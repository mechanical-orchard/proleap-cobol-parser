000010 IDENTIFICATION DIVISION.                                         00001003
000020 TITLE 'CASE RECEIVING FROM WMOS'                                 00002003
000030*---------------------------------------------------------------* 00003003
000040* CHANGED 12-01-2011 CHRISTINE TWIEHAUS     WR#40574            * 00004003
000050*         ADDED CAN (CARR_AUTH_ID). POPULATE WS008-CAN.         * 00005003
000051*---------------------------------------------------------------* 00005103
000052* CHANGED 03-22-2013 MARJ HOEFS             PRB 40432           * 00005203
000053*     REMOVED SELECT FROM PARAGRAPH 7020 BECAUSE IT WAS CAUSING * 00005303
000054*     A FATAL ERROR FOR SQLCODE -811.  MISC OTHER SMALL FIXES   * 00005403
000055*     MADE TOO.  AFFECTED LINES HAVE "HOEFS1" ON THEM.          * 00005503
000056*---------------------------------------------------------------* 00005603
000057*                                                                 00005703
000058 PROGRAM-ID.    WSKCS309.                                         00005803
000059 AUTHOR.        JEAN KURKOWSKI.                                   00005903
000060 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00006003
000061 DATE-WRITTEN.  MARCH 2007.                                       00006103
000062 DATE-COMPILED.                                                   00006203
000063 ENVIRONMENT DIVISION.                                            00006303
000064                                                                  00006403
000065 CONFIGURATION SECTION.                                           00006503
000066 SOURCE-COMPUTER. IBM-3090.                                       00006603
000067 OBJECT-COMPUTER. IBM-3090.                                       00006703
000068                                                                  00006803
000069 DATA DIVISION.                                                   00006903
000070 WORKING-STORAGE SECTION.                                         00007003
000080 01  PV-VARIABLES.                                                00008003
000090     05  PV-REPOS-TIMESTAMP           PIC X(26) VALUE SPACES.     00009003
000100* CHANGED FROM S9(05) TO -9(05) SO SQLCODE IS READABLE IN LOG.    00010003
000200     05  PV-DISPLAY-SQLCODE           PIC -9(03) VALUE ZEROES.    00020003
000300                                                                  00030003
000400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00040003
000500                                                     COMP SYNC.   00050003
000600     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     00060003
000700                                                     COMP SYNC.   00070003
000800     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 00080003
000900     05  PV-SML-BARCODE                  PIC X(18).               00090003
001000     05  PV-SML-BARCODE-R                REDEFINES PV-SML-BARCODE.00100003
001100         10  PV-SML-PACKAGING-TYP        PIC 9(01).               00110003
001200             88  PV-SML-INTERNAL-LBL     VALUE 4.                 00120003
001300         10  PV-SML-SOFTWARE-SRC         PIC 9(01).               00130003
001400             88  PV-SML-FROM-KOHLS       VALUE 1.                 00140003
001500         10  PV-SML-DIVERT.                                       00150003
001600             15  PV-SML-DIVERT-PFX       PIC 9(01).               00160003
001700             15  PV-SML-DIVERT-CDE       PIC 9(04).               00170003
001800         10  PV-SML-DC-ORIGIN            PIC 9(03).               00180003
001900         10  PV-SML-MNFST-NBR            PIC 9(08).               00190003
002000     05  PV-TRIP-ID                  PIC  S9(9) COMP.             00200003
002100     05  PV-DISPLAY-PO-NBR           PIC  9(09)  VALUE ZERO.      00210003
002200     05  PV-DISPLAY-RCVR             PIC  9(04)  VALUE ZERO.      00220003
002300     05  PV-DISPLAY-LINE             PIC  9(04)  VALUE ZERO.      00230003
002400     05  PV-DISPLAY-SKU-NBR          PIC  9(09)  VALUE ZERO.      00240003
002500     05  PV-DISPLAY-CRTN             PIC  9(18)  VALUE ZERO.      00250003
002600     05  PV-DISPLAY-TRIP             PIC  9(09)  VALUE ZERO.      00260003
002700     05  PV-DISPLAY-STORE            PIC  9(04)  VALUE ZERO.      00270003
002710     05  PV-DISPLAY-OPER             PIC  9(04)  VALUE ZERO.      00271003
002720     05  PV-DISPLAY-UPC              PIC  9(15)  VALUE ZERO.      00272003
002730     05  PV-DC-ORIGIN                PIC  9(04)  VALUE ZERO.      00273003
002740     05  PV-DC-ORIGIN-R REDEFINES PV-DC-ORIGIN.                   00274003
002750         10 PV-DC-ORIGIN-1              PIC  9(01).               00275003
002760         10 PV-DC-ORIGIN-3              PIC  9(03).               00276003
002770     05  PV-OTBND-CART-RCVR-SEQ-NBR  PIC  S9(9) COMP VALUE ZERO.  00277003
002780     05  PV-RCVR-SEQ-NBR             PIC  S9(9) COMP VALUE ZERO.  00278003
002790     05  PV-FRE-ASTRA-IND            PIC   X(1) VALUE SPACES.     00279003
002800     05  PV-SHIPT-UNT-ID             PIC  S9(18)V COMP-3.         00280003
002810     05  PV-WMC-RCVR-STATUS          PIC   X(02).                 00281003
002811     05  PV-WMC-VERFYD-TMST          PIC   X(26).                 00281103
002812     05  PV-PREPK-DRIVER-LINE        PIC  S9(9) COMP.             00281203
002813     05  PV-CASE-PREV-RCVD           PIC  S9(18)V COMP-3.         00281303
002814                                                                  00281403
002815     05  PV-SHIPT_UNT_ID             PIC  S9(18)V COMP-3.         00281503
002816     05  PV-TSHUUPC-TRN-NBR          PIC  S9(9) COMP.             00281603
002817     05  PV-TSHUUPC-TRN-LNE-NBR      PIC  S9(9) COMP.             00281703
002818     05  PV-VALID-PO-CNT             PIC S9(09)  COMP.            00281803
002819                                                                  00281903
002820 01  WS-FIELDS.                                                   00282003
002821     05  WS-CASE-NBR-CH               PIC X(20).                  00282103
002822     05  WS-CASE-NBR-PIC              REDEFINES WS-CASE-NBR-CH.   00282203
002823         10  WS-CASE-NBR              PIC 9(20).                  00282303
002824     05  WS-CART-SRC-CDE              PIC X(03).                  00282403
002825     05  WS-ORD-LNE-NBR               PIC S9(09) COMP VALUE +0.   00282503
002826     05  WS-TRN-LNE-NBR               PIC S9(09) COMP VALUE +0.   00282603
002827     05  WS-UPC-NBR                   PIC S9(15)V COMP VALUE +0.  00282703
002828     05  WS-ORIG-TRIP-ID              PIC S9(09) COMP VALUE +0.   00282803
002829     05  WS-RCVD-TRIP-ID              PIC S9(09) COMP VALUE +0.   00282903
002830     05  WS-REC-SEQ-NBR               PIC S9(09) COMP VALUE +0.   00283003
002840     05  WS-APP-PO-LNE-NBR            PIC S9(04) COMP VALUE +0.   00284003
002850     05  WS-ASN-LVL-CDE               PIC X(01).                  00285003
002860     05  WS-DISPLAY-1                 PIC -Z(08)9.                00286003
002870     05  WS-DISPLAY-2                 PIC -Z(08)9.                00287003
002880     05  WS-DISPLAY-3                 PIC -Z(08)9.                00288003
002890     05  WS-DISPLAY-4                 PIC -Z(14)9.                00289003
002900     05  WS-DISPLAY-CRTN              PIC  9(18) VALUE ZEROES.    00290003
003000     05  WS-DATE-TIME                 PIC X(26).                  00300003
003100     05  WS-DATE-TIME-OUT             REDEFINES WS-DATE-TIME.     00310003
003200         10  WS-DATE-OUT              PIC 9(10).                  00320003
003300         10  WS-FILL1                 PIC 9(01).                  00330003
003400         10  WS-TIME-OUT              PIC 9(08).                  00340003
003500         10  WS-FILL2                 PIC 9(07).                  00350003
003600     05 WS-FIELD                      PIC X(20) VALUE SPACES.     00360003
003700     05  WS-FIELD2 REDEFINES WS-FIELD.                            00370003
003800         10  WS-FIELD-CHAR     OCCURS 20 INDEXED BY X1 PIC X(01). 00380003
003900     05  WS-NUMERIC                   PIC 9(20).                  00390003
004000     05  WS-INDEX                     PIC 9(03).                  00400003
004100                                                                  00410003
004200 01  DK-KEYS.                                                     00420003
004300     05  DK-CASE-NBR                  PIC S9(18)V COMP-3 VALUE +0.00430003
004400     05  DK-PO-NBR                    PIC S9(09) COMP VALUE +0.   00440003
004500     05  DK-TRN-LNE-NBR               PIC S9(09) COMP VALUE +0.   00450003
004600     05  DK-SHPMT-NBR                 PIC X(20)  VALUE SPACES.    00460003
004700     05  DK-SHPMT-NBR-ORIG            PIC X(20)  VALUE SPACES.    00470003
004800     05  DK-EXT-SHP-ID                PIC X(20)  VALUE SPACES.    00480003
004900     05  DK-REC-SEQ-NBR               PIC S9(04) COMP VALUE +0.   00490003
005000     05  DK-REC-SEQ-NBR-NEW           PIC S9(04) COMP VALUE +0.   00500003
005100     05  DK-REC-SEQ-RECITM            PIC S9(04) COMP VALUE +0.   00510003
005200     05  DK-SKU-NBR                   PIC S9(08)V COMP-3 VALUE +0.00520003
005300     05  DK-TRN-NBR                   PIC S9(09) COMP VALUE +0.   00530003
005400     05  DK-TRIP-ID                   PIC S9(09) COMP VALUE +0.   00540003
005500     05  DK-RCVR-SEQ-NBR              PIC S9(09) COMP VALUE +0.   00550003
005600     05  DK-ORD-NBR                   PIC S9(09) COMP VALUE +0.   00560003
005700     05  DK-ORD-LNE-NBR               PIC S9(09) COMP VALUE +0.   00570003
005800     05  DK-SHIPT-UNT-ID              PIC S9(18)V COMP-3 VALUE +0.00580003
005900     05  DK-STR-NBR                   PIC S9(04) COMP VALUE +0.   00590003
006000     05  DK-DUMMY-SHP-ID              PIC X(12).                  00600003
006100     05  DK-DUMMY-SHP-ID-P            REDEFINES DK-DUMMY-SHP-ID.  00610003
006200         10  DK-DUMMY-EXT-SHP-ID      PIC X(10).                  00620003
006300         10  DK-DUMMY                 PIC X(01).                  00630003
006400         10  DK-DUMMY-WILDCARD        PIC X(01).                  00640003
006500                                                                  00650003
006600 01  PS-SWITCHES.                                                 00660003
006700     05  PS-OTBND-CART-EXISTS        PIC X(01)  VALUE 'N'.        00670003
006800         88  PS-OTBND-CART-EXISTS-NO            VALUE 'N'.        00680003
006900         88  PS-OTBND-CART-EXISTS-YES           VALUE 'Y'.        00690003
007000     05  PS-CICS-SWITCH-IND          PIC X(01)  VALUE 'N'.        00700003
007100         88  PS-CICS-SWITCH-NO                  VALUE 'N'.        00710003
007200         88  PS-CICS-SWITCH-YES                 VALUE 'Y'.        00720003
007300     05  PS-LNE-NOT-VRFD-IND         PIC X(01)  VALUE 'N'.        00730003
007400         88  PS-LNE-NOT-VRFD-YES                VALUE 'Y'.        00740003
007500         88  PS-LNE-NOT-VRFD-NO                 VALUE 'N'.        00750003
007600     05  PS-VRFD-LINE-EXISTS-IND     PIC X(01)  VALUE 'N'.        00760003
007700         88  PS-VRFD-LINE-EXISTS-YES            VALUE 'Y'.        00770003
007800         88  PS-VRFD-LINE-EXISTS-NO             VALUE 'N'.        00780003
007900     05  PS-PURITM-FOUND-IND         PIC X(01)  VALUE 'N'.        00790003
008000         88  PS-PURITM-FOUND-ONE                VALUE 'O'.        00800003
008100         88  PS-PURITM-FOUND-MULT               VALUE 'M'.        00810003
008200         88  PS-PURITM-FOUND-NONE               VALUE 'N'.        00820003
008300     05  PS-VRFD-CRTN-LNE-IND        PIC X(01)  VALUE 'N'.        00830003
008400         88  PS-VRFD-CRTN-LNE-NO                VALUE 'N'.        00840003
008500         88  PS-VRFD-CRTN-LNE-YES               VALUE 'Y'.        00850003
008600     05  PS-FREE-ASTRAY-IND          PIC X(01)  VALUE 'N'.        00860003
008700         88  PS-FREE-ASTRAY-YES                 VALUE 'Y'.        00870003
008800         88  PS-FREE-ASTRAY-NO                  VALUE 'N'.        00880003
008900     05  PS-RCVR-MATCH-IND           PIC X(01)  VALUE 'N'.        00890003
009000         88  PS-RCVR-MATCH-YES                  VALUE 'Y'.        00900003
009100         88  PS-RCVR-MATCH-NO                   VALUE 'N'.        00910003
009200     05  PS-CASE-LNE-VRFD-IND        PIC X(01)  VALUE 'N'.        00920003
009300         88  PS-CASE-LNE-VRFD-YES               VALUE 'Y'.        00930003
009400         88  PS-CASE-LNE-VRFD-NO                VALUE 'N'.        00940003
009500     05  PS-EOF-PO-RCVR-CSR          PIC X(01)  VALUE 'N'.        00950003
009600         88  PS-EOF-PO-RCVR-CSR-YES             VALUE 'Y'.        00960003
009700         88  PS-EOF-PO-RCVR-CSR-NO              VALUE 'N'.        00970003
009800     05  PS-RCVR-FOUND-IND           PIC X(01)  VALUE 'N'.        00980003
009900         88  PS-RCVR-FOUND-YES                  VALUE 'Y'.        00990003
010000         88  PS-RCVR-FOUND-NO                   VALUE 'N'.        01000003
010100     05  PS-RECITM-CREATED-SW        PIC X(01)  VALUE 'N'.        01010003
010200         88  PS-NEW-RECITM-CREATED-YES          VALUE 'Y'.        01020003
010300         88  PS-NEW-RECITM-CREATED-NO           VALUE 'N'.        01030003
010400     05  PS-SHUNLO-CRTN-EXISTS-SW    PIC X(01)  VALUE 'N'.        01040003
010500         88  PS-SHUNLO-CRTN-EXISTS              VALUE 'Y'.        01050003
010600         88  PS-SHUNLO-CRTN-NOT-EXISTS          VALUE 'N'.        01060003
010700     05  PS-RECITM-FOUND-SW          PIC X(01)  VALUE 'N'.        01070003
010800         88  PS-RECITM-FOUND                    VALUE 'Y'.        01080003
010900         88  PS-RECITM-NOT-FOUND                VALUE 'N'.        01090003
011000     05  PS-FA-PACK-SLIP-IND         PIC X(01)  VALUE 'N'.        01100003
011100         88  PS-FA-PACK-SLIP-FOUND              VALUE 'Y'.        01110003
011200         88  PS-FA-PACK-SLIP-NOT-FOUND          VALUE 'N'.        01120003
011300     05  PS-FA-RCVR-IND              PIC X(01)  VALUE 'N'.        01130003
011400         88  PS-FA-RCVR-YES                     VALUE 'Y'.        01140003
011500         88  PS-FA-RCVR-NO                      VALUE 'N'.        01150003
011600     05  PS-CHECK-CR-VALID-PO-SW     PIC X(01)  VALUE 'N'.        01160003
011700         88  PS-CHECK-CR-VALID-PO-YES           VALUE 'Y'.        01170003
011800         88  PS-CHECK-CR-VALID-PO-NO            VALUE 'N'.        01180003
011900     05  PS-CART-HAS-LINE-SKU-SW     PIC X(01)  VALUE 'N'.        01190003
012000         88  PS-CART-HAS-LINE-SKU-YES           VALUE 'Y'.        01200003
012100         88  PS-CART-HAS-LINE-SKU-NO            VALUE 'N'.        01210003
012200                                                                  01220003
012300     05  PS-CR-VALID-CASE-NBR-SW     PIC X(01)  VALUE 'N'.        01230003
012400         88  PS-CR-VALID-CASE-NBR               VALUE 'Y'.        01240003
012500         88  PS-CR-VALID-CASE-NBR-NO            VALUE 'N'.        01250003
012600     05  PS-CR-VALID-PO-NBR-SW       PIC X(01)  VALUE 'N'.        01260003
012700         88  PS-CR-VALID-PO-NBR                 VALUE 'Y'.        01270003
012800         88  PS-CR-VALID-PO-NBR-NO              VALUE 'N'.        01280003
012900                                                                  01290003
013000     05  PS-PO-EXISTS-SW             PIC X(01)  VALUE 'N'.        01300003
013100         88  PS-PO-EXISTS                       VALUE 'Y'.        01310003
013200         88  PS-PO-EXISTS-NO                    VALUE 'N'.        01320003
013300                                                                  01330003
013400 01  PC-CONSTANTS.                                                01340003
013500     05  PC-MAX-RETRIES              PIC S9(04) VALUE +3          01350003
013600                                                COMP.             01360003
013610     05  PC-DEFAULT-NINES            PIC X(26)  VALUE             01361003
013620                              '9999-09-09-09.09.09.999999'.       01362003
013630     05  PC-DEFAULT-DATE             PIC X(10)  VALUE             01363003
013640                                              '9999-09-09'.       01364003
013650     05  PC-HIGH-NINES               PIC S9(04) VALUE +9999 COMP. 01365003
013660     05  PC-ADD-UPD-PKSLIP-MOD       PIC X(08)  VALUE             01366003
013670                                                 'WSKCS311'.      01367003
013680     05  PC-RCVR-CREATE-MOD          PIC X(08)  VALUE             01368003
013690                                                 'WSKCS312'.      01369003
013700     05  PC-ADD-UPD-PKSLIP-MOD-LEN   PIC S9(4) VALUE +100         01370003
013800                                                COMP SYNC.        01380003
013900     05  PC-MAX-CARTON-TBL-ENTRY     PIC S9(04)  VALUE  +5000     01390003
014000                                                 COMP SYNC.       01400003
014100     05  PC-UNKNWN-PRO               PIC X(11)  VALUE             01410003
014200                                                'WM UNKNOWN '.    01420003
014300* CLT 02-24-2012 WR40574 START                                    01430003
014400     05  PC-UNKNWN-CAN               PIC X(11)  VALUE             01440003
014410                                                'WM UNKNOWN '.    01441003
014420* CLT 02-24-2012 WR40574 ENDRT                                    01442003
014430                                                                  01443003
014440*================================================================*01444003
014450* CARTON TABLE - THIS TABLE WILL CONTAIN AN ENTRY FOR EACH CRTN  *01445003
014460*      ASSIGNED.  THIS TABLE WILL ONLY BE CREATED IF VIRTUAL     *01446003
014470*      LABELS ARE BEING CREATED.  THIS TABLE WILL BE USED TO     *01447003
014480*      CREATE ENTRIES                                            *01448003
014490*                     MAXIMUM TABLE ENTRIES = 5000               *01449003
014500*================================================================*01450003
014600 01  PT-CARTON-TABLE.                                             01460003
014700     05  PT-CARTON OCCURS 5000 TIMES                              01470003
014800                              INDEXED BY PT-CRTN-IDX.             01480003
014900         10  PT-CRTN-ASSGN-SEQ-NBR    PIC  9(04).                 01490003
015000         10  PT-CRTN-MSTR-CRTN        PIC  9(04).                 01500003
015100         10  PT-CRTN-STORE-NBR        PIC  9(04).                 01510003
015200         10  PT-CRTN-STORE-TYP        PIC  X(02).                 01520003
015300             88  PT-CRTN-CENTRL-STCK             VALUE 'CS'.      01530003
015400             88  PT-CRTN-DISTRB-CNTR             VALUE 'DC'.      01540003
015500             88  PT-CRTN-STORE                   VALUE 'DS'.      01550003
015600             88  PT-CRTN-RETURN-VNDR             VALUE 'RV'.      01560003
015700         10  PT-CRTN-OTPK-QTY         PIC  9(04).                 01570003
015800         10  PT-CRTN-MSTR             PIC  X(01).                 01580003
015900         10  PT-CRTN-USE              PIC  X(01).                 01590003
016000             88  PT-CRTN-FCSE-SML                VALUE 'F'.       01600003
016100             88  PT-CRTN-INPK-SML                VALUE 'I'.       01610003
016200         10  PT-CRTN-LBL-TYP          PIC  X(01).                 01620003
016300             88  PT-CRTN-SML                     VALUE 'S'.       01630003
016400             88  PT-CRTN-P2L                     VALUE 'P'.       01640003
016500         10  PT-CRTN-E-COMMERCE-IND   PIC  X(01).                 01650003
016600             88  PT-CRTN-E-COMMERCE-YES          VALUE 'Y'.       01660003
016700             88  PT-CRTN-E-COMMERCE-NO           VALUE 'N'.       01670003
016800         10  PT-CRTN-MANIFEST-NBR     PIC S9(09) VALUE ZEROES     01680003
016900                                                 COMP.            01690003
017000         10  PT-CRTN-SEASET-IND       PIC  X(01).                 01700003
017100             88  PT-CRTN-SEASET-YES              VALUE 'Y'.       01710003
017200             88  PT-CRTN-SEASET-NO               VALUE 'N'.       01720003
017300         10  PT-CRTN-FIXT-ID          PIC  X(10).                 01730003
017400         10  PT-CRTN-SEASONAL-SET     PIC  X(25).                 01740003
017500                                                                  01750003
017600* * * RECEIPT PIX TRANSACTIONS FROM WMOS                          01760003
017700     COPY WSRD014.                                                01770003
017800* * * COMM AREA TO PASS CARTON INFO TO FREE ASTRAY MODULE         01780003
017900     COPY WSWS008.                                                01790003
018000* * * COMM AREA TO PASS RECEIPT PIX INFO FROM CALLING PROGRAM     01800003
018100     COPY WSWS007.                                                01810003
018200                                                                  01820003
018300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   01830003
018400* PKT_TXT LAYOUT FOR TUPLDER FOR BAD CASE RECEIPT TRACKING        01840003
018500* DMH 05/02/16                                                    01850003
018600* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   01860003
018700     COPY WSWS024.                                                01870003
018800                                                                  01880003
018900                                                                  01890003
019000* * * LAYOUT FOR THE ABEND COMMUNICATIONS AREA                    01900003
019100     COPY DPWS013.                                                01910003
019200                                                                  01920003
019300* * * COMMUNICATIONS AREA FOR DB2                                 01930003
019400     EXEC SQL                                                     01940003
019500          INCLUDE SQLCA                                           01950003
019600     END-EXEC.                                                    01960003
019700* * * WST_SHPMT_XREF_HDR VIEW                                     01970003
019800     EXEC SQL                                                     01980003
019900         INCLUDE WST00001                                         01990003
020000     END-EXEC.                                                    02000003
020100* * * WST_SHPMT_XREF_DTL VIEW                                     02010003
020200     EXEC SQL                                                     02020003
020300         INCLUDE WST00002                                         02030003
020400     END-EXEC.                                                    02040003
020500* * * WST_ATTR_DEFN VIEW                                          02050003
020600     EXEC SQL                                                     02060003
020700         INCLUDE WST00009                                         02070003
020800     END-EXEC.                                                    02080003
020900* * * WST_ATTR_ELEM VIEW                                          02090003
021000     EXEC SQL                                                     02100003
021100         INCLUDE WST00010                                         02110003
021200     END-EXEC.                                                    02120003
021300* * * WST_INTGRTN_TYP VIEW                                        02130003
021400     EXEC SQL                                                     02140003
021500         INCLUDE WST00008                                         02150003
021600     END-EXEC.                                                    02160003
021700* * * SUT_OTBND_UPC VIEW                                          02170003
021800     EXEC SQL                                                     02180003
021900         INCLUDE SUT00028                                         02190003
022000     END-EXEC.                                                    02200003
022100* * * SUT_OTBND_CART VIEW                                         02210003
022200     EXEC SQL                                                     02220003
022300         INCLUDE SUT00024                                         02230003
022400     END-EXEC.                                                    02240003
022500* * * SUT_OTBND_LOC VIEW                                          02250003
022600     EXEC SQL                                                     02260003
022700         INCLUDE SUT00027                                         02270003
022800     END-EXEC.                                                    02280003
022900* * * XLV_UPC VIEW                                                02290003
023000     EXEC SQL                                                     02300003
023100         INCLUDE XLV00003                                         02310003
023200     END-EXEC.                                                    02320003
023300* * * XLV_SKU VIEW                                                02330003
023400     EXEC SQL                                                     02340003
023500         INCLUDE XLV00000                                         02350003
023600     END-EXEC.                                                    02360003
023700* * * TSHUNLO VIEW                                                02370003
023800     EXEC SQL                                                     02380003
023900         INCLUDE TSHUNLO                                          02390003
024000     END-EXEC.                                                    02400003
024100* * * TPKSLIP VIEW                                                02410003
024200     EXEC SQL                                                     02420003
024300         INCLUDE TPKSLIP                                          02430003
024400     END-EXEC.                                                    02440003
024500* * * TINPKSU VIEW                                                02450003
024600     EXEC SQL                                                     02460003
024700         INCLUDE TINPKSU                                          02470003
024800     END-EXEC.                                                    02480003
024900* * * TSHPUNT VIEW                                                02490003
025000     EXEC SQL                                                     02500003
025100         INCLUDE TSHPUNT                                          02510003
025200     END-EXEC.                                                    02520003
025300* * * TDCSTMF VIEW                                                02530003
025400     EXEC SQL                                                     02540003
025500         INCLUDE TDCSTMF                                          02550003
025600     END-EXEC.                                                    02560003
025700* * * TSHIPMT VIEW                                                02570003
025800     EXEC SQL                                                     02580003
025900         INCLUDE TSHIPMT                                          02590003
026000     END-EXEC.                                                    02600003
026100* * * TSHUUPC VIEW                                                02610003
026200     EXEC SQL                                                     02620003
026300         INCLUDE TSHUUPC                                          02630003
026400     END-EXEC.                                                    02640003
026500* * * TSHPTPO VIEW                                                02650003
026600     EXEC SQL                                                     02660003
026700         INCLUDE TSHPTPO                                          02670003
026800     END-EXEC.                                                    02680003
026900* * * TPURITM VIEW                                                02690003
027000     EXEC SQL                                                     02700003
027100         INCLUDE TPURITM                                          02710003
027200     END-EXEC.                                                    02720003
027300* * * TPURCHS                                                     02730003
027400     EXEC SQL                                                     02740003
027500         INCLUDE TPURCHS                                          02750003
027600     END-EXEC.                                                    02760003
027700* * * TRECEIV VIEW                                                02770003
027800     EXEC SQL                                                     02780003
027900         INCLUDE TRECEIV                                          02790003
028000     END-EXEC.                                                    02800003
028100* * * TRECITM VIEW                                                02810003
028200     EXEC SQL                                                     02820003
028300         INCLUDE TRECITM                                          02830003
028400     END-EXEC.                                                    02840003
028500* * * TRECDIS VIEW                                                02850003
028600     EXEC SQL                                                     02860003
028700         INCLUDE TRECDIS                                          02870003
028800     END-EXEC.                                                    02880003
028900* * * XLT_UPC                                                     02890003
029000     EXEC SQL                                                     02900003
029100         INCLUDE XLT00006                                         02910003
029200     END-EXEC.                                                    02920003
029300* * * XLT_SKU                                                     02930003
029400     EXEC SQL                                                     02940003
029410         INCLUDE XLT00003                                         02941003
029420     END-EXEC.                                                    02942003
029430* * * TKRPRPM - PARM TABLE                                        02943003
029440     EXEC SQL                                                     02944003
029450         INCLUDE TKRPRPM                                          02945003
029460     END-EXEC.                                                    02946003
029470                                                                  02947003
029471* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02947103
029472* TUPLDER - UPLOAD ERROR TABLE                                  * 02947203
029473* DMH - 5/02/16                                                 * 02947303
029474* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02947403
029475     EXEC SQL                                                     02947503
029476         INCLUDE TUPLDER                                          02947603
029477     END-EXEC.                                                    02947703
029478                                                                  02947803
029479**DECLARE THE CURSOR SELECTING MANIFEST NBR FROM TDCSTMF          02947903
029480                                                                  02948003
029490     EXEC SQL                                                     02949003
029500         DECLARE  DCSTMF_CSR CURSOR FOR                           02950003
029600          SELECT  MFST_NBR                                        02960003
029700            FROM  TDCSTMF                                         02970003
029800        WHERE STR_NBR = :DK-STR-NBR                               02980003
029900        FOR UPDATE OF MFST_NBR                                    02990003
030000     END-EXEC.                                                    03000003
030100                                                                  03010003
030200**DECLARE THE CURSOR SELECTING PO/SKU EXISTS ON TRIP              03020003
030300     EXEC SQL                                                     03030003
030400         DECLARE  PO-RCVR-CSR CURSOR FOR                          03040003
030500          SELECT DISTINCT                                         03050003
030600                 D.ORD_NBR                                        03060003
030700               , D.REC_SEQ_NBR                                    03070003
030800               , D.STATUS_CDE                                     03080003
030900          FROM                                                    03090003
031000                 TSHIPMT  B                                       03100003
031100               , TSHPTPO  C                                       03110003
031200               , TRECITM  D                                       03120003
031300               , XLV_SKU  F                                       03130003
031400          WHERE  B.TRIP_ID        = :DK-TRIP-ID                   03140003
031500          AND    C.PO_NBR         = :DK-PO-NBR                    03150003
031600          AND    F.SKU_NBR        = :DK-SKU-NBR                   03160003
031700          AND    B.SHIPT_ID       = C.SHIPT_ID                    03170003
031800          AND    C.PO_NBR         = D.ORD_NBR                     03180003
031900          AND    C.REC_SEQ_NBR    = D.REC_SEQ_NBR                 03190003
032000          AND    D.ITM_NBR        = F.ITM_NBR                     03200003
032100          AND    D.VER_STATUS_CDE = 'A'                           03210003
032200          AND    C.PRIM_SHIPT_IND = 'Y'                           03220003
032300**                                                                03230003
032400*** DMH 11/6                                                      03240003
032500          AND    D.STATUS_CDE    <> 'VE'                          03250003
032600*** DMH 11/6                                                      03260003
032610**                                                                03261003
032620          ORDER BY D.STATUS_CDE                                   03262003
032630     END-EXEC.                                                    03263003
032640                                                                  03264003
032650                                                                  03265003
032660******************************************************************03266003
032670 LINKAGE SECTION.                                                 03267003
032680******************************************************************03268003
032690 01  DFHCOMMAREA.                                                 03269003
032700     05  FILLER                         OCCURS  1 TO 4072 TIMES   03270003
032800                                      DEPENDING ON EIBCALEN.      03280003
032900         10  FILLER                   PIC X.                      03290003
033000                                                                  03300003
033100******************************************************************03310003
033200 PROCEDURE DIVISION.                                              03320003
033300******************************************************************03330003
033400                                                                  03340003
033500     INITIALIZE                        WS007-RECEIPT-PIX-RECORD.  03350003
033600     MOVE DFHCOMMAREA              TO  WS007-RECEIPT-PIX-RECORD.  03360003
033700                                                                  03370003
033800     INITIALIZE PV-CICS-MSG-AREA.                                 03380003
033900     STRING   ' ' WS007-SRC-TASK-NUMBER                           03390003
034000              ' WSKCS309 CALLED FROM '                            03400003
034100              WS007-CALLING-PROGRAM-NAME                          03410003
034200              ' TIME '                                            03420003
034300               WS014-CRE-TMST                                     03430003
034400              DELIMITED BY SIZE                                   03440003
034500                                 INTO PV-CICS-MSG-AREA.           03450003
034600     PERFORM 8000-WRITE-TO-CICS-LOG.                              03460003
034700                                                                  03470003
034800     INITIALIZE PV-CICS-MSG-AREA.                                 03480003
034900     STRING   WS007-WSRD014-RECORD(1:73)                          03490003
035000              DELIMITED BY SIZE                                   03500003
035100                                 INTO PV-CICS-MSG-AREA.           03510003
035200     PERFORM 8000-WRITE-TO-CICS-LOG.                              03520003
035300                                                                  03530003
035400     INITIALIZE PV-CICS-MSG-AREA.                                 03540003
035500     STRING   WS007-WSRD014-RECORD(74:80)                         03550003
035600              DELIMITED BY SIZE                                   03560003
035700                                 INTO PV-CICS-MSG-AREA.           03570003
035800     PERFORM 8000-WRITE-TO-CICS-LOG.                              03580003
035900                                                                  03590003
036000     INITIALIZE PV-CICS-MSG-AREA.                                 03600003
036100     STRING   WS007-WSRD014-RECORD(154:50)                        03610003
036200              DELIMITED BY SIZE                                   03620003
036300                                 INTO PV-CICS-MSG-AREA.           03630003
036400     PERFORM 8000-WRITE-TO-CICS-LOG.                              03640003
036500                                                                  03650003
036600     PERFORM 0500-INITIALIZE-PGM.                                 03660003
036700                                                                  03670003
036800* MOVE THIS LINE ABOVE THE RIGHT-JUSTIFY LOGIC.  PREVIOUSLY       03680003
036900* THE FIELD BEING JUSTIFIED HAD NOT YET BEEN POPULATED.           03690003
036901     MOVE WS007-WSRD014-RECORD    TO WS014-RECEIPT-PIX-RECORD.    03690103
036902                                                                  03690203
036903* RIGHT JUSTIFY AND ZERO FILL THE CASE NUMBER                     03690303
036904                                                                  03690403
036905     SET X1 TO 20.                                                03690503
036906     MOVE WS014-CASE-NUMBER TO WS-FIELD.                          03690603
036907     PERFORM UNTIL WS-FIELD-CHAR(X1) NOT = ' '                    03690703
036908         SET X1 DOWN BY 1                                         03690803
036909     END-PERFORM.                                                 03690903
036910     SET WS-INDEX TO X1.                                          03691003
036920     MOVE WS-FIELD(1:WS-INDEX)    TO WS-NUMERIC.                  03692003
036930     INSPECT WS-NUMERIC REPLACING ALL ' ' BY '0'.                 03693003
036940     MOVE WS-NUMERIC TO WS014-CASE-NUMBER.                        03694003
036950                                                                  03695003
036960     MOVE WS014-PO-NUMBER         TO DK-PO-NBR.                   03696003
036970     MOVE WS014-REC-SEQ-NUMBER    TO DK-REC-SEQ-NBR               03697003
036980                                     DK-REC-SEQ-NBR-NEW.          03698003
036990     MOVE WS014-SKU-NUMBER        TO DK-SKU-NBR.                  03699003
037000     MOVE WS014-PO-LINE-NUMBER    TO WS-TRN-LNE-NBR.              03700003
037100                                                                  03710003
037200*                                                                 03720003
037300*** DMH - 1/28/16 -  BEGIN                                        03730003
037400*                                                                 03740003
037500     IF  WS014-CASE-NUMBER NUMERIC                                03750003
037600         MOVE WS014-CASE-NUMBER        TO WS-CASE-NBR-CH          03760003
037700         MOVE WS-CASE-NBR              TO DK-CASE-NBR             03770003
037800* DMH 02/20/2017 - BEGIN                                          03780003
037810         MOVE WS014-PO-LINE-NUMBER     TO DK-TRN-LNE-NBR          03781003
037820* DMH 02/20/20/17 - END                                           03782003
037830         SET  PS-CHECK-CR-VALID-PO-NO  TO  TRUE                   03783003
037840         PERFORM 1003-PO-VALIDATION-PARM                          03784003
037850         IF  PS-CHECK-CR-VALID-PO-YES                             03785003
037860             PERFORM 1005-VALIDATE-CORRECT-PO                     03786003
037870*                                                                 03787003
037880*** DMH - 11/22/19 BEGIN                                          03788003
037890*** CHECK IF VALID INBOUND CARTON AND THAT THE PO NUMBER ON       03789003
037900*** ON THE PIX MATCHES TSHUUPC                                    03790003
038000             PERFORM 5100-VALIDATE-CASE-PO                        03800003
038100*** DMH - 11/22/19 END                                            03810003
038200*                                                                 03820003
038300         END-IF                                                   03830003
038400     END-IF.                                                      03840003
038500*                                                                 03850003
038600*** DMH - 1/28/16 -  END                                          03860003
038700*                                                                 03870003
038800                                                                  03880003
038900     IF WS014-CASE-NUMBER NUMERIC                                 03890003
039000         MOVE WS014-CASE-NUMBER   TO WS-CASE-NBR-CH               03900003
039100         MOVE WS-CASE-NBR         TO DK-CASE-NBR                  03910003
039200         MOVE ZEROES              TO PV-OTBND-CART-RCVR-SEQ-NBR   03920003
039300         PERFORM 1010-CHK-FOR-ORIG-CARTON                         03930003
039400     ELSE                                                         03940003
039500         MOVE 'INVALID CASE NUMBER '                              03950003
039600                                  TO WS007-CRA-RET-MSG            03960003
039700                                     DP013-MESSAGE-TEXT(1)        03970003
039800         MOVE 'MAIN PROC'         TO WS007-SQL-ERROR-PARA         03980003
039900                                     DP013-PARAGRAPH              03990003
040000                                                                  04000003
040100         INITIALIZE PV-CICS-MSG-AREA                              04010003
040200         STRING   ' ' WS007-SRC-TASK-NUMBER                       04020003
040300                  ' WSKCS309-MAIN: INVALID CASE NBR:'             04030003
040400                  WS014-CASE-NUMBER                               04040003
040500                  DELIMITED BY SIZE                               04050003
040600                                 INTO PV-CICS-MSG-AREA            04060003
040700         PERFORM 8000-WRITE-TO-CICS-LOG                           04070003
040800     END-IF.                                                      04080003
040900                                                                  04090003
041000*                                                                 04100003
041100*** DMH 09/08/17 - BEGIN                                          04110003
041200*** IF OUTBOUND CARTON ALREADY EXISTS AND WMU (USING UCC128)      04120003
041201*** CHECK TO SEE IF THE LINE/SKU IN THE PIX IS ALREADY IN THE     04120103
041202*** OUTBOUND CARTON UPC DATABASE                                  04120203
041203     SET  PS-CART-HAS-LINE-SKU-NO  TO  TRUE.                      04120303
041204     IF  PS-OTBND-CART-EXISTS-YES  AND                            04120403
041205         WS-CART-SRC-CDE = 'WMU'                                  04120503
041206         PERFORM 1050-CHECK-LINE-SKU-PREV-RCVD                    04120603
041207     END-IF.                                                      04120703
041208*                                                                 04120803
041209*** DMH 09/08/17 - END                                            04120903
041210*                                                                 04121003
041211                                                                  04121103
041212*                                                                 04121203
041213*** DMH 5/2/16 BEGIN                                              04121303
041214*** IF OUTBOUND CARTON ALREADY EXISTS AND RECEIVER IS VERIFIED    04121403
041215*** ERROR OUT THIS CARTON                                         04121503
041216*                                                                 04121603
041217     MOVE  SPACES  TO  PV-WMC-RCVR-STATUS.                        04121703
041218     IF  PS-OTBND-CART-EXISTS-YES                                 04121803
041219         PERFORM 1007-CHECK-RCVR-NOT-VE                           04121903
041220     END-IF.                                                      04122003
041230                                                                  04123003
041240*** IF OUTBOUND CARTON ALREADY EXISTS AND RECEIVER IS VERIFIED    04124003
041250*** INVENTORY CONTROL DOES NOT WANT A NEW RECEIVER CREATED.       04125003
041260*** THEY WANT TO HAVE THE CARTON ERROR OUT.                       04126003
041270*** COMMENTED OUT THE LINES TO CREATE NEW RECEIVER *INVCNTL       04127003
041280     IF  PS-OTBND-CART-EXISTS-YES      AND                        04128003
041290         PV-WMC-RCVR-STATUS   = 'VE'                              04129003
041291*INVCNTL     MOVE 'WMC'  TO WS-CART-SRC-CDE                       04129103
041292*INVCNTL     PERFORM 5000-VALID-SHPMT-CHK                         04129203
041293*INVCNTL     PERFORM 5030-CHECK-SHIPMT-DTL                        04129303
041294*INVCNTL     MOVE  ZERO  TO  WS014-CASE-NUMBER                    04129403
041295*INVCNTL     MOVE  ZERO  TO  WS-CASE-NBR                          04129503
041296*INVCNTL     MOVE  ZERO  TO  DK-CASE-NBR                          04129603
041297*INVCNTL     SET  PS-OTBND-CART-EXISTS-NO  TO  TRUE               04129703
041298*INVCNTL     PERFORM 7000-SKU-RECEIPT                             04129803
041299*                                                                 04129903
041300*INVCNTL - BEG - THIS WILL WRITE RECORD TO ERROR QUEUE            04130003
041301*INVCNTL         TO APPEAR ON MISSING CASES REPORT                04130103
041302*INVCNTL                                                          04130203
041303             MOVE 'CASE PREVIOUSLY RECEIVED '                     04130303
041304                                  TO WS007-CRA-RET-MSG            04130403
041305                                     DP013-MESSAGE-TEXT(1)        04130503
041306             MOVE 'MAIN PROC'     TO WS007-SQL-ERROR-PARA         04130603
041307                                     DP013-PARAGRAPH              04130703
041308                                                                  04130803
041309             INITIALIZE PV-CICS-MSG-AREA                          04130903
041310             STRING   ' ' WS007-SRC-TASK-NUMBER                   04131003
041311                      ' WSKCS309-MAIN: CASE PREV RCVD:'           04131103
041312                      WS014-CASE-NUMBER                           04131203
041313                      DELIMITED BY SIZE                           04131303
041314                                 INTO PV-CICS-MSG-AREA            04131403
041315             PERFORM 8000-WRITE-TO-CICS-LOG                       04131503
041316*INVCNTL - END                                                    04131603
041317*                                                                 04131703
041318     ELSE                                                         04131803
041319*                                                                 04131903
041320*** DMH 5/2/16 END                                                04132003
041330*                                                                 04133003
041340     IF PS-OTBND-CART-EXISTS-YES AND WS-CART-SRC-CDE = 'WMC'      04134003
041350             PERFORM 2000-CHECK-LINE-ITEMS                        04135003
041360             PERFORM 5030-CHECK-SHIPMT-DTL                        04136003
041370             IF WS-ASN-LVL-CDE NOT = 'C'                          04137003
041380                 PERFORM 7040-CHECK-IF-PKSLIP-IS-FA               04138003
041390             END-IF                                               04139003
041400             IF PS-FA-PACK-SLIP-FOUND                             04140003
041500                 PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD             04150003
041600             END-IF                                               04160003
041700                                                                  04170003
041800*                                                                 04180003
041900*** DMH 09/08/17                                                  04190003
042000*** IF OUTBOUND CARTON ALREADY EXISTS  AND                        04200003
042100***    CARTON SOURCE WMU  (USING UCC128 DATA)                     04210003
042200***    AND THE LINE/SKU IS ALREADY ON OUTBOUND UPC                04220003
042300***    ERROR THIS PIX OUT AS BEING PREVIUOSLY RECEIVED            04230003
042400***                                                               04240003
042500     ELSE                                                         04250003
042600     IF PS-OTBND-CART-EXISTS-YES AND                              04260003
042700        WS-CART-SRC-CDE = 'WMU'  AND                              04270003
042710        PS-CART-HAS-LINE-SKU-YES                                  04271003
042720             MOVE 'WMU CASE PREVIOUSLY RCVD '                     04272003
042730                                  TO WS007-CRA-RET-MSG            04273003
042740                                     DP013-MESSAGE-TEXT(1)        04274003
042741             MOVE 'MAIN PROC'     TO WS007-SQL-ERROR-PARA         04274103
042742                                     DP013-PARAGRAPH              04274203
042743                                                                  04274303
042744             INITIALIZE PV-CICS-MSG-AREA                          04274403
042745             STRING   ' ' WS007-SRC-TASK-NUMBER                   04274503
042746                      ' WSKCS309-MAIN: WMU CASE PREV RCVD:'       04274603
042747                      WS014-CASE-NUMBER                           04274703
042748                      DELIMITED BY SIZE                           04274803
042749                                 INTO PV-CICS-MSG-AREA            04274903
042750             PERFORM 8000-WRITE-TO-CICS-LOG                       04275003
042751***                                                               04275103
042752*** DMH 09/08/17 - END                                            04275203
042753*                                                                 04275303
042754                                                                  04275403
042755* *  ELSE OTBND CARTON DOES NOT EXIST                             04275503
042756     ELSE                                                         04275603
042757*                                                                 04275703
042758*** DMH - 11/03/17 BEGIN                                          04275803
042759*** CHECK IF VALID INBOUND CARTON AND THAT THE PO NUMBER ON       04275903
042760*** ON THE PIX MATCHES TSHUUPC                                    04276003
042761****DMH  PERFORM 5100-VALIDATE-CASE-PO                            04276103
042762*** DMH - 11/03/17 END                                            04276203
042763*                                                                 04276303
042764         PERFORM 5000-VALID-SHPMT-CHK                             04276403
042765         PERFORM 5030-CHECK-SHIPMT-DTL                            04276503
042766         EVALUATE TRUE                                            04276603
042767             WHEN WS-ASN-LVL-CDE = 'S'                            04276703
042768                 MOVE 'WMC'  TO WS-CART-SRC-CDE                   04276803
042769                 PERFORM 7000-SKU-RECEIPT                         04276903
042770             WHEN WS-ASN-LVL-CDE = 'C'                            04277003
042780                 MOVE 'WMU'  TO WS-CART-SRC-CDE                   04278003
042790                 PERFORM 6000-CASE-RECEIPT                        04279003
042800             WHEN OTHER                                           04280003
042900* SLH 8/2007 - TREAT NOT FOUNDS AS SKU LEVEL                      04290003
043000                 MOVE 'WMC'  TO WS-CART-SRC-CDE                   04300003
043100                 PERFORM 7000-SKU-RECEIPT                         04310003
043200         END-EVALUATE                                             04320003
043300     END-IF.                                                      04330003
043400                                                                  04340003
043500     INITIALIZE PV-CICS-MSG-AREA.                                 04350003
043600     STRING   ' ' WS007-SRC-TASK-NUMBER                           04360003
043700              ' EXITING FROM WSKCS309'                            04370003
043800              DELIMITED BY SIZE                                   04380003
043900                                 INTO PV-CICS-MSG-AREA.           04390003
044000     PERFORM 8000-WRITE-TO-CICS-LOG.                              04400003
044100                                                                  04410003
044200     MOVE WS007-RECEIPT-PIX-RECORD      TO DFHCOMMAREA.           04420003
044300                                                                  04430003
044400     EXEC CICS                                                    04440003
044500         RETURN                                                   04450003
044600     END-EXEC.                                                    04460003
044700                                                                  04470003
044800/                                                                 04480003
044900 0500-INITIALIZE-PGM.                                             04490003
045000                                                                  04500003
045100     IF PS-CICS-SWITCH-YES                                        04510003
045200          STRING  ' ' WS007-SRC-TASK-NUMBER                       04520003
045300                  ' WSKCS309-0500-INITIALIZE-PGM          '       04530003
045400                  DELIMITED BY SIZE                               04540003
045500            INTO  PV-CICS-MSG-AREA                                04550003
045600         PERFORM 8000-WRITE-TO-CICS-LOG                           04560003
045700     END-IF.                                                      04570003
045800                                                                  04580003
045900     SET WS007-SUCCESSFUL        TO TRUE.                         04590003
046000     INITIALIZE DCLWST00001                                       04600003
046100                DCLWST00002                                       04610003
046200                DCLWST00008                                       04620003
046300                DCLWST00009                                       04630003
046400                DCLWST00010                                       04640003
046500                DCLSUT00024                                       04650003
046600                DCLSUT00027                                       04660003
046700                DCLSUT00028                                       04670003
046800                DCLXLV00000                                       04680003
046900                DCLXLV00003                                       04690003
047000                DCLTDCSTMF                                        04700003
047100                DCLTSHUNLO                                        04710003
047200                DCLTSHPUNT                                        04720003
047300                DCLTSHUUPC                                        04730003
047400                DCLTRECEIV                                        04740003
047500                DCLTRECITM                                        04750003
047600                DCLTRECDIS                                        04760003
047700                DCLTPKSLIP                                        04770003
047800                DCLTINPKSU                                        04780003
047900                DCLTSHIPMT                                        04790003
048000                DCLTSHPTPO                                        04800003
048100                DCLTPURITM.                                       04810003
048200                                                                  04820003
048300     INITIALIZE PV-VARIABLES.                                     04830003
048400     MOVE 'N'              TO    PS-OTBND-CART-EXISTS             04840003
048500                                  PS-CICS-SWITCH-IND              04850003
048600                                  PS-LNE-NOT-VRFD-IND             04860003
048700                                  PS-VRFD-LINE-EXISTS-IND         04870003
048800                                  PS-PURITM-FOUND-IND             04880003
048900                                  PS-VRFD-CRTN-LNE-IND            04890003
049000                                  PS-FREE-ASTRAY-IND              04900003
049100                                  PS-RCVR-MATCH-IND               04910003
049200                                  PS-CASE-LNE-VRFD-IND            04920003
049300                                  PS-EOF-PO-RCVR-CSR              04930003
049400                                  PS-RCVR-FOUND-IND               04940003
049500                                  PS-RECITM-CREATED-SW            04950003
049600                                  PS-SHUNLO-CRTN-EXISTS-SW.       04960003
049700                                                                  04970003
049800     PERFORM 0510-CICS-LOGGING.                                   04980003
049900     PERFORM 8030-GET-REPOS-TMST.                                 04990003
050000                                                                  05000003
050100/                                                                 05010003
050200 0510-CICS-LOGGING.                                               05020003
050300                                                                  05030003
050400     IF PS-CICS-SWITCH-YES                                        05040003
050500          STRING  ' ' WS007-SRC-TASK-NUMBER                       05050003
050600                  ' WSKCS309-0510-CICS-LOGGING            '       05060003
050700                  DELIMITED BY SIZE                               05070003
050800            INTO  PV-CICS-MSG-AREA                                05080003
050900         PERFORM 8000-WRITE-TO-CICS-LOG                           05090003
051000     END-IF.                                                      05100003
051100                                                                  05110003
051200* READ PARM TO DETERMINE CICS LOGGING                             05120003
051300                                                                  05130003
051400     EXEC SQL                                                     05140003
051500         SELECT  D.ATTR_ELEM_TXT                                  05150003
051600         INTO  :PS-CICS-SWITCH-IND                                05160003
051700         FROM   WST_INTGRTN_TYP A                                 05170003
051800              , WST_ATTR_DEFN   B                                 05180003
051900              , WST_ATTR_ELEM   C                                 05190003
052000              , WST_ATTR_ELEM   D                                 05200003
052100         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   05210003
052200           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           05220003
052300           AND  B.ATTR_DEFN_SEQ_NBR = 1                           05230003
052400           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           05240003
052500           AND  C.ATTR_DEFN_SEQ_NBR = 1                           05250003
052600           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           05260003
052700           AND  D.ATTR_DEFN_SEQ_NBR = 2                           05270003
052800           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         05280003
052900           AND  C.ATTR_ELEM_TXT     = 'WSKCS309'                  05290003
053000     END-EXEC.                                                    05300003
053100                                                                  05310003
053200     EVALUATE TRUE                                                05320003
053300         WHEN SQLCODE = ZERO                                      05330003
053400             IF PS-CICS-SWITCH-YES                                05340003
053500                 STRING   ' ' WS007-SRC-TASK-NUMBER               05350003
053600                          ' WSKCS309-0510:'                       05360003
053700                          ' CICS LOGGING TURNED ON'               05370003
053800                          DELIMITED BY SIZE                       05380003
053900                                      INTO PV-CICS-MSG-AREA       05390003
054000                 PERFORM 8000-WRITE-TO-CICS-LOG                   05400003
054100             END-IF                                               05410003
054200* SQLCODE -904, -913, -911, -803 SHOULD BE TREATED AS FATAL.      05420003
054300*        WHEN SQLCODE = -904                                      05430003
054400*        WHEN SQLCODE = -913                                      05440003
054500*        WHEN SQLCODE = -911                                      05450003
054600*        WHEN SQLCODE = -803                                      05460003
054700*            CONTINUE                                             05470003
054800         WHEN SQLWARN0 NOT = SPACES                               05480003
054900         WHEN SQLCODE NOT = ZERO                                  05490003
055000             MOVE SQLCODE             TO WS007-SQLCODE            05500003
055100                                         PV-DISPLAY-SQLCODE       05510003
055200             INITIALIZE PV-CICS-MSG-AREA                          05520003
055300             STRING   ' ' WS007-SRC-TASK-NUMBER                   05530003
055400                      ' WSKCS309-0510 ERROR:'                     05540003
055500                      ' SQL='                                     05550003
055600                      PV-DISPLAY-SQLCODE                          05560003
055700                      DELIMITED BY SIZE                           05570003
055800                                   INTO PV-CICS-MSG-AREA          05580003
055900             PERFORM 8000-WRITE-TO-CICS-LOG                       05590003
056000                                                                  05600003
056100             SET WS007-INVALID-SQL    TO TRUE                     05610003
056200             MOVE '0510-CICS-LOGGING'                             05620003
056300                                      TO WS007-SQL-ERROR-PARA     05630003
056400                                         DP013-PARAGRAPH          05640003
056500             MOVE SQLCA               TO WS007-SQLCA              05650003
056600                                         DP013-SQLCA              05660003
056700             STRING 'SQL='                                        05670003
056800                  PV-DISPLAY-SQLCODE                              05680003
056900                  DELIMITED BY SIZE                               05690003
057000                                    INTO WS007-CRA-RET-MSG        05700003
057100             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   05710003
057200             MOVE 'WST_INTGRTN_TYP'   TO                          05720003
057300                                       DP013-DB2-TABLE-NAME (1)   05730003
057400             MOVE 'WST_ATTR_DEFN'     TO                          05740003
057500                                       DP013-DB2-TABLE-NAME (2)   05750003
057600             MOVE 'WST_ATTR_ELEM'     TO                          05760003
057700                                       DP013-DB2-TABLE-NAME (3)   05770003
057800             SET DP013-DB2-ABEND  TO TRUE                         05780003
057900             PERFORM 9999-ABEND                                   05790003
058000     END-EVALUATE.                                                05800003
058100                                                                  05810003
058200/                                                                 05820003
058300****************************************************************  05830003
058400* CHECK PARM WSCRPO TO SEE IF WE ARE VALIDATING THE PO NUMBER  *  05840003
058500* ON THE CASE RECEIPT PIX FOR THIS FACILITY  (EFC/OHL)         *  05850003
058600* DMH - 2/02/16 ADDED                                          *  05860003
058700****************************************************************  05870003
058800 1003-PO-VALIDATION-PARM.                                         05880003
058801                                                                  05880103
058802     IF PS-CICS-SWITCH-YES                                        05880203
058803          STRING  ' ' WS007-SRC-TASK-NUMBER                       05880303
058804                  ' WSKCS309-1003-PO-VALIDATION-PARM      '       05880403
058805                  DELIMITED BY SIZE                               05880503
058806            INTO  PV-CICS-MSG-AREA                                05880603
058807         PERFORM 8000-WRITE-TO-CICS-LOG                           05880703
058808     END-IF.                                                      05880803
058809                                                                  05880903
058810     MOVE WS014-DC-LOCATION  TO KRPRPM-LOC-ID.                    05881003
058811                                                                  05881103
058812     EXEC SQL                                                     05881203
058813        SELECT   FUNC_TXT                                         05881303
058814         INTO   :PS-CHECK-CR-VALID-PO-SW                          05881403
058815         FROM    TKRPRPM                                          05881503
058816         WHERE   LOC_ID             = :KRPRPM-LOC-ID              05881603
058817           AND   INTFC_SYS_CDE      = 'WMS'                       05881703
058818           AND   SYS_PRC_FUNC_CDE   = 'WSCRPO'                    05881803
058819           AND   FUNC_PRC_STAT_CDE  = 'AC'                        05881903
058820           AND   FUNC_BEG_TMST     <= CURRENT TIMESTAMP           05882003
058821           AND   FUNC_END_TMST     >= CURRENT TIMESTAMP           05882103
058822          WITH UR                                                 05882203
058823     END-EXEC.                                                    05882303
058824                                                                  05882403
058825     EVALUATE TRUE                                                05882503
058826         WHEN SQLCODE = ZERO                                      05882603
058827              CONTINUE                                            05882703
058828                                                                  05882803
058829         WHEN SQLCODE = +100                                      05882903
058830              SET  PS-CHECK-CR-VALID-PO-NO  TO  TRUE              05883003
058831                                                                  05883103
058832         WHEN SQLWARN0 NOT = SPACES                               05883203
058833         WHEN SQLCODE NOT = ZERO                                  05883303
058834              SET  PS-CHECK-CR-VALID-PO-NO  TO  TRUE              05883403
058835     END-EVALUATE.                                                05883503
058836                                                                  05883603
058837                                                                  05883703
058838****************************************************************  05883803
058839* VERIFY THAT THE PO # THAT IS IN THE CASE RECEIPT PIX         *  05883903
058840* MATCHES THE PO ON THE UCC128 DATA (TSHUUPC)   IF THE         *  05884003
058850* PO DOES NO MATCH - UPDATE THE PIX TO THE CORRECT PO          *  05885003
058860* DMH - 1/29/16 ADDED                                          *  05886003
058870****************************************************************  05887003
058880 1005-VALIDATE-CORRECT-PO.                                        05888003
058890                                                                  05889003
058900     IF PS-CICS-SWITCH-YES                                        05890003
058910          STRING  ' ' WS007-SRC-TASK-NUMBER                       05891003
058911                  ' WSKCS309-1005-VALIDATE-CORRECT-PO     '       05891103
058912                  DELIMITED BY SIZE                               05891203
058913            INTO  PV-CICS-MSG-AREA                                05891303
058914         PERFORM 8000-WRITE-TO-CICS-LOG                           05891403
058915     END-IF.                                                      05891503
058916                                                                  05891603
058917     MOVE WS014-CASE-NUMBER  TO DK-CASE-NBR.                      05891703
058918     MOVE WS014-SKU-QTY      TO SHUUPC-SHPD-QTY.                  05891803
058919                                                                  05891903
058920     EXEC SQL                                                     05892003
058921        SELECT  A.TRN_NBR                                         05892103
058922            ,   A.TRN_LNE_NBR                                     05892203
058923         INTO   :SHUUPC-TRN-NBR                                   05892303
058924            ,   :SHUUPC-TRN-LNE-NBR                               05892403
058925         FROM    TSHUUPC  A                                       05892503
058926            ,    XLT_SKU  B                                       05892603
058927            ,    XLT_UPC  C                                       05892703
058928         WHERE   A.SHIPT_UNT_ID   = :DK-CASE-NBR                  05892803
058929           AND   A.UPC_NBR        = C.UPC_NBR                     05892903
058930           AND   C.INTR_UPC_ID    = B.INTR_UPC_ID                 05893003
058931           AND   B.SKU_NBR        = :DK-SKU-NBR                   05893103
058932           AND   SHPD_QTY         = :SHUUPC-SHPD-QTY              05893203
058933          WITH UR                                                 05893303
058934     END-EXEC.                                                    05893403
058935                                                                  05893503
058936     EVALUATE TRUE                                                05893603
058937         WHEN SQLCODE = ZERO                                      05893703
058938         WHEN SQLCODE = -811                                      05893803
058939              IF  SHUUPC-TRN-NBR      =  DK-PO-NBR   AND          05893903
058940                  SHUUPC-TRN-LNE-NBR  =  DK-TRN-LNE-NBR           05894003
058941                  CONTINUE                                        05894103
058942              ELSE                                                05894203
058943* 2/25/2021 - DENISE                                              05894303
058944              IF  SHUUPC-TRN-NBR      =  DK-PO-NBR   AND          05894403
058945                  NOT SHUUPC-TRN-LNE-NBR =  DK-TRN-LNE-NBR        05894503
058946                                                                  05894603
058947                   MOVE DK-CASE-NBR     TO PV-DISPLAY-CRTN        05894703
058948                   MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR      05894803
058949                   MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR        05894903
058950                   MOVE DK-TRN-LNE-NBR  TO PV-DISPLAY-LINE        05895003
058951                   INITIALIZE PV-CICS-MSG-AREA                    05895103
058952                   STRING   ' ' WS007-SRC-TASK-NUMBER             05895203
058953                            ' WSKCS309-1005 BAD PO-LNE NBR'       05895303
058954                            ' SSCC:' PV-DISPLAY-CRTN              05895403
058955                            '  PO:'   PV-DISPLAY-PO-NBR           05895503
058956                            '-'       PV-DISPLAY-RCVR             05895603
058957                            '-'       PV-DISPLAY-LINE             05895703
058958                                 DELIMITED BY SIZE                05895803
058959                            INTO PV-CICS-MSG-AREA                 05895903
058960                   PERFORM 8000-WRITE-TO-CICS-LOG                 05896003
058961                                                                  05896103
058962                    MOVE SHUUPC-TRN-LNE-NBR                       05896203
058963                                        TO WS014-PO-LINE-NUMBER   05896303
058964                                           DK-TRN-LNE-NBR         05896403
058965                                           WS-TRN-LNE-NBR         05896503
058966* 2/25/2021 - DENISE - END                                        05896603
058967                                                                  05896703
058968              ELSE                                                05896803
058969                 MOVE DK-CASE-NBR     TO PV-DISPLAY-CRTN          05896903
058970                 MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR        05897003
058971                 MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR          05897103
058972                 MOVE DK-TRN-LNE-NBR  TO PV-DISPLAY-LINE          05897203
058973                 INITIALIZE PV-CICS-MSG-AREA                      05897303
058974                 STRING   ' ' WS007-SRC-TASK-NUMBER               05897403
058975                          ' WSKCS309-1005 INCORRECT PO '          05897503
058976                          ' SSCC:' PV-DISPLAY-CRTN                05897603
058977                          '  PO:'   PV-DISPLAY-PO-NBR             05897703
058978                          '-'       PV-DISPLAY-RCVR               05897803
058979                          '-'       PV-DISPLAY-LINE               05897903
058980                               DELIMITED BY SIZE                  05898003
058981                          INTO PV-CICS-MSG-AREA                   05898103
058982                 PERFORM 8000-WRITE-TO-CICS-LOG                   05898203
058983                                                                  05898303
058984* DMH 05/02/16 BEGIN                                              05898403
058985                 MOVE WS014-DC-LOCATION TO UPLDER-OPER-UNT-ID     05898503
058986                 MOVE 'I'               TO UPLDER-UPLD-TRN-CDE    05898603
058987                 MOVE '001'             TO UPLDER-ERR-CDE         05898703
058988                                                                  05898803
058989                 MOVE WS014-STORE-NUMBER                          05898903
058990                                        TO WS024-STORE-NUMBER     05899003
058991                 MOVE WS014-CASE-NUMBER TO WS024-CASE-NUMBER      05899103
058992                 MOVE WS014-PO-NUMBER   TO WS024-PO-NUMBER        05899203
058993                 MOVE WS014-REC-SEQ-NUMBER                        05899303
058994                                        TO WS024-REC-SEQ-NUMBER   05899403
058995                 MOVE WS014-PO-LINE-NUMBER                        05899503
058996                                        TO WS024-PO-LINE-NUMBER   05899603
058997                 MOVE WS014-SKU-NUMBER  TO WS024-SKU-NUMBER       05899703
058998                 MOVE WS014-SKU-QTY     TO WS024-SKU-QTY          05899803
058999                 MOVE WS014-CRE-USER-ID TO WS024-CRE-USER-ID      05899903
059000                 MOVE SHUUPC-TRN-NBR    TO WS024-NEW-PO-NUMBER    05900003
059001                 MOVE WS014-RCVD-SHPMT-NBR                        05900103
059002                                        TO WS024-RCVD-SHPMT-NBR   05900203
059003* DMH - 02/20/2017 - BEGIN                                        05900303
059004                 MOVE SHUUPC-TRN-LNE-NBR                          05900403
059005                                        TO WS024-NEW-LINE         05900503
059006                                           WS-TRN-LNE-NBR         05900603
059007* DMH - 02/20/2017 - AFTER                                        05900703
059008                                                                  05900803
059009                 MOVE WS024-UPLOAD-ERROR-RECORD                   05900903
059010                                        TO UPLDER-PKT-TXT         05901003
059011                 PERFORM 1006-WRITE-TUPLDER                       05901103
059012                                                                  05901203
059013                                                                  05901303
059014* DMH 05/02/16 BEGIN                                              05901403
059015                                                                  05901503
059016                 MOVE  SHUUPC-TRN-NBR  TO WS014-PO-NUMBER         05901603
059017                                          DK-PO-NBR               05901703
059018                                          DK-TRN-NBR              05901803
059019                 MOVE DK-PO-NBR        TO PV-DISPLAY-PO-NBR       05901903
059020* 2/20/2017  BEGIN                                                05902003
059021                 MOVE SHUUPC-TRN-LNE-NBR TO WS014-PO-LINE-NUMBER  05902103
059022                                            PV-DISPLAY-LINE       05902203
059023* 2/20/2017  END                                                  05902303
059024                                                                  05902403
059025                 INITIALIZE PV-CICS-MSG-AREA                      05902503
059026                 STRING  ' ' WS007-SRC-TASK-NUMBER                05902603
059027                         ' WSKCS309-1005- UPDATED PO   '          05902703
059028                         ' SSCC:' PV-DISPLAY-CRTN                 05902803
059029                         '  PO:'  PV-DISPLAY-PO-NBR               05902903
059030                         '  LNE:' PV-DISPLAY-LINE                 05903003
059031                                         DELIMITED BY SIZE        05903103
059032                                    INTO PV-CICS-MSG-AREA         05903203
059033                 PERFORM 8000-WRITE-TO-CICS-LOG                   05903303
059034             END-IF                                               05903403
059035             END-IF                                               05903503
059036                                                                  05903603
059037         WHEN SQLCODE = +100                                      05903703
059038              CONTINUE                                            05903803
059039                                                                  05903903
059040         WHEN SQLWARN0 NOT = SPACES                               05904003
059041         WHEN SQLCODE NOT = ZERO                                  05904103
059042             MOVE SQLCODE             TO WS007-SQLCODE            05904203
059043                                         PV-DISPLAY-SQLCODE       05904303
059044             MOVE DK-CASE-NBR            TO PV-DISPLAY-CRTN       05904403
059045             MOVE DK-PO-NBR              TO PV-DISPLAY-PO-NBR     05904503
059046             MOVE DK-RCVR-SEQ-NBR        TO PV-DISPLAY-RCVR       05904603
059047             MOVE DK-SKU-NBR             TO PV-DISPLAY-SKU-NBR    05904703
059048             INITIALIZE PV-CICS-MSG-AREA                          05904803
059049             STRING   ' ' WS007-SRC-TASK-NUMBER                   05904903
059050                      ' WSKCS309-1005 ERROR:'                     05905003
059051                      ' SSCC:'              PV-DISPLAY-CRTN       05905103
059052                      ' SQL:'               PV-DISPLAY-SQLCODE    05905203
059053                      ' PO:'                PV-DISPLAY-PO-NBR     05905303
059054                      '-'                   PV-DISPLAY-RCVR       05905403
059055                      ' SKU:'               PV-DISPLAY-SKU-NBR    05905503
059056                                            DELIMITED BY SIZE     05905603
059057                                       INTO PV-CICS-MSG-AREA      05905703
059058             PERFORM 8000-WRITE-TO-CICS-LOG                       05905803
059059                                                                  05905903
059060             SET WS007-INVALID-SQL    TO TRUE                     05906003
059061             MOVE '1005-VALIDATE-CORRECT-PO  '                    05906103
059062                                      TO WS007-SQL-ERROR-PARA     05906203
059063                                         DP013-PARAGRAPH          05906303
059064             MOVE SQLCA               TO WS007-SQLCA              05906403
059065                                         DP013-SQLCA              05906503
059066             STRING 'SQL='                                        05906603
059067                  PV-DISPLAY-SQLCODE                              05906703
059068                  DELIMITED BY SIZE                               05906803
059069                                    INTO WS007-CRA-RET-MSG        05906903
059070             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   05907003
059071             MOVE 'TSHUUPC'           TO                          05907103
059072                                       DP013-DB2-TABLE-NAME (1)   05907203
059073             SET DP013-DB2-ABEND      TO TRUE                     05907303
059074             PERFORM 9999-ABEND                                   05907403
059075     END-EVALUATE.                                                05907503
059076                                                                  05907603
059077                                                                  05907703
059078****************************************************************  05907803
059079* WRITE BAD CASE RECEIPT PIX TO UPLDER ERROR TABLE FOR         *  05907903
059080* TRACKING PURPOSES                                            *  05908003
059081* DMH 5/2/16                                                   *  05908103
059082****************************************************************  05908203
059083 1006-WRITE-TUPLDER.                                              05908303
059084                                                                  05908403
059085     IF PS-CICS-SWITCH-YES                                        05908503
059086          STRING  ' ' WS007-SRC-TASK-NUMBER                       05908603
059087                  ' WSKCS309-1006-WRITE-TUPLDER           '       05908703
059088                  DELIMITED BY SIZE                               05908803
059089            INTO  PV-CICS-MSG-AREA                                05908903
059090         PERFORM 8000-WRITE-TO-CICS-LOG                           05909003
059091     END-IF.                                                      05909103
059092                                                                  05909203
059093     EXEC SQL                                                     05909303
059094          INSERT INTO TUPLDER                                     05909403
059095              ( OPER_UNT_ID                                       05909503
059096               ,UPLD_TRN_CDE                                      05909603
059097               ,ERR_CDE                                           05909703
059098               ,PRC_TMST                                          05909803
059099               ,UPLD_SEQ_NBR                                      05909903
059100               ,PKT_TXT                                           05910003
059101              )                                                   05910103
059102          VALUES                                                  05910203
059103              (                                                   05910303
059104               :UPLDER-OPER-UNT-ID                                05910403
059105             , :UPLDER-UPLD-TRN-CDE                               05910503
059106             , :UPLDER-ERR-CDE                                    05910603
059107             ,  CURRENT TIMESTAMP                                 05910703
059108             ,  0                                                 05910803
059109             , :UPLDER-PKT-TXT                                    05910903
059110              )                                                   05911003
059111     END-EXEC.                                                    05911103
059112                                                                  05911203
059113     EVALUATE TRUE                                                05911303
059114         WHEN SQLCODE = ZERO                                      05911403
059115             IF PS-CICS-SWITCH-YES                                05911503
059116                 INITIALIZE PV-CICS-MSG-AREA                      05911603
059117                 STRING   ' WSKCS309-1006:'                       05911703
059118                          ' INSERT TO TUPLDER:'                   05911803
059119                          'SHPMT=' WS-DISPLAY-1                   05911903
059120                           UPLDER-PKT-TXT                         05912003
059121                          DELIMITED BY SIZE                       05912103
059122                          INTO PV-CICS-MSG-AREA                   05912203
059123                 PERFORM 8000-WRITE-TO-CICS-LOG                   05912303
059124             END-IF                                               05912403
059125         WHEN SQLWARN0 NOT = SPACES                               05912503
059126         WHEN SQLCODE NOT = ZERO                                  05912603
059127             MOVE SQLCODE             TO WS007-SQLCODE            05912703
059128                                         PV-DISPLAY-SQLCODE       05912803
059129             MOVE WS014-RCVD-SHPMT-NBR  TO WS-DISPLAY-1           05912903
059130             MOVE SUT00024-SHIPT-UNT-ID TO WS-DISPLAY-CRTN        05913003
059131             INITIALIZE PV-CICS-MSG-AREA                          05913103
059132             STRING   ' ' WS007-SRC-TASK-NUMBER                   05913203
059133                      ' WSKCS309-1006 ERROR:'                     05913303
059134                      ' SQL='                                     05913403
059135                      PV-DISPLAY-SQLCODE                          05913503
059136                      ' SHPMT=' WS-DISPLAY-1                      05913603
059137                      ' CRTN =' WS-DISPLAY-CRTN                   05913703
059138                      DELIMITED BY SIZE                           05913803
059139                                   INTO PV-CICS-MSG-AREA          05913903
059140             PERFORM 8000-WRITE-TO-CICS-LOG                       05914003
059141                                                                  05914103
059142             SET WS007-INVALID-SQL    TO TRUE                     05914203
059143             MOVE '1006-INS-TUPLDER   '                           05914303
059144                                      TO WS007-SQL-ERROR-PARA     05914403
059145                                         DP013-PARAGRAPH          05914503
059146             MOVE SQLCA               TO WS007-SQLCA              05914603
059147                                         DP013-SQLCA              05914703
059148             STRING 'SQL='                                        05914803
059149                  PV-DISPLAY-SQLCODE                              05914903
059150                  DELIMITED BY SIZE                               05915003
059151                                    INTO WS007-CRA-RET-MSG        05915103
059152             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   05915203
059153             MOVE 'TUPLDER       '    TO                          05915303
059154                                       DP013-DB2-TABLE-NAME (1)   05915403
059155             SET DP013-DB2-ABEND      TO TRUE                     05915503
059156             PERFORM 9999-ABEND                                   05915603
059157     END-EVALUATE.                                                05915703
059158                                                                  05915803
059159                                                                  05915903
059160****************************************************************  05916003
059161* CHECK TO MAKE SURE THAT RECEIVER IS NOT VERIFIED             *  05916103
059162* IF VERIFIED - ERROR OUT                                      *  05916203
059163* DMH - 5/04/16 ADDED                                          *  05916303
059164****************************************************************  05916403
059165 1007-CHECK-RCVR-NOT-VE.                                          05916503
059166                                                                  05916603
059167     IF PS-CICS-SWITCH-YES                                        05916703
059168          STRING  ' ' WS007-SRC-TASK-NUMBER                       05916803
059169                  ' WSKCS309-1007-CHECK-RCVR-NOT-VE       '       05916903
059170                  DELIMITED BY SIZE                               05917003
059171            INTO  PV-CICS-MSG-AREA                                05917103
059172         PERFORM 8000-WRITE-TO-CICS-LOG                           05917203
059173     END-IF.                                                      05917303
059174                                                                  05917403
059175     EXEC SQL                                                     05917503
059176         SELECT STATUS_CDE                                        05917603
059177              , VERFYD_TMST                                       05917703
059178           INTO :PV-WMC-RCVR-STATUS                               05917803
059179              , :PV-WMC-VERFYD-TMST                               05917903
059180           FROM TRECEIV                                           05918003
059181           WHERE ORD_NBR        = :DK-TRN-NBR                     05918103
059182             AND REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR                05918203
059183             AND VER_STATUS_CDE = 'A'                             05918303
059184          WITH UR                                                 05918403
059185     END-EXEC.                                                    05918503
059186                                                                  05918603
059187     EVALUATE TRUE                                                05918703
059188         WHEN SQLCODE = ZERO                                      05918803
059189              IF  PV-WMC-RCVR-STATUS  = 'VE'                      05918903
059190                 MOVE WS014-CASE-NUMBER TO PV-DISPLAY-CRTN        05919003
059200                 MOVE DK-TRN-NBR        TO PV-DISPLAY-PO-NBR      05920003
059210                 MOVE DK-RCVR-SEQ-NBR   TO PV-DISPLAY-RCVR        05921003
059211                 INITIALIZE PV-CICS-MSG-AREA                      05921103
059212                 STRING   ' ' WS007-SRC-TASK-NUMBER               05921203
059213                          ' WSKCS309-1007-WMC RCVR VE'            05921303
059214                          ' SSCC:' PV-DISPLAY-CRTN                05921403
059215                          '  PO:'   PV-DISPLAY-PO-NBR             05921503
059216                          '-'       PV-DISPLAY-RCVR               05921603
059217                               DELIMITED BY SIZE                  05921703
059218                          INTO PV-CICS-MSG-AREA                   05921803
059219                 PERFORM 8000-WRITE-TO-CICS-LOG                   05921903
059220                                                                  05922003
059221                 MOVE WS014-DC-LOCATION TO UPLDER-OPER-UNT-ID     05922103
059222                 MOVE 'I'               TO UPLDER-UPLD-TRN-CDE    05922203
059223                 MOVE '002'             TO UPLDER-ERR-CDE         05922303
059224                                                                  05922403
059225                 MOVE WS014-STORE-NUMBER                          05922503
059226                                        TO WS024-STORE-NUMBER     05922603
059227                 MOVE WS014-CASE-NUMBER TO WS024-CASE-NUMBER      05922703
059228                 MOVE DK-TRN-NBR        TO WS024-PO-NUMBER        05922803
059229                 MOVE DK-RCVR-SEQ-NBR   TO WS024-REC-SEQ-NUMBER   05922903
059230                 MOVE WS014-PO-LINE-NUMBER                        05923003
059231                                        TO WS024-PO-LINE-NUMBER   05923103
059232                 MOVE WS014-SKU-NUMBER  TO WS024-SKU-NUMBER       05923203
059233                 MOVE WS014-SKU-QTY     TO WS024-SKU-QTY          05923303
059234                 MOVE WS014-CRE-USER-ID TO WS024-CRE-USER-ID      05923403
059235                 MOVE SHUUPC-TRN-NBR    TO WS024-NEW-PO-NUMBER    05923503
059236                 MOVE WS014-RCVD-SHPMT-NBR                        05923603
059237                                        TO WS024-RCVD-SHPMT-NBR   05923703
059238                                                                  05923803
059239                 MOVE WS024-UPLOAD-ERROR-RECORD                   05923903
059240                                        TO UPLDER-PKT-TXT         05924003
059241                 PERFORM 1006-WRITE-TUPLDER                       05924103
059242                                                                  05924203
059243             END-IF                                               05924303
059244                                                                  05924403
059245         WHEN SQLCODE = +100                                      05924503
059246              CONTINUE                                            05924603
059247                                                                  05924703
059248         WHEN SQLWARN0 NOT = SPACES                               05924803
059249         WHEN SQLCODE NOT = ZERO                                  05924903
059250             MOVE SQLCODE             TO WS007-SQLCODE            05925003
059260                                         PV-DISPLAY-SQLCODE       05926003
059261             MOVE WS014-CASE-NUMBER      TO PV-DISPLAY-CRTN       05926103
059262             MOVE DK-TRN-NBR             TO PV-DISPLAY-PO-NBR     05926203
059263             MOVE DK-RCVR-SEQ-NBR        TO PV-DISPLAY-RCVR       05926303
059264             MOVE DK-SKU-NBR             TO PV-DISPLAY-SKU-NBR    05926403
059265             INITIALIZE PV-CICS-MSG-AREA                          05926503
059266             STRING   ' ' WS007-SRC-TASK-NUMBER                   05926603
059267                      ' WSKCS309-1007 ERROR:'                     05926703
059268                      ' SSCC:'              PV-DISPLAY-CRTN       05926803
059269                      ' SQL:'               PV-DISPLAY-SQLCODE    05926903
059270                      ' PO:'                PV-DISPLAY-PO-NBR     05927003
059271                      '-'                   PV-DISPLAY-RCVR       05927103
059272                      ' SKU:'               PV-DISPLAY-SKU-NBR    05927203
059273                                            DELIMITED BY SIZE     05927303
059274                                       INTO PV-CICS-MSG-AREA      05927403
059275             PERFORM 8000-WRITE-TO-CICS-LOG                       05927503
059276                                                                  05927603
059277             SET WS007-INVALID-SQL    TO TRUE                     05927703
059278             MOVE '1007-CHECK-RCVR-NOT-VE    '                    05927803
059279                                      TO WS007-SQL-ERROR-PARA     05927903
059280                                         DP013-PARAGRAPH          05928003
059281             MOVE SQLCA               TO WS007-SQLCA              05928103
059282                                         DP013-SQLCA              05928203
059283             STRING 'SQL='                                        05928303
059284                  PV-DISPLAY-SQLCODE                              05928403
059285                  DELIMITED BY SIZE                               05928503
059286                                    INTO WS007-CRA-RET-MSG        05928603
059287             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   05928703
059288             MOVE 'TRECEIV'           TO                          05928803
059289                                       DP013-DB2-TABLE-NAME (1)   05928903
059290             SET DP013-DB2-ABEND      TO TRUE                     05929003
059291             PERFORM 9999-ABEND                                   05929103
059292     END-EVALUATE.                                                05929203
059293                                                                  05929303
059294                                                                  05929403
059295****************************************************************  05929503
059296*                                                              *  05929603
059297****************************************************************  05929703
059298 1010-CHK-FOR-ORIG-CARTON.                                        05929803
059299                                                                  05929903
059300     IF PS-CICS-SWITCH-YES                                        05930003
059301          STRING  ' ' WS007-SRC-TASK-NUMBER                       05930103
059302                  ' WSKCS309-1010-CHK-FOR-ORIG-CARTON     '       05930203
059303                  DELIMITED BY SIZE                               05930303
059304            INTO  PV-CICS-MSG-AREA                                05930403
059305         PERFORM 8000-WRITE-TO-CICS-LOG                           05930503
059306     END-IF.                                                      05930603
059307                                                                  05930703
059308* CHECK IF OUTBOUND CARTON ALREADY EXISTS.  IF IT DOES, THEN      05930803
059309* WE HAVE RECEIVED AT LEAST ONE SKU FROM THIS CARTON ALREADY.     05930903
059310                                                                  05931003
059311     EXEC SQL                                                     05931103
059312          SELECT DISTINCT                                         05931203
059313                 A.TRN_NBR                                        05931303
059314               , A.RCVR_SEQ_NBR                                   05931403
059315               , B.CART_SRC_CDE                                   05931503
059316               , A.SHIPT_UNT_ID                                   05931603
059317          INTO   :SUT00028-TRN-NBR                                05931703
059318               , :SUT00028-RCVR-SEQ-NBR                           05931803
059319               , :SUT00024-CART-SRC-CDE                           05931903
059320               , :SUT00028-SHIPT-UNT-ID                           05932003
059330          FROM   SUT_OTBND_UPC  A                                 05933003
059340               , SUT_OTBND_CART B                                 05934003
059350          WHERE  B.ORIG_CART_ID = :DK-CASE-NBR                    05935003
059360          AND    A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                  05936003
059370          AND    B.ACTV_IND     = 'Y'                             05937003
059380     END-EXEC.                                                    05938003
059390                                                                  05939003
059400     EVALUATE TRUE                                                05940003
059500         WHEN SQLCODE = ZERO                                      05950003
059600             SET PS-OTBND-CART-EXISTS-YES TO TRUE                 05960003
059700             MOVE SUT00024-CART-SRC-CDE   TO WS-CART-SRC-CDE      05970003
059800             MOVE SUT00028-TRN-NBR        TO DK-TRN-NBR           05980003
059900             MOVE SUT00028-RCVR-SEQ-NBR   TO DK-RCVR-SEQ-NBR      05990003
060000                                             DK-REC-SEQ-NBR       06000003
060100* SAVE RCVR SEQ # IN CASE IT IS BLANK ON THE PIX                  06010003
060200                                       PV-OTBND-CART-RCVR-SEQ-NBR 06020003
060300             MOVE SUT00028-SHIPT-UNT-ID   TO DK-SHIPT-UNT-ID      06030003
060400                                             PV-SML-BARCODE       06040003
060500             IF PS-CICS-SWITCH-YES                                06050003
060600                 INITIALIZE PV-CICS-MSG-AREA                      06060003
060700                 MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN              06070003
060800                 STRING   ' ' WS007-SRC-TASK-NUMBER               06080003
060900                          ' WSKCS309-1010:'                       06090003
061000                          ' CART SRC CDE='                        06100003
061100                          SUT00024-CART-SRC-CDE                   06110003
061200                          ' '                                     06120003
061300                          PV-DISPLAY-CRTN                         06130003
061400                          DELIMITED BY SIZE                       06140003
061500                                        INTO PV-CICS-MSG-AREA     06150003
061600                 PERFORM 8000-WRITE-TO-CICS-LOG                   06160003
061700             END-IF                                               06170003
061800         WHEN SQLCODE = +100                                      06180003
061900             SET PS-OTBND-CART-EXISTS-NO TO TRUE                  06190003
062000* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            06200003
062100*        WHEN SQLCODE = -904                                      06210003
062200*        WHEN SQLCODE = -913                                      06220003
062300*        WHEN SQLCODE = -911                                      06230003
062400*            CONTINUE                                             06240003
062500         WHEN SQLWARN0 NOT = SPACES                               06250003
062600         WHEN SQLCODE NOT = ZERO                                  06260003
062700             MOVE SQLCODE             TO WS007-SQLCODE            06270003
062800                                         PV-DISPLAY-SQLCODE       06280003
062900             INITIALIZE PV-CICS-MSG-AREA                          06290003
063000             MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN                  06300003
063100             STRING   ' ' WS007-SRC-TASK-NUMBER                   06310003
063200                      ' WSKCS309-1010 ERROR:'                     06320003
063300                      ' SQL='                                     06330003
063400                      PV-DISPLAY-SQLCODE                          06340003
063500                      ' ' PV-DISPLAY-CRTN                         06350003
063600                      DELIMITED BY SIZE                           06360003
063700                                   INTO PV-CICS-MSG-AREA          06370003
063800             PERFORM 8000-WRITE-TO-CICS-LOG                       06380003
063900                                                                  06390003
064000             SET PS-OTBND-CART-EXISTS-NO TO TRUE                  06400003
064100             SET WS007-INVALID-SQL    TO TRUE                     06410003
064200             MOVE '1010-CHK-FOR-ORIG-CARTON'                      06420003
064300                                      TO WS007-SQL-ERROR-PARA     06430003
064400                                         DP013-PARAGRAPH          06440003
064500             MOVE SQLCA               TO WS007-SQLCA              06450003
064600                                         DP013-SQLCA              06460003
064700             STRING 'SQL='                                        06470003
064800                  PV-DISPLAY-SQLCODE                              06480003
064900                  ' ' PV-DISPLAY-CRTN                             06490003
065000                  DELIMITED BY SIZE                               06500003
065100                                    INTO WS007-CRA-RET-MSG        06510003
065200             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   06520003
065300             MOVE 'SUT_OTBND_CART'    TO                          06530003
065400                                       DP013-DB2-TABLE-NAME (1)   06540003
065500             MOVE 'SUT_OTBND_UPC'     TO                          06550003
065600                                       DP013-DB2-TABLE-NAME (2)   06560003
065700             SET DP013-DB2-ABEND  TO TRUE                         06570003
065800             PERFORM 9999-ABEND                                   06580003
065900     END-EVALUATE.                                                06590003
066000                                                                  06600003
066100                                                                  06610003
066200****************************************************************  06620003
066300* IF THE CARTON HAS ALREADY BEEN RECEIVED, CHECK TO SEE IF THE *  06630003
066400* SKU ON THE PIX IS ALREADY ON OUTBOUND UPC.  IF IT IS, THAT   *  06640003
066500* MEANS THAT THE CARTON HAS ALREADY BEEN RECEIVED ONCE AND     *  06650003
066600* THIS PIX SHOULD BE ERRORED OUT.  THERE IS AN ISSUE IN THE    *  06660003
066700* EFC'S WHERE THEY ARE RECEIVING THE SAME CASE MULTIPLE TIMES. *  06670003
066800* DMH - 09/08/17 ADDED                                         *  06680003
066810****************************************************************  06681003
066820 1050-CHECK-LINE-SKU-PREV-RCVD.                                   06682003
066830                                                                  06683003
066840     IF PS-CICS-SWITCH-YES                                        06684003
066850          STRING  ' ' WS007-SRC-TASK-NUMBER                       06685003
066860                  ' WSKCS309-1050-CHECK-LINE-SKU-PREV-RCVD'       06686003
066870                  DELIMITED BY SIZE                               06687003
066880            INTO  PV-CICS-MSG-AREA                                06688003
066890         PERFORM 8000-WRITE-TO-CICS-LOG                           06689003
066891     END-IF.                                                      06689103
066892                                                                  06689203
066893     MOVE WS014-SKU-NUMBER  TO  XLT00003-SKU-NBR.                 06689303
066894                                                                  06689403
066895     EXEC SQL                                                     06689503
066896          SELECT                                                  06689603
066897                 B.SHIPT_UNT_ID                                   06689703
066898          INTO                                                    06689803
066899                 :PV-CASE-PREV-RCVD                               06689903
066900          FROM   SUT_OTBND_UPC  A                                 06690003
066901               , SUT_OTBND_CART B                                 06690103
066902               , XLT_SKU        C                                 06690203
066903               , XLT_UPC        D                                 06690303
066904          WHERE  B.ORIG_CART_ID = :DK-CASE-NBR                    06690403
066905          AND    A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                  06690503
066906          AND    B.ACTV_IND     = 'Y'                             06690603
066907          AND    A.UPC_NBR      = D.UPC_NBR                       06690703
066908          AND    D.INTR_UPC_ID  = C.INTR_UPC_ID                   06690803
066909          AND    C.SKU_NBR      = :XLT00003-SKU-NBR               06690903
066910          WITH UR                                                 06691003
066920     END-EXEC.                                                    06692003
066930     EVALUATE TRUE                                                06693003
066931         WHEN SQLCODE = ZERO                                      06693103
066932              SET  PS-CART-HAS-LINE-SKU-YES  TO  TRUE             06693203
066933                 MOVE WS014-CASE-NUMBER TO PV-DISPLAY-CRTN        06693303
066934                 MOVE DK-TRN-NBR        TO PV-DISPLAY-PO-NBR      06693403
066935                 MOVE DK-RCVR-SEQ-NBR   TO PV-DISPLAY-RCVR        06693503
066936                 INITIALIZE PV-CICS-MSG-AREA                      06693603
066937                 STRING   ' ' WS007-SRC-TASK-NUMBER               06693703
066938                          ' WSKCS309-1050- '                      06693803
066939                          ' SSCC:' PV-DISPLAY-CRTN                06693903
066940                          '  PO:'   PV-DISPLAY-PO-NBR             06694003
066941                          '-'       PV-DISPLAY-RCVR               06694103
066942                          '  SKU:'  WS014-SKU-NUMBER              06694203
066943                          '  CARTON PREVIOUSLY RECEIVED'          06694303
066944                               DELIMITED BY SIZE                  06694403
066945                          INTO PV-CICS-MSG-AREA                   06694503
066946                 PERFORM 8000-WRITE-TO-CICS-LOG                   06694603
066947                                                                  06694703
066948                 MOVE WS014-DC-LOCATION TO UPLDER-OPER-UNT-ID     06694803
066949                 MOVE 'I'               TO UPLDER-UPLD-TRN-CDE    06694903
066950                 MOVE '003'             TO UPLDER-ERR-CDE         06695003
066951                                                                  06695103
066952                 MOVE WS014-STORE-NUMBER                          06695203
066953                                        TO WS024-STORE-NUMBER     06695303
066954                 MOVE WS014-CASE-NUMBER TO WS024-CASE-NUMBER      06695403
066955                 MOVE DK-TRN-NBR        TO WS024-PO-NUMBER        06695503
066956                 MOVE DK-RCVR-SEQ-NBR   TO WS024-REC-SEQ-NUMBER   06695603
066957                 MOVE WS014-PO-LINE-NUMBER                        06695703
066958                                        TO WS024-PO-LINE-NUMBER   06695803
066959                 MOVE WS014-SKU-NUMBER  TO WS024-SKU-NUMBER       06695903
066960                 MOVE WS014-SKU-QTY     TO WS024-SKU-QTY          06696003
066961                 MOVE WS014-CRE-USER-ID TO WS024-CRE-USER-ID      06696103
066962                 MOVE SHUUPC-TRN-NBR    TO WS024-NEW-PO-NUMBER    06696203
066963                 MOVE WS014-RCVD-SHPMT-NBR                        06696303
066964                                        TO WS024-RCVD-SHPMT-NBR   06696403
066965                                                                  06696503
066966                 MOVE WS024-UPLOAD-ERROR-RECORD                   06696603
066967                                        TO UPLDER-PKT-TXT         06696703
066968                 PERFORM 1006-WRITE-TUPLDER                       06696803
066969                                                                  06696903
066970         WHEN SQLCODE = +100                                      06697003
066971              SET  PS-CART-HAS-LINE-SKU-NO   TO  TRUE             06697103
066972                                                                  06697203
066973         WHEN SQLWARN0 NOT = SPACES                               06697303
066974         WHEN SQLCODE NOT = ZERO                                  06697403
066975             MOVE SQLCODE             TO WS007-SQLCODE            06697503
066976                                         PV-DISPLAY-SQLCODE       06697603
066977             MOVE WS014-CASE-NUMBER      TO PV-DISPLAY-CRTN       06697703
066978             MOVE DK-TRN-NBR             TO PV-DISPLAY-PO-NBR     06697803
066979             MOVE DK-RCVR-SEQ-NBR        TO PV-DISPLAY-RCVR       06697903
066980             MOVE DK-SKU-NBR             TO PV-DISPLAY-SKU-NBR    06698003
066981             INITIALIZE PV-CICS-MSG-AREA                          06698103
066982             STRING   ' ' WS007-SRC-TASK-NUMBER                   06698203
066983                      ' WSKCS309-1050 ERROR:'                     06698303
066984                      ' SSCC:'              PV-DISPLAY-CRTN       06698403
066985                      ' SQL:'               PV-DISPLAY-SQLCODE    06698503
066986                      ' PO:'                PV-DISPLAY-PO-NBR     06698603
066987                      '-'                   PV-DISPLAY-RCVR       06698703
066988                      ' SKU:'               PV-DISPLAY-SKU-NBR    06698803
066989                                            DELIMITED BY SIZE     06698903
066990                                       INTO PV-CICS-MSG-AREA      06699003
066991             PERFORM 8000-WRITE-TO-CICS-LOG                       06699103
066992                                                                  06699203
066993             SET WS007-INVALID-SQL    TO TRUE                     06699303
066994             MOVE '1050-CHECK-LINE-SKU-PREV-RCVD'                 06699403
066995                                      TO WS007-SQL-ERROR-PARA     06699503
066996                                         DP013-PARAGRAPH          06699603
066997             MOVE SQLCA               TO WS007-SQLCA              06699703
066998                                         DP013-SQLCA              06699803
066999             STRING 'SQL='                                        06699903
067000                  PV-DISPLAY-SQLCODE                              06700003
067001                  DELIMITED BY SIZE                               06700103
067002                                    INTO WS007-CRA-RET-MSG        06700203
067003             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   06700303
067004             MOVE 'SUT00024'          TO                          06700403
067005                                       DP013-DB2-TABLE-NAME (1)   06700503
067006             MOVE 'SUT00028'          TO                          06700603
067007                                       DP013-DB2-TABLE-NAME (2)   06700703
067008             SET DP013-DB2-ABEND      TO TRUE                     06700803
067009             PERFORM 9999-ABEND                                   06700903
067010     END-EVALUATE.                                                06701003
067011                                                                  06701103
067012                                                                  06701203
067013 1500-CHK-VRFD-LINE-IN-CRTN.                                      06701303
067014                                                                  06701403
067015     IF PS-CICS-SWITCH-YES                                        06701503
067016          STRING  ' ' WS007-SRC-TASK-NUMBER                       06701603
067017                  ' WSKCS309-1500-CHK-VRFD-LINE-IN-CRTN   '       06701703
067018                  DELIMITED BY SIZE                               06701803
067019            INTO  PV-CICS-MSG-AREA                                06701903
067020         PERFORM 8000-WRITE-TO-CICS-LOG                           06702003
067030     END-IF.                                                      06703003
067040                                                                  06704003
067050                                                                  06705003
067060     MOVE WS014-CASE-NUMBER  TO DK-CASE-NBR.                      06706003
067070                                                                  06707003
067080     EXEC SQL                                                     06708003
067090*        SELECT A.TRN_LNE_NBR                                     06709003
067100        SELECT  A.UPC_NBR                                         06710003
067200              , A.TRN_LNE_NBR                                     06720003
067300              , A.SHPD_QTY                                        06730003
067400*        INTO   :SHUUPC-TRN-LNE-NBR                               06740003
067500         INTO   :SHUUPC-UPC-NBR                                   06750003
067600              , :SHUUPC-TRN-LNE-NBR                               06760003
067700              , :SHUUPC-SHPD-QTY                                  06770003
067800         FROM    TSHUUPC  A                                       06780003
067900               , TRECITM  B                                       06790003
068000               , XLV_SKU  C                                       06800003
068010         WHERE   A.SHIPT_UNT_ID   = :DK-CASE-NBR                  06801003
068020         AND     A.TRN_NBR        = :DK-TRN-NBR                   06802003
068030         AND     B.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR              06803003
068040         AND     C.SKU_NBR        = :DK-SKU-NBR                   06804003
068050         AND     A.TRN_NBR        = B.ORD_NBR                     06805003
068060         AND     A.TRN_LNE_NBR    = B.ORD_LNE_NBR                 06806003
068070         AND     B.ITM_NBR        = C.ITM_NBR                     06807003
068080         AND     B.VER_STATUS_CDE = 'A'                           06808003
068090         AND     B.STATUS_CDE     IN ('IP','CM')                  06809003
068100     END-EXEC.                                                    06810003
068200                                                                  06820003
068300     EVALUATE TRUE                                                06830003
068400         WHEN SQLCODE = ZERO                                      06840003
068500             SET PS-VRFD-CRTN-LNE-NO TO TRUE                      06850003
068600             IF PS-CICS-SWITCH-YES                                06860003
068700* DMH            MOVE WS-TRN-LNE-NBR TO WS-DISPLAY-1              06870003
068800* DMH            MOVE SHUUPC-UPC-NBR     TO WS-DISPLAY-2          06880003
068900                 MOVE DK-CASE-NBR     TO PV-DISPLAY-CRTN          06890003
069000                 MOVE DK-TRN-NBR      TO PV-DISPLAY-PO-NBR        06900003
069100                 MOVE DK-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR          06910003
069200                 MOVE DK-SKU-NBR      TO PV-DISPLAY-SKU-NBR       06920003
069300                 INITIALIZE PV-CICS-MSG-AREA                      06930003
069400                 STRING   ' ' WS007-SRC-TASK-NUMBER               06940003
069500                          ' WSKCS309-1500 ERROR:'                 06950003
069600* DMH                     ' TRN LNE NBR='                         06960003
069700* DMH                     WS-DISPLAY-1                            06970003
069800* DMH                     ' UPC NBR='                             06980003
069900* DMH                     WS-DISPLAY-2                            06990003
070000                          ' PO:'  PV-DISPLAY-PO-NBR               07000003
070100                          '-'     PV-DISPLAY-RCVR                 07010003
070200                          ' SKU:' PV-DISPLAY-SKU-NBR              07020003
070300                          ' '     PV-DISPLAY-CRTN                 07030003
070400                               DELIMITED BY SIZE                  07040003
070500                          INTO PV-CICS-MSG-AREA                   07050003
070600                 PERFORM 8000-WRITE-TO-CICS-LOG                   07060003
070610             END-IF                                               07061003
070620* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            07062003
070630*        WHEN SQLCODE = -904                                      07063003
070640*        WHEN SQLCODE = -913                                      07064003
070650*        WHEN SQLCODE = -911                                      07065003
070660*            CONTINUE                                             07066003
070670         WHEN SQLCODE = +100                                      07067003
070680             SET PS-VRFD-CRTN-LNE-YES    TO TRUE                  07068003
070690             SET WS007-INVALID-SQL       TO TRUE                  07069003
070700* DMH        MOVE DK-TRN-NBR             TO WS-DISPLAY-1          07070003
070800* DMH        MOVE DK-RCVR-SEQ-NBR        TO WS-DISPLAY-2          07080003
070900* DMH        MOVE DK-SKU-NBR             TO WS-DISPLAY-3          07090003
071000* DMH        MOVE DK-CASE-NBR            TO WS-DISPLAY-CRTN       07100003
071100             MOVE SQLCODE                TO WS007-SQLCODE         07110003
071200                                            PV-DISPLAY-SQLCODE    07120003
071300             MOVE DK-CASE-NBR            TO PV-DISPLAY-CRTN       07130003
071400             MOVE DK-TRN-NBR             TO PV-DISPLAY-PO-NBR     07140003
071500             MOVE DK-RCVR-SEQ-NBR        TO PV-DISPLAY-RCVR       07150003
071600             MOVE DK-SKU-NBR             TO PV-DISPLAY-SKU-NBR    07160003
071700             MOVE '1500-CHK-VRFD-LINE-IN-CRTN'                    07170003
071800                                         TO WS007-SQL-ERROR-PARA  07180003
071900                                         DP013-PARAGRAPH          07190003
072000             MOVE 'CARTON HAS VERIFIED LINE'                      07200003
072100                                         TO WS007-CRA-RET-MSG     07210003
072200             MOVE SQLCA                  TO WS007-SQLCA           07220003
072300                                            DP013-SQLCA           07230003
072400             INITIALIZE PV-CICS-MSG-AREA                          07240003
072500             STRING   ' WSKCS309-1500 ERROR:'                     07250003
072600                      ' SQL='                                     07260003
072700                      PV-DISPLAY-SQLCODE                          07270003
072800                      DELIMITED BY SIZE                           07280003
072900                                       INTO PV-CICS-MSG-AREA      07290003
073000             PERFORM 8000-WRITE-TO-CICS-LOG                       07300003
073100                                                                  07310003
073200             STRING   ' WSKCS309-1500 ERROR:'                     07320003
073300                      ' NO UNVRFD LINE FOUND '                    07330003
073400                      DELIMITED BY SIZE                           07340003
073500                          ' PO:'  PV-DISPLAY-PO-NBR               07350003
073600                          '-'     PV-DISPLAY-RCVR                 07360003
073700                          ' SKU:' PV-DISPLAY-SKU-NBR              07370003
073800                          ' '     PV-DISPLAY-CRTN                 07380003
073900* DMH                 ' PO/RCV/SKU/CRTN'                          07390003
074000* DMH                 WS-DISPLAY-1                                07400003
074100* DMH                 WS-DISPLAY-2                                07410003
074110* DMH                 WS-DISPLAY-3                                07411003
074120* DMH                 WS-DISPLAY-CRTN                             07412003
074130                      DELIMITED BY SIZE                           07413003
074140                               INTO PV-CICS-MSG-AREA              07414003
074150             PERFORM 8000-WRITE-TO-CICS-LOG                       07415003
074160                                                                  07416003
074170             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   07417003
074180             MOVE 'TSHUUPC'           TO                          07418003
074190                                       DP013-DB2-TABLE-NAME (1)   07419003
074200             MOVE 'TRECITM'           TO                          07420003
074300                                       DP013-DB2-TABLE-NAME (2)   07430003
074400             MOVE 'XLV_SKU'           TO                          07440003
074500                                       DP013-DB2-TABLE-NAME (3)   07450003
074600             SET DP013-DB2-ABEND  TO TRUE                         07460003
074700             PERFORM 9999-ABEND                                   07470003
074800         WHEN SQLWARN0 NOT = SPACES                               07480003
074900         WHEN SQLCODE NOT = ZERO                                  07490003
075000             MOVE SQLCODE             TO WS007-SQLCODE            07500003
075100                                         PV-DISPLAY-SQLCODE       07510003
075200             MOVE DK-CASE-NBR            TO PV-DISPLAY-CRTN       07520003
075300             MOVE DK-TRN-NBR             TO PV-DISPLAY-PO-NBR     07530003
075400             MOVE DK-RCVR-SEQ-NBR        TO PV-DISPLAY-RCVR       07540003
075500             MOVE DK-SKU-NBR             TO PV-DISPLAY-SKU-NBR    07550003
075600             INITIALIZE PV-CICS-MSG-AREA                          07560003
075700             STRING   ' ' WS007-SRC-TASK-NUMBER                   07570003
075800                      ' WSKCS309-1500 ERROR:'                     07580003
075900                      ' SQL='                                     07590003
076000                      PV-DISPLAY-SQLCODE                          07600003
076100                          ' PO:'  PV-DISPLAY-PO-NBR               07610003
076200                          '-'     PV-DISPLAY-RCVR                 07620003
076300                          ' SKU:' PV-DISPLAY-SKU-NBR              07630003
076400                          ' '     PV-DISPLAY-CRTN                 07640003
076500                      DELIMITED BY SIZE                           07650003
076600                                   INTO PV-CICS-MSG-AREA          07660003
076700             PERFORM 8000-WRITE-TO-CICS-LOG                       07670003
076800                                                                  07680003
076810             SET WS007-INVALID-SQL    TO TRUE                     07681003
076820             MOVE '1500-CHK-VRFD-LINE-IN-CRTN'                    07682003
076830                                      TO WS007-SQL-ERROR-PARA     07683003
076840                                         DP013-PARAGRAPH          07684003
076850             MOVE SQLCA               TO WS007-SQLCA              07685003
076860                                         DP013-SQLCA              07686003
076870             STRING 'SQL='                                        07687003
076880                  PV-DISPLAY-SQLCODE                              07688003
076890                  DELIMITED BY SIZE                               07689003
076900                                    INTO WS007-CRA-RET-MSG        07690003
077000             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   07700003
077100             MOVE 'TSHUUPC'           TO                          07710003
077200                                       DP013-DB2-TABLE-NAME (1)   07720003
077300             MOVE 'TRECITM'           TO                          07730003
077400                                       DP013-DB2-TABLE-NAME (2)   07740003
077500             MOVE 'XLV_SKU'           TO                          07750003
077600                                       DP013-DB2-TABLE-NAME (3)   07760003
077700             SET DP013-DB2-ABEND      TO TRUE                     07770003
077800             PERFORM 9999-ABEND                                   07780003
077900     END-EVALUATE.                                                07790003
078000                                                                  07800003
078100/                                                                 07810003
078200 2000-CHECK-LINE-ITEMS.                                           07820003
078300                                                                  07830003
078400     IF PS-CICS-SWITCH-YES                                        07840003
078500          STRING  ' ' WS007-SRC-TASK-NUMBER                       07850003
078600                  ' WSKCS309-2000-CHECK-LINE-ITEMS        '       07860003
078700                  DELIMITED BY SIZE                               07870003
078800            INTO  PV-CICS-MSG-AREA                                07880003
078900         PERFORM 8000-WRITE-TO-CICS-LOG                           07890003
079000     END-IF.                                                      07900003
079100                                                                  07910003
079200                                                                  07920003
079300     PERFORM 2005-CHECK-ITM-NBR.                                  07930003
079400     IF PS-LNE-NOT-VRFD-YES                                       07940003
079500         MOVE DK-REC-SEQ-NBR        TO WS008-NEW-REC-SEQ-NBR      07950003
079600         PERFORM 4000-OTBND-INSERT                                07960003
079700         PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD                     07970003
079800     ELSE                                                         07980003
079900         PERFORM 2010-DOES-LINE-EXIST                             07990003
080000         IF PS-VRFD-LINE-EXISTS-NO                                08000003
080100             PERFORM 2050-CHECK-PURITM                            08010003
080200             EVALUATE TRUE                                        08020003
080300                 WHEN PS-PURITM-FOUND-ONE                         08030003
080400                     PERFORM 3000-INSERT-RECITM                   08040003
080500                     PERFORM 3010-INSERT-RECDIS                   08050003
080600                     PERFORM 4000-OTBND-INSERT                    08060003
080700                     PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD         08070003
080800                 WHEN PS-PURITM-FOUND-MULT                        08080003
080900                     PERFORM 2020-CHECK-FOR-FA-RCVR               08090003
081000                     IF PS-FA-RCVR-YES                            08100003
081100                         PERFORM 2025-UPDATE-FA-RCVR              08110003
081200                     END-IF                                       08120003
081300                     PERFORM 4000-OTBND-INSERT                    08130003
081400                     PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD         08140003
081500                 WHEN PS-PURITM-FOUND-NONE                        08150003
081600* JAK 08/2007 - CHANGE ERROR INDICATOR                            08160003
081700****                 SET WS007-ERROR     TO TRUE                  08170003
081800                     SET WS007-NO-PURITM TO TRUE                  08180003
081900                     MOVE 'NO RECS FOUND ON TPURITM'              08190003
082000                                         TO WS007-CRA-RET-MSG     08200003
082100                                            DP013-MESSAGE-TEXT (1)08210003
082200                     MOVE '2000-CHECK-LINE-ITEMS'                 08220003
082300                                         TO WS007-SQL-ERROR-PARA  08230003
082400                                            DP013-PARAGRAPH       08240003
082410                     INITIALIZE PV-CICS-MSG-AREA                  08241003
082420                     STRING   ' WSKCS309-2000 ERROR:'             08242003
082430                              ' NO RECS FOUND ON TPURITM'         08243003
082440                              ' A '                               08244003
082450                              DELIMITED BY SIZE                   08245003
082460                                       INTO PV-CICS-MSG-AREA      08246003
082470                     PERFORM 8000-WRITE-TO-CICS-LOG               08247003
082480                                                                  08248003
082490                     SET DP013-DB2-ABEND TO TRUE                  08249003
082500                     PERFORM 9999-ABEND                           08250003
082600             END-EVALUATE                                         08260003
082700         END-IF                                                   08270003
082800     END-IF.                                                      08280003
082900                                                                  08290003
083000/                                                                 08300003
083100 2005-CHECK-ITM-NBR.                                              08310003
083200                                                                  08320003
083300     IF PS-CICS-SWITCH-YES                                        08330003
083400          MOVE DK-PO-NBR      TO   PV-DISPLAY-PO-NBR              08340003
083500          MOVE DK-REC-SEQ-NBR TO   PV-DISPLAY-RCVR                08350003
083600          MOVE DK-SKU-NBR     TO   PV-DISPLAY-SKU-NBR             08360003
083700                                                                  08370003
083800          STRING  ' ' WS007-SRC-TASK-NUMBER                       08380003
083900                  ' WSKCS309-2005-CHECK-ITM-NBR '                 08390003
084000                    PV-DISPLAY-PO-NBR '-'                         08400003
084100                    PV-DISPLAY-RCVR '-'                           08410003
084200                    PV-DISPLAY-SKU-NBR                            08420003
084300                  DELIMITED BY SIZE                               08430003
084400            INTO  PV-CICS-MSG-AREA                                08440003
084500         PERFORM 8000-WRITE-TO-CICS-LOG                           08450003
084510     END-IF.                                                      08451003
084520                                                                  08452003
084530                                                                  08453003
084540* CHECK TO SEE IF LINE EXISTS BUT IS NOT VERIFIED                 08454003
084550     EXEC SQL                                                     08455003
084560         SELECT DISTINCT                                          08456003
084570                C.UPC_NBR                                         08457003
084580             ,  B.ORD_LNE_NBR                                     08458003
084590         INTO   :XLT00006-UPC-NBR                                 08459003
084600             ,  :RECITM-ORD-LNE-NBR                               08460003
084700         FROM    XLV_SKU  A                                       08470003
084800               , TRECITM  B                                       08480003
084900               , XLT_UPC  C                                       08490003
085000         WHERE   A.SKU_NBR        = :DK-SKU-NBR                   08500003
085100         AND     B.ORD_NBR        = :DK-PO-NBR                    08510003
085200         AND     B.REC_SEQ_NBR    = :DK-REC-SEQ-NBR               08520003
085300         AND     A.ITM_NBR        = B.ITM_NBR                     08530003
085400         AND     B.VER_STATUS_CDE = 'A'                           08540003
085500         AND     B.STATUS_CDE     <> 'VE'                         08550003
085600         AND     A.INTR_UPC_ID  = C.INTR_UPC_ID                   08560003
085700         AND     C.UPC_TYP_CDE  = 'I'                             08570003
085800         WITH UR                                                  08580003
085900     END-EXEC.                                                    08590003
086000                                                                  08600003
086100     EVALUATE TRUE                                                08610003
086200         WHEN SQLCODE = ZERO                                      08620003
086300             SET PS-LNE-NOT-VRFD-YES TO TRUE                      08630003
086400             MOVE XLT00006-UPC-NBR   TO WS-UPC-NBR                08640003
086500                                        WS-DISPLAY-2              08650003
086600             IF PS-CICS-SWITCH-YES                                08660003
086700                 INITIALIZE PV-CICS-MSG-AREA                      08670003
086800                 MOVE DK-SKU-NBR     TO  PV-DISPLAY-SKU-NBR       08680003
086900                 MOVE DK-PO-NBR      TO  PV-DISPLAY-PO-NBR        08690003
087000                 MOVE DK-REC-SEQ-NBR TO  PV-DISPLAY-RCVR          08700003
087100                 STRING   ' WSKCS309-2000:'                       08710003
087200                          ' PO: ' PV-DISPLAY-PO-NBR               08720003
087300                          '-'     PV-DISPLAY-RCVR                 08730003
087400                          ' SKU:' PV-DISPLAY-SKU-NBR              08740003
087500                          DELIMITED BY SIZE                       08750003
087600                          INTO PV-CICS-MSG-AREA                   08760003
087700                 PERFORM 8000-WRITE-TO-CICS-LOG                   08770003
087800             END-IF                                               08780003
087810         WHEN SQLCODE = -811                                      08781003
087820             SET PS-LNE-NOT-VRFD-YES TO TRUE                      08782003
087830             MOVE ZERO               TO WS-TRN-LNE-NBR            08783003
087840             MOVE XLT00006-UPC-NBR   TO WS-UPC-NBR                08784003
087850                                        WS-DISPLAY-2              08785003
087860             MOVE DK-SKU-NBR     TO  PV-DISPLAY-SKU-NBR           08786003
087870             MOVE DK-PO-NBR      TO  PV-DISPLAY-PO-NBR            08787003
087880             MOVE DK-REC-SEQ-NBR TO  PV-DISPLAY-RCVR              08788003
087890             IF PS-CICS-SWITCH-YES                                08789003
087900                 INITIALIZE PV-CICS-MSG-AREA                      08790003
088000                 STRING   ' WSKCS309-2000:'                       08800003
088100                          ' MULTIPLE ORD LNE NBRS'                08810003
088200                          ' PO: ' PV-DISPLAY-PO-NBR               08820003
088300                          '-'     PV-DISPLAY-RCVR                 08830003
088400                          ' SKU:' PV-DISPLAY-SKU-NBR              08840003
088500                          DELIMITED BY SIZE                       08850003
088600                          INTO PV-CICS-MSG-AREA                   08860003
088700                 PERFORM 8000-WRITE-TO-CICS-LOG                   08870003
088800             END-IF                                               08880003
088900* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            08890003
089000*        WHEN SQLCODE = -904                                      08900003
089100*        WHEN SQLCODE = -913                                      08910003
089200*        WHEN SQLCODE = -911                                      08920003
089210*            CONTINUE                                             08921003
089220         WHEN SQLCODE = +100                                      08922003
089230             MOVE ZERO                   TO WS-ORD-LNE-NBR        08923003
089240             SET PS-LNE-NOT-VRFD-NO      TO TRUE                  08924003
089250         WHEN SQLWARN0 NOT = SPACES                               08925003
089260         WHEN SQLCODE NOT = ZERO                                  08926003
089270             INITIALIZE PV-CICS-MSG-AREA                          08927003
089280             MOVE SQLCODE             TO WS007-SQLCODE            08928003
089290                                         PV-DISPLAY-SQLCODE       08929003
089300             MOVE DK-SKU-NBR     TO  PV-DISPLAY-SKU-NBR           08930003
089400             MOVE DK-PO-NBR      TO  PV-DISPLAY-PO-NBR            08940003
089500             MOVE DK-REC-SEQ-NBR TO  PV-DISPLAY-RCVR              08950003
089600             STRING   ' ' WS007-SRC-TASK-NUMBER                   08960003
089700                      ' WSKCS309-2005 ERROR:'                     08970003
089800                      ' SQL='                                     08980003
089900                      PV-DISPLAY-SQLCODE                          08990003
090000                      ' PO: ' PV-DISPLAY-PO-NBR                   09000003
090100                      '-'     PV-DISPLAY-RCVR                     09010003
090200                      ' SKU:' PV-DISPLAY-SKU-NBR                  09020003
090300                      DELIMITED BY SIZE                           09030003
090400                                   INTO PV-CICS-MSG-AREA          09040003
090500             PERFORM 8000-WRITE-TO-CICS-LOG                       09050003
090600                                                                  09060003
090700             SET WS007-INVALID-SQL    TO TRUE                     09070003
090800             MOVE '2005-CHECK-ITM-NBR'                            09080003
090900                                      TO WS007-SQL-ERROR-PARA     09090003
090910                                         DP013-PARAGRAPH          09091003
090920             MOVE SQLCA               TO WS007-SQLCA              09092003
090930                                         DP013-SQLCA              09093003
090940             STRING 'SQL='                                        09094003
090950                  PV-DISPLAY-SQLCODE                              09095003
090960                  DELIMITED BY SIZE                               09096003
090970                                    INTO WS007-CRA-RET-MSG        09097003
090980             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   09098003
090990             MOVE 'TRECITM'           TO                          09099003
091000                                       DP013-DB2-TABLE-NAME (1)   09100003
091100             MOVE 'XLV_SKU'           TO                          09110003
091200                                       DP013-DB2-TABLE-NAME (2)   09120003
091300             SET DP013-DB2-ABEND  TO TRUE                         09130003
091400             PERFORM 9999-ABEND                                   09140003
091500     END-EVALUATE.                                                09150003
091600                                                                  09160003
091700/                                                                 09170003
091800 2010-DOES-LINE-EXIST.                                            09180003
091900                                                                  09190003
092000     IF PS-CICS-SWITCH-YES                                        09200003
092100          STRING  ' ' WS007-SRC-TASK-NUMBER                       09210003
092200                  ' WSKCS309-2010-DOES-LINE-EXIST         '       09220003
092300                  DELIMITED BY SIZE                               09230003
092400            INTO  PV-CICS-MSG-AREA                                09240003
092500         PERFORM 8000-WRITE-TO-CICS-LOG                           09250003
092600     END-IF.                                                      09260003
092700                                                                  09270003
092800                                                                  09280003
092900* CHECK TO SEE IF THE LINE EXISTS, BUT IS VERIFIED                09290003
093000     EXEC SQL                                                     09300003
093100         SELECT DISTINCT                                          09310003
093200                B.ORD_LNE_NBR                                     09320003
093300         INTO   :RECITM-ORD-LNE-NBR                               09330003
093400         FROM    XLV_SKU  A                                       09340003
093500               , TRECITM  B                                       09350003
093600         WHERE   A.SKU_NBR        = :DK-SKU-NBR                   09360003
093700         AND     B.ORD_NBR        = :DK-PO-NBR                    09370003
093800         AND     B.REC_SEQ_NBR    = :DK-REC-SEQ-NBR               09380003
093900         AND     A.ITM_NBR        = B.ITM_NBR                     09390003
094000         AND     B.VER_STATUS_CDE = 'A'                           09400003
094100         AND     B.STATUS_CDE     = 'VE'                          09410003
094200     END-EXEC.                                                    09420003
094300                                                                  09430003
094400     EVALUATE TRUE                                                09440003
094500         WHEN SQLCODE = ZERO                                      09450003
094600             SET PS-VRFD-LINE-EXISTS-YES TO TRUE                  09460003
094700* JAK 08/2007 - CHANGE ERROR INDICATOR, SHORTEN MESSAGE           09470003
094800*****        SET WS007-ERROR             TO TRUE                  09480003
094900             SET WS007-VRFD-RCVR-ERR     TO TRUE                  09490003
095000             MOVE '2010-DOES-LINE-EXIST'                          09500003
095100                                         TO WS007-SQL-ERROR-PARA  09510003
095200                                            DP013-PARAGRAPH       09520003
095300*****        MOVE 'CANNOT RECEIVE A VERIFIED RECEIVER'            09530003
095400             MOVE 'CANT RCV A VERIFIED RCVR'                      09540003
095500                                         TO WS007-CRA-RET-MSG     09550003
095600             IF PS-CICS-SWITCH-YES                                09560003
095700                 INITIALIZE PV-CICS-MSG-AREA                      09570003
095800                 MOVE DK-SKU-NBR     TO  PV-DISPLAY-SKU-NBR       09580003
095900                 MOVE DK-PO-NBR      TO  PV-DISPLAY-PO-NBR        09590003
096000                 MOVE DK-REC-SEQ-NBR TO  PV-DISPLAY-RCVR          09600003
096100                 STRING   ' WSKCS309-2010:'                       09610003
096200                          ' CANNOT RECV A VERIFIED RCVR'          09620003
096300                          ' PO:'  PV-DISPLAY-PO-NBR               09630003
096400                          '-'     PV-DISPLAY-RCVR                 09640003
096500                          ' SKU:' PV-DISPLAY-SKU-NBR              09650003
096600                          DELIMITED BY SIZE                       09660003
096700                          INTO PV-CICS-MSG-AREA                   09670003
096800                 PERFORM 8000-WRITE-TO-CICS-LOG                   09680003
096810             END-IF                                               09681003
096820                                                                  09682003
096830             MOVE SQLCA               TO WS007-SQLCA              09683003
096840                                         DP013-SQLCA              09684003
096850             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   09685003
096860             MOVE 'TRECITM'           TO                          09686003
096870                                       DP013-DB2-TABLE-NAME (1)   09687003
096880             MOVE 'XLV_SKU'           TO                          09688003
096890                                       DP013-DB2-TABLE-NAME (2)   09689003
096900             SET DP013-DB2-ABEND      TO TRUE                     09690003
097000             PERFORM 9999-ABEND                                   09700003
097100* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            09710003
097200*        WHEN SQLCODE = -904                                      09720003
097300*        WHEN SQLCODE = -913                                      09730003
097400*        WHEN SQLCODE = -911                                      09740003
097500*            CONTINUE                                             09750003
097600         WHEN SQLCODE = +100                                      09760003
097700             SET PS-VRFD-LINE-EXISTS-NO  TO TRUE                  09770003
097800         WHEN SQLWARN0 NOT = SPACES                               09780003
097900         WHEN SQLCODE NOT = ZERO                                  09790003
098000             MOVE SQLCODE                TO WS007-SQLCODE         09800003
098100                                            PV-DISPLAY-SQLCODE    09810003
098200             MOVE DK-SKU-NBR     TO  PV-DISPLAY-SKU-NBR           09820003
098300             MOVE DK-PO-NBR      TO  PV-DISPLAY-PO-NBR            09830003
098400             MOVE DK-REC-SEQ-NBR TO  PV-DISPLAY-RCVR              09840003
098500             INITIALIZE PV-CICS-MSG-AREA                          09850003
098600             STRING   ' ' WS007-SRC-TASK-NUMBER                   09860003
098700                      ' WSKCS309-2010 ERROR:'                     09870003
098800                      ' SQL='                                     09880003
098900                      PV-DISPLAY-SQLCODE                          09890003
099000                      ' PO:'  PV-DISPLAY-PO-NBR                   09900003
099100                      '-'     PV-DISPLAY-RCVR                     09910003
099200                      ' SKU:' PV-DISPLAY-SKU-NBR                  09920003
099300                      DELIMITED BY SIZE                           09930003
099400                                    INTO PV-CICS-MSG-AREA         09940003
099500             PERFORM 8000-WRITE-TO-CICS-LOG                       09950003
099600                                                                  09960003
099700             SET WS007-INVALID-SQL    TO TRUE                     09970003
099800             MOVE '2010-DOES-LINE-EXIST'                          09980003
099900                                      TO WS007-SQL-ERROR-PARA     09990003
100000                                         DP013-PARAGRAPH          10000003
100100             MOVE SQLCA               TO WS007-SQLCA              10010003
100200                                         DP013-SQLCA              10020003
100300             STRING 'SQL='                                        10030003
100400                  PV-DISPLAY-SQLCODE                              10040003
100500                  DELIMITED BY SIZE                               10050003
100600                                    INTO WS007-CRA-RET-MSG        10060003
100700             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   10070003
100800             MOVE 'TRECITM'           TO                          10080003
100900                                       DP013-DB2-TABLE-NAME (1)   10090003
101000             MOVE 'XLV_SKU'           TO                          10100003
101100                                       DP013-DB2-TABLE-NAME (2)   10110003
101200             SET DP013-DB2-ABEND      TO TRUE                     10120003
101300             PERFORM 9999-ABEND                                   10130003
101400     END-EVALUATE.                                                10140003
101500                                                                  10150003
101600     IF PS-CICS-SWITCH-YES                                        10160003
101700          INITIALIZE  PV-CICS-MSG-AREA                            10170003
101800          MOVE RECITM-ORD-LNE-NBR   TO  PV-DISPLAY-LINE           10180003
101900          MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE        10190003
101910          STRING  ' ' WS007-SRC-TASK-NUMBER                       10191003
101920                  ' WSKCS309-2010  '                              10192003
101921                  ' LINE:'  PV-DISPLAY-LINE                       10192103
101922                  ' SQL:'   PV-DISPLAY-SQLCODE                    10192203
101923                  DELIMITED BY SIZE                               10192303
101924            INTO  PV-CICS-MSG-AREA                                10192403
101925         PERFORM 8000-WRITE-TO-CICS-LOG                           10192503
101926     END-IF.                                                      10192603
101927                                                                  10192703
101928                                                                  10192803
101929/                                                                 10192903
101930 2020-CHECK-FOR-FA-RCVR.                                          10193003
101940                                                                  10194003
101950     IF PS-CICS-SWITCH-YES                                        10195003
101960          STRING  ' ' WS007-SRC-TASK-NUMBER                       10196003
101970                  ' WSKCS309-2020-CHECK-FOR-FA-RCVR       '       10197003
101980                  DELIMITED BY SIZE                               10198003
101990            INTO  PV-CICS-MSG-AREA                                10199003
102000         PERFORM 8000-WRITE-TO-CICS-LOG                           10200003
102100     END-IF.                                                      10210003
102200                                                                  10220003
102201* PARAGRAPH ADDED 4/16/2010. MARJ HOEFS                           10220103
102202* CHECK IF THE RECEIVER IS A FREE ASTRAY.                         10220203
102203                                                                  10220303
102204                                                                  10220403
102205     EXEC SQL                                                     10220503
102206         SELECT FRE_ASTRA_IND                                     10220603
102207           INTO :PV-FRE-ASTRA-IND                                 10220703
102208           FROM TRECEIV                                           10220803
102209           WHERE ORD_NBR        = :DK-PO-NBR                      10220903
102210             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 10221003
102220             AND VER_STATUS_CDE = 'A'                             10222003
102230     END-EXEC.                                                    10223003
102240                                                                  10224003
102250     EVALUATE TRUE                                                10225003
102260         WHEN SQLCODE = +0                                        10226003
102270             IF PV-FRE-ASTRA-IND = 'Y'                            10227003
102280                 SET PS-FA-RCVR-YES TO TRUE                       10228003
102290             ELSE                                                 10229003
102300                 SET PS-FA-RCVR-NO TO TRUE                        10230003
102400             END-IF                                               10240003
102500         WHEN SQLCODE = +100                                      10250003
102600             SET PS-FA-RCVR-NO TO TRUE                            10260003
102700* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            10270003
102800*        WHEN SQLCODE = -904                                      10280003
102900*        WHEN SQLCODE = -913                                      10290003
102910*        WHEN SQLCODE = -911                                      10291003
102920*            CONTINUE                                             10292003
102930         WHEN SQLWARN0 NOT = SPACES                               10293003
102931         WHEN SQLCODE NOT = ZERO                                  10293103
102932             MOVE SQLCODE             TO WS007-SQLCODE            10293203
102933                                         PV-DISPLAY-SQLCODE       10293303
102934             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        10293403
102935             MOVE DK-REC-SEQ-NBR      TO PV-DISPLAY-RCVR          10293503
102936             INITIALIZE PV-CICS-MSG-AREA                          10293603
102937             STRING   ' ' WS007-SRC-TASK-NUMBER                   10293703
102938                      ' WSKCS309-2020 ERROR:'                     10293803
102939                      ' SQL='                                     10293903
102940                      PV-DISPLAY-SQLCODE                          10294003
102950                      ' PO:'  PV-DISPLAY-PO-NBR                   10295003
102951                      '-'     PV-DISPLAY-RCVR                     10295103
102952                      DELIMITED BY SIZE                           10295203
102953                                   INTO PV-CICS-MSG-AREA          10295303
102954             PERFORM 8000-WRITE-TO-CICS-LOG                       10295403
102955                                                                  10295503
102956             SET WS007-INVALID-SQL    TO TRUE                     10295603
102957             MOVE SQLCODE             TO WS007-SQLCODE            10295703
102958             MOVE '2020-CHECK-FOR-FA-RCVR'                        10295803
102959                                      TO WS007-SQL-ERROR-PARA     10295903
102960                                         DP013-PARAGRAPH          10296003
102961             MOVE SQLCA               TO WS007-SQLCA              10296103
102962                                         DP013-SQLCA              10296203
102963             STRING 'SQL='                                        10296303
102964                  PV-DISPLAY-SQLCODE                              10296403
102965                  DELIMITED BY SIZE                               10296503
102966                                    INTO WS007-CRA-RET-MSG        10296603
102967             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   10296703
102968             MOVE 'TRECEIV'           TO                          10296803
102969                                       DP013-DB2-TABLE-NAME (1)   10296903
102970             SET DP013-DB2-ABEND      TO TRUE                     10297003
102971             PERFORM 9999-ABEND                                   10297103
102972     END-EVALUATE.                                                10297203
102973                                                                  10297303
102974     IF PS-CICS-SWITCH-YES                                        10297403
102975          INITIALIZE  PV-CICS-MSG-AREA                            10297503
102976          MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE        10297603
102977          STRING  ' ' WS007-SRC-TASK-NUMBER                       10297703
102978                  ' WSKCS309-2020  '                              10297803
102979                  ' FA:'  PV-FRE-ASTRA-IND                        10297903
102980                  ' SQL:' PV-DISPLAY-SQLCODE                      10298003
102981                  DELIMITED BY SIZE                               10298103
102982            INTO  PV-CICS-MSG-AREA                                10298203
102983         PERFORM 8000-WRITE-TO-CICS-LOG                           10298303
102984     END-IF.                                                      10298403
102985                                                                  10298503
102986                                                                  10298603
102987 2025-UPDATE-FA-RCVR.                                             10298703
102988                                                                  10298803
102989     IF PS-CICS-SWITCH-YES                                        10298903
102990          STRING  ' ' WS007-SRC-TASK-NUMBER                       10299003
102991                  ' WSKCS309-2025-UPDATE-FA-RCVR          '       10299103
102992                  DELIMITED BY SIZE                               10299203
102993            INTO  PV-CICS-MSG-AREA                                10299303
102994         PERFORM 8000-WRITE-TO-CICS-LOG                           10299403
102995     END-IF.                                                      10299503
102996                                                                  10299603
102997* PARAGRAPH ADDED 4/16/2010. MARJ HOEFS                           10299703
102998* SINCE MORE THAN ONE ROW FOUND ON TPURITM AND THE RECEIVER IS    10299803
102999* A FREE ASTRAY, GET ANY "AC" ROW FROM TPURITM FOR PO AND SKU.    10299903
103000* IF NO "AC" ROW FOUND THEN GET MOST RECENTLY UPDATED NON-"AC"    10300003
103001* ROW.  ADD THE ITEM TO THE F/A RECEIVER.                         10300103
103002                                                                  10300203
103003     EXEC SQL                                                     10300303
103004         SELECT B.APP_PO_LNE_NBR                                  10300403
103005              , B.VER_NBR                                         10300503
103006              , B.ITM_NBR                                         10300603
103007              , B.UNT_RTL_PR_AMT                                  10300703
103008              , B.GP_RTL_AMT                                      10300803
103009              , B.GP_QTY                                          10300903
103010              , B.PO_PREPK_ID                                     10301003
103011              , B.UNT_COST_AMT                                    10301103
103012              , B.PREPK_RATO_QTY                                  10301203
103013         INTO   :PURITM-APP-PO-LNE-NBR                            10301303
103014              , :PURITM-VER-NBR                                   10301403
103015              , :PURITM-ITM-NBR                                   10301503
103016              , :PURITM-UNT-RTL-PR-AMT                            10301603
103017              , :PURITM-GP-RTL-AMT                                10301703
103018              , :PURITM-GP-QTY                                    10301803
103019              , :PURITM-PO-PREPK-ID                               10301903
103020              , :PURITM-UNT-COST-AMT                              10302003
103021              , :PURITM-PREPK-RATO-QTY                            10302103
103022         FROM    XLV_SKU  A                                       10302203
103023               , TPURITM  B                                       10302303
103024         WHERE   B.PO_NBR         = :DK-PO-NBR                    10302403
103025         AND     A.SKU_NBR        = :DK-SKU-NBR                   10302503
103026         AND     A.ITM_NBR        = B.ITM_NBR                     10302603
103027         AND     B.VER_STATUS_CDE = 'A'                           10302703
103028         AND     B.STATUS_CDE     = 'AC'                          10302803
103029     END-EXEC.                                                    10302903
103030                                                                  10303003
103031     EVALUATE TRUE                                                10303103
103032         WHEN SQLCODE = ZERO                                      10303203
103033         WHEN SQLCODE = -811                                      10303303
103034             MOVE PURITM-APP-PO-LNE-NBR  TO WS-APP-PO-LNE-NBR     10303403
103035         WHEN SQLCODE = +100                                      10303503
103036             PERFORM 2026-GET-MOST-RECENT-TPURITM                 10303603
103037* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            10303703
103038*        WHEN SQLCODE = -904                                      10303803
103039*        WHEN SQLCODE = -913                                      10303903
103040*        WHEN SQLCODE = -911                                      10304003
103041*            CONTINUE                                             10304103
103042         WHEN SQLWARN0 NOT = SPACES                               10304203
103043         WHEN SQLCODE NOT = ZERO                                  10304303
103044             MOVE SQLCODE             TO WS007-SQLCODE            10304403
103045                                         PV-DISPLAY-SQLCODE       10304503
103046             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        10304603
103047             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       10304703
103048             INITIALIZE PV-CICS-MSG-AREA                          10304803
103049             STRING   ' ' WS007-SRC-TASK-NUMBER                   10304903
103050                      ' WSKCS309-2025 ERROR:'                     10305003
103051                      ' SQL='                                     10305103
103052                      PV-DISPLAY-SQLCODE                          10305203
103053                      ' PO:'  PV-DISPLAY-PO-NBR                   10305303
103054                      ' SKU:' PV-DISPLAY-SKU-NBR                  10305403
103055                      DELIMITED BY SIZE                           10305503
103056                                   INTO PV-CICS-MSG-AREA          10305603
103057             PERFORM 8000-WRITE-TO-CICS-LOG                       10305703
103058                                                                  10305803
103059             SET WS007-INVALID-SQL    TO TRUE                     10305903
103060             MOVE '2025-UPDATE-FA-RCVR'                           10306003
103061                                      TO WS007-SQL-ERROR-PARA     10306103
103062                                         DP013-PARAGRAPH          10306203
103063             MOVE SQLCA               TO WS007-SQLCA              10306303
103064                                         DP013-SQLCA              10306403
103065             STRING 'SQL='                                        10306503
103066                  PV-DISPLAY-SQLCODE                              10306603
103067                  DELIMITED BY SIZE                               10306703
103068                                    INTO WS007-CRA-RET-MSG        10306803
103069             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   10306903
103070             MOVE 'TPURITM'           TO                          10307003
103071                                       DP013-DB2-TABLE-NAME (1)   10307103
103072             MOVE 'XLV_SKU'           TO                          10307203
103073                                       DP013-DB2-TABLE-NAME (2)   10307303
103074             SET DP013-DB2-ABEND      TO TRUE                     10307403
103075             PERFORM 9999-ABEND                                   10307503
103076     END-EVALUATE.                                                10307603
103077                                                                  10307703
103078 2026-GET-MOST-RECENT-TPURITM.                                    10307803
103079                                                                  10307903
103080     IF PS-CICS-SWITCH-YES                                        10308003
103081          STRING  ' ' WS007-SRC-TASK-NUMBER                       10308103
103082                  ' WSKCS309-2026-GET-MOST-RECENT-TPURITM '       10308203
103083                  DELIMITED BY SIZE                               10308303
103084            INTO  PV-CICS-MSG-AREA                                10308403
103085         PERFORM 8000-WRITE-TO-CICS-LOG                           10308503
103086     END-IF.                                                      10308603
103087                                                                  10308703
103088                                                                  10308803
103089     EXEC SQL                                                     10308903
103090         SELECT B.APP_PO_LNE_NBR                                  10309003
103091              , B.VER_NBR                                         10309103
103092              , B.ITM_NBR                                         10309203
103093              , B.UNT_RTL_PR_AMT                                  10309303
103094              , B.GP_RTL_AMT                                      10309403
103095              , B.GP_QTY                                          10309503
103096              , B.PO_PREPK_ID                                     10309603
103097              , B.UNT_COST_AMT                                    10309703
103098              , B.PREPK_RATO_QTY                                  10309803
103099         INTO   :PURITM-APP-PO-LNE-NBR                            10309903
103100              , :PURITM-VER-NBR                                   10310003
103101              , :PURITM-ITM-NBR                                   10310103
103102              , :PURITM-UNT-RTL-PR-AMT                            10310203
103103              , :PURITM-GP-RTL-AMT                                10310303
103104              , :PURITM-GP-QTY                                    10310403
103105              , :PURITM-PO-PREPK-ID                               10310503
103106              , :PURITM-UNT-COST-AMT                              10310603
103107              , :PURITM-PREPK-RATO-QTY                            10310703
103108         FROM    XLV_SKU  A                                       10310803
103109               , TPURITM  B                                       10310903
103110         WHERE   B.PO_NBR         = :DK-PO-NBR                    10311003
103120         AND     A.SKU_NBR        = :DK-SKU-NBR                   10312003
103130         AND     A.ITM_NBR        = B.ITM_NBR                     10313003
103140         AND     B.VER_STATUS_CDE = 'A'                           10314003
103150         ORDER BY LAST_UPD_TMST DESC                              10315003
103160     END-EXEC.                                                    10316003
103170                                                                  10317003
103180     EVALUATE TRUE                                                10318003
103190         WHEN SQLCODE = ZERO                                      10319003
103200         WHEN SQLCODE = -811                                      10320003
103300             MOVE PURITM-APP-PO-LNE-NBR  TO WS-APP-PO-LNE-NBR     10330003
103400* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            10340003
103500*        WHEN SQLCODE = -904                                      10350003
103600*        WHEN SQLCODE = -913                                      10360003
103700*        WHEN SQLCODE = -911                                      10370003
103800*            CONTINUE                                             10380003
103900         WHEN SQLCODE = +100                                      10390003
104000             SET PS-PURITM-FOUND-NONE    TO TRUE                  10400003
104100             SET WS007-INVALID-SQL       TO TRUE                  10410003
104200             MOVE '2026-GET-MOST-RECENT-TPURITM'                  10420003
104300                                         TO WS007-SQL-ERROR-PARA  10430003
104400             MOVE 'NO APP PO NBRS FOUND'                          10440003
104500                                         TO WS007-CRA-RET-MSG     10450003
104600             MOVE SQLCA                  TO WS007-SQLCA           10460003
104700             IF PS-CICS-SWITCH-YES                                10470003
104800                 INITIALIZE PV-CICS-MSG-AREA                      10480003
104900                 MOVE DK-PO-NBR          TO PV-DISPLAY-PO-NBR     10490003
105000                 MOVE DK-SKU-NBR         TO PV-DISPLAY-SKU-NBR    10500003
105100                 STRING   ' WSKCS309-2026:'                       10510003
105200                          ' NO APP PO NBRS FOUND'                 10520003
105300                          ' PO:'   PV-DISPLAY-PO-NBR              10530003
105400                          ' SKU:'  PV-DISPLAY-SKU-NBR             10540003
105500                          DELIMITED BY SIZE                       10550003
105600                          INTO PV-CICS-MSG-AREA                   10560003
105700                 PERFORM 8000-WRITE-TO-CICS-LOG                   10570003
105800             END-IF                                               10580003
105900         WHEN SQLWARN0 NOT = SPACES                               10590003
106000         WHEN SQLCODE NOT = ZERO                                  10600003
106100             MOVE SQLCODE             TO WS007-SQLCODE            10610003
106200                                         PV-DISPLAY-SQLCODE       10620003
106300             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        10630003
106400             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       10640003
106500             INITIALIZE PV-CICS-MSG-AREA                          10650003
106600             STRING   ' ' WS007-SRC-TASK-NUMBER                   10660003
106700                      ' WSKCS309-2026 ERROR:'                     10670003
106800                      ' SQL='                                     10680003
106900                      PV-DISPLAY-SQLCODE                          10690003
107000                      ' PO:'   PV-DISPLAY-PO-NBR                  10700003
107100                      ' SKU:'  PV-DISPLAY-SKU-NBR                 10710003
107200                      DELIMITED BY SIZE                           10720003
107300                                   INTO PV-CICS-MSG-AREA          10730003
107400             PERFORM 8000-WRITE-TO-CICS-LOG                       10740003
107500                                                                  10750003
107600             SET WS007-INVALID-SQL    TO TRUE                     10760003
107700             MOVE '2026-GET-MOST-RECENT-TPURITM'                  10770003
107800                                      TO WS007-SQL-ERROR-PARA     10780003
107900                                         DP013-PARAGRAPH          10790003
108000             MOVE SQLCA               TO WS007-SQLCA              10800003
108100                                         DP013-SQLCA              10810003
108200             STRING 'SQL='                                        10820003
108300                  PV-DISPLAY-SQLCODE                              10830003
108400                  DELIMITED BY SIZE                               10840003
108500                                    INTO WS007-CRA-RET-MSG        10850003
108600             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   10860003
108700             MOVE 'TPURITM'           TO                          10870003
108800                                       DP013-DB2-TABLE-NAME (1)   10880003
108900             MOVE 'XLV_SKU'           TO                          10890003
109000                                       DP013-DB2-TABLE-NAME (2)   10900003
109100             SET DP013-DB2-ABEND      TO TRUE                     10910003
109200             PERFORM 9999-ABEND                                   10920003
109300     END-EVALUATE.                                                10930003
109400                                                                  10940003
109500 2050-CHECK-PURITM.                                               10950003
109600                                                                  10960003
109700     IF PS-CICS-SWITCH-YES                                        10970003
109800          STRING  ' ' WS007-SRC-TASK-NUMBER                       10980003
109900                  ' WSKCS309-2050-CHECK-PURITM            '       10990003
110000                  DELIMITED BY SIZE                               11000003
110100            INTO  PV-CICS-MSG-AREA                                11010003
110200         PERFORM 8000-WRITE-TO-CICS-LOG                           11020003
110300     END-IF.                                                      11030003
110400                                                                  11040003
110500                                                                  11050003
110600     EXEC SQL                                                     11060003
110700         SELECT B.APP_PO_LNE_NBR                                  11070003
110710              , B.VER_NBR                                         11071003
110720              , B.ITM_NBR                                         11072003
110730              , B.UNT_RTL_PR_AMT                                  11073003
110740              , B.GP_RTL_AMT                                      11074003
110750              , B.GP_QTY                                          11075003
110760              , B.PO_PREPK_ID                                     11076003
110770              , B.UNT_COST_AMT                                    11077003
110771              , B.PREPK_RATO_QTY                                  11077103
110772         INTO   :PURITM-APP-PO-LNE-NBR                            11077203
110773              , :PURITM-VER-NBR                                   11077303
110774              , :PURITM-ITM-NBR                                   11077403
110775              , :PURITM-UNT-RTL-PR-AMT                            11077503
110776              , :PURITM-GP-RTL-AMT                                11077603
110777              , :PURITM-GP-QTY                                    11077703
110778              , :PURITM-PO-PREPK-ID                               11077803
110779              , :PURITM-UNT-COST-AMT                              11077903
110780              , :PURITM-PREPK-RATO-QTY                            11078003
110790         FROM    XLV_SKU  A                                       11079003
110791               , TPURITM  B                                       11079103
110792         WHERE   B.PO_NBR         = :DK-PO-NBR                    11079203
110793         AND     A.SKU_NBR        = :DK-SKU-NBR                   11079303
110794         AND     A.ITM_NBR        = B.ITM_NBR                     11079403
110795         AND     B.VER_STATUS_CDE = 'A'                           11079503
110796     END-EXEC.                                                    11079603
110797                                                                  11079703
110798     EVALUATE TRUE                                                11079803
110799         WHEN SQLCODE = ZERO                                      11079903
110800             MOVE PURITM-APP-PO-LNE-NBR  TO WS-APP-PO-LNE-NBR     11080003
110801             MOVE PURITM-APP-PO-LNE-NBR  TO WS-TRN-LNE-NBR        11080103
110802             SET PS-PURITM-FOUND-ONE     TO TRUE                  11080203
110803         WHEN SQLCODE = -811                                      11080303
110805             MOVE ZERO                   TO WS-APP-PO-LNE-NBR     11080503
110806             SET PS-PURITM-FOUND-MULT    TO TRUE                  11080606
110807*                                                                 11080706
110808* DMH - 2/15/2024 - BEGIN                                         11080806
110809* DMH - CHECK IF THE LINE/SKU FROM THE PIX MATCHES                11080906
110810*   WS014-PO-LINE-NUMBER   WS-TRN-LNE-NBR                         11081006
110811*                                                                 11081106
110812             IF  WS014-PO-LINE-NUMBER > 0                         11081206
110813                 PERFORM 2055-CHECK-PURITM-SKU-LNE                11081306
110814             ELSE                                                 11081406
110817                 PERFORM 2060-CHECK-PURITM-A-AC                   11081706
110818             END-IF                                               11081806
110819* DMH - 2/15/2024 - END                                           11081906
110820*                                                                 11082006
110821* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            11082106
110822*        WHEN SQLCODE = -904                                      11082206
110823*        WHEN SQLCODE = -913                                      11082306
110824*        WHEN SQLCODE = -911                                      11082406
110825*            CONTINUE                                             11082506
110826         WHEN SQLCODE = +100                                      11082606
110827             SET PS-PURITM-FOUND-NONE    TO TRUE                  11082706
110828             SET WS007-INVALID-SQL       TO TRUE                  11082806
110829             MOVE '2050-CHECK-PURITM'                             11082906
110830                                         TO WS007-SQL-ERROR-PARA  11083006
110831             MOVE 'NO APP PO NBRS FOUND'                          11083106
110832                                         TO WS007-CRA-RET-MSG     11083206
110833             MOVE SQLCA                  TO WS007-SQLCA           11083306
110834             IF PS-CICS-SWITCH-YES                                11083406
110835                 INITIALIZE PV-CICS-MSG-AREA                      11083506
110836                 MOVE DK-PO-NBR          TO PV-DISPLAY-PO-NBR     11083606
110837                 MOVE DK-SKU-NBR         TO PV-DISPLAY-SKU-NBR    11083706
110838                 STRING   ' WSKCS309-2050:'                       11083806
110839                          ' NO APP PO NBRS FOUND'                 11083906
110840                          ' PO:'   PV-DISPLAY-PO-NBR              11084006
110841                          ' SKU:'  PV-DISPLAY-SKU-NBR             11084106
110842                          DELIMITED BY SIZE                       11084206
110843                          INTO PV-CICS-MSG-AREA                   11084306
110844                 PERFORM 8000-WRITE-TO-CICS-LOG                   11084406
110845             END-IF                                               11084506
110846         WHEN SQLWARN0 NOT = SPACES                               11084606
110847         WHEN SQLCODE NOT = ZERO                                  11084706
110848             MOVE SQLCODE             TO WS007-SQLCODE            11084806
110849                                         PV-DISPLAY-SQLCODE       11084906
110850             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        11085006
110851             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       11085106
110852             INITIALIZE PV-CICS-MSG-AREA                          11085206
110853             STRING   ' ' WS007-SRC-TASK-NUMBER                   11085306
110854                      ' WSKCS309-2050 ERROR:'                     11085406
110855                      ' SQL='                                     11085506
110856                      PV-DISPLAY-SQLCODE                          11085606
110857                      ' PO:'   PV-DISPLAY-PO-NBR                  11085706
110858                      ' SKU:'  PV-DISPLAY-SKU-NBR                 11085806
110859                      DELIMITED BY SIZE                           11085906
110860                                   INTO PV-CICS-MSG-AREA          11086006
110861             PERFORM 8000-WRITE-TO-CICS-LOG                       11086106
110862                                                                  11086206
110863             SET WS007-INVALID-SQL    TO TRUE                     11086306
110864             MOVE '2050-CHECK-PURITM'                             11086406
110865                                      TO WS007-SQL-ERROR-PARA     11086506
110866                                         DP013-PARAGRAPH          11086606
110867             MOVE SQLCA               TO WS007-SQLCA              11086706
110868                                         DP013-SQLCA              11086806
110869             STRING 'SQL='                                        11086906
110870                  PV-DISPLAY-SQLCODE                              11087006
110871                  DELIMITED BY SIZE                               11087106
110872                                    INTO WS007-CRA-RET-MSG        11087206
110873             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   11087306
110874             MOVE 'TPURITM'           TO                          11087406
110875                                       DP013-DB2-TABLE-NAME (1)   11087506
110876             MOVE 'XLV_SKU'           TO                          11087606
110877                                       DP013-DB2-TABLE-NAME (2)   11087706
110878             SET DP013-DB2-ABEND      TO TRUE                     11087806
110879             PERFORM 9999-ABEND                                   11087906
110880     END-EVALUATE.                                                11088006
110881                                                                  11088106
110882     IF PS-CICS-SWITCH-YES                                        11088206
110883          INITIALIZE  PV-CICS-MSG-AREA                            11088306
110884          MOVE SQLCODE               TO  PV-DISPLAY-SQLCODE       11088406
110885          MOVE PURITM-APP-PO-LNE-NBR TO  PV-DISPLAY-LINE          11088506
110886          STRING  ' ' WS007-SRC-TASK-NUMBER                       11088606
110887                  ' WSKCS309-2050  '                              11088706
110888                  ' LINE:' PV-DISPLAY-LINE                        11088806
110889                  ' SQL:'  PV-DISPLAY-SQLCODE                     11088906
110890                  DELIMITED BY SIZE                               11089006
110891            INTO  PV-CICS-MSG-AREA                                11089106
110892         PERFORM 8000-WRITE-TO-CICS-LOG                           11089206
110893     END-IF.                                                      11089306
110894                                                                  11089406
110895                                                                  11089506
110896****************************************************************  11089606
110897* CHECK IF PURITM SKU/LINE MATCHES ONLY IF 2050 RETURNS -811      11089706
110898* DMH 2/15/24                                                     11089806
110899****************************************************************  11089906
110900 2055-CHECK-PURITM-SKU-LNE.                                       11090008
110901                                                                  11090106
110902     IF PS-CICS-SWITCH-YES                                        11090206
110903          STRING  ' ' WS007-SRC-TASK-NUMBER                       11090306
110904                  ' WSKCS309-2055-CHECK-PURITM-SKU-LNE    '       11090406
110905                  DELIMITED BY SIZE                               11090506
110906            INTO  PV-CICS-MSG-AREA                                11090606
110907         PERFORM 8000-WRITE-TO-CICS-LOG                           11090706
110908                                                                  11090806
110909          MOVE SPACES TO PV-CICS-MSG-AREA                         11090906
110910          MOVE WS014-PO-LINE-NUMBER  TO  PV-DISPLAY-LINE          11091006
110911          STRING  ' ' WS007-SRC-TASK-NUMBER                       11091106
110912                  ' WSKCS309-2055-WS014-PO-LINE-NUMBER:   '       11091206
110913                    PV-DISPLAY-LINE                               11091306
110914                  DELIMITED BY SIZE                               11091406
110915            INTO  PV-CICS-MSG-AREA                                11091506
110916         PERFORM 8000-WRITE-TO-CICS-LOG                           11091606
110917                                                                  11091706
110918          MOVE SPACES TO PV-CICS-MSG-AREA                         11091806
110919          MOVE DK-TRN-LNE-NBR        TO  PV-DISPLAY-LINE          11091906
110920          STRING  ' ' WS007-SRC-TASK-NUMBER                       11092006
110921                  ' WSKCS309-2055-DK-TRN-LNE-NBR:         '       11092106
110922                    PV-DISPLAY-LINE                               11092206
110923                  DELIMITED BY SIZE                               11092306
110924            INTO  PV-CICS-MSG-AREA                                11092406
110925         PERFORM 8000-WRITE-TO-CICS-LOG                           11092506
110926     END-IF.                                                      11092606
110927                                                                  11092706
110928     MOVE WS014-PO-LINE-NUMBER   TO  DK-TRN-LNE-NBR.              11092806
110929                                                                  11092906
110930     EXEC SQL                                                     11093006
110931         SELECT B.APP_PO_LNE_NBR                                  11093106
110932              , B.VER_NBR                                         11093206
110933              , B.ITM_NBR                                         11093306
110934              , B.UNT_RTL_PR_AMT                                  11093406
110935              , B.GP_RTL_AMT                                      11093506
110936              , B.GP_QTY                                          11093606
110937              , B.PO_PREPK_ID                                     11093706
110938              , B.UNT_COST_AMT                                    11093806
110939              , B.PREPK_RATO_QTY                                  11093906
110940         INTO   :PURITM-APP-PO-LNE-NBR                            11094006
110941              , :PURITM-VER-NBR                                   11094106
110942              , :PURITM-ITM-NBR                                   11094206
110943              , :PURITM-UNT-RTL-PR-AMT                            11094306
110944              , :PURITM-GP-RTL-AMT                                11094406
110945              , :PURITM-GP-QTY                                    11094506
110946              , :PURITM-PO-PREPK-ID                               11094606
110947              , :PURITM-UNT-COST-AMT                              11094706
110948              , :PURITM-PREPK-RATO-QTY                            11094806
110949         FROM    XLV_SKU  A                                       11094906
110950               , TPURITM  B                                       11095006
110951         WHERE   B.PO_NBR         = :DK-PO-NBR                    11095106
110952         AND     A.SKU_NBR        = :DK-SKU-NBR                   11095206
110953         AND     B.APP_PO_LNE_NBR = :DK-TRN-LNE-NBR               11095306
110954         AND     A.ITM_NBR        = B.ITM_NBR                     11095406
110955         AND     B.VER_STATUS_CDE = 'A'                           11095506
110956         AND     B.STATUS_CDE    IN ('AC','AP')                   11095606
110957     END-EXEC.                                                    11095706
110958                                                                  11095806
110959     EVALUATE TRUE                                                11095906
110960         WHEN SQLCODE = ZERO                                      11096006
110961             MOVE PURITM-APP-PO-LNE-NBR  TO WS-APP-PO-LNE-NBR     11096106
110962             MOVE PURITM-APP-PO-LNE-NBR  TO WS-TRN-LNE-NBR        11096206
110963             SET PS-PURITM-FOUND-ONE     TO TRUE                  11096306
110964         WHEN SQLCODE = -811                                      11096406
110965             MOVE ZERO                   TO WS-APP-PO-LNE-NBR     11096506
110966             SET PS-PURITM-FOUND-MULT    TO TRUE                  11096606
110967             PERFORM 2060-CHECK-PURITM-A-AC                       11096708
110968                                                                  11096806
110969         WHEN SQLCODE = +100                                      11096906
110970             MOVE ZERO                   TO WS-APP-PO-LNE-NBR     11097006
110971             SET PS-PURITM-FOUND-MULT    TO TRUE                  11097106
110972             PERFORM 2060-CHECK-PURITM-A-AC                       11097208
110973                                                                  11097306
110974         WHEN SQLWARN0 NOT = SPACES                               11097406
110975         WHEN SQLCODE NOT = ZERO                                  11097506
110976             MOVE SQLCODE             TO WS007-SQLCODE            11097606
110977                                         PV-DISPLAY-SQLCODE       11097706
110978             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        11097806
110979             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       11097906
110980             MOVE DK-TRN-LNE-NBR      TO PV-DISPLAY-LINE          11098006
110981             INITIALIZE PV-CICS-MSG-AREA                          11098106
110982             STRING   ' ' WS007-SRC-TASK-NUMBER                   11098206
110983                      ' WSKCS309-2055 ERROR:'                     11098306
110984                      ' SQL='                                     11098406
110985                      PV-DISPLAY-SQLCODE                          11098506
110986                      ' PO:'   PV-DISPLAY-PO-NBR                  11098606
110987                      ' SKU:'  PV-DISPLAY-SKU-NBR                 11098706
110988                      ' LNE:'  PV-DISPLAY-LINE                    11098806
110989                      DELIMITED BY SIZE                           11098906
110990                                   INTO PV-CICS-MSG-AREA          11099006
110991             PERFORM 8000-WRITE-TO-CICS-LOG                       11099106
110992                                                                  11099206
110993             SET WS007-INVALID-SQL    TO TRUE                     11099306
110994             MOVE '2055-CHECK-PURITM-SKU-LINE'                    11099406
110995                                      TO WS007-SQL-ERROR-PARA     11099506
110996                                         DP013-PARAGRAPH          11099606
110997             MOVE SQLCA               TO WS007-SQLCA              11099706
110998                                         DP013-SQLCA              11099806
110999             STRING 'SQL='                                        11099906
111000                  PV-DISPLAY-SQLCODE                              11100006
111001                  DELIMITED BY SIZE                               11100106
111002                                    INTO WS007-CRA-RET-MSG        11100206
111003             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   11100306
111004             MOVE 'TPURITM'           TO                          11100406
111005                                       DP013-DB2-TABLE-NAME (1)   11100506
111006             MOVE 'XLV_SKU'           TO                          11100606
111007                                       DP013-DB2-TABLE-NAME (2)   11100706
111008             SET DP013-DB2-ABEND      TO TRUE                     11100806
111009             PERFORM 9999-ABEND                                   11100906
111010     END-EVALUATE.                                                11101006
111011                                                                  11101106
111012     IF PS-CICS-SWITCH-YES                                        11101206
111013          INITIALIZE  PV-CICS-MSG-AREA                            11101306
111014          MOVE SQLCODE               TO  PV-DISPLAY-SQLCODE       11101406
111015          MOVE PURITM-APP-PO-LNE-NBR TO  PV-DISPLAY-LINE          11101506
111016          STRING  ' ' WS007-SRC-TASK-NUMBER                       11101606
111017                  ' WSKCS309-2055  '                              11101706
111018                  ' LINE:' PV-DISPLAY-LINE                        11101806
111019                  ' SQL:'  PV-DISPLAY-SQLCODE                     11101906
111020                  DELIMITED BY SIZE                               11102006
111021            INTO  PV-CICS-MSG-AREA                                11102106
111022         PERFORM 8000-WRITE-TO-CICS-LOG                           11102206
111023     END-IF.                                                      11102306
111024                                                                  11102406
111025                                                                  11102506
111026****************************************************************  11102606
111027* A-AC IS ONLY CHECKED IF MULTIPLE ROWS ARE RETURNED FROM 2050    11102706
111028****************************************************************  11102806
111029 2060-CHECK-PURITM-A-AC.                                          11102906
111030                                                                  11103006
111031     IF PS-CICS-SWITCH-YES                                        11103106
111032          STRING  ' ' WS007-SRC-TASK-NUMBER                       11103206
111033                  ' WSKCS309-2060-CHECK-PURITM-A-AC       '       11103306
111034                  DELIMITED BY SIZE                               11103406
111035            INTO  PV-CICS-MSG-AREA                                11103506
111036         PERFORM 8000-WRITE-TO-CICS-LOG                           11103606
111037     END-IF.                                                      11103706
111038                                                                  11103806
111039                                                                  11103906
111040     EXEC SQL                                                     11104006
111041         SELECT B.APP_PO_LNE_NBR                                  11104106
111042              , B.VER_NBR                                         11104206
111043              , B.ITM_NBR                                         11104306
111044              , B.UNT_RTL_PR_AMT                                  11104406
111045              , B.GP_RTL_AMT                                      11104506
111046              , B.GP_QTY                                          11104606
111047              , B.PO_PREPK_ID                                     11104706
111048              , B.UNT_COST_AMT                                    11104806
111049              , B.PREPK_RATO_QTY                                  11104906
111050         INTO   :PURITM-APP-PO-LNE-NBR                            11105006
111051              , :PURITM-VER-NBR                                   11105106
111052              , :PURITM-ITM-NBR                                   11105206
111053              , :PURITM-UNT-RTL-PR-AMT                            11105306
111054              , :PURITM-GP-RTL-AMT                                11105406
111055              , :PURITM-GP-QTY                                    11105506
111056              , :PURITM-PO-PREPK-ID                               11105606
111057              , :PURITM-UNT-COST-AMT                              11105706
111058              , :PURITM-PREPK-RATO-QTY                            11105806
111059         FROM    XLV_SKU  A                                       11105906
111060               , TPURITM  B                                       11106006
111061         WHERE   B.PO_NBR         = :DK-PO-NBR                    11106106
111062         AND     A.SKU_NBR        = :DK-SKU-NBR                   11106206
111063         AND     A.ITM_NBR        = B.ITM_NBR                     11106306
111064         AND     B.VER_STATUS_CDE = 'A'                           11106406
111065         AND     B.STATUS_CDE    IN ('AC','AP')                   11106506
111066     END-EXEC.                                                    11106606
111067                                                                  11106706
111068     EVALUATE TRUE                                                11106806
111069         WHEN SQLCODE = ZERO                                      11106906
111070             MOVE PURITM-APP-PO-LNE-NBR  TO WS-APP-PO-LNE-NBR     11107006
111071             MOVE PURITM-APP-PO-LNE-NBR  TO WS-TRN-LNE-NBR        11107106
111072             SET PS-PURITM-FOUND-ONE     TO TRUE                  11107206
111073         WHEN SQLCODE = -811                                      11107306
111074             MOVE ZERO                   TO WS-APP-PO-LNE-NBR     11107406
111075             SET PS-PURITM-FOUND-MULT    TO TRUE                  11107506
111076             PERFORM 2080-CHECK-PURITM-A-AC-MAX                   11107606
111077* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            11107706
111078*        WHEN SQLCODE = -904                                      11107806
111079*        WHEN SQLCODE = -913                                      11107906
111080*        WHEN SQLCODE = -911                                      11108006
111081*            CONTINUE                                             11108106
111082         WHEN SQLCODE = +100                                      11108206
111083             PERFORM 2070-CHECK-PURITM-A-MAX                      11108306
111084                                                                  11108406
111085         WHEN SQLWARN0 NOT = SPACES                               11108506
111086         WHEN SQLCODE NOT = ZERO                                  11108606
111087             MOVE SQLCODE             TO WS007-SQLCODE            11108706
111088                                         PV-DISPLAY-SQLCODE       11108806
111089             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        11108906
111090             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       11109006
111091             INITIALIZE PV-CICS-MSG-AREA                          11109106
111092             STRING   ' ' WS007-SRC-TASK-NUMBER                   11109206
111093                      ' WSKCS309-2060 ERROR:'                     11109306
111094                      ' SQL='                                     11109406
111095                      PV-DISPLAY-SQLCODE                          11109506
111096                      ' PO:'   PV-DISPLAY-PO-NBR                  11109606
111097                      ' SKU:'  PV-DISPLAY-SKU-NBR                 11109706
111098                      DELIMITED BY SIZE                           11109806
111099                                   INTO PV-CICS-MSG-AREA          11109906
111100             PERFORM 8000-WRITE-TO-CICS-LOG                       11110006
111101                                                                  11110106
111102             SET WS007-INVALID-SQL    TO TRUE                     11110206
111103             MOVE '2060-CHECK-PURITM-A-AC'                        11110306
111104                                      TO WS007-SQL-ERROR-PARA     11110406
111105                                         DP013-PARAGRAPH          11110506
111106             MOVE SQLCA               TO WS007-SQLCA              11110606
111107                                         DP013-SQLCA              11110706
111108             STRING 'SQL='                                        11110806
111109                  PV-DISPLAY-SQLCODE                              11110906
111110                  DELIMITED BY SIZE                               11111006
111111                                    INTO WS007-CRA-RET-MSG        11111106
111112             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   11111206
111113             MOVE 'TPURITM'           TO                          11111306
111114                                       DP013-DB2-TABLE-NAME (1)   11111406
111115             MOVE 'XLV_SKU'           TO                          11111506
111116                                       DP013-DB2-TABLE-NAME (2)   11111606
111117             SET DP013-DB2-ABEND      TO TRUE                     11111706
111118             PERFORM 9999-ABEND                                   11111806
111119     END-EVALUATE.                                                11111906
111120                                                                  11112006
111121     IF PS-CICS-SWITCH-YES                                        11112106
111122          INITIALIZE  PV-CICS-MSG-AREA                            11112206
111123          MOVE SQLCODE               TO  PV-DISPLAY-SQLCODE       11112306
111124          MOVE PURITM-APP-PO-LNE-NBR TO  PV-DISPLAY-LINE          11112406
111125          STRING  ' ' WS007-SRC-TASK-NUMBER                       11112506
111126                  ' WSKCS309-2060  '                              11112606
111127                  ' LINE:' PV-DISPLAY-LINE                        11112706
111128                  ' SQL:'  PV-DISPLAY-SQLCODE                     11112806
111129                  DELIMITED BY SIZE                               11112906
111130            INTO  PV-CICS-MSG-AREA                                11113006
111131         PERFORM 8000-WRITE-TO-CICS-LOG                           11113106
111132     END-IF.                                                      11113206
111133                                                                  11113306
111134                                                                  11113406
111135****************************************************************  11113506
111136* A-AC IS ONLY CHECKED IF MULTIPLE ROWS ARE RETURNED FROM 2050    11113606
111137* THIS PARAGRAPH IS ONLY CALLED IF MULTIPLE ROWS RETURNED IN      11113706
111138* PARAGRAPH 2060                                                  11113806
111139* MULTIPLE ACTIVE ROWS FOR ITEM ON TPURITM                        11113906
111140* SELECT THE ONE WITH THE MAX STATUS TIMESTAMP                    11114006
111141****************************************************************  11114106
111142 2070-CHECK-PURITM-A-MAX.                                         11114206
111143                                                                  11114306
111144     IF PS-CICS-SWITCH-YES                                        11114406
111145          STRING  ' ' WS007-SRC-TASK-NUMBER                       11114506
111146                  ' WSKCS309-2070-CHECK-PURITM-A-MAX      '       11114606
111147                  DELIMITED BY SIZE                               11114706
111148            INTO  PV-CICS-MSG-AREA                                11114806
111149         PERFORM 8000-WRITE-TO-CICS-LOG                           11114906
111150     END-IF.                                                      11115006
111151                                                                  11115106
111152                                                                  11115206
111153     EXEC SQL                                                     11115306
111154         SELECT B.APP_PO_LNE_NBR                                  11115406
111155              , B.VER_NBR                                         11115506
111156              , B.ITM_NBR                                         11115606
111157              , B.UNT_RTL_PR_AMT                                  11115706
111158              , B.GP_RTL_AMT                                      11115806
111159              , B.GP_QTY                                          11115906
111160              , B.PO_PREPK_ID                                     11116006
111161              , B.UNT_COST_AMT                                    11116106
111162              , B.PREPK_RATO_QTY                                  11116206
111163         INTO   :PURITM-APP-PO-LNE-NBR                            11116306
111164              , :PURITM-VER-NBR                                   11116406
111165              , :PURITM-ITM-NBR                                   11116506
111166              , :PURITM-UNT-RTL-PR-AMT                            11116606
111167              , :PURITM-GP-RTL-AMT                                11116706
111168              , :PURITM-GP-QTY                                    11116806
111169              , :PURITM-PO-PREPK-ID                               11116906
111170              , :PURITM-UNT-COST-AMT                              11117006
111171              , :PURITM-PREPK-RATO-QTY                            11117106
111172         FROM    XLV_SKU  A                                       11117206
111173               , TPURITM  B                                       11117306
111174         WHERE   B.PO_NBR         = :DK-PO-NBR                    11117406
111175         AND     A.SKU_NBR        = :DK-SKU-NBR                   11117506
111176         AND     A.ITM_NBR        = B.ITM_NBR                     11117606
111177         AND     B.VER_STATUS_CDE = 'A'                           11117706
111178         AND     B.STAT_TMST  IN                                  11117806
111179                 (SELECT MAX(C.STAT_TMST)                         11117906
111180                    FROM TPURITM C                                11118006
111181                   WHERE  C.PO_NBR         = B.PO_NBR             11118106
111182                     AND  C.ITM_NBR        = B.ITM_NBR            11118206
111183                     AND  C.VER_STATUS_CDE = 'A')                 11118306
111184     END-EXEC.                                                    11118406
111185                                                                  11118506
111186     EVALUATE TRUE                                                11118606
111187         WHEN SQLCODE = ZERO                                      11118706
111188             MOVE PURITM-APP-PO-LNE-NBR  TO WS-APP-PO-LNE-NBR     11118806
111189             MOVE PURITM-APP-PO-LNE-NBR  TO WS-TRN-LNE-NBR        11118906
111190             SET PS-PURITM-FOUND-ONE     TO TRUE                  11119006
111191* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            11119106
111192*        WHEN SQLCODE = -904                                      11119206
111193*        WHEN SQLCODE = -913                                      11119306
111194*        WHEN SQLCODE = -911                                      11119406
111195*            CONTINUE                                             11119506
111196         WHEN SQLCODE = +100                                      11119606
111197             SET PS-PURITM-FOUND-NONE    TO TRUE                  11119706
111198             SET WS007-INVALID-SQL       TO TRUE                  11119806
111199             MOVE '2070-CHECK-PURITM-A-MAX'                       11119906
111200                                         TO WS007-SQL-ERROR-PARA  11120006
111201             MOVE 'NO APP PO NBRS FOUND'                          11120106
111202                                         TO WS007-CRA-RET-MSG     11120206
111203             MOVE SQLCA                  TO WS007-SQLCA           11120306
111204             IF PS-CICS-SWITCH-YES                                11120406
111205                 INITIALIZE PV-CICS-MSG-AREA                      11120506
111206                 MOVE DK-PO-NBR          TO PV-DISPLAY-PO-NBR     11120606
111207                 MOVE DK-SKU-NBR         TO PV-DISPLAY-SKU-NBR    11120706
111208                 STRING   ' WSKCS309-2070:'                       11120806
111209                          ' NO APP PO NBRS FOUND'                 11120906
111210                          ' PO:'   PV-DISPLAY-PO-NBR              11121006
111211                          ' SKU:'  PV-DISPLAY-SKU-NBR             11121106
111212                          DELIMITED BY SIZE                       11121206
111213                          INTO PV-CICS-MSG-AREA                   11121306
111214                 PERFORM 8000-WRITE-TO-CICS-LOG                   11121406
111215             END-IF                                               11121506
111216         WHEN SQLWARN0 NOT = SPACES                               11121606
111217         WHEN SQLCODE NOT = ZERO                                  11121706
111218             MOVE SQLCODE             TO WS007-SQLCODE            11121806
111219                                         PV-DISPLAY-SQLCODE       11121906
111220             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        11122006
111221             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       11122106
111222             INITIALIZE PV-CICS-MSG-AREA                          11122206
111223             STRING   ' ' WS007-SRC-TASK-NUMBER                   11122306
111224                      ' WSKCS309-2070 ERROR:'                     11122406
111225                      ' SQL='                                     11122506
111226                      PV-DISPLAY-SQLCODE                          11122606
111227                      ' PO:'   PV-DISPLAY-PO-NBR                  11122706
111228                      ' SKU:'  PV-DISPLAY-SKU-NBR                 11122806
111229                      DELIMITED BY SIZE                           11122906
111230                                   INTO PV-CICS-MSG-AREA          11123006
111231             PERFORM 8000-WRITE-TO-CICS-LOG                       11123106
111232                                                                  11123206
111233             SET WS007-INVALID-SQL    TO TRUE                     11123306
111234             MOVE '2070-CHECK-PURITM-A-MAX'                       11123406
111235                                      TO WS007-SQL-ERROR-PARA     11123506
111236                                         DP013-PARAGRAPH          11123606
111237             MOVE SQLCA               TO WS007-SQLCA              11123706
111238                                         DP013-SQLCA              11123806
111239             STRING 'SQL='                                        11123906
111240                  PV-DISPLAY-SQLCODE                              11124006
111241                  DELIMITED BY SIZE                               11124106
111242                                    INTO WS007-CRA-RET-MSG        11124206
111243             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   11124306
111244             MOVE 'TPURITM'           TO                          11124406
111245                                       DP013-DB2-TABLE-NAME (1)   11124506
111246             MOVE 'XLV_SKU'           TO                          11124606
111247                                       DP013-DB2-TABLE-NAME (2)   11124706
111248             SET DP013-DB2-ABEND      TO TRUE                     11124806
111249             PERFORM 9999-ABEND                                   11124906
111250     END-EVALUATE.                                                11125006
111251                                                                  11125106
111252     IF PS-CICS-SWITCH-YES                                        11125206
111253          INITIALIZE  PV-CICS-MSG-AREA                            11125306
111254          MOVE SQLCODE               TO  PV-DISPLAY-SQLCODE       11125406
111255          MOVE PURITM-APP-PO-LNE-NBR TO  PV-DISPLAY-LINE          11125506
111256          STRING  ' ' WS007-SRC-TASK-NUMBER                       11125606
111257                  ' WSKCS309-2070  '                              11125706
111258                  ' LINE:' PV-DISPLAY-LINE                        11125806
111259                  ' SQL:'  PV-DISPLAY-SQLCODE                     11125906
111260                  DELIMITED BY SIZE                               11126006
111261            INTO  PV-CICS-MSG-AREA                                11126106
111262         PERFORM 8000-WRITE-TO-CICS-LOG                           11126206
111263     END-IF.                                                      11126306
111264                                                                  11126406
111265****************************************************************  11126506
111266* A-AC IS ONLY CHECKED IF MULTIPLE ROWS ARE RETURNED FROM 2050    11126606
111267* THIS PARAGRAPH IS ONLY CALLED IF NO ACTIVE/ACTIVE ROWS ARE      11126706
111268* RETURNED IN PARAGRAPH 2060                                      11126806
111269* SELECT THE ONE WITH THE MAX STATUS TIMESTAMP                    11126906
111270****************************************************************  11127006
111271 2080-CHECK-PURITM-A-AC-MAX.                                      11127106
111272                                                                  11127206
111273     IF PS-CICS-SWITCH-YES                                        11127306
111274          STRING  ' ' WS007-SRC-TASK-NUMBER                       11127406
111275                  ' WSKCS309-2080-CHECK-PURITM-A-AC-MAX   '       11127506
111276                  DELIMITED BY SIZE                               11127606
111277            INTO  PV-CICS-MSG-AREA                                11127706
111278         PERFORM 8000-WRITE-TO-CICS-LOG                           11127806
111279     END-IF.                                                      11127906
111280                                                                  11128006
111281                                                                  11128106
111282     EXEC SQL                                                     11128206
111283         SELECT B.APP_PO_LNE_NBR                                  11128306
111284              , B.VER_NBR                                         11128406
111285              , B.ITM_NBR                                         11128506
111286              , B.UNT_RTL_PR_AMT                                  11128606
111287              , B.GP_RTL_AMT                                      11128706
111288              , B.GP_QTY                                          11128806
111289              , B.PO_PREPK_ID                                     11128906
111290              , B.UNT_COST_AMT                                    11129006
111291              , B.PREPK_RATO_QTY                                  11129106
111292         INTO   :PURITM-APP-PO-LNE-NBR                            11129206
111293              , :PURITM-VER-NBR                                   11129306
111294              , :PURITM-ITM-NBR                                   11129406
111295              , :PURITM-UNT-RTL-PR-AMT                            11129506
111296              , :PURITM-GP-RTL-AMT                                11129606
111297              , :PURITM-GP-QTY                                    11129706
111298              , :PURITM-PO-PREPK-ID                               11129806
111299              , :PURITM-UNT-COST-AMT                              11129906
111300              , :PURITM-PREPK-RATO-QTY                            11130006
111301         FROM    XLV_SKU  A                                       11130106
111302               , TPURITM  B                                       11130206
111303         WHERE   B.PO_NBR         = :DK-PO-NBR                    11130306
111304         AND     A.SKU_NBR        = :DK-SKU-NBR                   11130406
111305         AND     A.ITM_NBR        = B.ITM_NBR                     11130506
111306         AND     B.VER_STATUS_CDE = 'A'                           11130606
111307         AND     B.STATUS_CDE    IN ('AC','AP')                   11130706
111308         AND     B.STAT_TMST  IN                                  11130806
111309                 (SELECT MAX(C.STAT_TMST)                         11130906
111310                    FROM TPURITM C                                11131006
111311                   WHERE  C.PO_NBR         = B.PO_NBR             11131106
111312                     AND  C.ITM_NBR        = B.ITM_NBR            11131206
111313                     AND  C.VER_STATUS_CDE = 'A'                  11131306
111314                     AND  C.STATUS_CDE    IN ('AC','AP'))         11131406
111315     END-EXEC.                                                    11131506
111316                                                                  11131606
111317     EVALUATE TRUE                                                11131706
111318         WHEN SQLCODE = ZERO                                      11131806
111319             MOVE PURITM-APP-PO-LNE-NBR  TO WS-APP-PO-LNE-NBR     11131906
111320             MOVE PURITM-APP-PO-LNE-NBR  TO WS-TRN-LNE-NBR        11132006
111321             SET PS-PURITM-FOUND-ONE     TO TRUE                  11132106
111322* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            11132206
111323*        WHEN SQLCODE = -904                                      11132306
111324*        WHEN SQLCODE = -913                                      11132406
111325*        WHEN SQLCODE = -911                                      11132506
111326*            CONTINUE                                             11132606
111327         WHEN SQLCODE = +100                                      11132706
111328             SET PS-PURITM-FOUND-NONE    TO TRUE                  11132806
111329             SET WS007-INVALID-SQL       TO TRUE                  11132906
111330             MOVE '2080-CHECK-PURITM-A-AC-MAX'                    11133006
111331                                         TO WS007-SQL-ERROR-PARA  11133106
111332             MOVE 'NO APP PO NBRS FOUND'                          11133206
111333                                         TO WS007-CRA-RET-MSG     11133306
111334             MOVE SQLCA                  TO WS007-SQLCA           11133406
111335             IF PS-CICS-SWITCH-YES                                11133506
111336                 INITIALIZE PV-CICS-MSG-AREA                      11133606
111337                 MOVE DK-PO-NBR          TO PV-DISPLAY-PO-NBR     11133706
111338                 MOVE DK-SKU-NBR         TO PV-DISPLAY-SKU-NBR    11133806
111339                 STRING   ' WSKCS309-2080:'                       11133906
111340                          ' NO APP PO NBRS FOUND'                 11134006
111341                          ' PO:'   PV-DISPLAY-PO-NBR              11134106
111342                          ' SKU:'  PV-DISPLAY-SKU-NBR             11134206
111343                          DELIMITED BY SIZE                       11134306
111344                          INTO PV-CICS-MSG-AREA                   11134406
111345                 PERFORM 8000-WRITE-TO-CICS-LOG                   11134506
111346             END-IF                                               11134606
111347         WHEN SQLWARN0 NOT = SPACES                               11134706
111348         WHEN SQLCODE NOT = ZERO                                  11134806
111349             MOVE SQLCODE             TO WS007-SQLCODE            11134906
111350                                         PV-DISPLAY-SQLCODE       11135006
111351             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        11135106
111352             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       11135206
111353             INITIALIZE PV-CICS-MSG-AREA                          11135306
111354             STRING   ' ' WS007-SRC-TASK-NUMBER                   11135406
111355                      ' WSKCS309-2080 ERROR:'                     11135506
111356                      ' SQL='                                     11135606
111357                      PV-DISPLAY-SQLCODE                          11135706
111358                      ' PO:'   PV-DISPLAY-PO-NBR                  11135806
111359                      ' SKU:'  PV-DISPLAY-SKU-NBR                 11135906
111360                      DELIMITED BY SIZE                           11136006
111361                                   INTO PV-CICS-MSG-AREA          11136106
111362             PERFORM 8000-WRITE-TO-CICS-LOG                       11136206
111363                                                                  11136306
111364             SET WS007-INVALID-SQL    TO TRUE                     11136406
111365             MOVE '2080-CHECK-PURITM-A-AC-MAX'                    11136506
111366                                      TO WS007-SQL-ERROR-PARA     11136606
111367                                         DP013-PARAGRAPH          11136706
111368             MOVE SQLCA               TO WS007-SQLCA              11136806
111369                                         DP013-SQLCA              11136906
111370             STRING 'SQL='                                        11137006
111371                  PV-DISPLAY-SQLCODE                              11137106
111372                  DELIMITED BY SIZE                               11137206
111373                                    INTO WS007-CRA-RET-MSG        11137306
111374             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   11137406
111375             MOVE 'TPURITM'           TO                          11137506
111376                                       DP013-DB2-TABLE-NAME (1)   11137606
111377             MOVE 'XLV_SKU'           TO                          11137706
111378                                       DP013-DB2-TABLE-NAME (2)   11137806
111379             SET DP013-DB2-ABEND      TO TRUE                     11137906
111380             PERFORM 9999-ABEND                                   11138006
111381     END-EVALUATE.                                                11138106
111382                                                                  11138206
111383     IF PS-CICS-SWITCH-YES                                        11138306
111384          INITIALIZE  PV-CICS-MSG-AREA                            11138406
111385          MOVE SQLCODE               TO  PV-DISPLAY-SQLCODE       11138506
111386          MOVE PURITM-APP-PO-LNE-NBR TO  PV-DISPLAY-LINE          11138606
111387          STRING  ' ' WS007-SRC-TASK-NUMBER                       11138706
111388                  ' WSKCS309-2080  '                              11138806
111389                  ' LINE:' PV-DISPLAY-LINE                        11138906
111390                  ' SQL:'  PV-DISPLAY-SQLCODE                     11139006
111391                  DELIMITED BY SIZE                               11139106
111392            INTO  PV-CICS-MSG-AREA                                11139206
111393         PERFORM 8000-WRITE-TO-CICS-LOG                           11139306
111394     END-IF.                                                      11139406
111395                                                                  11139506
111396/                                                                 11139606
111397 3000-INSERT-RECITM.                                              11139706
111398                                                                  11139806
111399     IF PS-CICS-SWITCH-YES                                        11139906
111400          STRING  ' ' WS007-SRC-TASK-NUMBER                       11140006
111401                  ' WSKCS309-3000-INSERT-RECITM           '       11140106
111402                  DELIMITED BY SIZE                               11140206
111403            INTO  PV-CICS-MSG-AREA                                11140306
111404         PERFORM 8000-WRITE-TO-CICS-LOG                           11140406
111405     END-IF.                                                      11140506
111406                                                                  11140606
111407                                                                  11140706
111408     INITIALIZE DCLTRECITM.                                       11140806
111409     MOVE WS014-PO-NUMBER          TO RECITM-ORD-NBR.             11140906
111410     MOVE PURITM-APP-PO-LNE-NBR    TO RECITM-ORD-LNE-NBR.         11141006
111411                                                                  11141106
111412     IF WS008-NEW-REC-SEQ-NBR > 0                                 11141206
111413        MOVE WS008-NEW-REC-SEQ-NBR TO RECITM-REC-SEQ-NBR          11141306
111414     ELSE                                                         11141406
111415* SEPT 2009 - MARJ HOEFS - ADDED "IF" BELOW                       11141506
111416* IF RECV SEQ # IS NOT ON PIX, USE THE ONE CAPTURED IN PARA 1010. 11141606
111417*                                                                 11141706
111418* DMH 2016-06-09                                                  11141806
111419* USE PV-OTBND-CART-RCVR-SEQ-NBR THE ONE CAPTURED IN PARA 1010.   11141906
111420* THIS IS THE RECEIVER THE CARTON IS ATTACHED TO                  11142006
111421        IF WS014-REC-SEQ-NUMBER > 0  AND                          11142106
111422           PV-OTBND-CART-RCVR-SEQ-NBR  > 0                        11142206
111423            MOVE PV-OTBND-CART-RCVR-SEQ-NBR TO RECITM-REC-SEQ-NBR 11142306
111424        ELSE                                                      11142406
111425        IF WS014-REC-SEQ-NUMBER > 0                               11142506
111426            MOVE WS014-REC-SEQ-NUMBER       TO RECITM-REC-SEQ-NBR 11142606
111427        ELSE                                                      11142706
111428            MOVE PV-OTBND-CART-RCVR-SEQ-NBR TO RECITM-REC-SEQ-NBR 11142806
111429        END-IF                                                    11142906
111430        END-IF                                                    11143006
111431     END-IF.                                                      11143106
111432                                                                  11143206
111433     MOVE WS014-DC-LOCATION        TO RECITM-OPER-UNT-ID.         11143306
111434     MOVE 1                        TO RECITM-FCLTY-ID.            11143406
111435     MOVE WS014-CRE-TMST           TO RECITM-CRE-TMST.            11143506
111436     MOVE WS014-CRE-USER-ID        TO RECITM-CRE-UID.             11143606
111437     MOVE PURITM-VER-NBR           TO RECITM-PO-VER-NBR.          11143706
111438     MOVE PURITM-ITM-NBR           TO RECITM-ITM-NBR.             11143806
111439     MOVE SPACES                   TO RECITM-PRE-TKT-IND.         11143906
111440     MOVE SPACES                   TO RECITM-TKT-FMT-ID.          11144006
111441     MOVE 'IP'                     TO RECITM-STATUS-CDE.          11144106
111442     MOVE 'A'                      TO RECITM-VER-STATUS-CDE.      11144206
111443     MOVE WS014-SKU-QTY            TO RECITM-PKSL-ITM-QTY.        11144306
111450     MOVE 1                        TO RECITM-EXPTED-CART-CNT.     11145003
111500     MOVE PC-DEFAULT-NINES         TO RECITM-MKING-APRON-TMST.    11150003
111600     MOVE PURITM-UNT-COST-AMT      TO RECITM-UNT-COST-AMT.        11160003
111700     MOVE PC-DEFAULT-NINES         TO RECITM-VERFYD-TMST.         11170003
111800     MOVE PC-DEFAULT-NINES         TO RECITM-UPD-TMST.            11180003
111900     MOVE 'WSKCS309'               TO RECITM-UPD-PGM-ID.          11190003
112000     MOVE PC-DEFAULT-NINES         TO RECITM-LAST-TRSCP-TMST.     11200003
112100     MOVE PURITM-PO-PREPK-ID       TO RECITM-PREPK-ID.            11210003
112200     MOVE PURITM-UNT-RTL-PR-AMT    TO RECITM-UNT-RTL-AMT.         11220003
112300     MOVE PURITM-GP-RTL-AMT        TO RECITM-GP-RTL-AMT.          11230003
112400     MOVE PURITM-GP-QTY            TO RECITM-GP-QTY.              11240003
112500     MOVE WS014-SKU-QTY            TO RECITM-ORIG-PKSL-ITM-QTY.   11250003
112600     PERFORM 3005-SELECT-RECITM-FIELDS.                           11260003
112700     IF PS-RECITM-NOT-FOUND                                       11270003
112800         MOVE PURITM-PREPK-RATO-QTY TO RECITM-PREPK-RATO-QTY      11280003
112900     END-IF.                                                      11290003
113000                                                                  11300003
113100*                                                                 11310003
113200*** DMH - 5/2/16 BEGIN                                            11320003
113300     IF  RECITM-PREPK-ID  >  0                                    11330003
113400         PERFORM 3006-CHECK-IF-DRIVER-LINE                        11340003
113500     END-IF.                                                      11350003
113600*** DMH - 5/2/16 BEGIN                                            11360003
113700*                                                                 11370003
113800                                                                  11380003
113900     EXEC SQL                                                     11390003
114000          INSERT INTO TRECITM                                     11400003
114100              (ORD_NBR                                            11410003
114200             , ORD_LNE_NBR                                        11420003
114300             , REC_SEQ_NBR                                        11430003
114400             , OPER_UNT_ID                                        11440003
114500             , FCLTY_ID                                           11450003
114600             , CRE_TMST                                           11460003
114700             , CRE_UID                                            11470003
114800             , PO_VER_NBR                                         11480003
114900             , ITM_NBR                                            11490003
115000             , PRE_TKT_IND                                        11500003
115100             , TKT_FMT_ID                                         11510003
115200             , RTV_IND                                            11520003
115300             , STATUS_CDE                                         11530003
115400             , VER_STATUS_CDE                                     11540003
115500             , PKSL_ITM_QTY                                       11550003
115600             , DTL_CK_ITM_QTY                                     11560003
115700             , INNR_PACK_QTY                                      11570003
115800             , CASE_PACK_QTY                                      11580003
115900             , RTV_QTY                                            11590003
116000             , EXPTED_CART_CNT                                    11600003
116100             , ACTL_CART_CNT                                      11610003
116200             , MKING_APRON_TMST                                   11620003
116300             , UNT_COST_AMT                                       11630003
116400             , COLOR_DESC                                         11640003
116500             , SIZE_DESC                                          11650003
116600             , VEND_STYL_NAME                                     11660003
116700             , VEND_DESC                                          11670003
116800             , VERFYD_TMST                                        11680003
116900             , PKSL_NBR                                           11690003
117000             , REC_INV_LNE_NBR                                    11700003
117100             , DMG_ITM_QTY                                        11710003
117200             , UPD_TMST                                           11720003
117300             , UPD_UID                                            11730003
117400             , UPD_PGM_ID                                         11740003
117500             , RCPT_DISTR_UPD_CDE                                 11750003
117600             , VRFD_USR_ID                                        11760003
117700             , LAST_TRSCP_TMST                                    11770003
117800             , LAST_TRSCP_USR_ID                                  11780003
117900             , PREPK_ID                                           11790003
118000             , PREPK_RATO_QTY                                     11800003
118100             , PREPK_ODD_UNT_QTY                                  11810003
118200             , PREPK_DRV_LNE_CDE                                  11820003
118300             , UNT_RTL_AMT                                        11830003
118400             , GP_RTL_AMT                                         11840003
118500             , GP_QTY                                             11850003
118600             , ORIG_PKSL_ITM_QTY)                                 11860003
118700          VALUES (                                                11870003
118800               :RECITM-ORD-NBR                                    11880003
118900             , :RECITM-ORD-LNE-NBR                                11890003
119000             , :RECITM-REC-SEQ-NBR                                11900003
119100             , :RECITM-OPER-UNT-ID                                11910003
119200             , :RECITM-FCLTY-ID                                   11920003
119300             , :RECITM-CRE-TMST                                   11930003
119400             , :RECITM-CRE-UID                                    11940003
119500             , :RECITM-PO-VER-NBR                                 11950003
119600             , :RECITM-ITM-NBR                                    11960003
119700             , :RECITM-PRE-TKT-IND                                11970003
119800             , :RECITM-TKT-FMT-ID                                 11980003
119900             , :RECITM-RTV-IND                                    11990003
120000             , :RECITM-STATUS-CDE                                 12000003
120100             , :RECITM-VER-STATUS-CDE                             12010003
120200             , :RECITM-PKSL-ITM-QTY                               12020003
120300             , :RECITM-DTL-CK-ITM-QTY                             12030003
120400             , :RECITM-INNR-PACK-QTY                              12040003
120500             , :RECITM-CASE-PACK-QTY                              12050003
120600             , :RECITM-RTV-QTY                                    12060003
120700             , :RECITM-EXPTED-CART-CNT                            12070003
120800             , :RECITM-ACTL-CART-CNT                              12080003
120900             , :RECITM-MKING-APRON-TMST                           12090003
121000             , :RECITM-UNT-COST-AMT                               12100003
121100             , :RECITM-COLOR-DESC                                 12110003
121200             , :RECITM-SIZE-DESC                                  12120003
121300             , :RECITM-VEND-STYL-NAME                             12130003
121400             , :RECITM-VEND-DESC                                  12140003
121500             , :RECITM-VERFYD-TMST                                12150003
121600             , :RECITM-PKSL-NBR                                   12160003
121700             , :RECITM-REC-INV-LNE-NBR                            12170003
121800             , :RECITM-DMG-ITM-QTY                                12180003
121900             , :RECITM-UPD-TMST                                   12190003
122000             , :RECITM-UPD-UID                                    12200003
122100             , :RECITM-UPD-PGM-ID                                 12210003
122200             , :RECITM-RCPT-DISTR-UPD-CDE                         12220003
122300             , :RECITM-VRFD-USR-ID                                12230003
122400             , :RECITM-LAST-TRSCP-TMST                            12240003
122500             , :RECITM-LAST-TRSCP-USR-ID                          12250003
122600             , :RECITM-PREPK-ID                                   12260003
122700             , :RECITM-PREPK-RATO-QTY                             12270003
122800             , :RECITM-PREPK-ODD-UNT-QTY                          12280003
122900             , :RECITM-PREPK-DRV-LNE-CDE                          12290003
123000             , :RECITM-UNT-RTL-AMT                                12300003
123100             , :RECITM-GP-RTL-AMT                                 12310003
123200             , :RECITM-GP-QTY                                     12320003
123300             , :RECITM-ORIG-PKSL-ITM-QTY)                         12330003
123400     END-EXEC.                                                    12340003
123500                                                                  12350003
123600     EVALUATE TRUE                                                12360003
123700         WHEN SQLCODE = ZERO                                      12370003
123800         WHEN SQLCODE = -803                                      12380003
123900             SET PS-NEW-RECITM-CREATED-YES TO TRUE                12390003
124000             IF PS-CICS-SWITCH-YES                                12400003
124100                 MOVE WS014-PO-NUMBER    TO WS-DISPLAY-1          12410003
124200                 MOVE RECITM-ORD-NBR     TO PV-DISPLAY-PO-NBR     12420003
124300                 MOVE RECITM-ORD-LNE-NBR TO PV-DISPLAY-LINE       12430003
124400                 MOVE RECITM-REC-SEQ-NBR TO PV-DISPLAY-RCVR       12440003
124500                 MOVE RECITM-OPER-UNT-ID TO PV-DISPLAY-OPER       12450003
124600                 INITIALIZE PV-CICS-MSG-AREA                      12460003
124700                 STRING   ' WSKCS309-3000:'                       12470003
124800                          ' INSERT TO TRECITM'                    12480003
124900                          ' ORD NBR=' WS-DISPLAY-1                12490003
125000                          '  '                                    12500003
125100                          PV-DISPLAY-OPER '-'                     12510003
125200                          PV-DISPLAY-PO-NBR '-'                   12520003
125300                          PV-DISPLAY-RCVR   '-'                   12530003
125400                          PV-DISPLAY-LINE                         12540003
125500                          DELIMITED BY SIZE                       12550003
125600                          INTO PV-CICS-MSG-AREA                   12560003
125700                 PERFORM 8000-WRITE-TO-CICS-LOG                   12570003
125800             END-IF                                               12580003
125900* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            12590003
126000*        WHEN SQLCODE = -904                                      12600003
126100*        WHEN SQLCODE = -913                                      12610003
126200*        WHEN SQLCODE = -911                                      12620003
126300*             CONTINUE                                            12630003
126400         WHEN SQLWARN0 NOT = SPACES                               12640003
126500         WHEN SQLCODE NOT = ZERO                                  12650003
126600             MOVE SQLCODE             TO WS007-SQLCODE            12660003
126700                                         PV-DISPLAY-SQLCODE       12670003
126800             MOVE RECITM-ORD-NBR      TO PV-DISPLAY-PO-NBR        12680003
126900             MOVE RECITM-ORD-LNE-NBR  TO PV-DISPLAY-LINE          12690003
127000             MOVE RECITM-REC-SEQ-NBR  TO PV-DISPLAY-RCVR          12700003
127100             MOVE RECITM-OPER-UNT-ID  TO PV-DISPLAY-OPER          12710003
127200             INITIALIZE PV-CICS-MSG-AREA                          12720003
127300             STRING   ' ' WS007-SRC-TASK-NUMBER                   12730003
127400                      ' WSKCS309-3000 ERROR:'                     12740003
127500                      ' SQL='                                     12750003
127600                      PV-DISPLAY-SQLCODE                          12760003
127700                          '  '                                    12770003
127800                          PV-DISPLAY-OPER '-'                     12780003
127900                          PV-DISPLAY-PO-NBR '-'                   12790003
128000                          PV-DISPLAY-RCVR   '-'                   12800003
128100                          PV-DISPLAY-LINE                         12810003
128200                      DELIMITED BY SIZE                           12820003
128300                                   INTO PV-CICS-MSG-AREA          12830003
128400             PERFORM 8000-WRITE-TO-CICS-LOG                       12840003
128500                                                                  12850003
128600             SET WS007-INVALID-SQL    TO TRUE                     12860003
128700             MOVE '3000-INSERT-RECITM'                            12870003
128800                                      TO WS007-SQL-ERROR-PARA     12880003
128900                                         DP013-PARAGRAPH          12890003
129000             MOVE SQLCA               TO WS007-SQLCA              12900003
129100                                         DP013-SQLCA              12910003
129200             STRING 'SQL='                                        12920003
129300                  PV-DISPLAY-SQLCODE                              12930003
129400                  DELIMITED BY SIZE                               12940003
129500                                    INTO WS007-CRA-RET-MSG        12950003
129600             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   12960003
129700             MOVE 'TRECITM'           TO                          12970003
129800                                       DP013-DB2-TABLE-NAME (1)   12980003
129900             SET DP013-DB2-ABEND      TO TRUE                     12990003
130000             PERFORM 9999-ABEND                                   13000003
130100     END-EVALUATE.                                                13010003
130200                                                                  13020003
130300/                                                                 13030003
130400                                                                  13040003
130500 3005-SELECT-RECITM-FIELDS.                                       13050003
130600                                                                  13060003
130700     IF PS-CICS-SWITCH-YES                                        13070003
130800          STRING  ' ' WS007-SRC-TASK-NUMBER                       13080003
130900                  ' WSKCS309-3005-SELECT-RECITM-FIELDS    '       13090003
131000                  DELIMITED BY SIZE                               13100003
131100            INTO  PV-CICS-MSG-AREA                                13110003
131200         PERFORM 8000-WRITE-TO-CICS-LOG                           13120003
131300     END-IF.                                                      13130003
131400                                                                  13140003
131500                                                                  13150003
131600* SEPT 2009 - MARJ HOEFS - ADDED "IF" BELOW                       13160003
131700* IF RECV SEQ # IS NOT ON PIX, USE THE ONE CAPTURED IN PARA 1010. 13170003
131800*                                                                 13180003
131900* DMH 2016-06-09                                                  13190003
132000* USE PV-OTBND-CART-RCVR-SEQ-NBR THE ONE CAPTURED IN PARA 1010.   13200003
132100* THIS IS THE RECEIVER THE CARTON IS ATTACHED TO                  13210003
132200     IF WS014-REC-SEQ-NUMBER > 0  AND                             13220003
132300        PV-OTBND-CART-RCVR-SEQ-NBR  > 0                           13230003
132400         MOVE PV-OTBND-CART-RCVR-SEQ-NBR TO DK-REC-SEQ-RECITM     13240003
132500     ELSE                                                         13250003
132600     IF WS014-REC-SEQ-NUMBER > 0                                  13260003
132610         MOVE WS014-REC-SEQ-NUMBER       TO DK-REC-SEQ-RECITM     13261003
132620     ELSE                                                         13262003
132630         MOVE PV-OTBND-CART-RCVR-SEQ-NBR TO DK-REC-SEQ-RECITM     13263003
132640     END-IF                                                       13264003
132650     END-IF.                                                      13265003
132660                                                                  13266003
132670     EXEC SQL                                                     13267003
132680        SELECT RTV_IND                                            13268003
132690              ,INNR_PACK_QTY                                      13269003
132700              ,CASE_PACK_QTY                                      13270003
132800              ,RTV_QTY                                            13280003
132900              ,COLOR_DESC                                         13290003
133000              ,SIZE_DESC                                          13300003
133100              ,VEND_STYL_NAME                                     13310003
133200              ,VEND_DESC                                          13320003
133300              ,PREPK_RATO_QTY                                     13330003
133400              ,PREPK_DRV_LNE_CDE                                  13340003
133500        INTO                                                      13350003
133600             :RECITM-RTV-IND                                      13360003
133700           , :RECITM-INNR-PACK-QTY                                13370003
133710           , :RECITM-CASE-PACK-QTY                                13371003
133720           , :RECITM-RTV-QTY                                      13372003
133730           , :RECITM-COLOR-DESC                                   13373003
133740           , :RECITM-SIZE-DESC                                    13374003
133750           , :RECITM-VEND-STYL-NAME                               13375003
133760           , :RECITM-VEND-DESC                                    13376003
133770           , :RECITM-PREPK-RATO-QTY                               13377003
133780           , :RECITM-PREPK-DRV-LNE-CDE                            13378003
133790        FROM                                                      13379003
133800              TRECITM                                             13380003
133900        WHERE ORD_NBR       = :RECITM-ORD-NBR                     13390003
134000          AND REC_SEQ_NBR   = :DK-REC-SEQ-RECITM                  13400003
134100          AND ORD_LNE_NBR   = :RECITM-ORD-LNE-NBR                 13410003
134200     END-EXEC.                                                    13420003
134300                                                                  13430003
134400     EVALUATE TRUE                                                13440003
134500        WHEN SQLCODE = ZERO                                       13450003
134600            SET PS-RECITM-FOUND TO TRUE                           13460003
134700            IF PS-CICS-SWITCH-YES                                 13470003
134800                MOVE WST00001-INTR-TRIP-ID TO WS-DISPLAY-1        13480003
134900                MOVE RECITM-ORD-NBR        TO PV-DISPLAY-PO-NBR   13490003
135000                MOVE DK-REC-SEQ-RECITM     TO PV-DISPLAY-RCVR     13500003
135100                MOVE RECITM-ORD-LNE-NBR    TO PV-DISPLAY-LINE     13510003
135200                INITIALIZE PV-CICS-MSG-AREA                       13520003
135300                STRING   ' WSKCS309-3005:'                        13530003
135400                         ' INTR TRIP ID='                         13540003
135500                         WS-DISPLAY-1                             13550003
135600                         '   '                                    13560003
135700                         PV-DISPLAY-PO-NBR '-'                    13570003
135800                         PV-DISPLAY-RCVR   '-'                    13580003
135810                         PV-DISPLAY-LINE                          13581003
135820                         DELIMITED BY SIZE                        13582003
135830                                   INTO PV-CICS-MSG-AREA          13583003
135840                PERFORM 8000-WRITE-TO-CICS-LOG                    13584003
135850            END-IF                                                13585003
135860                                                                  13586003
135870* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            13587003
135880*       WHEN SQLCODE = -904                                       13588003
135890*       WHEN SQLCODE = -913                                       13589003
135900*       WHEN SQLCODE = -911                                       13590003
136000*           SET PS-RECITM-NOT-FOUND  TO TRUE                      13600003
136100*           CONTINUE                                              13610003
136200        WHEN SQLCODE = +100                                       13620003
136300            SET PS-RECITM-NOT-FOUND  TO TRUE                      13630003
136400            MOVE SQLCODE             TO WS007-SQLCODE             13640003
136500                                        PV-DISPLAY-SQLCODE        13650003
136600            MOVE RECITM-ORD-NBR      TO PV-DISPLAY-PO-NBR         13660003
136700            MOVE DK-REC-SEQ-RECITM   TO PV-DISPLAY-RCVR           13670003
136800            MOVE RECITM-ORD-LNE-NBR  TO PV-DISPLAY-LINE           13680003
136900            INITIALIZE PV-CICS-MSG-AREA                           13690003
137000            STRING   ' ' WS007-SRC-TASK-NUMBER                    13700003
137100                     ' WSKCS309-3005 ERROR:'                      13710003
137200                     ' RECITM NOT FOUND FOR'                      13720003
137300                     ' PO:' PV-DISPLAY-PO-NBR                     13730003
137400                     '-'    PV-DISPLAY-RCVR                       13740003
137500                     '-'    PV-DISPLAY-LINE                       13750003
137600                                        DELIMITED BY SIZE         13760003
137700                                   INTO PV-CICS-MSG-AREA          13770003
137800            PERFORM 8000-WRITE-TO-CICS-LOG                        13780003
137900                                                                  13790003
138000*           SET WS007-INVALID-SQL    TO TRUE                      13800003
138100            MOVE '3005-SELECT-RECITM-FIELDS '                     13810003
138200                                     TO WS007-SQL-ERROR-PARA      13820003
138300                                        DP013-PARAGRAPH           13830003
138400            MOVE SQLCA               TO WS007-SQLCA               13840003
138500                                        DP013-SQLCA               13850003
138600            MOVE 'RECITM NOT FOUND'                               13860003
138700                                     TO WS007-CRA-RET-MSG         13870003
138800                                        DP013-MESSAGE-TEXT (1)    13880003
138900            MOVE 'TRECITM '                                       13890003
139000                                     TO DP013-DB2-TABLE-NAME (1)  13900003
139100*           SET DP013-DB2-ABEND      TO TRUE                      13910003
139200*           PERFORM 9999-ABEND                                    13920003
139300        WHEN SQLWARN0 NOT = SPACES                                13930003
139400        WHEN SQLCODE NOT = ZERO                                   13940003
139500            MOVE SQLCODE             TO WS007-SQLCODE             13950003
139600                                        PV-DISPLAY-SQLCODE        13960003
139700            MOVE RECITM-ORD-NBR     TO PV-DISPLAY-PO-NBR          13970003
139800            MOVE DK-REC-SEQ-RECITM  TO PV-DISPLAY-RCVR            13980003
139900            MOVE RECITM-ORD-LNE-NBR TO PV-DISPLAY-LINE            13990003
140000            INITIALIZE PV-CICS-MSG-AREA                           14000003
140100            STRING   ' ' WS007-SRC-TASK-NUMBER                    14010003
140200                     ' WSKCS309-3005 ERROR:'                      14020003
140300                     ' SQL='                                      14030003
140400                     PV-DISPLAY-SQLCODE                           14040003
140500                     ' PO:' PV-DISPLAY-PO-NBR                     14050003
140600                     '-'    PV-DISPLAY-RCVR                       14060003
140700                     '-'    PV-DISPLAY-LINE                       14070003
140800                     DELIMITED BY SIZE                            14080003
140900                                   INTO PV-CICS-MSG-AREA          14090003
141000            PERFORM 8000-WRITE-TO-CICS-LOG                        14100003
141100                                                                  14110003
141200            SET WS007-INVALID-SQL    TO TRUE                      14120003
141300            MOVE '3005-SELECT-RECITM-FIELDS '                     14130003
141400                                     TO WS007-SQL-ERROR-PARA      14140003
141410                                        DP013-PARAGRAPH           14141003
141420            MOVE SQLCA               TO WS007-SQLCA               14142003
141430                                        DP013-SQLCA               14143003
141440            STRING 'SQL='                                         14144003
141450                 PV-DISPLAY-SQLCODE                               14145003
141460                     ' PO:' PV-DISPLAY-PO-NBR                     14146003
141470                     '-'    PV-DISPLAY-RCVR                       14147003
141480                     '-'    PV-DISPLAY-LINE                       14148003
141490                 DELIMITED BY SIZE                                14149003
141500                                   INTO WS007-CRA-RET-MSG         14150003
141600            MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)    14160003
141700            MOVE 'TRECITM '                                       14170003
141800                                     TO DP013-DB2-TABLE-NAME (1)  14180003
141900            SET DP013-DB2-ABEND      TO TRUE                      14190003
142000            PERFORM 9999-ABEND                                    14200003
142100     END-EVALUATE.                                                14210003
142200                                                                  14220003
142300                                                                  14230003
142400* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 14240003
142500* FOR PREPACK ORDER - CHECK TO SEE IF THE LINE BEING PROCESSED  * 14250003
142600* IS THE DRIVER LINE                                            * 14260003
142700* DMH 5/2/16                                                    * 14270003
142800* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 14280003
142900 3006-CHECK-IF-DRIVER-LINE.                                       14290003
143000                                                                  14300003
143100     IF PS-CICS-SWITCH-YES                                        14310003
143200          STRING  ' ' WS007-SRC-TASK-NUMBER                       14320003
143201                  ' WSKCS309-3006-CHECK-IF-DRIVER-LINE    '       14320103
143202                  DELIMITED BY SIZE                               14320203
143203            INTO  PV-CICS-MSG-AREA                                14320303
143204         PERFORM 8000-WRITE-TO-CICS-LOG                           14320403
143205     END-IF.                                                      14320503
143206                                                                  14320603
143207     MOVE  ZEROES  TO  PV-PREPK-DRIVER-LINE.                      14320703
143208                                                                  14320803
143209     EXEC SQL                                                     14320903
143210        SELECT  MIN(APP_PO_LNE_NBR)                               14321003
143211          INTO :PV-PREPK-DRIVER-LINE                              14321103
143212          FROM  TPURITM                                           14321203
143213         WHERE PO_NBR        = :RECITM-ORD-NBR                    14321303
143214           AND PO_PREPK_ID   = :RECITM-PREPK-ID                   14321403
143215         WITH UR                                                  14321503
143216     END-EXEC.                                                    14321603
143217                                                                  14321703
143218     EVALUATE TRUE                                                14321803
143219         WHEN SQLCODE = ZERO                                      14321903
143220              IF  RECITM-ORD-LNE-NBR  =  PV-PREPK-DRIVER-LINE     14322003
143230                  MOVE 'A'   TO  RECITM-PREPK-DRV-LNE-CDE         14323003
143240              END-IF                                              14324003
143250                                                                  14325003
143251        WHEN SQLCODE = +100                                       14325103
143252             MOVE ' '   TO  RECITM-PREPK-DRV-LNE-CDE              14325203
143253                                                                  14325303
143254        WHEN SQLWARN0 NOT = SPACES                                14325403
143255        WHEN SQLCODE NOT = ZERO                                   14325503
143256            MOVE SQLCODE             TO WS007-SQLCODE             14325603
143257                                        PV-DISPLAY-SQLCODE        14325703
143258            MOVE RECITM-ORD-NBR     TO PV-DISPLAY-PO-NBR          14325803
143259            MOVE DK-REC-SEQ-RECITM  TO PV-DISPLAY-RCVR            14325903
143260            MOVE RECITM-ORD-LNE-NBR TO PV-DISPLAY-LINE            14326003
143270            INITIALIZE PV-CICS-MSG-AREA                           14327003
143280            STRING   ' ' WS007-SRC-TASK-NUMBER                    14328003
143290                     ' WSKCS309-3006 ERROR:'                      14329003
143300                     ' SQL='                                      14330003
143310                     PV-DISPLAY-SQLCODE                           14331003
143320                     ' PO:' PV-DISPLAY-PO-NBR                     14332003
143321                     '-'    PV-DISPLAY-RCVR                       14332103
143322                     '-'    PV-DISPLAY-LINE                       14332203
143323                     DELIMITED BY SIZE                            14332303
143324                                   INTO PV-CICS-MSG-AREA          14332403
143325            PERFORM 8000-WRITE-TO-CICS-LOG                        14332503
143326                                                                  14332603
143327            SET WS007-INVALID-SQL    TO TRUE                      14332703
143328            MOVE '3006-CHECK-IF-DRIVER-LINE '                     14332803
143329                                     TO WS007-SQL-ERROR-PARA      14332903
143330                                        DP013-PARAGRAPH           14333003
143331            MOVE SQLCA               TO WS007-SQLCA               14333103
143332                                        DP013-SQLCA               14333203
143333            STRING 'SQL='                                         14333303
143334                 PV-DISPLAY-SQLCODE                               14333403
143335                     ' PO:' PV-DISPLAY-PO-NBR                     14333503
143336                     '-'    PV-DISPLAY-RCVR                       14333603
143337                     '-'    PV-DISPLAY-LINE                       14333703
143338                 DELIMITED BY SIZE                                14333803
143339                                   INTO WS007-CRA-RET-MSG         14333903
143340            MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)    14334003
143341            MOVE 'TRECITM '                                       14334103
143342                                     TO DP013-DB2-TABLE-NAME (1)  14334203
143343            SET DP013-DB2-ABEND      TO TRUE                      14334303
143344            PERFORM 9999-ABEND                                    14334403
143345     END-EVALUATE.                                                14334503
143346                                                                  14334603
143347                                                                  14334703
143348                                                                  14334803
143349                                                                  14334903
143350 3010-INSERT-RECDIS.                                              14335003
143351                                                                  14335103
143352     IF PS-CICS-SWITCH-YES                                        14335203
143353          STRING  ' ' WS007-SRC-TASK-NUMBER                       14335303
143354                  ' WSKCS309-3010-INSERT-RECDIS           '       14335403
143355                  DELIMITED BY SIZE                               14335503
143356            INTO  PV-CICS-MSG-AREA                                14335603
143357         PERFORM 8000-WRITE-TO-CICS-LOG                           14335703
143358     END-IF.                                                      14335803
143359                                                                  14335903
143360                                                                  14336003
143370     INITIALIZE DCLTRECDIS.                                       14337003
143380     MOVE WS014-PO-NUMBER          TO RECDIS-ORD-NBR.             14338003
143390     MOVE PURITM-APP-PO-LNE-NBR    TO RECDIS-ORD-LNE-NBR.         14339003
143400                                                                  14340003
143500     IF WS008-NEW-REC-SEQ-NBR > 0                                 14350003
143600        MOVE WS008-NEW-REC-SEQ-NBR TO RECDIS-REC-SEQ-NBR          14360003
143700     ELSE                                                         14370003
143710* SEPT 2009 - MARJ HOEFS - ADDED "IF" BELOW                       14371003
143720* IF RECV SEQ # IS NOT ON PIX, USE THE ONE CAPTURED IN PARA 1010. 14372003
143730*                                                                 14373003
143740* DMH 2016-06-09                                                  14374003
143750* USE PV-OTBND-CART-RCVR-SEQ-NBR THE ONE CAPTURED IN PARA 1010.   14375003
143760* THIS IS THE RECEIVER THE CARTON IS ATTACHED TO                  14376003
143770        IF WS014-REC-SEQ-NUMBER > 0  AND                          14377003
143780           PV-OTBND-CART-RCVR-SEQ-NBR  > 0                        14378003
143790            MOVE PV-OTBND-CART-RCVR-SEQ-NBR TO RECDIS-REC-SEQ-NBR 14379003
143800        ELSE                                                      14380003
143900        IF WS014-REC-SEQ-NUMBER > 0                               14390003
144000            MOVE WS014-REC-SEQ-NUMBER       TO RECDIS-REC-SEQ-NBR 14400003
144100        ELSE                                                      14410003
144200            MOVE PV-OTBND-CART-RCVR-SEQ-NBR TO RECDIS-REC-SEQ-NBR 14420003
144300        END-IF                                                    14430003
144310        END-IF                                                    14431003
144320     END-IF.                                                      14432003
144330     MOVE WS014-DC-LOCATION        TO RECDIS-OPER-UNT-ID.         14433003
144340     MOVE 1                        TO RECDIS-FCLTY-ID.            14434003
144350     MOVE WS014-CRE-TMST           TO RECDIS-CRE-TMST.            14435003
144360     MOVE WS014-CRE-USER-ID        TO RECDIS-CRE-UID.             14436003
144370     MOVE 'A'                      TO RECDIS-VER-STATUS-CDE.      14437003
144380     MOVE WS014-SKU-QTY            TO RECDIS-EXPTED-ITM-QTY.      14438003
144390     MOVE 0                        TO RECDIS-VERIFY-ITM-QTY.      14439003
144400     MOVE 0                        TO RECDIS-AP-VERIFY-ITM-QTY.   14440003
144500     MOVE WS014-STORE-NUMBER       TO RECDIS-STR-NBR.             14450003
144600     MOVE 1                        TO RECDIS-STR-FCLTY-ID.        14460003
144700     MOVE 0                        TO RECDIS-PLAN-ITM-QTY.        14470003
144800     MOVE SPACE                    TO RECDIS-AP-PRC-CDE.          14480003
144900     MOVE PC-DEFAULT-DATE          TO RECDIS-AP-PRC-DTE.          14490003
145000                                                                  14500003
145100     EXEC SQL                                                     14510003
145200          INSERT INTO TRECDIS                                     14520003
145300              (ORD_NBR                                            14530003
145400             , ORD_LNE_NBR                                        14540003
145500             , REC_SEQ_NBR                                        14550003
145600             , OPER_UNT_ID                                        14560003
145700             , FCLTY_ID                                           14570003
145800             , CRE_TMST                                           14580003
145900             , CRE_UID                                            14590003
146000             , VER_STATUS_CDE                                     14600003
146100             , EXPTED_ITM_QTY                                     14610003
146200             , VERIFY_ITM_QTY                                     14620003
146300             , AP_VERIFY_ITM_QTY                                  14630003
146400             , STR_NBR                                            14640003
146500             , STR_FCLTY_ID                                       14650003
146600             , PLAN_ITM_QTY                                       14660003
146700             , AP_PRC_CDE                                         14670003
146800             , AP_PRC_DTE)                                        14680003
146900          VALUES (                                                14690003
147000               :RECDIS-ORD-NBR                                    14700003
147100             , :RECDIS-ORD-LNE-NBR                                14710003
147200             , :RECDIS-REC-SEQ-NBR                                14720003
147300             , :RECDIS-OPER-UNT-ID                                14730003
147400             , :RECDIS-FCLTY-ID                                   14740003
147500             , :RECDIS-CRE-TMST                                   14750003
147600             , :RECDIS-CRE-UID                                    14760003
147700             , :RECDIS-VER-STATUS-CDE                             14770003
147800             , :RECDIS-EXPTED-ITM-QTY                             14780003
147900             , :RECDIS-VERIFY-ITM-QTY                             14790003
148000             , :RECDIS-AP-VERIFY-ITM-QTY                          14800003
148100             , :RECDIS-STR-NBR                                    14810003
148200             , :RECDIS-STR-FCLTY-ID                               14820003
148300             , :RECDIS-PLAN-ITM-QTY                               14830003
148400             , :RECDIS-AP-PRC-CDE                                 14840003
148500             , :RECDIS-AP-PRC-DTE)                                14850003
148600     END-EXEC.                                                    14860003
148700                                                                  14870003
148800     EVALUATE TRUE                                                14880003
148900         WHEN SQLCODE = ZERO                                      14890003
149000         WHEN SQLCODE = -803                                      14900003
149100             IF PS-CICS-SWITCH-YES                                14910003
149200                 MOVE WS014-PO-NUMBER    TO WS-DISPLAY-1          14920003
149300                 MOVE WS014-PO-NUMBER    TO PV-DISPLAY-PO-NBR     14930003
149400                 MOVE RECITM-ORD-LNE-NBR TO PV-DISPLAY-LINE       14940003
149500                 MOVE RECITM-REC-SEQ-NBR TO PV-DISPLAY-RCVR       14950003
149600                 INITIALIZE PV-CICS-MSG-AREA                      14960003
149700                 STRING   ' WSKCS309-3010:'                       14970003
149800                          ' INSERT TO TRECDIS'                    14980003
149900                          ' PO: ' PV-DISPLAY-PO-NBR               14990003
150000                          '-'     PV-DISPLAY-RCVR                 15000003
150100                          '-'     PV-DISPLAY-LINE                 15010003
150200                          DELIMITED BY SIZE                       15020003
150300                                       INTO PV-CICS-MSG-AREA      15030003
150400                 PERFORM 8000-WRITE-TO-CICS-LOG                   15040003
150500             END-IF                                               15050003
150600* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            15060003
150700*        WHEN SQLCODE = -904                                      15070003
150800*        WHEN SQLCODE = -913                                      15080003
150900*        WHEN SQLCODE = -911                                      15090003
151000*             CONTINUE                                            15100003
151100         WHEN SQLWARN0 NOT = SPACES                               15110003
151200         WHEN SQLCODE NOT = ZERO                                  15120003
151300             MOVE SQLCODE             TO WS007-SQLCODE            15130003
151400                                         PV-DISPLAY-SQLCODE       15140003
151500             MOVE WS014-PO-NUMBER     TO PV-DISPLAY-PO-NBR        15150003
151600             MOVE RECITM-ORD-LNE-NBR  TO PV-DISPLAY-LINE          15160003
151700             MOVE RECITM-REC-SEQ-NBR  TO PV-DISPLAY-RCVR          15170003
151800             INITIALIZE PV-CICS-MSG-AREA                          15180003
151900             STRING   ' ' WS007-SRC-TASK-NUMBER                   15190003
152000                      ' WSKCS309-3010 ERROR:'                     15200003
152100                      ' SQL='                                     15210003
152200                      PV-DISPLAY-SQLCODE                          15220003
152300                      ' PO: ' PV-DISPLAY-PO-NBR                   15230003
152400                      '-'     PV-DISPLAY-RCVR                     15240003
152500                      '-'     PV-DISPLAY-LINE                     15250003
152600                      DELIMITED BY SIZE                           15260003
152700                                   INTO PV-CICS-MSG-AREA          15270003
152800             PERFORM 8000-WRITE-TO-CICS-LOG                       15280003
152900                                                                  15290003
153000             SET WS007-INVALID-SQL    TO TRUE                     15300003
153100             MOVE '3010-INSERT-RECDIS'                            15310003
153200                                      TO WS007-SQL-ERROR-PARA     15320003
153300                                         DP013-PARAGRAPH          15330003
153400             MOVE SQLCA               TO WS007-SQLCA              15340003
153500                                         DP013-SQLCA              15350003
153600             STRING 'SQL='                                        15360003
153700                  PV-DISPLAY-SQLCODE                              15370003
153800                  DELIMITED BY SIZE                               15380003
153900                                    INTO WS007-CRA-RET-MSG        15390003
154000             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   15400003
154100             MOVE 'TRECITM'           TO                          15410003
154200                                       DP013-DB2-TABLE-NAME (1)   15420003
154300             SET DP013-DB2-ABEND      TO TRUE                     15430003
154400             PERFORM 9999-ABEND                                   15440003
154500     END-EVALUATE.                                                15450003
154600                                                                  15460003
154700/                                                                 15470003
154800 4000-OTBND-INSERT.                                               15480003
154900                                                                  15490003
155000     IF PS-CICS-SWITCH-YES                                        15500003
155100          STRING  ' ' WS007-SRC-TASK-NUMBER                       15510003
155200                  ' WSKCS309-4000-OTBND-INSERT            '       15520003
155300                  DELIMITED BY SIZE                               15530003
155400            INTO  PV-CICS-MSG-AREA                                15540003
155500         PERFORM 8000-WRITE-TO-CICS-LOG                           15550003
155600     END-IF.                                                      15560003
155700                                                                  15570003
155800                                                                  15580003
155900     IF PS-OTBND-CART-EXISTS-NO                                   15590003
156000          MOVE WS014-RCVD-SHPMT-NBR   TO DK-EXT-SHP-ID            15600003
156100          PERFORM 4005-FORMAT-SML                                 15610003
156200          PERFORM 4110-INS-OTBND-CART                             15620003
156300          PERFORM 4120-INS-OTBND-UPC                              15630003
156400          PERFORM 4130-INS-OTBND-LOC                              15640003
156500     ELSE                                                         15650003
156600          PERFORM 4120-INS-OTBND-UPC                              15660003
156700     END-IF.                                                      15670003
156800                                                                  15680003
156900                                                                  15690003
157000/                                                                 15700003
157100 4005-FORMAT-SML.                                                 15710003
157200                                                                  15720003
157300     IF PS-CICS-SWITCH-YES                                        15730003
157400          STRING  ' ' WS007-SRC-TASK-NUMBER                       15740003
157500                  ' WSKCS309-4005-FORMAT-SML              '       15750003
157600                  DELIMITED BY SIZE                               15760003
157700            INTO  PV-CICS-MSG-AREA                                15770003
157800         PERFORM 8000-WRITE-TO-CICS-LOG                           15780003
157810     END-IF.                                                      15781003
157820                                                                  15782003
157830                                                                  15783003
157840* GET START MANIFEST NUMBER FOR EACH ENTRY IN TABLE              *15784003
157850                                                                  15785003
157860     PERFORM 4010-MANIFEST-NBR.                                   15786003
157870                                                                  15787003
157880*================================================================*15788003
157890* GET MANIFEST NUMBER                                            *15789003
157900*================================================================*15790003
158000 4010-MANIFEST-NBR.                                               15800003
158100                                                                  15810003
158200     IF PS-CICS-SWITCH-YES                                        15820003
158300          STRING  ' ' WS007-SRC-TASK-NUMBER                       15830003
158400                  ' WSKCS309-4010-MANIFEST-NBR            '       15840003
158500                  DELIMITED BY SIZE                               15850003
158600            INTO  PV-CICS-MSG-AREA                                15860003
158700         PERFORM 8000-WRITE-TO-CICS-LOG                           15870003
158800     END-IF.                                                      15880003
158900                                                                  15890003
159000                                                                  15900003
159100     MOVE  WS014-STORE-NUMBER    TO  DK-STR-NBR.                  15910003
159200                                                                  15920003
159210     PERFORM 4020-OPEN-DCSTMF-CSR.                                15921003
159220     PERFORM 4030-FETCH-DCSTMF-CSR.                               15922003
159230                                                                  15923003
159240     IF DCSTMF-MFST-NBR > 90000000                                15924003
159250        INITIALIZE DCSTMF-MFST-NBR                                15925003
159260        MOVE +1                  TO DCSTMF-MFST-NBR               15926003
159270     END-IF.                                                      15927003
159280     ADD  +1                     TO DCSTMF-MFST-NBR.              15928003
159290                                                                  15929003
159300     PERFORM 4040-UPDATE-DCSTMF.                                  15930003
159400                                                                  15940003
159500     PERFORM 4050-CLOSE-DCSTMF-CSR.                               15950003
159600     MOVE  DCSTMF-MFST-NBR       TO PV-SML-MNFST-NBR.             15960003
159700     MOVE  WS014-DC-LOCATION     TO PV-DC-ORIGIN.                 15970003
159800     MOVE  PV-DC-ORIGIN-3        TO PV-SML-DC-ORIGIN.             15980003
159900     MOVE  ZERO                  TO PV-SML-DIVERT-PFX.            15990003
160000     MOVE  WS014-STORE-NUMBER    TO PV-SML-DIVERT-CDE.            16000003
160100     SET   PV-SML-INTERNAL-LBL                                    16010003
160200           PV-SML-FROM-KOHLS     TO TRUE.                         16020003
160300                                                                  16030003
160400 4020-OPEN-DCSTMF-CSR.                                            16040003
160500                                                                  16050003
160600     IF PS-CICS-SWITCH-YES                                        16060003
160700          STRING  ' ' WS007-SRC-TASK-NUMBER                       16070003
160800                  ' WSKCS309-4020-OPEN-DCSTMF-CSR         '       16080003
160900                  DELIMITED BY SIZE                               16090003
161000            INTO  PV-CICS-MSG-AREA                                16100003
161100         PERFORM 8000-WRITE-TO-CICS-LOG                           16110003
161200     END-IF.                                                      16120003
161300                                                                  16130003
161400                                                                  16140003
161500     EXEC SQL                                                     16150003
161600         OPEN DCSTMF_CSR                                          16160003
161700     END-EXEC.                                                    16170003
161800                                                                  16180003
161810     EVALUATE TRUE                                                16181003
161820         WHEN SQLCODE = ZERO                                      16182003
161830             CONTINUE                                             16183003
161840         WHEN SQLWARN0 NOT = SPACES                               16184003
161850         WHEN SQLCODE < ZERO                                      16185003
161860         WHEN SQLCODE > ZERO                                      16186003
161870             MOVE SQLCODE             TO WS007-SQLCODE            16187003
161880                                         PV-DISPLAY-SQLCODE       16188003
161890             MOVE DK-STR-NBR          TO PV-DISPLAY-STORE         16189003
161900             INITIALIZE PV-CICS-MSG-AREA                          16190003
162000             STRING   ' ' WS007-SRC-TASK-NUMBER                   16200003
162100                      ' WSKCS309-4020 ERROR:'                     16210003
162200                      ' SQL='                                     16220003
162300                      PV-DISPLAY-SQLCODE                          16230003
162400                      ' STORE:'  PV-DISPLAY-STORE                 16240003
162500                      DELIMITED BY SIZE                           16250003
162600                                   INTO PV-CICS-MSG-AREA          16260003
162700             PERFORM 8000-WRITE-TO-CICS-LOG                       16270003
162800                                                                  16280003
162900             SET WS007-INVALID-SQL    TO TRUE                     16290003
163000             MOVE '4020-OPEN-DCSTMF-CSR'                          16300003
163100                                      TO WS007-SQL-ERROR-PARA     16310003
163200                                         DP013-PARAGRAPH          16320003
163300             MOVE SQLCA               TO WS007-SQLCA              16330003
163400                                         DP013-SQLCA              16340003
163500             STRING 'SQL='                                        16350003
163600                  PV-DISPLAY-SQLCODE                              16360003
163610                  DELIMITED BY SIZE                               16361003
163620                                    INTO WS007-CRA-RET-MSG        16362003
163630             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   16363003
163640             MOVE 'TRECITM'           TO                          16364003
163650                                       DP013-DB2-TABLE-NAME (1)   16365003
163660             SET DP013-DB2-ABEND      TO TRUE                     16366003
163670             PERFORM 9999-ABEND                                   16367003
163680     END-EVALUATE.                                                16368003
163690                                                                  16369003
163700 4030-FETCH-DCSTMF-CSR.                                           16370003
163800                                                                  16380003
163900     IF PS-CICS-SWITCH-YES                                        16390003
164000          STRING  ' ' WS007-SRC-TASK-NUMBER                       16400003
164100                  ' WSKCS309-4030-FETCH-DCSTMF-CSR        '       16410003
164200                  DELIMITED BY SIZE                               16420003
164300            INTO  PV-CICS-MSG-AREA                                16430003
164400         PERFORM 8000-WRITE-TO-CICS-LOG                           16440003
164500     END-IF.                                                      16450003
164600                                                                  16460003
164700                                                                  16470003
164800     EXEC SQL                                                     16480003
164900         FETCH DCSTMF_CSR                                         16490003
165000          INTO :DCSTMF-MFST-NBR                                   16500003
165100     END-EXEC.                                                    16510003
165200                                                                  16520003
165300     EVALUATE TRUE                                                16530003
165400         WHEN SQLCODE = ZERO                                      16540003
165500         WHEN SQLCODE = +100                                      16550003
165600             CONTINUE                                             16560003
165700         WHEN SQLWARN0 NOT = SPACES                               16570003
165800         WHEN SQLCODE < ZERO                                      16580003
165900         WHEN SQLCODE > ZERO                                      16590003
166000             MOVE SQLCODE             TO WS007-SQLCODE            16600003
166100                                         PV-DISPLAY-SQLCODE       16610003
166200             MOVE DK-STR-NBR          TO PV-DISPLAY-STORE         16620003
166300             INITIALIZE PV-CICS-MSG-AREA                          16630003
166400             STRING   ' ' WS007-SRC-TASK-NUMBER                   16640003
166500                      ' WSKCS309-4030 ERROR:'                     16650003
166510                      ' SQL='                                     16651003
166520                      PV-DISPLAY-SQLCODE                          16652003
166530                      'STORE:'  PV-DISPLAY-STORE                  16653003
166540                      DELIMITED BY SIZE                           16654003
166550                                    INTO PV-CICS-MSG-AREA         16655003
166560             PERFORM 8000-WRITE-TO-CICS-LOG                       16656003
166570                                                                  16657003
166580             SET WS007-INVALID-SQL    TO TRUE                     16658003
166590             MOVE '4030-FETCH-DCSTMF-CSR'                         16659003
166600                                      TO WS007-SQL-ERROR-PARA     16660003
166700                                         DP013-PARAGRAPH          16670003
166800             MOVE SQLCA               TO WS007-SQLCA              16680003
166900                                         DP013-SQLCA              16690003
167000             STRING 'SQL='                                        16700003
167100                  PV-DISPLAY-SQLCODE                              16710003
167200                  DELIMITED BY SIZE                               16720003
167300                                    INTO WS007-CRA-RET-MSG        16730003
167400             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   16740003
167500             MOVE 'TDCSTMF'           TO                          16750003
167600                                       DP013-DB2-TABLE-NAME (1)   16760003
167700             SET DP013-DB2-ABEND      TO TRUE                     16770003
167800             PERFORM 9999-ABEND                                   16780003
167900                                                                  16790003
168000     END-EVALUATE.                                                16800003
168100                                                                  16810003
168200                                                                  16820003
168300 4040-UPDATE-DCSTMF.                                              16830003
168400                                                                  16840003
168500     IF PS-CICS-SWITCH-YES                                        16850003
168600          STRING  ' ' WS007-SRC-TASK-NUMBER                       16860003
168700                  ' WSKCS309-4040-UPDATE-DCSTMF           '       16870003
168800                  DELIMITED BY SIZE                               16880003
168900            INTO  PV-CICS-MSG-AREA                                16890003
169000         PERFORM 8000-WRITE-TO-CICS-LOG                           16900003
169100     END-IF.                                                      16910003
169200                                                                  16920003
169300                                                                  16930003
169400     EXEC SQL                                                     16940003
169500          UPDATE TDCSTMF                                          16950003
169600             SET MFST_NBR   = :DCSTMF-MFST-NBR                    16960003
169700           WHERE CURRENT OF DCSTMF_CSR                            16970003
169800     END-EXEC.                                                    16980003
169900                                                                  16990003
170000     EVALUATE TRUE                                                17000003
170100         WHEN SQLCODE = ZERO                                      17010003
170200         WHEN SQLCODE = +100                                      17020003
170300             CONTINUE                                             17030003
170400         WHEN SQLWARN0 NOT = SPACES                               17040003
170500         WHEN SQLCODE < ZERO                                      17050003
170600         WHEN SQLCODE > ZERO                                      17060003
170700             MOVE SQLCODE             TO WS007-SQLCODE            17070003
170800                                         PV-DISPLAY-SQLCODE       17080003
170900             MOVE DK-STR-NBR          TO PV-DISPLAY-STORE         17090003
170910             INITIALIZE PV-CICS-MSG-AREA                          17091003
170920             STRING   ' ' WS007-SRC-TASK-NUMBER                   17092003
170930                      ' WSKCS309-4040 ERROR:'                     17093003
170940                      ' SQL='                                     17094003
170950                      PV-DISPLAY-SQLCODE                          17095003
170960                      'STORE:'  PV-DISPLAY-STORE                  17096003
170970                      DELIMITED BY SIZE                           17097003
170980                                   INTO PV-CICS-MSG-AREA          17098003
170990             PERFORM 8000-WRITE-TO-CICS-LOG                       17099003
171000                                                                  17100003
171100             SET WS007-INVALID-SQL    TO TRUE                     17110003
171200             MOVE '4040-UPDATE-DCSTMF'                            17120003
171300                                      TO WS007-SQL-ERROR-PARA     17130003
171400                                         DP013-PARAGRAPH          17140003
171500             MOVE SQLCA               TO WS007-SQLCA              17150003
171600                                         DP013-SQLCA              17160003
171700             STRING 'SQL='                                        17170003
171800                  PV-DISPLAY-SQLCODE                              17180003
171900                  DELIMITED BY SIZE                               17190003
172000                                    INTO WS007-CRA-RET-MSG        17200003
172100             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   17210003
172200             MOVE 'TDCSTMF'           TO                          17220003
172300                                       DP013-DB2-TABLE-NAME (1)   17230003
172400             SET DP013-DB2-ABEND      TO TRUE                     17240003
172500             PERFORM 9999-ABEND                                   17250003
172600                                                                  17260003
172700     END-EVALUATE.                                                17270003
172800                                                                  17280003
172900                                                                  17290003
173000 4050-CLOSE-DCSTMF-CSR.                                           17300003
173100                                                                  17310003
173200     IF PS-CICS-SWITCH-YES                                        17320003
173300          STRING  ' ' WS007-SRC-TASK-NUMBER                       17330003
173400                  ' WSKCS309-4050-CLOSE-DCSTMF-CSR        '       17340003
173500                  DELIMITED BY SIZE                               17350003
173600            INTO  PV-CICS-MSG-AREA                                17360003
173700         PERFORM 8000-WRITE-TO-CICS-LOG                           17370003
173800     END-IF.                                                      17380003
173900                                                                  17390003
174000                                                                  17400003
174100     EXEC SQL                                                     17410003
174200        CLOSE DCSTMF_CSR                                          17420003
174300     END-EXEC.                                                    17430003
174310                                                                  17431003
174320     EVALUATE TRUE                                                17432003
174330         WHEN SQLCODE = ZERO                                      17433003
174340             CONTINUE                                             17434003
174350         WHEN SQLWARN0 NOT = SPACES                               17435003
174360         WHEN SQLCODE < ZERO                                      17436003
174370         WHEN SQLCODE > ZERO                                      17437003
174380             MOVE SQLCODE             TO WS007-SQLCODE            17438003
174390                                         PV-DISPLAY-SQLCODE       17439003
174400             MOVE DK-STR-NBR          TO PV-DISPLAY-STORE         17440003
174500             INITIALIZE PV-CICS-MSG-AREA                          17450003
174600             STRING   ' ' WS007-SRC-TASK-NUMBER                   17460003
174700                      ' WSKCS309-4050 ERROR:'                     17470003
174800                      ' SQL='                                     17480003
174900                      PV-DISPLAY-SQLCODE                          17490003
175000                      'STORE:'  PV-DISPLAY-STORE                  17500003
175100                      DELIMITED BY SIZE                           17510003
175200                                   INTO PV-CICS-MSG-AREA          17520003
175300             PERFORM 8000-WRITE-TO-CICS-LOG                       17530003
175400                                                                  17540003
175500             SET WS007-INVALID-SQL    TO TRUE                     17550003
175600             MOVE '4050-CLOSE-DCSTMF-CSR'                         17560003
175610                                      TO WS007-SQL-ERROR-PARA     17561003
175620                                         DP013-PARAGRAPH          17562003
175630             MOVE SQLCA               TO WS007-SQLCA              17563003
175640                                         DP013-SQLCA              17564003
175650             STRING 'SQL='                                        17565003
175660                  PV-DISPLAY-SQLCODE                              17566003
175670                  DELIMITED BY SIZE                               17567003
175680                                    INTO WS007-CRA-RET-MSG        17568003
175690             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   17569003
175700             SET DP013-DB2-ABEND      TO TRUE                     17570003
175800             PERFORM 9999-ABEND                                   17580003
175900                                                                  17590003
176000     END-EVALUATE.                                                17600003
176100                                                                  17610003
176200                                                                  17620003
176300/                                                                 17630003
176400 4110-INS-OTBND-CART.                                             17640003
176500                                                                  17650003
176600     IF PS-CICS-SWITCH-YES                                        17660003
176700          STRING  ' ' WS007-SRC-TASK-NUMBER                       17670003
176800                  ' WSKCS309-4110-INS-OTBND-CART          '       17680003
176900                  DELIMITED BY SIZE                               17690003
177000            INTO  PV-CICS-MSG-AREA                                17700003
177100         PERFORM 8000-WRITE-TO-CICS-LOG                           17710003
177200     END-IF.                                                      17720003
177300                                                                  17730003
177400                                                                  17740003
177500     INITIALIZE DCLSUT00024.                                      17750003
177600     MOVE PV-SML-BARCODE        TO SUT00024-SHIPT-UNT-ID.         17760003
177700     MOVE WS014-DC-LOCATION     TO SUT00024-ORGN-LOC-NBR.         17770003
177800     MOVE WS014-STORE-NUMBER    TO SUT00024-DEST-LOC-NBR.         17780003
177900     MOVE WS-CART-SRC-CDE       TO SUT00024-CART-SRC-CDE.         17790003
178000     MOVE WS014-CRE-TMST        TO WS-DATE-TIME.                  17800003
178100     MOVE WS-DATE-OUT           TO SUT00024-CRE-DTE.              17810003
178200     MOVE WS-TIME-OUT           TO SUT00024-CRE-TM.               17820003
178300     MOVE WS014-CRE-USER-ID     TO SUT00024-CRE-USR-ID.           17830003
178400     MOVE 'WSKCS309'            TO SUT00024-CRE-PGM-NM.           17840003
178410     MOVE 'N'                   TO SUT00024-MSTR-CART-IND.        17841003
178420     MOVE PV-SML-BARCODE        TO SUT00024-PRNT-CART-ID.         17842003
178430     MOVE WS-CASE-NBR           TO SUT00024-ORIG-CART-ID.         17843003
178440     MOVE 'S'                   TO SUT00024-CART-TYP-CDE.         17844003
178450     MOVE 0                     TO SUT00024-LBL-PRT-SEQ-NBR.      17845003
178460     MOVE 0                     TO SUT00024-CART-RVSN-NBR.        17846003
178470     MOVE 'Y'                   TO SUT00024-ACTV-IND.             17847003
178480     MOVE 'N'                   TO SUT00024-ODD-UNT-IND.          17848003
178490     MOVE 'N'                   TO SUT00024-EAS-TAG-IND.          17849003
178500                                                                  17850003
178600     EXEC SQL                                                     17860003
178700          INSERT INTO SUT_OTBND_CART                              17870003
178800              (SHIPT_UNT_ID                                       17880003
178900             , ORGN_LOC_NBR                                       17890003
179000             , DEST_LOC_NBR                                       17900003
179100             , CART_SRC_CDE                                       17910003
179200             , CRE_DTE                                            17920003
179300             , CRE_TM                                             17930003
179400             , CRE_USR_ID                                         17940003
179500             , CRE_PGM_NM                                         17950003
179600             , MSTR_CART_IND                                      17960003
179700             , PRNT_CART_ID                                       17970003
179800             , ORIG_CART_ID                                       17980003
179900             , CART_TYP_CDE                                       17990003
180000             , LBL_PRT_SEQ_NBR                                    18000003
180100             , CART_RVSN_NBR                                      18010003
180200             , OTBND_TRIP_ID                                      18020003
180300             , ACTV_IND                                           18030003
180400             , ODD_UNT_IND                                        18040003
180500             , EAS_TAG_IND)                                       18050003
180600          VALUES(                                                 18060003
180700               :SUT00024-SHIPT-UNT-ID                             18070003
180800             , :SUT00024-ORGN-LOC-NBR                             18080003
180900             , :SUT00024-DEST-LOC-NBR                             18090003
181000             , :SUT00024-CART-SRC-CDE                             18100003
181100             , CURRENT DATE                                       18110003
181200             , CURRENT TIME                                       18120003
181300             , :SUT00024-CRE-USR-ID                               18130003
181400             , :SUT00024-CRE-PGM-NM                               18140003
181500             , :SUT00024-MSTR-CART-IND                            18150003
181600             , :SUT00024-PRNT-CART-ID                             18160003
181700             , :SUT00024-ORIG-CART-ID                             18170003
181800             , :SUT00024-CART-TYP-CDE                             18180003
181900             , :SUT00024-LBL-PRT-SEQ-NBR                          18190003
182000             , :SUT00024-CART-RVSN-NBR                            18200003
182100             , NULL                                               18210003
182200             , :SUT00024-ACTV-IND                                 18220003
182300             , :SUT00024-ODD-UNT-IND                              18230003
182400             , :SUT00024-EAS-TAG-IND)                             18240003
182500     END-EXEC.                                                    18250003
182600                                                                  18260003
182700     EVALUATE TRUE                                                18270003
182800         WHEN SQLCODE = ZERO                                      18280003
182900             IF PS-CICS-SWITCH-YES                                18290003
183000                 MOVE WS014-RCVD-SHPMT-NBR  TO WS-DISPLAY-1       18300003
183100                 MOVE SUT00024-SHIPT-UNT-ID TO WS-DISPLAY-CRTN    18310003
183200                 INITIALIZE PV-CICS-MSG-AREA                      18320003
183300                 STRING   ' WSKCS309-4110:'                       18330003
183400                          ' INSERT TO SUT_OTBND_CART FOR '        18340003
183500                          'SHPMT=' WS-DISPLAY-1                   18350003
183600                          DELIMITED BY SIZE                       18360003
183700                          ' CRTN =' WS-DISPLAY-CRTN               18370003
183800                          DELIMITED BY SIZE                       18380003
183900                          INTO PV-CICS-MSG-AREA                   18390003
184000                 PERFORM 8000-WRITE-TO-CICS-LOG                   18400003
184100             END-IF                                               18410003
184200* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            18420003
184300*        WHEN SQLCODE = -904                                      18430003
184400*        WHEN SQLCODE = -913                                      18440003
184500*        WHEN SQLCODE = -911                                      18450003
184600*            CONTINUE                                             18460003
184700         WHEN SQLWARN0 NOT = SPACES                               18470003
184800         WHEN SQLCODE NOT = ZERO                                  18480003
184900             MOVE SQLCODE             TO WS007-SQLCODE            18490003
185000                                         PV-DISPLAY-SQLCODE       18500003
185100             MOVE WS014-RCVD-SHPMT-NBR  TO WS-DISPLAY-1           18510003
185200             MOVE SUT00024-SHIPT-UNT-ID TO WS-DISPLAY-CRTN        18520003
185300             INITIALIZE PV-CICS-MSG-AREA                          18530003
185400             STRING   ' ' WS007-SRC-TASK-NUMBER                   18540003
185500                      ' WSKCS309-4110 ERROR:'                     18550003
185600                      ' SQL='                                     18560003
185700                      PV-DISPLAY-SQLCODE                          18570003
185800                      ' SHPMT=' WS-DISPLAY-1                      18580003
185900                      ' CRTN =' WS-DISPLAY-CRTN                   18590003
186000                      DELIMITED BY SIZE                           18600003
186100                                   INTO PV-CICS-MSG-AREA          18610003
186200             PERFORM 8000-WRITE-TO-CICS-LOG                       18620003
186300                                                                  18630003
186400             SET WS007-INVALID-SQL    TO TRUE                     18640003
186500             MOVE '4110-INS-OTBND-CART'                           18650003
186600                                      TO WS007-SQL-ERROR-PARA     18660003
186700                                         DP013-PARAGRAPH          18670003
186800             MOVE SQLCA               TO WS007-SQLCA              18680003
186900                                         DP013-SQLCA              18690003
187000             STRING 'SQL='                                        18700003
187100                  PV-DISPLAY-SQLCODE                              18710003
187200                  DELIMITED BY SIZE                               18720003
187300                                    INTO WS007-CRA-RET-MSG        18730003
187400             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   18740003
187500             MOVE 'SUT_OTBND_CART'    TO                          18750003
187600                                       DP013-DB2-TABLE-NAME (1)   18760003
187700             SET DP013-DB2-ABEND      TO TRUE                     18770003
187800             PERFORM 9999-ABEND                                   18780003
187900     END-EVALUATE.                                                18790003
188000                                                                  18800003
188100/                                                                 18810003
188200 4120-INS-OTBND-UPC.                                              18820003
188300                                                                  18830003
188400     IF PS-CICS-SWITCH-YES                                        18840003
188500          STRING  ' ' WS007-SRC-TASK-NUMBER                       18850003
188600                  ' WSKCS309-4120-INS-OTBND-UPC           '       18860003
188700                  DELIMITED BY SIZE                               18870003
188800            INTO  PV-CICS-MSG-AREA                                18880003
188900         PERFORM 8000-WRITE-TO-CICS-LOG                           18890003
189000     END-IF.                                                      18900003
189100                                                                  18910003
189200     INITIALIZE DCLSUT00028.                                      18920003
189300     MOVE PV-SML-BARCODE         TO SUT00028-SHIPT-UNT-ID.        18930003
189400     MOVE WS014-PO-NUMBER        TO SUT00028-TRN-NBR.             18940003
189500     IF WS008-NEW-REC-SEQ-NBR    > 0                              18950003
189600        MOVE WS008-NEW-REC-SEQ-NBR  TO SUT00028-RCVR-SEQ-NBR      18960003
189700     ELSE                                                         18970003
189800* SEPT 2009 - MARJ HOEFS - ADDED "IF" BELOW                       18980003
189900* IF RECV SEQ # IS NOT ON PIX, USE THE ONE CAPTURED IN PARA 1010. 18990003
190000*                                                                 19000003
190100* DMH 2016-06-09                                                  19010003
190200* USE PV-OTBND-CART-RCVR-SEQ-NBR THE ONE CAPTURED IN PARA 1010.   19020003
190300* THIS IS THE RECEIVER THE CARTON IS ATTACHED TO                  19030003
190400        IF WS014-REC-SEQ-NUMBER > 0  AND                          19040003
190500           PV-OTBND-CART-RCVR-SEQ-NBR  > 0                        19050003
190600            MOVE PV-OTBND-CART-RCVR-SEQ-NBR                       19060003
190700                                        TO SUT00028-RCVR-SEQ-NBR  19070003
190800        ELSE                                                      19080003
190900        IF WS014-REC-SEQ-NUMBER > 0                               19090003
191000            MOVE WS014-REC-SEQ-NUMBER   TO SUT00028-RCVR-SEQ-NBR  19100003
191100        ELSE                                                      19110003
191200            MOVE PV-OTBND-CART-RCVR-SEQ-NBR                       19120003
191210                                        TO SUT00028-RCVR-SEQ-NBR  19121003
191220        END-IF                                                    19122003
191230        END-IF                                                    19123003
191240     END-IF.                                                      19124003
191250                                                                  19125003
191260*  DMH ADDED CHECK FOR ZEROES - 9/27/2007                         19126003
191270     IF  WS-TRN-LNE-NBR  >  0                                     19127003
191280         MOVE WS-TRN-LNE-NBR     TO SUT00028-TRN-LNE-NBR          19128003
191290     ELSE                                                         19129003
191300         MOVE RECITM-ORD-LNE-NBR TO SUT00028-TRN-LNE-NBR          19130003
191400     END-IF.                                                      19140003
191500                                                                  19150003
191600     IF PS-CICS-SWITCH-YES                                        19160003
191700         INITIALIZE  PV-CICS-MSG-AREA                             19170003
191800         MOVE  SUT00028-TRN-LNE-NBR  TO  PV-DISPLAY-LINE          19180003
191900         MOVE  WS-UPC-NBR            TO  PV-DISPLAY-UPC           19190003
192000          STRING  ' ' WS007-SRC-TASK-NUMBER                       19200003
192100                  ' WSKCS309-4120  '                              19210003
192200                  ' LINE:'   PV-DISPLAY-LINE                      19220003
192300                  ' UPC:'    PV-DISPLAY-UPC                       19230003
192400                  DELIMITED BY SIZE                               19240003
192500            INTO  PV-CICS-MSG-AREA                                19250003
192600         PERFORM 8000-WRITE-TO-CICS-LOG                           19260003
192700     END-IF.                                                      19270003
192800                                                                  19280003
192900*                                                                 19290003
193000     MOVE 'PO'                   TO SUT00028-TRN-TYP-CDE.         19300003
193100* SEPT 2009 - MARJ HOEFS - ADDED "IF" BELOW                       19310003
193200* IF WS-UPC-NBR = 0, THEN PARA 2005 GOT A NOT FOUND.  SINCE THEN  19320003
193300* THE RECEIVER LINE HAS BEEN INSERTED SO CALL PARA 2005 AGAIN.    19330003
193400     IF WS-UPC-NBR = 0                                            19340003
193500         PERFORM 2005-CHECK-ITM-NBR                               19350003
193600     END-IF.                                                      19360003
193700     MOVE WS-UPC-NBR             TO SUT00028-UPC-NBR.             19370003
193800     MOVE WS014-SKU-QTY          TO SUT00028-SHPD-UNT-QTY.        19380003
193900                                                                  19390003
194000     EXEC SQL                                                     19400003
194100          INSERT INTO SUT_OTBND_UPC                               19410003
194200              (SHIPT_UNT_ID                                       19420003
194300             , TRN_NBR                                            19430003
194400             , RCVR_SEQ_NBR                                       19440003
194500             , TRN_LNE_NBR                                        19450003
194600             , TRN_TYP_CDE                                        19460003
194700             , UPC_NBR                                            19470003
194800             , SHPD_UNT_QTY)                                      19480003
194900          VALUES(                                                 19490003
195000               :SUT00028-SHIPT-UNT-ID                             19500003
195100             , :SUT00028-TRN-NBR                                  19510003
195200             , :SUT00028-RCVR-SEQ-NBR                             19520003
195300             , :SUT00028-TRN-LNE-NBR                              19530003
195400             , :SUT00028-TRN-TYP-CDE                              19540003
195500             , :SUT00028-UPC-NBR                                  19550003
195600             , :SUT00028-SHPD-UNT-QTY)                            19560003
195700     END-EXEC.                                                    19570003
195800                                                                  19580003
195900     EVALUATE TRUE                                                19590003
196000         WHEN SQLCODE = ZERO                                      19600003
196100                                                                  19610003
196200             IF PS-CICS-SWITCH-YES                                19620003
196300                 MOVE WS014-RCVD-SHPMT-NBR  TO DK-SHPMT-NBR       19630003
196400                 MOVE SUT00028-SHIPT-UNT-ID TO WS-DISPLAY-CRTN    19640003
196500                 MOVE SUT00028-TRN-NBR      TO PV-DISPLAY-PO-NBR  19650003
196600                 MOVE SUT00028-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR    19660003
196700                 MOVE SUT00028-TRN-LNE-NBR  TO PV-DISPLAY-LINE    19670003
196800                 INITIALIZE PV-CICS-MSG-AREA                      19680003
196900                 STRING   ' WSKCS309-4120:'                       19690003
197000                          ' INSERT TO SUT_OTBND_UPC FOR '         19700003
197100                          'SHPMT=' WS-DISPLAY-1                   19710003
197200                          ' CRTN =' WS-DISPLAY-CRTN               19720003
197300                          ' PO:' PV-DISPLAY-PO-NBR                19730003
197400                          '-'    PV-DISPLAY-RCVR                  19740003
197500                          DELIMITED BY SIZE                       19750003
197600                          INTO PV-CICS-MSG-AREA                   19760003
197700                 PERFORM 8000-WRITE-TO-CICS-LOG                   19770003
197800                                                                  19780003
197900                 INITIALIZE PV-CICS-MSG-AREA                      19790003
198000                 STRING   ' WSKCS309-4120:'                       19800003
198100                          ' INSERT TO SUT_OTBND_UPC FOR '         19810003
198200                          'SHPMT=' WS-DISPLAY-1                   19820003
198300                          ' PO:' PV-DISPLAY-PO-NBR                19830003
198400                          '-'    PV-DISPLAY-RCVR                  19840003
198500                          '-'    PV-DISPLAY-LINE                  19850003
198600                          DELIMITED BY SIZE                       19860003
198700                          INTO PV-CICS-MSG-AREA                   19870003
198800                 PERFORM 8000-WRITE-TO-CICS-LOG                   19880003
198900             END-IF                                               19890003
199000                                                                  19900003
199100* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            19910003
199200*        WHEN SQLCODE = -904                                      19920003
199300*        WHEN SQLCODE = -913                                      19930003
199400*        WHEN SQLCODE = -911                                      19940003
199500*            CONTINUE                                             19950003
199600         WHEN SQLWARN0 NOT = SPACES                               19960003
199700         WHEN SQLCODE NOT = ZERO                                  19970003
199800             MOVE SQLCODE             TO WS007-SQLCODE            19980003
199900                                         PV-DISPLAY-SQLCODE       19990003
200000             MOVE WS014-RCVD-SHPMT-NBR  TO DK-SHPMT-NBR           20000003
200100             MOVE SUT00028-SHIPT-UNT-ID TO WS-DISPLAY-CRTN        20010003
200200             MOVE SUT00028-TRN-NBR      TO PV-DISPLAY-PO-NBR      20020003
200300             MOVE SUT00028-RCVR-SEQ-NBR TO PV-DISPLAY-RCVR        20030003
200400             MOVE SUT00028-TRN-LNE-NBR  TO PV-DISPLAY-LINE        20040003
200500             INITIALIZE PV-CICS-MSG-AREA                          20050003
200600             STRING   ' ' WS007-SRC-TASK-NUMBER                   20060003
200700                      ' WSKCS309-4120 ERR:'                       20070003
200800                      ' SQL;'                                     20080003
200900                      PV-DISPLAY-SQLCODE                          20090003
201000                      ' SHPMT=' WS-DISPLAY-1                      20100003
201100                      ' CRTN =' WS-DISPLAY-CRTN                   20110003
201200                      DELIMITED BY SIZE                           20120003
201300                                   INTO PV-CICS-MSG-AREA          20130003
201400             PERFORM 8000-WRITE-TO-CICS-LOG                       20140003
201500                                                                  20150003
201600             INITIALIZE PV-CICS-MSG-AREA                          20160003
201700             STRING   ' ' WS007-SRC-TASK-NUMBER                   20170003
201800                          ' WSKCS309-4120:'                       20180003
201900                          ' PO:' PV-DISPLAY-PO-NBR                20190003
202000                          '-'    PV-DISPLAY-RCVR                  20200003
202100                          '-'    PV-DISPLAY-LINE                  20210003
202200                          DELIMITED BY SIZE                       20220003
202300                          INTO PV-CICS-MSG-AREA                   20230003
202400                 PERFORM 8000-WRITE-TO-CICS-LOG                   20240003
202500                                                                  20250003
202600             SET WS007-INVALID-SQL    TO TRUE                     20260003
202700             MOVE '4120-INS-OTBND-UPC'                            20270003
202800                                      TO WS007-SQL-ERROR-PARA     20280003
202900                                         DP013-PARAGRAPH          20290003
203000             MOVE SQLCA               TO WS007-SQLCA              20300003
203010                                         DP013-SQLCA              20301003
203020             STRING 'SQL='                                        20302003
203030                  PV-DISPLAY-SQLCODE                              20303003
203040                  DELIMITED BY SIZE                               20304003
203050                                    INTO WS007-CRA-RET-MSG        20305003
203060             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   20306003
203070             MOVE 'SUT_OTBND_UPC'     TO                          20307003
203080                                       DP013-DB2-TABLE-NAME (1)   20308003
203090             SET DP013-DB2-ABEND      TO TRUE                     20309003
203100             PERFORM 9999-ABEND                                   20310003
203200     END-EVALUATE.                                                20320003
203300                                                                  20330003
203400/                                                                 20340003
203500 4130-INS-OTBND-LOC.                                              20350003
203600                                                                  20360003
203700     IF PS-CICS-SWITCH-YES                                        20370003
203800          STRING  ' ' WS007-SRC-TASK-NUMBER                       20380003
203900                  ' WSKCS309-4130-INS-OTBND-LOC           '       20390003
204000                  DELIMITED BY SIZE                               20400003
204100            INTO  PV-CICS-MSG-AREA                                20410003
204200         PERFORM 8000-WRITE-TO-CICS-LOG                           20420003
204300     END-IF.                                                      20430003
204400                                                                  20440003
204500                                                                  20450003
204600     INITIALIZE DCLSUT00027.                                      20460003
204700     MOVE PV-SML-BARCODE        TO SUT00027-SHIPT-UNT-ID.         20470003
204800     MOVE WS014-CRE-TMST        TO SUT00027-CRE-TMST.             20480003
204900     MOVE WS014-DC-LOCATION     TO SUT00027-LOC-NBR.              20490003
205000     MOVE 'RECV'                TO SUT00027-SCN-CDE.              20500003
205010     MOVE WS014-CRE-USER-ID     TO SUT00027-CRE-USR-ID.           20501003
205020     MOVE 'A'                   TO SUT00027-ACTV-CDE.             20502003
205030     MOVE WS-RCVD-TRIP-ID       TO SUT00027-INBD-TRIP-ID.         20503003
205040                                                                  20504003
205050     EXEC SQL                                                     20505003
205060          INSERT INTO SUT_OTBND_LOC                               20506003
205070              (SHIPT_UNT_ID                                       20507003
205080             , CRE_TMST                                           20508003
205090             , OTBND_TRIP_ID                                      20509003
205100             , LOC_NBR                                            20510003
205200             , SCN_CDE                                            20520003
205300             , CRE_USR_ID                                         20530003
205400             , ACTV_CDE                                           20540003
205500             , INBD_TRIP_ID)                                      20550003
205600          VALUES(                                                 20560003
205700               :SUT00027-SHIPT-UNT-ID                             20570003
205800             , :SUT00027-CRE-TMST                                 20580003
205900             , NULL                                               20590003
206000             , :SUT00027-LOC-NBR                                  20600003
206100             , :SUT00027-SCN-CDE                                  20610003
206200             , :SUT00027-CRE-USR-ID                               20620003
206300             , :SUT00027-ACTV-CDE                                 20630003
206400             , :SUT00027-INBD-TRIP-ID)                            20640003
206500     END-EXEC.                                                    20650003
206600                                                                  20660003
206700     EVALUATE TRUE                                                20670003
206800        WHEN SQLCODE = ZERO                                       20680003
206900                                                                  20690003
207000             IF PS-CICS-SWITCH-YES                                20700003
207100                 MOVE WS014-RCVD-SHPMT-NBR  TO DK-SHPMT-NBR       20710003
207200                 MOVE SUT00027-SHIPT-UNT-ID TO WS-DISPLAY-CRTN    20720003
207300                 INITIALIZE PV-CICS-MSG-AREA                      20730003
207400                 STRING   ' WSKCS309-4130:'                       20740003
207500                          ' INSERT TO SUT_OTBND_LOC FOR '         20750003
207600                          'SHPMT=' WS-DISPLAY-1                   20760003
207700                          ' CRTN =' WS-DISPLAY-CRTN               20770003
207800                          DELIMITED BY SIZE                       20780003
207900                                    INTO PV-CICS-MSG-AREA         20790003
208000                 PERFORM 8000-WRITE-TO-CICS-LOG                   20800003
208100             END-IF                                               20810003
208200                                                                  20820003
208300* SQLCODE -803, -904, -913, -911 SHOULD BE TREATED AS FATAL.      20830003
208400*        WHEN SQLCODE = -803                                      20840003
208500*        WHEN SQLCODE = -904                                      20850003
208600*        WHEN SQLCODE = -913                                      20860003
208700*        WHEN SQLCODE = -911                                      20870003
208800*            CONTINUE                                             20880003
208900         WHEN SQLWARN0 NOT = SPACES                               20890003
209000         WHEN SQLCODE NOT = ZERO                                  20900003
209100             MOVE SQLCODE             TO WS007-SQLCODE            20910003
209200                                         PV-DISPLAY-SQLCODE       20920003
209300             MOVE WS014-RCVD-SHPMT-NBR  TO DK-SHPMT-NBR           20930003
209400             MOVE SUT00027-SHIPT-UNT-ID TO WS-DISPLAY-CRTN        20940003
209500             INITIALIZE PV-CICS-MSG-AREA                          20950003
209600             STRING   ' ' WS007-SRC-TASK-NUMBER                   20960003
209700                      ' WSKCS309-4130 ERROR:'                     20970003
209800                      ' SQL='                                     20980003
209900                      PV-DISPLAY-SQLCODE                          20990003
210000                      ' SHPMT=' WS-DISPLAY-1                      21000003
210100                      ' CRTN =' WS-DISPLAY-CRTN                   21010003
210200                      DELIMITED BY SIZE                           21020003
210300                                    INTO PV-CICS-MSG-AREA         21030003
210400             PERFORM 8000-WRITE-TO-CICS-LOG                       21040003
210500                                                                  21050003
210600             SET WS007-INVALID-SQL    TO TRUE                     21060003
210700             MOVE '4130-INS-OTBND-LOC'                            21070003
210800                                      TO WS007-SQL-ERROR-PARA     21080003
210900                                         DP013-PARAGRAPH          21090003
211000             MOVE SQLCA               TO WS007-SQLCA              21100003
211100                                         DP013-SQLCA              21110003
211200             STRING 'SQL='                                        21120003
211300                  PV-DISPLAY-SQLCODE                              21130003
211400                  DELIMITED BY SIZE                               21140003
211500                                    INTO WS007-CRA-RET-MSG        21150003
211600             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   21160003
211700             MOVE 'SUT_OTBND_LOC'     TO                          21170003
211800                                       DP013-DB2-TABLE-NAME (1)   21180003
211900             SET DP013-DB2-ABEND      TO TRUE                     21190003
212000             PERFORM 9999-ABEND                                   21200003
212100     END-EVALUATE.                                                21210003
212200                                                                  21220003
212300/                                                                 21230003
212400 5000-VALID-SHPMT-CHK.                                            21240003
212500                                                                  21250003
212600     IF PS-CICS-SWITCH-YES                                        21260003
212700          STRING  ' ' WS007-SRC-TASK-NUMBER                       21270003
212800                  ' WSKCS309-5000-VALID-SHPMT-CHK         '       21280003
212900                  DELIMITED BY SIZE                               21290004
213000            INTO  PV-CICS-MSG-AREA                                21300004
213100         PERFORM 8000-WRITE-TO-CICS-LOG                           21310003
213101                                                                  21310104
213110          STRING  ' ' WS007-SRC-TASK-NUMBER                       21311004
213120                  ' WSKCS309-5000-ORIG: '  WS014-ORIG-SHIPMT-NBR  21312004
213130                  DELIMITED BY SIZE                               21313004
213140            INTO  PV-CICS-MSG-AREA                                21314004
213150         PERFORM 8000-WRITE-TO-CICS-LOG                           21315004
213160                                                                  21316004
213170          STRING  ' ' WS007-SRC-TASK-NUMBER                       21317004
213180                  ' WSKCS309-5000-RCVD: ' WS014-RCVD-SHPMT-NBR    21318005
213190                  DELIMITED BY SIZE                               21319004
213191            INTO  PV-CICS-MSG-AREA                                21319104
213192         PERFORM 8000-WRITE-TO-CICS-LOG                           21319204
213200     END-IF.                                                      21320003
213300                                                                  21330003
213400     IF WS014-ORIG-SHIPMT-NBR > SPACES                            21340003
213500        MOVE WS014-ORIG-SHIPMT-NBR     TO DK-SHPMT-NBR            21350003
213600                                          DK-SHPMT-NBR-ORIG       21360003
213700     ELSE                                                         21370003
213800        MOVE WS014-RCVD-SHPMT-NBR      TO DK-SHPMT-NBR            21380003
213900                                          DK-SHPMT-NBR-ORIG       21390003
214000     END-IF.                                                      21400003
214100                                                                  21410003
214200     PERFORM 5010-GET-SHIPMENT.                                   21420003
214300     MOVE WST00001-INTR-TRIP-ID     TO WS-ORIG-TRIP-ID.           21430003
214400                                                                  21440003
214500     SET PS-FREE-ASTRAY-NO          TO TRUE.                      21450003
214600     IF WS014-ORIG-SHIPMT-NBR NOT = WS014-RCVD-SHPMT-NBR          21460003
214700         MOVE WS014-RCVD-SHPMT-NBR  TO DK-SHPMT-NBR               21470003
214800         PERFORM 5010-GET-SHIPMENT                                21480003
214900         MOVE WST00001-INTR-TRIP-ID TO WS-RCVD-TRIP-ID            21490003
215000                                                                  21500003
215100         IF WS-ORIG-TRIP-ID NOT = WS-RCVD-TRIP-ID                 21510003
215200             SET PS-FREE-ASTRAY-YES TO TRUE                       21520003
215300         END-IF                                                   21530003
215400     ELSE                                                         21540003
215500         MOVE WS-ORIG-TRIP-ID       TO WS-RCVD-TRIP-ID            21550003
215510     END-IF.                                                      21551003
215520                                                                  21552003
215530     MOVE WS014-RCVD-SHPMT-NBR      TO DK-SHPMT-NBR.              21553003
215540                                                                  21554003
215550     IF PS-OTBND-CART-EXISTS-NO                                   21555003
215560        PERFORM 5020-UPDATE-XREF-HDR                              21556003
215570     END-IF.                                                      21557003
215580                                                                  21558003
215590/                                                                 21559003
215600 5010-GET-SHIPMENT.                                               21560003
215700                                                                  21570003
215800     IF PS-CICS-SWITCH-YES                                        21580003
215900          STRING  ' ' WS007-SRC-TASK-NUMBER                       21590003
216000                  ' WSKCS309-5010-GET-SHIPMENT            '       21600003
216100                  DELIMITED BY SIZE                               21610003
216200            INTO  PV-CICS-MSG-AREA                                21620003
216300         PERFORM 8000-WRITE-TO-CICS-LOG                           21630003
216400     END-IF.                                                      21640003
216500                                                                  21650003
216600                                                                  21660003
216700     EXEC SQL                                                     21670003
216800          SELECT                                                  21680003
216900                INTR_TRIP_ID                                      21690003
217000          INTO                                                    21700003
217100                :WST00001-INTR-TRIP-ID                            21710003
217200          FROM                                                    21720003
217300                WST_SHPMT_XREF_HDR                                21730003
217400          WHERE                                                   21740003
217500                EXT_SHP_ID = :DK-SHPMT-NBR                        21750003
217600     END-EXEC.                                                    21760003
217700                                                                  21770003
217800     EVALUATE TRUE                                                21780003
217900         WHEN SQLCODE = ZERO                                      21790003
218000             IF PS-CICS-SWITCH-YES                                21800003
218100                 MOVE WST00001-INTR-TRIP-ID TO WS-DISPLAY-1       21810003
218200                 INITIALIZE PV-CICS-MSG-AREA                      21820003
218300                 STRING   ' WSKCS309-5010:'                       21830003
218400                          ' INTR TRIP ID='                        21840003
218500                          WS-DISPLAY-1                            21850003
218600                          '  '                                    21860003
218700                          DK-SHPMT-NBR                            21870003
218710                          DELIMITED BY SIZE                       21871003
218720                                    INTO PV-CICS-MSG-AREA         21872003
218730                 PERFORM 8000-WRITE-TO-CICS-LOG                   21873003
218740             END-IF                                               21874003
218750                                                                  21875003
218760* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            21876003
218770*        WHEN SQLCODE = -904                                      21877003
218780*        WHEN SQLCODE = -913                                      21878003
218790*        WHEN SQLCODE = -911                                      21879003
218800*            CONTINUE                                             21880003
218900         WHEN SQLCODE = +100                                      21890003
219000             MOVE SQLCODE             TO WS007-SQLCODE            21900003
219100                                         PV-DISPLAY-SQLCODE       21910003
219200             INITIALIZE PV-CICS-MSG-AREA                          21920003
219300             STRING   ' ' WS007-SRC-TASK-NUMBER                   21930003
219400                      ' WSKCS309-5010 ERROR:'                     21940003
219500                      ' SHIPMENT NOT FOUND FOR'                   21950003
219600                      ' SHPMT='                                   21960003
219700                      DK-SHPMT-NBR                                21970003
219800                      DELIMITED BY SIZE                           21980003
219900                                    INTO PV-CICS-MSG-AREA         21990003
220000             PERFORM 8000-WRITE-TO-CICS-LOG                       22000003
220100                                                                  22010003
220200             SET WS007-INVALID-SQL    TO TRUE                     22020003
220300             MOVE '5010-GET-SHIPMENT'                             22030003
220400                                      TO WS007-SQL-ERROR-PARA     22040003
220500                                         DP013-PARAGRAPH          22050003
220600             MOVE SQLCA               TO WS007-SQLCA              22060003
220700                                         DP013-SQLCA              22070003
220800             MOVE 'SHIPMENT NOT FOUND'                            22080003
220900                                      TO WS007-CRA-RET-MSG        22090003
221000                                         DP013-MESSAGE-TEXT (1)   22100003
221100             MOVE 'WST_SHPMT_XREF_HDR'                            22110003
221200                                      TO DP013-DB2-TABLE-NAME (1) 22120003
221300             SET DP013-DB2-ABEND      TO TRUE                     22130003
221400             PERFORM 9999-ABEND                                   22140003
221500         WHEN SQLWARN0 NOT = SPACES                               22150003
221600         WHEN SQLCODE NOT = ZERO                                  22160003
221700             MOVE SQLCODE             TO WS007-SQLCODE            22170003
221800                                         PV-DISPLAY-SQLCODE       22180003
221900             INITIALIZE PV-CICS-MSG-AREA                          22190003
222000             STRING   ' ' WS007-SRC-TASK-NUMBER                   22200003
222100                      ' WSKCS309-5010 ERROR:'                     22210003
222200                      ' SQL='                                     22220003
222300                      PV-DISPLAY-SQLCODE                          22230003
222400                      ' SHPMT='                                   22240003
222500                      DK-SHPMT-NBR                                22250003
222600                      DELIMITED BY SIZE                           22260003
222700                                    INTO PV-CICS-MSG-AREA         22270003
222800             PERFORM 8000-WRITE-TO-CICS-LOG                       22280003
222900                                                                  22290003
223000             SET WS007-INVALID-SQL    TO TRUE                     22300003
223100             MOVE '5010-GET-SHIPMENT'                             22310003
223200                                      TO WS007-SQL-ERROR-PARA     22320003
223300                                         DP013-PARAGRAPH          22330003
223400             MOVE SQLCA               TO WS007-SQLCA              22340003
223500                                         DP013-SQLCA              22350003
223600             STRING 'SQL='                                        22360003
223700                  PV-DISPLAY-SQLCODE                              22370003
223800                  DELIMITED BY SIZE                               22380003
223900                                    INTO WS007-CRA-RET-MSG        22390003
224000             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   22400003
224100             MOVE 'WST_SHPMT_XREF_HDR'                            22410003
224200                                      TO DP013-DB2-TABLE-NAME (1) 22420003
224300             SET DP013-DB2-ABEND      TO TRUE                     22430003
224400             PERFORM 9999-ABEND                                   22440003
224500     END-EVALUATE.                                                22450003
224600                                                                  22460003
224700/                                                                 22470003
224800 5020-UPDATE-XREF-HDR.                                            22480003
224900                                                                  22490003
225000     IF PS-CICS-SWITCH-YES                                        22500003
225100          STRING  ' ' WS007-SRC-TASK-NUMBER                       22510003
225200                  ' WSKCS309-5020-UPDATE-XREF-HDR         '       22520003
225300                  DELIMITED BY SIZE                               22530003
225400            INTO  PV-CICS-MSG-AREA                                22540003
225500         PERFORM 8000-WRITE-TO-CICS-LOG                           22550003
225600     END-IF.                                                      22560003
225700                                                                  22570003
225800                                                                  22580003
225900     EXEC SQL                                                     22590003
226000          UPDATE                                                  22600003
226100                WST_SHPMT_XREF_HDR                                22610003
226200          SET                                                     22620003
226300                RCPT_TMST = CURRENT TIMESTAMP                     22630003
226400          WHERE                                                   22640003
226500                EXT_SHP_ID = :DK-SHPMT-NBR                        22650003
226600     END-EXEC.                                                    22660003
226700                                                                  22670003
226800     EVALUATE TRUE                                                22680003
226900         WHEN SQLCODE = ZERO                                      22690003
227000             IF PS-CICS-SWITCH-YES                                22700003
227010                 INITIALIZE PV-CICS-MSG-AREA                      22701003
227020                 STRING   ' WSKCS309-5020:'                       22702003
227030                          ' UPDATE WST_SHPMT_XREF_HDR FOR '       22703003
227040                          'SHPMT='                                22704003
227050                          DK-SHPMT-NBR                            22705003
227060                          DELIMITED BY SIZE                       22706003
227070                                    INTO PV-CICS-MSG-AREA         22707003
227080                 PERFORM 8000-WRITE-TO-CICS-LOG                   22708003
227090             END-IF                                               22709003
227100                                                                  22710003
227200* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            22720003
227300*        WHEN SQLCODE = -904                                      22730003
227400*        WHEN SQLCODE = -913                                      22740003
227410*        WHEN SQLCODE = -911                                      22741003
227420         WHEN SQLCODE = +100                                      22742003
227430             CONTINUE                                             22743003
227440         WHEN SQLWARN0 NOT = SPACES                               22744003
227450         WHEN SQLCODE NOT = ZERO                                  22745003
227460             MOVE SQLCODE             TO WS007-SQLCODE            22746003
227470                                         PV-DISPLAY-SQLCODE       22747003
227480             INITIALIZE PV-CICS-MSG-AREA                          22748003
227490             STRING   ' ' WS007-SRC-TASK-NUMBER                   22749003
227500                      ' WSKCS309-5020 ERROR:'                     22750003
227600                      ' SQL='                                     22760003
227700                      PV-DISPLAY-SQLCODE                          22770003
227800                      'SHPMT='                                    22780003
227900                      DK-SHPMT-NBR                                22790003
228000                      DELIMITED BY SIZE                           22800003
228100                                    INTO PV-CICS-MSG-AREA         22810003
228200             PERFORM 8000-WRITE-TO-CICS-LOG                       22820003
228300                                                                  22830003
228400             SET WS007-INVALID-SQL    TO TRUE                     22840003
228500             MOVE '5020-UPDATE-XREF-HDR'                          22850003
228600                                      TO WS007-SQL-ERROR-PARA     22860003
228700                                         DP013-PARAGRAPH          22870003
228800             MOVE SQLCA               TO WS007-SQLCA              22880003
228900                                         DP013-SQLCA              22890003
229000             STRING 'SQL='                                        22900003
229100                  PV-DISPLAY-SQLCODE                              22910003
229200                  DELIMITED BY SIZE                               22920003
229300                                    INTO WS007-CRA-RET-MSG        22930003
229400             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   22940003
229500             MOVE 'WST_SHPMT_XREF_HDR'                            22950003
229600                                      TO DP013-DB2-TABLE-NAME (1) 22960003
229700             SET DP013-DB2-ABEND      TO TRUE                     22970003
229800             PERFORM 9999-ABEND                                   22980003
229900     END-EVALUATE.                                                22990003
230000                                                                  23000003
230100/                                                                 23010003
230200 5030-CHECK-SHIPMT-DTL.                                           23020003
230300                                                                  23030003
230400     IF PS-CICS-SWITCH-YES                                        23040003
230500          STRING  ' ' WS007-SRC-TASK-NUMBER                       23050003
230600                  ' WSKCS309-5030-CHECK-SHIPMT-DTL        '       23060003
230700                  DELIMITED BY SIZE                               23070003
230800            INTO  PV-CICS-MSG-AREA                                23080003
230900         PERFORM 8000-WRITE-TO-CICS-LOG                           23090003
231000     END-IF.                                                      23100003
231100                                                                  23110003
231200* GET ASN LEVEL CODE (CASE VS. SKU) FOR THE SKU/PO/SHIPMENT NBR.  23120003
231300                                                                  23130003
231400     EXEC SQL                                                     23140003
231500          SELECT DISTINCT                                         23150003
231600                 A.ASN_LVL_CDE                                    23160003
231700          INTO   :WST00002-ASN-LVL-CDE                            23170003
231800          FROM   WST_SHPMT_XREF_DTL A                             23180003
231900               , TPURITM            B                             23190003
232000               , XLV_SKU            C                             23200003
232100          WHERE  A.PO_NBR         = :DK-PO-NBR                    23210003
232110          AND    A.EXT_SHP_ID     = :DK-SHPMT-NBR-ORIG            23211003
232120          AND    C.SKU_NBR        = :DK-SKU-NBR                   23212003
232130          AND    A.PO_NBR         = B.PO_NBR                      23213003
232140          AND    A.PO_LNE_NBR     = B.APP_PO_LNE_NBR              23214003
232150          AND    B.ITM_NBR        = C.ITM_NBR                     23215003
232160          AND    A.ACTV_CDE       = 'A'                           23216003
232170     END-EXEC.                                                    23217003
232180                                                                  23218003
232190     EVALUATE TRUE                                                23219003
232200         WHEN SQLCODE = ZERO                                      23220003
232300             MOVE WST00002-ASN-LVL-CDE TO WS-ASN-LVL-CDE          23230003
232400             IF PS-CICS-SWITCH-YES                                23240003
232500                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             23250003
232600                 MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR            23260003
232700                 INITIALIZE PV-CICS-MSG-AREA                      23270003
232800                 STRING   ' WSKCS309-5030:'                       23280003
232900                          ' ASN LVL CDE='                         23290003
233000                          WS-ASN-LVL-CDE                          23300003
233100                          ' PO:'  PV-DISPLAY-PO-NBR               23310003
233200                          ' SKU:' PV-DISPLAY-SKU-NBR              23320003
233300                          '  '    DK-SHPMT-NBR-ORIG               23330003
233400                          DELIMITED BY SIZE                       23340003
233500                          INTO PV-CICS-MSG-AREA                   23350003
233600                 PERFORM 8000-WRITE-TO-CICS-LOG                   23360003
233700             END-IF                                               23370003
233800**                                                                23380003
233900*** DMH 11/6/13                                                   23390003
234000            PERFORM 5035-CHECK-SHIPMT-DTL-NOT-VE                  23400003
234100*** DMH 11/6/13                                                   23410003
234200**                                                                23420003
234300                                                                  23430003
234400         WHEN SQLCODE = +100                                      23440003
234500             PERFORM 5040-CHK-DUMMY-SHIPMT-DTL                    23450003
234600* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            23460003
234700*        WHEN SQLCODE = -904                                      23470003
234800*        WHEN SQLCODE = -913                                      23480003
234900*        WHEN SQLCODE = -911                                      23490003
235000*            IF PS-CICS-SWITCH-YES                                23500003
235100*                MOVE SQLCODE  TO PV-DISPLAY-SQLCODE              23510003
235200*                MOVE DK-PO-NBR TO PV-DISPLAY-PO-NBR              23520003
235300*                MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR            23530003
235400*                INITIALIZE PV-CICS-MSG-AREA                      23540003
235500*                STRING   ' WSKCS309-5030:'                       23550003
235600*                         ' PO NBR ' PV-DISPLAY-PO-NBR            23560003
235700*                         ' SKU NBR' PV-DISPLAY-SKU-NBR           23570003
235710*                         ' EXP SHP ID'  DK-SHPMT-NBR-ORIG        23571003
235720*                         ' SQLCODE' PV-DISPLAY-SQLCODE           23572003
235730*                         DELIMITED BY SIZE                       23573003
235740*                         INTO PV-CICS-MSG-AREA                   23574003
235750*                PERFORM 8000-WRITE-TO-CICS-LOG                   23575003
235760*            END-IF                                               23576003
235770*             CONTINUE                                            23577003
235780         WHEN SQLWARN0 NOT = SPACES                               23578003
235790         WHEN SQLCODE NOT = ZERO                                  23579003
235800             MOVE SQLCODE             TO WS007-SQLCODE            23580003
235900                                         PV-DISPLAY-SQLCODE       23590003
236000             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        23600003
236100             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       23610003
236200             INITIALIZE PV-CICS-MSG-AREA                          23620003
236300             STRING   ' ' WS007-SRC-TASK-NUMBER                   23630003
236400                      ' WSKCS309-5030 ERROR:'                     23640003
236500                      ' SQL='                                     23650003
236600                      PV-DISPLAY-SQLCODE                          23660003
236700                      ' PO:'  PV-DISPLAY-PO-NBR                   23670003
236800                      ' SKU:' PV-DISPLAY-SKU-NBR                  23680003
236900                      '  '    DK-SHPMT-NBR-ORIG                   23690003
237000                      DELIMITED BY SIZE                           23700003
237100                                   INTO PV-CICS-MSG-AREA          23710003
237200             PERFORM 8000-WRITE-TO-CICS-LOG                       23720003
237300                                                                  23730003
237400             SET WS007-INVALID-SQL    TO TRUE                     23740003
237500             MOVE '5030-CHECK-SHIPMT-DTL'                         23750003
237600                                      TO WS007-SQL-ERROR-PARA     23760003
237700                                         DP013-PARAGRAPH          23770003
237800             MOVE SQLCA               TO WS007-SQLCA              23780003
237900                                         DP013-SQLCA              23790003
238000             STRING 'SQL='                                        23800003
238100                  PV-DISPLAY-SQLCODE                              23810003
238200                  DELIMITED BY SIZE                               23820003
238300                                    INTO WS007-CRA-RET-MSG        23830003
238400             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   23840003
238500             MOVE 'WST_SHPMT_XREF_HDR'                            23850003
238600                                      TO DP013-DB2-TABLE-NAME (1) 23860003
238700             MOVE 'TPURITM'                                       23870003
238800                                      TO DP013-DB2-TABLE-NAME (2) 23880003
238900             MOVE 'XLV_SKU'                                       23890003
239000                                      TO DP013-DB2-TABLE-NAME (3) 23900003
239100             SET DP013-DB2-ABEND      TO TRUE                     23910003
239200             PERFORM 9999-ABEND                                   23920003
239300     END-EVALUATE.                                                23930003
239400                                                                  23940003
239500*                                                                 23950003
239600*** DMH 11/7/13                                                   23960003
239700     IF  WS-ASN-LVL-CDE = 'C'                                     23970003
239800            PERFORM 5037-CHECK-TSHPUNT                            23980003
239900     END-IF.                                                      23990003
240000*** DMH 11/7/13                                                   24000003
240100*                                                                 24010003
240200                                                                  24020003
240300                                                                  24030003
240400 5035-CHECK-SHIPMT-DTL-NOT-VE.                                    24040003
240500                                                                  24050003
240600     IF PS-CICS-SWITCH-YES                                        24060003
240700          STRING  ' ' WS007-SRC-TASK-NUMBER                       24070003
240800                  ' WSKCS309-5035-CHECK-SHIPMT-DTL-NOT-VE '       24080003
240900                  DELIMITED BY SIZE                               24090003
241000            INTO  PV-CICS-MSG-AREA                                24100003
241100         PERFORM 8000-WRITE-TO-CICS-LOG                           24110003
241101     END-IF.                                                      24110103
241102                                                                  24110203
241103* MAKE SURE THAT THE PO-RCVR IS NOT VERIFIED                      24110303
241104                                                                  24110403
241105     EXEC SQL                                                     24110503
241106          SELECT DISTINCT                                         24110603
241107                 A.ASN_LVL_CDE                                    24110703
241108          INTO   :WST00002-ASN-LVL-CDE                            24110803
241109          FROM   WST_SHPMT_XREF_DTL A                             24110903
241110               , TPURITM            B                             24111003
241120               , XLV_SKU            C                             24112003
241130               , TRECITM            D                             24113003
241140          WHERE  A.PO_NBR         = :DK-PO-NBR                    24114003
241150          AND    A.EXT_SHP_ID     = :DK-SHPMT-NBR-ORIG            24115003
241160          AND    C.SKU_NBR        = :DK-SKU-NBR                   24116003
241170          AND    A.PO_NBR         = B.PO_NBR                      24117003
241180          AND    A.PO_LNE_NBR     = B.APP_PO_LNE_NBR              24118003
241190          AND    B.ITM_NBR        = C.ITM_NBR                     24119003
241191          AND    A.ACTV_CDE       = 'A'                           24119103
241192          AND    A.PO_NBR         =  D.ORD_NBR                    24119203
241193          AND    A.RCVR_SEQ_NBR   =  D.REC_SEQ_NBR                24119303
241194          AND    A.PO_LNE_NBR     =  D.ORD_LNE_NBR                24119403
241195          AND    D.STATUS_CDE    <>  'VE'                         24119503
241196     END-EXEC.                                                    24119603
241197                                                                  24119703
241198     EVALUATE TRUE                                                24119803
241199         WHEN SQLCODE = ZERO                                      24119903
241200             MOVE WST00002-ASN-LVL-CDE TO WS-ASN-LVL-CDE          24120003
241201             IF PS-CICS-SWITCH-YES                                24120103
241202                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             24120203
241203                 MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR            24120303
241204                 INITIALIZE PV-CICS-MSG-AREA                      24120403
241205                 STRING   ' WSKCS309-5035:'                       24120503
241206                          ' ASN LVL CDE='                         24120603
241207                          WS-ASN-LVL-CDE                          24120703
241208                          ' PO:'  PV-DISPLAY-PO-NBR               24120803
241209                          ' SKU:' PV-DISPLAY-SKU-NBR              24120903
241210                          '  '    DK-SHPMT-NBR-ORIG               24121003
241211                          DELIMITED BY SIZE                       24121103
241212                          INTO PV-CICS-MSG-AREA                   24121203
241213                 PERFORM 8000-WRITE-TO-CICS-LOG                   24121303
241214             END-IF                                               24121403
241215         WHEN SQLCODE = +100                                      24121503
241216             MOVE  SPACES  TO  WS-ASN-LVL-CDE                     24121603
241217             PERFORM 5040-CHK-DUMMY-SHIPMT-DTL                    24121703
241218         WHEN SQLWARN0 NOT = SPACES                               24121803
241219         WHEN SQLCODE NOT = ZERO                                  24121903
241220             MOVE SQLCODE             TO WS007-SQLCODE            24122003
241221                                         PV-DISPLAY-SQLCODE       24122103
241222             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        24122203
241223             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       24122303
241224             INITIALIZE PV-CICS-MSG-AREA                          24122403
241225             STRING   ' ' WS007-SRC-TASK-NUMBER                   24122503
241226                      ' WSKCS309-5035 ERROR:'                     24122603
241227                      ' SQL='                                     24122703
241228                      PV-DISPLAY-SQLCODE                          24122803
241229                      ' PO:'  PV-DISPLAY-PO-NBR                   24122903
241230                      ' SKU:' PV-DISPLAY-SKU-NBR                  24123003
241231                      '  '    DK-SHPMT-NBR-ORIG                   24123103
241232                      DELIMITED BY SIZE                           24123203
241233                                   INTO PV-CICS-MSG-AREA          24123303
241234             PERFORM 8000-WRITE-TO-CICS-LOG                       24123403
241235                                                                  24123503
241236             SET WS007-INVALID-SQL    TO TRUE                     24123603
241237             MOVE '5035-CHECK-SHIPMT-DTL-NOT-VE'                  24123703
241238                                      TO WS007-SQL-ERROR-PARA     24123803
241239                                         DP013-PARAGRAPH          24123903
241240             MOVE SQLCA               TO WS007-SQLCA              24124003
241250                                         DP013-SQLCA              24125003
241260             STRING 'SQL='                                        24126003
241261                  PV-DISPLAY-SQLCODE                              24126103
241262                  DELIMITED BY SIZE                               24126203
241263                                    INTO WS007-CRA-RET-MSG        24126303
241264             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   24126403
241265             MOVE 'WST_SHPMT_XREF_HDR'                            24126503
241266                                      TO DP013-DB2-TABLE-NAME (1) 24126603
241267             MOVE 'TPURITM'                                       24126703
241268                                      TO DP013-DB2-TABLE-NAME (2) 24126803
241269             MOVE 'XLV_SKU'                                       24126903
241270                                      TO DP013-DB2-TABLE-NAME (3) 24127003
241271             MOVE 'TRECITM'                                       24127103
241272                                      TO DP013-DB2-TABLE-NAME (2) 24127203
241273             SET DP013-DB2-ABEND      TO TRUE                     24127303
241274             PERFORM 9999-ABEND                                   24127403
241275     END-EVALUATE.                                                24127503
241276                                                                  24127603
241277                                                                  24127703
241278****************************************************************  24127803
241279* IF CASE LEVEL RECIEVING AND CARTON STARTS WITH 0047 CHECK IF *  24127903
241280* IN INBOUND DATABASE ---  IF NOT THIS SHOULD BE SKU LEVEL     *  24128003
241281****************************************************************  24128103
241282 5037-CHECK-TSHPUNT.                                              24128203
241283                                                                  24128303
241284     IF PS-CICS-SWITCH-YES                                        24128403
241285          STRING  ' ' WS007-SRC-TASK-NUMBER                       24128503
241286                  ' WSKCS309-5037-CHECK-TSHPUNT           '       24128603
241287                  WS014-CASE-NUMBER                               24128703
241288                  DELIMITED BY SIZE                               24128803
241289            INTO  PV-CICS-MSG-AREA                                24128903
241290         PERFORM 8000-WRITE-TO-CICS-LOG                           24129003
241291     END-IF.                                                      24129103
241292                                                                  24129203
241293     MOVE WS014-CASE-NUMBER  TO DK-CASE-NBR.                      24129303
241294                                                                  24129403
241295     EXEC SQL                                                     24129503
241296          SELECT                                                  24129603
241297                 A.SHIPT_UNT_ID                                   24129703
241298          INTO                                                    24129803
241299                 :PV-SHIPT-UNT-ID                                 24129903
241300          FROM                                                    24130003
241301                 TSHPUNT A                                        24130103
241302          WHERE  A.SHIPT_UNT_ID   = :DK-CASE-NBR                  24130203
241303          AND    A.ACTV_IND       = 'A'                           24130303
241304     END-EXEC.                                                    24130403
241305                                                                  24130503
241306     EVALUATE TRUE                                                24130603
241307         WHEN SQLCODE = ZERO                                      24130703
241308             CONTINUE                                             24130803
241309             IF PS-CICS-SWITCH-YES                                24130903
241310                 INITIALIZE PV-CICS-MSG-AREA                      24131003
241311                 MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN              24131103
241312                 MOVE DK-PO-NBR   TO PV-DISPLAY-PO-NBR            24131203
241313                 STRING   ' WSKCS309-5037-'                       24131303
241314                          ' CASE LEVEL RCVG '                     24131403
241315                          ' CRTN:' PV-DISPLAY-CRTN                24131503
241316                          ' PO:'   PV-DISPLAY-PO-NBR              24131603
241317                          DELIMITED BY SIZE                       24131703
241318                                    INTO PV-CICS-MSG-AREA         24131803
241319                 PERFORM 8000-WRITE-TO-CICS-LOG                   24131903
241320             END-IF                                               24132003
241330         WHEN SQLCODE = +100                                      24133003
241331             MOVE SPACES  TO  WS-ASN-LVL-CDE                      24133103
241332             IF PS-CICS-SWITCH-YES                                24133203
241333                 INITIALIZE PV-CICS-MSG-AREA                      24133303
241334                 MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN              24133403
241335                 MOVE DK-PO-NBR   TO PV-DISPLAY-PO-NBR            24133503
241336                 STRING   ' WSKCS309-5037-'                       24133603
241337                          ' SKU LEVEL RCVG '                      24133703
241338                          ' CRTN:' PV-DISPLAY-CRTN                24133803
241339                          ' PO:'   PV-DISPLAY-PO-NBR              24133903
241340                          DELIMITED BY SIZE                       24134003
241341                                    INTO PV-CICS-MSG-AREA         24134103
241342                 PERFORM 8000-WRITE-TO-CICS-LOG                   24134203
241343             END-IF                                               24134303
241344         WHEN SQLWARN0 NOT = SPACES                               24134403
241345         WHEN SQLCODE NOT = ZERO                                  24134503
241346             MOVE SQLCODE             TO WS007-SQLCODE            24134603
241347                                         PV-DISPLAY-SQLCODE       24134703
241348             MOVE DK-CASE-NBR         TO PV-DISPLAY-CRTN          24134803
241349             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        24134903
241350             INITIALIZE PV-CICS-MSG-AREA                          24135003
241360             STRING   ' ' WS007-SRC-TASK-NUMBER                   24136003
241361                      ' WSKCS309-5037 ERROR:'                     24136103
241362                      ' SQL='                                     24136203
241363                      PV-DISPLAY-SQLCODE                          24136303
241364                      ' CRTN:' PV-DISPLAY-CRTN                    24136403
241365                      ' PO:'   PV-DISPLAY-PO-NBR                  24136503
241366                      DELIMITED BY SIZE                           24136603
241367                                    INTO PV-CICS-MSG-AREA         24136703
241368             PERFORM 8000-WRITE-TO-CICS-LOG                       24136803
241369                                                                  24136903
241370             SET WS007-INVALID-SQL    TO TRUE                     24137003
241371             MOVE '5037-CHECK-TSHPUNT'                            24137103
241372                                      TO WS007-SQL-ERROR-PARA     24137203
241373                                         DP013-PARAGRAPH          24137303
241374             MOVE SQLCA               TO WS007-SQLCA              24137403
241375                                         DP013-SQLCA              24137503
241376             STRING 'SQL='                                        24137603
241377                  PV-DISPLAY-SQLCODE                              24137703
241378                  DELIMITED BY SIZE                               24137803
241379                                    INTO WS007-CRA-RET-MSG        24137903
241380             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   24138003
241381             MOVE 'TSHPUNT'                                       24138103
241382                                      TO DP013-DB2-TABLE-NAME (1) 24138203
241383             SET DP013-DB2-ABEND      TO TRUE                     24138303
241384             PERFORM 9999-ABEND                                   24138403
241385     END-EVALUATE.                                                24138503
241386                                                                  24138603
241387                                                                  24138703
241388/                                                                 24138803
241389 5040-CHK-DUMMY-SHIPMT-DTL.                                       24138903
241390                                                                  24139003
241391     IF PS-CICS-SWITCH-YES                                        24139103
241392          STRING  ' ' WS007-SRC-TASK-NUMBER                       24139203
241393                  ' WSKCS309-5040-CHK-DUMMY-SHIPMT-DTL    '       24139303
241394                  DELIMITED BY SIZE                               24139403
241395            INTO  PV-CICS-MSG-AREA                                24139503
241396         PERFORM 8000-WRITE-TO-CICS-LOG                           24139603
241397     END-IF.                                                      24139703
241398                                                                  24139803
241399                                                                  24139903
241400* IF THE PO WAS NOT FOUND IN 5030-, IT MAY BE BECAUSE IT IS ON    24140003
241410* A DUMMY SHIPMENT, NOT THE ORIGINAL SHIPMENT.  THIS SELECT WILL  24141003
241411* CHECK TO SEE IF THE PO IS ON A DUMMY SHIPMENT.                  24141103
241412* GET ASN LEVEL CODE (CASE VS. SKU) FOR THE SKU/PO/SHIPMENT NBR.  24141203
241413                                                                  24141303
241414     MOVE DK-SHPMT-NBR-ORIG        TO DK-DUMMY-EXT-SHP-ID.        24141403
241415     MOVE 'D'                      TO DK-DUMMY.                   24141503
241416     MOVE '%'                      TO DK-DUMMY-WILDCARD.          24141603
241417                                                                  24141703
241418     EXEC SQL                                                     24141803
241419          SELECT DISTINCT                                         24141903
241420                 A.ASN_LVL_CDE                                    24142003
241430          INTO   :WST00002-ASN-LVL-CDE                            24143003
241440          FROM   WST_SHPMT_XREF_DTL A                             24144003
241450               , TPURITM            B                             24145003
241460               , XLV_SKU            C                             24146003
241470          WHERE  A.PO_NBR         = :DK-PO-NBR                    24147003
241480          AND    A.EXT_SHP_ID  LIKE :DK-DUMMY-SHP-ID              24148003
241490          AND    C.SKU_NBR        = :DK-SKU-NBR                   24149003
241500          AND    A.PO_NBR         = B.PO_NBR                      24150003
241600          AND    A.PO_LNE_NBR     = B.APP_PO_LNE_NBR              24160003
241700          AND    B.ITM_NBR        = C.ITM_NBR                     24170003
241800          AND    A.ACTV_CDE       = 'A'                           24180003
241900     END-EXEC.                                                    24190003
242000                                                                  24200003
242100     EVALUATE TRUE                                                24210003
242200         WHEN SQLCODE = ZERO                                      24220003
242300             MOVE WST00002-ASN-LVL-CDE TO WS-ASN-LVL-CDE          24230003
242400             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        24240003
242500             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       24250003
242600             IF PS-CICS-SWITCH-YES                                24260003
242700                 INITIALIZE PV-CICS-MSG-AREA                      24270003
242800                 STRING   ' WSKCS309-5040:'                       24280003
242900                          ' ASN LVL CDE='                         24290003
243000                          WS-ASN-LVL-CDE                          24300003
243100                          ' PO:'  PV-DISPLAY-PO-NBR               24310003
243200                          ' SKU:' PV-DISPLAY-SKU-NBR              24320003
243300                          '  '    DK-DUMMY-SHP-ID                 24330003
243400                          DELIMITED BY SIZE                       24340003
243500                          INTO PV-CICS-MSG-AREA                   24350003
243600                 PERFORM 8000-WRITE-TO-CICS-LOG                   24360003
243700             END-IF                                               24370003
243800                                                                  24380003
243810**                                                                24381003
243820*** DMH 11/6/13                                                   24382003
243830             PERFORM 5045-CHK-DUM-SHPMT-DTL-NO-VE                 24383003
243840*** DMH 11/6/13                                                   24384003
243850**                                                                24385003
243860                                                                  24386003
243870* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            24387003
243880*        WHEN SQLCODE = -904                                      24388003
243890*        WHEN SQLCODE = -913                                      24389003
243900*        WHEN SQLCODE = -911                                      24390003
244000         WHEN SQLCODE = +100                                      24400003
244100             IF PS-CICS-SWITCH-YES                                24410003
244200                 MOVE SQLCODE    TO PV-DISPLAY-SQLCODE            24420003
244300                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             24430003
244400                 MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR            24440003
244500                 INITIALIZE PV-CICS-MSG-AREA                      24450003
244600                 STRING   ' WSKCS309-5040:'                       24460003
244700                          ' SQLCODE ' PV-DISPLAY-SQLCODE          24470003
244710                          ' PO:'  PV-DISPLAY-PO-NBR               24471003
244720                          ' SKU:' PV-DISPLAY-SKU-NBR              24472003
244730                          '  '    DK-DUMMY-SHP-ID                 24473003
244740                          DELIMITED BY SIZE                       24474003
244750                          INTO PV-CICS-MSG-AREA                   24475003
244760                 PERFORM 8000-WRITE-TO-CICS-LOG                   24476003
244770             END-IF                                               24477003
244780              CONTINUE                                            24478003
244790         WHEN SQLWARN0 NOT = SPACES                               24479003
244800         WHEN SQLCODE NOT = ZERO                                  24480003
244900             MOVE SQLCODE             TO WS007-SQLCODE            24490003
245000                                         PV-DISPLAY-SQLCODE       24500003
245100             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 24510003
245200             MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR                24520003
245300             INITIALIZE PV-CICS-MSG-AREA                          24530003
245400             STRING   ' ' WS007-SRC-TASK-NUMBER                   24540003
245500                      ' WSKCS309-5040 ERROR:'                     24550003
245600                      ' SQL='                                     24560003
245700                      PV-DISPLAY-SQLCODE                          24570003
245800                      ' PO:'  PV-DISPLAY-PO-NBR                   24580003
245900                      ' SKU:' PV-DISPLAY-SKU-NBR                  24590003
246000                      '  '    DK-DUMMY-SHP-ID                     24600003
246100                      DELIMITED BY SIZE                           24610003
246200                                   INTO PV-CICS-MSG-AREA          24620003
246300             PERFORM 8000-WRITE-TO-CICS-LOG                       24630003
246400                                                                  24640003
246500             SET WS007-INVALID-SQL    TO TRUE                     24650003
246600             MOVE '5040-CHK-DUMMY-SHIPMT-DTL'                     24660003
246700                                      TO WS007-SQL-ERROR-PARA     24670003
246800                                         DP013-PARAGRAPH          24680003
246900             MOVE SQLCA               TO WS007-SQLCA              24690003
247000                                         DP013-SQLCA              24700003
247100             STRING 'SQL='                                        24710003
247200                  PV-DISPLAY-SQLCODE                              24720003
247300                  DELIMITED BY SIZE                               24730003
247400                                    INTO WS007-CRA-RET-MSG        24740003
247500             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   24750003
247600             MOVE 'WST_SHPMT_XREF_HDR'                            24760003
247700                                      TO DP013-DB2-TABLE-NAME (1) 24770003
247800             MOVE 'TPURITM'                                       24780003
247900                                      TO DP013-DB2-TABLE-NAME (2) 24790003
248000             MOVE 'XLV_SKU'                                       24800003
248100                                      TO DP013-DB2-TABLE-NAME (3) 24810003
248200             SET DP013-DB2-ABEND      TO TRUE                     24820003
248300             PERFORM 9999-ABEND                                   24830003
248400     END-EVALUATE.                                                24840003
248500                                                                  24850003
248600 5045-CHK-DUM-SHPMT-DTL-NO-VE .                                   24860003
248700                                                                  24870003
248800     IF PS-CICS-SWITCH-YES                                        24880003
248900          STRING  ' ' WS007-SRC-TASK-NUMBER                       24890003
249000                  ' WSKCS309-5045-CHK-DUM-SHPMT-DTL-NO-VE'        24900003
249100                  DELIMITED BY SIZE                               24910003
249200            INTO  PV-CICS-MSG-AREA                                24920003
249300         PERFORM 8000-WRITE-TO-CICS-LOG                           24930003
249400     END-IF.                                                      24940003
249500                                                                  24950003
249600                                                                  24960003
249700* IF THE PO WAS NOT FOUND IN 5030-, IT MAY BE BECAUSE IT IS ON    24970003
249800* A DUMMY SHIPMENT, NOT THE ORIGINAL SHIPMENT.  THIS SELECT WILL  24980003
249900* CHECK TO SEE IF THE PO IS ON A DUMMY SHIPMENT.                  24990003
250000* GET ASN LEVEL CODE (CASE VS. SKU) FOR THE SKU/PO/SHIPMENT NBR.  25000003
250010                                                                  25001003
250020     MOVE DK-SHPMT-NBR-ORIG        TO DK-DUMMY-EXT-SHP-ID.        25002003
250030     MOVE 'D'                      TO DK-DUMMY.                   25003003
250040     MOVE '%'                      TO DK-DUMMY-WILDCARD.          25004003
250050                                                                  25005003
250060     EXEC SQL                                                     25006003
250070          SELECT DISTINCT                                         25007003
250080                 A.ASN_LVL_CDE                                    25008003
250090          INTO   :WST00002-ASN-LVL-CDE                            25009003
250091          FROM   WST_SHPMT_XREF_DTL A                             25009103
250092               , TPURITM            B                             25009203
250093               , XLV_SKU            C                             25009303
250094               , TRECITM            D                             25009403
250095          WHERE  A.PO_NBR         = :DK-PO-NBR                    25009503
250096          AND    A.EXT_SHP_ID  LIKE :DK-DUMMY-SHP-ID              25009603
250097          AND    C.SKU_NBR        = :DK-SKU-NBR                   25009703
250098          AND    A.PO_NBR         = B.PO_NBR                      25009803
250099          AND    A.PO_LNE_NBR     = B.APP_PO_LNE_NBR              25009903
250100          AND    B.ITM_NBR        = C.ITM_NBR                     25010003
250101          AND    A.ACTV_CDE       = 'A'                           25010103
250102          AND    A.PO_NBR         =  D.ORD_NBR                    25010203
250103          AND    A.RCVR_SEQ_NBR   =  D.REC_SEQ_NBR                25010303
250104          AND    A.PO_LNE_NBR     =  D.ORD_LNE_NBR                25010403
250105          AND    D.STATUS_CDE    <>  'VE'                         25010503
250106     END-EXEC.                                                    25010603
250107                                                                  25010703
250108     EVALUATE TRUE                                                25010803
250109         WHEN SQLCODE = ZERO                                      25010903
250110             MOVE WST00002-ASN-LVL-CDE TO WS-ASN-LVL-CDE          25011003
250111             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        25011103
250112             MOVE DK-SKU-NBR          TO PV-DISPLAY-SKU-NBR       25011203
250113             IF PS-CICS-SWITCH-YES                                25011303
250114                 INITIALIZE PV-CICS-MSG-AREA                      25011403
250115                 STRING   ' WSKCS309-5045:'                       25011503
250116                          ' ASN LVL CDE='                         25011603
250117                          WS-ASN-LVL-CDE                          25011703
250118                          ' PO:'  PV-DISPLAY-PO-NBR               25011803
250119                          ' SKU:' PV-DISPLAY-SKU-NBR              25011903
250120                          '  '    DK-DUMMY-SHP-ID                 25012003
250121                          DELIMITED BY SIZE                       25012103
250122                          INTO PV-CICS-MSG-AREA                   25012203
250123                 PERFORM 8000-WRITE-TO-CICS-LOG                   25012303
250124             END-IF                                               25012403
250125         WHEN SQLCODE = +100                                      25012503
250126             MOVE  SPACES  TO  WS-ASN-LVL-CDE                     25012603
250127             IF PS-CICS-SWITCH-YES                                25012703
250128                 MOVE SQLCODE    TO PV-DISPLAY-SQLCODE            25012803
250129                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             25012903
250130                 MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR            25013003
250131                 INITIALIZE PV-CICS-MSG-AREA                      25013103
250132                 STRING   ' WSKCS309-5045:'                       25013203
250133                          ' SQLCODE ' PV-DISPLAY-SQLCODE          25013303
250134                          ' PO:'  PV-DISPLAY-PO-NBR               25013403
250135                          ' SKU:' PV-DISPLAY-SKU-NBR              25013503
250136                          '  '    DK-DUMMY-SHP-ID                 25013603
250137                          DELIMITED BY SIZE                       25013703
250138                          INTO PV-CICS-MSG-AREA                   25013803
250139                 PERFORM 8000-WRITE-TO-CICS-LOG                   25013903
250140             END-IF                                               25014003
250141              CONTINUE                                            25014103
250142         WHEN SQLWARN0 NOT = SPACES                               25014203
250143         WHEN SQLCODE NOT = ZERO                                  25014303
250144             MOVE SQLCODE             TO WS007-SQLCODE            25014403
250145                                         PV-DISPLAY-SQLCODE       25014503
250146             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 25014603
250147             MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR                25014703
250148             INITIALIZE PV-CICS-MSG-AREA                          25014803
250149             STRING   ' ' WS007-SRC-TASK-NUMBER                   25014903
250150                      ' WSKCS309-5045 ERROR:'                     25015003
250151                      ' SQL='                                     25015103
250152                      PV-DISPLAY-SQLCODE                          25015203
250153                      ' PO:'  PV-DISPLAY-PO-NBR                   25015303
250154                      ' SKU:' PV-DISPLAY-SKU-NBR                  25015403
250155                      '  '    DK-DUMMY-SHP-ID                     25015503
250156                      DELIMITED BY SIZE                           25015603
250157                                   INTO PV-CICS-MSG-AREA          25015703
250158             PERFORM 8000-WRITE-TO-CICS-LOG                       25015803
250159                                                                  25015903
250160             SET WS007-INVALID-SQL    TO TRUE                     25016003
250161             MOVE '5045-CHK-DUM-SHPMT-DTL-NO-VE '                 25016103
250162                                      TO WS007-SQL-ERROR-PARA     25016203
250163                                         DP013-PARAGRAPH          25016303
250164             MOVE SQLCA               TO WS007-SQLCA              25016403
250165                                         DP013-SQLCA              25016503
250166             STRING 'SQL='                                        25016603
250167                  PV-DISPLAY-SQLCODE                              25016703
250168                  DELIMITED BY SIZE                               25016803
250169                                    INTO WS007-CRA-RET-MSG        25016903
250170             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   25017003
250171             MOVE 'WST_SHPMT_XREF_HDR'                            25017103
250172                                      TO DP013-DB2-TABLE-NAME (1) 25017203
250173             MOVE 'TPURITM'                                       25017303
250174                                      TO DP013-DB2-TABLE-NAME (2) 25017403
250175             MOVE 'XLV_SKU'                                       25017503
250176                                      TO DP013-DB2-TABLE-NAME (3) 25017603
250177             MOVE 'TRECITM'                                       25017703
250178                                      TO DP013-DB2-TABLE-NAME (2) 25017803
250179             SET DP013-DB2-ABEND      TO TRUE                     25017903
250180             PERFORM 9999-ABEND                                   25018003
250181     END-EVALUATE.                                                25018103
250182                                                                  25018203
250183                                                                  25018303
250184******************************************************************25018403
250185* ISSUES WITH EFC'S SENDING CASE RECEIPT PIX (606-03) WITH       *25018503
250186* INVALID CASE NUMBERS, AND INVALID PO NUMBERS.                  *25018603
250187* THIS PROCESS WILL JUST VALIDATE THAT THE CASE NUMBER IS VALID  *25018703
250188* (TSHPUNT) AND THAT THE PO ON THE PIX IS CORRECT.               *25018803
250189******************************************************************25018903
250190 5100-VALIDATE-CASE-PO.                                           25019003
250191                                                                  25019103
250192     IF PS-CICS-SWITCH-YES                                        25019203
250193          STRING  ' ' WS007-SRC-TASK-NUMBER                       25019303
250194                  ' WSKCS309-5100-VALIDATE-CASE-PO        '       25019403
250195                  DELIMITED BY SIZE                               25019503
250196            INTO  PV-CICS-MSG-AREA                                25019603
250197         PERFORM 8000-WRITE-TO-CICS-LOG                           25019703
250198     END-IF.                                                      25019803
250199                                                                  25019903
250200                                                                  25020003
250201     SET  PS-CR-VALID-CASE-NBR-NO                                 25020103
250202          PS-CR-VALID-PO-NBR-NO    TO  TRUE.                      25020203
250203                                                                  25020303
250204     PERFORM 5110-VALIDATE-CASE-NBR                               25020403
250205                                                                  25020503
250206     IF  PS-CR-VALID-CASE-NBR                                     25020603
250207         PERFORM 5120-VALIDATE-PO-NBR                             25020703
250208     END-IF.                                                      25020803
250209                                                                  25020903
250210                                                                  25021003
250211******************************************************************25021103
250212*                                                                *25021203
250213*                                                                *25021303
250214******************************************************************25021403
250215 5110-VALIDATE-CASE-NBR.                                          25021503
250216                                                                  25021603
250217     IF PS-CICS-SWITCH-YES                                        25021703
250218          STRING  ' ' WS007-SRC-TASK-NUMBER                       25021803
250219                  ' WSKCS309-5110-VALIDATE-CASE-NBR       '       25021903
250220                  DELIMITED BY SIZE                               25022003
250221            INTO  PV-CICS-MSG-AREA                                25022103
250222         PERFORM 8000-WRITE-TO-CICS-LOG                           25022203
250223     END-IF.                                                      25022303
250224                                                                  25022403
250225                                                                  25022503
250226     EXEC SQL                                                     25022603
250227          SELECT                                                  25022703
250228                  SHIPT_UNT_ID                                    25022803
250229          INTO                                                    25022903
250230                 :PV-SHIPT_UNT_ID                                 25023003
250231          FROM                                                    25023103
250232                 TSHPUNT                                          25023203
250233          WHERE  SHIPT_UNT_ID   = :DK-CASE-NBR                    25023303
250234          AND    ACTV_IND       = 'A'                             25023403
250235          WITH UR                                                 25023503
250236     END-EXEC.                                                    25023603
250237                                                                  25023703
250238     EVALUATE TRUE                                                25023803
250239         WHEN SQLCODE = ZERO                                      25023903
250240              SET  PS-CR-VALID-CASE-NBR  TO  TRUE                 25024003
250241              IF PS-CICS-SWITCH-YES                               25024103
250242                  INITIALIZE PV-CICS-MSG-AREA                     25024203
250243                  MOVE PV-SHIPT_UNT_ID TO PV-DISPLAY-CRTN         25024303
250244                  STRING   ' WSKCS309-5110:'                      25024403
250245                           ' VALID CASE:'                         25024503
250246                                    PV-DISPLAY-CRTN               25024603
250247                           DELIMITED BY SIZE                      25024703
250248                                     INTO PV-CICS-MSG-AREA        25024803
250249                  PERFORM 8000-WRITE-TO-CICS-LOG                  25024903
250250              END-IF                                              25025003
250260                                                                  25026003
250261         WHEN SQLCODE = +100                                      25026103
250262              SET  PS-CR-VALID-CASE-NBR-NO  TO TRUE               25026203
250263              IF PS-CICS-SWITCH-YES                               25026303
250264                  INITIALIZE PV-CICS-MSG-AREA                     25026403
250265                  MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN             25026503
250266                  STRING   ' WSKCS309-5110:'                      25026603
250267                           ' INVALID CASE:'                       25026703
250268                                    PV-DISPLAY-CRTN               25026803
250269                           ' EFC:'  WS014-DC-LOCATION             25026903
250270                           ' STR:'  WS014-STORE-NUMBER            25027003
250280                           '  '     WS014-RCVD-SHPMT-NBR          25028003
250281                           DELIMITED BY SIZE                      25028103
250282                                     INTO PV-CICS-MSG-AREA        25028203
250283                  PERFORM 8000-WRITE-TO-CICS-LOG                  25028303
250284              END-IF                                              25028403
250285                                                                  25028503
250286* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            25028603
250287*        WHEN SQLCODE = -904                                      25028703
250288*        WHEN SQLCODE = -913                                      25028803
250289*        WHEN SQLCODE = -911                                      25028903
250290              SET  PS-CR-VALID-CASE-NBR-NO  TO TRUE               25029003
250291              MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                25029103
250292              IF PS-CICS-SWITCH-YES                               25029203
250293                  INITIALIZE PV-CICS-MSG-AREA                     25029303
250294                  MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN             25029403
250295                  STRING   ' WSKCS309-5110:'                      25029503
250296                           ' SQL ERROR:'  PV-DISPLAY-SQLCODE      25029603
250297                           ' CRTN:' PV-DISPLAY-CRTN               25029703
250298                           DELIMITED BY SIZE                      25029803
250299                                     INTO PV-CICS-MSG-AREA        25029903
250300                  PERFORM 8000-WRITE-TO-CICS-LOG                  25030003
250301              END-IF                                              25030103
250302                                                                  25030203
250303         WHEN SQLWARN0 NOT = SPACES                               25030303
250304         WHEN SQLCODE NOT = ZERO                                  25030403
250305             MOVE SQLCODE             TO WS007-SQLCODE            25030503
250306                                         PV-DISPLAY-SQLCODE       25030603
250307             MOVE DK-CASE-NBR         TO PV-DISPLAY-CRTN          25030703
250308             INITIALIZE PV-CICS-MSG-AREA                          25030803
250309             STRING   ' ' WS007-SRC-TASK-NUMBER                   25030903
250310                      ' WSKCS309-5110 ERROR:'                     25031003
250311                      ' SQL:'                                     25031103
250312                      PV-DISPLAY-SQLCODE                          25031203
250313                      ' CRTN:' PV-DISPLAY-CRTN                    25031303
250314                      DELIMITED BY SIZE                           25031403
250315                                    INTO PV-CICS-MSG-AREA         25031503
250316             PERFORM 8000-WRITE-TO-CICS-LOG                       25031603
250317                                                                  25031703
250318             SET WS007-INVALID-SQL    TO TRUE                     25031803
250319             MOVE '5110-VALIDATE-CASE-NBR'                        25031903
250320                                      TO WS007-SQL-ERROR-PARA     25032003
250321                                         DP013-PARAGRAPH          25032103
250322             MOVE SQLCA               TO WS007-SQLCA              25032203
250323                                         DP013-SQLCA              25032303
250324             STRING 'SQL:'                                        25032403
250325                  PV-DISPLAY-SQLCODE                              25032503
250326                  DELIMITED BY SIZE                               25032603
250327                                    INTO WS007-CRA-RET-MSG        25032703
250328             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   25032803
250329             MOVE 'TSHPUNT'                                       25032903
250330                                      TO DP013-DB2-TABLE-NAME (1) 25033003
250331             SET DP013-DB2-ABEND      TO TRUE                     25033103
250332             PERFORM 9999-ABEND                                   25033203
250333     END-EVALUATE.                                                25033303
250334                                                                  25033403
250335                                                                  25033503
250336                                                                  25033603
250337******************************************************************25033703
250338*                                                                *25033803
250339*                                                                *25033903
250340******************************************************************25034003
250341 5120-VALIDATE-PO-NBR.                                            25034103
250342                                                                  25034203
250343     IF PS-CICS-SWITCH-YES                                        25034303
250344          STRING  ' ' WS007-SRC-TASK-NUMBER                       25034403
250345                  ' WSKCS309-5120-VALIDATE-PO-NBR         '       25034503
250346                  DELIMITED BY SIZE                               25034603
250347            INTO  PV-CICS-MSG-AREA                                25034703
250348         PERFORM 8000-WRITE-TO-CICS-LOG                           25034803
250349     END-IF.                                                      25034903
250350                                                                  25035003
250351     EXEC SQL                                                     25035103
250352          SELECT                                                  25035203
250353                  DISTINCT(TRN_NBR)                               25035303
250354          INTO                                                    25035403
250355                 :PV-TSHUUPC-TRN-NBR                              25035503
250356          FROM                                                    25035603
250357                 TSHUUPC                                          25035703
250358          WHERE  SHIPT_UNT_ID   = :DK-CASE-NBR                    25035803
250359          WITH UR                                                 25035903
250360     END-EXEC.                                                    25036003
250361                                                                  25036103
250362     EVALUATE TRUE                                                25036203
250363         WHEN SQLCODE = ZERO                                      25036303
250364              IF  PV-TSHUUPC-TRN-NBR  = DK-PO-NBR                 25036403
250365                  IF PS-CICS-SWITCH-YES                           25036503
250366                      INITIALIZE PV-CICS-MSG-AREA                 25036603
250367                      MOVE PV-SHIPT_UNT_ID TO PV-DISPLAY-CRTN     25036703
250368                      STRING   ' WSKCS309-5120:'                  25036803
250369                               ' VALID PO:'                       25036903
250370                                        PV-DISPLAY-CRTN           25037003
250371                               DELIMITED BY SIZE                  25037103
250372                                     INTO PV-CICS-MSG-AREA        25037203
250373                      PERFORM 8000-WRITE-TO-CICS-LOG              25037303
250374                  END-IF                                          25037403
250375              ELSE                                                25037503
250376                  PERFORM 5125-VALIDATE-CASE-LINE                 25037603
250377                  PERFORM 5130-VALIDATE-RCVR                      25037703
250378                                                                  25037803
250379                 MOVE WS014-DC-LOCATION TO UPLDER-OPER-UNT-ID     25037903
250380                 MOVE 'I'               TO UPLDER-UPLD-TRN-CDE    25038003
250390                 MOVE '001'             TO UPLDER-ERR-CDE         25039003
250391                                                                  25039103
250392                 MOVE WS014-STORE-NUMBER                          25039203
250393                                        TO WS024-STORE-NUMBER     25039303
250394                 MOVE WS014-CASE-NUMBER TO WS024-CASE-NUMBER      25039403
250395                 MOVE WS014-PO-NUMBER   TO WS024-PO-NUMBER        25039503
250396                 MOVE WS014-REC-SEQ-NUMBER                        25039603
250397                                        TO WS024-REC-SEQ-NUMBER   25039703
250398                 MOVE WS014-PO-LINE-NUMBER                        25039803
250399                                        TO WS024-PO-LINE-NUMBER   25039903
250400                 MOVE WS014-SKU-NUMBER  TO WS024-SKU-NUMBER       25040003
250401                 MOVE WS014-SKU-QTY     TO WS024-SKU-QTY          25040103
250402                 MOVE WS014-CRE-USER-ID TO WS024-CRE-USER-ID      25040203
250403                 MOVE PV-TSHUUPC-TRN-NBR                          25040303
250404                                        TO WS024-NEW-PO-NUMBER    25040403
250405                 MOVE WS014-RCVD-SHPMT-NBR                        25040503
250406                                        TO WS024-RCVD-SHPMT-NBR   25040603
250407                                                                  25040703
250408                 MOVE WS024-UPLOAD-ERROR-RECORD                   25040803
250409                                        TO UPLDER-PKT-TXT         25040903
250410                 PERFORM 1006-WRITE-TUPLDER                       25041003
250411                                                                  25041103
250412                 MOVE PV-TSHUUPC-TRN-NBR TO WS014-PO-NUMBER       25041203
250413                                            DK-PO-NBR             25041303
250414                                            DK-TRN-NBR            25041403
250415                 MOVE DK-PO-NBR          TO PV-DISPLAY-PO-NBR     25041503
250416                                                                  25041603
250417                                                                  25041703
250418                 IF  WS024-NEW-LINE  > 0                          25041803
250419                     IF  WS014-PO-LINE-NUMBER  =                  25041903
250420                         WS024-NEW-LINE                           25042003
250430                         CONTINUE                                 25043003
250431                     ELSE                                         25043103
250432                         MOVE WS024-NEW-LINE                      25043203
250433                           TO WS014-PO-LINE-NUMBER                25043303
250434                    END-IF                                        25043403
250435                 END-IF                                           25043503
250436                                                                  25043603
250437                 INITIALIZE PV-CICS-MSG-AREA                      25043703
250438                 STRING  ' ' WS007-SRC-TASK-NUMBER                25043803
250439                         ' WSKCS309-5120- UPDATED PO   '          25043903
250440                         ' SSCC:' PV-DISPLAY-CRTN                 25044003
250441                         '  PO:'  PV-DISPLAY-PO-NBR               25044103
250442                         '  LNE:' PV-DISPLAY-LINE                 25044203
250443                         '  RCVR:' PV-DISPLAY-RCVR                25044303
250444                                         DELIMITED BY SIZE        25044403
250445                                    INTO PV-CICS-MSG-AREA         25044503
250446                 PERFORM 8000-WRITE-TO-CICS-LOG                   25044603
250447              END-IF                                              25044703
250448                                                                  25044803
250449              SET  PS-CR-VALID-PO-NBR       TO TRUE               25044903
250450                                                                  25045003
250451         WHEN SQLCODE = +100                                      25045103
250452              SET  PS-CR-VALID-PO-NBR-NO    TO TRUE               25045203
250453              IF PS-CICS-SWITCH-YES                               25045303
250454                  INITIALIZE PV-CICS-MSG-AREA                     25045403
250455                  MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN             25045503
250456                  STRING   ' WSKCS309-5120:'                      25045603
250457                           ' INVALID CASE:'                       25045703
250458                                    PV-DISPLAY-CRTN               25045803
250459                           ' EFC:'  WS014-DC-LOCATION             25045903
250460                           ' STR:'  WS014-STORE-NUMBER            25046003
250461                           '  '     WS014-RCVD-SHPMT-NBR          25046103
250462                           DELIMITED BY SIZE                      25046203
250463                                     INTO PV-CICS-MSG-AREA        25046303
250464                  PERFORM 8000-WRITE-TO-CICS-LOG                  25046403
250465              END-IF                                              25046503
250466                                                                  25046603
250467* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            25046703
250468*        WHEN SQLCODE = -904                                      25046803
250469*        WHEN SQLCODE = -913                                      25046903
250470*        WHEN SQLCODE = -911                                      25047003
250471              SET  PS-CR-VALID-PO-NBR-NO    TO TRUE               25047103
250472              MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                25047203
250473              IF PS-CICS-SWITCH-YES                               25047303
250474                  INITIALIZE PV-CICS-MSG-AREA                     25047403
250475                  MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN             25047503
250476                  STRING   ' WSKCS309-5120:'                      25047603
250477                           ' SQL ERROR:'  PV-DISPLAY-SQLCODE      25047703
250478                           ' CRTN:' PV-DISPLAY-CRTN               25047803
250479                           DELIMITED BY SIZE                      25047903
250480                                     INTO PV-CICS-MSG-AREA        25048003
250481                  PERFORM 8000-WRITE-TO-CICS-LOG                  25048103
250482              END-IF                                              25048203
250483                                                                  25048303
250484         WHEN SQLWARN0 NOT = SPACES                               25048403
250485         WHEN SQLCODE NOT = ZERO                                  25048503
250486             MOVE SQLCODE             TO WS007-SQLCODE            25048603
250487                                         PV-DISPLAY-SQLCODE       25048703
250488             MOVE DK-CASE-NBR         TO PV-DISPLAY-CRTN          25048803
250489             INITIALIZE PV-CICS-MSG-AREA                          25048903
250490             STRING   ' ' WS007-SRC-TASK-NUMBER                   25049003
250491                      ' WSKCS309-5120 ERROR:'                     25049103
250492                      ' SQL:'                                     25049203
250493                      PV-DISPLAY-SQLCODE                          25049303
250494                      ' CRTN:' PV-DISPLAY-CRTN                    25049403
250495                      DELIMITED BY SIZE                           25049503
250496                                    INTO PV-CICS-MSG-AREA         25049603
250497             PERFORM 8000-WRITE-TO-CICS-LOG                       25049703
250498                                                                  25049803
250499             SET WS007-INVALID-SQL    TO TRUE                     25049903
250500             MOVE '5120-VALIDATE-PO-NBR  '                        25050003
250501                                      TO WS007-SQL-ERROR-PARA     25050103
250502                                         DP013-PARAGRAPH          25050203
250503             MOVE SQLCA               TO WS007-SQLCA              25050303
250504                                         DP013-SQLCA              25050403
250505             STRING 'SQL:'                                        25050503
250506                  PV-DISPLAY-SQLCODE                              25050603
250507                  DELIMITED BY SIZE                               25050703
250508                                    INTO WS007-CRA-RET-MSG        25050803
250509             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   25050903
250510             MOVE 'TSHUUPC'                                       25051003
250511                                      TO DP013-DB2-TABLE-NAME (1) 25051103
250512             SET DP013-DB2-ABEND      TO TRUE                     25051203
250513             PERFORM 9999-ABEND                                   25051303
250514     END-EVALUATE.                                                25051403
250515                                                                  25051503
250516                                                                  25051603
250517******************************************************************25051703
250518* CHECK TO SEE THAT LINE NUMBER ON CASE RECEIPT MATCHES THE      *25051803
250519* LINE NUMBER ON THE INBOUND CASE                                *25051903
250520* 11/21/19 - DMH                                                 *25052003
250521******************************************************************25052103
250522 5125-VALIDATE-CASE-LINE.                                         25052203
250523                                                                  25052303
250524     IF PS-CICS-SWITCH-YES                                        25052403
250525          STRING  ' ' WS007-SRC-TASK-NUMBER                       25052503
250526                  ' WSKCS309-5125-VALIDATE-CASE-LINE      '       25052603
250527                  DELIMITED BY SIZE                               25052703
250528            INTO  PV-CICS-MSG-AREA                                25052803
250529         PERFORM 8000-WRITE-TO-CICS-LOG                           25052903
250530     END-IF.                                                      25053003
250531                                                                  25053103
250532     MOVE WS014-SKU-NUMBER   TO  DK-SKU-NBR.                      25053203
250533                                                                  25053303
250534     EXEC SQL                                                     25053403
250535          SELECT                                                  25053503
250536                  A.TRN_LNE_NBR                                   25053603
250537          INTO                                                    25053703
250538                 :PV-TSHUUPC-TRN-LNE-NBR                          25053803
250539          FROM                                                    25053903
250540                 TSHUUPC A                                        25054003
250541               , XLT_UPC B                                        25054103
250542               , XLT_SKU C                                        25054203
250543          WHERE  A.SHIPT_UNT_ID   = :DK-CASE-NBR                  25054303
250544            AND  A.UPC_NBR        = B.UPC_NBR                     25054403
250545            AND  B.INTR_UPC_ID    = C.INTR_UPC_ID                 25054503
250546            AND  C.SKU_NBR        = :DK-SKU-NBR                   25054603
250547          WITH UR                                                 25054703
250548     END-EXEC.                                                    25054803
250549                                                                  25054903
250550     EVALUATE TRUE                                                25055003
250551         WHEN SQLCODE = ZERO                                      25055103
250552                 IF  WS014-PO-LINE-NUMBER  =                      25055203
250553                     PV-TSHUUPC-TRN-LNE-NBR                       25055303
250554                     CONTINUE                                     25055403
250555                 ELSE                                             25055503
250556                     MOVE PV-TSHUUPC-TRN-LNE-NBR                  25055603
250557                       TO WS014-PO-LINE-NUMBER                    25055703
250558                          WS024-NEW-LINE                          25055803
250559                          DK-TRN-LNE-NBR                          25055903
250560                          WS-TRN-LNE-NBR                          25056003
250561                          PV-DISPLAY-LINE                         25056103
250562                 END-IF                                           25056203
250563                                                                  25056303
250564         WHEN SQLCODE = +100                                      25056403
250565              CONTINUE                                            25056503
250566                                                                  25056603
250567* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            25056703
250568*        WHEN SQLCODE = -904                                      25056803
250569*        WHEN SQLCODE = -913                                      25056903
250570*        WHEN SQLCODE = -911                                      25057003
250580              SET  PS-CR-VALID-PO-NBR-NO    TO TRUE               25058003
250590              MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                25059003
250600              IF PS-CICS-SWITCH-YES                               25060003
250610                  INITIALIZE PV-CICS-MSG-AREA                     25061003
250620                  MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN             25062003
250630                  STRING   ' WSKCS309-5125:'                      25063003
250631                           ' SQL ERROR:'  PV-DISPLAY-SQLCODE      25063103
250632                           ' CRTN:' PV-DISPLAY-CRTN               25063203
250633                           DELIMITED BY SIZE                      25063303
250634                                     INTO PV-CICS-MSG-AREA        25063403
250635                  PERFORM 8000-WRITE-TO-CICS-LOG                  25063503
250636              END-IF                                              25063603
250637                                                                  25063703
250638         WHEN SQLWARN0 NOT = SPACES                               25063803
250639         WHEN SQLCODE NOT = ZERO                                  25063903
250640             MOVE SQLCODE             TO WS007-SQLCODE            25064003
250641                                         PV-DISPLAY-SQLCODE       25064103
250642             MOVE DK-CASE-NBR         TO PV-DISPLAY-CRTN          25064203
250643             INITIALIZE PV-CICS-MSG-AREA                          25064303
250644             STRING   ' ' WS007-SRC-TASK-NUMBER                   25064403
250645                      ' WSKCS309-5125 ERROR:'                     25064503
250646                      ' SQL:'                                     25064603
250647                      PV-DISPLAY-SQLCODE                          25064703
250648                      ' CRTN:' PV-DISPLAY-CRTN                    25064803
250649                      DELIMITED BY SIZE                           25064903
250650                                    INTO PV-CICS-MSG-AREA         25065003
250651             PERFORM 8000-WRITE-TO-CICS-LOG                       25065103
250652                                                                  25065203
250653             SET WS007-INVALID-SQL    TO TRUE                     25065303
250654             MOVE '5125-VALIDATE-CASE-LINE'                       25065403
250655                                      TO WS007-SQL-ERROR-PARA     25065503
250656                                         DP013-PARAGRAPH          25065603
250657             MOVE SQLCA               TO WS007-SQLCA              25065703
250658                                         DP013-SQLCA              25065803
250659             STRING 'SQL:'                                        25065903
250660                  PV-DISPLAY-SQLCODE                              25066003
250661                  DELIMITED BY SIZE                               25066103
250662                                    INTO WS007-CRA-RET-MSG        25066203
250663             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   25066303
250664             MOVE 'TSHUUPC'                                       25066403
250665                                      TO DP013-DB2-TABLE-NAME (1) 25066503
250666             SET DP013-DB2-ABEND      TO TRUE                     25066603
250667             PERFORM 9999-ABEND                                   25066703
250668     END-EVALUATE.                                                25066803
250669                                                                  25066903
250670                                                                  25067003
250671******************************************************************25067103
250672* CHECK TO SEE THAT RECEIVER CASE RECEIPT MATCHES THE RECEIVER   *25067203
250673* THAT IS ATTACHED TO THE INBOUND CASE                           *25067303
250674* THIS IS ONLY CHECKED IF THE PO NUMBER ON THE PIX WAS INCORRECT *25067403
250675* 11/21/19 - DMH                                                 *25067503
250676******************************************************************25067603
250677 5130-VALIDATE-RCVR.                                              25067703
250678                                                                  25067803
250679     IF PS-CICS-SWITCH-YES                                        25067903
250680          STRING  ' ' WS007-SRC-TASK-NUMBER                       25068003
250681                  ' WSKCS309-5130-VALIDATE-RCVR           '       25068103
250682                  DELIMITED BY SIZE                               25068203
250683            INTO  PV-CICS-MSG-AREA                                25068303
250684         PERFORM 8000-WRITE-TO-CICS-LOG                           25068403
250685     END-IF.                                                      25068503
250686                                                                  25068603
250687     MOVE PV-TSHUUPC-TRN-NBR  TO  DK-PO-NBR.                      25068703
250688                                                                  25068803
250689     EXEC SQL                                                     25068903
250690          SELECT                                                  25069003
250691                 B.PO_NBR                                         25069103
250692               , B.REC_SEQ_NBR                                    25069203
250693          INTO                                                    25069303
250694                 :PKSLIP-PO-NBR                                   25069403
250695               , :PKSLIP-REC-SEQ-NBR                              25069503
250696          FROM                                                    25069603
250697                 TSHPUNT A                                        25069703
250698               , TPKSLIP B                                        25069803
250699               , TINPKSU C                                        25069903
250700          WHERE  A.SHIPT_UNT_ID   = :DK-CASE-NBR                  25070003
250701          AND    B.PO_NBR         = :DK-PO-NBR                    25070103
250702          AND    A.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                25070203
250703          AND    B.PO_NBR         = C.PO_NBR                      25070303
250704          AND    B.SEQ_NBR        = C.SEQ_NBR                     25070403
250705          AND    A.ACTV_IND       = 'A'                           25070503
250706          AND    B.VER_STAT_CDE   = 'A'                           25070603
250707          AND    B.PKSL_STAT_CDE  = 'AC'                          25070703
250708         WITH UR                                                  25070803
250709     END-EXEC.                                                    25070903
250710                                                                  25071003
250711     EVALUATE TRUE                                                25071103
250712         WHEN SQLCODE = ZERO                                      25071203
250713                 IF  WS014-REC-SEQ-NUMBER  =                      25071303
250714                     PKSLIP-REC-SEQ-NBR                           25071403
250715                     CONTINUE                                     25071503
250716                 ELSE                                             25071603
250717                     MOVE PKSLIP-REC-SEQ-NBR                      25071703
250718                       TO WS014-REC-SEQ-NUMBER                    25071803
250719                          WS024-NEW-RCVR                          25071903
250720                          DK-REC-SEQ-NBR                          25072003
250730                          DK-REC-SEQ-NBR-NEW                      25073003
250731                          PV-DISPLAY-RCVR                         25073103
250732                 END-IF                                           25073203
250733                                                                  25073303
250734         WHEN SQLCODE = +100                                      25073403
250735              CONTINUE                                            25073503
250736                                                                  25073603
250737* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            25073703
250738*        WHEN SQLCODE = -904                                      25073803
250739*        WHEN SQLCODE = -913                                      25073903
250740*        WHEN SQLCODE = -911                                      25074003
250741              SET  PS-CR-VALID-PO-NBR-NO    TO TRUE               25074103
250742              MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                25074203
250743              IF PS-CICS-SWITCH-YES                               25074303
250744                  INITIALIZE PV-CICS-MSG-AREA                     25074403
250745                  MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN             25074503
250746                  STRING   ' WSKCS309-5130-'                      25074603
250747                           ' SQL ERROR:'  PV-DISPLAY-SQLCODE      25074703
250748                           ' CRTN:' PV-DISPLAY-CRTN               25074803
250749                           DELIMITED BY SIZE                      25074903
250750                                     INTO PV-CICS-MSG-AREA        25075003
250751                  PERFORM 8000-WRITE-TO-CICS-LOG                  25075103
250752              END-IF                                              25075203
250753                                                                  25075303
250754         WHEN SQLWARN0 NOT = SPACES                               25075403
250755         WHEN SQLCODE NOT = ZERO                                  25075503
250756             MOVE SQLCODE             TO WS007-SQLCODE            25075603
250757                                         PV-DISPLAY-SQLCODE       25075703
250758             MOVE DK-CASE-NBR         TO PV-DISPLAY-CRTN          25075803
250759             INITIALIZE PV-CICS-MSG-AREA                          25075903
250760             STRING   ' ' WS007-SRC-TASK-NUMBER                   25076003
250761                      ' WSKCS309-5130 ERROR:'                     25076103
250762                      ' SQL:'                                     25076203
250763                      PV-DISPLAY-SQLCODE                          25076303
250764                      ' CRTN:' PV-DISPLAY-CRTN                    25076403
250765                      DELIMITED BY SIZE                           25076503
250766                                    INTO PV-CICS-MSG-AREA         25076603
250767             PERFORM 8000-WRITE-TO-CICS-LOG                       25076703
250768                                                                  25076803
250769             SET WS007-INVALID-SQL    TO TRUE                     25076903
250770             MOVE '5130-VALIDATE-RCVR'                            25077003
250771                                      TO WS007-SQL-ERROR-PARA     25077103
250772                                         DP013-PARAGRAPH          25077203
250773             MOVE SQLCA               TO WS007-SQLCA              25077303
250774                                         DP013-SQLCA              25077403
250775             STRING 'SQL:'                                        25077503
250776                  PV-DISPLAY-SQLCODE                              25077603
250777                  DELIMITED BY SIZE                               25077703
250778                                    INTO WS007-CRA-RET-MSG        25077803
250779             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   25077903
250780             MOVE 'TSHPUNT'                                       25078003
250781                                      TO DP013-DB2-TABLE-NAME (1) 25078103
250782             MOVE 'TPKSLIP'                                       25078203
250783                                      TO DP013-DB2-TABLE-NAME (2) 25078303
250784             MOVE 'TINPKSU'                                       25078403
250785                                      TO DP013-DB2-TABLE-NAME (3) 25078503
250786             SET DP013-DB2-ABEND      TO TRUE                     25078603
250787             PERFORM 9999-ABEND                                   25078703
250788     END-EVALUATE.                                                25078803
250789                                                                  25078903
250790                                                                  25079003
250791                                                                  25079103
250792                                                                  25079203
250793                                                                  25079303
250794******************************************************************25079403
250795*                                                                *25079503
250796*                                                                *25079603
250797******************************************************************25079703
250798 6000-CASE-RECEIPT.                                               25079803
250799                                                                  25079903
250800     IF PS-CICS-SWITCH-YES                                        25080003
250801          STRING  ' ' WS007-SRC-TASK-NUMBER                       25080103
250802                  ' WSKCS309-6000-CASE-RECEIPT            '       25080203
250803                  DELIMITED BY SIZE                               25080303
250804            INTO  PV-CICS-MSG-AREA                                25080403
250805         PERFORM 8000-WRITE-TO-CICS-LOG                           25080503
250806     END-IF.                                                      25080603
250807                                                                  25080703
250808                                                                  25080803
250809     SET PS-NEW-RECITM-CREATED-NO TO TRUE                         25080903
250810                                                                  25081003
250811     IF PS-FREE-ASTRAY-YES                                        25081103
250812          INITIALIZE WS008-COMM-AREA                              25081203
250813          MOVE WS-RCVD-TRIP-ID        TO DK-TRIP-ID               25081303
250814          PERFORM 6010-CHK-FOR-UNVRFD-RCVR-SKU                    25081403
250815          IF WS008-CREATE-RECEIVER                                25081503
250816             PERFORM 6015-CHK-FOR-UNVRFD-RCVR                     25081603
250817             IF WS008-CREATE-RECEIVER                             25081703
250818                PERFORM 6025-PC-RCVR-CREATE-MOD                   25081803
250819             END-IF                                               25081903
250820             PERFORM 2050-CHECK-PURITM                            25082003
250830             PERFORM 3000-INSERT-RECITM                           25083003
250840             PERFORM 3010-INSERT-RECDIS                           25084003
250850             IF PS-OTBND-CART-EXISTS-NO                           25085003
250860                PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD              25086003
250870             END-IF                                               25087003
250880          ELSE                                                    25088003
250890             IF PS-OTBND-CART-EXISTS-NO                           25089003
250900                PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD              25090003
251000             END-IF                                               25100003
251010             PERFORM 2050-CHECK-PURITM                            25101003
251020             PERFORM 3000-INSERT-RECITM                           25102003
251030             PERFORM 3010-INSERT-RECDIS                           25103003
251040          END-IF                                                  25104003
251050          SET PS-RCVR-MATCH-YES TO TRUE                           25105003
251060     ELSE                                                         25106003
251070          PERFORM 6030-CHECK-CARTON                               25107003
251080     END-IF.                                                      25108003
251090                                                                  25109003
251100     IF PS-RCVR-MATCH-NO                                          25110003
251200         MOVE 'WMC'                   TO WS-CART-SRC-CDE          25120003
251300         PERFORM 7000-SKU-RECEIPT                                 25130003
251400     ELSE                                                         25140003
251500         MOVE 'WMU'                   TO WS-CART-SRC-CDE          25150003
251600         PERFORM 6045-CHECK-TSHUNLO-EXISTS                        25160003
251700         IF PS-SHUNLO-CRTN-NOT-EXISTS                             25170003
251800            PERFORM 6040-INSERT-TSHUNLO                           25180003
251900         END-IF                                                   25190003
252000         PERFORM 6050-SELECT-LNE-UPC                              25200003
252100         IF PS-NEW-RECITM-CREATED-NO                              25210003
252200            PERFORM 6060-CHK-RCVR-ITM-STAT                        25220003
252300         END-IF                                                   25230003
252400         IF PS-CASE-LNE-VRFD-NO                                   25240003
252500             PERFORM 4000-OTBND-INSERT                            25250003
252600         END-IF                                                   25260003
252700     END-IF.                                                      25270003
252800                                                                  25280003
252900/                                                                 25290003
253000 6010-CHK-FOR-UNVRFD-RCVR-SKU.                                    25300003
253100                                                                  25310003
253200     IF PS-CICS-SWITCH-YES                                        25320003
253300          STRING  ' ' WS007-SRC-TASK-NUMBER                       25330003
253400                  ' WSKCS309-6010-CHK-FOR-UNVRFD-RCVR-SKU '       25340003
253500                  DELIMITED BY SIZE                               25350003
253600            INTO  PV-CICS-MSG-AREA                                25360003
253700         PERFORM 8000-WRITE-TO-CICS-LOG                           25370003
253800     END-IF.                                                      25380003
253900                                                                  25390003
254000                                                                  25400003
254100     EXEC SQL                                                     25410003
254200          SELECT DISTINCT                                         25420003
254300                 C.ORD_NBR                                        25430003
254400               , C.REC_SEQ_NBR                                    25440003
254500               , C.ORD_LNE_NBR                                    25450003
254600          INTO   :RECITM-ORD-NBR                                  25460003
254700               , :RECITM-REC-SEQ-NBR                              25470003
254800               , :RECITM-ORD-LNE-NBR                              25480003
254900          FROM   TSHIPMT   A                                      25490003
255000               , TSHPTPO   B                                      25500003
255100               , TRECITM   C                                      25510003
255200               , XLV_SKU   D                                      25520003
255300          WHERE  A.TRIP_ID        = :DK-TRIP-ID                   25530003
255400          AND    B.PO_NBR         = :DK-PO-NBR                    25540003
255500          AND    D.SKU_NBR        = :DK-SKU-NBR                   25550003
255600          AND    B.PO_NBR         = C.ORD_NBR                     25560003
255700          AND    A.SHIPT_ID       = B.SHIPT_ID                    25570003
255800          AND    C.ITM_NBR        = D.ITM_NBR                     25580003
255900          AND    B.REC_SEQ_NBR    = C.REC_SEQ_NBR                 25590003
256000          AND    B.PRIM_SHIPT_IND = 'Y'                           25600003
256100          AND    C.VER_STATUS_CDE = 'A'                           25610003
256110          AND    C.STATUS_CDE     <> 'VE'                         25611003
256120     END-EXEC.                                                    25612003
256130                                                                  25613003
256140     EVALUATE TRUE                                                25614003
256150* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            25615003
256160*        WHEN SQLCODE = -904                                      25616003
256170*        WHEN SQLCODE = -913                                      25617003
256180*        WHEN SQLCODE = -911                                      25618003
256190*             CONTINUE                                            25619003
256200         WHEN SQLCODE = +100                                      25620003
256300             SET WS008-CREATE-RECEIVER TO TRUE                    25630003
256400             IF PS-CICS-SWITCH-YES                                25640003
256500                 INITIALIZE PV-CICS-MSG-AREA                      25650003
256600                 MOVE DK-TRIP-ID TO PV-DISPLAY-TRIP               25660003
256700                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             25670003
256800                 MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR            25680003
256900                 STRING   ' WSKCS309-6010:'                       25690003
257000                          ' CREATE RECVR'                         25700003
257100                          ' TRIP:' PV-DISPLAY-TRIP                25710003
257200                          ' PO:'   PV-DISPLAY-PO-NBR              25720003
257300                          ' SKU:'  PV-DISPLAY-SKU-NBR             25730003
257400                          DELIMITED BY SIZE                       25740003
257500                                     INTO PV-CICS-MSG-AREA        25750003
257600                 PERFORM 8000-WRITE-TO-CICS-LOG                   25760003
257700             END-IF                                               25770003
257800         WHEN SQLCODE = ZERO                                      25780003
257900         WHEN SQLCODE = -811                                      25790003
258000             SET WS008-CREATE-PKSLIP   TO TRUE                    25800003
258100             MOVE RECITM-ORD-NBR       TO WS008-PO-NUMBER         25810003
258200             MOVE RECITM-REC-SEQ-NBR   TO WS008-NEW-REC-SEQ-NBR   25820003
258300             IF PS-CICS-SWITCH-YES                                25830003
258400                 INITIALIZE PV-CICS-MSG-AREA                      25840003
258500                 MOVE DK-TRIP-ID TO PV-DISPLAY-TRIP               25850003
258510                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             25851003
258520                 MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR            25852003
258530                 STRING   ' WSKCS309-6010:'                       25853003
258540                          ' CREATE PKSLIP'                        25854003
258550                          ' TRIP:' PV-DISPLAY-TRIP                25855003
258560                          ' PO:'   PV-DISPLAY-PO-NBR              25856003
258570                          ' SKU:'  PV-DISPLAY-SKU-NBR             25857003
258580                          DELIMITED BY SIZE                       25858003
258590                                     INTO PV-CICS-MSG-AREA        25859003
258600                 PERFORM 8000-WRITE-TO-CICS-LOG                   25860003
258700             END-IF                                               25870003
258800         WHEN SQLWARN0 NOT = SPACES                               25880003
258900         WHEN SQLCODE NOT = ZERO                                  25890003
259000             MOVE SQLCODE              TO WS007-SQLCODE           25900003
259100                                          PV-DISPLAY-SQLCODE      25910003
259200             MOVE DK-TRIP-ID TO PV-DISPLAY-TRIP                   25920003
259300             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 25930003
259400             MOVE DK-SKU-NBR TO PV-DISPLAY-SKU-NBR                25940003
259500             INITIALIZE PV-CICS-MSG-AREA                          25950003
259600             STRING   ' ' WS007-SRC-TASK-NUMBER                   25960003
259700                      ' WSKCS309-6010 ERROR:'                     25970003
259800                      ' SQL='                                     25980003
259900                      PV-DISPLAY-SQLCODE                          25990003
260000                      ' TRIP:' PV-DISPLAY-TRIP                    26000003
260100                      ' PO:'   PV-DISPLAY-PO-NBR                  26010003
260200                      ' SKU:'  PV-DISPLAY-SKU-NBR                 26020003
260300                      DELIMITED BY SIZE                           26030003
260400                                     INTO PV-CICS-MSG-AREA        26040003
260500             PERFORM 8000-WRITE-TO-CICS-LOG                       26050003
260600                                                                  26060003
260700             SET WS007-INVALID-SQL     TO TRUE                    26070003
260800             MOVE '6010-CHK-FOR-UNVRFD-RCVR-SKU '                 26080003
260900                                       TO WS007-SQL-ERROR-PARA    26090003
261000                                          DP013-PARAGRAPH         26100003
261100             MOVE SQLCA                TO WS007-SQLCA             26110003
261200                                          DP013-SQLCA             26120003
261300             STRING 'SQL='                                        26130003
261400                  PV-DISPLAY-SQLCODE                              26140003
261500                  DELIMITED BY SIZE                               26150003
261600                                     INTO WS007-CRA-RET-MSG       26160003
261700             MOVE WS007-CRA-RET-MSG    TO DP013-MESSAGE-TEXT (1)  26170003
261800             MOVE 'TSHIPMT'                                       26180003
261900                                       TO DP013-DB2-TABLE-NAME (1)26190003
262000             MOVE 'TSHPTPO'                                       26200003
262100                                       TO DP013-DB2-TABLE-NAME (2)26210003
262200             MOVE 'TRECITM'                                       26220003
262300                                       TO DP013-DB2-TABLE-NAME (3)26230003
262400             MOVE 'XLV_SKU'                                       26240003
262500                                       TO DP013-DB2-TABLE-NAME (4)26250003
262600             SET DP013-DB2-ABEND       TO TRUE                    26260003
262700             PERFORM 9999-ABEND                                   26270003
262800     END-EVALUATE.                                                26280003
262900                                                                  26290003
263000/                                                                 26300003
263100 6015-CHK-FOR-UNVRFD-RCVR.                                        26310003
263200                                                                  26320003
263300     IF PS-CICS-SWITCH-YES                                        26330003
263400          STRING  ' ' WS007-SRC-TASK-NUMBER                       26340003
263500                  ' WSKCS309-6015-CHK-FOR-UNVRFD-RCVR     '       26350003
263600                  DELIMITED BY SIZE                               26360003
263700            INTO  PV-CICS-MSG-AREA                                26370003
263800         PERFORM 8000-WRITE-TO-CICS-LOG                           26380003
263900     END-IF.                                                      26390003
264000                                                                  26400003
264100     EXEC SQL                                                     26410003
264200          SELECT DISTINCT                                         26420003
264300                 C.ORD_NBR                                        26430003
264400               , C.REC_SEQ_NBR                                    26440003
264500          INTO   :RECITM-ORD-NBR                                  26450003
264600               , :RECITM-REC-SEQ-NBR                              26460003
264700          FROM   TSHIPMT   A                                      26470003
264800               , TSHPTPO   B                                      26480003
264900               , TRECITM   C                                      26490003
265000          WHERE  A.TRIP_ID        = :DK-TRIP-ID                   26500003
265100          AND    B.PO_NBR         = :DK-PO-NBR                    26510003
265200          AND    B.PO_NBR         = C.ORD_NBR                     26520003
265300          AND    A.SHIPT_ID       = B.SHIPT_ID                    26530003
265400          AND    B.REC_SEQ_NBR    = C.REC_SEQ_NBR                 26540003
265500          AND    B.PRIM_SHIPT_IND = 'Y'                           26550003
265600          AND    C.VER_STATUS_CDE = 'A'                           26560003
265700          AND    C.STATUS_CDE     <> 'VE'                         26570003
265800     END-EXEC.                                                    26580003
265900                                                                  26590003
266000     EVALUATE TRUE                                                26600003
266010         WHEN SQLCODE = ZERO                                      26601003
266020         WHEN SQLCODE = -811                                      26602003
266030             SET WS008-CREATE-PKSLIP   TO TRUE                    26603003
266040             MOVE RECITM-ORD-NBR       TO WS008-PO-NUMBER         26604003
266050             MOVE RECITM-REC-SEQ-NBR   TO WS008-NEW-REC-SEQ-NBR   26605003
266060             IF PS-CICS-SWITCH-YES                                26606003
266070                 INITIALIZE PV-CICS-MSG-AREA                      26607003
266080                 MOVE DK-TRIP-ID TO PV-DISPLAY-TRIP               26608003
266090                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             26609003
266100                 STRING   ' WSKCS309-6015:'                       26610003
266200                          ' CREATE PKSLIP'                        26620003
266300                          ' TRIP:' PV-DISPLAY-TRIP                26630003
266400                          ' PO:'   PV-DISPLAY-PO-NBR              26640003
266500                          DELIMITED BY SIZE                       26650003
266600                                     INTO PV-CICS-MSG-AREA        26660003
266700                 PERFORM 8000-WRITE-TO-CICS-LOG                   26670003
266800             END-IF                                               26680003
266900         WHEN SQLCODE = +100                                      26690003
267000             SET WS008-CREATE-RECEIVER TO TRUE                    26700003
267100             IF PS-CICS-SWITCH-YES                                26710003
267200                 INITIALIZE PV-CICS-MSG-AREA                      26720003
267300                 MOVE DK-TRIP-ID TO PV-DISPLAY-TRIP               26730003
267400                 MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR             26740003
267500                 STRING   ' WSKCS309-6015:'                       26750003
267600                          ' CREATE RECVR'                         26760003
267700                          ' TRIP:' PV-DISPLAY-TRIP                26770003
267800                          ' PO:'   PV-DISPLAY-PO-NBR              26780003
267900                          DELIMITED BY SIZE                       26790003
268000                                     INTO PV-CICS-MSG-AREA        26800003
268100                 PERFORM 8000-WRITE-TO-CICS-LOG                   26810003
268200             END-IF                                               26820003
268300         WHEN SQLWARN0 NOT = SPACES                               26830003
268400         WHEN SQLCODE NOT = ZERO                                  26840003
268500             MOVE SQLCODE              TO WS007-SQLCODE           26850003
268600                                          PV-DISPLAY-SQLCODE      26860003
268700             MOVE DK-TRIP-ID TO PV-DISPLAY-TRIP                   26870003
268800             MOVE DK-PO-NBR  TO PV-DISPLAY-PO-NBR                 26880003
268900             INITIALIZE PV-CICS-MSG-AREA                          26890003
269000             STRING   ' ' WS007-SRC-TASK-NUMBER                   26900003
269100                      ' WSKCS309-6015 ERROR:'                     26910003
269200                      ' SQL='                                     26920003
269300                      PV-DISPLAY-SQLCODE                          26930003
269400                      ' TRIP:' PV-DISPLAY-TRIP                    26940003
269500                      ' PO:'   PV-DISPLAY-PO-NBR                  26950003
269600                      DELIMITED BY SIZE                           26960003
269700                                     INTO PV-CICS-MSG-AREA        26970003
269800             PERFORM 8000-WRITE-TO-CICS-LOG                       26980003
269900                                                                  26990003
270000             SET WS007-INVALID-SQL     TO TRUE                    27000003
270100             MOVE '6015-CHK-FOR-UNVRFD-RCVR '                     27010003
270200                                       TO WS007-SQL-ERROR-PARA    27020003
270300                                          DP013-PARAGRAPH         27030003
270400             MOVE SQLCA                TO WS007-SQLCA             27040003
270500                                          DP013-SQLCA             27050003
270600             STRING 'SQL='                                        27060003
270700                  PV-DISPLAY-SQLCODE                              27070003
270800                  DELIMITED BY SIZE                               27080003
270900                                     INTO WS007-CRA-RET-MSG       27090003
271000             MOVE WS007-CRA-RET-MSG    TO DP013-MESSAGE-TEXT (1)  27100003
271100             MOVE 'TSHIPMT'                                       27110003
271200                                       TO DP013-DB2-TABLE-NAME (1)27120003
271300             MOVE 'TSHPTPO'                                       27130003
271400                                       TO DP013-DB2-TABLE-NAME (2)27140003
271500             MOVE 'TRECITM'                                       27150003
271600                                       TO DP013-DB2-TABLE-NAME (3)27160003
271700             SET DP013-DB2-ABEND       TO TRUE                    27170003
271800             PERFORM 9999-ABEND                                   27180003
271900     END-EVALUATE.                                                27190003
272000                                                                  27200003
272100 6018-CHECK-PKSLIP.                                               27210003
272200                                                                  27220003
272300     IF PS-CICS-SWITCH-YES                                        27230003
272400          STRING  ' ' WS007-SRC-TASK-NUMBER                       27240003
272500                  ' WSKCS309-6018-CHECK-PKSLIP            '       27250003
272600                  DELIMITED BY SIZE                               27260003
272700            INTO  PV-CICS-MSG-AREA                                27270003
272800         PERFORM 8000-WRITE-TO-CICS-LOG                           27280003
272900     END-IF.                                                      27290003
273000                                                                  27300003
273100                                                                  27310003
273200     MOVE WS008-ORIG-REC-SEQ-NBR TO DK-REC-SEQ-NBR-NEW.           27320003
273300     MOVE  WS014-STORE-NUMBER    TO  DK-STR-NBR.                  27330003
273400                                                                  27340003
273500     EXEC SQL                                                     27350003
273600         SELECT REC_SEQ_NBR                                       27360003
273700               ,SEQ_NBR                                           27370003
273800          INTO :PKSLIP-REC-SEQ-NBR                                27380003
273900             , :PKSLIP-SEQ-NBR                                    27390003
274000           FROM TPKSLIP                                           27400003
274100          WHERE PO_NBR             =  :DK-PO-NBR                  27410003
274200            AND STR_DEST_NBR       =  :DK-STR-NBR                 27420003
274210            AND REC_SEQ_NBR        =  :DK-REC-SEQ-NBR-NEW         27421003
274220            AND CRE_SRC_CDE        = 'FA'                         27422003
274230            AND VER_STAT_CDE       = 'A'                          27423003
274240     END-EXEC.                                                    27424003
274250                                                                  27425003
274260     EVALUATE TRUE                                                27426003
274270         WHEN SQLCODE = ZERO                                      27427003
274280         WHEN SQLCODE = -811                                      27428003
274290             SET WS008-DETACH-ONLY     TO TRUE                    27429003
274300         WHEN SQLCODE = +100                                      27430003
274400             SET WS008-CREATE-PKSLIP   TO TRUE                    27440003
274500         WHEN SQLWARN0 NOT = SPACES                               27450003
274600         WHEN SQLCODE NOT = ZERO                                  27460003
274700             MOVE SQLCODE              TO WS007-SQLCODE           27470003
274710                                          PV-DISPLAY-SQLCODE      27471003
274720             MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR       27472003
274730             MOVE DK-STR-NBR           TO PV-DISPLAY-STORE        27473003
274740             MOVE DK-REC-SEQ-NBR-NEW   TO PV-DISPLAY-RCVR         27474003
274750             INITIALIZE PV-CICS-MSG-AREA                          27475003
274760             STRING   ' ' WS007-SRC-TASK-NUMBER                   27476003
274770                      ' WSKCS309-6018 ERROR:'                     27477003
274780                      ' SQL='                                     27478003
274790                      PV-DISPLAY-SQLCODE                          27479003
274800                      ' PO:'  PV-DISPLAY-PO-NBR                   27480003
274900                      '-'     PV-DISPLAY-RCVR                     27490003
275000                      ' STR:' PV-DISPLAY-STORE                    27500003
275100                      DELIMITED BY SIZE                           27510003
275200                                     INTO PV-CICS-MSG-AREA        27520003
275300             PERFORM 8000-WRITE-TO-CICS-LOG                       27530003
275400                                                                  27540003
275500             SET WS007-INVALID-SQL     TO TRUE                    27550003
275600             MOVE '6018-CHECK-PKSLIP  '                           27560003
275700                                       TO WS007-SQL-ERROR-PARA    27570003
275800                                          DP013-PARAGRAPH         27580003
275900             MOVE SQLCA                TO WS007-SQLCA             27590003
276000                                          DP013-SQLCA             27600003
276100             STRING 'SQL='                                        27610003
276200                  PV-DISPLAY-SQLCODE                              27620003
276300                  DELIMITED BY SIZE                               27630003
276400                                     INTO WS007-CRA-RET-MSG       27640003
276500             MOVE WS007-CRA-RET-MSG    TO DP013-MESSAGE-TEXT (1)  27650003
276600             MOVE 'TPKSLIP'                                       27660003
276700                                       TO DP013-DB2-TABLE-NAME (1)27670003
276800             SET DP013-DB2-ABEND       TO TRUE                    27680003
276900             PERFORM 9999-ABEND                                   27690003
277000     END-EVALUATE.                                                27700003
277100                                                                  27710003
277200/                                                                 27720003
277300 6020-CALL-ADD-UPD-PKSLIP-MOD.                                    27730003
277400                                                                  27740003
277500     IF PS-CICS-SWITCH-YES                                        27750003
277600          STRING  ' ' WS007-SRC-TASK-NUMBER                       27760003
277700                  ' WSKCS309-6020-CALL-ADD-UPD-PKSLIP-MOD '       27770003
277800                  DELIMITED BY SIZE                               27780003
277900            INTO  PV-CICS-MSG-AREA                                27790003
278000         PERFORM 8000-WRITE-TO-CICS-LOG                           27800003
278100     END-IF.                                                      27810003
278200                                                                  27820003
278300     MOVE 'WSKCS309'             TO WS008-PROGRAM-NAME.           27830003
278400     MOVE WS014-CASE-NUMBER      TO WS008-SHIPT-UNT-ID.           27840003
278500     MOVE WS014-PO-NUMBER        TO WS008-PO-NUMBER.              27850003
278600                                                                  27860003
278700     IF WS008-NEW-REC-SEQ-NBR > 0                                 27870003
278800        MOVE WS008-NEW-REC-SEQ-NBR  TO WS008-ORIG-REC-SEQ-NBR     27880003
278900     ELSE                                                         27890003
279000* SEPT 2009 - MARJ HOEFS - ADDED "IF" BELOW                       27900003
279100* IF RECV SEQ # IS NOT ON PIX, USE THE ONE CAPTURED IN PARA 1010. 27910003
279200*                                                                 27920003
279300* DMH 2016-06-09                                                  27930003
279400* USE PV-OTBND-CART-RCVR-SEQ-NBR THE ONE CAPTURED IN PARA 1010.   27940003
279410* THIS IS THE RECEIVER THE CARTON IS ATTACHED TO                  27941003
279420        IF WS014-REC-SEQ-NUMBER > 0  AND                          27942003
279430           PV-OTBND-CART-RCVR-SEQ-NBR  > 0                        27943003
279440            MOVE PV-OTBND-CART-RCVR-SEQ-NBR                       27944003
279450                                        TO WS008-ORIG-REC-SEQ-NBR 27945003
279460        ELSE                                                      27946003
279470        IF WS014-REC-SEQ-NUMBER > 0                               27947003
279480            MOVE WS014-REC-SEQ-NUMBER   TO WS008-ORIG-REC-SEQ-NBR 27948003
279490        ELSE                                                      27949003
279500            MOVE PV-OTBND-CART-RCVR-SEQ-NBR                       27950003
279510                                        TO WS008-ORIG-REC-SEQ-NBR 27951003
279520        END-IF                                                    27952003
279530        END-IF                                                    27953003
279540     END-IF.                                                      27954003
279550                                                                  27955003
279560     PERFORM 6018-CHECK-PKSLIP.                                   27956003
279570                                                                  27957003
279580     MOVE WS-RCVD-TRIP-ID        TO WS008-TRIP-ID                 27958003
279590     MOVE WS014-DC-LOCATION      TO WS008-OPER-UNT-ID             27959003
279600     MOVE WS014-STORE-NUMBER     TO WS008-DEST-STR-NBR            27960003
279700     MOVE WS014-SCAC             TO WS008-SCAC-ID                 27970003
279800     MOVE WS014-CRE-USER-ID      TO WS008-SIGNON-USER-ID          27980003
279900**                                                                27990003
280000     IF WS-ASN-LVL-CDE NOT = 'C'                                  28000003
280100        MOVE WS014-SKU-QTY          TO WS008-ITEM-QTY             28010003
280200        MOVE RECITM-ORD-LNE-NBR     TO WS008-PO-LINE-NBR          28020003
280300        SET WS008-CRE-SKU-LVL-PKSL  TO TRUE                       28030003
280400     END-IF                                                       28040003
280500**                                                                28050003
280600     IF WS008-DETACH-ONLY                                         28060003
280700        MOVE PKSLIP-SEQ-NBR      TO WS008-NEW-PKSL-SEQ-NBR        28070003
280800     END-IF                                                       28080003
280900                                                                  28090003
281000     MOVE LENGTH OF WS008-COMM-AREA                               28100003
281100                                         TO PV-COMMAREA-LENGTH.   28110003
281200                                                                  28120003
281300     EXEC CICS                                                    28130003
281400         LINK PROGRAM  (PC-ADD-UPD-PKSLIP-MOD)                    28140003
281500              COMMAREA (WS008-COMM-AREA)                          28150003
281600              LENGTH   (PV-COMMAREA-LENGTH)                       28160003
281700              RESP     (PV-CICS-RESP)                             28170003
281800     END-EXEC.                                                    28180003
281900                                                                  28190003
282000     EVALUATE TRUE                                                28200003
282100         WHEN WS008-SUCCESSFUL                                    28210003
282200              CONTINUE                                            28220003
282300         WHEN OTHER                                               28230003
282400* JAK 08/2007 - CHANGE ERROR INDICATOR, SHORTEN MESSAGE           28240003
282500*****         STRING 'BAD RETURN FROM '                           28250003
282600*****              PC-ADD-UPD-PKSLIP-MOD                          28260003
282700*****              '  IND='                                       28270003
282800              STRING 'BAD RTRN - '                                28280003
282900                   PC-ADD-UPD-PKSLIP-MOD                          28290003
283000                   ' IND='                                        28300003
283100                   WS008-SUCCESS-IND                              28310003
283200                   DELIMITED BY SIZE                              28320003
283300                                     INTO WS007-CRA-RET-MSG       28330003
283400             INITIALIZE PV-CICS-MSG-AREA                          28340003
283500             STRING   ' ' WS007-SRC-TASK-NUMBER                   28350003
283600                      ' WSKCS309-6020 ERROR:'                     28360003
283700                      ' BAD RETURN FROM ' PC-ADD-UPD-PKSLIP-MOD   28370003
283800                      '  IND='                                    28380003
283900                      WS008-SUCCESS-IND                           28390003
284000                      DELIMITED BY SIZE                           28400003
284100                                    INTO PV-CICS-MSG-AREA         28410003
284200             PERFORM 8000-WRITE-TO-CICS-LOG                       28420003
284300                                                                  28430003
284400*****        SET WS007-ERROR          TO TRUE                     28440003
284500             SET WS007-UPD-PKSLIP-ERR TO TRUE                     28450003
284600             MOVE '6020-CALL-ADD-UPD-PKSLIP-MOD'                  28460003
284700                                      TO WS007-SQL-ERROR-PARA     28470003
284800                                         DP013-PARAGRAPH          28480003
284900             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   28490003
285000             SET DP013-DB2-ABEND      TO TRUE                     28500003
285100             PERFORM 9999-ABEND                                   28510003
285200                                                                  28520003
285300     END-EVALUATE.                                                28530003
285400                                                                  28540003
285500 6025-PC-RCVR-CREATE-MOD.                                         28550003
285600                                                                  28560003
285700     IF PS-CICS-SWITCH-YES                                        28570003
285800          STRING  ' ' WS007-SRC-TASK-NUMBER                       28580003
285900                  ' WSKCS309-6025-PC-RCVR-CREATE-MOD      '       28590003
286000                  DELIMITED BY SIZE                               28600003
286100            INTO  PV-CICS-MSG-AREA                                28610003
286200         PERFORM 8000-WRITE-TO-CICS-LOG                           28620003
286300     END-IF.                                                      28630003
286400                                                                  28640003
286500     SET PS-PO-EXISTS-NO        TO TRUE.                          28650003
286600     PERFORM 6026-CHECK-PO-EXISTS.                                28660003
286700                                                                  28670003
286710     IF  PS-PO-EXISTS                                             28671003
286720                                                                  28672003
286730         MOVE 'WSKCS309'             TO WS008-PROGRAM-NAME        28673003
286740         MOVE WS014-CASE-NUMBER      TO WS008-SHIPT-UNT-ID        28674003
286750         MOVE WS014-PO-NUMBER        TO WS008-PO-NUMBER           28675003
286760         MOVE WS-RCVD-TRIP-ID        TO WS008-TRIP-ID             28676003
286770         MOVE WS014-DC-LOCATION      TO WS008-OPER-UNT-ID         28677003
286780         MOVE WS014-STORE-NUMBER     TO WS008-DEST-STR-NBR        28678003
286790         MOVE WS014-SCAC             TO WS008-SCAC-ID             28679003
286800         MOVE WS014-CRE-USER-ID      TO WS008-SIGNON-USER-ID      28680003
286900         PERFORM 6027-SELECT-PRO-BOL                              28690003
287000         MOVE SHIPMT-BOL-NBR         TO WS008-ORIG-BOL-NBR        28700003
287100         MOVE SHIPMT-PRO-NBR         TO WS008-ORIG-PRO-NBR        28710003
287200         MOVE SHIPMT-CARR-AUTH-ID    TO WS008-CAN-ORIG            28720003
287300                                                                  28730003
287400         MOVE LENGTH OF WS008-COMM-AREA                           28740003
287500                                         TO PV-COMMAREA-LENGTH    28750003
287600                                                                  28760003
287700         EXEC CICS                                                28770003
287800             LINK PROGRAM  (PC-RCVR-CREATE-MOD)                   28780003
287900                  COMMAREA (WS008-COMM-AREA)                      28790003
288000                  LENGTH   (PV-COMMAREA-LENGTH)                   28800003
288100                  RESP     (PV-CICS-RESP)                         28810003
288200         END-EXEC                                                 28820003
288300                                                                  28830003
288400         EVALUATE TRUE                                            28840003
288500             WHEN WS008-SUCCESSFUL                                28850003
288600                  CONTINUE                                        28860003
288700             WHEN OTHER                                           28870003
288800                  STRING 'BAD RTRN - '                            28880003
288900                          PC-RCVR-CREATE-MOD                      28890003
289000                         ' IND='                                  28900003
289100                          WS008-SUCCESS-IND                       28910003
289200                          DELIMITED BY SIZE                       28920003
289300                                     INTO WS007-CRA-RET-MSG       28930003
289400                  INITIALIZE PV-CICS-MSG-AREA                     28940003
289500                  STRING ' ' WS007-SRC-TASK-NUMBER                28950003
289600                         ' WSKCS309-6025 ERROR:'                  28960003
289700                         ' BAD RETURN FROM '                      28970003
289800                                          PC-RCVR-CREATE-MOD      28980003
289900                         '  IND='                                 28990003
290000                          WS008-SUCCESS-IND                       29000003
290100                          DELIMITED BY SIZE                       29010003
290200                                    INTO PV-CICS-MSG-AREA         29020003
290300                  PERFORM 8000-WRITE-TO-CICS-LOG                  29030003
290400                                                                  29040003
290500                  SET WS007-RCVR-CRE-ERR   TO TRUE                29050003
290600                  MOVE '6025-PC-RCVR-CREATE-MOD'                  29060003
290700                                      TO WS007-SQL-ERROR-PARA     29070003
290800                                         DP013-PARAGRAPH          29080003
290900                  MOVE WS007-CRA-RET-MSG                          29090003
291000                                      TO DP013-MESSAGE-TEXT (1)   29100003
291100                 SET DP013-DB2-ABEND      TO TRUE                 29110003
291200                 PERFORM 9999-ABEND                               29120003
291300                                                                  29130003
291400         END-EVALUATE                                             29140003
291500                                                                  29150003
291600     END-IF.                                                      29160003
291700                                                                  29170003
291800                                                                  29180003
291900*---------------------------------------------------------------- 29190003
292000*  CHECK TO MAKE SURE PO EXISTS BEFORE CREATING RECEIVER       -- 29200003
292100*---------------------------------------------------------------- 29210003
292200 6026-CHECK-PO-EXISTS.                                            29220003
292300                                                                  29230003
292400     IF PS-CICS-SWITCH-YES                                        29240003
292500         MOVE WS014-PO-NUMBER       TO  PV-DISPLAY-PO-NBR         29250003
292510         MOVE WS014-REC-SEQ-NUMBER  TO  PV-DISPLAY-RCVR           29251003
292520         MOVE WS014-PO-LINE-NUMBER  TO  PV-DISPLAY-LINE           29252003
292521         MOVE WS014-SKU-NUMBER      TO  PV-DISPLAY-SKU-NBR        29252103
292522          STRING  ' ' WS007-SRC-TASK-NUMBER                       29252203
292523                  ' WSKCS309-6026-CHECK-PO-EXISTS         '       29252303
292524                  DELIMITED BY SIZE                               29252403
292525            INTO  PV-CICS-MSG-AREA                                29252503
292526         PERFORM 8000-WRITE-TO-CICS-LOG                           29252603
292527         INITIALIZE PV-CICS-MSG-AREA                              29252703
292528          STRING  ' ' WS007-SRC-TASK-NUMBER                       29252803
292529                  ' WSKCS309-6026-'                               29252903
292530                    PV-DISPLAY-PO-NBR '-'                         29253003
292540                    PV-DISPLAY-RCVR '-'                           29254003
292550                    PV-DISPLAY-LINE '-'                           29255003
292560                    PV-DISPLAY-SKU-NBR '*'                        29256003
292570                  DELIMITED BY SIZE                               29257003
292571            INTO  PV-CICS-MSG-AREA                                29257103
292572         PERFORM 8000-WRITE-TO-CICS-LOG                           29257203
292573     END-IF.                                                      29257303
292574                                                                  29257403
292575     MOVE WS014-PO-NUMBER  TO PURCHS-PO-NBR.                      29257503
292576     MOVE WS014-SKU-NUMBER TO DK-SKU-NBR.                         29257603
292577                                                                  29257703
292578     EXEC SQL                                                     29257803
292579         SELECT  COUNT(*)                                         29257903
292580           INTO :PV-VALID-PO-CNT                                  29258003
292590           FROM  TPURCHS A                                        29259003
292600              ,  TPURITM B                                        29260003
292601              ,  XLV_SKU C                                        29260103
292602          WHERE  A.PO_NBR         = :PURCHS-PO-NBR                29260203
292603            AND  A.VER_STATUS_CDE = 'A'                           29260303
292604            AND  A.PO_NBR         = B.PO_NBR                      29260403
292605            AND  B.VER_STATUS_CDE = 'A'                           29260503
292606            AND  C.SKU_NBR        = :DK-SKU-NBR                   29260603
292607            AND  C.ITM_NBR        = B.ITM_NBR                     29260703
292608          FETCH FIRST 1 ROW ONLY                                  29260803
292609     END-EXEC.                                                    29260903
292610                                                                  29261003
292611     EVALUATE TRUE                                                29261103
292612         WHEN SQLCODE = ZERO                                      29261203
292613         WHEN SQLCODE = -811                                      29261303
292614              IF  PV-VALID-PO-CNT  > 0                            29261403
292615                  SET  PS-PO-EXISTS   TO  TRUE                    29261503
292616              END-IF                                              29261603
292617                                                                  29261703
292618         WHEN SQLCODE = +100                                      29261803
292619         WHEN SQLCODE = -305                                      29261903
292620             SET PS-PO-EXISTS-NO         TO TRUE                  29262003
292630             SET WS007-INVALID-SQL       TO TRUE                  29263003
292631             MOVE '6026-CHECK-PO-EXISTS'                          29263103
292632                                         TO WS007-SQL-ERROR-PARA  29263203
292633             MOVE 'PO NOT FOUND '                                 29263303
292634                                         TO WS007-CRA-RET-MSG     29263403
292635             MOVE SQLCA                  TO WS007-SQLCA           29263503
292636                                                                  29263603
292637             IF PS-CICS-SWITCH-YES                                29263703
292638                 INITIALIZE PV-CICS-MSG-AREA                      29263803
292639                 MOVE PURCHS-PO-NBR      TO PV-DISPLAY-PO-NBR     29263903
292640                 STRING   ' WSKCS309-6026:'                       29264003
292641                          ' PO NOT FOUND'                         29264103
292642                          ' PO:'   PV-DISPLAY-PO-NBR              29264203
292643                          DELIMITED BY SIZE                       29264303
292644                          INTO PV-CICS-MSG-AREA                   29264403
292645                 PERFORM 8000-WRITE-TO-CICS-LOG                   29264503
292646             END-IF                                               29264603
292647         WHEN SQLWARN0 NOT = SPACES                               29264703
292648         WHEN SQLCODE NOT = ZERO                                  29264803
292649             MOVE SQLCODE             TO WS007-SQLCODE            29264903
292650                                         PV-DISPLAY-SQLCODE       29265003
292660             MOVE PURCHS-PO-NBR       TO PV-DISPLAY-PO-NBR        29266003
292670             INITIALIZE PV-CICS-MSG-AREA                          29267003
292671             STRING   ' ' WS007-SRC-TASK-NUMBER                   29267103
292672                      ' WSKCS309-6026 ERROR:'                     29267203
292673                      ' SQL='                                     29267303
292674                      PV-DISPLAY-SQLCODE                          29267403
292675                      ' PO:'   PV-DISPLAY-PO-NBR                  29267503
292676                      DELIMITED BY SIZE                           29267603
292677                                   INTO PV-CICS-MSG-AREA          29267703
292678             PERFORM 8000-WRITE-TO-CICS-LOG                       29267803
292679                                                                  29267903
292680             SET WS007-INVALID-SQL    TO TRUE                     29268003
292681             MOVE '6026-CHECK-PO-EXISTS'                          29268103
292682                                      TO WS007-SQL-ERROR-PARA     29268203
292683                                         DP013-PARAGRAPH          29268303
292684             MOVE SQLCA               TO WS007-SQLCA              29268403
292685                                         DP013-SQLCA              29268503
292686             STRING 'SQL='                                        29268603
292687                  PV-DISPLAY-SQLCODE                              29268703
292688                  DELIMITED BY SIZE                               29268803
292689                                    INTO WS007-CRA-RET-MSG        29268903
292690             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   29269003
292691             MOVE 'TPURCHS'           TO                          29269103
292692                                       DP013-DB2-TABLE-NAME (1)   29269203
292693             SET DP013-DB2-ABEND      TO TRUE                     29269303
292694             PERFORM 9999-ABEND                                   29269403
292695     END-EVALUATE.                                                29269503
292696                                                                  29269603
292697     IF PS-CICS-SWITCH-YES                                        29269703
292698          INITIALIZE  PV-CICS-MSG-AREA                            29269803
292699          MOVE SQLCODE               TO  PV-DISPLAY-SQLCODE       29269903
292700          MOVE PURCHS-PO-NBR         TO  PV-DISPLAY-PO-NBR        29270003
292701          STRING  ' ' WS007-SRC-TASK-NUMBER                       29270103
292702                  ' WSKCS309-6026  '                              29270203
292703                  ' PO: '  PV-DISPLAY-PO-NBR                      29270303
292704                  ' SQL:'  PV-DISPLAY-SQLCODE                     29270403
292705                  DELIMITED BY SIZE                               29270503
292706            INTO  PV-CICS-MSG-AREA                                29270603
292707         PERFORM 8000-WRITE-TO-CICS-LOG                           29270703
292708     END-IF.                                                      29270803
292709                                                                  29270903
292710                                                                  29271003
292711**--------------------------------------------------------------- 29271103
292712**                                                             -- 29271203
292713**--------------------------------------------------------------- 29271303
292714 6027-SELECT-PRO-BOL.                                             29271403
292715                                                                  29271503
292716     IF PS-CICS-SWITCH-YES                                        29271603
292717          STRING  ' ' WS007-SRC-TASK-NUMBER                       29271703
292718                  ' WSKCS309-6027-SELECT-PRO-BOL          '       29271803
292719                  DELIMITED BY SIZE                               29271903
292720            INTO  PV-CICS-MSG-AREA                                29272003
292730         PERFORM 8000-WRITE-TO-CICS-LOG                           29273003
292740     END-IF.                                                      29274003
292750                                                                  29275003
292760                                                                  29276003
292770* SEPT 2009 - MARJ HOEFS - ADDED "IF" BELOW                       29277003
292780* IF RECV SEQ # IS NOT ON PIX, USE THE ONE CAPTURED IN PARA 1010. 29278003
292790*                                                                 29279003
292800* DMH 2016-06-09                                                  29280003
292900* USE PV-OTBND-CART-RCVR-SEQ-NBR THE ONE CAPTURED IN PARA 1010.   29290003
293000* THIS IS THE RECEIVER THE CARTON IS ATTACHED TO                  29300003
293100     IF WS014-REC-SEQ-NUMBER > 0  AND                             29310003
293200        PV-OTBND-CART-RCVR-SEQ-NBR  > 0                           29320003
293300         MOVE PV-OTBND-CART-RCVR-SEQ-NBR                          29330003
293400                                        TO DK-REC-SEQ-RECITM      29340003
293500     ELSE                                                         29350003
293600     IF WS014-REC-SEQ-NUMBER > 0                                  29360003
293700         MOVE WS014-REC-SEQ-NUMBER       TO DK-REC-SEQ-RECITM     29370003
293800     ELSE                                                         29380003
293900         MOVE PV-OTBND-CART-RCVR-SEQ-NBR TO DK-REC-SEQ-RECITM     29390003
294000     END-IF                                                       29400003
294100     END-IF.                                                      29410003
294200                                                                  29420003
294300* CLT 12-12-2011 WR40574 ADDED CAN (CARR-AUTH-ID) BELOW           29430003
294400     EXEC SQL                                                     29440003
294500       SELECT  B.PRO_NBR                                          29450003
294600             , B.BOL_NBR                                          29460003
294700             , B.CARR_AUTH_ID                                     29470003
294800       INTO   :SHIPMT-PRO-NBR                                     29480003
294810            , :SHIPMT-BOL-NBR                                     29481003
294820            , :SHIPMT-CARR-AUTH-ID                                29482003
294830       FROM    TSHPTPO A                                          29483003
294840              ,TSHIPMT B                                          29484003
294850       WHERE A.PO_NBR         = :DK-PO-NBR                        29485003
294860         AND A.REC_SEQ_NBR    = :DK-REC-SEQ-RECITM                29486003
294870         AND A.PRIM_SHIPT_IND = 'Y'                               29487003
294880         AND A.SHIPT_ID       = B.SHIPT_ID                        29488003
294890     END-EXEC.                                                    29489003
294900                                                                  29490003
295000     EVALUATE TRUE                                                29500003
295100         WHEN SQLCODE = ZERO                                      29510003
295200            CONTINUE                                              29520003
295300         WHEN SQLCODE = +100                                      29530003
295400         WHEN SQLCODE = -811                                      29540003
295500            MOVE PC-UNKNWN-PRO TO SHIPMT-PRO-NBR                  29550003
295600* CLT 02-24-2012 WR40574 START                                    29560003
295700            MOVE PC-UNKNWN-CAN TO SHIPMT-CARR-AUTH-ID             29570003
295800* CLT 02-24-2012 WR40574 END                                      29580003
295810            MOVE DK-PO-NBR     TO SHIPMT-BOL-NBR                  29581003
295820* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            29582003
295830*        WHEN SQLCODE = -904                                      29583003
295840*        WHEN SQLCODE = -913                                      29584003
295850*        WHEN SQLCODE = -911                                      29585003
295860*            INITIALIZE PV-CICS-MSG-AREA                          29586003
295870*            STRING   ' WSKCS309-6027:'                           29587003
295880*                     ' RCVR-MATCH='                              29588003
295890*                     PS-RCVR-MATCH-IND                           29589003
295900*                     DELIMITED BY SIZE                           29590003
296000*                               INTO PV-CICS-MSG-AREA             29600003
296100*            PERFORM 8000-WRITE-TO-CICS-LOG                       29610003
296200         WHEN SQLWARN0 NOT = SPACES                               29620003
296300         WHEN SQLCODE NOT = ZERO                                  29630003
296400             MOVE SQLCODE             TO WS007-SQLCODE            29640003
296500                                         PV-DISPLAY-SQLCODE       29650003
296600             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        29660003
296700             MOVE DK-REC-SEQ-RECITM   TO PV-DISPLAY-RCVR          29670003
296800             INITIALIZE PV-CICS-MSG-AREA                          29680003
296900             STRING   ' ' WS007-SRC-TASK-NUMBER                   29690003
297000                      ' WSKCS309-6027 ERROR:'                     29700003
297100                      ' SQL='                                     29710003
297110                      PV-DISPLAY-SQLCODE                          29711003
297120                      ' PO:'  PV-DISPLAY-PO-NBR                   29712003
297130                      '-'     PV-DISPLAY-RCVR                     29713003
297140                      DELIMITED BY SIZE                           29714003
297150                                    INTO PV-CICS-MSG-AREA         29715003
297160             PERFORM 8000-WRITE-TO-CICS-LOG                       29716003
297170                                                                  29717003
297180             SET WS007-INVALID-SQL    TO TRUE                     29718003
297190             MOVE '6027-SELECT PRO BOL '                          29719003
297200                                      TO WS007-SQL-ERROR-PARA     29720003
297300                                         DP013-PARAGRAPH          29730003
297400             MOVE SQLCA               TO WS007-SQLCA              29740003
297500                                         DP013-SQLCA              29750003
297600             STRING 'SQL='                                        29760003
297700                  PV-DISPLAY-SQLCODE                              29770003
297800                  DELIMITED BY SIZE                               29780003
297900                                    INTO WS007-CRA-RET-MSG        29790003
298000             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   29800003
298100             MOVE 'TSHPTPO'                                       29810003
298200                                      TO DP013-DB2-TABLE-NAME (1) 29820003
298300             MOVE 'TSHIPMT'                                       29830003
298400                                      TO DP013-DB2-TABLE-NAME (2) 29840003
298500             SET DP013-DB2-ABEND      TO TRUE                     29850003
298600             PERFORM 9999-ABEND                                   29860003
298700     END-EVALUATE.                                                29870003
298800                                                                  29880003
298900 6030-CHECK-CARTON.                                               29890003
299000                                                                  29900003
299100     IF PS-CICS-SWITCH-YES                                        29910003
299200          STRING  ' ' WS007-SRC-TASK-NUMBER                       29920003
299300                  ' WSKCS309-6030-CHECK-CARTON            '       29930003
299400                  DELIMITED BY SIZE                               29940003
299500            INTO  PV-CICS-MSG-AREA                                29950003
299600         PERFORM 8000-WRITE-TO-CICS-LOG                           29960003
299700     END-IF.                                                      29970003
299800                                                                  29980003
299900                                                                  29990003
300000     EXEC SQL                                                     30000003
300100          SELECT                                                  30010003
300200                 B.PO_NBR                                         30020003
300300               , B.REC_SEQ_NBR                                    30030003
300400          INTO                                                    30040003
300500                 :PKSLIP-PO-NBR                                   30050003
300600               , :PKSLIP-REC-SEQ-NBR                              30060003
300700          FROM                                                    30070003
300800                 TSHPUNT A                                        30080003
300900               , TPKSLIP B                                        30090003
301000               , TINPKSU C                                        30100003
301100          WHERE  A.SHIPT_UNT_ID   = :DK-CASE-NBR                  30110003
301200          AND    B.PO_NBR         = :DK-PO-NBR                    30120003
301300          AND    A.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                30130003
301400          AND    B.PO_NBR         = C.PO_NBR                      30140003
301500          AND    B.SEQ_NBR        = C.SEQ_NBR                     30150003
301600          AND    A.ACTV_IND       = 'A'                           30160003
301700          AND    B.VER_STAT_CDE   = 'A'                           30170003
301800          AND    B.PKSL_STAT_CDE  = 'AC'                          30180003
301900     END-EXEC.                                                    30190003
302000                                                                  30200003
302100     SET PS-RCVR-MATCH-YES            TO TRUE                     30210003
302200     EVALUATE TRUE                                                30220003
302300         WHEN SQLCODE = ZERO                                      30230003
302310             MOVE PKSLIP-REC-SEQ-NBR  TO WS-REC-SEQ-NBR           30231003
302320             IF PKSLIP-REC-SEQ-NBR NOT = WS014-REC-SEQ-NUMBER     30232003
302330                 SET PS-RCVR-MATCH-NO TO TRUE                     30233003
302340             END-IF                                               30234003
302350             IF PS-CICS-SWITCH-YES                                30235003
302360                 INITIALIZE PV-CICS-MSG-AREA                      30236003
302370                 MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN              30237003
302380                 MOVE DK-PO-NBR   TO PV-DISPLAY-PO-NBR            30238003
302390                 STRING   ' WSKCS309-6030:'                       30239003
302400                          ' RCVR-MATCH='                          30240003
302500                          PS-RCVR-MATCH-IND                       30250003
302600                          ' CRTN:' PV-DISPLAY-CRTN                30260003
302700                          ' PO:'   PV-DISPLAY-PO-NBR              30270003
302800                          DELIMITED BY SIZE                       30280003
302900                                    INTO PV-CICS-MSG-AREA         30290003
303000                 PERFORM 8000-WRITE-TO-CICS-LOG                   30300003
303100             END-IF                                               30310003
303200* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            30320003
303300*        WHEN SQLCODE = -904                                      30330003
303400*        WHEN SQLCODE = -913                                      30340003
303500*        WHEN SQLCODE = -911                                      30350003
303600         WHEN SQLCODE = +100                                      30360003
303700             SET PS-RCVR-MATCH-NO     TO TRUE                     30370003
303800             IF PS-CICS-SWITCH-YES                                30380003
303900                 INITIALIZE PV-CICS-MSG-AREA                      30390003
304000                 MOVE DK-CASE-NBR TO PV-DISPLAY-CRTN              30400003
304100                 MOVE DK-PO-NBR   TO PV-DISPLAY-PO-NBR            30410003
304200                 STRING   ' WSKCS309-6030:'                       30420003
304300                          ' RCVR-MATCH='                          30430003
304400                          PS-RCVR-MATCH-IND                       30440003
304500                          ' CRTN:' PV-DISPLAY-CRTN                30450003
304600                          ' PO:'   PV-DISPLAY-PO-NBR              30460003
304610                          DELIMITED BY SIZE                       30461003
304620                                    INTO PV-CICS-MSG-AREA         30462003
304630                 PERFORM 8000-WRITE-TO-CICS-LOG                   30463003
304640             END-IF                                               30464003
304650         WHEN SQLWARN0 NOT = SPACES                               30465003
304660         WHEN SQLCODE NOT = ZERO                                  30466003
304670             MOVE SQLCODE             TO WS007-SQLCODE            30467003
304680                                         PV-DISPLAY-SQLCODE       30468003
304690             MOVE DK-CASE-NBR         TO PV-DISPLAY-CRTN          30469003
304700             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        30470003
304800             INITIALIZE PV-CICS-MSG-AREA                          30480003
304900             STRING   ' ' WS007-SRC-TASK-NUMBER                   30490003
305000                      ' WSKCS309-6030 ERROR:'                     30500003
305100                      ' SQL='                                     30510003
305200                      PV-DISPLAY-SQLCODE                          30520003
305300                      ' CRTN:' PV-DISPLAY-CRTN                    30530003
305400                      ' PO:'   PV-DISPLAY-PO-NBR                  30540003
305500                      DELIMITED BY SIZE                           30550003
305600                                    INTO PV-CICS-MSG-AREA         30560003
305700             PERFORM 8000-WRITE-TO-CICS-LOG                       30570003
305800                                                                  30580003
305900             SET WS007-INVALID-SQL    TO TRUE                     30590003
306000             MOVE '6030-CHECK-CARTON'                             30600003
306100                                      TO WS007-SQL-ERROR-PARA     30610003
306200                                         DP013-PARAGRAPH          30620003
306300             MOVE SQLCA               TO WS007-SQLCA              30630003
306400                                         DP013-SQLCA              30640003
306500             STRING 'SQL='                                        30650003
306600                  PV-DISPLAY-SQLCODE                              30660003
306700                  DELIMITED BY SIZE                               30670003
306800                                    INTO WS007-CRA-RET-MSG        30680003
306900             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   30690003
307000             MOVE 'TSHPUNT'                                       30700003
307100                                      TO DP013-DB2-TABLE-NAME (1) 30710003
307200             MOVE 'TPKSLIP'                                       30720003
307300                                      TO DP013-DB2-TABLE-NAME (2) 30730003
307310             MOVE 'TINPKSU'                                       30731003
307320                                      TO DP013-DB2-TABLE-NAME (3) 30732003
307330             SET DP013-DB2-ABEND      TO TRUE                     30733003
307340             PERFORM 9999-ABEND                                   30734003
307350     END-EVALUATE.                                                30735003
307360                                                                  30736003
307370/                                                                 30737003
307380 6040-INSERT-TSHUNLO.                                             30738003
307390                                                                  30739003
307400     IF PS-CICS-SWITCH-YES                                        30740003
307500          STRING  ' ' WS007-SRC-TASK-NUMBER                       30750003
307600                  ' WSKCS309-6040-INSERT-TSHUNLO          '       30760003
307700                  DELIMITED BY SIZE                               30770003
307800            INTO  PV-CICS-MSG-AREA                                30780003
307900         PERFORM 8000-WRITE-TO-CICS-LOG                           30790003
308000     END-IF.                                                      30800003
308100                                                                  30810003
308200     INITIALIZE DCLTSHUNLO.                                       30820003
308300     MOVE WS014-CASE-NUMBER       TO SHUNLO-SHIPT-UNT-ID.         30830003
308400     MOVE WS014-DC-LOCATION       TO SHUNLO-OPER-UNT-ID.          30840003
308500     MOVE 1                       TO SHUNLO-FCLTY-ID.             30850003
308600     MOVE 'WRCV'                  TO SHUNLO-SCN-LOC-ID.           30860003
308700     MOVE WS014-CRE-USER-ID       TO SHUNLO-CRE-USR-ID.           30870003
308800     MOVE WS-RCVD-TRIP-ID         TO SHUNLO-TRIP-ID.              30880003
308900     MOVE 'N'                     TO SHUNLO-PRTR-TYP-CDE.         30890003
309000     MOVE 0                       TO SHUNLO-LBL-PRT-BTCH-ID.      30900003
309100     MOVE 'A'                     TO SHUNLO-ACTV-CDE.             30910003
309200                                                                  30920003
309300     EXEC SQL                                                     30930003
309400          INSERT INTO TSHUNLO                                     30940003
309500               (SHIPT_UNT_ID                                      30950003
309600              , OPER_UNT_ID                                       30960003
309700              , FCLTY_ID                                          30970003
309800              , SCN_LOC_ID                                        30980003
309900              , CRE_USR_ID                                        30990003
310000              , CRE_TMST                                          31000003
310100              , TRIP_ID                                           31010003
310200              , PRTR_TYP_CDE                                      31020003
310300              , LBL_PRT_BTCH_ID                                   31030003
310400              , ACTV_CDE)                                         31040003
310500          VALUES                                                  31050003
310600               (:SHUNLO-SHIPT-UNT-ID                              31060003
310700              , :SHUNLO-OPER-UNT-ID                               31070003
310800              , :SHUNLO-FCLTY-ID                                  31080003
310900              , :SHUNLO-SCN-LOC-ID                                31090003
311000              , :SHUNLO-CRE-USR-ID                                31100003
311100              , CURRENT TIMESTAMP                                 31110003
311200              , :SHUNLO-TRIP-ID                                   31120003
311300              , :SHUNLO-PRTR-TYP-CDE                              31130003
311400              , :SHUNLO-LBL-PRT-BTCH-ID                           31140003
311500              , :SHUNLO-ACTV-CDE)                                 31150003
311600     END-EXEC.                                                    31160003
311700                                                                  31170003
311800     EVALUATE TRUE                                                31180003
311900         WHEN SQLCODE = ZERO                                      31190003
312000             IF PS-CICS-SWITCH-YES                                31200003
312100                 MOVE SHUNLO-SHIPT-UNT-ID TO PV-DISPLAY-CRTN      31210003
312200                 MOVE SHUNLO-OPER-UNT-ID  TO PV-DISPLAY-OPER      31220003
312300                 INITIALIZE PV-CICS-MSG-AREA                      31230003
312400                 STRING   ' WSKCS309-6040:'                       31240003
312500                          ' INSERT TSHUNLO FOR '                  31250003
312600                          PV-DISPLAY-OPER '-'                     31260003
312700                          PV-DISPLAY-CRTN                         31270003
312800                          DELIMITED BY SIZE                       31280003
312900                                        INTO PV-CICS-MSG-AREA     31290003
313000                 PERFORM 8000-WRITE-TO-CICS-LOG                   31300003
313100             END-IF                                               31310003
313200         WHEN SQLCODE = -904                                      31320003
313300         WHEN SQLCODE = -913                                      31330003
313400         WHEN SQLCODE = -911                                      31340003
313500         WHEN SQLWARN0 NOT = SPACES                               31350003
313600         WHEN SQLCODE NOT = ZERO                                  31360003
313700             MOVE SQLCODE                TO WS007-SQLCODE         31370003
313800                                            PV-DISPLAY-SQLCODE    31380003
313900             MOVE SHUNLO-SHIPT-UNT-ID    TO PV-DISPLAY-CRTN       31390003
314000             MOVE SHUNLO-OPER-UNT-ID     TO PV-DISPLAY-OPER       31400003
314100             INITIALIZE PV-CICS-MSG-AREA                          31410003
314200             STRING   ' ' WS007-SRC-TASK-NUMBER                   31420003
314300                      ' WSKCS309-6040 ERROR:'                     31430003
314400                      ' SQL='                                     31440003
314500                      PV-DISPLAY-SQLCODE                          31450003
314600                      '  '  PV-DISPLAY-OPER                       31460003
314700                      '-'   PV-DISPLAY-CRTN                       31470003
314800                      DELIMITED BY SIZE                           31480003
314900                                    INTO PV-CICS-MSG-AREA         31490003
315000             PERFORM 8000-WRITE-TO-CICS-LOG                       31500003
315100                                                                  31510003
315200             SET WS007-INVALID-SQL    TO TRUE                     31520003
315300             MOVE '6040-INSERT-TSHUNLO'                           31530003
315400                                      TO WS007-SQL-ERROR-PARA     31540003
315500                                         DP013-PARAGRAPH          31550003
315600             MOVE SQLCA               TO WS007-SQLCA              31560003
315700                                         DP013-SQLCA              31570003
315800             STRING 'SQL='                                        31580003
315900                  PV-DISPLAY-SQLCODE                              31590003
316000                  DELIMITED BY SIZE                               31600003
316100                                     INTO WS007-CRA-RET-MSG       31610003
316200             MOVE WS007-CRA-RET-MSG    TO DP013-MESSAGE-TEXT (1)  31620003
316300             MOVE 'TSHUNLO'                                       31630003
316400                                      TO DP013-DB2-TABLE-NAME (1) 31640003
316500             SET DP013-DB2-ABEND      TO TRUE                     31650003
316600             PERFORM 9999-ABEND                                   31660003
316700     END-EVALUATE.                                                31670003
316800                                                                  31680003
316900 6045-CHECK-TSHUNLO-EXISTS.                                       31690003
317000                                                                  31700003
317100     IF PS-CICS-SWITCH-YES                                        31710003
317200          STRING  ' ' WS007-SRC-TASK-NUMBER                       31720003
317300                  ' WSKCS309-6045-CHECK-TSHUNLO-EXISTS    '       31730003
317400                   WS014-CASE-NUMBER                              31740003
317500                  DELIMITED BY SIZE                               31750003
317600            INTO  PV-CICS-MSG-AREA                                31760003
317700         PERFORM 8000-WRITE-TO-CICS-LOG                           31770003
317800     END-IF.                                                      31780003
317900                                                                  31790003
318000                                                                  31800003
318100     MOVE WS014-CASE-NUMBER       TO SHUNLO-SHIPT-UNT-ID.         31810003
318200                                                                  31820003
318300     EXEC SQL                                                     31830003
318400          SELECT TRIP_ID                                          31840003
318500          INTO                                                    31850003
318600                 :PV-TRIP-ID                                      31860003
318700          FROM                                                    31870003
318800                 TSHUNLO                                          31880003
318900          WHERE SHIPT_UNT_ID  = :SHUNLO-SHIPT-UNT-ID              31890003
319000           AND  SCN_LOC_ID    = 'WRCV'                            31900003
319100     END-EXEC.                                                    31910003
319200                                                                  31920003
319300     EVALUATE TRUE                                                31930003
319400         WHEN SQLCODE = ZERO                                      31940003
319500              SET PS-SHUNLO-CRTN-EXISTS TO TRUE                   31950003
319600         WHEN SQLCODE = +100                                      31960003
319700              SET PS-SHUNLO-CRTN-NOT-EXISTS TO TRUE               31970003
319800              CONTINUE                                            31980003
319900         WHEN SQLCODE = -904                                      31990003
320000         WHEN SQLCODE = -913                                      32000003
320100         WHEN SQLCODE = -911                                      32010003
320200         WHEN SQLWARN0 NOT = SPACES                               32020003
320300         WHEN SQLCODE NOT = ZERO                                  32030003
320400             MOVE SQLCODE                TO WS007-SQLCODE         32040003
320500                                            PV-DISPLAY-SQLCODE    32050003
320600             MOVE SHUNLO-SHIPT-UNT-ID    TO PV-DISPLAY-CRTN       32060003
320700             INITIALIZE PV-CICS-MSG-AREA                          32070003
320800             STRING   ' ' WS007-SRC-TASK-NUMBER                   32080003
320900                      ' WSKCS309-6040 ERROR:'                     32090003
321000                      ' SQL='                                     32100003
321100                      PV-DISPLAY-SQLCODE                          32110003
321200                      ' CRTN:'  PV-DISPLAY-CRTN                   32120003
321300                      DELIMITED BY SIZE                           32130003
321400                                    INTO PV-CICS-MSG-AREA         32140003
321500             PERFORM 8000-WRITE-TO-CICS-LOG                       32150003
321600                                                                  32160003
321700             SET WS007-INVALID-SQL    TO TRUE                     32170003
321800             MOVE '6045-CHECK-TSHUNLO-EXISTS'                     32180003
321900                                      TO WS007-SQL-ERROR-PARA     32190003
322000                                         DP013-PARAGRAPH          32200003
322100             MOVE SQLCA               TO WS007-SQLCA              32210003
322200                                         DP013-SQLCA              32220003
322300             STRING 'SQL='                                        32230003
322400                  PV-DISPLAY-SQLCODE                              32240003
322500                  DELIMITED BY SIZE                               32250003
322600                                     INTO WS007-CRA-RET-MSG       32260003
322700             MOVE WS007-CRA-RET-MSG    TO DP013-MESSAGE-TEXT (1)  32270003
322800             MOVE 'TSHUNLO'                                       32280003
322900                                      TO DP013-DB2-TABLE-NAME (1) 32290003
323000             SET DP013-DB2-ABEND      TO TRUE                     32300003
323100             PERFORM 9999-ABEND                                   32310003
323200     END-EVALUATE.                                                32320003
323210/                                                                 32321003
323220 6050-SELECT-LNE-UPC.                                             32322003
323230                                                                  32323003
323240     IF PS-CICS-SWITCH-YES                                        32324003
323250          STRING  ' ' WS007-SRC-TASK-NUMBER                       32325003
323260                  ' WSKCS309-6050-SELECT-LNE-UPC          '       32326003
323270                  DELIMITED BY SIZE                               32327003
323280            INTO  PV-CICS-MSG-AREA                                32328003
323290         PERFORM 8000-WRITE-TO-CICS-LOG                           32329003
323300     END-IF.                                                      32330003
323400                                                                  32340003
323500                                                                  32350003
323600     MOVE WS014-CASE-NUMBER  TO DK-CASE-NBR.                      32360003
323700                                                                  32370003
323800     EXEC SQL                                                     32380003
323900          SELECT DISTINCT                                         32390003
324000                 C.TRN_LNE_NBR                                    32400003
324100               , C.UPC_NBR                                        32410003
324200          INTO                                                    32420003
324300                 :SHUUPC-TRN-LNE-NBR                              32430003
324400               , :SHUUPC-UPC-NBR                                  32440003
324500          FROM                                                    32450003
324600                 XLV_SKU A                                        32460003
324700               , XLV_UPC B                                        32470003
324800               , TSHUUPC C                                        32480003
324900          WHERE  C.SHIPT_UNT_ID = :DK-CASE-NBR                    32490003
325000          AND    A.SKU_NBR      = :DK-SKU-NBR                     32500003
325100          AND    A.INTR_UPC_ID  = B.INTR_UPC_ID                   32510003
325200          AND    B.UPC_NBR      = C.UPC_NBR                       32520003
325300     END-EXEC.                                                    32530003
325400                                                                  32540003
325500     EVALUATE TRUE                                                32550003
325600         WHEN SQLCODE = ZERO                                      32560003
325700             MOVE SHUUPC-UPC-NBR     TO WS-DISPLAY-4              32570003
325800                                        WS-UPC-NBR                32580003
325900             IF PS-CICS-SWITCH-YES                                32590003
326000                 INITIALIZE PV-CICS-MSG-AREA                      32600003
326010                 MOVE  DK-CASE-NBR   TO PV-DISPLAY-CRTN           32601003
326020                 MOVE  DK-SKU-NBR    TO PV-DISPLAY-SKU-NBR        32602003
326030                 STRING   ' WSKCS309-6050:'                       32603003
326040                          ' UPC:'                                 32604003
326050                          WS-DISPLAY-4                            32605003
326060                          ' CRTN:' PV-DISPLAY-CRTN                32606003
326070                          ' SKU:'  PV-DISPLAY-SKU-NBR             32607003
326080                          DELIMITED BY SIZE                       32608003
326090                          INTO PV-CICS-MSG-AREA                   32609003
326100                 PERFORM 8000-WRITE-TO-CICS-LOG                   32610003
326200             END-IF                                               32620003
326300* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            32630003
326400*        WHEN SQLCODE = -904                                      32640003
326500*        WHEN SQLCODE = -913                                      32650003
326600*        WHEN SQLCODE = -911                                      32660003
326700         WHEN SQLCODE = +100                                      32670003
326800                 MOVE SHUUPC-SHIPT-UNT-ID  TO WS-DISPLAY-1        32680003
326900                 MOVE  DK-CASE-NBR   TO PV-DISPLAY-CRTN           32690003
327000                 MOVE  DK-SKU-NBR    TO PV-DISPLAY-SKU-NBR        32700003
327100                 INITIALIZE PV-CICS-MSG-AREA                      32710003
327200                 STRING   ' WSKCS309-6050:'                       32720003
327300                          ' NO RECS FOR SHIPT UNT ID='            32730003
327400                          ' CRTN:' PV-DISPLAY-CRTN                32740003
327500                          ' SKU:'  PV-DISPLAY-SKU-NBR             32750003
327600                          DELIMITED BY SIZE                       32760003
327700                          INTO PV-CICS-MSG-AREA                   32770003
327800                 PERFORM 8000-WRITE-TO-CICS-LOG                   32780003
327900                 MOVE SQLCODE             TO WS007-SQLCODE        32790003
328000                                             PV-DISPLAY-SQLCODE   32800003
328100                                                                  32810003
328200                 SET WS007-INVALID-SQL    TO TRUE                 32820003
328300                 MOVE '6050-SELECT-LNE-UPC'                       32830003
328400                                          TO WS007-SQL-ERROR-PARA 32840003
328500                                             DP013-PARAGRAPH      32850003
328600                 MOVE SQLCA               TO WS007-SQLCA          32860003
328700                                             DP013-SQLCA          32870003
328800                 STRING 'SQL='                                    32880003
328900                      PV-DISPLAY-SQLCODE                          32890003
329000                      DELIMITED BY SIZE                           32900003
329100                                    INTO WS007-CRA-RET-MSG        32910003
329200                 MOVE WS007-CRA-RET-MSG                           32920003
329300                                        TO DP013-MESSAGE-TEXT (1) 32930003
329400                 MOVE 'XLV_SKU'                                   32940003
329500                                    TO DP013-DB2-TABLE-NAME (1)   32950003
329600                 MOVE 'XLU_UPC'                                   32960003
329700                                    TO DP013-DB2-TABLE-NAME (2)   32970003
329800                 MOVE 'TSHUUPC'                                   32980003
329900                                    TO DP013-DB2-TABLE-NAME (3)   32990003
330000                 SET DP013-DB2-ABEND  TO TRUE                     33000003
330100                 PERFORM 9999-ABEND                               33010003
330200         WHEN SQLWARN0 NOT = SPACES                               33020003
330300         WHEN SQLCODE NOT = ZERO                                  33030003
330400             MOVE SQLCODE             TO WS007-SQLCODE            33040003
330500                                         PV-DISPLAY-SQLCODE       33050003
330600             MOVE  DK-CASE-NBR        TO PV-DISPLAY-CRTN          33060003
330700             MOVE  DK-SKU-NBR         TO PV-DISPLAY-SKU-NBR       33070003
330800             INITIALIZE PV-CICS-MSG-AREA                          33080003
330900             STRING   ' ' WS007-SRC-TASK-NUMBER                   33090003
331000                      ' WSKCS309-6050 ERROR:'                     33100003
331100                      ' SQL='                                     33110003
331200                      PV-DISPLAY-SQLCODE                          33120003
331300                      ' CRTN:' PV-DISPLAY-CRTN                    33130003
331400                      ' SKU:'  PV-DISPLAY-SKU-NBR                 33140003
331500                      DELIMITED BY SIZE                           33150003
331600                                   INTO PV-CICS-MSG-AREA          33160003
331700             PERFORM 8000-WRITE-TO-CICS-LOG                       33170003
331800                                                                  33180003
331900             SET WS007-INVALID-SQL    TO TRUE                     33190003
332000             MOVE '6050-SELECT-LNE-UPC'                           33200003
332100                                      TO WS007-SQL-ERROR-PARA     33210003
332200                                         DP013-PARAGRAPH          33220003
332300             MOVE SQLCA               TO WS007-SQLCA              33230003
332400                                         DP013-SQLCA              33240003
332500             STRING 'SQL='                                        33250003
332600                  PV-DISPLAY-SQLCODE                              33260003
332700                  DELIMITED BY SIZE                               33270003
332800                                    INTO WS007-CRA-RET-MSG        33280003
332900             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   33290003
333000             MOVE 'XLV_SKU'                                       33300003
333100                                    TO DP013-DB2-TABLE-NAME (1)   33310003
333200             MOVE 'XLU_UPC'                                       33320003
333300                                    TO DP013-DB2-TABLE-NAME (2)   33330003
333400             MOVE 'TSHUUPC'                                       33340003
333500                                    TO DP013-DB2-TABLE-NAME (3)   33350003
333600             SET DP013-DB2-ABEND    TO TRUE                       33360003
333700             PERFORM 9999-ABEND                                   33370003
333800     END-EVALUATE.                                                33380003
333900                                                                  33390003
334000/                                                                 33400003
334100 6060-CHK-RCVR-ITM-STAT.                                          33410003
334200                                                                  33420003
334300     IF PS-CICS-SWITCH-YES                                        33430003
334400          STRING  ' ' WS007-SRC-TASK-NUMBER                       33440003
334500                  ' WSKCS309-6060-CHK-RCVR-ITM-STAT       '       33450003
334600                  DELIMITED BY SIZE                               33460003
334700            INTO  PV-CICS-MSG-AREA                                33470003
334800         PERFORM 8000-WRITE-TO-CICS-LOG                           33480003
334900     END-IF.                                                      33490003
335000                                                                  33500003
335100*                                                                 33510003
335200*** DMH 11/8/13                                                   33520003
335300     IF  DK-ORD-LNE-NBR  =  0                                     33530003
335400         MOVE  SHUUPC-TRN-LNE-NBR   TO  DK-ORD-LNE-NBR            33540003
335500     END-IF                                                       33550003
335600*** DMH 11/8/13                                                   33560003
335700*                                                                 33570003
335800                                                                  33580003
335900     EXEC SQL                                                     33590003
336000          SELECT                                                  33600003
336100                 OPER_UNT_ID                                      33610003
336200          INTO                                                    33620003
336300                 :RECITM-OPER-UNT-ID                              33630003
336400          FROM                                                    33640003
336500                 TRECITM                                          33650003
336600          WHERE  ORD_NBR        = :DK-PO-NBR                      33660003
336700          AND    ORD_LNE_NBR    = :DK-ORD-LNE-NBR                 33670003
336800          AND    REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 33680003
336900          AND    VER_STATUS_CDE = 'A'                             33690003
337000          AND    STATUS_CDE     <> 'VE'                           33700003
337100     END-EXEC.                                                    33710003
337200                                                                  33720003
337210     EVALUATE TRUE                                                33721003
337211         WHEN SQLCODE = ZERO                                      33721103
337212             MOVE RECITM-OPER-UNT-ID TO WS-DISPLAY-1              33721203
337213             SET PS-CASE-LNE-VRFD-NO TO TRUE                      33721303
337214             IF PS-CICS-SWITCH-YES                                33721403
337215                 INITIALIZE PV-CICS-MSG-AREA                      33721503
337216                 MOVE DK-PO-NBR       TO  PV-DISPLAY-PO-NBR       33721603
337217                 MOVE DK-ORD-LNE-NBR  TO  PV-DISPLAY-LINE         33721703
337218                 MOVE DK-REC-SEQ-NBR  TO  PV-DISPLAY-RCVR         33721803
337219                 STRING   ' WSKCS309-6060:'                       33721903
337220                          ' LNE VERIFIED FOR '                    33722003
337230                          WS-DISPLAY-1                            33723003
337240                          '-' PV-DISPLAY-PO-NBR                   33724003
337250                          '-' PV-DISPLAY-RCVR                     33725003
337260                          '-' PV-DISPLAY-LINE                     33726003
337270                          DELIMITED BY SIZE                       33727003
337280                          INTO PV-CICS-MSG-AREA                   33728003
337290                 PERFORM 8000-WRITE-TO-CICS-LOG                   33729003
337300             END-IF                                               33730003
337400* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            33740003
337500*        WHEN SQLCODE = -904                                      33750003
337600*        WHEN SQLCODE = -913                                      33760003
337700*        WHEN SQLCODE = -911                                      33770003
337800         WHEN SQLCODE = +100                                      33780003
337900             SET WS007-INVALID-SQL      TO TRUE                   33790003
338000             MOVE SQLCODE               TO WS007-SQLCODE          33800003
338100                                           PV-DISPLAY-SQLCODE     33810003
338200             MOVE 'RCVNG FOR VERIFIED SHPMT'                      33820003
338300                                        TO WS007-CRA-RET-MSG      33830003
338400             IF PS-CICS-SWITCH-YES                                33840003
338500                 MOVE DK-PO-NBR         TO  PV-DISPLAY-PO-NBR     33850003
338600                 MOVE DK-ORD-LNE-NBR    TO  PV-DISPLAY-LINE       33860003
338700                 MOVE DK-REC-SEQ-NBR    TO  PV-DISPLAY-RCVR       33870003
338800                 INITIALIZE PV-CICS-MSG-AREA                      33880003
338810                 STRING   ' WSKCS309-6060:'                       33881003
338820                          ' RCV CASE FOR VERIFIED SHPMT FOR '     33882003
338830                          'PO:' PV-DISPLAY-PO-NBR                 33883003
338840                          '-'   PV-DISPLAY-RCVR                   33884003
338850                          '-'   PV-DISPLAY-LINE                   33885003
338860                          DELIMITED BY SIZE                       33886003
338870                          INTO PV-CICS-MSG-AREA                   33887003
338880                 PERFORM 8000-WRITE-TO-CICS-LOG                   33888003
338890             END-IF                                               33889003
338900                                                                  33890003
339000             MOVE '6060-CHK-RCVR-ITM-STAT'                        33900003
339100                                      TO WS007-SQL-ERROR-PARA     33910003
339200                                         DP013-PARAGRAPH          33920003
339300             MOVE SQLCA               TO WS007-SQLCA              33930003
339400                                         DP013-SQLCA              33940003
339500             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   33950003
339600             MOVE 'TRECITM'                                       33960003
339700                                    TO DP013-DB2-TABLE-NAME (1)   33970003
339800             SET DP013-DB2-ABEND    TO TRUE                       33980003
339900             PERFORM 9999-ABEND                                   33990003
340000         WHEN SQLWARN0 NOT = SPACES                               34000003
340100         WHEN SQLCODE NOT = ZERO                                  34010003
340200             MOVE SQLCODE             TO WS007-SQLCODE            34020003
340300                                         PV-DISPLAY-SQLCODE       34030003
340400             MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR        34040003
340500             MOVE DK-ORD-LNE-NBR      TO PV-DISPLAY-LINE          34050003
340600             MOVE DK-REC-SEQ-NBR      TO PV-DISPLAY-RCVR          34060003
340700             INITIALIZE PV-CICS-MSG-AREA                          34070003
340800             STRING   ' ' WS007-SRC-TASK-NUMBER                   34080003
340900                      ' WSKCS309-6060 ERROR:'                     34090003
341000                      ' SQL='                                     34100003
341100                      PV-DISPLAY-SQLCODE                          34110003
341200                      ' PO:' PV-DISPLAY-PO-NBR                    34120003
341300                      '-'    PV-DISPLAY-RCVR                      34130003
341400                      '-'    PV-DISPLAY-LINE                      34140003
341500                      DELIMITED BY SIZE                           34150003
341600                                   INTO PV-CICS-MSG-AREA          34160003
341700             PERFORM 8000-WRITE-TO-CICS-LOG                       34170003
341800                                                                  34180003
341900             SET WS007-INVALID-SQL    TO TRUE                     34190003
342000             MOVE '6060-CHK-RCVR-ITM-STAT'                        34200003
342100                                      TO WS007-SQL-ERROR-PARA     34210003
342200                                         DP013-PARAGRAPH          34220003
342300             MOVE SQLCA               TO WS007-SQLCA              34230003
342400                                         DP013-SQLCA              34240003
342500             STRING 'SQL='                                        34250003
342600                  PV-DISPLAY-SQLCODE                              34260003
342700                  DELIMITED BY SIZE                               34270003
342800                                    INTO WS007-CRA-RET-MSG        34280003
342900             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   34290003
343000             MOVE 'TRECITM'                                       34300003
343100                                    TO DP013-DB2-TABLE-NAME (1)   34310003
343200             SET DP013-DB2-ABEND    TO TRUE                       34320003
343300             PERFORM 9999-ABEND                                   34330003
343400     END-EVALUATE.                                                34340003
343500                                                                  34350003
343600 7000-SKU-RECEIPT.                                                34360003
343700                                                                  34370003
343800     IF PS-CICS-SWITCH-YES                                        34380003
343900          STRING  ' ' WS007-SRC-TASK-NUMBER                       34390003
344000                  ' WSKCS309-7000-SKU-RECEIPT             '       34400003
344100                  DELIMITED BY SIZE                               34410003
344200            INTO  PV-CICS-MSG-AREA                                34420003
344300         PERFORM 8000-WRITE-TO-CICS-LOG                           34430003
344400     END-IF.                                                      34440003
344500                                                                  34450003
344600**CURSOR SELECTING IF PO/SKU EXISTS ON TRIP                       34460003
344700     MOVE WS-RCVD-TRIP-ID          TO DK-TRIP-ID.                 34470003
344800* CHECK IF RECEIVER EXISTS.                                       34480003
344900     PERFORM 7010-OPEN-PO-RCVR-CSR.                               34490003
345000     PERFORM 7020-FETCH-PO-RCVR-CSR.                              34500003
345100     PERFORM 7030-CLOSE-PO-RCVR-CSR.                              34510003
345200                                                                  34520003
345300     IF PS-RCVR-FOUND-YES                                         34530003
345400**PO/SKU EXISTS ON TRIP                                           34540003
345500        PERFORM 2000-CHECK-LINE-ITEMS                             34550003
345600        PERFORM 7040-CHECK-IF-PKSLIP-IS-FA                        34560003
345700        IF PS-FA-PACK-SLIP-FOUND                                  34570003
345800* FOR FREE ASTRAY PACK SLIP, UPDATE THE QUANTITY.                 34580003
345900* NEVER UPDATE THE QUANTITY ON A NON-FREE ASTRAY PACK SLIP.       34590003
346000            PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD                  34600003
346010        END-IF                                                    34601003
346020     ELSE                                                         34602003
346030**12/19/07  CHANGE IF PO NOT ON TRIP CREATE IT                    34603003
346040                                                                  34604003
346050        INITIALIZE WS008-COMM-AREA                                34605003
346060        MOVE WS-RCVD-TRIP-ID        TO DK-TRIP-ID                 34606003
346070        MOVE 'S'                    TO WS-ASN-LVL-CDE             34607003
346080                                                                  34608003
346090        PERFORM 6010-CHK-FOR-UNVRFD-RCVR-SKU                      34609003
346100                                                                  34610003
346200* CARTON PREFIX 0041 OR 0042 INDICATES THE LABEL WAS APPLIED AT   34620003
346300* A DC BEFORE THE CARTON WAS SHIPPED TO AN EFC.                   34630003
346400      IF WS-CASE-NBR(1:4) NOT EQUAL '0041' AND                    34640003
346500         WS-CASE-NBR(1:4) NOT EQUAL '0042'                        34650003
346600        IF WS008-CREATE-RECEIVER                                  34660003
346700           PERFORM 6015-CHK-FOR-UNVRFD-RCVR                       34670003
346800           IF WS008-CREATE-RECEIVER                               34680003
346900              SET WS008-SKU-LVL-RCVING TO TRUE                    34690003
347000              PERFORM 6025-PC-RCVR-CREATE-MOD                     34700003
347100           END-IF                                                 34710003
347200           PERFORM 2050-CHECK-PURITM                              34720003
347300           IF PS-PURITM-FOUND-NONE  OR                            34730003
347400              (WS008-CREATE-RECEIVER  AND  PS-PO-EXISTS-NO)       34740003
347500                                                                  34750003
347600               MOVE WS014-DC-LOCATION TO PV-DISPLAY-OPER          34760003
347700               MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR        34770003
347800               MOVE DK-SKU-NBR        TO PV-DISPLAY-SKU-NBR       34780003
347900                                                                  34790003
348000               SET WS007-NO-PURITM TO TRUE                        34800003
348100               MOVE 'NO RECS FOUND ON TPURITM'                    34810003
348200                                   TO WS007-CRA-RET-MSG           34820003
348210               MOVE '7000-SKU-RECEIPT'                            34821003
348220                                   TO WS007-SQL-ERROR-PARA        34822003
348230               INITIALIZE PV-CICS-MSG-AREA                        34823003
348240               STRING   ' WSKCS309-7000 ERROR:'                   34824003
348250                        ' NO RECS FOUND ON TPURITM'               34825003
348260                        '  B '                                    34826003
348270                         PV-DISPLAY-OPER   ' '                    34827003
348280                         PV-DISPLAY-PO-NBR ' '                    34828003
348290                         PV-DISPLAY-SKU-NBR                       34829003
348300                        DELIMITED BY SIZE                         34830003
348400                                 INTO PV-CICS-MSG-AREA            34840003
348500               PERFORM 8000-WRITE-TO-CICS-LOG                     34850003
348600           ELSE                                                   34860003
348700               PERFORM 3000-INSERT-RECITM                         34870003
348800               PERFORM 3010-INSERT-RECDIS                         34880003
348900               PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD               34890003
349000           END-IF                                                 34900003
349100        ELSE                                                      34910003
349200           PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD                   34920003
349300           PERFORM 2050-CHECK-PURITM                              34930003
349400           IF PS-PURITM-FOUND-NONE                                34940003
349500               MOVE WS014-DC-LOCATION TO PV-DISPLAY-OPER          34950003
349510               MOVE DK-PO-NBR         TO PV-DISPLAY-PO-NBR        34951003
349511               MOVE DK-SKU-NBR        TO PV-DISPLAY-SKU-NBR       34951103
349512                                                                  34951203
349513               SET WS007-NO-PURITM TO TRUE                        34951303
349514               MOVE 'NO RECS FOUND ON TPURITM'                    34951403
349515                                   TO WS007-CRA-RET-MSG           34951503
349516               MOVE '7000-SKU-RECEIPT'                            34951603
349517                                   TO WS007-SQL-ERROR-PARA        34951703
349518               INITIALIZE PV-CICS-MSG-AREA                        34951803
349519               STRING   ' WSKCS309-7000 ERROR:'                   34951903
349520                        ' NO RECS FOUND ON TPURITM'               34952003
349521                        ' C '                                     34952103
349522                         PV-DISPLAY-OPER   ' '                    34952203
349523                         PV-DISPLAY-PO-NBR ' '                    34952303
349524                         PV-DISPLAY-SKU-NBR                       34952403
349525                        DELIMITED BY SIZE                         34952503
349526                                 INTO PV-CICS-MSG-AREA            34952603
349527               PERFORM 8000-WRITE-TO-CICS-LOG                     34952703
349528           ELSE                                                   34952803
349529               PERFORM 3000-INSERT-RECITM                         34952903
349530               PERFORM 3010-INSERT-RECDIS                         34953003
349540           END-IF                                                 34954003
349550        END-IF                                                    34955003
349551                                                                  34955103
349552        IF  PS-PURITM-FOUND-NONE                                  34955203
349553            CONTINUE                                              34955303
349554        ELSE                                                      34955403
349555            MOVE 'WMC'            TO WS-CART-SRC-CDE              34955503
349556            IF PS-CASE-LNE-VRFD-NO                                34955603
349557               MOVE WS008-NEW-REC-SEQ-NBR TO DK-REC-SEQ-NBR       34955703
349558               PERFORM 2005-CHECK-ITM-NBR                         34955803
349559                                                                  34955903
349560               IF  DK-CASE-NBR  =  ZEROES                         34956003
349570                   SET  PS-OTBND-CART-EXISTS-NO TO TRUE           34957003
349580               ELSE                                               34958003
349590                   PERFORM 1010-CHK-FOR-ORIG-CARTON               34959003
349600               END-IF                                             34960003
349700                                                                  34970003
349800               PERFORM 4000-OTBND-INSERT                          34980003
349900               PERFORM 6020-CALL-ADD-UPD-PKSLIP-MOD               34990003
350000            END-IF                                                35000003
350100        END-IF                                                    35010003
350200                                                                  35020003
350300      END-IF                                                      35030003
350400     END-IF.                                                      35040003
350500                                                                  35050003
350510/                                                                 35051003
350520 7010-OPEN-PO-RCVR-CSR.                                           35052003
350530                                                                  35053003
350540     IF PS-CICS-SWITCH-YES                                        35054003
350541          STRING  ' ' WS007-SRC-TASK-NUMBER                       35054103
350542                  ' WSKCS309-7010-OPEN-PO-RCVR-CSR        '       35054203
350543                  DELIMITED BY SIZE                               35054303
350544            INTO  PV-CICS-MSG-AREA                                35054403
350545         PERFORM 8000-WRITE-TO-CICS-LOG                           35054503
350546     END-IF.                                                      35054603
350547                                                                  35054703
350548                                                                  35054803
350549     SET PS-EOF-PO-RCVR-CSR-NO        TO TRUE.                    35054903
350550     SET PS-RCVR-FOUND-NO             TO TRUE.                    35055003
350560                                                                  35056003
350570     EXEC SQL                                                     35057003
350580          OPEN PO-RCVR-CSR                                        35058003
350590     END-EXEC.                                                    35059003
350600                                                                  35060003
350700     EVALUATE TRUE                                                35070003
350800         WHEN SQLCODE = ZERO                                      35080003
350810             IF PS-CICS-SWITCH-YES                                35081003
350820                 MOVE DK-TRIP-ID  TO  PV-DISPLAY-TRIP             35082003
350830                 MOVE DK-PO-NBR   TO  PV-DISPLAY-PO-NBR           35083003
350840                 MOVE DK-SKU-NBR  TO  PV-DISPLAY-SKU-NBR          35084003
350841                 INITIALIZE PV-CICS-MSG-AREA                      35084103
350842                 STRING   ' WSKCS309-7010:'                       35084203
350843                          ' OPEN PO-RCVR-CSR'                     35084303
350844                          ' TRIP:' PV-DISPLAY-TRIP                35084403
350845                          ' PO:'   PV-DISPLAY-PO-NBR              35084503
350846                          ' SKU:'  PV-DISPLAY-SKU-NBR             35084603
350847                          DELIMITED BY SIZE                       35084703
350848                          INTO PV-CICS-MSG-AREA                   35084803
350849                 PERFORM 8000-WRITE-TO-CICS-LOG                   35084903
350850             END-IF                                               35085003
350851* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            35085103
350852*        WHEN SQLCODE = -904                                      35085203
350853*        WHEN SQLCODE = -913                                      35085303
350854*        WHEN SQLCODE = -911                                      35085403
350855*             CONTINUE                                            35085503
350856         WHEN SQLWARN0 NOT = SPACES                               35085603
350857         WHEN SQLCODE NOT = ZERO                                  35085703
350858             MOVE SQLCODE             TO WS007-SQLCODE            35085803
350859                                         PV-DISPLAY-SQLCODE       35085903
350860             MOVE DK-TRIP-ID          TO  PV-DISPLAY-TRIP         35086003
350870             MOVE DK-PO-NBR           TO  PV-DISPLAY-PO-NBR       35087003
350880             MOVE DK-SKU-NBR          TO  PV-DISPLAY-SKU-NBR      35088003
350890             INITIALIZE PV-CICS-MSG-AREA                          35089003
350900             STRING   ' ' WS007-SRC-TASK-NUMBER                   35090003
351000                      ' WSKCS309-7010 ERROR:'                     35100003
351100                      ' SQL='                                     35110003
351200                      PV-DISPLAY-SQLCODE                          35120003
351300                      ' TRIP:' PV-DISPLAY-TRIP                    35130003
351400                      ' PO:'   PV-DISPLAY-PO-NBR                  35140003
351500                      ' SKU:' PV-DISPLAY-SKU-NBR                  35150003
351600                      DELIMITED BY SIZE                           35160003
351700                                   INTO PV-CICS-MSG-AREA          35170003
351800             PERFORM 8000-WRITE-TO-CICS-LOG                       35180003
351900                                                                  35190003
352000             SET WS007-INVALID-SQL    TO TRUE                     35200003
352100             MOVE '7010-OPEN-PO-RCVR-CSR'                         35210003
352200                                      TO WS007-SQL-ERROR-PARA     35220003
352300                                         DP013-PARAGRAPH          35230003
352400             MOVE SQLCA               TO WS007-SQLCA              35240003
352500                                         DP013-SQLCA              35250003
352510             STRING 'SQL='                                        35251003
352520                  PV-DISPLAY-SQLCODE                              35252003
352530                  DELIMITED BY SIZE                               35253003
352540                                    INTO WS007-CRA-RET-MSG        35254003
352550             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   35255003
352560             SET DP013-DB2-ABEND      TO TRUE                     35256003
352570             PERFORM 9999-ABEND                                   35257003
352580     END-EVALUATE.                                                35258003
352590                                                                  35259003
352600/                                                                 35260003
352700 7020-FETCH-PO-RCVR-CSR.                                          35270003
352800                                                                  35280003
352900     IF PS-CICS-SWITCH-YES                                        35290003
353000          STRING  ' ' WS007-SRC-TASK-NUMBER                       35300003
353100                  ' WSKCS309-7020-FETCH-PO-RCVR-CSR       '       35310003
353200                  DELIMITED BY SIZE                               35320003
353300            INTO  PV-CICS-MSG-AREA                                35330003
353400         PERFORM 8000-WRITE-TO-CICS-LOG                           35340003
353500     END-IF.                                                      35350003
353600                                                                  35360003
353700                                                                  35370003
353800     EXEC SQL                                                     35380003
353900          FETCH PO-RCVR-CSR                                       35390003
354000          INTO                                                    35400003
354100                 :RECITM-ORD-NBR                                  35410003
354200               , :RECITM-REC-SEQ-NBR                              35420003
354300               , :RECITM-STATUS-CDE                               35430003
354400     END-EXEC.                                                    35440003
354500                                                                  35450003
354600* REMOVED "SELECT" HERE SINCE THE CURSOR FETCH WAS ALREADY CODED. 35460003
354700* THE "SELECT" WAS CAUSING A FATAL ERROR WHEN IT GOT -811 EVEN    35470003
354800* THOUGH IT IS VALID TO HAVE MULTIPLE RECEIVERS ON A SHIPMENT     35480003
354900* FOR THE SAME PO AND SKU.                                        35490003
355000                                                                  35500003
355100     EVALUATE TRUE                                                35510003
355200         WHEN SQLCODE = ZERO                                      35520003
355300             SET PS-RCVR-FOUND-YES       TO TRUE                  35530003
355400             SET PS-EOF-PO-RCVR-CSR-YES  TO TRUE                  35540003
355500             MOVE RECITM-REC-SEQ-NBR     TO DK-REC-SEQ-NBR        35550003
355600             IF PS-CICS-SWITCH-YES                                35560003
355700                 MOVE DK-TRIP-ID      TO  PV-DISPLAY-TRIP         35570003
355800                 MOVE DK-PO-NBR       TO  PV-DISPLAY-PO-NBR       35580003
355900                 MOVE DK-SKU-NBR      TO  PV-DISPLAY-SKU-NBR      35590003
356000                 INITIALIZE PV-CICS-MSG-AREA                      35600003
356100                 MOVE RECITM-ORD-NBR     TO WS-DISPLAY-1          35610003
356200                 MOVE RECITM-REC-SEQ-NBR TO WS-DISPLAY-2          35620003
356300                 STRING   ' WSKCS309-7020:'                       35630003
356400                          ' ORD='                                 35640003
356500                          WS-DISPLAY-1                            35650003
356600                          '-'                                     35660003
356700                          WS-DISPLAY-2                            35670003
356710                          ' ST='                                  35671003
356720                          RECITM-STATUS-CDE                       35672003
356730                          ' TRIP:' PV-DISPLAY-TRIP                35673003
356740                          ' PO:'   PV-DISPLAY-PO-NBR              35674003
356750                          ' SKU:'  PV-DISPLAY-SKU-NBR             35675003
356760                          DELIMITED BY SIZE                       35676003
356770                          INTO PV-CICS-MSG-AREA                   35677003
356780                 PERFORM 8000-WRITE-TO-CICS-LOG                   35678003
356790             END-IF                                               35679003
356800* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            35680003
356900*        WHEN SQLCODE = -904                                      35690003
357000*        WHEN SQLCODE = -913                                      35700003
357100*        WHEN SQLCODE = -911                                      35710003
357200         WHEN SQLCODE = +100                                      35720003
357300             SET PS-RCVR-FOUND-NO        TO TRUE                  35730003
357400             SET PS-EOF-PO-RCVR-CSR-YES  TO TRUE                  35740003
357500             IF PS-CICS-SWITCH-YES                                35750003
357600                 MOVE DK-TRIP-ID      TO  PV-DISPLAY-TRIP         35760003
357700                 MOVE DK-PO-NBR       TO  PV-DISPLAY-PO-NBR       35770003
357800                 MOVE DK-SKU-NBR      TO  PV-DISPLAY-SKU-NBR      35780003
357900                 INITIALIZE PV-CICS-MSG-AREA                      35790003
358000                 STRING   ' WSKCS309-7020:'                       35800003
358100                          ' NO VERIFIED PO/RCVR ON TRIP '         35810003
358200                          ' TRIP:' PV-DISPLAY-TRIP                35820003
358300                          ' PO:'   PV-DISPLAY-PO-NBR              35830003
358400                          ' SKU:'  PV-DISPLAY-SKU-NBR             35840003
358500                          DELIMITED BY SIZE                       35850003
358600                          INTO PV-CICS-MSG-AREA                   35860003
358700                 PERFORM 8000-WRITE-TO-CICS-LOG                   35870003
358800             END-IF                                               35880003
358900         WHEN SQLWARN0 NOT = SPACES                               35890003
359000         WHEN SQLCODE NOT = ZERO                                  35900003
359100             MOVE SQLCODE             TO WS007-SQLCODE            35910003
359200                                         PV-DISPLAY-SQLCODE       35920003
359300             MOVE DK-TRIP-ID          TO  PV-DISPLAY-TRIP         35930003
359400             MOVE DK-PO-NBR           TO  PV-DISPLAY-PO-NBR       35940003
359500             MOVE DK-SKU-NBR          TO  PV-DISPLAY-SKU-NBR      35950003
359600             INITIALIZE PV-CICS-MSG-AREA                          35960003
359700             STRING   ' ' WS007-SRC-TASK-NUMBER                   35970003
359800                      ' WSKCS309-7020 ERROR:'                     35980003
359900                      ' SQL='                                     35990003
360000                      PV-DISPLAY-SQLCODE                          36000003
360100                      ' TRIP:' PV-DISPLAY-TRIP                    36010003
360200                      ' PO:'   PV-DISPLAY-PO-NBR                  36020003
360300                      ' SKU:'  PV-DISPLAY-SKU-NBR                 36030003
360400                      DELIMITED BY SIZE                           36040003
360500                                   INTO PV-CICS-MSG-AREA          36050003
360600             PERFORM 8000-WRITE-TO-CICS-LOG                       36060003
360700                                                                  36070003
360800             SET WS007-INVALID-SQL    TO TRUE                     36080003
360900             MOVE '7020-FETCH-PO-RCVR-CSR'                        36090003
361000                                      TO WS007-SQL-ERROR-PARA     36100003
361100                                         DP013-PARAGRAPH          36110003
361200             MOVE SQLCA               TO WS007-SQLCA              36120003
361300                                         DP013-SQLCA              36130003
361400             STRING 'SQL='                                        36140003
361500                  PV-DISPLAY-SQLCODE                              36150003
361600                  DELIMITED BY SIZE                               36160003
361700                                    INTO WS007-CRA-RET-MSG        36170003
361800             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   36180003
361900             MOVE 'TSHIPMT'                                       36190003
362000                                    TO DP013-DB2-TABLE-NAME (1)   36200003
362100             MOVE 'TSHPTPO'                                       36210003
362200                                    TO DP013-DB2-TABLE-NAME (2)   36220003
362300             MOVE 'TRECITM'                                       36230003
362400                                    TO DP013-DB2-TABLE-NAME (3)   36240003
362500             MOVE 'XLV_SKU'                                       36250003
362600                                    TO DP013-DB2-TABLE-NAME (4)   36260003
362700             SET DP013-DB2-ABEND    TO TRUE                       36270003
362800             PERFORM 9999-ABEND                                   36280003
362900     END-EVALUATE.                                                36290003
363000                                                                  36300003
363100/                                                                 36310003
363200 7030-CLOSE-PO-RCVR-CSR.                                          36320003
363300                                                                  36330003
363400     IF PS-CICS-SWITCH-YES                                        36340003
363500          STRING  ' ' WS007-SRC-TASK-NUMBER                       36350003
363600                  ' WSKCS309-7030-CLOSE-PO-RCVR-CSR       '       36360003
363700                  DELIMITED BY SIZE                               36370003
363800            INTO  PV-CICS-MSG-AREA                                36380003
363900         PERFORM 8000-WRITE-TO-CICS-LOG                           36390003
364000     END-IF.                                                      36400003
364100                                                                  36410003
364200                                                                  36420003
364300     EXEC SQL                                                     36430003
364400          CLOSE PO-RCVR-CSR                                       36440003
364500     END-EXEC.                                                    36450003
364600                                                                  36460003
364700     EVALUATE TRUE                                                36470003
364800         WHEN SQLCODE = ZERO                                      36480003
364900            IF PS-CICS-SWITCH-YES                                 36490003
365000                 MOVE DK-TRIP-ID          TO  PV-DISPLAY-TRIP     36500003
365100                 MOVE DK-PO-NBR           TO  PV-DISPLAY-PO-NBR   36510003
365200                 MOVE DK-SKU-NBR          TO  PV-DISPLAY-SKU-NBR  36520003
365300                 INITIALIZE PV-CICS-MSG-AREA                      36530003
365400                 STRING   ' WSKCS309-7030:'                       36540003
365500                          ' CLOSE PO-RCVR-CSR'                    36550003
365600                          ' TRIP:' PV-DISPLAY-TRIP                36560003
365700                          ' PO:'   PV-DISPLAY-PO-NBR              36570003
365800                          ' SKU:'  PV-DISPLAY-SKU-NBR             36580003
365900                          DELIMITED BY SIZE                       36590003
366000                          INTO PV-CICS-MSG-AREA                   36600003
366100                 PERFORM 8000-WRITE-TO-CICS-LOG                   36610003
366200             END-IF                                               36620003
366300* SQLCODE -904, -913, -911 SHOULD BE TREATED AS FATAL.            36630003
366400*        WHEN SQLCODE = -904                                      36640003
366500*        WHEN SQLCODE = -913                                      36650003
366600*        WHEN SQLCODE = -911                                      36660003
366700*             CONTINUE                                            36670003
366800         WHEN SQLWARN0 NOT = SPACES                               36680003
366900         WHEN SQLCODE NOT = ZERO                                  36690003
367000             MOVE SQLCODE             TO WS007-SQLCODE            36700003
367100                                         PV-DISPLAY-SQLCODE       36710003
367110             MOVE DK-TRIP-ID          TO  PV-DISPLAY-TRIP         36711003
367120             MOVE DK-PO-NBR           TO  PV-DISPLAY-PO-NBR       36712003
367130             MOVE DK-SKU-NBR          TO  PV-DISPLAY-SKU-NBR      36713003
367140             INITIALIZE PV-CICS-MSG-AREA                          36714003
367150             STRING   ' ' WS007-SRC-TASK-NUMBER                   36715003
367160                      ' WSKCS309-7030 ERROR:'                     36716003
367170                      ' SQL='                                     36717003
367180                      PV-DISPLAY-SQLCODE                          36718003
367190                      ' TRIP:' PV-DISPLAY-TRIP                    36719003
367200                      ' PO:'   PV-DISPLAY-PO-NBR                  36720003
367300                      ' SKU:'  PV-DISPLAY-SKU-NBR                 36730003
367400                      DELIMITED BY SIZE                           36740003
367500                                   INTO PV-CICS-MSG-AREA          36750003
367600             PERFORM 8000-WRITE-TO-CICS-LOG                       36760003
367700                                                                  36770003
367800             SET WS007-INVALID-SQL    TO TRUE                     36780003
367900             MOVE '7030-CLOSE-PO-RCVR-CSR'                        36790003
368000                                      TO WS007-SQL-ERROR-PARA     36800003
368100                                         DP013-PARAGRAPH          36810003
368200             MOVE SQLCA               TO WS007-SQLCA              36820003
368300                                         DP013-SQLCA              36830003
368400             STRING 'SQL='                                        36840003
368500                  PV-DISPLAY-SQLCODE                              36850003
368600                  DELIMITED BY SIZE                               36860003
368700                                    INTO WS007-CRA-RET-MSG        36870003
368800             MOVE WS007-CRA-RET-MSG   TO DP013-MESSAGE-TEXT (1)   36880003
368900             SET DP013-DB2-ABEND      TO TRUE                     36890003
369000             PERFORM 9999-ABEND                                   36900003
369100     END-EVALUATE.                                                36910003
369110                                                                  36911003
369120/                                                                 36912003
369130 7040-CHECK-IF-PKSLIP-IS-FA.                                      36913003
369140                                                                  36914003
369150                                                                  36915003
369160     IF PS-CICS-SWITCH-YES                                        36916003
369170          STRING  ' ' WS007-SRC-TASK-NUMBER                       36917003
369180                  ' WSKCS309-7040-CHECK-IF-PKSLIP-IS-FA   '       36918003
369190                  DELIMITED BY SIZE                               36919003
369200            INTO  PV-CICS-MSG-AREA                                36920003
369300         PERFORM 8000-WRITE-TO-CICS-LOG                           36930003
369400     END-IF.                                                      36940003
369500                                                                  36950003
369600     MOVE  WS014-STORE-NUMBER    TO  DK-STR-NBR.                  36960003
369700     IF WS008-NEW-REC-SEQ-NBR > 0                                 36970003
369800         MOVE WS008-NEW-REC-SEQ-NBR  TO PV-RCVR-SEQ-NBR           36980003
369900     ELSE                                                         36990003
370000         MOVE PV-OTBND-CART-RCVR-SEQ-NBR                          37000003
370100                                     TO PV-RCVR-SEQ-NBR           37010003
370200     END-IF.                                                      37020003
370300                                                                  37030003
370400     EXEC SQL                                                     37040003
370500         SELECT SEQ_NBR                                           37050003
370600          INTO :PKSLIP-SEQ-NBR                                    37060003
370700           FROM TPKSLIP                                           37070003
370800          WHERE PO_NBR             =  :DK-PO-NBR                  37080003
370900            AND REC_SEQ_NBR        =  :PV-RCVR-SEQ-NBR            37090003
371000            AND STR_DEST_NBR       =  :DK-STR-NBR                 37100003
371100            AND CRE_SRC_CDE        = 'FA'                         37110003
371200            AND VER_STAT_CDE       = 'A'                          37120003
371300     END-EXEC.                                                    37130003
371310                                                                  37131003
371320     EVALUATE TRUE                                                37132003
371330         WHEN SQLCODE = ZERO                                      37133003
371340             MOVE PKSLIP-SEQ-NBR TO WS008-ORIG-PKSL-SEQ-NBR       37134003
371350             SET PS-FA-PACK-SLIP-FOUND TO TRUE                    37135003
371360             CONTINUE                                             37136003
371370         WHEN SQLCODE = +100                                      37137003
371380             SET PS-FA-PACK-SLIP-NOT-FOUND TO TRUE                37138003
371390         WHEN SQLWARN0 NOT = SPACES                               37139003
371400         WHEN SQLCODE NOT = ZERO                                  37140003
371500             MOVE SQLCODE              TO WS007-SQLCODE           37150003
371600                                          PV-DISPLAY-SQLCODE      37160003
371700             MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR       37170003
371800             MOVE PV-RCVR-SEQ-NBR      TO PV-DISPLAY-RCVR         37180003
371900             MOVE DK-STR-NBR           TO PV-DISPLAY-STORE        37190003
372000             INITIALIZE PV-CICS-MSG-AREA                          37200003
372100             STRING   ' ' WS007-SRC-TASK-NUMBER                   37210003
372200                      ' WSKCS309-6018 ERROR:'                     37220003
372300                      ' SQL='                                     37230003
372400                      PV-DISPLAY-SQLCODE                          37240003
372500                      ' PO:'  PV-DISPLAY-PO-NBR                   37250003
372600                      '-'     PV-DISPLAY-RCVR                     37260003
372700                      ' STR:' PV-DISPLAY-STORE                    37270003
372800                      DELIMITED BY SIZE                           37280003
372900                                     INTO PV-CICS-MSG-AREA        37290003
373000             PERFORM 8000-WRITE-TO-CICS-LOG                       37300003
373100                                                                  37310003
373200             SET WS007-INVALID-SQL     TO TRUE                    37320003
373300             MOVE '6018-CHECK-PKSLIP  '                           37330003
373400                                       TO WS007-SQL-ERROR-PARA    37340003
373410                                          DP013-PARAGRAPH         37341003
373420             MOVE SQLCA                TO WS007-SQLCA             37342003
373430                                          DP013-SQLCA             37343003
373440             STRING 'SQL='                                        37344003
373450                  PV-DISPLAY-SQLCODE                              37345003
373460                  DELIMITED BY SIZE                               37346003
373461                                     INTO WS007-CRA-RET-MSG       37346103
373462             MOVE WS007-CRA-RET-MSG    TO DP013-MESSAGE-TEXT (1)  37346203
373463             MOVE 'TPKSLIP'                                       37346303
373464                                       TO DP013-DB2-TABLE-NAME (1)37346403
373465             SET DP013-DB2-ABEND       TO TRUE                    37346503
373466             PERFORM 9999-ABEND                                   37346603
373467     END-EVALUATE.                                                37346703
373468                                                                  37346803
373469 8000-WRITE-TO-CICS-LOG.                                          37346903
373470                                                                  37347003
373471     MOVE LENGTH PV-CICS-MSG-AREA    TO PV-COMMAREA-LENGTH.       37347103
373472                                                                  37347203
373473     EXEC CICS                                                    37347303
373474          WRITEQ TD                                               37347403
373475          QUEUE  ('CSSL')                                         37347503
373476          FROM  (PV-CICS-MSG-AREA)                                37347603
373477          LENGTH  (PV-COMMAREA-LENGTH)                            37347703
373478          RESP  (PV-CICS-RESP)                                    37347803
373479     END-EXEC.                                                    37347903
373480                                                                  37348003
373481     MOVE SPACES                     TO PV-CICS-MSG-AREA.         37348103
373482                                                                  37348203
373483/                                                                 37348303
373484 8030-GET-REPOS-TMST.                                             37348403
373485                                                                  37348503
373486     IF PS-CICS-SWITCH-YES                                        37348603
373487          STRING  ' ' WS007-SRC-TASK-NUMBER                       37348703
373488                  ' WSKCS309-8030-GET-REPOS-TMST          '       37348803
373489                  DELIMITED BY SIZE                               37348903
373490            INTO  PV-CICS-MSG-AREA                                37349003
373491         PERFORM 8000-WRITE-TO-CICS-LOG                           37349103
373492     END-IF.                                                      37349203
373493                                                                  37349303
373494* THE SAME TIMESTAMP IS USED FOR ALL RECORDS FOR THE SHIPMENT     37349403
373495* SO, WE ONLY GET THIS ONCE                                       37349503
373496                                                                  37349603
373497     EXEC SQL                                                     37349703
373498         SET :PV-REPOS-TIMESTAMP = CURRENT TIMESTAMP              37349803
373499     END-EXEC.                                                    37349903
373500                                                                  37350003
373600/                                                                 37360003
373700***************************************************************   37370003
373800*   STANDARD ABEND ROUTINE                                        37380003
373900* ==> PROCESSES:                                                  37390003
374000*   - ISSUES THE ABEND.                                           37400003
374010***************************************************************   37401003
374020 9999-ABEND.                                                      37402003
374030                                                                  37403003
374040     IF PS-CICS-SWITCH-YES                                        37404003
374050          STRING  ' ' WS007-SRC-TASK-NUMBER                       37405003
374060                  ' WSKCS309-9999-ABEND                   '       37406003
374070                  DELIMITED BY SIZE                               37407003
374080            INTO  PV-CICS-MSG-AREA                                37408003
374090         PERFORM 8000-WRITE-TO-CICS-LOG                           37409003
374100     END-IF.                                                      37410003
374200                                                                  37420003
374300     MOVE WS007-RECEIPT-PIX-RECORD      TO DFHCOMMAREA.           37430003
374400     MOVE 'WSKCS309'                  TO DP013-PROGRAM.           37440003
374500     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          37450003
374600     INITIALIZE DP013-SRC-TASK-NUMBER                             37460003
374700                DP013-STACK.                                      37470003
374800     SET DP013-LINK-RETURN TO TRUE.                               37480003
374900     SET DP013-ROLLBACK    TO TRUE.                               37490003
375000                                                                  37500003
375100     EXEC CICS                                                    37510003
375200         LINK                                                     37520003
375300             PROGRAM  (DP013-NAME)                                37530003
375400             COMMAREA (DP013-PARAMETERS)                          37540003
375410             LENGTH   (DP013-LENGTH)                              37541003
375420     END-EXEC.                                                    37542003
375430                                                                  37543003
375440                                                                  37544003
375450     EXEC CICS                                                    37545003
375460         RETURN                                                   37546003
375470     END-EXEC.                                                    37547003
