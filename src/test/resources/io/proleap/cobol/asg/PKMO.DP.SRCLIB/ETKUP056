      **********************************************************        00010006
       IDENTIFICATION DIVISION.                                         00020006
      **********************************************************        00030006
       PROGRAM-ID.      ETKUP056.                                       00040006
       AUTHOR.          JON FIEDLER.                                    00050006
       DATE-WRITTEN.    12/20/2001.                                     00060006
      *                                                                 00070006
      ******************************************************************00080006
      * PURPOSE: UPDATE DOCUMENT TRACKING WITH RECEIVE AND SEND         00090006
      *          DATE/TIMES FROM IPNET.                                 00100006
      ******************************************************************00110006
      *      DB2 TABLES: TINTTRN, TTRDPRT                               00120006
      *      DB2 CURSORS: TINTTRN_CURSOR, TTRDPRT_CURSOR                00130006
      **********************************************************        00140006
************************************************************************00141006
******* CHANGE HISTORY:                                                 00142006
******* WR/PITS#  DATE       DESCRIPTION                                00143006
************************************************************************00144006
JF0202* WR22776   02/12/2002 JON FIEDLER                                00145006
JF0202*                      ADDED CHECK FOR NULL IN SEND DATE/TIME.    00146006
************************************************************************00147006
JF1203* WR22776   12/16/2003 JON FIEDLER                                00148006
JF1203*                      CHANGED TO UPDATE FOR NEW EXTRACT FROM     00149006
JF1203*                      ORACLE TABLES.                             00149106
************************************************************************00149206
      *           08/12/2008 SUE PARI                                   00149406
      *                      CHANGED TO MAKE PROGRAM RUN FASTER         00149506
************************************************************************00149606
      *           08/18/2008 WADE GROVE                                 00149706
      *                      ADDED WITH HOLD TO BOTH CURSORS            00149806
      *                      TO CORRECT AN ABEND                        00149906
************************************************************************00150006
      *           01/22/2009 WADE GROVE                                 00150144
      *                      TAKING THE DIRECTION OF THE TRANSACTION    00150231
      *                      INTO ACCOUNT WHEN UPDATING TINTTRN         00150331
************************************************************************00150431
       ENVIRONMENT DIVISION.                                            00150531
      **********************************************************        00150631
       CONFIGURATION SECTION.                                           00150731
       SOURCE-COMPUTER. IBM-3090.                                       00150831
       OBJECT-COMPUTER. IBM-3090.                                       00150931
                                                                        00151031
       INPUT-OUTPUT SECTION.                                            00151131
       FILE-CONTROL.                                                    00151231
                                                                        00151331
           SELECT INPUT-IP-FILE           ASSIGN TO INP01.              00151431
                                                                        00151531
      **********************************************************        00151631
       DATA DIVISION.                                                   00151731
      **********************************************************        00151831
       FILE SECTION.                                                    00151931
                                                                        00152031
       FD  INPUT-IP-FILE                                                00152131
           RECORDING MODE F                                             00152231
           BLOCK CONTAINS 0 RECORDS                                     00152331
           RECORD CONTAINS 185 CHARACTERS                               00152431
           LABEL RECORDS ARE STANDARD                                   00153006
           DATA RECORD IS INPUT-RECORD.                                 00154006
                                                                        00155006
       01  INPUT-IP-RECORD                     PIC X(185).              00156006
                                                                        00157006
       WORKING-STORAGE SECTION.                                         00158006
                                                                        00159006
WG0109 01 RD-RECORD-DIRECTION.                                          00159131
WG0109     05  RD-DIRECTION                 PIC X(01).                  00159231
       01  PA-PROGRAM-ACUMM.                                            00160006
           05  PA-ROWS-UPDATED             PIC 9(05) VALUE ZERO.        00170006
           05  PA-RECS-READ                PIC 9(05) VALUE ZERO.        00180006
                                                                        00190006
       01  PC-PROGRAM-CONTROLS.                                         00200006
           05  PC-PROGRAM-NAME             PIC X(08) VALUE 'ETKUP056'.  00210006
           05  PC-KOHLS-ID1                PIC X(15) VALUE '4147037000'.00220006
           05  PC-KOHLS-ID2                PIC X(15) VALUE              00230006
                                                          '14147844480'.00240006
       01  PS-PROGRAM-SWITCHES.                                         00250006
           05  PS-END-OF-TTRDPRT-SW        PIC X(01)      VALUE 'N'.    00260006
               88  PS-END-OF-TTRDPRT                      VALUE 'Y'.    00270006
           05  PS-UPDATE-SW                PIC X(01)      VALUE 'N'.    00280006
               88  PS-NO-UPDATE                           VALUE 'N'.    00290006
               88  PS-UPDATE                              VALUE 'Y'.    00300006
           05  PS-EOF-IP-SW                PIC X(01)      VALUE 'N'.    00310006
               88  PS-NO-EOF-IP                           VALUE 'N'.    00320006
               88  PS-EOF-IP                              VALUE 'Y'.    00330006
           05  PS-ROWS-FOUND-SW            PIC X(01)      VALUE 'N'.    00340006
               88  PS-NO-ROWS-FOUND                       VALUE 'N'.    00350006
               88  PS-ROWS-FOUND                          VALUE 'Y'.    00360006
           05  PS-EMAIL-SW                 PIC X(01)      VALUE 'N'.    00370006
               88  PS-NO-EMAIL                            VALUE 'N'.    00380006
               88  PS-EMAIL                               VALUE 'Y'.    00390006
                                                                        00400006
       01 PV-INPUT-REC.                                                 00410006
           05  PV-DOC-TRK-DTE-TIME.                                     00420006
               10 PV-DATE                         PIC X(10) VALUE SPACE.00430006
               10 PV-HOUR                         PIC X(02) VALUE SPACE.00440006
               10 PV-MINUTE                       PIC X(02) VALUE SPACE.00450006
           05  PV-SENDER-QUAL-ID.                                       00460006
               10 PV-SENDER-QUAL                  PIC X(02) VALUE SPACE.00470006
               10 PV-SENDER-ID                    PIC X(15) VALUE SPACE.00480006
           05  PV-RECEIVER-QUAL-ID.                                     00490006
               10 PV-RECEIVER-QUAL                PIC X(02) VALUE SPACE.00500006
               10 PV-RECEIVER-ID                  PIC X(15) VALUE SPACE.00510006
           05  PV-CONTROL-ID                      PIC X(09) VALUE SPACE.00520006
                                                                        00530006
       01  PV-CONTROL-ID-FORM             PIC S9(09)V COMP-3 VALUE ZERO.00540006
       01  PV-VENDOR-QUAL                 PIC X(02) VALUE SPACE.        00550006
       01  PV-VENDOR-ID                   PIC X(15) VALUE SPACE.        00560006
                                                                        00570006
       01  PV-MLBX-TIME-CONVERT.                                        00580006
           05  PV-MLBX-TIME-HR              PIC X(02)      VALUE ZEROES.00590006
           05  FILLER                       PIC X(01)      VALUE '.'.   00600006
           05  PV-MLBX-TIME-MN              PIC X(02)      VALUE SPACES.00610006
           05  FILLER                       PIC X(01)      VALUE '.'.   00620006
           05  PV-MLBX-TIME-SC              PIC X(02)      VALUE '00'.  00630006
                                                                        00640006
       01  PV-TP-DKEY-TMST                  PIC X(26)      VALUE SPACES.00650006
       01  PV-RESULT                        PIC 9(04)      VALUE 0.     00660006
       01  PV-REMAINDER                     PIC 9(05)      VALUE 0.     00670006
                                                                        00680006
       01  ABEND-CODE                       PIC S9(04)     VALUE +0     00690006
                                                           COMP SYNC.   00700006
           88  ABEND-4002-READ-ERROR                       VALUE +4002. 00710006
           88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00720006
                                                                        00730006
      *                                                                 00740006
      * DB2 COMMUNICATION AREA.                                         00750006
      *                                                                 00760006
           EXEC SQL                                                     00770006
              INCLUDE TINTTRN                                           00780006
           END-EXEC.                                                    00790006
      *                                                                 00800006
           EXEC SQL                                                     00810006
              INCLUDE TTRDPRT                                           00820006
           END-EXEC.                                                    00830006
      *                                                                 00840006
           EXEC SQL                                                     00850006
              INCLUDE SQLCA                                             00860006
           END-EXEC.                                                    00870006
                                                                        00880006
      *                                                                 00890006
      * DECLARE DB2 CURSORS                                             00900006
      *                                                                 00910006
                                                                        00920006
           EXEC SQL                                                     00930006
             DECLARE TTRDPRT_CURSOR CURSOR WITH HOLD FOR                00940006
               SELECT TP_DKEY                                           00950006
               FROM TTRDPRT                                             00960033
               WHERE VEND_INCHG_ID_DESC = :PV-VENDOR-QUAL               00970006
                 AND VEND_INCHG_ID = :PV-VENDOR-ID                      00980006
               FOR FETCH ONLY                                           00990006
           END-EXEC.                                                    01000006
                                                                        01010006
            EXEC SQL                                                    01121006
              DECLARE TINTTRN_CURSOR CURSOR WITH HOLD FOR               01122023
                SELECT TP_DKEY_TMST,                                    01123006
                       MAILBOX_REC_DTE                                  01124006
                FROM TINTTRN                                            01125033
                WHERE TP_DKEY = :TRDPRT-TP-DKEY                         01126006
                  AND INCHG_CNTL_NBR = :PV-CONTROL-ID-FORM              01127006
WG0109            AND DIR_IND = :RD-DIRECTION                           01128031
                ORDER BY TP_DKEY_TMST DESC                              01129006
                FOR FETCH ONLY                                          01129122
           END-EXEC.                                                    01129206
      *                                                                 01130006
      * DB2 COMMUNICATION AREA 2                                        01140006
      *                                                                 01150006
           COPY SQLCA2.                                                 01160006
      ****************************************************************  01170006
       PROCEDURE DIVISION.                                              01180006
      ****************************************************************  01190006
                                                                        01200006
       0000-MAINLINE.                                                   01210006
                                                                        01220006
      *                                                                 01230006
      * OPEN INPUT FILE                                                 01240006
      *                                                                 01250006
           OPEN INPUT INPUT-IP-FILE.                                    01260006
      *                                                                 01270006
           PERFORM 4000-READ-IP-FILE.                                   01280006
                                                                        01290006
           PERFORM 1000-PROCESS-FILE UNTIL PS-EOF-IP.                   01300006
                                                                        01310006
      *                                                                 01320006
      * CLOSE FILE                                                      01330006
      *                                                                 01340006
           CLOSE INPUT-IP-FILE.                                         01350006
                                                                        01360006
           IF PS-EMAIL                                                  01370006
              MOVE 4095 TO RETURN-CODE.                                 01380006
                                                                        01390006
      *                                                                 01400006
      * END OF JOB SUMMARY                                              01410006
           DISPLAY 'ROWS READ    = ' PA-RECS-READ.                      01420006
           DISPLAY 'ROWS UPDATED = ' PA-ROWS-UPDATED.                   01430006
                                                                        01440006
           STOP RUN.                                                    01450006
                                                                        01460006
                                                                        01470006
       1000-PROCESS-FILE.                                               01480006
                                                                        01490006
           MOVE PV-CONTROL-ID TO PV-CONTROL-ID-FORM.                    01500006
                                                                        01510006
           IF PV-SENDER-ID = PC-KOHLS-ID1 OR PC-KOHLS-ID2               01591009
               MOVE PV-RECEIVER-QUAL TO PV-VENDOR-QUAL                  01592009
               MOVE PV-RECEIVER-ID   TO PV-VENDOR-ID                    01593009
WG0109         MOVE 'S'              TO RD-DIRECTION                    01594032
           ELSE                                                         01595009
               MOVE PV-SENDER-QUAL   TO PV-VENDOR-QUAL                  01596009
               MOVE PV-SENDER-ID     TO PV-VENDOR-ID                    01597009
WG0109         MOVE 'R'              TO RD-DIRECTION                    01598032
           END-IF.                                                      01599009
                                                                        01599106
           PERFORM 2000-OPEN-TTRDPRT-CURSOR                             01600006
              THRU 2000-OPEN-TTRDPRT-CURSOR-EXIT.                       01610006
                                                                        01620006
           MOVE 'N' TO PS-ROWS-FOUND-SW.                                01630006
                                                                        01640006
           MOVE 'N' TO PS-END-OF-TTRDPRT-SW.                            01650006
           PERFORM 2100-PROCESS-TTRDPRT                                 01660006
              THRU 2100-PROCESS-TTRDPRT-EXIT                            01670006
                 UNTIL PS-END-OF-TTRDPRT.                               01680006
                                                                        01690006
           PERFORM 2200-CLOSE-TTRDPRT-CURSOR                            01700006
              THRU 2200-CLOSE-TTRDPRT-CURSOR-EXIT.                      01710006
                                                                        01720006
           IF PS-NO-ROWS-FOUND                                          01730006
              DISPLAY '** MISSING ROW ON TINTTRN **'                    01740006
              DISPLAY '** 2100-FETCH-TRAN-CUR-RECORD **'                01750006
              DISPLAY '** THIS COULD INDICATE A DOCUMENT WAS NEVER'     01760006
              DISPLAY '** RECEIVED BY THE MAINFRAME OR IS A TIMING'     01770006
              DISPLAY '** ISSUE, IN WHICH A DOCUMENT WAS RECEIVED'      01780006
              DISPLAY '** BY IPNET BETWEEN THE TIME OUR MAINFRAME'      01790006
              DISPLAY '** CYCLE UPDATES TINTTRN INITIALLY AND WHEN'     01800006
              DISPLAY '** THE SQL SERVER EXTRACT RUNS'                  01810006
              DISPLAY '** INTERCHANGE CONTROL# = ' PV-CONTROL-ID        01820006
              DISPLAY '  '                                              01830006
              MOVE 'Y' TO PS-EMAIL-SW                                   01840006
           END-IF.                                                      01850006
                                                                        01860006
           PERFORM 4000-READ-IP-FILE.                                   01870006
                                                                        01880006
                                                                        01890006
       2000-OPEN-TTRDPRT-CURSOR.                                        01900006
                                                                        01910006
            EXEC SQL                                                    01920006
               OPEN TTRDPRT_CURSOR                                      01930006
            END-EXEC.                                                   01940006
                                                                        01950006
            EVALUATE TRUE                                               01960006
               WHEN SQLCODE = ZERO                                      01970006
                   CONTINUE                                             01980006
               WHEN SQLCODE > ZERO                                      01990006
               WHEN SQLWARN0 = 'W'                                      02000006
                    DISPLAY 'WARNING ON OPEN OF TTRDPRT_CURSOR'         02010006
                    PERFORM 8000-SQL-WARNING                            02020006
               WHEN OTHER                                               02030006
                    DISPLAY 'ERROR ON OPEN OF TTRDPRT_CURSOR'           02040006
                    PERFORM 9999-SQL-ERROR                              02050006
            END-EVALUATE.                                               02060006
                                                                        02070006
       2000-OPEN-TTRDPRT-CURSOR-EXIT.                                   02080006
            EXIT.                                                       02090006
                                                                        02100006
                                                                        02110006
       2050-OPEN-TINTTRN-CURSOR.                                        02120006
                                                                        02130006
            EXEC SQL                                                    02140006
               OPEN TINTTRN_CURSOR                                      02150006
            END-EXEC.                                                   02160006
                                                                        02170006
            EVALUATE TRUE                                               02180006
               WHEN SQLCODE = ZERO                                      02190006
                   CONTINUE                                             02200006
               WHEN SQLCODE > ZERO                                      02210006
               WHEN SQLWARN0 = 'W'                                      02220006
                    DISPLAY 'WARNING ON OPEN OF TINTTRN_CURSOR'         02230006
                    PERFORM 8000-SQL-WARNING                            02240006
               WHEN OTHER                                               02250006
                    DISPLAY 'ERROR ON OPEN OF TINTTRN_CURSOR'           02260006
                    PERFORM 9999-SQL-ERROR                              02270006
            END-EVALUATE.                                               02280006
                                                                        02290006
       2050-OPEN-TINTTRN-CURSOR-EXIT.                                   02300006
            EXIT.                                                       02310006
                                                                        02320006
                                                                        02330006
       2100-PROCESS-TTRDPRT.                                            02340006
                                                                        02350006
            EXEC SQL                                                    02360006
               FETCH TTRDPRT_CURSOR                                     02370006
               INTO :TRDPRT-TP-DKEY                                     02380006
            END-EXEC.                                                   02390006
                                                                        02400006
            EVALUATE TRUE                                               02430006
               WHEN SQLCODE = ZERO                                      02440006
                    PERFORM 2050-OPEN-TINTTRN-CURSOR                    02450006
                       THRU 2050-OPEN-TINTTRN-CURSOR-EXIT               02460006
                    PERFORM 2150-PROCESS-TINTTRN                        02470006
                       THRU 2150-PROCESS-TINTTRN-EXIT                   02480006
                    PERFORM 2250-CLOSE-TINTTRN-CURSOR                   02490006
                       THRU 2250-CLOSE-TINTTRN-CURSOR-EXIT              02500006
               WHEN SQLCODE = +100                                      02510006
                    MOVE 'Y' TO PS-END-OF-TTRDPRT-SW                    02520006
               WHEN SQLCODE  > ZERO                                     02530006
               WHEN SQLWARN0 = 'W'                                      02540006
                    DISPLAY 'WARNING ON FETCH OF TTRDPRT_CURSOR'        02550006
                    PERFORM 8000-SQL-WARNING                            02560006
               WHEN OTHER                                               02570006
                    DISPLAY 'ERROR ON FETCH OF TTRDPRT_CURSOR'          02580006
                    PERFORM 9999-SQL-ERROR                              02590006
            END-EVALUATE.                                               02600006
                                                                        02610006
       2100-PROCESS-TTRDPRT-EXIT.                                       02620006
            EXIT.                                                       02630006
                                                                        02640006
                                                                        02650006
       2150-PROCESS-TINTTRN.                                            02660006
                                                                        02670006
            EXEC SQL                                                    02680006
               FETCH TINTTRN_CURSOR                                     02690006
               INTO :INTTRN-TP-DKEY-TMST,                               02700006
                    :INTTRN-MAILBOX-REC-DTE                             02710006
            END-EXEC.                                                   02720006
                                                                        02730006
            EVALUATE TRUE                                               02750006
               WHEN SQLCODE = ZERO                                      02760006
                    MOVE 'Y' TO PS-ROWS-FOUND-SW                        02770006
                    PERFORM 3000-CHECK-DATES-AND-UPDATE                 02780006
               WHEN SQLCODE = +100                                      02790006
WG0109              CONTINUE                                            02800031
               WHEN SQLCODE  > ZERO                                     02810006
               WHEN SQLWARN0 = 'W'                                      02820006
                    DISPLAY 'WARNING ON FETCH OF TINTTRN_CURSOR'        02830006
                    PERFORM 8000-SQL-WARNING                            02840006
               WHEN OTHER                                               02850006
                    DISPLAY 'ERROR ON FETCH OF TINTTRN_CURSOR'          02860006
                    PERFORM 9999-SQL-ERROR                              02870006
            END-EVALUATE.                                               02880006
                                                                        02890006
       2150-PROCESS-TINTTRN-EXIT.                                       02900006
            EXIT.                                                       02910006
                                                                        02920006
                                                                        02930006
       2200-CLOSE-TTRDPRT-CURSOR.                                       02940006
                                                                        02950006
            EXEC SQL                                                    02960006
                CLOSE TTRDPRT_CURSOR                                    02970006
            END-EXEC.                                                   02980006
                                                                        02990006
            EVALUATE TRUE                                               03000006
               WHEN SQLCODE = ZERO                                      03010006
                    CONTINUE                                            03020006
               WHEN SQLCODE  > ZERO                                     03030006
               WHEN SQLWARN0 = 'W'                                      03040006
                    DISPLAY 'WARNING ON CLOSE OF TTRDPRT_CURSOR'        03050006
                    PERFORM 8000-SQL-WARNING                            03060006
               WHEN OTHER                                               03070006
                    DISPLAY 'ERROR ON CLOSE OF TTRDPRT_CURSOR'          03080006
                    PERFORM 9999-SQL-ERROR                              03090006
            END-EVALUATE.                                               03100006
                                                                        03110006
       2200-CLOSE-TTRDPRT-CURSOR-EXIT.                                  03120006
            EXIT.                                                       03130006
                                                                        03140006
                                                                        03150006
       2250-CLOSE-TINTTRN-CURSOR.                                       03160006
                                                                        03170006
            EXEC SQL                                                    03180006
                CLOSE TINTTRN_CURSOR                                    03190006
            END-EXEC.                                                   03200006
                                                                        03210006
            EVALUATE TRUE                                               03220006
               WHEN SQLCODE = ZERO                                      03230006
                    CONTINUE                                            03240006
WG0109         WHEN SQLCODE = +100                                      03241032
WG0109              CONTINUE                                            03242032
               WHEN SQLCODE  > ZERO                                     03250006
               WHEN SQLWARN0 = 'W'                                      03260006
                    DISPLAY 'WARNING ON CLOSE OF TINTTRN_CURSOR'        03270006
                    PERFORM 8000-SQL-WARNING                            03280006
               WHEN OTHER                                               03290006
                    DISPLAY 'ERROR ON CLOSE OF TINTTRN_CURSOR'          03300006
                    PERFORM 9999-SQL-ERROR                              03310006
            END-EVALUATE.                                               03320006
                                                                        03330006
       2250-CLOSE-TINTTRN-CURSOR-EXIT.                                  03340006
            EXIT.                                                       03350006
                                                                        03360006
                                                                        03370006
       3000-CHECK-DATES-AND-UPDATE.                                     03380006
                                                                        03390006
            MOVE INTTRN-TP-DKEY-TMST TO PV-TP-DKEY-TMST.                03400006
                                                                        03410006
            MOVE PV-DATE TO INTTRN-MAILBOX-REC-DTE.                     03420006
            MOVE PV-DATE TO INTTRN-MAILBOX-PU-DTE.                      03430006
      *                                                                 03440006
      * CONVERT TIME TO DB2 FORMAT                                      03450006
      *                                                                 03460006
            MOVE PV-HOUR TO PV-MLBX-TIME-HR.                            03470006
            MOVE PV-MINUTE TO PV-MLBX-TIME-MN.                          03480006
            MOVE PV-MLBX-TIME-CONVERT TO INTTRN-MAILBOX-REC-TME.        03490006
            MOVE PV-MLBX-TIME-CONVERT TO INTTRN-MAILBOX-PU-TME.         03500006
            MOVE 'Y' TO  PS-UPDATE-SW.                                  03510006
                                                                        03520006
            EXEC SQL                                                    03611044
              UPDATE TINTTRN                                            03612044
                 SET MAILBOX_REC_DTE  = :INTTRN-MAILBOX-REC-DTE         03613044
                    ,MAILBOX_REC_TME  = :INTTRN-MAILBOX-REC-TME         03614044
                    ,MAILBOX_PU_DTE   = :INTTRN-MAILBOX-PU-DTE          03615044
                    ,MAILBOX_PU_TME   = :INTTRN-MAILBOX-PU-TME          03616044
                 WHERE TP_DKEY        = :TRDPRT-TP-DKEY      AND        03617044
                       TP_DKEY_TMST   = :INTTRN-TP-DKEY-TMST AND        03618044
WG0109                 DIR_IND        = :RD-DIRECTION                   03619044
            END-EXEC.                                                   03619144
WG0109*     DISPLAY 'SQLCODE = ' SQLCODE.                               03689044
WG0109*     DISPLAY 'ZSELECT $' INTTRN-MAILBOX-REC-DTE '$ AS FLDA,'     03689144
WG0109*             'MAILBOX_REC_DTE,'.                                 03689244
WG0109*     DISPLAY 'Z$' INTTRN-MAILBOX-REC-TME '$ AS FLDB,'            03689344
WG0109*             'MAILBOX_REC_TME,'                                  03689444
WG0109*             '$' INTTRN-MAILBOX-PU-TME '$ AS FLDC,'.             03689544
WG0109*     DISPLAY 'ZMAILBOX_PU_TME, TP_DKEY, TP_DKEY_TMST,'.          03689644
WG0109*     DISPLAY 'Z$' PV-CONTROL-ID-FORM '$ AS FLDD,'.               03689744
WG0109*     DISPLAY 'Z$' RD-DIRECTION '$ AS FLDE '.                     03689844
WG0109*     DISPLAY 'ZFROM DB2PDBA.TINTTRN '                            03689944
WG0109*             'WHERE TP_DKEY = ' TRDPRT-TP-DKEY ' AND '.          03690044
WG0109*     DISPLAY 'ZTP_DKEY_TMST   = $' INTTRN-TP-DKEY-TMST '$ AND '  03690144
WG0109*             'DIR_IND = $' RD-DIRECTION '$;'                     03690244
WG0109*     DISPLAY 'Z                             '.                   03690344
            EVALUATE TRUE                                               03691006
               WHEN SQLCODE = ZERO                                      03700006
                  MOVE INTTRN-TP-DKEY-TMST TO PV-TP-DKEY-TMST           03710006
                  ADD 1 TO PA-ROWS-UPDATED                              03720006
               WHEN SQLCODE = +100                                      03730028
                  CONTINUE                                              03740028
               WHEN SQLCODE  > ZERO                                     03810006
               WHEN SQLWARN0 = 'W'                                      03820006
                  DISPLAY 'WARNING ON UPDATE OF TINTTRN'                03830006
                  PERFORM 8000-SQL-WARNING                              03840006
               WHEN OTHER                                               03850006
                  DISPLAY 'ERROR ON UPDATE OF TINTTRN'                  03860006
                  PERFORM 9999-SQL-ERROR                                03870006
            END-EVALUATE.                                               03880006
                                                                        03890006
           DIVIDE PA-ROWS-UPDATED BY 500 GIVING PV-RESULT               03900006
                REMAINDER PV-REMAINDER.                                 03910006
                                                                        03920006
           IF PV-REMAINDER = 0                                          03930006
               PERFORM 7000-COMMIT                                      03940006
           END-IF.                                                      03950006
                                                                        03960006
                                                                        03970006
       4000-READ-IP-FILE.                                               03980006
                                                                        03990006
            READ INPUT-IP-FILE                                          04000006
              INTO PV-INPUT-REC                                         04010006
              AT END MOVE 'Y' TO PS-EOF-IP-SW.                          04020006
                                                                        04030006
            ADD 1 TO PA-RECS-READ.                                      04040006
                                                                        04050006
       7000-COMMIT.                                                     04060006
           EXEC SQL                                                     04070044
               COMMIT                                                   04080044
           END-EXEC.                                                    04090044
                                                                        04100006
           EVALUATE TRUE                                                04110006
               WHEN SQLCODE = ZEROS                                     04120006
                   CONTINUE                                             04130006
               WHEN OTHER                                               04140006
                   DISPLAY '7000-COMMIT  '                              04150006
                   DISPLAY 'UNSUCCESSFUL COMMIT  '                      04160006
                   PERFORM 9999-SQL-ERROR                               04170006
           END-EVALUATE.                                                04180006
                                                                        04190006
       8000-SQL-WARNING.                                                04200006
            MOVE SQLCODE               TO SQLCODE2.                     04210006
            MOVE SQLERRD(3)            TO SQLERRD3.                     04220006
                                                                        04230006
            DISPLAY '** ABEND **       ** = SQLWARNING'.                04240006
            DISPLAY '** PROGRAM        ** = ETKUP056'.                  04250006
            DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 04260006
            DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 04270006
            DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                 04280006
            DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                 04290006
            DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                 04300006
            DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                 04310006
            DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                 04320006
            DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                 04330006
            DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                 04340006
            DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                 04350006
                                                                        04360006
            EXEC SQL                                                    04370006
               ROLLBACK                                                 04380006
            END-EXEC.                                                   04390006
                                                                        04400006
            SET ABEND-4013-DB2-ERROR   TO TRUE.                         04410006
            CALL 'ILBOABN0' USING ABEND-CODE.                           04420006
                                                                        04430006
       9999-SQL-ERROR.                                                  04440006
            MOVE SQLCODE               TO SQLCODE2.                     04450006
            MOVE SQLERRD(3)            TO SQLERRD3.                     04460006
                                                                        04470006
            DISPLAY '** ABEND **       ** = SQLERROR'.                  04480006
            DISPLAY '** PROGRAM        ** = ETKUP056'.                  04490006
            DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 04500006
            DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 04510006
            DISPLAY '** SQLERRM        ** = ' SQLERRM.                  04520006
            DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                 04530006
                                                                        04540006
            EXEC SQL                                                    04550006
               ROLLBACK                                                 04560006
            END-EXEC.                                                   04570006
                                                                        04580006
            SET ABEND-4013-DB2-ERROR   TO TRUE.                         04590006
            CALL 'ILBOABN0' USING ABEND-CODE.                           04600006
