000100******************************************************************00010007
000200 IDENTIFICATION DIVISION.                                         00020012
000300******************************************************************00030013
000400                                                                  00040013
000500 PROGRAM-ID.             RCKUT127.                                00050013
000600 AUTHOR.                 GERMAN BANDA.                            00060013
000700 INSTALLATION.           KOHLS.                                   00070013
000800 DATE-WRITTEN            OCTOBER, 2003.                           00080013
000900 DATE-COMPILED.                                                   00090013
001000                                                                  00100013
001100******************************************************************00110013
001200* THIS MODULE WILL DETERMINE IF THE DC OR DC-DEPT IS PERFORMING   00120013
001300* AUTO-VERIFICATION.                                              00130013
001400******************************************************************00140013
001500                                                                  00150013
001600******************************************************************00160013
001700 ENVIRONMENT DIVISION.                                            00170013
001800******************************************************************00180013
001900                                                                  00190013
002000******************************************************************00200013
002100 DATA DIVISION.                                                   00210013
002200******************************************************************00220013
002300                                                                  00230013
002400******************************************************************00240013
002500 WORKING-STORAGE SECTION.                                         00250013
002600******************************************************************00260013
002700*----------------------------------------------------------------*00270013
002800**  SECURITY SUBROUTINE PARAMETERS                                00280013
002900*----------------------------------------------------------------*00290013
003000     COPY DPWS008.                                                00300013
003100                                                                  00310013
003200                                                                  00320013
003300*                                                                 00330013
003400 01  DK-DB2-KEYS.                                                 00340013
003500     05  DK-PO-NBR                       PIC S9(09) COMP SYNC.    00350013
003600     05  DK-REC-SEQ-NBR                  PIC S9(09) COMP SYNC.    00360013
003700     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00370013
003800     05  DK-FCLTY-ID                     PIC S9(04) COMP.         00380013
003900                                                                  00390013
004000 01  PC-PROGRAM-CONSTANTS.                                        00400013
004100     05  PC-DEFAULT-TMST           PIC X(26)  VALUE               00410013
004200                                  '9999-09-09-09.09.09.999999'.   00420013
004300     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'RCKUT127'.   00430013
004400     05  PC-LOGGING-PROGRAM-NAME   PIC X(08)  VALUE 'SUKPV702'.   00440013
004500     05  PC-DEFAULT-DATE           PIC X(10)  VALUE '9999-09-09'. 00450013
004600                                                                  00460013
004700                                                                  00470013
004800 01  PS-PROGRAM-SWITCHES.                                         00480013
004900     05  PS-ERROR-SW                    PIC  X(01)  VALUE  'N'.   00490013
005000         88  PS-NO-ERROR                            VALUE  'N'.   00500013
005100         88  PS-ERROR                               VALUE  'Y'.   00510013
005200     05  PS-LOG-MESSAGE-SW              PIC  X       VALUE 'N'.   00520013
005300         88  PS-LOG-MESSAGE                          VALUE 'Y'.   00530013
005400         88  PS-NO-LOG-MESSAGE                       VALUE 'N'.   00540013
005500     05  PS-BEFORE-ONLY-LOGGING-SW      PIC  X       VALUE 'N'.   00550013
005600         88  PS-BEFORE-ONLY-LOGGING                  VALUE 'Y'.   00560013
005700         88  PS-NOT-BEFORE-ONLY-LOGGING              VALUE 'N'.   00570013
005800     05  PS-CONTINUATION-SW             PIC  X       VALUE 'N'.   00580013
005900         88  PS-DONE                                 VALUE 'Y'.   00590013
006000         88  PS-NOT-DONE                             VALUE 'N'.   00600013
006100                                                                  00610013
006200 01  PV-PROGRAM-VARIABLES.                                        00620013
006300     05  PV-NULL-IND                    PIC S9(04)  VALUE +0      00630013
006400                                                    COMP SYNC.    00640013
006500     05  PV-RACF-FUNCTION-NAME          PIC  X(08).               00650013
006600     05  PV-NOTIF-NBR                    PIC S9(9) VALUE ZERO     00660013
006700                                                COMP SYNC.        00670013
006800     05  PV-CURRENT-TIMESTAMP            PIC X(26)   VALUE SPACES.00680013
006900     05  PV-FROM-PARAGRAPH               PIC X(35) VALUE SPACES.  00690013
007000     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00700013
007100                                                COMP SYNC.        00710013
007200     05  PV-CICS-RESPONSE                PIC S9(04)  VALUE +0     00720013
007300                                                COMP SYNC.        00730013
007400     05  PV-DISPLAY-SQLCODE              PIC -9(05) VALUE ZEROES. 00740013
007500     05  PV-DISP-SHIPT-UNT-ID            PIC 9(18).               00750013
007600     05  PV-DISP-PO                      PIC 9(09).               00760013
007700     05  PV-DISP-RCVR-SEQ-NBR            PIC 9(04).               00770013
007800     05  PV-DISP-OPER-UNT-ID             PIC   9(04).             00780013
007900     05  PV-DISP-DEPT                    PIC   X(03).             00790013
008000     05  PV-DISPLAY-CICS-RESP            PIC 999999999-           00800013
008100                                                 VALUE ZEROS.     00810013
008200                                                                  00820013
008300 01  PV-AUTOVE-BY-DEPT-WORK-AREA.                                 00830013
008400     05  PS-AUTO-VE-BY-DEPT-SW          PIC  X      VALUE 'N'.    00840013
008500         88  PS-AUTO-VE-BY-DEPT-YES                 VALUE 'Y'.    00850013
008600         88  PS-AUTO-VE-BY-DEPT-NO                  VALUE 'N'.    00860013
008700         88  PS-AUTO-VE-BY-DEPT1-YES             VALUE 'Y'.       00870013
008800         88  PS-AUTO-VE-BY-DEPT1-NO              VALUE 'N'.       00880013
008900         88  PS-AUTO-VE-BY-DEPT2-YES             VALUE 'Y'.       00890013
009000         88  PS-AUTO-VE-BY-DEPT2-NO              VALUE 'N'.       00900013
009100         88  PS-AUTO-VE-BY-DEPT3-YES             VALUE 'Y'.       00910013
009200         88  PS-AUTO-VE-BY-DEPT3-NO              VALUE 'N'.       00920013
009300                                                                  00930013
009400     05  PV-DEPT-01                     PIC X(03)   VALUE SPACE.  00940013
009500     05  PV-DEPT-02                     PIC X(03)   VALUE SPACE.  00950013
009600     05  PV-DEPT-03                     PIC X(03)   VALUE SPACE.  00960013
009700     05  PV-DEPT-04                     PIC X(03)   VALUE SPACE.  00970013
009800     05  PV-DEPT-05                     PIC X(03)   VALUE SPACE.  00980013
009900     05  PV-DEPT-06                     PIC X(03)   VALUE SPACE.  00990013
010000     05  PV-DEPT-07                     PIC X(03)   VALUE SPACE.  01000013
010100     05  PV-DEPT-08                     PIC X(03)   VALUE SPACE.  01010013
010200                                                                  01020013
010300                                                                  01030013
010400*----------------------------------------------------------------*01040013
010500*    SQL AND COBOL DECLARATIONS FOR THE PURCHASE ORDER TABLE      01050013
010600*----------------------------------------------------------------*01060013
010700     EXEC SQL                                                     01070013
010800          INCLUDE TPURCHS                                         01080013
010900     END-EXEC.                                                    01090013
011000*----------------------------------------------------------------*01100013
011100*    SQL AND COBOL DECLARATIONS FOR THE RECEIVER TABLE (TRECEIV)  01110013
011200*----------------------------------------------------------------*01120013
011300     EXEC SQL                                                     01130013
011400          INCLUDE TRECEIV                                         01140013
011500     END-EXEC.                                                    01150013
011600*----------------------------------------------------------------*01160013
011700*  SQL AND COBOL DECLARATIONS FOR PARMS (TKRPRPM)                 01170013
011800*----------------------------------------------------------------*01180013
011900     EXEC SQL                                                     01190013
012000          INCLUDE TKRPRPM                                         01200013
012100     END-EXEC.                                                    01210013
012200                                                                  01220013
012300*----------------------------------------------------------------*01230013
012400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR LOGISTICS DOMAIN       01240013
012500*  LOCATION MASTER TABLE                                          01250013
012600*----------------------------------------------------------------*01260013
012700     EXEC SQL                                                     01270013
012800         INCLUDE XLT00010                                         01280013
012900     END-EXEC.                                                    01290013
013000******************************************************************01300013
013100******************************************************************01310013
013200*  COMMUNICATIONS AREA FOR DB2                                    01320013
013300******************************************************************01330013
013400     EXEC SQL                                                     01340013
013500         INCLUDE SQLCA                                            01350013
013600     END-EXEC.                                                    01360013
013700                                                                  01370013
013800******************************************************************01380013
013900 LINKAGE SECTION.                                                 01390013
014000     COPY RCWS040.                                                01400013
014100******************************************************************01410013
014200                                                                  01420013
014300******************************************************************01430013
014400 PROCEDURE DIVISION USING RC040-FIELDS.                           01440013
014500     SET RC040-SUCCESSFUL        TO TRUE                          01450013
014600     INITIALIZE DCLTPURCHS                                        01460013
014700                DCLTRECEIV                                        01470013
014800                DCLTKRPRPM                                        01480013
014900                DCLXLT00010.                                      01490013
015000                                                                  01500013
015100******************************************************************01510013
015200 0000-PROGRAM-MAINLINE.                                           01520013
015300     INITIALIZE PV-PROGRAM-VARIABLES.                             01530013
015400     SET PS-NO-ERROR TO TRUE.                                     01540013
015500     MOVE 'N'                   TO  PS-ERROR-SW                   01550013
015600                                    PS-LOG-MESSAGE-SW             01560013
015700                                    PS-BEFORE-ONLY-LOGGING-SW     01570013
015800                                    PS-CONTINUATION-SW            01580013
015900                                    RC040-AUTO-VE-SW.             01590013
016000                                                                  01600013
016100     MOVE RC040-PO-NBR           TO DK-PO-NBR.                    01610013
016200     MOVE RC040-PO-RCVR          TO DK-REC-SEQ-NBR.               01620013
016300     MOVE RC040-SIGNON-LOCATION  TO KRPRPM-LOC-ID                 01630021
016310                                    DK-OPER-UNT-ID.               01631021
016400                                                                  01640013
016500     IF  RC040-PO-RCVR  >  0                                      01650013
016600         SET RC040-RCVR-EXISTS  TO TRUE                           01660013
016700         PERFORM 0500-SELECT-CURRENT-OPER                         01670013
016800     END-IF.                                                      01680013
016900                                                                  01690013
017000     IF  RC040-DC-LEVEL                                           01700013
017100         PERFORM 3000-CHECK-DC-AUTOVE                             01710013
017200     ELSE                                                         01720013
017300         PERFORM 1000-PROCESS-VERIF-CHECK                         01730013
017400     END-IF.                                                      01740013
017410                                                                  01741020
017500     IF RC040-AUTO-VE-YES AND RC040-CHCK-MSDIRCT-YES              01750020
017510        PERFORM 3500-CHECK-MISDIRECT-PARM                         01751020
017520     END-IF                                                       01752020
017530                                                                  01753020
017600     PERFORM 9998-RETURN.                                         01760013
017700                                                                  01770013
017800 0500-SELECT-CURRENT-OPER.                                        01780013
017900                                                                  01790013
018000     EXEC SQL                                                     01800013
018100          SELECT   CURR_OPER_UNT_ID                               01810013
018200            INTO  :RECEIV-CURR-OPER-UNT-ID                        01820013
018300            FROM                                                  01830013
018400                  TRECEIV                                         01840013
018500            WHERE ORD_NBR           = :DK-PO-NBR                  01850013
018600              AND REC_SEQ_NBR       = :DK-REC-SEQ-NBR             01860013
018700              AND VER_STATUS_CDE    = 'A'                         01870018
018800     END-EXEC.                                                    01880013
018900                                                                  01890013
019000     EVALUATE TRUE                                                01900013
019100         WHEN SQLCODE = ZERO                                      01910013
019200             IF RECEIV-CURR-OPER-UNT-ID > 0                       01920013
019300                MOVE RECEIV-CURR-OPER-UNT-ID  TO KRPRPM-LOC-ID    01930013
019400             ELSE                                                 01940013
019500                SET RC040-NOT-SUCCESSFUL TO TRUE                  01950013
019600                MOVE RC040-PO-NBR    TO  PV-DISP-PO               01960013
019700                MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR  01970013
019800                MOVE RECEIV-CURR-OPER-UNT-ID TO                   01980013
019900                                      PV-DISP-OPER-UNT-ID         01990013
020000                MOVE SQLCODE             TO PV-DISPLAY-SQLCODE    02000013
020100                STRING   ' RCKUT127-0500-'                        02010013
020200                         ' INVALID CURRENT OPER '                 02020014
020300                         ' PO='                                   02030013
020400                         PV-DISP-PO                               02040013
020500                         ' RCVR='                                 02050013
020600                         PV-DISP-RCVR-SEQ-NBR                     02060013
020700                         'OPER UNT'                               02070013
020800                         PV-DISP-OPER-UNT-ID                      02080013
020900                         DELIMITED BY SIZE                        02090013
021000                                         INTO RC040-CRA-RET-MSG   02100013
021100                MOVE '0500-'        TO RC040-CRA-REQ-ID           02110013
021200                PERFORM 9998-RETURN                               02120013
021300             END-IF                                               02130013
021400         WHEN SQLCODE = -904                                      02140013
021500         WHEN SQLCODE = -911                                      02150013
021600             SET RC040-DATABASE-BUSY   TO TRUE                    02160013
021700             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  02170013
021800             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     02180013
021900             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       02190013
022000             STRING   ' RCKUT127-0500-'                           02200013
022100                      ' CALLED BY-'                               02210013
022200                      RC040-CALLING-PROGRAM                       02220013
022300                      ' PO='                                      02230013
022400                      PV-DISP-PO                                  02240013
022500                      ' RCVR='                                    02250013
022600                      PV-DISP-RCVR-SEQ-NBR                        02260013
022700                      'SQLCODE'                                   02270013
022800                      PV-DISPLAY-SQLCODE                          02280013
022900                      DELIMITED BY SIZE                           02290013
023000                                      INTO RC040-CRA-RET-MSG      02300013
023100             MOVE '0500-'        TO RC040-CRA-REQ-ID              02310013
023200             PERFORM 9998-RETURN                                  02320013
023300         WHEN SQLWARN0 NOT = SPACES                               02330013
023400         WHEN SQLCODE  NOT = ZERO                                 02340013
023500             SET RC040-INVALID-SQL     TO TRUE                    02350013
023600             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  02360013
023700             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     02370013
023800             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       02380013
023900             STRING   ' RCKUT127-0500-'                           02390013
024000                      ' CALLED BY-'                               02400013
024100                      RC040-CALLING-PROGRAM                       02410013
024200                      ' PO='                                      02420013
024300                      PV-DISP-PO                                  02430013
024400                      ' RCVR='                                    02440013
024500                      PV-DISP-RCVR-SEQ-NBR                        02450013
024600                      'SQLCODE'                                   02460013
024700                      PV-DISPLAY-SQLCODE                          02470013
024800                      DELIMITED BY SIZE                           02480013
024900                                      INTO RC040-CRA-RET-MSG      02490013
025000             MOVE '0500-'        TO RC040-CRA-REQ-ID              02500013
025100             PERFORM 9998-RETURN                                  02510013
025200     END-EVALUATE.                                                02520013
025300                                                                  02530013
025400 1000-PROCESS-VERIF-CHECK.                                        02540013
025500                                                                  02550013
025600     IF RC040-RCVR-EXISTS                                         02560013
025700        PERFORM 2000-GET-DEPT-BY-RCVR                             02570013
025800     ELSE                                                         02580013
025900        PERFORM 2100-GET-DEPT-BY-PO                               02590013
026000     END-IF                                                       02600013
026100                                                                  02610013
026200                                                                  02620013
026300     IF PS-NOT-DONE                                               02630013
026400        IF RC040-RCVR-EXISTS                                      02640013
026500           IF  (RECEIV-REC-TYP-CDE = 'AP') OR                     02650013
026600               (RECEIV-REC-TYP-CDE = 'CR') OR                     02660019
026700               (XLT00010-LOC-TYP-CDE NOT = 'DC')                  02670013
026800               SET PS-DONE                                        02680013
026900                   RC040-AUTO-VE-NO TO TRUE                       02690013
027000           END-IF                                                 02700013
027100        ELSE                                                      02710013
027200            SET PS-NOT-DONE TO TRUE                               02720013
027300        END-IF                                                    02730013
027400     END-IF                                                       02740013
027500                                                                  02750013
027600*    CHECK AT SINGLE DEPT LEVEL                                   02760013
027700     IF PS-NOT-DONE                                               02770013
027800         PERFORM 2200A-CHECK-TKRPRPM-AUTVE1                       02780013
027900         IF PS-AUTO-VE-BY-DEPT1-YES                               02790013
028000             PERFORM 2250-CHECK-DEPT-TO-PARM                      02800013
028100         END-IF                                                   02810013
028200     END-IF                                                       02820013
028300                                                                  02830007
028400     IF PS-NOT-DONE AND RC040-AUTO-VE-NO                          02840007
028500         PERFORM 2200B-CHECK-TKRPRPM-AUTVE2                       02850007
028600         IF PS-AUTO-VE-BY-DEPT2-YES                               02860013
028700             PERFORM 2250-CHECK-DEPT-TO-PARM                      02870007
028800         END-IF                                                   02880013
028900     END-IF                                                       02890013
029000                                                                  02900007
029100     IF PS-NOT-DONE AND RC040-AUTO-VE-NO                          02910007
029200         PERFORM 2200C-CHECK-TKRPRPM-AUTVE3                       02920007
029300         IF PS-AUTO-VE-BY-DEPT3-YES                               02930013
029400             PERFORM 2250-CHECK-DEPT-TO-PARM                      02940007
029500         END-IF                                                   02950013
029600     END-IF                                                       02960013
029700                                                                  02970007
029800*    CHECK AT MULTIPLE DEPT LEVEL                                 02980008
029900     IF PS-NOT-DONE AND RC040-AUTO-VE-NO                          02990007
030000        PERFORM 2200-CHECK-TKRPRPM-AUTOVE                         03000007
030100        IF PS-AUTO-VE-BY-DEPT-YES                                 03010007
030200           PERFORM 2250-CHECK-DEPT-TO-PARM                        03020007
030300        END-IF                                                    03030007
030400                                                                  03040007
030500*    CHECK AT DC LEVEL                                            03050008
030600        IF RC040-AUTO-VE-NO                                       03060007
030700           PERFORM 2400-CHECK-DC-AUTO-VE                          03070007
030800        END-IF                                                    03080007
030900     END-IF.                                                      03090007
031000                                                                  03100007
031100 2000-GET-DEPT-BY-RCVR.                                           03110007
031200                                                                  03120007
031300     EXEC SQL                                                     03130007
031400          SELECT   A.DEPT_NBR                                     03140013
031500               ,   B.CRE_TMST                                     03150013
031600               ,   B.REC_TYP_CDE                                  03160013
031700               ,   C.LOC_TYP_CDE                                  03170013
031800            INTO  :PURCHS-DEPT-NBR                                03180013
031900               ,  :RECEIV-CRE-TMST                                03190013
032000               ,  :RECEIV-REC-TYP-CDE                             03200013
032100               ,  :XLT00010-LOC-TYP-CDE                           03210013
032200            FROM                                                  03220013
032300                  TPURCHS A                                       03230013
032400               ,  TRECEIV B                                       03240013
032500               ,  XLT_LOC C                                       03250013
032600            WHERE                                                 03260013
032700                  B.ORD_NBR         = :DK-PO-NBR                  03270013
032800              AND B.REC_SEQ_NBR     = :DK-REC-SEQ-NBR             03280013
032900              AND B.ORD_NBR         =  A.PO_NBR                   03290013
033000              AND B.PO_VER_NBR      =  A.VER_NBR                  03300013
033100              AND B.OPER_UNT_ID     =  C.LOC_NBR                  03310013
033200     END-EXEC.                                                    03320013
033300                                                                  03330013
033400     EVALUATE TRUE                                                03340013
033500         WHEN SQLCODE = ZERO                                      03350013
033600             CONTINUE                                             03360013
033700         WHEN SQLCODE = +100                                      03370016
033800             SET PS-DONE TO TRUE                                  03380015
033900             SET RC040-AUTO-VE-NO TO TRUE                         03390016
034000         WHEN SQLCODE = -904                                      03400013
034100         WHEN SQLCODE = -911                                      03410013
034200             SET RC040-DATABASE-BUSY   TO TRUE                    03420013
034300             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  03430013
034400             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     03440013
034500             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       03450013
034600             STRING   ' RCKUT127-2000-'                           03460013
034700                      ' CALLED BY-'                               03470013
034800                      RC040-CALLING-PROGRAM                       03480013
034900                      ' PO='                                      03490013
035000                      PV-DISP-PO                                  03500013
035100                      ' RCVR='                                    03510013
035200                      PV-DISP-RCVR-SEQ-NBR                        03520013
035300                      'SQLCODE'                                   03530013
035400                      PV-DISPLAY-SQLCODE                          03540013
035500                      DELIMITED BY SIZE                           03550013
035600                                      INTO RC040-CRA-RET-MSG      03560013
035700             MOVE '2000-'        TO RC040-CRA-REQ-ID              03570013
035800             PERFORM 9998-RETURN                                  03580013
035900         WHEN SQLWARN0 NOT = SPACES                               03590013
036000         WHEN SQLCODE  NOT = ZERO                                 03600013
036100             SET RC040-INVALID-SQL     TO TRUE                    03610013
036200             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  03620013
036300             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     03630013
036400             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       03640013
036500             STRING   ' RCKUT127-2000-'                           03650013
036600                      ' CALLED BY-'                               03660013
036700                      RC040-CALLING-PROGRAM                       03670013
036800                      ' PO='                                      03680013
036900                      PV-DISP-PO                                  03690013
037000                      ' RCVR='                                    03700013
037100                      PV-DISP-RCVR-SEQ-NBR                        03710013
037200                      'SQLCODE'                                   03720013
037300                      PV-DISPLAY-SQLCODE                          03730013
037400                      DELIMITED BY SIZE                           03740013
037500                                      INTO RC040-CRA-RET-MSG      03750013
037600             MOVE '2000-'        TO RC040-CRA-REQ-ID              03760013
037700             PERFORM 9998-RETURN                                  03770013
037800     END-EVALUATE.                                                03780013
037900                                                                  03790013
038000 2100-GET-DEPT-BY-PO.                                             03800013
038100                                                                  03810013
038200     EXEC SQL                                                     03820013
038300          SELECT   DISTINCT                                       03830013
038400                   A.DEPT_NBR                                     03840013
038500               ,   CURRENT TIMESTAMP                              03850013
038600            INTO  :PURCHS-DEPT-NBR                                03860013
038700               ,  :RECEIV-CRE-TMST                                03870013
038800            FROM                                                  03880013
038900                  TPURCHS A                                       03890013
039000            WHERE                                                 03900013
039100                  A.PO_NBR          = :DK-PO-NBR                  03910013
039200             AND  VER_STATUS_CDE    = 'A'                         03920013
039300     END-EXEC.                                                    03930013
039400                                                                  03940013
039500     EVALUATE TRUE                                                03950013
039600         WHEN SQLCODE = ZERO                                      03960013
039700             CONTINUE                                             03970013
039800         WHEN SQLCODE = +100                                      03980013
039900             SET PS-DONE                                          03990013
040000                 RC040-AUTO-VE-NO TO TRUE                         04000013
040100         WHEN SQLCODE = -904                                      04010013
040200         WHEN SQLCODE = -911                                      04020013
040300             SET RC040-DATABASE-BUSY   TO TRUE                    04030013
040400             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  04040013
040500             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       04050013
040600             STRING   ' RCKUT127-2100-'                           04060013
040700                      ' CALLED BY-'                               04070013
040800                      RC040-CALLING-PROGRAM                       04080013
040900                      ' PO='                                      04090013
041000                      PV-DISP-PO                                  04100013
041100                      ' RCVR='                                    04110013
041200                      PV-DISP-RCVR-SEQ-NBR                        04120013
041300                      'SQLCODE'                                   04130013
041400                      PV-DISPLAY-SQLCODE                          04140013
041500                      DELIMITED BY SIZE                           04150013
041600                                      INTO RC040-CRA-RET-MSG      04160013
041700             MOVE '2100-'        TO RC040-CRA-REQ-ID              04170013
041800             PERFORM 9998-RETURN                                  04180013
041900         WHEN SQLWARN0 NOT = SPACES                               04190013
042000         WHEN SQLCODE  NOT = ZERO                                 04200013
042100             SET RC040-INVALID-SQL     TO TRUE                    04210013
042200             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  04220013
042300             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     04230013
042400             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       04240013
042500             STRING   ' RCKUT127-2100-'                           04250013
042600                      ' CALLED BY-'                               04260013
042700                      RC040-CALLING-PROGRAM                       04270013
042800                      ' PO='                                      04280013
042900                      PV-DISP-PO                                  04290013
043000                      ' RCVR='                                    04300013
043100                      PV-DISP-RCVR-SEQ-NBR                        04310013
043200                      'SQLCODE'                                   04320013
043300                      PV-DISPLAY-SQLCODE                          04330013
043400                      DELIMITED BY SIZE                           04340013
043500                                      INTO RC040-CRA-RET-MSG      04350013
043600             MOVE '2100-'        TO RC040-CRA-REQ-ID              04360013
043700             PERFORM 9998-RETURN                                  04370013
043800     END-EVALUATE.                                                04380013
043900                                                                  04390013
044000                                                                  04400013
044100 2200-CHECK-TKRPRPM-AUTOVE.                                       04410013
044200                                                                  04420013
044300                                                                  04430013
044400     EXEC SQL                                                     04440013
044500          SELECT   FUNC_TXT                                       04450013
044600                ,  FUNC_BEG_TMST                                  04460013
044700                ,  FUNC_END_TMST                                  04470013
044800            INTO  :KRPRPM-FUNC-TXT                                04480013
044900                , :KRPRPM-FUNC-BEG-TMST                           04490013
045000                , :KRPRPM-FUNC-END-TMST                           04500013
045100            FROM                                                  04510013
045200                  TKRPRPM A                                       04520013
045300            WHERE                                                 04530013
045400                  LOC_ID            = :KRPRPM-LOC-ID              04540013
045500              AND SYS_PRC_FUNC_CDE  = 'AUTVED'                    04550013
045600              AND FUNC_PRC_STAT_CDE = 'AC'                        04560013
045700              AND INTFC_SYS_CDE     = 'KHL'                       04570013
045800              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            04580013
045900     END-EXEC.                                                    04590013
046000                                                                  04600013
046100     EVALUATE TRUE                                                04610013
046200         WHEN SQLCODE = ZERO                                      04620013
046300              MOVE KRPRPM-FUNC-TXT  TO                            04630013
046400                                 PV-AUTOVE-BY-DEPT-WORK-AREA      04640013
046500*             SET  PS-AUTO-VE-BY-DEPT-YES  TO  TRUE               04650013
046600         WHEN SQLCODE = +100                                      04660013
046700              SET PS-AUTO-VE-BY-DEPT-NO TO TRUE                   04670013
046800         WHEN SQLWARN0 NOT = SPACES                               04680013
046900         WHEN SQLCODE  NOT = ZERO                                 04690013
047000             SET RC040-INVALID-SQL     TO TRUE                    04700013
047100             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  04710013
047200             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     04720013
047300             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       04730013
047400             STRING   ' RCKUT127-2200-'                           04740013
047500                      ' CALLED BY-'                               04750013
047600                      RC040-CALLING-PROGRAM                       04760013
047700                      ' PO='                                      04770013
047800                      PV-DISP-PO                                  04780013
047900                      ' RCVR='                                    04790013
048000                      PV-DISP-RCVR-SEQ-NBR                        04800013
048100                      'SQLCODE'                                   04810013
048200                      PV-DISPLAY-SQLCODE                          04820013
048300                      DELIMITED BY SIZE                           04830013
048400                                      INTO RC040-CRA-RET-MSG      04840013
048500             MOVE '2200-'        TO RC040-CRA-REQ-ID              04850013
048600             PERFORM 9998-RETURN                                  04860013
048700     END-EVALUATE.                                                04870013
048800                                                                  04880013
048900 2200A-CHECK-TKRPRPM-AUTVE1.                                      04890007
049000                                                                  04900007
049100     EXEC SQL                                                     04910007
049200          SELECT   FUNC_TXT                                       04920007
049300                ,  FUNC_BEG_TMST                                  04930007
049400                ,  FUNC_END_TMST                                  04940007
049500            INTO  :KRPRPM-FUNC-TXT                                04950007
049600                , :KRPRPM-FUNC-BEG-TMST                           04960007
049700                , :KRPRPM-FUNC-END-TMST                           04970007
049800            FROM                                                  04980007
049900                  TKRPRPM A                                       04990007
050000            WHERE                                                 05000007
050100                  LOC_ID            = :KRPRPM-LOC-ID              05010007
050200              AND SYS_PRC_FUNC_CDE  = 'AUTVE1'                    05020007
050300              AND FUNC_PRC_STAT_CDE = 'AC'                        05030007
050400              AND INTFC_SYS_CDE     = 'KHL'                       05040007
050500              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            05050007
050600     END-EXEC.                                                    05060007
050700                                                                  05070007
050800     EVALUATE TRUE                                                05080007
050900         WHEN SQLCODE = ZERO                                      05090007
051000              MOVE KRPRPM-FUNC-TXT  TO                            05100007
051100                                 PV-AUTOVE-BY-DEPT-WORK-AREA      05110007
051200         WHEN SQLCODE = +100                                      05120007
051300              SET PS-AUTO-VE-BY-DEPT1-NO TO TRUE                  05130007
051400         WHEN SQLWARN0 NOT = SPACES                               05140007
051500         WHEN SQLCODE  NOT = ZERO                                 05150007
051600             SET RC040-INVALID-SQL     TO TRUE                    05160007
051700             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  05170007
051800             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     05180007
051900             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       05190007
052000             STRING   ' RCKUT127-2200A-'                          05200007
052100                      ' CALLED BY-'                               05210007
052200                      RC040-CALLING-PROGRAM                       05220007
052300                      ' PO='                                      05230007
052400                      PV-DISP-PO                                  05240007
052500                      ' RCVR='                                    05250007
052600                      PV-DISP-RCVR-SEQ-NBR                        05260007
052700                      'SQLCODE'                                   05270007
052800                      PV-DISPLAY-SQLCODE                          05280007
052900                      DELIMITED BY SIZE                           05290007
053000                                      INTO RC040-CRA-RET-MSG      05300013
053100             MOVE '2200A-'       TO RC040-CRA-REQ-ID              05310013
053200             PERFORM 9998-RETURN                                  05320013
053300     END-EVALUATE.                                                05330013
053400                                                                  05340013
053500 2200B-CHECK-TKRPRPM-AUTVE2.                                      05350007
053600                                                                  05360007
053700     EXEC SQL                                                     05370007
053800          SELECT   FUNC_TXT                                       05380007
053900                ,  FUNC_BEG_TMST                                  05390007
054000                ,  FUNC_END_TMST                                  05400007
054100            INTO  :KRPRPM-FUNC-TXT                                05410007
054200                , :KRPRPM-FUNC-BEG-TMST                           05420007
054300                , :KRPRPM-FUNC-END-TMST                           05430007
054400            FROM                                                  05440007
054500                  TKRPRPM A                                       05450007
054600            WHERE                                                 05460007
054700                  LOC_ID            = :KRPRPM-LOC-ID              05470007
054800              AND SYS_PRC_FUNC_CDE  = 'AUTVE2'                    05480007
054900              AND FUNC_PRC_STAT_CDE = 'AC'                        05490007
055000              AND INTFC_SYS_CDE     = 'KHL'                       05500007
055100              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            05510007
055200     END-EXEC.                                                    05520007
055300                                                                  05530007
055400     EVALUATE TRUE                                                05540007
055500         WHEN SQLCODE = ZERO                                      05550007
055600              MOVE KRPRPM-FUNC-TXT  TO                            05560007
055700                                 PV-AUTOVE-BY-DEPT-WORK-AREA      05570007
055800         WHEN SQLCODE = +100                                      05580007
055900              SET PS-AUTO-VE-BY-DEPT2-NO TO TRUE                  05590007
056000         WHEN SQLWARN0 NOT = SPACES                               05600007
056100         WHEN SQLCODE  NOT = ZERO                                 05610007
056200             SET RC040-INVALID-SQL     TO TRUE                    05620007
056300             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  05630007
056400             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     05640007
056500             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       05650007
056600             STRING   ' RCKUT127-2200B-'                          05660013
056700                      ' CALLED BY-'                               05670007
056800                      RC040-CALLING-PROGRAM                       05680007
056900                      ' PO='                                      05690007
057000                      PV-DISP-PO                                  05700007
057100                      ' RCVR='                                    05710007
057200                      PV-DISP-RCVR-SEQ-NBR                        05720007
057300                      'SQLCODE'                                   05730007
057400                      PV-DISPLAY-SQLCODE                          05740007
057500                      DELIMITED BY SIZE                           05750007
057600                                      INTO RC040-CRA-RET-MSG      05760013
057700             MOVE '2200B-'       TO RC040-CRA-REQ-ID              05770013
057800             PERFORM 9998-RETURN                                  05780013
057900     END-EVALUATE.                                                05790013
058000                                                                  05800013
058100 2200C-CHECK-TKRPRPM-AUTVE3.                                      05810007
058200                                                                  05820007
058300     EXEC SQL                                                     05830007
058400          SELECT   FUNC_TXT                                       05840007
058500                ,  FUNC_BEG_TMST                                  05850007
058600                ,  FUNC_END_TMST                                  05860007
058700            INTO  :KRPRPM-FUNC-TXT                                05870007
058800                , :KRPRPM-FUNC-BEG-TMST                           05880007
058900                , :KRPRPM-FUNC-END-TMST                           05890007
059000            FROM                                                  05900007
059100                  TKRPRPM A                                       05910007
059200            WHERE                                                 05920007
059300                  LOC_ID            = :KRPRPM-LOC-ID              05930007
059400              AND SYS_PRC_FUNC_CDE  = 'AUTVE3'                    05940007
059500              AND FUNC_PRC_STAT_CDE = 'AC'                        05950007
059600              AND INTFC_SYS_CDE     = 'KHL'                       05960007
059700              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            05970007
059800     END-EXEC.                                                    05980007
059900                                                                  05990007
060000     EVALUATE TRUE                                                06000007
060100         WHEN SQLCODE = ZERO                                      06010007
060200              MOVE KRPRPM-FUNC-TXT  TO                            06020007
060300                                 PV-AUTOVE-BY-DEPT-WORK-AREA      06030007
060400         WHEN SQLCODE = +100                                      06040007
060500              SET PS-AUTO-VE-BY-DEPT3-NO TO TRUE                  06050007
060600         WHEN SQLWARN0 NOT = SPACES                               06060007
060700         WHEN SQLCODE  NOT = ZERO                                 06070007
060800             SET RC040-INVALID-SQL     TO TRUE                    06080007
060900             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  06090007
061000             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     06100007
061100             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       06110007
061200             STRING   ' RCKUT127-2200C-'                          06120013
061300                      ' CALLED BY-'                               06130007
061400                      RC040-CALLING-PROGRAM                       06140007
061500                      ' PO='                                      06150007
061600                      PV-DISP-PO                                  06160007
061700                      ' RCVR='                                    06170007
061800                      PV-DISP-RCVR-SEQ-NBR                        06180007
061900                      'SQLCODE'                                   06190007
062000                      PV-DISPLAY-SQLCODE                          06200007
062100                      DELIMITED BY SIZE                           06210007
062200                                      INTO RC040-CRA-RET-MSG      06220007
062300             MOVE '2200C-'       TO RC040-CRA-REQ-ID              06230007
062400             PERFORM 9998-RETURN                                  06240013
062500     END-EVALUATE.                                                06250013
062600                                                                  06260013
062700 2250-CHECK-DEPT-TO-PARM.                                         06270013
062800                                                                  06280013
062900     IF (PURCHS-DEPT-NBR    = PV-DEPT-01 OR                       06290013
063000         PURCHS-DEPT-NBR    = PV-DEPT-02 OR                       06300013
063100         PURCHS-DEPT-NBR    = PV-DEPT-03 OR                       06310013
063200         PURCHS-DEPT-NBR    = PV-DEPT-04 OR                       06320013
063300         PURCHS-DEPT-NBR    = PV-DEPT-05 OR                       06330013
063400         PURCHS-DEPT-NBR    = PV-DEPT-06 OR                       06340013
063500         PURCHS-DEPT-NBR    = PV-DEPT-07 OR                       06350013
063600         PURCHS-DEPT-NBR    = PV-DEPT-08 ) AND                    06360013
063700         RECEIV-CRE-TMST    >= KRPRPM-FUNC-BEG-TMST AND           06370013
063800         RECEIV-CRE-TMST    <= KRPRPM-FUNC-END-TMST               06380013
063900           SET RC040-AUTO-VE-YES  TO TRUE                         06390013
064000     END-IF.                                                      06400013
064100                                                                  06410013
064200                                                                  06420013
064300 2400-CHECK-DC-AUTO-VE.                                           06430013
064400                                                                  06440013
064500     EXEC SQL                                                     06450013
064600          SELECT   FUNC_TXT                                       06460013
064700            INTO  :KRPRPM-FUNC-TXT                                06470013
064800            FROM                                                  06480013
064900                  TKRPRPM A                                       06490013
065000            WHERE                                                 06500013
065100                  LOC_ID            = :KRPRPM-LOC-ID              06510013
065200              AND SYS_PRC_FUNC_CDE  = 'AUTOVE'                    06520013
065300              AND FUNC_PRC_STAT_CDE = 'AC'                        06530013
065400              AND INTFC_SYS_CDE     = 'KHL'                       06540013
065500              AND FUNC_BEG_TMST    <=   :RECEIV-CRE-TMST          06550013
065600              AND FUNC_END_TMST    >=   :RECEIV-CRE-TMST          06560013
065700     END-EXEC.                                                    06570013
065800                                                                  06580013
065900     EVALUATE TRUE                                                06590013
066000         WHEN SQLCODE = ZERO                                      06600013
066100              IF KRPRPM-FUNC-TXT   = 'Y'                          06610013
066200                 SET RC040-AUTO-VE-YES TO TRUE                    06620013
066300              ELSE                                                06630013
066400                 SET RC040-AUTO-VE-NO TO TRUE                     06640013
066500              END-IF                                              06650013
066600         WHEN SQLCODE = +100                                      06660016
066700              SET RC040-AUTO-VE-NO TO TRUE                        06670013
066800         WHEN SQLWARN0 NOT = SPACES                               06680013
066900         WHEN SQLCODE  NOT = ZERO                                 06690013
067000             SET RC040-INVALID-SQL     TO TRUE                    06700013
067100             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  06710013
067200             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     06720013
067300             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       06730013
067400             STRING   ' RCKUT127-2400-'                           06740013
067500                      ' CALLED BY-'                               06750013
067600                      RC040-CALLING-PROGRAM                       06760013
067700                      ' PO='                                      06770013
067800                      PV-DISP-PO                                  06780013
067900                      ' RCVR='                                    06790013
068000                      PV-DISP-RCVR-SEQ-NBR                        06800013
068100                      'SQLCODE'                                   06810013
068200                      PV-DISPLAY-SQLCODE                          06820013
068300                      DELIMITED BY SIZE                           06830013
068400                                      INTO RC040-CRA-RET-MSG      06840013
068500             MOVE '2400-'        TO RC040-CRA-REQ-ID              06850013
068600             PERFORM 9998-RETURN                                  06860013
068700     END-EVALUATE.                                                06870013
068800                                                                  06880013
068900                                                                  06890013
069000 3000-CHECK-DC-AUTOVE.                                            06900013
069100                                                                  06910013
069200     SET  RC040-FACILITY-AUTOVE-NO  TO  TRUE.                     06920013
069300                                                                  06930013
069400     PERFORM 3100-CHECK-DC-AUTOVE.                                06940013
069500                                                                  06950013
069600     IF  RC040-FACILITY-AUTOVE-NO                                 06960013
069700         PERFORM 3200-CHECK-DC-AUTOVE-DEPT                        06970013
069800     END-IF.                                                      06980013
069900                                                                  06990013
070000     IF  RC040-FACILITY-AUTOVE-NO                                 07000013
070100         PERFORM 3250-CHECK-DC-AUTOVE-DEPT                        07010013
070200     END-IF.                                                      07020013
070300                                                                  07030013
070400     IF  RC040-FACILITY-AUTOVE-NO                                 07040013
070500         PERFORM 3251-CHECK-DC-AUTOVE-DEPT                        07050013
070600     END-IF.                                                      07060013
070700                                                                  07070013
070800     IF  RC040-FACILITY-AUTOVE-NO                                 07080007
070900         PERFORM 3252-CHECK-DC-AUTOVE-DEPT                        07090013
071000     END-IF.                                                      07100013
071100                                                                  07110013
071200                                                                  07120013
071300 3100-CHECK-DC-AUTOVE.                                            07130013
071400                                                                  07140013
071500                                                                  07150013
071600     EXEC SQL                                                     07160013
071700          SELECT   FUNC_TXT                                       07170013
071800            INTO  :KRPRPM-FUNC-TXT                                07180013
071900            FROM                                                  07190013
072000                  TKRPRPM A                                       07200013
072100            WHERE                                                 07210013
072200                  LOC_ID            = :KRPRPM-LOC-ID              07220013
072300              AND SYS_PRC_FUNC_CDE  = 'AUTOVE'                    07230013
072400              AND FUNC_PRC_STAT_CDE = 'AC'                        07240013
072500              AND INTFC_SYS_CDE     = 'KHL'                       07250013
072600              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            07260013
072700     END-EXEC.                                                    07270013
072800                                                                  07280013
072900     EVALUATE TRUE                                                07290013
073000         WHEN SQLCODE = ZERO                                      07300013
073100              IF  KRPRPM-FUNC-TXT  =  'Y'                         07310013
073200                  SET  RC040-FACILITY-AUTOVE-YES  TO  TRUE        07320013
073300              ELSE                                                07330013
073400                  SET  RC040-FACILITY-AUTOVE-NO   TO  TRUE        07340013
073500              END-IF                                              07350013
073600                                                                  07360013
073700         WHEN SQLCODE = +100                                      07370013
073800              SET RC040-FACILITY-AUTOVE-NO  TO  TRUE              07380013
073900                                                                  07390013
074000         WHEN SQLWARN0 NOT = SPACES                               07400013
074100         WHEN SQLCODE  NOT = ZERO                                 07410013
074200             SET RC040-INVALID-SQL     TO TRUE                    07420013
074300             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  07430013
074400             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     07440013
074500             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       07450013
074600             STRING   ' RCKUT127-3100-'                           07460013
074700                      ' CALLED BY-'                               07470013
074800                      RC040-CALLING-PROGRAM                       07480013
074900                      ' PO='                                      07490013
075000                      PV-DISP-PO                                  07500013
075100                      ' RCVR='                                    07510013
075200                      PV-DISP-RCVR-SEQ-NBR                        07520013
075300                      'SQLCODE'                                   07530013
075400                      PV-DISPLAY-SQLCODE                          07540013
075500                      DELIMITED BY SIZE                           07550013
075600                                      INTO RC040-CRA-RET-MSG      07560013
075700             MOVE '3100-'        TO RC040-CRA-REQ-ID              07570013
075800             PERFORM 9998-RETURN                                  07580013
075900     END-EVALUATE.                                                07590013
076000                                                                  07600013
076100                                                                  07610013
076200 3200-CHECK-DC-AUTOVE-DEPT.                                       07620013
076300                                                                  07630013
076400                                                                  07640013
076500     EXEC SQL                                                     07650013
076600          SELECT   FUNC_TXT                                       07660013
076700            INTO  :KRPRPM-FUNC-TXT                                07670013
076800            FROM                                                  07680013
076900                  TKRPRPM A                                       07690013
077000            WHERE                                                 07700013
077100                  LOC_ID            = :KRPRPM-LOC-ID              07710013
077200              AND SYS_PRC_FUNC_CDE  = 'AUTVED'                    07720013
077300              AND FUNC_PRC_STAT_CDE = 'AC'                        07730013
077400              AND INTFC_SYS_CDE     = 'KHL'                       07740013
077500              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            07750013
077600     END-EXEC.                                                    07760013
077700                                                                  07770013
077800     EVALUATE TRUE                                                07780013
077900         WHEN SQLCODE = ZERO                                      07790013
078000              IF  KRPRPM-FUNC-TXT(1:1) = 'Y'                      07800013
078100                  SET  RC040-FACILITY-AUTOVE-YES  TO  TRUE        07810013
078200              ELSE                                                07820013
078300                  SET  RC040-FACILITY-AUTOVE-NO   TO  TRUE        07830013
078400              END-IF                                              07840013
078500                                                                  07850013
078600         WHEN SQLCODE = +100                                      07860013
078700              SET RC040-FACILITY-AUTOVE-NO  TO  TRUE              07870013
078800                                                                  07880013
078900         WHEN SQLWARN0 NOT = SPACES                               07890013
079000         WHEN SQLCODE  NOT = ZERO                                 07900013
079100             SET RC040-INVALID-SQL     TO TRUE                    07910013
079200             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  07920013
079300             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     07930013
079400             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       07940013
079500             STRING   ' RCKUT127-3200-'                           07950013
079600                      ' CALLED BY-'                               07960013
079700                      RC040-CALLING-PROGRAM                       07970013
079800                      ' PO='                                      07980013
079900                      PV-DISP-PO                                  07990013
080000                      ' RCVR='                                    08000013
080100                      PV-DISP-RCVR-SEQ-NBR                        08010013
080200                      'SQLCODE'                                   08020013
080300                      PV-DISPLAY-SQLCODE                          08030013
080400                      DELIMITED BY SIZE                           08040013
080500                                      INTO RC040-CRA-RET-MSG      08050013
080600             MOVE '3200-'        TO RC040-CRA-REQ-ID              08060013
080700             PERFORM 9998-RETURN                                  08070013
080800     END-EVALUATE.                                                08080013
080900                                                                  08090013
081000                                                                  08100013
081100 3250-CHECK-DC-AUTOVE-DEPT.                                       08110007
081200                                                                  08120007
081300                                                                  08130007
081400     EXEC SQL                                                     08140007
081500          SELECT   FUNC_TXT                                       08150007
081600            INTO  :KRPRPM-FUNC-TXT                                08160007
081700            FROM                                                  08170007
081800                  TKRPRPM A                                       08180007
081900            WHERE                                                 08190007
082000                  LOC_ID            = :KRPRPM-LOC-ID              08200007
082100              AND SYS_PRC_FUNC_CDE  = 'AUTVE1'                    08210007
082200              AND FUNC_PRC_STAT_CDE = 'AC'                        08220007
082300              AND INTFC_SYS_CDE     = 'KHL'                       08230007
082400              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            08240007
082500     END-EXEC.                                                    08250007
082600                                                                  08260007
082700     EVALUATE TRUE                                                08270007
082800         WHEN SQLCODE = ZERO                                      08280007
082900              IF  KRPRPM-FUNC-TXT(1:1) =  'Y'                     08290013
083000                  SET  RC040-FACILITY-AUTOVE-YES  TO  TRUE        08300007
083100              ELSE                                                08310007
083200                  SET  RC040-FACILITY-AUTOVE-NO   TO  TRUE        08320007
083300              END-IF                                              08330007
083400                                                                  08340007
083500         WHEN SQLCODE = +100                                      08350007
083600              SET RC040-FACILITY-AUTOVE-NO  TO  TRUE              08360007
083700                                                                  08370007
083800         WHEN SQLWARN0 NOT = SPACES                               08380007
083900         WHEN SQLCODE  NOT = ZERO                                 08390007
084000             SET RC040-INVALID-SQL     TO TRUE                    08400007
084100             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  08410007
084200             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     08420007
084300             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       08430013
084400             STRING   ' RCKUT127-3250-'                           08440013
084500                      ' CALLED BY-'                               08450013
084600                      RC040-CALLING-PROGRAM                       08460013
084700                      ' PO='                                      08470013
084800                      PV-DISP-PO                                  08480013
084900                      ' RCVR='                                    08490013
085000                      PV-DISP-RCVR-SEQ-NBR                        08500013
085100                      'SQLCODE'                                   08510013
085200                      PV-DISPLAY-SQLCODE                          08520013
085300                      DELIMITED BY SIZE                           08530013
085400                                      INTO RC040-CRA-RET-MSG      08540013
085500             MOVE '3250-'        TO RC040-CRA-REQ-ID              08550013
085600             PERFORM 9998-RETURN                                  08560013
085700     END-EVALUATE.                                                08570013
085800                                                                  08580013
085900 3251-CHECK-DC-AUTOVE-DEPT.                                       08590007
086000                                                                  08600007
086100                                                                  08610007
086200     EXEC SQL                                                     08620007
086300          SELECT   FUNC_TXT                                       08630007
086400            INTO  :KRPRPM-FUNC-TXT                                08640007
086500            FROM                                                  08650007
086600                  TKRPRPM A                                       08660007
086700            WHERE                                                 08670007
086800                  LOC_ID            = :KRPRPM-LOC-ID              08680007
086900              AND SYS_PRC_FUNC_CDE  = 'AUTVE2'                    08690007
087000              AND FUNC_PRC_STAT_CDE = 'AC'                        08700007
087100              AND INTFC_SYS_CDE     = 'KHL'                       08710007
087200              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            08720007
087300     END-EXEC.                                                    08730007
087400                                                                  08740007
087500     EVALUATE TRUE                                                08750007
087600         WHEN SQLCODE = ZERO                                      08760007
087700              IF  KRPRPM-FUNC-TXT(1:1) =  'Y'                     08770013
087800                  SET  RC040-FACILITY-AUTOVE-YES  TO  TRUE        08780007
087900              ELSE                                                08790007
088000                  SET  RC040-FACILITY-AUTOVE-NO   TO  TRUE        08800007
088100              END-IF                                              08810007
088200                                                                  08820007
088300         WHEN SQLCODE = +100                                      08830007
088400              SET RC040-FACILITY-AUTOVE-NO  TO  TRUE              08840007
088500                                                                  08850007
088600         WHEN SQLWARN0 NOT = SPACES                               08860007
088700         WHEN SQLCODE  NOT = ZERO                                 08870007
088800             SET RC040-INVALID-SQL     TO TRUE                    08880007
088900             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  08890007
089000             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     08900007
089100             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       08910007
089200             STRING   ' RCKUT127-3251-'                           08920007
089300                      ' CALLED BY-'                               08930007
089400                      RC040-CALLING-PROGRAM                       08940013
089500                      ' PO='                                      08950013
089600                      PV-DISP-PO                                  08960013
089700                      ' RCVR='                                    08970013
089800                      PV-DISP-RCVR-SEQ-NBR                        08980013
089900                      'SQLCODE'                                   08990013
090000                      PV-DISPLAY-SQLCODE                          09000013
090100                      DELIMITED BY SIZE                           09010013
090200                                      INTO RC040-CRA-RET-MSG      09020013
090300             MOVE '3251-'        TO RC040-CRA-REQ-ID              09030013
090400             PERFORM 9998-RETURN                                  09040013
090500     END-EVALUATE.                                                09050013
090600                                                                  09060013
090700 3252-CHECK-DC-AUTOVE-DEPT.                                       09070007
090800                                                                  09080007
090900                                                                  09090007
091000     EXEC SQL                                                     09100007
091100          SELECT   FUNC_TXT                                       09110007
091200            INTO  :KRPRPM-FUNC-TXT                                09120007
091300            FROM                                                  09130007
091400                  TKRPRPM A                                       09140007
091500            WHERE                                                 09150007
091600                  LOC_ID            = :KRPRPM-LOC-ID              09160007
091700              AND SYS_PRC_FUNC_CDE  = 'AUTVE3'                    09170007
091800              AND FUNC_PRC_STAT_CDE = 'AC'                        09180007
091900              AND INTFC_SYS_CDE     = 'KHL'                       09190007
092000              AND FUNC_BEG_TMST    <> :PC-DEFAULT-TMST            09200007
092100     END-EXEC.                                                    09210007
092200                                                                  09220007
092300     EVALUATE TRUE                                                09230007
092400         WHEN SQLCODE = ZERO                                      09240007
092500              IF  KRPRPM-FUNC-TXT(1:1) =  'Y'                     09250013
092600                  SET  RC040-FACILITY-AUTOVE-YES  TO  TRUE        09260007
092700              ELSE                                                09270007
092800                  SET  RC040-FACILITY-AUTOVE-NO   TO  TRUE        09280007
092900              END-IF                                              09290007
093000                                                                  09300007
093100         WHEN SQLCODE = +100                                      09310007
093200              SET RC040-FACILITY-AUTOVE-NO  TO  TRUE              09320007
093300                                                                  09330007
093400         WHEN SQLWARN0 NOT = SPACES                               09340007
093500         WHEN SQLCODE  NOT = ZERO                                 09350007
093600             SET RC040-INVALID-SQL     TO TRUE                    09360007
093700             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  09370007
093800             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     09380007
093900             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       09390007
094000             STRING   ' RCKUT127-3252-'                           09400007
094100                      ' CALLED BY-'                               09410007
094200                      RC040-CALLING-PROGRAM                       09420007
094300                      ' PO='                                      09430007
094400                      PV-DISP-PO                                  09440007
094500                      ' RCVR='                                    09450007
094600                      PV-DISP-RCVR-SEQ-NBR                        09460007
094700                      'SQLCODE'                                   09470007
094800                      PV-DISPLAY-SQLCODE                          09480007
094900                      DELIMITED BY SIZE                           09490007
095000                                      INTO RC040-CRA-RET-MSG      09500007
095100             MOVE '3252-'        TO RC040-CRA-REQ-ID              09510007
095200             PERFORM 9998-RETURN                                  09520007
095300     END-EVALUATE.                                                09530007
095400                                                                  09540007
095410 3500-CHECK-MISDIRECT-PARM.                                       09541020
095430                                                                  09543020
095440     EXEC SQL                                                     09544020
095450          SELECT   FUNC_TXT                                       09545020
095480            INTO  :KRPRPM-FUNC-TXT                                09548020
095492            FROM                                                  09549220
095493                  TKRPRPM A                                       09549320
095494            WHERE                                                 09549420
095495                  LOC_ID            = :DK-OPER-UNT-ID             09549521
095496              AND SYS_PRC_FUNC_CDE  = 'PBSMSD'                    09549620
095497              AND FUNC_PRC_STAT_CDE = 'AC'                        09549720
095498              AND INTFC_SYS_CDE     = 'KHL'                       09549820
095499              AND FUNC_TXT          = 'Y'                         09549920
095500     END-EXEC.                                                    09550020
095501                                                                  09550120
095502     EVALUATE TRUE                                                09550220
095503         WHEN SQLCODE = ZERO                                      09550320
095504              SET RC040-PROCESS-MSDIRCT-YES TO TRUE               09550420
095507         WHEN SQLCODE = +100                                      09550720
095508              SET RC040-PROCESS-MSDIRCT-NO  TO TRUE               09550820
095510         WHEN SQLWARN0 NOT = SPACES                               09551020
095511         WHEN SQLCODE  NOT = ZERO                                 09551120
095512             SET RC040-INVALID-SQL     TO TRUE                    09551220
095513             MOVE RC040-PO-NBR    TO  PV-DISP-PO                  09551320
095514             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     09551420
095515             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       09551520
095516             STRING   ' RCKUT127-3500-'                           09551620
095517                      ' CALLED BY-'                               09551720
095518                      RC040-CALLING-PROGRAM                       09551820
095519                      ' PO='                                      09551920
095520                      PV-DISP-PO                                  09552020
095521                      ' RCVR='                                    09552120
095522                      PV-DISP-RCVR-SEQ-NBR                        09552220
095523                      'SQLCODE'                                   09552320
095524                      PV-DISPLAY-SQLCODE                          09552420
095525                      DELIMITED BY SIZE                           09552520
095526                                      INTO RC040-CRA-RET-MSG      09552620
095527             MOVE '3500-'        TO RC040-CRA-REQ-ID              09552720
095528             PERFORM 9998-RETURN                                  09552820
095529     END-EVALUATE.                                                09552920
095530                                                                  09553020
095540                                                                  09554007
095600*-----------------------------------------------------------------09560007
095700*  RETURN TO CALLING PROGRAM                                      09570007
095800*-----------------------------------------------------------------09580007
095900 9998-RETURN.                                                     09590013
096000                                                                  09600013
096100     MOVE SQLCA                         TO RC040-SQLCA.           09610013
096200     GOBACK.                                                      09620013
096300                                                                  09630013
