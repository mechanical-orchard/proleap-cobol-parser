000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         SVKRP008.                                    00020000
000300 AUTHOR.             DAVID COLOMBO - COMPUWARE.                   00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       MARCH 2000.                                  00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*----------------------------------------------------------------*00080000
000900* THIS PROGRAM PRODUCES STORED VALUE CARD ORDERS REPORT          *00090000
001000*                                                                *00100000
001100*----------------------------------------------------------------*00110000
001200*  CHANGED 04/13/00  BY DAVID COLOMBO - COMPUWARE  WR# 20894     *00120027
001300*          ADDED TRN_VOID_IND TO THE WHERE CLAUSE BUILD IN PARA  *00130024
001400*          1520-BUILD-ISSUE-CURSOR.                              *00140099
001500*----------------------------------------------------------------*00150000
001600*  09/19/01 - ARCHIVE PROJECT - GREG SHEFF                       *00160055
001700*   ALSO RETRIEVE DATA FROM HISTORY TABLES TKMCHTB AND TKMCHAC   *00170055
001800*----------------------------------------------------------------*00180055
001900*  03/31/02 - MULTI-CHANNEL GIFT CARD PROJECT     WR# 22603      *00190055
002000*   USE NEW STORED VALUE TABLES                                  *00200055
002100*   REMOVED THE TRN-RVRSL-CDE FROM THE CURSOR.  THE TRN-VOID-IND *00210065
002200*   HANDLES THE SELECT WITHOUT THE TRN-RVRSL-CDE.                *00220065
002300******************************************************************00230055
002400 ENVIRONMENT DIVISION.                                            00240000
002500*----------------------------------------------------------------*00250000
002600 CONFIGURATION SECTION.                                           00260000
002700                                                                  00270000
002800 SOURCE-COMPUTER.    IBM-3090.                                    00280000
002900 OBJECT-COMPUTER.    IBM-3090.                                    00290000
003000                                                                  00300000
003100 INPUT-OUTPUT SECTION.                                            00310000
003200                                                                  00320000
003300 FILE-CONTROL.                                                    00330000
003400                                                                  00340000
003500     SELECT CONTROL-CARD-FILE         ASSIGN TO INP01.            00350000
003600     SELECT REPORT-FILE               ASSIGN TO RPT01.            00360000
003700                                                                  00370000
003800*----------------------------------------------------------------*00380000
003900 DATA DIVISION.                                                   00390000
004000*----------------------------------------------------------------*00400000
004100                                                                  00410000
004200 FILE SECTION.                                                    00420000
004300                                                                  00430000
004400                                                                  00440000
004500 FD  CONTROL-CARD-FILE                                            00450000
004600     RECORDING MODE IS F                                          00460000
004700     BLOCK CONTAINS 0 RECORDS                                     00470000
004800     LABEL RECORDS ARE OMITTED.                                   00480000
004900                                                                  00490000
005000 01  CONTROL-CARD-RECORD              PIC X(80).                  00500000
005100                                                                  00510000
005200 FD  REPORT-FILE                                                  00520000
005300     RECORDING MODE IS F                                          00530000
005400     BLOCK CONTAINS 0 RECORDS                                     00540000
005500     LABEL RECORDS ARE OMITTED.                                   00550000
005600                                                                  00560000
005700 01  REPORT-RECORD                    PIC X(132).                 00570000
005800                                                                  00580000
005900 WORKING-STORAGE SECTION.                                         00590000
006000                                                                  00600000
006100 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.00610000
006200                                                                  00620000
006300                                                                  00630000
006400*----------------------------------------------------------------*00640000
006500*    CR-CONTROL RECORD   DATE IN MMDDCCYY FORMAT                 *00650000
006600*----------------------------------------------------------------*00660000
006700 01  CR-CONTROL-RECORD.                                           00670000
006800     05  CR-CONTROL-CARD.                                         00680000
006900         10  CR-REGION-IND            PIC  X(01)    VALUE SPACE.  00690000
007000         10  CR-STORE-NUMBER          PIC  X(04)    VALUE SPACE.  00700000
007100         10  CR-STORE-NUMBER-9 REDEFINES                          00710000
007200             CR-STORE-NUMBER          PIC  9(04).                 00720000
007300         10  CR-BEG-DATE              PIC  X(10)    VALUE SPACE.  00730000
007400         10  CR-END-DATE              PIC  X(10)    VALUE SPACE.  00740000
007500         10  CR-CARD-TYPE             PIC  X(01)    VALUE SPACE.  00750055
007600         10  CR-CARD-TYPE-9 REDEFINES CR-CARD-TYPE                00760055
007700                                      PIC  9(01).                 00770055
007800         10  CR-STOCK-ID              PIC  X(08)    VALUE SPACE.  00780000
007900         10  CR-ISSUE-ASSIGN          PIC  X(01)    VALUE SPACE.  00790000
008000             88  CR-IA-CDE-ASSIGN                   VALUE 'A'.    00800000
008100             88  CR-IA-CDE-ISSUE                    VALUE 'I'.    00810000
008200         10  CR-DENOMINATION          PIC  X(07)    VALUE SPACE.  00820000
008300         10  CR-DENOMINATION-9 REDEFINES                          00830000
008400             CR-DENOMINATION          PIC  9(05)V99.              00840000
008500         10  CR-PRINTER-ID            PIC  X(05)    VALUE SPACE.  00850000
008600         10  FILLER                   PIC  X(33)    VALUE SPACE.  00860000
008700                                                                  00870000
008800*----------------------------------------------------------------*00880000
008900*    PC-PROGRAM CONSTANTS                                        *00890000
009000*----------------------------------------------------------------*00900000
009100 01  PC-PROGRAM-CONSTANTS.                                        00910000
009200     05  PC-PROGRAM-NAME              PIC  X(08)     VALUE        00920000
009300                                                      'SVKRP008'. 00930000
009400     05  PC-ONE                       PIC  9(01)     VALUE 1.     00940000
009500     05  PC-CNT-6                     PIC S9(04)     VALUE +6     00950000
009600                                                     COMP SYNC.   00960000
009700     05  PC-CNT-7                     PIC S9(04)     VALUE +7     00970000
009800                                                     COMP SYNC.   00980000
009900     05  PC-QUOTE                     PIC  X(01)     VALUE QUOTE. 00990000
010000     05  PC-COMMA                     PIC  X(01)     VALUE ','.   01000009
010100     05  PC-LIT-ALL                   PIC  X(08)     VALUE        01010097
010200                                                     'ALL     '.  01020097
010300     05  PC-LIT-KMRC                  PIC  X(08)     VALUE        01030099
010400                                                     'KMRC    '.  01040099
010500     05  PC-LIT-ASSIGN                PIC  X(08)     VALUE        01050000
010600                                                     'ASSIGNED'.  01060000
010700     05  PC-LIT-ISSUE                 PIC  X(08)     VALUE        01070000
010800                                                     'ISSUED  '.  01080000
010900     05  PC-LIT-TOTAL                 PIC  X(08)     VALUE        01090014
011000                                                     'TOTAL:  '.  01100014
011100     05  PC-HEADER-LINE-COUNT         PIC S9(03)     VALUE +18    01110013
011200                                                     COMP.        01120000
011300     05  PC-MAX-LINES-PER-PAGE        PIC S9(03)     VALUE +59    01130013
011400                                                     COMP.        01140000
011500                                                                  01150000
011600*----------------------------------------------------------------*01160000
011700*       PROGRAM VARIABLES                                        *01170008
011800*----------------------------------------------------------------*01180000
011900 01  PV-PROGRAM-VARIABLES.                                        01190000
012000     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01200000
012100     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01210000
012200     05  PV-LINE-SPACING              PIC S9(04)     VALUE ZERO   01220003
012300                                                     COMP SYNC.   01230003
012400                                                                  01240000
012500     05  PV-CURRENT-DATE.                                         01250000
012600         10  PV-CURRENT-YEAR          PIC  9(04)     VALUE ZERO.  01260000
012700         10  PV-CURRENT-MONTH         PIC  9(02)     VALUE ZERO.  01270000
012800         10  PV-CURRENT-DAY           PIC  9(02)     VALUE ZERO.  01280000
012900     05  PV-CURRENT-TIME.                                         01290000
013000         10  PV-CURRENT-HOUR          PIC  9(02)     VALUE ZERO.  01300000
013100         10  PV-CURRENT-MINUTE        PIC  9(02)     VALUE ZERO.  01310000
013200         10  FILLER                   PIC  9(04)     VALUE ZERO.  01320000
013300     05  PV-HISTORY-DATE              PIC  X(10)     VALUE SPACES.01330099
013400     05  PV-BEG-THRU-END-DATE.                                    01340000
013500         10  PV-BEG-DATE-MM           PIC  X(02).                 01350000
013600         10  FILLER                   PIC  X(01)     VALUE '/'.   01360000
013700         10  PV-BEG-DATE-DD           PIC  X(02).                 01370000
013800         10  FILLER                   PIC  X(01)     VALUE '/'.   01380000
013900         10  PV-BEG-DATE-CCYY         PIC  X(04).                 01390000
014000         10  PV-THRU-END-DATE.                                    01400000
014100             15  FILLER               PIC  X(06)     VALUE        01410000
014200                 ' THRU '.                                        01420000
014300             15  PV-END-DATE-MM       PIC  X(02).                 01430000
014400             15  FILLER               PIC  X(01)     VALUE '/'.   01440000
014500             15  PV-END-DATE-DD       PIC  X(02).                 01450000
014600             15  FILLER               PIC  X(01)     VALUE '/'.   01460000
014700             15  PV-END-DATE-CCYY     PIC  X(04).                 01470000
014800     05  PV-CARD-DATE.                                            01480007
014900         10  PV-CARD-DATE-MM          PIC  X(02).                 01490007
015000         10  FILLER                   PIC  X(01)     VALUE '/'.   01500007
015100         10  PV-CARD-DATE-DD          PIC  X(02).                 01510007
015200         10  FILLER                   PIC  X(01)     VALUE '/'.   01520007
015300         10  PV-CARD-DATE-CCYY        PIC  X(04).                 01530007
015400     05  PV-HOLD-NEXT-CNTL-NBR        PIC  9(14)     VALUE ZERO.  01540056
015500     05  PV-HOLD-NEXT-CNTL-R REDEFINES PV-HOLD-NEXT-CNTL-NBR.     01550057
015600         10  PV-HOLD-NEXT-CRD-PROD-YR PIC  9(04).                 01560056
015700         10  PV-HOLD-NEXT-SHIPT-REQ   PIC  9(04).                 01570056
015800         10  PV-HOLD-NEXT-CNTL        PIC  9(06).                 01580056
015900     05  PV-HOLD-PREV-CNTL-NBR        PIC  9(14)     VALUE ZERO.  01590056
016000     05  PV-HOLD-PREV-CNTL-R REDEFINES PV-HOLD-PREV-CNTL-NBR.     01600057
016100         10  PV-HOLD-PREV-CRD-PROD-YR PIC  9(04).                 01610056
016200         10  PV-HOLD-PREV-SHIPT-REQ   PIC  9(04).                 01620056
016300         10  PV-HOLD-PREV-CNTL        PIC  9(06).                 01630056
016400     05  PV-HOLD-CRD-DTE              PIC  X(10)     VALUE SPACE. 01640000
016500     05  PV-HOLD-STR-NBR              PIC  9(04)     VALUE ZERO.  01650090
016600     05  PV-DNNTD-AMT-DSPLY           PIC  9(07).9(2)             01660000
016700                                                     VALUE ZERO.  01670000
016800     05  PV-CNTL-NBR-TO-FMT           PIC  X(14)     VALUE SPACES.01680091
016900     05  PV-CNTL-NBR-POST-033102 REDEFINES PV-CNTL-NBR-TO-FMT.    01690056
017000         10  FILLER                   PIC  X(02).                 01700056
017100         10  PV-CNTL-NBR-PRE-033102   PIC  X(12).                 01710056
017200     05  PV-CNTL-NBR-FMTD             PIC  X(14)     VALUE SPACES.01720056
017300                                                                  01730000
017400                                                                  01740000
017500*----------------------------------------------------------------*01750000
017600*    PS-PROGRAM SWITCHES                                         *01760000
017700*----------------------------------------------------------------*01770000
017800 01  PS-PROGRAM-SWITCHES.                                         01780000
017900     05  PS-END-OF-CONTROL-FILE-SW    PIC  X(01)     VALUE 'N'.   01790000
018000         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   01800000
018100     05  PS-END-OF-ORDER-CSR-SW       PIC  X(01)     VALUE 'N'.   01810000
018200         88  PS-END-OF-ORDER-CSR                     VALUE 'Y'.   01820000
018300         88  PS-NOT-END-OF-ORDER-CSR                 VALUE 'N'.   01830000
018400     05  PS-END-OF-RANGE-SW           PIC  X(01)     VALUE 'N'.   01840000
018500         88  PS-END-OF-RANGE                         VALUE 'Y'.   01850000
018600         88  PS-NOT-END-OF-RANGE                     VALUE 'N'.   01860000
018700     05  PS-RANGE-NOT-FOUND-SW        PIC  X(01)     VALUE 'N'.   01870000
018800         88  PS-RANGE-FOUND                          VALUE 'Y'.   01880000
018900         88  PS-RANGE-NOT-FOUND                      VALUE 'N'.   01890000
019000     05  PS-FORMAT-END-CNTL-NBR-SW    PIC  X(01)     VALUE 'N'.   01900000
019100         88  PS-FORMAT-END-CNTL-NBR                  VALUE 'Y'.   01910000
019200         88  PS-DONT-FORMAT-CNTL-NBR                 VALUE 'N'.   01920000
019300     05  PS-FIRST-CNTL-NBR-SW         PIC  X(01)     VALUE 'N'.   01930000
019400         88  PS-FIRST-CNTL-NBR                       VALUE 'Y'.   01940000
019500         88  PS-NOT-FIRST-CNTL-NBR                   VALUE 'N'.   01950000
019600     05  PS-FROM-HEADINGS-SW          PIC  X(01)     VALUE 'N'.   01960006
019700         88  PS-FROM-HEADINGS                        VALUE 'Y'.   01970006
019800         88  PS-NOT-FROM-HEADINGS                    VALUE 'N'.   01980006
019900     05  PS-TOTALS-NEEDED-SW          PIC  X(01)     VALUE 'N'.   01990014
020000         88  PS-ONE-TOTAL-NEEDED                     VALUE 'Y'.   02000014
020100         88  PS-TWO-TOTALS-NEEDED                    VALUE 'N'.   02010014
020200     05  PS-HISTORY-NEEDED-SW         PIC  X(01)     VALUE 'N'.   02020099
020300         88  PS-HISTORY-NEEDED                       VALUE 'Y'.   02030099
020400         88  PS-NO-HISTORY-NEEDED                    VALUE 'N'.   02040099
020500                                                                  02050000
020600*----------------------------------------------------------------*02060000
020700*    PA-PROGRAM ACCUMULATORS                                     *02070000
020800*----------------------------------------------------------------*02080000
020900 01  PA-PROGRAM-ACCUMULATORS.                                     02090000
021000     05  PA-CARD-RECS-READ            PIC S9(11)     COMP-3       02100000
021100                                                     VALUE ZEROES.02110000
021200     05  PA-LINE-COUNTER              PIC S9(11)     COMP-3       02120000
021300                                                     VALUE ZEROES.02130000
021400     05  PA-PAGE-COUNTER              PIC S9(11)     COMP-3       02140000
021500                                                     VALUE ZEROES.02150000
021600     05  PA-CARD-QUANTITY             PIC S9(11)     COMP-3       02160000
021700                                                     VALUE ZEROES.02170000
021800     05  PA-DTE-CARD-QUANTITY         PIC S9(11)     COMP-3       02180014
021900                                                     VALUE ZEROES.02190014
022000     05  PA-TTL-CARD-QUANTITY         PIC S9(11)     COMP-3       02200000
022100                                                     VALUE ZEROES.02210000
022200                                                                  02220000
022300*----------------------------------------------------------------*02230000
022400*    STANDARD HEADER FOR 075 COLUMN REPORT                       *02240000
022500*----------------------------------------------------------------*02250000
022600     COPY DPWS075.                                                02260000
022700                                                                  02270000
022800 01  REPORT-TITLE-LINE.                                           02280000
022900     05  FILLER                         PIC  X(26)   VALUE SPACE. 02290000
023000     05  FILLER                         PIC  X(24)   VALUE        02300000
023100         'STORED VALUE CARD ORDERS'.                              02310000
023200     05  FILLER                         PIC  X(25)   VALUE SPACE. 02320000
023300                                                                  02330000
023400 01  REPORT-CLAUSE-LINE-1.                                        02340000
023500     05  FILLER                         PIC  X(05)   VALUE SPACE. 02350000
023600     05  FILLER                         PIC  X(48)   VALUE        02360000
023700         'UPON RECEIPT, PLEASE VERIFY QUANTITY AND CONTROL'.      02370000
023800     05  FILLER                         PIC  X(14)   VALUE        02380000
023900         ' NUMBERS.  ANY'.                                        02390000
024000     05  FILLER                         PIC  X(09)   VALUE SPACE. 02400000
024100                                                                  02410000
024200 01  REPORT-CLAUSE-LINE-2.                                        02420000
024300     05  FILLER                         PIC  X(05)   VALUE SPACE. 02430000
024400     05  FILLER                         PIC  X(48)   VALUE        02440000
024500         'DISCREPANCIES IMMEDIATELY CALL 1-800-653-1774.  '.      02450023
024600     05  FILLER                         PIC  X(20)   VALUE        02460000
024700         ' PLEASE RETAIN      '.                                  02470000
024800     05  FILLER                         PIC  X(03)   VALUE SPACE. 02480000
024900                                                                  02490000
025000 01  REPORT-CLAUSE-LINE-3.                                        02500000
025100     05  FILLER                         PIC  X(05)   VALUE SPACE. 02510000
025200     05  FILLER                         PIC  X(21)   VALUE        02520000
025300         'THIS FORM FOR 1 YEAR.'.                                 02530000
025400     05  FILLER                         PIC  X(49)   VALUE SPACE. 02540000
025500                                                                  02550000
025600 01  REPORT-SUBTITLE-LINE-1.                                      02560000
025700     05  FILLER                         PIC  X(02)   VALUE SPACE. 02570000
025800     05  FILLER                         PIC  X(12)   VALUE        02580000
025900         '     DATE:  '.                                          02590000
026000     05  RSL1-DATE                      PIC  X(26)   VALUE SPACE. 02600000
026100     05  FILLER                         PIC  X(35)   VALUE SPACE. 02610000
026200                                                                  02620000
026300 01  REPORT-SUBTITLE-LINE-2.                                      02630000
026400     05  FILLER                         PIC  X(02)   VALUE SPACE. 02640000
026500     05  FILLER                         PIC  X(12)   VALUE        02650000
026600         'CARD TYPE:  '.                                          02660000
026700     05  RSL2-CARD-TYPE                 PIC  X(08)   VALUE SPACE. 02670000
026800     05  FILLER                         PIC  X(02)   VALUE SPACE. 02680000
026900     05  RSL2-ISSUED-ASSIGNED           PIC  X(08)   VALUE SPACE. 02690000
027000     05  FILLER                         PIC  X(43)   VALUE SPACE. 02700000
027100                                                                  02710000
027200*----------------------------------------------------------------*02720000
027300*    HEADERS                                                     *02730000
027400*----------------------------------------------------------------*02740000
027500 01  REPORT-HEADER-LINE-1.                                        02750000
027600     05  FILLER                         PIC  X(10)   VALUE SPACE. 02760099
027700     05  FILLER                         PIC  X(01)   VALUE SPACE. 02770099
027800     05  FILLER                         PIC  X(04)   VALUE        02780099
027900         ' STR'.                                                  02790099
028000     05  FILLER                         PIC  X(01)   VALUE SPACE. 02800099
028100     05  FILLER                         PIC  X(14)   VALUE        02810099
028200         '   STARTING   '.                                        02820099
028300     05  FILLER                         PIC  X(01)   VALUE SPACE. 02830099
028400     05  FILLER                         PIC  X(14)   VALUE        02840099
028500         '    ENDING    '.                                        02850099
028600     05  FILLER                         PIC  X(01)   VALUE SPACE. 02860099
028700     05  FILLER                         PIC  X(08)   VALUE SPACE. 02870099
028800     05  FILLER                         PIC  X(01)   VALUE SPACE. 02880099
028900     05  FILLER                         PIC  X(09)   VALUE        02890099
029000         '  DENOMI-'.                                             02900099
029100     05  FILLER                         PIC  X(01)   VALUE SPACE. 02910099
029200     05  FILLER                         PIC  X(08)   VALUE        02920099
029300         '  CARD  '.                                              02930099
029400                                                                  02940000
029500 01  REPORT-HEADER-LINE-2.                                        02950099
029600     05  FILLER                         PIC  X(10)   VALUE        02960099
029700         '   DATE   '.                                            02970099
029800     05  FILLER                         PIC  X(01)   VALUE SPACE. 02980099
029900     05  FILLER                         PIC  X(04)   VALUE        02990099
030000         ' NBR'.                                                  03000099
030100     05  FILLER                         PIC  X(01)   VALUE SPACE. 03010099
030200     05  FILLER                         PIC  X(14)   VALUE        03020099
030300         ' CONTROL NMBR '.                                        03030099
030400     05  FILLER                         PIC  X(01)   VALUE SPACE. 03040099
030500     05  FILLER                         PIC  X(14)   VALUE        03050099
030600         ' CONTROL NMBR '.                                        03060099
030700     05  FILLER                         PIC  X(01)   VALUE SPACE. 03070099
030800     05  FILLER                         PIC  X(08)   VALUE        03080099
030900         'QUANTITY'.                                              03090099
031000     05  FILLER                         PIC  X(01)   VALUE SPACE. 03100099
031100     05  FILLER                         PIC  X(09)   VALUE        03110099
031200         '  NATION '.                                             03120099
031300     05  FILLER                         PIC  X(01)   VALUE SPACE. 03130099
031400     05  FILLER                         PIC  X(08)   VALUE        03140099
031500         '  STOCK '.                                              03150099
031600                                                                  03160000
031700 01  REPORT-HEADER-LINE-3.                                        03170099
031800     05  FILLER                         PIC  X(10)   VALUE        03180099
031900         ALL '-'.                                                 03190099
032000     05  FILLER                         PIC  X(01)   VALUE SPACE. 03200099
032100     05  FILLER                         PIC  X(04)   VALUE        03210099
032200         ALL '-'.                                                 03220099
032300     05  FILLER                         PIC  X(01)   VALUE SPACE. 03230099
032400     05  FILLER                         PIC  X(14)   VALUE        03240099
032500         ALL '-'.                                                 03250099
032600     05  FILLER                         PIC  X(01)   VALUE SPACE. 03260099
032700     05  FILLER                         PIC  X(14)   VALUE        03270099
032800         ALL '-'.                                                 03280099
032900     05  FILLER                         PIC  X(01)   VALUE SPACE. 03290099
033000     05  FILLER                         PIC  X(08)   VALUE        03300099
033100         ALL '-'.                                                 03310099
033200     05  FILLER                         PIC  X(01)   VALUE SPACE. 03320099
033300     05  FILLER                         PIC  X(09)   VALUE        03330099
033400         ALL '-'.                                                 03340099
033500     05  FILLER                         PIC  X(01)   VALUE SPACE. 03350099
033600     05  FILLER                         PIC  X(08)   VALUE        03360099
033700         ALL '-'.                                                 03370099
033800                                                                  03380099
033900*----------------------------------------------------------------*03390000
034000*    DETAIL LINES                                                *03400000
034100*----------------------------------------------------------------*03410000
034200 01  REPORT-DETAIL-LINE-1.                                        03420000
034300     05  RDL1-DATE                      PIC  X(10)   VALUE SPACE. 03430000
034400     05  FILLER                         PIC  X(01)   VALUE SPACE. 03440099
034500     05  RDL1-STORE                     PIC  X(04)   VALUE SPACE. 03450000
034600     05  RDL1-STORE-9 REDEFINES                                   03460000
034700         RDL1-STORE                     PIC  ZZZ9.                03470099
034800     05  FILLER                         PIC  X(01)   VALUE SPACE. 03480099
034900     05  RDL1-CNTL-NBR-STRT             PIC  X(14)   VALUE SPACE. 03490056
035000     05  FILLER                         PIC  X(01)   VALUE SPACE. 03500099
035100     05  RDL1-CNTL-NBR-END              PIC  X(14)   VALUE SPACE. 03510056
035200     05  FILLER                         PIC  X(01)   VALUE SPACE. 03520099
035300     05  RDL1-QUANTITY                  PIC  Z(08)   VALUE ZERO.  03530000
035400     05  FILLER                         PIC  X(01)   VALUE SPACE. 03540099
035500     05  RDL1-DENOMINATION              PIC  X(09)   VALUE SPACE. 03550099
035600     05  RDL1-DENOMINATION-9 REDEFINES                            03560000
035700         RDL1-DENOMINATION              PIC $$$$$9.99.            03570099
035800     05  FILLER                         PIC  X(01)   VALUE SPACE. 03580099
035900     05  RDL1-STOCK-ID                  PIC  X(08)   VALUE SPACE. 03590099
036000                                                                  03600000
036100*----------------------------------------------------------------*03610000
036200*    TOTAL LINES                                                 *03620000
036300*----------------------------------------------------------------*03630000
036400 01  REPORT-TOTAL-DASH.                                           03640000
036500     05  FILLER                         PIC  X(46)   VALUE SPACE. 03650099
036600     05  FILLER                         PIC  X(08)   VALUE ALL    03660000
036700         '-'.                                                     03670000
036800     05  FILLER                         PIC  X(26)   VALUE SPACE. 03680099
036900                                                                  03690000
037000 01  REPORT-TOTAL-LINE-1.                                         03700000
037100     05  FILLER                         PIC  X(38)   VALUE SPACE. 03710099
037200     05  RTL1-TOTAL-TITLE               PIC  X(08)   VALUE SPACE. 03720014
037300     05  RTL1-QUANTITY                  PIC  Z(08)   VALUE ZERO.  03730000
037400     05  FILLER                         PIC  X(26)   VALUE SPACE. 03740099
037500                                                                  03750000
037600 01  REPORT-TOTAL-LINE-2.                                         03760000
037700     05  FILLER                         PIC  X(01)   VALUE SPACE. 03770000
037800     05  FILLER                         PIC  X(12)   VALUE        03780000
037900         'CHECKED BY: '.                                          03790000
038000     05  FILLER                         PIC  X(40)   VALUE        03800000
038100         '___________________________________'.                   03810000
038200     05  FILLER                         PIC  X(22)   VALUE SPACE. 03820000
038300                                                                  03830000
038400 01  REPORT-NO-DATA-LINE.                                         03840000
038500     05  FILLER                         PIC  X(47)   VALUE        03850000
038600         '     **  NO DATA FOUND FOR SELECTION CRITERIA '.        03860000
038700     05  FILLER                         PIC  X(27)   VALUE SPACE. 03870000
038800                                                                  03880000
038900*---------------------------------------------------------------* 03890000
039000*  WORKING STORAGE AREA USED TO BUILD SQL STATEMENTS            * 03900000
039100*---------------------------------------------------------------* 03910000
039200 01  PV-SQL-POINTERS.                                             03920000
039300     05  PV-SELECT-BYTES              PIC S9(04)     VALUE +138   03930099
039400                                                     COMP SYNC.   03940000
039500     05  PV-STRING-POINTER-FROM       PIC S9(04)     VALUE +0     03950000
039600                                                     COMP   SYNC. 03960000
039700     05  PV-STRING-POINTER-WHERE      PIC S9(04)     VALUE +0     03970000
039800                                                     COMP   SYNC. 03980000
039900     05  PV-STRING-POINTER-FROM2      PIC S9(04)     VALUE +0     03990031
040000                                                     COMP   SYNC. 04000031
040100     05  PV-STRING-POINTER-WHERE2     PIC S9(04)     VALUE +0     04010031
040200                                                     COMP   SYNC. 04020031
040300 01  PV-SQL-STMT.                                                 04030000
040400     49  PV-SQL-STMT-LEN              PIC S9(04)     VALUE 0      04040059
040500                                                     COMP.        04050000
040600*        SELECT 120 LENGTH PLUS                                   04060075
040700*        FROM   100 LENGTH PLUS  (MAX)                            04070000
040800*        WHERE 1100 LENGTH       (MAX)                            04080000
040900     49  PV-SQL-STMT-TEXT             PIC X(1400)    VALUE SPACE. 04090075
041000                                                                  04100030
041100 01  PV-QUAILIFIERS.                                              04110000
041200     05  PV-TABLE-QUALIFIER.                                      04120000
041300         10  FILLER                   PIC  X(03)     VALUE 'DB2'. 04130000
041400         10  PV-REGION-IND            PIC  X(01)     VALUE SPACE. 04140000
041500         10  FILLER                   PIC  X(04)     VALUE 'DBA.'.04150000
041600     05  PV-TABLE-QUALIFIER-COMMA.                                04160000
041700         10  FILLER                   PIC  X(04)     VALUE ',DB2'.04170000
041800         10  PV-REGION-IND-COMMA      PIC  X(01)     VALUE SPACE. 04180000
041900         10  FILLER                   PIC  X(04)     VALUE 'DBA.'.04190000
042000                                                                  04200000
042100 01  PV-SELECT-COLUMNS.                                           04210000
042200     05  PV-ISSUE-DATE                PIC  X(07)     VALUE        04220088
042300         'POS_DTE'.                                               04230088
042400     05  PV-ASSIGN-DATE               PIC  X(14)     VALUE        04240088
042500         'CRD_DISTRB_DTE'.                                        04250088
042600     05  PV-ISSUE-STORE               PIC  X(09)     VALUE        04260011
042700         'A.STR_NBR'.                                             04270011
042800     05  PV-ASSIGN-STORE              PIC  X(09)     VALUE        04280011
042900         'T.STR_NBR'.                                             04290011
043000     05  PV-ISSUE-STORE-H             PIC  X(09)     VALUE        04300088
043100         'Z.STR_NBR'.                                             04310088
043200     05  PV-ASSIGN-STORE-H            PIC  X(09)     VALUE        04320088
043300         'Y.STR_NBR'.                                             04330088
043400                                                                  04340000
043500 01  PV-BUILD-SELECT-REC.                                         04350000
043600     05  PV-BUILD-SELECT-STMT.                                    04360000
043700         10  FILLER                   PIC  X(07)     VALUE        04370080
043800             'SELECT '.                                           04380080
043900         10  PV-SELECT-DATE           PIC  X(14)     VALUE SPACE. 04390088
044000         10  FILLER                   PIC  X(02)     VALUE ' ,'.  04400058
044100         10  PV-SELECT-STORE          PIC  X(09)     VALUE SPACE. 04410011
044200         10  FILLER                   PIC  X(16)     VALUE        04420056
044300             ' ,T.CRD_PROD_YR '.                                  04430056
044400         10  FILLER                   PIC  X(18)     VALUE        04440056
044500             ' ,T.SHIPT_REQ_NBR '.                                04450056
044600         10  FILLER                   PIC  X(13)     VALUE        04460056
044700             ' ,T.CNTL_NBR '.                                     04470056
044800         10  FILLER                   PIC  X(21)     VALUE        04480000
044900             ',C.PRE_DNNTD_CRD_AMT '.                             04490064
045000         10  FILLER                   PIC  X(16)     VALUE        04500000
045100             ',C.CRD_REQD_DTE '.                                  04510000
045200         10  FILLER                   PIC  X(18)     VALUE        04520099
045300             ',C.CRD_STK_TYP_ID '.                                04530099
045400                                                                  04540000
045500     05  PV-BUILD-SELECT-STMT-H.                                  04550088
045600         10  FILLER                   PIC  X(07)     VALUE        04560088
045700             'SELECT '.                                           04570088
045800         10  PV-SELECT-DATE-H         PIC  X(14)     VALUE SPACE. 04580088
045900         10  FILLER                   PIC  X(02)     VALUE ' ,'.  04590088
046000         10  PV-SELECT-STORE-H        PIC  X(09)     VALUE SPACE. 04600088
046100         10  FILLER                   PIC  X(16)     VALUE        04610088
046200             ' ,Y.CRD_PROD_YR '.                                  04620088
046300         10  FILLER                   PIC  X(18)     VALUE        04630088
046400             ' ,Y.SHIPT_REQ_NBR '.                                04640088
046500         10  FILLER                   PIC  X(13)     VALUE        04650088
046600             ' ,Y.CNTL_NBR '.                                     04660088
046700         10  FILLER                   PIC  X(21)     VALUE        04670088
046800             ',C.PRE_DNNTD_CRD_AMT '.                             04680088
046900         10  FILLER                   PIC  X(16)     VALUE        04690088
047000             ',C.CRD_REQD_DTE '.                                  04700088
047100         10  FILLER                   PIC  X(18)     VALUE        04710099
047200             ',C.CRD_STK_TYP_ID '.                                04720099
047300                                                                  04730088
047400     05  PV-FROM-CLAUSE.                                          04740000
047500         10  FILLER                   PIC  X(100)    VALUE SPACE. 04750000
047600                                                                  04760000
047700     05  PV-WHERE-CLAUSE.                                         04770000
047800         10  FILLER                   PIC  X(1100)   VALUE SPACE. 04780064
047900                                                                  04790000
048000     05  PV-FROM-CLAUSE2.                                         04800029
048100         10  FILLER                   PIC  X(100)    VALUE SPACE. 04810029
048200                                                                  04820029
048300     05  PV-WHERE-CLAUSE2.                                        04830029
048400         10  FILLER                   PIC  X(1100)   VALUE SPACE. 04840064
048500*----------------------------------------------------------------*04850029
048600*    STORED VALUE CONSTANTS                                      *04860088
048700*----------------------------------------------------------------*04870000
048800     COPY SVWS004.                                                04880056
048900                                                                  04890000
049000*----------------------------------------------------------------*04900099
049100*    CALENDAR ROUTINE COPYBOOK                                   *04910099
049200*----------------------------------------------------------------*04920099
049300     COPY DPWS500.                                                04930099
049400                                                                  04940099
049500*----------------------------------------------------------------*04950000
049600*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *04960000
049700*----------------------------------------------------------------*04970000
049800     COPY DPWS004.                                                04980000
049900                                                                  04990000
050000*----------------------------------------------------------------*05000099
050100*    STORED VALUE CARD CONTROL TABLE                             *05010099
050200*----------------------------------------------------------------*05020099
050300     EXEC SQL                                                     05030099
050400         INCLUDE SVT00000                                         05040099
050500     END-EXEC.                                                    05050099
050600                                                                  05060099
050700*----------------------------------------------------------------*05070000
050800*    STORED VALUE CARD TABLE                                     *05080056
050900*----------------------------------------------------------------*05090000
051000     EXEC SQL                                                     05100000
051100         INCLUDE SVT00001                                         05110056
051200     END-EXEC.                                                    05120000
051300                                                                  05130000
051400*----------------------------------------------------------------*05140099
051500*    STORED VALUE CARD ACTIVITY TABLE                            *05150099
051600*----------------------------------------------------------------*05160099
051700     EXEC SQL                                                     05170099
051800         INCLUDE SVT00002                                         05180099
051900     END-EXEC.                                                    05190099
052000                                                                  05200099
052100*----------------------------------------------------------------*05210000
052200*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *05220000
052300*----------------------------------------------------------------*05230000
052400     EXEC SQL                                                     05240000
052500         INCLUDE SQLCA                                            05250000
052600     END-EXEC.                                                    05260000
052700                                                                  05270000
052800     COPY SQLCA2.                                                 05280000
052900                                                                  05290000
053000 PROCEDURE DIVISION.                                              05300000
053100                                                                  05310000
053200 0000-MAINLINE.                                                   05320000
053300                                                                  05330000
053400     PERFORM 1000-INITIALIZE.                                     05340000
053500                                                                  05350000
053600     IF PS-NOT-END-OF-ORDER-CSR                                   05360000
053700         PERFORM 2000-PROCESS-ORDERS                              05370001
053800             UNTIL PS-END-OF-ORDER-CSR                            05380000
053900         PERFORM 7000-PRINT-DETAIL                                05390000
054000         IF PS-TWO-TOTALS-NEEDED                                  05400018
054100             PERFORM 7100-PRINT-DATE-TOTALS                       05410018
054200         END-IF                                                   05420018
054300         PERFORM 7200-PRINT-TOTALS                                05430014
054400     END-IF.                                                      05440000
054500                                                                  05450000
054600     PERFORM 1900-EOJ-ROUTINE.                                    05460000
054700                                                                  05470000
054800     GOBACK.                                                      05480000
054900                                                                  05490000
055000*----------------------------------------------------------------*05500000
055100*     1000-INITIALIZE                                            *05510000
055200* ==> PROCESSES:                                                 *05520000
055300*     - READS SELECTION CRITERIAL FROM THE CONTROL CARD          *05530000
055400*     - ACCEPTS THE CURRENT DATE AND TIME FOR THE REPORT HEADING *05540000
055500*     - BUILD ORDER-CSR (CURSOR).                                *05550000
055600*     - READS FIRST KMRC, OR GIFT CARD CONTROL NUMBER.  IF ONE IS*05560000
055700*       NOT FOUND, END THE PROGRAM.                              *05570000
055800*----------------------------------------------------------------*05580000
055900 1000-INITIALIZE.                                                 05590000
056000                                                                  05600000
056100     OPEN INPUT CONTROL-CARD-FILE.                                05610000
056200     OPEN OUTPUT REPORT-FILE.                                     05620000
056300                                                                  05630000
056400     READ CONTROL-CARD-FILE INTO CR-CONTROL-RECORD                05640000
056500         AT END                                                   05650000
056600             SET PS-END-OF-CONTROL-FILE TO TRUE.                  05660000
056700                                                                  05670000
056800     IF PS-END-OF-CONTROL-FILE                                    05680000
056900         DISPLAY ' '                                              05690000
057000         DISPLAY '** ABEND     **'                                05700000
057100         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05710000
057200         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE      '       05720095
057300         DISPLAY '** CONTROL CARD FILE IS EMPTY  '                05730000
057400         DISPLAY ' '                                              05740000
057500         MOVE +4002 TO ABEND-CODE                                 05750000
057600         CALL 'ILBOABN0' USING ABEND-CODE                         05760000
057700     END-IF.                                                      05770094
057800                                                                  05780094
057900     DISPLAY PC-PROGRAM-NAME ' CONTROL CARD SELECTION VALUES'.    05790094
058000     DISPLAY 'REGION ID...: ' CR-REGION-IND.                      05800094
058100     DISPLAY 'STORE NUMBER: ' CR-STORE-NUMBER.                    05810094
058200     DISPLAY 'BEGIN DATE..: ' CR-BEG-DATE.                        05820094
058300     DISPLAY 'END DATE....: ' CR-END-DATE.                        05830094
058400     DISPLAY 'CARD TYPE...: ' CR-CARD-TYPE.                       05840094
058500     DISPLAY 'STOCK ID....: ' CR-STOCK-ID.                        05850094
058600     DISPLAY 'ISSUE-ASSIGN: ' CR-ISSUE-ASSIGN.                    05860094
058700     IF CR-DENOMINATION NOT NUMERIC                               05870094
058800         DISPLAY 'DENOMINATION: ' CR-DENOMINATION                 05880094
058900     ELSE                                                         05890094
059000         MOVE CR-DENOMINATION-9   TO PV-DNNTD-AMT-DSPLY           05900094
059100         DISPLAY 'DENOMINATION: ' PV-DNNTD-AMT-DSPLY              05910094
059200     END-IF.                                                      05920094
059300     DISPLAY 'PRINTER ID..: ' CR-PRINTER-ID.                      05930094
059400                                                                  05940000
059500     PERFORM 1100-VALIDATE-CONTROL-CARD.                          05950096
059600     IF CR-BEG-DATE = CR-END-DATE                                 05960000
059700         MOVE CR-BEG-DATE(1:4)     TO PV-BEG-DATE-CCYY            05970000
059800         MOVE CR-BEG-DATE(6:2)     TO PV-BEG-DATE-MM              05980000
059900         MOVE CR-BEG-DATE(9:2)     TO PV-BEG-DATE-DD              05990000
060000         MOVE SPACES               TO PV-THRU-END-DATE            06000000
060100         SET PS-ONE-TOTAL-NEEDED   TO TRUE                        06010014
060200     ELSE                                                         06020000
060300         MOVE CR-BEG-DATE(1:4)     TO PV-BEG-DATE-CCYY            06030000
060400         MOVE CR-BEG-DATE(6:2)     TO PV-BEG-DATE-MM              06040000
060500         MOVE CR-BEG-DATE(9:2)     TO PV-BEG-DATE-DD              06050000
060600         MOVE CR-END-DATE(1:4)     TO PV-END-DATE-CCYY            06060000
060700         MOVE CR-END-DATE(6:2)     TO PV-END-DATE-MM              06070000
060800         MOVE CR-END-DATE(9:2)     TO PV-END-DATE-DD              06080000
060900     END-IF.                                                      06090000
061000     MOVE PV-BEG-THRU-END-DATE     TO RSL1-DATE.                  06100000
061100                                                                  06110000
061200     MOVE FUNCTION CURRENT-DATE (1:8)                             06120000
061300                                   TO PV-CURRENT-DATE.            06130000
061400     MOVE PV-CURRENT-YEAR          TO DP075-RUN-YEAR.             06140000
061500     MOVE PV-CURRENT-MONTH         TO DP075-RUN-MONTH.            06150000
061600     MOVE PV-CURRENT-DAY           TO DP075-RUN-DAY.              06160000
061700                                                                  06170000
061800     ACCEPT PV-CURRENT-TIME      FROM TIME.                       06180000
061900     MOVE PV-CURRENT-HOUR          TO DP075-RUN-HOUR.             06190000
062000     MOVE PV-CURRENT-MINUTE        TO DP075-RUN-MINUTE.           06200000
062100     MOVE PC-PROGRAM-NAME          TO DP075-PROGRAM-NAME.         06210000
062200                                                                  06220000
062300     PERFORM 1200-GET-HISTORY-DATE.                               06230099
062400                                                                  06240099
062500     IF CR-END-DATE < PV-HISTORY-DATE                             06250099
062600         SET PS-HISTORY-NEEDED TO TRUE                            06260099
062700     ELSE                                                         06270099
062800         SET PS-NO-HISTORY-NEEDED TO TRUE                         06280099
062900     END-IF.                                                      06290099
063000                                                                  06300099
063100     MOVE CR-STOCK-ID              TO RSL2-CARD-TYPE.             06310000
063200     IF CR-IA-CDE-ASSIGN                                          06320000
063300         MOVE PC-LIT-ASSIGN        TO RSL2-ISSUED-ASSIGNED        06330000
063400     ELSE                                                         06340000
063500         MOVE PC-LIT-ISSUE         TO RSL2-ISSUED-ASSIGNED        06350000
063600     END-IF.                                                      06360000
063700                                                                  06370000
063800     MOVE CR-REGION-IND            TO PV-REGION-IND               06380000
063900                                      PV-REGION-IND-COMMA.        06390000
064000     MOVE SPACES                   TO PV-FROM-CLAUSE              06400000
064100                                      PV-WHERE-CLAUSE.            06410000
064200     MOVE +1                       TO PV-STRING-POINTER-FROM      06420000
064300                                      PV-STRING-POINTER-WHERE.    06430000
064400     MOVE SPACES                   TO PV-FROM-CLAUSE2             06440031
064500                                      PV-WHERE-CLAUSE2.           06450031
064600     MOVE +1                       TO PV-STRING-POINTER-FROM2     06460031
064700                                      PV-STRING-POINTER-WHERE2.   06470031
064800     IF CR-IA-CDE-ASSIGN                                          06480000
064900         PERFORM 1500-BUILD-ASSIGN-CURSOR                         06490000
065000     ELSE                                                         06500000
065100         PERFORM 1600-BUILD-ISSUE-CURSOR                          06510099
065200     END-IF.                                                      06520000
065300                                                                  06530000
065400*    STRING TOGETHER THE CODE TO BUILD THE DYNAMIC SQL CURSOR     06540000
065500     MOVE SPACES                   TO PV-SQL-STMT-TEXT.           06550000
065600     IF PS-HISTORY-NEEDED                                         06560099
065700         STRING PV-BUILD-SELECT-STMT      DELIMITED BY SIZE       06570099
065800            ' FROM '                  DELIMITED BY SIZE           06580000
065900            PV-FROM-CLAUSE            DELIMITED BY '        '     06590000
066000            ' WHERE '                 DELIMITED BY SIZE           06600000
066100            PV-WHERE-CLAUSE           DELIMITED BY '        '     06610000
066200            ' UNION ALL '             DELIMITED BY SIZE           06620029
066300            PV-BUILD-SELECT-STMT-H    DELIMITED BY SIZE           06630088
066400            ' FROM '                  DELIMITED BY SIZE           06640029
066500            PV-FROM-CLAUSE2           DELIMITED BY '        '     06650029
066600            ' WHERE '                 DELIMITED BY SIZE           06660029
066700            PV-WHERE-CLAUSE2          DELIMITED BY '        '     06670029
066800         INTO PV-SQL-STMT-TEXT                                    06680099
066900     ELSE                                                         06690099
067000         STRING PV-BUILD-SELECT-STMT      DELIMITED BY SIZE       06700099
067100            ' FROM '                  DELIMITED BY SIZE           06710099
067200            PV-FROM-CLAUSE            DELIMITED BY '        '     06720099
067300            ' WHERE '                 DELIMITED BY SIZE           06730099
067400            PV-WHERE-CLAUSE           DELIMITED BY '        '     06740099
067500         INTO PV-SQL-STMT-TEXT                                    06750099
067600     END-IF.                                                      06760099
067700                                                                  06770035
067800     DISPLAY 'PV-SQL-STMT-TEXT IS '.                              06780081
067900     DISPLAY PV-SQL-STMT-TEXT.                                    06790081
068000                                                                  06800081
068100     IF PS-HISTORY-NEEDED                                         06810099
068200         ADD PV-SELECT-BYTES                                      06820099
068300             PC-CNT-6                                             06830099
068400             PV-STRING-POINTER-FROM                               06840099
068500             PC-CNT-7                                             06850099
068600             PV-STRING-POINTER-WHERE                              06860099
068700             PV-SELECT-BYTES                                      06870099
068800             PC-CNT-6                                             06880099
068900             PV-STRING-POINTER-FROM2                              06890099
069000             PC-CNT-7                                             06900099
069100             PV-STRING-POINTER-WHERE2                             06910099
069200         GIVING                                                   06920099
069300             PV-SQL-STMT-LEN                                      06930099
069400     ELSE                                                         06940099
069500         ADD PV-SELECT-BYTES                                      06950099
069600             PC-CNT-6                                             06960099
069700             PV-STRING-POINTER-FROM                               06970099
069800             PC-CNT-7                                             06980099
069900             PV-STRING-POINTER-WHERE                              06990099
070000         GIVING                                                   07000099
070100             PV-SQL-STMT-LEN                                      07010099
070200     END-IF.                                                      07020099
070300                                                                  07030000
070400     EXEC SQL                                                     07040000
070500         PREPARE ORDER-SELECT FROM :PV-SQL-STMT                   07050000
070600     END-EXEC.                                                    07060000
070700                                                                  07070000
070800     EVALUATE TRUE                                                07080000
070900         WHEN SQLCODE = ZERO                                      07090000
071000             CONTINUE                                             07100000
071100         WHEN OTHER                                               07110000
071200             DISPLAY 'SQL = ' SQLCODE                             07120037
071300             MOVE '1000-INITIALIZE '                              07130000
071400                                   TO PV-PARAGRAPH-NAME           07140000
071500             MOVE 'PREPARE ORDER-CSR SELECT STMT  '               07150000
071600                                   TO PV-DB2-OPERATION-ATTEMPTED  07160000
071700             PERFORM 9999-SQL-ABEND                               07170000
071800     END-EVALUATE.                                                07180000
071900                                                                  07190000
072000     EXEC SQL                                                     07200000
072100         DECLARE ORDER-CSR CURSOR FOR                             07210000
072200                 ORDER-SELECT                                     07220000
072300     END-EXEC.                                                    07230000
072400                                                                  07240000
072500     EXEC SQL                                                     07250000
072600         OPEN ORDER-CSR                                           07260000
072700     END-EXEC.                                                    07270000
072800                                                                  07280000
072900     EVALUATE TRUE                                                07290000
073000         WHEN SQLCODE = ZERO                                      07300000
073100             CONTINUE                                             07310000
073200         WHEN OTHER                                               07320000
073300             DISPLAY ' '                                          07330000
073400             MOVE '1000-INITIALIZE'                               07340000
073500                                   TO PV-PARAGRAPH-NAME           07350000
073600             MOVE 'OPEN ORDER CURSOR           '                  07360000
073700                                   TO PV-DB2-OPERATION-ATTEMPTED  07370000
073800             PERFORM 9999-SQL-ABEND                               07380000
073900     END-EVALUATE.                                                07390000
074000                                                                  07400000
074100     SET PS-FIRST-CNTL-NBR TO TRUE.                               07410000
074200     PERFORM 2100-FETCH-ORDER-CURSOR.                             07420000
074300                                                                  07430000
074400     PERFORM 8000-PROCESS-PAGE-HEADINGS.                          07440000
074500                                                                  07450000
074600     IF PS-END-OF-ORDER-CSR                                       07460000
074700         DISPLAY ' '                                              07470000
074800         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            07480000
074900         DISPLAY '** FIRST FETCH FOUND NO KMRC OR GIFT CARDS'     07490000
075000         DISPLAY ' '                                              07500000
075100         WRITE REPORT-RECORD                                      07510000
075200               FROM REPORT-NO-DATA-LINE                           07520000
075300               AFTER ADVANCING 3 LINE                             07530000
075400     ELSE                                                         07540000
075500         MOVE SVT00001-CRD-DISTRB-DTE                             07550056
075600                                   TO PV-HOLD-CRD-DTE             07560000
075700         MOVE PV-HOLD-CRD-DTE(1:4) TO PV-CARD-DATE-CCYY           07570007
075800         MOVE PV-HOLD-CRD-DTE(6:2) TO PV-CARD-DATE-MM             07580007
075900         MOVE PV-HOLD-CRD-DTE(9:2) TO PV-CARD-DATE-DD             07590007
076000         MOVE PV-CARD-DATE         TO RDL1-DATE                   07600007
076100         MOVE SVT00001-STR-NBR     TO PV-HOLD-STR-NBR             07610056
076200                                      RDL1-STORE-9                07620000
076300         IF CR-CARD-TYPE-9 = SV004-KMRC-CRD-TYP                   07630056
076400             MOVE SPACE            TO RDL1-DENOMINATION           07640021
076500         ELSE                                                     07650021
076600             MOVE SVT00000-PRE-DNNTD-CRD-AMT                      07660064
076700                                   TO RDL1-DENOMINATION-9         07670021
076800         END-IF                                                   07680021
076900     END-IF.                                                      07690000
077000                                                                  07700000
077100*----------------------------------------------------------------*07710096
077200*     1100-VALIDATE-CONTROL-CARD                                 *07720096
077300* ==> PROCESSES:                                                 *07730096
077400*     - VERIFY THAT ALL FIELDS ON THE CONTROL CARD THAT SHOULD   *07740096
077500*       BE NUMERIC CONTAIN NUMERIC VALUES OR ALL.                *07750096
077600*----------------------------------------------------------------*07760096
077700 1100-VALIDATE-CONTROL-CARD.                                      07770096
077800                                                                  07780096
077900     EVALUATE TRUE                                                07790096
078000         WHEN CR-STORE-NUMBER = PC-LIT-ALL                        07800096
078100         WHEN CR-STORE-NUMBER NUMERIC                             07810096
078200             CONTINUE                                             07820096
078300         WHEN OTHER                                               07830096
078400             DISPLAY ' '                                          07840096
078500             DISPLAY '** ABEND     **'                            07850096
078600             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        07860096
078700             DISPLAY                                              07870096
078800             '** PARAGRAPH **  = 1100-VALIDATE-CONTROL-CARD'      07880096
078900             DISPLAY '** INVALID STORE NUMBER ON CONTROL CARD'    07890096
079000             DISPLAY ' '                                          07900096
079100             MOVE +4002 TO ABEND-CODE                             07910096
079200             CALL 'ILBOABN0' USING ABEND-CODE                     07920096
079300     END-EVALUATE.                                                07930096
079400                                                                  07940096
079500     EVALUATE TRUE                                                07950096
079600         WHEN CR-DENOMINATION = PC-LIT-ALL                        07960096
079700         WHEN CR-DENOMINATION NUMERIC                             07970096
079800             CONTINUE                                             07980096
079900         WHEN OTHER                                               07990096
080000             DISPLAY ' '                                          08000096
080100             DISPLAY '** ABEND     **'                            08010096
080200             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        08020096
080300             DISPLAY                                              08030096
080400             '** PARAGRAPH **  = 1100-VALIDATE-CONTROL-CARD'      08040096
080500             DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE      '   08050096
080600             DISPLAY '** INVALID DENOMINATION ON CONTROL CARD'    08060096
080700             DISPLAY ' '                                          08070096
080800             MOVE +4002 TO ABEND-CODE                             08080096
080900             CALL 'ILBOABN0' USING ABEND-CODE                     08090096
081000     END-EVALUATE.                                                08100096
081100                                                                  08110096
081200     IF CR-CARD-TYPE NOT NUMERIC                                  08120096
081300         DISPLAY ' '                                              08130096
081400         DISPLAY '** ABEND     **'                                08140096
081500         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            08150096
081600         DISPLAY '** PARAGRAPH **  = 1100-VALIDATE-CONTROL-CARD'  08160096
081700         DISPLAY '** INVALID CARD TYPE ON CONTROL CARD'           08170096
081800         DISPLAY ' '                                              08180096
081900         MOVE +4002 TO ABEND-CODE                                 08190096
082000         CALL 'ILBOABN0' USING ABEND-CODE                         08200096
082100     END-IF.                                                      08210096
082200                                                                  08220096
082300*----------------------------------------------------------------*08230099
082400*     1200-GET-HISTORY-DATE                                      *08240099
082500* ==> PROCESSES:                                                 *08250099
082600*     - USE CALENDAR ROUTINE TO GET DATE 60 DAYS AGO.            *08260099
082700*----------------------------------------------------------------*08270099
082800 1200-GET-HISTORY-DATE.                                           08280099
082900                                                                  08290099
083000     INITIALIZE DPG51 DPG52 DPG53                                 08300099
083100                DPG54 DPG55 DPG56.                                08310099
083200                                                                  08320099
083300     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      08330099
083400     SET DPG51-DECREMENT-DATE       TO TRUE.                      08340099
083500     MOVE 60                        TO DPG51-INCR-DECR-DAYS-9.    08350099
083600     MOVE PV-CURRENT-DATE           TO DPG52-LK-DATE-INPUT.       08360099
083700     SET DPG52-LK-DTE-ISO           TO TRUE                       08370099
083800                                                                  08380099
083900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    08390099
084000                                             DPG54 DPG55 DPG56.   08400099
084100                                                                  08410099
084200     EVALUATE TRUE                                                08420099
084300       WHEN DPG54-SEVERE-ERROR                                    08430099
084400       WHEN DPG54-WARNING-ERROR                                   08440099
084500            MOVE '1200-GET-HISTORY-DATE' TO PV-PARAGRAPH-NAME     08450099
084600            PERFORM 9900-DATE-ABEND                               08460099
084700     END-EVALUATE.                                                08470099
084800                                                                  08480099
084900     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-HISTORY-DATE.              08490099
085000                                                                  08500099
085100*----------------------------------------------------------------*08510096
085200*     1500-BUILD-ASSIGN-CURSOR                                   *08520000
085300* ==> PROCESSES:                                                 *08530000
085400*     - BUILD THE DYNAMIC CURSOR TO RETRIEVE ASSIGNED CARD INFO  *08540000
085500*----------------------------------------------------------------*08550000
085600 1500-BUILD-ASSIGN-CURSOR.                                        08560029
085700                                                                  08570029
085800*                      ORIGINAL CODE                              08580029
085900     MOVE PV-ASSIGN-DATE           TO PV-SELECT-DATE              08590088
086000                                      PV-SELECT-DATE-H.           08600088
086100     MOVE PV-ASSIGN-STORE          TO PV-SELECT-STORE.            08610029
086200     MOVE PV-ASSIGN-STORE-H        TO PV-SELECT-STORE-H.          08620088
086300                                                                  08630029
086400*    FROM CLAUSE                                                  08640029
086500     STRING PV-TABLE-QUALIFIER        DELIMITED BY SIZE           08650029
086600            'SVT_CRD_PROD C'          DELIMITED BY SIZE           08660056
086700            PV-TABLE-QUALIFIER-COMMA  DELIMITED BY SIZE           08670029
086800            'SVT_KOHLS_CRD_ACCT T'    DELIMITED BY SIZE           08680056
086900       INTO PV-FROM-CLAUSE                                        08690029
087000       WITH POINTER PV-STRING-POINTER-FROM.                       08700029
087100                                                                  08710029
087200*    CONTROL NUMBER                                               08720029
087300     STRING ' T.CRD_PROD_YR = C.CRD_PROD_YR ' DELIMITED BY SIZE   08730056
087400            'AND T.SHIPT_REQ_NBR = '          DELIMITED BY SIZE   08740056
087500            'C.SHIPT_REQ_NBR '                DELIMITED BY SIZE   08750056
087600       INTO PV-WHERE-CLAUSE                                       08760029
087700       WITH POINTER PV-STRING-POINTER-WHERE.                      08770029
087800                                                                  08780029
087900*    STORE NUMBER                                                 08790029
088000     IF CR-STORE-NUMBER = PC-LIT-ALL                              08800029
088100         CONTINUE                                                 08810029
088200     ELSE                                                         08820029
088300         STRING ' AND T.STR_NBR = '   DELIMITED BY SIZE           08830029
088400                CR-STORE-NUMBER       DELIMITED BY SIZE           08840029
088500           INTO PV-WHERE-CLAUSE                                   08850029
088600           WITH POINTER PV-STRING-POINTER-WHERE                   08860029
088700     END-IF.                                                      08870029
088800                                                                  08880029
088900*    BEGIN & END DATE                                             08890029
089000     IF CR-BEG-DATE = CR-END-DATE                                 08900029
089100         STRING ' AND T.CRD_DISTRB_DTE = '                        08910029
089200                                      DELIMITED BY SIZE           08920029
089300                PC-QUOTE              DELIMITED BY SIZE           08930029
089400                CR-BEG-DATE           DELIMITED BY SIZE           08940029
089500                PC-QUOTE              DELIMITED BY SIZE           08950029
089600           INTO PV-WHERE-CLAUSE                                   08960029
089700           WITH POINTER PV-STRING-POINTER-WHERE                   08970029
089800     ELSE                                                         08980029
089900         STRING ' AND T.CRD_DISTRB_DTE BETWEEN '                  08990029
090000                                      DELIMITED BY SIZE           09000029
090100                PC-QUOTE              DELIMITED BY SIZE           09010029
090200                CR-BEG-DATE           DELIMITED BY SIZE           09020029
090300                PC-QUOTE              DELIMITED BY SIZE           09030029
090400                ' AND '               DELIMITED BY SIZE           09040029
090500                PC-QUOTE              DELIMITED BY SIZE           09050029
090600                CR-END-DATE           DELIMITED BY SIZE           09060029
090700                PC-QUOTE              DELIMITED BY SIZE           09070029
090800           INTO PV-WHERE-CLAUSE                                   09080029
090900           WITH POINTER PV-STRING-POINTER-WHERE                   09090029
091000     END-IF.                                                      09100029
091100                                                                  09110029
091200*    CARD TYPE                                                    09120029
091300     STRING ' AND C.CRD_TYP_CDE = '   DELIMITED BY SIZE           09130089
091400            CR-CARD-TYPE-9            DELIMITED BY SIZE           09140056
091500       INTO PV-WHERE-CLAUSE                                       09150029
091600       WITH POINTER PV-STRING-POINTER-WHERE.                      09160029
091700                                                                  09170029
091800*    CARD STOCK ID                                                09180029
091900     IF CR-STOCK-ID = PC-LIT-ALL OR PC-LIT-KMRC                   09190099
092000         CONTINUE                                                 09200098
092100     ELSE                                                         09210098
092200         STRING ' AND C.CRD_STK_TYP_ID = '                        09220098
092300                                          DELIMITED BY SIZE       09230098
092400                PC-QUOTE                  DELIMITED BY SIZE       09240098
092500                CR-STOCK-ID               DELIMITED BY SIZE       09250098
092600                PC-QUOTE                  DELIMITED BY SIZE       09260098
092700           INTO PV-WHERE-CLAUSE                                   09270098
092800           WITH POINTER PV-STRING-POINTER-WHERE                   09280098
092900     END-IF                                                       09290098
093000                                                                  09300029
093100*    DENOMINATION AMOUNT                                          09310029
093200     IF CR-DENOMINATION = PC-LIT-ALL                              09320029
093300         CONTINUE                                                 09330029
093400     ELSE                                                         09340029
093500         MOVE CR-DENOMINATION-9    TO  PV-DNNTD-AMT-DSPLY         09350029
093600         STRING ' AND C.PRE_DNNTD_CRD_AMT = '                     09360029
093700                                      DELIMITED BY SIZE           09370029
093800                PV-DNNTD-AMT-DSPLY    DELIMITED BY SIZE           09380029
093900           INTO PV-WHERE-CLAUSE                                   09390029
094000           WITH POINTER PV-STRING-POINTER-WHERE                   09400029
094100     END-IF.                                                      09410029
094200                                                                  09420099
094300*    ORDER BY                                                     09430033
094400*         CRD_DISTRB_DTE                                          09440084
094500*         STR_NBR                                                 09450084
094600*         CRD_PROD_YR                                             09460084
094700*         SHIPT_REQ_NBR                                           09470084
094800*         CNTL_NBR                                                09480084
094900                                                                  09490033
095000     IF PS-HISTORY-NEEDED                                         09500099
095100         PERFORM 1510-SELECT-HISTORY                              09510099
095200     ELSE                                                         09520099
095300         STRING ' ORDER BY 1, 2, 3, 4, 5 ' DELIMITED BY SIZE      09530099
095400           INTO PV-WHERE-CLAUSE                                   09540099
095500           WITH POINTER PV-STRING-POINTER-WHERE                   09550099
095600     END-IF.                                                      09560099
095700                                                                  09570033
095800*----------------------------------------------------------------*09580099
095900*     1510-SELECT-HISTORY                                        *09590099
096000* ==> PROCESSES:                                                 *09600099
096100*     - BUILD THE DYNAMIC CURSOR TO RETRIEVE ASSIGNED CARD INFO  *09610099
096200*       FOR ROWS ON THE HISTORY TABLE.                           *09620099
096300*----------------------------------------------------------------*09630099
096400 1510-SELECT-HISTORY.                                             09640099
096500                                                                  09650099
096600*    UNION ALL CLAUSE                                             09660099
096700                                                                  09670099
096800*    SELECT CLAUSE                                                09680099
096900                                                                  09690099
097000*    FROM CLAUSE                                                  09700099
097100     STRING PV-TABLE-QUALIFIER        DELIMITED BY SIZE           09710099
097200            'SVT_CRD_PROD C'          DELIMITED BY SIZE           09720099
097300            PV-TABLE-QUALIFIER-COMMA  DELIMITED BY SIZE           09730099
097400            'SVT_CRD_ACCT_HIST Y'     DELIMITED BY SIZE           09740099
097500       INTO PV-FROM-CLAUSE2                                       09750099
097600       WITH POINTER PV-STRING-POINTER-FROM2.                      09760099
097700                                                                  09770099
097800                                                                  09780099
097900*    CONTROL NUMBER                                               09790099
098000     STRING ' Y.CRD_PROD_YR = C.CRD_PROD_YR ' DELIMITED BY SIZE   09800099
098100            'AND Y.SHIPT_REQ_NBR = '          DELIMITED BY SIZE   09810099
098200            'C.SHIPT_REQ_NBR '                DELIMITED BY SIZE   09820099
098300       INTO PV-WHERE-CLAUSE2                                      09830099
098400       WITH POINTER PV-STRING-POINTER-WHERE2.                     09840099
098500                                                                  09850099
098600*    STORE NUMBER                                                 09860099
098700     IF CR-STORE-NUMBER = PC-LIT-ALL                              09870099
098800         CONTINUE                                                 09880099
098900     ELSE                                                         09890099
099000         STRING ' AND Y.STR_NBR = '   DELIMITED BY SIZE           09900099
099100                CR-STORE-NUMBER       DELIMITED BY SIZE           09910099
099200           INTO PV-WHERE-CLAUSE2                                  09920099
099300           WITH POINTER PV-STRING-POINTER-WHERE2                  09930099
099400     END-IF.                                                      09940099
099500                                                                  09950099
099600*    BEGIN & END DATE                                             09960099
099700     IF CR-BEG-DATE = CR-END-DATE                                 09970099
099800         STRING ' AND Y.CRD_DISTRB_DTE = '                        09980099
099900                                      DELIMITED BY SIZE           09990099
100000                PC-QUOTE              DELIMITED BY SIZE           10000099
100100                CR-BEG-DATE           DELIMITED BY SIZE           10010099
100200                PC-QUOTE              DELIMITED BY SIZE           10020099
100300           INTO PV-WHERE-CLAUSE2                                  10030099
100400           WITH POINTER PV-STRING-POINTER-WHERE2                  10040099
100500     ELSE                                                         10050099
100600         STRING ' AND Y.CRD_DISTRB_DTE BETWEEN '                  10060099
100700                                      DELIMITED BY SIZE           10070099
100800                PC-QUOTE              DELIMITED BY SIZE           10080099
100900                CR-BEG-DATE           DELIMITED BY SIZE           10090099
101000                PC-QUOTE              DELIMITED BY SIZE           10100099
101100                ' AND '               DELIMITED BY SIZE           10110099
101200                PC-QUOTE              DELIMITED BY SIZE           10120099
101300                CR-END-DATE           DELIMITED BY SIZE           10130099
101400                PC-QUOTE              DELIMITED BY SIZE           10140099
101500           INTO PV-WHERE-CLAUSE2                                  10150099
101600           WITH POINTER PV-STRING-POINTER-WHERE2                  10160099
101700     END-IF.                                                      10170099
101800                                                                  10180099
101900*    CARD TYPE                                                    10190099
102000     STRING ' AND C.CRD_TYP_CDE = '   DELIMITED BY SIZE           10200099
102100            CR-CARD-TYPE-9            DELIMITED BY SIZE           10210099
102200       INTO PV-WHERE-CLAUSE2                                      10220099
102300       WITH POINTER PV-STRING-POINTER-WHERE2.                     10230099
102400                                                                  10240099
102500*    CARD STOCK ID                                                10250099
102600     IF CR-STOCK-ID   = PC-LIT-ALL OR PC-LIT-KMRC                 10260099
102700         CONTINUE                                                 10270099
102800     ELSE                                                         10280099
102900         STRING ' AND C.CRD_STK_TYP_ID = '                        10290099
103000                                          DELIMITED BY SIZE       10300099
103100                PC-QUOTE                  DELIMITED BY SIZE       10310099
103200                CR-STOCK-ID               DELIMITED BY SIZE       10320099
103300                PC-QUOTE                  DELIMITED BY SIZE       10330099
103400           INTO PV-WHERE-CLAUSE2                                  10340099
103500           WITH POINTER PV-STRING-POINTER-WHERE2                  10350099
103600     END-IF.                                                      10360099
103700                                                                  10370099
103800*    DENOMINATION AMOUNT                                          10380099
103900     IF CR-DENOMINATION = PC-LIT-ALL                              10390099
104000         CONTINUE                                                 10400099
104100     ELSE                                                         10410099
104200         MOVE CR-DENOMINATION-9    TO  PV-DNNTD-AMT-DSPLY         10420099
104300         STRING ' AND C.PRE_DNNTD_CRD_AMT = '                     10430099
104400                                      DELIMITED BY SIZE           10440099
104500                PV-DNNTD-AMT-DSPLY    DELIMITED BY SIZE           10450099
104600           INTO PV-WHERE-CLAUSE2                                  10460099
104700           WITH POINTER PV-STRING-POINTER-WHERE2                  10470099
104800     END-IF.                                                      10480099
104900                                                                  10490099
105000*    ORDER BY                                                     10500099
105100*         CRD_DISTRB_DTE                                          10510099
105200*         STR_NBR                                                 10520099
105300*         CRD_PROD_YR                                             10530099
105400*         SHIPT_REQ_NBR                                           10540099
105500*         CNTL_NBR                                                10550099
105600                                                                  10560099
105700     STRING ' ORDER BY 1, 2, 3, 4, 5 ' DELIMITED BY SIZE          10570099
105800       INTO PV-WHERE-CLAUSE2                                      10580099
105900       WITH POINTER PV-STRING-POINTER-WHERE2.                     10590099
106000                                                                  10600099
106100*----------------------------------------------------------------*10610000
106200*     1600-BUILD-ISSUE-CURSOR                                    *10620099
106300* ==> PROCESSES:                                                 *10630000
106400*     - BUILD THE DYNAMIC CURSOR TO RETRIEVE ISSUED CARD INFO    *10640000
106500*----------------------------------------------------------------*10650000
106600 1600-BUILD-ISSUE-CURSOR.                                         10660099
106700                                                                  10670034
106800     MOVE PV-ISSUE-DATE            TO PV-SELECT-DATE              10680088
106900                                      PV-SELECT-DATE-H.           10690088
107000     MOVE PV-ISSUE-STORE           TO PV-SELECT-STORE.            10700034
107100     MOVE PV-ISSUE-STORE-H         TO PV-SELECT-STORE-H.          10710088
107200                                                                  10720034
107300*    FROM CLAUSE                                                  10730034
107400     STRING PV-TABLE-QUALIFIER        DELIMITED BY SIZE           10740034
107500            'SVT_CRD_PROD C'          DELIMITED BY SIZE           10750056
107600            PV-TABLE-QUALIFIER-COMMA  DELIMITED BY SIZE           10760034
107700            'SVT_KOHLS_CRD_ACCT T'    DELIMITED BY SIZE           10770056
107800            PV-TABLE-QUALIFIER-COMMA  DELIMITED BY SIZE           10780034
107900            'SVT_KOHLS_CRD_TXN A'     DELIMITED BY SIZE           10790056
108000       INTO PV-FROM-CLAUSE                                        10800034
108100       WITH POINTER PV-STRING-POINTER-FROM.                       10810034
108200                                                                  10820034
108300                                                                  10830034
108400*    CARD NUMBER / CONTROL NUMBER JOIN                            10840089
108500     STRING ' A.CRD_NBR = T.CRD_NBR ' DELIMITED BY SIZE           10850034
108600            ' AND T.CRD_PROD_YR =  ' DELIMITED BY SIZE            10860089
108700            ' C.CRD_PROD_YR '        DELIMITED BY SIZE            10870089
108800            'AND T.SHIPT_REQ_NBR = ' DELIMITED BY SIZE            10880089
108900            'C.SHIPT_REQ_NBR '       DELIMITED BY SIZE            10890089
109000       INTO PV-WHERE-CLAUSE                                       10900034
109100       WITH POINTER PV-STRING-POINTER-WHERE.                      10910034
109200                                                                  10920034
109300*    VOID INDICATOR / ACTIVITY TYPE                               10930089
109400     STRING ' AND A.TRN_VOID_IND = '  DELIMITED BY SIZE           10940089
109500            PC-QUOTE                  DELIMITED BY SIZE           10950089
109600            SV004-NOT-VOID-TRANS      DELIMITED BY SIZE           10960089
109700            PC-QUOTE                  DELIMITED BY SIZE           10970089
109800            ' AND A.ACTVY_TYP_CDE '   DELIMITED BY SIZE           10980089
109900            'IN ('                    DELIMITED BY SIZE           10990089
110000            SV004-ISSUE-KMRC-ACT-TYP DELIMITED BY SIZE            11000089
110100            PC-COMMA                  DELIMITED BY SIZE           11010089
110200            SV004-ISSUE-GIFT-CRD-ACT-TYP DELIMITED BY SIZE        11020089
110300            ')'                       DELIMITED BY SIZE           11030089
110400       INTO PV-WHERE-CLAUSE                                       11040034
110500       WITH POINTER PV-STRING-POINTER-WHERE.                      11050034
110600                                                                  11060034
110700*    STORE NUMBER                                                 11070034
110800     IF CR-STORE-NUMBER = PC-LIT-ALL                              11080034
110900         CONTINUE                                                 11090034
111000     ELSE                                                         11100034
111100         STRING ' AND A.STR_NBR = '   DELIMITED BY SIZE           11110034
111200                CR-STORE-NUMBER-9     DELIMITED BY SIZE           11120034
111300           INTO PV-WHERE-CLAUSE                                   11130034
111400           WITH POINTER PV-STRING-POINTER-WHERE                   11140034
111500     END-IF.                                                      11150034
111600                                                                  11160034
111700*    BEGIN & END DATE                                             11170034
111800     IF CR-BEG-DATE = CR-END-DATE                                 11180034
111900         STRING ' AND A.POS_DTE = '   DELIMITED BY SIZE           11190034
112000                PC-QUOTE              DELIMITED BY SIZE           11200034
112100                CR-BEG-DATE           DELIMITED BY SIZE           11210034
112200                PC-QUOTE              DELIMITED BY SIZE           11220034
112300           INTO PV-WHERE-CLAUSE                                   11230034
112400           WITH POINTER PV-STRING-POINTER-WHERE                   11240034
112500     ELSE                                                         11250034
112600         STRING ' AND A.POS_DTE BETWEEN '                         11260034
112700                                      DELIMITED BY SIZE           11270034
112800                PC-QUOTE              DELIMITED BY SIZE           11280034
112900                CR-BEG-DATE           DELIMITED BY SIZE           11290034
113000                PC-QUOTE              DELIMITED BY SIZE           11300034
113100                ' AND '               DELIMITED BY SIZE           11310034
113200                PC-QUOTE              DELIMITED BY SIZE           11320034
113300                CR-END-DATE           DELIMITED BY SIZE           11330034
113400                PC-QUOTE              DELIMITED BY SIZE           11340034
113500           INTO PV-WHERE-CLAUSE                                   11350034
113600           WITH POINTER PV-STRING-POINTER-WHERE                   11360034
113700     END-IF.                                                      11370034
113800                                                                  11380034
113900*    CARD TYPE                                                    11390034
114000     STRING ' AND T.CRD_TYP_CDE = '   DELIMITED BY SIZE           11400034
114100            CR-CARD-TYPE-9            DELIMITED BY SIZE           11410056
114200       INTO PV-WHERE-CLAUSE                                       11420034
114300       WITH POINTER PV-STRING-POINTER-WHERE.                      11430034
114400                                                                  11440034
114500*    CARD STOCK ID                                                11450034
114600     IF CR-STOCK-ID  = PC-LIT-ALL OR PC-LIT-KMRC                  11460099
114700         CONTINUE                                                 11470098
114800     ELSE                                                         11480098
114900         STRING ' AND C.CRD_STK_TYP_ID = '                        11490098
115000                                          DELIMITED BY SIZE       11500098
115100                PC-QUOTE                  DELIMITED BY SIZE       11510098
115200                CR-STOCK-ID               DELIMITED BY SIZE       11520098
115300                PC-QUOTE                  DELIMITED BY SIZE       11530098
115400           INTO PV-WHERE-CLAUSE                                   11540098
115500           WITH POINTER PV-STRING-POINTER-WHERE                   11550098
115600     END-IF.                                                      11560098
115700                                                                  11570034
115800*    DENOMINATION AMOUNT                                          11580034
115900     IF CR-DENOMINATION = PC-LIT-ALL                              11590034
116000         CONTINUE                                                 11600034
116100     ELSE                                                         11610034
116200         MOVE CR-DENOMINATION-9    TO PV-DNNTD-AMT-DSPLY          11620034
116300         STRING ' AND C.PRE_DNNTD_CRD_AMT = '                     11630034
116400                                      DELIMITED BY SIZE           11640034
116500                PV-DNNTD-AMT-DSPLY    DELIMITED BY SIZE           11650034
116600           INTO PV-WHERE-CLAUSE                                   11660034
116700           WITH POINTER PV-STRING-POINTER-WHERE                   11670034
116800     END-IF.                                                      11680034
116900                                                                  11690034
117000**************************************************************    11700056
117100                                                                  11710056
117200*    ORDER BY                                                     11720056
117300*         POS_DTE                                                 11730084
117400*         STR_NBR                                                 11740084
117500*         CRD_PROD_YR                                             11750084
117600*         SHIPT_REQ_NBR                                           11760084
117700*         CNTL_NBR                                                11770084
117800                                                                  11780056
117900     IF PS-HISTORY-NEEDED                                         11790099
118000         PERFORM 1610-SELECT-ISSUE-HISTORY                        11800099
118100     ELSE                                                         11810099
118200         STRING ' ORDER BY 1, 2, 3, 4, 5' DELIMITED BY SIZE       11820099
118300           INTO PV-WHERE-CLAUSE                                   11830099
118400           WITH POINTER PV-STRING-POINTER-WHERE                   11840099
118500     END-IF.                                                      11850099
118600                                                                  11860047
118700*----------------------------------------------------------------*11870099
118800*     1610-SELECT-ISSUE-HISTORY                                  *11880099
118900* ==> PROCESSES:                                                 *11890099
119000*     - BUILD THE DYNAMIC CURSOR TO RETRIEVE ISSUED CARD INFO    *11900099
119100*       FROM THE HISTORY TABLE                                   *11910099
119200*----------------------------------------------------------------*11920099
119300 1610-SELECT-ISSUE-HISTORY.                                       11930099
119400                                                                  11940099
119500*    UNION ALL CLAUSE                                             11950099
119600                                                                  11960099
119700*    SELECT CLAUSE                                                11970099
119800                                                                  11980099
119900*    FROM CLAUSE                                                  11990099
120000     STRING PV-TABLE-QUALIFIER        DELIMITED BY SIZE           12000099
120100            'SVT_CRD_PROD C'          DELIMITED BY SIZE           12010099
120200            PV-TABLE-QUALIFIER-COMMA  DELIMITED BY SIZE           12020099
120300            'SVT_CRD_ACCT_HIST Y'     DELIMITED BY SIZE           12030099
120400            PV-TABLE-QUALIFIER-COMMA  DELIMITED BY SIZE           12040099
120500            'SVT_CRD_TXN_HIST Z'      DELIMITED BY SIZE           12050099
120600       INTO PV-FROM-CLAUSE2                                       12060099
120700       WITH POINTER PV-STRING-POINTER-FROM2.                      12070099
120800                                                                  12080099
120900                                                                  12090099
121000*    CARD NUMBER / CONTROL NUMBER JOIN                            12100099
121100     STRING ' Z.CRD_NBR = Y.CRD_NBR ' DELIMITED BY SIZE           12110099
121200            ' AND Y.CRD_PROD_YR =  ' DELIMITED BY SIZE            12120099
121300            ' C.CRD_PROD_YR '        DELIMITED BY SIZE            12130099
121400            'AND Y.SHIPT_REQ_NBR = ' DELIMITED BY SIZE            12140099
121500            'C.SHIPT_REQ_NBR '       DELIMITED BY SIZE            12150099
121600       INTO PV-WHERE-CLAUSE2                                      12160099
121700       WITH POINTER PV-STRING-POINTER-WHERE2.                     12170099
121800                                                                  12180099
121900*    VOID IND / ACTIVITY TYPE / CARD TYPE                         12190099
122000     STRING ' AND Z.TRN_VOID_IND = '  DELIMITED BY SIZE           12200099
122100            PC-QUOTE                  DELIMITED BY SIZE           12210099
122200            SV004-NOT-VOID-TRANS      DELIMITED BY SIZE           12220099
122300            PC-QUOTE                  DELIMITED BY SIZE           12230099
122400            ' AND Z.ACTVY_TYP_CDE '   DELIMITED BY SIZE           12240099
122500            'IN ('                    DELIMITED BY SIZE           12250099
122600            SV004-ISSUE-KMRC-ACT-TYP DELIMITED BY SIZE            12260099
122700            PC-COMMA                  DELIMITED BY SIZE           12270099
122800            SV004-ISSUE-GIFT-CRD-ACT-TYP DELIMITED BY SIZE        12280099
122900            ')'                       DELIMITED BY SIZE           12290099
123000       INTO PV-WHERE-CLAUSE2                                      12300099
123100       WITH POINTER PV-STRING-POINTER-WHERE2.                     12310099
123200                                                                  12320099
123300*    STORE NUMBER                                                 12330099
123400     IF CR-STORE-NUMBER = PC-LIT-ALL                              12340099
123500         CONTINUE                                                 12350099
123600     ELSE                                                         12360099
123700         STRING ' AND Z.STR_NBR = '   DELIMITED BY SIZE           12370099
123800                CR-STORE-NUMBER-9     DELIMITED BY SIZE           12380099
123900           INTO PV-WHERE-CLAUSE2                                  12390099
124000           WITH POINTER PV-STRING-POINTER-WHERE2                  12400099
124100     END-IF.                                                      12410099
124200                                                                  12420099
124300*    BEGIN & END DATE                                             12430099
124400     IF CR-BEG-DATE = CR-END-DATE                                 12440099
124500         STRING ' AND Z.POS_DTE = '   DELIMITED BY SIZE           12450099
124600                PC-QUOTE              DELIMITED BY SIZE           12460099
124700                CR-BEG-DATE           DELIMITED BY SIZE           12470099
124800                PC-QUOTE              DELIMITED BY SIZE           12480099
124900           INTO PV-WHERE-CLAUSE2                                  12490099
125000           WITH POINTER PV-STRING-POINTER-WHERE2                  12500099
125100     ELSE                                                         12510099
125200         STRING ' AND Z.POS_DTE BETWEEN '                         12520099
125300                                      DELIMITED BY SIZE           12530099
125400                PC-QUOTE              DELIMITED BY SIZE           12540099
125500                CR-BEG-DATE           DELIMITED BY SIZE           12550099
125600                PC-QUOTE              DELIMITED BY SIZE           12560099
125700                ' AND '               DELIMITED BY SIZE           12570099
125800                PC-QUOTE              DELIMITED BY SIZE           12580099
125900                CR-END-DATE           DELIMITED BY SIZE           12590099
126000                PC-QUOTE              DELIMITED BY SIZE           12600099
126100           INTO PV-WHERE-CLAUSE2                                  12610099
126200           WITH POINTER PV-STRING-POINTER-WHERE2                  12620099
126300     END-IF.                                                      12630099
126400                                                                  12640099
126500*    CARD TYPE                                                    12650099
126600     STRING ' AND C.CRD_TYP_CDE = '   DELIMITED BY SIZE           12660099
126700            CR-CARD-TYPE-9            DELIMITED BY SIZE           12670099
126800       INTO PV-WHERE-CLAUSE2                                      12680099
126900       WITH POINTER PV-STRING-POINTER-WHERE2.                     12690099
127000                                                                  12700099
127100*    CARD STOCK ID                                                12710099
127200     IF CR-STOCK-ID = PC-LIT-ALL OR PC-LIT-KMRC                   12720099
127300         CONTINUE                                                 12730099
127400     ELSE                                                         12740099
127500         STRING ' AND C.CRD_STK_TYP_ID = '                        12750099
127600                                          DELIMITED BY SIZE       12760099
127700                PC-QUOTE                  DELIMITED BY SIZE       12770099
127800                CR-STOCK-ID               DELIMITED BY SIZE       12780099
127900                PC-QUOTE                  DELIMITED BY SIZE       12790099
128000           INTO PV-WHERE-CLAUSE2                                  12800099
128100           WITH POINTER PV-STRING-POINTER-WHERE2                  12810099
128200     END-IF.                                                      12820099
128300                                                                  12830099
128400*    DENOMINATION AMOUNT                                          12840099
128500     IF CR-DENOMINATION = PC-LIT-ALL                              12850099
128600         CONTINUE                                                 12860099
128700     ELSE                                                         12870099
128800         MOVE CR-DENOMINATION-9    TO PV-DNNTD-AMT-DSPLY          12880099
128900         STRING ' AND C.PRE_DNNTD_CRD_AMT = '                     12890099
129000                                      DELIMITED BY SIZE           12900099
129100                PV-DNNTD-AMT-DSPLY    DELIMITED BY SIZE           12910099
129200           INTO PV-WHERE-CLAUSE2                                  12920099
129300           WITH POINTER PV-STRING-POINTER-WHERE2                  12930099
129400     END-IF.                                                      12940099
129500                                                                  12950099
129600                                                                  12960099
129700*    ORDER BY                                                     12970099
129800*         POS_DTE                                                 12980099
129900*         STR_NBR                                                 12990099
130000*         CRD_PROD_YR                                             13000099
130100*         SHIPT_REQ_NBR                                           13010099
130200*         CNTL_NBR                                                13020099
130300                                                                  13030099
130400     STRING ' ORDER BY 1, 2, 3, 4, 5' DELIMITED BY SIZE           13040099
130500       INTO PV-WHERE-CLAUSE2                                      13050099
130600       WITH POINTER PV-STRING-POINTER-WHERE2.                     13060099
130700                                                                  13070099
130800*----------------------------------------------------------------*13080047
130900*     1900-EOJ-ROUTINE                                           *13090047
131000* ==> PROCESSES:                                                 *13100000
131100*     - WRITES AN END OF REPORT LINE TO THE REPORT               *13110000
131200*     - CLOSES THE FILES                                         *13120000
131300*     - DISPLAYS THE NUMBER OF RECORDS READ AND WRITTEN          *13130000
131400*----------------------------------------------------------------*13140000
131500 1900-EOJ-ROUTINE.                                                13150000
131600                                                                  13160000
131700     CLOSE CONTROL-CARD-FILE                                      13170000
131800           REPORT-FILE.                                           13180000
131900                                                                  13190000
132000     EXEC SQL                                                     13200000
132100        CLOSE ORDER-CSR                                           13210000
132200     END-EXEC.                                                    13220000
132300                                                                  13230000
132400     EVALUATE TRUE                                                13240000
132500         WHEN SQLCODE = ZERO                                      13250000
132600             CONTINUE                                             13260000
132700         WHEN OTHER                                               13270000
132800             MOVE '1900-EOJ-ROUTINE'                              13280000
132900                                   TO PV-PARAGRAPH-NAME           13290000
133000             MOVE 'CLOSE ORDER CURSOR          '                  13300000
133100                                   TO PV-DB2-OPERATION-ATTEMPTED  13310000
133200             PERFORM 9999-SQL-ABEND                               13320000
133300     END-EVALUATE.                                                13330000
133400                                                                  13340000
133500     DISPLAY ' '.                                                 13350000
133600     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             13360000
133700     DISPLAY 'NUMBER OF CARD ORDER RECORDS READ:       '          13370000
133800         PA-CARD-RECS-READ.                                       13380000
133900     DISPLAY ' '.                                                 13390000
134000                                                                  13400000
134100*----------------------------------------------------------------*13410000
134200*     2000-PROCESS-ORDERS                                        *13420000
134300* ==> PROCESSES:                                                 *13430000
134400*     - PROCESS THE CARDS ORDER FOR THE REQUESTED CRITERIA       *13440000
134500*----------------------------------------------------------------*13450000
134600 2000-PROCESS-ORDERS.                                             13460000
134700                                                                  13470000
134800     IF PV-HOLD-CRD-DTE = SVT00001-CRD-DISTRB-DTE                 13480056
134900         IF PV-HOLD-STR-NBR = SVT00001-STR-NBR                    13490056
135000             PERFORM 2010-PROCESS-CNTL-RANGE                      13500000
135100             IF PS-END-OF-RANGE                                   13510000
135200                 PERFORM 7000-PRINT-DETAIL                        13520000
135300                 MOVE SPACES       TO RDL1-CNTL-NBR-END           13530000
135400                                      RDL1-DATE                   13540000
135500                                      RDL1-STORE                  13550000
135600                 IF CR-CARD-TYPE-9 = SV004-KMRC-CRD-TYP           13560056
135700                     MOVE SPACE    TO RDL1-DENOMINATION           13570020
135800                 ELSE                                             13580020
135900                     MOVE SVT00000-PRE-DNNTD-CRD-AMT              13590056
136000                                   TO RDL1-DENOMINATION-9         13600020
136100                 END-IF                                           13610020
136200                 SET PS-FIRST-CNTL-NBR                            13620000
136300                                   TO TRUE                        13630000
136400                 PERFORM 2010-PROCESS-CNTL-RANGE                  13640000
136500             END-IF                                               13650000
136600         ELSE                                                     13660000
136700             PERFORM 7000-PRINT-DETAIL                            13670000
136800             MOVE SPACES           TO RDL1-CNTL-NBR-END           13680000
136900                                      RDL1-DATE                   13690000
137000             MOVE SVT00001-STR-NBR TO PV-HOLD-STR-NBR             13700056
137100                                      RDL1-STORE-9                13710000
137200             IF CR-CARD-TYPE-9 = SV004-KMRC-CRD-TYP               13720056
137300                 MOVE SPACE        TO RDL1-DENOMINATION           13730020
137400             ELSE                                                 13740020
137500                 MOVE SVT00000-PRE-DNNTD-CRD-AMT                  13750056
137600                                   TO RDL1-DENOMINATION-9         13760020
137700             END-IF                                               13770020
137800             SET PS-FIRST-CNTL-NBR TO TRUE                        13780000
137900             PERFORM 2010-PROCESS-CNTL-RANGE                      13790000
138000         END-IF                                                   13800000
138100     ELSE                                                         13810000
138200         PERFORM 7000-PRINT-DETAIL                                13820000
138300         PERFORM 7100-PRINT-DATE-TOTALS                           13830014
138400         MOVE SPACES               TO RDL1-CNTL-NBR-END           13840000
138500         MOVE SVT00001-STR-NBR     TO PV-HOLD-STR-NBR             13850056
138600                                      RDL1-STORE-9                13860000
138700         MOVE SVT00001-CRD-DISTRB-DTE                             13870056
138800                                   TO PV-HOLD-CRD-DTE             13880000
138900         MOVE PV-HOLD-CRD-DTE(1:4) TO PV-CARD-DATE-CCYY           13890007
139000         MOVE PV-HOLD-CRD-DTE(6:2) TO PV-CARD-DATE-MM             13900007
139100         MOVE PV-HOLD-CRD-DTE(9:2) TO PV-CARD-DATE-DD             13910007
139200         MOVE PV-CARD-DATE         TO RDL1-DATE                   13920007
139300         IF CR-CARD-TYPE-9 = SV004-KMRC-CRD-TYP                   13930056
139400             MOVE SPACE            TO RDL1-DENOMINATION           13940020
139500         ELSE                                                     13950020
139600             MOVE SVT00000-PRE-DNNTD-CRD-AMT                      13960056
139700                                   TO RDL1-DENOMINATION-9         13970020
139800         END-IF                                                   13980020
139900         SET PS-FIRST-CNTL-NBR     TO TRUE                        13990000
140000         PERFORM 2010-PROCESS-CNTL-RANGE                          14000000
140100     END-IF.                                                      14010000
140200                                                                  14020000
140300     PERFORM 2100-FETCH-ORDER-CURSOR.                             14030000
140400                                                                  14040000
140500*----------------------------------------------------------------*14050000
140600*     2010-PROCESS-CNTL-RANGE.                                   *14060000
140700* ==> PROCESSES:                                                 *14070000
140800*     - PROCESSES CNTL NUMBERS TO SEE IF THE RANGE IS BROKEN.    *14080000
140900*     - IF FIRST TIME, SET PREVIOUS HOLD FIELDS AND DO NOT CHECK *14090000
141000*       FOR RANGE.                                               *14100000
141100*     - AFTER THE END OF A RANGE, THE PREVIOUS CNTL NBR(S) IS    *14110000
141200*       WRITTEN, NOT THE CURRENT CNTL NBR WHICH WAS JUST READ.   *14120000
141300*----------------------------------------------------------------*14130000
141400 2010-PROCESS-CNTL-RANGE.                                         14140000
141500                                                                  14150000
141600     IF PS-FIRST-CNTL-NBR                                         14160000
141700         SET PS-NOT-FIRST-CNTL-NBR                                14170001
141800             PS-NOT-END-OF-RANGE     TO TRUE                      14180056
141900         MOVE SVT00001-CRD-PROD-YR   TO PV-HOLD-PREV-CRD-PROD-YR  14190056
142000         MOVE SVT00001-SHIPT-REQ-NBR TO PV-HOLD-PREV-SHIPT-REQ    14200056
142100         MOVE SVT00001-CNTL-NBR      TO PV-HOLD-PREV-CNTL         14210056
142200         MOVE SVT00000-CRD-STK-TYP-ID                             14220099
142300                                     TO RDL1-STOCK-ID             14230099
142400         MOVE PV-HOLD-PREV-CNTL-NBR  TO PV-CNTL-NBR-TO-FMT        14240056
142500                                                                  14250056
142600         PERFORM 2030-DETERMINE-CNTL-NBR-PRINT                    14260000
142700                                                                  14270056
142800         MOVE PV-CNTL-NBR-FMTD         TO RDL1-CNTL-NBR-STRT      14280056
142900         MOVE PV-HOLD-PREV-CRD-PROD-YR TO PV-HOLD-NEXT-CRD-PROD-YR14290056
143000         MOVE PV-HOLD-PREV-SHIPT-REQ   TO PV-HOLD-NEXT-SHIPT-REQ  14300056
143100         COMPUTE PV-HOLD-NEXT-CNTL = SVT00001-CNTL-NBR + 1        14310056
143200         ADD +1                    TO PA-CARD-QUANTITY            14320000
143300     ELSE                                                         14330000
143400         PERFORM 2020-CHECK-FOR-RANGE                             14340000
143500     END-IF.                                                      14350000
143600                                                                  14360000
143700*----------------------------------------------------------------*14370000
143800*     2020-CHECK-FOR-RANGE.                                      *14380000
143900* ==> PROCESSES:                                                 *14390000
144000*     - CHECK TO SEE IF NEW CNTL-NBR FALLS IN RANGE OF PREVIOUS  *14400000
144100*       CNTL NBR.                                                 14410000
144200*----------------------------------------------------------------*14420000
144300 2020-CHECK-FOR-RANGE.                                            14430000
144400                                                                  14440000
144500     IF SVT00001-CRD-PROD-YR = PV-HOLD-NEXT-CRD-PROD-YR           14450056
144600      AND SVT00001-SHIPT-REQ-NBR = PV-HOLD-NEXT-SHIPT-REQ         14460056
144700      AND SVT00001-CNTL-NBR = PV-HOLD-NEXT-CNTL                   14470056
144800         MOVE PV-HOLD-NEXT-CNTL-NBR TO PV-HOLD-PREV-CNTL-NBR      14480056
144900         COMPUTE PV-HOLD-NEXT-CNTL = SVT00001-CNTL-NBR + 1        14490056
145000         SET PS-FORMAT-END-CNTL-NBR                               14500000
145100             PS-RANGE-FOUND        TO TRUE                        14510000
145200         ADD +1                    TO PA-CARD-QUANTITY            14520000
145300     ELSE                                                         14530000
145400        SET PS-END-OF-RANGE                                       14540000
145500            PS-RANGE-NOT-FOUND     TO TRUE                        14550000
145600     END-IF.                                                      14560000
145700                                                                  14570000
145800*----------------------------------------------------------------*14580000
145900*     2030-DETERMINE-CNTL-NBR-PRINT                              *14590000
146000* ==> PROCESSES:                                                 *14600000
146100*     - THE SVT00001-CNTL-NBR NEEDS TO BE PRINTED AS A 12 DIGIT  *14610056
146200*       NUMBER FOR CARDS IF THE CARD REQUESTED DATE IS PRIOR     *14620056
146300*       TO THE SPECIFIED DATE BELOW. OTHERWISE PRINT AS 14 DIGIT.*14630056
146400*----------------------------------------------------------------*14640000
146500 2030-DETERMINE-CNTL-NBR-PRINT.                                   14650000
146600                                                                  14660000
146700     IF SVT00000-CRD-REQD-DTE  <= '2002-03-31'                    14670057
146800         MOVE PV-CNTL-NBR-PRE-033102 TO PV-CNTL-NBR-FMTD          14680056
146900     ELSE                                                         14690056
147000         MOVE PV-CNTL-NBR-TO-FMT     TO PV-CNTL-NBR-FMTD          14700056
147100     END-IF.                                                      14710056
147200                                                                  14720000
147300*----------------------------------------------------------------*14730000
147400*     2100-FETCH-ORDER-CURSOR                                    *14740000
147500* ==> PROCESSES:                                                 *14750000
147600*     - READS ACTIVITY FROM THE SVT_KOHLS_CRD_TXN/               *14760056
147700*       SVT_KOHLS_CRD_ACCT/SVT_CRD_PROD TABLES                    14770056
147800*       OR SVT_CRD_TXN_HIST/SVT_CRD_ACCT_HIST/SVT_CRD_PROD TABLES*14780056
147900*     - I.E. 'UNION ALL' FILLS SVT00001 FIELDS (LISTED BELOW)    *14790056
148000*       WITH DATA FROM EITHER SVT_KOHLS_CRD_ACCT OR              *14800056
148100*       SVT_CRD_ACCT_HIST.                                       *14810056
148200*----------------------------------------------------------------*14820000
148300 2100-FETCH-ORDER-CURSOR.                                         14830000
148400                                                                  14840000
148500     EXEC SQL                                                     14850000
148600         FETCH ORDER-CSR                                          14860000
148700           INTO  :SVT00001-CRD-DISTRB-DTE                         14870056
148800                ,:SVT00001-STR-NBR                                14880056
148900                ,:SVT00001-CRD-PROD-YR                            14890066
149000                ,:SVT00001-SHIPT-REQ-NBR                          14900066
149100                ,:SVT00001-CNTL-NBR                               14910056
149200                ,:SVT00000-PRE-DNNTD-CRD-AMT                      14920056
149300                ,:SVT00000-CRD-REQD-DTE                           14930056
149400                ,:SVT00000-CRD-STK-TYP-ID                         14940099
149500     END-EXEC.                                                    14950000
149600                                                                  14960000
149700     EVALUATE TRUE                                                14970000
149800         WHEN SQLCODE = +0                                        14980000
149900             ADD +1                TO PA-CARD-RECS-READ           14990000
150000             CONTINUE                                             15000000
150100         WHEN SQLCODE = +100                                      15010000
150200             SET PS-END-OF-ORDER-CSR                              15020000
150300                                   TO TRUE                        15030000
150400         WHEN OTHER                                               15040000
150500             MOVE '2100-FETCH-ORDER-CURSOR'                       15050000
150600                                   TO PV-PARAGRAPH-NAME           15060000
150700             MOVE 'ERROR ON FETCH ORDER-CSR       '               15070000
150800                                   TO PV-DB2-OPERATION-ATTEMPTED  15080000
150900             PERFORM 9999-SQL-ABEND                               15090000
151000     END-EVALUATE.                                                15100000
151100                                                                  15110000
151200*----------------------------------------------------------------*15120000
151300*     7000-PRINT-DETAIL                                          *15130000
151400* ==> PROCESSES:                                                 *15140000
151500*     - WRITES THE RANGE OF CNTL NBRS DETAIL LINE.               *15150000
151600*----------------------------------------------------------------*15160000
151700 7000-PRINT-DETAIL.                                               15170000
151800                                                                  15180000
151900     IF PS-END-OF-ORDER-CSR                                       15190000
152000         IF (PA-LINE-COUNTER + 8) > PC-MAX-LINES-PER-PAGE         15200014
152100             PERFORM 8000-PROCESS-PAGE-HEADINGS                   15210000
152200         END-IF                                                   15220000
152300     ELSE                                                         15230000
152400         IF PA-LINE-COUNTER > PC-MAX-LINES-PER-PAGE               15240000
152500             PERFORM 8000-PROCESS-PAGE-HEADINGS                   15250000
152600         END-IF                                                   15260000
152700     END-IF.                                                      15270000
152800                                                                  15280000
152900     IF PS-FORMAT-END-CNTL-NBR                                    15290000
153000         SET PS-DONT-FORMAT-CNTL-NBR                              15300000
153100                                   TO TRUE                        15310000
153200         MOVE PV-HOLD-PREV-CNTL-NBR                               15320000
153300                                   TO PV-CNTL-NBR-TO-FMT          15330000
153400        PERFORM 2030-DETERMINE-CNTL-NBR-PRINT                     15340000
153500        MOVE PV-CNTL-NBR-FMTD      TO RDL1-CNTL-NBR-END           15350000
153600     END-IF.                                                      15360000
153700                                                                  15370000
153800     MOVE PA-CARD-QUANTITY          TO RDL1-QUANTITY.             15380000
153900     ADD  PA-CARD-QUANTITY          TO PA-TTL-CARD-QUANTITY.      15390000
154000     ADD  PA-CARD-QUANTITY          TO PA-DTE-CARD-QUANTITY.      15400014
154100     MOVE ZERO                      TO PA-CARD-QUANTITY.          15410000
154200                                                                  15420006
154300     IF RDL1-DATE > SPACES AND PS-NOT-FROM-HEADINGS               15430006
154400         MOVE +2                    TO PV-LINE-SPACING            15440003
154500     ELSE                                                         15450003
154600         MOVE +1                    TO PV-LINE-SPACING            15460003
154700         SET PS-NOT-FROM-HEADINGS   TO TRUE                       15470006
154800     END-IF.                                                      15480003
154900                                                                  15490000
155000     WRITE REPORT-RECORD                                          15500000
155100           FROM REPORT-DETAIL-LINE-1                              15510000
155200           AFTER ADVANCING PV-LINE-SPACING LINE.                  15520003
155300                                                                  15530000
155400     ADD PV-LINE-SPACING            TO PA-LINE-COUNTER.           15540003
155500                                                                  15550000
155600                                                                  15560000
155700 7100-PRINT-DATE-TOTALS.                                          15570014
155800*----------------------------------------------------------------*15580014
155900*     7100-PRINT-DATE-TOTALS.                                    *15590014
156000* ==> PROCESSES:                                                 *15600014
156100*     - WRITE THE ACCUMULATED TOTAL FOR THE PROCESSED DATE       *15610014
156200*----------------------------------------------------------------*15620014
156300                                                                  15630014
156400     WRITE REPORT-RECORD                                          15640014
156500           FROM REPORT-TOTAL-DASH                                 15650014
156600           AFTER ADVANCING 1 LINE.                                15660014
156700                                                                  15670014
156800     MOVE PA-DTE-CARD-QUANTITY      TO RTL1-QUANTITY.             15680014
156900                                                                  15690014
157000     WRITE REPORT-RECORD                                          15700014
157100           FROM REPORT-TOTAL-LINE-1                               15710014
157200           AFTER ADVANCING 1 LINE.                                15720014
157300                                                                  15730017
157400     ADD +2                         TO PA-LINE-COUNTER.           15740017
157500     MOVE ZEROS                     TO PA-DTE-CARD-QUANTITY.      15750018
157600                                                                  15760014
157700 7200-PRINT-TOTALS.                                               15770014
157800*----------------------------------------------------------------*15780000
157900*     7200-PRINT-TOTALS.                                         *15790014
158000* ==> PROCESSES:                                                 *15800000
158100*     - WRITE THE REPORT TOTAL LINES                             *15810000
158200*----------------------------------------------------------------*15820000
158300                                                                  15830000
158400                                                                  15840014
158500     WRITE REPORT-RECORD                                          15850000
158600           FROM REPORT-TOTAL-DASH                                 15860000
158700           AFTER ADVANCING 1 LINE.                                15870000
158800                                                                  15880000
158900     MOVE PC-LIT-TOTAL              TO RTL1-TOTAL-TITLE.          15890016
159000     MOVE PA-TTL-CARD-QUANTITY      TO RTL1-QUANTITY.             15900000
159100                                                                  15910000
159200     WRITE REPORT-RECORD                                          15920000
159300           FROM REPORT-TOTAL-LINE-1                               15930000
159400           AFTER ADVANCING 1 LINE.                                15940000
159500                                                                  15950000
159600     WRITE REPORT-RECORD                                          15960000
159700           FROM REPORT-TOTAL-LINE-2                               15970000
159800           AFTER ADVANCING 4 LINE.                                15980000
159900                                                                  15990005
160000*----------------------------------------------------------------*16000000
160100*     8000-PROCESS-PAGE-HEADINGS.                                *16010000
160200* ==> PROCESSES:                                                 *16020000
160300*     - ADVANCES TO A NEW PAGE AND WRITES THE REPORT HEADINGS    *16030000
160400*----------------------------------------------------------------*16040000
160500 8000-PROCESS-PAGE-HEADINGS.                                      16050000
160600                                                                  16060000
160700     ADD PC-ONE                    TO PA-PAGE-COUNTER.            16070000
160800     MOVE PA-PAGE-COUNTER          TO DP075-PAGE-NUMBER.          16080000
160900     MOVE PC-ONE                   TO DP075-REPORT-NUMBER.        16090000
161000                                                                  16100000
161100     MOVE PC-HEADER-LINE-COUNT     TO PA-LINE-COUNTER.            16110000
161200                                                                  16120000
161300     WRITE REPORT-RECORD                                          16130000
161400         FROM DP075-STANDARD-HEADER-75-COLS                       16140000
161500         AFTER ADVANCING PAGE.                                    16150000
161600                                                                  16160000
161700     INITIALIZE DP075-LASER-NEW-PAGE-INDICATR.                    16170000
161800                                                                  16180000
161900     WRITE REPORT-RECORD                                          16190000
162000         FROM REPORT-TITLE-LINE                                   16200000
162100         AFTER ADVANCING 1 LINE.                                  16210000
162200                                                                  16220000
162300     WRITE REPORT-RECORD                                          16230000
162400         FROM REPORT-CLAUSE-LINE-1                                16240000
162500         AFTER ADVANCING 3 LINE.                                  16250000
162600                                                                  16260000
162700     WRITE REPORT-RECORD                                          16270000
162800         FROM REPORT-CLAUSE-LINE-2                                16280000
162900         AFTER ADVANCING 1 LINE.                                  16290000
163000                                                                  16300000
163100     WRITE REPORT-RECORD                                          16310000
163200         FROM REPORT-CLAUSE-LINE-3                                16320000
163300         AFTER ADVANCING 1 LINE.                                  16330000
163400                                                                  16340000
163500     WRITE REPORT-RECORD                                          16350000
163600         FROM REPORT-SUBTITLE-LINE-1                              16360000
163700         AFTER ADVANCING 4 LINE.                                  16370000
163800                                                                  16380000
163900     WRITE REPORT-RECORD                                          16390000
164000         FROM REPORT-SUBTITLE-LINE-2                              16400000
164100         AFTER ADVANCING 2 LINE.                                  16410000
164200                                                                  16420000
164300     WRITE REPORT-RECORD                                          16430000
164400         FROM REPORT-HEADER-LINE-1                                16440000
164500         AFTER ADVANCING 3 LINE.                                  16450000
164600                                                                  16460000
164700     WRITE REPORT-RECORD                                          16470000
164800         FROM REPORT-HEADER-LINE-2                                16480000
164900         AFTER ADVANCING 1 LINE.                                  16490000
165000                                                                  16500000
165100     WRITE REPORT-RECORD                                          16510000
165200         FROM REPORT-HEADER-LINE-3                                16520000
165300         AFTER ADVANCING 1 LINE.                                  16530000
165400                                                                  16540000
165500     MOVE PV-HOLD-STR-NBR          TO RDL1-STORE-9.               16550006
165600     MOVE PV-HOLD-CRD-DTE(1:4)     TO PV-CARD-DATE-CCYY.          16560007
165700     MOVE PV-HOLD-CRD-DTE(6:2)     TO PV-CARD-DATE-MM.            16570007
165800     MOVE PV-HOLD-CRD-DTE(9:2)     TO PV-CARD-DATE-DD.            16580007
165900     MOVE PV-CARD-DATE             TO RDL1-DATE.                  16590007
166000     SET PS-FROM-HEADINGS          TO TRUE.                       16600006
166100                                                                  16610006
166200***************************************************************** 16620099
166300*    ABEND PROCESSING FOR ERRORS.                                 16630099
166400***************************************************************** 16640099
166500 9900-DATE-ABEND.                                                 16650099
166600     DISPLAY ' '.                                                 16660099
166700     DISPLAY '** ABEND     **'.                                   16670099
166800     DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME.               16680099
166900     DISPLAY '** PARAGRAPH **  = ' PV-PARAGRAPH-NAME.             16690099
167000     DISPLAY '** BAD CALL TO CALENDAR MODULE '.                   16700099
167100     DISPLAY DPG54-ERROR-MESSAGE.                                 16710099
167200                                                                  16720099
167300******************************************************************16730000
167400*     9999-SQL-ABEND                                             *16740000
167500* ==> PROCESSES:                                                 *16750000
167600*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *16760000
167700******************************************************************16770000
167800 9999-SQL-ABEND.                                                  16780000
167900                                                                  16790000
168000     DISPLAY '9999-SQL-ABEND'.                                    16800000
168100     DISPLAY '**  ABEND     **'.                                  16810000
168200     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               16820000
168300     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             16830000
168400     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    16840000
168500                                                                  16850000
168600******************************************************************16860000
168700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *16870000
168800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *16880000
168900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *16890000
169000* FORMAT.                                                        *16900000
169100******************************************************************16910000
169200     COPY DPPD004.                                                16920000
169300                                                                  16930000
169400     MOVE +4013 TO ABEND-CODE.                                    16940000
169500     CALL 'ILBOABN0' USING ABEND-CODE.                            16950000
