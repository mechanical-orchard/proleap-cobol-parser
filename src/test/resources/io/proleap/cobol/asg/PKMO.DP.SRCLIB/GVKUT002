000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         GVKUT002.                                    00020004
000300 AUTHOR.             Cognizant.                                   00030004
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       JUN       2014                               00050032
000800*---------------------------------------------------------------* 00051005
000900*    THIS IS A COPY OF PROGRAM OFKUT007, CHANGED TO GVKUT002    * 00052005
001000*    WITH NEW XML LAYOUT AND QUEUE TO GIV.                      * 00053005
000600******************************************************************00060000
000600*When compiling check 'MQSERIES PROGRAM(Y/N)' with 'Y' on second *00061002
000600*compile screen.                                                 *00062002
000600******************************************************************00063002
000700*        SEND RDC INVENTORY ADJUSTMENTS TO GIV                    00070005
000800* This program will take in a file of extracted verified          00080000
000900* receipts and receipt adjustments that have been determined      00090000
001000* to be for RDC and send those to GIV via MQ                      00100005
001020******************************************************************00102000
001030*  CHANGE LOG                                                     00103000
001040*  DATE       CHANGED BY    DESC                                  00104000
001050*  ---------- ------------- --------------------------------------00105000
001060*  06/25/2014 Cognizant     GIV Changes for                       00106031
001070*                           GIV_R1 1 0_RDC_Adjustments            00107005
001102*                                                                 00110200
001103******************************************************************00110300
001110 ENVIRONMENT DIVISION.                                            00111000
001120******************************************************************00112000
001130 CONFIGURATION SECTION.                                           00113000
001140 SOURCE-COMPUTER.    IBM-3090.                                    00114000
001150 OBJECT-COMPUTER.    IBM-3090.                                    00115000
001160                                                                  00116000
001170 INPUT-OUTPUT SECTION.                                            00117000
001180 FILE-CONTROL.                                                    00118000
001190     SELECT STR-EXPECTED-FILE     ASSIGN TO IN01.                 00119000
001192                                                                  00119200
001193******************************************************************00119400
001194 DATA DIVISION.                                                   00119500
001195******************************************************************00119600
001196 FILE SECTION.                                                    00119700
001197                                                                  00119800
001198 FD  STR-EXPECTED-FILE                                            00119900
001199     RECORDING MODE IS F                                          00120000
001200     LABEL RECORDS ARE STANDARD                                   00120100
001201     BLOCK CONTAINS 0 RECORDS.                                    00120200
001202 01  STR-EXPECTED-RECORD         PIC X(60).                       00120300
001197                                                                  00120406
001237******************************************************************00123700
001238 WORKING-STORAGE SECTION.                                         00123800
001239******************************************************************00123900
001240 01  PS-PROGRAM-SWITCHES.                                         00124000
001250     05  PS-END-OF-EXPECTED-REC      PIC X(01) VALUE 'N'.         00125000
001260         88  PS-END-OF-EXPECTED-REC-Y          VALUE 'Y'.         00126000
001270         88  PS-END-OF-EXPECTED-REC-N          VALUE 'N'.         00127000
001400     05  PS-END-OF-MQ-CSR            PIC X(01) VALUE 'N'.         00140000
001500         88  PS-END-OF-MQ-CSR-Y                VALUE 'Y'.         00150000
001600         88  PS-END-OF-MQ-CSR-N                VALUE 'N'.         00160000
002000     05  PS-MQPUT-SUCCESSFUL-IND     PIC X(01) VALUE SPACES.      00200000
002100         88  PS-MQPUT-SUCCESSFUL               VALUE 'Y'.         00210000
002200                                                                  00220000
002300 01  PA-PROGRAM-ACCUMULATORS.                                     00230000
002500     05  PA-TOTAL-MQ-MSGS-SENT       PIC S9(9) VALUE +0 COMP-3.   00250000
002600                                                                  00260000
002700 01  PV-PROGRAM-VARIABLES.                                        00270000
002800     05  N                           PIC 9(05) VALUE ZEROES.      00280000
003000     05  PV-COUNTER                  PIC 9(05) VALUE ZEROES.      00300000
003200     05  PV-EXPECTS-SENT-TO-QUE      PIC 9(05) VALUE ZEROES.      00320000
004000     05  PV-MQ-CNT                   PIC 9(05) VALUE ZEROES.      00400000
004000     05  PV-STR-NBR-4                PIC 9(04) VALUE ZEROS.       00401000
004000     05  PV-STR-NBR-RED     REDEFINES                             00401100
004000         PV-STR-NBR-4.                                            00401200
004000         10 PV-STR-NBR-1             PIC 9(01).                   00402000
004000         10 PV-STR-NBR               PIC 9(03).                   00403000
004100     05  PV-MQ-TBL-CNT               PIC 9(05) VALUE ZEROES.      00410000
004200     05  PV-MQ-HANDLE-CNT            PIC 9(05) VALUE ZEROES.      00420000
004300     05  PV-CNT                      PIC 9(05) VALUE ZEROES.      00430000
004400     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.00440000
004500     05  PV-HOLD-COMPLETION-CODE     PIC S9(9) BINARY.            00450000
004600     05  PV-HOLD-REASON              PIC S9(9) BINARY.            00460000
004700     05  PV-HOLD-PROCESS-TYPE        PIC X(16) VALUE SPACES.      00470000
004800     05  PV-XML-BANNER               PIC X(39) VALUE              00480000
004900         '<?xml version="1.0" encoding="UTF-8" ?>'.               00490000
005000     05  PV-VNDR-HOLD-DFLT-VALUES.                                00500000
005100        10  PV-HOLD-TAG-NM           PIC X(50) VALUE SPACES.      00510000
005200        10  PV-HOLD-DFLT-VALUE       PIC X(02) VALUE SPACES.      00520000
005300                                                                  00530000
005400 01  ABEND-CODE                      PIC S9(4) VALUE +0 COMP SYNC.00540000
005500 01  PV-HOLD-MSGBUFFER.                                           00550000
005600     05  PV-MSGBUFFER-CHAR OCCURS   1000 TIMES                    00560000
005700                                     PIC X(01).                   00570000
005800 01  PV-ABEND-VARIABLES.                                          00580000
005900     05  PV-SQLCODE                  PIC S9(9).                   00590000
006000     05  PV-DISPLAY-SQLCODE          PIC -------999.              00600000
006100     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'GVKUT002'.  00610004
006200     05  PV-ABEND-PARAGRAPH          PIC X(25) VALUE SPACES.      00620000
006300     05  PV-ABEND-OPERATION          PIC X(20) VALUE SPACES.      00630000
006400     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      00640000
006500     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      00650000
006600     05  PV-ABEND-CODE               PIC S9(4) VALUE +0 COMP SYNC.00660000
006700                                                                  00670000
006800***************************************************************** 00680000
006900*    RECORD PURPOSE: EXPECT Extract (for XML conversion)        * 00690000
      * The lines in the next 01 level need to start w/capitol and    * 00691000
      * end with lower case for the XML to work.                        00692000
007000***************************************************************** 00700000
007100                                                                  00710010
        01  Items.                                                      00710119
            05  Item.                                                   00711024
                10 AdjustmentType          PIC X(15).                   00711125
                10 Availability            PIC X(20).                   00712024
                10 ItemID                  PIC X(40).                   00714024
                10 OrganizationCode        PIC X(24).                   00715024
                10 ProductClass            PIC X(10).                   00716024
                10 Quantity                PIC S9(10)V9 COMP.           00717024
                10 ReasonCode              PIC x(40).                   00719124
                10 ReasonText              PIC X(255) VALUE SPACE.      00719224
                10 ShipNode                PIC X(24).                   00719324
                10 SupplyType              PIC X(40).                   00719424
                10 UnitOfMeasure           PIC X(40).                   00719524
                10 Reference1              PIC X(254).                  00719624
                                                                        00719710
010022                                                                  01002200
010024 01  PV-XML                      PIC X(1000)     VALUE SPACES.    01002400
010030                                                                  01003000
010040 01  PV-DESC                     PIC X(132)      VALUE SPACES.    01004000
010050 01  PV-DISPLAY                  PIC X(132)      VALUE SPACES.    01005000
010060                                                                  01006000
010200 01  XML-LENGTH                  PIC 9(9)    COMP.                01020000
010300                                                                  01030000
010410     COPY ISWS007.                                                01041000
010500     COPY ISWS008.                                                01050000
010600     COPY ISWS009.                                                01060000
010700                                                                  01070000
010800***************************************************************** 01080000
010900* FILE OPEN STATUS'S ON THE CONTROL CARDS USED FOR GETTING        01090000
011000* MQ-SERIES QUEUE MANAGER AND QUEUE NAME.                         01100000
011100***************************************************************** 01110000
012100                                                                  01210000
012200 01  PE-MQ-ABEND-VARIABLES.                                       01220000
012300     05  PE-MQ-QMANAGER              PIC X(05) VALUE SPACES.      01230000
012400     05  PE-MQ-QMANAGER-REMOTE       PIC X(30) VALUE SPACES.      01240000
012500     05  PE-MQ-QNAME                 PIC X(48) VALUE SPACES.      01250000
012600     05  PE-MQ-COMPLETION-CODE       PIC 9(04) VALUE ZEROES.      01260000
012700     05  PE-MQ-REASON-CODE           PIC 9(04) VALUE ZEROES.      01270000
012800                                                                  01280000
012900******************************************************************01290000
013000*  DB2 FORMATTED MESSAGE AREA                                     01300000
013100******************************************************************01310000
013200     COPY DPWS004.                                                01320000
013300                                                                  01330000
013310******************************************************************01331000
013320*  INPUT FILE                                                     01332000
013330******************************************************************01333000
013340     COPY GVRD000.                                                01334007
013350                                                                  01335000
013400******************************************************************01340000
013500*  COMMUNICATIONS AREA FOR DB2                                    01350000
013600******************************************************************01360000
013700     EXEC SQL                                                     01370000
013800          INCLUDE SQLCA                                           01380000
013900     END-EXEC.                                                    01390000
014000                                                                  01400000
014100******************************************************************01410000
014200*  DB2 DECLARATION - LOGISTICS                                    01420000
014300*      TABLE XLT00003-SKU-NBR                                     01430000
014400******************************************************************01440000
014500     EXEC SQL                                                     01450000
014600         INCLUDE XLT00003                                         01460000
014700     END-EXEC.                                                    01470000
014800                                                                  01480000
014900******************************************************************01490000
015000*  DB2 DECLARATION - LOGISTICS                                    01500000
015100*      TABLE SEASONAL SET CODES                                   01510000
015200******************************************************************01520000
015300     EXEC SQL                                                     01530000
015400         INCLUDE TSEASET                                          01540000
015500     END-EXEC.                                                    01550000
015600                                                                  01560000
017540******************************************************************01754000
017541*  DB2 DECLARATION - WMOS - Provider Queue information (Put/Write)01754100
017542*      TABLE (WSV_PRVDR_QUE)                                      01754200
017543******************************************************************01754300
017544     EXEC SQL                                                     01754400
017545         INCLUDE WSV00005                                         01754500
017546     END-EXEC.                                                    01754600
017547                                                                  01754700
017548******************************************************************01754800
017549* COBOL CURSOR DELCARATION TO READ MQ INFORMATION                *01754900
017550******************************************************************01755000
017560     EXEC SQL                                                     01756000
017570        DECLARE MQ-CSR CURSOR WITH HOLD FOR                       01757000
017580        SELECT A.INTGRTN_TYP_DESC                                 01758000
017590             , A.LCL_QUE_MGR                                      01759000
017600             , A.RMT_QUE_MGR                                      01760000
017700             , A.QUE_NM                                           01770000
017800          FROM WSV_PRVDR_QUE A                                    01780000
017900         WHERE A.APPL_FUNC_DESC    = 'QUEUE'                      01790027
018000           AND A.INTGRTN_TYP_CDE   = 'GIVRDCADJS'                 01800027
018100     END-EXEC.                                                    01810000
018200                                                                  01820000
018300****************************************************************  01830000
018400**                                                            **  01840000
018500**     M Q   S E R I E S    W O R K I N G   S T O R A G E     **  01850000
018600**                                                            **  01860000
018700**                  M  Q    C O P Y B O O K S                 **  01870000
018800**                                                            **  01880000
018900****************************************************************  01890000
019000 01  MQM-OBJECT-DESCRIPTOR.                                       01900000
019100     COPY CMQODV.                                                 01910000
019200                                                                  01920000
019300 01  MQM-MESSAGE-DESCRIPTOR.                                      01930000
019400     COPY CMQMDV.                                                 01940000
019500                                                                  01950000
019600 01  MQM-PUT-MESSAGE-OPTIONS.                                     01960000
019700     COPY CMQPMOV.                                                01970000
019800                                                                  01980000
019900 01  MQM-GET-MESSAGE-OPTIONS.                                     01990000
020000     COPY CMQGMOV.                                                02000000
020100                                                                  02010000
020200 01  MQM-CONSTANTS.                                               02020000
020300     COPY CMQV.                                                   02030000
020400                                                                  02040000
020500****************************************************************  02050000
020600** CONTROL CARDS FOR QUEUE MANAGER AND QUEUE NAME                 02060000
020700****************************************************************  02070000
020800 01  CC-CONTROL-CARD-1.                                           02080000
020900     05  CC-QMGR-NAME-REMOTE         PIC X(50).                   02090000
021000                                                                  02100000
021100 01  CC-CONTROL-CARD-2.                                           02110000
021200     05  CC-TRANS-QUEUE-NAME         PIC X(50).                   02120000
021300                                                                  02130000
021700 01  CC-CONTROL-CARD-4.                                           02170000
021800     05  CC-QMGR-NAME                PIC X(50).                   02180000
021900                                                                  02190000
022000****************************************************************  02200000
022100** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS GET AND    **  02210000
022200*  OPEN, CONNECT, DISCONNECT.                                     02220000
022300****************************************************************  02230000
022400 01  MQ-WORKING-STORAGE.                                          02240000
022500     05  PC-MQCONN                   PIC X(08) VALUE 'CSQBCONN'.  02250000
022600     05  PC-MQOPEN                   PIC X(08) VALUE 'CSQBOPEN'.  02260000
022700     05  PC-MQINQ                    PIC X(08) VALUE 'CSQBINQ'.   02270000
022800     05  PC-MQPUT                    PIC X(08) VALUE 'CSQBPUT'.   02280000
022900     05  PC-MQGET                    PIC X(08) VALUE 'CSQBGET'.   02290000
023000     05  PC-MQCMIT                   PIC X(08) VALUE 'CSQBCOMM'.  02300000
023100     05  PC-MQBACK                   PIC X(08) VALUE 'CSQBBACK'.  02310000
023200     05  PC-MQCLOSE                  PIC X(08) VALUE 'CSQBCLOS'.  02320000
023300     05  PC-MQDISC                   PIC X(08) VALUE 'CSQBDISC'.  02330000
023400     05  PC-TRANS-QNAME              PIC X(48) VALUE SPACES.      02340000
023500     05  PC-QMGR-NAME                PIC X(04) VALUE SPACES.      02350000
023600         88  PC-PROD-QMGR-NAME                 VALUE 'QKSP'.      02360000
023700         88  PC-ACCEPT-QMGR-NAME               VALUE 'QKSQ'.      02370000
023800         88  PC-TEST-QMGR-NAME                 VALUE 'QKST'.      02380000
023900                                                                  02390000
024000****************************************************************  02400000
024100** QUEUE MANAGER HANDLE                                           02410000
024200*  QUEUE HANDLE                                                   02420000
024300****************************************************************  02430000
024400 01 PV-MQ-PROGRAM-HANDLES.                                        02440000
024500     05  PV-QM-NAME                  PIC X(48).                   02450000
024600     05  PV-QM-NAME-REMOTE           PIC X(48).                   02460000
024700     05  PV-HCONN                    PIC S9(9) BINARY VALUE 0.    02470000
024800     05  PV-PQ-HANDLE                PIC S9(9) BINARY VALUE 0.    02480000
024900                                                                  02490000
025000****************************************************************  02500000
025100* ERROR PROCESSING VARIABLES                                      02510000
025200* CODES FROM CALLS ARE STORED HERE                                02520000
025300****************************************************************  02530000
025400 01 PV-MQ-PROGRAM-VARIABLES.                                      02540000
025500     05  PV-COMPLETION-CODE          PIC S9(9) BINARY.            02550000
025600     05  PV-REASON                   PIC S9(9) BINARY.            02560000
025700     05  PV-CON-REASON               PIC S9(9) BINARY.            02570000
025800     05  PV-MQCHECK                  PIC X(08) VALUE 'MQR2C'.     02580000
025900     05  PV-ERROR-MESSAGE            PIC X(48) VALUE SPACES.      02590000
026000     05  PV-OPEN-OPTIONS             PIC S9(9) BINARY.            02600000
026100     05  PV-MQ-REASON-TEXT           PIC X(30) VALUE SPACES.      02610000
026300     05  PV-CURRENT-TMST             PIC X(26).                   02630000
026310     05  PV-CURRENT-TMST-DATE-HHMM   REDEFINES                    02631000
026320         PV-CURRENT-TMST.                                         02632000
026340         10  PV-CURRENT-CCYY         PIC X(04).                   02633100
026340         10  FILLER                  PIC X(01).                   02633200
026340         10  PV-CURRENT-MM           PIC X(02).                   02633300
026340         10  FILLER                  PIC X(01).                   02633400
026340         10  PV-CURRENT-DD           PIC X(02).                   02633600
026340         10  FILLER                  PIC X(16).                   02634000
026400     05  PV-REF1.                                                 02640000
026330         10  PV-REF1-RDC             PIC X(04) VALUE 'RDC_'.      02640100
026340         10  PV-REF1-CCYY            PIC X(04).                   02640200
026340         10  PV-REF1-MM              PIC X(02).                   02640300
026340         10  PV-REF1-DD              PIC X(02).                   02640400
026400     05  PV-RETRY-COUNTER            PIC S9(4) VALUE +0 COMP SYNC.02641000
026500     05  PV-PARAGRAPH                PIC X(48) VALUE SPACES.      02650000
026600     05  PV-MSG-LENGTH               PIC S9(9) BINARY.            02660000
026700     05  PV-DC-NBR                   PIC 9(04).                   02670000
026800     05  PV-MSG-LENGTH-DISPLAY       PIC S9(9).                   02680000
026900     05  PV-MSGBUFFER.                                            02690000
027000         10  PV-MSGBUFFER-banner     PIC X(39) VALUE SPACES.      02700000
027100         10  PV-MSGBUFFER-data       PIC X(999999) VALUE SPACES.  02710000
027200                                                                  02720000
027300 01  PC-PROGRAM-CONSTANTS.                                        02730000
027400     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'GVKUT002'.  02740004
027500     05  PC-MAX-RETRIES              PIC S9(3) VALUE +5 COMP-3.   02750000
027600     05  PC-READY                    PIC X(06) VALUE 'READY '.    02760000
027700     05  PC-ERROR                    PIC X(06) VALUE 'ERROR '.    02770000
027800     05  PC-WAIT-15-SECS             PIC S9(9) VALUE 1500.        02780000
027900     05  PC-MQPUT-RETRY-COUNTER      PIC 9(3)  VALUE ZERO.        02790000
028000     05  PC-DELAY-INTERVAL.                                       02800000
028100         10  FILLER                  PIC X(2)  VALUE SPACES.      02810000
028200         10  PC-DELAY-TIME           PIC 9(8)  VALUE 3000.        02820000
028300****************************************************************  02830000
028400* RETURN CODES ARE EVALUATED AND THIS SWITCH IS USED TO           02840000
028500* INDICATE ANY ERRORS (FROM WHAT I'VE SEEN THIS SWITCH IS         02850000
028600* USELESS SINCE THE PROGRAM ABENDS BEFORE IT IS USED ANYWHERE) *  02860000
028700****************************************************************  02870000
028800 01 PV-MQ-PROGRAM-SWITCHES.                                       02880000
028900     05  PS-MQ-ERROR-SW              PIC X(01) VALUE 'N'.         02890000
029000         88  PS-NO-MQ-ERROR                    VALUE 'N'.         02900000
029100         88  PS-MQ-ERROR                       VALUE 'Y'.         02910000
029200 01  PV-MQ-INFO-FOR-DIFF-DCS.                                     02920000
029300     05  MQ-INFO OCCURS 1 TO 20 TIMES                             02930000
029400                      DEPENDING ON PV-MQ-CNT.                     02940000
029500        10 MQ-INTGRTN-TYP-DESC        PIC X(50).                  02950000
029600        10 MQ-QMGR-NAME               PIC X(50).                  02960000
029700        10 MQ-QMGR-NAME-REMOTE        PIC X(50).                  02970000
029800        10 MQ-TRANS-QUEUE-NAME        PIC X(50).                  02980000
030000 01  PV-MQ-HANDLE-FOR-DIFF-DCS.                                   03000000
030100     05  PV-MQ-HANDLE-INFO OCCURS 1 TO 20 TIMES                   03010000
030200                      DEPENDING ON PV-MQ-HANDLE-CNT.              03020000
030300        10 PV-MQ-HANDLE-HOLD  PIC S9(9) BINARY VALUE 0.           03030000
030400                                                                  03040000
030500****************************************************************  03050000
030600**                     E N D   O F   M Q                      **  03060000
030700****************************************************************  03070000
030800*                                                                 03080000
031800 PROCEDURE DIVISION.                                              03180000
031900*                                                                 03190000
032000 0000-MAINLINE.                                                   03200000
032100     DISPLAY '************ START OF GVKUT002 ***************'     03210004
032300                                                                  03230000
032400     PERFORM 1000-INITIALIZE.                                     03240000
032500                                                                  03250000
032600     MOVE ZEROES TO PV-COUNTER                                    03260000
032710                    PV-EXPECTS-SENT-TO-QUE                        03271000
032800                    PV-MQ-CNT.                                    03280000
032900                                                                  03290000
033000     SET PS-END-OF-EXPECTED-REC-N                                 03300000
033100         PS-END-OF-MQ-CSR-N TO TRUE.                              03310000
033110                                                                  03311000
033111     READ STR-EXPECTED-FILE INTO GV000-PCT-INTRANSIT-REC          03311107
033112          AT END SET PS-END-OF-EXPECTED-REC-Y TO TRUE.            03311200
033200                                                                  03320000
033300     PERFORM 2000-PROCESS-EXPECTED-RECORDS                        03330000
033400       UNTIL PS-END-OF-EXPECTED-REC-Y.                            03340000
033500                                                                  03350000
033800*CLOSE THE MULTIPLE OPEN QUEUES.                                  03380000
033900     PERFORM 1500-MQ-QUEUE-CLOSE.                                 03390000
034000                                                                  03400000
034100*DISCONNECT FROM THE QMGR.                                        03410000
034200     PERFORM 1600-DISCONNECT-QMGR.                                03420000
034300                                                                  03430000
034400* END OF JOB ROUTINE.                                             03440000
034500     PERFORM 9000-EOJ-ROUTINE.                                    03450000
034600                                                                  03460000
034700     DISPLAY '************  END OF GVKUT002  ***************'     03470004
034800     STOP RUN.                                                    03480000
034900                                                                  03490000
035000******************************************************************03500000
035100*                                                                *03510000
035200*           1 0 0 0 - I N I T I A L I Z A T I O N                *03520000
035300*                                                                *03530000
035400******************************************************************03540000
035500 1000-INITIALIZE.                                                 03550000
035600                                                                  03560000
035700*GET CURRENT TIMESTAMP.                                           03570000
035800     PERFORM 1100-SET-CURRENT-TMST.                               03580000
035900                                                                  03590000
036000*READ MQ CONTROL CARDS.                                           03600000
036001                                                                  03600100
036100     PERFORM 1200-GET-MQ-QUEUE-INFO.                              03610000
036160     MOVE WSV00005-INTGRTN-TYP-DESC                               03616000
036170            TO MQ-INTGRTN-TYP-DESC(PV-MQ-CNT).                    03617000
036180     MOVE CC-QMGR-NAME                                            03618000
036190            TO MQ-QMGR-NAME(PV-MQ-CNT).                           03619000
036191     MOVE CC-QMGR-NAME-REMOTE                                     03619100
036192            TO MQ-QMGR-NAME-REMOTE(PV-MQ-CNT).                    03619200
036193     MOVE CC-TRANS-QUEUE-NAME                                     03619300
036194            TO MQ-TRANS-QUEUE-NAME(PV-MQ-CNT).                    03619400
036200                                                                  03620000
036300*CONNECT TO QUEUE MANAGER ONLY ONCE.                              03630000
036400                                                                  03640000
036500     PERFORM 1300-MQ-CONNECT-TO-QMGR.                             03650000
036600                                                                  03660000
036700*OPEN THE MULTIPLE QUEUES FOR PUTS                                03670000
036800                                                                  03680000
036900     PERFORM 1400-MQ-QUEUE-OPEN.                                  03690000
037000                                                                  03700000
037400     OPEN  INPUT STR-EXPECTED-FILE.                               03740000
037700                                                                  03770000
037800******************************************************************03780000
037900* SET THE CURRENT TIMESTAMP.                                      03790000
038000******************************************************************03800000
038100 1100-SET-CURRENT-TMST.                                           03810000
038200                                                                  03820000
038300     EXEC SQL                                                     03830000
038400         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 03840000
038500     END-EXEC                                                     03850000
038600                                                                  03860000
038700     EVALUATE TRUE                                                03870000
038800       WHEN SQLCODE = ZERO                                        03880000
038900           CONTINUE                                               03890000
039000                                                                  03900000
039100       WHEN SQLWARN0 NOT EQUAL SPACE                              03910000
039200       WHEN SQLCODE NOT EQUAL ZERO                                03920000
039300           MOVE '1100-CURRENT-TMST' TO PV-ABEND-PARAGRAPH         03930000
039400           MOVE 'SET CURR TMST'     TO PV-ABEND-OPERATION         03940000
039500           PERFORM 9900-DB2-ABEND                                 03950000
039600     END-EVALUATE.                                                03960000
039700                                                                  03970000
039800****************************************************************  03980000
039900* GET MQ INFORMATION FROM DB2 TABLES.                             03990000
040000****************************************************************  04000000
040100 1200-GET-MQ-QUEUE-INFO.                                          04010000
040200                                                                  04020000
040300     PERFORM 1210-OPEN-MQ-CSR.                                    04030000
040400                                                                  04040000
040500     PERFORM 1220-FETCH-MQ-CURSOR UNTIL                           04050000
040600           PS-END-OF-MQ-CSR-Y.                                    04060000
040700                                                                  04070000
040800     PERFORM 1225-CLOSE-MQ-CURSOR.                                04080000
040900                                                                  04090000
041000****************************************************************  04100000
041100* OPEN MQ CURSOR.                                                 04110000
041200****************************************************************  04120000
041300 1210-OPEN-MQ-CSR.                                                04130000
041400                                                                  04140000
041500     EXEC SQL                                                     04150000
041600         OPEN MQ-CSR                                              04160000
041700     END-EXEC.                                                    04170000
041800                                                                  04180000
041900     EVALUATE TRUE                                                04190000
042000       WHEN SQLCODE = ZERO                                        04200000
042100           SET PS-END-OF-MQ-CSR-N TO TRUE                         04210000
042200                                                                  04220000
042300       WHEN OTHER                                                 04230000
042400           MOVE '1210-OPEN-MQ-CURSOR' TO PV-ABEND-PARAGRAPH       04240000
042500           MOVE 'OPEN MQ-CSR'         TO PV-ABEND-OPERATION       04250000
042600           PERFORM 9900-DB2-ABEND                                 04260000
042700     END-EVALUATE.                                                04270000
042800                                                                  04280000
042900****************************************************************  04290000
043000* FETCH MQ INFORMATION FOR PUTS.                                  04300000
043100****************************************************************  04310000
043200 1220-FETCH-MQ-CURSOR.                                            04320000
043400                                                                  04340000
043500     EXEC SQL                                                     04350000
043600         FETCH MQ-CSR                                             04360000
043700          INTO                                                    04370000
043800              :WSV00005-INTGRTN-TYP-DESC                          04380000
043900             ,:CC-QMGR-NAME                                       04390000
044000             ,:CC-QMGR-NAME-REMOTE                                04400000
044100             ,:CC-TRANS-QUEUE-NAME                                04410000
044200     END-EXEC.                                                    04420000
044300                                                                  04430000
044400     EVALUATE TRUE                                                04440000
044500       WHEN SQLCODE = ZERO                                        04450000
044600                                                                  04460000
044700           DISPLAY 'QMGR-NAME-REMOTE:' CC-QMGR-NAME-REMOTE        04470000
044800           DISPLAY 'TRANS-QUEUE-NAME:' CC-TRANS-QUEUE-NAME        04480000
044900                                                                  04490000
045000           ADD 1 TO PV-MQ-CNT                                     04500000
045100                                                                  04510000
045200                                                                  04520000
045300           MOVE WSV00005-INTGRTN-TYP-DESC                         04530000
045400                  TO MQ-INTGRTN-TYP-DESC(PV-MQ-CNT)               04540000
045500           MOVE CC-QMGR-NAME                                      04550000
045600                  TO MQ-QMGR-NAME(PV-MQ-CNT)                      04560000
045700           MOVE CC-QMGR-NAME-REMOTE                               04570000
045800                  TO MQ-QMGR-NAME-REMOTE(PV-MQ-CNT)               04580000
045900           MOVE CC-TRANS-QUEUE-NAME                               04590000
046000                  TO MQ-TRANS-QUEUE-NAME(PV-MQ-CNT)               04600000
046300                                                                  04630000
046400       WHEN SQLCODE = +100                                        04640000
046500           SET PS-END-OF-MQ-CSR-Y TO TRUE                         04650000
046600                                                                  04660000
046700       WHEN OTHER                                                 04670000
046800           MOVE '1020-FETCH-MQ-CURSOR' TO PV-ABEND-PARAGRAPH      04680000
046900           MOVE 'FETCH MQ-CSR'         TO PV-ABEND-OPERATION      04690000
047000           PERFORM 9900-DB2-ABEND                                 04700000
047100     END-EVALUATE.                                                04710000
047200                                                                  04720000
047300******************************************************************04730000
047400 1225-CLOSE-MQ-CURSOR.                                            04740000
047500                                                                  04750000
047600     EXEC SQL                                                     04760000
047700         CLOSE MQ-CSR                                             04770000
047800     END-EXEC.                                                    04780000
047900                                                                  04790000
048000     EVALUATE TRUE                                                04800000
048100       WHEN SQLCODE = ZERO                                        04810000
048200       DISPLAY ' TOTAL MQ PUTS:' PV-MQ-CNT                        04820000
048300           CONTINUE                                               04830000
048400                                                                  04840000
048500       WHEN OTHER                                                 04850000
048600           MOVE '1225-CLOSE-MQ-CURSOR' TO PV-ABEND-PARAGRAPH      04860000
048700           MOVE 'CLOSE MQ-CSR'         TO PV-ABEND-OPERATION      04870000
048800           PERFORM 9900-DB2-ABEND                                 04880000
048900     END-EVALUATE.                                                04890000
049000                                                                  04900000
049100****************************************************************  04910000
049200** CONNECT TO THE MULTIPLE QUEUE MANAGERS.                        04920000
049300** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                 04930000
049400****************************************************************  04940000
049500 1300-MQ-CONNECT-TO-QMGR.                                         04950000
049700                                                                  04970000
049800     MOVE '1300-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.              04980000
049900     MOVE 1 TO PV-MQ-TBL-CNT.                                     04990000
050100                                                                  05010000
050200     MOVE MQ-QMGR-NAME(PV-MQ-TBL-CNT) TO PV-QM-NAME.              05020000
050300                                                                  05030000
050400     CALL PC-MQCONN USING PV-QM-NAME                              05040028
050500                          PV-HCONN                                05050028
050600                          PV-COMPLETION-CODE                      05060028
050700                          PV-REASON.                              05070028
050800                                                                  05080000
051200     MOVE PV-REASON TO PV-CON-REASON.                             05120000
051300     IF PV-COMPLETION-CODE = MQCC-OK                              05130000
051400        ADD 1 TO PV-MQ-TBL-CNT                                    05140000
051500        DISPLAY 'CONNECTED TO QM -' MQ-QMGR-NAME(PV-MQ-TBL-CNT)   05150000
051600         CONTINUE                                                 05160000
051700     ELSE                                                         05170000
051800         CALL PV-MQCHECK USING PV-REASON                          05180000
051900                               PV-MQ-REASON-TEXT                  05190000
052000         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              05200000
052100         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       05210000
052200         MOVE PV-REASON            TO PE-MQ-REASON-CODE           05220000
052300         MOVE '1300-MQ-CONNECT-TO-QMGR'                           05230000
052400                                   TO PV-ERROR-MESSAGE            05240000
052500         PERFORM 9200-MQ-ABEND                                    05250000
052600     END-IF.                                                      05260000
052700                                                                  05270000
052800****************************************************************  05280000
052900** OPEN MULTIPLE QUEUES FOR 'PUT'                                 05290000
053000****************************************************************  05300000
053100 1400-MQ-QUEUE-OPEN.                                              05310000
053200                                                                  05320000
053300     MOVE 1 TO PV-MQ-TBL-CNT.                                     05330000
053400     PERFORM 1410-MULTI-MQ-OPEN PV-MQ-CNT TIMES.                  05340000
053500                                                                  05350000
053600****************************************************************  05360000
053700** OPEN MULTIPLE QUEUES FOR 'PUT'                                 05370000
053800****************************************************************  05380000
053900 1410-MULTI-MQ-OPEN.                                              05390000
054000                                                                  05400000
054100     MOVE '1410-MUTI-MQ-OPEN' TO PV-PARAGRAPH.                    05410000
054200                                                                  05420000
054300* CONTROL CARD 2 - QUEUE NAME                                     05430000
054400     MOVE MQ-TRANS-QUEUE-NAME(PV-MQ-TBL-CNT)  TO PC-TRANS-QNAME.  05440000
054500     COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT                        05450000
054600                             + MQOO-SET-IDENTITY-CONTEXT          05460000
054700                             + MQOO-FAIL-IF-QUIESCING.            05470000
054800     MOVE PC-TRANS-QNAME       TO MQOD-OBJECTNAME.                05480000
054900                                                                  05490000
055000     DISPLAY 'PC-TRANS-QNAME:' PC-TRANS-QNAME                     05500000
055100     DISPLAY 'MQOD-OBJECTNAME:' MQOD-OBJECTNAME                   05510000
055200                                                                  05520000
055300* CONTROL CARD 3 - REMOTE QMGR NAME                               05530000
055400     MOVE MQ-QMGR-NAME-REMOTE(PV-MQ-TBL-CNT)                      05540000
055500                          TO MQOD-OBJECTQMGRNAME.                 05550000
055600                                                                  05560000
055700******************************************************************05570000
055800*REPLACE REMOTE QMGR NAME WITH LOCAL QMGR NAME TO WRITE TO LOCAL Q05580000
055900******************************************************************05590000
056300                                                                  05631015
056400     DISPLAY 'MQOD-OBJECTQMGRNAME:' MQOD-OBJECTQMGRNAME           05640000
056500     DISPLAY 'MQOD-OBJECTNAME    :' MQOD-OBJECTNAME               05650000
056600     DISPLAY 'PV-HCONN:' PV-HCONN                                 05660000
056700     DISPLAY 'MQM-OBJECT-DESCRIPTOR:' MQM-OBJECT-DESCRIPTOR       05670000
056800     DISPLAY 'PV-OPEN-OPTIONS:' PV-OPEN-OPTIONS                   05680000
056900     DISPLAY 'PV-PQ-HANDLE:' PV-PQ-HANDLE                         05690000
057000                                                                  05700000
057100     CALL PC-MQOPEN USING PV-HCONN                                05710028
057200                          MQM-OBJECT-DESCRIPTOR                   05720028
057300                          PV-OPEN-OPTIONS                         05730028
057400                          PV-PQ-HANDLE                            05740028
057500                          PV-COMPLETION-CODE                      05750028
057600                          PV-REASON.                              05760028
057700                                                                  05770000
057800     IF PV-COMPLETION-CODE = MQCC-OK THEN                         05780000
057900         ADD 1 TO PV-MQ-TBL-CNT                                   05790000
058000                  PV-MQ-HANDLE-CNT                                05800000
058100         MOVE  PV-PQ-HANDLE TO PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)05810000
058200         DISPLAY 'OPEN COMPLETE'                                  05820000
058300         CONTINUE                                                 05830000
058400     ELSE                                                         05840000
058500         CALL PV-MQCHECK USING PV-REASON                          05850028
058600                               PV-MQ-REASON-TEXT                  05860028
058700         MOVE PV-QM-NAME-REMOTE    TO PE-MQ-QMANAGER-REMOTE       05870000
058800         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 05880000
058900         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       05890000
059000         MOVE PV-REASON            TO PE-MQ-REASON-CODE           05900000
059100         MOVE '1410-MULTI-MQ-OPEN' TO PV-ERROR-MESSAGE            05910000
059200         PERFORM 9200-MQ-ABEND                                    05920000
059300     END-IF.                                                      05930000
059400                                                                  05940000
059500****************************************************************  05950000
059600** CLOSES THE MQ QUEUE.                                           05960000
059700****************************************************************  05970000
059800 1500-MQ-QUEUE-CLOSE.                                             05980000
059900                                                                  05990000
060000     MOVE 1 TO PV-MQ-HANDLE-CNT.                                  06000000
060100     PERFORM 1510-MQ-MULTI-QUEUE-CLOSE PV-MQ-CNT TIMES.           06010000
060200                                                                  06020000
060300 1510-MQ-MULTI-QUEUE-CLOSE.                                       06030000
060400                                                                  06040000
060500     MOVE '1510-MQ-MULTI-QUEUE-CLOSE' TO PV-PARAGRAPH.            06050000
060600                                                                  06060000
060700     CALL PC-MQCLOSE USING PV-HCONN                               06070028
060800                           PV-MQ-HANDLE-HOLD(PV-MQ-HANDLE-CNT)    06080028
060900                           MQCO-NONE                              06090028
061000                           PV-COMPLETION-CODE                     06100028
061100                           PV-REASON.                             06110028
061200                                                                  06120000
061300     IF PV-COMPLETION-CODE = MQCC-OK                              06130000
061400         CONTINUE                                                 06140000
061500     ELSE                                                         06150000
061600         CALL PV-MQCHECK USING PV-REASON                          06160028
061700                               PV-MQ-REASON-TEXT                  06170028
061800         MOVE PV-QM-NAME           TO PE-MQ-QMANAGER              06180000
061900         MOVE PC-TRANS-QNAME       TO PE-MQ-QNAME                 06190000
062000         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       06200000
062100         MOVE PV-REASON            TO PE-MQ-REASON-CODE           06210000
062200         MOVE 'PE-MQ-CLOSE'        TO PV-ERROR-MESSAGE            06220000
062300         PERFORM 9200-MQ-ABEND                                    06230000
062400     END-IF.                                                      06240000
062500                                                                  06250000
062600****************************************************************  06260000
062700** DISCONNECT FROM THE QUEUE MANAGER                              06270000
062800****************************************************************  06280000
062900 1600-DISCONNECT-QMGR.                                            06290000
063000     MOVE '1600-DISCONNECT-QMGR' TO PV-PARAGRAPH.                 06300000
063100                                                                  06310000
063200     CALL PC-MQDISC USING PV-HCONN                                06320028
063300                          PV-COMPLETION-CODE                      06330028
063400                          PV-REASON                               06340028
063500                                                                  06350000
063600     IF PV-COMPLETION-CODE = MQCC-OK                              06360000
063700        CONTINUE                                                  06370000
063800     ELSE                                                         06380000
063900        CALL PV-MQCHECK USING PV-REASON                           06390028
064000                              PV-MQ-REASON-TEXT                   06400028
064100        MOVE PV-QM-NAME             TO PE-MQ-QMANAGER             06410000
064200        MOVE PC-TRANS-QNAME         TO PE-MQ-QNAME                06420000
064300        MOVE PV-COMPLETION-CODE     TO PE-MQ-COMPLETION-CODE      06430000
064400        MOVE PV-REASON              TO PE-MQ-REASON-CODE          06440000
064500        MOVE '1600-DISCONNECT-QMGR' TO PV-ERROR-MESSAGE           06450000
064600        PERFORM 9200-MQ-ABEND                                     06460000
064700     END-IF.                                                      06470000
064800                                                                  06480000
064900******************************************************************06490000
065000*                                                                *06500000
065100*         2 0 0 0 - PROCESS RDC INVENTORY ADJUSTMENTS            *06510000
065200*                                                                *06520000
065300******************************************************************06530000
065400                                                                  06540000
065500 2000-PROCESS-EXPECTED-RECORDS.                                   06550000
065600                                                                  06560000
065700     PERFORM 2020-FORMAT-OUTPUT.                                  06570000
065800                                                                  06580000
065900     READ STR-EXPECTED-FILE INTO GV000-PCT-INTRANSIT-REC          06590007
066000          AT END SET PS-END-OF-EXPECTED-REC-Y TO TRUE.            06600000
066100     ADD +1 TO PV-COUNTER.                                        06610000
066120                                                                  06612000
066200******************************************************************06620000
066300* Build MQ output                                                 06630000
066400******************************************************************06640000
066500 2020-FORMAT-OUTPUT.                                              06650000
066600                                                                  06660000
           MOVE 'ADJUSTMENT'            TO AdjustmentType.              06670026
           MOVE 'TRACK'                 TO Availability.                06680023
                                                                        06690011
067000     PERFORM 3000-SELECT-XLT-SKU.                                 06700000
067001     MOVE XLT00003-SKU-NBR        TO ItemID.                      06700100
067002                                                                  06700200
           MOVE 'DEFAULT'               TO OrganizationCode.            06700311
           MOVE 'Good'                  TO ProductClass.                06700411
067019     MOVE GV000-IN-TRNST-QTY      TO Quantity.                    06700511
067023     MOVE 'RECEIPT'               TO ReasonCode.                  06700611
067023     MOVE 'RDC Receipt'           TO ReasonText.                  06700711
067011     MOVE ZEROS                   TO PV-STR-NBR-4.                06700811
067011     ADD  GV000-STR-NBR           TO PV-STR-NBR-4.                06700911
067011     MOVE PV-STR-NBR              TO ShipNode.                    06701011
           MOVE 'EF_ONHAND.ex'          TO SupplyType.                  06701111
067022     MOVE 'EACH'                  TO UnitOfMeasure.               06701211
                                                                        06701311
067024     MOVE  PV-CURRENT-CCYY        TO PV-REF1-CCYY.                06702500
067024     MOVE  PV-CURRENT-MM          TO PV-REF1-MM.                  06702600
067024     MOVE  PV-CURRENT-DD          TO PV-REF1-DD.                  06702700
067024     MOVE  PV-REF1                TO Reference1.                  06702800
076900                                                                  07690000
077200     PERFORM 4000-CREATE-MSGS.                                    07720000
077350                                                                  07735000
077400****************************************************************  07740000
077500* SELECT NEEDED INFO FROM XLT_SKU BT INTR_UPC_ID                  07750000
077600****************************************************************  07760000
077700 3000-SELECT-XLT-SKU.                                             07770000
077800                                                                  07780000
078200     EXEC SQL                                                     07820000
078300         SELECT SKU_NBR                                           07830000
079100           INTO :XLT00003-SKU-NBR                                 07910000
079900           FROM XLT_SKU                                           07990000
080000          WHERE INTR_UPC_ID    = :GV000-INTR-UPC-ID               08000007
080100     END-EXEC.                                                    08010000
080200                                                                  08020000
080300     EVALUATE TRUE                                                08030000
080400       WHEN SQLCODE = ZERO                                        08040000
080500           CONTINUE                                               08050000
080600       WHEN SQLCODE = +100                                        08060000
080700           MOVE ZEROS  TO XLT00003-SKU-NBR                        08070000
081500       WHEN OTHER                                                 08150000
081600           MOVE '3000-SELECT-XLT-SKU' TO PV-ABEND-PARAGRAPH       08160000
081700           MOVE 'SELECT             '  TO PV-ABEND-OPERATION      08170000
081800           DISPLAY '3000-SELECT-XLT-SKU SQLCODE='                 08180000
081900                   SQLCODE ' FOR INTR_UPC_ID '                    08190000
082000                   GV000-INTR-UPC-ID                              08200007
082100           PERFORM 9900-DB2-ABEND                                 08210000
082200     END-EVALUATE.                                                08220000
082300                                                                  08230000
082400****************************************************************  08240000
082500* CREATE XML FOR RDC AND OUTPUT TO MQ                             08250000
082600****************************************************************  08260000
094233 4000-CREATE-MSGS.                                                09423300
094234                                                                  09423400
094235     PERFORM 4100-GENERATE-XML.                                   09423500
094236     ADD +1 TO PV-EXPECTS-SENT-TO-QUE.                            09423600
094237                                                                  09423700
094238     MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.      09423800
094239     MOVE PV-XML(1:XML-LENGTH)       TO PV-MSGBUFFER-data.        09423900
094240     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           09424000
094241                           + LENGTH OF PV-XML-BANNER.             09424100
094242     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 09424200
094250*    DISPLAY 'MQ MSG-LENGTH = ' PV-MSG-LENGTH-DISPLAY.            09425000
094260     INITIALIZE PS-MQPUT-SUCCESSFUL-IND                           09426000
094270                PC-MQPUT-RETRY-COUNTER.                           09427000
094280     PERFORM 5000-MQ-PUT-TO-QUEUE                                 09428018
094290       UNTIL PS-MQPUT-SUCCESSFUL.                                 09429018
094300                                                                  09430000
094310     IF PV-EXPECTS-SENT-TO-QUE = 5000                             09431000
094400         PERFORM 5100-MQ-COMMIT                                   09440000
094410         MOVE ZEROS TO PV-EXPECTS-SENT-TO-QUE                     09441000
094420     END-IF.                                                      09442000
094500                                                                  09450000
094600***************************************************************   09460000
094700 4100-GENERATE-XML.                                               09470000
094800                                                                  09480000
094900     MOVE SPACES TO PV-XML.                                       09490000
095100     XML GENERATE PV-XML                                          09510000
095200         FROM Items                                               09520020
095320         COUNT IN XML-LENGTH                                      09532000
095330         WITH ATTRIBUTES                                          09533000
095400         ON EXCEPTION                                             09540000
095410             DISPLAY Items ' PV=' PV-XML                          09541020
095500             PERFORM 4110-XML-ERROR                               09550000
095600         NOT ON EXCEPTION                                         09560000
095700             PERFORM 4200-REPLACE-XML                             09570000
095900     END-XML.                                                     09590000
096000                                                                  09600000
096100***************************************************************   09610000
096200 4110-XML-ERROR.                                                  09620000
096300                                                                  09630000
096400     PERFORM 9000-EXPLAIN-XML-RESPONSE                            09640000
096500     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    09650000
096600                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           09660000
096700         DISPLAY XML-MSG(XML-LINE-IDX)                            09670000
096800     END-PERFORM.                                                 09680000
096900     MOVE +4018         TO ABEND-CODE.                            09690000
097000     CALL 'ILBOABN0' USING ABEND-CODE.                            09700000
098700                                                                  09870000
098800     COPY ISPD007.                                                09880000
098900     COPY ISPD008.                                                09890000
099000     COPY ISPD009.                                                09900000
099100                                                                  09910000
099200******************************************************************09920000
099300 4200-REPLACE-XML.                                                09930000
099400                                                                  09940000
099500*  INSPECT ... REPLACING command to change the tag.               09950000
099600                                                                  09960000
099700     INSPECT PV-XML REPLACING ALL 'Mtrx Store 1'                  09970000
099701                               BY 'Mtrx_Store_1'.                 09970100
099710     INSPECT PV-XML REPLACING ALL 'Sourze'                        09971000
099720                               BY 'Source'.                       09972000
099800                                                                  09980000
100000******************************************************************10000000
100100*                                                                *10010000
100200*             5 0 0 0 - P U T   M Q   M E S S A G E              *10020000
100300*                                                                *10030000
100400******************************************************************10040000
100500 5000-MQ-PUT-TO-QUEUE.                                            10050000
100600                                                                  10060000
100700     MOVE ZEROES TO PV-CNT.                                       10070000
100800     PERFORM 5100-MQ-MULTI-PUTS PV-MQ-HANDLE-CNT TIMES.           10080000
100900                                                                  10090000
101000 5100-MQ-MULTI-PUTS.                                              10100000
101100                                                                  10110000
101200     ADD 1 TO PV-CNT.                                             10120000
101300     MOVE MQMI-NONE    TO MQMD-MSGID.                             10130000
101400     MOVE MQCI-NONE    TO MQMD-CORRELID.                          10140000
101500     MOVE MQFMT-STRING TO MQMD-FORMAT.                            10150000
101600                                                                  10160000
101700*    MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   10170000
101800     COMPUTE MQPMO-OPTIONS  = MQPMO-SYNCPOINT                     10180000
101900                            + MQPMO-SET-IDENTITY-CONTEXT.         10190000
102000     PERFORM 5010-LOW-VALUES.                                     10200000
102100                                                                  10210000
102200*        DISPLAY '5000 - PV-MQ-HANDLE-HOLD(PV-CNT):'              10220000
102300*                          PV-MQ-HANDLE-HOLD(PV-CNT)              10230000
102400     CALL PC-MQPUT USING PV-HCONN                                 10240028
102500                         PV-MQ-HANDLE-HOLD(PV-CNT)                10250028
102600                         MQM-MESSAGE-DESCRIPTOR                   10260028
102700                         MQM-PUT-MESSAGE-OPTIONS                  10270028
102800                         PV-MSG-LENGTH                            10280028
102900                         PV-MSGBUFFER                             10290028
103000                         PV-COMPLETION-CODE                       10300028
103100                         PV-REASON.                               10310028
103200                                                                  10320000
103300*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         10330000
103400     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        10340000
103500         IF (PV-REASON NOT = MQRC-PAGESET-FULL                    10350000
103600           AND PV-REASON NOT = MQRC-Q-FULL                        10360000
103700           AND PV-REASON NOT = MQRC-Q-SPACE-NOT-AVAILABLE )       10370000
103800             CALL PV-MQCHECK USING PV-REASON                      10380028
103900                                   PV-MQ-REASON-TEXT              10390028
104000             DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER                 10400000
104100             MOVE '5000-MQ-PUT-TO-QUEUE'  TO PV-PARAGRAPH         10410000
104200             MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE     10420000
104300             MOVE PV-COMPLETION-CODE  TO PV-HOLD-COMPLETION-CODE  10430000
104400                                         PE-MQ-COMPLETION-CODE    10440000
104500             MOVE PV-REASON               TO PV-HOLD-REASON       10450000
104600                                             PE-MQ-REASON-CODE    10460000
104700             PERFORM 5200-BACK-OUT-MQ                             10470000
104800             MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE   10480000
104900             MOVE PV-HOLD-REASON          TO PV-REASON            10490000
105000             PERFORM 9200-MQ-ABEND                                10500000
105100         ELSE                                                     10510000
105200             ADD 1 TO PC-MQPUT-RETRY-COUNTER                      10520000
105300             IF PC-MQPUT-RETRY-COUNTER >= 60                      10530000
105400                 DISPLAY 'MQ MESSAGE = ' PV-MSGBUFFER             10540000
105500                 MOVE '5000-MQ-PUT-TO-QUEUE' TO PV-PARAGRAPH      10550000
105600                 MOVE 'MQPUT ERROR- RETRY > 60 '                  10560000
105700                      TO PV-ERROR-MESSAGE                         10570000
105800                 MOVE PV-COMPLETION-CODE                          10580000
105900                      TO PV-HOLD-COMPLETION-CODE                  10590000
106000                 MOVE PV-REASON TO PV-HOLD-REASON                 10600000
106100                 PERFORM 5200-BACK-OUT-MQ                         10610000
106200                 MOVE PV-HOLD-COMPLETION-CODE                     10620000
106300                      TO PV-COMPLETION-CODE                       10630000
106400                 MOVE PV-HOLD-REASON TO PV-REASON                 10640000
106500                 PERFORM 9200-MQ-ABEND                            10650000
106600             ELSE                                                 10660000
106700*WAIT FOR 30 SECONDS AND TRY AGAIN                                10670000
106800                 CALL 'SYSWAIT' USING PC-DELAY-INTERVAL           10680000
106900             END-IF                                               10690000
107000         END-IF                                                   10700000
107100     ELSE                                                         10710000
107200         ADD 1 TO PA-TOTAL-MQ-MSGS-SENT                           10720000
107300         SET PS-MQPUT-SUCCESSFUL TO TRUE                          10730000
107400     END-IF.                                                      10740000
107500                                                                  10750000
107600******************************************************************10760000
107700 5010-LOW-VALUES.                                                 10770000
107800                                                                  10780000
107900     MOVE PV-MSGBUFFER TO PV-HOLD-MSGBUFFER.                      10790000
108000                                                                  10800000
109100     MOVE PV-HOLD-MSGBUFFER TO PV-MSGBUFFER.                      10910000
109200                                                                  10920000
109300******************************************************************10930000
109400*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        10940000
109500******************************************************************10950000
109600 5100-MQ-COMMIT.                                                  10960000
109800                                                                  10980000
109900     CALL PC-MQCMIT USING PV-HCONN                                10990028
110000                          PV-COMPLETION-CODE                      11000028
110100                          PV-REASON.                              11010028
110200                                                                  11020000
110300     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        11030000
110400        CALL PV-MQCHECK USING PV-REASON                           11040028
110500                              PV-MQ-REASON-TEXT                   11050028
110600        MOVE '5100-COMMIT-MQ'   TO PV-PARAGRAPH                   11060000
110700        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               11070000
110800        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        11080000
110900                                   PE-MQ-COMPLETION-CODE          11090000
111000        MOVE PV-REASON          TO PV-HOLD-REASON                 11100000
111100                                   PE-MQ-REASON-CODE              11110000
111200        PERFORM 5200-BACK-OUT-MQ                                  11120000
111300        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        11130000
111400        MOVE PV-HOLD-REASON          TO PV-REASON                 11140000
111500        PERFORM 9200-MQ-ABEND                                     11150000
111600     END-IF.                                                      11160000
111700                                                                  11170000
111800******************************************************************11180000
111900* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       11190000
112000******************************************************************11200000
112100 5200-BACK-OUT-MQ.                                                11210000
112200                                                                  11220000
112300     CALL PC-MQBACK USING PV-HCONN                                11230028
112400                          PV-COMPLETION-CODE                      11240028
112500                          PV-REASON.                              11250028
112600                                                                  11260000
112700     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        11270000
112800        CALL PV-MQCHECK USING PV-REASON                           11280028
112900                              PV-MQ-REASON-TEXT                   11290028
113000        MOVE '5200-BACK-OUT-MQ'  TO PV-PARAGRAPH                  11300000
113100        MOVE 'MQBACK ERROR'    TO PV-ERROR-MESSAGE                11310000
113200        PERFORM 9200-MQ-ABEND                                     11320000
113300     END-IF.                                                      11330000
113400                                                                  11340000
113500******************************************************************11350000
113600* DISPLAY STATISTICS FOR THE PROGRAM                              11360000
113700******************************************************************11370000
113800 9000-EOJ-ROUTINE.                                                11380000
113900                                                                  11390000
114000     CLOSE STR-EXPECTED-FILE.                                     11400000
114100                                                                  11410000
114200     DISPLAY ' '                                                  11420000
114300     DISPLAY ' ********************************************'      11430000
114400     DISPLAY '     * GVKUT002 SUMMARY STATISTICS *         '      11440004
114500     DISPLAY ' '                                                  11450000
114600     DISPLAY '       ---------------------------           '      11460000
114700     DISPLAY '          EXPECT   EXTRACT VIA MQ              '    11470000
114800     DISPLAY '       ---------------------------           '      11480000
114900     DISPLAY ' '                                                  11490000
115000     DISPLAY '   TOTAL EXPECT   RECORDS READ:   '                 11500000
115100                                    PV-COUNTER                    11510000
115200     DISPLAY ' '                                                  11520000
115300     DISPLAY '   TOTAL MQ MESSAGES SENT:   '                      11530000
115400                                    PA-TOTAL-MQ-MSGS-SENT         11540000
115500     DISPLAY ' '                                                  11550000
115600     DISPLAY ' '                                                  11560000
115700     DISPLAY ' ********************************************'.     11570000
115800                                                                  11580000
115900****************************************************************  11590000
116000** PERFORM MQ-SERIES ABEND PROCESSING                             11600000
116100****************************************************************  11610000
116200 9200-MQ-ABEND.                                                   11620000
116300                                                                  11630000
116400     DISPLAY '****************** A B E N D ******************'.   11640000
116500     DISPLAY '** MQSERIES ERROR **'.                              11650000
116600     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          11660000
116700     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    11670000
116800     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     11680000
116900     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 11690000
117000     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            11700000
117100     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                11710000
117200     DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                11720000
117300     DISPLAY '***********************************************'.   11730000
117400     MOVE +4013 TO ABEND-CODE.                                    11740000
117500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11750000
117600                                                                  11760000
117700******************************************************************11770000
117800* 9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      11780000
117900* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 11790000
118000******************************************************************11800000
118100 9900-DB2-ABEND.                                                  11810000
118200                                                                  11820000
118300     MOVE SQLCODE    TO PV-SQLCODE.                               11830000
118400     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       11840000
118500     DISPLAY '*** DB2 ERROR ***'.                                 11850000
118600     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               11860000
118700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 11870000
118800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               11880000
118900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               11890000
119000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       11900000
119100     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             11910000
119200                                                                  11920000
119300******************************************************************11930000
119400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    11940000
119500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         11950000
119600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     11960000
119700* FORMAT.                                                         11970000
119800******************************************************************11980000
119900     COPY DPPD004.                                                11990000
120000                                                                  12000000
120100     IF SQLCODE NOT = -911                                        12010000
120200         EXEC SQL                                                 12020000
120300             ROLLBACK                                             12030000
120400         END-EXEC                                                 12040000
120500     END-IF.                                                      12050000
120600                                                                  12060000
120700     MOVE +4013         TO PV-ABEND-CODE.                         12070000
120800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12080000
120900******************************************************************12090000
