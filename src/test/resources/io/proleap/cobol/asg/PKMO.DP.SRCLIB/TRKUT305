000120******************************************************************00012003
000200 IDENTIFICATION DIVISION.                                         00020003
000300******************************************************************00030003
000400 PROGRAM-ID.    TRKUT305.                                         00040003
000500 AUTHOR.        GERMAN BANDA.                                     00050003
000600 INSTALLATION.  KOHLS.                                            00060003
000700 DATE-WRITTEN   NOVEMBER 2021.                                    00070003
000800 DATE-COMPILED.                                                   00080003
000900******************************************************************00090003
001000* THIS PROGRAM WILL READ A FILE OF PO HEADER/DETAIL AND           00100003
001010* AND VENDOR/DC DATA.                                             00101003
001020* RECORDS COME IN SORTED  BY PO AND DC NUMBER                     00102003
001030* THE PROGRAM WILL READ THE FILE AND CHECK FOR FLAG               00103003
001040* TR302-THRD-PRTY-PO-PRCS-IND-YES AND TR302-DC-DROP-IND-NO        00104003
001050* TR302-DC-DROP-IND-YES- ALLOCATIONS HAVE BEEN DELETED , BUT WE   00105003
001060* STILL SEND RECORDS WITH QTY = 0                                 00106003
001070* SUM THE PO/DC RECORDS WITH PO-PRCS-IND-YES TO A SINGLE RECORD   00107003
001080* WHILE PROCESSING THE FILE SUM THE TR302-REQ-ITEM-QTY  AND       00108003
001090* TR302-PREV-ITEM-QTY , THEN COMPARE BEFORE WRITING THE RECORD    00109003
001100* TO DETERMINE TR302-DC-QTY-CHG-INCREASE                          00110003
001200* TR302-DC-QTY-CHG-DECREASE AND UPDATE INDICATOR                  00120003
001300* IF NO NET INCREASE OR DECREASE , CHECK FOR ANY OTHER UPDATES    00130003
001400* IF NO OTHER CHANGES, DROP THE RECORD                            00140003
001500* NON THIRD PARTY PO/DC'S WILL BE REWRITTEN WITH NO CHANGES       00150003
001600******************************************************************00160003
001700 ENVIRONMENT DIVISION.                                            00170003
001800 CONFIGURATION SECTION.                                           00180003
001900                                                                  00190003
002000 SOURCE-COMPUTER.        IBM-3090.                                00200003
002100 OBJECT-COMPUTER.        IBM-3090.                                00210003
002200                                                                  00220003
002300 INPUT-OUTPUT SECTION.                                            00230003
002400 FILE-CONTROL.                                                    00240003
002500                                                                  00250003
002600     SELECT TMS-PO-HDR-DTL-FILE-IN                                00260003
002700         ASSIGN TO INP01.                                         00270003
002800                                                                  00280003
002900     SELECT TMS-PO-HDR-DTL-FILE-OUT                               00290003
003000         ASSIGN TO OUT01.                                         00300003
003100                                                                  00310003
003200******************************************************************00320003
003300 DATA DIVISION.                                                   00330003
003400 FILE SECTION.                                                    00340003
003500                                                                  00350003
003600 FD  TMS-PO-HDR-DTL-FILE-IN                                       00360003
003700     RECORDING MODE F                                             00370003
003800     LABEL RECORDS ARE STANDARD                                   00380003
003900     BLOCK CONTAINS 0 RECORDS.                                    00390003
004000                                                                  00400003
004100 01  TMS-PO-HDR-DTL-RECORD-IN              PIC X(300).            00410003
004200                                                                  00420003
004300 FD  TMS-PO-HDR-DTL-FILE-OUT                                      00430003
004400     RECORDING MODE F                                             00440003
004500     LABEL RECORDS ARE STANDARD                                   00450003
004600     BLOCK CONTAINS 0 RECORDS.                                    00460003
004700                                                                  00470003
004800 01  TMS-PO-HDR-DTL-RECORD-OUT             PIC X(300).            00480003
004900                                                                  00490003
005000******************************************************************00500003
005100 WORKING-STORAGE SECTION.                                         00510003
005200******************************************************************00520003
005300******************************************************************00530003
005400* PO HEADER AND PO/DC DETAIL FILE LAYOUT                          00540003
005500******************************************************************00550003
005600     COPY TRRD302.                                                00560003
005700                                                                  00570003
007100******************************************************************00710003
007500 01 PS-PROGRAM-SWITCHES.                                          00750003
007600     05  PS-END-OF-FILE-SW             PIC  X(01)  VALUE 'N'.     00760003
007700         88  PS-END-OF-FILE                        VALUE 'Y'.     00770003
007800         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00780003
007900     05  PS-FIRST-TIME-CHECK-SW        PIC  X(01)  VALUE 'N'.     00790003
008000         88  PS-FIRST-TIME-CHECK-YES               VALUE 'Y'.     00800003
008100         88  PS-FIRST-TIME-CHECK-NO                VALUE 'N'.     00810003
008200     05  PS-CHECK-PO-INSTR-TEXT-SW     PIC  X(01)  VALUE 'N'.     00820003
008300         88  PS-CHECK-PO-INSTR-TEXT-YES            VALUE 'Y'.     00830003
008400         88  PS-CHECK-PO-INSTR-TEXT-NO             VALUE 'N'.     00840003
008500         88  PS-CHECK-PO-INSTR-BYPASS              VALUE 'B'.     00850003
008600     05  PS-PO-PROCESS-SW              PIC  X(01)  VALUE 'N'.     00860003
008700         88  PS-PO-PROCESS-YES                     VALUE 'Y'.     00870003
008800         88  PS-PO-PROCESS-NO                      VALUE 'N'.     00880003
008900     05  PS-DC-LOCATION-SW             PIC  X(01)  VALUE 'N'.     00890003
009000         88  PS-DC-LOCATION-FOUND                  VALUE 'Y'.     00900003
009100         88  PS-DC-LOCATION-NOT-FND                VALUE 'N'.     00910003
009200                                                                  00920003
009300 01 PC-PROGRAM-CONSTANTS.                                         00930003
009400     05  PC-I                        PIC  X(01)    VALUE 'I'.     00940003
009500     05  PC-D                        PIC  X(01)    VALUE 'D'.     00950003
009600     05  PC-N                        PIC  X(01)    VALUE 'N'.     00960003
009610     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     00961005
009700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'TRKUT305'. 00970003
009800                                                                  00980003
009900 01 PV-PROGRAM-VARIABLES.                                         00990003
010000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01000003
010100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01010003
010200     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01020003
010300     05  PV-DISPLAY-SQLCODE          PIC -999.                    01030003
010400                                                                  01040003
010500 01  PV-SAVE-FIELDS.                                              01050003
010600     05  PV-SAVE-PO-NBR              PIC ZZZZZZZZZZ VALUE ZEROES. 01060003
010700     05  PV-SAVE-DC-NBR              PIC  9(4)     VALUE ZEROES.  01070003
010800     05  PV-SAVE-PO-PRCS-IND         PIC  X(01)    VALUE SPACES.  01080003
010900     05  PV-DCSPLIT-WORK-QTY         PIC  9(10)    VALUE ZEROES.  01090003
011000     05  PV-DC-PREV-SPLIT-QTY        PIC  9(10)    VALUE ZEROES.  01100003
011100     05  PV-DC-CMPAR-SPLIT-QTY       PIC S9(10)    VALUE ZEROES.  01110003
011200*                                                                 01120003
012310     05  PV-SAVE-RECORD.                                          01231004
012320         10 FILLER                   PIC   X(14)  VALUE SPACES.   01232004
012330         10 PV-DC-NBR                PIC   9(4)   VALUE ZEROES.   01233004
012340         10 FILLER                   PIC   X(40)  VALUE SPACES.   01234004
012350         10 PV-DEST-NAME             PIC   9(4)   VALUE ZEROES.   01235004
012360         10 FILLER                   PIC   X(50)  VALUE SPACES.   01236004
012370         10 PV-REQ-ITEM-QTY          PIC   9(10)  VALUE ZEROES.   01237004
012380         10 FILLER                   PIC   X(40)  VALUE SPACES.   01238004
012390         10 PV-PO-STATUS-CDE         PIC   X(02)  VALUE SPACES.   01239004
012391         10 PV-NEW-STORE-PO-IND      PIC   X(01)  VALUE SPACES.   01239106
012392         10 PV-STR-PO-ALLOCATED-IND  PIC   X(01)  VALUE SPACES.   01239206
012393         10 PV-CHANGES-IND           PIC   X(01)  VALUE SPACES.   01239306
012394         10 PV-DC-QTY-CHG-IND        PIC   X(01)  VALUE SPACES.   01239406
012395         10 PV-PO-STATUS-CHG-IND     PIC   X(01)  VALUE SPACES.   01239506
012396         10 PV-DC-DROP-IND           PIC   X(01)  VALUE SPACES.   01239606
012397         10 PV-SEASET-SHRT-NM        PIC   X(05)  VALUE SPACES.   01239707
012398         10 PV-INIT-PO-LOD-IND       PIC   X(01)  VALUE SPACES.   01239807
012399         10 PV-DATE-CHGD-IND         PIC   X(01)  VALUE SPACES.   01239907
012400         10 PV-NW-STR-CHGD-IND       PIC   X(01)  VALUE SPACES.   01240007
012401         10 PV-STR-ALLOC-CHGD-IND    PIC   X(01)  VALUE SPACES.   01240107
012402         10 PV-SEASET-CHGD-IND       PIC   X(01)  VALUE SPACES.   01240207
012403         10 PV-LOAD-TIMESTAMP        PIC   X(26)  VALUE SPACES.   01240308
012404         10 PV-E-MAIL-ADDRESS        PIC   X(30)  VALUE SPACES.   01240408
012405         10 PV-ENT-NAME              PIC   X(30)  VALUE SPACES.   01240508
012406         10 PV-DEPT-NBR              PIC   9(04)  VALUE ZEROES.   01240608
012407         10 PV-DEPT-NBR-CHGD-IND     PIC   X(01)  VALUE SPACES.   01240708
012408         10 PV-MIN-CL-NBR            PIC   9(04)  VALUE ZEROES.   01240808
012409         10 PV-MIN-CL-NBR-CHGD-IND   PIC   X(01)  VALUE SPACES.   01240908
012411         10 PV-FILLER                PIC   X(24)  VALUE SPACES.   01241108
012420                                                                  01242008
012500                                                                  01250003
012600  01 DB2-KEYS.                                                    01260003
012700     05  DK-PO-NBR                 PIC  S9(9) COMP.               01270003
012800     05  DK-OPER-UNT-ID            PIC  S9(4) COMP.               01280003
012900                                                                  01290003
013000 01 COUNTERS.                                                     01300003
013100     05  PV-READ-COUNTER             PIC  S9(9) COMP-3.           01310003
013200     05  PV-PO-RECORD-WRITE-COUNT    PIC  S9(9) COMP-3.           01320003
013300                                                                  01330003
013400*---------------------------------------------------------------* 01340003
013500******************************************************************01350003
013600 PROCEDURE DIVISION.                                              01360003
013700******************************************************************01370003
013800******************************************************************01380003
013900* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01390003
014000*      PROGRAM.                                                   01400003
014100******************************************************************01410003
014200 0000-PROGRAM-MAINLINE.                                           01420003
014300                                                                  01430003
014400     DISPLAY '***** TRKUT305 STARTED *****'.                      01440003
014500                                                                  01450003
014600     PERFORM 1000-INITIALIZE.                                     01460003
014700                                                                  01470003
014800     PERFORM 2000-PROCESS-PO-FILE-IN                              01480003
014900         UNTIL PS-END-OF-FILE.                                    01490003
015000                                                                  01500003
015100     IF PS-END-OF-FILE AND PV-READ-COUNTER  > 0                   01510003
015200        IF PV-SAVE-PO-PRCS-IND  = 'Y'                             01520003
015300           PERFORM 2500-SET-DC-QTY-CHANGE                         01530003
015400        END-IF                                                    01540003
015500     END-IF                                                       01550003
015600                                                                  01560003
015700     PERFORM 9000-EOJ-ROUTINE.                                    01570003
015800                                                                  01580003
015900     STOP RUN.                                                    01590003
016000                                                                  01600003
016100******************************************************************01610003
016200* DO FIRST TIME PROGRAM INITIALIZATION TASKS.                     01620003
016300*    -- OPEN INPUT FILE                                           01630003
016400*    -- OPEN OUTPUT FILE                                          01640003
016500*    -- GET CURRENT TIMESTAMP FOR THE OUTPUT INTRANSIT RECORD     01650003
016600*    -- READ INPUT FILE                                           01660003
016700******************************************************************01670003
016800 1000-INITIALIZE.                                                 01680003
016900                                                                  01690003
017000     INITIALIZE COUNTERS.                                         01700003
017100     OPEN INPUT  TMS-PO-HDR-DTL-FILE-IN.                          01710003
017200     OPEN OUTPUT TMS-PO-HDR-DTL-FILE-OUT.                         01720003
017300                                                                  01730003
017400     PERFORM 7000-READ-PO-HDR-DTL-FILE-IN.                        01740003
017500                                                                  01750003
017600     IF PS-END-OF-FILE                                            01760003
017700         DISPLAY '** FILE IS EMPTY **'                            01770003
017800     ELSE                                                         01780003
017900         MOVE TR302-TMS-PO-HDR-DTL-RECORD TO PV-SAVE-RECORD       01790003
018000         MOVE TR302-PO-NBR  TO PV-SAVE-PO-NBR                     01800003
018100         MOVE TR302-DC-NBR  TO PV-SAVE-DC-NBR                     01810003
018200         MOVE TR302-THRD-PRTY-PO-PRCS-IND TO PV-SAVE-PO-PRCS-IND  01820003
018300         SET PS-FIRST-TIME-CHECK-YES TO TRUE                      01830003
018400*        PERFORM 2100-PROCESS-DC-SPLITS                           01840003
018500     END-IF.                                                      01850003
018600                                                                  01860003
018700******************************************************************01870003
018800******************************************************************01880003
018900* BEGIN RETRIEVING THE NECESSARY DATA                             01890003
019000******************************************************************01900003
019100 2000-PROCESS-PO-FILE-IN.                                         01910003
019200                                                                  01920003
019300     IF TR302-PO-NBR  = PV-SAVE-PO-NBR                            01930003
019400        IF TR302-THRD-PRTY-PO-PRCS-YES AND TR302-DC-DROP-IND-NO   01940003
019500           IF TR302-DC-NBR = PV-SAVE-DC-NBR                       01950003
019600              PERFORM 2110-SUM-LOCATION                           01960003
019700           ELSE                                                   01970003
019800              PERFORM 2500-SET-DC-QTY-CHANGE                      01980003
019900              MOVE TR302-DC-NBR TO PV-SAVE-DC-NBR                 01990003
020000              MOVE TR302-TMS-PO-HDR-DTL-RECORD TO PV-SAVE-RECORD  02000003
020100              PERFORM 2110-SUM-LOCATION                           02010003
020200           END-IF                                                 02020003
020300        ELSE                                                      02030003
020400           PERFORM 8100-WRITE-PO-DTL-REC-OUT                      02040003
020500        END-IF                                                    02050003
020600     ELSE                                                         02060003
020700        IF PV-SAVE-PO-PRCS-IND  = 'Y'                             02070003
020800           PERFORM 2500-SET-DC-QTY-CHANGE                         02080003
020900           MOVE TR302-THRD-PRTY-PO-PRCS-IND TO PV-SAVE-PO-PRCS-IND02090003
021000        ELSE                                                      02100003
021100           MOVE 'N' TO PV-SAVE-PO-PRCS-IND                        02110003
021200        END-IF                                                    02120003
021300        MOVE TR302-PO-NBR  TO PV-SAVE-PO-NBR                      02130003
021400        MOVE TR302-DC-NBR  TO PV-SAVE-DC-NBR                      02140003
021500        PERFORM 2100-PROCESS-DC-SPLITS                            02150003
021600     END-IF                                                       02160003
021700                                                                  02170003
021800     PERFORM 7000-READ-PO-HDR-DTL-FILE-IN.                        02180003
021900                                                                  02190003
022000******************************************************************02200003
022100* SUM CERTAIN VENDOR ALLOCATIONS FOR DC SPLITS                    02210003
022200******************************************************************02220003
022300 2100-PROCESS-DC-SPLITS.                                          02230003
022400                                                                  02240003
022500     MOVE TR302-TMS-PO-HDR-DTL-RECORD TO PV-SAVE-RECORD           02250003
022600                                                                  02260003
022700     IF TR302-THRD-PRTY-PO-PRCS-YES AND TR302-DC-DROP-IND-NO      02270003
022800        MOVE 'Y'   TO PV-SAVE-PO-PRCS-IND                         02280003
022900        PERFORM 2110-SUM-LOCATION                                 02290003
023000     ELSE                                                         02300003
023100        PERFORM 8000-WRITE-PO-DTL-REC-OUT                         02310003
023200     END-IF.                                                      02320003
023300                                                                  02330003
023400******************************************************************02340003
023500 2110-SUM-LOCATION.                                               02350003
023600     COMPUTE PV-DCSPLIT-WORK-QTY =                                02360003
023700                   PV-DCSPLIT-WORK-QTY + TR302-REQ-ITEM-QTY       02370003
023800                                                                  02380003
023900     COMPUTE PV-DC-PREV-SPLIT-QTY =                               02390003
024000                  PV-DC-PREV-SPLIT-QTY + TR302-PREV-ITEM-QTY-N.   02400003
024100                                                                  02410003
024200                                                                  02420003
024300 2500-SET-DC-QTY-CHANGE.                                          02430003
024310     DISPLAY 'PO BEING PROCESSED : ' PV-SAVE-PO-NBR               02431009
024400     DISPLAY '3RD PARTY DC LOC   : ' PV-SAVE-DC-NBR               02440009
024800                                                                  02480003
024900     IF PV-DCSPLIT-WORK-QTY > PV-DC-PREV-SPLIT-QTY                02490003
025000          MOVE PV-DCSPLIT-WORK-QTY  TO PV-REQ-ITEM-QTY            02500003
025100          MOVE PC-I        TO PV-DC-QTY-CHG-IND                   02510003
025110          MOVE PC-Y        TO PV-CHANGES-IND                      02511004
025200          MOVE SPACE       TO PV-FILLER                           02520003
025300          PERFORM 8000-WRITE-PO-DTL-REC-OUT                       02530003
025400     ELSE                                                         02540003
025500       IF PV-DCSPLIT-WORK-QTY < PV-DC-PREV-SPLIT-QTY              02550003
025600          MOVE PV-DCSPLIT-WORK-QTY  TO PV-REQ-ITEM-QTY            02560003
025700          MOVE PC-D        TO PV-DC-QTY-CHG-IND                   02570003
025710          MOVE PC-Y        TO PV-CHANGES-IND                      02571004
025800          MOVE SPACE       TO PV-FILLER                           02580003
025900          PERFORM 8000-WRITE-PO-DTL-REC-OUT                       02590003
026000       ELSE                                                       02600003
026100          IF PV-NEW-STORE-PO-IND  = 'Y'                           02610008
026200            OR PV-STR-PO-ALLOCATED-IND = 'Y'                      02620008
026300            OR PV-PO-STATUS-CDE = 'Y'                             02630008
026400            OR PV-INIT-PO-LOD-IND                                 02640008
026500            OR PV-DC-DROP-IND                                     02650008
026600            OR PV-DATE-CHGD-IND                                   02660008
026700            OR PV-STR-ALLOC-CHGD-IND = 'Y'                        02670008
026800            OR PV-SEASET-CHGD-IND = 'Y'                           02680008
026900            OR TR302-DEPT-NBR-CHGD-YES                            02690003
027000            OR TR302-MIN-CL-NBR-CHGD-YES                          02700003
027100               MOVE PC-N        TO PV-DC-QTY-CHG-IND              02710003
027200               MOVE SPACE       TO PV-FILLER                      02720003
027300               PERFORM 8000-WRITE-PO-DTL-REC-OUT                  02730003
027400          END-IF                                                  02740003
027500       END-IF                                                     02750003
027600     END-IF.                                                      02760003
027700                                                                  02770003
027800******************************************************************02780003
027900******************************************************************02790003
028000* READ INPUT FILE.                                                02800003
028100******************************************************************02810003
028200 7000-READ-PO-HDR-DTL-FILE-IN.                                    02820003
028300                                                                  02830003
028400      INITIALIZE TR302-TMS-PO-HDR-DTL-RECORD.                     02840003
028500                                                                  02850003
028600      READ TMS-PO-HDR-DTL-FILE-IN INTO                            02860003
028700           TR302-TMS-PO-HDR-DTL-RECORD                            02870003
028800            AT END SET PS-END-OF-FILE TO TRUE.                    02880003
028900                                                                  02890003
029000      IF PS-END-OF-FILE                                           02900003
029100         CONTINUE                                                 02910003
029200      ELSE                                                        02920003
029300         ADD +1 TO PV-READ-COUNTER                                02930003
029400      END-IF.                                                     02940003
029500                                                                  02950003
029600******************************************************************02960003
029700* WRITE PO HEADER DETAIL FILE - COPYBOOK TRRD302.                 02970003
029800******************************************************************02980003
029900 8000-WRITE-PO-DTL-REC-OUT.                                       02990003
030000                                                                  03000003
030100     MOVE   SPACES TO  PV-FILLER.                                 03010003
030200                                                                  03020003
030300     WRITE  TMS-PO-HDR-DTL-RECORD-OUT                             03030003
030400      FROM  PV-SAVE-RECORD                                        03040003
030500     ADD    +1   TO PV-PO-RECORD-WRITE-COUNT.                     03050003
030600     MOVE   +0   TO PV-DCSPLIT-WORK-QTY                           03060003
030700                    PV-DC-PREV-SPLIT-QTY.                         03070003
030800                                                                  03080003
030900******************************************************************03090003
031000* WRITE PO HEADER DETAIL FILE - COPYBOOK TRRD302.                 03100003
031100******************************************************************03110003
031200 8100-WRITE-PO-DTL-REC-OUT.                                       03120003
031300     MOVE   SPACES TO  TR302-PREV-ITEM-QTY                        03130003
031400                       TR302-THRD-PRTY-PO-PRCS-IND.               03140003
031500                                                                  03150003
031600     WRITE  TMS-PO-HDR-DTL-RECORD-OUT                             03160003
031700      FROM  TR302-TMS-PO-HDR-DTL-RECORD.                          03170003
031800     ADD    +1   TO PV-PO-RECORD-WRITE-COUNT.                     03180003
031900                                                                  03190003
032000                                                                  03200003
032100******************************************************************03210003
032200******************************************************************03220003
032300* CLOSE FILES.   DISPLAY COUNTERS.                                03230003
032400******************************************************************03240003
032500 9000-EOJ-ROUTINE.                                                03250003
032600     CLOSE TMS-PO-HDR-DTL-FILE-IN                                 03260003
032700           TMS-PO-HDR-DTL-FILE-OUT.                               03270003
032800                                                                  03280003
032900     MOVE PV-READ-COUNTER          TO PV-DISPLAY-COUNT.           03290003
033000     DISPLAY '                     '                              03300003
033100     DISPLAY 'TOTAL RECORDS READ.: '  PV-DISPLAY-COUNT.           03310003
033200     MOVE PV-PO-RECORD-WRITE-COUNT TO PV-DISPLAY-COUNT.           03320003
033300     DISPLAY 'PO RECORDS OUT.....: '  PV-DISPLAY-COUNT.           03330003
033400                                                                  03340003
033500     DISPLAY '*****  TRKUT305 ENDED  *****'.                      03350003
033600                                                                  03360003
033700******************************************************************03370003
