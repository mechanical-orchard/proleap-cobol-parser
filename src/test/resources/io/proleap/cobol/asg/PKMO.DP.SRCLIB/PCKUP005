000100 IDENTIFICATION DIVISION.                                         00010033
000200                                                                  00020033
000300 PROGRAM-ID.             PCKUP005.                                00030033
000400 AUTHOR.                 DENNIS STEFFEN.                          00040033
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050033
000600 DATE-WRITTEN            AUTUMN 2001.                             00060033
000700 DATE-COMPILED.                                                   00070033
000800                                                                  00080033
000900 ENVIRONMENT DIVISION.                                            00090033
001000 CONFIGURATION SECTION.                                           00100033
001100                                                                  00110033
001200 SOURCE-COMPUTER.        IBM-3090.                                00120033
001300 OBJECT-COMPUTER.        IBM-3090.                                00130033
001400                                                                  00140033
001500 INPUT-OUTPUT SECTION.                                            00150033
001600                                                                  00160033
001700 FILE-CONTROL.                                                    00170033
001800                                                                  00180033
001900     SELECT IN-TRANSIT-EXTRACT-FILE                               00190033
002000         ASSIGN TO INP01.                                         00200033
002100                                                                  00210033
002200                                                                  00220033
002300 DATA DIVISION.                                                   00230033
002400 FILE SECTION.                                                    00240033
002500                                                                  00250033
002600 FD  IN-TRANSIT-EXTRACT-FILE                                      00260033
002700     RECORDING MODE IS F                                          00270033
002800     LABEL RECORDS ARE STANDARD                                   00280033
002900     BLOCK CONTAINS 0 RECORDS.                                    00290033
003000                                                                  00300033
003100 01  IN-TRANSIT-RECORD    PIC  X(100).                            00310033
003200                                                                  00320033
003300 WORKING-STORAGE SECTION.                                         00330033
003400                                                                  00340033
003500                                                                  00350033
003600 01  FILLER.                                                      00360033
003700     05  FILLER                      PIC  X(36)    VALUE          00370033
003800         ' ***** WORKING STORAGE PGM=PCKUP005 '.                  00380033
003900     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00390033
004000     05  FILLER                      PIC  X(10)    VALUE          00400033
004100         ' LOCATION='.                                            00410033
004200     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00420033
004300     05  FILLER                      PIC  X(06)    VALUE          00430033
004400         ' *****'.                                                00440033
004500                                                                  00450033
004600 01  PV-DISP-KEY-MSG.                                             00460033
004700     05  FILLER                      PIC X(14) VALUE              00470033
004800         'INTR-UPC-ID = '.                                        00480033
004900     05  PV-KEY-INTR-UPC-ID          PIC 9(11) VALUE ZEROES.      00490033
005000     05  FILLER                      PIC X(12) VALUE              00500033
005100         '; LOC-NBR = '.                                          00510033
005200     05  PV-KEY-LOC-NBR              PIC 9(04) VALUE ZEROES.      00520033
005300     05  FILLER                      PIC X(13) VALUE              00530033
005400         '; CLSN-CDE = '.                                         00540033
005500     05  PV-KEY-CLSN-CDE             PIC X(02) VALUE ZEROES.      00550033
005600                                                                  00560033
005610 01 PV-DISPLAY-FIELDS.                                            00570033
005611     05  PV-DISP-INTR-UPC            PIC 9(11) VALUE ZEROES.      00580033
005612     05  PV-DISP-LOC-NBR             PIC 9(04) VALUE ZEROES.      00590033
005613     05  PV-DISP-QTY                 PIC Z(09) VALUE ZEROES.      00600033
005614     05  PV-DISP-PO                  PIC Z(09) VALUE ZEROES.      00610033
005615     05  PV-DISP-RCVR                PIC 9(04) VALUE ZEROES.      00620033
005616                                                                  00630033
005617                                                                  00640033
005618 01  PV-UPC-CRAPOLA.                                              00650033
005619     05  PV-DETAIL-INNER-UPC      PIC S9(10)  VALUE ZEROES        00660033
005620                                                COMP.             00670033
005630                                                                  00680033
005640 01  PS-SWITCHES.                                                 00690033
005650     05  PS-EOF-SW                    PIC X(01) VALUE 'N'.        00700033
005660         88  PS-EOF-EXTRACT-YES                 VALUE 'Y'.        00710033
005670         88  PS-EOF-EXTRACT-NO                  VALUE 'N'.        00720033
005680     05  PS-HEADER-SW                 PIC X(01) VALUE 'A'.        00730033
005690         88  PS-UPDATE-OLD-HEADER               VALUE 'U'.        00740033
005700         88  PS-ADD-NEW-HEADER                  VALUE 'A'.        00750033
005800                                                                  00760033
005900 01  PC-CONSTANTS.                                                00770033
006000     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00780033
006100                                                   'PCKUP005'.    00790033
006200     05  PC-OPEN-FUNC                PIC X(05)     VALUE 'OPEN '. 00800033
006300     05  PC-TRANS-FUNC               PIC X(05)     VALUE 'TRANS'. 00810033
006400     05  PC-CLOSE-FUNC               PIC X(05)     VALUE 'CLOSE'. 00820033
006500     05  PC-RSTRT-FUNC               PIC X(05)     VALUE 'RSTRT'. 00830033
006600     05  PV-CKPT-JOB-NAME            PIC X(08)   VALUE 'PCK026'.  00840033
006700     05  PC-CKPT-PLAN-NAME           PIC X(08)   VALUE 'PCKUP005'.00850033
006800     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00860033
006900                                                   'ILBOABN0'.    00870033
007000     05  PC-MAX-RETRIES              PIC S9(04)    VALUE  +3      00880033
007100                                                   COMP.          00890033
007200     05  PC-DEFAULT-DATE             PIC  X(10)    VALUE          00900033
007300                                     '0001-01-01'.                00910033
007400     05  PC-DEFAULT-TIME             PIC  X(08)    VALUE          00920033
007500                                     '00.00.00'.                  00930033
007600                                                                  00940033
007700                                                                  00950033
007800 01  PV-MISC-STUFF.                                               00960033
007900     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    00970033
008000     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     00980033
008100     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      00990033
008200     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01000033
008300                                                   COMP SYNC.     01010033
008400     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       01020033
008500                                                 COMP SYNC.       01030033
008600     05  PV-READ-COUNTER              PIC S9(09) COMP-3           01040033
008700                                              VALUE ZERO.         01050033
008800     05  PV-DISP-CONTROL              PIC S9(09) COMP-3           01060033
008900                                              VALUE ZERO.         01070033
009000     05 PV-QTY-INSERT-COUNTER         PIC S9(09) COMP-3           01080033
009100                                              VALUE ZERO.         01090033
009200     05 PV-QTY-UPDATE-COUNTER         PIC S9(09) COMP-3           01100033
009300                                              VALUE ZERO.         01110033
009400     05 PV-TRAN-INSERT-COUNTER        PIC S9(09) COMP-3           01120033
009500                                              VALUE ZERO.         01130033
009600     05 PV-TRAN-DUP-IN-COUNTER        PIC S9(09) COMP-3           01140033
009700                                              VALUE ZERO.         01150033
009800     05 PV-ADD-QTY                    PIC 9(04).                  01160033
009900                                                                  01170033
010000     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            01180033
010100                                                                  01190033
010200     05  PV-PREP-TIMESTAMP.                                       01200033
010300         10  PV-PREP-DATE            PIC  X(10).                  01210033
010400         10  FILLER                  PIC  X(01).                  01220033
010500         10  PV-PREP-TIME            PIC  X(08).                  01230033
010600         10  FILLER                  PIC  X(07).                  01240033
010700                                                                  01250033
010800     05  PV-INTR-UPC-ID               PIC S9(9) COMP VALUE ZEROS. 01260033
010900     05  PV-STR-NBR                   PIC S9(4) COMP VALUE ZEROS. 01270033
011000     05  PV-TRN-CLSN-CDE              PIC X(02)      VALUE SPACES.01280033
011100     05  PV-HOLD-TIMESTAMP            PIC X(26)      VALUE SPACES.01290033
011200                                                                  01300033
011300     05 PV-EVNT-TMST.                                             01310033
011400        10 PV-EVNT-TMST-YY           PIC  X(04).                  01320033
011500        10 FILLER                    PIC  X(01).                  01330033
011600        10 PV-EVNT-TMST-MM           PIC  X(02).                  01340033
011700        10 FILLER                    PIC  X(01).                  01350033
011800        10 PV-EVNT-TMST-DD           PIC  X(02).                  01360033
011900        10 FILLER                    PIC  X(01).                  01370033
012000        10 PV-EVNT-TMST-HRS          PIC  X(02).                  01380033
012100        10 FILLER                    PIC  X(01).                  01390033
012200        10 PV-EVNT-TMST-MIN          PIC  X(02).                  01400033
012300        10 FILLER                    PIC  X(01).                  01410033
012400        10 PV-EVNT-TMST-SEC          PIC  X(02).                  01420033
012500        10 PV-DOT                    PIC  X(01).                  01430033
012600        10 PV-EVNT-TMST-NSEC         PIC  9(06).                  01440033
012700     05  PV-TIME                      PIC X(08) VALUE SPACES.     01450033
012800                                                                  01460033
012900                                                                  01470033
013000 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01480033
013100                                                     COMP SYNC.   01490033
013200     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01500033
013300     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01510033
013400     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01520033
013500     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01530033
013600     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01540033
013700     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01550033
013800     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01560033
013900     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01570033
014000     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01580033
014100     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01590033
014200                                                                  01600033
014300* TRANSACTION PRESENTATION MODULE PARAMETERS                      01610033
260107     COPY DPWS991.                                                01620065
014400                                                                  01621065
014400     COPY DPLS001.                                                01622065
014500         05  WORK-STRG-AREA          PIC X(150).                  01630033
014600                                                                  01640033
014700                                                                  01650033
014800*    IN-TRANSIT EXTRACT RECORD LAYOUT                             01660033
014900     COPY PCRD010.                                                01670033
015000                                                                  01680033
015100/                                                                 01690033
015200*                                                                 01700033
015300*  IN-TRANSIT HEADERS                                             01710033
015400*                                                                 01720033
015500     EXEC SQL                                                     01730033
015600         INCLUDE PCT00014                                         01740033
015700     END-EXEC.                                                    01750033
015800                                                                  01760033
015900*                                                                 01770033
016000*  IN-TRANSIT DETAIL                                              01780033
016100*                                                                 01790033
016200     EXEC SQL                                                     01800033
016300         INCLUDE PCT00015                                         01810033
016400     END-EXEC.                                                    01820033
016500                                                                  01830033
016600*                                                                 01840033
016700*  CHECK POINT RESTART CONTROL                                    01850033
016800*                                                                 01860033
016900*    EXEC SQL                                                     01870033
017000*        INCLUDE TCKRSTCN                                         01880033
017100*    END-EXEC.                                                    01890033
017200*                                                                 01900033
017300*  COMMUNICATIONS AREA FOR DB2                                    01910033
017400*                                                                 01920033
017500     EXEC SQL                                                     01930033
017600         INCLUDE SQLCA                                            01940033
017700     END-EXEC.                                                    01950033
017800                                                                  01960033
017900*                                                                 01970033
018000* DB2 COMMUNICATION AREA 2                                        01980033
018100*                                                                 01990033
018200     COPY SQLCA2.                                                 02000033
018300/                                                                 02010033
018400     COPY DPWS004.                                                02020033
018500/                                                                 02030033
018600 PROCEDURE DIVISION.                                              02040033
018700                                                                  02050033
018800 0000-MAINLINE-PROCESSING.                                        02060033
018900                                                                  02070033
019000     PERFORM 1000-INITIALIZATION.                                 02080033
019100                                                                  02090033
019200     PERFORM 2000-PROCESS                                         02100033
019300       UNTIL PS-EOF-EXTRACT-YES                                   02110033
019400                                                                  02120033
019500     PERFORM 9000-QUIT.                                           02130033
019600                                                                  02140033
019700     GOBACK.                                                      02150033
019800                                                                  02160033
019900******************************************************************02170033
020000** READ THE DB2 CONTROL TABLE AND READ THE FIRST ASN EXTRACT REC *02180033
020100******************************************************************02190033
020200 1000-INITIALIZATION.                                             02200033
020300     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.  02210033
020400                                                                  02220033
020500     ACCEPT PV-CKPT-JOB-NAME FROM SYSIN.                          02230033
020600     MOVE PC-OPEN-FUNC           TO DP001-FUNC-CODE.              02240033
020700                                                                  02250033
020800     PERFORM 8000-READ-EXTRACT.                                   02260033
020900                                                                  02270033
021000     MOVE PC-TRANS-FUNC          TO DP001-FUNC-CODE.              02280033
021100                                                                  02290033
021200     IF PS-EOF-EXTRACT-YES                                        02300033
021300         DISPLAY SPACES                                           02310033
021400         DISPLAY ALL '*'                                          02320033
021500         DISPLAY '  INPUT FILE IS EMPTY '                         02330033
021600         DISPLAY ALL '*'                                          02340033
021700         DISPLAY SPACES                                           02350033
021800     END-IF.                                                      02360033
021900                                                                  02370033
022000                                                                  02380033
022100 2000-PROCESS.                                                    02390033
022200                                                                  02400033
022300     MOVE '2000-PROCESS                '  TO PV-ABEND-PARAGRAPH.  02410033
022400                                                                  02420033
022500     IF  PC010-INTR-UPC-ID > ZERO                                 02430033
022600         PERFORM 7000-SELECT-INTRANSIT-HEADER                     02440033
022700         IF  PS-ADD-NEW-HEADER                                    02450033
022800             MOVE PC010-IN-TRNST-QTY TO                           02460033
022900                  PCT00014-TRN-CLSN-QTY                           02470033
164325             IF PC010-NOT-SCANNED-BY-STORE OR                     02480058
164325                PC010-MISLOAD-MEMO OR                             02490062
                      PC010-MISLOAD-UNLOAD-MEMO OR                      02500063
                      PC010-ASSUMPT-UNLOAD-MEMO                         02510062
164325                  MOVE +0 TO PCT00014-TRN-CLSN-QTY                02520058
164325             END-IF                                               02530058
023000             PERFORM 7050-INSERT-INTRANSIT-HEADER                 02540054
023100             IF  SQLCODE = ZERO                                   02550054
023200                 MOVE PC010-IN-TRNST-QTY TO                       02560055
023300                      PCT00015-TRN-CLSN-PRCG-QTY                  02570055
023400                      PCT00015-TRN-CLSN-BAL-QTY                   02580055
023500                 IF  PC010-TRIP-ID = ZERO                         02590055
023600                     PERFORM 3000-CHECK-KEY                       02600054
023700                     PERFORM 7100-INSERT-INTRANSIT-NULL           02610054
023800                 ELSE                                             02620055
023900                     PERFORM 3000-CHECK-KEY                       02630055
024000                     PERFORM 7200-INSERT-INTRANSIT-TRANS          02640054
024100                 END-IF                                           02650055
024200             END-IF                                               02660055
024300         ELSE                                                     02670033
                   IF   PC010-TRN-STR-EXPECTED AND                      02680059
164325                    (PC010-UNLOAD-MEMO                            02690062
164325                  OR PC010-NOT-SCANNED-BY-STORE                   02700062
164325                  OR PC010-MISLOAD-MEMO                           02710062
                        OR PC010-MISLOAD-UNLOAD-MEMO                    02720063
                        OR PC010-ASSUMPT-UNLOAD-MEMO )                  02730062
                     MOVE PC010-IN-TRNST-QTY TO                         02740064
                          PCT00015-TRN-CLSN-PRCG-QTY                    02750064
                     PERFORM 7052-INSERT-DATA                           02760052
                   ELSE                                                 02770052
024400               ADD PC010-IN-TRNST-QTY TO                          02780052
024500                   PCT00014-TRN-CLSN-QTY                          02790052
024600               PERFORM 7150-UPDATE-INTRANSIT-HEADER               02800052
024700               IF  SQLCODE = ZERO                                 02810052
024800                   MOVE PC010-IN-TRNST-QTY TO                     02820052
024900                        PCT00015-TRN-CLSN-PRCG-QTY                02830052
025000                   MOVE PCT00014-TRN-CLSN-QTY TO                  02840052
025100                        PCT00015-TRN-CLSN-BAL-QTY                 02850052
025200                   IF  PC010-TRIP-ID = ZERO                       02860052
025300                       PERFORM 3000-CHECK-KEY                     02870055
025400                       PERFORM 7100-INSERT-INTRANSIT-NULL         02880055
025500                   ELSE                                           02890052
025600                       PERFORM 3000-CHECK-KEY                     02900055
025700                       PERFORM 7200-INSERT-INTRANSIT-TRANS        02910055
025800                   END-IF                                         02920052
025900               END-IF                                             02930052
                   END-IF                                               02940052
026000         END-IF                                                   02950033
026100     END-IF.                                                      02960033
026200                                                                  02970033
026300     PERFORM 8000-READ-EXTRACT.                                   02980033
026400                                                                  02990033
026500 3000-CHECK-KEY.                                                  03000033
026600                                                                  03010033
026700     IF  PC010-INTR-UPC-ID  = PV-INTR-UPC-ID                      03020033
026800     AND PC010-STR-NBR      = PV-STR-NBR                          03030033
026900     AND PC010-TRN-CLSN-CDE = PV-TRN-CLSN-CDE                     03040033
027000     AND PC010-EVENT-TMST   = PV-HOLD-TIMESTAMP                   03050033
027100         MOVE PC010-EVENT-TMST TO PV-EVNT-TMST                    03060033
027200         ADD +1 TO PV-ADD-QTY                                     03070033
027300         ADD PV-ADD-QTY TO PV-EVNT-TMST-NSEC                      03080033
027400         MOVE PV-EVNT-TMST TO PC010-EVENT-TMST                    03090033
027500     ELSE                                                         03100033
027600         MOVE PC010-INTR-UPC-ID TO PV-INTR-UPC-ID                 03110033
027700         MOVE PC010-STR-NBR     TO PV-STR-NBR                     03120033
027800         MOVE PC010-TRN-CLSN-CDE TO PV-TRN-CLSN-CDE               03130033
027900         MOVE PC010-EVENT-TMST  TO PV-HOLD-TIMESTAMP              03140033
028000         MOVE ZERO TO PV-ADD-QTY                                  03150033
028100     END-IF.                                                      03160033
028200                                                                  03170033
028300 7000-SELECT-INTRANSIT-HEADER.                                    03180033
028400                                                                  03190033
028500     MOVE '7000-SELECT-INTRANSIT-HEADER'  TO PV-ABEND-PARAGRAPH.  03200033
028600     MOVE PC010-INTR-UPC-ID           TO PCT00014-INTR-UPC-ID     03210033
028700                                         PV-DETAIL-INNER-UPC      03220033
028800     MOVE PV-DETAIL-INNER-UPC         TO PV-KEY-INTR-UPC-ID       03230033
028900     MOVE PC010-STR-NBR               TO PCT00014-LOC-NBR         03240033
029000                                         PV-KEY-LOC-NBR           03250033
029100     MOVE PC010-TRN-CLSN-CDE          TO PCT00014-TRN-CLSN-CDE    03260033
029200                                         PV-KEY-CLSN-CDE          03270033
029300     MOVE ZERO                        TO PCT00014-TRN-CLSN-QTY    03280033
029400                                                                  03290033
029500     PERFORM                                                      03300033
029600         WITH TEST AFTER                                          03310033
029700         VARYING PV-RETRY-COUNTER                                 03320033
029800         FROM 1 BY 1                                              03330033
029900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03340033
030000            OR  (SQLCODE = +100)                                  03350033
030100            OR  (SQLCODE = +0)                                    03360033
030200            OR  (SQLCODE = -911))                                 03370033
030300                                                                  03380033
030400         EXEC SQL                                                 03390033
030500             SELECT  TRN_CLSN_QTY                                 03400033
030600               INTO :PCT00014-TRN-CLSN-QTY                        03410033
030700              FROM  PCT_TRN_CLSN_BAL                              03420035
030800             WHERE                                                03430033
030900                   INTR_UPC_ID  = :PCT00014-INTR-UPC-ID           03440033
031000               AND LOC_NBR      = :PCT00014-LOC-NBR               03450033
031100               AND TRN_CLSN_CDE = :PCT00014-TRN-CLSN-CDE          03460033
031200         END-EXEC                                                 03470033
031300                                                                  03480033
031400         EVALUATE TRUE                                            03490033
031500             WHEN SQLCODE = ZERO                                  03500033
031600                 SET PS-UPDATE-OLD-HEADER TO TRUE                 03510033
031700             WHEN SQLCODE = +100                                  03520033
031800                 SET PS-ADD-NEW-HEADER TO TRUE                    03530033
031900                 MOVE ZERO             TO PCT00014-TRN-CLSN-QTY   03540033
032000             WHEN SQLCODE = -904                                  03550033
032100             WHEN SQLCODE = -913                                  03560033
032200                  CONTINUE                                        03570033
032300                                                                  03580033
032400             WHEN SQLCODE = -911                                  03590033
032500                 MOVE PCT00014-INTR-UPC-ID TO PV-DISP-INTR-UPC    03600033
032600                 MOVE PCT00014-LOC-NBR     TO PV-DISP-LOC-NBR     03610033
032700                 DISPLAY '**************************************' 03620033
032800                 DISPLAY '-911 ERROR ISSUED ON                  ' 03630033
032900                 DISPLAY 'SELECT PCT_TRN_CLSN_BAL               ' 03640033
033000                 DISPLAY '7000-SELECT-INTRANSIT-HEADER          ' 03650033
033100                 DISPLAY 'DB2 AUTOMATIC ROLLBACK ON -911        ' 03660033
033200                 DISPLAY PV-DISP-KEY-MSG                          03670033
033300                 DISPLAY 'INTR-UPC-ID  = ' PV-DISP-INTR-UPC       03680033
033310                 DISPLAY 'LOC-NBR      = ' PV-DISP-LOC-NBR        03690033
033311                 DISPLAY 'TRN-CLSN-CDE = ' PCT00014-TRN-CLSN-CDE  03700033
033312                 DISPLAY '**************************************' 03710033
033313                 PERFORM 9900-SQL-ERROR                           03720033
033314                                                                  03730033
033315             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              03740033
033316                 DISPLAY '**************************************' 03750033
033317                 DISPLAY 'WARNING ISSUED '                        03760033
033318                 DISPLAY 'SELECT PCT_IN_TRNST_QTY               ' 03770033
033319                 DISPLAY PV-DISP-KEY-MSG                          03780033
033320                 DISPLAY '**************************************' 03790033
033330                 PERFORM 9800-SQL-WARNING                         03800033
033340                                                                  03810033
033350             WHEN SQLCODE < ZERO                                  03820033
033360                 DISPLAY '**************************************' 03830033
033370                 DISPLAY 'ERROR ISSUED ON                       ' 03840033
033380                 DISPLAY 'SELECT PCT_IN_TRNST_QTY               ' 03850033
033390                 DISPLAY PV-DISP-KEY-MSG                          03860033
033400                 DISPLAY '**************************************' 03870033
033500                 PERFORM 9900-SQL-ERROR                           03880033
033600                                                                  03890033
033700         END-EVALUATE                                             03900033
033800     END-PERFORM.                                                 03910033
033900                                                                  03920033
034000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    03930033
034100         SQLCODE NOT = ZERO                                       03940033
034200         DISPLAY '**************************************'         03950033
034300         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         03960033
034400         DISPLAY 'SELECT TRN_CLSN_QTY                   '         03970033
034500         DISPLAY PV-DISP-KEY-MSG                                  03980033
034600         DISPLAY '**************************************'         03990033
034700         PERFORM 9900-SQL-ERROR                                   04000033
034800     END-IF.                                                      04010033
034900                                                                  04020033
035000 7050-INSERT-INTRANSIT-HEADER.                                    04030033
035100                                                                  04040033
035200     MOVE '7050-INSERT-INTRANSIT-HEADER' TO PV-ABEND-PARAGRAPH.   04050033
035300     MOVE PCT00014-INTR-UPC-ID        TO PV-DETAIL-INNER-UPC      04060033
035400     MOVE PV-DETAIL-INNER-UPC         TO PV-KEY-INTR-UPC-ID       04070033
035500     MOVE PCT00014-LOC-NBR            TO PV-KEY-LOC-NBR           04080033
035600     MOVE PC010-TRN-CLSN-CDE          TO PCT00014-TRN-CLSN-CDE    04090033
035700                                         PV-KEY-CLSN-CDE.         04100033
035800                                                                  04110033
035900     PERFORM                                                      04120033
036000         WITH TEST AFTER                                          04130033
036100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     04140033
036200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES) OR            04150033
036300                (SQLCODE = ZERO) OR                               04160033
036400                (SQLCODE = -803) OR                               04170033
036500                (SQLCODE = -911))                                 04180033
036600                                                                  04190033
036700         EXEC SQL                                                 04200033
036800             INSERT INTO PCT_TRN_CLSN_BAL                         04210035
036900           ( INTR_UPC_ID                                          04220033
037000            ,LOC_NBR                                              04230033
037100            ,TRN_CLSN_CDE                                         04240033
037200            ,TRN_CLSN_QTY                                         04250033
037300            ,LAST_UPD_DTE                                         04260033
037400           )                                                      04270033
037500             VALUES                                               04280033
037600           (                                                      04290033
037700             :PCT00014-INTR-UPC-ID                                04300033
037800           , :PCT00014-LOC-NBR                                    04310033
037900           , :PCT00014-TRN-CLSN-CDE                               04320033
038000           , :PCT00014-TRN-CLSN-QTY                               04330033
038100           , CURRENT DATE                                         04340033
038200           )                                                      04350033
038300         END-EXEC                                                 04360033
038400                                                                  04370033
038500         EVALUATE TRUE                                            04380033
038600             WHEN SQLCODE = ZERO                                  04390033
038700                 ADD +1  TO PV-QTY-INSERT-COUNTER                 04400033
038800             WHEN SQLCODE = -803                                  04410033
038900             WHEN SQLCODE = -904                                  04420033
039000             WHEN SQLCODE = -913                                  04430033
039100                 CONTINUE                                         04440033
039200                                                                  04450033
039300             WHEN SQLCODE = -911                                  04460033
039400                 MOVE PCT00014-INTR-UPC-ID TO PV-DISP-INTR-UPC    04470033
039500                 MOVE PCT00014-LOC-NBR     TO PV-DISP-LOC-NBR     04480033
039600                 MOVE PCT00014-TRN-CLSN-QTY TO PV-DISP-QTY        04490033
039700                 DISPLAY '**************************************' 04500033
039800                 DISPLAY '-911 ERROR ISSUED ON                  ' 04510033
039900                 DISPLAY 'INSERT PCT_TRN_CLSN_BAL               ' 04520033
040000                 DISPLAY '7050-INSERT-INTRANSIT-HEADER          ' 04530033
040100                 DISPLAY 'DB2 AUTOMATIC ROLLBACK ON -911        ' 04540033
040200                 DISPLAY PV-DISP-KEY-MSG                          04550033
040300                 DISPLAY 'INTR-UPC-ID  = ' PV-DISP-INTR-UPC       04560033
040400                 DISPLAY 'LOC-NBR      = ' PV-DISP-LOC-NBR        04570033
040500                 DISPLAY 'TRN-CLSN-CDE = ' PCT00014-TRN-CLSN-CDE  04580033
040510                 DISPLAY 'TRN-CLSN-QTY = ' PV-DISP-QTY            04590033
040520                 DISPLAY '**************************************' 04600033
040530                 PERFORM 9900-SQL-ERROR                           04610033
040540                                                                  04620033
040550             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              04630033
040560                 DISPLAY '**************************************' 04640033
040570                 DISPLAY 'WARNING ISSUED                        ' 04650033
040580                 DISPLAY 'INSERT PCT_TRN_CLSN_BAL               ' 04660033
040590                 DISPLAY PV-DISP-KEY-MSG                          04670033
040600                 DISPLAY '**********************************'     04680033
040700                 PERFORM 9800-SQL-WARNING                         04690033
040800                                                                  04700033
040900             WHEN SQLCODE < ZERO                                  04710033
041000                 DISPLAY '**************************************' 04720033
041100                 DISPLAY 'ERROR ISSUED'                           04730033
041200                 DISPLAY 'INSERT PCT_TRN_CLSN_BAL               ' 04740033
041300                 DISPLAY PV-DISP-KEY-MSG                          04750033
041400                 DISPLAY '**************************************' 04760033
041500                 PERFORM 9900-SQL-ERROR                           04770033
041600                                                                  04780033
041700         END-EVALUATE                                             04790033
041800     END-PERFORM.                                                 04800033
041900                                                                  04810033
042000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04820033
042100         SQLCODE NOT = +0                                         04830033
042200         DISPLAY '**************************************'         04840033
042300         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04850033
042400         DISPLAY 'INSERT PCT_TRN_CLSN_BAL               '         04860033
042500         DISPLAY PV-DISP-KEY-MSG                                  04870033
042600         DISPLAY '**************************************'         04880033
042700         PERFORM 9900-SQL-ERROR                                   04890033
042800     END-IF.                                                      04900033
042900                                                                  04910033
       7052-INSERT-DATA.                                                04920053
           IF   PC010-TRIP-ID = ZERO                                    04930053
              PERFORM 3000-CHECK-KEY                                    04940053
              PERFORM 7100-INSERT-INTRANSIT-NULL                        04950053
           ELSE                                                         04960053
              PERFORM 3000-CHECK-KEY                                    04970053
              PERFORM 7200-INSERT-INTRANSIT-TRANS                       04980053
           END-IF.                                                      04990053
                                                                        05000053
043000******************************************************************05010033
043100**  IF THE TRIP ID ON THE INPUT IS ZEROS, THEN THE ROW BEING    **05020033
043200**  INSERTED MUST HAVE NULLS IN THE TRIP ID SO THAT IT WILL     **05030033
043300**  NOT FAIL THE RI CHECK TO THE OUTBOUND TRIP TABLES           **05040033
      **  CHECK IF INPUT RECORD IS OF 'UM' TYPE AND BASED ON THAT     **05050042
      **  SELECT CURRENT SE QUANTITY FOR THE STORE/SKU FROM           **05060042
      **  PCT_TRN_CLSN_BAL TABLE WHICH WILL BE PUT INTO DTL TABLE     **05070042
043400******************************************************************05080033
043500 7100-INSERT-INTRANSIT-NULL.                                      05090033
043600     MOVE '7100-INSERT-INTRANSIT-NULL ' TO PV-ABEND-PARAGRAPH.    05100033
043700     MOVE PCT00014-INTR-UPC-ID        TO PV-DETAIL-INNER-UPC      05110033
043800     MOVE PV-DETAIL-INNER-UPC         TO PV-KEY-INTR-UPC-ID       05120033
043900     MOVE PCT00014-LOC-NBR            TO PV-KEY-LOC-NBR           05130033
044000     MOVE PC010-TRN-CLSN-CDE          TO PCT00015-TRN-CLSN-CDE    05140033
044100                                         PV-KEY-CLSN-CDE.         05150033
                                                                        05160037
      *    MOVE ZEROES TO PCT00014-TRN-CLSN-QTY                         05170048
            IF  PC010-UNLOAD-MEMO                                       05180047
164325      OR  PC010-NOT-SCANNED-BY-STORE                              05190058
164325      OR  PC010-MISLOAD-MEMO                                      05200058
            OR  PC010-MISLOAD-UNLOAD-MEMO                               05210063
            OR  PC010-ASSUMPT-UNLOAD-MEMO                               05220062
              PERFORM  7120-SELECT-CLSN-QTY                             05230037
            END-IF.                                                     05240037
                                                                        05250037
044300     PERFORM                                                      05260033
044400         WITH TEST AFTER                                          05270033
044500         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     05280033
044600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES) OR            05290033
044700                (SQLCODE = ZERO) OR                               05300033
044800                (SQLCODE = -803) OR                               05310033
044900                (SQLCODE = -911))                                 05320033
                                                                        05330036
045100         EXEC SQL                                                 05340033
045200             INSERT INTO PCT_TRN_CLSN_DTL                         05350035
045300           (                                                      05360033
045400             INTR_UPC_ID                                          05370033
045500            ,LOC_NBR                                              05380033
045600            ,TRN_CLSN_CDE                                         05390033
045700            ,IN_TRNST_TRN_TMST                                    05400033
045800            ,TRN_TYP_CDE                                          05410033
045900            ,TRN_CLSN_PRCG_QTY                                    05420033
046000            ,TRN_CLSN_BAL_QTY                                     05430033
046100            ,UPD_USR_ID                                           05440033
046200            ,OTBND_TRIP_ID                                        05450033
046300            ,PO_NBR                                               05460033
046400            ,RCVR_SEQ_NBR                                         05470033
046500           )                                                      05480033
046600             VALUES                                               05490033
046700           (                                                      05500033
046800             :PCT00014-INTR-UPC-ID                                05510033
046900           , :PCT00014-LOC-NBR                                    05520033
047000           , :PCT00015-TRN-CLSN-CDE                               05530033
047100           , :PC010-EVENT-TMST                                    05540033
047200           , :PC010-TRN-TYP-CDE                                   05550033
047300           , :PCT00015-TRN-CLSN-PRCG-QTY                          05560033
047400           , :PCT00015-TRN-CLSN-BAL-QTY                           05570033
047500           , :PC010-UPD-USR-ID                                    05580033
047600           , NULL                                                 05590033
047700           , :PC010-PO-NBR                                        05600033
047800           , :PC010-RCVR-SEQ-NBR                                  05610033
047900           )                                                      05620033
048000         END-EXEC                                                 05630033
048100                                                                  05640033
048200         EVALUATE TRUE                                            05650033
048300             WHEN SQLCODE = ZERO                                  05660033
048400                 ADD +1  TO PV-TRAN-INSERT-COUNTER                05670033
048500             WHEN SQLCODE = -803                                  05680033
048600                 ADD +1  TO PV-TRAN-DUP-IN-COUNTER                05690033
048700                 MOVE PV-READ-COUNTER TO PV-DISP-NBR              05700033
048800                 DISPLAY 'DUP REC INPUT NUMBER ' PV-DISP-NBR      05710033
048900             WHEN SQLCODE = -904                                  05720033
049000             WHEN SQLCODE = -913                                  05730033
049100                 CONTINUE                                         05740033
049200                                                                  05750033
049300             WHEN SQLCODE = -911                                  05760033
049400                 MOVE PCT00014-INTR-UPC-ID TO PV-DISP-INTR-UPC    05770033
049500                 MOVE PCT00014-LOC-NBR     TO PV-DISP-LOC-NBR     05780033
049600                 MOVE PCT00014-TRN-CLSN-QTY TO PV-DISP-QTY        05790033
049610                 MOVE PC010-PO-NBR          TO PV-DISP-PO         05800033
049620                 MOVE PC010-RCVR-SEQ-NBR    TO PV-DISP-RCVR       05810033
049630                 DISPLAY '**************************************' 05820033
049640                 DISPLAY '-911 ERROR ISSUED ON                  ' 05830033
049650                 DISPLAY 'INSERT PCT_TRN_CLSN_DTL               ' 05840033
049660                 DISPLAY '7100-INSERT-INTRANSIT-NULL            ' 05850033
049670                 DISPLAY 'DB2 AUTOMATIC ROLLBACK ON -911        ' 05860033
049680                 DISPLAY PV-DISP-KEY-MSG                          05870033
049690                 DISPLAY 'INTR-UPC-ID  = ' PV-DISP-INTR-UPC       05880033
049691                 DISPLAY 'LOC-NBR      = ' PV-DISP-LOC-NBR        05890033
049692                 DISPLAY 'TRN-CLSN-CDE = ' PCT00015-TRN-CLSN-CDE  05900033
049693                 DISPLAY 'TRN-CLSN-QTY = ' PV-DISP-QTY            05910033
049694                 DISPLAY 'PO-RCVR      = ' PV-DISP-PO '-'         05920033
049695                                           PV-DISP-RCVR           05930033
049696                 DISPLAY '**************************************' 05940033
049697                 PERFORM 9900-SQL-ERROR                           05950033
049698                                                                  05960033
049699             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05970033
049700                 DISPLAY '**************************************' 05980033
049800                 DISPLAY 'WARNING ISSUED                        ' 05990033
049900                 DISPLAY 'INSERT PCT_TRN_CLSN_DTL               ' 06000033
050000                 DISPLAY PV-DISP-KEY-MSG                          06010033
050100                 DISPLAY '**********************************'     06020033
050200                 PERFORM 9800-SQL-WARNING                         06030033
050300                                                                  06040033
050400             WHEN SQLCODE < ZERO                                  06050033
050500                 DISPLAY '**************************************' 06060033
050600                 DISPLAY 'ERROR ISSUED'                           06070033
050700                 DISPLAY 'INSERT PCT_TRN_CLSN_DTL               ' 06080033
050800                 DISPLAY PV-DISP-KEY-MSG                          06090033
050900                 DISPLAY '**************************************' 06100033
051000                 PERFORM 9900-SQL-ERROR                           06110033
051100                                                                  06120033
051200         END-EVALUATE                                             06130033
051300     END-PERFORM.                                                 06140033
051400                                                                  06150033
051500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06160033
051600         SQLCODE NOT = ZERO AND SQLCODE NOT = -803                06170033
051700         DISPLAY '**************************************'         06180033
051800         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06190033
051900         DISPLAY 'INSERT PCT_TRN_CLSN_DTL               '         06200033
052000         DISPLAY PV-DISP-KEY-MSG                                  06210033
052100         DISPLAY '**************************************'         06220033
052200         PERFORM 9900-SQL-ERROR                                   06230033
052300     END-IF.                                                      06240033
                                                                        06250052
       7120-SELECT-CLSN-QTY.                                            06260036
           EXEC SQL                                                     06270036
               SELECT  A.TRN_CLSN_QTY                                   06280044
                 INTO :PCT00014-TRN-CLSN-QTY                            06290050
               FROM    PCT_TRN_CLSN_BAL A                               06300044
               WHERE                                                    06310036
                      A.INTR_UPC_ID  = :PCT00014-INTR-UPC-ID            06320044
                  AND A.LOC_NBR      = :PCT00014-LOC-NBR                06330044
                  AND A.TRN_CLSN_CDE = 'SE'                             06340044
           END-EXEC.                                                    06350045
                                                                        06360044
           EVALUATE TRUE                                                06370036
               WHEN SQLCODE = ZERO                                      06380036
                   MOVE PCT00014-TRN-CLSN-QTY                           06390036
                     TO PCT00015-TRN-CLSN-BAL-QTY                       06400036
               WHEN SQLCODE = +100                                      06410036
                   MOVE ZERO TO PCT00015-TRN-CLSN-BAL-QTY               06420047
               WHEN SQLCODE = -904                                      06430036
               WHEN SQLCODE = -913                                      06440036
                   CONTINUE                                             06450036
                                                                        06460036
               WHEN SQLCODE = -911                                      06470036
                   MOVE PCT00014-INTR-UPC-ID TO PV-DISP-INTR-UPC        06480036
                   MOVE PCT00014-LOC-NBR     TO PV-DISP-LOC-NBR         06490036
                   DISPLAY '**************************************'     06500036
                   DISPLAY '-911 ERROR ISSUED ON                  '     06510036
                   DISPLAY 'SELECT PCT_TRN_CLSN_BAL               '     06520036
                   DISPLAY '7120-SELECT-CLSN-QTY         '              06530036
                   DISPLAY 'DB2 AUTOMATIC ROLLBACK ON -911        '     06540036
                   DISPLAY PV-DISP-KEY-MSG                              06550036
                   DISPLAY 'INTR-UPC-ID  = ' PV-DISP-INTR-UPC           06560036
                   DISPLAY 'LOC-NBR      = ' PV-DISP-LOC-NBR            06570036
                   DISPLAY 'TRN-CLSN-CDE = ' PCT00014-TRN-CLSN-CDE      06580036
                   DISPLAY '**************************************'     06590036
                   PERFORM 9900-SQL-ERROR                               06600036
                                                                        06610036
               WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  06620036
                   DISPLAY '**************************************'     06630036
                   DISPLAY 'WARNING ISSUED '                            06640036
                   DISPLAY 'SELECT PCT_TRN_CLSN_BAL               '     06650041
                   DISPLAY PV-DISP-KEY-MSG                              06660036
                   DISPLAY '**************************************'     06670036
                   PERFORM 9800-SQL-WARNING                             06680036
                                                                        06690036
               WHEN SQLCODE < ZERO                                      06700036
                   DISPLAY '**************************************'     06710036
                   DISPLAY 'ERROR ISSUED ON                       '     06720036
                   DISPLAY 'SELECT PCT_IN_TRNST_QTY               '     06730036
                   DISPLAY PV-DISP-KEY-MSG                              06740036
                   DISPLAY '**************************************'     06750036
                   PERFORM 9900-SQL-ERROR                               06760036
                                                                        06770036
05120      END-EVALUATE.                                                06780038
                                                                        06790036
052500 7200-INSERT-INTRANSIT-TRANS.                                     06800033
052600     MOVE '7200-INSERT-INTRANSIT-TRANS' TO PV-ABEND-PARAGRAPH.    06810033
052700     MOVE PCT00014-INTR-UPC-ID        TO PV-DETAIL-INNER-UPC      06820033
052800     MOVE PV-DETAIL-INNER-UPC         TO PV-KEY-INTR-UPC-ID       06830033
052900     MOVE PCT00014-LOC-NBR            TO PV-KEY-LOC-NBR           06840033
053000     MOVE PC010-TRN-CLSN-CDE          TO PCT00015-TRN-CLSN-CDE    06850033
053100                                         PV-KEY-CLSN-CDE.         06860033
053200                                                                  06870033
      *    MOVE ZEROES TO PCT00014-TRN-CLSN-QTY                         06880048
            IF  PC010-UNLOAD-MEMO                                       06890047
164325      OR  PC010-NOT-SCANNED-BY-STORE                              06900058
164325      OR  PC010-MISLOAD-MEMO                                      06910058
            OR  PC010-MISLOAD-UNLOAD-MEMO                               06920063
            OR  PC010-ASSUMPT-UNLOAD-MEMO                               06930062
              PERFORM 7120-SELECT-CLSN-QTY                              06940043
            END-IF.                                                     06950037
                                                                        06960036
053400     PERFORM                                                      06970033
053500         WITH TEST AFTER                                          06980033
053600         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     06990033
053700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES) OR            07000033
053800                (SQLCODE = ZERO) OR                               07010033
053801                (SQLCODE = -803) OR                               07020033
053802                (SQLCODE = -911))                                 07030033
                                                                        07040036
053804         EXEC SQL                                                 07050033
053805             INSERT INTO PCT_TRN_CLSN_DTL                         07060035
053806           (                                                      07070033
053807             INTR_UPC_ID                                          07080033
053808            ,LOC_NBR                                              07090033
053809            ,TRN_CLSN_CDE                                         07100033
053810            ,IN_TRNST_TRN_TMST                                    07110033
053820            ,TRN_TYP_CDE                                          07120033
053830            ,TRN_CLSN_PRCG_QTY                                    07130033
053840            ,TRN_CLSN_BAL_QTY                                     07140033
053850            ,UPD_USR_ID                                           07150033
053860            ,OTBND_TRIP_ID                                        07160033
053870            ,PO_NBR                                               07170033
053880            ,RCVR_SEQ_NBR                                         07180033
053890           )                                                      07190033
053900             VALUES                                               07200033
054000           (                                                      07210033
054100             :PCT00014-INTR-UPC-ID                                07220033
054200           , :PCT00014-LOC-NBR                                    07230033
054300           , :PCT00015-TRN-CLSN-CDE                               07240033
054400           , :PC010-EVENT-TMST                                    07250033
054500           , :PC010-TRN-TYP-CDE                                   07260033
054600           , :PCT00015-TRN-CLSN-PRCG-QTY                          07270033
054700           , :PCT00015-TRN-CLSN-BAL-QTY                           07280033
054800           , :PC010-UPD-USR-ID                                    07290033
054900           , :PC010-TRIP-ID                                       07300033
055000           , :PC010-PO-NBR                                        07310033
055100           , :PC010-RCVR-SEQ-NBR                                  07320033
055200           )                                                      07330033
055300         END-EXEC                                                 07340033
055400                                                                  07350033
055500         EVALUATE TRUE                                            07360033
055600             WHEN SQLCODE = ZERO                                  07370033
055700                 ADD +1  TO PV-TRAN-INSERT-COUNTER                07380033
055800             WHEN SQLCODE = -803                                  07390033
055900                 ADD +1  TO PV-TRAN-DUP-IN-COUNTER                07400033
056000                 MOVE PV-READ-COUNTER TO PV-DISP-NBR              07410033
056100                 DISPLAY 'DUP REC INPUT NUMBER ' PV-DISP-NBR      07420033
056200             WHEN SQLCODE = -904                                  07430033
056300             WHEN SQLCODE = -913                                  07440033
056400                 CONTINUE                                         07450033
056500                                                                  07460033
056600             WHEN SQLCODE = -911                                  07470033
056700                 MOVE PCT00014-INTR-UPC-ID TO PV-DISP-INTR-UPC    07480033
056800                 MOVE PCT00014-LOC-NBR     TO PV-DISP-LOC-NBR     07490033
056900                 MOVE PC010-PO-NBR          TO PV-DISP-PO         07500033
057000                 MOVE PC010-RCVR-SEQ-NBR    TO PV-DISP-RCVR       07510033
057100                 DISPLAY '**************************************' 07520033
057200                 DISPLAY '-911 ERROR ISSUED ON                  ' 07530033
057300                 DISPLAY 'INSERT PCT_TRN_CLSN_DTL               ' 07540033
057400                 DISPLAY '7200-INSERT-INTRANSIT-TRANS           ' 07550033
057500                 DISPLAY 'DB2 AUTOMATIC ROLLBACK ON -911        ' 07560033
057600                 DISPLAY PV-DISP-KEY-MSG                          07570033
057700                 DISPLAY 'INTR-UPC-ID  = ' PV-DISP-INTR-UPC       07580033
057800                 DISPLAY 'LOC-NBR      = ' PV-DISP-LOC-NBR        07590033
057900                 DISPLAY 'TRN-CLSN-CDE = ' PCT00015-TRN-CLSN-CDE  07600033
058000                 DISPLAY 'TRN-CLSN-QTY = ' PV-DISP-QTY            07610033
058100                 DISPLAY 'PO-RCVR      = ' PV-DISP-PO '-'         07620033
058200                                           PV-DISP-RCVR           07630033
058300                 DISPLAY '**************************************' 07640033
058301                 PERFORM 9900-SQL-ERROR                           07650033
058302                                                                  07660033
058303             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              07670033
058304                 DISPLAY '**************************************' 07680033
058305                 DISPLAY 'WARNING ISSUED                        ' 07690033
058306                 DISPLAY 'INSERT PCT_TRN_CLSN_DTL               ' 07700033
058307                 DISPLAY PV-DISP-KEY-MSG                          07710033
058308                 DISPLAY '**********************************'     07720033
058309                 PERFORM 9800-SQL-WARNING                         07730033
058310                                                                  07740033
058320             WHEN SQLCODE < ZERO                                  07750033
058330                 DISPLAY '**************************************' 07760033
058340                 DISPLAY 'ERROR ISSUED'                           07770033
058350                 DISPLAY 'INSERT PCT_TRN_CLSN_DTL               ' 07780033
058360                 DISPLAY PV-DISP-KEY-MSG                          07790033
058370                 DISPLAY '**************************************' 07800033
058380                 PERFORM 9900-SQL-ERROR                           07810033
058390                                                                  07820033
058400         END-EVALUATE                                             07830033
058500     END-PERFORM.                                                 07840033
058600                                                                  07850033
058700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    07860033
058800         SQLCODE NOT = ZERO AND SQLCODE NOT = -803                07870033
058900         DISPLAY '**************************************'         07880033
059000         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         07890033
059100         DISPLAY 'INSERT PCT_TRN_CLSN_DTL               '         07900033
059200         DISPLAY PV-DISP-KEY-MSG                                  07910033
059300         DISPLAY '**************************************'         07920033
059400         PERFORM 9900-SQL-ERROR                                   07930033
059500     END-IF.                                                      07940033
059600                                                                  07950033
059700 7150-UPDATE-INTRANSIT-HEADER.                                    07960033
059800     MOVE '7150-UPDATE-INTRANSIT-HEADER' TO PV-ABEND-PARAGRAPH.   07970033
059900     MOVE PCT00014-INTR-UPC-ID        TO PV-DETAIL-INNER-UPC      07980033
060000     MOVE PV-DETAIL-INNER-UPC         TO PV-KEY-INTR-UPC-ID       07990033
060100     MOVE PCT00014-LOC-NBR            TO PV-KEY-LOC-NBR           08000033
060200     MOVE PC010-TRN-CLSN-CDE          TO PCT00014-TRN-CLSN-CDE    08010033
060300                                         PV-KEY-CLSN-CDE.         08020033
060400                                                                  08030033
060500     PERFORM                                                      08040033
060600         WITH TEST AFTER                                          08050033
060700         VARYING PV-RETRY-COUNTER                                 08060033
060800         FROM 1 BY 1                                              08070033
060900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08080033
061000            OR  (SQLCODE = +100)                                  08090033
061100            OR  (SQLCODE = ZERO)                                  08100033
061200            OR  (SQLCODE = -911))                                 08110033
061300                                                                  08120033
061400         EXEC SQL                                                 08130033
061500             UPDATE PCT_TRN_CLSN_BAL                              08140035
061600             SET TRN_CLSN_QTY   = :PCT00014-TRN-CLSN-QTY          08150033
061700               , LAST_UPD_DTE   = CURRENT DATE                    08160033
061800             WHERE                                                08170033
061900                   INTR_UPC_ID  = :PCT00014-INTR-UPC-ID           08180033
062000               AND LOC_NBR      = :PCT00014-LOC-NBR               08190033
062100               AND TRN_CLSN_CDE = :PCT00014-TRN-CLSN-CDE          08200033
062200         END-EXEC                                                 08210033
062300                                                                  08220033
062400         EVALUATE TRUE                                            08230033
062500             WHEN SQLCODE = ZERO                                  08240033
062600                 ADD +1  TO PV-QTY-UPDATE-COUNTER                 08250033
062700             WHEN SQLCODE = +100                                  08260033
062800                 DISPLAY 'HEADER ROW NOT FOUND FOR UPDATE'        08270033
062900                 DISPLAY PV-DISP-KEY-MSG                          08280033
063000                 PERFORM 9100-SQL-ABEND                           08290033
063100             WHEN SQLCODE = -904                                  08300033
063200             WHEN SQLCODE = -913                                  08310033
063300                  CONTINUE                                        08320033
063400                                                                  08330033
063500             WHEN SQLCODE = -911                                  08340033
063600                 MOVE PCT00014-INTR-UPC-ID TO PV-DISP-INTR-UPC    08350033
063700                 MOVE PCT00014-LOC-NBR     TO PV-DISP-LOC-NBR     08360033
063800                 DISPLAY '**************************************' 08370033
063900                 DISPLAY '-911 ERROR ISSUED ON                  ' 08380033
064000                 DISPLAY 'UPDATE PCT_TRN_CLSN_BAL               ' 08390033
064100                 DISPLAY '7150-UPDATE-INTRANSIT-HEADER          ' 08400033
064200                 DISPLAY 'DB2 AUTOMATIC ROLLBACK ON -911        ' 08410033
064300                 DISPLAY PV-DISP-KEY-MSG                          08420033
064400                 DISPLAY 'INTR-UPC-ID  = ' PV-DISP-INTR-UPC       08430033
064500                 DISPLAY 'LOC-NBR      = ' PV-DISP-LOC-NBR        08440033
064600                 DISPLAY 'TRN-CLSN-CDE = ' PCT00014-TRN-CLSN-CDE  08450033
064700                 DISPLAY '**************************************' 08460033
064800                 PERFORM 9900-SQL-ERROR                           08470033
064900                                                                  08480033
065000                                                                  08490033
065100             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              08500033
065200                 DISPLAY '**************************************' 08510033
065300                 DISPLAY 'WARNING ISSUED '                        08520033
065400                 DISPLAY 'UPDATE PCT_TRN_CLSN_BAL               ' 08530033
065500                 DISPLAY PV-DISP-KEY-MSG                          08540033
065600                 DISPLAY '**************************************' 08550033
065700                 PERFORM 9800-SQL-WARNING                         08560033
065800                                                                  08570033
065900             WHEN SQLCODE < ZERO                                  08580033
066000                 DISPLAY '**************************************' 08590033
066100                 DISPLAY 'ERROR ISSUED ON                       ' 08600033
066200                 DISPLAY 'UPDATE PCT_TRN_CLSN_BAL               ' 08610033
066300                 DISPLAY PV-DISP-KEY-MSG                          08620033
066400                 DISPLAY '**************************************' 08630033
066500                 PERFORM 9900-SQL-ERROR                           08640033
066600                                                                  08650033
066700         END-EVALUATE                                             08660033
066800     END-PERFORM.                                                 08670033
066900                                                                  08680033
067000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08690033
067100         SQLCODE NOT = ZERO                                       08700033
067200         DISPLAY '**************************************'         08710033
067300         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         08720033
067400         DISPLAY 'UPDATE PCT_TRN_CLSN_BAL               '         08730033
067500         DISPLAY PV-DISP-KEY-MSG                                  08740033
067600         DISPLAY '**************************************'         08750033
067700         PERFORM 9900-SQL-ERROR                                   08760033
067800     END-IF.                                                      08770033
067900/                                                                 08780033
068000 8000-READ-EXTRACT.                                               08790033
068100                                                                  08800033
068200     MOVE '8000-READ-EXTRACT   '  TO PV-ABEND-PARAGRAPH.          08810033
068300                                                                  08820033
068400     MOVE LENGTH OF PC010-PCT-INTRANSIT-REC                       08830033
068500                                     TO DP001-WORK-STRG-LENGTH.   08840033
068600     MOVE PV-CKPT-JOB-NAME           TO DP001-JOB-NAME.           08850033
068700     MOVE PC-CKPT-PLAN-NAME          TO DP001-PLAN-NAME.          08860033
068800                                                                  08870033
068900     PERFORM Z900-CALL-TRANS-PRES-MODULE.                         08880033
069000                                                                  08890033
069100     MOVE DP001-TRANS-RECORD  TO PC010-PCT-INTRANSIT-REC          08900033
069200                                                                  08910033
069300*    IF DP001-GOOD-RET-CODE                                       08920033
069400*        IF DP001-CKPT-TAKEN                                      08930033
069500*            ADD 1                    TO PV-CKPT-COUNTER          08940033
069600*        ELSE                                                     08950033
069700*            MOVE PC010-INTR-UPC-ID   TO PV-KEY-INTR-UPC-ID       08960033
069800*            MOVE PC010-STR-NBR       TO PV-KEY-LOC-NBR           08970033
069900*        END-IF                                                   08980033
070000*    END-IF                                                       08990033
070100                                                                  09000033
070200     IF DP001-GOOD-RET-CODE                                       09010033
070300*        MOVE PC010-INTR-UPC-ID       TO PV-KEY-INTR-UPC-ID       09020033
070400         MOVE PCT00014-INTR-UPC-ID    TO PV-DETAIL-INNER-UPC      09030033
070500         MOVE PV-DETAIL-INNER-UPC     TO PV-KEY-INTR-UPC-ID       09040033
070600         MOVE PC010-STR-NBR           TO PV-KEY-LOC-NBR           09050033
070700         IF PC010-EVENT-TMST (20:1) = SPACES                      09060033
070800             MOVE PC010-EVENT-TMST    TO PV-EVNT-TMST             09070033
070900             MOVE '.'                TO PV-DOT                    09080033
071000             MOVE ZEROES              TO PV-EVNT-TMST-NSEC        09090033
071100             MOVE  PV-EVNT-TMST       TO PC010-EVENT-TMST         09100033
071200         END-IF                                                   09110033
071300     END-IF                                                       09120033
071400                                                                  09130033
071500                                                                  09140033
071600     IF DP001-PREP-TRANS-EOF                                      09150033
071700         SET PS-EOF-EXTRACT-YES       TO TRUE                     09160033
071800     ELSE                                                         09170033
071900         ADD 1                        TO PV-READ-COUNTER          09180033
072000                                         PV-DISP-CONTROL          09190033
072100         IF PV-DISP-CONTROL > 9999                                09200033
072200             EXEC SQL                                             09210033
072300                 SELECT CURRENT TIME                              09220033
072400                 INTO :PV-TIME                                    09230033
072500                 FROM SYSIBM.SYSDUMMY1                            09240033
072600             END-EXEC                                             09250033
072700             MOVE PV-READ-COUNTER     TO PV-DISP-NBR              09260033
072800             DISPLAY PV-TIME                                      09270033
072900             ' PROCESSING REC # ' PV-DISP-NBR                     09280033
073000             ' / '     PV-DISP-KEY-MSG                            09290033
073100             MOVE ZERO                TO PV-DISP-CONTROL          09300033
073200         END-IF                                                   09310033
073300     END-IF.                                                      09320033
073400                                                                  09330033
073500/                                                                 09340033
073600 9000-QUIT.                                                       09350033
073700     MOVE PC-CLOSE-FUNC               TO DP001-FUNC-CODE.         09360033
073800     PERFORM 8000-READ-EXTRACT.                                   09370033
073900                                                                  09380033
074000     MOVE PV-READ-COUNTER             TO PV-DISP-NBR              09390033
074100     DISPLAY 'RECORDS READ               = ' PV-DISP-NBR          09400033
074200                                                                  09410033
074300     MOVE PV-QTY-INSERT-COUNTER       TO PV-DISP-NBR              09420033
074400     DISPLAY 'PCT_TRN_CLSN_BAL INSERTS   = '  PV-DISP-NBR         09430033
074500                                                                  09440033
074600     MOVE PV-QTY-UPDATE-COUNTER       TO PV-DISP-NBR              09450033
074700     DISPLAY 'PCT_TRN_CLSN_BAL UPDATES   = '  PV-DISP-NBR         09460033
074800                                                                  09470033
074900     MOVE PV-TRAN-INSERT-COUNTER      TO PV-DISP-NBR              09480033
075000     DISPLAY 'PCT_TRN_CLSN_DTL INSERTS   = '  PV-DISP-NBR.        09490033
075100                                                                  09500033
075200     MOVE PV-TRAN-DUP-IN-COUNTER      TO PV-DISP-NBR              09510033
075300     DISPLAY 'PCT_TRN_CLSN_DTL -803      = '  PV-DISP-NBR.        09520033
075400/                                                                 09530033
075500 9100-SQL-ABEND.                                                  09540033
075600******************************************************************09550033
075700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    09560033
075800*  ERROR OR WARNING CODE OCCURS.                                  09570033
075900******************************************************************09580033
076000     DISPLAY '9100-SQL-ABEND'.                                    09590033
076100     DISPLAY '** ABEND     **'.                                   09600033
076200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        09610033
076300     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             09620033
076400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     09630033
076500     DISPLAY '** INTR-UPC-ID  = ' PC010-INTR-UPC-ID               09640033
076600     DISPLAY '** LOC-NBR      ** = ' PC010-STR-NBR                09650033
076700     DISPLAY '** TRIP-ID      ** = ' PC010-TRIP-ID                09660033
076800     DISPLAY '**              ** = '                              09670033
076900     MOVE SQLCODE TO PV-SQL-CODE.                                 09680033
077000     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    09690033
077100     MOVE +4013 TO PV-ABEND-CODE.                                 09700033
077200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         09710033
077300                                                                  09720033
077400******************************************************************09730033
077500*  THIS MODULE PERFORMS THE SQL WARNING.                         *09740033
077600******************************************************************09750033
077700                                                                  09760033
077800 9800-SQL-WARNING.                                                09770033
077900                                                                  09780033
078000     MOVE SQLCODE               TO SQLCODE2.                      09790033
078100     MOVE SQLERRD(3)            TO SQLERRD3.                      09800033
078200     DISPLAY '** ABEND **       ** = SQLWARNING'.                 09810033
078300     DISPLAY '** PROGRAM        ** = PCKUP005'.                   09820033
078400     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        09830033
078500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  09840033
078600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  09850033
078700                                                                  09860033
078800     COPY DPPD004.                                                09870033
078900     SET ABEND-4013-DB2-ERROR   TO TRUE                           09880033
079000     CALL 'ILBOABN0' USING ABEND-CODE.                            09890033
079100                                                                  09900033
079200 EJECT                                                            09910033
079300******************************************************************09920033
079400* THIS MODULE PERFORMS THE SQL ERROR.                            *09930033
079500******************************************************************09940033
079600                                                                  09950033
079700 9900-SQL-ERROR.                                                  09960033
079800                                                                  09970033
079900     MOVE SQLCODE               TO SQLCODE2.                      09980033
080000     MOVE SQLERRD(3)            TO SQLERRD3.                      09990033
080100     DISPLAY '** ABEND **       ** = SQLERROR'.                   10000033
080200     DISPLAY '** PROGRAM        ** = PCKUP005'.                   10010033
080300     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        10020033
080400                                                                  10030033
080500     COPY DPPD004.                                                10040033
080600     SET ABEND-4013-DB2-ERROR   TO TRUE                           10050033
080700     CALL 'ILBOABN0' USING ABEND-CODE.                            10060033
080800/                                                                 10070033
080900     COPY DPPD001.                                                10080033
