       IDENTIFICATION DIVISION.                                         00010001
       PROGRAM-ID.           DAKUP206.                                  00020069
       AUTHOR.               SCOTT JACKSON.                             00030001
       INSTALLATION.         KOHLS DEPARTMENT STORES.                   00040001
       DATE-WRITTEN          11/20/2008.                                00050086
       DATE-COMPILED.                                                   00060001
                                                                        00070001
      ******************************************************************00080001
      * PROCESS UPDATES THE DAT_BRND_PRRTN % BASED ON ML FINANCIALS     00090050
      *   1) PROCESS ML FINANCIAL % FILE TO BUILD INTERNAL TABLE        00100050
      *   2) CREATES A SPREADSHEET INDICATING CURRENT BRAND ALLOCATION  00110050
      *   3) UPDATES DAT_BRND_PRRTN % TO MATCH CALCULATED ML %          00120050
      *                                                                 00130099
      *   4) TO BYPASS ACTUAL UPDATES BUT STILL CREAT REPORTING...      00140099
      *      EXECUTE : TKMA.ML.BV.PHASE2.TEST.SRCLIB(DAKRP206)          00150099
      ******************************************************************00160001
      ***************************************************************** 00161099
      *    WR/INC#      DATE        DESCRIPTION                       * 00162099
      *    --------   ----------   ---------------------------------  * 00163099
132403*   1324033     07/15/2010   TAISA KONTAROVICH                    00164099
      *                            INC # 1324033 - FIX SOC7 ERROR.      00165099
      *   IN1271921   02/03/2015   COGNIZANT                          * 00169099
      *                            INCREASED THE OCCURS AS 199        * 00169199
      *                            FOR INTERNAL TABLE                 * 00169299
      *                            BRAND-PRRTN-TABLE.                 * 00169399
8613F *   8613F       7/17/2015    SUE BARTELT                        * 00169499
8613F *                            RMS 9 REMEDIATION. CHANGED FROM      00169599
8613F *                            AUTO LOGON TO EXTERNAL SIGN ON       00169699
      *---------------------------------------------------------------* 00169799
                                                                        00170001
                                                                        00180001
       ENVIRONMENT DIVISION.                                            00190001
                                                                        00200001
       CONFIGURATION SECTION.                                           00210001
                                                                        00220001
       SOURCE-COMPUTER. IBM-3090.                                       00230001
       OBJECT-COMPUTER. IBM-3090.                                       00240001
                                                                        00250001
       INPUT-OUTPUT SECTION.                                            00260001
                                                                        00270001
       FILE-CONTROL.                                                    00280001
8613F      SELECT ORACLE-LOGIN-FILE                                     00281099
8613F          ASSIGN TO ORALOGON.                                      00282099
                                                                        00310001
           SELECT ML-PRORATION-FILE                                     00320001
               ASSIGN TO INP02.                                         00330001
                                                                        00340001
           SELECT ML-DA-PRORATION-FILE                                  00350001
               ASSIGN TO OUT01.                                         00360001
                                                                        00370001
           SELECT DA-PRORATION-FILE                                     00380069
               ASSIGN TO OUT02.                                         00390085
                                                                        00400069
                                                                        00410001
       DATA DIVISION.                                                   00420001
                                                                        00430001
       FILE SECTION.                                                    00440001
8613F  FD  ORACLE-LOGIN-FILE                                            00441099
8613F      RECORDING MODE IS F                                          00442099
8613F      LABEL RECORDS ARE STANDARD                                   00443099
8613F      BLOCK CONTAINS 0 RECORDS                                     00444099
8613F      DATA RECORD IS ORACLE-LOGIN-REC.                             00445099
8613F  01  ORACLE-LOGIN-REC.                                            00446099
8613F      05  FILLER                  PIC X(80).                       00447099
                                                                        00500001
       FD  ML-PRORATION-FILE                                            00510001
           RECORDING MODE IS F                                          00520001
           LABEL RECORDS ARE STANDARD                                   00530001
           BLOCK CONTAINS 0 RECORDS.                                    00540001
       01  ML-PRORATION-RECORD             PIC X(301).                  00550001
                                                                        00560001
       FD  ML-DA-PRORATION-FILE                                         00570001
           RECORDING MODE IS F                                          00580001
           LABEL RECORDS ARE STANDARD                                   00590001
           BLOCK CONTAINS 0 RECORDS.                                    00600001
       01  ML-DA-PRORATION-RECORD          PIC X(301).                  00610001
                                                                        00620001
       FD  DA-PRORATION-FILE                                            00630069
           RECORDING MODE IS F                                          00640069
           LABEL RECORDS ARE STANDARD                                   00650069
           BLOCK CONTAINS 0 RECORDS.                                    00660069
       01  DA-PRORATION-RECORD             PIC X(120).                  00670088
                                                                        00680069
                                                                        00690001
       WORKING-STORAGE SECTION.                                         00700001
                                                                        00710001
      ****************************************************************  00720001
      * RECORD LAYOUT FOR CONTROL CARD FILE.                            00730001
      ****************************************************************  00740001
8613F  01  CC-ORACLE-CONNECTION.                                        00741099
8613F      05  CC-ORACLE-USERID                PIC X(40).               00742099
8613F          88 CC-AUTO-LOGON                           VALUE '/'.    00743099
8613F      05  CC-ORACLE-PASSWORD              PIC X(40).               00744099
                                                                        00910001
      ***************************************************************** 00920001
      *  PROGRAM'S ACCUMULATORS                                       * 00930001
      ***************************************************************** 00940001
       01  PA-PROGRAM-ACCUMULATORS.                                     00950001
           05  PA-ML-RECORDS-READ          PIC 9(09)       VALUE ZEROES.00960069
           05  PA-ROWS-FETCHED             PIC 9(09)       VALUE ZEROES.00970069
           05  PA-ROWS-UPDATED             PIC 9(09)       VALUE ZEROES.00980001
           05  PA-ROWS-INSERTED            PIC 9(09)       VALUE ZEROES.00990069
           05  PA-ROWS-TO-COMMIT           PIC 9(09)       VALUE ZEROES.01000001
           05  PA-NUMBER-OF-COMMIT         PIC 9(09)       VALUE ZEROES.01010001
           05  PA-ML-RECORDS-WRITTEN       PIC 9(09)       VALUE ZEROES.01020069
           05  PA-DA-RECORDS-WRITTEN       PIC 9(09)       VALUE ZEROES.01030069
                                                                        01040001
      ***************************************************************** 01050001
      *  PROGRAM'S CONSTANTS                                          * 01060001
      ***************************************************************** 01070001
       01  PC-PROGRAM-CONSTANTS.                                        01080001
           05  PC-MAX-DEADLOCKS            PIC S9(04)      VALUE +3.    01090001
           05  PC-COMMIT-COUNT             PIC 9(03)       VALUE 01.    01100001
           05  PC-PROGRAM-NAME             PIC X(08)       VALUE        01110001
               'DAKUP206'.                                              01120069
           05  PC-ORACLE-PROD-ID           PIC X(1)        VALUE '/'.   01130001
           05  PC-ORACLE-PROD-ID-LGTH      PIC 9(02)       VALUE 1.     01140001
                                                                        01150001
W30021     05  PC-CURR-TIME                PIC 9(08)       VALUE ZEROES.01160001
W30021     05  PC-AFTR-TIME                PIC 9(08)       VALUE ZEROES.01170001
W30021     05  PC-TIME-DIFF                PIC 9(08)       VALUE ZEROES.01180001
8613F      05  PC-AUTO-LOGON           PIC X(01)  VALUE '/'.            01181099
      ***************************************************************** 01190001
      *  PROGRAM'S SWITCHES                                           * 01200001
      ***************************************************************** 01210001
       01  PS-PROGRAM-SWITCHES.                                         01220001
           05  PS-END-OF-FILE-SW           PIC X(01)       VALUE 'N'.   01230001
               88  PS-END-OF-FILE                          VALUE 'Y'.   01240001
               88  PS-NOT-END-OF-FILE                      VALUE 'N'.   01250001
           05  PS-END-OF-CONTROL-SW        PIC X(01)       VALUE 'N'.   01260001
               88  PS-END-OF-CONTROL-CARDS                 VALUE 'Y'.   01270001
               88  PS-NOT-END-CONTROL-CARDS                VALUE 'N'.   01280001
           05  PS-DA-TABLE-LOAD-SW          PIC X(01)      VALUE 'N'.   01290001
               88  PS-DA-TABLE-LOADED                      VALUE 'Y'.   01300001
               88  PS-MORE-DA-TABLE-ROWS                   VALUE 'N'.   01310001
           05  PS-DA-PRRTN-ROWS-SW          PIC X(01)      VALUE 'N'.   01320069
               88  PS-DA-PRRTN-ROWS-FOUND                  VALUE 'Y'.   01330069
               88  PS-DA-NO-PRRTN-ROWS-FOUND               VALUE 'N'.   01340077
           05  PS-DA-CSR-LEFT-SW            PIC X(01)      VALUE 'Y'.   01350001
               88  PS-NO-MORE-DA-ROWS-LEFT                 VALUE 'N'.   01360001
               88  PS-MORE-DA-ROWS-LEFT                    VALUE 'Y'.   01370001
           05  PS-END-OF-DA-PROCESS-SW      PIC X(01)      VALUE 'N'.   01380073
               88  PS-END-OF-DA-NUMBER                     VALUE 'Y'.   01390073
               88  PS-NOT-END-OF-DA-NUMBER                 VALUE 'N'.   01400001
           05  PS-END-OF-DA-CSR-SW         PIC X(01)       VALUE 'N'.   01410073
               88  PS-END-OF-CSR-DA                        VALUE 'Y'.   01420073
               88  PS-NOT-END-OF-CSR-DA                    VALUE 'N'.   01430073
           05  PS-END-OF-DA-FILE-SW        PIC X(01)       VALUE 'N'.   01440073
               88  PS-END-OF-FILE-DA                       VALUE 'Y'.   01450073
               88  PS-NOT-END-OF-FILE-DA                   VALUE 'N'.   01460073
NOBRND     05  PS-DA-BRAND-SW              PIC X(01)       VALUE 'N'.   01470059
NOBRND         88  PS-DA-MISSING-BRAND                     VALUE 'Y'.   01480059
NOBRND         88  PS-DA-MISSING-NEXT                      VALUE 'N'.   01490059
8613F      05  PS-ORACLE-LOGIN-EOF-SW          PIC  X     VALUE 'N'.    01491099
8613F          88  ORACLE-LOGIN-EOF                       VALUE 'Y'.    01492099
                                                                        01500001
                                                                        01510001
      *01  DAT00001.                                                    01520001
      *    10  DR-ALW-NBR                     PIC X(16).                01530001
      *    10  LBL-SEQ-NBR                    PIC S9(10) COMP-3.        01540001
      *    10  EFF-BEG-TMST                   PIC X(19).                01550001
      *    10  EFF-END-TMST                   PIC X(19).                01560001
      *    10  PRRTN-PCT                      PIC S9(3)V9(2) COMP-3.    01570001
      *    10  CRE-BY-USR-ID                  PIC X(8).                 01580001
                                                                        01590001
           05  PV-JOBNAME                  PIC X(08)       VALUE SPACES.01600001
           05  FILLER REDEFINES PV-JOBNAME.                             01610001
               10  PV-JOBNAME-APPL         PIC X(02).                   01620001
                   88  PV-PROD-JOBS                        VALUES ARE   01630001
                       'DA' 'IN' 'MJ' 'ML'.                             01640001
               10  FILLER                  PIC X(06).                   01650001
           05  PV-LAST-COMMIT-RECORD       PIC 9(09)       VALUE ZEROES.01660001
           05  PV-LAST-COMMIT-DR-ALW-NBR   PIC X(16)       VALUE SPACES.01670001
           05  PV-RETRY-COUNT              PIC S9(04)      VALUE ZEROES.01680001
           05  PV-MAX-TABLE-ENTRIES        PIC S9(04)      VALUE ZEROES.01690029
           05  PV-PARAGRAPH-NAME           PIC X(40)       VALUE SPACES.01700001
           05  PV-OPERATION-ATTEMPTED      PIC X(50)       VALUE SPACES.01710001
           05  PV-NULL-RETURN              PIC S9(04)      VALUE ZEROES 01720001
                               COMP.                                    01730001
           05  PV-SYMBOLIC-FOUND           PIC S9(04)      VALUE ZEROES 01740001
                               COMP-3.                                  01750001
           05  PV-EFF-FSCL-MONTH-END-DTE   PIC X(10)       VALUE SPACES.01760001
           05  FILLER REDEFINES PV-EFF-FSCL-MONTH-END-DTE.              01770001
               10  PV-EFF-FSCL-MONTH-END-YYYY                           01780001
                                           PIC X(04).                   01790001
               10  FILLER                  PIC X(01).                   01800001
               10  PV-EFF-FSCL-MONTH-END-MM                             01810001
                                           PIC X(02).                   01820001
               10  FILLER                  PIC X(01).                   01830001
               10  PV-EFF-FSCL-MONTH-END-DD                             01840001
                                           PIC X(02).                   01850001
           05  PV-CURRENT-DATE.                                         01860001
               10  PV-CURR-DTE             PIC X(10)       VALUE SPACES.01870001
               10  PV-CURR-TIME            PIC X(09)       VALUE        01880001
                   '-00.00.00'.                                         01890001
                                                                        01900001
           05  PV-TALLY                    PIC S9(09)      VALUE ZEROES 01910001
                               COMP.                                    01920001
           05  PV-LENGTH                   PIC S9(09)      VALUE ZEROES 01930001
                               COMP.                                    01940001
8613F      05  PV-ORACLE-USERID-LEN            PIC S9(04) VALUE ZEROS.  01941099
8613F      05  PV-ORACLE-PASSWORD-LEN          PIC S9(04) VALUE ZEROS.  01942099
       01  PV-ABEND-CODE                   PIC S9(04)      VALUE ZEROES 01950001
                               COMP SYNC.                               01960001
           88  ABEND-4001-INV-WRITE-KEY                    VALUE +4001. 01970001
           88  ABEND-4002-INV-READ-KEY                     VALUE +4002. 01980001
           88  ABEND-4003-CNTL-CARD-ERRORS                 VALUE +4003. 01990001
           88  ABEND-4004-INTERNAL-ERROR                   VALUE +4004. 02000001
           88  ABEND-4005-OPEN-FILE-ERROR                  VALUE +4005. 02010001
           88  ABEND-4006-CLOSE-FILE-ERROR                 VALUE +4006. 02020001
           88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 02030001
           88  ABEND-4009-INVALID-DATA                     VALUE +4009. 02040001
           88  ABEND-4012-BAD-INTR-SORT                    VALUE +4012. 02050001
           88  ABEND-4013-DB-ERROR                         VALUE +4013. 02060001
                                                                        02070001
                                                                        02080001
       01  WS-MSG-TEXT                     PIC X(512)      VALUE SPACES.02090001
       01  WS-MAX-SIZE                     PIC S9(09)      VALUE +512   02100001
                               COMP.                                    02110001
       01  WS-MSG-LENGTH                   PIC S9(09)      VALUE ZEROES 02120001
                               COMP.                                    02130001
                                                                        02140001
      *----------------------------------------------------------------*02150001
      *    ORACLE DECLARE SECTION                                       02160001
      *----------------------------------------------------------------*02170001
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02180001
       01  USERNAME                       PIC X(10)      VARYING.       02270001
       01  PASSWD                         PIC X(10)      VARYING.       02280001
       01  PV-ORACLE-ID                   PIC X(1)       VALUE '/'.     02290001
                                                                        02300001
      ***************************************************************** 02310001
      *  PROGRAM'S VARIABLES                                          * 02320001
      ***************************************************************** 02330001
       01  PV-PROGRAM-VARIABLES.                                        02340001
           05  DA-CSR-VARIABLES.                                        02350001
               10  DA-CSR-DR-ALW-NBR    PIC X(16)          VALUE SPACES.02360001
               10  DA-CSR-LBL-SEQ-NBR   PIC S9(10)    COMP-3 VALUE ZERO.02370001
               10  DA-CSR-EFF-BEG-TMST  PIC X(19).                      02380046
               10  DA-CSR-EFF-END-TMST  PIC X(19).                      02390046
               10  DA-CSR-PRRTN-PCT     PIC S9(3)V9(2) COMP-3 VALUE 0.  02400046
               10  DA-CSR-CRE-BY-USR-ID PIC X(8).                       02410046
               10  DA-CSR-ML-PRRTN-PCT  PIC S9(3)V9(2) COMP-3 VALUE 0.  02420074
           05  DA-UPDATE-TBL-VARIABLES.                                 02430001
               10  DA-UPD-DR-ALW-NBR    PIC X(16)          VALUE SPACES.02440001
               10  DA-UPD-BRAND-LBL-SEQ PIC S9(10) COMP-3 VALUE ZERO.   02450001
               10  DA-UPD-EFF-BEG-TMST                PIC X(19).        02460001
               10  DA-UPD-EFF-END-TMST                PIC X(19).        02470001
               10  DA-UPD-PRRTN-PCT    PIC S9(3)V9(2) COMP-3 VALUE ZERO.02480001
               10  DA-UPD-CRE-BY-USR-ID               PIC X(8).         02490001
           05  PV-NULL-RETURN          PIC S9(04)  VALUE ZEROES  COMP.  02500001
           05  PV-DA-VARIABLES.                                         02510001
               10  PV-DA-DR-ALW-NBR       PIC X(16)      VALUE SPACES.  02520051
               10  PV-DA-BRAND-LBL-SEQ    PIC S9(10)     COMP-3 VALUE 0.02530099
      *        10  PV-DA-PRRTN-PCT        PIC S9(3)V9(2) COMP-3 VALUE 0.02540051
               10  PV-LAST-DR-ALW-NBR PIC X(16)    VALUE SPACES.        02550069
               10  PV-LAST-PRRTN-LBL PIC S9(10)    COMP-3 VALUE 0.      02560069
           05  PV-TEMP-VARIABLES.                                       02570001
      *        10  ML-TEMP-DR-ALW-NBR   PIC X(16)          VALUE SPACES.02580069
               10  ML-TEMP-LBL-SEQ      PIC  9(10)  COMP-3 VALUE ZERO.  02590001
*********      10  ML-TEMP-PRRTN-PCT  PIC 9(3)V9(4)        VALUE ZERO.  02600001
               10  ML-TEMP-PRRTN-PCT  PIC S9(3)V9(4) COMP   VALUE ZERO. 02610001
               10  DA-INS-PRRTN-PCT   PIC S9(3)V9(4) COMP   VALUE ZERO. 02620099
               10  ML-TEMP-PRRTN-COMP PIC S9(3)V9(2) COMP-3 VALUE ZERO. 02630001
           05  PV-HOLD-VARIABLES.                                       02640001
               10  DA-HOLD-DR-ALW-NBR   PIC X(16)          VALUE SPACES.02650001
               10  DA-HOLD-LBL-SEQ      PIC S9(10)  COMP-3 VALUE ZERO.  02660001
               10  DA-HOLD-LBL-SEQ-COMP PIC S9(10)  COMP   VALUE ZERO.  02670017
               10  DA-HOLD-LBL-SEQ-CHAR PIC  9(16)         VALUE ZERO.  02680021
               10  DA-HOLD-PRRTN-PCT PIC S9(3)V9(2) COMP-3 VALUE ZERO.  02690001
               10  ML-HOLD-DR-ALW-NBR   PIC X(16)          VALUE SPACES.02700001
               10  ML-HOLD-LBL-SEQ      PIC S9(10)  COMP-3 VALUE ZERO.  02710001
               10  ML-HOLD-PRRTN-PCT PIC S9(3)V9(2) COMP-3 VALUE ZERO.  02720001
                                                                        02730001
      *    COPY DARD111.                                                02740029
      ***************************************************************** 02750001
      *  DA REPORT 2  .CSV                                              02760001
      ***************************************************************** 02770001
       01  PRORATION-LAYOUT.                                            02780001
           05  FILLER                    PIC X(1)       VALUE SPACE.    02790010
           05  PRORATION-FSCL-WK-DTL     PIC X(10)      VALUE SPACES.   02800001
           05  FILLER                    PIC X(1)       VALUE ','.      02810001
           05  PRORATION-DEPT-DTL        PIC 9(4)       VALUE ZERO.     02820001
           05  FILLER                    PIC X(1)       VALUE ','.      02830001
           05  PRORATION-TARGET-MIN-DTL  PIC ZZZ9.999- VALUE ZERO.      02840001
           05  FILLER                    PIC X(1)       VALUE ','.      02850001
           05  PRORATION-TARGET-MAX-DTL  PIC ZZZ9.999- VALUE ZERO.      02860001
           05  FILLER                    PIC X(1)       VALUE ','.      02870001
           05  PRORATION-VENDOR-DTL      PIC X(30)      VALUE SPACE.    02880001
           05  FILLER                    PIC X(1)       VALUE ','.      02890001
           05  PRORATION-SCL-DTL         PIC ZZZ9       VALUE ZERO.     02900001
           05  FILLER                    PIC X(1)       VALUE ','.      02910001
           05  PRORATION-DA-NBR-DTL      PIC X(16)      VALUE SPACE.    02920001
           05  FILLER                    PIC X(1)       VALUE ','.      02930001
           05  PRORATION-LBL-SEQ-NBR-DTL PIC  9(16)     VALUE ZERO.     02940029
           05  FILLER                    PIC X(1)    VALUE ','.         02950001
           05  PRORATION-BRAND-NAME-DTL  PIC X(30)     VALUE SPACE.     02960001
           05  FILLER                    PIC X(1)       VALUE ','.      02970001
           05  PRORATION-BRAND-PCT-NEW   PIC 999.9999  VALUE ZERO.      02980001
           05  FILLER                    PIC X(1)       VALUE ','.      02990001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03000001
           05  PRORATION-EXCEPTION-NEG-DTL PIC X(1)   VALUE SPACE.      03010001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03020001
           05  FILLER                    PIC X(1)       VALUE ','.      03030001
           05  FILLER                    PIC X(2)       VALUE SPACE.    03040001
           05  PRORATION-EXCEPTION-ZERO-DTL PIC X(1)  VALUE SPACE.      03050001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03060001
           05  FILLER                    PIC X(1)       VALUE ','.      03070001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03080001
           05  PRORATION-EXCEPTION-CUM-DTL PIC X(1)   VALUE SPACE.      03090001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03100001
           05  FILLER                    PIC X(1)       VALUE ','.      03110001
           05  PRORATION-EIRRTL-BASIS-DTL PIC ZZZZZZZZZ.99- VALUE ZERO. 03120001
           05  FILLER                  PIC X(1)       VALUE ','.        03130001
           05  PRORATION-EIRCOST-BASIS-DTL PIC ZZZZZZZZZ.99- VALUE ZERO.03140001
           05  FILLER                  PIC X(1)       VALUE ','.        03150001
           05  PRORATION-MKUP-PCT-DTL  PIC ZZ9.999-   VALUE ZERO.       03160001
           05  FILLER                  PIC X(1)       VALUE ','.        03170001
           05  PRORATION-DA-COST-DTL   PIC ZZZZZZZZZZ.99 VALUE ZERO.    03180001
           05  FILLER                  PIC X(1)       VALUE ','.        03190001
           05  PRORATION-DA-RTL-DTL    PIC ZZZZZZZZZZ.99 VALUE ZERO.    03200001
           05  FILLER                  PIC X(1)       VALUE ','.        03210001
           05  PRORATION-EIRRTL-APPLIED-DTL PIC Z(9).99- VALUE ZERO.    03220001
           05  FILLER                  PIC X(1)    VALUE ','.           03230001
           05  PRORATION-EIRCOST-APPLIED-DTL PIC Z(9).99- VALUE ZERO.   03240001
           05  FILLER                  PIC X(1)    VALUE ','.           03250001
           05  PRORATION-ALLOCATION-METHOD PIC X(20) VALUE SPACE.       03260001
           05  FILLER                  PIC X(1)       VALUE ','.        03270001
           05  DA-APPL-BRAND-PCT-PREV  PIC 999.9999  VALUE ZERO.        03280001
                                                                        03290001
       01  NEW-PRORATE-OUTPUT.                                          03300001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03310010
           05  PRORATE-FSCL-WK-DTL     PIC X(10)      VALUE SPACES.     03320001
           05  FILLER                    PIC X(1)       VALUE ','.      03330001
           05  PRORATE-DEPT-DTL        PIC ZZZ9       VALUE ZERO.       03340001
           05  FILLER                    PIC X(1)       VALUE ','.      03350001
           05  PRORATE-TARGET-MIN-DTL  PIC ZZZ9.999- VALUE ZERO.        03360001
           05  FILLER                    PIC X(1)       VALUE ','.      03370001
           05  PRORATE-TARGET-MAX-DTL  PIC ZZZ9.999- VALUE ZERO.        03380001
           05  FILLER                    PIC X(1)       VALUE ','.      03390001
           05  PRORATE-VENDOR-DTL      PIC X(30)      VALUE SPACE.      03400001
           05  FILLER                    PIC X(1)       VALUE ','.      03410001
           05  PRORATE-SCL-DTL         PIC ZZZ9       VALUE ZERO.       03420001
           05  FILLER                    PIC X(1)       VALUE ','.      03430001
           05  PRORATE-DA-NBR-DTL      PIC X(16)      VALUE SPACE.      03440001
           05  FILLER                    PIC X(1)       VALUE ','.      03450001
           05  PRORATE-LBL-SEQ-NBR-DTL PIC  9(16)     VALUE ZERO.       03460024
           05  FILLER                    PIC X(1)    VALUE ','.         03470001
           05  PRORATE-BRAND-NAME-DTL  PIC X(30)     VALUE SPACE.       03480001
           05  FILLER                    PIC X(1)       VALUE ','.      03490001
           05  PRORATE-BRAND-PCT-NEW   PIC 999.9999  VALUE ZERO.        03500026
           05  FILLER                    PIC X(1)       VALUE ','.      03510001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03520001
           05  PRORATE-EXCEPTION-NEG-DTL PIC X(1)   VALUE SPACE.        03530001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03540001
           05  FILLER                    PIC X(1)       VALUE ','.      03550001
           05  FILLER                    PIC X(2)       VALUE SPACE.    03560001
           05  PRORATE-EXCEPTION-ZERO-DTL PIC X(1)  VALUE SPACE.        03570001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03580001
           05  FILLER                    PIC X(1)       VALUE ','.      03590001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03600001
           05  PRORATE-EXCEPTION-CUM-DTL PIC X(1)   VALUE SPACE.        03610001
           05  FILLER                    PIC X(1)       VALUE SPACE.    03620001
           05  FILLER                    PIC X(1)       VALUE ','.      03630001
           05  PRORATE-EIRRTL-BASIS-DTL PIC ZZZZZZZZZ.99- VALUE ZERO.   03640001
           05  FILLER                  PIC X(1)       VALUE ','.        03650001
           05  PRORATE-EIRCOST-BASIS-DTL PIC ZZZZZZZZZ.99- VALUE ZERO.  03660001
           05  FILLER                  PIC X(1)       VALUE ','.        03670001
           05  PRORATE-MKUP-PCT-DTL  PIC 999.999-   VALUE ZERO.         03680026
           05  FILLER                  PIC X(1)       VALUE ','.        03690001
           05  PRORATE-DA-COST-DTL   PIC ZZZZZZZZZZ.99 VALUE ZERO.      03700001
           05  FILLER                  PIC X(1)       VALUE ','.        03710001
           05  PRORATE-DA-RTL-DTL    PIC ZZZZZZZZZZ.99 VALUE ZERO.      03720001
           05  FILLER                  PIC X(1)       VALUE ','.        03730001
           05  PRORATE-EIRRTL-APPLIED-DTL PIC  Z(9).99- VALUE ZERO.     03740001
           05  FILLER                  PIC X(1)    VALUE ','.           03750001
           05  PRORATE-EIRCOST-APPLIED-DTL PIC Z(9).99- VALUE ZERO.     03760001
           05  FILLER                  PIC X(1)    VALUE ','.           03770001
           05  PRORATE-ALLOCATION-METHOD PIC X(20) VALUE SPACE.         03780001
           05  FILLER                  PIC X(1)       VALUE ','.        03790001
           05  PRORATE-DA-BRAND-PCT    PIC 999.9999  VALUE ZERO.        03800026
                                                                        03810001
                                                                        03820069
       01  DA-REPORT-TEMP.                                              03830074
           05  DA-TEMP-DR-ALW-NBR    PIC X(16)            VALUE SPACES. 03840074
           05  DA-TEMP-LBL-SEQ-NBR   PIC S9(10)           VALUE 0.      03850074
           05  DA-TEMP-EFF-BEG-TMST  PIC X(19).                         03860074
           05  DA-TEMP-EFF-END-TMST  PIC X(19).                         03870074
           05  DA-TEMP-PRRTN-PCT     PIC S9(3)V9(2) COMP   VALUE 0.     03880074
           05  DA-TEMP-CRE-BY-USR-ID PIC X(8).                          03890074
           05  DA-TEMP-ML-PRRTN-PCT  PIC S9(3)V9(2) COMP   VALUE 0.     03900074
           05  DA-TEMP-SOURCE        PIC X(10).                         03910074
           05  DA-TEMP-ACTIVITY      PIC X(10).                         03920074
                                                                        03930069
       01  DA-PERCENTAGE-REPORT.                                        03940074
           05  DA-RPT-DR-ALW-NBR    PIC X(16)           VALUE SPACES.   03950074
           05  FILLER               PIC X(1)       VALUE ','.           03960082
           05  DA-RPT-LBL-SEQ-NBR   PIC ZZZZZZZZZ9.                     03970077
           05  FILLER               PIC X(1)       VALUE ','.           03980082
           05  DA-RPT-EFF-BEG-TMST  PIC X(19)           VALUE SPACES.   03990074
           05  FILLER               PIC X(1)       VALUE ','.           04000082
           05  DA-RPT-EFF-END-TMST  PIC X(19)           VALUE SPACES.   04010074
           05  FILLER               PIC X(1)       VALUE ','.           04020082
           05  DA-RPT-PRRTN-PCT     PIC ZZ9.99.                         04030077
           05  FILLER               PIC X(1)       VALUE ','.           04040082
           05  DA-RPT-CRE-BY-USR-ID PIC X(8)            VALUE SPACES.   04050079
           05  FILLER               PIC X(1)       VALUE ','.           04060082
           05  DA-RPT-ML-PRRTN-PCT  PIC ZZ9.99.                         04070077
           05  FILLER               PIC X(1)            VALUE ','.      04080082
           05  DA-RPT-SOURCE        PIC X(10)           VALUE SPACES.   04090074
           05  FILLER               PIC X(1)            VALUE ','.      04100082
           05  DA-RPT-ACTIVITY      PIC X(10)           VALUE SPACES.   04110077
                                                                        04120074
      ******************************************************************04130069
      * COBOL DECLARATION FOR ORACLE BRAND PRORATION TABLE              04140046
      ******************************************************************04150046
      *    EXEC SQL                                                     04160046
      *        INCLUDE DAT_BRND_PRRTN                                   04170046
      *    END-EXEC.                                                    04180046
                                                                        04190046
      *    EXEC SQL                                                     04200046
      *        INCLUDE DAT00001                                         04210046
      *    END-EXEC.                                                    04220046
      ******************************************************************04230001
      * COBOL DECLARATION FOR DB2 BRAND DESCRIPTION TABLE               04240030
      ******************************************************************04250001
           EXEC SQL                                                     04260001
               INCLUDE TVSCHVL                                          04270001
           END-EXEC.                                                    04280001
      ******************************************************************04290030
      * COBOL DECLARATION FOR ORACLE DEBIT ALLOWANCE TABLE              04300030
      ******************************************************************04310030
           EXEC SQL                                                     04320030
               INCLUDE TDAALW                                           04330030
           END-EXEC.                                                    04340030
      ******************************************************************04350030
      * COBOL DECLARATION FOR DB2 VENDOR TABLE                          04360030
      ******************************************************************04370030
           EXEC SQL                                                     04380030
               INCLUDE TENTNME                                          04390030
           END-EXEC.                                                    04400030
      ******************************************************************04410030
      * COBOL DECLARATION FOR DB2 BRAND TABLE                           04420030
      ******************************************************************04430030
           EXEC SQL                                                     04440030
               INCLUDE TDAALW                                           04450030
           END-EXEC.                                                    04460030
      ******************************************************************04470045
      * COBOL DECLARATION FOR TABLE TDAALW                             *04480045
      ******************************************************************04490045
       01  DCLTDAALW.                                                   04500046
           10  DAALW-DR-ALW-NBR            PIC X(16).                   04510046
           10  DAALW-DEPT-NBR              PIC X(3).                    04520046
           10  DAALW-MAJ-CL-NBR            PIC X(2).                    04530046
           10  DAALW-SUB-CL-NBR            PIC X(2).                    04540046
           10  DAALW-ENT-ID                PIC S9(10) COMP-3.           04550046
           10  DAALW-TYP-CDE               PIC X(2).                    04560046
           10  DAALW-EFF-DTE               PIC X(19).                   04570046
           10  DAALW-FSCL-MN-NBR           PIC S9(2) COMP-3.            04580046
           10  DAALW-FSCL-YR-NBR           PIC S9(4) COMP-3.            04590046
           10  DAALW-STAT-CDE              PIC X(2).                    04600046
           10  DAALW-CLLCTN-MTHD-CDE       PIC X(2).                    04610046
           10  DAALW-CLLCTN-DAYS-NBR       PIC S9(3) COMP-3.            04620046
           10  DAALW-NET-CST-AMT           PIC S9(7)V9(2) COMP-3.       04630046
           10  DAALW-MKUP-PCT              PIC S9(3)V9(2) COMP-3.       04640046
           10  DAALW-CENPPC-NBR            PIC S9(7) COMP-3.            04650046
           10  DAALW-PO-NBR                PIC S9(10) COMP-3.           04660046
           10  DAALW-RSN-CDE               PIC X(2).                    04670046
           10  DAALW-CRE-BY-USR-ID         PIC X(8).                    04680046
           10  DAALW-CRE-DTE               PIC X(19).                   04690046
           10  DAALW-DMM-UPD-BY-USR-ID     PIC X(8).                    04700046
           10  DAALW-DMM-UPD-DTE           PIC X(19).                   04710046
           10  DAALW-AP-UPD-BY-USR-ID      PIC X(8).                    04720046
           10  DAALW-AP-UPD-DTE            PIC X(19).                   04730046
           10  DAALW-LAST-UPD-BY-USR-ID    PIC X(8).                    04740046
           10  DAALW-LAST-UPD-DTE          PIC X(19).                   04750046
           10  DAALW-CPLT-DTE              PIC X(19).                   04760046
      ******************************************************************04770045
      * THE NUMBER OF COLUMNS DESCRIBED BY THIS DECLARATION IS 26      *04780045
      ******************************************************************04790045
      ******************************************************************04800001
      * COBOL DECLARATION FOR TABLE K_DA01.DAT_BRND_PRRTN              *04810001
      ******************************************************************04820001
       01  DA-BRAND-PRRTN-TABLE.                                        04830001
           05  DA-PRRTN-ENTRIES OCCURS 199 TIMES.                       04840099
               10  DA-DR-ALW-NBR              PIC X(16).                04850079
               10  DA-LBL-SEQ-NBR             PIC S9(10) COMP-3.        04860079
               10  DA-EFF-BEG-TMST            PIC X(19).                04870079
               10  DA-EFF-END-TMST            PIC X(19).                04880079
               10  DA-PRRTN-PCT               PIC S9(3)V9(2) COMP-3.    04890079
               10  DA-CRE-BY-USR-ID           PIC X(8).                 04900079
               10  ML-PRRTN-PCT               PIC S9(3)V9(2) COMP-3.    04910079
      ***      15  DA-SOURCE                  PIC X(10).                04920079
      *                                                                 04930001
      ******************************************************************04940032
      *                                                                 04950032
      ******************************************************************04960032
      *                                                                 04970032
       01  REPORT-FIELD-ENTRIES.                                        04980032
           05  RPT-DEPT-NBR                  PIC X(03).                 04990045
           05  RPT-SUB-CL-NBR                PIC X(02).                 05000045
           05  RPT-ENT-ID                    PIC S9(10) COMP-3.         05010045
           05  RPT-ENT-NAME-DESC             PIC X(30).                 05020032
           05  RPT-CHARTC-VAL-DESC           PIC X(20).                 05030042
           05  RPT-NET-CST-AMT               PIC S9(7)V9(2) COMP-3.     05040045
           05  RPT-MKUP-PCT                  PIC S9(3)V9(2) COMP-3.     05050045
      *                                                                 05060032
      *                                                                 05070032
      *                                                                 05080032
       01  DA-SUBSCRIPT.                                                05090032
           05  SS-DA                        PIC S9(04)     COMP SYNC    05100001
                                                           VALUE ZERO.  05110001
      ******************************************************************05120001
      ***************************************************************** 05130001
      *    DAT_BRND_PRRTN CURSOR -                                      05140045
      *    THE INPUT DA NUMBER WILL BE USED AS THE DRIVING CRITERIA.    05150001
      ***************************************************************** 05160001
      * JOIN OF DA TABLE AND BRAND PRORATION TABLES                     05170001
      *                                                                 05180001
           EXEC SQL                                                     05190001
               DECLARE DA_BRAND_CSR CURSOR FOR                          05200001
                  SELECT DR_ALW_NBR                                     05210001
                       , LBL_SEQ_NBR                                    05220001
                       , EFF_BEG_TMST                                   05230001
                       , EFF_END_TMST                                   05240001
                       , PRRTN_PCT                                      05250001
                       , CRE_BY_USR_ID                                  05260001
                    FROM DAT_BRND_PRRTN                                 05270001
                  WHERE TRIM(DR_ALW_NBR)  = TRIM(:PV-DA-DR-ALW-NBR)     05280001
                   ORDER BY DR_ALW_NBR, LBL_SEQ_NBR, PRRTN_PCT          05290001
      *              FOR UPDATE NOWAIT                                  05300001
           END-EXEC.                                                    05310001
                                                                        05320001
      *                                                                 05330001
      *                                                                 05340001
           EXEC SQL END DECLARE SECTION END-EXEC.                       05350001
      *                                                                 05360001
      *                                                                 05370001
      * ORA COMMUNICATION AREA                                          05380001
      *                                                                 05390001
        01       SQLCA.                                                 05400001
                 05  SQLCAID               PIC X(8).                    05410001
                 05  SQLCABC               PIC S9(9) COMPUTATIONAL.     05420001
                 05  SQLCODE               PIC S9(9) COMPUTATIONAL.     05430001
                 05  SQLERRM.                                           05440001
                     49 SQLERRML           PIC S9(4) COMPUTATIONAL.     05450001
                     49 SQLERRMC           PIC X(70).                   05460001
                 05  SQLERRP               PIC X(8).                    05470001
                 05  SQLERRD OCCURS 6 TIMES                             05480001
                                           PIC S9(9) COMPUTATIONAL.     05490001
                 05  SQLWARN.                                           05500001
                     10 SQLWARN0           PIC X(1).                    05510001
                     10 SQLWARN1           PIC X(1).                    05520001
                     10 SQLWARN2           PIC X(1).                    05530001
                     10 SQLWARN3           PIC X(1).                    05540001
                     10 SQLWARN4           PIC X(1).                    05550001
                     10 SQLWARN5           PIC X(1).                    05560001
                     10 SQLWARN6           PIC X(1).                    05570001
                     10 SQLWARN7           PIC X(1).                    05580001
                 05  SQLEXT                PIC X(8).                    05590001
       01 SQLSTATE                  PIC X(8).                           05600001
      ******************************************************************05610001
      * ORA COMMUNICATION AREA2                                         05620001
           COPY SQLCA2.                                                 05630001
                                                                        05640001
       LINKAGE SECTION.                                                 05650001
                                                                        05660001
                                                                        05670001
       PROCEDURE DIVISION.                                              05680001
                                                                        05690001
      ******************************************************************05700001
      *    MAINLINE LOGIC                                              *05710001
      ******************************************************************05720001
                                                                        05730001
       0000-MAINLINE.                                                   05740001
                                                                        05750001
           PERFORM 1000-INITIALIZATION.                                 05760001
                                                                        05770001
           IF NOT PS-END-OF-FILE                                        05780001
               DISPLAY ' ****** EXECUTING DA PRORATION PROCESS ******'  05790061
               DISPLAY '        READ-NEXT BYPASSING HEADER RECORD'      05800061
               PERFORM 7000-READ-ML-PRORATION-FILE                      05810069
               MOVE PRORATION-FSCL-WK-DTL TO PV-CURR-DTE                05820069
                                                                        05830001
               PERFORM 2000-PROCESS-DEBITS                              05840069
                   UNTIL PS-END-OF-FILE                                 05850069
      *                                                                 05860069
           END-IF.                                                      05870013
                                                                        05880013
           PERFORM 9900-EOJ-LOGIC.                                      05890013
                                                                        05900013
           GOBACK.                                                      05910001
                                                                        05920001
      ******************************************************************05930001
      *    LOGON TO ORACLE, AND DECLARE THE ORACLE CURSORS.            *05940001
      ******************************************************************05950001
       1000-INITIALIZATION.                                             05960001
                                                                        05970001
           OPEN INPUT  ORACLE-LOGIN-FILE.                               05981099
                                                                        05990001
           PERFORM 7200-LOGON-TO-ORACLE.                                06120099
                                                                        06140001
           OPEN INPUT  ML-PRORATION-FILE.                               06150001
           OPEN OUTPUT ML-DA-PRORATION-FILE                             06160069
                       DA-PRORATION-FILE.                               06170069
                                                                        06180001
           PERFORM 7000-READ-ML-PRORATION-FILE.                         06190001
                                                                        06200001
           IF NOT PS-END-OF-FILE                                        06210077
      *        DISPLAY ' INPUT HEADER : ', PRORATION-LAYOUT             06220061
               WRITE ML-DA-PRORATION-RECORD FROM PRORATION-LAYOUT       06230001
               MOVE 0                     TO PA-ML-RECORDS-READ         06240069
               MOVE 0                     TO PA-ROWS-FETCHED            06250069
               MOVE 0                     TO PA-ROWS-UPDATED            06260069
               MOVE 0                     TO PA-ROWS-INSERTED           06270069
               MOVE 0                     TO PA-ROWS-TO-COMMIT          06280069
               MOVE 0                     TO PA-NUMBER-OF-COMMIT        06290069
               MOVE 0                     TO PA-ML-RECORDS-WRITTEN      06300069
               MOVE 0                     TO PA-DA-RECORDS-WRITTEN      06310069
           ELSE                                                         06320077
               DISPLAY '****** NO DAS WERE PROCESSED FOR UPDATE *****'  06330077
           END-IF.                                                      06340001
                                                                        06350001
      ******************************************************************06360001
      *    2000-PROCESS-DEBITS                                         *06370069
      *      1. READ A FILE RECORD AND RETIEVES DAT_PRRTN PCTS FOR DA   06380069
      *      2. WRITES OUT DA-REPORT RECORD FOR EACH ROW RETRIEVED      06390069
      *      3. ZERO OUT ALL DAT_PRRTN_PCT VALUE DAT_BRND_PRRTN         06400069
      *      4. PERFORM UPDATES AND/OR INSERTS TO DAT_BRND_PRRTN TABLE  06410069
      ******************************************************************06420001
       2000-PROCESS-DEBITS.                                             06430069
      *                                                                 06440001
           SET PS-MORE-DA-TABLE-ROWS TO TRUE.                           06450002
      *    THIS SECTION LOADS THE DAT_PRRTN_PCT UPDATE VARIABLES        06460069
           MOVE PRORATION-DA-NBR-DTL TO PV-LAST-DR-ALW-NBR              06470086
                                                                        06480069
           PERFORM 2100-PROCESS-DA                                      06490069
               UNTIL PRORATION-DA-NBR-DTL > PV-LAST-DR-ALW-NBR          06500069
                  OR PS-END-OF-FILE.                                    06510077
      *                                                                 06520050
           PERFORM 9000-COMMIT-CHANGES.                                 06530099
      **                                                                06540069
      ******************************************************************06550069
      *  2100-PROCESS-DA                                                06560069
      *  1) PROCESS ALL DA PRORATION ROWS FOR DR_ALW_NBR                06570069
      *  2) LOAD DA TABLE                                               06580069
      *  3) WRITE DA OUTPUT 2 FILE OF ORIGINAL PCTS                     06590069
      ******************************************************************06600069
       2100-PROCESS-DA.                                                 06610069
      *                                                                 06620069
           DISPLAY '***PROCESS DA-NBR: ' PRORATION-DA-NBR-DTL           06630095
      *                                                                 06640069
           PERFORM 4000-PROCESS-DAT-BRND-PRRTN.                         06650074
                                                                        06660069
           IF PS-DA-NO-PRRTN-ROWS-FOUND                                 06670069
      *        NO DA ROWS - JUST ML INSERTS TO DAT_BRND_PRRTN           06680069
               PERFORM                                                  06690070
               UNTIL PRORATION-DA-NBR-DTL > PV-LAST-DR-ALW-NBR          06700070
                                                                        06710070
                   PERFORM 3000-ML-INSERT-PROCESS                       06720074
                   PERFORM 9000-COMMIT-CHANGES                          06730070
                   PERFORM 7000-READ-ML-PRORATION-FILE                  06740070
               END-PERFORM                                              06750078
           ELSE                                                         06760069
      *        DA ROWS FOUND - PERFORM ML UPDATES TO DAT_BRND_PRRTN     06770069
               IF PS-DA-PRRTN-ROWS-FOUND                                06780069
                   MOVE 1 TO SS-DA                                      06790073
                   SET PS-NOT-END-OF-CSR-DA        TO TRUE              06800087
                   SET PS-NOT-END-OF-FILE-DA       TO TRUE              06810087
                   SET PS-NOT-END-OF-DA-NUMBER TO TRUE                  06820074
      ************                                                      06830076
      *            4300-CLEAR-DA WILL ZERO OUT ALL DAT_BRND_PRRTN ROWS  06840076
      *            FOR THE CURRENT DA NUMBER.                           06850076
UPDATE*                                                                 06860099
UPDATE         DISPLAY '   >>>ZERO OUT BRAND PRORATION % DAT_BRND_PRRTN'06870099
UPDATE             PERFORM 4300-CLEAR-DA-PRRTN-PCTS                     06880099
UPDATE             PERFORM 9000-COMMIT-CHANGES                          06890099
UPDATE*                                                                 06900099
      *            ML UPDATES OF 0% ARE BYPASSED                        06910076
      ************                                                      06920076
                   PERFORM 2300-UPDATE-PROCESS                          06930075
                       UNTIL PS-END-OF-DA-NUMBER                        06940071
               END-IF                                                   06950069
           END-IF.                                                      06960069
      *                                                                 06970069
      *                                                                 06980074
      ******************************************************************06990074
      *                                                                 07000075
      ******************************************************************07010075
       2300-UPDATE-PROCESS.                                             07020075
      *                                                                 07030075
                                                                        07040075
           IF PS-NOT-END-OF-FILE-DA                                     07050099
              IF DA-DR-ALW-NBR(SS-DA) NOT EQUAL SPACES                  07060099
                 IF PRORATION-LBL-SEQ-NBR-DTL = DA-LBL-SEQ-NBR(SS-DA)   07070099
      * MATCHING BRAND                                                  07080075
                     MOVE PRORATION-BRAND-PCT-NEW TO ML-TEMP-PRRTN-PCT  07090094
                     IF ML-TEMP-PRRTN-PCT > 0                           07100099
                        PERFORM 3400-UPDATE-MATCHING-BRAND              07110075
                        PERFORM 7000-READ-ML-PRORATION-FILE             07120092
                        ADD 1 TO SS-DA                                  07130091
                     ELSE                                               07140099
                        DISPLAY '   *** UPDATE BYPASSED : ',            07150099
                                        DA-LBL-SEQ-NBR(SS-DA)           07160095
                        PERFORM 7000-READ-ML-PRORATION-FILE             07170092
                        ADD 1 TO SS-DA                                  07180091
                     END-IF                                             07190099
                 ELSE                                                   07200099
      * DA ONLY BRAND                                                   07210093
                   IF PRORATION-LBL-SEQ-NBR-DTL > DA-LBL-SEQ-NBR(SS-DA) 07220099
                      PERFORM 5400-INSERT-ML-RPT-DA-RECORD              07230075
                      ADD 1 TO SS-DA                                    07240075
                   ELSE                                                 07250099
      * ML ONLY BRAND                                                   07260093
                   IF PRORATION-LBL-SEQ-NBR-DTL < DA-LBL-SEQ-NBR(SS-DA) 07270099
                      IF ML-TEMP-PRRTN-PCT > 0                          07280099
                          DISPLAY '   *** ML < DA INSERTED: ',          07290099
                                          PRORATION-LBL-SEQ-NBR-DTL     07300099
                          PERFORM 3000-ML-INSERT-PROCESS                07310099
                      ELSE                                              07320099
                          PERFORM 5200-ML-REPORT-NO-DA                  07330099
                      END-IF                                            07340099
                      PERFORM 7000-READ-ML-PRORATION-FILE               07350099
                   END-IF                                               07360099
                 END-IF                                                 07370099
              ELSE                                                      07380099
                 SET PS-END-OF-CSR-DA TO TRUE                           07390099
      *    ONLY ML BRANDS LEFT TO PROCESS                               07400093
                 IF NOT PS-END-OF-FILE                                  07410099
                     PERFORM UNTIL (PRORATION-DA-NBR-DTL >              07420099
                                    PV-LAST-DR-ALW-NBR)                 07430099
                                 OR PS-END-OF-FILE                      07440099
                         IF ML-TEMP-PRRTN-PCT > 0                       07450099
                              DISPLAY '   *** MLONLY INSERTED : ',      07460099
                                          PRORATION-LBL-SEQ-NBR-DTL     07470099
                             PERFORM 3000-ML-INSERT-PROCESS             07480099
                         ELSE                                           07490099
                             PERFORM 5200-ML-REPORT-NO-DA               07500099
                         END-IF                                         07510099
                         PERFORM 7000-READ-ML-PRORATION-FILE            07520099
                     END-PERFORM                                        07530099
                 END-IF                                                 07540099
              END-IF                                                    07550099
           ELSE                                                         07560099
      *    ONLY DA BRANDS LEFT TO PROCESS                               07570093
               PERFORM UNTIL DA-DR-ALW-NBR(SS-DA) EQUAL SPACES          07580092
                   PERFORM 5400-INSERT-ML-RPT-DA-RECORD                 07590089
                   ADD 1 TO SS-DA                                       07600089
               END-PERFORM                                              07610089
               SET PS-END-OF-CSR-DA TO TRUE                             07620089
           END-IF.                                                      07630099
                                                                        07640089
      *                                                                 07650075
           IF (PRORATION-DA-NBR-DTL > PV-LAST-DR-ALW-NBR OR             07660099
               PS-END-OF-FILE)                                          07670099
               SET PS-END-OF-FILE-DA TO TRUE                            07680076
           END-IF.                                                      07690076
      *                                                                 07700075
           IF (PS-END-OF-CSR-DA AND                                     07710092
               PS-END-OF-FILE-DA)                                       07720092
               SET PS-END-OF-DA-NUMBER TO TRUE                          07730092
           END-IF.                                                      07740092
      *                                                                 07750075
      ******************************************************************07760074
      *  ML HAS IT BUT DA DOES NOT                                      07770074
      *  INSERT DA TO TABLE AND MOVE ZEROES TO DA PRRTN                 07780074
      ******************************************************************07790074
       3000-ML-INSERT-PROCESS.                                          07800074
      *                                                                 07810074
      *    WRITE BOTH ML AND DA REPORTS                                 07820074
           PERFORM 5200-ML-REPORT-NO-DA.                                07830083
           PERFORM 5300-DA-REPORT-ML-PRRTN.                             07840083
      *                                                                 07850074
      *    INSERT ROW TO DAT_BRND_PRRTN                                 07860074
           PERFORM 3100-INSERT-DA-PRRTN.                                07870074
      *                                                                 07880075
      ******************************************************************07890075
      *                                                                 07900075
      *                                                                 07910075
      ******************************************************************07920075
       3100-INSERT-DA-PRRTN.                                            07930075
      *                                                                 07940075
            MOVE PRORATION-BRAND-PCT-NEW TO DA-INS-PRRTN-PCT            07950099
                                                                        07960099
            IF DA-INS-PRRTN-PCT > 0                                     07970099
      *                                                                 07980075
               MOVE PRORATION-DA-NBR-DTL      TO  DA-UPD-DR-ALW-NBR     07990099
               MOVE PRORATION-LBL-SEQ-NBR-DTL TO  DA-UPD-BRAND-LBL-SEQ  08000099
               MOVE PV-CURRENT-DATE           TO  DA-UPD-EFF-BEG-TMST   08010099
               MOVE SPACE                     TO  DA-UPD-EFF-END-TMST   08020099
               MOVE PRORATION-BRAND-PCT-NEW   TO  DA-UPD-PRRTN-PCT      08030099
               MOVE 'DAKUP206'                TO  DA-UPD-CRE-BY-USR-ID  08040099
                                                                        08050083
               DISPLAY '   *** INSERT : ',  DA-UPD-DR-ALW-NBR, ' - '    08060099
                                         ,  DA-UPD-BRAND-LBL-SEQ, ' - ' 08070099
                                         ,  DA-UPD-PRRTN-PCT            08080099
UPDATE********                                                          08090099
UPDATE*                                                                 08100099
UPDATE      PERFORM 4100-INSERT-NEW-ROW                                 08110099
UPDATE*                                                                 08120099
UPDATE********                                                          08130099
                                                                        08140075
            END-IF.                                                     08150078
      *                                                                 08160075
      ******************************************************************08170075
      *                                                                 08180075
      *                                                                 08190075
      ******************************************************************08200075
       3400-UPDATE-MATCHING-BRAND.                                      08210075
      *                                                                 08220075
            MOVE DA-DR-ALW-NBR(SS-DA)    TO  DA-UPD-DR-ALW-NBR          08230075
            MOVE DA-LBL-SEQ-NBR(SS-DA)   TO  DA-UPD-BRAND-LBL-SEQ       08240075
            MOVE PRORATION-BRAND-PCT-NEW TO  DA-UPD-PRRTN-PCT           08250075
      *                                                                 08260075
            DISPLAY '   *** UPDATE : ',  DA-UPD-DR-ALW-NBR, ' - '       08270095
                                      ,  DA-UPD-BRAND-LBL-SEQ, ' - '    08280083
                                      ,  DA-UPD-PRRTN-PCT               08290083
      *                                                                 08300083
UPDATE********                                                          08310099
UPDATE*                                                                 08320099
UPDATE      PERFORM 4200-UPDATE-BRND-PRRTN                              08330099
UPDATE*                                                                 08340099
UPDATE********                                                          08350099
            MOVE PRORATION-LAYOUT        TO NEW-PRORATE-OUTPUT.         08360099
            MOVE DA-PRRTN-PCT(SS-DA)     TO PRORATE-DA-BRAND-PCT.       08370075
            PERFORM 7500-WRITE-PRORATE-FILE                             08380075
      *                                                                 08390075
      *     PREP DA-PRRTN-PCT REPORT                                    08400092
            MOVE  DA-UPD-DR-ALW-NBR      TO DA-TEMP-DR-ALW-NBR          08410093
            MOVE  DA-UPD-BRAND-LBL-SEQ   TO DA-TEMP-LBL-SEQ-NBR         08420093
            MOVE  DA-EFF-BEG-TMST(SS-DA) TO DA-TEMP-EFF-BEG-TMST        08430098
            MOVE  DA-EFF-END-TMST(SS-DA) TO DA-TEMP-EFF-END-TMST        08440098
            MOVE  ZEROES                 TO DA-TEMP-PRRTN-PCT           08450093
            MOVE  'DAKUP206'             TO DA-TEMP-CRE-BY-USR-ID       08460093
            MOVE  DA-UPD-PRRTN-PCT       TO DA-TEMP-ML-PRRTN-PCT        08470093
            MOVE  'ML BRAND %'           TO DA-TEMP-SOURCE              08480097
            MOVE  'UPDATE    '           TO DA-TEMP-ACTIVITY            08490092
            PERFORM 5100-DA-REPORT-WITH-PRRTN.                          08500092
                                                                        08510092
      *                                                                 08520075
      ******************************************************************08530074
      * 4000-PROCESS-DAT-BRND-PRRTN                                     08540074
      *      THIS IS PARAGRAPH WILL UPDATE DAT_BRND_PRRTN               08550074
      ******************************************************************08560074
      *                                                                 08570074
       4000-PROCESS-DAT-BRND-PRRTN.                                     08580074
      *                                                                 08590074
           MOVE 1 TO SS-DA.                                             08600074
           SET PS-NO-MORE-DA-ROWS-LEFT   TO TRUE.                       08610074
           SET PS-DA-NO-PRRTN-ROWS-FOUND TO TRUE.                       08620074
      *    CSR VARIABLE                                                 08630074
           MOVE PRORATION-DA-NBR-DTL     TO PV-DA-DR-ALW-NBR            08640074
      *                                                                 08650074
           PERFORM 8000-OPEN-TDAALW-CSR                                 08660074
           PERFORM 8200-FETCH-TDAALW                                    08670074
      *                                                                 08680074
           IF PS-MORE-DA-ROWS-LEFT                                      08690078
               SET PS-DA-PRRTN-ROWS-FOUND TO TRUE                       08700074
                                                                        08710074
               INITIALIZE DA-BRAND-PRRTN-TABLE                          08720080
                                                                        08730074
               PERFORM VARYING SS-DA FROM +1 BY +1                      08740074
                   UNTIL PS-NO-MORE-DA-ROWS-LEFT                        08750074
                                                                        08760074
                   PERFORM 6000-LOAD-TABLE-DAT-BRND-PRRTN               08770074
                   PERFORM 8200-FETCH-TDAALW                            08780074
               END-PERFORM                                              08790078
           ELSE                                                         08800074
               PERFORM 5000-DA-REPORT-NO-PRRTN                          08810074
               SET PS-DA-NO-PRRTN-ROWS-FOUND TO TRUE                    08820074
           END-IF.                                                      08830074
                                                                        08840074
      *                                                                 08850074
      ******************************************************************08860074
      * ML ALLOCATED BRAND DOLLARS AND DA SYSTEM HAD NO BRAND PCTS      08870074
      ******************************************************************08880074
       4100-INSERT-NEW-ROW.                                             08890074
      *                                                                 08900074
      *                                                                 08910074
           EXEC SQL                                                     08920074
             INSERT INTO DAT_BRND_PRRTN                                 08930074
                 ( DR_ALW_NBR                                           08940074
                  ,LBL_SEQ_NBR                                          08950074
                  ,EFF_BEG_TMST                                         08960074
                  ,EFF_END_TMST                                         08970074
                  ,PRRTN_PCT                                            08980074
                  ,CRE_BY_USR_ID)                                       08990074
             VALUES                                                     09000074
               (  :DA-UPD-DR-ALW-NBR                                    09010074
                 ,:DA-UPD-BRAND-LBL-SEQ                                 09020074
                 ,TO_DATE(:DA-UPD-EFF-BEG-TMST, 'YYYY-MM-DD-HH24.MI.SS')09030074
                 ,TO_DATE(:DA-UPD-EFF-END-TMST, 'YYYY-MM-DD-HH24.MI.SS')09040074
                 ,:DA-UPD-PRRTN-PCT                                     09050074
                 ,:DA-UPD-CRE-BY-USR-ID)                                09060074
           END-EXEC.                                                    09070074
      *                                                                 09080074
                                                                        09090074
           EVALUATE TRUE                                                09100074
               WHEN SQLCODE = 0                                         09110074
                   DISPLAY '   *** ROW INSERTED '                       09120099
                   ADD +1   TO PA-ROWS-INSERTED                         09130074
               WHEN SQLCODE = +1403                                     09140099
                   DISPLAY '   *** ROW FAILED TO BE INSERTED !!! ',     09150099
                           ' LBL SEQ ', DA-UPD-BRAND-LBL-SEQ            09160099
               WHEN OTHER                                               09170099
                   PERFORM 9990-SQL-ERROR                               09180074
           END-EVALUATE.                                                09190074
      ******************************************************************09200075
      *                                                                 09210075
      *                                                                 09220075
      ******************************************************************09230075
       4200-UPDATE-BRND-PRRTN.                                          09240075
                                                                        09250075
                                                                        09260075
           EXEC SQL                                                     09270075
             UPDATE DAT_BRND_PRRTN                                      09280075
                SET PRRTN_PCT         = :DA-UPD-PRRTN-PCT               09290075
              WHERE TRIM(DR_ALW_NBR)  = TRIM(:DA-UPD-DR-ALW-NBR)        09300075
               AND  LBL_SEQ_NBR       = :DA-UPD-BRAND-LBL-SEQ           09310075
               AND  EFF_END_TMST IS NULL                                09320081
           END-EXEC.                                                    09330075
                                                                        09340075
           EVALUATE TRUE                                                09350075
               WHEN SQLCODE = 0                                         09360075
                   ADD +1            TO PA-ROWS-UPDATED                 09370075
                   DISPLAY '   *** ROW UPDATED '                        09380099
               WHEN SQLCODE = +1403                                     09390075
                   DISPLAY '*** UPD FAILED / ATTEMPT INSERT !!! ',      09400099
                           ' LBL SEQ ', DA-UPD-BRAND-LBL-SEQ            09410099
                   PERFORM 3100-INSERT-DA-PRRTN                         09420099
               WHEN OTHER                                               09430075
                   PERFORM 9990-SQL-ERROR                               09440075
           END-EVALUATE.                                                09450075
      *                                                                 09460075
      ******************************************************************09470076
      *                                                                 09480076
      *                                                                 09490076
      ******************************************************************09500076
       4300-CLEAR-DA-PRRTN-PCTS.                                        09510076
                                                                        09520076
           MOVE PRORATION-DA-NBR-DTL TO DA-UPD-DR-ALW-NBR               09530076
                                                                        09540076
           EXEC SQL                                                     09550076
             UPDATE DAT_BRND_PRRTN                                      09560076
                SET PRRTN_PCT         = 0                               09570076
              WHERE TRIM(DR_ALW_NBR)  = TRIM(:DA-UPD-DR-ALW-NBR)        09580076
               AND  EFF_END_TMST IS NULL                                09590081
           END-EXEC.                                                    09600076
                                                                        09610076
           EVALUATE TRUE                                                09620076
               WHEN SQLCODE = 0                                         09630076
                   ADD +1            TO PA-ROWS-UPDATED                 09640076
                 DISPLAY '***** DAT PRRTN CLEARED  ',  DA-UPD-DR-ALW-NBR09650078
               WHEN SQLCODE = +1403                                     09660078
                 DISPLAY '! DAT PRRTN NOT CLEARED  ',  DA-UPD-DR-ALW-NBR09670078
               WHEN OTHER                                               09680076
                   PERFORM 9990-SQL-ERROR                               09690076
           END-EVALUATE.                                                09700076
      *                                                                 09710076
      *                                                                 09720076
      ******************************************************************09730074
       5000-DA-REPORT-NO-PRRTN.                                         09740074
      *                                                                 09750074
      *        WRITE MISSING OR 'NOBRAND' TO DA-PRRTN-PCT REPORT        09760074
               MOVE  PV-DA-DR-ALW-NBR       TO DA-RPT-DR-ALW-NBR        09770074
               MOVE  PRORATION-LBL-SEQ-NBR-DTL TO DA-RPT-LBL-SEQ-NBR    09780097
               MOVE  PV-CURRENT-DATE        TO DA-RPT-EFF-BEG-TMST      09790097
               MOVE  SPACES                 TO DA-RPT-EFF-END-TMST      09800074
               MOVE  ZEROS                  TO DA-RPT-PRRTN-PCT         09810074
               MOVE  SPACES                 TO DA-RPT-CRE-BY-USR-ID     09820074
               MOVE  ZEROS                  TO DA-RPT-ML-PRRTN-PCT      09830074
               MOVE  'DA NOBRAND'           TO DA-RPT-SOURCE            09840097
               MOVE  'EXCEPTION '           TO DA-RPT-ACTIVITY          09850097
      *                                                                 09860074
               PERFORM 7600-WRITE-DA-PRRTN-FILE.                        09870074
      *                                                                 09880074
      ******************************************************************09890074
      *                                                                 09900074
      ******************************************************************09910074
       5100-DA-REPORT-WITH-PRRTN.                                       09920074
      *                                                                 09930074
      *                                                                 09940074
               MOVE  DA-TEMP-DR-ALW-NBR     TO DA-RPT-DR-ALW-NBR        09950074
               MOVE  DA-TEMP-LBL-SEQ-NBR    TO DA-RPT-LBL-SEQ-NBR       09960074
               MOVE  DA-TEMP-EFF-BEG-TMST   TO DA-RPT-EFF-BEG-TMST      09970074
               MOVE  DA-TEMP-EFF-END-TMST   TO DA-RPT-EFF-END-TMST      09980074
               MOVE  DA-TEMP-PRRTN-PCT      TO DA-RPT-PRRTN-PCT         09990074
               MOVE  DA-TEMP-CRE-BY-USR-ID  TO DA-RPT-CRE-BY-USR-ID     10000074
               MOVE  DA-TEMP-ML-PRRTN-PCT   TO DA-RPT-ML-PRRTN-PCT      10010074
               MOVE  DA-TEMP-SOURCE         TO DA-RPT-SOURCE            10020074
               MOVE  DA-TEMP-ACTIVITY       TO DA-RPT-ACTIVITY          10030074
      *                                                                 10040074
               PERFORM 7600-WRITE-DA-PRRTN-FILE.                        10050074
      *                                                                 10060074
      *                                                                 10070074
      ******************************************************************10080074
      *  ML HAS IT BUT DA DOES NOT                                      10090074
      *  INSERT DA TO TABLE AND MOVE ZEROES TO DA PRRTN                 10100074
      ******************************************************************10110074
       5200-ML-REPORT-NO-DA.                                            10120075
      *                                                                 10130074
      *    INSERT A REPORT RECORD                                       10140074
           MOVE PRORATION-LAYOUT         TO NEW-PRORATE-OUTPUT          10150074
           MOVE ZEROES                   TO PRORATE-DA-BRAND-PCT.       10160074
           MOVE 'DA-BRAND NOT FOUND    ' TO PRORATE-ALLOCATION-METHOD.  10170074
      *                                                                 10180074
           PERFORM 7500-WRITE-PRORATE-FILE.                             10190074
      *                                                                 10200074
      *                                                                 10210074
      ******************************************************************10220074
       5300-DA-REPORT-ML-PRRTN.                                         10230083
      *                                                                 10240083
      *        WRITE MISSING OR 'NOBRAND' TO DA-PRRTN-PCT REPORT        10250083
               MOVE  PRORATION-DA-NBR-DTL   TO DA-RPT-DR-ALW-NBR        10260083
               MOVE  PRORATION-LBL-SEQ-NBR-DTL TO DA-RPT-LBL-SEQ-NBR    10270083
               MOVE  PV-CURR-DTE            TO DA-RPT-EFF-BEG-TMST      10280083
               MOVE  SPACES                 TO DA-RPT-EFF-END-TMST      10290083
               MOVE  ZEROES                 TO DA-RPT-PRRTN-PCT         10300083
               MOVE  'DAKUP206'             TO DA-RPT-CRE-BY-USR-ID     10310083
               MOVE  PRORATION-BRAND-PCT-NEW TO DA-RPT-ML-PRRTN-PCT     10320097
               MOVE  PRORATION-BRAND-PCT-NEW TO ML-TEMP-PRRTN-PCT       10330097
                                                                        10340097
               IF ML-TEMP-PRRTN-PCT > 0                                 10350097
                   MOVE  'ML ASSIGN '  TO DA-RPT-SOURCE                 10360097
                   MOVE  'INSERTED  '  TO DA-RPT-ACTIVITY               10370097
               ELSE                                                     10380097
                   MOVE  'ML ASSIGN '  TO DA-RPT-SOURCE                 10390097
                   MOVE  'BYPASSED  '  TO DA-RPT-ACTIVITY               10400097
               END-IF.                                                  10410097
      *                                                                 10420083
               PERFORM 7600-WRITE-DA-PRRTN-FILE.                        10430083
      *                                                                 10440083
      *                                                                 10450075
      ******************************************************************10460075
      *                                                                 10470075
      *                                                                 10480075
      ******************************************************************10490075
       5400-INSERT-ML-RPT-DA-RECORD.                                    10500075
      *                                                                 10510075
           DISPLAY '   *** BYPASS DA ONLY  : ', DA-LBL-SEQ-NBR(SS-DA)   10520099
      *                                                                 10530096
           MOVE DA-DR-ALW-NBR(SS-DA)  TO PRORATE-DA-NBR-DTL             10540075
           MOVE DA-LBL-SEQ-NBR(SS-DA) TO PRORATE-LBL-SEQ-NBR-DTL        10550075
           MOVE PV-CURR-DTE        TO PRORATE-FSCL-WK-DTL               10560075
           MOVE ZEROS              TO PRORATE-TARGET-MIN-DTL            10570075
                                      PRORATE-TARGET-MAX-DTL            10580075
                                      PRORATE-EIRRTL-BASIS-DTL          10590075
                                      PRORATE-EIRCOST-BASIS-DTL         10600075
                                      PRORATE-MKUP-PCT-DTL              10610075
                                      PRORATE-DA-COST-DTL               10620075
                                      PRORATE-DA-RTL-DTL                10630075
                                      PRORATE-EIRRTL-APPLIED-DTL        10640075
                                      PRORATE-EIRCOST-APPLIED-DTL       10650075
                                      PRORATE-BRAND-PCT-NEW             10660075
      *                               PRORATE-DEPT-DTL                  10670075
      *                               PRORATE-SCL-DTL                   10680075
           MOVE SPACES            TO  PRORATE-EXCEPTION-NEG-DTL         10690075
                                      PRORATE-EXCEPTION-ZERO-DTL        10700075
                                      PRORATE-EXCEPTION-CUM-DTL         10710075
      *                               PRORATE-VENDOR-DTL                10720075
      *                               PRORATE-BRAND-NAME-DTL            10730075
           MOVE DA-PRRTN-PCT(SS-DA)   TO ML-TEMP-PRRTN-COMP             10740099
           MOVE ML-TEMP-PRRTN-COMP    TO ML-TEMP-PRRTN-PCT              10750099
           MOVE ML-TEMP-PRRTN-PCT     TO PRORATE-DA-BRAND-PCT           10760099
      *                                                                 10770099
           MOVE DA-DR-ALW-NBR(SS-DA)  TO PV-DA-DR-ALW-NBR               10780099
           MOVE DA-LBL-SEQ-NBR(SS-DA) TO PV-DA-BRAND-LBL-SEQ            10790099
           PERFORM 8300-GET-RPT-INFO.                                   10800075
      *                                                                 10810075
           MOVE RPT-MKUP-PCT          TO PRORATE-MKUP-PCT-DTL           10820075
           MOVE RPT-NET-CST-AMT       TO PRORATE-DA-COST-DTL            10830075
           MOVE RPT-DEPT-NBR          TO PRORATE-DEPT-DTL               10840075
           MOVE RPT-SUB-CL-NBR        TO PRORATE-SCL-DTL                10850075
           MOVE RPT-ENT-NAME-DESC     TO PRORATE-VENDOR-DTL             10860075
           MOVE RPT-CHARTC-VAL-DESC   TO PRORATE-BRAND-NAME-DTL.        10870075
           MOVE 'ML DID NOT ALLOCATE' TO PRORATE-ALLOCATION-METHOD      10880075
                                                                        10890075
           PERFORM 7500-WRITE-PRORATE-FILE.                             10900075
                                                                        10910075
      ******************************************************************10920074
      *6000-LOAD-TABLE-DAT-BRND-PRRTN.                                  10930074
      *  SAVE DA VALUES TO DA-SUBSCRIPTED-TABLE                         10940074
      *  WRITE THE DA VALUES TO OUTPUT FILE                             10950074
      ******************************************************************10960074
      *                                                                 10970074
       6000-LOAD-TABLE-DAT-BRND-PRRTN.                                  10980074
      *    LOAD DA-PRRTN-PCT                                            10990092
           MOVE  DA-CSR-DR-ALW-NBR      TO DA-DR-ALW-NBR(SS-DA)         11000074
           MOVE  DA-CSR-LBL-SEQ-NBR     TO DA-LBL-SEQ-NBR(SS-DA)        11010074
           MOVE  DA-CSR-EFF-BEG-TMST    TO DA-EFF-BEG-TMST(SS-DA)       11020074
           MOVE  DA-CSR-EFF-END-TMST    TO DA-EFF-END-TMST(SS-DA)       11030074
           MOVE  DA-CSR-PRRTN-PCT       TO DA-PRRTN-PCT(SS-DA)          11040080
           MOVE  DA-CSR-CRE-BY-USR-ID   TO DA-CRE-BY-USR-ID(SS-DA)      11050074
           MOVE  ZEROES                 TO ML-PRRTN-PCT(SS-DA)          11060074
      *                                                                 11070092
      *    PREP DA-PRRTN-PCT REPORT                                     11080092
           MOVE  DA-CSR-DR-ALW-NBR      TO DA-TEMP-DR-ALW-NBR           11090092
           MOVE  DA-CSR-LBL-SEQ-NBR     TO DA-TEMP-LBL-SEQ-NBR          11100092
           MOVE  DA-CSR-EFF-BEG-TMST    TO DA-TEMP-EFF-BEG-TMST         11110092
           MOVE  DA-CSR-EFF-END-TMST    TO DA-TEMP-EFF-END-TMST         11120092
           MOVE  DA-CSR-PRRTN-PCT       TO DA-TEMP-PRRTN-PCT            11130092
           MOVE  DA-CSR-CRE-BY-USR-ID   TO DA-TEMP-CRE-BY-USR-ID        11140092
           MOVE  ZEROS                  TO DA-TEMP-ML-PRRTN-PCT         11150092
           MOVE  'DA BRAND  '           TO DA-TEMP-SOURCE               11160092
           MOVE  'FOUND     '           TO DA-TEMP-ACTIVITY             11170092
      *                                                                 11180092
           PERFORM 5100-DA-REPORT-WITH-PRRTN.                           11190074
      *                                                                 11200003
      ******************************************************************11210074
      *  READ ML FILE                                                   11220092
      ******************************************************************11230001
       7000-READ-ML-PRORATION-FILE.                                     11240001
                                                                        11250001
           READ ML-PRORATION-FILE INTO PRORATION-LAYOUT                 11260001
               AT END SET PS-END-OF-FILE TO TRUE.                       11270001
      *    MOVE PRORATION-DA-NBR-DTL  TO ML-HOLD-DR-ALW-NBR.            11280069
      *    MOVE PRORATION-DA-NBR-DTL  TO PV-DA-DR-ALW-NBR               11290073
           ADD 1                      TO PA-ML-RECORDS-READ.            11300069
                                                                        11310001
      ****************************************************************  11390001
      * WRITE A RECORD                                               *  11400001
      ****************************************************************  11410001
       7500-WRITE-PRORATE-FILE.                                         11420001
                                                                        11430001
           WRITE ML-DA-PRORATION-RECORD FROM NEW-PRORATE-OUTPUT.        11440001
           ADD 1                        TO PA-ML-RECORDS-WRITTEN.       11450069
                                                                        11460001
      ****************************************************************  11470069
      * WRITE A RECORD                                               *  11480069
      ****************************************************************  11490069
       7600-WRITE-DA-PRRTN-FILE.                                        11500069
                                                                        11510069
           WRITE DA-PRORATION-RECORD FROM DA-PERCENTAGE-REPORT.         11520069
           ADD 1                       TO PA-DA-RECORDS-WRITTEN.        11530069
                                                                        11540069
      ****************************************************************  11550001
      * LOGON                                                        *  11560001
      ****************************************************************  11570001
       7200-LOGON-TO-ORACLE.                                            11580099
      *                                                                 11590099
           DISPLAY '**********************************'.                11991199
           DISPLAY '**------ BEGIN DAKUP200 ------**'.                  11991299
           DISPLAY '**********************************'.                11991399
                                                                        11991499
 8613F     MOVE '7200-LOGON-TO-ORACLE'   TO PV-PARAGRAPH-NAME.          11991599
 8613F                                                                  11991699
 8613F     READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             11991799
 8613F        AT END                                                    11991899
 8613F           SET ORACLE-LOGIN-EOF      TO TRUE.                     11991999
 8613F                                                                  11992099
 8613F     IF CC-AUTO-LOGON                                             11992199
 8613F        DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'         11992299
 8613F        EXEC SQL                                                  11992399
 8613F             CONNECT :PC-AUTO-LOGON                               11992499
 8613F        END-EXEC                                                  11992599
 8613F     ELSE                                                         11992699
 8613F        INITIALIZE PV-ORACLE-USERID-LEN                           11992799
 8613F                   PV-ORACLE-PASSWORD-LEN                         11992899
 8613F        INSPECT CC-ORACLE-USERID                                  11992999
 8613F                TALLYING PV-ORACLE-USERID-LEN                     11993099
 8613F                FOR CHARACTERS BEFORE INITIAL SPACE               11993199
 8613F        INSPECT CC-ORACLE-PASSWORD                                11993299
 8613F                TALLYING PV-ORACLE-PASSWORD-LEN                   11993399
 8613F                FOR CHARACTERS BEFORE INITIAL SPACE               11993499
 8613F        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO     11993599
 8613F                USERNAME-ARR                                      11993699
 8613F        MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN              11993799
 8613F        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     11993899
 8613F                PASSWD-ARR                                        11993999
 8613F        MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                11994099
 8613F        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     11994199
 8613F             PASSWD-ARR                                           11994299
 8613F        MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                11994399
 8613F        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO     11994499
 8613F             USERNAME-ARR                                         11994599
 8613F        MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN              11994699
 8613F        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     11994799
 8613F             PASSWD-ARR                                           11994899
 8613F        MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                11994999
 8613F        DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '    11995099
 8613F             USERNAME-ARR                                         11995199
 8613F        EXEC SQL                                                  11995299
 8613F             CONNECT :USERNAME IDENTIFIED BY :PASSWD              11995399
 8613F        END-EXEC                                                  11995499
 8613F        INITIALIZE CC-ORACLE-PASSWORD                             11995599
 8613F                   PASSWD                                         11995699
 8613F     END-IF.                                                      11995799
 8613F                                                                  11995899
                                                                        11997099
 8613F     IF SQLCODE = 0                                               12000099
 8613F         DISPLAY 'CONNECTED TO ORACLE AS USER: ' USERNAME         12010099
 8613F         DISPLAY ' '                                              12020099
 8613F     ELSE                                                         12030099
 8613F         PERFORM 9990-SQL-ERROR                                   12040099
 8613F     END-IF.                                                      12050099
      ******************************************************************12060001
      *  OPEN DEBIT ALLOWANCE CURSOR                                   *12070001
      ******************************************************************12080001
       8000-OPEN-TDAALW-CSR.                                            12090001
                                                                        12100001
           MOVE '8000-OPEN-TDAALW-CSR  ' TO PV-PARAGRAPH-NAME.          12110001
                                                                        12120001
           EXEC SQL                                                     12130001
               OPEN DA_BRAND_CSR                                        12140001
           END-EXEC.                                                    12150001
                                                                        12160001
           EVALUATE TRUE                                                12170001
               WHEN SQLCODE = 0                                         12180001
                   DISPLAY '   ### OPEN DA CSR : ',                     12190095
                                PRORATION-DA-NBR-DTL                    12200095
               WHEN OTHER                                               12210001
                   PERFORM 9990-SQL-ERROR                               12220001
           END-EVALUATE.                                                12230001
                                                                        12240001
      ******************************************************************12250001
      *  CLOSE DEBIT ALLOWANCE CURSOR                                  *12260001
      ******************************************************************12270001
      *8100-CLOSE-TDAALW-CSR.                                           12280099
      *                                                                 12290099
      *    MOVE '8100-CLOSE-TDAALW-CSR ' TO PV-PARAGRAPH-NAME.          12300099
      *                                                                 12310099
      *    EXEC SQL                                                     12320099
      *        CLOSE DA_BRAND_CSR                                       12330099
      *    END-EXEC.                                                    12340099
      *                                                                 12350099
      *    EVALUATE TRUE                                                12360099
      *        WHEN SQLCODE = 0                                         12370099
      *            CONTINUE                                             12380099
      *        WHEN OTHER                                               12390099
      *            PERFORM 9990-SQL-ERROR                               12400099
      *    END-EVALUATE.                                                12410099
                                                                        12420001
      ******************************************************************12430001
      *  FETCH THE NEXT ROW                                            *12440001
      ******************************************************************12450001
       8200-FETCH-TDAALW.                                               12460001
                                                                        12470001
           MOVE '8200-FETCH-TDAALW   ' TO PV-PARAGRAPH-NAME.            12480001
      *                                                                 12490001
           EXEC SQL                                                     12500001
               FETCH DA_BRAND_CSR                                       12510001
               INTO :DA-CSR-DR-ALW-NBR                                  12520001
                   ,:DA-CSR-LBL-SEQ-NBR                                 12530001
                   ,:DA-CSR-EFF-BEG-TMST                                12540001
                   ,:DA-CSR-EFF-END-TMST      :PV-NULL-RETURN           12550001
                   ,:DA-CSR-PRRTN-PCT                                   12560001
                   ,:DA-CSR-CRE-BY-USR-ID                               12570001
           END-EXEC.                                                    12580001
                                                                        12590001
           EVALUATE TRUE                                                12600001
               WHEN SQLCODE = 0                                         12610001
                   SET PS-MORE-DA-ROWS-LEFT    TO TRUE                  12620013
                   ADD +1            TO PA-ROWS-FETCHED                 12630061
                   DISPLAY '       LBL SEQ ', DA-CSR-LBL-SEQ-NBR,       12640095
                           ' BEF % : ', DA-CSR-PRRTN-PCT                12650061
               WHEN SQLCODE = 1403                                      12660001
                   SET PS-NO-MORE-DA-ROWS-LEFT TO TRUE                  12670003
               WHEN OTHER                                               12680001
                   DISPLAY 'SQLCODE : ', SQLCODE                        12690001
                   PERFORM 9990-SQL-ERROR                               12700001
           END-EVALUATE.                                                12710001
                                                                        12720001
      ******************************************************************12730001
      *  RETRIEVE MISSING REPORT RECORD INFORMATION                    *12740030
      ******************************************************************12750001
       8300-GET-RPT-INFO.                                               12760030
                                                                        12770030
           MOVE '8300-GET-RPT-INFO  ' TO PV-PARAGRAPH-NAME.             12780030
                                                                        12790030
           EXEC SQL                                                     12800032
           SELECT DEPT_NBR                                              12810030
                , SUB_CL_NBR                                            12820032
                , A.ENT_ID                                              12830030
                , ENT_NAME_DESC                                         12840032
                , CHARTC_VAL_DESC                                       12850032
                , NET_CST_AMT                                           12860046
                , MKUP_PCT                                              12870046
             INTO :RPT-DEPT-NBR                                         12880030
                , :RPT-SUB-CL-NBR                                       12890032
                , :RPT-ENT-ID                                           12900032
                , :RPT-ENT-NAME-DESC                                    12910032
                , :RPT-CHARTC-VAL-DESC                                  12920033
                , :RPT-NET-CST-AMT                                      12930045
                , :RPT-MKUP-PCT                                         12940045
            FROM  TDAALW A                                              12950030
                , DAT_BRND_PRRTN B                                      12960030
                , TVSCHVL C                                             12970030
                , TENTNME D                                             12980030
            WHERE TRIM(A.DR_ALW_NBR)  = TRIM(:PV-DA-DR-ALW-NBR)         12990099
              AND A.DR_ALW_NBR        =  B.DR_ALW_NBR                   13000045
              AND B.LBL_SEQ_NBR       = :PV-DA-BRAND-LBL-SEQ            13010099
              AND B.EFF_END_TMST IS NULL                                13020055
              AND B.LBL_SEQ_NBR       = CHARTC_SEQ_NBR                  13030055
              AND A.ENT_ID            = D.ENT_ID                        13040045
              AND D.TYPE_CDE          = '01'                            13050045
              AND CHARTC_CDE          = 3                               13060099
           END-EXEC                                                     13070032
      *                                                                 13080032
           EVALUATE TRUE                                                13090032
               WHEN SQLCODE = 0                                         13100032
                   INSPECT RPT-ENT-NAME-DESC                            13110099
                                REPLACING ALL ',' BY ' '                13120099
                   INSPECT RPT-CHARTC-VAL-DESC                          13130099
                                REPLACING ALL ',' BY ' '                13140099
               WHEN SQLCODE = 1403                                      13150032
                   DISPLAY 'REPORT ATTR LOOKUP FAILED - TRY 8301-'      13160099
132403             MOVE ZERO TO RPT-DEPT-NBR                            13161099
132403                          RPT-SUB-CL-NBR                          13162099
132403                          RPT-ENT-ID                              13163099
132403                          RPT-NET-CST-AMT                         13166099
132403                          RPT-MKUP-PCT                            13167099
                   PERFORM 8301-GET-BRAND-INFO                          13170099
               WHEN SQLCODE = -2112                                     13180055
                   DISPLAY 'REPORT ATTRIBUTE FALIURE-BYPASS LOOKUP'     13190058
               WHEN OTHER                                               13200032
                   DISPLAY 'SQLCODE : ', SQLCODE                        13210032
                   PERFORM 9990-SQL-ERROR                               13220032
           END-EVALUATE.                                                13230032
                                                                        13240032
      ******************************************************************13250099
      *  RETRIEVE MISSING REPORT RECORD INFORMATION                    *13260099
      ******************************************************************13270099
       8301-GET-BRAND-INFO.                                             13280099
                                                                        13290099
           MOVE '8301-GET-BRAND-INFO  ' TO PV-PARAGRAPH-NAME.           13300099
                                                                        13310030
           EXEC SQL                                                     13320099
               SELECT CHARTC_VAL_DESC                                   13330099
                INTO :RPT-CHARTC-VAL-DESC                               13340099
                FROM  TVSCHVL                                           13350099
               WHERE  CHARTC_SEQ_NBR  = :PV-DA-BRAND-LBL-SEQ            13360099
                  AND CHARTC_CDE      = 3                               13370099
           END-EXEC                                                     13380099
      *                                                                 13390099
           EVALUATE TRUE                                                13400099
               WHEN SQLCODE = 0                                         13410099
                   DISPLAY 'BRAND NAME FOUND'                           13420099
                   INSPECT RPT-CHARTC-VAL-DESC                          13430099
                                REPLACING ALL ',' BY ' '                13440099
               WHEN SQLCODE = 1403                                      13450099
                   DISPLAY 'BRAND NAME NOT FOUND'                       13460099
               WHEN SQLCODE = -2112                                     13470099
                   DISPLAY 'REPORT ATTRIBUTE FALIURE-BYPASS LOOKUP'     13480099
               WHEN OTHER                                               13490099
                   DISPLAY 'SQLCODE : ', SQLCODE                        13500099
                   PERFORM 9990-SQL-ERROR                               13510099
           END-EVALUATE.                                                13520099
      *                                                                 13530001
      ******************************************************************13540001
      *    COMMIT-CHANGES.                                             *13550001
      *      PURPOSE: COMMIT CHANGES TO THUS FAR                       *13560001
      ******************************************************************13570001
       9000-COMMIT-CHANGES.                                             13580001
                                                                        13590001
           ADD +1                      TO PA-ROWS-TO-COMMIT.            13600069
      *    IF PA-ROWS-TO-COMMIT >= PC-COMMIT-COUNT                      13610061
      *        ADD +1                        TO PA-NUMBER-OF-COMMIT     13620061
      *    END-IF.                                                      13630061
                                                                        13640001
                                                                        13650001
           EXEC SQL                                                     13660045
               COMMIT                                                   13670045
           END-EXEC                                                     13680045
                                                                        13690001
      *                                                                 13700045
           EVALUATE TRUE                                                13710045
               WHEN SQLCODE = 0                                         13720045
                   DISPLAY '*******COMMIT COUNT  ', PA-ROWS-TO-COMMIT   13730080
               WHEN OTHER                                               13740045
                   DISPLAY '  DA UPDATE COMMIT FAILED '                 13750057
                   PERFORM 9990-SQL-ERROR                               13760045
           END-EVALUATE.                                                13770045
      *                                                                 13780045
      *    MOVE PA-ROWS-FETCHED        TO PV-LAST-COMMIT-RECORD.        13790069
      *    MOVE DA-DR-ALW-NBR(SS-DA)   TO PV-LAST-COMMIT-DR-ALW-NBR.    13800069
                                                                        13810001
                                                                        13820001
      ******************************************************************13830001
      *    9900-EOJ-LOGIC.                                             *13840001
      *      THIS IS PERFORMED AT END OF INPUT FILE.                   *13850001
      *      PURPOSE: CLOSE INPUT FILE, COMMIT CHANGES AND DISPLAY     *13860001
      *      RECORD COUNTS.                                            *13870001
      ******************************************************************13880001
       9900-EOJ-LOGIC.                                                  13890001
      * FORCE A COMMIT, IF THERE ARE UNCOMMITTED ROWS                   13900001
      *                                                                 13910099
           PERFORM 9000-COMMIT-CHANGES.                                 13920099
                                                                        13930099
           CLOSE ML-PRORATION-FILE                                      13950099
                 ML-DA-PRORATION-FILE                                   13960099
                 DA-PRORATION-FILE.                                     13970099
                                                                        13980001
           DISPLAY ' '.                                                 13990001
           DISPLAY 'COMMIT EVERY ' PC-COMMIT-COUNT ' RECORD(S).'.       14000001
           DISPLAY 'ML RECORDS READ     ' PA-ML-RECORDS-READ.           14010069
           DISPLAY 'ML RECORDS WRITTEN  ' PA-ML-RECORDS-WRITTEN.        14020069
           DISPLAY 'DA RECORDS WRITTEN  ' PA-DA-RECORDS-WRITTEN.        14030069
           DISPLAY 'DAT_BRND_PRRTN TABLE UPDATED '.                     14040069
           DISPLAY '    ROWS FETCHED        ' PA-ROWS-FETCHED.          14050069
           DISPLAY '    ROWS UPDATED        ' PA-ROWS-UPDATED.          14060069
           DISPLAY '    ROWS INSERTED       ' PA-ROWS-INSERTED.         14070069
           DISPLAY 'COMMITS             ' PA-NUMBER-OF-COMMIT.          14080001
           DISPLAY '**------ END ' PC-PROGRAM-NAME ' ------**'.         14090001
                                                                        14100001
                                                                        14110001
      ******************************************************************14120001
      * DISPLAYS ERRORS ENCOUNTERED ON SQL REQUEST                      14130001
      ******************************************************************14140001
       9990-SQL-ERROR.                                                  14150001
                                                                        14160001
           MOVE SQLCODE    TO SQLCODE2.                                 14170001
           MOVE SQLERRD(3) TO SQLERRD3.                                 14180001
           DISPLAY '** ABEND **       ** = SQLERROR'.                   14190001
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           14200001
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         14210001
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  14220001
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  14230001
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   14240001
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  14250001
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                14260001
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-ATTEMPTED.    14270001
           DISPLAY '** LAST COMMIT RECORD  = ' PV-LAST-COMMIT-RECORD.   14280001
           DISPLAY '** LAST COMMIT DA-NBR  = ' PV-LAST-COMMIT-DR-ALW-NBR14290001
                                                                        14300001
           PERFORM 9995-GET-SQL-MSG.                                    14310001
           IF WS-MSG-LENGTH > ZEROES                                    14320001
               DISPLAY ' ** MESSAGE TEXT      ** = '                    14330001
                       WS-MSG-TEXT(1:WS-MSG-LENGTH)                     14340001
           END-IF.                                                      14350001
                                                                        14360001
           EXEC SQL                                                     14370001
               ROLLBACK WORK RELEASE                                    14380001
           END-EXEC.                                                    14390001
                                                                        14400001
           SET ABEND-4013-DB-ERROR  TO TRUE.                            14410001
                                                                        14420001
           PERFORM 9999-ABEND.                                          14430001
                                                                        14440001
      ******************************************************************14450001
      * GET ORACLE SQL ERROR MESSAGE                                    14460001
      ******************************************************************14470001
       9995-GET-SQL-MSG.                                                14480001
                                                                        14490001
           MOVE SPACES TO WS-MSG-TEXT.                                  14500001
                                                                        14510001
           CALL 'SQLGLM' USING WS-MSG-TEXT,                             14520001
                               WS-MAX-SIZE,                             14530001
                               WS-MSG-LENGTH.                           14540001
                                                                        14550001
      *                                                                 14560069
      *                                                                 14570069
      ******************************************************************14580001
      * PROGRAM ABEND PARAGRAPH                                         14590001
      ******************************************************************14600001
       9999-ABEND.                                                      14610001
                                                                        14620001
           CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        14630001
                                                                        14640001
                                                                        14650001
                                                                        14660001
      ******************************************************************14670001
      *    END OF SOURCE CODE FOR DAKUP206                            * 14680069
      ******************************************************************14690001
