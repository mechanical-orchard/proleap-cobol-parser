000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.    APKCS339.                                         00020003
000300 AUTHOR.        MARILYN WILKINSON.                                00030003
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040003
000500 DATE-WRITTEN.  10/08/96.                                         00050003
000600 DATE-COMPILED.                                                   00060003
000700                                                                  00070003
000800*---------------------------------------------------------------* 00080003
000900*    TRANID      - A339                                         * 00090003
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00100003
001100*    MAPSET      - APKM339                                      * 00110003
001200*                                                               * 00120003
001300*    THIS SCREEN ALLOWS USERS TO SET UP OR INACTIVATE DIFFERENT * 00130003
001400*    CONTROL DAYS FOR PAYMENT DUE DATE CALCULATIONS BY VENDOR.  * 00140003
001500*                                                               * 00150003
001600* DATE  10/24/2007                                              * 00160018
001700*     CHANGE MADE: MATCH BY DC PHASE 2                          * 00170014
001800*     ADDED LOGIC FOR THE VENDOR SPECIFIC CUT-OFF DAYS PROCESS. * 00180014
001900*     THE NEW FIELD ON THE SCREEN IS RECON CUTOFF DAYS. THIS    * 00190014
001910*     FIELD CAN'T BE NEGATIVE, AND IT CAN'T BE BETWEEN 0 AND 7. * 00191014
001920*     IT CAN BE ZERO, OR 7 AND ABOVE, WITH THE UPDATE           * 00192014
001930*     BEING > 35 CONFIRMED BEFORE BEING APPLIED.                * 00193015
001940*                                                               * 00194014
002000*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR32804         * 00200014
002010* DATE  09/01/2021                                                00201019
002020*            - CHANGE CALL OF  DPKUT100  TO                     * 00202021
002030*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00203019
002040*              MAKING THE CALL DYNAMIC VS STATIC                * 00204019
002050*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        00205022
002060* DATE  10/24/2022                                              * 00206023
002070*     ADD COPYBOOK DPWS930                                      * 00207024
002080*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API  * 00208024
002090*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 00209024
002100*---------------------------------------------------------------* 00210003
002200                                                                  00220003
002300 ENVIRONMENT DIVISION.                                            00230003
002400 DATA DIVISION.                                                   00240003
002500/                                                                 00250003
002600 WORKING-STORAGE SECTION.                                         00260003
002700                                                                  00270003
002800 01  DK-DB2-KEYS.                                                 00280003
002900     05  DK-ENT-ID                    PIC S9(09) VALUE +0         00290003
003000                                                 COMP.            00300003
003100     05  DK-DUN-NBR                   PIC X(09).                  00310003
003200                                                                  00320003
003300 01  PC-PROGRAM-CONSTANTS.                                        00330003
003400     05  PC-TRANS-ID                  PIC X(04)  VALUE 'A339'.    00340003
003500     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'APKCS339'.00350003
003600     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'AP339A  '.00360003
003700     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'APKM339 '.00370003
003800     05  PC-DPKUT100                  PIC X(08)  VALUE 'DPKUT100'.00380003
003900     05  PC-MINIMUM-LIMIT             PIC S9(3)  VALUE +07.       00390007
003910     05  PC-UPPER-LIMIT               PIC S9(3)  VALUE +35.       00391007
004000     05  PC-LOWER-LIMIT               PIC S9(3)  VALUE -35.       00400003
004100     05  PC-TSYMSG-NUMBERS.                                       00410003
004200         10  PC-TSYMSG-00007          PIC 9(05)  VALUE 00007.     00420003
004300         10  PC-TSYMSG-00008          PIC 9(05)  VALUE 00008.     00430003
004400         10  PC-TSYMSG-00034          PIC 9(05)  VALUE 00034.     00440003
004500         10  PC-TSYMSG-00059          PIC 9(05)  VALUE 00059.     00450003
004600         10  PC-TSYMSG-01095          PIC 9(05)  VALUE 01095.     00460003
004700         10  PC-TSYMSG-01169          PIC 9(05)  VALUE 01169.     00470003
004800         10  PC-TSYMSG-01309          PIC 9(05)  VALUE 01309.     00480003
004900         10  PC-TSYMSG-01311          PIC 9(05)  VALUE 01311.     00490003
005000         10  PC-TSYMSG-01313          PIC 9(05)  VALUE 01313.     00500003
005100         10  PC-TSYMSG-01314          PIC 9(05)  VALUE 01314.     00510003
005200         10  PC-TSYMSG-01423          PIC 9(05)  VALUE 01423.     00520003
005300         10  PC-TSYMSG-01424          PIC 9(05)  VALUE 01424.     00530003
005400         10  PC-TSYMSG-01434          PIC 9(05)  VALUE 01434.     00540003
005500         10  PC-TSYMSG-01435          PIC 9(05)  VALUE 01435.     00550003
005510         10  PC-TSYMSG-03592          PIC 9(05)  VALUE 03592.     00551005
005520         10  PC-TSYMSG-03593          PIC 9(05)  VALUE 03593.     00552011
005600     05  PC-IND-DESCRIPTIONS.                                     00560003
005700         10  PC-IND-DESC-SPECIFIC     PIC X(50)  VALUE            00570003
005800             '-ACTIVE; VENDOR CONTROL VALUES BELOW WILL BE USED'. 00580003
005900         10  PC-IND-DESC-INACTIVE     PIC X(50)  VALUE            00590003
006000             '-INACTIVE; DEFAULT CONTROL VALUES WILL BE USED'.    00600003
006100         10  PC-IND-DESC-2            PIC X(50)  VALUE            00610003
006200             '  (ENTER ''A'' TO ACTIVATE OR ''I'' TO INACTIVATE)'.00620003
006300                                                                  00630003
006400 01  PV-PROGRAM-VARIABLES.                                        00640003
006500     05  PV-3V-DISP                     PIC 999-.                 00650003
006600     05  PV-3V-DISP-X REDEFINES                                   00660003
006700         PV-3V-DISP                     PIC X(04).                00670003
006800                                                                  00680003
006900 01  PS-PROGRAM-SWITCHES.                                         00690003
007000     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00700003
007100         88  PS-ERROR                            VALUE 'Y'.       00710003
007200         88  PS-NO-ERROR                         VALUE 'N'.       00720003
007300     05  PS-COMMAREA-SW               PIC  X(01) VALUE 'N'.       00730003
007400         88  PS-COMMAREA-VALID                   VALUE 'Y'.       00740003
007500         88  PS-COMMAREA-NOT-VALID               VALUE 'N'.       00750003
007600     05  PS-FOUND-SW                  PIC X(01)  VALUE 'N'.       00760003
007700         88  PS-FOUND                            VALUE 'Y'.       00770003
007800         88  PS-NOT-FOUND                        VALUE 'N'.       00780003
007810     05  PS-RECN-CUTOFF-VALID-SW      PIC X(01)  VALUE 'N'.       00781008
007820         88  PS-RECN-CUTOFF-VALID                VALUE 'Y'.       00782009
007830         88  PS-RECN-CUTOFF-NOT-VALID            VALUE 'N'.       00783009
007900/                                                                 00790003
008000*----------------------------------------------------------------*00800003
008100*    MAP LAYOUT                                                  *00810003
008200*----------------------------------------------------------------*00820003
008300                                                                  00830003
008400     COPY APKM339.                                                00840003
008500/                                                                 00850003
008600*----------------------------------------------------------------*00860003
008700*    ATTRIBUTE SETTINGS COPYBOOK.                                *00870003
008800*----------------------------------------------------------------*00880003
008900                                                                  00890003
009000     COPY DPWS015.                                                00900003
009100/                                                                 00910003
009200*----------------------------------------------------------------*00920003
009300*    FUNCTION KEYS COPYBOOK                                      *00930003
009400*----------------------------------------------------------------*00940003
009500                                                                  00950003
009600     COPY DPWS016.                                                00960003
009700/                                                                 00970003
009800*----------------------------------------------------------------*00980003
009900*    THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHIT.   *00990003
010000*    APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.       *01000003
010100*----------------------------------------------------------------*01010003
010200     COPY DPWS030.                                                01020003
010210     COPY DPWS930.                                                01021024
010300/                                                                 01030003
010400*----------------------------------------------------------------*01040003
010500*    STANDARD COMMAREA.                                          *01050003
010600*----------------------------------------------------------------*01060003
010700                                                                  01070003
010800     COPY DPWS020.                                                01080003
010900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01090003
011000                                                                  01100003
011100*----------------------------------------------------------------*01110003
011200*    INTER-APPLICATION COMMAREA.                                 *01120003
011300*----------------------------------------------------------------*01130003
011400                                                                  01140003
011500         10  INTER-APPL-COMM-AREA PIC X(200).                     01150003
011600     COPY APWS302.                                                01160003
011700*----------------------------------------------------------------*01170003
011800*    SPECIFIC COMMMAREA FOR APKCS339.                            *01180003
011900*----------------------------------------------------------------*01190003
012000         10  ASC-SPECIFIC-COMMAREA.                               01200003
012100             15  ASC-INT-APPL-FORMAT-IND      PIC X(01).          01210003
012200                 88  ASC-INTER-APPL-ADD           VALUE ' '.      01220003
012300                 88  ASC-INTER-APPL-UPDATE        VALUE '1'.      01230003
012400             15  ASC-REQUEST-SW               PIC X(03).          01240003
012500                 88  ASC-INSERT-REQUESTED         VALUE 'INS'.    01250003
012600                 88  ASC-UPDATE-REQUESTED         VALUE 'UPD'.    01260003
012700             15  ASC-FIELDS-MODIFIED-SW       PIC X(01).          01270003
012800                 88  ASC-FIELDS-UNCHANGED         VALUE ' '.      01280003
012900                 88  ASC-FIELDS-MODIFIED          VALUE 'Y'.      01290003
013000             15  ASC-KEY-FIELDS.                                  01300003
013100                 20  ASC-KEY-DUN-NBR          PIC X(09).          01310003
013200                 20  ASC-KEY-ENT-ID           PIC S9(9) COMP.     01320003
013300             15  ASC-NUMERIC-FIELDS.                              01330003
013400                 20  ASC-PAYT-FLOAT-DAYS-X    PIC X(4).           01340003
013500                 20  ASC-EXC-FLT-DAYS-X       PIC X(4).           01350003
013600                 20  ASC-RCVG-VARN-DAYS-X     PIC X(4).           01360003
013700                 20  ASC-RECN-CTOFF-DAY-QTY-X PIC X(4).           01370003
013800             15  ASC-SCREEN-FIELDS.                               01380003
013900                 20  ASC-DUN-NBR              PIC X(09).          01390003
014000                 20  ASC-ENT-NAME-DESC        PIC X(30).          01400003
014100                 20  ASC-VND-FLT-DAY-IND      PIC X(1).           01410003
014200                     88  STATUS-SPECIFIED         VALUE 'S'.      01420003
014300                     88  STATUS-INACTIVE          VALUE 'I'.      01430003
014400                 20  ASC-IND-DESC1            PIC X(50).          01440003
014500                 20  ASC-IND-DESC2            PIC X(50).          01450003
014600                 20  ASC-PAYT-FLOAT-DAYS      PIC S9(3).          01460003
014700                 20  ASC-EXC-FLT-DAYS         PIC S9(3).          01470003
014800                 20  ASC-RCVG-VARN-DAYS       PIC S9(3).          01480003
014900                 20  ASC-RECN-CTOFF-DAY-QTY   PIC S9(3).          01490003
015000             15  ASC-OLD-SCREEN-VALUES.                           01500003
015100                 20  ASC-VND-FLT-DAY-IND-OLD  PIC X(1).           01510003
015200                 20  ASC-PAYT-FLOAT-DAYS-OLD  PIC S9(3).          01520003
015300                 20  ASC-EXC-FLT-DAYS-OLD     PIC S9(3).          01530003
015400                 20  ASC-RCVG-VARN-DAYS-OLD   PIC S9(3).          01540003
015500                 20  ASC-RECN-CTOFF-DAY-QTY-OLD PIC S9(3).        01550003
015600             15  ASC-SWITCH-AREA.                                 01560003
015700                 20  ASC-CONFIRM-SW           PIC X(1).           01570003
015800                     88 ASC-OK-TO-CONFIRM-ADD        VALUE 'A'.   01580003
015900                     88 ASC-OK-TO-CONFIRM-UPD        VALUE 'I'.   01590003
016000                     88 ASC-DO-NOT-CHECK-CONFIRM     VALUE 'N'.   01600003
016100             15  ASC-TYPE-OF-ADD-UPDATE       PIC X(01).          01610003
016200                 88  ASC-NOT-FOUND-AT-ALL     VALUE 'N'.          01620003
016300                 88  ASC-NOT-FOUND-FOR-IND    VALUE 'X'.          01630003
016400                 88  ASC-FOUND                VALUE 'Y'.          01640003
016500/                                                                 01650003
016600*---------------------------------------------------------------* 01660003
016700*  WORK AREA FOR NUMERIC EDIT ROUTINE - DPKUT100                * 01670003
016800*---------------------------------------------------------------* 01680003
016900     COPY DPWS010I.                                               01690003
017000/                                                                 01700003
017100*----------------------------------------------------------------*01710003
017200*    ABEND PROCESSING COPYBOOK.                                  *01720003
017300*----------------------------------------------------------------*01730003
017400                                                                  01740003
017500     COPY DPWS013.                                                01750003
017600/                                                                 01760003
017700*----------------------------------------------------------------*01770003
017800*    DB2 SQL COMMUNICATION AREA                                   01780003
017900*----------------------------------------------------------------*01790003
018000     EXEC SQL                                                     01800003
018100          INCLUDE SQLCA                                           01810003
018200     END-EXEC.                                                    01820003
018300/                                                                 01830003
018400*----------------------------------------------------------------*01840003
018500*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE TABLE              01850003
018600*----------------------------------------------------------------*01860003
018700     EXEC SQL                                                     01870003
018800          INCLUDE TEXTENT                                         01880003
018900     END-EXEC.                                                    01890003
019000/                                                                 01900003
019100*----------------------------------------------------------------*01910003
019200*    DB2 DCLGEN FOR VENDOR EXTERNAL ENTERPRISE NAME TABLE         01920003
019300*----------------------------------------------------------------*01930003
019400     EXEC SQL                                                     01940003
019500          INCLUDE TENTNME                                         01950003
019600     END-EXEC.                                                    01960003
019700/                                                                 01970003
019800*----------------------------------------------------------------*01980003
019900*    DB2 DCLGEN FOR VENDOR SPECIFICATION TABLE.                   01990003
020000*----------------------------------------------------------------*02000003
020100     EXEC SQL                                                     02010003
020200          INCLUDE TAPVNDS                                         02020003
020300     END-EXEC.                                                    02030003
020400/                                                                 02040003
020500 LINKAGE SECTION.                                                 02050003
020600                                                                  02060003
020700 01  DFHCOMMAREA.                                                 02070003
020800     05  FILLER                       OCCURS  1 TO 4072 TIMES     02080003
020900                                      DEPENDING ON EIBCALEN.      02090003
021000         10  FILLER                   PIC X.                      02100003
021100/                                                                 02110003
021200 PROCEDURE DIVISION.                                              02120003
021300                                                                  02130003
021400*----------------------------------------------------------------*02140003
021500*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *02150003
021600*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *02160003
021700*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *02170003
021800*                                                                *02180003
021900*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *02190003
022000*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *02200003
022100*----------------------------------------------------------------*02210003
022200 0000-MAIN-MODULE.                                                02220003
022300                                                                  02230003
022400     INITIALIZE DP030-CICS-API-FIELDS.                            02240003
022500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02250003
022600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02260003
022700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02270003
022800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02280003
022900     MOVE LENGTH OF AP339AI        TO DP030-MAP-LENGTH (1).       02290003
023000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02300003
023100     PERFORM 0001-CALL-CICS-ARCH-API.                             02310003
023200                                                                  02320003
023300     PERFORM 1000-CONTROL-PROCESSING.                             02330003
023400                                                                  02340003
023500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02350003
023600     PERFORM 0001-CALL-CICS-ARCH-API.                             02360003
023700                                                                  02370003
023800/                                                                 02380003
023900 0001-CALL-CICS-ARCH-API.                                         02390003
024000                                                                  02400003
024100     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     02410023
024200                                     DFHCOMMAREA                  02420023
024300                                     DP030-CICS-API-FIELDS        02430023
024400                                     DP020-STANDARD-COMMAREA      02440023
024500                                     AP339AI.                     02450024
024600                                                                  02460003
024700     IF  DP030-RC-CALL-SUCCESSFUL                                 02470003
024800         CONTINUE                                                 02480003
024900     ELSE                                                         02490003
025000         SET DP013-NO-ROLLBACK                                    02500003
025100             DP013-XCTL-DISPLAY-RESTART                           02510003
025200             DP013-CICS-ABEND      TO TRUE                        02520003
025300         MOVE 'BEFORE 0000-MAIN-MODULE'                           02530003
025400                                   TO DP013-PARAGRAPH             02540003
025500         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02550024
025600-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02560024
025700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02570003
025800         PERFORM DP013-0000-PROCESS-ABEND                         02580003
025900     END-IF.                                                      02590003
026000                                                                  02600003
026100/                                                                 02610003
026200*----------------------------------------------------------------*02620003
026300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02630003
026400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02640003
026500*----------------------------------------------------------------*02650003
026600                                                                  02660003
026700 1000-CONTROL-PROCESSING.                                         02670003
026800                                                                  02680003
026900     EVALUATE TRUE                                                02690003
027000         WHEN DP020-NEXT-ACT-INITIAL                              02700003
027100              INITIALIZE ASC-SPECIFIC-COMMAREA                    02710003
027200              PERFORM 1100-PROCESS-INTER-APPL-COMM                02720003
027300              IF  PS-COMMAREA-NOT-VALID                           02730003
027400*                -- THIS WILL RETURN TO CALLING APPLICATION       02740003
027500*                -- WHEN API IS CALLED                            02750003
027600                 SET DP020-NEXT-ACT-APPL-ERROR                    02760003
027700                                   TO TRUE                        02770003
027800              ELSE                                                02780003
027900                  PERFORM 4000-BUILD-INITIAL-PANEL                02790003
028000                  PERFORM 3200-RESET-ATTRIBUTES                   02800003
028100                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            02810003
028200              END-IF                                              02820003
028300                                                                  02830003
028400         WHEN DP020-NEXT-ACT-READ-MAP                             02840003
028500              PERFORM 2000-PROCESS-PANEL                          02850003
028600                                                                  02860003
028700         WHEN DP020-NEXT-ACT-RETURN                               02870003
028800              CONTINUE                                            02880003
028900                                                                  02890003
029000         WHEN OTHER                                               02900003
029100              SET DP013-LOGIC-ABEND                               02910003
029200                  DP013-NO-ROLLBACK TO TRUE                       02920003
029300              MOVE '1000-CONTROL-PROCESSING'                      02930003
029400                                    TO DP013-PARAGRAPH            02940003
029500              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  02950003
029600                                    TO DP013-MESSAGE-TEXT(1)      02960003
029700              MOVE DP020-NEXT-APPL-ACTIVITY                       02970003
029800                                    TO DP013-MESSAGE-TEXT(2)      02980003
029900              PERFORM DP013-0000-PROCESS-ABEND                    02990003
030000     END-EVALUATE.                                                03000003
030100/                                                                 03010003
030200*----------------------------------------------------------------*03020003
030300* EDIT DATA IN INTER-APPL COMMAREA.                              *03030003
030400*----------------------------------------------------------------*03040003
030500                                                                  03050003
030600 1100-PROCESS-INTER-APPL-COMM.                                    03060003
030700                                                                  03070003
030800     SET PS-COMMAREA-VALID         TO TRUE.                       03080003
030900                                                                  03090003
031000     MOVE AP302-INTER-APPL-FORMAT-IND                             03100003
031100                                    TO ASC-INT-APPL-FORMAT-IND.   03110003
031200     EVALUATE TRUE                                                03120003
031300         WHEN ASC-INTER-APPL-ADD                                  03130003
031400             SET ASC-INSERT-REQUESTED    TO TRUE                  03140003
031500         WHEN ASC-INTER-APPL-UPDATE                               03150003
031600             SET ASC-UPDATE-REQUESTED    TO TRUE                  03160003
031700         WHEN OTHER                                               03170003
031800*           -- ADD OR UPDATE WAS NOT REQUESTED --                 03180003
031900             MOVE PC-TSYMSG-01309        TO DP020-MSG-NUMBER      03190003
032000             SET DP020-MSG-FATAL                                  03200003
032100                 DP020-NEXT-ACT-APPL-ERROR                        03210003
032200                 PS-COMMAREA-NOT-VALID   TO TRUE                  03220003
032300     END-EVALUATE.                                                03230003
032400                                                                  03240003
032500     EVALUATE TRUE                                                03250003
032600                                                                  03260003
032700         WHEN AP302-DUN-NBR = SPACES                              03270003
032800*            -- VENDOR NBR REQUIRED --                            03280003
032900             MOVE PC-TSYMSG-01311          TO DP020-MSG-NUMBER    03290003
033000             SET DP020-MSG-FATAL           TO TRUE                03300003
033100             SET PS-COMMAREA-NOT-VALID     TO TRUE                03310003
033200                                                                  03320003
033300         WHEN OTHER                                               03330003
033400             MOVE AP302-DUN-NBR            TO ASC-KEY-DUN-NBR     03340003
033500                                              DK-DUN-NBR          03350003
033600             SET PS-NOT-FOUND              TO TRUE                03360003
033700             PERFORM 1110-GET-ENT-ID                              03370003
033800                                                                  03380003
033900             IF PS-NOT-FOUND                                      03390003
034000*            -- VENDOR NBR IS INVALID --                          03400003
034100                 MOVE PC-TSYMSG-01095      TO DP020-MSG-NUMBER    03410003
034200                 SET DP020-MSG-FATAL       TO TRUE                03420003
034300                 SET PS-COMMAREA-NOT-VALID TO TRUE                03430003
034400                                                                  03440003
034500             ELSE                                                 03450003
034600                 MOVE EXTENT-ENT-ID        TO ASC-KEY-ENT-ID      03460003
034700                                              DK-ENT-ID           03470003
034800                 SET PS-NOT-FOUND      TO TRUE                    03480003
034900                 SET ASC-NOT-FOUND-AT-ALL TO TRUE                 03490003
035000                 PERFORM 4020-GET-APVNDS                          03500003
035100                 IF PS-NOT-FOUND                                  03510003
035200                    IF ASC-UPDATE-REQUESTED                       03520003
035300*            -- APVNDS ROW NOT FOUND FOR AN UPDATE --             03530003
035400                       MOVE PC-TSYMSG-01423 TO DP020-MSG-NUMBER   03540003
035500                       SET DP020-MSG-FATAL       TO TRUE          03550003
035600                       SET PS-COMMAREA-NOT-VALID TO TRUE          03560003
035700                   END-IF                                         03570003
035800                 ELSE                                             03580003
035900                    IF ASC-INSERT-REQUESTED                       03590003
036000*            -- APVNDS ROW FOUND FOR AN INSERT --                 03600003
036100                       MOVE PC-TSYMSG-01424 TO DP020-MSG-NUMBER   03610003
036200                       SET DP020-MSG-FATAL       TO TRUE          03620003
036300                       SET PS-COMMAREA-NOT-VALID TO TRUE          03630003
036400                   END-IF                                         03640003
036500                 END-IF                                           03650003
036600             END-IF                                               03660003
036700                                                                  03670003
036800     END-EVALUATE.                                                03680003
036900/                                                                 03690003
037000*----------------------------------------------------------------*03700003
037100*    GET THE ENT ID                                              *03710003
037200*----------------------------------------------------------------*03720003
037300 1110-GET-ENT-ID.                                                 03730003
037400                                                                  03740003
037500     EXEC SQL                                                     03750003
037600          SELECT ENT_ID                                           03760003
037700            INTO :EXTENT-ENT-ID                                   03770003
037800            FROM TEXTENT                                          03780003
037900           WHERE DUN_NBR    = :DK-DUN-NBR                         03790003
038000             AND STATUS_CDE = 'A'                                 03800003
038100     END-EXEC.                                                    03810003
038200                                                                  03820003
038300     EVALUATE TRUE                                                03830003
038400         WHEN SQLCODE = +0                                        03840003
038500              SET PS-FOUND TO TRUE                                03850003
038600                                                                  03860003
038700         WHEN SQLCODE = +100                                      03870003
038800              CONTINUE                                            03880003
038900                                                                  03890003
039000         WHEN SQLWARN0 NOT = SPACES                               03900003
039100         WHEN SQLCODE < +0                                        03910003
039200         WHEN SQLCODE > +0                                        03920003
039300              MOVE '1110-GET-ENT-ID'                              03930003
039400                              TO DP013-PARAGRAPH                  03940003
039500              MOVE 'UNSUCCESSFUL SELECT ENTERPRISE ID'            03950003
039600                              TO DP013-MESSAGE-TEXT (1)           03960003
039700              MOVE SQLCA      TO DP013-SQLCA                      03970003
039800              MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)         03980003
039900              SET DP013-DB2-ABEND                                 03990003
040000                  DP013-XCTL-DISPLAY-RESTART                      04000003
040100                              TO TRUE                             04010003
040200              PERFORM DP013-0000-PROCESS-ABEND                    04020003
040300     END-EVALUATE.                                                04030003
040400/                                                                 04040003
040500*----------------------------------------------------------------*04050003
040600*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*04060003
040700*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*04070003
040800*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *04080003
040900*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *04090003
041000*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *04100003
041100*----------------------------------------------------------------*04110003
041200                                                                  04120003
041300 2000-PROCESS-PANEL.                                              04130003
041400                                                                  04140003
041500     EVALUATE TRUE                                                04150003
041600                                                                  04160003
041700         WHEN DP020-SRC-AID = DP016-CLEAR                         04170003
041800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04180003
041900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04190003
042000                                                                  04200003
042100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04210003
042200             PERFORM 4000-BUILD-INITIAL-PANEL                     04220003
042300             PERFORM 3200-RESET-ATTRIBUTES                        04230003
042400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04240003
042500                                                                  04250003
042600         WHEN OTHER                                               04260003
042700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04270003
042800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04280003
042900             IF  PS-NO-ERROR                                      04290003
043000                 SET DP030-CONTINUE-GO                            04300003
043100                                   TO TRUE                        04310003
043200                 PERFORM 2100-CHECK-FUNCTION-KEY                  04320003
043300             ELSE                                                 04330003
043400                 SET DP030-OVERRIDE-GO                            04340003
043500                                   TO TRUE                        04350003
043600             END-IF                                               04360003
043700     END-EVALUATE.                                                04370003
043800                                                                  04380003
043900/                                                                 04390003
044000*----------------------------------------------------------------*04400003
044100*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *04410003
044200*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*04420003
044300*    FROM THE CICS ARCHITECTURE API.                             *04430003
044400*----------------------------------------------------------------*04440003
044500                                                                  04450003
044600 2100-CHECK-FUNCTION-KEY.                                         04460003
044700                                                                  04470003
044800     EVALUATE TRUE                                                04480003
044900         WHEN DP020-SRC-AID = DP016-ENTER                         04490003
045000             SET ASC-DO-NOT-CHECK-CONFIRM TO TRUE                 04500003
045100                                                                  04510003
045200         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    04520003
045300             SET DP030-CONTINUE-GO TO TRUE                        04530003
045400             IF ASC-OK-TO-CONFIRM-ADD                             04540003
045500                PERFORM 5000-INSERT-PROCESSING                    04550003
045600*-- ADD SUCCESSFUL --                                             04560003
045700                MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER         04570003
045800                SET DP020-MSG-INFORMATIONAL TO TRUE               04580003
045900             ELSE                                                 04590003
046000                IF ASC-OK-TO-CONFIRM-UPD                          04600003
046100                   PERFORM 5100-UPDATE-PROCESSING                 04610003
046200*-- UPDATE SUCCESSFUL --                                          04620003
046300                   MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER      04630003
046400                   SET DP020-MSG-INFORMATIONAL TO TRUE            04640003
046500                ELSE                                              04650003
046600                   SET DP013-NO-ROLLBACK                          04660003
046700                       DP013-XCTL-DISPLAY-RESTART                 04670003
046800                       DP013-CICS-ABEND  TO TRUE                  04680003
046900                   MOVE '2100-CHECK-FUNCTION-KEY'                 04690003
047000                                      TO DP013-PARAGRAPH          04700003
047100                   MOVE                                           04710003
047200                     'INVALID FUNCTION KEY NOT CAPTURED BY API'   04720003
047300                                      TO DP013-MESSAGE-TEXT (1)   04730003
047400                   PERFORM DP013-0000-PROCESS-ABEND               04740003
047500                END-IF                                            04750003
047600             END-IF                                               04760003
047700             SET ASC-DO-NOT-CHECK-CONFIRM TO TRUE                 04770003
047800                                                                  04780003
047900*   FOR AN INSERT                                                 04790003
048000         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               04800003
048100             SET DP030-CONTINUE-GO TO TRUE                        04810003
048200             SET PS-NOT-FOUND TO TRUE                             04820003
048300             SET ASC-DO-NOT-CHECK-CONFIRM TO TRUE                 04830003
048400             SET ASC-NOT-FOUND-AT-ALL TO TRUE                     04840003
048500             PERFORM 4020-GET-APVNDS                              04850003
048600             IF PS-FOUND                                          04860003
048700*-- ALREADY EXISTS --                                             04870003
048800                MOVE PC-TSYMSG-01424 TO DP020-MSG-NUMBER          04880003
048900                SET DP020-MSG-FATAL  TO TRUE                      04890003
049000             ELSE                                                 04900003
049100               PERFORM 5200-CHECK-DAY-RANGE                       04910003
049110               IF PS-RECN-CUTOFF-NOT-VALID                        04911008
049120                 MOVE PC-TSYMSG-03593 TO DP020-MSG-NUMBER         04912010
049130                 SET DP020-MSG-FATAL  TO TRUE                     04913008
049140               ELSE                                               04914008
049200                 IF DP020-MSG-WARNING                             04920008
049300*-- DAY AND/OR DAYS ARE OUTSIDE OF RANGE - CONFIRM B4 ADD         04930003
049400                    MOVE PC-TSYMSG-01435  TO DP020-MSG-NUMBER     04940008
049500                    SET ASC-OK-TO-CONFIRM-ADD    TO TRUE          04950008
049600                 ELSE                                             04960008
049700                    PERFORM 5000-INSERT-PROCESSING                04970008
049800*-- ADD SUCCESSFUL --                                             04980003
049900                    MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER     04990008
050000                    SET DP020-MSG-INFORMATIONAL TO TRUE           05000008
050100                 END-IF                                           05010008
050200               END-IF                                             05020008
050210             END-IF                                               05021008
050300                                                                  05030003
050400*   FOR AN UPDATE                                                 05040003
050500         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               05050003
050600             SET DP030-CONTINUE-GO TO TRUE                        05060003
050700             SET PS-NOT-FOUND TO TRUE                             05070003
050800             SET ASC-DO-NOT-CHECK-CONFIRM TO TRUE                 05080003
050900             SET ASC-NOT-FOUND-AT-ALL TO TRUE                     05090003
051000             PERFORM 4020-GET-APVNDS                              05100003
051100             IF PS-FOUND                                          05110003
051200                 SET ASC-FIELDS-UNCHANGED TO TRUE                 05120003
051300                 PERFORM 3600-CHECK-IF-FIELDS-CHANGED             05130003
051400                 IF ASC-FIELDS-UNCHANGED                          05140003
051500*-- ALREADY EXISTS --                                             05150003
051600                     MOVE PC-TSYMSG-01169 TO DP020-MSG-NUMBER     05160003
051700                     SET DP020-MSG-FATAL  TO TRUE                 05170003
051800                 ELSE                                             05180003
051900                     PERFORM 5200-CHECK-DAY-RANGE                 05190003
051910                     IF PS-RECN-CUTOFF-NOT-VALID                  05191008
051920                       MOVE PC-TSYMSG-03593 TO DP020-MSG-NUMBER   05192010
051930                       SET DP020-MSG-FATAL  TO TRUE               05193008
051940                     ELSE                                         05194008
052000                       IF DP020-MSG-WARNING                       05200008
052100*-- DAY AND/OR DAYS ARE OUTSIDE OF RANGE - CONFIRM B4 UPDATE      05210003
052200                         MOVE PC-TSYMSG-01434  TO DP020-MSG-NUMBER05220008
052300                         SET ASC-OK-TO-CONFIRM-UPD    TO TRUE     05230008
052400                       ELSE                                       05240008
052500                         PERFORM 5100-UPDATE-PROCESSING           05250008
052600*-- UPDATE SUCCESSFUL --                                          05260003
052700                         MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER05270008
052800                         SET DP020-MSG-INFORMATIONAL TO TRUE      05280008
052810                       END-IF                                     05281008
052900                     END-IF                                       05290003
053000                 END-IF                                           05300003
053100             END-IF                                               05310003
053200                                                                  05320003
053300         WHEN OTHER                                               05330003
053400             SET ASC-DO-NOT-CHECK-CONFIRM TO TRUE                 05340003
053500             SET DP013-NO-ROLLBACK                                05350003
053600                 DP013-XCTL-DISPLAY-RESTART                       05360003
053700                 DP013-CICS-ABEND  TO TRUE                        05370003
053800             MOVE '2100-CHECK-FUNCTION-KEY'                       05380003
053900                                   TO DP013-PARAGRAPH             05390003
054000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05400003
054100                                   TO DP013-MESSAGE-TEXT (1)      05410003
054200             PERFORM DP013-0000-PROCESS-ABEND                     05420003
054300     END-EVALUATE.                                                05430003
054400                                                                  05440003
054500/                                                                 05450003
054600*----------------------------------------------------------------*05460003
054700*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *05470003
054800*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *05480003
054900*----------------------------------------------------------------*05490003
055000 2200-MOVE-SCREEN-TO-COMMAREA.                                    05500003
055100                                                                  05510003
055200     IF  AVARINDL > ZERO                                          05520003
055300         IF AVARINDI = 'A'                                        05530003
055400             MOVE 'S'              TO ASC-VND-FLT-DAY-IND         05540003
055500         ELSE                                                     05550003
055600             MOVE AVARINDI         TO ASC-VND-FLT-DAY-IND         05560003
055700         END-IF                                                   05570003
055800     ELSE                                                         05580003
055900         IF  AVARINDF = DP015-ERASE-EOF                           05590003
056000             MOVE SPACES           TO ASC-VND-FLT-DAY-IND         05600003
056100         END-IF                                                   05610003
056200     END-IF.                                                      05620003
056300                                                                  05630003
056400     IF  APYTFLTL > ZERO                                          05640003
056500         MOVE APYTFLTI             TO ASC-PAYT-FLOAT-DAYS-X       05650003
056600     ELSE                                                         05660003
056700         IF  APYTFLTF = DP015-ERASE-EOF                           05670003
056800             MOVE ZEROS            TO ASC-PAYT-FLOAT-DAYS         05680003
056900                                      PV-3V-DISP                  05690003
057000             MOVE PV-3V-DISP-X     TO ASC-PAYT-FLOAT-DAYS-X       05700003
057100         END-IF                                                   05710003
057200     END-IF.                                                      05720003
057300                                                                  05730003
057400     IF  AEXCFLTL > ZERO                                          05740003
057500         MOVE AEXCFLTI             TO ASC-EXC-FLT-DAYS-X          05750003
057600     ELSE                                                         05760003
057700         IF  AEXCFLTF = DP015-ERASE-EOF                           05770003
057800             MOVE ZEROS            TO ASC-EXC-FLT-DAYS            05780003
057900                                      PV-3V-DISP                  05790003
058000             MOVE PV-3V-DISP-X     TO ASC-EXC-FLT-DAYS-X          05800003
058100         END-IF                                                   05810003
058200     END-IF.                                                      05820003
058300                                                                  05830003
058400     IF  ARCVVARL > ZERO                                          05840003
058500         MOVE ARCVVARI             TO ASC-RCVG-VARN-DAYS-X        05850003
058600     ELSE                                                         05860003
058700         IF  ARCVVARF = DP015-ERASE-EOF                           05870003
058800             MOVE ZEROS            TO ASC-RCVG-VARN-DAYS          05880003
058900                                      PV-3V-DISP                  05890003
059000             MOVE PV-3V-DISP-X     TO ASC-RCVG-VARN-DAYS-X        05900003
059100         END-IF                                                   05910003
059200     END-IF.                                                      05920003
059300                                                                  05930003
059400     IF  ARCNCUTL > ZERO                                          05940003
059500         MOVE ARCNCUTI             TO ASC-RECN-CTOFF-DAY-QTY-X    05950003
059600     ELSE                                                         05960003
059700         IF  ARCNCUTF = DP015-ERASE-EOF                           05970003
059800             MOVE ZEROS            TO ASC-RECN-CTOFF-DAY-QTY      05980003
059900                                      PV-3V-DISP                  05990003
060000             MOVE PV-3V-DISP-X     TO ASC-RECN-CTOFF-DAY-QTY-X    06000003
060100         END-IF                                                   06010003
060200     END-IF.                                                      06020003
060300                                                                  06030003
060400     MOVE ASC-KEY-DUN-NBR          TO DK-DUN-NBR.                 06040003
060500     MOVE ASC-KEY-ENT-ID           TO DK-ENT-ID.                  06050003
060600/                                                                 06060003
060700*----------------------------------------------------------------*06070003
060800*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *06080003
060900*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *06090003
061000*----------------------------------------------------------------*06100003
061100 3000-EDIT-DATA-IN-COMMAREA.                                      06110003
061200                                                                  06120003
061300     PERFORM 3200-RESET-ATTRIBUTES.                               06130003
061400                                                                  06140003
061500     IF  ASC-PAYT-FLOAT-DAYS-X > SPACES                           06150003
061600         MOVE ASC-PAYT-FLOAT-DAYS-X                               06160003
061700                                  TO DP010I-UNEDITED-FIELD        06170003
061800         MOVE 3                   TO DP010I-MAXIMUM-DIGITS        06180003
061900         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      06190003
062000         SET  DP010I-NEGATIVE-ALLOWED                             06200003
062100                                         TO TRUE                  06210003
062220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06222019
062230                         USING DP010I-NUMERIC-EDIT-AREA           06223019
062300         IF DP010I-ERROR-DETECTED                                 06230003
062400             SET DP020-MSG-FATAL         TO TRUE                  06240003
062500             MOVE DP015-UNP-ALP-BRT-OFF  TO APYTFLTA              06250003
062600             MOVE DP015-RED              TO APYTFLTC              06260003
062700             MOVE DP015-REVERSE          TO APYTFLTH              06270003
062800             MOVE -1                     TO APYTFLTL              06280003
062900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06290003
063000             SET PS-ERROR                TO TRUE                  06300003
063100             IF DP010I-DIGIT-COUNT   > 3                          06310003
063200             OR DP010I-DECIMAL-COUNT > 0                          06320003
063300*        --  NUMBER OUT OF RANGE --                               06330003
063400                 MOVE PC-TSYMSG-01314    TO DP020-MSG-NUMBER      06340003
063500             ELSE                                                 06350003
063600*        --  MUST BE NUMERIC --                                   06360003
063700                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      06370003
063800             END-IF                                               06380003
063900         ELSE                                                     06390003
064000             MOVE DP010I-NUMERIC-FIELD                            06400003
064100                                     TO ASC-PAYT-FLOAT-DAYS       06410003
064200                                        PV-3V-DISP                06420003
064300             MOVE PV-3V-DISP-X       TO ASC-PAYT-FLOAT-DAYS-X     06430003
064400         END-IF                                                   06440003
064500     ELSE                                                         06450003
064600         SET DP020-MSG-FATAL         TO TRUE                      06460003
064700*    --  REQUIRED ENTRY  --                                       06470003
064800         MOVE DP015-UNP-ALP-BRT-OFF                               06480003
064900                                     TO APYTFLTA                  06490003
065000         MOVE DP015-RED              TO APYTFLTC                  06500003
065100         MOVE DP015-REVERSE          TO APYTFLTH                  06510003
065200         MOVE -1                     TO APYTFLTL                  06520003
065300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06530003
065400         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          06540003
065500         SET PS-ERROR                TO TRUE                      06550003
065600     END-IF.                                                      06560003
065700                                                                  06570003
065800     IF  ASC-EXC-FLT-DAYS-X > SPACES                              06580003
065900         MOVE ASC-EXC-FLT-DAYS-X                                  06590003
066000                              TO DP010I-UNEDITED-FIELD            06600003
066100         MOVE 3               TO DP010I-MAXIMUM-DIGITS            06610003
066200         MOVE 0               TO DP010I-MAXIMUM-DECIMALS          06620003
066300         SET  DP010I-NEGATIVE-ALLOWED                             06630003
066400                              TO TRUE                             06640003
066520         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06652020
066530                         USING DP010I-NUMERIC-EDIT-AREA           06653020
066600         IF DP010I-ERROR-DETECTED                                 06660003
066700             SET DP020-MSG-FATAL         TO TRUE                  06670003
066800             MOVE DP015-UNP-ALP-BRT-OFF  TO AEXCFLTA              06680003
066900             MOVE DP015-RED              TO AEXCFLTC              06690003
067000             MOVE DP015-REVERSE          TO AEXCFLTH              06700003
067100             MOVE -1                     TO AEXCFLTL              06710003
067200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06720003
067300             SET PS-ERROR                TO TRUE                  06730003
067400             IF DP010I-DIGIT-COUNT   > 3                          06740003
067500             OR DP010I-DECIMAL-COUNT > 0                          06750003
067600*        --  NUMBER OUT OF RANGE --                               06760003
067700                 MOVE PC-TSYMSG-01314    TO DP020-MSG-NUMBER      06770003
067800             ELSE                                                 06780003
067900*        --  MUST BE NUMERIC --                                   06790003
068000                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      06800003
068100             END-IF                                               06810003
068200         ELSE                                                     06820003
068300             MOVE DP010I-NUMERIC-FIELD                            06830003
068400                                     TO ASC-EXC-FLT-DAYS          06840003
068500                                        PV-3V-DISP                06850003
068600             MOVE PV-3V-DISP-X       TO ASC-EXC-FLT-DAYS-X        06860003
068700         END-IF                                                   06870003
068800     ELSE                                                         06880003
068900         SET DP020-MSG-FATAL         TO TRUE                      06890003
069000*    --  REQUIRED ENTRY  --                                       06900003
069100         MOVE DP015-UNP-ALP-BRT-OFF  TO AEXCFLTA                  06910003
069200         MOVE DP015-RED              TO AEXCFLTC                  06920003
069300         MOVE DP015-REVERSE          TO AEXCFLTH                  06930003
069400         MOVE -1                     TO AEXCFLTL                  06940003
069500         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06950003
069600         IF PS-NO-ERROR                                           06960003
069700             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          06970003
069800         END-IF                                                   06980003
069900         SET PS-ERROR                TO TRUE                      06990003
070000     END-IF.                                                      07000003
070100                                                                  07010003
070200     IF  ASC-RCVG-VARN-DAYS-X     > SPACES                        07020003
070300         MOVE ASC-RCVG-VARN-DAYS-X                                07030003
070400                              TO DP010I-UNEDITED-FIELD            07040003
070500         MOVE 3               TO DP010I-MAXIMUM-DIGITS            07050003
070600         MOVE 0               TO DP010I-MAXIMUM-DECIMALS          07060003
070700         SET  DP010I-NEGATIVE-ALLOWED                             07070003
070800                              TO TRUE                             07080003
070920         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07092020
070930                         USING DP010I-NUMERIC-EDIT-AREA           07093020
071000         IF DP010I-ERROR-DETECTED                                 07100003
071100             SET DP020-MSG-FATAL         TO TRUE                  07110003
071200             MOVE DP015-UNP-ALP-BRT-OFF  TO ARCVVARA              07120003
071300             MOVE DP015-RED              TO ARCVVARC              07130003
071400             MOVE DP015-REVERSE          TO ARCVVARH              07140003
071500             MOVE -1                     TO ARCVVARL              07150003
071600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07160003
071700             SET PS-ERROR                TO TRUE                  07170003
071800             IF DP010I-DIGIT-COUNT   > 3                          07180003
071900             OR DP010I-DECIMAL-COUNT > 0                          07190003
072000*        --  NUMBER OUT OF RANGE --                               07200003
072100                 MOVE PC-TSYMSG-01314    TO DP020-MSG-NUMBER      07210003
072200             ELSE                                                 07220003
072300*        --  MUST BE NUMERIC --                                   07230003
072400                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      07240003
072500             END-IF                                               07250003
072600         ELSE                                                     07260003
072700             MOVE DP010I-NUMERIC-FIELD                            07270003
072800                                     TO ASC-RCVG-VARN-DAYS        07280003
072900                                        PV-3V-DISP                07290003
073000             MOVE PV-3V-DISP-X       TO ASC-RCVG-VARN-DAYS-X      07300003
073100         END-IF                                                   07310003
073200     ELSE                                                         07320003
073300         SET DP020-MSG-FATAL         TO TRUE                      07330003
073400*    --  REQUIRED ENTRY  --                                       07340003
073500         MOVE DP015-UNP-ALP-BRT-OFF  TO ARCVVARA                  07350003
073600         MOVE DP015-RED              TO ARCVVARC                  07360003
073700         MOVE DP015-REVERSE          TO ARCVVARH                  07370003
073800         MOVE -1                     TO ARCVVARL                  07380003
073900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      07390003
074000         IF PS-NO-ERROR                                           07400003
074100             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          07410003
074200         END-IF                                                   07420003
074300         SET PS-ERROR                TO TRUE                      07430003
074400     END-IF.                                                      07440003
074500                                                                  07450003
074600     IF  ASC-RECN-CTOFF-DAY-QTY-X > SPACES                        07460003
074700         MOVE ASC-RECN-CTOFF-DAY-QTY-X                            07470003
074800                                  TO DP010I-UNEDITED-FIELD        07480003
074900         MOVE 3                   TO DP010I-MAXIMUM-DIGITS        07490003
075000         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      07500003
075100         SET  DP010I-NEGATIVE-NOT-ALLOWED                         07510004
075200                                         TO TRUE                  07520004
075320         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07532020
075330                         USING DP010I-NUMERIC-EDIT-AREA           07533020
075400         IF DP010I-ERROR-DETECTED                                 07540003
075500             SET DP020-MSG-FATAL         TO TRUE                  07550003
075600             MOVE DP015-UNP-ALP-BRT-OFF  TO ARCNCUTA              07560003
075700             MOVE DP015-RED              TO ARCNCUTC              07570003
075800             MOVE DP015-REVERSE          TO ARCNCUTH              07580003
075900             MOVE -1                     TO ARCNCUTL              07590003
076000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07600003
076100             SET PS-ERROR                TO TRUE                  07610003
076200             IF DP010I-DIGIT-COUNT   > 3                          07620003
076300             OR DP010I-DECIMAL-COUNT > 0                          07630003
076400*        --  NUMBER OUT OF RANGE --                               07640003
076500                 MOVE PC-TSYMSG-01314    TO DP020-MSG-NUMBER      07650003
076520*         --  NEGATIVE NUMBER NOT ALLOWED --                      07652004
076600             ELSE                                                 07660003
076620               IF DP010I-NEGATIVE-SIGN-FOUND                      07662004
076621                 MOVE PC-TSYMSG-03592    TO DP020-MSG-NUMBER      07662104
076630               ELSE                                               07663004
076700*        --  MUST BE NUMERIC --                                   07670003
076800                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      07680003
076900               END-IF                                             07690004
076910           END-IF                                                 07691004
077000         ELSE                                                     07700003
077100             MOVE DP010I-NUMERIC-FIELD                            07710003
077200                                     TO ASC-RECN-CTOFF-DAY-QTY    07720003
077300                                        PV-3V-DISP                07730003
077400             MOVE PV-3V-DISP-X       TO ASC-RECN-CTOFF-DAY-QTY-X  07740003
077500         END-IF                                                   07750003
077600     ELSE                                                         07760003
077700         SET DP020-MSG-FATAL         TO TRUE                      07770003
077800*    --  REQUIRED ENTRY  --                                       07780003
077900         MOVE DP015-UNP-ALP-BRT-OFF                               07790003
078000                                     TO ARCNCUTA                  07800003
078100         MOVE DP015-RED              TO ARCNCUTC                  07810003
078200         MOVE DP015-REVERSE          TO ARCNCUTH                  07820003
078300         MOVE -1                     TO ARCNCUTL                  07830003
078400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      07840003
078500         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          07850003
078600         SET PS-ERROR                TO TRUE                      07860003
078700     END-IF.                                                      07870003
078800                                                                  07880003
078900     IF  ASC-VND-FLT-DAY-IND     > SPACES                         07890003
079000        IF STATUS-SPECIFIED OR STATUS-INACTIVE                    07900003
079100            CONTINUE                                              07910003
079200        ELSE                                                      07920003
079300            SET DP020-MSG-FATAL         TO TRUE                   07930003
079400*        --  STATUS MUST BE 'A' OR 'I' --                         07940003
079500            MOVE DP015-UNP-ALP-BRT-OFF  TO AVARINDA               07950003
079600            MOVE DP015-RED              TO AVARINDC               07960003
079700            MOVE DP015-REVERSE          TO AVARINDH               07970003
079800            MOVE -1                     TO AVARINDL               07980003
079900            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   07990003
080000            MOVE PC-TSYMSG-01313        TO DP020-MSG-NUMBER       08000003
080100            SET PS-ERROR                TO TRUE                   08010003
080200        END-IF                                                    08020003
080300     ELSE                                                         08030003
080400         SET DP020-MSG-FATAL            TO TRUE                   08040003
080500*        --  REQUIRED ENTRY  --                                   08050003
080600         MOVE DP015-UNP-ALP-BRT-OFF                               08060003
080700                                        TO AVARINDA               08070003
080800         MOVE DP015-RED                 TO AVARINDC               08080003
080900         MOVE DP015-REVERSE             TO AVARINDH               08090003
081000         MOVE -1                        TO AVARINDL               08100003
081100         SET DP030-SET-CURSOR-APPL-1    TO TRUE                   08110003
081200         MOVE PC-TSYMSG-00007           TO DP020-MSG-NUMBER       08120003
081300         SET PS-ERROR                   TO TRUE                   08130003
081400     END-IF.                                                      08140003
081500/                                                                 08150003
081600*----------------------------------------------------------------*08160003
081700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *08170003
081800*----------------------------------------------------------------*08180003
081900                                                                  08190003
082000 3200-RESET-ATTRIBUTES.                                           08200003
082100                                                                  08210003
082200     MOVE DP015-UNP-ALP-NOR-OFF TO AVARINDA                       08220003
082300                                   APYTFLTA                       08230003
082400                                   AEXCFLTA                       08240003
082500                                   ARCVVARA                       08250003
082600                                   ARCNCUTA.                      08260003
082700                                                                  08270003
082800     MOVE DP015-GREEN           TO AVARINDC                       08280003
082900                                   APYTFLTC                       08290003
083000                                   AEXCFLTC                       08300003
083100                                   ARCVVARC                       08310003
083200                                   ARCNCUTC.                      08320003
083300                                                                  08330003
083400                                                                  08340003
083500     MOVE DP015-UNDERLINE       TO AVARINDH                       08350003
083600                                   APYTFLTH                       08360003
083700                                   AEXCFLTH                       08370003
083800                                   ARCVVARH                       08380003
083900                                   ARCNCUTH.                      08390003
084000/                                                                 08400003
084100 3600-CHECK-IF-FIELDS-CHANGED.                                    08410003
084200                                                                  08420003
084300     IF ASC-VND-FLT-DAY-IND      = ASC-VND-FLT-DAY-IND-OLD        08430003
084400     AND ASC-PAYT-FLOAT-DAYS     = ASC-PAYT-FLOAT-DAYS-OLD        08440003
084500     AND ASC-EXC-FLT-DAYS        = ASC-EXC-FLT-DAYS-OLD           08450003
084600     AND ASC-RCVG-VARN-DAYS      = ASC-RCVG-VARN-DAYS-OLD         08460003
084700     AND ASC-RECN-CTOFF-DAY-QTY  = ASC-RECN-CTOFF-DAY-QTY-OLD     08470003
084800         CONTINUE                                                 08480003
084900     ELSE                                                         08490003
085000         SET ASC-FIELDS-MODIFIED  TO TRUE                         08500003
085100     END-IF.                                                      08510003
085200/                                                                 08520003
085300 4000-BUILD-INITIAL-PANEL.                                        08530003
085400                                                                  08540003
085500     INITIALIZE ASC-SCREEN-FIELDS                                 08550003
085600                DCLTAPVNDS                                        08560003
085700                DCLTENTNME                                        08570003
085800                DK-DB2-KEYS.                                      08580003
085900                                                                  08590003
086000     MOVE -1                         TO AVARINDL.                 08600003
086100     SET PS-NO-ERROR                 TO TRUE.                     08610003
086200     SET DP030-SET-CURSOR-APPL-1     TO TRUE.                     08620003
086300     SET ASC-DO-NOT-CHECK-CONFIRM    TO TRUE.                     08630003
086400                                                                  08640003
086500     MOVE ASC-KEY-DUN-NBR            TO DK-DUN-NBR                08650003
086600                                        ASC-DUN-NBR.              08660003
086700     MOVE ASC-KEY-ENT-ID             TO DK-ENT-ID.                08670003
086800                                                                  08680003
086900     PERFORM 4010-GET-VENDOR-NAME.                                08690003
087000     MOVE ENTNME-ENT-NAME-DESC       TO ASC-ENT-NAME-DESC.        08700003
087100                                                                  08710003
087200     SET PS-NOT-FOUND TO TRUE.                                    08720003
087300     SET ASC-NOT-FOUND-AT-ALL TO TRUE.                            08730003
087400     PERFORM 4020-GET-APVNDS.                                     08740003
087500     IF PS-FOUND                                                  08750003
087600         PERFORM 4200-MOVE-DATABASE-TO-COMMAREA                   08760003
087700     ELSE                                                         08770003
087800*      A NOT FOUND WILL OCCUR ONLY FOR AN ADD.  AN UPDATE WITH    08780003
087900*      NO ROW ON TAPVNDS WILL HAVE ERRORED OUT IN COMMAREA EDIT.  08790003
088000         MOVE SPACE                TO ASC-VND-FLT-DAY-IND         08800003
088100                                      ASC-VND-FLT-DAY-IND-OLD     08810003
088200         MOVE SPACE                TO ASC-IND-DESC1               08820003
088300         MOVE PC-IND-DESC-2        TO ASC-IND-DESC2               08830003
088400         MOVE ZEROS                TO ASC-PAYT-FLOAT-DAYS         08840003
088500                                      ASC-PAYT-FLOAT-DAYS-OLD     08850003
088600                                      PV-3V-DISP                  08860003
088700         MOVE PV-3V-DISP-X         TO ASC-PAYT-FLOAT-DAYS-X       08870003
088800         MOVE ZEROS                TO ASC-EXC-FLT-DAYS            08880003
088900                                      ASC-EXC-FLT-DAYS-OLD        08890003
089000                                      PV-3V-DISP                  08900003
089100         MOVE PV-3V-DISP-X         TO ASC-EXC-FLT-DAYS-X          08910003
089200         MOVE ZEROS                TO ASC-RCVG-VARN-DAYS          08920003
089300                                      ASC-RCVG-VARN-DAYS-OLD      08930003
089400                                      PV-3V-DISP                  08940003
089500         MOVE ZEROS                TO ASC-RECN-CTOFF-DAY-QTY      08950003
089600                                      ASC-RECN-CTOFF-DAY-QTY-OLD  08960003
089700                                      PV-3V-DISP                  08970003
089800         MOVE PV-3V-DISP-X         TO ASC-RECN-CTOFF-DAY-QTY-X    08980003
089900     END-IF.                                                      08990003
090000                                                                  09000003
090100/                                                                 09010003
090200*----------------------------------------------------------------*09020003
090300*    GET THE VENDOR NAME                                         *09030003
090400*----------------------------------------------------------------*09040003
090500 4010-GET-VENDOR-NAME.                                            09050003
090600                                                                  09060003
090700     EXEC SQL                                                     09070003
090800          SELECT ENT_NAME_DESC                                    09080003
090900            INTO :ENTNME-ENT-NAME-DESC                            09090003
091000            FROM TENTNME                                          09100003
091100           WHERE ENT_ID     = :DK-ENT-ID                          09110003
091200             AND TYPE_CDE   = '01'                                09120003
091300     END-EXEC.                                                    09130003
091400                                                                  09140003
091500     EVALUATE TRUE                                                09150003
091600         WHEN SQLCODE = +0                                        09160003
091700              CONTINUE                                            09170003
091800                                                                  09180003
091900         WHEN SQLCODE = +100                                      09190003
092000              MOVE 'VENDOR NAME NOT FOUND'                        09200003
092100                                    TO ENTNME-ENT-NAME-DESC       09210003
092200         WHEN SQLWARN0 NOT = SPACES                               09220003
092300         WHEN SQLCODE < +0                                        09230003
092400         WHEN SQLCODE > +0                                        09240003
092500              MOVE '4010-GET-VENDOR-NAME'                         09250003
092600                              TO DP013-PARAGRAPH                  09260003
092700              MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'          09270003
092800                              TO DP013-MESSAGE-TEXT (1)           09280003
092900              MOVE SQLCA      TO DP013-SQLCA                      09290003
093000              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)         09300003
093100              SET DP013-DB2-ABEND                                 09310003
093200                  DP013-XCTL-DISPLAY-RESTART                      09320003
093300                              TO TRUE                             09330003
093400              PERFORM DP013-0000-PROCESS-ABEND                    09340003
093500     END-EVALUATE.                                                09350003
093600/                                                                 09360003
093700*----------------------------------------------------------------*09370003
093800*    RETRIEVE THE ROW FROM TAPVNDS IF IT EXISTS.                 *09380003
093900*----------------------------------------------------------------*09390003
094000 4020-GET-APVNDS.                                                 09400003
094100                                                                  09410003
094200     EXEC SQL                                                     09420003
094300          SELECT ENT_ID                                           09430003
094400                ,PAYT_FLOAT_DAY_QTY                               09440003
094500                ,EXC_FLT_DAY_QTY                                  09450003
094600                ,RCVG_VARN_DAY_QTY                                09460003
094700                ,VND_FLT_DAY_IND                                  09470003
094800                ,RECN_CTOFF_DAY_QTY                               09480003
094900            INTO :APVNDS-ENT-ID                                   09490003
095000                ,:APVNDS-PAYT-FLOAT-DAY-QTY                       09500003
095100                ,:APVNDS-EXC-FLT-DAY-QTY                          09510003
095200                ,:APVNDS-RCVG-VARN-DAY-QTY                        09520003
095300                ,:APVNDS-VND-FLT-DAY-IND                          09530003
095400                ,:APVNDS-RECN-CTOFF-DAY-QTY                       09540003
095500            FROM TAPVNDS                                          09550003
095600           WHERE ENT_ID     = :DK-ENT-ID                          09560003
095700     END-EXEC.                                                    09570003
095800                                                                  09580003
095900     EVALUATE TRUE                                                09590003
096000         WHEN SQLCODE = +0                                        09600003
096100              IF APVNDS-VND-FLT-DAY-IND = ' '                     09610003
096200                 SET ASC-NOT-FOUND-FOR-IND TO TRUE                09620003
096300              ELSE                                                09630003
096400                 SET PS-FOUND              TO TRUE                09640003
096500                 SET ASC-FOUND             TO TRUE                09650003
096600              END-IF                                              09660003
096700                                                                  09670003
096800         WHEN SQLCODE = +100                                      09680003
096900              CONTINUE                                            09690003
097000                                                                  09700003
097100         WHEN SQLWARN0 NOT = SPACES                               09710003
097200         WHEN SQLCODE < +0                                        09720003
097300         WHEN SQLCODE > +0                                        09730003
097400              MOVE '4020-GET-APVNDS'                              09740003
097500                              TO DP013-PARAGRAPH                  09750003
097600              MOVE 'UNSUCCESSFUL SELECT AP VENDOR CNTRL'          09760003
097700                              TO DP013-MESSAGE-TEXT (1)           09770003
097800              MOVE SQLCA      TO DP013-SQLCA                      09780003
097900              MOVE 'TAPVNDS ' TO DP013-DB2-TABLE-NAME (1)         09790003
098000              SET DP013-DB2-ABEND                                 09800003
098100                  DP013-XCTL-DISPLAY-RESTART                      09810003
098200                              TO TRUE                             09820003
098300              PERFORM DP013-0000-PROCESS-ABEND                    09830003
098400     END-EVALUATE.                                                09840003
098500/                                                                 09850003
098600*---------------------------------------------------------------- 09860003
098700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.      09870003
098800*---------------------------------------------------------------- 09880003
098900                                                                  09890003
099000 4200-MOVE-DATABASE-TO-COMMAREA.                                  09900003
099100                                                                  09910003
099200     IF APVNDS-VND-FLT-DAY-IND = 'V'                              09920003
099300*       VENDOR PAYMENT DAYS ARE SPECIFIED                         09930003
099400         MOVE PC-IND-DESC-SPECIFIC    TO ASC-IND-DESC1            09940003
099500     ELSE                                                         09950003
099600        IF APVNDS-VND-FLT-DAY-IND = 'D'                           09960003
099700*       VENDOR PAYMENT DAYS ARE INACTIVE                          09970003
099800            MOVE PC-IND-DESC-INACTIVE    TO ASC-IND-DESC1         09980003
099900        ELSE                                                      09990003
100000            MOVE SPACES                  TO ASC-IND-DESC1         10000003
100100        END-IF                                                    10010003
100200     END-IF.                                                      10020003
100300                                                                  10030003
100400     IF APVNDS-VND-FLT-DAY-IND  = 'V'                             10040003
100500        MOVE 'S'                      TO ASC-VND-FLT-DAY-IND      10050003
100600                                         ASC-VND-FLT-DAY-IND-OLD  10060003
100700     ELSE                                                         10070003
100800        IF APVNDS-VND-FLT-DAY-IND  = 'D'                          10080003
100900           MOVE 'I'                   TO ASC-VND-FLT-DAY-IND      10090003
101000                                         ASC-VND-FLT-DAY-IND-OLD  10100003
101100        ELSE                                                      10110003
101200           MOVE ' '                   TO ASC-VND-FLT-DAY-IND      10120003
101300                                         ASC-VND-FLT-DAY-IND-OLD. 10130003
101400                                                                  10140003
101500     MOVE PC-IND-DESC-2               TO ASC-IND-DESC2.           10150003
101600     MOVE APVNDS-PAYT-FLOAT-DAY-QTY   TO ASC-PAYT-FLOAT-DAYS      10160003
101700                                         ASC-PAYT-FLOAT-DAYS-OLD  10170003
101800                                         PV-3V-DISP.              10180003
101900     MOVE PV-3V-DISP-X                TO ASC-PAYT-FLOAT-DAYS-X.   10190003
102000     MOVE APVNDS-EXC-FLT-DAY-QTY      TO ASC-EXC-FLT-DAYS         10200003
102100                                         ASC-EXC-FLT-DAYS-OLD     10210003
102200                                         PV-3V-DISP.              10220003
102300     MOVE PV-3V-DISP-X                TO ASC-EXC-FLT-DAYS-X.      10230003
102400     MOVE APVNDS-RCVG-VARN-DAY-QTY    TO ASC-RCVG-VARN-DAYS       10240003
102500                                         ASC-RCVG-VARN-DAYS-OLD   10250003
102600                                         PV-3V-DISP.              10260003
102700     MOVE PV-3V-DISP-X                TO ASC-RCVG-VARN-DAYS-X.    10270003
102800                                                                  10280003
102900     MOVE APVNDS-RECN-CTOFF-DAY-QTY   TO ASC-RECN-CTOFF-DAY-QTY   10290003
103000                                       ASC-RECN-CTOFF-DAY-QTY-OLD 10300003
103100                                         PV-3V-DISP.              10310003
103200     MOVE PV-3V-DISP-X                TO ASC-RECN-CTOFF-DAY-QTY-X.10320003
103300                                                                  10330003
103400/                                                                 10340003
103500*----------------------------------------------------------------*10350003
103600*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *10360003
103700*----------------------------------------------------------------*10370003
103800 4400-MOVE-COMMAREA-TO-SCREEN.                                    10380003
103900                                                                  10390003
104000     MOVE ASC-KEY-DUN-NBR          TO AVNDNBRO.                   10400003
104100     MOVE ASC-ENT-NAME-DESC        TO AVNDNMEO.                   10410003
104200     IF ASC-VND-FLT-DAY-IND = 'S'                                 10420003
104300         MOVE 'A'                  TO AVARINDO                    10430003
104400     ELSE                                                         10440003
104500         MOVE ASC-VND-FLT-DAY-IND  TO AVARINDO                    10450003
104600     END-IF.                                                      10460003
104700     MOVE ASC-IND-DESC1            TO AINDSC1O.                   10470003
104800     MOVE ASC-IND-DESC2            TO AINDSC2O.                   10480003
104900     MOVE ASC-PAYT-FLOAT-DAYS      TO APYTFLTO                    10490003
105000                                      PV-3V-DISP.                 10500003
105100     MOVE PV-3V-DISP-X             TO ASC-PAYT-FLOAT-DAYS-X.      10510003
105200     MOVE ASC-EXC-FLT-DAYS         TO AEXCFLTO                    10520003
105300                                      PV-3V-DISP.                 10530003
105400     MOVE PV-3V-DISP-X             TO ASC-EXC-FLT-DAYS-X.         10540003
105500     MOVE ASC-RCVG-VARN-DAYS       TO ARCVVARO                    10550003
105600                                      PV-3V-DISP.                 10560003
105700     MOVE PV-3V-DISP-X             TO ASC-RCVG-VARN-DAYS-X.       10570003
105800     MOVE ASC-RECN-CTOFF-DAY-QTY   TO ARCNCUTO                    10580003
105900                                      PV-3V-DISP.                 10590003
106000     MOVE PV-3V-DISP-X             TO ASC-RECN-CTOFF-DAY-QTY-X.   10600003
106100                                                                  10610003
106200/                                                                 10620003
106300*----------------------------------------------------------------*10630003
106400*    PREPARE TO INSERT TO TAPVNDS                                *10640003
106500*----------------------------------------------------------------*10650003
106600                                                                  10660003
106700 5000-INSERT-PROCESSING.                                          10670003
106800                                                                  10680003
106900     MOVE ASC-KEY-ENT-ID          TO APVNDS-ENT-ID.               10690003
107000     MOVE ASC-PAYT-FLOAT-DAYS     TO APVNDS-PAYT-FLOAT-DAY-QTY.   10700003
107100     MOVE ASC-EXC-FLT-DAYS        TO APVNDS-EXC-FLT-DAY-QTY.      10710003
107200     MOVE ASC-RCVG-VARN-DAYS      TO APVNDS-RCVG-VARN-DAY-QTY.    10720003
107300     MOVE ASC-RECN-CTOFF-DAY-QTY  TO APVNDS-RECN-CTOFF-DAY-QTY.   10730003
107400                                                                  10740003
107500     IF ASC-VND-FLT-DAY-IND  = 'S'                                10750003
107600        MOVE 'V'                  TO APVNDS-VND-FLT-DAY-IND       10760003
107700     ELSE                                                         10770003
107800        MOVE 'D'                  TO APVNDS-VND-FLT-DAY-IND.      10780003
107900                                                                  10790003
108000     IF ASC-NOT-FOUND-FOR-IND                                     10800003
108100        PERFORM 6100-UPDATE-TAPVNDS                               10810003
108200     ELSE                                                         10820003
108300        PERFORM 6000-INSERT-TAPVNDS.                              10830003
108400                                                                  10840003
108500     MOVE ASC-VND-FLT-DAY-IND      TO ASC-VND-FLT-DAY-IND-OLD.    10850003
108600     MOVE ASC-PAYT-FLOAT-DAYS      TO ASC-PAYT-FLOAT-DAYS-OLD.    10860003
108700     MOVE ASC-EXC-FLT-DAYS         TO ASC-EXC-FLT-DAYS-OLD.       10870003
108800     MOVE ASC-RCVG-VARN-DAYS       TO ASC-RCVG-VARN-DAYS-OLD.     10880003
108900     MOVE ASC-RECN-CTOFF-DAY-QTY   TO ASC-RECN-CTOFF-DAY-QTY-OLD. 10890003
109000                                                                  10900003
109100     IF STATUS-SPECIFIED                                          10910003
109200         MOVE PC-IND-DESC-SPECIFIC TO ASC-IND-DESC1               10920003
109300     ELSE                                                         10930003
109400         MOVE PC-IND-DESC-INACTIVE TO ASC-IND-DESC1               10940003
109500     END-IF.                                                      10950003
109600                                                                  10960003
109700/                                                                 10970003
109800*----------------------------------------------------------------*10980003
109900*    PREPARE TO UPDATE TAPVNDS                                   *10990003
110000*----------------------------------------------------------------*11000003
110100 5100-UPDATE-PROCESSING.                                          11010003
110200                                                                  11020003
110300      MOVE ASC-KEY-ENT-ID       TO APVNDS-ENT-ID.                 11030003
110400      MOVE ASC-PAYT-FLOAT-DAYS  TO APVNDS-PAYT-FLOAT-DAY-QTY.     11040003
110500      MOVE ASC-EXC-FLT-DAYS     TO APVNDS-EXC-FLT-DAY-QTY.        11050003
110600      MOVE ASC-RCVG-VARN-DAYS   TO APVNDS-RCVG-VARN-DAY-QTY.      11060003
110700      MOVE ASC-RECN-CTOFF-DAY-QTY TO APVNDS-RECN-CTOFF-DAY-QTY.   11070003
110800                                                                  11080003
110900      IF ASC-VND-FLT-DAY-IND  = 'S'                               11090003
111000         MOVE 'V'               TO APVNDS-VND-FLT-DAY-IND         11100003
111100      ELSE                                                        11110003
111200         MOVE 'D'               TO APVNDS-VND-FLT-DAY-IND.        11120003
111300                                                                  11130003
111400     PERFORM 6100-UPDATE-TAPVNDS.                                 11140003
111500                                                                  11150003
111600     MOVE ASC-VND-FLT-DAY-IND   TO ASC-VND-FLT-DAY-IND-OLD.       11160003
111700     MOVE ASC-PAYT-FLOAT-DAYS   TO ASC-PAYT-FLOAT-DAYS-OLD.       11170003
111800     MOVE ASC-EXC-FLT-DAYS      TO ASC-EXC-FLT-DAYS-OLD.          11180003
111900     MOVE ASC-RCVG-VARN-DAYS    TO ASC-RCVG-VARN-DAYS-OLD.        11190003
112000                                                                  11200003
112100     MOVE ASC-RECN-CTOFF-DAY-QTY TO ASC-RECN-CTOFF-DAY-QTY-OLD.   11210003
112200                                                                  11220003
112300     IF STATUS-SPECIFIED                                          11230003
112400         MOVE PC-IND-DESC-SPECIFIC TO ASC-IND-DESC1               11240003
112500     ELSE                                                         11250003
112600         MOVE PC-IND-DESC-INACTIVE TO ASC-IND-DESC1               11260003
112700     END-IF.                                                      11270003
112800                                                                  11280003
112900*----------------------------------------------------------------*11290003
113000*    CHECK FOR BEYOND RANGE OF DAYS                              *11300003
113100*----------------------------------------------------------------*11310003
113200                                                                  11320003
113300 5200-CHECK-DAY-RANGE.                                            11330003
113400                                                                  11340003
113500     IF ASC-PAYT-FLOAT-DAYS  > PC-UPPER-LIMIT OR                  11350003
113600        ASC-PAYT-FLOAT-DAYS  < PC-LOWER-LIMIT                     11360003
113700*--  MUST BE WITHIN SPECIFIED RANGE OF DAYS                       11370003
113800        SET DP020-MSG-WARNING       TO TRUE                       11380003
113900        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       11390003
114000        MOVE -1                     TO APYTFLTL                   11400003
114100        MOVE DP015-REVERSE          TO APYTFLTH                   11410003
114200        MOVE DP015-YELLOW           TO APYTFLTC                   11420003
114300     END-IF.                                                      11430003
114400                                                                  11440003
114500     IF ASC-EXC-FLT-DAYS     > PC-UPPER-LIMIT OR                  11450003
114600        ASC-EXC-FLT-DAYS     < PC-LOWER-LIMIT                     11460003
114700*--  MUST BE WITHIN SPECIFIED RANGE OF DAYS                       11470003
114800        SET DP020-MSG-WARNING       TO TRUE                       11480003
114900        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       11490003
115000        MOVE -1                     TO AEXCFLTL                   11500003
115100        MOVE DP015-REVERSE          TO AEXCFLTH                   11510003
115200        MOVE DP015-YELLOW           TO AEXCFLTC                   11520003
115300     END-IF.                                                      11530003
115400                                                                  11540003
115500     IF ASC-RCVG-VARN-DAYS   > PC-UPPER-LIMIT OR                  11550003
115600        ASC-RCVG-VARN-DAYS   < PC-LOWER-LIMIT                     11560003
115700*--  MUST BE WITHIN SPECIFIED RANGE OF DAYS                       11570003
115800        SET DP020-MSG-WARNING       TO TRUE                       11580003
115900        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       11590003
116000        MOVE -1                     TO ARCVVARL                   11600003
116100        MOVE DP015-REVERSE          TO ARCVVARH                   11610003
116200        MOVE DP015-YELLOW           TO ARCVVARC                   11620003
116300     END-IF.                                                      11630003
116310                                                                  11631008
116320*-- RECON CUTOFF DAYS                                             11632012
116330                                                                  11633012
116400     MOVE 'Y' TO PS-RECN-CUTOFF-VALID-SW.                         11640008
116600     IF (ASC-RECN-CTOFF-DAY-QTY = 0)                              11660008
116700       CONTINUE                                                   11670008
116800     ELSE                                                         11680008
116900       IF ((ASC-RECN-CTOFF-DAY-QTY > 0) AND                       11690008
117000           (ASC-RECN-CTOFF-DAY-QTY < PC-MINIMUM-LIMIT))           11700008
117100             MOVE 'N' TO PS-RECN-CUTOFF-VALID-SW                  11710008
117200       ELSE                                                       11720008
117300         IF ((ASC-RECN-CTOFF-DAY-QTY >= PC-MINIMUM-LIMIT) AND     11730008
117310             (ASC-RECN-CTOFF-DAY-QTY <= PC-UPPER-LIMIT))          11731008
117320            CONTINUE                                              11732008
117330         ELSE                                                     11733008
117340           SET DP020-MSG-WARNING       TO TRUE                    11734008
117350           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    11735008
117360           MOVE -1                     TO ARCNCUTL                11736008
117370           MOVE DP015-REVERSE          TO ARCNCUTH                11737008
117380           MOVE DP015-YELLOW           TO ARCNCUTC                11738008
117390         END-IF                                                   11739008
117391       END-IF                                                     11739108
117392     END-IF.                                                      11739208
117400/                                                                 11740003
117500*----------------------------------------------------------------*11750003
117600*    INSERT A VENDOR PAYMENT CONTROL ROW                         *11760003
117700*----------------------------------------------------------------*11770003
117800                                                                  11780003
117900 6000-INSERT-TAPVNDS.                                             11790003
118000                                                                  11800003
118100     EXEC SQL                                                     11810003
118200          INSERT INTO TAPVNDS                                     11820003
118300                (ENT_ID                                           11830003
118400                ,PAYT_FLOAT_DAY_QTY                               11840003
118500                ,EXC_FLT_DAY_QTY                                  11850003
118600                ,RCVG_VARN_DAY_QTY                                11860003
118700                ,VND_FLT_DAY_IND                                  11870003
118800                ,RECN_CTOFF_DAY_QTY                               11880003
118900                ,PAYT_CNTL_CHG_TMST)                              11890003
119000          VALUES (:APVNDS-ENT-ID                                  11900003
119100                 ,:APVNDS-PAYT-FLOAT-DAY-QTY                      11910003
119200                 ,:APVNDS-EXC-FLT-DAY-QTY                         11920003
119300                 ,:APVNDS-RCVG-VARN-DAY-QTY                       11930003
119400                 ,:APVNDS-VND-FLT-DAY-IND                         11940003
119500                 ,:APVNDS-RECN-CTOFF-DAY-QTY                      11950003
119600                 ,CURRENT TIMESTAMP)                              11960003
119700     END-EXEC.                                                    11970003
119800                                                                  11980003
119900     EVALUATE TRUE                                                11990003
120000         WHEN SQLCODE = +0                                        12000003
120100              CONTINUE                                            12010003
120200                                                                  12020003
120300         WHEN SQLWARN0 NOT = SPACES                               12030003
120400         WHEN SQLCODE < +0                                        12040003
120500         WHEN SQLCODE > +0                                        12050003
120600              MOVE '6000-INSERT-TAPVNDS'                          12060003
120700                              TO DP013-PARAGRAPH                  12070003
120800              MOVE 'UNSUCCESSFUL INSERT FOR TAPVNDS'              12080003
120900                              TO DP013-MESSAGE-TEXT (1)           12090003
121000              MOVE SQLCA      TO DP013-SQLCA                      12100003
121100              MOVE 'TAPVNDS ' TO DP013-DB2-TABLE-NAME (1)         12110003
121200              SET DP013-DB2-ABEND                                 12120003
121300                  DP013-XCTL-DISPLAY-RESTART                      12130003
121400                              TO TRUE                             12140003
121500              PERFORM DP013-0000-PROCESS-ABEND                    12150003
121600     END-EVALUATE.                                                12160003
121700/                                                                 12170003
121800*----------------------------------------------------------------*12180003
121900*    UPDATE A VENDOR PAYMENT CONTROL ROW                         *12190003
122000*----------------------------------------------------------------*12200003
122100                                                                  12210003
122200 6100-UPDATE-TAPVNDS.                                             12220003
122300                                                                  12230003
122400     EXEC SQL                                                     12240003
122500          UPDATE TAPVNDS                                          12250003
122600            SET PAYT_FLOAT_DAY_QTY = :APVNDS-PAYT-FLOAT-DAY-QTY   12260003
122700               ,EXC_FLT_DAY_QTY    = :APVNDS-EXC-FLT-DAY-QTY      12270003
122800               ,RCVG_VARN_DAY_QTY  = :APVNDS-RCVG-VARN-DAY-QTY    12280003
122900               ,VND_FLT_DAY_IND    = :APVNDS-VND-FLT-DAY-IND      12290003
123000               ,RECN_CTOFF_DAY_QTY = :APVNDS-RECN-CTOFF-DAY-QTY   12300003
123100               ,PAYT_CNTL_CHG_TMST = CURRENT TIMESTAMP            12310003
123200          WHERE ENT_ID = :APVNDS-ENT-ID                           12320003
123300     END-EXEC.                                                    12330003
123400                                                                  12340003
123500     EVALUATE TRUE                                                12350003
123600         WHEN SQLCODE = +0                                        12360003
123700              CONTINUE                                            12370003
123800                                                                  12380003
123900         WHEN SQLWARN0 NOT = SPACES                               12390003
124000         WHEN SQLCODE < +0                                        12400003
124100         WHEN SQLCODE > +0                                        12410003
124200              MOVE '6100-UPDATE-TAPVNDS'                          12420003
124300                              TO DP013-PARAGRAPH                  12430003
124400              MOVE 'UNSUCCESSFUL UPDATE FOR TAPVNDS'              12440003
124500                              TO DP013-MESSAGE-TEXT (1)           12450003
124600              MOVE SQLCA      TO DP013-SQLCA                      12460003
124700              MOVE 'TAPVNDS ' TO DP013-DB2-TABLE-NAME (1)         12470003
124800              SET DP013-DB2-ABEND                                 12480003
124900                  DP013-XCTL-DISPLAY-RESTART                      12490003
125000                              TO TRUE                             12500003
125100              PERFORM DP013-0000-PROCESS-ABEND                    12510003
125200     END-EVALUATE.                                                12520003
125300/                                                                 12530003
125400*----------------------------------------------------------------*12540003
125500*    ABEND PROCESSOR MODULE                                      *12550003
125600*----------------------------------------------------------------*12560003
125700                                                                  12570003
125800     COPY DPPD013.                                                12580003
