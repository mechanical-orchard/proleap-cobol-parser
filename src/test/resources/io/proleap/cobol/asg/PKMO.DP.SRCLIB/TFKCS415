      ******************************************************************00010044
      *   CHECK TO SEE IF THIS TRANSACTION WAS TRIGGERED BY THE MQ      00020044
      *   LISTENER.  IF SO, WRITE MESSAGE TO REMOTE QUEUE INSTEAD OF    00030044
      *   TEMPORARY STORAGE QUEUE.                                      00040039
      ******************************************************************00050044
       IDENTIFICATION DIVISION.                                         00060044
      ******************************************************************00070044
                                                                        00080044
       PROGRAM-ID.       TFKCS415.                                      00090044
       AUTHOR.           WILLIAM B. BURT.                               00100044
       INSTALLATION.     KOHLS.                                         00110044
       DATE-WRITTEN      AUGUST, 1996.                                  00120044
       DATE-COMPILED.                                                   00130044
                                                                        00140044
      ******************************************************************00150044
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160044
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170044
      * IS A REQUEST FOR INFORMATION REGARDING A PARTICULAR TRANSFER.   00180044
      * THE TRANSMIT DATA IS THE RESPONSE TO THAT REQUEST.              00190044
      ******************************************************************00200044
      *  DATE 01/15/01                                                  00210044
      *  ADD CODE FOR 2ND LISTNER                                       00220044
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230044
      ******************************************************************00240044
      *  1/20/2003 - RAY GRAF                                           00241044
      *   PROCESS NONINTELLIGENT SKU.                                   00242044
      ******************************************************************00243044
      *  1/28/2003 - DAVE WELLER          WR/IR #: 25501                00244052
      *   MOS AND RTV DEF/DAMAGE TRANSFERS                              00245052
      ******************************************************************00246052
      **DATE:03/23/2004 CHANGED BY: RAY GRAF                            00247052
      **     CHANGE PRINTER DESTINATION TO NEW 8 CHARACTER FORMAT       00248052
      ***************************************************************** 00249048
      **DATE:10/19/2004 CHANGED BY: DAVE WELLER                         00249164
      **     STORE EXPANSION                                            00249264
      ***************************************************************** 00249364
021605**DATE:02/16/2005 CHANGED BY: DAVE WELLER  WR27349                00249464
021605**     STANDARDIZE TFWS007 USAGE                                  00249564
021605***************************************************************** 00249664
051705*  DATE 05/17/05 RAY GRAF                                         00249765
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00249865
051705******************************************************************00249965
SR3403*  DATE 03/20/2012 TEJA KARWEER                                   00250070
SR3403*  LARGE RETAIL AMT FIELD EXPANSION : ADDED PRINTER LOGIC         00250170
SR3403******************************************************************00250270
                                                                        00251044
      ******************************************************************00260044
       ENVIRONMENT DIVISION.                                            00270044
      ******************************************************************00280044
                                                                        00290044
      ******************************************************************00300044
       DATA DIVISION.                                                   00310044
      ******************************************************************00320044
                                                                        00330044
      ******************************************************************00340044
       WORKING-STORAGE SECTION.                                         00350044
      ******************************************************************00360044
                                                                        00370044
      *                                                                 00380044
      *  LISTENER QUEUE NAMES                                           00390044
      *                                                                 00400044
           COPY RFWS001.                                                00410044
                                                                        00420044
      *                                                                 00430044
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00440044
      *                                                                 00450044
           COPY TFRD025.                                                00460044
                                                                        00470044
      *                                                                 00480044
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00490044
      *                                                                 00500044
           COPY TFRD026.                                                00510044
                                                                        00520044
      *                                                                 00530044
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00540044
      *                                                                 00550044
           COPY DPWS013.                                                00560044
                                                                        00570044
      *                                                                 00580044
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00590044
      *                                                                 00600044
           COPY DPRD507I.                                               00610044
                                                                        00620044
      *                                                                 00630044
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00640044
      *                                                                 00650044
           COPY DPWS011.                                                00660044
                                                                        00670044
      *                                                                 00680044
      *  LAYOUT FOR THE PRINT TRANSFER COMMUNICATIONS AREA              00690044
      *                                                                 00700044
           COPY TFWS005.                                                00710044
                                                                        00710148
      *                                                                 00711048
      *  RF COPYBOOK TO FORMAT PRINTER DESTINATION                      00712048
      *                                                                 00713048
           COPY RFWS009.                                                00714064
                                                                        00790044
      *                                                                 00791064
      *  XS DOMAIN TABLES                                               00792064
      *                                                                 00793064
           EXEC SQL                                                     00794064
               INCLUDE XST00012                                         00795064
           END-EXEC.                                                    00796064
           EXEC SQL                                                     00796164
               INCLUDE XST00010                                         00796264
           END-EXEC.                                                    00796364
           EXEC SQL                                                     00796464
               INCLUDE XST00008                                         00796564
           END-EXEC.                                                    00796664
                                                                        00797052
      *                                                                 00800044
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER STATUS    00810044
      *  CODE TABLE                                                     00820044
      *                                                                 00830044
           EXEC SQL                                                     00840044
               INCLUDE TTFSTAT                                          00850044
           END-EXEC.                                                    00860044
                                                                        00870044
      *                                                                 00880044
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER RECEIPT   00890044
      *  TABLE                                                          00900044
      *                                                                 00910044
           EXEC SQL                                                     00920044
               INCLUDE TTFRCPT                                          00930044
           END-EXEC.                                                    00940044
                                                                        00950044
      *                                                                 00960044
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER           00970044
      *  ITEM RECEIPT TABLE                                             00980044
      *                                                                 00990044
           EXEC SQL                                                     01000044
               INCLUDE TTFITRC                                          01010044
           END-EXEC.                                                    01020044
                                                                        01030044
      *                                                                 01040044
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER           01050044
      *  DISCREPANCY TABLE                                              01060044
      *                                                                 01070044
           EXEC SQL                                                     01080044
               INCLUDE TTFDSCP                                          01090044
           END-EXEC.                                                    01100044
                                                                        01110044
      *                                                                 01120044
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TABLE     01130044
      *                                                                 01140044
           EXEC SQL                                                     01150044
               INCLUDE TTFMSTR                                          01160044
           END-EXEC.                                                    01170044
                                                                        01180044
      *                                                                 01190044
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE01200044
      *                                                                 01210044
           EXEC SQL                                                     01220044
               INCLUDE TTFITEM                                          01230044
           END-EXEC.                                                    01240044
                                                                        01250044
      *                                                                 01260044
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM      01270044
      *  POSTING TABLE                                                  01280044
      *                                                                 01290044
           EXEC SQL                                                     01300044
               INCLUDE TTFITPS                                          01310044
           END-EXEC.                                                    01320044
                                                                        01330044
051705*                                                                 01340067
051705*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER CONTROL   01350067
051705*  TABLE                                                          01360067
051705*                                                                 01370067
051705*    EXEC SQL                                                     01380067
051705*        INCLUDE TTFCNTL                                          01390067
051705*    END-EXEC.                                                    01400067
051705*                                                                 01410067
051705*                                                                 01420067
051705*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE INVENTORY PARAMETER01430067
051705*  TABLE                                                          01440067
051705*                                                                 01450067
051705*    EXEC SQL                                                     01460067
051705*        INCLUDE TINVPAR                                          01470067
051705*    END-EXEC.                                                    01480067
                                                                        01490044
      *                                                                 01580044
      *  COMMUNICATIONS AREA FOR DB2                                    01590044
      *                                                                 01600044
           EXEC SQL                                                     01610044
               INCLUDE SQLCA                                            01620044
           END-EXEC.                                                    01630044
                                                                        01640039
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          01650044
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          01660044
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           01670044
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           01680044
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          01690044
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01700044
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01710044
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01720044
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01730044
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01740044
                                                                        01750044
      *    API CONTROL BLOCKS                                           01760044
                                                                        01770044
       01  MQM-OBJECT-DESCRIPTOR.                                       01780044
           COPY CMQODV.                                                 01790044
       01  MQM-MESSAGE-DESCRIPTOR.                                      01800044
           COPY CMQMDV.                                                 01810044
       01  MQM-GET-MESSAGE-OPTIONS.                                     01820044
           COPY CMQGMOV.                                                01830044
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01840044
           COPY CMQPMOV.                                                01850044
                                                                        01860044
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01870044
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01880044
                                                                        01890044
       01  MQM-CONSTANTS.                                               01900044
           COPY CMQV.                                                   01910044
      *                                                                 01920044
      **---------------------------------------------------------------*01930044
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01940044
      **  (EPPD000)                                                    *01950044
      **---------------------------------------------------------------*01960044
                                                                        01970044
           COPY EPWS000.                                                01980044
021605     COPY TFWS007.                                                01981064
                                                                        01990044
      *                                                                 02000044
       01  DK-DB2-KEYS.                                                 02010044
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  02020044
                                                           COMP SYNC.   02030044
           05  DK-STORE-NBR-9                  PIC S9(04)  VALUE ZEROS  02040052
                                                           COMP.        02041052
           05  DK-LOC-NBR                      PIC S9(04)  VALUE ZEROS  02071056
                                                           COMP.        02072052
      *                                                                 02080044
       01  PC-PROGRAM-CONSTANTS.                                        02090044
           05  PC-811                          PIC  9(04)  VALUE 0811.  02100044
           05  PC-801                          PIC  9(04)  VALUE 0801.  02110044
           05  PC-085                          PIC  9(04)  VALUE 0085.  02120044
           05  PC-810                          PIC  9(04)  VALUE 0810.  02130044
           05  PC-PRINT-DISCREPANCY-PGM        PIC  X(04)  VALUE 'P455'.02140044
           05  PC-FASHION-SALES                PIC  X(02)  VALUE 'FS'.  02150044
           05  PC-MERCHANDISE-LEDGER           PIC  X(02)  VALUE 'ML'.  02160044
021605*    COPY TFWS007                                                 02170064
           05  PC-COMPLETE-RSN-CDE             PIC  X(02)  VALUE 'CM'.  02220044
           05  PC-ADJUSTMENT-RSN-CDE           PIC  X(02)  VALUE 'AD'.  02230044
           05  PC-MISDIRECT-RSN-CDE            PIC  X(02)  VALUE 'MD'.  02240044
           05  PC-ASSUMPTIVELY-RECEIVED        PIC  X(02)  VALUE 'AR'.  02250044
           05  PC-CLEARANCE                    PIC  9(02)  VALUE 30.    02260044
           05  PC-ZERO                         PIC  9(01)  VALUE ZEROS. 02270044
           05  PC-ONE                          PIC S9(04)  VALUE +1     02280044
                                                           COMP SYNC.   02290044
           05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   02300044
                                                           COMP SYNC.   02310044
           05  PC-MULTIPLE-ROWS-FOUND          PIC S9(04)  VALUE -811   02320044
                                                           COMP SYNC.   02330044
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   02340044
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   02350044
051705*    05  PC-HAND-CARRY                   PIC  X(02)  VALUE '05'.  02360067
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        02370044
               'TFKCS415'.                                              02380044
051705*    05  PC-MAX-DATE                 PIC X(10) VALUE '9999-09-09'.02390067
                                                                        02400044
           05  PC-TSYMSG-NUMBERS.                                       02410044
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                02420044
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.02430044
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           02440044
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.02450044
      *  TRANSFER &VAR HAS BEEN RESET                                   02460044
               10  PC-TSYMSG-01582             PIC  9(05)  VALUE  01582.02470044
                                                                        02480040
       01  PH-PROGRAM-HOLD-VARIABLES.                                   02490044
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          02500044
           05  PH-REASON                   PIC  S9(09) BINARY.          02510044
      *                                                                 02520044
       01  PS-PROGRAM-SWITCHES.                                         02530044
           05  PS-XFER-DISCREPANCY-IND         PIC  X(01)  VALUE 'N'.   02540044
               88  PS-NO-XFER-DISCREPANCY                  VALUE 'N'.   02550044
               88  PS-XFER-DISCREPANCY                     VALUE 'Y'.   02560044
           05  PS-XFER-ITMS-IND                PIC  X(01)  VALUE 'N'.   02570044
               88  PS-MORE-XFER-ITMS                       VALUE 'N'.   02580044
               88  PS-END-OF-XFER-ITMS                     VALUE 'Y'.   02590044
           05  PS-RCPT-ITMS-IND                PIC  X(01)  VALUE 'N'.   02600044
               88  PS-MORE-RCPT-ITMS                       VALUE 'N'.   02610044
               88  PS-END-OF-RCPT-ITMS                     VALUE 'Y'.   02620044
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   02630044
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   02640044
      *                                                                 02650044
       01  PV-PROGRAM-VARIABLES.                                        02660044
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          02670044
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          02680044
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          02690044
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          02700044
           05  PV-QM-NAME              PIC X(48).                       02710044
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02720044
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        02730044
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        02740044
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        02750044
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        02760044
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02770044
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02780044
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02790044
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02800044
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02810044
                                                                        02820040
           05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZEROS  02830044
                                                           COMP SYNC.   02840044
           05  PV-XFER-TYP-CDE                 PIC  X(02)  VALUE SPACE. 02850044
               88  PV-RTL-XFER                             VALUE        02860044
                   '01'  THRU  '05'.                                    02870044
               88  PV-OFFSITE-STORAGE-XFER                 VALUE '07'.  02890044
           05  PV-DISPLAY-AREA.                                         02900044
               10  PV-DISPLAY-ITM-NBR          PIC  9(15)  VALUE ZEROS. 02910044
               10  PV-DISPLAY-XFER-DKEY-ID     PIC  9(09)  VALUE ZEROS. 02920044
               10  PV-DISPLAY-XFER-LNE-NBR     PIC  9(04)  VALUE ZEROS. 02930044
               10  PV-DISPLAY-XFER-LNE-SEQ-NBR PIC  9(04)  VALUE ZEROS. 02940044
               10  PV-DISPLAY-PSTG-SEQ-NBR     PIC  9(04)  VALUE ZEROS. 02950044
               10  PV-DISPLAY-XFER-DOC-NBR-X.                           02960044
                   15  PV-DISPLAY-XFER-FROM-STR-NBR                     02970044
                                               PIC  9(05)  VALUE ZEROS. 02980063
                   15  FILLER                  PIC  X(01)  VALUE '-'.   02990044
                   15  PV-DISPLAY-XFER-SEQ-NBR PIC  9(06)  VALUE ZEROS. 03000044
           05  PV-PSTG-SEQ-NBR                 PIC S9(04)  VALUE ZEROS  03010044
                                                           COMP SYNC.   03020044
           05  PV-DB2-NULL-IND                 PIC S9(04)  VALUE ZEROS  03030044
                                                           COMP SYNC.   03040044
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  03050044
                                                           COMP SYNC.   03060044
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  03070044
                                                           COMP SYNC.   03080044
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.03090044
                                                                        03100044
           05  PV-TCPIPPRQ-RECORD1.                                     03110044
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 03120044
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 03130044
               10  FILLER                      PIC X(4104) VALUE SPACE. 03140044
           05  PV-TCPIPPRQ-RECORD2.                                     03150044
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 03160044
               10  FILLER                      PIC X(4112) VALUE SPACE. 03170044
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  03180044
                                                           COMP SYNC.   03190044
           05  PV-PRINTER-DEST-801.                                     03250044
               10  FILLER                      PIC  X(08)  VALUE        03260052
                   'U17'.                                               03270044
           05  PV-CONTNR-TYP-CDE               PIC  X(02)  VALUE SPACE. 03310044
           05  PV-CMPLT-DATE                   PIC  X(10)  VALUE SPACE. 03320044
051705*    05  PV-CURRENT-DATE                 PIC  X(10)  VALUE SPACE. 03330067
051705*    05  PV-COMPARE-DATE                 PIC  X(10)  VALUE SPACE. 03340067
051705*    05  PV-MAX-FINCL-BK-DTE             PIC  X(10)  VALUE SPACE. 03350067
051705*    05  PV-MAX-PLND-INV-DTE             PIC  X(10)  VALUE SPACE. 03360067
051705*    05  PV-TO-STR-INV-DTE               PIC  X(10)  VALUE SPACE. 03370067
051705*    05  PV-FR-STR-INV-DTE               PIC  X(10)  VALUE SPACE. 03380067
051705*    05  PV-XFER-INV-CTOFF-DTE           PIC  X(10)  VALUE SPACE. 03390067
051705*    05  PV-PHY-INV-PERD-IND             PIC  X(01)  VALUE SPACE. 03400067
051705*    05  PV-HOLD-INVENTORY-IND           PIC X(01)   VALUE 'N'.   03410067
051705*        88  PV-HOLD-PHYSICAL-COUNT                  VALUE 'Y'.   03420067
051705*        88  PV-HOLD-FAKE-INVENTORY                  VALUE 'F'.   03430067
051705*        88  PV-HOLD-NO-INVENTORY                    VALUE 'N'.   03440067
051705*    05  PV-FR-INVENTORY-IND             PIC X(01)   VALUE 'N'.   03450067
051705*        88  PV-FR-PHYSICAL-COUNT                    VALUE 'Y'.   03460067
051705*        88  PV-FR-FAKE-INVENTORY                    VALUE 'F'.   03470067
051705*        88  PV-FR-NO-INVENTORY                      VALUE 'N'.   03480067
051705*    05  PV-TO-INVENTORY-IND             PIC X(01)   VALUE 'N'.   03490067
051705*        88  PV-TO-PHYSICAL-COUNT                    VALUE 'Y'.   03500067
051705*        88  PV-TO-FAKE-INVENTORY                    VALUE 'F'.   03510067
051705*        88  PV-TO-NO-INVENTORY                      VALUE 'N'.   03520067
           05  PV-CUR-RTL-AMT                  PIC S9(7)V9(2) COMP-3.   03530044
SR3403     05  PV-CICS-APPL-ID.                                         03531068
SR3403         10  FILLER                      PIC X(04).               03532068
SR3403         10  PV-CICS-REGION-ENVIRONMENT  PIC X.                   03533068
SR3403             88  PV-CR-PRODUCTION                    VALUE 'P'.   03534068
SR3403         10  PV-FILLER                   PIC X(03).               03535068
                                                                        03540044
      *                                                                 03550044
      * CURSOR TO RETRIEVE ALL ITEMS FOR A TRANSFER                     03560044
      *                                                                 03570044
           EXEC SQL                                                     03580044
              DECLARE  XFER_ITM_CSR CURSOR FOR                          03590044
               SELECT  XFER_LNE_NBR,                                    03600044
                       ITM_NBR,                                         03640044
                       XFER_PRIC_AMT,                                   03650044
                       XFER_QTY                                         03660044
                 FROM  TTFITEM                                          03670044
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)              03680044
             ORDER BY  XFER_LNE_NBR                                     03690044
                 WITH  UR                                               03691053
           END-EXEC.                                                    03700044
                                                                        03710044
      *                                                                 03720044
      * CURSOR TO RETRIEVE ALL RECEIPTS FOR AN ITEM                     03730044
      *                                                                 03740044
           EXEC SQL                                                     03750044
              DECLARE  RCPT_ITM_CSR CURSOR FOR                          03760044
               SELECT  XFER_LNE_SEQ_NBR,                                03770044
                       RCVD_XFER_QTY,                                   03780044
                       RCVD_XFER_PRIC_AMT                               03790044
                 FROM  TTFITRC                                          03800044
                WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID             03810044
                  AND   XFER_LNE_NBR    =  :TFITEM-XFER-LNE-NBR         03820044
                  AND   XFER_RCPT_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)   03830044
             ORDER BY  XFER_LNE_SEQ_NBR                                 03840044
                 WITH  UR                                               03841053
           END-EXEC.                                                    03850044
      *                                                                 03860044
      ******************************************************************03870044
       PROCEDURE DIVISION.                                              03880044
      ******************************************************************03890044
       0000-PROGRAM-MAINLINE.                                           03900044
           INITIALIZE TF026-XFER-TO-PTC-RECORD.                         03910044
                                                                        03920044
           PERFORM 1000-RETRIEVE-TEXT.                                  03930044
                                                                        03940044
           PERFORM 2000-PROCESS-PTC-REQUEST.                            03950044
                                                                        03960044
           GOBACK.                                                      03970044
      *                                                                 03980044
       1000-RETRIEVE-TEXT.                                              03990044
           EXEC CICS                                                    04000044
               RETRIEVE                                                 04010044
                   INTO  (TF025-XFER-FROM-PTC-RECORD)                   04020044
                   RESP  (PV-CICS-RESPONSE)                             04030044
           END-EXEC.                                                    04040044
                                                                        04050044
           EVALUATE TRUE                                                04060044
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04070044
                   CONTINUE                                             04080044
               WHEN OTHER                                               04090044
                   MOVE '1000-RETRIEVE-TEXT'                            04100055
                                   TO DP013-PARAGRAPH                   04101055
                   MOVE 'UNABLE TO RECEIVE TEXT'                        04110044
                                   TO DP013-MESSAGE-TEXT (1)            04120055
                   MOVE  TF025-XFER-FROM-PTC-RECORD                     04130044
                                   TO DP013-MESSAGE-TEXT (2)            04140055
                   SET DP013-CICS-ABEND                                 04150044
                       DP013-NO-ROLLBACK                                04160055
                                   TO TRUE                              04161055
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04170044
                   SET  DP011-MSG-FATAL                                 04180055
                                   TO TRUE                              04181055
                   MOVE PC-TSYMSG-01064                                 04190055
                                   TO DP011-MSG-NUMBER                  04191055
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04200044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04210044
           END-EVALUATE.                                                04220044
                                                                        04230044
                                                                        04240044
           MOVE TF025-LISTENER-CODE                                     04250055
                                   TO PV-QUEUE-PARM.                    04251055
                                                                        04260044
           IF  PV-VALID-PARM                                            04270044
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      04280055
                                   TO PV-TSQ-NAME                       04281055
                                                                        04290044
           ELSE                                                         04300044
               MOVE '1000-RETRIEVE-TEXT'                                04310055
                                   TO DP013-PARAGRAPH                   04311055
               MOVE 'INVALID PARM VALUE'                                04320055
                                   TO DP013-MESSAGE-TEXT (1)            04321055
               MOVE 'PARM VALUE = '                                     04330055
                                   TO DP013-MESSAGE-TEXT (2)            04331055
               MOVE TF025-LISTENER-CODE                                 04340055
                                   TO DP013-MESSAGE-TEXT (3)            04341055
                                                                        04350044
               SET DP013-LOGIC-ABEND                                    04360044
                   DP013-NO-ROLLBACK                                    04370055
                                   TO TRUE                              04371055
                                                                        04380044
               PERFORM 9999-WRITE-CICS-LOG-MSG                          04390044
                                                                        04400044
               SET DP011-MSG-FATAL TO TRUE                              04410055
                                                                        04420044
               MOVE PC-TSYMSG-01064                                     04430055
                                   TO DP011-MSG-NUMBER                  04431055
                                                                        04440044
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04450044
               PERFORM 8000-SEND-DATA-TO-LISTENER                       04460044
           END-IF.                                                      04470044
                                                                        04480044
                                                                        04490044
      ******************************************************************04500044
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 04510044
      ******************************************************************04520044
       2000-PROCESS-PTC-REQUEST.                                        04530044
                                                                        04540044
           PERFORM 7000-SELECT-MAX-RCPT-TMST.                           04550044
                                                                        04560044
           IF PV-DB2-NULL-IND NEGATIVE                                  04570044
               PERFORM 7250-SELECT-XFER                                 04580044
               MOVE TF005-XFER-SEQ-NBR                                  04590055
                                   TO PV-DISPLAY-XFER-SEQ-NBR           04591055
               MOVE TF005-XFER-FROM-STORE-NBR                           04600044
                                   TO PV-DISPLAY-XFER-FROM-STR-NBR      04610055
               MOVE PV-DISPLAY-XFER-DOC-NBR-X                           04620055
                                   TO DP011-MSG-TEXT                    04621055
               SET  DP011-MSG-FATAL                                     04630044
                    TF026-XFER-RESET                                    04640055
                                   TO TRUE                              04641055
               MOVE PC-TSYMSG-01582                                     04650055
                                   TO DP011-MSG-NUMBER                  04651055
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04660044
               PERFORM 8000-SEND-DATA-TO-LISTENER                       04670044
           ELSE                                                         04680044
               SET  TF026-XFER-NOT-RESET                                04690055
                                   TO  TRUE                             04691055
           END-IF.                                                      04700044
                                                                        04710044
           IF TF025-COMPLETE-XFER                                       04720044
               PERFORM 7250-SELECT-XFER                                 04730044
               IF PV-RTL-XFER                                           04740044
                   PERFORM 2100-CHK-ASSUMPTIVE-RECEIPT                  04750044
051705*            PERFORM 7900-READ-CONTROL-TABLE                      04760066
051705*            IF PV-PHY-INV-PERD-IND = PC-YES                      04770066
051705*                PERFORM 2500-CHECK-INVENTORY                     04780066
051705*            END-IF                                               04790066
               END-IF                                                   04800044
               PERFORM 2200-COMPLETE-XFER                               04810044
           ELSE                                                         04820044
               PERFORM 2300-RESET-XFER-RECEIPT                          04830044
           END-IF.                                                      04840044
                                                                        04850044
           IF TF026-DISCREPANCY-IND  =  PC-YES                          04860044
               PERFORM 2400-START-PRINT-DSCRP-PGM                       04870044
           END-IF.                                                      04880044
                                                                        04890044
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          04900044
      *                                                                 04910044
       2100-CHK-ASSUMPTIVE-RECEIPT.                                     04920044
           PERFORM 7700-SELECT-ASSUMPTIVE-RECEIPT.                      04930044
                                                                        04940044
           IF SQLCODE  =  PC-ROW-NOT-FOUND                              04950044
               PERFORM 2110-CREATE-ASMTV-RCPT-BOOKING                   04960044
               SET  PS-MORE-XFER-ITMS                                   04970055
                                   TO  TRUE                             04971055
           END-IF.                                                      04980044
      *                                                                 04990044
       2110-CREATE-ASMTV-RCPT-BOOKING.                                  05000044
           PERFORM 4000-OPEN-XFER-ITM-CSR.                              05010044
           PERFORM 7050-FETCH-XFER-ITM-CSR.                             05020044
                                                                        05030044
           PERFORM 2111-CREATE-BOOKINGS                                 05040044
               UNTIL PS-END-OF-XFER-ITMS.                               05050044
                                                                        05060044
           PERFORM 4100-CLOSE-XFER-ITM-CSR.                             05070044
      *                                                                 05080044
       2111-CREATE-BOOKINGS.                                            05090044
           IF TFITEM-XFER-QTY  >  ZERO                                  05100044
               MOVE TFITEM-XFER-PRIC-AMT                                05110055
                                   TO  TFITPS-ITM-RTL-PRCE-AMT          05111055
               MOVE TFITEM-XFER-QTY                                     05120055
                                   TO  TFITPS-ITM-QTY                   05121055
               MOVE TFMSTR-FR-STR-NBR                                   05130055
                                   TO  TFITPS-FRM-PSTG-STR-NBR          05131055
               MOVE TFMSTR-TO-STR-NBR                                   05140055
                                   TO  TFITPS-TO-PSTG-STR-NBR           05141055
               MOVE PC-COMPLETE-RSN-CDE                                 05150055
                                   TO  TFITPS-ADJ-RSN-CDE               05151055
               PERFORM 5300-FILL-EXNL-SYS-PRCG-CDE                      05160044
               PERFORM 7350-INSERT-ADJUSTMENT-ROW                       05170044
               MOVE ZEROS          TO  PV-PSTG-SEQ-NBR                  05180055
           END-IF.                                                      05190044
                                                                        05200044
           PERFORM 7050-FETCH-XFER-ITM-CSR.                             05210044
      *                                                                 05220044
       2200-COMPLETE-XFER.                                              05230044
           IF TF025-DTL-CHK-BYPASSED                                    05240044
               MOVE PC-NO          TO  TFRCPT-XFER-DSCRP-IND            05250055
                                       TF026-DISCREPANCY-IND            05260055
               IF PV-RTL-XFER                                           05270044
                   PERFORM 7200-CHK-FOR-DISCREPANCY                     05280044
                   IF PS-XFER-DISCREPANCY                               05290044
                       MOVE PC-YES TO  TFRCPT-XFER-DSCRP-IND            05300055
                                        TF026-DISCREPANCY-IND           05310044
                   END-IF                                               05320044
                   PERFORM 3000-DTL-CHK-BYPASSED                        05330044
               ELSE                                                     05340044
                   IF PV-OFFSITE-STORAGE-XFER                           05350062
                       PERFORM 3000-DTL-CHK-BYPASSED                    05360044
                   END-IF                                               05370044
               END-IF                                                   05380044
           ELSE                                                         05390044
               PERFORM 3100-DTL-CHK                                     05400044
           END-IF.                                                      05410044
                                                                        05420044
           PERFORM 7600-UPDATE-XFER-RCPT-END-TMST.                      05430044
           PERFORM 7650-UPDATE-XFER-STAT-TO-PR.                         05440044
      *                                                                 05450044
       2300-RESET-XFER-RECEIPT.                                         05460044
           PERFORM 7450-UPDATE-MAX-RCPT-TMST.                           05470044
           PERFORM 7500-DELETE-XFER-ITM-RCPTS.                          05480044
           PERFORM 7550-DELETE-ALL-ADDED-ITMS.                          05490044
           PERFORM 7800-DELETE-DISCREPANCY.                             05500044
      *                                                                 05510044
       2400-START-PRINT-DSCRP-PGM.                                      05520044
           IF TFDSCP-RCVD-AT-STR-NBR NOT = ZEROS                        05530044
               IF (TFDSCP-RCVD-AT-STR-NBR  =  PC-085                    05540044
                         OR                                             05550044
                   TFDSCP-RCVD-AT-STR-NBR  =  PC-801)                   05560044
                   MOVE PV-PRINTER-DEST-801                             05570055
                                   TO  TF005-PRINTER-DEST               05571055
               ELSE                                                     05580044
                   IF (TFDSCP-RCVD-AT-STR-NBR  =  PC-810                05590044
                             OR                                         05600044
                       TFDSCP-RCVD-AT-STR-NBR  =  PC-811)               05610044
                       MOVE RFWS009-PRINTER-DEST-811                    05620052
                                   TO TF005-PRINTER-DEST                05621055
                   ELSE                                                 05630044
                       MOVE TFDSCP-RCVD-AT-STR-NBR                      05640048
                                   TO RFWS009-STORE-NBR                 05641055
                       MOVE RFWS009-STORE-PRINTER-DEST                  05650052
                                   TO TF005-PRINTER-DEST                05651055
                   END-IF                                               05660044
               END-IF                                                   05670044
           ELSE                                                         05680044
               IF (TFMSTR-TO-STR-NBR  =  PC-085                         05690044
                         OR                                             05700044
                   TFMSTR-TO-STR-NBR  =  PC-801)                        05710044
                   MOVE PV-PRINTER-DEST-801                             05720055
                                   TO  TF005-PRINTER-DEST               05721055
               ELSE                                                     05730044
                   IF (TFMSTR-TO-STR-NBR  =  PC-810                     05740044
                             OR                                         05750044
                       TFMSTR-TO-STR-NBR  =  PC-811)                    05760044
                       MOVE RFWS009-PRINTER-DEST-811                    05770052
                                   TO TF005-PRINTER-DEST                05771055
                   ELSE                                                 05780044
                       MOVE RFWS009-STORE-PRINTER-DEST                  05790052
                                   TO TF005-PRINTER-DEST                05791055
                   END-IF                                               05800044
               END-IF                                                   05810044
           END-IF.                                                      05820044
SR3403     PERFORM 2410-FILL-PRINTER-DEST.                              05821068
           MOVE LENGTH OF TF005-COMMAREA                                05830055
                                   TO  PV-COMMAREA-LENGTH.              05831055
                                                                        05840044
           EXEC CICS                                                    05850044
               START                                                    05860044
                   TRANSID  (PC-PRINT-DISCREPANCY-PGM)                  05870044
                   FROM     (TF005-COMMAREA)                            05880044
                   LENGTH   (PV-COMMAREA-LENGTH)                        05890044
           END-EXEC.                                                    05900044
      *                                                                 05910044
SR3403 2410-FILL-PRINTER-DEST.                                          05911068
SR3403     EXEC CICS                                                    05912068
SR3403     ASSIGN                                                       05913068
SR3403     APPLID (PV-CICS-APPL-ID)                                     05914068
SR3403     END-EXEC.                                                    05915068
SR3403                                                                  05916068
SR3403     EVALUATE TRUE                                                05917068
SR3403         WHEN PV-CR-PRODUCTION                                    05918068
SR3403             CONTINUE                                             05919068
SR3403         WHEN OTHER                                               05919168
SR3403             MOVE 'U4106' TO  TF005-PRINTER-DEST                  05919268
SR3403     END-EVALUATE.                                                05919368
SR3403*                                                                 05919468
       2500-CHECK-INVENTORY.                                            05920044
           PERFORM 7200-CHK-FOR-DISCREPANCY.                            05930044
051705*    PERFORM 7910-SELECT-CURRENT-DATE.                            05940067
051705*    MOVE TFMSTR-TO-STR-NBR  TO DK-STORE-NBR-9.                   05950066
051705*    PERFORM 7920-GET-PLND-INV-DTE.                               05960066
051705*    MOVE INVPAR-PLND-INV-DTE                                     05970066
051705*                            TO PV-TO-STR-INV-DTE.                05971066
051705*    MOVE PV-HOLD-INVENTORY-IND                                   05980066
051705*                            TO PV-TO-INVENTORY-IND.              05981066
051705*    MOVE TFMSTR-FR-STR-NBR  TO DK-STORE-NBR-9.                   05990066
051705*    PERFORM 7920-GET-PLND-INV-DTE.                               06000066
051705*    MOVE INVPAR-PLND-INV-DTE                                     06010066
051705*                            TO PV-FR-STR-INV-DTE.                06011066
051705*    MOVE PV-HOLD-INVENTORY-IND                                   06020066
051705*                            TO PV-FR-INVENTORY-IND.              06021066
051705*    IF TFDSCP-RCVD-AT-STR-NBR  =  ZEROS                          06030066
051705*        PERFORM 2600-NORMAL-RECEIPT                              06040066
051705*    ELSE                                                         06050066
051705*        PERFORM 2700-MISDIRECT                                   06060066
051705*    END-IF.                                                      06070066
051705*2600-NORMAL-RECEIPT.                                             06080066
051705*    IF PV-FR-NO-INVENTORY  AND                                   06090066
051705*       PV-TO-NO-INVENTORY                                        06100066
051705*        CONTINUE                                                 06110066
051705*    ELSE                                                         06120066
051705*        IF PV-FR-NO-INVENTORY                                    06130066
051705*            MOVE PV-TO-STR-INV-DTE                               06140066
051705*                            TO PV-FR-STR-INV-DTE                 06141066
051705*        ELSE                                                     06150066
051705*            IF PV-TO-NO-INVENTORY                                06160066
051705*                MOVE PV-FR-STR-INV-DTE                           06170066
051705*                            TO PV-TO-STR-INV-DTE                 06180066
051705*            END-IF                                               06190066
051705*        END-IF                                                   06200066
051705*        IF PV-CONTNR-TYP-CDE = PC-HAND-CARRY                     06210066
051705*            IF PV-CMPLT-DATE   <= PV-FR-STR-INV-DTE              06220066
051705*               EVALUATE TRUE                                     06230066
051705*                 WHEN PV-CURRENT-DATE <= PV-FR-STR-INV-DTE  AND  06240066
051705*                      PV-CURRENT-DATE <= PV-TO-STR-INV-DTE       06250066
051705*                      CONTINUE                                   06260066
051705*                 WHEN PV-CURRENT-DATE >  PV-FR-STR-INV-DTE  AND  06270066
051705*                      PV-CURRENT-DATE >  PV-TO-STR-INV-DTE       06280066
051705*                     MOVE PC-YES                                 06290066
051705*                            TO TF026-BEFORE-INV-IND              06291066
051705*               END-EVALUATE                                      06300066
051705*            END-IF                                               06310066
051705*        ELSE                                                     06320066
051705*            IF PV-CMPLT-DATE   <= PV-XFER-INV-CTOFF-DTE          06330066
051705*                EVALUATE TRUE                                    06340066
051705*                  WHEN PV-CURRENT-DATE <= PV-FR-STR-INV-DTE  AND 06350066
051705*                       PV-CURRENT-DATE <= PV-TO-STR-INV-DTE      06360066
051705*                      CONTINUE                                   06370066
051705*                  WHEN PV-CURRENT-DATE >  PV-FR-STR-INV-DTE  AND 06380066
051705*                       PV-CURRENT-DATE >  PV-TO-STR-INV-DTE      06390066
051705*                      MOVE PC-YES                                06400066
051705*                            TO TF026-BEFORE-INV-IND              06401066
051705*                END-EVALUATE                                     06410066
051705*            END-IF                                               06420066
051705*        END-IF                                                   06430066
051705*    END-IF.                                                      06440066
      *                                                                 06450044
051705*2700-MISDIRECT.                                                  06460066
051705*    IF PV-CONTNR-TYP-CDE = PC-HAND-CARRY                         06470066
051705*        IF PV-FR-NO-INVENTORY                                    06480066
051705*            MOVE PV-TO-STR-INV-DTE                               06490066
051705*                            TO PV-COMPARE-DATE                   06491066
051705*        ELSE                                                     06500066
051705*            MOVE PV-FR-STR-INV-DTE                               06510066
051705*                            TO PV-COMPARE-DATE                   06511066
051705*        END-IF                                                   06520066
051705*    ELSE                                                         06530066
051705*        MOVE PV-XFER-INV-CTOFF-DTE                               06540066
051705*                            TO PV-COMPARE-DATE                   06541066
051705*    END-IF.                                                      06550066
051705*    MOVE TFMSTR-TO-STR-NBR  TO DK-STORE-NBR-9.                   06560066
051705*    PERFORM 7920-GET-PLND-INV-DTE.                               06570066
051705*    MOVE INVPAR-PLND-INV-DTE                                     06580066
051705*                            TO PV-FR-STR-INV-DTE.                06581066
051705*    MOVE PV-HOLD-INVENTORY-IND                                   06590066
051705*                            TO PV-FR-INVENTORY-IND.              06591066
051705*    MOVE TFDSCP-RCVD-AT-STR-NBR                                  06600066
051705*                            TO DK-STORE-NBR-9.                   06601066
051705*    PERFORM 7920-GET-PLND-INV-DTE.                               06610066
051705*    MOVE INVPAR-PLND-INV-DTE                                     06620066
051705*                            TO PV-TO-STR-INV-DTE.                06621066
051705*    MOVE PV-HOLD-INVENTORY-IND                                   06630066
051705*                            TO PV-TO-INVENTORY-IND.              06631066
051705*    IF PV-FR-NO-INVENTORY  AND                                   06640066
051705*       PV-TO-NO-INVENTORY                                        06650066
051705*        CONTINUE                                                 06660066
051705*    ELSE                                                         06670066
051705*        IF PV-FR-NO-INVENTORY                                    06680066
051705*            MOVE PV-TO-STR-INV-DTE                               06690066
051705*                            TO PV-FR-STR-INV-DTE                 06691066
051705*        ELSE                                                     06700066
051705*            IF PV-TO-NO-INVENTORY                                06710066
051705*                MOVE PV-FR-STR-INV-DTE                           06720066
051705*                            TO  PV-TO-STR-INV-DTE                06730066
051705*            END-IF                                               06740066
051705*        END-IF                                                   06750066
051705*        IF PV-CMPLT-DATE   <= PV-COMPARE-DATE                    06760066
051705*           EVALUATE TRUE                                         06770066
051705*             WHEN PV-CURRENT-DATE <= PV-FR-STR-INV-DTE  AND      06780066
051705*                  PV-CURRENT-DATE <= PV-TO-STR-INV-DTE           06790066
051705*                 CONTINUE                                        06800066
051705*             WHEN PV-CURRENT-DATE >  PV-FR-STR-INV-DTE  AND      06810066
051705*                  PV-CURRENT-DATE >  PV-TO-STR-INV-DTE           06820066
051705*                 MOVE PC-YES                                     06830066
051705*                            TO TF026-BEFORE-INV-IND              06831066
051705*           END-EVALUATE                                          06840066
051705*        END-IF                                                   06850066
051705*    END-IF.                                                      06860066
                                                                        06870066
       3000-DTL-CHK-BYPASSED.                                           06880044
           PERFORM 4000-OPEN-XFER-ITM-CSR.                              06890044
           PERFORM 7050-FETCH-XFER-ITM-CSR.                             06900044
                                                                        06910044
           PERFORM 3010-UPDATE-XFER-ITM-RCPTS                           06920044
               UNTIL PS-END-OF-XFER-ITMS.                               06930044
                                                                        06940044
           PERFORM 4100-CLOSE-XFER-ITM-CSR.                             06950044
      *                                                                 06960044
       3010-UPDATE-XFER-ITM-RCPTS.                                      06970044
           IF TFITEM-KOHLS-UPC-NBR = ZEROS                              06980052
               MOVE ZEROS          TO  TFITRC-RCVD-RTL-PRIC-AMT         06990055
           ELSE                                                         07000044
               PERFORM 7100-SELECT-CUR-UNT-RTL-AMT                      07010044
               MOVE PV-CUR-RTL-AMT TO  TFITRC-RCVD-RTL-PRIC-AMT         07020055
           END-IF.                                                      07030044
                                                                        07040044
           PERFORM 7150-UPDATE-XFER-ITM-RCPT.                           07050044
                                                                        07060044
           IF PV-OFFSITE-STORAGE-XFER                                   07070062
               CONTINUE                                                 07080044
           ELSE                                                         07090044
               IF PS-XFER-DISCREPANCY  AND                              07100044
                  TFDSCP-RCVD-AT-STR-NBR  NOT =  ZEROS                  07110044
                   PERFORM 3110-CREATE-ADJUSTMENT                       07120044
               END-IF                                                   07130044
           END-IF.                                                      07140044
                                                                        07150044
           PERFORM 7050-FETCH-XFER-ITM-CSR.                             07160044
      *                                                                 07170044
       3100-DTL-CHK.                                                    07180044
           PERFORM 7200-CHK-FOR-DISCREPANCY.                            07190044
                                                                        07200044
           PERFORM 4000-OPEN-XFER-ITM-CSR.                              07210044
           PERFORM 7050-FETCH-XFER-ITM-CSR.                             07220044
                                                                        07230044
           IF PS-XFER-DISCREPANCY                                       07240044
               MOVE PC-YES         TO  TFRCPT-XFER-DSCRP-IND            07250055
                                       TF026-DISCREPANCY-IND            07260055
               IF TFDSCP-RCVD-AT-STR-NBR  NOT =  ZEROS                  07270044
                   IF PV-RTL-XFER                                       07280044
                       PERFORM 3110-CREATE-ADJUSTMENT                   07290044
                           UNTIL  PS-END-OF-XFER-ITMS                   07300044
                   END-IF                                               07310044
               ELSE                                                     07320044
                   PERFORM 5000-CHK-FOR-ITM-DISCREPANCYS                07330044
                       UNTIL  PS-END-OF-XFER-ITMS                       07340044
               END-IF                                                   07350044
           ELSE                                                         07360044
               MOVE PC-NO          TO  TFRCPT-XFER-DSCRP-IND            07370055
                                       TF026-DISCREPANCY-IND            07380055
               PERFORM 5000-CHK-FOR-ITM-DISCREPANCYS                    07390044
                   UNTIL  PS-END-OF-XFER-ITMS                           07400044
           END-IF.                                                      07410044
                                                                        07420044
           PERFORM 4100-CLOSE-XFER-ITM-CSR.                             07430044
      *                                                                 07440044
       3110-CREATE-ADJUSTMENT.                                          07450044
           IF TFITEM-XFER-QTY > PC-ZERO                                 07460044
               MOVE TFITEM-XFER-PRIC-AMT                                07470055
                                   TO  TFITPS-ITM-RTL-PRCE-AMT          07471055
               MOVE TFITEM-XFER-QTY                                     07480055
                                   TO  TFITPS-ITM-QTY                   07481055
               MOVE TFMSTR-TO-STR-NBR                                   07490055
                                   TO  TFITPS-FRM-PSTG-STR-NBR          07491055
               MOVE TFDSCP-RCVD-AT-STR-NBR                              07500055
                                   TO  TFITPS-TO-PSTG-STR-NBR           07501055
               MOVE PC-MISDIRECT-RSN-CDE                                07510055
                                   TO  TFITPS-ADJ-RSN-CDE               07511055
               MOVE PC-FASHION-SALES                                    07520055
                                   TO  TFITPS-EXTL-SYS-PRCG-CDE         07521055
               PERFORM 7300-SELECT-MAX-PSTG-SEQ-NBR                     07530044
               PERFORM 7350-INSERT-ADJUSTMENT-ROW                       07540044
           END-IF.                                                      07550044
                                                                        07560044
           IF TF025-DTL-CHK                                             07570044
               PERFORM 5000-CHK-FOR-ITM-DISCREPANCYS                    07580044
           END-IF.                                                      07590044
      *                                                                 07600044
       4000-OPEN-XFER-ITM-CSR.                                          07610044
           EXEC SQL                                                     07620044
               OPEN XFER_ITM_CSR                                        07630044
           END-EXEC.                                                    07640044
                                                                        07650044
           EVALUATE SQLCODE                                             07660053
               WHEN ZERO                                                07661053
                   CONTINUE                                             07662053
               WHEN OTHER                                               07670053
                   MOVE '4000-OPEN-XFER-ITM-CSR'                        07700044
                                   TO DP013-PARAGRAPH                   07710055
                   MOVE 'OPEN THE XFER_ITM_CSR CURSOR'                  07720044
                                   TO DP013-MESSAGE-TEXT (1)            07730055
                   MOVE SQLCA      TO DP013-SQLCA                       07740055
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          07750055
                   SET DP013-DB2-ABEND                                  07760044
                       DP013-ROLLBACK                                   07770055
                                   TO TRUE                              07771055
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07780044
                   SET  DP011-MSG-FATAL                                 07790055
                                   TO TRUE                              07791055
                   MOVE PC-TSYMSG-01064                                 07800055
                                   TO DP011-MSG-NUMBER                  07801055
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07810044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07820044
           END-EVALUATE.                                                07850044
      *                                                                 07860044
       4100-CLOSE-XFER-ITM-CSR.                                         07870044
           EXEC SQL                                                     07880044
               CLOSE XFER_ITM_CSR                                       07890044
           END-EXEC.                                                    07900044
                                                                        07910044
           EVALUATE SQLCODE                                             07920053
               WHEN ZERO                                                07921053
                   CONTINUE                                             07922053
               WHEN OTHER                                               07930053
                   MOVE '4100-CLOSE-XFER-ITM-CSR'                       07960044
                                   TO DP013-PARAGRAPH                   07970055
                   MOVE 'CLOSE THE XFER_ITM_CSR CURSOR'                 07980044
                                   TO DP013-MESSAGE-TEXT (1)            07990055
                   MOVE SQLCA      TO DP013-SQLCA                       08000055
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          08010055
                   SET DP013-DB2-ABEND                                  08020044
                       DP013-ROLLBACK                                   08030055
                                   TO TRUE                              08031055
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08040044
                   SET  DP011-MSG-FATAL                                 08050055
                                   TO TRUE                              08051055
                   MOVE PC-TSYMSG-01064                                 08060055
                                   TO DP011-MSG-NUMBER                  08061055
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08070044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08080044
           END-EVALUATE.                                                08110044
      *                                                                 08120044
       5000-CHK-FOR-ITM-DISCREPANCYS.                                   08130044
           PERFORM 5010-OPEN-RCPT-ITM-CSR.                              08140044
           PERFORM 7400-FETCH-RCPT-ITM-CSR.                             08150044
           PERFORM 5020-PROCESS-RCPT-ITMS                               08160044
               UNTIL PS-END-OF-RCPT-ITMS.                               08170044
           PERFORM 5030-CLOSE-RCPT-ITM-CSR.                             08180044
                                                                        08190044
           SET  PS-MORE-RCPT-ITMS  TO  TRUE.                            08200044
                                                                        08210044
           PERFORM 7050-FETCH-XFER-ITM-CSR.                             08220044
      *                                                                 08230044
       5010-OPEN-RCPT-ITM-CSR.                                          08240044
           EXEC SQL                                                     08250044
               OPEN RCPT_ITM_CSR                                        08260044
           END-EXEC.                                                    08270044
                                                                        08280044
           EVALUATE SQLCODE                                             08290053
               WHEN ZERO                                                08291053
                   CONTINUE                                             08292053
               WHEN OTHER                                               08300053
                   MOVE '5010-OPEN-RCPT-ITM-CSR'                        08330044
                                   TO DP013-PARAGRAPH                   08340055
                   MOVE 'OPEN THE RCPT_ITM_CSR CURSOR'                  08350044
                                   TO DP013-MESSAGE-TEXT (1)            08360055
                   MOVE SQLCA      TO DP013-SQLCA                       08370055
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          08380055
                   SET DP013-DB2-ABEND                                  08390044
                       DP013-ROLLBACK                                   08400055
                                   TO TRUE                              08401055
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08410044
                   SET  DP011-MSG-FATAL                                 08420055
                                   TO TRUE                              08421055
                   MOVE PC-TSYMSG-01064                                 08430055
                                   TO DP011-MSG-NUMBER                  08431055
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08440044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08450044
           END-EVALUATE.                                                08480044
      *                                                                 08490044
       5020-PROCESS-RCPT-ITMS.                                          08500044
           IF TFITRC-XFER-LNE-SEQ-NBR  =  PC-ONE                        08510044
               IF TFITEM-XFER-QTY  =  TFITRC-RCVD-XFER-QTY              08520044
                   CONTINUE                                             08530044
               ELSE                                                     08540044
                   MOVE PC-YES     TO  TF026-DISCREPANCY-IND            08550055
                   COMPUTE TFITPS-ITM-QTY  =                            08560044
                       TFITRC-RCVD-XFER-QTY  -  TFITEM-XFER-QTY         08570044
                   IF PV-RTL-XFER                                       08580044
                       IF TFITPS-ITM-QTY POSITIVE                       08590044
                           PERFORM 5100-SAME-FROM-TO-STR                08600044
                       ELSE                                             08610044
                           PERFORM 5200-SWITCH-FROM-TO-STR              08620044
                           COMPUTE TFITPS-ITM-QTY  =                    08630044
                               TFITPS-ITM-QTY  *  -1                    08640044
                       END-IF                                           08650044
                       MOVE TFITEM-XFER-PRIC-AMT                        08660044
                                   TO TFITPS-ITM-RTL-PRCE-AMT           08670055
                                                                        08680044
                       MOVE PC-ADJUSTMENT-RSN-CDE                       08690055
                                   TO TFITPS-ADJ-RSN-CDE                08691055
                       PERFORM 5300-FILL-EXNL-SYS-PRCG-CDE              08700044
                       PERFORM 7300-SELECT-MAX-PSTG-SEQ-NBR             08710044
                       PERFORM 7350-INSERT-ADJUSTMENT-ROW               08720044
                       PERFORM 7750-UPDATE-XFER-ITM-DSCRP-IND           08730044
                   ELSE                                                 08740044
                       MOVE 1      TO  TFITRC-XFER-LNE-SEQ-NBR          08750055
                       PERFORM 7750-UPDATE-XFER-ITM-DSCRP-IND           08760044
                   END-IF                                               08770044
           ELSE                                                         08780044
               IF PV-RTL-XFER                                           08790044
                   MOVE PC-YES     TO  TF026-DISCREPANCY-IND            08801057
                   MOVE TFITRC-RCVD-XFER-QTY                            08810055
                                   TO  TFITPS-ITM-QTY                   08811055
                   MOVE TFITRC-RCVD-XFER-PRIC-AMT                       08820044
                                   TO TFITPS-ITM-RTL-PRCE-AMT           08830055
                   PERFORM 5100-SAME-FROM-TO-STR                        08840044
                   MOVE PC-ADJUSTMENT-RSN-CDE                           08850055
                                   TO  TFITPS-ADJ-RSN-CDE               08851055
                   PERFORM 5300-FILL-EXNL-SYS-PRCG-CDE                  08860044
                   PERFORM 7300-SELECT-MAX-PSTG-SEQ-NBR                 08870044
                   PERFORM 7350-INSERT-ADJUSTMENT-ROW                   08880044
                   PERFORM 7750-UPDATE-XFER-ITM-DSCRP-IND               08890044
               ELSE                                                     08900044
                   MOVE PC-YES     TO  TF026-DISCREPANCY-IND            08910055
                   PERFORM 7750-UPDATE-XFER-ITM-DSCRP-IND               08920044
               END-IF                                                   08930044
           END-IF.                                                      08940044
                                                                        08950044
           PERFORM 7400-FETCH-RCPT-ITM-CSR.                             08960044
      *                                                                 08970044
       5030-CLOSE-RCPT-ITM-CSR.                                         08980044
           EXEC SQL                                                     08990044
               CLOSE RCPT_ITM_CSR                                       09000044
           END-EXEC.                                                    09010044
                                                                        09020044
           EVALUATE SQLCODE                                             09030053
               WHEN ZERO                                                09031053
                   CONTINUE                                             09032053
               WHEN OTHER                                               09040053
                   MOVE '5030-CLOSE-RCPT-ITM-CSR'                       09070044
                                   TO DP013-PARAGRAPH                   09080055
                   MOVE 'CLOSE THE RCPT_ITM_CSR CURSOR'                 09090044
                                   TO DP013-MESSAGE-TEXT (1)            09100055
                   MOVE SQLCA      TO DP013-SQLCA                       09110055
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          09120055
                   SET DP013-DB2-ABEND                                  09130044
                       DP013-ROLLBACK                                   09140055
                                   TO TRUE                              09141055
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09150044
                   SET  DP011-MSG-FATAL                                 09160055
                                   TO TRUE                              09161055
                   MOVE PC-TSYMSG-01064                                 09170055
                                   TO DP011-MSG-NUMBER                  09171055
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09180044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09190044
           END-EVALUATE.                                                09220044
      *                                                                 09230044
       5100-SAME-FROM-TO-STR.                                           09240044
           MOVE TFMSTR-FR-STR-NBR  TO  TFITPS-FRM-PSTG-STR-NBR.         09250055
           IF PS-XFER-DISCREPANCY                                       09260044
               IF TFDSCP-RCVD-AT-STR-NBR  =  ZEROS                      09270044
                   MOVE TFMSTR-TO-STR-NBR                               09280055
                                   TO   TFITPS-TO-PSTG-STR-NBR          09281055
               ELSE                                                     09290044
                   MOVE TFDSCP-RCVD-AT-STR-NBR                          09300055
                                   TO TFITPS-TO-PSTG-STR-NBR            09301055
               END-IF                                                   09310044
           ELSE                                                         09320044
               MOVE TFMSTR-TO-STR-NBR                                   09330055
                                   TO  TFITPS-TO-PSTG-STR-NBR           09331055
           END-IF.                                                      09340044
      *                                                                 09350044
       5200-SWITCH-FROM-TO-STR.                                         09360044
           MOVE TFMSTR-FR-STR-NBR  TO  TFITPS-TO-PSTG-STR-NBR.          09370055
           IF PS-XFER-DISCREPANCY                                       09380044
               IF TFDSCP-RCVD-AT-STR-NBR  =  ZEROS                      09390044
                 MOVE TFMSTR-TO-STR-NBR                                 09400055
                                   TO  TFITPS-FRM-PSTG-STR-NBR          09401055
               ELSE                                                     09410044
                 MOVE TFDSCP-RCVD-AT-STR-NBR                            09420055
                                   TO TFITPS-FRM-PSTG-STR-NBR           09421055
               END-IF                                                   09430044
           ELSE                                                         09440044
               MOVE TFMSTR-TO-STR-NBR                                   09450055
                                   TO  TFITPS-FRM-PSTG-STR-NBR          09451055
           END-IF.                                                      09460044
      *                                                                 09470044
       5300-FILL-EXNL-SYS-PRCG-CDE.                                     09480044
021605     IF (PV-XFER-TYP-CDE  =  TF007-DEFECTIVES-DAMAGES-SORT1       09501064
                     OR                                                 09502052
021605         PV-XFER-TYP-CDE  =  TF007-DEFECTIVES-DAMAGES-SORT2       09503064
                     OR                                                 09504052
021605         PV-XFER-TYP-CDE  =  TF007-CALLBACK)                      09510064
               MOVE PC-MERCHANDISE-LEDGER                               09520055
                                   TO  TFITPS-EXTL-SYS-PRCG-CDE         09521055
           ELSE                                                         09530044
               MOVE PC-FASHION-SALES                                    09540055
                                   TO  TFITPS-EXTL-SYS-PRCG-CDE         09541055
           END-IF.                                                      09550044
      *                                                                 09560044
       7000-SELECT-MAX-RCPT-TMST.                                       09570044
           INITIALIZE DCLTTFRCPT.                                       09580044
           MOVE TF025-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 09590055
                                                                        09600044
           EXEC SQL                                                     09610044
               SELECT  MAX(RCV_XFER_BEG_TMST)                           09620044
                 INTO  :TFRCPT-RCV-XFER-BEG-TMST                        09630044
                           :PV-DB2-NULL-IND                             09640044
                 FROM  TTFRCPT                                          09650044
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          09660044
                  AND   RCV_XFER_BEG_TMST  =  RCV_XFER_END_TMST)        09670044
                 WITH  UR                                               09671053
           END-EXEC.                                                    09680044
                                                                        09690044
           EVALUATE SQLCODE                                             09700053
               WHEN ZERO                                                09701053
                   CONTINUE                                             09702053
               WHEN -904                                                09710053
               WHEN -913                                                09720053
                   SET  DP011-MSG-FATAL                                 09730055
                                   TO TRUE                              09731055
                   MOVE PC-TSYMSG-01063                                 09740055
                                   TO DP011-MSG-NUMBER                  09741055
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09750044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09760044
               WHEN OTHER                                               09770053
                   MOVE '7000-SELECT-MAX-RCPT-TMST'                     09800044
                                   TO DP013-PARAGRAPH                   09810055
                   MOVE 'SELECT MAX TIMESTAMP FOR XFER_DKEY_ID: '       09820044
                                   TO DP013-MESSAGE-TEXT (1)            09830055
                   MOVE DK-XFER-DKEY-ID                                 09840055
                                   TO PV-DISPLAY-XFER-DKEY-ID           09841055
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         09850044
                                   TO DP013-MESSAGE-TEXT (2)            09860055
                   MOVE SQLCA      TO DP013-SQLCA                       09870055
                   MOVE 'TTFRCPT'  TO DP013-DB2-TABLE-NAME (1)          09880055
                   SET DP013-DB2-ABEND                                  09890044
                       DP013-NO-ROLLBACK                                09900055
                                   TO TRUE                              09901059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09910044
                   SET  DP011-MSG-FATAL                                 09920055
                                   TO TRUE                              09921059
                   MOVE PC-TSYMSG-01064                                 09930055
                                   TO DP011-MSG-NUMBER                  09931059
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09940044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09950044
           END-EVALUATE.                                                09980044
      *                                                                 09990044
       7050-FETCH-XFER-ITM-CSR.                                         10000044
           INITIALIZE DCLTTFITEM.                                       10010044
                                                                        10020044
           EXEC SQL                                                     10030044
               FETCH  XFER_ITM_CSR                                      10040044
                INTO  :TFITEM-XFER-LNE-NBR,                             10050044
                      :TFITEM-KOHLS-UPC-NBR,                            10090052
                      :TFITEM-XFER-PRIC-AMT,                            10100044
                      :TFITEM-XFER-QTY                                  10110044
           END-EXEC.                                                    10120044
                                                                        10130044
           EVALUATE SQLCODE                                             10140053
               WHEN ZERO                                                10141053
                   CONTINUE                                             10142053
               WHEN +100                                                10150053
                   SET PS-END-OF-XFER-ITMS                              10160055
                                   TO TRUE                              10161055
               WHEN OTHER                                               10170053
                   MOVE '7050-FETCH-XFER-ITM-CSR'                       10200044
                                   TO DP013-PARAGRAPH                   10210055
                   MOVE 'FETCH XFER_ITM_CSR'                            10220055
                                   TO DP013-MESSAGE-TEXT (1)            10221055
                   MOVE 'FOR XFER_DKEY_ID: '                            10230055
                                   TO DP013-MESSAGE-TEXT (2)            10231055
                   MOVE DK-XFER-DKEY-ID                                 10240055
                                   TO PV-DISPLAY-XFER-DKEY-ID           10241055
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         10250044
                                   TO DP013-MESSAGE-TEXT (3)            10260055
                   MOVE SQLCA      TO DP013-SQLCA                       10270059
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          10280059
                   SET DP013-DB2-ABEND                                  10290044
                       DP013-ROLLBACK                                   10300059
                                   TO TRUE                              10301059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10310044
                   SET  DP011-MSG-FATAL                                 10320059
                                   TO TRUE                              10321059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              10330044
                       MOVE PC-TSYMSG-01063                             10340059
                                   TO DP011-MSG-NUMBER                  10341059
                   ELSE                                                 10350044
                       MOVE PC-TSYMSG-01064                             10360059
                                   TO DP011-MSG-NUMBER                  10361059
                   END-IF                                               10370044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10380044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10390044
           END-EVALUATE.                                                10420044
      *                                                                 10430044
       7100-SELECT-CUR-UNT-RTL-AMT.                                     10440044
           MOVE +0                 TO DK-LOC-NBR.                       10441059
           PERFORM 7860-GET-UNT-RTL-AMT.                                10442052
           IF XST00010-REGN-PRIC-IND = PC-YES                           10443064
                EVALUATE TFMSTR-XFER-TYP-CDE                            10444064
021605              WHEN  TF007-DEFECTIVES-DAMAGES-SORT1                10445064
021605              WHEN  TF007-DEFECTIVES-DAMAGES-SORT2                10446064
021605              WHEN  TF007-CALLBACK                                10447064
                        MOVE TFMSTR-FR-STR-NBR                          10448064
                                   TO DK-LOC-NBR                        10448164
                        PERFORM 7850-CHECK-REGN-PRC                     10449064
021605              WHEN  TF007-STOCK-BALANCE-CORPORATE                 10449164
021605              WHEN  TF007-STOCK-BALANCE-STORE                     10449264
021605              WHEN  TF007-CUSTOMER                                10449364
                        MOVE TF025-STR-NBR                              10449464
                                   TO DK-LOC-NBR                        10449564
                        PERFORM 7850-CHECK-REGN-PRC                     10449764
                END-EVALUATE                                            10449864
           END-IF.                                                      10449964
      *                                                                 10970044
       7150-UPDATE-XFER-ITM-RCPT.                                       10980044
           EXEC SQL                                                     10990044
               UPDATE  TTFITRC                                          11000044
                  SET  RCVD_XFER_QTY       = :TFITEM-XFER-QTY,          11010044
                       RCVD_XFER_PRIC_AMT  = :TFITEM-XFER-PRIC-AMT,     11020044
                       RCVD_RTL_PRIC_AMT   = :TFITRC-RCVD-RTL-PRIC-AMT, 11030044
                       XFER_ITM_DSCRP_IND  = :PC-NO                     11040044
                WHERE  (XFER_DKEY_ID       = :DK-XFER-DKEY-ID           11050044
                  AND   XFER_LNE_NBR       = :TFITEM-XFER-LNE-NBR       11060044
                  AND   XFER_RCPT_TMST     = :TFRCPT-RCV-XFER-BEG-TMST) 11070044
           END-EXEC.                                                    11080044
                                                                        11090044
           EVALUATE SQLCODE                                             11100053
               WHEN ZERO                                                11101053
                   CONTINUE                                             11102053
               WHEN OTHER                                               11110053
                   MOVE '7150-UPDATE-XFER-ITM-RCPT'                     11140044
                                   TO DP013-PARAGRAPH                   11150059
                   MOVE 'UPDATE XFER ITEM RECEIVED DATA FOR XFER_DKEY_ID11160044
      -                 '/XFER_LNE_NBR/XFER_RCPT_TMST: '                11170044
                                   TO DP013-MESSAGE-TEXT (1)            11180059
                   MOVE DK-XFER-DKEY-ID                                 11190059
                                   TO PV-DISPLAY-XFER-DKEY-ID           11191059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         11200044
                                   TO DP013-MESSAGE-TEXT (2)            11210059
                   MOVE TFITEM-XFER-LNE-NBR                             11220059
                                   TO PV-DISPLAY-XFER-LNE-NBR           11221059
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         11230044
                                   TO DP013-MESSAGE-TEXT (3)            11240059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        11250044
                                   TO DP013-MESSAGE-TEXT (4)            11260059
                   MOVE SQLCA      TO DP013-SQLCA                       11270059
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          11280059
                   SET DP013-DB2-ABEND                                  11290044
                       DP013-ROLLBACK                                   11300059
                                   TO TRUE                              11301059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11310044
                   SET  DP011-MSG-FATAL                                 11320059
                                   TO TRUE                              11321059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              11330044
                       MOVE PC-TSYMSG-01063                             11340059
                                   TO DP011-MSG-NUMBER                  11341059
                   ELSE                                                 11350044
                       MOVE PC-TSYMSG-01064                             11360059
                                   TO DP011-MSG-NUMBER                  11361059
                   END-IF                                               11370044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      11380044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   11390044
           END-EVALUATE.                                                11420044
      *                                                                 11430044
       7200-CHK-FOR-DISCREPANCY.                                        11440044
           INITIALIZE DCLTTFDSCP.                                       11450044
                                                                        11460044
           EXEC SQL                                                     11470044
               SELECT  RCVD_AT_STR_NBR                                  11480044
                 INTO  :TFDSCP-RCVD-AT-STR-NBR                          11490044
                 FROM  TTFDSCP                                          11500044
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          11510044
                  AND   RCV_XFER_BEG_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)11520044
                 WITH  UR                                               11521053
           END-EXEC.                                                    11530044
                                                                        11540044
           EVALUATE SQLCODE                                             11550053
               WHEN ZERO                                                11551053
                   SET PS-XFER-DISCREPANCY                              11552059
                                   TO TRUE                              11553059
               WHEN +100                                                11560053
                   SET PS-NO-XFER-DISCREPANCY                           11570059
                                   TO TRUE                              11571059
               WHEN OTHER                                               11580053
                   MOVE '7200-CHK-FOR-DISCREPANCY'                      11610044
                                   TO DP013-PARAGRAPH                   11620059
                   MOVE 'CHECK FOR DISCREPANCY FOR XFER_DKEY_ID/RCV_XFER11630044
      -                 'BEG_TMST: '                                    11640059
                                   TO DP013-MESSAGE-TEXT (1)            11641059
                   MOVE DK-XFER-DKEY-ID                                 11650059
                                   TO PV-DISPLAY-XFER-DKEY-ID           11651059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         11660044
                                   TO DP013-MESSAGE-TEXT (2)            11670059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        11680044
                                   TO DP013-MESSAGE-TEXT (3)            11690059
                   MOVE SQLCA      TO DP013-SQLCA                       11700059
                   MOVE 'TTFDSCP'  TO DP013-DB2-TABLE-NAME (1)          11710059
                   SET DP013-DB2-ABEND                                  11720044
                       DP013-ROLLBACK                                   11730059
                                   TO TRUE                              11731059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11740044
                   SET  DP011-MSG-FATAL                                 11750059
                                   TO TRUE                              11751059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              11760044
                       MOVE PC-TSYMSG-01063                             11770059
                                   TO DP011-MSG-NUMBER                  11771059
                   ELSE                                                 11780044
                       MOVE PC-TSYMSG-01064                             11790059
                                   TO DP011-MSG-NUMBER                  11791059
                   END-IF                                               11800044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      11810044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   11820044
           END-EVALUATE.                                                11850044
      *                                                                 11860044
       7250-SELECT-XFER.                                                11870044
           INITIALIZE DCLTTFMSTR.                                       11880044
                                                                        11890044
           EXEC SQL                                                     11900044
               SELECT  XFER_TYP_CDE,                                    11910044
                       FR_STR_NBR,                                      11920044
                       XFER_SEQ_NBR,                                    11930044
                       TO_STR_NBR,                                      11940044
                       CONTNR_TYP_CDE,                                  11950044
                       CMPT_XFER_END_TMST                               11960044
                 INTO  :TFMSTR-XFER-TYP-CDE,                            11970044
                       :TFMSTR-FR-STR-NBR,                              11980044
                       :TFMSTR-XFER-SEQ-NBR,                            11990044
                       :TFMSTR-TO-STR-NBR,                              12000044
                       :TFMSTR-CONTNR-TYP-CDE,                          12010044
                       :TFMSTR-CMPT-XFER-END-TMST                       12020044
                 FROM  TTFMSTR                                          12030044
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)              12040044
           END-EXEC.                                                    12050044
                                                                        12060044
           EVALUATE SQLCODE                                             12070053
               WHEN ZERO                                                12071053
                   MOVE TFMSTR-XFER-TYP-CDE                             12072059
                                   TO PV-XFER-TYP-CDE                   12072159
                   MOVE TFMSTR-FR-STR-NBR                               12073059
                                   TO TF005-XFER-FROM-STORE-NBR         12073159
                   MOVE TFMSTR-XFER-SEQ-NBR                             12074059
                                   TO TF005-XFER-SEQ-NBR                12074159
                   MOVE TFMSTR-TO-STR-NBR                               12075059
                                   TO RFWS009-STORE-NBR                 12075159
                   MOVE TFMSTR-CONTNR-TYP-CDE                           12076053
                                   TO PV-CONTNR-TYP-CDE                 12077059
                   MOVE TFMSTR-CMPT-XFER-END-TMST                       12078053
                                   TO PV-CMPLT-DATE                     12079059
               WHEN -904                                                12080053
               WHEN -913                                                12090053
                   SET  DP011-MSG-FATAL                                 12100059
                                   TO TRUE                              12101059
                   MOVE PC-TSYMSG-01063                                 12110059
                                   TO DP011-MSG-NUMBER                  12111059
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      12120044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   12130044
               WHEN OTHER                                               12140053
                   MOVE '7250-SELECT-XFER'                              12170059
                                   TO DP013-PARAGRAPH                   12171059
                   MOVE 'SELECT TRANSFER FOR XFER_DKEY_ID: '            12180044
                                   TO DP013-MESSAGE-TEXT (1)            12190059
                   MOVE DK-XFER-DKEY-ID                                 12200059
                                   TO PV-DISPLAY-XFER-DKEY-ID           12201059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         12210044
                                   TO DP013-MESSAGE-TEXT (2)            12220059
                   MOVE SQLCA      TO DP013-SQLCA                       12230059
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          12240059
                   SET DP013-DB2-ABEND                                  12250044
                       DP013-NO-ROLLBACK                                12260059
                                   TO TRUE                              12261059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      12270044
                   SET  DP011-MSG-FATAL                                 12280059
                                   TO TRUE                              12281059
                   MOVE PC-TSYMSG-01064                                 12290059
                                   TO DP011-MSG-NUMBER                  12291059
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      12300044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   12310044
           END-EVALUATE.                                                12410044
      *                                                                 12420044
       7300-SELECT-MAX-PSTG-SEQ-NBR.                                    12430044
           INITIALIZE PV-PSTG-SEQ-NBR.                                  12440044
                                                                        12450044
           EXEC SQL                                                     12460044
               SELECT  MAX(PSTG_SEQ_NBR)                                12470044
                 INTO  :PV-PSTG-SEQ-NBR                                 12480044
                           :PV-DB2-NULL-IND                             12490044
                 FROM  TTFITPS                                          12500044
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID               12510044
                  AND   XFER_LNE_NBR  =  :TFITEM-XFER-LNE-NBR)          12520044
                 WITH  UR                                               12521053
           END-EXEC.                                                    12530044
                                                                        12540044
           EVALUATE SQLCODE                                             12550053
               WHEN ZERO                                                12551053
                   CONTINUE                                             12552053
               WHEN OTHER                                               12560053
                   MOVE '7300-SELECT-MAX-PSTG-SEQ-NBR'                  12590044
                                   TO DP013-PARAGRAPH                   12600059
                   MOVE 'SELECT MAX(PSTG_SEQ_NBR) FOR XFER_DKEY_ID: '   12610044
                                   TO DP013-MESSAGE-TEXT (1)            12620059
                   MOVE DK-XFER-DKEY-ID                                 12630059
                                   TO PV-DISPLAY-XFER-DKEY-ID           12631059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         12640044
                                   TO DP013-MESSAGE-TEXT (2)            12650059
                   MOVE SQLCA      TO DP013-SQLCA                       12660059
                   MOVE 'TTFITPS'  TO DP013-DB2-TABLE-NAME (1)          12670059
                   SET DP013-DB2-ABEND                                  12680044
                       DP013-ROLLBACK                                   12690059
                                   TO TRUE                              12691059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      12700044
                   SET  DP011-MSG-FATAL                                 12710059
                                   TO TRUE                              12711059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              12720044
                       MOVE PC-TSYMSG-01063                             12730059
                                   TO DP011-MSG-NUMBER                  12731059
                   ELSE                                                 12740044
                       MOVE PC-TSYMSG-01064                             12750059
                                   TO DP011-MSG-NUMBER                  12751059
                   END-IF                                               12760044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      12770044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   12780044
           END-EVALUATE.                                                12810044
      *                                                                 12820044
       7350-INSERT-ADJUSTMENT-ROW.                                      12830044
           COMPUTE TFITPS-PSTG-SEQ-NBR  =                               12840044
               PV-PSTG-SEQ-NBR + 1.                                     12850044
                                                                        12860044
           EXEC SQL                                                     12870044
               INSERT INTO TTFITPS                                      12880044
                   (XFER_DKEY_ID,                                       12890044
                    XFER_LNE_NBR,                                       12900044
                    PSTG_SEQ_NBR,                                       12910044
                    XFER_RCPT_TMST,                                     12920044
                    ADJ_RSN_CDE,                                        12930044
                    FRM_PSTG_STR_NBR,                                   12940044
                    TO_PSTG_STR_NBR,                                    12950044
                    ITM_RTL_PRCE_AMT,                                   12960044
                    ITM_QTY,                                            12970044
                    EXTL_SYS_PRCG_CDE)                                  12980044
               VALUES                                                   12990044
                   (:DK-XFER-DKEY-ID,                                   13000044
                    :TFITEM-XFER-LNE-NBR,                               13010044
                    :TFITPS-PSTG-SEQ-NBR,                               13020044
                    :TFRCPT-RCV-XFER-BEG-TMST,                          13030044
                    :TFITPS-ADJ-RSN-CDE,                                13040044
                    :TFITPS-FRM-PSTG-STR-NBR,                           13050044
                    :TFITPS-TO-PSTG-STR-NBR,                            13060044
                    :TFITPS-ITM-RTL-PRCE-AMT,                           13070044
                    :TFITPS-ITM-QTY,                                    13080044
                    :TFITPS-EXTL-SYS-PRCG-CDE)                          13090044
           END-EXEC.                                                    13100044
                                                                        13110044
           EVALUATE SQLCODE                                             13120053
               WHEN ZERO                                                13121053
                   CONTINUE                                             13122053
               WHEN OTHER                                               13130053
                   MOVE '7350-INSERT-ADJUSTMENT-ROW'                    13160044
                                   TO DP013-PARAGRAPH                   13170059
                   MOVE 'INSERT ADJUSTMENT FOR XFER_DKEY_ID/XFER_LNE_NBR13180044
      -                 '/PSTG_SEQ_NBR: '                               13190059
                                   TO DP013-MESSAGE-TEXT (1)            13191059
                   MOVE DK-XFER-DKEY-ID                                 13200059
                                   TO PV-DISPLAY-XFER-DKEY-ID           13201059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         13210044
                                   TO DP013-MESSAGE-TEXT (2)            13220059
                   MOVE TFITEM-XFER-LNE-NBR                             13230059
                                   TO PV-DISPLAY-XFER-LNE-NBR           13231059
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         13240044
                                   TO DP013-MESSAGE-TEXT (3)            13250059
                   MOVE PV-PSTG-SEQ-NBR                                 13260059
                                   TO PV-DISPLAY-PSTG-SEQ-NBR           13261059
                   MOVE PV-DISPLAY-PSTG-SEQ-NBR                         13270044
                                   TO DP013-MESSAGE-TEXT (4)            13280059
                   MOVE SQLCA      TO DP013-SQLCA                       13290059
                   MOVE 'TTFITPS'  TO DP013-DB2-TABLE-NAME (1)          13300059
                   SET DP013-DB2-ABEND                                  13310044
                       DP013-ROLLBACK                                   13320059
                                   TO TRUE                              13321059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      13330044
                   SET  DP011-MSG-FATAL                                 13340059
                                   TO TRUE                              13341059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              13350044
                       MOVE PC-TSYMSG-01063                             13360059
                                   TO DP011-MSG-NUMBER                  13361059
                   ELSE                                                 13370044
                       MOVE PC-TSYMSG-01064                             13380059
                                   TO DP011-MSG-NUMBER                  13381059
                   END-IF                                               13390044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      13400044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   13410044
           END-EVALUATE.                                                13440044
      *                                                                 13450044
       7400-FETCH-RCPT-ITM-CSR.                                         13460044
           INITIALIZE DCLTTFITRC.                                       13470044
                                                                        13480044
           EXEC SQL                                                     13490044
               FETCH  RCPT_ITM_CSR                                      13500044
                INTO  :TFITRC-XFER-LNE-SEQ-NBR,                         13510044
                      :TFITRC-RCVD-XFER-QTY,                            13520044
                      :TFITRC-RCVD-XFER-PRIC-AMT                        13530044
           END-EXEC.                                                    13540044
                                                                        13550044
           EVALUATE SQLCODE                                             13560053
               WHEN ZERO                                                13561053
                   CONTINUE                                             13562053
               WHEN +100                                                13570053
                   SET PS-END-OF-RCPT-ITMS                              13580059
                                   TO TRUE                              13581059
               WHEN OTHER                                               13590053
                   MOVE '7400-FETCH-RCPT-ITM-CSR'                       13620044
                                   TO DP013-PARAGRAPH                   13630059
                   MOVE 'FETCH RCPT_ITM_CSR FOR XFER_DKEY_ID/XFER_LNE_NB13640044
      -                 'R/XFER_RCPT_TMST: '                            13650059
                                   TO DP013-MESSAGE-TEXT (1)            13651059
                   MOVE DK-XFER-DKEY-ID                                 13660059
                                   TO PV-DISPLAY-XFER-DKEY-ID           13661059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         13670044
                                   TO DP013-MESSAGE-TEXT (2)            13680059
                   MOVE TFITEM-XFER-LNE-NBR                             13690059
                                   TO PV-DISPLAY-XFER-LNE-NBR           13691059
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         13700044
                                   TO DP013-MESSAGE-TEXT (3)            13710059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        13720044
                                   TO DP013-MESSAGE-TEXT (4)            13730059
                   MOVE SQLCA      TO DP013-SQLCA                       13740059
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          13750059
                   SET DP013-DB2-ABEND                                  13760044
                       DP013-ROLLBACK                                   13770059
                                   TO TRUE                              13771059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      13780044
                   SET  DP011-MSG-FATAL                                 13790059
                                   TO TRUE                              13791059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              13800044
                       MOVE PC-TSYMSG-01063                             13810059
                                   TO DP011-MSG-NUMBER                  13811059
                   ELSE                                                 13820044
                       MOVE PC-TSYMSG-01064                             13830059
                                   TO DP011-MSG-NUMBER                  13831059
                   END-IF                                               13840044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      13850044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   13860044
           END-EVALUATE.                                                13890044
      *                                                                 13900044
       7450-UPDATE-MAX-RCPT-TMST.                                       13910044
           EXEC SQL                                                     13920044
               UPDATE  TTFRCPT                                          13930044
                  SET  RCV_XFER_END_TMST   =  CURRENT TIMESTAMP         13940044
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          13950044
                  AND   RCV_XFER_BEG_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)13960044
           END-EXEC.                                                    13970044
                                                                        13980044
           EVALUATE SQLCODE                                             13990053
               WHEN ZERO                                                13991053
                   CONTINUE                                             13992053
               WHEN -904                                                14000053
               WHEN -913                                                14010053
                   SET  DP011-MSG-FATAL                                 14020059
                                   TO TRUE                              14021059
                   MOVE PC-TSYMSG-01063                                 14030059
                                   TO DP011-MSG-NUMBER                  14031059
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      14040044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   14050044
               WHEN OTHER                                               14060053
                   MOVE '7450-UPDATE-MAX-RCPT-TMST'                     14090044
                                   TO DP013-PARAGRAPH                   14100059
                   MOVE 'UPDATE RECEIPT END TIMESTAMP FOR XFER_DKEY_ID/R14110044
      -                 'CV_XFER_BEG_TMST: '                            14120059
                                   TO DP013-MESSAGE-TEXT (1)            14121059
                   MOVE DK-XFER-DKEY-ID                                 14130059
                                   TO PV-DISPLAY-XFER-DKEY-ID           14131059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         14140044
                                   TO DP013-MESSAGE-TEXT (2)            14150059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        14160044
                                   TO DP013-MESSAGE-TEXT (3)            14170059
                   MOVE SQLCA      TO DP013-SQLCA                       14180059
                   MOVE 'TTFRCPT'  TO DP013-DB2-TABLE-NAME (1)          14190059
                   SET DP013-DB2-ABEND                                  14200044
                       DP013-NO-ROLLBACK                                14210059
                                   TO TRUE                              14211059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      14220044
                   SET  DP011-MSG-FATAL                                 14230059
                                   TO TRUE                              14231059
                   MOVE PC-TSYMSG-01064                                 14240059
                                   TO DP011-MSG-NUMBER                  14241059
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      14250044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   14260044
           END-EVALUATE.                                                14290044
      *                                                                 14300044
       7500-DELETE-XFER-ITM-RCPTS.                                      14310044
           EXEC SQL                                                     14320044
               DELETE FROM TTFITRC                                      14330044
                WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID             14340044
                  AND   XFER_RCPT_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)   14350044
           END-EXEC.                                                    14360044
                                                                        14370044
           EVALUATE SQLCODE                                             14380053
               WHEN ZERO                                                14381053
                   CONTINUE                                             14382053
               WHEN +100                                                14390053
                   CONTINUE                                             14400044
               WHEN OTHER                                               14410053
                   MOVE '7500-DELETE-XFER-ITM-RCPTS'                    14440044
                                   TO DP013-PARAGRAPH                   14450059
                   MOVE 'DELETE ALL RECEIPT ITEMS FOR XFER_DKEY_ID/XFER_14460044
      -                 'RCPT_TMST: '                                   14470059
                                   TO DP013-MESSAGE-TEXT (1)            14471059
                   MOVE DK-XFER-DKEY-ID                                 14480059
                                   TO PV-DISPLAY-XFER-DKEY-ID           14481059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         14490044
                                   TO DP013-MESSAGE-TEXT (2)            14500059
                   MOVE TFRCPT-RCV-XFER-END-TMST                        14510044
                                   TO DP013-MESSAGE-TEXT (3)            14520059
                   MOVE SQLCA      TO DP013-SQLCA                       14530059
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          14540059
                   SET DP013-DB2-ABEND                                  14550044
                       DP013-ROLLBACK                                   14560059
                                   TO TRUE                              14561059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      14570044
                   SET  DP011-MSG-FATAL                                 14580059
                                   TO TRUE                              14581059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              14590044
                       MOVE PC-TSYMSG-01063                             14600059
                                   TO DP011-MSG-NUMBER                  14601059
                   ELSE                                                 14610044
                       MOVE PC-TSYMSG-01064                             14620059
                                   TO DP011-MSG-NUMBER                  14621059
                   END-IF                                               14630044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      14640044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   14650044
           END-EVALUATE.                                                14680044
      *                                                                 14690044
       7550-DELETE-ALL-ADDED-ITMS.                                      14700044
           INITIALIZE TFITEM-XFER-QTY.                                  14710044
                                                                        14720044
           EXEC SQL                                                     14730044
               DELETE FROM TTFITEM                                      14740044
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID               14750044
                  AND   XFER_QTY      =  :TFITEM-XFER-QTY)              14760044
           END-EXEC.                                                    14770044
                                                                        14780044
           EVALUATE SQLCODE                                             14790053
               WHEN ZERO                                                14791053
                   CONTINUE                                             14792053
               WHEN +100                                                14800053
                   CONTINUE                                             14810044
               WHEN OTHER                                               14820053
                   MOVE '7550-DELETE-ALL-ADDED-ITMS'                    14850044
                                   TO DP013-PARAGRAPH                   14860059
                   MOVE 'DELETE ALL XFER ITEMS ADDED DURING THIS RECEIPT14870044
      -                 'FOR XFER_DKEY_ID: '                            14880059
                                   TO DP013-MESSAGE-TEXT (1)            14881059
                   MOVE DK-XFER-DKEY-ID                                 14890059
                                   TO PV-DISPLAY-XFER-DKEY-ID           14891059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         14900044
                                   TO DP013-MESSAGE-TEXT (2)            14910059
                   MOVE SQLCA      TO DP013-SQLCA                       14920059
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          14930059
                   SET DP013-DB2-ABEND                                  14940044
                       DP013-ROLLBACK                                   14950059
                                   TO TRUE                              14951059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      14960044
                   SET  DP011-MSG-FATAL                                 14970059
                                   TO TRUE                              14971059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              14980044
                       MOVE PC-TSYMSG-01063                             14990059
                                   TO DP011-MSG-NUMBER                  14991059
                   ELSE                                                 15000044
                       MOVE PC-TSYMSG-01064                             15010059
                                   TO DP011-MSG-NUMBER                  15011059
                   END-IF                                               15020044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      15030044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   15040044
           END-EVALUATE.                                                15070044
      *                                                                 15080044
       7600-UPDATE-XFER-RCPT-END-TMST.                                  15090044
           IF TF026-BEFORE-INV-IND = PC-YES                             15100044
               MOVE PC-YES         TO TFRCPT-RCVG-PROB-IND              15110059
           ELSE                                                         15120044
               MOVE PC-NO          TO TFRCPT-RCVG-PROB-IND              15130059
           END-IF.                                                      15140044
           EXEC SQL                                                     15150044
               UPDATE  TTFRCPT                                          15160044
                  SET  RCPT_MTHD_CDE       =  '01',                     15170044
                       RCV_XFER_END_TMST   =  CURRENT TIMESTAMP,        15180044
                       BYP_DTL_CK_IND      =  :TF025-DTL-CHK-BYPASS-IND,15190044
                       XFER_DSCRP_IND      =  :TFRCPT-XFER-DSCRP-IND,   15200044
                       RCVG_PROB_IND       =  :TFRCPT-RCVG-PROB-IND     15210044
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          15220044
                  AND   RCV_XFER_BEG_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)15230044
           END-EXEC.                                                    15240044
                                                                        15250044
           EVALUATE SQLCODE                                             15260053
               WHEN ZERO                                                15261053
                   CONTINUE                                             15262053
               WHEN OTHER                                               15270053
                   MOVE '7600-UPDATE-XFER-RCPT-END-TMST'                15300044
                                   TO DP013-PARAGRAPH                   15310059
                   MOVE 'UPDATE RECEIPT XFER END TIMESTAMP FOR XFER_DKEY15320044
      -                 '_ID/XFER_RCPT_TMST: '                          15330044
                                   TO DP013-MESSAGE-TEXT (1)            15340059
                   MOVE DK-XFER-DKEY-ID                                 15350059
                                   TO PV-DISPLAY-XFER-DKEY-ID           15351059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         15360044
                                   TO DP013-MESSAGE-TEXT (2)            15370059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        15380044
                                   TO DP013-MESSAGE-TEXT (3)            15390059
                   MOVE SQLCA      TO DP013-SQLCA                       15400059
                   MOVE 'TTFRCPT'  TO DP013-DB2-TABLE-NAME (1)          15410059
                   SET DP013-DB2-ABEND                                  15420044
                       DP013-ROLLBACK                                   15430059
                                   TO TRUE                              15431059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      15440044
                   SET  DP011-MSG-FATAL                                 15450059
                                   TO TRUE                              15451059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              15460044
                       MOVE PC-TSYMSG-01063                             15470059
                                   TO DP011-MSG-NUMBER                  15471059
                   ELSE                                                 15480044
                       MOVE PC-TSYMSG-01064                             15490059
                                   TO DP011-MSG-NUMBER                  15491059
                   END-IF                                               15500044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      15510044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   15520044
           END-EVALUATE.                                                15550044
      *                                                                 15560044
       7650-UPDATE-XFER-STAT-TO-PR.                                     15570044
           EXEC SQL                                                     15580044
               UPDATE  TTFSTAT                                          15590044
                  SET  XFER_STAT_CDE    =  'PR'                         15600044
                WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID             15610044
                  AND   XFER_STAT_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)   15620044
           END-EXEC.                                                    15630044
                                                                        15640044
           EVALUATE SQLCODE                                             15650053
               WHEN ZERO                                                15651053
                   CONTINUE                                             15652053
               WHEN OTHER                                               15660053
                   MOVE '7650-UPDATE-XFER-STAT-TO-PR'                   15690044
                                   TO DP013-PARAGRAPH                   15700059
                   MOVE 'UPDATE XFER STATUS FOR XFER_DKEY_ID/XFER_STAT_T15710044
      -                 'MST: '    TO DP013-MESSAGE-TEXT (1)            15720059
                   MOVE DK-XFER-DKEY-ID                                 15730059
                                   TO PV-DISPLAY-XFER-DKEY-ID           15731059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         15740044
                                   TO DP013-MESSAGE-TEXT (2)            15750059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        15760044
                                   TO DP013-MESSAGE-TEXT (3)            15770059
                   MOVE SQLCA      TO DP013-SQLCA                       15780059
                   MOVE 'TTFSTAT'  TO DP013-DB2-TABLE-NAME (1)          15790059
                   SET DP013-DB2-ABEND                                  15800044
                       DP013-ROLLBACK                                   15810059
                                   TO TRUE                              15811059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      15820044
                   SET  DP011-MSG-FATAL                                 15830059
                                   TO TRUE                              15831059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              15840044
                       MOVE PC-TSYMSG-01063                             15850059
                                   TO DP011-MSG-NUMBER                  15851059
                   ELSE                                                 15860044
                       MOVE PC-TSYMSG-01064                             15870059
                                   TO DP011-MSG-NUMBER                  15871059
                   END-IF                                               15880044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      15890044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   15900044
           END-EVALUATE.                                                15930044
      *                                                                 15940044
       7700-SELECT-ASSUMPTIVE-RECEIPT.                                  15950044
           EXEC SQL                                                     15960044
               SELECT  XFER_STAT_CDE                                    15970044
                 INTO  :TFSTAT-XFER-STAT-CDE                            15980044
                 FROM  TTFSTAT                                          15990044
                WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID              16000044
                  AND   XFER_STAT_CDE  =  :PC-ASSUMPTIVELY-RECEIVED)    16010044
                 WITH  UR                                               16011053
           END-EXEC.                                                    16020044
                                                                        16030044
           EVALUATE SQLCODE                                             16040053
               WHEN ZERO                                                16040153
                   CONTINUE                                             16040253
               WHEN +100                                                16041053
                   CONTINUE                                             16042053
               WHEN -904                                                16050053
               WHEN -913                                                16060053
                   SET  DP011-MSG-FATAL                                 16070059
                                   TO TRUE                              16071059
                   MOVE PC-TSYMSG-01063                                 16080059
                                   TO DP011-MSG-NUMBER                  16081059
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      16090044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   16100044
               WHEN OTHER                                               16130053
                   MOVE '7700-SELECT-ASSUMPTIVE-RECEIPT'                16160044
                                   TO DP013-PARAGRAPH                   16170059
                   MOVE 'CHECK FOR AN ASSUMPTIVE RECEIPT FOR XFER_DKEY_I16180044
      -                 'D: '      TO DP013-MESSAGE-TEXT (1)            16190059
                   MOVE DK-XFER-DKEY-ID                                 16200059
                                   TO PV-DISPLAY-XFER-DKEY-ID           16201059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         16210044
                                   TO DP013-MESSAGE-TEXT (2)            16220059
                   MOVE SQLCA      TO DP013-SQLCA                       16230059
                   MOVE 'TTFSTAT'  TO DP013-DB2-TABLE-NAME (1)          16240059
                   SET DP013-DB2-ABEND                                  16250044
                       DP013-NO-ROLLBACK                                16260059
                                   TO TRUE                              16261059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      16270044
                   SET  DP011-MSG-FATAL                                 16280059
                                   TO TRUE                              16281059
                   MOVE PC-TSYMSG-01064                                 16290059
                                   TO DP011-MSG-NUMBER                  16291059
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      16300044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   16310044
           END-EVALUATE.                                                16340044
      *                                                                 16350044
       7750-UPDATE-XFER-ITM-DSCRP-IND.                                  16360044
           EXEC SQL                                                     16370044
               UPDATE  TTFITRC                                          16380044
                  SET  XFER_ITM_DSCRP_IND  =  :PC-YES                   16390044
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          16400044
                  AND   XFER_LNE_NBR       =  :TFITEM-XFER-LNE-NBR      16410044
                  AND   XFER_LNE_SEQ_NBR   =  :TFITRC-XFER-LNE-SEQ-NBR  16420044
                  AND   XFER_RCPT_TMST     =  :TFRCPT-RCV-XFER-BEG-TMST)16430044
           END-EXEC.                                                    16440044
                                                                        16450044
           EVALUATE SQLCODE                                             16460053
               WHEN ZERO                                                16461053
                   CONTINUE                                             16462053
               WHEN OTHER                                               16470053
                   MOVE '7750-UPDATE-XFER-ITM-DSCRP-IND'                16500044
                                   TO DP013-PARAGRAPH                   16510059
                   MOVE 'UPDATE TRANSFER ITEM DISCREPANCY INDICATOR FOR'16520044
                                   TO DP013-MESSAGE-TEXT (1)            16530059
                   MOVE 'XFER_DKEY_ID/XFER_LNE_NBR/XFER_LNE_SEQ_NBR/XFER16540044
      -                 '_RCPT_TMST: '                                  16550044
                                   TO DP013-MESSAGE-TEXT (2)            16560059
                   MOVE DK-XFER-DKEY-ID                                 16570059
                                   TO PV-DISPLAY-XFER-DKEY-ID           16571059
                   MOVE TFITEM-XFER-LNE-NBR                             16580059
                                   TO PV-DISPLAY-XFER-LNE-NBR           16581059
                   MOVE TFITRC-XFER-LNE-SEQ-NBR                         16590044
                                   TO PV-DISPLAY-XFER-LNE-SEQ-NBR       16600059
                   MOVE PV-DISPLAY-AREA                                 16610059
                                   TO DP013-MESSAGE-TEXT (3)            16611059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        16620044
                                   TO DP013-MESSAGE-TEXT (4)            16630059
                   MOVE SQLCA      TO DP013-SQLCA                       16640059
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          16650059
                   SET DP013-DB2-ABEND                                  16660044
                       DP013-ROLLBACK                                   16670059
                                   TO TRUE                              16671059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      16680044
                   SET  DP011-MSG-FATAL                                 16690059
                                   TO TRUE                              16691059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              16700044
                       MOVE PC-TSYMSG-01063                             16710059
                                   TO DP011-MSG-NUMBER                  16711059
                   ELSE                                                 16720044
                       MOVE PC-TSYMSG-01064                             16730059
                                   TO DP011-MSG-NUMBER                  16731059
                   END-IF                                               16740044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      16750044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   16760044
           END-EVALUATE.                                                16790044
      *                                                                 16800044
       7800-DELETE-DISCREPANCY.                                         16810044
           INITIALIZE DCLTTFDSCP.                                       16820044
                                                                        16830044
           EXEC SQL                                                     16840044
               DELETE FROM TTFDSCP                                      16850044
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          16860044
                  AND   RCV_XFER_BEG_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST 16870044
                  AND   RCVD_AT_STR_NBR    =  :TFDSCP-RCVD-AT-STR-NBR)  16880044
           END-EXEC.                                                    16890044
                                                                        16900044
           EVALUATE SQLCODE                                             16910053
               WHEN ZERO                                                16911053
                   CONTINUE                                             16912053
               WHEN +100                                                16920053
                   CONTINUE                                             16930044
               WHEN OTHER                                               16940053
                   MOVE '7800-DELETE-DISCREPANCY'                       16970044
                                   TO DP013-PARAGRAPH                   16980059
                   MOVE 'DELETE DISCREPANCY FOR XFER_DKEY_ID/RCV_XFER_RC16990044
      -                 'PT_TMST: '                                     17000059
                                   TO DP013-MESSAGE-TEXT (1)            17001059
                   MOVE DK-XFER-DKEY-ID                                 17010059
                                   TO PV-DISPLAY-XFER-DKEY-ID           17011059
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         17020044
                                   TO DP013-MESSAGE-TEXT (2)            17030059
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        17040044
                                   TO DP013-MESSAGE-TEXT (3)            17050059
                   MOVE SQLCA      TO DP013-SQLCA                       17060059
                   MOVE 'TTFDSCP'  TO DP013-DB2-TABLE-NAME (1)          17070059
                   SET DP013-DB2-ABEND                                  17080044
                       DP013-ROLLBACK                                   17090059
                                   TO TRUE                              17091059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      17100044
                   SET  DP011-MSG-FATAL                                 17110059
                                   TO TRUE                              17111059
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              17120044
                       MOVE PC-TSYMSG-01063                             17130059
                                   TO DP011-MSG-NUMBER                  17131059
                   ELSE                                                 17140044
                       MOVE PC-TSYMSG-01064                             17150059
                                   TO DP011-MSG-NUMBER                  17151059
                   END-IF                                               17160044
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      17170044
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   17180044
           END-EVALUATE.                                                17210044
                                                                        17220044
       7850-CHECK-REGN-PRC.                                             17230044
           PERFORM 7860-GET-UNT-RTL-AMT.                                17231052
      ******************************************************************17651064
      * RETRIEVE UNIT RETAIL AMOUNT                                     17652064
      ******************************************************************17653064
       7860-GET-UNT-RTL-AMT.                                            17654064
           INITIALIZE DCLXST00010.                                      17655064
           INITIALIZE DCLXST00008.                                      17655164
           EXEC SQL                                                     17656064
               SELECT  B.REGN_PRIC_IND                                  17657064
                     , C.LOC_SKU_STAT_CDE                               17657164
                     , C.UNT_RTL_AMT                                    17658064
                 INTO :XST00010-REGN-PRIC-IND                           17659264
                    , :XST00008-LOC-SKU-STAT-CDE                        17659364
                    , :XST00008-UNT-RTL-AMT                             17659464
                 FROM  XST_UPC        A                                 17659564
                    ,  XST_SKU        B                                 17659664
                    ,  XST_SKU_LOC    C                                 17659764
                WHERE  A.UPC_NBR       =  :TFITEM-KOHLS-UPC-NBR         17659864
                  AND  A.LAST_ACTN_CDE IN ('A', 'U')                    17659964
                  AND  B.INTR_UPC_ID   =  A.INTR_UPC_ID                 17660064
                  AND  C.INTR_UPC_ID   =  B.INTR_UPC_ID                 17660164
                  AND  C.LOC_NBR       =  :DK-LOC-NBR                   17660264
                  AND  C.BEG_TMST      <= CURRENT TIMESTAMP             17660364
                  AND  (C.END_TMST     >  CURRENT TIMESTAMP             17660464
                   OR  C.END_TMST      IS NULL)                         17660564
                 WITH  UR                                               17660653
           END-EXEC.                                                    17660764
                                                                        17660852
           EVALUATE SQLCODE                                             17660964
               WHEN ZERO                                                17661064
               WHEN +100                                                17661164
                   MOVE XST00008-UNT-RTL-AMT                            17661264
                                   TO PV-CUR-RTL-AMT                    17661364
               WHEN OTHER                                               17661664
                   MOVE '7860-GET-UNT-RTL-AMT'                          17661964
                                   TO DP013-PARAGRAPH                   17662064
                   MOVE 'SELECT DATA FROM XS DOMAIN'                    17662164
                                   TO DP013-MESSAGE-TEXT (1)            17662264
                   MOVE SQLCA      TO DP013-SQLCA                       17662364
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          17662464
                   MOVE 'XST_SKU'  TO DP013-DB2-TABLE-NAME (2)          17662664
                   MOVE 'XST_SKU_LOC'                                   17662764
                                   TO DP013-DB2-TABLE-NAME (3)          17662864
                   SET DP013-DB2-ABEND                                  17662964
                       DP013-ROLLBACK                                   17663064
                                   TO TRUE                              17663164
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      17663264
                   SET  DP011-MSG-FATAL                                 17663364
                                   TO TRUE                              17663464
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              17663564
                       MOVE PC-TSYMSG-01063                             17663664
                                   TO DP011-MSG-NUMBER                  17663764
                   ELSE                                                 17663864
                       MOVE PC-TSYMSG-01064                             17663964
                                   TO DP011-MSG-NUMBER                  17664064
                   END-IF                                               17664164
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      17664264
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   17664364
           END-EVALUATE.                                                17664464
      *                                                                 17665059
      *----------------------------------------------------------------*17670044
      *    GET THE PHYSICAL INVENTORY PERIOD INDICATOR FROM TTFCNTL    *17680044
      *----------------------------------------------------------------*17690044
051705*7900-READ-CONTROL-TABLE.                                         17700066
051705*    EXEC SQL                                                     17710066
051705*        SELECT PHY_INV_PERD_IND                                  17720066
051705*              ,XFER_INV_CTOFF_DTE                                17730066
051705*              ,MAX_FINCL_BK_DTE                                  17740066
051705*              ,MAX_PLND_INV_DTE                                  17750066
051705*         INTO :TFCNTL-PHY-INV-PERD-IND                           17760066
051705*             ,:TFCNTL-XFER-INV-CTOFF-DTE                         17770066
051705*             ,:TFCNTL-MAX-FINCL-BK-DTE                           17780066
051705*             ,:TFCNTL-MAX-PLND-INV-DTE                           17790066
051705*         FROM TTFCNTL                                            17800066
051705*         WITH UR                                                 17801066
051705*    END-EXEC.                                                    17810066
051705*                                                                 17820066
051705*    EVALUATE SQLCODE                                             17830066
051705*        WHEN ZERO                                                17831066
051705*            MOVE TFCNTL-PHY-INV-PERD-IND                         17832066
051705*                            TO PV-PHY-INV-PERD-IND               17833066
051705*            MOVE TFCNTL-XFER-INV-CTOFF-DTE                       17834066
051705*                            TO PV-XFER-INV-CTOFF-DTE             17835066
051705*            MOVE TFCNTL-MAX-FINCL-BK-DTE                         17836066
051705*                            TO PV-MAX-FINCL-BK-DTE               17837066
051705*            MOVE TFCNTL-MAX-PLND-INV-DTE                         17838066
051705*                            TO PV-MAX-PLND-INV-DTE               17839066
051705*        WHEN -904                                                17840066
051705*        WHEN -913                                                17850066
051705*            SET  DP011-MSG-FATAL                                 17860066
051705*                            TO TRUE                              17861066
051705*            MOVE PC-TSYMSG-01063                                 17870066
051705*                            TO DP011-MSG-NUMBER                  17871066
051705*            PERFORM 9000-FMT-ERR-MSG-TO-PTC                      17880066
051705*            PERFORM 8000-SEND-DATA-TO-LISTENER                   17890066
051705*        WHEN OTHER                                               17900066
051705*            MOVE '7900-READ-CONTROL-TABLE'                       17930066
051705*                            TO DP013-PARAGRAPH                   17940066
051705*            MOVE 'GET THE PHYSICAL INV. PERIOD INDICATOR'        17950066
051705*                            TO DP013-MESSAGE-TEXT (1)            17960066
051705*            MOVE SQLCA      TO DP013-SQLCA                       17970066
051705*            MOVE 'TTFCNTL'  TO DP013-DB2-TABLE-NAME (1)          17980066
051705*            SET DP013-DB2-ABEND                                  17990066
051705*                DP013-NO-ROLLBACK                                18000066
051705*                            TO TRUE                              18001066
051705*            PERFORM 9999-WRITE-CICS-LOG-MSG                      18010066
051705*            SET  DP011-MSG-FATAL                                 18020066
051705*                            TO TRUE                              18021066
051705*            MOVE PC-TSYMSG-01064                                 18030066
051705*                            TO DP011-MSG-NUMBER                  18031066
051705*            PERFORM 9000-FMT-ERR-MSG-TO-PTC                      18040066
051705*            PERFORM 8000-SEND-DATA-TO-LISTENER                   18050066
051705*    END-EVALUATE.                                                18150066
      *                                                                 18160044
051705*7910-SELECT-CURRENT-DATE.                                        18170067
                                                                        18180044
051705*    EXEC SQL                                                     18190067
051705*        SET  :PV-CURRENT-DATE       =  CURRENT DATE              18200067
051705*    END-EXEC.                                                    18210067
                                                                        18220044
051705*    EVALUATE SQLCODE                                             18230067
051705*        WHEN ZERO                                                18231067
051705*            CONTINUE                                             18232067
051705*        WHEN OTHER                                               18240067
051705*            MOVE '7910-SELECT-CURRENT-DATE'                      18270067
051705*                            TO DP013-PARAGRAPH                   18280067
051705*            MOVE 'SELECT THE CURRENT DATE'                       18290067
051705*                            TO DP013-MESSAGE-TEXT (1)            18300067
051705*            MOVE SQLCA      TO DP013-SQLCA                       18310067
051705*            SET DP013-DB2-ABEND                                  18320067
051705*                DP013-NO-ROLLBACK                                18330067
051705*                            TO TRUE                              18331067
051705*            PERFORM 9999-WRITE-CICS-LOG-MSG                      18340067
051705*            SET  DP011-MSG-FATAL                                 18350067
051705*                            TO TRUE                              18351067
051705*            MOVE PC-TSYMSG-01064                                 18360067
051705*                            TO DP011-MSG-NUMBER                  18361067
051705*            PERFORM 9000-FMT-ERR-MSG-TO-PTC                      18370067
051705*            PERFORM 8000-SEND-DATA-TO-LISTENER                   18380067
051705*    END-EVALUATE.                                                18410067
      *                                                                 18420044
      *----------------------------------------------------------------*18430044
      *    GET THE MAX PLANNED INVENTORY DATE FOR THIS STORE           *18440044
      *----------------------------------------------------------------*18450044
051705*7920-GET-PLND-INV-DTE.                                           18460066
051705*    EXEC SQL                                                     18470066
051705*        SELECT A.PLND_INV_DTE                                    18480066
051705*              ,A.ACTL_FIN_BK_DTE                                 18490066
051705*              ,A.SCHD_PHY_CNT_IND                                18500066
051705*         INTO :INVPAR-PLND-INV-DTE                               18510066
051705*             ,:INVPAR-ACTL-FIN-BK-DTE                            18520066
051705*             ,:INVPAR-SCHD-PHY-CNT-IND                           18530066
051705*         FROM TINVPAR A                                          18540066
051705*        WHERE  A.LOC_NBR      = :DK-STORE-NBR-9   AND            18551066
051705*               A.PLND_INV_DTE < :PC-MAX-DATE                     18560066
051705*          AND  A.PLND_INV_DTE =                                  18570066
051705*               (SELECT MAX(PLND_INV_DTE)                         18580066
051705*                 FROM TINVPAR B                                  18590066
051705*                WHERE  B.LOC_NBR         = :DK-STORE-NBR-9       18601066
051705*                  AND  B.ACTL_FIN_BK_DTE = :PC-MAX-DATE          18610066
051705*                  AND  PLND_INV_DTE      < :PC-MAX-DATE)         18620066
051705*         WITH  UR                                                18621066
051705*    END-EXEC.                                                    18630066
051705*                                                                 18640066
051705*    EVALUATE SQLCODE                                             18650066
051705*        WHEN ZERO                                                18651066
051705*            IF INVPAR-SCHD-PHY-CNT-IND = PC-YES                  18652066
051705*                SET PV-HOLD-PHYSICAL-COUNT                       18653066
051705*                            TO TRUE                              18653166
051705*            ELSE                                                 18654066
051705*                IF INVPAR-ACTL-FIN-BK-DTE = PC-MAX-DATE          18655066
051705*                    SET PV-HOLD-FAKE-INVENTORY                   18656066
051705*                            TO TRUE                              18656166
051705*                ELSE                                             18657066
051705*                    SET PV-HOLD-NO-INVENTORY                     18658066
051705*                            TO TRUE                              18658166
051705*                END-IF                                           18659066
051705*            END-IF                                               18659166
051705*        WHEN +100                                                18660066
051705*            MOVE PV-CURRENT-DATE                                 18670066
051705*                            TO INVPAR-PLND-INV-DTE               18671066
051705*            SET PV-HOLD-NO-INVENTORY                             18680066
051705*                            TO TRUE                              18681066
051705*        WHEN -904                                                18690066
051705*        WHEN -913                                                18700066
051705*            SET  DP011-MSG-FATAL                                 18710066
051705*                            TO TRUE                              18711066
051705*            MOVE PC-TSYMSG-01063                                 18720066
051705*                            TO DP011-MSG-NUMBER                  18721066
051705*            PERFORM 9000-FMT-ERR-MSG-TO-PTC                      18730066
051705*            PERFORM 8000-SEND-DATA-TO-LISTENER                   18740066
051705*        WHEN OTHER                                               18750066
051705*            MOVE '7920-GET-PLND-INV-DTE'                         18780066
051705*                            TO DP013-PARAGRAPH                   18790066
051705*            MOVE 'GET THE PLANNED INVENTORY DATE FOR STORE:'     18800066
051705*                            TO DP013-MESSAGE-TEXT (1)            18810066
051705*            MOVE DK-STORE-NBR-9                                  18820066
051705*                            TO DP013-MESSAGE-TEXT (2)            18821066
051705*            MOVE SQLCA      TO DP013-SQLCA                       18830066
051705*            MOVE 'TINVPAR'  TO DP013-DB2-TABLE-NAME (1)          18840066
051705*            SET DP013-DB2-ABEND                                  18850066
051705*                DP013-NO-ROLLBACK                                18860066
051705*                            TO TRUE                              18861066
051705*            PERFORM 9999-WRITE-CICS-LOG-MSG                      18870066
051705*            SET  DP011-MSG-FATAL                                 18880066
051705*                            TO TRUE                              18881066
051705*            MOVE PC-TSYMSG-01064                                 18890066
051705*                            TO DP011-MSG-NUMBER                  18891066
051705*            PERFORM 9000-FMT-ERR-MSG-TO-PTC                      18900066
051705*            PERFORM 8000-SEND-DATA-TO-LISTENER                   18910066
051705*    END-EVALUATE.                                                19020066
      ******************************************************************19030044
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  19040044
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           19050044
      ******************************************************************19060044
       8000-SEND-DATA-TO-LISTENER.                                      19070044
           IF TF025-MQ-INDICATOR-Y                                      19080040
               PERFORM 8500-MQ-SETUP                                    19090044
               PERFORM 8510-MQ-SETUP-REMOTE                             19100044
               PERFORM 8520-PUT-QUEUE                                   19110044
               PERFORM 8600-CLOSE-PUT-Q                                 19120044
               PERFORM 8610-DISCONNECT-QMGR                             19130044
               PERFORM 9100-EXEC-CICS-RETURN                            19140044
           ELSE                                                         19150040
               PERFORM 8110-ENQ-TCPIPPRQ                                19160044
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      19170044
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      19180044
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   19210044
               ADD 1               TO PV-NEXT-RECORD                    19230059
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     19250044
                   MOVE 3          TO PV-NEXT-RECORD                    19260059
               END-IF                                                   19270044
                                                                        19280044
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    19290044
               PERFORM 8160-DEQ-TCPIPPRQ                                19300044
                                                                        19310044
               PERFORM 9100-EXEC-CICS-RETURN                            19320044
           END-IF.                                                      19330040
      *                                                                 19340044
      ******************************************************************19350044
       8110-ENQ-TCPIPPRQ.                                               19360044
           EXEC CICS                                                    19370044
               ENQ                                                      19380044
                   RESOURCE  (PV-TSQ-NAME)                              19390044
                   RESP      (PV-CICS-RESPONSE)                         19400044
           END-EXEC.                                                    19410044
                                                                        19420044
           EVALUATE TRUE                                                19430044
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 19440044
                   CONTINUE                                             19450044
               WHEN OTHER                                               19460044
                   MOVE '8110-ENQ-TCPIPPRQ'                             19470059
                                   TO DP013-PARAGRAPH                   19471059
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q19480044
      -                 'UEUE: '                                        19490044
                                   TO DP013-MESSAGE-TEXT (1)            19500059
                   MOVE PV-TSQ-NAME                                     19510059
                                   TO DP013-MESSAGE-TEXT (2)            19511059
                   SET DP013-CICS-ABEND                                 19520044
                       DP013-NO-ROLLBACK                                19530059
                                   TO TRUE                              19531059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      19540044
                   PERFORM 9100-EXEC-CICS-RETURN                        19550044
           END-EVALUATE.                                                19560044
      *                                                                 19570044
      ******************************************************************19580044
       8120-READQ-TCPIPPRQ-RECORD1.                                     19590044
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           19600059
                                   TO PV-TSQ-LENGTH.                    19601059
                                                                        19610044
           EXEC CICS                                                    19620044
               READQ TS                                                 19630044
                   QUEUE   (PV-TSQ-NAME)                                19640044
                   INTO    (PV-TCPIPPRQ-RECORD1)                        19650044
                   LENGTH  (PV-TSQ-LENGTH)                              19660044
                   ITEM    (1)                                          19670044
                   RESP    (PV-CICS-RESPONSE)                           19680044
           END-EXEC.                                                    19690044
                                                                        19700044
           EVALUATE TRUE                                                19710044
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 19720044
                   CONTINUE                                             19730044
               WHEN OTHER                                               19740044
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   19750044
                                   TO DP013-PARAGRAPH                   19760059
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 19770044
      -                 'QUEUE: '                                       19780044
                                   TO DP013-MESSAGE-TEXT (1)            19790059
                   MOVE PV-TSQ-NAME                                     19800059
                                   TO DP013-MESSAGE-TEXT (2)            19801059
                   SET DP013-CICS-ABEND                                 19810044
                       DP013-NO-ROLLBACK                                19820059
                                   TO TRUE                              19821059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      19830044
                   PERFORM 9100-EXEC-CICS-RETURN                        19840044
           END-EVALUATE.                                                19850044
      *                                                                 19860044
      ******************************************************************19870044
       8130-READQ-TCPIPPRQ-RECORD2.                                     19880044
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           19890059
                                   TO PV-TSQ-LENGTH.                    19891059
                                                                        19900044
           EXEC CICS                                                    19910044
               READQ TS                                                 19920044
                   QUEUE   (PV-TSQ-NAME)                                19930044
                   INTO    (PV-TCPIPPRQ-RECORD2)                        19940044
                   LENGTH  (PV-TSQ-LENGTH)                              19950044
                   ITEM    (2)                                          19960044
                   RESP    (PV-CICS-RESPONSE)                           19970044
           END-EXEC.                                                    19980044
                                                                        19990044
           EVALUATE TRUE                                                20000044
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 20010044
                   CONTINUE                                             20020044
               WHEN OTHER                                               20030044
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   20040044
                                   TO DP013-PARAGRAPH                   20050059
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 20060044
      -                 'QUEUE: '                                       20070044
                                   TO DP013-MESSAGE-TEXT (1)            20080059
                   MOVE PV-TSQ-NAME                                     20090059
                                   TO DP013-MESSAGE-TEXT (2)            20091059
                   SET DP013-CICS-ABEND                                 20100044
                       DP013-NO-ROLLBACK                                20110059
                                   TO TRUE                              20111059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      20120044
                   PERFORM 9100-EXEC-CICS-RETURN                        20130044
           END-EVALUATE.                                                20140044
      *                                                                 20150044
      ******************************************************************20160044
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  20170044
           MOVE LENGTH OF TF026-XFER-TO-PTC-RECORD                      20180044
                                   TO  TF026-TOT-REC-LENGTH.            20190059
                                                                        20200044
           MOVE TF025-MATCHING-NBR-FIELD                                20210059
                                   TO  TF026-MATCHING-NBR-FIELD.        20211059
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     20220059
                                                                        20230044
           EXEC CICS                                                    20240044
               WRITEQ TS                                                20250044
                   QUEUE   (PV-TSQ-NAME)                                20260044
                   FROM    (TF026-XFER-TO-PTC-RECORD)                   20270044
                   LENGTH  (PV-TSQ-LENGTH)                              20280044
                   ITEM    (PV-ITEM-NBR)                                20290044
                       REWRITE                                          20300044
                   RESP    (PV-CICS-RESPONSE)                           20310044
           END-EXEC.                                                    20320044
                                                                        20330044
           EVALUATE TRUE                                                20340044
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 20350044
                   CONTINUE                                             20360044
               WHEN OTHER                                               20370044
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                20380044
                                   TO DP013-PARAGRAPH                   20390059
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA20400044
      -                 'STORAGE QUEUE: '                               20410044
                                   TO DP013-MESSAGE-TEXT (1)            20420059
                   MOVE PV-TSQ-NAME                                     20430059
                                   TO DP013-MESSAGE-TEXT (2)            20431059
                   SET DP013-CICS-ABEND                                 20440044
                       DP013-NO-ROLLBACK                                20450059
                                   TO TRUE                              20451059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      20460044
                   PERFORM 9100-EXEC-CICS-RETURN                        20470044
           END-EVALUATE.                                                20480044
      *                                                                 20490044
      ******************************************************************20500044
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   20510044
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           20520059
                                   TO PV-TSQ-LENGTH.                    20521059
           MOVE +1                 TO PV-ITEM-NBR.                      20530059
                                                                        20540044
           EXEC CICS                                                    20550044
               WRITEQ TS                                                20560044
                   QUEUE   (PV-TSQ-NAME)                                20570044
                   FROM    (PV-TCPIPPRQ-RECORD1)                        20580044
                   LENGTH  (PV-TSQ-LENGTH)                              20590044
                   ITEM    (PV-ITEM-NBR)                                20600044
                       REWRITE                                          20610044
                   RESP    (PV-CICS-RESPONSE)                           20620044
           END-EXEC.                                                    20630044
                                                                        20640044
           EVALUATE TRUE                                                20650044
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 20660044
                   CONTINUE                                             20670044
               WHEN OTHER                                               20680044
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 20690044
                                   TO DP013-PARAGRAPH                   20700059
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   20710044
                                   TO DP013-MESSAGE-TEXT (1)            20720059
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     20730044
                                   TO DP013-MESSAGE-TEXT (2)            20740059
                   MOVE PV-TSQ-NAME                                     20750059
                                   TO DP013-MESSAGE-TEXT (3)            20751059
                   MOVE PV-TCPIPPRQ-RECORD1                             20760059
                                   TO DP013-MESSAGE-TEXT (4)            20761059
                   SET DP013-CICS-ABEND                                 20770044
                       DP013-NO-ROLLBACK                                20780059
                                   TO TRUE                              20781059
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      20790044
                   PERFORM 9100-EXEC-CICS-RETURN                        20800044
           END-EVALUATE.                                                20810044
      *                                                                 20820044
      ******************************************************************20830044
       8160-DEQ-TCPIPPRQ.                                               20840044
           EXEC CICS                                                    20850044
               DEQ                                                      20860044
                   RESOURCE  (PV-TSQ-NAME)                              20870044
                   RESP      (PV-CICS-RESPONSE)                         20880044
           END-EXEC.                                                    20890044
                                                                        20900044
           EVALUATE TRUE                                                20910044
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 20920044
                   CONTINUE                                             20930044
               WHEN OTHER                                               20940044
                   MOVE '8160-DEQ-TCPIPPRQ'                             20950059
                                   TO DP013-PARAGRAPH                   20951059
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q20960044
      -                 'UEUE: '                                        20970044
                                   TO DP013-MESSAGE-TEXT (1)            20980059
                   MOVE PV-TSQ-NAME                                     20990059
                                   TO DP013-MESSAGE-TEXT (2)            20991059
                   SET DP013-CICS-ABEND                                 21000044
                       DP013-NO-ROLLBACK                                21010059
                                   TO TRUE                              21011059
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        21020044
                 PERFORM 9100-EXEC-CICS-RETURN                          21030044
           END-EVALUATE.                                                21040044
                                                                        21050040
       8500-MQ-SETUP.                                                   21060040
                                                                        21070042
      * DETERMINE THE SYSTEM                                            21080044
                                                                        21090044
           PERFORM EP000-0000-INITIALIZE.                               21100044
           IF EP000-PV-KOHLS-PROD-SYSTEM                                21110044
               SET PV-PROD-QMGR-NAME                                    21120059
                                   TO TRUE                              21121059
           ELSE                                                         21130044
                IF EP000-PV-KOHLS-QA-SYSTEM                             21140044
                    SET PV-QA-QMGR-NAME                                 21150059
                                   TO TRUE                              21151059
                ELSE                                                    21160044
                    SET PV-TEST-QMGR-NAME                               21170044
                                   TO TRUE                              21180059
                END-IF                                                  21190044
           END-IF.                                                      21200044
                                                                        21210044
      ***************************************************************   21220040
      *    CONNECT TO THE QUEUE MANAGER                                 21230044
      ***************************************************************   21240040
                                                                        21250044
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       21260059
           CALL WS-MQCONN USING PV-QM-NAME                              21270044
                                PV-HCONN                                21280044
                                PV-COMPLETION-CODE                      21290044
                                PV-REASON.                              21300044
                                                                        21310044
      ***************************************************************   21320040
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              21330044
      *    AND EXIT                                                     21340044
      ***************************************************************   21350040
                                                                        21360044
           MOVE PV-REASON          TO PV-CON-REASON.                    21370059
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   21380044
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  21390059
               MOVE '8500-MQ-SETUP'                                     21400059
                                   TO DP013-PARAGRAPH                   21401059
               MOVE  PV-ERROR-MESSAGE                                   21410059
                                   TO DP013-MESSAGE-TEXT (1)            21411059
               MOVE  PV-COMPLETION-CODE                                 21420059
                                   TO DP013-MESSAGE-TEXT (2)            21421059
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            21430059
               SET DP013-CICS-ABEND                                     21440044
                   DP013-NO-ROLLBACK                                    21450059
                                   TO TRUE                              21451059
               PERFORM 9999-WRITE-CICS-LOG-MSG                          21460044
               PERFORM 9100-EXEC-CICS-RETURN                            21470044
           END-IF.                                                      21480044
                                                                        21490044
                                                                        21500040
       8510-MQ-SETUP-REMOTE.                                            21510040
      ***************************************************************   21520040
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     21530044
      *    THIS IS A REMOTE QUEUE.                                      21540044
      ***************************************************************   21550040
                                                                        21560044
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      21570044
                                     MQOO-FAIL-IF-QUIESCING.            21580044
                                                                        21590044
           MOVE TF025-REPLYTOQ     TO MQOD-OBJECTNAME.                  21600059
           MOVE TF025-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              21610059
                                                                        21620040
           CALL WS-MQOPEN USING PV-HCONN                                21630044
                                MQM-OBJECT-DESCRIPTOR                   21640044
                                PV-OPEN-OPTIONS                         21650044
                                PV-PQ-HANDLE                            21660044
                                PV-COMPLETION-CODE                      21670044
                                PV-REASON.                              21680044
                                                                        21690044
      ********************************************************          21700040
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    21710044
      *    AND EXIT.                                                    21720044
      ********************************************************          21730040
      *                                                                 21740044
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   21750044
               PERFORM 8600-CLOSE-PUT-Q                                 21760044
               PERFORM 8610-DISCONNECT-QMGR                             21770044
               MOVE 'MQOPEN WRITE Q'                                    21780059
                                   TO PV-ERROR-MESSAGE                  21781059
               MOVE '8510-MQ-SETUP-REMOTE'                              21790059
                                   TO DP013-PARAGRAPH                   21791059
               MOVE  PV-ERROR-MESSAGE                                   21800059
                                   TO DP013-MESSAGE-TEXT (1)            21801059
               MOVE  PV-COMPLETION-CODE                                 21810059
                                   TO DP013-MESSAGE-TEXT (2)            21811059
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            21820059
               SET DP013-CICS-ABEND                                     21830044
                   DP013-NO-ROLLBACK                                    21840059
                                   TO TRUE                              21841059
               PERFORM 9999-WRITE-CICS-LOG-MSG                          21850044
               PERFORM 9100-EXEC-CICS-RETURN                            21860044
           END-IF.                                                      21870044
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          21880059
      *                                                                 21890044
      ******************************************************************21900044
       8520-PUT-QUEUE.                                                  21910044
           MOVE TF025-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              21920059
           MOVE TF025-REPLYTOQ     TO MQOD-OBJECTNAME.                  21930059
           MOVE TF025-MSGID        TO MQMD-CORRELID.                    21940059
           MOVE MQMI-NONE          TO MQMD-MSGID.                       21950059
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      21960059
           MOVE 5000               TO MQMD-EXPIRY.                      21970059
           MOVE LENGTH OF TF026-XFER-TO-PTC-RECORD                      21980044
                                   TO PV-DATA-LENGTH.                   21990059
           MOVE TF026-XFER-TO-PTC-RECORD                                22000059
                                   TO PV-MSGBUFFER.                     22001059
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 22010059
                                                                        22020044
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      22030044
                                                                        22040040
                                                                        22050040
                                                                        22060044
           CALL WS-MQPUT USING PV-HCONN                                 22070044
                               PV-FMT-OPEN-OUTPUT-HNDL                  22080044
                               MQM-MESSAGE-DESCRIPTOR                   22090044
                               MQM-PUT-MESSAGE-OPTIONS                  22100044
                               PV-DATA-LENGTH                           22110044
                               PV-MSGBUFFER                             22120044
                               PV-COMPLETION-CODE                       22130044
                               PV-REASON.                               22140044
                                                                        22150044
      ***********************************************************       22160040
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 22170044
      *        AND BREAK OUT OF LOOP                                    22180044
      ***********************************************************       22190040
                                                                        22200044
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   22210044
                  MOVE PV-COMPLETION-CODE                               22220059
                                   TO PH-COMPLETION-CODE                22221059
                  MOVE PV-REASON   TO PH-REASON                         22230059
                  PERFORM 8600-CLOSE-PUT-Q                              22240044
                  PERFORM 8610-DISCONNECT-QMGR                          22250044
                  MOVE 'MQPUT ERR' TO PV-ERROR-MESSAGE                  22260059
                  MOVE '8520-PUT-QUEUE'                                 22270059
                                   TO DP013-PARAGRAPH                   22271059
                  MOVE PV-ERROR-MESSAGE                                 22280059
                                   TO DP013-MESSAGE-TEXT (1)            22281059
                  MOVE PH-COMPLETION-CODE                               22290059
                                   TO DP013-MESSAGE-TEXT (2)            22300059
                  MOVE PH-REASON   TO DP013-MESSAGE-TEXT (3)            22301059
                  SET DP013-CICS-ABEND                                  22310044
                      DP013-NO-ROLLBACK                                 22320059
                                   TO TRUE                              22321059
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       22330044
                  PERFORM 9100-EXEC-CICS-RETURN                         22340044
           ELSE                                                         22350044
              SET PS-MQPUT-SUCCESSFUL                                   22360059
                                   TO TRUE                              22361059
           END-IF.                                                      22370044
      *                                                                 22380044
      ******************************************************************22390044
       8600-CLOSE-PUT-Q.                                                22400044
           CALL WS-MQCLOSE USING PV-HCONN                               22410044
                                 PV-PQ-HANDLE                           22420044
                                 MQCO-NONE                              22430044
                                 PV-COMPLETION-CODE                     22440044
                                 PV-REASON.                             22450044
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   22460044
               MOVE 'MQCLOSE PQ HANDLE'                                 22470059
                                   TO PV-ERROR-MESSAGE                  22471059
               MOVE '8600-CLOSE-PUT-Q'                                  22480059
                                   TO DP013-PARAGRAPH                   22481059
               MOVE  PV-ERROR-MESSAGE                                   22490058
                                   TO DP013-MESSAGE-TEXT (1)            22491058
               MOVE  PV-COMPLETION-CODE                                 22500058
                                   TO DP013-MESSAGE-TEXT (2)            22501058
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            22510058
               SET DP013-CICS-ABEND                                     22520044
                   DP013-NO-ROLLBACK                                    22530058
                                   TO TRUE                              22531058
               PERFORM 9999-WRITE-CICS-LOG-MSG                          22540044
               PERFORM 9100-EXEC-CICS-RETURN                            22550044
           END-IF.                                                      22560044
      *                                                                 22570044
      ******************************************************************22580044
       8610-DISCONNECT-QMGR.                                            22590044
                                                                        22600044
           IF PV-CON-REASON IS NOT EQUAL                                22610059
                                   TO MQRC-ALREADY-CONNECTED            22611059
              CALL WS-MQDISC USING PV-HCONN                             22620044
                                   PV-COMPLETION-CODE                   22630044
                                   PV-REASON                            22640044
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                22650044
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  22660058
                  MOVE '8610-DISCONNECT'                                22670058
                                   TO DP013-PARAGRAPH                   22671058
                  MOVE PV-ERROR-MESSAGE                                 22680058
                                   TO DP013-MESSAGE-TEXT (1)            22681058
                  MOVE PV-COMPLETION-CODE                               22690058
                                   TO DP013-MESSAGE-TEXT (2)            22691058
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            22700058
                  SET DP013-CICS-ABEND                                  22710044
                      DP013-NO-ROLLBACK                                 22720058
                                   TO TRUE                              22721058
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       22730044
                  PERFORM 9100-EXEC-CICS-RETURN                         22740044
              END-IF                                                    22750044
           END-IF.                                                      22760044
                                                                        22770044
      *                                                                 22780044
      ******************************************************************22790044
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          22800044
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   22810044
      *    STREAM BEING SENT BACK TO THE PTC.                           22820044
      ******************************************************************22830044
       9000-FMT-ERR-MSG-TO-PTC.                                         22840044
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         22850044
           MOVE DP011-MSG-LEVEL    TO  TF026-ERR-TYP-IND.               22860058
           MOVE DP011-MSG-TEXT     TO  TF026-ERR-MSG.                   22870058
      *                                                                 22880044
       9100-EXEC-CICS-RETURN.                                           22890044
           EXEC CICS                                                    22900044
               RETURN                                                   22910044
           END-EXEC.                                                    22920044
      *                                                                 22930044
       9999-WRITE-CICS-LOG-MSG.                                         22940044
           MOVE PC-CURRENT-PROGRAM-NAME                                 22950058
                                   TO  DP013-PROGRAM.                   22960058
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  22961058
                                                                        22970044
           INITIALIZE DP013-SRC-TASK-NUMBER                             22980044
                      DP013-STACK.                                      22990044
                                                                        23000044
           SET DP013-LINK-RETURN   TO  TRUE.                            23010058
                                                                        23020044
           EXEC CICS                                                    23030044
               LINK                                                     23040044
                   PROGRAM   (DP013-NAME)                               23050044
                   COMMAREA  (DP013-PARAMETERS)                         23060044
                   LENGTH    (DP013-LENGTH)                             23070044
           END-EXEC.                                                    23080044
                                                                        23090044
      *                                                                 23100044
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           23110044
      *                                                                 23120044
                                                                        23130044
           COPY DPPD011.                                                23140044
      *                                                                 23150044
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     23160044
      *                                                                 23170044
                                                                        23180044
           COPY DPPD014.                                                23190044
                                                                        23200042
           COPY EPPD000.                                                23210044
