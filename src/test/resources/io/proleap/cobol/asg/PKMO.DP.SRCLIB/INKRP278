       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.         INKRP278.                                            
       INSTALLATION.       KOHLS DEPARTMENT STORES.                             
       DATE-WRITTEN.       08/31/2004.                                          
       DATE-COMPILED.                                                           
      *                                                                         
      ******************************************************************        
      *     INKRP278 - PHYSICAL INVENTORY TOP EXCEPTION REPORT.                 
      *                (BY UNIT COUNT...)                                       
      *                                                                         
      *     (CHANGES MADE TO THIS PROGRAM MAY NEED TO BE MADE TO                
      *      INKRP279, INKRP280, INKRP281, INKRP285)                            
      *                                                                         
      *CHANGE HISTORY:                                                          
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                             
      * -------  ----------  ----------------------------------------           
W26600* W26600  07-29-2004 INVENTORY STORE EXPANSION CHANGES. ALSO              
W26600*                    MODIFY PROGRAM FOR EXCEPTION REPORTING               
W26600*                    RE-WRITE. REMOVE STORE-INV-FILE (INRD024).           
W26600*                    WR26600   SCOTT JACKSON                              
W27710* W27710  01-19-2005 ON A STORE BREAK, THE FIRST EXCEPTION IS             
W27710*                    BEING WRITTEN TWICE                                  
W27710*                    WR27710   SCOTT JACKSON                              
W28545* W28545  08-10-2006 FIX PAGE BREAK AT END OF STORE                       
W28545*                    REMOVE TINVPAR, NOT REFERENCED                       
W28545*                    WR28545   B. GRAHAM - STRATAGEM                      
W34557* W34557  09-13-2011 EXCLUDE THE RECORDS WITH CALCULATED                  
W34557*                    ONHAND QUANTITY LESS THEN ZERO                       
W34557*                    WR34557   RAVIKUMAR GUNTHA                           
SR3403* SR3403  04-10-2012 LARGE RETAIL PROJECT                                 
SR3403*                    -ANUJ GUPTA                                          
      ******************************************************************        
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *                                                                         
           SELECT STORE-CONTROL-FILE                                            
               ASSIGN TO INP01.                                                 
      *                                                                         
           SELECT STORE-MERGE-FILE                                              
               ASSIGN TO INP02.                                                 
      *                                                                         
           SELECT EXCEPT-CONTROL-FILE                                           
               ASSIGN TO INP03.                                                 
      *                                                                         
           SELECT STORE-INV-EXCEPTION-RPT                                       
               ASSIGN TO RPT01.                                                 
      *                                                                         
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *                                                                         
       FD  STORE-CONTROL-FILE                                                   
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  STORE-CONTROL-RECORD.                                                
           05  FILLER                  PIC X(05).                               
           05  SCR-STORE-NMBR          PIC 9(04).                               
           05  SCR-REST-OF-RECORD      PIC X(71).                               
      *                                                                         
       FD  STORE-MERGE-FILE                                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  STORE-MERGE-RECORD          PIC X(100).                              
      *                                                                         
       FD  EXCEPT-CONTROL-FILE                                                  
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  EXCEPT-CONTROL-RECORD.                                               
           05  ECR-EXCEPT-CONTROL      PIC 9(05).                               
           05  ECR-REST-OF-RECORD      PIC X(75).                               
      *                                                                         
       FD  STORE-INV-EXCEPTION-RPT                                              
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 132 CHARACTERS                                       
           RECORDING  MODE IS F                                                 
           DATA RECORD IS REPORT-LINE.                                          
       01  REPORT-LINE         PIC X(132).                                      
      *                                                                         
      /*****************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      *                                                                         
       01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.        
      *                                                                         
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-SUB                  PIC S9(4)    VALUE +0  COMP.             
           05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.               
           05  PV-DB2-OPER-ATTEMPTED   PIC X(30)    VALUE SPACES.               
W26600     05  PV-STORE-NUM            PIC 9(04)    VALUE ZERO.                 
W26600     05  PV-AREA-NUMBER          PIC 9(06)    VALUE ZERO.                 
      *    05  PV-ITEM-NMBR            PIC S9(15)V  VALUE +0  COMP-3.           
      *    05  PV-NUMERIC-STORE        PIC S9(9)    VALUE +0.                   
      *    05  PV-PHY-INV-OH-VAR       PIC S9(09) COMP VALUE ZERO.              
           05  PV-DEFAULT-CURRENT-DATE.                                         
               10  PV-DF-CC            PIC XX       VALUE '20'.                 
               10  PV-DF-YY            PIC XX.                                  
               10  FILLER              PIC X        VALUE '-'.                  
               10  PV-DF-MM            PIC XX.                                  
               10  FILLER              PIC X        VALUE '-'.                  
               10  PV-DF-DD            PIC XX.                                  
           05  PV-CURRENT-DATE.                                                 
               10  PV-CD-YY            PIC XX.                                  
               10  PV-CD-MM            PIC XX.                                  
               10  PV-CD-DD            PIC XX.                                  
           05  PV-TOTAL-INV-QTY        PIC S9(5)    COMP-3 VALUE 0.             
           05  PV-TOTAL-FS-QTY         PIC S9(5)    COMP-3 VALUE 0.             
W34557     05  PV-TOTAL-OH-QTY         PIC S9(5)    COMP-3 VALUE 0.             
           05  PV-VARIANCE-QTY         PIC S9(5)    COMP-3 VALUE 0.             
           05  PV-TOTAL-EXT-PRICE      PIC S9(13)V99 COMP-3 VALUE 0.            
           05  PV-STORE-EXCEPT-COUNT   PIC 9(05)    VALUE ZEROS.                
           05  PV-PAGE-COUNT           PIC S9(05) COMP-3 VALUE 0.               
           05  PV-LINE-COUNT           PIC S9(05) COMP-3 VALUE 0.               
           05  PV-ADVANCE-LINE         PIC S9(04) COMP   VALUE +1.              
           05  PV-DTL-LINE-PRT-ACCUM   PIC S9(13) COMP-3 VALUE 0.               
           05  PV-CURRENT-TIME.                                                 
               10  PV-CT-HH            PIC XX.                                  
               10  PV-CT-MM            PIC XX.                                  
           05  PV-LOW-RANGE            PIC S9(09) COMP-3 VALUE 0.               
           05  PV-HIGH-RANGE           PIC S9(09) COMP-3 VALUE 0.               
           05  PV-STORE-REC-COUNT      PIC S9(09) COMP-3 VALUE 0.               
      *    05  PV-STORE-COUNT          PIC S9(09) COMP-3 VALUE 0.               
           05  PV-EDIT-SKU             PIC 9(08) VALUE ZEROES.                  
           05  PV-SAVE-UPC             PIC S9(15)V COMP-3 VALUE ZEROES.         
           05  PV-SAVE-AREA            PIC S9(9) COMP VALUE ZEROES.             
           05  PV-SAVE-QTY             PIC S9(9) COMP VALUE ZEROES.             
 ES   **** 05  PV-EDIT-SKU             PIC 9(08) VALUE ZEROES.                  
      *                                                                         
       01  SA-SAVE-AREA.                                                        
           05  SA-STORE-NUMBER         PIC  9(04)    VALUE ZEROES.              
           05  SA-SAVE-STORE-NUMBER    PIC  9(04)    VALUE ZEROES.              
           05  SA-SKU                  PIC  9(08)    VALUE ZEROES.              
           05  SA-AREA-NUMBER          PIC  9(08)    VALUE ZEROES.              
           05  SA-SUMINV-LOC           PIC S9(04)    COMP.                      
           05  SA-SUMINV-SKU           PIC S9(08)V   COMP-3.                    
           05  SA-SUMINV-AREA-NBR      PIC S9(09)    COMP.                      
           05  SA-SKU-ATTRIBUTES.                                               
               10  SA-DEPT-CLASS.                                               
                   15  SA-DEPT         PIC 9(04)    VALUE ZEROES.               
                   15  SA-CLASS        PIC 9(04)    VALUE ZEROES.               
               10  SA-SUB-CLASS        PIC 9(04)    VALUE ZEROES.               
           05  SA-STORE-FOR-HEADER     PIC 9(04)    VALUE ZEROES.               
           05  SA-SKU-SAVE             PIC X(08)    VALUE SPACES.               
           05  SA-SKU-DESCRIP-SAVE     PIC X(25)    VALUE SPACES.               
      *                                                                         
       01  PS-PROGRAM-SWITCHES.                                                 
28545      05  PS-STORE-CONTROL-AT-END-SW  PIC X(01) VALUE 'N'.                 
28545          88  PS-STORE-CONTROL-AT-END-NO        VALUE 'N'.                 
28545          88  PS-STORE-CONTROL-AT-END-YES       VALUE 'Y'.                 
28545      05  PS-FOUND-STORE-MATCH-SW     PIC X(01) VALUE 'N'.                 
28545          88  PS-FOUND-STORE-MATCH-NO           VALUE 'N'.                 
28545          88  PS-FOUND-STORE-MATCH-YES          VALUE 'Y'.                 
28545      05  PS-PRINT-DEPT-SW            PIC X(01) VALUE 'N'.                 
28545          88  PS-PRINT-DEPT-NO                  VALUE 'N'.                 
28545          88  PS-PRINT-DEPT-YES                 VALUE 'Y'.                 
           05  PS-END-OF-INPUT-SW          PIC X(01) VALUE 'N'.                 
               88  PS-END-OF-INPUT                   VALUE 'Y'.                 
               88  PS-NOT-END-OF-INPUT               VALUE 'N'.                 
      *    05  PS-INP02-DONE-SW            PIC X(01) VALUE 'N'.                 
      *        88  ABSOLUTE-DIFF-END                 VALUE 'Y'.                 
           05  END-OF-CURSOR-SW            PIC X(01) VALUE 'N'.                 
               88  END-OF-CURSOR                     VALUE 'Y'.                 
           05  PS-CLEARANCE-STAT-SW        PIC X(01) VALUE 'N'.                 
           05  PS-TSUMINV-DONE-SW          PIC X(01) VALUE 'N'.                 
               88  NO-MORE-TSUMINV-UPCS              VALUE 'Y'.                 
           05  PS-TINENTY-DONE-SW          PIC X(01) VALUE 'N'.                 
               88  NO-MORE-TINENTY-UPCS              VALUE 'Y'.                 
      *                                                                         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PRINT-LINE-MAX           PIC S9(04)      VALUE +57            
                               COMP.                                            
           05  PC-PROGRAM-NAME         PIC X(08)    VALUE 'INKRP278'.           
           05  PC-OPERCO-NBR           PIC X(02)    VALUE '03'.                 
W34557*                                                                         
W34557 01  PA-PROGRAM-COUNTS.                                                   
W34557     05  PA-NEG-OHQTY-REC        PIC S9(09)   VALUE 0 COMP-3.             
      *                                                                         
       01  RP-REPORT-WORK-RECORD           PIC X(132)      VALUE SPACES.        
      *                                                                         
       01  HL1-HEADING-LINE-1.                                                  
           05  FILLER                  PIC X(35) VALUE SPACES.                  
           05  FILLER                  PIC X(23) VALUE                          
               'PHYSICAL INVENTORY TOP '.                                       
           05  HL1-EXCEPT-CONTROL      PIC Z,ZZZ9.                              
           05  FILLER                  PIC X(34) VALUE                          
               ' EXCEPTION DETAIL REPORT BY UNITS'.                             
                                                                                
       01  HL2-HEADING-LINE-2.                                                  
           05  FILLER                  PIC X(08) VALUE ' STORE: '.              
           05  HL2-STORE-NUMBER        PIC X(04) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE ' - '.                   
           05  HL2-STORE-DESCRIPTION   PIC X(45) VALUE SPACES.                  
                                                                                
       01  HL3-HEADING-LINE-3.                                                  
           05  FILLER                      PIC X(08) VALUE SPACES.              
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(25) VALUE SPACES.              
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(15) VALUE SPACES.              
           05  FILLER                      PIC X(01) VALUE SPACES.              
           05  FILLER                      PIC X(06) VALUE SPACES.              
           05  FILLER                      PIC X(03) VALUE SPACES.              
SR3403     05  FILLER                      PIC X(19) VALUE                      
               '****INVENTORIED***'.                                            
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
SR3403     05  FILLER                      PIC X(19) VALUE                      
               '**    CUTOFF    **'.                                            
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
           05  FILLER                      PIC X(09) VALUE SPACES.              
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(13) VALUE                      
               '   EXTENDED  '.                                                 
      *                                                                         
       01  HL4-HEADING-LINE-4.                                                  
           05  FILLER                      PIC X(08) VALUE '   SKU  '.          
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(25) VALUE                      
               ' DESCRIPTION             '.                                     
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(15) VALUE '      UPC '.        
           05  FILLER                      PIC X(01) VALUE SPACES.              
           05  FILLER                      PIC X(06) VALUE '  AREA'.            
           05  FILLER                      PIC X(03) VALUE SPACES.              
           05  FILLER                      PIC X(09) VALUE '     QTY '.         
SR3403     05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(08) VALUE '  PRICE '.          
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
           05  FILLER                      PIC X(09) VALUE '  ONHAND '.         
SR3403     05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(08) VALUE '  PRICE '.          
SR3403     05  FILLER                      PIC X(04) VALUE SPACES.              
           05  FILLER                      PIC X(09) VALUE 'VARIANCE '.         
SR3403     05  FILLER                      PIC X(01) VALUE SPACES.              
           05  FILLER                      PIC X(13) VALUE                      
               '   VAR PRICE '.                                                 
                                                                                
       01  HL5-HEADING-LINE-5.                                                  
           05  FILLER                      PIC X(08) VALUE ALL '-'.             
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(25) VALUE ALL '-'.             
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(15) VALUE ALL '-'.             
           05  FILLER                      PIC X(01) VALUE SPACES.              
           05  FILLER                      PIC X(06) VALUE ALL '-'.             
           05  FILLER                      PIC X(03) VALUE SPACES.              
           05  FILLER                      PIC X(09) VALUE ALL '-'.             
SR3403     05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(08) VALUE ALL '-'.             
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
SR3403     05  FILLER                      PIC X(08) VALUE ALL '-'.             
SR3403     05  FILLER                      PIC X(02) VALUE SPACES.              
SR3403     05  FILLER                      PIC X(10) VALUE ALL '-'.             
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
SR3403     05  FILLER                      PIC X(08) VALUE ALL '-'.             
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  FILLER                      PIC X(13) VALUE ALL '-'.             
                                                                                
       01  HL6-HEADING-LINE-6.                                                  
           05  FILLER                  PIC X(07) VALUE ' DEPT: '.               
           05  HL6-DEPT-NUMBER         PIC X(03) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE ' - '.                   
           05  HL6-DEPT-DESCRIPTION    PIC X(45) VALUE SPACES.                  
                                                                                
       01  DL-DETAIL-LINE.                                                      
           05  DL1-SKU                     PIC X(08).                           
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  DL1-SKU-DESCRIP             PIC X(25).                           
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  DL1-UPC-NMBR                PIC X(15).                           
           05  FILLER                      PIC X(01) VALUE SPACES.              
           05  DL1-AREA                    PIC Z(06).                           
           05  DL1-AREA-ALPHA REDEFINES                                         
               DL1-AREA                    PIC X(06).                           
           05  FILLER                      PIC X(03) VALUE SPACES.              
           05  DL1-INV-ONHND               PIC ZZZZ,ZZ9-.                       
           05  FILLER                      PIC X(01) VALUE SPACES.              
SR3403     05  DL1-INV-PRICE               PIC ZZ,ZZZ.ZZ.                       
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
           05  DL1-FS-ONHND                PIC ZZZZ,ZZZ-.                       
           05  FILLER                      PIC X(01) VALUE SPACES.              
SR3403     05  DL1-FS-PRICE                PIC ZZ,ZZZ.ZZ.                       
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
           05  DL1-VARIANCE                PIC ZZZZ,ZZZ-.                       
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  DL1-EXTEND-PRICE            PIC Z,ZZZ,ZZZ.ZZ-.                   
      *                                                                         
       01  VL-VARIANCE-LINE.                                                    
           05  VL1-SKU                     PIC X(08).                           
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  VL1-SKU-DESCRIP             PIC X(25).                           
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  VL1-UPC-NMBR                PIC X(15).                           
           05  FILLER                      PIC X(01) VALUE SPACES.              
           05  FILLER                      PIC X(06) VALUE SPACES.              
           05  FILLER                      PIC X(03) VALUE SPACES.              
           05  VL1-INV-ONHND               PIC ZZZZ,ZZ9-.                       
           05  FILLER                      PIC X(01) VALUE SPACES.              
      *    05  VL1-INV-PRICE               PIC $,$$$.99.                        
SR3403     05  VL1-INV-PRICE               PIC ZZ,ZZZ.ZZ.                       
SR3403     05  FILLER                      PIC X(03) VALUE SPACES.              
           05  VL1-FS-ONHND                PIC ZZZZ,ZZ9-.                       
           05  FILLER                      PIC X(01) VALUE SPACES.              
SR3403     05  VL1-FS-PRICE                PIC $$$,$$$.99.                      
SR3403     05  FILLER                      PIC X(02) VALUE SPACES.              
           05  VL1-VARIANCE                PIC ZZZZ,ZZ9-.                       
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  VL1-EXTEND-PRICE            PIC $,$$$,$$$.99-.                   
                                                                                
       01  DL-NO-EXCEPTION-LINE.                                                
           05  FILLER                  PIC X(49)    VALUE                       
               '************* NO EXCEPTIONS EXIST ***************'.             
           05  FILLER                  PIC X(83)    VALUE SPACES.               
                                                                                
       01  DL-EXCEPTION-SUMMARY-LINE.                                           
           05  FILLER                  PIC X(10)    VALUE                       
               '** STORE: '.                                                    
           05  DLESL-STORE             PIC X(04).                               
           05  FILLER                  PIC X(32)    VALUE                       
               ' EXCEPTIONS RANGE FROM A LOW OF '.                              
           05  DLESL-LOW               PIC Z,ZZZ,ZZ9-.                          
           05  FILLER                  PIC X(14)    VALUE                       
               ' TO A HIGH OF '.                                                
           05  DLESL-HIGH              PIC Z,ZZZ,ZZ9-.                          
           05  FILLER                  PIC X(03)    VALUE ' **'.                
      *                                                                         
      ******************************************************************        
      * COPYBOOK FOR REMAINING REPORT HEADING LINES, DETAIL LINE                
      ******************************************************************        
           COPY DPWS132O.                                                       
      *                                                                         
      ******************************************************************        
      *  INVENTORY EXCEPTIONS BY STORE EXTRACT - INPUT RECORD LAYOUT            
      ******************************************************************        
           COPY INRD024.                                                        
      *                                                                         
      ******************************************************************        
      *  SQL ABEND ROUTINE WORKING STORAGE                                      
      ******************************************************************        
           COPY DPWS004.                                                        
      *                                                                         
      *                                                                         
      ******************************************************************        
      * DB2 TABLE DCLGEN - TSKXREF                                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TSKXREF                                                  
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * DB2 TABLE DCLGEN - IMV_SKU                                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE IMV00001                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * XMT_LOC TABLE DCLGEN                                                    
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE XMT00001                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *  DB2 TABLE DCLGEN - TMDSEAR                                             
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TMDSEAR                                                  
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *  DB2 TABLE DCLGEN - TSUMINV                                             
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TSUMINV                                                  
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      *  DB2 TABLE DCLGEN - TINENTY                                             
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TINENTY                                                  
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * DB2 - CURSOR FOR - TSUMINV                                              
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE TSUMINV_CURSOR CURSOR FOR                                  
               SELECT UPC_NBR                                                   
                     ,AREA_NBR                                                  
                     ,INV_QTY                                                   
               FROM TSUMINV                                                     
               WHERE LOC_NBR   = :SUMINV-LOC-NBR                                
                 AND SKU_NBR   = :SUMINV-SKU-NBR                                
                ORDER BY AREA_NBR                                               
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * DB2 - CURSOR FOR - TINENTY                                              
      ******************************************************************        
           EXEC SQL                                                             
             DECLARE TINENTY_CURSOR CURSOR FOR                                  
               SELECT UPC_NBR                                                   
                     ,SHEET_NBR                                                 
                     ,SUM(INV_QTY)                                              
               FROM TINENTY                                                     
               WHERE STR_NBR   = :INENTY-STR-NBR                                
                 AND SKU_NBR   = :INENTY-SKU-NBR                                
                GROUP BY UPC_NBR, SHEET_NBR                                     
                ORDER BY SHEET_NBR                                              
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * DB2 TABLE ERROR HANDLING                                                
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
      *                                                                         
      *****************************************************************         
           COPY SQLCA2.                                                         
      *                                                                         
      *****************************************************************         
       PROCEDURE DIVISION.                                                      
      *****************************************************************         
      *                                                                         
       1000-MAIN-MODULE.                                                        
      *                                                                         
           PERFORM 1000-INITIALIZATION.                                         
      *                                                                         
           PERFORM 2000-PROCESS-INPUT                                           
               UNTIL PS-END-OF-INPUT OR                                         
28545                PS-STORE-CONTROL-AT-END-YES.                               
      *                                                                         
           PERFORM 9000-END-OF-JOB-TASKS.                                       
      *                                                                         
       9999-EXIT-PROGRAM.                                                       
           STOP RUN.                                                            
      *                                                                         
      /****************************************************************         
      * 1000-INITIALIZATION.                                                    
      *****************************************************************         
       1000-INITIALIZATION.                                                     
      *                                                                         
           DISPLAY '**********************************'.                        
           DISPLAY '* START OF INKRP278               '.                        
           DISPLAY '**********************************'.                        
      *                                                                         
           OPEN INPUT  STORE-CONTROL-FILE                                       
                INPUT  STORE-MERGE-FILE                                         
                INPUT  EXCEPT-CONTROL-FILE                                      
                OUTPUT STORE-INV-EXCEPTION-RPT.                                 
      *                                                                         
           ACCEPT PV-CURRENT-DATE    FROM DATE.                                 
           ACCEPT PV-CURRENT-TIME    FROM TIME.                                 
      *                                                                         
           MOVE PV-CD-MM            TO DP132O-RUN-MONTH.                        
           MOVE PV-CD-DD            TO DP132O-RUN-DAY.                          
           MOVE PV-CD-YY            TO DP132O-RUN-YEAR.                         
           MOVE PV-CT-HH            TO DP132O-RUN-HOUR.                         
           MOVE PV-CT-MM            TO DP132O-RUN-MINUTE.                       
           MOVE PC-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.                     
           MOVE 1                   TO DP132O-REPORT-NUMBER.                    
           MOVE ZEROS               TO PV-TOTAL-INV-QTY.                        
           MOVE ZEROS               TO PV-TOTAL-EXT-PRICE.                      
           MOVE ZEROS               TO PV-STORE-REC-COUNT.                      
           MOVE ZEROS               TO PV-PAGE-COUNT                            
                                       PV-LINE-COUNT.                           
      *                                                                         
      ** GET THE TOP XXXXX CONTROL RECORD FOR THE REPORT.                       
           PERFORM 5100-READ-EXCEPT-CONTROL-FILE.                               
      *                                                                         
      ** DETERMINE WHICH STORES ARE BEING PROCESSED THIS RUN.                   
           PERFORM 5300-READ-STORE-CONTROL.                                     
      *                                                                         
28545      IF PS-STORE-CONTROL-AT-END-YES                                       
28545          SET PS-END-OF-INPUT TO TRUE                                      
28545          MOVE ZEROS              TO SA-STORE-FOR-HEADER                   
28545          MOVE ZEROS              TO PV-PAGE-COUNT                         
28545          SET PS-PRINT-DEPT-NO    TO TRUE                                  
28545          PERFORM 7100-PRINT-HEADINGS                                      
28545          MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD               
28545          MOVE 2                    TO PV-ADVANCE-LINE                     
28545          PERFORM 7300-PRINT-DETAIL-RECORD                                 
28545      ELSE                                                                 
28545          PERFORM 2500-PROCESS-STORE-CONTROL                               
28545                                                                           
      *                                                                         
      *                                                                         
      ** READ OF THE EXCEPTION MERGE FILE.                                      
      *                                                                         
               PERFORM 5000-READ-INV-FILE                                       
      *                                                                         
W34557         PERFORM 2600-EXCLUDE-NEG-OHQTY                                   
W34557                                                                          
               IF PS-END-OF-INPUT                                               
                   MOVE ZEROS TO SA-STORE-FOR-HEADER                            
28545              SET PS-PRINT-DEPT-NO      TO TRUE                            
28545              PERFORM 7100-PRINT-HEADINGS                                  
28545              MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD           
28545              MOVE 2                    TO PV-ADVANCE-LINE                 
28545              PERFORM 7300-PRINT-DETAIL-RECORD                             
28545          ELSE                                                             
28545              IF IN024-STORE-NUMBER NOT = SCR-STORE-NMBR                   
28545                  SET PS-FOUND-STORE-MATCH-NO TO TRUE                      
28545                  PERFORM 1100-NONE-FOR-STORE                              
28545                      UNTIL PS-FOUND-STORE-MATCH-YES OR                    
28545                            PS-STORE-CONTROL-AT-END-YES                    
28545                  IF PS-FOUND-STORE-MATCH-YES                              
28545                      PERFORM 1110-STORE-MATCH                             
28545                  END-IF                                                   
28545              ELSE                                                         
28545                  PERFORM 1110-STORE-MATCH                                 
28545              END-IF                                                       
28545          END-IF                                                           
28545      END-IF.                                                              
28545 *                                                                         
28545                                                                           
28545                                                                           
28545                                                                           
28545  1100-NONE-FOR-STORE.                                                     
28545                                                                           
28545      MOVE SCR-STORE-NMBR TO SA-STORE-FOR-HEADER.                          
28545      MOVE ZEROS          TO PV-PAGE-COUNT.                                
28545      SET PS-PRINT-DEPT-NO TO TRUE.                                        
28545      PERFORM 7100-PRINT-HEADINGS.                                         
28545      MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD.                  
28545      MOVE 2                    TO PV-ADVANCE-LINE.                        
28545      PERFORM 7300-PRINT-DETAIL-RECORD.                                    
28545                                                                           
28545      PERFORM 5300-READ-STORE-CONTROL.                                     
28545                                                                           
28545      IF PS-STORE-CONTROL-AT-END-NO                                        
28545          IF IN024-STORE-NUMBER = SCR-STORE-NMBR                           
28545              SET PS-FOUND-STORE-MATCH-YES TO TRUE.                        
28545                                                                           
28545  1110-STORE-MATCH.                                                        
28545                                                                           
28545      MOVE IN024-STORE-NUMBER             TO SA-STORE-NUMBER               
28545                                             SA-STORE-FOR-HEADER.          
28545      MOVE IN024-SKU                      TO SA-SKU.                       
28545      MOVE IN024-SKU-ATTRIBUTES           TO SA-SKU-ATTRIBUTES.            
28545      MOVE IN024-ABSOLUTE-VAR-QTY         TO PV-HIGH-RANGE                 
28545                                             PV-LOW-RANGE.                 
28545                                                                           
28545      PERFORM 2500-PROCESS-STORE-CONTROL.                                  
28545      PERFORM 7100-PRINT-HEADINGS.                                         
      *                                                                         
      /****************************************************************         
      * 2000-PROCESS-INPUT.                                                     
      * 1. IF MERGE-FILE STORE <> CONTROL-FILE-STORE - NO EXCEPTIONS            
      * 2. IF MERGE-FILE STORE =  MERGE-FILE STORE CONTINUE ALL RECS            
      *****************************************************************         
       2000-PROCESS-INPUT.                                                      
      ** STORE/SKU CHANGES.....                                                 
           IF IN024-STORE-NUMBER     IS EQUAL TO SA-SAVE-STORE-NUMBER           
               IF IN024-STORE-NUMBER IS EQUAL TO SA-STORE-NUMBER                
                   IF IN024-DEPT     IS EQUAL TO SA-DEPT                        
                       PERFORM 2200-PROCESS-SKU                                 
                   ELSE                                                         
                       PERFORM 2350-PROCESS-DEPT-BREAK                          
                       PERFORM 2200-PROCESS-SKU                                 
                   END-IF                                                       
               ELSE                                                             
                   PERFORM 2400-PROCESS-STORE-BREAK                             
                   PERFORM 2200-PROCESS-SKU                                     
               END-IF                                                           
      *                                                                         
      **       READ OF THE EXCEPTION MERGE FILE.                                
               PERFORM 5000-READ-INV-FILE                                       
           ELSE                                                                 
               PERFORM 2400-PROCESS-STORE-BREAK                                 
               PERFORM 2200-PROCESS-SKU                                         
               PERFORM 5000-READ-INV-FILE                                       
           END-IF.                                                              
W34557                                                                          
W34557     PERFORM 2600-EXCLUDE-NEG-OHQTY.                                      
W34557                                                                          
      *                                                                         
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       2200-PROCESS-SKU.                                                        
      *                                                                         
           MOVE 'N' TO PS-TSUMINV-DONE-SW                                       
           MOVE IN024-STORE-NUMBER TO SA-STORE-NUMBER                           
                                      SUMINV-LOC-NBR                            
           MOVE IN024-SKU          TO SA-SKU                                    
                                      SUMINV-SKU-NBR                            
                                                                                
           PERFORM 8800-OPEN-TSUMINV-CSR                                        
           PERFORM 6000-MOVE-TSUMINV-MERGE-RECORD                               
           PERFORM 8850-CLOSE-TSUMINV-CSR.                                      
      *                                                                         
           MOVE 'N' TO PS-TINENTY-DONE-SW                                       
           MOVE IN024-STORE-NUMBER TO SA-STORE-NUMBER                           
                                      INENTY-STR-NBR                            
           MOVE IN024-SKU          TO SA-SKU                                    
                                      INENTY-SKU-NBR                            
                                                                                
           PERFORM 8900-OPEN-TINENTY-CSR                                        
           PERFORM 6050-MOVE-TINENTY-MERGE-RECORD                               
           PERFORM 8950-CLOSE-TINENTY-CSR.                                      
      *                                                                         
           PERFORM 2300-PROCESS-SKU-TOTALS.                                     
      *                                                                         
      *****************************************************************         
      * 2300-PROCESS-SKU-TOTALS.                                                
      *****************************************************************         
       2300-PROCESS-SKU-TOTALS.                                                 
      *                                                                         
           IF IN024-ABSOLUTE-VAR-QTY < PV-LOW-RANGE                             
               MOVE IN024-ABSOLUTE-VAR-QTY TO PV-LOW-RANGE                      
           ELSE                                                                 
               IF IN024-ABSOLUTE-VAR-QTY > PV-HIGH-RANGE                        
                   MOVE IN024-ABSOLUTE-VAR-QTY TO PV-HIGH-RANGE                 
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM 3000-VARIANCE-TOTALS.                                        
      *                                                                         
           MOVE IN024-STORE-NUMBER   TO SA-STORE-NUMBER.                        
           MOVE IN024-SKU-ATTRIBUTES TO SA-SKU-ATTRIBUTES.                      
           MOVE IN024-SKU            TO SA-SKU.                                 
      *                                                                         
      *****************************************************************         
      * 2350-PROCESS-DEPT-BREAK.                                                
      *****************************************************************         
       2350-PROCESS-DEPT-BREAK.                                                 
      *                                                                         
           PERFORM 7100-PRINT-HEADINGS.                                         
      *                                                                         
      *    MOVE IN024-STORE-NUMBER   TO SA-STORE-NUMBER.                        
      *    MOVE IN024-SKU-ATTRIBUTES TO SA-SKU-ATTRIBUTES.                      
      *    MOVE IN024-SKU            TO SA-SKU.                                 
      *                                                                         
      *****************************************************************         
      * 2400-PROCESS-STORE-BREAK.                                               
      *****************************************************************         
       2400-PROCESS-STORE-BREAK.                                                
      *                                                                         
           IF PV-STORE-REC-COUNT IS GREATER THAN 0                              
               PERFORM 7700-PRINT-EXCEPTION-RANGE                               
           ELSE                                                                 
               MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD               
               MOVE 2                    TO PV-ADVANCE-LINE                     
               PERFORM 7300-PRINT-DETAIL-RECORD                                 
           END-IF.                                                              
      *                                                                         
      *                                                                         
           MOVE ZEROS                TO PV-PAGE-COUNT                           
                                        PV-LINE-COUNT                           
                                        PV-STORE-REC-COUNT.                     
      *                                                                         
28545                                                                           
28545      SET PS-FOUND-STORE-MATCH-NO TO TRUE.                                 
28545                                                                           
28545      PERFORM 2410-GET-STORE-CONTROL                                       
28545          UNTIL PS-FOUND-STORE-MATCH-YES OR                                
28545                PS-STORE-CONTROL-AT-END-YES                                
28545                  IF PS-FOUND-STORE-MATCH-YES                              
28545                      PERFORM 2500-PROCESS-STORE-CONTROL                   
28545                      MOVE IN024-STORE-NUMBER                              
28545                                      TO SA-STORE-NUMBER                   
28545                                         SA-STORE-FOR-HEADER               
28545                      MOVE IN024-SKU-ATTRIBUTES                            
28545                                      TO SA-SKU-ATTRIBUTES                 
28545                      MOVE IN024-SKU  TO SA-SKU                            
28545                      PERFORM 7100-PRINT-HEADINGS                          
28545                  END-IF.                                                  
      *                                                                         
28545                                                                           
28545  2410-GET-STORE-CONTROL.                                                  
28545                                                                           
28545      PERFORM 5300-READ-STORE-CONTROL.                                     
28545                                                                           
28545      IF PS-STORE-CONTROL-AT-END-NO                                        
28545          IF IN024-STORE-NUMBER = SCR-STORE-NMBR                           
28545              SET PS-FOUND-STORE-MATCH-YES TO TRUE                         
28545          ELSE                                                             
28545              MOVE SCR-STORE-NMBR TO SA-STORE-FOR-HEADER                   
28545              MOVE ZEROS          TO PV-PAGE-COUNT                         
28545                                                                           
28545              SET PS-PRINT-DEPT-NO      TO TRUE                            
28545              PERFORM 7100-PRINT-HEADINGS                                  
28545              MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD           
28545              MOVE 2                    TO PV-ADVANCE-LINE                 
28545              PERFORM 7300-PRINT-DETAIL-RECORD                             
28545          END-IF                                                           
28545      END-IF.                                                              
28545                                                                           
28545                                                                           
28545                                                                           
      *                                                                         
      *****************************************************************         
      * 2500-PROCESS-STORE-CONTROL.                                             
      *****************************************************************         
       2500-PROCESS-STORE-CONTROL.                                              
      *                                                                         
           MOVE SCR-STORE-NMBR  TO SA-SAVE-STORE-NUMBER                         
                                   SA-STORE-FOR-HEADER.                         
      *                                                                         
      *                                                                         
W34557*****************************************************************         
W34557* 2600-EXCLUDE-NEG-OHQTY.                                                 
W34557*****************************************************************         
W34557 2600-EXCLUDE-NEG-OHQTY.                                                  
W34557*                                                                         
W34557     MOVE -1 TO PV-TOTAL-OH-QTY                                           
W34557                                                                          
W34557     PERFORM                                                              
W34557       UNTIL PV-TOTAL-OH-QTY >= 0                                         
W34557          OR PS-END-OF-INPUT                                              
W34557                                                                          
W34557        IF IN024-MFSTNG-IND IS EQUAL TO 'Y'                               
W34557           COMPUTE PV-TOTAL-OH-QTY = IN024-INV-CUTOFF-OH-QTY -            
W34557                                    (IN024-CUTOFF-STR-EXPECT -            
W34557                                     IN024-CUTOFF-INTRANSIT)              
W34557        ELSE                                                              
W34557           COMPUTE PV-TOTAL-OH-QTY = IN024-INV-CUTOFF-OH-QTY -            
W34557                                     IN024-POST-FL-AFT-REC                
W34557        END-IF                                                            
W34557                                                                          
W34557        IF PV-TOTAL-OH-QTY < 0                                            
W34557           ADD 1 TO PA-NEG-OHQTY-REC                                      
W34557           PERFORM 5000-READ-INV-FILE                                     
W34557        END-IF                                                            
W34557                                                                          
W34557     END-PERFORM.                                                         
W34557*                                                                         
      ******************************************************************        
      * 3000-VARIANCE-TOTALS.                                                   
      ******************************************************************        
       3000-VARIANCE-TOTALS.                                                    
      *                                                                         
           MOVE SPACES               TO RP-REPORT-WORK-RECORD                   
           PERFORM 7300-PRINT-DETAIL-RECORD                                     
      *                                                                         
           MOVE SPACES              TO VL-VARIANCE-LINE                         
           MOVE 'SKU TOTAL:'        TO VL1-SKU-DESCRIP                          
      *                                                                         
     ****  INVENTORIED QTY / PRICE                                              
           MOVE PV-TOTAL-INV-QTY          TO VL1-INV-ONHND.                     
           MOVE ZERO                      TO VL1-INV-PRICE.                     
                                                                                
     ****  FASHION SALES QTY                                                    
           IF IN024-MFSTNG-IND IS EQUAL TO 'Y'                                  
               COMPUTE PV-TOTAL-FS-QTY    =  IN024-INV-CUTOFF-OH-QTY -          
                                             (IN024-CUTOFF-STR-EXPECT -         
                                             IN024-CUTOFF-INTRANSIT)            
           ELSE                                                                 
               COMPUTE PV-TOTAL-FS-QTY    =  IN024-INV-CUTOFF-OH-QTY            
                                             - IN024-POST-FL-AFT-REC            
           END-IF.                                                              
      *                                                                         
           MOVE PV-TOTAL-FS-QTY           TO VL1-FS-ONHND.                      
                                                                                
                                                                                
     ****  FASHION SALES PRICE                                                  
           MOVE IN024-SYSTEM-PRICE        TO VL1-FS-PRICE.                      
                                                                                
     ****  VARIANCE                                                             
           MOVE IN024-VARIANCE-QTY        TO VL1-VARIANCE                       
                                                                                
     ****  EXTENDED VARIANCE                                                    
           COMPUTE VL1-EXTEND-PRICE = IN024-SYSTEM-PRICE                        
                                    * IN024-VARIANCE-QTY.                       
      *                                                                         
           MOVE VL-VARIANCE-LINE          TO RP-REPORT-WORK-RECORD.             
           PERFORM 7300-PRINT-DETAIL-RECORD.                                    
           MOVE SPACES                    TO RP-REPORT-WORK-RECORD.             
           PERFORM 7300-PRINT-DETAIL-RECORD.                                    
                                                                                
      *                                                                         
      /*****************************************************************        
      * 5000-READ-INV-FILE.                                                     
      *    READ THE MERGED INPUT EXCEPTION SKUS.                                
      ******************************************************************        
       5000-READ-INV-FILE.                                                      
      *                                                                         
           READ STORE-MERGE-FILE                                                
             INTO IN024-INV-EXCEPTS-STR-REC                                     
                AT END  SET PS-END-OF-INPUT TO TRUE                             
           END-READ.                                                            
      *                                                                         
      ******************************************************************        
      * 5100-READ THE EXCEPTION CONTROL FILE.                                   
      *    READ THE TOP EXCEPTION CONTROL FILE.                                 
      ******************************************************************        
       5100-READ-EXCEPT-CONTROL-FILE.                                           
                                                                                
           READ EXCEPT-CONTROL-FILE                                             
             AT END                                                             
               SET PS-END-OF-INPUT TO TRUE                                      
               DISPLAY '*************************************'                  
               DISPLAY '**  ABEND PROGRAM = INKRP278'                           
               DISPLAY '**  PARAGRAPH     = 1000-INITIALIZTION'                 
               DISPLAY '**'                                                     
               DISPLAY '**  MISSING EXCEPTION CONTROL RECORD'                   
               DISPLAY '**  INP03'                                              
               DISPLAY '*************************************'                  
               MOVE +4008          TO ABEND-CODE                                
               PERFORM 9990-ABEND                                               
           END-READ.                                                            
      *                                                                         
      ******************************************************************        
      * 5300-READ THE STORE CONTROL FILE.                                       
      *    READ THE STORE CONTROL FILE WHICH LETS US KNOW WHICH STORES          
      *  WE ARE PROCESSING THIS RUN.                                            
      ******************************************************************        
       5300-READ-STORE-CONTROL.                                                 
                                                                                
           READ STORE-CONTROL-FILE NEXT                                         
28545           AT END  SET PS-STORE-CONTROL-AT-END-YES TO TRUE                 
28545                                                                           
           END-READ.                                                            
      *                                                                         
      /*****************************************************************        
      * 6000-MOVE-TSUMINV-MERGE-RECORD.                                         
      * MOVE THE COPY BOOK (INRD288) VALUES TO THE OUTPUT RECORD VALUES         
      ******************************************************************        
       6000-MOVE-TSUMINV-MERGE-RECORD.                                          
      *                                                                         
           MOVE IN024-SKU                 TO DL1-SKU, PV-EDIT-SKU,              
                                             SA-SKU-SAVE.                       
           MOVE ZEROES                    TO PV-TOTAL-INV-QTY.                  
                                                                                
           PERFORM                                                              
             UNTIL NO-MORE-TSUMINV-UPCS                                         
               PERFORM 8825-SELECT-TSUMINV                                      
           END-PERFORM.                                                         
                                                                                
                                                                                
           MOVE 'N'                       TO PS-TSUMINV-DONE-SW.                
           MOVE ZEROS                     TO PV-DTL-LINE-PRT-ACCUM.             
      *                                                                         
      /*****************************************************************        
      * 6050-MOVE-TINENTY-MERGE-RECORD.                                         
      * MOVE THE COPY BOOK (INRD288) VALUES TO THE OUTPUT RECORD VALUES         
      ******************************************************************        
       6050-MOVE-TINENTY-MERGE-RECORD.                                          
      *                                                                         
           MOVE IN024-SKU                 TO DL1-SKU, PV-EDIT-SKU,              
                                             SA-SKU-SAVE.                       
      *    MOVE ZEROES                    TO PV-TOTAL-INV-QTY.                  
                                                                                
           PERFORM                                                              
             UNTIL NO-MORE-TINENTY-UPCS                                         
               PERFORM 8925-SELECT-TINENTY                                      
           END-PERFORM.                                                         
                                                                                
                                                                                
           MOVE 'N'                       TO PS-TINENTY-DONE-SW.                
           MOVE ZEROS                     TO PV-DTL-LINE-PRT-ACCUM.             
      *                                                                         
      /*****************************************************************        
      * 6100-MOVE-CSR-TO-REPORT.                                                
      * MOVE THE COPY BOOK (INRD288) VALUES TO THE OUTPUT RECORD VALUES         
      * FOR DUMMY SKUS.                                                         
      ******************************************************************        
      *                                                                         
       6100-MOVE-CSR-TO-REPORT.                                                 
      *                                                                         
           MOVE PV-SAVE-UPC     TO DL1-UPC-NMBR                                 
           MOVE PV-SAVE-AREA    TO PV-AREA-NUMBER                               
           MOVE PV-AREA-NUMBER  TO DL1-AREA                                     
           MOVE PV-SAVE-QTY     TO DL1-INV-ONHND                                
           ADD  PV-SAVE-QTY     TO PV-TOTAL-INV-QTY                             
           ADD  1               TO PV-STORE-REC-COUNT                           
      *                                                                         
           PERFORM 8600-SELECT-IMV-SKU.                                         
      *                                                                         
           PERFORM 8400-PRT-DETAIL                                              
      *    MOVE SPACES          TO DL-DETAIL-LINE                               
           ADD 1                TO PV-DTL-LINE-PRT-ACCUM.                       
      *                                                                         
      ******************************************************************        
      * 7100-PRINT-HEADINGS.                                                    
      ******************************************************************        
       7100-PRINT-HEADINGS.                                                     
      *                                                                         
           ADD 1                    TO PV-PAGE-COUNT.                           
           MOVE PV-PAGE-COUNT       TO DP132O-PAGE-NUMBER.                      
           MOVE PC-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.                     
           MOVE 1                   TO DP132O-REPORT-NUMBER.                    
                                                                                
           WRITE REPORT-LINE                                                    
             FROM DP132O-STANDRD-HEADER-132-COLS AFTER ADVANCING PAGE.          
                                                                                
           MOVE ECR-EXCEPT-CONTROL  TO HL1-EXCEPT-CONTROL.                      
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM HL1-HEADING-LINE-1 AFTER ADVANCING 1 LINE.                    
                                                                                
           PERFORM 8500-SELECT-XMTLOC.                                          
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL2-HEADING-LINE-2 AFTER ADVANCING 1 LINE.                    
                                                                                
28545      IF PS-PRINT-DEPT-YES                                                 
28545          PERFORM 8700-GET-MDSEAR-DESC                                     
28545          WRITE REPORT-LINE                                                
28545              FROM HL6-HEADING-LINE-6 AFTER ADVANCING 1 LINES              
28545      ELSE                                                                 
28545          MOVE SPACES TO HL6-DEPT-NUMBER                                   
28545          MOVE SPACES TO HL6-DEPT-DESCRIPTION                              
28545      END-IF.                                                              
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL3-HEADING-LINE-3 AFTER ADVANCING 1 LINE.                    
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL4-HEADING-LINE-4 AFTER ADVANCING 1 LINE.                    
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL5-HEADING-LINE-5 AFTER ADVANCING 1 LINE.                    
                                                                                
           MOVE 7                   TO PV-LINE-COUNT.                           
28545      SET PS-PRINT-DEPT-YES TO TRUE.                                       
      *                                                                         
      ******************************************************************        
      * 7300-PRINT-DETAIL-RECORD.                                               
      ******************************************************************        
       7300-PRINT-DETAIL-RECORD.                                                
      *                                                                         
           IF PV-LINE-COUNT = 0                                                 
               OR (PV-LINE-COUNT + PV-ADVANCE-LINE > PC-PRINT-LINE-MAX)         
               PERFORM 7100-PRINT-HEADINGS                                      
           END-IF.                                                              
      *                                                                         
           WRITE REPORT-LINE FROM RP-REPORT-WORK-RECORD                         
               AFTER ADVANCING PV-ADVANCE-LINE LINE.                            
      *                                                                         
           ADD PV-ADVANCE-LINE  TO PV-LINE-COUNT.                               
           MOVE +1              TO PV-ADVANCE-LINE.                             
      *                                                                         
      *                                                                         
      ******************************************************************        
      * 7700-PRINT THE STORE EXCEPTION SUMMARY LINE.                            
      ******************************************************************        
       7700-PRINT-EXCEPTION-RANGE.                                              
                                                                                
           MOVE HL2-STORE-NUMBER TO DLESL-STORE.                                
           MOVE PV-LOW-RANGE     TO DLESL-LOW.                                  
           MOVE PV-HIGH-RANGE    TO DLESL-HIGH.                                 
                                                                                
           MOVE DL-EXCEPTION-SUMMARY-LINE TO RP-REPORT-WORK-RECORD.             
           MOVE 3                    TO PV-ADVANCE-LINE.                        
           PERFORM 7300-PRINT-DETAIL-RECORD.                                    
                                                                                
           MOVE IN024-ABSOLUTE-VAR-QTY  TO PV-HIGH-RANGE                        
                                           PV-LOW-RANGE.                        
      *                                                                         
      *                                                                         
      *****************************************************************         
      * 8400-PRT-DETAIL.                                                        
      *****************************************************************         
       8400-PRT-DETAIL.                                                         
      *                                                                         
           MOVE DL-DETAIL-LINE       TO RP-REPORT-WORK-RECORD.                  
           PERFORM 7300-PRINT-DETAIL-RECORD.                                    
      *                                                                         
      /*****************************************************************        
      * 8500-SELECT-XMTLOC.                                                     
      ******************************************************************        
       8500-SELECT-XMTLOC.                                                      
      *                                                                         
           INITIALIZE DCLXMT00001.                                              
      *                                                                         
           MOVE SA-STORE-FOR-HEADER TO XMT00001-LOC-NBR                         
                                       HL2-STORE-NUMBER.                        
      *                                                                         
           EXEC SQL                                                             
             SELECT LOC_NM                                                      
               INTO :XMT00001-LOC-NM                                            
               FROM XMT_LOC                                                     
              WHERE LOC_NBR = :XMT00001-LOC-NBR                                 
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN SQLCODE = +0                                                
                   MOVE XMT00001-LOC-NM         TO HL2-STORE-DESCRIPTION        
               WHEN OTHER                                                       
                   MOVE 'NOT FOUND ON XMT00001' TO HL2-STORE-DESCRIPTION        
           END-EVALUATE.                                                        
      *                                                                         
      ******************************************************************        
      * 8600-SELECT-IMV-SKU.                                                    
      ******************************************************************        
       8600-SELECT-IMV-SKU.                                                     
      *                                                                         
           INITIALIZE DCLIMV00001.                                              
      *                                                                         
           MOVE PV-EDIT-SKU         TO IMV00001-SKU-NBR.                        
      *                                                                         
           EXEC SQL                                                             
             SELECT                                                             
                   SKU_DESC                                                     
             INTO                                                               
                  :IMV00001-SKU-DESC                                            
             FROM IMV_SKU                                                       
             WHERE                                                              
                   SKU_NBR         = :IMV00001-SKU-NBR                          
           END-EXEC.                                                            
      *                                                                         
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   MOVE IMV00001-SKU-DESC (1:25)  TO DL1-SKU-DESCRIP,           
                                                    SA-SKU-DESCRIP-SAVE         
               WHEN OTHER                                                       
                   MOVE '****'        TO DL1-SKU-DESCRIP,                       
                                         SA-SKU-DESCRIP-SAVE                    
           END-EVALUATE.                                                        
      *                                                                         
      ******************************************************************        
      *8700-GET-MDSEAR-DESC.                                                    
      ******************************************************************        
       8700-GET-MDSEAR-DESC.                                                    
      *                                                                         
           INITIALIZE DCLTMDSEAR.                                               
      *                                                                         
           MOVE IN024-DEPT (2:3)      TO MDSEAR-DEPT-NBR                        
                                         HL6-DEPT-NUMBER.                       
      *                                                                         
           EXEC SQL                                                             
               SELECT MDSEAR_DESC                                               
               INTO :MDSEAR-DESC                                                
               FROM TMDSEAR                                                     
               WHERE (DEPT_NBR = :MDSEAR-DEPT-NBR)                              
                 AND (MDSELV_CDE = 'DPT')                                       
                 AND (OPERCO_NBR = '03')                                        
                 AND (CURRENT DATE BETWEEN STRT_DTE AND END_DTE)                
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN SQLCODE IS EQUAL TO ZERO                                    
                   MOVE MDSEAR-DESC            TO HL6-DEPT-DESCRIPTION          
               WHEN SQLWARN IS NOT EQUAL TO SPACES                              
               WHEN SQLCODE IS NOT EQUAL TO ZERO                                
                   MOVE 'NOT FOUND ON TMDSEAR' TO HL6-DEPT-DESCRIPTION          
           END-EVALUATE.                                                        
      *                                                                         
      *****************************************************************         
      * 8800-OPEN-TSUMINV-CSR.                                                  
      *****************************************************************         
       8800-OPEN-TSUMINV-CSR.                                                   
                                                                                
           EXEC SQL                                                             
               OPEN TSUMINV_CURSOR                                              
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
             WHEN SQLCODE IS EQUAL TO ZERO                                      
               CONTINUE                                                         
             WHEN SQLCODE IS LESS THAN ZERO                                     
               DISPLAY '**  ABEND     **'                                       
               MOVE '8800-OPEN-TSUMINV-CSR' TO PV-PARAGRAPH-NAME                
               MOVE 'OPEN CURSOR'     TO  PV-DB2-OPER-ATTEMPTED                 
               PERFORM 9900-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *                                                                         
      ******************************************************************        
      * 8825-SELECT-TSUMINV.                                                    
      ******************************************************************        
       8825-SELECT-TSUMINV.                                                     
      *                                                                         
           EXEC SQL                                                             
             FETCH TSUMINV_CURSOR                                               
               INTO :SUMINV-UPC-NBR                                             
                   ,:SUMINV-AREA-NBR                                            
                   ,:SUMINV-INV-QTY                                             
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN SQLCODE IS EQUAL TO ZERO                                    
                   MOVE SUMINV-UPC-NBR TO PV-SAVE-UPC                           
                   MOVE SUMINV-AREA-NBR TO PV-SAVE-AREA                         
                   MOVE SUMINV-INV-QTY TO PV-SAVE-QTY                           
                   PERFORM 6100-MOVE-CSR-TO-REPORT                              
               WHEN SQLCODE IS EQUAL TO +100                                    
                   MOVE 'Y'             TO PS-TSUMINV-DONE-SW                   
               WHEN SQLWARN IS NOT EQUAL TO SPACES                              
               WHEN SQLCODE IS NOT EQUAL TO ZERO                                
                   MOVE 'Y'             TO PS-TSUMINV-DONE-SW                   
           END-EVALUATE.                                                        
      *                                                                         
      *****************************************************************         
      * 8850-CLOSE-TSUMINV-CSR.                                                 
      *****************************************************************         
       8850-CLOSE-TSUMINV-CSR.                                                  
      *                                                                         
           EXEC SQL                                                             
               CLOSE TSUMINV_CURSOR                                             
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
             WHEN SQLCODE IS EQUAL TO ZERO                                      
               CONTINUE                                                         
             WHEN SQLWARN IS NOT EQUAL TO SPACES                                
             WHEN SQLCODE IS NOT EQUAL TO ZERO                                  
               DISPLAY '**  ABEND     **'                                       
               MOVE '8850-CLOSE-TSUMINV-CSR' TO PV-PARAGRAPH-NAME               
               MOVE 'CLOSE CURSOR'     TO  PV-DB2-OPER-ATTEMPTED                
               PERFORM 9900-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *                                                                         
      *****************************************************************         
      * 8900-OPEN-TINENTY-CSR.                                                  
      *****************************************************************         
       8900-OPEN-TINENTY-CSR.                                                   
                                                                                
           EXEC SQL                                                             
               OPEN TINENTY_CURSOR                                              
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
             WHEN SQLCODE IS EQUAL TO ZERO                                      
               CONTINUE                                                         
             WHEN SQLCODE IS LESS THAN ZERO                                     
               DISPLAY '**  ABEND     **'                                       
               MOVE '8900-OPEN-TINENTY-CSR' TO PV-PARAGRAPH-NAME                
               MOVE 'OPEN CURSOR'     TO  PV-DB2-OPER-ATTEMPTED                 
               PERFORM 9900-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *                                                                         
      ******************************************************************        
      * 8925-SELECT-TINENTY.                                                    
      ******************************************************************        
       8925-SELECT-TINENTY.                                                     
      *                                                                         
           EXEC SQL                                                             
             FETCH TINENTY_CURSOR                                               
               INTO :INENTY-UPC-NBR                                             
                   ,:INENTY-SHEET-NBR                                           
                   ,:INENTY-INV-QTY                                             
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
               WHEN SQLCODE IS EQUAL TO ZERO                                    
                   MOVE INENTY-UPC-NBR TO PV-SAVE-UPC                           
                   MOVE INENTY-SHEET-NBR TO PV-SAVE-AREA                        
                   MOVE INENTY-INV-QTY TO PV-SAVE-QTY                           
                   PERFORM 6100-MOVE-CSR-TO-REPORT                              
               WHEN SQLCODE IS EQUAL TO +100                                    
                   MOVE 'Y'             TO PS-TINENTY-DONE-SW                   
               WHEN SQLWARN IS NOT EQUAL TO SPACES                              
               WHEN SQLCODE IS NOT EQUAL TO ZERO                                
                   MOVE 'Y'             TO PS-TINENTY-DONE-SW                   
           END-EVALUATE.                                                        
      *                                                                         
      *****************************************************************         
      * 8950-CLOSE-TINENTY-CSR.                                                 
      *****************************************************************         
       8950-CLOSE-TINENTY-CSR.                                                  
      *                                                                         
           EXEC SQL                                                             
               CLOSE TINENTY_CURSOR                                             
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
             WHEN SQLCODE IS EQUAL TO ZERO                                      
               CONTINUE                                                         
             WHEN SQLWARN IS NOT EQUAL TO SPACES                                
             WHEN SQLCODE IS NOT EQUAL TO ZERO                                  
               DISPLAY '**  ABEND     **'                                       
               MOVE '8950-CLOSE-TINENTY-CSR' TO PV-PARAGRAPH-NAME               
               MOVE 'CLOSE CURSOR'     TO  PV-DB2-OPER-ATTEMPTED                
               PERFORM 9900-SQL-ABEND                                           
           END-EVALUATE.                                                        
      *                                                                         
      /****************************************************************         
      * 9000-END-OF-JOB-TASKS.                                                  
      *****************************************************************         
       9000-END-OF-JOB-TASKS.                                                   
      *                                                                         
           IF PV-STORE-REC-COUNT IS GREATER THAN 0                              
               PERFORM 7700-PRINT-EXCEPTION-RANGE                               
           END-IF.                                                              
      *                                                                         
28545      PERFORM 9010-NO-EXCEPT-DISPLAY                                       
28545          UNTIL PS-STORE-CONTROL-AT-END-YES.                               
      *                                                                         
           CLOSE STORE-MERGE-FILE                                               
                 EXCEPT-CONTROL-FILE                                            
                 STORE-CONTROL-FILE                                             
                 STORE-INV-EXCEPTION-RPT.                                       
      *                                                                         
W34557     DISPLAY 'NEGATIVE ONHAND QUANTITY RECORD COUNT : '                   
W34557              PA-NEG-OHQTY-REC                                            
W34557     DISPLAY '**'                                                         
           DISPLAY '**********************************'.                        
           DISPLAY '* END OF INKRP278                 '.                        
           DISPLAY '**********************************'.                        
      *                                                                         
28545                                                                           
28545                                                                           
28545  9010-NO-EXCEPT-DISPLAY.                                                  
28545                                                                           
28545      PERFORM 5300-READ-STORE-CONTROL.                                     
28545                                                                           
28545      IF PS-STORE-CONTROL-AT-END-NO                                        
28545          MOVE SCR-STORE-NMBR TO SA-STORE-FOR-HEADER                       
28545          MOVE ZEROS          TO PV-PAGE-COUNT                             
28545          SET PS-PRINT-DEPT-NO TO TRUE                                     
28545          PERFORM 7100-PRINT-HEADINGS                                      
28545          MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD               
28545          MOVE 2                    TO PV-ADVANCE-LINE                     
28545          PERFORM 7300-PRINT-DETAIL-RECORD                                 
28545      END-IF.                                                              
      /****************************************************************         
      * 9900-SQL-ABEND.                                                         
      *  STANDARD DB2 ERROR ABEND ROUTINE                                       
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.                     
      *****************************************************************         
       9900-SQL-ABEND.                                                          
      *                                                                         
           MOVE +4013                 TO ABEND-CODE.                            
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  INKRP278'.                             
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.                
      *                                                                         
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
      *                                                                         
           COPY DPPD004.                                                        
      *                                                                         
           PERFORM 9990-ABEND.                                                  
      *                                                                         
       9990-ABEND.                                                              
                                                                                
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
