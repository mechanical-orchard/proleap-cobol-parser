000100 IDENTIFICATION DIVISION.                                         00010018
000200 PROGRAM-ID.         SVKUT072.                                    00020019
000300 AUTHOR.             MADHURA PETHE.                               00030053
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040019
000500 DATE-WRITTEN.       JULY 2012.                                   00050053
000600 DATE-COMPILED.                                                   00060019
000700                                                                  00070019
000800******************************************************************00080019
000900* THIS PROGRAM WILL COMPARE DAILY TRANSACTION REPORT THAT IS     *00090055
001000* RECEIVED FROM INCOMM WITH DAILY KOHLS EXTRACT AND WRITE THREE  *00100055
001010* OUT FILES.                                                     *00101055
001020* 1) POSTING FILE: IT WILL HAVE ALL THE VERIFIED RECORDS.        *00102055
001100* 2) UNSETTLED FILE: IT WILL HAVE ALL THE INCOMM RECORDS NOT     *00110055
001110* MATCHED WITH KOHLS RECORDS.                                    *00111055
001111* 3) REPORT FILE: WILL HAVE VERIFIED, MISSING KOHLS AND MISSING  *00111155
001120* INCOMM RECORDS.                                                *00112055
001200*                                                                *00120019
001300* INPUT FILES:   SV-KOHLS-FILE             DDNAME = INP01        *00130024
001400*                SV-INCOMM-FILE            DDNAME = INP02        *00140024
001500*                                                                *00150019
001600* OUTPUT FILES:  POSTING-FILE              DDNAME = OUT01        *00160019
001700*                REPORT-FILE               DDNAME = OUT02        *00170019
001800*                UNSETTLED-FILE            DDNAME = OUT03        *00180019
001900*                                                                *00190019
002000******************************************************************00200019
C05013* HISTORY LOG:                                                   *00201067
C05013*                                                                *00202067
C05013*----------------------------------------------------------------*00203067
C05013* DATE: FEB 2015                                                 *00204067
C05013* CHANGE: CHG0105013                                             *00205067
C05013* PROGRAMMER: COGNIZANT                                          *00206067
C05013* DESCRIPTION: EXCLUDED THE CARD ACTIVATION DATE COMPARISON      *00207067
C05013*              BETWEEN INCOMM EXTRACT AND STORES VALUE EXTRACT TO*00208067
C05013*              REDUCE THE NUMBER OF CARDS IN UNSETTLED REPORTS   *00209067
002200******************************************************************00220019
002300 ENVIRONMENT DIVISION.                                            00230019
002400******************************************************************00240019
002500                                                                  00250019
002600 CONFIGURATION SECTION.                                           00260019
002700                                                                  00270019
002800 SOURCE-COMPUTER.    IBM-3090.                                    00280019
002900 OBJECT-COMPUTER.    IBM-3090.                                    00290019
003000                                                                  00300019
003100 INPUT-OUTPUT SECTION.                                            00310019
003200                                                                  00320019
003300 FILE-CONTROL.                                                    00330019
003400                                                                  00340019
003500     SELECT SV-KOHLS-FILE        ASSIGN TO INP01.                 00350024
003600     SELECT SV-INCOMM-FILE       ASSIGN TO INP02.                 00360024
003700     SELECT POSTING-FILE         ASSIGN TO OUT01.                 00370019
003800     SELECT REPORT-FILE          ASSIGN TO OUT02.                 00380019
003900     SELECT UNSETTLED-FILE       ASSIGN TO OUT03.                 00390019
004000                                                                  00400019
004100******************************************************************00410019
004200 DATA DIVISION.                                                   00420019
004300******************************************************************00430019
004400                                                                  00440019
004500 FILE SECTION.                                                    00450019
004600                                                                  00460019
004700 FD  SV-KOHLS-FILE                                                00470024
004800     RECORDING MODE IS F                                          00480019
004900     BLOCK CONTAINS 0 RECORDS                                     00490019
005000     LABEL RECORDS ARE OMITTED.                                   00500019
005100                                                                  00510019
005200 01  SV-KOHLS-RECORD              PIC  X(110).                    00520031
005300                                                                  00530019
005400 FD  SV-INCOMM-FILE                                               00540024
005500     RECORDING MODE IS F                                          00550019
005600     BLOCK CONTAINS 0 RECORDS                                     00560019
005700     LABEL RECORDS ARE OMITTED.                                   00570019
005800                                                                  00580019
005900 01  SV-INCOMM-RECORD             PIC  X(360).                    00590024
006000                                                                  00600019
006100 FD  POSTING-FILE                                                 00610019
006200     RECORDING MODE IS F                                          00620019
006300     BLOCK CONTAINS 0 RECORDS                                     00630019
006400     LABEL RECORDS ARE OMITTED.                                   00640019
006500                                                                  00650019
006600 01  POSTING-RECORD               PIC  X(250).                    00660031
006700                                                                  00670019
006800 FD  REPORT-FILE                                                  00680019
006900     RECORDING MODE IS F                                          00690019
007000     BLOCK CONTAINS 0 RECORDS                                     00700019
007100     LABEL RECORDS ARE OMITTED.                                   00710019
007200                                                                  00720019
007300 01  REPORT-RECORD                PIC  X(250).                    00730031
007400                                                                  00740019
007500 FD  UNSETTLED-FILE                                               00750019
007600     RECORDING MODE IS F                                          00760019
007700     BLOCK CONTAINS 0 RECORDS                                     00770019
007800     LABEL RECORDS ARE OMITTED.                                   00780019
007900                                                                  00790019
008000 01  UNSETTLED-RECORD             PIC  X(360).                    00800028
008100                                                                  00810019
008200 WORKING-STORAGE SECTION.                                         00820019
008300                                                                  00830019
008400******************************************************************00840019
008500*    PC-PROGRAM CONSTANTS                                        *00850019
008600******************************************************************00860019
008700 01  PC-PROGRAM-CONSTANTS.                                        00870019
008800     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'SVKUT072'. 00880019
008900                                                                  00890019
009000******************************************************************00900019
009100*    PV-PROGRAM VARIABLES                                        *00910019
009200******************************************************************00920019
009300 01  PV-PROGRAM-VARIABLES.                                        00930019
009310     05  SD-SYSTEM-DATE.                                          00931062
009320         10  SD-SYSTEM-YYYY           PIC  9(04) VALUE ZEROS.     00932062
009330         10  SD-SYSTEM-MM             PIC  9(02) VALUE ZEROS.     00933062
009340         10  SD-SYSTEM-DD             PIC  9(02) VALUE ZEROS.     00934062
009350     05  PV-TODAYS-DATE.                                          00935062
009360         10  PV-TODAYS-YYYY           PIC  9(04) VALUE ZEROS.     00936062
009361         10  FILLER                   PIC  X(01) VALUE '/'.       00936164
009362         10  PV-TODAYS-MM             PIC  9(02) VALUE ZEROS.     00936262
009363         10  FILLER                   PIC  X(01) VALUE '/'.       00936364
009364         10  PV-TODAYS-DD             PIC  9(02) VALUE ZEROS.     00936462
009400     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    00940019
009500     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    00950026
009510     05  PV-DB2-SQLCODE               PIC  S9(04) VALUE ZEROES.   00951053
009600     05  PV-INCOMM-CARD-NBR           PIC S9(12) COMP-3 VALUE +0. 00960019
009700     05  PV-INCOMM-REV-CARD-NBR       PIC S9(12) COMP-3 VALUE +0. 00970019
009710     05  PV-TODAY-MINUS-7-DAYS        PIC  X(10)     VALUE SPACES.00971053
009720     05  PV-TRN-AUTH-TMST.                                        00972053
009730         10 PV-TRN-AUTH-YYYY          PIC  9(04) VALUE ZEROES.    00973053
009740         10 FILLER                    PIC  X(01) VALUE '-'.       00974053
009750         10 PV-TRN-AUTH-MT            PIC  9(02) VALUE ZEROES.    00975053
009760         10 FILLER                    PIC  X(01) VALUE '-'.       00976053
009770         10 PV-TRN-AUTH-DD            PIC  9(02) VALUE ZEROES.    00977053
009780         10 FILLER                    PIC  X(01) VALUE '-'.       00978053
009790         10 PV-TRN-AUTH-HH            PIC  9(02) VALUE ZEROES.    00979053
009791         10 FILLER                    PIC  X(01) VALUE '.'.       00979153
009792         10 PV-TRN-AUTH-MN            PIC  9(02) VALUE ZEROES.    00979253
009793         10 FILLER                    PIC  X(01) VALUE '.'.       00979353
009794         10 PV-TRN-AUTH-SS            PIC  9(02) VALUE ZEROES.    00979453
009795         10 FILLER                    PIC  X(01) VALUE '.'.       00979553
009796         10 PV-TRN-AUTH-MS            PIC  9(06) VALUE ZEROES.    00979653
009797      05 PV-INCOMM-REF-ORDER.                                     00979753
009798         10 PV-INCOMM-REF             PIC  9(12) VALUE ZEROES.    00979853
009799         10 PV-INCOMM-UPC             PIC  9(15) VALUE ZEROES.    00979953
009800         10 PV-INCOMM-ORDER           PIC  9(02) VALUE ZEROES.    00980053
C05013*        10 PV-INCOMM-YYYY            PIC  9(04) VALUE ZEROES.    00980167
C05013*        10 PV-INCOMM-MM              PIC  9(02) VALUE ZEROES.    00980267
C05013*        10 PV-INCOMM-DD              PIC  9(02) VALUE ZEROES.    00980367
009804      05 PV-KOHLS-REF-ORDER.                                      00980453
009805         10 PV-KOHLS-REF              PIC  9(12) VALUE ZEROES.    00980553
009806         10 PV-KOHLS-UPC              PIC  9(15) VALUE ZEROES.    00980653
009807         10 PV-KOHLS-ORDER            PIC  9(02) VALUE ZEROES.    00980753
C05013*        10 PV-KOHLS-YYYY             PIC  9(04) VALUE ZEROES.    00980867
C05013*        10 PV-KOHLS-MM               PIC  9(02) VALUE ZEROES.    00980967
C05013*        10 PV-KOHLS-DD               PIC  9(02) VALUE ZEROES.    00981067
009811      05 PV-PROGRAM-ACCUMULATORS.                                 00981162
009812         10  PV-INCOMM-RECS-READ       PIC S9(11)     COMP-3      00981262
009813                                               VALUE ZEROES.      00981362
009814         10  PV-KOHLS-RECS-READ        PIC S9(11)     COMP-3      00981462
009815                                               VALUE ZEROES.      00981562
009816         10  PV-VERIFIED-RECS-WRITTEN  PIC S9(11)     COMP-3      00981662
009817                                               VALUE ZEROES.      00981762
009818         10  PV-MISSING-I-RECS-WRITTEN PIC S9(11)     COMP-3      00981862
009819                                               VALUE ZEROES.      00981962
009820         10  PV-MISSING-K-RECS-WRITTEN PIC S9(11)     COMP-3      00982062
009821                                               VALUE ZEROES.      00982162
009822         10  PV-KOHLS-RECS-SKIPPED     PIC S9(11)     COMP-3      00982262
009823                                               VALUE ZEROES.      00982362
009824         10  PV-INCOMM-RECS-SKIPPED    PIC S9(11)     COMP-3      00982462
009825                                               VALUE ZEROES.      00982562
009830                                                                  00983057
011100******************************************************************01110019
011200*    PS-PROGRAM SWITCHES                                         *01120019
011300******************************************************************01130019
011400 01  PS-PROGRAM-SWITCHES.                                         01140019
011500     05  PS-END-OF-SV-KOHLS-FILE-SW PIC    X(01) VALUE 'N'.       01150024
011600         88  PS-END-OF-SV-KOHLS-FILE             VALUE 'Y'.       01160024
011700                                                                  01170019
011800     05  PS-END-OF-RECON-FILE-SW      PIC  X(01) VALUE 'N'.       01180019
011900         88  PS-END-OF-SV-INCOMM-FILE            VALUE 'Y'.       01190024
012000                                                                  01200019
012100 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01210019
012200                                                  COMP.           01220019
012300     88  AC-DATASET-DATA-ERROR                    VALUE +4008.    01230019
012400                                                                  01240019
012500******************************************************************01250019
012600*    DAILY EXTRACT RECORD LAYOUT                                 *01260019
012700******************************************************************01270019
012800     COPY SVRD071.                                                01280019
012900                                                                  01290019
013000******************************************************************01300019
013100*    SV-INCOMM FILE LAYOUT                                       *01310024
013200******************************************************************01320019
013300     COPY SVRD070.                                                01330019
013400                                                                  01340019
013500******************************************************************01350019
013600*  RECONCILIATION DETAIL FILE LAYOUT                             *01360019
013700******************************************************************01370019
013800     COPY SVRD072.                                                01380019
013900                                                                  01390019
013910******************************************************************01391026
013920*    SV-KOHL'S STORED VALUE 3RD PARTY TRAN TABLE                 *01392026
013930******************************************************************01393026
013940     EXEC SQL                                                     01394026
013950         INCLUDE SVT00015                                         01395026
013960     END-EXEC.                                                    01396026
013970                                                                  01397026
013971******************************************************************01397126
013972*    SV-KOHL'S STORED VALUE CARD STK DENOMINATION TABLE          *01397226
013973******************************************************************01397326
013974     EXEC SQL                                                     01397426
013975         INCLUDE SVT00008                                         01397526
013976     END-EXEC.                                                    01397626
013977                                                                  01397726
013978******************************************************************01397826
013979*    SV-KOHL'S STORED VALUE CARD ACTIVITY TABLE                  *01397926
013980******************************************************************01398026
013981     EXEC SQL                                                     01398126
013982         INCLUDE SVT00002                                         01398226
013983     END-EXEC.                                                    01398326
013984                                                                  01398426
013985******************************************************************01398526
013990*    SV-KOHL'S STORED VALUE CARD TABLE                           *01399026
013991******************************************************************01399126
013992     EXEC SQL                                                     01399226
013993         INCLUDE SVT00001                                         01399326
013994     END-EXEC.                                                    01399426
013995                                                                  01399526
013996                                                                  01399626
013997******************************************************************01399726
013998*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *01399826
013999******************************************************************01399926
014000     EXEC SQL                                                     01400026
014001         INCLUDE SQLCA                                            01400126
014002     END-EXEC.                                                    01400226
014003                                                                  01400326
014004     COPY SQLCA2.                                                 01400426
014005                                                                  01400526
014010******************************************************************01401019
014100* PROCEDURE DIVISION                                             *01410019
014200******************************************************************01420019
014300 PROCEDURE DIVISION.                                              01430019
014400                                                                  01440019
014500 0000-MAINLINE-PROCESSING.                                        01450019
014600                                                                  01460019
014700     PERFORM 1000-INITIALIZE-PROGRAM.                             01470019
014800                                                                  01480019
014900     PERFORM 2000-MATCH-INPUT-FILES                               01490019
015000       UNTIL PS-END-OF-SV-KOHLS-FILE                              01500024
015100          OR PS-END-OF-SV-INCOMM-FILE.                            01510024
015200                                                                  01520019
015300     IF PS-END-OF-SV-KOHLS-FILE                                   01530024
015400        PERFORM                                                   01540027
015401           UNTIL PS-END-OF-SV-INCOMM-FILE                         01540127
015402                                                                  01540227
015410           PERFORM 2600-PROCESS-MISSING-KOHLS                     01541049
015460        END-PERFORM                                               01546027
015600     END-IF.                                                      01560019
015700                                                                  01570019
015800     IF PS-END-OF-SV-INCOMM-FILE                                  01580024
015900        PERFORM                                                   01590035
015901           UNTIL PS-END-OF-SV-KOHLS-FILE                          01590127
015902                                                                  01590227
015910           PERFORM 2400-PROCESS-MISSING-INCOMM                    01591049
015950        END-PERFORM                                               01595049
016100     END-IF.                                                      01610019
016200                                                                  01620019
016210     PERFORM 9000-END-OF-JOB.                                     01621058
016220                                                                  01622058
016900     GOBACK.                                                      01690019
017000                                                                  01700019
017100******************************************************************01710019
017200* 1000-INITIALIZE-PROGRAM : OPEN INPUT AND OUTPUT FILES AND      *01720019
017300* PERFORM AN INITIAL READ OF THE INPUT FILE.                     *01730019
017400******************************************************************01740019
017500 1000-INITIALIZE-PROGRAM.                                         01750019
017600                                                                  01760019
017700     OPEN INPUT  SV-KOHLS-FILE                                    01770024
017800                 SV-INCOMM-FILE                                   01780024
017900          OUTPUT POSTING-FILE                                     01790019
018000                 REPORT-FILE                                      01800019
018100                 UNSETTLED-FILE.                                  01810019
018200                                                                  01820019
018201     ACCEPT SD-SYSTEM-DATE  FROM DATE YYYYMMDD.                   01820162
018202     MOVE SD-SYSTEM-YYYY    TO PV-TODAYS-YYYY.                    01820262
018203     MOVE SD-SYSTEM-MM      TO PV-TODAYS-MM.                      01820362
018204     MOVE SD-SYSTEM-DD      TO PV-TODAYS-DD.                      01820462
018205                                                                  01820562
018206**   ACCEPT TODAYS DATE AND SUBTRACT 7 DAYS FROM IT.            **01820626
018207     PERFORM S100-GET-COMPARE-DATE.                               01820726
018208     PERFORM 8000-READ-SV-INCOMM-FILE.                            01820824
018213     PERFORM 7000-READ-SV-KOHLS-FILE.                             01821339
018215                                                                  01821519
018700******************************************************************01870019
018800* 2000-MATCH-INPUT-FILES                                         *01880019
018910* COMPARE DAILY INCOMM REPORT FILE AND KOHLS EXTRACT FILE READING*01891055
018911* ONE RECORD FROM EACH FILE AT A TIME. IF THE RECORDS MATCH, THE *01891155
018912* RECORD IS MARKED 'VERIFIED', IF NOT, THEN DEPENDING UPON WHICH *01891255
018913* COMAPRE FIELDS ARE LESS, THE RECORD IS MARKED EITHER MISSING   *01891355
018914* KOHLS OR MISSING INCOMM.                                       *01891455
018915* THE FIELDS COMPARED :                                          *01891555
018920* INCOMM-REF-NBR, UPC, TRANSACTION TYPE, TRANS-DATE, TRANS-AMT   *01892055
019000******************************************************************01900019
019100 2000-MATCH-INPUT-FILES.                                          01910019
019200                                                                  01920019
019210     MOVE SV070-INCOMM-REF-NO   TO PV-INCOMM-REF.                 01921053
019211     MOVE SV070-UPC             TO PV-INCOMM-UPC.                 01921153
019220     MOVE SV070-TRANS-ORDER     TO PV-INCOMM-ORDER.               01922053
C05013*    MOVE SV070-TRANS-DATE(1:4) TO PV-INCOMM-YYYY.                01922167
C05013*    MOVE SV070-TRANS-DATE(6:2) TO PV-INCOMM-MM.                  01922267
C05013*    MOVE SV070-TRANS-DATE(9:2) TO PV-INCOMM-DD.                  01922367
019230                                                                  01923041
019240     MOVE SV071-POS-REF-NO      TO PV-KOHLS-REF.                  01924053
019241     MOVE SV071-UPC-NBR         TO PV-KOHLS-UPC.                  01924153
019250     MOVE SV071-TRANS-ORDER     TO PV-KOHLS-ORDER.                01925053
C05013*    MOVE SV071-POS-DTE(1:4)    TO PV-KOHLS-YYYY.                 01925167
C05013*    MOVE SV071-POS-DTE(6:2)    TO PV-KOHLS-MM.                   01925267
C05013*    MOVE SV071-POS-DTE(9:2)    TO PV-KOHLS-DD.                   01925367
019260                                                                  01926041
019291* VERIFIED                                                        01929153
019300     IF PV-INCOMM-REF-ORDER = PV-KOHLS-REF-ORDER                  01930041
019400        PERFORM 2200-PROCESS-VERIFIED                             01940044
020134     ELSE                                                         02013419
020135* MISSING IMCOMM                                                  02013519
020137        IF PV-INCOMM-REF-ORDER > PV-KOHLS-REF-ORDER               02013741
020138           PERFORM 2400-PROCESS-MISSING-INCOMM                    02013844
020164        ELSE                                                      02016429
020165* MISSING KOHLS                                                   02016529
020166           IF PV-INCOMM-REF-ORDER < PV-KOHLS-REF-ORDER            02016641
020167              PERFORM 2600-PROCESS-MISSING-KOHLS                  02016744
020191           END-IF                                                 02019129
020192        END-IF                                                    02019229
020193     END-IF.                                                      02019329
025500                                                                  02550019
025600******************************************************************02560019
025700* 2200-PROCESS-VERIFIED                                          *02570044
025800* MARK AS 'VERIFIED' IF THE TRANS-AMT IS SAME. READ BOTH REPORT  *02580055
025801* AND EXTRACT FILE IN CASE OF VERIFIED. IF THE TRANS-AMT         *02580155
025803* IS NOT SAME, THEN PROCESS EITHER MISSING-INCOMM OR MISSING-KOHS*02580355
025810* DEPENDING UPON WHICH TRANS-AMT IS LESS.                        *02581055
025900******************************************************************02590019
026000 2200-PROCESS-VERIFIED.                                           02600044
026100                                                                  02610019
026112     IF SV070-TRANS-AMOUNT = SV071-APP-AUTH-AMT                   02611245
026113        INITIALIZE SV072-DETAIL-TRANS                             02611349
026114        EVALUATE SV070-TRANS-ORDER                                02611445
026115           WHEN 00                                                02611545
026117                SET SV072-RF-VERIFIED-ACTIV    TO TRUE            02611745
026118           WHEN 02                                                02611845
026119                SET SV072-RF-VERIFIED-DEACTIV  TO TRUE            02611945
026120           WHEN 01                                                02612045
026121                SET SV072-RF-VERIFIED-A-REVERS TO TRUE            02612145
026122           WHEN 03                                                02612245
026124                SET SV072-RF-VERIFIED-D-REVERS TO TRUE            02612445
026125        END-EVALUATE                                              02612545
026126        PERFORM 3000-MOVE-COMBINED-DATA                           02612649
026127        ADD +1 TO PV-VERIFIED-RECS-WRITTEN                        02612756
026128        WRITE POSTING-RECORD FROM SV072-DETAIL-TRANS              02612849
026129        WRITE REPORT-RECORD FROM SV072-DETAIL-TRANS               02612949
026130        PERFORM 8000-READ-SV-INCOMM-FILE                          02613049
026131        PERFORM 7000-READ-SV-KOHLS-FILE                           02613149
026132     ELSE                                                         02613245
026134        IF SV070-TRANS-AMOUNT > SV071-APP-AUTH-AMT                02613452
026135           PERFORM 2400-PROCESS-MISSING-INCOMM                    02613545
026136        ELSE                                                      02613645
026137           PERFORM 2600-PROCESS-MISSING-KOHLS                     02613745
026138        END-IF                                                    02613845
026139     END-IF.                                                      02613945
026152                                                                  02615244
026153******************************************************************02615344
026154* 2400-PROCESS-MISSING-INCOMM                                    *02615444
026155* WE DON'T WANT TO DISPLAY THE KOHLS RECORDS IF THEY ARE MORE    *02615555
026156* THAN 7 DAYS OLD ON THE AUDIT REPORT. SO WHILE PROCESSING       *02615655
026157* MISSING INCOMM RECORDS, CHECK IF THE KOHLS RECORD IS MORE THAN *02615755
026158* 7-DAYS OLD. IF IT IS, THEN DON'T WRITE IT TO THE OUTPUT FILE   *02615855
026163******************************************************************02616344
026164 2400-PROCESS-MISSING-INCOMM.                                     02616444
026165                                                                  02616544
026170     IF SV071-POS-DTE >= PV-TODAY-MINUS-7-DAYS                    02617044
026172        INITIALIZE SV072-DETAIL-TRANS                             02617249
026173        EVALUATE SV071-TRANS-ORDER                                02617344
026174           WHEN 00                                                02617444
026175                SET SV072-RF-MISSING-I-ACTIV   TO TRUE            02617544
026176           WHEN 02                                                02617644
026177                SET SV072-RF-MISSING-I-DEACTIV TO TRUE            02617744
026178           WHEN 01                                                02617844
026179                SET SV072-RF-MISSING-I-A-REVERS TO TRUE           02617944
026180           WHEN 03                                                02618044
026181                SET SV072-RF-MISSING-I-D-REVERS TO TRUE           02618144
026182        END-EVALUATE                                              02618244
026183        PERFORM 5000-MOVE-KOHLS-DATA                              02618344
026184        ADD +1 TO PV-MISSING-I-RECS-WRITTEN                       02618457
026185        WRITE REPORT-RECORD FROM SV072-DETAIL-TRANS               02618544
026186     ELSE                                                         02618659
026187        ADD +1 TO PV-KOHLS-RECS-SKIPPED                           02618759
026188     END-IF.                                                      02618844
026189     PERFORM 7000-READ-SV-KOHLS-FILE.                             02618954
026190                                                                  02619044
026191******************************************************************02619144
026192* 2600-PROCESS-MISSING-KOHLS                                     *02619244
026193* PROCESS INCOMM RECORDS THAT DON'T HAVE A MATCHING KOHLS RECORD *02619353
026194******************************************************************02619444
026195 2600-PROCESS-MISSING-KOHLS.                                      02619544
026196                                                                  02619644
026198     IF SV070-REPORT-DATE = SPACES                                02619860
026199        MOVE PV-TODAYS-DATE TO SV070-REPORT-DATE                  02620063
026200     END-IF.                                                      02620160
026201                                                                  02620260
026202     IF SV070-REPORT-DATE >= PV-TODAY-MINUS-7-DAYS                02620363
026197        INITIALIZE SV072-DETAIL-TRANS                             02620663
026208        EVALUATE SV070-TRANS-ORDER                                02620861
026209            WHEN 00                                               02620961
026210                 SET SV072-RF-MISSING-K-ACTIV   TO TRUE           02621061
026211            WHEN 02                                               02621161
026212                 SET SV072-RF-MISSING-K-DEACTIV TO TRUE           02621261
026213            WHEN 01                                               02621361
026214                 SET SV072-RF-MISSING-K-A-REVERS TO TRUE          02621461
026215            WHEN 03                                               02621561
026216                 SET SV072-RF-MISSING-K-D-REVERS TO TRUE          02621661
026217        END-EVALUATE                                              02621761
026218        PERFORM 4000-MOVE-INCOMM-DATA                             02621861
026219        ADD +1 TO PV-MISSING-K-RECS-WRITTEN                       02621961
026220        WRITE UNSETTLED-RECORD FROM                               02622061
026221                      SV070-SETTLEMENT-RECORD                     02622161
026222        WRITE REPORT-RECORD FROM SV072-DETAIL-TRANS               02622261
026224     ELSE                                                         02622461
026225        ADD +1 TO PV-INCOMM-RECS-SKIPPED                          02622761
026226     END-IF.                                                      02622861
026227     PERFORM 8000-READ-SV-INCOMM-FILE.                            02622961
026228                                                                  02623044
026229******************************************************************02623144
026230* 3000-MOVE-CONBINED-DATA                                        *02623244
026231* MOVE THE INPUT DATA VARIABLES TO THE OUTPUT DATA VARIABLES.    *02623344
026232******************************************************************02623444
026233 3000-MOVE-COMBINED-DATA.                                         02623544
026240                                                                  02624044
026310     MOVE SV070-TRANS-DATE         TO SV072-TRANS-DATE.           02631050
026700     MOVE SV070-TRANS-AMOUNT       TO SV072-TRANS-AMOUNT.         02670028
026900     MOVE SV070-UPC                TO SV072-UPC.                  02690024
027000     MOVE SV070-INCOMM-REF-NO      TO SV072-INCOMM-REF-NO.        02700028
027100     MOVE SV070-VAN16              TO SV072-VAN16.                02710024
027101     MOVE SV070-MERCHANT           TO SV072-MERCHANT.             02710124
027102     MOVE SV070-LOCATION           TO SV072-LOCATION.             02710224
027103     MOVE SV070-TRANS-ORDER        TO SV072-TRANS-ORDER.          02710341
027110*                                                                 02711024
027111     MOVE SV071-CRD-NBR            TO SV072-CARD-NBR.             02711124
027130     MOVE SV071-SELR-NM            TO SV072-SELR-NM.              02713051
027140     MOVE SV071-TRN-AUTH-TMST      TO SV072-TRN-AUTH-TMST.        02714031
027200                                                                  02720019
027201******************************************************************02720124
027202* 4000-MOVE-INCOMM-DATA                                          *02720224
027203* MOVE THE INPUT DATA VARIABLES TO THE OUTPUT DATA VARIABLES.    *02720324
027204******************************************************************02720424
027205 4000-MOVE-INCOMM-DATA.                                           02720524
027206                                                                  02720624
027209     MOVE SV070-TRANS-DATE         TO SV072-TRANS-DATE.           02720950
027214     MOVE SV070-TRANS-AMOUNT       TO SV072-TRANS-AMOUNT.         02721428
027215     MOVE SV070-UPC                TO SV072-UPC.                  02721524
027216     MOVE SV070-INCOMM-REF-NO      TO SV072-INCOMM-REF-NO.        02721628
027217     MOVE SV070-VAN16              TO SV072-VAN16.                02721724
027218     MOVE SV070-MERCHANT           TO SV072-MERCHANT.             02721824
027219     MOVE SV070-LOCATION           TO SV072-LOCATION.             02721924
027220     MOVE SV070-TRANS-ORDER        TO SV072-TRANS-ORDER.          02722041
027222**********                                                        02722248
027223     UNSTRING SV070-TRANS-DATE                                    02722348
027224          DELIMITED BY ALL '/'                                    02722448
027225          INTO PV-TRN-AUTH-MT                                     02722548
027226               PV-TRN-AUTH-DD                                     02722648
027227               PV-TRN-AUTH-YYYY.                                  02722748
027228     UNSTRING SV070-TRANS-TIME                                    02722848
027229          DELIMITED BY ALL ':'                                    02722948
027230          INTO PV-TRN-AUTH-HH                                     02723048
027231               PV-TRN-AUTH-MN                                     02723148
027232               PV-TRN-AUTH-SS.                                    02723248
027233     MOVE PV-TRN-AUTH-TMST         TO SV072-TRN-AUTH-TMST.        02723348
027234                                                                  02723448
027235******************************************************************02723548
027236* 5000-MOVE-KOHLS-DATA                                           *02723648
027237* MOVE THE INPUT DATA VARIABLES TO THE OUTPUT DATA VARIABLES.    *02723748
027238******************************************************************02723848
027239 5000-MOVE-KOHLS-DATA.                                            02723948
027240                                                                  02724048
027242     MOVE SV071-POS-DTE            TO SV072-TRANS-DATE.           02724250
027250     MOVE SV071-APP-AUTH-AMT       TO SV072-TRANS-AMOUNT.         02725028
027260     MOVE SV071-POS-REF-NO         TO SV072-INCOMM-REF-NO.        02726028
027261     MOVE SV071-CRD-NBR            TO SV072-CARD-NBR.             02726124
027262     MOVE SV071-TRN-AUTH-TMST      TO SV072-TRN-AUTH-TMST.        02726231
027264     MOVE SV071-SELR-NM            TO SV072-SELR-NM.              02726451
027265     MOVE SV071-TRANS-ORDER        TO SV072-TRANS-ORDER.          02726541
027266     MOVE SV071-UPC-NBR            TO SV072-UPC.                  02726652
027313                                                                  02731324
027340******************************************************************02734026
027400* 7000-READ-SV-KOHLS-FILE                                        *02740024
027500*    READ THE INPUT FILE AND SET THE END OF FILE SWITCH WHEN     *02750019
027600*    THERE IS NO MORE RECORDS TO READ.                           *02760019
027700******************************************************************02770019
027800 7000-READ-SV-KOHLS-FILE.                                         02780024
027900                                                                  02790019
028000     READ SV-KOHLS-FILE INTO SV071-KMCACT-EXTRACT-RECORD          02800024
028100         AT END                                                   02810019
028200             SET PS-END-OF-SV-KOHLS-FILE TO TRUE.                 02820024
028300                                                                  02830019
028310     IF NOT PS-END-OF-SV-KOHLS-FILE                               02831057
028320        ADD +1 TO PV-KOHLS-RECS-READ                              02832057
028330     END-IF.                                                      02833057
028340                                                                  02834057
028400******************************************************************02840019
028500* 8000-READ-SV-INCOMM-FILE                                       *02850024
028600*    READ THE INPUT FILE AND SET THE END OF FILE SWITCH WHEN     *02860019
028700*    THERE IS NO MORE RECORDS TO READ.                           *02870019
028800******************************************************************02880019
028900 8000-READ-SV-INCOMM-FILE.                                        02890024
029000                                                                  02900019
029100     READ SV-INCOMM-FILE INTO SV070-SETTLEMENT-RECORD             02910028
029200         AT END                                                   02920019
029300             SET PS-END-OF-SV-INCOMM-FILE TO TRUE.                02930024
029301                                                                  02930157
029310     IF NOT PS-END-OF-SV-INCOMM-FILE                              02931057
029320        ADD +1 TO PV-INCOMM-RECS-READ                             02932057
029330     END-IF.                                                      02933057
029400                                                                  02940019
029401******************************************************************02940157
029402* 9000-END-OF-JOB                                                *02940258
029405******************************************************************02940557
029406 9000-END-OF-JOB.                                                 02940658
029410                                                                  02941058
029411     CLOSE SV-KOHLS-FILE                                          02941158
029412           SV-INCOMM-FILE                                         02941258
029413           POSTING-FILE                                           02941358
029414           REPORT-FILE                                            02941458
029415           UNSETTLED-FILE.                                        02941558
029416                                                                  02941658
029417     DISPLAY ' '.                                                 02941758
029418     DISPLAY '**********************************************'.    02941859
029419     DISPLAY '  OUTPUT FOR PROGRAM ' PC-PROGRAM-NAME              02941958
029420     DISPLAY '**********************************************'.    02942059
029421     DISPLAY '  RECORDS READ FROM INCOMM REPORT FILE: '           02942158
029422                                        PV-INCOMM-RECS-READ.      02942258
029423     DISPLAY '  RECORDS READ FROM KOHLS EXTRACT FILE: '           02942358
029424                                        PV-KOHLS-RECS-READ.       02942459
029425     DISPLAY ' '.                                                 02942559
029426     DISPLAY '**********************************************'.    02942659
029428     DISPLAY '  VERIFIED RECORDS WRITTEN             : '          02942861
029429                                   PV-VERIFIED-RECS-WRITTEN.      02942959
029430     DISPLAY '  MISSING INCOMM RECORDS WRITTEN       : '          02943061
029431                                   PV-MISSING-I-RECS-WRITTEN.     02943159
029432     DISPLAY '  MISSING KOHLS RECORDS WRITTEN        : '          02943261
029433                                   PV-MISSING-K-RECS-WRITTEN.     02943359
029434     DISPLAY '  KOHLS OLDER THAN 7-DAY RECS SKIPPED  : '          02943461
029435                                   PV-KOHLS-RECS-SKIPPED.         02943559
029436     DISPLAY '  INCOMM OLDER THAN 7-DAY RECS SKIPPED : '          02943661
029437                                   PV-INCOMM-RECS-SKIPPED.        02943764
029438     DISPLAY '**********************************************'.    02943861
029439     DISPLAY ' '.                                                 02943961
029440                                                                  02944061
029441                                                                  02944161
029442******************************************************************02944261
029443* SELECT TODAYS DATE AND SUBTRACT 7 DAYS                          02944361
029444******************************************************************02944461
029445 S100-GET-COMPARE-DATE.                                           02944561
029450     MOVE 'S100-GET-COMPARE-DATE'        TO PV-PARAGRAPH-NAME.    02945026
029460                                                                  02946026
029470     EXEC SQL                                                     02947026
029480         SELECT (CURRENT DATE - 7 DAY)                            02948026
029490           INTO :PV-TODAY-MINUS-7-DAYS                            02949026
029491           FROM SYSIBM.SYSDUMMY1                                  02949126
029492           WITH UR                                                02949226
029493     END-EXEC.                                                    02949326
029494                                                                  02949426
029495     EVALUATE SQLCODE                                             02949526
029496         WHEN 0                                                   02949626
029497             MOVE '/' TO PV-TODAY-MINUS-7-DAYS(5:1)               02949759
029498                         PV-TODAY-MINUS-7-DAYS(8:1)               02949859
029499             DISPLAY 'CUTOFF DATE FOR KOHLS TRANS: '              02949956
029500                     PV-TODAY-MINUS-7-DAYS                        02950056
029501         WHEN OTHER                                               02950126
029502             MOVE 'S100-GET-COMPARE-DATE'                         02950226
029503                                           TO PV-PARAGRAPH-NAME   02950326
029504             MOVE 'ERROR SELECTING PROCESSING DATE'               02950426
029505                                  TO PV-DB2-OPERATION-ATTEMPTED   02950526
029506             MOVE SQLCODE                                         02950635
029507                                  TO SQLCODE2                     02950736
029508             PERFORM Z900-SQL-ABEND                               02950835
029509     END-EVALUATE.                                                02950935
029510                                                                  02951035
035700******************************************************************03570026
035800*     Z900-SQL-ABEND                                             *03580026
035900* ==> PROCESSES:                                                 *03590026
036000*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *03600026
036100* ==> PERFORMED FROM:                                            *03610026
036200******************************************************************03620026
036300 Z900-SQL-ABEND.                                                  03630026
036400                                                                  03640026
036500     DISPLAY 'Z900-SQL-ABEND'.                                    03650026
036600     DISPLAY '**  ABEND     **'.                                  03660026
036700     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               03670026
036800     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             03680026
036900     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    03690026
036910     DISPLAY '**  SQLCODE   ** = ' SQLCODE2.                      03691036
037000                                                                  03700026
037100******************************************************************03710026
