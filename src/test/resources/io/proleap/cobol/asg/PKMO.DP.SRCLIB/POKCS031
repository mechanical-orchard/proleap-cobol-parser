000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    POKCS031.                                         00030000
000400 AUTHOR.        TOM RUSKA. G&R.                                   00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  08/31/93.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*---------------------------------------------------------------* 00090000
001000*    TRANID      - W031                                         * 00100000
001100*    TYPE        - CICS ARCHITECTURE INQUIRY - DB2              * 00110000
001200*    DESCRIPTION - PURCHASE ORDER HEADER INQUIRY                * 00120000
001300*    MAPSET      - POKM031                                      * 00130000
001400*                                                               * 00140000
001500*    THIS PROGRAM ALLOWS ONE TO VIEW INFORMATION FOR A GIVEN    * 00150000
001600*    PURCHASE ORDER.                                            * 00160000
001700*                                                               * 00170000
001800*---------------------------------------------------------------* 00180000
001900*                                                               * 00190000
002000*    ADDED THE ANALYST HOLD INDICATOR FIELD TO THE SCREEN.      * 00200000
002100*                                                               * 00210000
002200*    JEFF BOLWERK              08/11/95    WR#                  * 00220000
002300*---------------------------------------------------------------* 00230000
      *  WR4960 - CHANGED 3/30/00 - SUE BARTELT - TKMA537             * 00240000
      *  PROGRAM CHANGED BY ADDING NEW F KEY. F13=PACKSUM             * 00250000
      *  GOES TO POLPKINS (POKCS108).                                 * 00260000
      *---------------------------------------------------------------* 00270000
001280* DATE  09/2000, K. SCHOLEY, S. BARTELT, D. DARR                * 00280000
001290*   WR21302 MOVE DISCOUNT PAYMENT TERMS AND DISCOUNT LOGIC      * 00290000
      *   TO NEW "DEALS" PROGRAM.  FUNCTION F22 WILL TRANSFER TO      * 00300000
      *   NEW MENU PROGRAM FOR PRINTING PO OR SHIP INSTRUCTIONS.      * 00310000
      *   FUNCTION F23 WILL TRANSFER TO NEW DEALS PROGRAM TO          * 00320000
      *   INQUIRE ON ADDITIONAL DISCOUNT DATA.                        * 00330000
001300*---------------------------------------------------------------* 00340000
W24803*                                                               * 00341000
W24803* 04/23/03 - S PRABHAKAR RAO - WR NO. 24803                     * 00342000
W24803*    - REPLACED ALL REFERENCES TO SKU NUMBER WITH ITEM NUMBER.  * 00343000
W24803*    - REMOVED ALL THE INCLUDES OF TABLES THAT ARE NOT USED.    * 00345000
W24803*                                                               * 00346000
001300*---------------------------------------------------------------* 00348058
001400* CHANGE DESCRIPTION                                              00348259
001300*---------------------------------------------------------------* 00348359
001300*                                                               * 00349059
001400* 09/08/10 - PRASHANTH PEJAVER                                  * 00349159
001300*    - INCLUDE CHANGES TO DISPLAY WAREHOUSE REPLENISHMENT       * 00349259
001300*      INDICATOR.                                               * 00349359
001400*                                                               * 00349459
002200* CHANGES TAGGED AS PP 09/08/2010                                 00349559
002300*---------------------------------------------------------------* 00349659
C94517*                                                               * 00349763
C94517* 11/05/14 - JOHN SELWITSCHKA - CHG0094517                      * 00349863
C94517*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND CHANGED        * 00349963
C94517*      PROGRAM DUE TO TRWS001 COPYBOOK CHANGE.                  * 00350163
002300* 03/2021 - JEAN KURK                                           * 00350271
002301*    - REMOVE TABLE TPORESV                                     * 00350365
002302*---------------------------------------------------------------* 00350465
CICS  *  CHANGED 11/10/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00351072
CICS  *                                                               * 00352071
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00353071
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00354071
002302*---------------------------------------------------------------* 00354171
002301*    - REMOVE TABLE TPORESV                                     * 00355071
002500 ENVIRONMENT DIVISION.                                            00360000
002600 DATA DIVISION.                                                   00370000
002700/                                                                 00380000
002800 WORKING-STORAGE SECTION.                                         00390000
002900                                                                  00400000
003000 01  DK-DB2-KEYS.                                                 00410000
003100     05  DK-DEPT-NBR                  PIC X(03)  VALUE SPACES.    00420000
003200     05  DK-PO-TYP-CDE                PIC X(02)  VALUE SPACES.    00430000
003300     05  DK-STATUS-CDE                PIC X(02)  VALUE SPACES.    00440000
003400     05  DK-PO-NBR                    PIC S9(09) VALUE +0         00450000
003500                                                 COMP.            00460000
003600     05  DK-ENT-NAME-DESC             PIC X(30)  VALUE SPACES.    00470000
003700     05  DK-AGRMT-TYP-ID              PIC X(01)  VALUE SPACES.    00480000
003800     05  DK-ENT-ID                    PIC S9(09) VALUE +0         00490000
003900                                                 COMP.            00500000
004000     05  DK-PAYT-TERM-ID              PIC S9(04) VALUE +0         00510000
004100                                                 COMP.            00520000
004200     05  DK-TYP-CDE                   PIC S9(04) VALUE +0         00530000
004300                                                 COMP.            00540000
004400     05  DK-ADR-SEQ-NBR               PIC S9(04) COMP.            00550000
004500                                                                  00560000
004600 01  PC-PROGRAM-CONSTANTS.                                        00570000
004700     05  PC-TRANS-ID                  PIC X(04)  VALUE 'W031'.    00580000
004800     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'POKCS031'.00590000
004900     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'PO031A  '.00600000
005000     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'POKM031 '.00610000
005100     05  PC-APPL-MAP                  PIC S9(04) VALUE  +1        00620000
005200                                                 COMP.            00630000
005300     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00640000
005400                                                 COMP.            00650000
005402     05  PC-DPKUT410                  PIC  X(08) VALUE            00660000
005403                                                 'DPKUT410'.      00670000
005500     05  PC-NULL-TMST                 PIC X(26)  VALUE            00680000
005600                                 '9999-09-09-09.09.09.999999'.    00690000
005700     05  PC-INTER-APPL-CODES.                                     00700000
005800         10  PC-INTER-APPL-CRIT       PIC X(01)  VALUE ' '.       00710000
005900         10  PC-INTER-APPL-LIST       PIC X(01)  VALUE '1'.       00720000
006000         10  PC-INTER-APPL-PO-LIST    PIC X(01)  VALUE '2'.       00730000
006100                                                                  00740000
006200     05  PC-TSYMSG-NUMBERS.                                       00750000
006300         10  PC-TSYMSG-00069          PIC 9(05)  VALUE 00069.     00770000
006400         10  PC-TSYMSG-00070          PIC 9(05)  VALUE 00070.     00780000
006500         10  PC-TSYMSG-00083          PIC 9(05)  VALUE 00083.     00790000
006600         10  PC-TSYMSG-00148          PIC 9(05)  VALUE 00148.     00800000
006700         10  PC-TSYMSG-00461          PIC 9(05)  VALUE 00461.     00810000
006800         10  PC-TSYMSG-01189          PIC 9(05)  VALUE 01189.     00820000
006900                                                                  00830000
007000     05  PC-MONTH-ABBR-TABLE.                                     00840000
007100         10  FILLER                   PIC  X(03) VALUE 'JAN'.     00850000
007200         10  FILLER                   PIC  X(03) VALUE 'FEB'.     00860000
007300         10  FILLER                   PIC  X(03) VALUE 'MAR'.     00870000
007400         10  FILLER                   PIC  X(03) VALUE 'APR'.     00880000
007500         10  FILLER                   PIC  X(03) VALUE 'MAY'.     00890000
007600         10  FILLER                   PIC  X(03) VALUE 'JUN'.     00900000
007700         10  FILLER                   PIC  X(03) VALUE 'JUL'.     00910000
007800         10  FILLER                   PIC  X(03) VALUE 'AUG'.     00920000
007900         10  FILLER                   PIC  X(03) VALUE 'SEP'.     00930000
008000         10  FILLER                   PIC  X(03) VALUE 'OCT'.     00940000
008100         10  FILLER                   PIC  X(03) VALUE 'NOV'.     00950000
008200         10  FILLER                   PIC  X(03) VALUE 'DEC'.     00960000
008300     05  FILLER REDEFINES PC-MONTH-ABBR-TABLE.                    00970000
008400         10  PC-MONTH-ABBR OCCURS 12 TIMES                        00980000
008500                                      PIC  X(03).                 00990000
008600                                                                  01000000
008700 01  PS-PROGRAM-SWITCHES.                                         01010000
008800     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       01020000
008900         88  PS-ERROR                            VALUE 'Y'.       01030000
009000         88  PS-NO-ERROR                         VALUE 'N'.       01040000
009100     05  PS-COMMAREA-SW               PIC  X(01) VALUE 'N'.       01050000
009200         88  PS-COMMAREA-VALID                   VALUE 'Y'.       01060000
009300         88  PS-COMMAREA-NOT-VALID               VALUE 'N'.       01070000
009400     05  PS-LIST-END-SW               PIC X(01)  VALUE 'N'.       01080000
009500         88  PS-LIST-END                         VALUE 'Y'.       01090000
009600         88  PS-NO-LIST-END                      VALUE 'N'.       01100000
009700                                                                  01110000
009800 01  PV-PROGRAM-VARIABLES.                                        01120000
009900     05  PV-CICS-RESPONSE             PIC S9(04) VALUE +0         01130000
010000                                                 COMP SYNC.       01140000
010100     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         01150000
010200                                                 COMP SYNC.       01160000
010300     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         01170000
010400                                                 COMP-3.          01180000
010500     05  PV-NULL-IND                  PIC S9(04) VALUE +0         01190000
010600                                                 COMP SYNC.       01200000
010700                                                                  01210000
010702     05  PV-STATE-PROV                PIC  X(20).                 01221069
010703     05  PV-DPKUT410-COMMAREA         PIC  X(01)   VALUE SPACES.  01230000
010705     05  PV-ADDR1                     PIC  X(35).                 01240000
010706     05  PV-ADDR2                     PIC  X(35).                 01250000
010707     05  PV-CITY                      PIC  X(15).                 01260000
010708     05  PV-STATE                     PIC  X(02).                 01270000
010709     05  PV-ZIP                       PIC  X(12).                 01280000
010710     05  PV-COUNTRY                   PIC  X(20).                 01290000
010720     05  PV-PROVINCE                  PIC  X(20).                 01300000
010730     05  PV-ATTN                      PIC  X(40).                 01310000
010740     05  PV-ROOM                      PIC  X(10).                 01320000
010750     05  PV-DB2-DATE-HOST             PIC  X(10).                 01330000
010760     05  PV-DB2-DATE                  PIC  X(10).                 01340000
010770     05  FILLER  REDEFINES PV-DB2-DATE.                           01350000
010780         10  PV-DB2-DATE-CC           PIC  X(02).                 01360000
010790         10  PV-DB2-DATE-YY           PIC  X(02).                 01370000
010800         10  FILLER                   PIC  X(01).                 01380000
010900         10  PV-DB2-DATE-MM           PIC  X(02).                 01390000
011000         10  FILLER                   PIC  X(01).                 01400000
011100         10  PV-DB2-DATE-DD           PIC  X(02).                 01410000
011200     05  PV-DISPLAY-DATE.                                         01420000
011300         10  PV-DISPLAY-DATE-MM       PIC  X(02).                 01430000
011400         10  FILLER                   PIC  X(01) VALUE '/'.       01440000
011500         10  PV-DISPLAY-DATE-DD       PIC  X(02).                 01450000
011600         10  FILLER                   PIC  X(01) VALUE '/'.       01460000
011700         10  PV-DISPLAY-DATE-YY       PIC  X(02).                 01470000
011800     05  PV-MAX-VERFYD-TMST           PIC  X(26).                 01480000
011900     05  PV-MIN-VERFYD-TMST           PIC  X(26).                 01490000
012000     05  PV-EDIT-DISCOUNT-PCT         PIC ZZ.99.                  01500000
012100     05  PV-NUM-DISCOUNT-PCT          PIC 99V99 VALUE ZERO.       01510000
012200     05  PV-EDIT-DISCOUNT-DAYS        PIC ZZZ.                    01520000
012300     05  PV-EDIT-DUE-DAYS             PIC ZZZ.                    01530000
012500     05  PV-LINE-ITEM-PCT             PIC 9V99999.                01540000
012600     05  PV-CALC-UNT-QTY              PIC 9(9).                   01550000
W24803     05  PV-TOT-ITM-RCVD              PIC S9(04) VALUE ZERO COMP. 01561000
012800     05  PV-VER-QTY-NULL              PIC S9(04) VALUE +0         01570000
012900                                                 COMP SYNC.       01580000
013000     05  PV-REMAINDER                 PIC 9(3).                   01590000
013100     05  PV-OTB-PER-BREAK             PIC  X(06).                 01600000
013200     05  FILLER REDEFINES PV-OTB-PER-BREAK.                       01610000
013300         10  PV-OTBP-CC               PIC  X(02).                 01620000
013400         10  PV-OTBP-YY               PIC  X(02).                 01630000
013500         10  PV-OTBP-MM               PIC  X(02).                 01640000
013600         10  PV-OTBP-MM-N REDEFINES PV-OTBP-MM                    01650000
013700                                      PIC  9(02).                 01660000
013800     05  PV-OTB-PER-DISPLAY.                                      01670000
013900         10  PV-OTBPD-MONTH           PIC  X(03).                 01680000
014000         10  FILLER                   PIC  X(01) VALUE SPACE.     01690000
014100         10  PV-OTBPD-YY              PIC  X(02).                 01700000
014200     05  PV-DTS-STR-N                 PIC  9(04) VALUE ZERO.      01710055
014300     05  PV-DTS-STR  REDEFINES                                    01720000
014400         PV-DTS-STR-N                 PIC  X(04).                 01730055
014500     05  PV-PO-TEXT.                                              01740000
014600         10  FILLER                   PIC  X(11)                  01750000
014700                                      VALUE 'PO NUMBER: '.        01760000
014800         10  PV-PO-NBR                PIC  S9(09) COMP.           01770000
014900/                                                                 01930000
015000*----------------------------------------------------------------*01940000
015100*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *01950000
015200*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *01960000
015300*----------------------------------------------------------------*01970000
015400                                                                  01980000
015500     COPY POWS012.                                                01990000
015600/                                                                 02000000
015700                                                                  02010000
015800*----------------------------------------------------------------*02020000
015900* PAYMENT TERMS                                                  *02030000
016000*----------------------------------------------------------------*02040000
016100                                                                  02050000
016200     COPY POWS020.                                                02060000
015800*----------------------------------------------------------------*02061000
015900* COPYBOOK FOR OPEN TO BUY CALCULATIONS                          *02062000
016000*----------------------------------------------------------------*02063000
016100                                                                  02064000
016200     COPY POWS055.                                                02065000
016300/                                                                 02070000
016400                                                                  02080000
016500*----------------------------------------------------------------*02090000
016600*    MAP LAYOUT                                                  *02100000
016700*----------------------------------------------------------------*02110000
016800                                                                  02120000
016900     COPY POKM031.                                                02130000
017000                                                                  02140000
017100/                                                                 02200000
017200*----------------------------------------------------------------*02210000
017300*    ATTRIBUTE SETTINGS COPYBOOK.                                *02220000
017400*----------------------------------------------------------------*02230000
017500                                                                  02240000
017600     COPY DPWS015.                                                02250000
017700                                                                  02260000
017800/                                                                 02270000
017900*----------------------------------------------------------------*02280000
018000*    FUNCTION KEYS COPYBOOK                                      *02290000
018100*----------------------------------------------------------------*02300000
018200                                                                  02310000
018300     COPY DPWS016.                                                02320000
018400                                                                  02330000
018500/                                                                 02340000
018600*----------------------------------------------------------------*02350000
018700*    THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT   *02360000
018800*    SUB-ROUTINE (POKUT100).                                     *02370000
018900*----------------------------------------------------------------*02380000
019000     COPY DPWS010I.                                               02390000
019100                                                                  02400000
019200/                                                                 02410000
019300*----------------------------------------------------------------*02420000
019400*    NAME REFORMATOR COPYBOOK                                    *02430000
019500*----------------------------------------------------------------*02440000
019600     COPY DPWS024.                                                02450000
019700                                                                  02460000
019800/                                                                 02470000
019900*----------------------------------------------------------------*02480000
CICS  * PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.              *02490073
020200*----------------------------------------------------------------*02510000
020300     COPY DPWS030.                                                02520000
CICS       COPY DPWS930.                                                02521071
020400                                                                  02530000
020500/                                                                 02540000
020600*----------------------------------------------------------------*02550000
020700*    STANDARD COMMAREA.                                          *02560000
020800*----------------------------------------------------------------*02570000
020900                                                                  02580000
021000     COPY DPWS020.                                                02590000
021100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02600000
021200                                                                  02610000
021300*----------------------------------------------------------------*02620000
021400*    INTER-APPLICATION COMMAREA.                                 *02630000
021500*----------------------------------------------------------------*02640000
021600                                                                  02650000
021700         10  INTER-APPL-COMM-AREA PIC X(200).                     02660000
021800     COPY POWS017.                                                02670000
021900     COPY POWS013.                                                02680000
022000     COPY POWS014.                                                02690000
022100     COPY TRWS001.                                                02700000
022200*----------------------------------------------------------------*02710000
022300*    SPECIFIC COMMMAREA FOR POKCS031.                            *02720000
022400*----------------------------------------------------------------*02730000
022500         10  ASC-SPECIFIC-COMMAREA.                               02740000
022600             15  ASC-USE-SELECTION-QUEUE-IND                      02750000
022700                                           PIC X(01).             02760000
022800                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        02770000
022900             15  ASC-SEL-QUEUE-NAME        PIC X(08).             02780000
023000             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     02790000
023100             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02800000
023200                                           PIC S9(09) COMP-3.     02810000
023300             15  ASC-SEL-SUB               PIC S9(04) COMP.       02820000
023400             15  ASC-SEL-ITEM              PIC S9(04) COMP.       02830000
023500             15  ASC-KEY-FIELDS.                                  02840000
023600                 20  ASC-KEY-PO-NBR         PIC S9(09) COMP.      02850000
023700                 20  ASC-KEY-ENT-ID         PIC S9(09) COMP.      02860000
023800                 20  ASC-KEY-DEPT-NBR       PIC X(03).            02870000
023900                 20  ASC-KEY-ENT-NAME-DESC  PIC X(30).            02880000
024000                 20  ASC-KEY-STATUS-CDE     PIC X(02).            02890000
024100                 20  ASC-KEY-PO-TYP-CDE     PIC X(02).            02900000
024200             15  ASC-SCREEN-FIELDS.                               02910000
024300                 20  ASC-SPEC-INSTR         PIC X(20).            02920000
024400                 20  ASC-PO-TYPE            PIC X(02).            02930000
024500                 20  ASC-PO-STATUS-DESC     PIC X(20).            02940000
024600                 20  ASC-ORD-DTE            PIC X(08).            02950000
024700                 20  ASC-CRE-BY-UID         PIC X(20).            02960000
024800                 20  ASC-PO-ADDR1           PIC X(30).            02970000
024900                 20  ASC-APP-BY-UID         PIC X(20).            02980000
025000                 20  ASC-PO-ADDR2           PIC X(35).            02990000
025100                 20  ASC-LAST-UPD-TMST      PIC X(08).            03000000
025200                 20  ASC-PO-ADDR3           PIC X(35).            03010000
025300                 20  ASC-LAST-UPD-BY-UID    PIC X(20).            03020000
025400                 20  ASC-TOT-VAL-COST-AMT   PIC 9(08)V99.         03030000
025500                 20  ASC-TOT-VAL-RTL-AMT    PIC 9(08)V99.         03040000
025600                 20  ASC-MU-PCT             PIC S999V99.          03050000
025700                 20  ASC-TOT-UNT-QTY        PIC 9(07).            03060000
025800                 20  ASC-SKUS-ORDERED       PIC 9(03).            03070000
025900                 20  ASC-DONT-SHIP-DTE      PIC X(08).            03080000
026000                 20  ASC-OTB-PER-NBR        PIC X(06).            03090000
                       20  ASC-WEEK               PIC 9(01).            03100000
026100                 20  ASC-CAN-IFNOT-SHIP-DTE PIC X(08).            03110000
026200                 20  ASC-EDI-IND            PIC X(01).            03120000
026300                 20  ASC-EXT-CAN-DTE        PIC X(08).            03130000
026400                 20  ASC-EDI-PROMO-TXT      PIC X(08).            03140000
026500                 20  ASC-NEW-STR-PO-IND     PIC X(01).            03150000
026600                 20  ASC-DIR-STR-IND        PIC X(01).            03160000
026700                 20  ASC-DTS-STR            PIC X(04).            03170000
026900                 20  ASC-AD-EVNT-DTE        PIC X(08).            03180000
027300                 20  ASC-PRE-TICKETING      PIC X(01).            03190000
027400                 20  ASC-LEADTIME-DAYS-QTY  PIC 9(03).            03200000
027500                 20  ASC-HANGER             PIC X(01).            03210000
027600                 20  ASC-PACK-BY-STORE      PIC X(01).            03220000
027700                 20  ASC-PKGNG-CDE          PIC X(01).            03230000
027800                 20  ASC-ADR-SEQ-NBR        PIC S9(04) COMP.      03240000
027900                 20  ASC-TOT-UNT-RCVD-QTY   PIC 9(07).            03250000
028000                 20  ASC-TOT-SKU-RCVD-QTY   PIC 9(03).            03260000
028100                 20  ASC-RLSE-DTE           PIC X(08).            03270000
028200                 20  ASC-FIRST-RCPT-DTE     PIC X(08).            03280000
028300                 20  ASC-LAST-RCPT-DTE      PIC X(08).            03290000
028400                 20  ASC-IN-TROUBLE         PIC X(10).            03300000
071490** PP 09/08/2010 BEG                                              03300159
071492                 20  ASC-WHSE-RPLNT-IND     PIC X(01).            03300259
071493         10  FILLER                         PIC X(2438).          03301059
071490** PP 09/08/2010 END                                              03302059
028500                                                                  03310000
028600/                                                                 03320000
028700*----------------------------------------------------------------*03330000
028800*    ABEND PROCESSING COPYBOOK.                                  *03340000
028900*----------------------------------------------------------------*03350000
029000                                                                  03360000
029100     COPY DPWS013.                                                03370000
029200/                                                                 03380000
030601******************************************************************03390000
030602*  WORKING STORAGE AREA FOR COUNTRY AND STATE RETRIEVAL           03400000
030603******************************************************************03410000
030604     COPY DPWS410.                                                03420000
030700                                                                  03430000
030800*----------------------------------------------------------------*03440000
030900*    SYSTEM MESSAGE COPYBOOK                                     *03450000
031000*----------------------------------------------------------------*03460000
031100                                                                  03470000
031200     COPY DPRD507I.                                               03480000
031300/                                                                 03490000
031400                                                                  03500000
031500*----------------------------------------------------------------*03510000
031600*    DB2 SQL COMMUNICATION AREA                                   03520000
031700*----------------------------------------------------------------*03530000
031800     EXEC SQL                                                     03540000
031900          INCLUDE SQLCA                                           03550000
032000     END-EXEC.                                                    03560000
032100                                                                  03570000
032200/                                                                 03580000
033900*----------------------------------------------------------------*03750000
034000*    DB2 DCLGEN FOR WORKER TABLE                                  03760000
034100*----------------------------------------------------------------*03770000
034200     EXEC SQL                                                     03780000
034300          INCLUDE TWORKER                                         03790000
034400     END-EXEC.                                                    03800000
034500                                                                  03810000
034600/                                                                 03820000
035500*----------------------------------------------------------------*03910000
035600*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          03920000
035700*----------------------------------------------------------------*03930000
035800     EXEC SQL                                                     03940000
035900          INCLUDE TPURCHS                                         03950000
036000     END-EXEC.                                                    03960000
036100                                                                  03970000
036200/                                                                 03980000
036300*----------------------------------------------------------------*03990000
036400*    DB2 DCLGEN FOR PURCHASE ORDER LINE ITEM TABLE                04000000
036500*----------------------------------------------------------------*04010000
036600     EXEC SQL                                                     04020000
036700          INCLUDE TPURITM                                         04030000
036800     END-EXEC.                                                    04040000
036900                                                                  04050000
037000/                                                                 04060000
037100*----------------------------------------------------------------*04070000
037200*    DB2 DCLGEN FOR PO PLANNED SHIPMENT TABLE                     04080000
037300*----------------------------------------------------------------*04090000
037400     EXEC SQL                                                     04100000
037500          INCLUDE TPLNSHP                                         04110000
037600     END-EXEC.                                                    04120000
037700                                                                  04130000
037800/                                                                 04140000
037900*----------------------------------------------------------------*04150000
038000*    DB2 DCLGEN FOR PO MERCHANDISE STORE DIST. PLAN TABLE         04160000
038100*----------------------------------------------------------------*04170000
038200     EXEC SQL                                                     04180000
038300          INCLUDE TMESTDS                                         04190000
038400     END-EXEC.                                                    04200000
038500                                                                  04210000
038600/                                                                 04220000
038700*----------------------------------------------------------------*04230000
038800*    DB2 DCLGEN FOR PO INSTRUCTIONS TABLE                         04240000
038900*----------------------------------------------------------------*04250000
039000     EXEC SQL                                                     04260000
039100          INCLUDE TPOINST                                         04270000
039200     END-EXEC.                                                    04280000
039300                                                                  04290000
039400/                                                                 04300000
039500*----------------------------------------------------------------*04310000
039600*    DB2 DCLGEN FOR ENTERPRISE NAME TABLE                         04320000
039700*----------------------------------------------------------------*04330000
039800     EXEC SQL                                                     04340000
039900          INCLUDE TENTNME                                         04350000
040000     END-EXEC.                                                    04360000
040100                                                                  04370000
040200/                                                                 04380000
042700*----------------------------------------------------------------*04630000
042800*    DB2 DCLGEN FOR PAYMENT TERMS TABLE                           04640000
042900*----------------------------------------------------------------*04650000
043000     EXEC SQL                                                     04660000
043100          INCLUDE TPAYTRM                                         04670000
043200     END-EXEC.                                                    04680000
043300                                                                  04690000
043400/                                                                 04700000
043500*----------------------------------------------------------------*04710000
043600*    DB2 DCLGEN FOR ENTERPRISE BUSINESS LOCATION TABLE            04720000
043700*----------------------------------------------------------------*04730000
043800     EXEC SQL                                                     04740000
043900          INCLUDE TBUSLOC                                         04750000
044000     END-EXEC.                                                    04760000
044100                                                                  04770000
044200/                                                                 04780000
045900*----------------------------------------------------------------*04950000
046000*    DB2 DCLGEN FOR PO AGREEMENT TABLE                            04960000
046100*----------------------------------------------------------------*04970000
046200     EXEC SQL                                                     04980000
046300          INCLUDE TPOAGMT                                         04990000
046400     END-EXEC.                                                    05000000
046500                                                                  05010000
046600/                                                                 05020000
046700*----------------------------------------------------------------*05030000
046800*    DB2 DCLGEN FOR PO STATUS CODES TABLE                         05040000
046900*----------------------------------------------------------------*05050000
047000     EXEC SQL                                                     05060000
047100          INCLUDE TSTATCD                                         05070000
047200     END-EXEC.                                                    05080000
047300                                                                  05090000
047400/                                                                 05100000
047500*----------------------------------------------------------------*05110000
047600*    DB2 DCLGEN FOR PO RESERVATION TABLE                          05120000
047700*----------------------------------------------------------------*05130000
047800*    EXEC SQL                                                     05140064
047900*         INCLUDE TPORESV                                         05150064
048000*    END-EXEC.                                                    05160064
048100                                                                  05170000
048200/                                                                 05180000
051500*----------------------------------------------------------------*05510000
051600*    DB2 DCLGEN FOR RECEIVING STORE DISTRIBUTION TABLE            05520000
051700*----------------------------------------------------------------*05530000
051800     EXEC SQL                                                     05540000
051900          INCLUDE TRECDIS                                         05550000
052000     END-EXEC.                                                    05560000
052100                                                                  05570000
052200/                                                                 05580000
052300*----------------------------------------------------------------*05590000
052400*    DB2 DCLGEN FOR RECEIVING ITEM TABLE                          05600000
052500*----------------------------------------------------------------*05610000
052600     EXEC SQL                                                     05620000
052700          INCLUDE TRECITM                                         05630000
052800     END-EXEC.                                                    05640000
052900                                                                  05650000
053000/                                                                 05660000
053100*----------------------------------------------------------------*05670000
053200*    DB2 DCLGEN FOR RECEIVING TROUBLE NOTIFICATION                05680000
053300*----------------------------------------------------------------*05690000
053400     EXEC SQL                                                     05700000
053500          INCLUDE TTRBNTF                                         05710000
053600     END-EXEC.                                                    05720000
053700                                                                  05730000
053701*----------------------------------------------------------------*05740000
053702*    DB2 DCLGEN FOR TROUBLE REASON TABLE                          05750000
053703*----------------------------------------------------------------*05760000
053704     EXEC SQL                                                     05770000
053705          INCLUDE TTRBRSN                                         05780000
053706     END-EXEC.                                                    05790000
053710                                                                  05800000
053800/                                                                 05810000
053900*---------------------------------------------------------------* 05820000
054000*  CURSOR TO SELECT ALL PURCHASE ORDER AGREEMENTS               * 05830000
054100*---------------------------------------------------------------* 05840000
054200                                                                  05850000
054300     EXEC SQL                                                     05860000
054400          DECLARE TPOAGMT-CSR CURSOR FOR                          05870000
054500          SELECT PO_NBR                                           05880000
054600                ,VER_NBR                                          05890000
054700                ,AGRMT_TYP_ID                                     05900000
054800                ,SEQ_NBR                                          05910000
054900                ,VER_STATUS_CDE                                   05920000
055000                ,TYP_CDE                                          05930000
055100                ,TKT_MKR_IND                                      05940000
055200                ,BULK_STK_TKT_IND                                 05950000
055300                ,EDI_PROMO_TXT                                    05960000
055400                ,PO_CAN_DAY_QTY                                   05970000
055500                ,AUTO_PO_CAN_IND                                  05980000
055600                ,DISC_DOL_AMT                                     05990000
055700                ,DISC_PCT                                         06000000
055800                ,DISC_PAY_DAY_QTY                                 06010000
055900                ,LAST_UPD_TMST                                    06020000
056000                ,PAYT_TERM_ID                                     06030000
056100                ,LAST_UPD_BY_UID                                  06040000
056200          FROM   TPOAGMT                                          06050000
056300          WHERE  PO_NBR         = :ASC-KEY-PO-NBR                 06060000
056400            AND  VER_STATUS_CDE = 'A'                             06070000
056500     END-EXEC.                                                    06080000
056600/                                                                 06090000
056700*---------------------------------------------------------------* 06100000
056800*  CURSOR TO SELECT EARLIEST PO AGREEMENT                       * 06110000
056900*---------------------------------------------------------------* 06120000
057000                                                                  06130000
057100     EXEC SQL                                                     06140000
057200          DECLARE TPOAGMT-TMST-CSR CURSOR FOR                     06150000
057300          SELECT LAST_UPD_TMST                                    06160000
057400                ,LAST_UPD_BY_UID                                  06170000
057500          FROM   TPOAGMT                                          06180000
057600          WHERE  PO_NBR         = :ASC-KEY-PO-NBR                 06190000
057700            AND  VER_STATUS_CDE = 'A'                             06200000
057800            AND  AGRMT_TYP_ID IN ('2', '3', '4')                  06210000
057900            ORDER BY LAST_UPD_TMST DESC                           06220000
058000     END-EXEC.                                                    06230000
058100                                                                  06240000
058200******************************************************************06250000
058300* CURSOR TO SELECT WORKER NAME                                    06260000
058400******************************************************************06270000
058500                                                                  06280000
058600     EXEC SQL                                                     06290000
058700          DECLARE WORKER-CSR  CURSOR FOR                          06300000
058800              SELECT LAST_NAME,                                   06310000
058900                     FIR_NAME                                     06320000
059000              FROM TWORKER                                        06330000
059100              WHERE UID_NBR = :WORKER-UID-NBR                     06340000
059200     END-EXEC.                                                    06350000
059300/                                                                 06360000
059400 LINKAGE SECTION.                                                 06370000
059500                                                                  06380000
059600 01  DFHCOMMAREA.                                                 06390000
059700     05  FILLER                       OCCURS  1 TO 4072 TIMES     06400000
059800                                      DEPENDING ON EIBCALEN.      06410000
059900         10  FILLER                   PIC X.                      06420000
060000                                                                  06430000
060100/                                                                 06440000
060200 PROCEDURE DIVISION.                                              06450000
060300                                                                  06460000
060400*----------------------------------------------------------------*06470000
060500*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *06480000
060600*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *06490000
060700*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *06500000
060800*                                                                *06510000
060900*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *06520000
061000*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *06530000
061100*----------------------------------------------------------------*06540000
061200 0000-MAIN-MODULE.                                                06550000
061300                                                                  06560000
061400     INITIALIZE DP030-CICS-API-FIELDS.                            06570000
061500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06580000
061600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06590000
061700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06600000
061800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06610000
061900     MOVE LENGTH OF PO031AI        TO DP030-MAP-LENGTH (1).       06620000
062000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06630000
062100     PERFORM 0001-CALL-CICS-ARCH-API.                             06640000
062200                                                                  06650000
062300     PERFORM 1000-CONTROL-PROCESSING.                             06660000
062400                                                                  06670000
062500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06680000
062600     PERFORM 0001-CALL-CICS-ARCH-API.                             06690000
062700                                                                  06700000
062800/                                                                 06710000
062900 0001-CALL-CICS-ARCH-API.                                         06720000
063000                                                                  06730000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06740071
063200                                    DFHCOMMAREA                   06750071
063300                                    DP030-CICS-API-FIELDS         06760071
063400                                    DP020-STANDARD-COMMAREA       06770071
063500                                    PO031AI.                      06780071
063600                                                                  06790000
063700     IF  DP030-RC-CALL-SUCCESSFUL                                 06800000
063800         CONTINUE                                                 06810000
063900     ELSE                                                         06820000
064000         SET DP013-NO-ROLLBACK                                    06830000
064100             DP013-XCTL-DISPLAY-RESTART                           06840000
064200             DP013-CICS-ABEND      TO TRUE                        06850000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           06860071
064400                                   TO DP013-PARAGRAPH             06870000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06880071
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06890071
064700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06900000
064800         PERFORM DP013-0000-PROCESS-ABEND                         06910000
064900     END-IF.                                                      06920000
065000                                                                  06930000
065100/                                                                 06940000
065200*----------------------------------------------------------------*06950000
065300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *06960000
065400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *06970000
065500*----------------------------------------------------------------*06980000
065600                                                                  06990000
065700 1000-CONTROL-PROCESSING.                                         07000000
065800                                                                  07010000
065900     EVALUATE TRUE                                                07020000
066000         WHEN DP020-NEXT-ACT-INITIAL                              07030000
066100              PERFORM 1100-PROCESS-INTER-APPL-COMM                07040000
066200              IF  PS-COMMAREA-NOT-VALID                           07050000
066300                  CONTINUE                                        07060000
066400              ELSE                                                07070000
066500                  PERFORM 4000-BUILD-INITIAL-PANEL                07080000
066600              END-IF                                              07090000
066700                                                                  07100000
066800         WHEN DP020-NEXT-ACT-READ-MAP                             07110000
066900              PERFORM 2000-PROCESS-PANEL                          07120000
067000                                                                  07130000
067100         WHEN DP020-NEXT-ACT-RETURN                               07140000
067200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07150000
067300                                                                  07160000
067400         WHEN OTHER                                               07170000
067500              SET DP013-LOGIC-ABEND                               07180000
067600                  DP013-NO-ROLLBACK TO TRUE                       07190000
067700              MOVE '1000-CONTROL-PROCESSING'                      07200000
067800                                    TO DP013-PARAGRAPH            07210000
067900              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  07220000
068000                                    TO DP013-MESSAGE-TEXT(1)      07230000
068100              MOVE DP020-NEXT-APPL-ACTIVITY                       07240000
068200                                    TO DP013-MESSAGE-TEXT(2)      07250000
068300              PERFORM DP013-0000-PROCESS-ABEND                    07260000
068400     END-EVALUATE.                                                07270000
068500                                                                  07280000
068600/                                                                 07290000
068700*----------------------------------------------------------------*07300000
068800*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *07310000
068900*    INTER-APPLICATION FORMAT CODE.                              *07320000
069000*                                                                *07330000
069100*    PERFORM SPECIFIC VALIDATIONS FOR EACH "MODE" AND BASED      *07340000
069200*    ON WHERE THE PROGRAM WAS INITIATED FROM.                    *07350000
069300*----------------------------------------------------------------*07360000
069400 1100-PROCESS-INTER-APPL-COMM.                                    07370000
069500                                                                  07380000
069600     SET PS-COMMAREA-VALID            TO TRUE.                    07390000
069700                                                                  07400000
069800     INITIALIZE ASC-SPECIFIC-COMMAREA.                            07410000
069900                                                                  07420000
070000     EVALUATE DP020-INT-APPL-FORMAT-IND                           07430000
070100                                                                  07440000
070200         WHEN PC-INTER-APPL-CRIT                                  07450000
070300             IF  PO017-PO-NBR = ZEROES                            07460000
070400                 MOVE PC-TSYMSG-00461 TO DP020-MSG-NUMBER         07470000
070500                 SET PS-ERROR                                     07480000
070600                     PS-COMMAREA-NOT-VALID                        07490000
070700                     DP020-NEXT-ACT-APPL-ERROR                    07500000
070800                     DP020-MSG-FATAL  TO TRUE                     07510000
070900             ELSE                                                 07520000
071000                 MOVE PO017-PO-NBR                                07530000
071100                                 TO DK-PO-NBR                     07540000
071200                                    ASC-KEY-PO-NBR                07550000
071300                 INITIALIZE PV-DB2-COUNT                          07560000
071400                 PERFORM 1110-CHECK-PO                            07570000
071500                 IF  PV-DB2-COUNT = +0                            07580066
072700                     MOVE PC-TSYMSG-00083                         07581070
072800                                     TO DP020-MSG-NUMBER          07582070
072900                     SET PS-ERROR                                 07583070
073000                         PS-COMMAREA-NOT-VALID                    07584070
073100                         DP020-NEXT-ACT-APPL-ERROR                07585070
073200                         DP020-MSG-FATAL                          07586070
073300                                     TO TRUE                      07587070
073500                 END-IF                                           07588070
073600             END-IF                                               07589070
071600*                    PERFORM 1115-CHECK-TPORESV                   07590064
071700*                    IF  SQLCODE = +0                             07600064
071800*                        MOVE PORESV-DEPT-NBR TO DP020-MSG-TEXT   07610064
071900*                        MOVE PC-TSYMSG-01189                     07620064
072000*                                    TO DP020-MSG-NUMBER          07630064
072100*                        SET PS-ERROR                             07640064
072200*                            PS-COMMAREA-NOT-VALID                07650064
072300*                            DP020-NEXT-ACT-APPL-ERROR            07660064
072400*                            DP020-MSG-FATAL                      07670064
072500*                                    TO TRUE                      07680064
072600*                    ELSE                                         07690070
072700*                        MOVE PC-TSYMSG-00083                     07700070
072800*                                    TO DP020-MSG-NUMBER          07710070
072900*                        SET PS-ERROR                             07720070
073000*                            PS-COMMAREA-NOT-VALID                07730070
073100*                            DP020-NEXT-ACT-APPL-ERROR            07740070
073200*                            DP020-MSG-FATAL                      07750070
073300*                                    TO TRUE                      07760070
073400*                    END-IF                                       07770064
073500*                END-IF                                           07780070
073600*            END-IF                                               07790070
073700                                                                  07800000
073800         WHEN PC-INTER-APPL-LIST                                  07810000
073900             SET ASC-USE-SELECTION-QUEUE                          07820000
074000                                 TO TRUE                          07830000
074100             MOVE PO013-NUMBER-OF-SELECTED-ITEMS                  07840000
074200                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  07850000
074300             MOVE PO013-NUMBER-OF-TS-ITEMS                        07860000
074400                                 TO ASC-NUMBER-OF-TS-ITEMS        07870000
074500             MOVE PO013-SEL-QUEUE-NAME                            07880000
074600                                 TO ASC-SEL-QUEUE-NAME            07890000
074700             MOVE PO013-DEPT-NBR TO ASC-KEY-DEPT-NBR              07900000
074800                                    DK-DEPT-NBR                   07910000
074900             PERFORM 1120-PREPARE-LIST-ENTRY                      07920000
075000             INITIALIZE PV-DB2-COUNT                              07930000
075100             PERFORM 1110-CHECK-PO                                07940000
075200             IF  PV-DB2-COUNT = +0                                07950000
076400                 MOVE PC-TSYMSG-00083                             07950170
076500                                 TO DP020-MSG-NUMBER              07950270
076600                 SET PS-ERROR                                     07950370
076700                     PS-COMMAREA-NOT-VALID                        07950470
076800                     DP020-NEXT-ACT-APPL-ERROR                    07950570
076900                     DP020-MSG-FATAL                              07950670
077000                                 TO TRUE                          07950770
077100             END-IF                                               07950870
075300*                PERFORM 1115-CHECK-TPORESV                       07960064
075400*                IF  SQLCODE = +0                                 07970064
075500*                    MOVE PORESV-DEPT-NBR TO DP020-MSG-TEXT       07980064
075600*                    MOVE PC-TSYMSG-01189                         07990064
075700*                                TO DP020-MSG-NUMBER              08000064
075800*                    SET PS-ERROR                                 08010064
075900*                        PS-COMMAREA-NOT-VALID                    08020064
076000*                        DP020-NEXT-ACT-APPL-ERROR                08030064
076100*                        DP020-MSG-FATAL                          08040064
076200*                                TO TRUE                          08050064
076300*                ELSE                                             08060070
076400*                    MOVE PC-TSYMSG-00083                         08070070
076500*                                TO DP020-MSG-NUMBER              08080070
076600*                    SET PS-ERROR                                 08090070
076700*                        PS-COMMAREA-NOT-VALID                    08100070
076800*                        DP020-NEXT-ACT-APPL-ERROR                08110070
076900*                        DP020-MSG-FATAL                          08120070
077000*                                TO TRUE                          08130070
077100*                END-IF                                           08140064
077200*            END-IF                                               08150070
077300                                                                  08160000
077400         WHEN PC-INTER-APPL-PO-LIST                               08170000
077500             IF  TR001-PO-NBR = ZEROES                            08180000
077600                 MOVE PC-TSYMSG-00461 TO DP020-MSG-NUMBER         08190000
077700                 SET PS-ERROR                                     08200000
077800                     PS-COMMAREA-NOT-VALID                        08210000
077900                     DP020-NEXT-ACT-APPL-ERROR                    08220000
078000                     DP020-MSG-FATAL  TO TRUE                     08230000
078100             ELSE                                                 08240000
C94517                 MOVE TR001-PO-NBR                                08250063
078300                                 TO DK-PO-NBR                     08260000
078400                                    ASC-KEY-PO-NBR                08270000
078500                 INITIALIZE PV-DB2-COUNT                          08280000
078600                 PERFORM 1110-CHECK-PO                            08290000
078700                 IF  PV-DB2-COUNT = +0                            08300000
079900                     MOVE PC-TSYMSG-00083                         08301070
080000                                     TO DP020-MSG-NUMBER          08302070
080100                     SET PS-ERROR                                 08303070
080200                         PS-COMMAREA-NOT-VALID                    08304070
080300                         DP020-NEXT-ACT-APPL-ERROR                08305070
080400                         DP020-MSG-FATAL                          08306070
080500                                     TO TRUE                      08307070
080600                 END-IF                                           08308070
080800             END-IF                                               08309070
078800*                    PERFORM 1115-CHECK-TPORESV                   08310064
078900*                    IF  SQLCODE = +0                             08320064
079000*                        MOVE PORESV-DEPT-NBR TO DP020-MSG-TEXT   08330064
079100*                        MOVE PC-TSYMSG-01189                     08340064
079200*                                    TO DP020-MSG-NUMBER          08350064
079300*                        SET PS-ERROR                             08360064
079400*                            PS-COMMAREA-NOT-VALID                08370064
079500*                            DP020-NEXT-ACT-APPL-ERROR            08380064
079600*                            DP020-MSG-FATAL                      08390064
079700*                                    TO TRUE                      08400064
079800*                    ELSE                                         08410070
079900*                        MOVE PC-TSYMSG-00083                     08420070
080000*                                    TO DP020-MSG-NUMBER          08430070
080100*                        SET PS-ERROR                             08440070
080200*                            PS-COMMAREA-NOT-VALID                08450070
080300*                            DP020-NEXT-ACT-APPL-ERROR            08460070
080400*                            DP020-MSG-FATAL                      08470070
080500*                                    TO TRUE                      08480070
080600*                    END-IF                                       08490064
080700*                END-IF                                           08500070
080800*            END-IF                                               08510070
080900                                                                  08520000
081000         WHEN OTHER                                               08530000
081100             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             08540000
081200             SET PS-ERROR                                         08550000
081300                 PS-COMMAREA-NOT-VALID                            08560000
081400                 DP020-MSG-FATAL                                  08570000
081500                 DP020-NEXT-ACT-APPL-ERROR                        08580000
081600                                 TO TRUE                          08590000
081700                                                                  08600000
081800     END-EVALUATE.                                                08610000
081900                                                                  08620000
082000/                                                                 08630000
082100*----------------------------------------------------------------*08640000
082200*    CHECK TO MAKE SURE PO NUMBER EXISTS                         *08650000
082300*----------------------------------------------------------------*08660000
082400 1110-CHECK-PO.                                                   08670000
082500                                                                  08680000
082600     PERFORM                                                      08690000
082700         WITH TEST AFTER                                          08700000
082800         VARYING PV-RETRY-COUNTER                                 08710000
082900         FROM 1 BY 1                                              08720000
083000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08730000
083100             OR (SQLCODE = +0)                                    08740000
083200             OR (SQLCODE = +100))                                 08750000
083300                                                                  08760000
083400         EXEC SQL                                                 08770000
083500              SELECT COUNT(*)                                     08780000
083600                INTO :PV-DB2-COUNT                                08790000
083700                FROM TPURCHS                                      08800000
083800               WHERE PO_NBR         = :DK-PO-NBR                  08810000
083900                 AND VER_STATUS_CDE = 'A'                         08820000
084000                 AND PO_CATEG_CDE   = 'MR'                        08830000
084100         END-EXEC                                                 08840000
084200                                                                  08850000
084300         EVALUATE TRUE                                            08860000
084400             WHEN SQLCODE = +0                                    08870000
084500             WHEN SQLCODE = +100                                  08880000
084600             WHEN SQLCODE = -904                                  08890000
084700             WHEN SQLCODE = -913                                  08900000
084800                  CONTINUE                                        08910000
084900                                                                  08920000
085000             WHEN SQLWARN0 NOT = SPACES                           08930000
085100             WHEN SQLCODE < +0                                    08940000
085200             WHEN SQLCODE > +0                                    08950000
085300                  MOVE '1110-CHECK-PO'                            08960000
085400                                  TO DP013-PARAGRAPH              08970000
085500                  MOVE 'UNSUCCESSFUL SELECT ON PO HEADER'         08980000
085600                                  TO DP013-MESSAGE-TEXT (1)       08990000
085700                  MOVE SQLCA      TO DP013-SQLCA                  09000000
085800                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     09010000
085900                  SET DP013-DB2-ABEND                             09020000
086000                      DP013-XCTL-DISPLAY-RESTART                  09030000
086100                                  TO TRUE                         09040000
086200                  PERFORM DP013-0000-PROCESS-ABEND                09050000
086300         END-EVALUATE                                             09060000
086400     END-PERFORM.                                                 09070000
086500                                                                  09080000
086600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09090000
086700         MOVE '1110-CHECK-PO'     TO DP013-PARAGRAPH              09100000
086800         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         09110000
086900                                  TO DP013-MESSAGE-TEXT (1)       09120000
087000         MOVE SQLCA               TO DP013-SQLCA                  09130000
087100         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     09140000
087200         SET DP013-DB2-ABEND                                      09150000
087300             DP013-XCTL-DISPLAY-RESTART                           09160000
087400                                  TO TRUE                         09170000
087500         PERFORM DP013-0000-PROCESS-ABEND                         09180000
087600     END-IF.                                                      09190000
087700                                                                  09200000
087800*----------------------------------------------------------------*09210000
087900*    CHECK TO SEE IF THE PO NUMBER EXISTS ON TPORESV             *09220000
088000*----------------------------------------------------------------*09230000
088100*1115-CHECK-TPORESV.                                              09240064
088200*                                                                 09250064
088300*    PERFORM                                                      09260064
088400*        WITH TEST AFTER                                          09270064
088500*        VARYING PV-RETRY-COUNTER                                 09280064
088600*        FROM 1 BY 1                                              09290064
088700*        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09300064
088800*            OR (SQLCODE = +0)                                    09310064
088900*            OR (SQLCODE = +100))                                 09320064
089000*                                                                 09330064
089100*        EXEC SQL                                                 09340064
089200*             SELECT DEPT_NBR                                     09350064
089300*               INTO :PORESV-DEPT-NBR                             09360064
089400*               FROM TPORESV                                      09370064
089500*              WHERE RSVD_PO_NBR    = :DK-PO-NBR                  09380064
089600*        END-EXEC                                                 09390064
089700*                                                                 09400064
089800*        EVALUATE TRUE                                            09410064
089900*            WHEN SQLCODE = +0                                    09420064
090000*            WHEN SQLCODE = +100                                  09430064
090100*            WHEN SQLCODE = -904                                  09440064
090200*            WHEN SQLCODE = -913                                  09450064
090300*                 CONTINUE                                        09460064
090400*                                                                 09470064
090500*            WHEN SQLWARN0 NOT = SPACES                           09480064
090600*            WHEN SQLCODE < +0                                    09490064
090700*            WHEN SQLCODE > +0                                    09500064
090800*                 MOVE '1115-CHECK-TPORESV'                       09510064
090900*                                 TO DP013-PARAGRAPH              09520064
091000*                 MOVE 'UNSUCCESSFUL SELECT ON PO RESERVATION'    09530064
091100*                                 TO DP013-MESSAGE-TEXT (1)       09540064
091200*                 MOVE SQLCA      TO DP013-SQLCA                  09550064
091300*                 MOVE 'TPORESV ' TO DP013-DB2-TABLE-NAME (1)     09560064
091400*                 SET DP013-DB2-ABEND                             09570064
091500*                     DP013-XCTL-DISPLAY-RESTART                  09580064
091600*                                 TO TRUE                         09590064
091700*                 PERFORM DP013-0000-PROCESS-ABEND                09600064
091800*        END-EVALUATE                                             09610064
091900*    END-PERFORM.                                                 09620064
092000*                                                                 09630064
092100*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09640064
092200*        MOVE '1115-CHECK-TPORESV' TO DP013-PARAGRAPH             09650064
092300*        MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         09660064
092400*                                 TO DP013-MESSAGE-TEXT (1)       09670064
092500*        MOVE SQLCA               TO DP013-SQLCA                  09680064
092600*        MOVE 'TPORESV '          TO DP013-DB2-TABLE-NAME (1)     09690064
092700*        SET DP013-DB2-ABEND                                      09700064
092800*            DP013-XCTL-DISPLAY-RESTART                           09710064
092900*                                 TO TRUE                         09720064
093000*        PERFORM DP013-0000-PROCESS-ABEND                         09730064
093100*    END-IF.                                                      09740064
093200*                                                                 09750064
093300*                                                                 09760064
093400*----------------------------------------------------------------*09770000
093500*    ENTRY IS FROM A LIST.  GET THE PO NUMBER FROM THE           *09780000
093600*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *09790000
093700*----------------------------------------------------------------*09800000
093800 1120-PREPARE-LIST-ENTRY.                                         09810000
093900                                                                  09820000
094000     MOVE PO012-MAX-ITEMS          TO ASC-SEL-SUB.                09830000
094100     MOVE ZERO                     TO ASC-SEL-ITEM.               09840000
094200     PERFORM 2110-GET-NEXT-PO.                                    09850000
094300                                                                  09860000
094400/                                                                 09870000
094500*----------------------------------------------------------------*09880000
094600*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*09890000
094700*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*09900000
094800*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *09910000
094900*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *09920000
095000*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *09930000
095100*----------------------------------------------------------------*09940000
095200                                                                  09950000
095300 2000-PROCESS-PANEL.                                              09960000
095400                                                                  09970000
095500     EVALUATE TRUE                                                09980000
095600                                                                  09990000
095700         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  10000000
095800             MOVE ASC-KEY-PO-NBR   TO PO017-PO-NBR                10010000
095900             MOVE ASC-KEY-DEPT-NBR TO PO017-DEPT-NBR              10020000
096000             MOVE ASC-KEY-ENT-NAME-DESC                           10030000
096100                                   TO PO017-ENT-NAME-DESC         10040000
096200                                                                  10050000
096300         WHEN DP020-SRC-AID = DP016-CLEAR                         10060000
096400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10070000
096500                                                                  10080000
096600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     10090000
096700             INITIALIZE ASC-SCREEN-FIELDS                         10100000
096800             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   10110000
096900             MOVE ASC-KEY-DEPT-NBR TO DK-DEPT-NBR                 10120000
097000             MOVE ASC-KEY-STATUS-CDE                              10130000
097100                                   TO DK-STATUS-CDE               10140000
097200             MOVE ASC-KEY-PO-TYP-CDE                              10150000
097300                                   TO DK-PO-TYP-CDE               10160000
097400             MOVE ASC-KEY-ENT-NAME-DESC                           10170000
097500                                   TO DK-ENT-NAME-DESC            10180000
097600             PERFORM 4000-BUILD-INITIAL-PANEL                     10190000
097700                                                                  10200000
097800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             10210000
097900             IF  ASC-USE-SELECTION-QUEUE                          10220000
098000                 PERFORM 2110-GET-NEXT-PO                         10230000
098100                 IF PS-LIST-END                                   10240000
098200                    SET PS-NO-LIST-END                            10250000
098300                                   TO TRUE                        10260000
098400                 ELSE                                             10270000
098500                    PERFORM 4000-BUILD-INITIAL-PANEL              10280000
098600                 END-IF                                           10290000
098700             ELSE                                                 10300000
098800*                --- BOTTOM OF LIST ---                           10310000
098900                 MOVE PC-TSYMSG-00070                             10320000
099000                                   TO DP020-MSG-NUMBER            10330000
099100                 SET DP020-MSG-INFORMATIONAL                      10340000
099200                     PS-LIST-END   TO TRUE                        10350000
099300             END-IF                                               10360000
099400                                                                  10370000
099500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             10380000
099600             IF  ASC-USE-SELECTION-QUEUE                          10390000
099700                 PERFORM 2120-GET-PREV-PO                         10400000
099800                 IF PS-LIST-END                                   10410000
099900                    SET PS-NO-LIST-END                            10420000
100000                                   TO TRUE                        10430000
100100                 ELSE                                             10440000
100200                    PERFORM 4000-BUILD-INITIAL-PANEL              10450000
100300                 END-IF                                           10460000
100400             ELSE                                                 10470000
100500*                --- TOP OF LIST ---                              10480000
100600                 MOVE PC-TSYMSG-00069                             10490000
100700                                   TO DP020-MSG-NUMBER            10500000
100800                 SET DP020-MSG-INFORMATIONAL                      10510000
100900                     PS-LIST-END   TO TRUE                        10520000
101000             END-IF                                               10530000
101100                                                                  10540000
101200         WHEN OTHER                                               10550000
101300             PERFORM 2100-CHECK-FUNCTION-KEY                      10560000
101400     END-EVALUATE.                                                10570000
101500                                                                  10580000
101600/                                                                 10590000
101700*----------------------------------------------------------------*10600000
101800*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *10610000
101900*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*10620000
102000*    FROM THE CICS ARCHITECTURE API.                             *10630000
102100*----------------------------------------------------------------*10640000
102200                                                                  10650000
102300 2100-CHECK-FUNCTION-KEY.                                         10660000
102400                                                                  10670000
102500     EVALUATE TRUE                                                10680000
102600         WHEN DP020-SRC-AID = DP016-ENTER                         10690000
102700             CONTINUE                                             10700000
102800                                                                  10710000
102900         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               10720000
103000             CONTINUE                                             10730000
103100                                                                  10740000
103200         WHEN OTHER                                               10750000
103300             SET DP013-NO-ROLLBACK                                10760000
103400                 DP013-XCTL-DISPLAY-RESTART                       10770000
103500                 DP013-CICS-ABEND  TO TRUE                        10780000
103600             MOVE '2100-CHECK-FUNCTION-KEY'                       10790000
103700                                   TO DP013-PARAGRAPH             10800000
103800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10810000
103900                                   TO DP013-MESSAGE-TEXT (1)      10820000
104000             PERFORM DP013-0000-PROCESS-ABEND                     10830000
104100     END-EVALUATE.                                                10840000
104200                                                                  10850000
104300/                                                                 10860000
104400*----------------------------------------------------------------*10870000
104500*    GET THE PO NUMBER (KEY) OF THE NEXT SELECTED OBJECT         *10880000
104600*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *10890000
104700*----------------------------------------------------------------*10900000
104800 2110-GET-NEXT-PO.                                                10910000
104900                                                                  10920000
105000     ADD +1                        TO ASC-SEL-SUB.                10930000
105100     IF  ASC-SEL-SUB > PO012-MAX-ITEMS                            10940000
105200         ADD +1                    TO ASC-SEL-ITEM                10950000
105300         MOVE +1                   TO ASC-SEL-SUB                 10960000
105400     END-IF.                                                      10970000
105500                                                                  10980000
105600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                10990000
105700         PERFORM 9100-READ-SEL-QUEUE                              11000000
105800         IF  PO012-ITEM (ASC-SEL-SUB) > ZERO                      11010000
105900             INITIALIZE ASC-SCREEN-FIELDS                         11020000
106000             MOVE PO012-PO-NBR (ASC-SEL-SUB)                      11030000
106100                                   TO ASC-KEY-PO-NBR              11040000
106200                                      DK-PO-NBR                   11050000
106300             MOVE PO012-STATUS (ASC-SEL-SUB)                      11060000
106400                                   TO ASC-KEY-STATUS-CDE          11070000
106500             MOVE PO012-PO-TYPE (ASC-SEL-SUB)                     11080000
106600                                   TO ASC-KEY-PO-TYP-CDE          11090000
106700             MOVE PO012-VENDOR-NAME (ASC-SEL-SUB)                 11100000
106800                                   TO ASC-KEY-ENT-NAME-DESC       11110000
106900             SET PO012-INQ (ASC-SEL-SUB)                          11120000
107000                                   TO TRUE                        11130000
107100             PERFORM 9200-REWRITE-SEL-QUEUE                       11140000
107200         ELSE                                                     11150000
107300             SUBTRACT +1 FROM ASC-SEL-SUB                         11160000
107400*            --- BOTTOM OF LIST ---                               11170000
107500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11180000
107600             SET DP020-MSG-INFORMATIONAL                          11190000
107700                 PS-LIST-END                                      11200000
107800                                   TO TRUE                        11210000
107900         END-IF                                                   11220000
108000     ELSE                                                         11230000
108100         SUBTRACT +1 FROM ASC-SEL-ITEM                            11240000
108200         MOVE PO012-MAX-ITEMS      TO ASC-SEL-SUB                 11250000
108300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11260000
108400         SET DP020-MSG-INFORMATIONAL                              11270000
108500             PS-LIST-END                                          11280000
108600                                   TO TRUE                        11290000
108700     END-IF.                                                      11300000
108800                                                                  11310000
108900/                                                                 11320000
109000*----------------------------------------------------------------*11330000
109100*    GET THE PO NUMBER (KEY) OF THE PREVIOUS SELECTED            *11340000
109200*    OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.         *11350000
109300*----------------------------------------------------------------*11360000
109400 2120-GET-PREV-PO.                                                11370000
109500                                                                  11380000
109600     SUBTRACT +1 FROM ASC-SEL-SUB.                                11390000
109700     IF  ASC-SEL-SUB < +1                                         11400000
109800         SUBTRACT +1 FROM ASC-SEL-ITEM                            11410000
109900         MOVE PO012-MAX-ITEMS      TO ASC-SEL-SUB                 11420000
110000     END-IF.                                                      11430000
110100                                                                  11440000
110200     IF  ASC-SEL-ITEM > ZERO                                      11450000
110300         PERFORM 9100-READ-SEL-QUEUE                              11460000
110400         INITIALIZE ASC-SCREEN-FIELDS                             11470000
110500         MOVE PO012-PO-NBR (ASC-SEL-SUB)                          11480000
110600                                   TO ASC-KEY-PO-NBR              11490000
110700                                      DK-PO-NBR                   11500000
110800         MOVE PO012-STATUS (ASC-SEL-SUB)                          11510000
110900                                   TO ASC-KEY-STATUS-CDE          11520000
111000         MOVE PO012-PO-TYPE (ASC-SEL-SUB)                         11530000
111100                                   TO ASC-KEY-PO-TYP-CDE          11540000
111200         MOVE PO012-VENDOR-NAME (ASC-SEL-SUB)                     11550000
111300                                   TO ASC-KEY-ENT-NAME-DESC       11560000
111400     ELSE                                                         11570000
111500         MOVE +1                   TO ASC-SEL-ITEM                11580000
111600                                      ASC-SEL-SUB                 11590000
111700*        --- TOP OF LIST ---                                      11600000
111800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11610000
111900         SET DP020-MSG-INFORMATIONAL                              11620000
112000             PS-LIST-END           TO TRUE                        11630000
112100     END-IF.                                                      11640000
112200                                                                  11650000
112300/                                                                 11660000
112400*----------------------------------------------------------------*11670000
112500*  THIS PARAGRAPH READS THE PO TABLES AND BUILDS THE SCREEN      *11680000
112600*----------------------------------------------------------------*11690000
112700                                                                  11700000
112800 4000-BUILD-INITIAL-PANEL.                                        11710000
112900                                                                  11720000
113000     SET DP030-SET-CURSOR-TRAILER                                 11730000
113100         PS-NO-ERROR             TO TRUE.                         11740000
113200                                                                  11750000
113300     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR.                    11760000
113400                                                                  11770000
113500     PERFORM 4010-GET-PO-HEADER-INFO.                             11780000
113600                                                                  11790000
113700     PERFORM 4015-GET-RCVG-UNT-INFO.                              11800000
113800     PERFORM 4017-GET-RCVG-SKU-INFO.                              11810000
113900                                                                  11820000
114000     PERFORM 4005-GET-AD-DATE.                                    11830000
114100                                                                  11840000
114200     MOVE ASC-KEY-ENT-ID         TO DK-ENT-ID.                    11850000
114300     MOVE ASC-KEY-DEPT-NBR       TO DK-DEPT-NBR.                  11860000
114400     MOVE ASC-KEY-STATUS-CDE     TO DK-STATUS-CDE.                11870000
114500     MOVE ASC-KEY-PO-TYP-CDE     TO DK-PO-TYP-CDE.                11880000
114600     MOVE ASC-ADR-SEQ-NBR        TO DK-ADR-SEQ-NBR.               11890000
114700                                                                  11900000
114800     IF  ASC-KEY-STATUS-CDE > SPACES                              11910000
114900         PERFORM 4020-GET-PO-STATUS-DESC                          11920000
115000     END-IF.                                                      11930000
115100                                                                  11940000
115200     IF  ASC-KEY-PO-TYP-CDE > SPACES                              11950000
115400         MOVE ASC-KEY-PO-TYP-CDE TO ASC-PO-TYPE                   11960000
115500     END-IF.                                                      11970000
115600                                                                  11980000
115700     PERFORM 4120-GET-PRIMARY-ENT-NAME-DESC.                      11990000
115800                                                                  12000000
115900     PERFORM 4130-GET-PO-ADDRESS.                                 12010000
116000                                                                  12020000
116002     IF BUSLOC-CNTRY-CDE = 'US ' OR SPACES                        12030000
116003        MOVE SPACES             TO PV-COUNTRY                     12040000
116004                                   PV-STATE-PROV                  12050000
116005        MOVE BUSLOC-ST-PROV-CDE TO PV-STATE-PROV                  12060000
116006     ELSE                                                         12070000
116010        PERFORM 4135-RETRIEVE-ST-PRV-CNTY-NAME.                   12080000
116020                                                                  12090000
116100     PERFORM 4140-FORMAT-PO-ADDRESS.                              12100000
116200                                                                  12110000
116300     PERFORM 4050-GET-PLANNED-SHIPMENT-INFO.                      12120000
116400     PERFORM 4055-GET-RECEIPT-DATE-INFO.                          12130000
116500                                                                  12140000
116600* GET PURCHASE INFO                                               12150000
116700     MOVE 3                      TO DK-AGRMT-TYP-ID.              12160000
116800     PERFORM 4060-GET-PO-AGREEMENT-INFO.                          12170000
116900     MOVE POAGMT-EDI-PROMO-TXT   TO ASC-EDI-PROMO-TXT.            12180000
117000                                                                  12190000
117100* GET PAYMENT INFO                                                12200000
117200     MOVE 2                      TO DK-AGRMT-TYP-ID.              12210000
117300     PERFORM 4060-GET-PO-AGREEMENT-INFO.                          12220000
117400                                                                  12230000
117500     IF  SQLCODE = +0                                             12240000
118200         MOVE POAGMT-PAYT-TERM-ID                                 12250000
118300                                 TO DK-PAYT-TERM-ID               12260000
118400         PERFORM 4040-GET-PAYMENT-TERM-INFO                       12270000
118800     END-IF.                                                      12280000
118900                                                                  12290000
119000* GET PRETICKETING INFO                                           12300000
119100     MOVE 4                      TO DK-AGRMT-TYP-ID.              12310000
119200     MOVE 1                      TO DK-TYP-CDE.                   12320000
119300     INITIALIZE PV-DB2-COUNT.                                     12330000
119400     PERFORM 4070-CHECK-PO-SERVICE-INFO.                          12340000
119500     IF  PV-DB2-COUNT > +0                                        12350000
119600         MOVE 'Y'                TO ASC-PRE-TICKETING             12360000
119700     ELSE                                                         12370000
119800         MOVE 'N'                TO ASC-PRE-TICKETING             12380000
119900     END-IF.                                                      12390000
120000                                                                  12400000
120100** GET LEADTIME DAYS QTY INFO                                     12410000
120200     IF ASC-PRE-TICKETING = 'Y'                                   12420000
120300        PERFORM 4075-GET-LEADTIME-DAYS-POAGMT                     12430000
120400     ELSE                                                         12440000
120500        MOVE DP015-PRO-NOR-OFF TO APRETDAA                        12450000
120600        MOVE DP015-BLUE        TO APRETDAC                        12460000
120700        MOVE DP015-HL-OFF      TO APRETDAH                        12470000
120800     END-IF.                                                      12480000
120900                                                                  12490000
121000* GET HANGER INFO                                                 12500000
121100     MOVE 4                      TO DK-AGRMT-TYP-ID.              12510000
121200     MOVE 2                      TO DK-TYP-CDE.                   12520000
121300     INITIALIZE PV-DB2-COUNT.                                     12530000
121400     PERFORM 4070-CHECK-PO-SERVICE-INFO.                          12540000
121500     IF  PV-DB2-COUNT > +0                                        12550000
121600         MOVE 'Y'                TO ASC-HANGER                    12560000
121700     ELSE                                                         12570000
121800         MOVE 'N'                TO ASC-HANGER                    12580000
121900     END-IF.                                                      12590000
122000                                                                  12600000
122100* GET PACK BY STORE INFO                                          12610000
122200     MOVE 4                      TO DK-AGRMT-TYP-ID.              12620000
122300     MOVE 4                      TO DK-TYP-CDE.                   12630000
122400     PERFORM 4070-CHECK-PO-SERVICE-INFO.                          12640000
122500     IF  PV-DB2-COUNT > +0                                        12650000
122600         MOVE 'Y'                TO ASC-PACK-BY-STORE             12660000
122700     ELSE                                                         12670000
122800         MOVE 'N'                TO ASC-PACK-BY-STORE             12680000
122900     END-IF.                                                      12690000
123000                                                                  12700000
123100     INITIALIZE PV-DB2-COUNT.                                     12710000
123200     PERFORM 4080-CHECK-SPECIAL-INSTR.                            12720000
123300     IF  PV-DB2-COUNT > +0                                        12730000
123400         MOVE 'SPECIAL INSTRUCTIONS'                              12740000
123500                                 TO ASC-SPEC-INSTR                12750000
123600     END-IF.                                                      12760000
123700                                                                  12770000
123800     INITIALIZE PV-DB2-COUNT.                                     12780000
123900     PERFORM 4085-CHECK-IF-IN-TROUBLE.                            12790000
124000     IF  PV-DB2-COUNT > +0                                        12800000
124100         MOVE 'IN TROUBLE'       TO ASC-IN-TROUBLE                12810000
124200     END-IF.                                                      12820000
124300                                                                  12830000
124400     MOVE PURCHS-CRE-BY-UID      TO WORKER-UID-NBR.               12840000
124500     PERFORM 4090-GET-TWORKER.                                    12850000
124600     IF  SQLCODE = +0                                             12860000
124700         MOVE 20                 TO DP024-FLNAME-LENGTH           12870000
124800         MOVE WORKER-LAST-NAME   TO DP024-LNAME                   12880000
124900         MOVE WORKER-FIR-NAME    TO DP024-FNAME                   12890000
125000         PERFORM DP024-0000-FORMAT-NAME                           12900000
125100         MOVE DP024-FLNAME       TO ASC-CRE-BY-UID                12910000
125200     ELSE                                                         12920000
125300         MOVE SPACES             TO ASC-CRE-BY-UID                12930000
125400     END-IF.                                                      12940000
125500                                                                  12950000
125600     MOVE PURCHS-APP-BY-UID      TO WORKER-UID-NBR.               12960000
125700     PERFORM 4090-GET-TWORKER.                                    12970000
125800     IF  SQLCODE = +0                                             12980000
125900         MOVE 20                 TO DP024-FLNAME-LENGTH           12990000
126000         MOVE WORKER-LAST-NAME   TO DP024-LNAME                   13000000
126100         MOVE WORKER-FIR-NAME    TO DP024-FNAME                   13010000
126200         PERFORM DP024-0000-FORMAT-NAME                           13020000
126300         MOVE DP024-FLNAME       TO ASC-APP-BY-UID                13030000
126400     ELSE                                                         13040000
126500         MOVE SPACES             TO ASC-APP-BY-UID                13050000
126600     END-IF.                                                      13060000
126700                                                                  13070000
126800     PERFORM 4092-GET-DTS-INFO.                                   13080000
           IF PLNSHP-DONT-SHIP-BEF-DTE NOT EQUAL '0001-01-01'           13090000
             PERFORM 4095-GET-WEEK-NBR                                  13100000
           END-IF.                                                      13101000
126900                                                                  13110000
127000     PERFORM 7000-GET-LATEST-TPOAGMT.                             13120000
127100                                                                  13130000
127200     PERFORM 4180-MOVE-LAST-UPDATED.                              13140000
127300                                                                  13150000
127400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13160000
127500                                                                  13170000
127600/                                                                 13180000
127700*----------------------------------------------------------------*13190000
127800*    GET THE PURCHASE ORDER HEADER INFORMATION                   *13200000
127900*----------------------------------------------------------------*13210000
128000 4010-GET-PO-HEADER-INFO.                                         13220000
145800** INCLUDED THE WAREHOUSE REPLENISHMENT INDICATOR COLUMN IN THE   13221059
145900** QUERY (WHSE_RPLNT_IND)                                         13222059
146000** PP 09/08/2010                                                  13223059
128100                                                                  13230000
128200     PERFORM                                                      13240000
128300         WITH TEST AFTER                                          13250000
128400         VARYING PV-RETRY-COUNTER                                 13260000
128500         FROM 1 BY 1                                              13270000
128600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13280000
128700             OR (SQLCODE = +0)                                    13290000
128800             OR (SQLCODE = +100))                                 13300000
128900                                                                  13310000
129000         EXEC SQL                                                 13320000
129100              SELECT PO_TYP_CDE                                   13330000
129200                    ,EDI_IND                                      13340000
129300                    ,TOT_VAL_COST_AMT                             13350000
129400                    ,TOT_VAL_RTL_AMT                              13360000
129500                    ,TOT_MU_PCT                                   13370000
129600                    ,TOT_UNT_QTY                                  13380000
129700                    ,TOT_SKUS_QTY                                 13390000
129800                    ,OTB_PER_NBR                                  13400000
129900                    ,NEW_STR_PO_IND                               13410000
130000                    ,DIR_STR_IND                                  13420000
130100                    ,DEPT_NBR                                     13430000
130200                    ,ENT_ID                                       13440000
130300                    ,STATUS_CDE                                   13450000
130400                    ,CRE_BY_UID                                   13460000
130500                    ,APP_BY_UID                                   13470000
130600                    ,LAST_UPD_TMST                                13480000
130700                    ,LAST_UPD_BY_UID                              13490000
130800                    ,ORD_DTE                                      13500000
130900                    ,ADR_SEQ_NBR                                  13510000
131000                    ,RLSE_DTE                                     13520000
131100                    ,PKGNG_CDE                                    13530000
131100                    ,WHSE_RPLNT_IND                               13531059
131200                INTO :PURCHS-PO-TYP-CDE                           13540000
131300                    ,:PURCHS-EDI-IND                              13550000
131400                    ,:PURCHS-TOT-VAL-COST-AMT                     13560000
131500                    ,:PURCHS-TOT-VAL-RTL-AMT                      13570000
131600                    ,:PURCHS-TOT-MU-PCT                           13580000
131700                    ,:PURCHS-TOT-UNT-QTY                          13590000
131800                    ,:PURCHS-TOT-SKUS-QTY                         13600000
131900                    ,:PURCHS-OTB-PER-NBR                          13610000
132000                    ,:PURCHS-NEW-STR-PO-IND                       13620000
132100                    ,:PURCHS-DIR-STR-IND                          13630000
132200                    ,:PURCHS-DEPT-NBR                             13640000
132300                    ,:PURCHS-ENT-ID                               13650000
132400                    ,:PURCHS-STATUS-CDE                           13660000
132500                    ,:PURCHS-CRE-BY-UID                           13670000
132600                    ,:PURCHS-APP-BY-UID                           13680000
132700                    ,:PURCHS-LAST-UPD-TMST                        13690000
132800                    ,:PURCHS-LAST-UPD-BY-UID                      13700000
132900                    ,:PURCHS-ORD-DTE                              13710000
133000                    ,:PURCHS-ADR-SEQ-NBR                          13720000
133100                    ,:PURCHS-RLSE-DTE                             13730000
133200                    ,:PURCHS-PKGNG-CDE                            13740000
132220                    ,:PURCHS-WHSE-RPLNT-IND                       13741059
133300                FROM TPURCHS                                      13750000
133400               WHERE PO_NBR         = :DK-PO-NBR                  13760000
133500                 AND VER_STATUS_CDE = 'A'                         13770000
133600                 AND PO_CATEG_CDE   = 'MR'                        13780000
133700         END-EXEC                                                 13790000
133800                                                                  13800000
133900         EVALUATE TRUE                                            13810000
134000             WHEN SQLCODE = +0                                    13820000
134100                  MOVE PURCHS-PO-TYP-CDE                          13830000
134200                                 TO ASC-KEY-PO-TYP-CDE            13840000
134300                  MOVE PURCHS-EDI-IND                             13850000
134400                                 TO ASC-EDI-IND                   13860000
134500                  MOVE PURCHS-TOT-VAL-COST-AMT                    13870000
134600                                 TO ASC-TOT-VAL-COST-AMT          13880000
134700                  MOVE PURCHS-TOT-VAL-RTL-AMT                     13890000
134800                                 TO ASC-TOT-VAL-RTL-AMT           13900000
134900                  MOVE PURCHS-TOT-MU-PCT                          13910000
135000                                 TO ASC-MU-PCT                    13920000
135100                  MOVE PURCHS-TOT-UNT-QTY                         13930000
135200                                 TO ASC-TOT-UNT-QTY               13940000
135300                  MOVE PURCHS-TOT-SKUS-QTY                        13950000
135400                                 TO ASC-SKUS-ORDERED              13960000
135500                  MOVE PURCHS-OTB-PER-NBR                         13970000
135600                                 TO PV-OTB-PER-BREAK              13980000
135700                  IF PV-OTB-PER-BREAK = SPACES                    13990000
135800                                                                  14000000
135900                   MOVE SPACES   TO ASC-OTB-PER-NBR               14010000
136000                  ELSE                                            14020000
136100                                                                  14030000
136200                    MOVE PV-OTBP-YY                               14040000
136300                                  TO PV-OTBPD-YY                  14050000
136400                    MOVE PC-MONTH-ABBR (PV-OTBP-MM-N)             14060000
136500                                  TO PV-OTBPD-MONTH               14070000
136600                    MOVE PV-OTB-PER-DISPLAY                       14080000
136700                                  TO ASC-OTB-PER-NBR              14090000
136800                  END-IF                                          14100000
136900                                                                  14110000
137000                  MOVE PURCHS-NEW-STR-PO-IND                      14120000
137100                                 TO ASC-NEW-STR-PO-IND            14130000
137200                  MOVE PURCHS-DIR-STR-IND                         14140000
137300                                 TO ASC-DIR-STR-IND               14150000
137400                  MOVE PURCHS-DEPT-NBR                            14160000
137500                                 TO ASC-KEY-DEPT-NBR              14170000
137600                  MOVE PURCHS-ENT-ID                              14180000
137700                                 TO ASC-KEY-ENT-ID                14190000
137800                  MOVE PURCHS-STATUS-CDE                          14200000
137900                                 TO ASC-KEY-STATUS-CDE            14210000
138000                  MOVE PURCHS-ADR-SEQ-NBR                         14220000
138100                                 TO ASC-ADR-SEQ-NBR               14230000
138200                  MOVE PURCHS-PKGNG-CDE                           14240000
138300                                 TO ASC-PKGNG-CDE                 14250000
138400                                                                  14260000
138500                  IF PURCHS-ORD-DTE = '0001-01-01'                14270000
138600                      MOVE SPACES                                 14280000
138700                                 TO ASC-ORD-DTE                   14290000
138800                  ELSE                                            14300000
138900                      MOVE PURCHS-ORD-DTE                         14310000
139000                                 TO PV-DB2-DATE                   14320000
139100                      MOVE PV-DB2-DATE-MM                         14330000
139200                                 TO PV-DISPLAY-DATE-MM            14340000
139300                      MOVE PV-DB2-DATE-DD                         14350000
139400                                 TO PV-DISPLAY-DATE-DD            14360000
139500                      MOVE PV-DB2-DATE-YY                         14370000
139600                                 TO PV-DISPLAY-DATE-YY            14380000
139700                      MOVE PV-DISPLAY-DATE                        14390000
139800                                 TO ASC-ORD-DTE                   14400000
139900                  END-IF                                          14410000
140000                                                                  14420000
140100                  IF PURCHS-RLSE-DTE = '0001-01-01'               14430000
140200                      MOVE SPACES                                 14440000
140300                                 TO ASC-RLSE-DTE                  14450000
140400                  ELSE                                            14460000
140500                      MOVE PURCHS-RLSE-DTE                        14470000
140600                                 TO PV-DB2-DATE                   14480000
140700                      MOVE PV-DB2-DATE-MM                         14490000
140800                                 TO PV-DISPLAY-DATE-MM            14500000
140900                      MOVE PV-DB2-DATE-DD                         14510000
141000                                 TO PV-DISPLAY-DATE-DD            14520000
141100                      MOVE PV-DB2-DATE-YY                         14530000
141200                                 TO PV-DISPLAY-DATE-YY            14540000
141300                      MOVE PV-DISPLAY-DATE                        14550000
141400                                 TO ASC-RLSE-DTE                  14560000
141500                  END-IF                                          14570000
141300                  MOVE PURCHS-WHSE-RPLNT-IND                      14571058
141400                                 TO ASC-WHSE-RPLNT-IND            14572058
141600             WHEN SQLCODE = +100                                  14580000
141700             WHEN SQLCODE = -904                                  14590000
141800             WHEN SQLCODE = -913                                  14600000
141900                  CONTINUE                                        14610000
142000                                                                  14620000
142100             WHEN SQLWARN0 NOT = SPACES                           14630000
142200             WHEN SQLCODE < +0                                    14640000
142300             WHEN SQLCODE > +0                                    14650000
142400                  MOVE '4010-GET-PO-HEADER-INFO'                  14660000
142500                                  TO DP013-PARAGRAPH              14670000
142600                  MOVE 'UNSUCCESSFUL SELECT PO HEADER'            14680000
142700                                  TO DP013-MESSAGE-TEXT (1)       14690000
142800                  MOVE SQLCA      TO DP013-SQLCA                  14700000
142900                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     14710000
143000                  SET DP013-DB2-ABEND                             14720000
143100                      DP013-XCTL-DISPLAY-RESTART                  14730000
143200                                  TO TRUE                         14740000
143300                  PERFORM DP013-0000-PROCESS-ABEND                14750000
143400         END-EVALUATE                                             14760000
143500     END-PERFORM.                                                 14770000
143600                                                                  14780000
143700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14790000
143800         MOVE '4010-GET-PO-HEADER-INFO'                           14800000
143900                                  TO DP013-PARAGRAPH              14810000
144000         MOVE 'MAX RETRIES EXCEEDED ON SELECT PO HEADER'          14820000
144100                                  TO DP013-MESSAGE-TEXT (1)       14830000
144200         MOVE SQLCA               TO DP013-SQLCA                  14840000
144300         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     14850000
144400         SET DP013-DB2-ABEND                                      14860000
144500             DP013-XCTL-DISPLAY-RESTART                           14870000
144600                                  TO TRUE                         14880000
144700         PERFORM DP013-0000-PROCESS-ABEND                         14890000
144800     END-IF.                                                      14900000
144900                                                                  14910000
145000/                                                                 14920000
145100*----------------------------------------------------------------*14930000
145200*    GET THE PURCHASE ORDER HEADER RECEIVING INFORMATION         *14940000
145300*----------------------------------------------------------------*14950000
145400 4015-GET-RCVG-UNT-INFO.                                          14960000
145500                                                                  14970000
145600     PERFORM                                                      14980000
145700         WITH TEST AFTER                                          14990000
145800         VARYING PV-RETRY-COUNTER                                 15000000
145900         FROM 1 BY 1                                              15010000
146000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15020000
146100             OR (SQLCODE = +0)                                    15030000
146200             OR (SQLCODE = +100))                                 15040000
146300                                                                  15050000
146400         EXEC SQL                                                 15060000
146500         SELECT SUM(AP_VERIFY_ITM_QTY)                            15070000
146600          INTO :RECDIS-AP-VERIFY-ITM-QTY:PV-VER-QTY-NULL          15080000
146700          FROM TRECDIS                                            15090000
146800          WHERE ORD_NBR = :ASC-KEY-PO-NBR                         15100000
146900           AND  VER_STATUS_CDE = 'A'                              15110000
147000          END-EXEC                                                15120000
147100                                                                  15130000
147200          EVALUATE TRUE                                           15140000
147300             WHEN SQLCODE = +0                                    15150000
147400             IF PV-VER-QTY-NULL < ZERO                            15160000
147500                MOVE ZEROES                                       15170000
147600                                 TO ASC-TOT-UNT-RCVD-QTY          15180000
147700             ELSE                                                 15190000
147800                MOVE RECDIS-AP-VERIFY-ITM-QTY TO                  15200000
147900                                    ASC-TOT-UNT-RCVD-QTY          15210000
148000                                                                  15220000
148100             END-IF                                               15230000
148200                                                                  15240000
148300                                                                  15250000
148400             WHEN SQLCODE = -904                                  15260000
148500             WHEN SQLCODE = -913                                  15270000
148600                  CONTINUE                                        15280000
148700                                                                  15290000
148800             WHEN SQLWARN0 NOT = SPACES                           15300000
148900             WHEN SQLCODE < +0                                    15310000
149000             WHEN SQLCODE > +0                                    15320000
149100                  MOVE '4015-GET-RCVG-UNT-INFO'                   15330000
149200                                  TO DP013-PARAGRAPH              15340000
149300                  MOVE 'UNSUCCESSFUL SELECT RECDIS   '            15350000
149400                                  TO DP013-MESSAGE-TEXT (1)       15360000
149500                  MOVE SQLCA      TO DP013-SQLCA                  15370000
149600                  MOVE 'TRECDIS ' TO DP013-DB2-TABLE-NAME (1)     15380000
149700                  SET DP013-DB2-ABEND                             15390000
149800                      DP013-XCTL-DISPLAY-RESTART                  15400000
149900                                  TO TRUE                         15410000
150000                  PERFORM DP013-0000-PROCESS-ABEND                15420000
150100         END-EVALUATE                                             15430000
150200     END-PERFORM.                                                 15440000
150300                                                                  15450000
150400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15460000
150500         MOVE '4015-GET-RCVG-UNT-INFO'                            15470000
150600                                  TO DP013-PARAGRAPH              15480000
150700         MOVE 'MAX RETRIES EXCEEDED ON SELECT TRECEIV  '          15490000
150800                                  TO DP013-MESSAGE-TEXT (1)       15500000
150900         MOVE SQLCA               TO DP013-SQLCA                  15510000
151000         MOVE 'TRECDIS '          TO DP013-DB2-TABLE-NAME (1)     15520000
151100         SET DP013-DB2-ABEND                                      15530000
151200             DP013-XCTL-DISPLAY-RESTART                           15540000
151300                                  TO TRUE                         15550000
151400         PERFORM DP013-0000-PROCESS-ABEND                         15560000
151500     END-IF.                                                      15570000
151600                                                                  15580000
151700/                                                                 15590000
151800*----------------------------------------------------------------*15600000
151900*    GET THE PURCHASE ORDER HEADER RECEIVING INFORMATION         *15610000
152000*----------------------------------------------------------------*15620000
152100 4017-GET-RCVG-SKU-INFO.                                          15630000
152200                                                                  15640000
152300     PERFORM                                                      15650000
152400         WITH TEST AFTER                                          15660000
152500         VARYING PV-RETRY-COUNTER                                 15670000
152600         FROM 1 BY 1                                              15680000
152700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15690000
152800             OR (SQLCODE = +0)                                    15700000
152900             OR (SQLCODE = +100))                                 15710000
153000                                                                  15720000
W24803         MOVE DK-PO-NBR TO PURITM-PO-NBR                          15721000
                                                                        15722000
153100         EXEC SQL                                                 15730000
W24803            SELECT COUNT (DISTINCT A.ITM_NBR)                     15741000
W24803            INTO :PV-TOT-ITM-RCVD                                 15751000
153400               FROM TPURITM A,                                    15760000
153500                    TRECITM B                                     15770000
153600            WHERE A.PO_NBR           = :PURITM-PO-NBR             15780000
153700              AND A.PO_NBR           = B.ORD_NBR                  15790000
153800              AND A.VER_STATUS_CDE   = 'A'                        15800000
153900              AND B.VER_STATUS_CDE   = 'A'                        15810000
154000              AND A.APP_PO_LNE_NBR   = B.ORD_LNE_NBR              15820000
154100              AND B.STATUS_CDE       = 'VE'                       15830000
154200         END-EXEC                                                 15840000
154300                                                                  15850000
154400         EVALUATE TRUE                                            15860000
154500             WHEN SQLCODE = +0                                    15870000
W24803                  MOVE PV-TOT-ITM-RCVD                            15881000
154700                                 TO ASC-TOT-SKU-RCVD-QTY          15890000
154800                                                                  15900000
154900             WHEN SQLCODE = +100                                  15910000
155000             WHEN SQLCODE = -904                                  15920000
155100             WHEN SQLCODE = -913                                  15930000
155200                  CONTINUE                                        15940000
155300                                                                  15950000
155400             WHEN SQLWARN0 NOT = SPACES                           15960000
155500             WHEN SQLCODE < +0                                    15970000
155600             WHEN SQLCODE > +0                                    15980000
155700                  MOVE '4017-GET-RCVG-SKU-INFO'                   15990000
155800                                  TO DP013-PARAGRAPH              16000000
155900                  MOVE 'UNSUCCESSFUL SELECT RECEITM  '            16010000
156000                                  TO DP013-MESSAGE-TEXT (1)       16020000
156100                  MOVE SQLCA      TO DP013-SQLCA                  16030000
156200                  MOVE 'TRECEITM' TO DP013-DB2-TABLE-NAME (1)     16040000
156300                  SET DP013-DB2-ABEND                             16050000
156400                      DP013-XCTL-DISPLAY-RESTART                  16060000
156500                                  TO TRUE                         16070000
156600                  PERFORM DP013-0000-PROCESS-ABEND                16080000
156700         END-EVALUATE                                             16090000
156800     END-PERFORM.                                                 16100000
156900                                                                  16110000
157000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16120000
157100         MOVE '4017-GET-RCVG-SKU-INFO'                            16130000
157200                                  TO DP013-PARAGRAPH              16140000
157300         MOVE 'MAX RETRIES EXCEEDED ON SELECT TRECITM  '          16150000
157400                                  TO DP013-MESSAGE-TEXT (1)       16160000
157500         MOVE SQLCA               TO DP013-SQLCA                  16170000
157600         MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1)     16180000
157700         SET DP013-DB2-ABEND                                      16190000
157800             DP013-XCTL-DISPLAY-RESTART                           16200000
157900                                  TO TRUE                         16210000
158000         PERFORM DP013-0000-PROCESS-ABEND                         16220000
158100     END-IF.                                                      16230000
158200                                                                  16240000
158300/                                                                 16250000
158400*----------------------------------------------------------------*16260000
158500*    GET THE EARLIEST AD DATE                                    *16270000
158600*----------------------------------------------------------------*16280000
158700 4005-GET-AD-DATE.                                                16290000
158800                                                                  16300000
158900     PERFORM                                                      16310000
159000         WITH TEST AFTER                                          16320000
159100         VARYING PV-RETRY-COUNTER                                 16330000
159200         FROM 1 BY 1                                              16340000
159300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16350000
159400             OR (SQLCODE = +0)                                    16360000
159500             OR (SQLCODE = +100))                                 16370000
159600                                                                  16380000
159700         EXEC SQL                                                 16390000
159800              SELECT MIN(AD_EVNT_DTE)                             16400000
159900                INTO :PV-DB2-DATE-HOST:PV-NULL-IND                16410000
160000                FROM TPURITM                                      16420000
160100               WHERE PO_NBR         = :DK-PO-NBR                  16430000
160200                 AND VER_STATUS_CDE = 'A'                         16440000
160300                 AND AD_EVNT_DTE > '0001-01-01'                   16450000
160400                 AND STATUS_CDE NOT IN ('CA')                     16460000
160500         END-EXEC                                                 16470000
160600                                                                  16480000
160700         EVALUATE TRUE                                            16490000
160800             WHEN SQLCODE = +100                                  16500000
160900                      MOVE SPACES           TO ASC-AD-EVNT-DTE    16510000
161000                                                                  16520000
161100             WHEN SQLCODE = +0                                    16530000
161200                  IF  PV-NULL-IND < +0                            16540000
161300                      MOVE SPACES           TO ASC-AD-EVNT-DTE    16550000
161400                  ELSE                                            16560000
161500                      MOVE PV-DB2-DATE-HOST TO PV-DB2-DATE        16570000
161600                      MOVE PV-DB2-DATE-MM   TO PV-DISPLAY-DATE-MM 16580000
161700                      MOVE PV-DB2-DATE-DD   TO PV-DISPLAY-DATE-DD 16590000
161800                      MOVE PV-DB2-DATE-YY   TO PV-DISPLAY-DATE-YY 16600000
161900                      MOVE PV-DISPLAY-DATE  TO ASC-AD-EVNT-DTE    16610000
162000                  END-IF                                          16620000
162100                                                                  16630000
162200                                                                  16640000
162300             WHEN SQLCODE = -904                                  16650000
162400             WHEN SQLCODE = -913                                  16660000
162500                  CONTINUE                                        16670000
162600                                                                  16680000
162700             WHEN SQLWARN0 NOT = SPACES                           16690000
162800             WHEN SQLCODE < +0                                    16700000
162900             WHEN SQLCODE > +0                                    16710000
163000                  MOVE '4005-GET-AD-DATE'                         16720000
163100                                  TO DP013-PARAGRAPH              16730000
163200                  MOVE 'UNSUCCESSFUL SELECT AD DATE'              16740000
163300                                  TO DP013-MESSAGE-TEXT (1)       16750000
163400                  MOVE SQLCA      TO DP013-SQLCA                  16760000
163500                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     16770000
163600                  SET DP013-DB2-ABEND                             16780000
163700                      DP013-XCTL-DISPLAY-RESTART                  16790000
163800                                  TO TRUE                         16800000
163900                  PERFORM DP013-0000-PROCESS-ABEND                16810000
164000         END-EVALUATE                                             16820000
164100     END-PERFORM.                                                 16830000
164200                                                                  16840000
164300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16850000
164400         MOVE '4005-GET-AD-DATE'                                  16860000
164500                                  TO DP013-PARAGRAPH              16870000
164600         MOVE 'MAX RETRIES EXCEEDED ON SELECT AD DATE'            16880000
164700                                  TO DP013-MESSAGE-TEXT (1)       16890000
164800         MOVE SQLCA               TO DP013-SQLCA                  16900000
164900         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     16910000
165000         SET DP013-DB2-ABEND                                      16920000
165100             DP013-XCTL-DISPLAY-RESTART                           16930000
165200                                  TO TRUE                         16940000
165300         PERFORM DP013-0000-PROCESS-ABEND                         16950000
165400     END-IF.                                                      16960000
165500                                                                  16970000
165600/                                                                 16980000
165700*----------------------------------------------------------------*16990000
165800*    GET THE PURCHASE ORDER STATUS DESCRIPTION                   *17000000
165900*----------------------------------------------------------------*17010000
166000 4020-GET-PO-STATUS-DESC.                                         17020000
166100                                                                  17030000
166200     PERFORM                                                      17040000
166300         WITH TEST AFTER                                          17050000
166400         VARYING PV-RETRY-COUNTER                                 17060000
166500         FROM 1 BY 1                                              17070000
166600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17080000
166700             OR (SQLCODE = +0)                                    17090000
166800             OR (SQLCODE = +100))                                 17100000
166900                                                                  17110000
167000         EXEC SQL                                                 17120000
167100              SELECT STATUS_DESC                                  17130000
167200                INTO :STATCD-STATUS-DESC                          17140000
167300                FROM TSTATCD                                      17150000
167400               WHERE STATUS_TYP_CDE = 'P'                         17160000
167500                 AND STATUS_CDE     = :DK-STATUS-CDE              17170000
167600         END-EXEC                                                 17180000
167700                                                                  17190000
167800         EVALUATE TRUE                                            17200000
167900             WHEN SQLCODE = +0                                    17210000
168000                  MOVE STATCD-STATUS-DESC                         17220000
168100                                  TO ASC-PO-STATUS-DESC           17230000
168200                                                                  17240000
168300             WHEN SQLCODE = +100                                  17250000
168400                  MOVE SPACES     TO ASC-PO-STATUS-DESC           17260000
168500             WHEN SQLCODE = -904                                  17270000
168600             WHEN SQLCODE = -913                                  17280000
168700                  CONTINUE                                        17290000
168800                                                                  17300000
168900             WHEN SQLWARN0 NOT = SPACES                           17310000
169000             WHEN SQLCODE < +0                                    17320000
169100             WHEN SQLCODE > +0                                    17330000
169200                  MOVE '4020-GET-PO-STATUS-DESC'                  17340000
169300                                  TO DP013-PARAGRAPH              17350000
169400                  MOVE 'UNSUCCESSFUL SELECT PO STATUS DESC'       17360000
169500                                  TO DP013-MESSAGE-TEXT (1)       17370000
169600                  MOVE SQLCA      TO DP013-SQLCA                  17380000
169700                  MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)     17390000
169800                  SET DP013-DB2-ABEND                             17400000
169900                      DP013-XCTL-DISPLAY-RESTART                  17410000
170000                                  TO TRUE                         17420000
170100                  PERFORM DP013-0000-PROCESS-ABEND                17430000
170200         END-EVALUATE                                             17440000
170300     END-PERFORM.                                                 17450000
170400                                                                  17460000
170500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17470000
170600         MOVE '4020-GET-PO-STATUS-DESC'                           17480000
170700                                  TO DP013-PARAGRAPH              17490000
170800         MOVE 'MAX RETRIES EXCEEDED ON SELECT PO STATUS DESC'     17500000
170900                                  TO DP013-MESSAGE-TEXT (1)       17510000
171000         MOVE SQLCA               TO DP013-SQLCA                  17520000
171100         MOVE 'TSTATCD '          TO DP013-DB2-TABLE-NAME (1)     17530000
171200         SET DP013-DB2-ABEND                                      17540000
171300             DP013-XCTL-DISPLAY-RESTART                           17550000
171400                                  TO TRUE                         17560000
171500         PERFORM DP013-0000-PROCESS-ABEND                         17570000
171600     END-IF.                                                      17580000
171700                                                                  17590000
178100/                                                                 17600000
178200*----------------------------------------------------------------*17610000
178300*    GET PAYMENT TERM INFORMATION                                *17620000
178400*----------------------------------------------------------------*17630000
178500                                                                  17640000
178600 4040-GET-PAYMENT-TERM-INFO.                                      17650000
178700                                                                  17660000
178800     PERFORM                                                      17670000
178900         WITH TEST AFTER                                          17680000
179000         VARYING PV-RETRY-COUNTER                                 17690000
179100         FROM 1 BY 1                                              17700000
179200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17710000
179300             OR (SQLCODE = +0)                                    17720000
179400             OR (SQLCODE = +100))                                 17730000
179500                                                                  17740000
179600         EXEC SQL                                                 17750000
179700               SELECT PAY_TERM_ID                                 17760000
179800                     ,DISCOUNT_DAYS_QTY                           17770000
179900                     ,DISCOUNT_PCT                                17780000
180000                     ,DUE_DAY_QTY                                 17790000
180100                     ,DUE_DAY_FR_DTE_TXT                          17800000
180200                     ,OTHER_TXT                                   17810000
180300                INTO :PAYTRM-PAY-TERM-ID                          17820000
180400                    ,:PAYTRM-DISCOUNT-DAYS-QTY                    17830000
180500                    ,:PAYTRM-DISCOUNT-PCT                         17840000
180600                    ,:PAYTRM-DUE-DAY-QTY                          17850000
180700                    ,:PAYTRM-DUE-DAY-FR-DTE-TXT                   17860000
180800                    ,:PAYTRM-OTHER-TXT                            17870000
180900                FROM TPAYTRM                                      17880000
181000               WHERE PAY_TERM_ID = :DK-PAYT-TERM-ID               17890000
181100         END-EXEC                                                 17900000
181200                                                                  17910000
181300         EVALUATE TRUE                                            17920000
181400             WHEN SQLCODE = +0                                    17930000
181500             WHEN SQLCODE = +100                                  17940000
181600             WHEN SQLCODE = -904                                  17950000
181700             WHEN SQLCODE = -913                                  17960000
181800                  CONTINUE                                        17970000
181900                                                                  17980000
182000             WHEN SQLWARN0 NOT = SPACES                           17990000
182100             WHEN SQLCODE < +0                                    18000000
182200             WHEN SQLCODE > +0                                    18010000
182300                  MOVE '4040-GET-PAYMENT-TERM-INFO'               18020000
182400                                  TO DP013-PARAGRAPH              18030000
182500                  MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS'        18040000
182600                                  TO DP013-MESSAGE-TEXT (1)       18050000
182700                  MOVE SQLCA      TO DP013-SQLCA                  18060000
182800                  MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)     18070000
182900                  SET DP013-DB2-ABEND                             18080000
183000                      DP013-XCTL-DISPLAY-RESTART                  18090000
183100                                  TO TRUE                         18100000
183200                  PERFORM DP013-0000-PROCESS-ABEND                18110000
183300         END-EVALUATE                                             18120000
183400     END-PERFORM.                                                 18130000
183500                                                                  18140000
183600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18150000
183700         MOVE '4040-GET-PAYMENT-TERM-INFO'                        18160000
183800                                  TO DP013-PARAGRAPH              18170000
183900         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAYMENT TERMS'      18180000
184000                                  TO DP013-MESSAGE-TEXT (1)       18190000
184100         MOVE SQLCA               TO DP013-SQLCA                  18200000
184200         MOVE 'TPAYTRM '          TO DP013-DB2-TABLE-NAME (1)     18210000
184300         SET DP013-DB2-ABEND                                      18220000
184400             DP013-XCTL-DISPLAY-RESTART                           18230000
184500                                  TO TRUE                         18240000
184600         PERFORM DP013-0000-PROCESS-ABEND                         18250000
184700     END-IF.                                                      18260000
184800                                                                  18270000
184900/                                                                 18280000
185000*----------------------------------------------------------------*18290000
185100*    GET PLANNED SHIPMENT INFORMATION                            *18300000
185200*----------------------------------------------------------------*18310000
185300 4050-GET-PLANNED-SHIPMENT-INFO.                                  18320000
185400                                                                  18330000
185500     PERFORM                                                      18340000
185600         WITH TEST AFTER                                          18350000
185700         VARYING PV-RETRY-COUNTER                                 18360000
185800         FROM 1 BY 1                                              18370000
185900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18380000
186000             OR (SQLCODE = +0)                                    18390000
186100             OR (SQLCODE = +100))                                 18400000
186200                                                                  18410000
186300         EXEC SQL                                                 18420000
186400              SELECT CHAR(DONT_SHIP_BEF_DTE,ISO)                  18430000
186500                    ,CHAR(CAN_IFNOT_SHIP_DTE,ISO)                 18440000
186600                    ,CHAR(EXT_CAN_DTE,ISO)                        18450000
186700                    ,LAST_UPD_TMST                                18460000
186800                    ,LAST_UPD_BY_UID                              18470000
186900                INTO :PLNSHP-DONT-SHIP-BEF-DTE                    18480000
187000                    ,:PLNSHP-CAN-IFNOT-SHIP-DTE                   18490000
187100                    ,:PLNSHP-EXT-CAN-DTE                          18500000
187200                    ,:PLNSHP-LAST-UPD-TMST                        18510000
187300                    ,:PLNSHP-LAST-UPD-BY-UID                      18520000
187400                FROM TPLNSHP                                      18530000
187500               WHERE PO_NBR         = :DK-PO-NBR                  18540000
187600                 AND VER_STATUS_CDE = 'A'                         18550000
187800         END-EXEC                                                 18560000
187900                                                                  18570000
188000         EVALUATE TRUE                                            18580000
188100             WHEN SQLCODE = +0                                    18590000
188200                  IF  PLNSHP-DONT-SHIP-BEF-DTE > SPACES           18600000
188300                  AND PLNSHP-DONT-SHIP-BEF-DTE NOT = '0001-01-01' 18610000
188400                      MOVE PLNSHP-DONT-SHIP-BEF-DTE               18620000
188500                                           TO PV-DB2-DATE         18630000
188600                      MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM  18640000
188700                      MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD  18650000
188800                      MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY  18660000
188900                      MOVE PV-DISPLAY-DATE TO ASC-DONT-SHIP-DTE   18670000
189000                  ELSE                                            18680000
189100                      MOVE SPACES          TO ASC-DONT-SHIP-DTE   18690000
189200                  END-IF                                          18700000
189300                  IF  PLNSHP-CAN-IFNOT-SHIP-DTE > SPACES          18710000
189400                  AND PLNSHP-CAN-IFNOT-SHIP-DTE NOT = '0001-01-01'18720000
189500                      MOVE PLNSHP-CAN-IFNOT-SHIP-DTE              18730000
189600                                           TO PV-DB2-DATE         18740000
189700                      MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM  18750000
189800                      MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD  18760000
189900                      MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY  18770000
190000                      MOVE PV-DISPLAY-DATE TO                     18780000
190100                                           ASC-CAN-IFNOT-SHIP-DTE 18790000
190200                  ELSE                                            18800000
190300                      MOVE SPACES          TO                     18810000
190400                                           ASC-CAN-IFNOT-SHIP-DTE 18820000
190500                  END-IF                                          18830000
190600                  IF  PLNSHP-EXT-CAN-DTE > SPACES                 18840000
190700                  AND PLNSHP-EXT-CAN-DTE NOT = '0001-01-01'       18850000
190800                      MOVE PLNSHP-EXT-CAN-DTE TO PV-DB2-DATE      18860000
190900                      MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM  18870000
191000                      MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD  18880000
191100                      MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY  18890000
191200                      MOVE PV-DISPLAY-DATE TO ASC-EXT-CAN-DTE     18900000
191300                  ELSE                                            18910000
191400                      MOVE SPACES          TO ASC-EXT-CAN-DTE     18920000
191500                  END-IF                                          18930000
191600                                                                  18940000
191700             WHEN SQLCODE = +100                                  18950000
191800                  MOVE SPACES     TO ASC-DONT-SHIP-DTE            18960000
191900                                     ASC-CAN-IFNOT-SHIP-DTE       18970000
192000                                     ASC-EXT-CAN-DTE              18980000
192100                                                                  18990000
192200             WHEN SQLCODE = -904                                  19000000
192300             WHEN SQLCODE = -913                                  19010000
192400                  CONTINUE                                        19020000
192500                                                                  19030000
192600             WHEN SQLWARN0 NOT = SPACES                           19040000
192700             WHEN SQLCODE < +0                                    19050000
192800             WHEN SQLCODE > +0                                    19060000
192900                  MOVE '4050-GET-PLANNED-SHIPMENT-INFO'           19070000
193000                                  TO DP013-PARAGRAPH              19080000
193100                  MOVE 'UNSUCCESSFUL SELECT PLANNED SHIPMENTS'    19090000
193200                                  TO DP013-MESSAGE-TEXT (1)       19100000
193300                  MOVE SQLCA      TO DP013-SQLCA                  19110000
193400                  MOVE 'TPLNSHP ' TO DP013-DB2-TABLE-NAME (1)     19120000
193500                  SET DP013-DB2-ABEND                             19130000
193600                      DP013-XCTL-DISPLAY-RESTART                  19140000
193700                                  TO TRUE                         19150000
193800                  PERFORM DP013-0000-PROCESS-ABEND                19160000
193900         END-EVALUATE                                             19170000
194000     END-PERFORM.                                                 19180000
194100                                                                  19190000
194200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19200000
194300         MOVE '4050-GET-PLANNED-SHIPMENT-INFO'                    19210000
194400                                  TO DP013-PARAGRAPH              19220000
194500         MOVE 'MAX RETRIES EXCEEDED ON SELECT PLANNED SHIPMENTS'  19230000
194600                                  TO DP013-MESSAGE-TEXT (1)       19240000
194700         MOVE SQLCA               TO DP013-SQLCA                  19250000
194800         MOVE 'TPLNSHP '          TO DP013-DB2-TABLE-NAME (1)     19260000
194900         SET DP013-DB2-ABEND                                      19270000
195000             DP013-XCTL-DISPLAY-RESTART                           19280000
195100                                  TO TRUE                         19290000
195200         PERFORM DP013-0000-PROCESS-ABEND                         19300000
195300     END-IF.                                                      19310000
195400                                                                  19320000
195500/                                                                 19330000
195600*----------------------------------------------------------------*19340000
195700*    GET RECEIPT DATE INFORMATION                                *19350000
195800*----------------------------------------------------------------*19360000
195900 4055-GET-RECEIPT-DATE-INFO.                                      19370000
196000                                                                  19380000
196100     PERFORM                                                      19390000
196200         WITH TEST AFTER                                          19400000
196300         VARYING PV-RETRY-COUNTER                                 19410000
196400         FROM 1 BY 1                                              19420000
196500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19430000
196600             OR (SQLCODE = +0)                                    19440000
196700             OR (SQLCODE = +100)                                  19450000
196800             OR (SQLCODE = -305))                                 19460000
196900                                                                  19470000
197000         EXEC SQL                                                 19480000
197100              SELECT MAX(VERFYD_TMST)                             19490000
197200                    ,MIN(VERFYD_TMST)                             19500000
197300                INTO :PV-MAX-VERFYD-TMST                          19510000
197400                    ,:PV-MIN-VERFYD-TMST                          19520000
197500                FROM TRECITM                                      19530000
197600               WHERE ORD_NBR        = :DK-PO-NBR                  19540000
197700                 AND VER_STATUS_CDE = 'A'                         19550000
197800                 AND VERFYD_TMST   ^= :PC-NULL-TMST               19560000
197900         END-EXEC                                                 19570000
198000                                                                  19580000
198100         EVALUATE TRUE                                            19590000
198200             WHEN SQLCODE = +0                                    19600000
198300                  MOVE PV-MAX-VERFYD-TMST  TO PV-DB2-DATE         19610000
198400                  MOVE PV-DB2-DATE-MM      TO PV-DISPLAY-DATE-MM  19620000
198500                  MOVE PV-DB2-DATE-DD      TO PV-DISPLAY-DATE-DD  19630000
198600                  MOVE PV-DB2-DATE-YY      TO PV-DISPLAY-DATE-YY  19640000
198700                  MOVE PV-DISPLAY-DATE     TO ASC-LAST-RCPT-DTE   19650000
198800                  MOVE PV-MIN-VERFYD-TMST  TO PV-DB2-DATE         19660000
198900                  MOVE PV-DB2-DATE-MM      TO PV-DISPLAY-DATE-MM  19670000
199000                  MOVE PV-DB2-DATE-DD      TO PV-DISPLAY-DATE-DD  19680000
199100                  MOVE PV-DB2-DATE-YY      TO PV-DISPLAY-DATE-YY  19690000
199200                  MOVE PV-DISPLAY-DATE     TO ASC-FIRST-RCPT-DTE  19700000
199300                                                                  19710000
199400             WHEN SQLCODE = +100                                  19720000
199500                  MOVE SPACES              TO ASC-FIRST-RCPT-DTE  19730000
199600                  MOVE SPACES              TO ASC-LAST-RCPT-DTE   19740000
199700                                                                  19750000
199800             WHEN SQLCODE = -305                                  19760000
199900                  MOVE SPACES              TO ASC-FIRST-RCPT-DTE  19770000
200000                  MOVE SPACES              TO ASC-LAST-RCPT-DTE   19780000
200100                                                                  19790000
200200             WHEN SQLCODE = -904                                  19800000
200300             WHEN SQLCODE = -913                                  19810000
200400                  CONTINUE                                        19820000
200500                                                                  19830000
200600             WHEN SQLWARN0 NOT = SPACES                           19840000
200700             WHEN SQLCODE < +0                                    19850000
200800             WHEN SQLCODE > +0                                    19860000
200900                  MOVE '4055-GET-RECEIPT-DATE-INFO'               19870000
201000                                  TO DP013-PARAGRAPH              19880000
201100                  MOVE 'UNSUCCESSFUL SELECT RECEIPT DATES'        19890000
201200                                  TO DP013-MESSAGE-TEXT (1)       19900000
201300                  MOVE SQLCA      TO DP013-SQLCA                  19910000
201400                  MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)     19920000
201500                  SET DP013-DB2-ABEND                             19930000
201600                      DP013-XCTL-DISPLAY-RESTART                  19940000
201700                                  TO TRUE                         19950000
201800                  PERFORM DP013-0000-PROCESS-ABEND                19960000
201900         END-EVALUATE                                             19970000
202000     END-PERFORM.                                                 19980000
202100                                                                  19990000
202200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20000000
202300         MOVE '4055-GET-RECEIPT-DATE-INFO'                        20010000
202400                                  TO DP013-PARAGRAPH              20020000
202500         MOVE 'MAX RETRIES EXCEEDED ON SELECT RECEIPT DATES'      20030000
202600                                  TO DP013-MESSAGE-TEXT (1)       20040000
202700         MOVE SQLCA               TO DP013-SQLCA                  20050000
202800         MOVE 'TRECITM '          TO DP013-DB2-TABLE-NAME (1)     20060000
202900         SET DP013-DB2-ABEND                                      20070000
203000             DP013-XCTL-DISPLAY-RESTART                           20080000
203100                                  TO TRUE                         20090000
203200         PERFORM DP013-0000-PROCESS-ABEND                         20100000
203300     END-IF.                                                      20110000
203400                                                                  20120000
203500/                                                                 20130000
203600*----------------------------------------------------------------*20140000
203700*    GET THE PURCHASE ORDER AGREEMENT INFORMATION                *20150000
203800*----------------------------------------------------------------*20160000
203900 4060-GET-PO-AGREEMENT-INFO.                                      20170000
204000                                                                  20180000
204100     PERFORM                                                      20190000
204200         WITH TEST AFTER                                          20200000
204300         VARYING PV-RETRY-COUNTER                                 20210000
204400         FROM 1 BY 1                                              20220000
204500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20230000
204600             OR (SQLCODE = +0)                                    20240000
204700             OR (SQLCODE = +100))                                 20250000
204800                                                                  20260000
204900         EXEC SQL                                                 20270000
205000              SELECT EDI_PROMO_TXT                                20280000
205100                    ,PAYT_TERM_ID                                 20290000
205200                    ,DISC_DOL_AMT                                 20300000
205300                    ,DISC_PCT                                     20310000
205400                    ,DISC_PAY_DAY_QTY                             20320000
205500                    ,LAST_UPD_TMST                                20330000
205600                    ,LAST_UPD_BY_UID                              20340000
205700                INTO :POAGMT-EDI-PROMO-TXT                        20350000
205800                    ,:POAGMT-PAYT-TERM-ID                         20360000
205900                    ,:POAGMT-DISC-DOL-AMT                         20370000
206000                    ,:POAGMT-DISC-PCT                             20380000
206100                    ,:POAGMT-DISC-PAY-DAY-QTY                     20390000
206200                    ,:POAGMT-LAST-UPD-TMST                        20400000
206300                    ,:POAGMT-LAST-UPD-BY-UID                      20410000
206400                FROM TPOAGMT                                      20420000
206500               WHERE PO_NBR         = :DK-PO-NBR                  20430000
206600                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            20440000
206700                 AND VER_STATUS_CDE = 'A'                         20450000
206800         END-EXEC                                                 20460000
206900                                                                  20470000
207000         EVALUATE TRUE                                            20480000
207100             WHEN SQLCODE = +0                                    20490000
207200             WHEN SQLCODE = +100                                  20500000
207300             WHEN SQLCODE = -904                                  20510000
207400             WHEN SQLCODE = -913                                  20520000
207500                  CONTINUE                                        20530000
207600                                                                  20540000
207700             WHEN SQLWARN0 NOT = SPACES                           20550000
207800             WHEN SQLCODE < +0                                    20560000
207900             WHEN SQLCODE > +0                                    20570000
208000                  MOVE '4060-GET-PO-AGREEMENT-INFO'               20580000
208100                                  TO DP013-PARAGRAPH              20590000
208200                  MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'   20600000
208300                                  TO DP013-MESSAGE-TEXT (1)       20610000
208400                  MOVE DK-PO-NBR  TO PV-PO-NBR                    20620000
208500                  MOVE PV-PO-TEXT TO DP013-MESSAGE-TEXT (2)       20630000
208600                  MOVE SQLCA      TO DP013-SQLCA                  20640000
208700                  MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)     20650000
208800                  SET DP013-DB2-ABEND                             20660000
208900                      DP013-XCTL-DISPLAY-RESTART                  20670000
209000                                  TO TRUE                         20680000
209100                  PERFORM DP013-0000-PROCESS-ABEND                20690000
209200         END-EVALUATE                                             20700000
209300     END-PERFORM.                                                 20710000
209400                                                                  20720000
209500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20730000
209600         MOVE '4060-GET-PO-AGREEMENT-INFO'                        20740000
209700                                  TO DP013-PARAGRAPH              20750000
209800         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE AGREEMENT' 20760000
209900                                  TO DP013-MESSAGE-TEXT (1)       20770000
210000         MOVE SQLCA               TO DP013-SQLCA                  20780000
210100         MOVE 'TPOAGMT '          TO DP013-DB2-TABLE-NAME (1)     20790000
210200         SET DP013-DB2-ABEND                                      20800000
210300             DP013-XCTL-DISPLAY-RESTART                           20810000
210400                                  TO TRUE                         20820000
210500         PERFORM DP013-0000-PROCESS-ABEND                         20830000
210600     END-IF.                                                      20840000
210700                                                                  20850000
210800/                                                                 20860000
210900*----------------------------------------------------------------*20870000
211000*    CHECK TO SEE WHAT TYPES OF SERVICES THIS PO HAS             *20880000
211100*----------------------------------------------------------------*20890000
211200 4070-CHECK-PO-SERVICE-INFO.                                      20900000
211300                                                                  20910000
211400     PERFORM                                                      20920000
211500         WITH TEST AFTER                                          20930000
211600         VARYING PV-RETRY-COUNTER                                 20940000
211700         FROM 1 BY 1                                              20950000
211800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20960000
211900             OR (SQLCODE = +0)                                    20970000
212000             OR (SQLCODE = +100))                                 20980000
212100                                                                  20990000
212200         EXEC SQL                                                 21000000
212300              SELECT COUNT(*)                                     21010000
212400                INTO :PV-DB2-COUNT                                21020000
212500                FROM TPOAGMT                                      21030000
212600               WHERE PO_NBR         = :DK-PO-NBR                  21040000
212700                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            21050000
212800                 AND VER_STATUS_CDE = 'A'                         21060000
212900                 AND TYP_CDE        = :DK-TYP-CDE                 21070000
213000         END-EXEC                                                 21080000
213100                                                                  21090000
213200         EVALUATE TRUE                                            21100000
213300             WHEN SQLCODE = +0                                    21110000
213400             WHEN SQLCODE = +100                                  21120000
213500             WHEN SQLCODE = -904                                  21130000
213600             WHEN SQLCODE = -913                                  21140000
213700                  CONTINUE                                        21150000
213800                                                                  21160000
213900             WHEN SQLWARN0 NOT = SPACES                           21170000
214000             WHEN SQLCODE < +0                                    21180000
214100             WHEN SQLCODE > +0                                    21190000
214200                  MOVE '4070-CHECK-PO-SERVICE-INFO'               21200000
214300                                  TO DP013-PARAGRAPH              21210000
214400                  MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'   21220000
214500                                  TO DP013-MESSAGE-TEXT (1)       21230000
214600                  MOVE SQLCA      TO DP013-SQLCA                  21240000
214700                  MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)     21250000
214800                  SET DP013-DB2-ABEND                             21260000
214900                      DP013-XCTL-DISPLAY-RESTART                  21270000
215000                                  TO TRUE                         21280000
215100                  PERFORM DP013-0000-PROCESS-ABEND                21290000
215200         END-EVALUATE                                             21300000
215300     END-PERFORM.                                                 21310000
215400                                                                  21320000
215500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21330000
215600         MOVE '4070-CHECK-PO-SERVICE-INFO'                        21340000
215700                                  TO DP013-PARAGRAPH              21350000
215800         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE AGREEMENT' 21360000
215900                                  TO DP013-MESSAGE-TEXT (1)       21370000
216000         MOVE SQLCA               TO DP013-SQLCA                  21380000
216100         MOVE 'TPOAGMT '          TO DP013-DB2-TABLE-NAME (1)     21390000
216200         SET DP013-DB2-ABEND                                      21400000
216300             DP013-XCTL-DISPLAY-RESTART                           21410000
216400                                  TO TRUE                         21420000
216500         PERFORM DP013-0000-PROCESS-ABEND                         21430000
216600     END-IF.                                                      21440000
216700                                                                  21450000
216800/                                                                 21460000
216900*----------------------------------------------------------------*21470000
217000*    OBTAIN THE LEADTIME DAYS QUANTITY                           *21480000
217100*    FROM THE TPOAGMT TABLE                                      *21490000
217200*----------------------------------------------------------------*21500000
217300 4075-GET-LEADTIME-DAYS-POAGMT.                                   21510000
217400                                                                  21520000
217500     PERFORM                                                      21530000
217600         WITH TEST AFTER                                          21540000
217700         VARYING PV-RETRY-COUNTER                                 21550000
217800         FROM 1 BY 1                                              21560000
217900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21570000
218000             OR (SQLCODE = +0)                                    21580000
218100             OR (SQLCODE = +100))                                 21590000
218200                                                                  21600000
218300         EXEC SQL                                                 21610000
218400              SELECT LEADTIME_DAYS_QTY                            21620000
218500                INTO :POAGMT-LEADTIME-DAYS-QTY                    21630000
218600                FROM TPOAGMT                                      21640000
218700               WHERE PO_NBR         = :DK-PO-NBR                  21650000
218800                 AND VER_STATUS_CDE = 'A'                         21660000
218900                 AND AGRMT_TYP_ID   = '4'                         21670000
219000                 AND TYP_CDE        = 1                           21680000
219100         END-EXEC                                                 21690000
219200                                                                  21700000
219300         EVALUATE TRUE                                            21710000
219400             WHEN SQLCODE = +0                                    21720000
219500                  MOVE POAGMT-LEADTIME-DAYS-QTY                   21730000
219600                                  TO ASC-LEADTIME-DAYS-QTY        21740000
219700             WHEN SQLCODE = +100                                  21750000
219800             WHEN SQLCODE = -904                                  21760000
219900             WHEN SQLCODE = -913                                  21770000
220000                  CONTINUE                                        21780000
220100                                                                  21790000
220200             WHEN SQLWARN0 NOT = SPACES                           21800000
220300             WHEN SQLCODE < +0                                    21810000
220400             WHEN SQLCODE > +0                                    21820000
220500                  MOVE '4075-GET-LEADTIME-DAYS-POAGMT'            21830000
220600                                  TO DP013-PARAGRAPH              21840000
220700                  MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'   21850000
220800                                  TO DP013-MESSAGE-TEXT (1)       21860000
220900                  MOVE SQLCA      TO DP013-SQLCA                  21870000
221000                  MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)     21880000
221100                  SET DP013-DB2-ABEND                             21890000
221200                      DP013-XCTL-DISPLAY-RESTART                  21900000
221300                                  TO TRUE                         21910000
221400                  PERFORM DP013-0000-PROCESS-ABEND                21920000
221500         END-EVALUATE                                             21930000
221600     END-PERFORM.                                                 21940000
221700                                                                  21950000
221800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21960000
221900         MOVE '4075-GET-LEADTIME-DAYS-POAGMT'                     21970000
222000                                  TO DP013-PARAGRAPH              21980000
222100         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE AGREEMENT' 21990000
222200                                  TO DP013-MESSAGE-TEXT (1)       22000000
222300         MOVE SQLCA               TO DP013-SQLCA                  22010000
222400         MOVE 'TPOAGMT '          TO DP013-DB2-TABLE-NAME (1)     22020000
222500         SET DP013-DB2-ABEND                                      22030000
222600             DP013-XCTL-DISPLAY-RESTART                           22040000
222700                                  TO TRUE                         22050000
222800         PERFORM DP013-0000-PROCESS-ABEND                         22060000
222900     END-IF.                                                      22070000
223000                                                                  22080000
223100                                                                  22090000
223200/                                                                 22100000
223300*----------------------------------------------------------------*22110000
223400*    CHECK AND SEE IF THERE ARE SPECIAL INSTRUCTIONS FOR THIS PO *22120000
223500*----------------------------------------------------------------*22130000
223600 4080-CHECK-SPECIAL-INSTR.                                        22140000
223700                                                                  22150000
223800     PERFORM                                                      22160000
223900         WITH TEST AFTER                                          22170000
224000         VARYING PV-RETRY-COUNTER                                 22180000
224100         FROM 1 BY 1                                              22190000
224200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22200000
224300             OR (SQLCODE = +0)                                    22210000
224400             OR (SQLCODE = +100))                                 22220000
224500                                                                  22230000
224600         EXEC SQL                                                 22240000
224700              SELECT COUNT(*)                                     22250000
224800                INTO :PV-DB2-COUNT                                22260000
224900                FROM TPOINST                                      22270000
225000               WHERE PO_NBR  = :DK-PO-NBR                         22280000
225100         END-EXEC                                                 22290000
225200                                                                  22300000
225300         EVALUATE TRUE                                            22310000
225400             WHEN SQLCODE = +0                                    22320000
225500             WHEN SQLCODE = +100                                  22330000
225600             WHEN SQLCODE = -904                                  22340000
225700             WHEN SQLCODE = -913                                  22350000
225800                  CONTINUE                                        22360000
225900                                                                  22370000
226000             WHEN SQLWARN0 NOT = SPACES                           22380000
226100             WHEN SQLCODE < +0                                    22390000
226200             WHEN SQLCODE > +0                                    22400000
226300                  MOVE '4080-CHECK-SPECIAL-INSTR'                 22410000
226400                                  TO DP013-PARAGRAPH              22420000
226500                  MOVE 'UNSUCCESSFUL SELECT PURCHASE INSTRUCTIONS'22430000
226600                                  TO DP013-MESSAGE-TEXT (1)       22440000
226700                  MOVE SQLCA      TO DP013-SQLCA                  22450000
226800                  MOVE 'TPOINST ' TO DP013-DB2-TABLE-NAME (1)     22460000
226900                  SET DP013-DB2-ABEND                             22470000
227000                      DP013-XCTL-DISPLAY-RESTART                  22480000
227100                                  TO TRUE                         22490000
227200                  PERFORM DP013-0000-PROCESS-ABEND                22500000
227300         END-EVALUATE                                             22510000
227400     END-PERFORM.                                                 22520000
227500                                                                  22530000
227600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22540000
227700         MOVE '4080-CHECK-SPECIAL-INSTR'                          22550000
227800                                  TO DP013-PARAGRAPH              22560000
227900         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE INSTR'     22570000
228000                                  TO DP013-MESSAGE-TEXT (1)       22580000
228100         MOVE SQLCA               TO DP013-SQLCA                  22590000
228200         MOVE 'TPOINST '          TO DP013-DB2-TABLE-NAME (1)     22600000
228300         SET DP013-DB2-ABEND                                      22610000
228400             DP013-XCTL-DISPLAY-RESTART                           22620000
228500                                  TO TRUE                         22630000
228600         PERFORM DP013-0000-PROCESS-ABEND                         22640000
228700     END-IF.                                                      22650000
228800                                                                  22660000
228900/                                                                 22670000
229000*----------------------------------------------------------------*22680000
229100*    CHECK AND SEE IF THIS PO IS 'IN TROUBLE'                    *22690000
229200*----------------------------------------------------------------*22700000
229300 4085-CHECK-IF-IN-TROUBLE.                                        22710000
229400                                                                  22720000
229500     PERFORM                                                      22730000
229600         WITH TEST AFTER                                          22740000
229700         VARYING PV-RETRY-COUNTER                                 22750000
229800         FROM 1 BY 1                                              22760000
229900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22770000
230000             OR (SQLCODE = +0)                                    22780000
230100             OR (SQLCODE = +100))                                 22790000
230200                                                                  22800000
230300         EXEC SQL                                                 22810000
230308              SELECT COUNT(*)                                     22820000
230309                INTO :PV-DB2-COUNT                                22830000
230310                FROM TTRBNTF A                                    22840000
230311                    ,TTRBRSN B                                    22850000
230312               WHERE PO_NBR          =  :DK-PO-NBR                22860000
230313                 AND A.RESOLVED_IND  IN ('N','I')                 22870000
230320                 AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE            22880000
230500                 AND B.TRBL_INITR_CDE <> 'T'                      22890000
230900         END-EXEC                                                 22900000
231000                                                                  22910000
231100         EVALUATE TRUE                                            22920000
231200             WHEN SQLCODE = +0                                    22930000
231300             WHEN SQLCODE = +100                                  22940000
231400             WHEN SQLCODE = -904                                  22950000
231500             WHEN SQLCODE = -913                                  22960000
231600                  CONTINUE                                        22970000
231700                                                                  22980000
231800             WHEN SQLWARN0 NOT = SPACES                           22990000
231900             WHEN SQLCODE < +0                                    23000000
232000             WHEN SQLCODE > +0                                    23010000
232100                  MOVE '4085-CHECK-IF-IN-TROUBLE'                 23020000
232200                                  TO DP013-PARAGRAPH              23030000
232300                  MOVE 'UNSUCCESSFUL SELECT TROUBLE COUNT'        23040000
232400                                  TO DP013-MESSAGE-TEXT (1)       23050000
232500                  MOVE SQLCA      TO DP013-SQLCA                  23060000
232600                  MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)     23070000
232700                  SET DP013-DB2-ABEND                             23080000
232800                      DP013-XCTL-DISPLAY-RESTART                  23090000
232900                                  TO TRUE                         23100000
233000                  PERFORM DP013-0000-PROCESS-ABEND                23110000
233100         END-EVALUATE                                             23120000
233200     END-PERFORM.                                                 23130000
233300                                                                  23140000
233400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23150000
233500         MOVE '4085-CHECK-IF-IN-TROUBLE'                          23160000
233600                                  TO DP013-PARAGRAPH              23170000
233700         MOVE 'MAX RETRIES EXCEEDED ON COUNT'                     23180000
233800                                  TO DP013-MESSAGE-TEXT (1)       23190000
233900         MOVE SQLCA               TO DP013-SQLCA                  23200000
234000         MOVE 'TTRBNTF '          TO DP013-DB2-TABLE-NAME (1)     23210000
234100         SET DP013-DB2-ABEND                                      23220000
234200             DP013-XCTL-DISPLAY-RESTART                           23230000
234300                                  TO TRUE                         23240000
234400         PERFORM DP013-0000-PROCESS-ABEND                         23250000
234500     END-IF.                                                      23260000
234600                                                                  23270000
234700/                                                                 23280000
234800*----------------------------------------------------------------*23290000
234900*    DECODE USERIDS TO DISPLAY NAMES                             *23300000
235000*----------------------------------------------------------------*23310000
235100 4090-GET-TWORKER.                                                23320000
235200                                                                  23330000
235300     PERFORM 4092-OPEN-WORKER-CSR.                                23340000
235400                                                                  23350000
235500     EXEC SQL                                                     23360000
235600          FETCH WORKER-CSR                                        23370000
235700          INTO  :WORKER-LAST-NAME,                                23380000
235800                :WORKER-FIR-NAME                                  23390000
235900     END-EXEC                                                     23400000
236000                                                                  23410000
236100     EVALUATE TRUE                                                23420000
236200         WHEN SQLCODE = +0                                        23430000
236300              CONTINUE                                            23440000
236400                                                                  23450000
236500         WHEN SQLCODE = +100                                      23460000
236600              MOVE SPACES        TO WORKER-LAST-NAME              23470000
236700                                    WORKER-FIR-NAME               23480000
236800         WHEN SQLCODE = -904                                      23490000
236900         WHEN SQLCODE = -913                                      23500000
237000          CONTINUE                                                23510000
237100                                                                  23520000
237200         WHEN SQLWARN0 NOT = SPACES                               23530000
237300         WHEN SQLCODE < +0                                        23540000
237400         WHEN SQLCODE > +0                                        23550000
237500              MOVE '4090-GET-TWORKER'                             23560000
237600                              TO DP013-PARAGRAPH                  23570000
237700              MOVE 'UNSUCCESSFUL SELECT TWORKER'                  23580000
237800                              TO DP013-MESSAGE-TEXT (1)           23590000
237900              MOVE SQLCA          TO DP013-SQLCA                  23600000
238000              MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)         23610000
238100              SET DP013-DB2-ABEND                                 23620000
238200                  DP013-XCTL-DISPLAY-RESTART                      23630000
238300                              TO TRUE                             23640000
238400              PERFORM DP013-0000-PROCESS-ABEND                    23650000
238500     END-EVALUATE.                                                23660000
238600                                                                  23670000
238700     PERFORM 4094-CLOSE-WORKER-CSR.                               23680000
238800                                                                  23690000
238900 4092-GET-DTS-INFO.                                               23700000
239000                                                                  23710000
239100     PERFORM                                                      23720000
239200         WITH TEST AFTER                                          23730000
239300         VARYING PV-RETRY-COUNTER                                 23740000
239400         FROM 1 BY 1                                              23750000
239500         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  23760000
239600             OR SQLCODE = ZERO                                    23770000
239700             OR SQLCODE = +100                                    23780000
239800             OR SQLCODE = -811                                    23790000
239900                                                                  23800000
240000         EXEC SQL                                                 23810000
240100              SELECT DISTINCT STR_NBR                             23820000
240200                INTO :MESTDS-STR-NBR                              23830000
240300                FROM TMESTDS                                      23840000
240400               WHERE PO_NBR = :DK-PO-NBR                          23850000
240500         END-EXEC                                                 23860000
240600                                                                  23870000
240700         EVALUATE TRUE                                            23880000
240800             WHEN SQLCODE = ZERO                                  23890000
240900                  IF ASC-DIR-STR-IND = 'Y'                        23900000
241000                      MOVE MESTDS-STR-NBR TO PV-DTS-STR-N         23910000
241100                      MOVE PV-DTS-STR     TO ASC-DTS-STR          23920000
241200                  ELSE                                            23930000
241300                      MOVE SPACES TO ASC-DTS-STR                  23940000
241400                  END-IF                                          23950000
241500                                                                  23960000
241600             WHEN SQLCODE = -811                                  23970000
241700                  IF ASC-DIR-STR-IND = 'Y'                        23980000
241800                      MOVE 'MULT' TO ASC-DTS-STR                  23990000
241900                  ELSE                                            24000000
242000                      MOVE SPACES TO ASC-DTS-STR                  24010000
242100                  END-IF                                          24020000
242200                                                                  24030000
242300             WHEN SQLCODE = +100                                  24040000
242400                  MOVE SPACES TO ASC-DTS-STR                      24050000
242500                                                                  24060000
242600             WHEN SQLCODE = -904                                  24070000
242700             WHEN SQLCODE = -913                                  24080000
242800                  CONTINUE                                        24090000
242900                                                                  24100000
243000             WHEN SQLWARN0 NOT = SPACES                           24110000
243100             WHEN SQLCODE < ZERO                                  24120000
243200             WHEN SQLCODE > ZERO                                  24130000
243300                  MOVE '4092-GET-DTS-INFO'                        24140000
243400                                  TO DP013-PARAGRAPH              24150000
243500                  MOVE 'UNSUCCESSFUL SELECT DTS STORE'            24160000
243600                                  TO DP013-MESSAGE-TEXT (1)       24170000
243700                  MOVE SQLCA      TO DP013-SQLCA                  24180000
243800                  MOVE 'TMESTDS ' TO DP013-DB2-TABLE-NAME (1)     24190000
243900                  SET DP013-DB2-ABEND                             24200000
244000                      DP013-XCTL-DISPLAY-RESTART                  24210000
244100                                  TO TRUE                         24220000
244200                  PERFORM DP013-0000-PROCESS-ABEND                24230000
244300         END-EVALUATE                                             24240000
244400     END-PERFORM.                                                 24250000
244500                                                                  24260000
244600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24270000
244700         MOVE '4092-GET-DTS-INFO'                                 24280000
244800                                  TO DP013-PARAGRAPH              24290000
244900         MOVE 'MAX RETRIES EXCEEDED ON SELECT DTS STORE'          24300000
245000                                  TO DP013-MESSAGE-TEXT (1)       24310000
245100         MOVE SQLCA               TO DP013-SQLCA                  24320000
245200         MOVE 'TMESTDS '          TO DP013-DB2-TABLE-NAME (1)     24330000
245300         SET DP013-DB2-ABEND                                      24340000
245400             DP013-XCTL-DISPLAY-RESTART                           24350000
245500                                  TO TRUE                         24360000
245600         PERFORM DP013-0000-PROCESS-ABEND                         24370000
245700     END-IF.                                                      24380000
245800                                                                  24390000
245900 4092-OPEN-WORKER-CSR.                                            24400000
246000                                                                  24410000
246100     PERFORM                                                      24420000
246200         WITH TEST AFTER                                          24430000
246300         VARYING PV-RETRY-COUNTER                                 24440000
246400         FROM 1 BY 1                                              24450000
246500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24460000
246600            OR (SQLCODE = +0))                                    24470000
246700                                                                  24480000
246800         EXEC SQL                                                 24490000
246900             OPEN WORKER-CSR                                      24500000
247000         END-EXEC                                                 24510000
247100                                                                  24520000
247200         EVALUATE TRUE                                            24530000
247300             WHEN SQLCODE = +0                                    24540000
247400                  CONTINUE                                        24550000
247500             WHEN SQLCODE = -904                                  24560000
247600             WHEN SQLCODE = -913                                  24570000
247700                  CONTINUE                                        24580000
247800             WHEN SQLWARN0 NOT = SPACE                            24590000
247900             WHEN SQLCODE  NOT = +0                               24600000
248000                  MOVE '4092-OPEN-WORKER-CSR'                     24610000
248100                                   TO DP013-PARAGRAPH             24620000
248200                  MOVE 'OPEN WORKER-CSR CURSOR'                   24630000
248300                                   TO DP013-MESSAGE-TEXT (1)      24640000
248400                  MOVE SQLCA       TO DP013-SQLCA                 24650000
248500                  MOVE 'TWORKER'   TO DP013-DB2-TABLE-NAME (1)    24660000
248600                  SET DP013-DB2-ABEND                             24670000
248700                                   TO TRUE                        24680000
248800                  PERFORM DP013-0000-PROCESS-ABEND                24690000
248900         END-EVALUATE                                             24700000
249000     END-PERFORM.                                                 24710000
249100                                                                  24720000
249200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24730000
249300         MOVE '4092-OPEN-WORKER-CURSOR' TO DP013-PARAGRAPH        24740000
249400         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              24750000
249500                                   TO DP013-MESSAGE-TEXT (1)      24760000
249600         MOVE SQLCA                TO DP013-SQLCA                 24770000
249700         SET DP013-DB2-ABEND       TO TRUE                        24780000
249800         PERFORM DP013-0000-PROCESS-ABEND                         24790000
249900     END-IF.                                                      24800000
250000                                                                  24810000
250100 4094-CLOSE-WORKER-CSR.                                           24820000
250200                                                                  24830000
250300     EXEC SQL                                                     24840000
250400         CLOSE WORKER-CSR                                         24850000
250500     END-EXEC.                                                    24860000
250600                                                                  24870000
250700     EVALUATE TRUE                                                24880000
250800         WHEN SQLCODE = +0                                        24890000
250900              CONTINUE                                            24900000
251000         WHEN SQLWARN0 NOT = SPACE                                24910000
251100         WHEN SQLCODE  NOT = +0                                   24920000
251200              MOVE '4094-CLOSE-WORKER-CURSOR'                     24930000
251300                                   TO DP013-PARAGRAPH             24940000
251400              MOVE 'CLOSE WORKER-CSR CURSOR'                      24950000
251500                                   TO DP013-MESSAGE-TEXT (1)      24960000
251600              MOVE SQLCA           TO DP013-SQLCA                 24970000
251700              MOVE 'TWORKER'       TO DP013-DB2-TABLE-NAME (1)    24980000
251800              SET DP013-DB2-ABEND  TO TRUE                        24990000
251900              PERFORM DP013-0000-PROCESS-ABEND                    25000000
252000     END-EVALUATE.                                                25010000
252100                                                                  25020000
252200/                                                                 25030000
460300 4095-GET-WEEK-NBR.                                               25040000
           MOVE PLNSHP-DONT-SHIP-BEF-DTE   TO POWS055-INPUT-DATE.       25041000
           PERFORM POPD055-CALC-WEEKLY-OTB.                             25050000
           IF POWS055-NO-ERROR                                          25060000
                 MOVE POWS055-OTB-FSCL-WEEK-NBR                         25080000
                                          TO ASC-WEEK                   25090000
           ELSE                                                         25140000
               MOVE '4095-GET-WEEK-NBR'                                 25158000
                               TO DP013-PARAGRAPH                       25159000
               MOVE '** BAD PERFORM DATE ROUTINE USING '                25159100
                               TO DP013-MESSAGE-TEXT (1)                25159300
               MOVE PLNSHP-DONT-SHIP-BEF-DTE                            25159400
                               TO DP013-MESSAGE-TEXT (2)                25159600
               MOVE SQLCA      TO DP013-SQLCA                           25159700
               SET DP013-DB2-ABEND                                      25159800
                   DP013-XCTL-DISPLAY-RESTART                           25159900
                               TO TRUE                                  25160000
               PERFORM DP013-0000-PROCESS-ABEND                         25160100
461500     END-IF.                                                      25161000
461600                                                                  25170000
461700                                                                  25180000
252200/                                                                 25550000
252300*----------------------------------------------------------------*25560000
252400*  RETRIEVE THE PRIMARY VENDOR NAME                               25570000
252500*----------------------------------------------------------------*25580000
252600                                                                  25590000
252700 4120-GET-PRIMARY-ENT-NAME-DESC.                                  25600000
252800                                                                  25610000
252900     PERFORM                                                      25620000
253000         WITH TEST AFTER                                          25630000
253100         VARYING PV-RETRY-COUNTER                                 25640000
253200         FROM 1 BY 1                                              25650000
253300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25660000
253400             OR (SQLCODE = +0))                                   25670000
253500                                                                  25680000
253600         EXEC SQL                                                 25690000
253700              SELECT ENT_NAME_DESC                                25700000
253800                INTO :ENTNME-ENT-NAME-DESC                        25710000
253900                FROM TENTNME                                      25720000
254000               WHERE ENT_ID   = :DK-ENT-ID                        25730000
254100                 AND TYPE_CDE = '01'                              25740000
254200         END-EXEC                                                 25750000
254300                                                                  25760000
254400         EVALUATE TRUE                                            25770000
254500             WHEN SQLCODE = +0                                    25780000
254600                  MOVE ENTNME-ENT-NAME-DESC                       25790000
254700                                  TO ASC-KEY-ENT-NAME-DESC        25800000
254800             WHEN SQLCODE = -904                                  25810000
254900             WHEN SQLCODE = -913                                  25820000
255000                  CONTINUE                                        25830000
255100                                                                  25840000
255200             WHEN SQLWARN0 NOT = SPACES                           25850000
255300             WHEN SQLCODE < +0                                    25860000
255400             WHEN SQLCODE > +0                                    25870000
255500                  MOVE '4120-GET-PRIMARY-ENT-NAME-DESC'           25880000
255600                                  TO DP013-PARAGRAPH              25890000
255700                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      25900000
255800                                  TO DP013-MESSAGE-TEXT (1)       25910000
255900                  MOVE SQLCA      TO DP013-SQLCA                  25920000
256000                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     25930000
256100                  SET DP013-DB2-ABEND                             25940000
256200                      DP013-XCTL-DISPLAY-RESTART                  25950000
256300                                  TO TRUE                         25960000
256400                  PERFORM DP013-0000-PROCESS-ABEND                25970000
256500         END-EVALUATE                                             25980000
256600     END-PERFORM.                                                 25990000
256700                                                                  26000000
256800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26010000
256900         MOVE '4120-GET-PRIMARY-NAME'                             26020000
257000                                  TO DP013-PARAGRAPH              26030000
257100         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    26040000
257200                                  TO DP013-MESSAGE-TEXT (1)       26050000
257300         MOVE SQLCA               TO DP013-SQLCA                  26060000
257400         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     26070000
257500         SET DP013-DB2-ABEND                                      26080000
257600             DP013-XCTL-DISPLAY-RESTART                           26090000
257700                                  TO TRUE                         26100000
257800         PERFORM DP013-0000-PROCESS-ABEND                         26110000
257900     END-IF.                                                      26120000
258000                                                                  26130000
258100/                                                                 26140000
258200*----------------------------------------------------------------*26150000
258300*    GET PO ADDRESS INFORMATION                                  *26160000
258400*----------------------------------------------------------------*26170000
258500 4130-GET-PO-ADDRESS.                                             26180000
258600                                                                  26190000
258700     PERFORM                                                      26200000
258800         WITH TEST AFTER                                          26210000
258900         VARYING PV-RETRY-COUNTER                                 26220000
259000         FROM 1 BY 1                                              26230000
259100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26240000
259200             OR (SQLCODE = +0)                                    26250000
259300             OR (SQLCODE = +100))                                 26260000
259400                                                                  26270000
259500         EXEC SQL                                                 26280000
259600              SELECT ADDRESS_LINE1_DESC                           26290000
259700                    ,ADDRESS_LINE2_DESC                           26300000
259800                    ,ATTENTION_TO_TXT                             26310000
259900                    ,CITY_NAME                                    26320000
260010                    ,ST_PROV_CDE                                  26330000
260100                    ,ZIP_CDE                                      26340000
260110                    ,CNTRY_CDE                                    26350000
260400                    ,ROOM_NBR                                     26360000
260500               INTO :BUSLOC-ADDRESS-LINE1-DESC                    26370000
260600                   ,:BUSLOC-ADDRESS-LINE2-DESC                    26380000
260700                   ,:BUSLOC-ATTENTION-TO-TXT                      26390000
260800                   ,:BUSLOC-CITY-NAME                             26400000
260910                   ,:BUSLOC-ST-PROV-CDE                           26410000
261000                   ,:BUSLOC-ZIP-CDE                               26420000
261010                   ,:BUSLOC-CNTRY-CDE                             26430000
261300                   ,:BUSLOC-ROOM-NBR                              26440000
261400                FROM TBUSLOC                                      26450000
261500               WHERE ENT_ID      = :DK-ENT-ID                     26460000
261600                 AND FUNCTION_ID = 2                              26470000
261700                 AND SEQ_NBR     = :DK-ADR-SEQ-NBR                26480000
261800         END-EXEC                                                 26490000
261900                                                                  26500000
262000         EVALUATE TRUE                                            26510000
262100             WHEN SQLCODE = +0                                    26520000
262200                  MOVE BUSLOC-ADDRESS-LINE1-DESC                  26530000
262300                                 TO PV-ADDR1                      26540000
262400                  MOVE BUSLOC-ADDRESS-LINE2-DESC                  26550000
262500                                 TO PV-ADDR2                      26560000
262600                  MOVE BUSLOC-ATTENTION-TO-TXT                    26570000
262700                                 TO PV-ATTN                       26580000
262800                  MOVE BUSLOC-CITY-NAME                           26590000
262900                                 TO PV-CITY                       26600000
263010                  MOVE BUSLOC-ST-PROV-CDE                         26610000
263100                                 TO PV-STATE                      26620000
263200                  MOVE BUSLOC-ZIP-CDE                             26630000
263300                                 TO PV-ZIP                        26640000
263800                  MOVE BUSLOC-ROOM-NBR                            26650000
263900                                 TO PV-ROOM                       26660000
264000             WHEN SQLCODE = +100                                  26670000
264100             WHEN SQLCODE = -904                                  26680000
264200             WHEN SQLCODE = -913                                  26690000
264300                  CONTINUE                                        26700000
264400                                                                  26710000
264500             WHEN SQLWARN0 NOT = SPACES                           26720000
264600             WHEN SQLCODE < +0                                    26730000
264700             WHEN SQLCODE > +0                                    26740000
264800                  MOVE '4130-GET-PO-ADDRESS'                      26750000
264900                                  TO DP013-PARAGRAPH              26760000
265000                  MOVE 'UNSUCCESSFUL GET PO ADDRESS'              26770000
265100                                  TO DP013-MESSAGE-TEXT (1)       26780000
265200                  MOVE SQLCA      TO DP013-SQLCA                  26790000
265300                  MOVE 'TBUSLOC ' TO DP013-DB2-TABLE-NAME (1)     26800000
265400                  SET DP013-DB2-ABEND                             26810000
265500                      DP013-XCTL-DISPLAY-RESTART                  26820000
265600                                  TO TRUE                         26830000
265700                  PERFORM DP013-0000-PROCESS-ABEND                26840000
265800         END-EVALUATE                                             26850000
265900     END-PERFORM.                                                 26860000
266000                                                                  26870000
266100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26880000
266200         MOVE '4130-GET-PO-ADDRESS'                               26890000
266300                                  TO DP013-PARAGRAPH              26900000
266400         MOVE 'MAX RETRIES EXCEEDED ON SELECT BUSINESS LOCATION'  26910000
266500                                  TO DP013-MESSAGE-TEXT (1)       26920000
266600         MOVE SQLCA               TO DP013-SQLCA                  26930000
266700         MOVE 'TBUSLOC '          TO DP013-DB2-TABLE-NAME (1)     26940000
266800         SET DP013-DB2-ABEND                                      26950000
266900             DP013-XCTL-DISPLAY-RESTART                           26960000
267000                                  TO TRUE                         26970000
267100         PERFORM DP013-0000-PROCESS-ABEND                         26980000
267200     END-IF.                                                      26990000
267300                                                                  27000000
267301*----------------------------------------------------------------*27010000
267302*    RETRIEVE COUNTRY AND STATE NAME                             *27020000
267303*----------------------------------------------------------------*27030000
267304 4135-RETRIEVE-ST-PRV-CNTY-NAME.                                  27040000
267305                                                                  27050000
267306     MOVE SPACES                 TO PV-STATE-PROV                 27060000
267307                                    PV-COUNTRY.                   27070000
267308     MOVE BUSLOC-ST-PROV-CDE     TO DP410-STATE-CODE.             27080000
267309     MOVE BUSLOC-CNTRY-CDE       TO DP410-COUNTRY-CODE.           27090000
267310                                                                  27100000
267311     CALL PC-DPKUT410 USING DFHEIBLK                              27110000
267312                            PV-DPKUT410-COMMAREA                  27120000
267313                            DP410-ST-PROV-CNTRY-ROUTINE.          27130000
267314     EVALUATE TRUE                                                27140000
267315                                                                  27150000
267316         WHEN  DP410-DB2-ERROR                                    27160000
267317             MOVE '4135-RETRIEVE-ST-PRV-CNTY-NAME'                27170000
267318                                      TO DP013-PARAGRAPH          27180000
267321             MOVE 'PS_COUNTRY'        TO DP013-DB2-TABLE-NAME (1) 27210000
267322             MOVE 'PS_STATE'          TO DP013-DB2-TABLE-NAME (2) 27220000
267323             SET DP013-DB2-ABEND   TO TRUE                        27230000
267324             SET DP013-NO-ROLLBACK TO TRUE                        27240000
267325             MOVE DP410-SQLCODE    TO DP013-SQLCA                 27250000
267326             PERFORM DP013-0000-PROCESS-ABEND                     27260000
267327                                                                  27270000
267328         WHEN  DP410-DEADLOCK-BYPASS-ROUTINE                      27280000
267329             MOVE DP410-STATE-CODE TO PV-STATE-PROV               27290000
267330             MOVE DP410-COUNTRY-CODE TO PV-COUNTRY                27300000
267331                                                                  27310000
267332         WHEN  OTHER                                              27320000
267333             MOVE DP410-STATE-NAME TO PV-STATE-PROV               27330000
267334             MOVE DP410-COUNTRY-NAME TO PV-COUNTRY                27340000
267335     END-EVALUATE.                                                27350000
267400/                                                                 27360000
267500*----------------------------------------------------------------*27370000
267600*    FORMAT PO ADDRESS INFORMATION AS BEST AS WE CAN             *27380000
267700*----------------------------------------------------------------*27390000
267800 4140-FORMAT-PO-ADDRESS.                                          27400000
267900                                                                  27410000
268000     INITIALIZE ASC-PO-ADDR1                                      27420000
268100                ASC-PO-ADDR2                                      27430000
268200                ASC-PO-ADDR3.                                     27440000
268300                                                                  27450000
268400     MOVE PV-ADDR1               TO ASC-PO-ADDR1.                 27460000
268500                                                                  27470000
268600     IF  PV-ADDR2 > SPACES                                        27480000
268700         MOVE PV-ADDR2           TO ASC-PO-ADDR2                  27490000
268800         STRING PV-CITY      DELIMITED BY '  '                    27500000
268900                    '  '     DELIMITED BY SIZE                    27510000
269210                PV-STATE-PROV DELIMITED BY '  '                   27520000
269300                    '  '     DELIMITED BY SIZE                    27530000
269400                PV-ZIP       DELIMITED BY '  '                    27540000
269500                    '  '     DELIMITED BY SIZE                    27550000
269600                PV-COUNTRY   DELIMITED BY '  '                    27560000
269700                               INTO ASC-PO-ADDR3                  27570000
269800     ELSE                                                         27580000
269900         STRING PV-CITY      DELIMITED BY '  '                    27590000
270000                    '  '     DELIMITED BY SIZE                    27600000
270310                PV-STATE-PROV  DELIMITED BY '  '                  27610000
270400                    '  '     DELIMITED BY SIZE                    27620000
270500                PV-ZIP       DELIMITED BY '  '                    27630000
270600                    '  '     DELIMITED BY SIZE                    27640000
270700                PV-COUNTRY   DELIMITED BY '  '                    27650000
270800                               INTO ASC-PO-ADDR2                  27660000
270900         STRING PV-ATTN      DELIMITED BY '  '                    27670000
271000                    '  '     DELIMITED BY SIZE                    27680000
271100                PV-ROOM      DELIMITED BY '  '                    27690000
271200                               INTO ASC-PO-ADDR3                  27700000
271300     END-IF.                                                      27710000
271400                                                                  27720000
271500/                                                                 27730000
279100 4180-MOVE-LAST-UPDATED.                                          27740000
279200                                                                  27750000
279300     IF PURCHS-LAST-UPD-TMST > POAGMT-LAST-UPD-TMST AND           27760000
279400        PURCHS-LAST-UPD-TMST > PLNSHP-LAST-UPD-TMST               27770000
279500           MOVE PURCHS-LAST-UPD-TMST   TO PV-DB2-DATE-HOST        27780000
279600           MOVE PURCHS-LAST-UPD-BY-UID TO WORKER-UID-NBR          27790000
279700     ELSE                                                         27800000
279800        IF POAGMT-LAST-UPD-TMST > PLNSHP-LAST-UPD-TMST AND        27810000
279900           POAGMT-LAST-UPD-TMST > PURCHS-LAST-UPD-TMST            27820000
280000              MOVE POAGMT-LAST-UPD-TMST   TO PV-DB2-DATE-HOST     27830000
280100              MOVE POAGMT-LAST-UPD-BY-UID TO WORKER-UID-NBR       27840000
280200        ELSE                                                      27850000
280300           IF PLNSHP-LAST-UPD-TMST > POAGMT-LAST-UPD-TMST AND     27860000
280400              PLNSHP-LAST-UPD-TMST > PURCHS-LAST-UPD-TMST         27870000
280500                 MOVE PLNSHP-LAST-UPD-TMST   TO PV-DB2-DATE-HOST  27880000
280600                 MOVE PLNSHP-LAST-UPD-BY-UID TO WORKER-UID-NBR.   27890000
280700                                                                  27900000
280800     PERFORM 4090-GET-TWORKER.                                    27910000
280900                                                                  27920000
281000     IF  SQLCODE = +0                                             27930000
281100         MOVE 20                 TO DP024-FLNAME-LENGTH           27940000
281200         MOVE WORKER-LAST-NAME   TO DP024-LNAME                   27950000
281300         MOVE WORKER-FIR-NAME    TO DP024-FNAME                   27960000
281400         PERFORM DP024-0000-FORMAT-NAME                           27970000
281500         MOVE DP024-FLNAME       TO ASC-LAST-UPD-BY-UID           27980000
281600     ELSE                                                         27990000
281700         MOVE SPACES             TO ASC-LAST-UPD-BY-UID           28000000
281800     END-IF.                                                      28010000
281900                                                                  28020000
282000     IF PV-DB2-DATE-HOST = '0001-01-01'                           28030000
282100         MOVE SPACES                    TO ASC-LAST-UPD-TMST      28040000
282200     ELSE                                                         28050000
282300         MOVE PV-DB2-DATE-HOST TO PV-DB2-DATE                     28060000
282400         MOVE PV-DB2-DATE-MM            TO PV-DISPLAY-DATE-MM     28070000
282500         MOVE PV-DB2-DATE-DD            TO PV-DISPLAY-DATE-DD     28080000
282600         MOVE PV-DB2-DATE-YY            TO PV-DISPLAY-DATE-YY     28090000
282700         MOVE PV-DISPLAY-DATE           TO ASC-LAST-UPD-TMST      28100000
282800     END-IF.                                                      28110000
282900                                                                  28120000
283000/                                                                 28130000
283100*----------------------------------------------------------------*28140000
283200*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *28150000
283300*----------------------------------------------------------------*28160000
283400 4400-MOVE-COMMAREA-TO-SCREEN.                                    28170000
283500                                                                  28180000
283600     MOVE ASC-SPEC-INSTR         TO ASPINSTO.                     28190000
283700     MOVE ASC-IN-TROUBLE         TO AINTRBLO.                     28200000
283800     MOVE ASC-KEY-PO-NBR         TO APONUMO.                      28210000
283900     MOVE ASC-KEY-DEPT-NBR       TO ADEPTO.                       28220000
284000     MOVE ASC-PO-TYPE            TO APTYPEO.                      28230000
284100     MOVE ASC-PO-STATUS-DESC     TO ASTATDEO.                     28240000
284200     MOVE ASC-ORD-DTE            TO AORDTEO.                      28250000
284300     MOVE ASC-RLSE-DTE           TO ARELDTO.                      28260000
284400     MOVE ASC-KEY-ENT-NAME-DESC  TO AVENDNMO.                     28270000
284500     MOVE ASC-CRE-BY-UID         TO ACREBYO.                      28280000
284600     MOVE ASC-PO-ADDR1           TO AADD1O.                       28290000
284700     MOVE ASC-APP-BY-UID         TO AAPRBYO.                      28300000
284800     MOVE ASC-PO-ADDR2           TO AADD2O.                       28310000
284900     MOVE ASC-LAST-UPD-TMST      TO ACHGDTEO.                     28320000
285000     MOVE ASC-PO-ADDR3           TO AADD3O.                       28330000
285100     MOVE ASC-LAST-UPD-BY-UID    TO ACHGBYO.                      28340000
285200     MOVE ASC-TOT-VAL-COST-AMT   TO ATOTCSTO.                     28350000
285300     MOVE ASC-TOT-VAL-RTL-AMT    TO ATOTRETO.                     28360000
285400     MOVE ASC-MU-PCT             TO ATOTMUPO.                     28370000
285500     MOVE ASC-TOT-UNT-QTY        TO ATOTUO.                       28380000
285600     MOVE ASC-SKUS-ORDERED       TO ASKUSO.                       28390000
285700     MOVE ASC-TOT-UNT-RCVD-QTY   TO AURECO.                       28400000
285800     MOVE ASC-TOT-SKU-RCVD-QTY   TO ASKURECO.                     28410000
285900     MOVE ASC-DONT-SHIP-DTE      TO ADNSBDTO.                     28420000
286000     MOVE ASC-OTB-PER-NBR        TO AOTBPERO.                     28430000
           MOVE ASC-WEEK               TO AWEEKO.                       28440000
286100     MOVE ASC-CAN-IFNOT-SHIP-DTE TO ACINSDTO.                     28450000
286200     MOVE ASC-EDI-IND            TO AEDIINDO.                     28460000
286300     MOVE ASC-EXT-CAN-DTE        TO AEXTCANO.                     28470000
286400     MOVE ASC-EDI-PROMO-TXT      TO AEDIPROO.                     28480000
286500     MOVE ASC-NEW-STR-PO-IND     TO ANEWSTRO.                     28490000
286600     MOVE ASC-DIR-STR-IND        TO ADIRECTO.                     28500000
286700     MOVE ASC-DTS-STR            TO ADTSSTRO.                     28510000
286900     MOVE ASC-AD-EVNT-DTE        TO AADDTEO.                      28520000
287300     MOVE ASC-PRE-TICKETING      TO APRETICO.                     28530000
287400     MOVE ASC-LEADTIME-DAYS-QTY     TO APRETDAO.                  28540000
287500     MOVE ASC-HANGER             TO AHANGERO.                     28550000
287600     MOVE ASC-PACK-BY-STORE      TO APKBSTO.                      28560000
287700     MOVE ASC-PKGNG-CDE          TO APACKIGO.                     28570000
287800     MOVE ASC-FIRST-RCPT-DTE     TO AFSHPDTO.                     28580000
287900     MOVE ASC-LAST-RCPT-DTE      TO ALSHPDTO.                     28590000
071490** PP 09/08/2010 BEG                                              28590359
287900     MOVE ASC-WHSE-RPLNT-IND     TO AWRREPLO.                     28591058
071490** PP 09/08/2010 END                                              28592059
288000                                                                  28600000
288100/                                                                 28610000
288200 7000-GET-LATEST-TPOAGMT.                                         28620000
288300     INITIALIZE POAGMT-LAST-UPD-TMST                              28630000
288400                POAGMT-LAST-UPD-BY-UID                            28640000
288500     PERFORM 7010-OPEN-TMST-CSR.                                  28650000
288600     PERFORM 7020-FETCH-TMST-CSR.                                 28660000
288700     PERFORM 7030-CLOSE-TMST-CSR.                                 28670000
288800                                                                  28680000
288900 7010-OPEN-TMST-CSR.                                              28690000
289000     EXEC SQL                                                     28700000
289100         OPEN TPOAGMT-TMST-CSR                                    28710000
289200     END-EXEC                                                     28720000
289300                                                                  28730000
289400     EVALUATE TRUE                                                28740000
289500         WHEN SQLCODE = ZERO                                      28750000
289600              CONTINUE                                            28760000
289700         WHEN SQLCODE = -904                                      28770000
289800         WHEN SQLCODE = -913                                      28780000
289900         WHEN SQLWARN0 NOT = SPACE                                28790000
290000             MOVE '7010-OPEN-TMST-CSR'                            28800000
290100                              TO DP013-PARAGRAPH                  28810000
290200             MOVE 'OPEN TPOAGMT-TMST-CSR CURSOR'                  28820000
290300                                  TO DP013-MESSAGE-TEXT (1)       28830000
290400             MOVE SQLCA       TO DP013-SQLCA                      28840000
290500             MOVE 'TPOAGMT'   TO DP013-DB2-TABLE-NAME (1)         28850000
290600             SET DP013-DB2-ABEND                                  28860000
290700                              TO TRUE                             28870000
290800             PERFORM DP013-0000-PROCESS-ABEND                     28880000
290900     END-EVALUATE.                                                28890000
291000                                                                  28900000
291100 7020-FETCH-TMST-CSR.                                             28910000
291200     EXEC SQL                                                     28920000
291300         FETCH TPOAGMT-TMST-CSR                                   28930000
291400         INTO :POAGMT-LAST-UPD-TMST                               28940000
291500            , :POAGMT-LAST-UPD-BY-UID                             28950000
291600     END-EXEC.                                                    28960000
291700                                                                  28970000
291800     EVALUATE TRUE                                                28980000
291900         WHEN SQLCODE = ZERO                                      28990000
292000         WHEN SQLCODE = +100                                      29000000
292100              CONTINUE                                            29010000
292200         WHEN SQLCODE NOT = ZERO                                  29020000
292300         WHEN SQLWARN0 NOT = SPACE                                29030000
292400             MOVE '7020-FETCH-TMST-CSR'                           29040000
292500                              TO DP013-PARAGRAPH                  29050000
292600             MOVE 'FETCH TPOAGMT-TMST-CSR CURSOR'                 29060000
292700                                  TO DP013-MESSAGE-TEXT (1)       29070000
292800             MOVE SQLCA       TO DP013-SQLCA                      29080000
292900             MOVE 'TPOAGMT'   TO DP013-DB2-TABLE-NAME (1)         29090000
293000             SET DP013-DB2-ABEND                                  29100000
293100                              TO TRUE                             29110000
293200             PERFORM DP013-0000-PROCESS-ABEND                     29120000
293300     END-EVALUATE.                                                29130000
293400                                                                  29140000
293500 7030-CLOSE-TMST-CSR.                                             29150000
293600     EXEC SQL                                                     29160000
293700         CLOSE TPOAGMT-TMST-CSR                                   29170000
293800     END-EXEC                                                     29180000
293900                                                                  29190000
294000     EVALUATE TRUE                                                29200000
294100         WHEN SQLCODE = ZERO                                      29210000
294200              CONTINUE                                            29220000
294300         WHEN SQLCODE NOT = ZERO                                  29230000
294400         WHEN SQLWARN0 NOT = SPACE                                29240000
294500             MOVE '7030-CLOSE-TMST-CSR'                           29250000
294600                              TO DP013-PARAGRAPH                  29260000
294700             MOVE 'CLOSE TPOAGMT-TMST-CSR CURSOR'                 29270000
294800                                  TO DP013-MESSAGE-TEXT (1)       29280000
294900             MOVE SQLCA       TO DP013-SQLCA                      29290000
295000             MOVE 'TPOAGMT'   TO DP013-DB2-TABLE-NAME (1)         29300000
295100             SET DP013-DB2-ABEND                                  29310000
295200                              TO TRUE                             29320000
295300             PERFORM DP013-0000-PROCESS-ABEND                     29330000
295400     END-EVALUATE.                                                29340000
295500/                                                                 29350000
295600*----------------------------------------------------------------*29360000
295700*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *29370000
295800*----------------------------------------------------------------*29380000
295900                                                                  29390000
296000 9100-READ-SEL-QUEUE.                                             29400000
296100     EXEC CICS                                                    29410000
296200         READQ TS                                                 29420000
296300             QUEUE (ASC-SEL-QUEUE-NAME)                           29430000
296400             INTO  (PO012-PO-SELECT-RECORD)                       29440000
296500             ITEM  (ASC-SEL-ITEM)                                 29450000
296600             RESP  (PV-CICS-RESPONSE)                             29460000
296700     END-EXEC.                                                    29470000
296800                                                                  29480000
296900     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   29490000
297000         CONTINUE                                                 29500000
297100     ELSE                                                         29510000
297200         SET DP013-LOGIC-ABEND                                    29520000
297300             DP013-NO-ROLLBACK     TO TRUE                        29530000
297400         MOVE '9100-READ-SEL-QUEUE'                               29540000
297500                                   TO DP013-PARAGRAPH             29550000
297600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   29560000
297700                                   TO DP013-MESSAGE-TEXT (1)      29570000
297800         PERFORM DP013-0000-PROCESS-ABEND                         29580000
297900     END-IF.                                                      29590000
298000                                                                  29600000
298100/                                                                 29610000
298200*----------------------------------------------------------------*29620000
298300*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *29630000
298400*----------------------------------------------------------------*29640000
298500 9200-REWRITE-SEL-QUEUE.                                          29650000
298600     EXEC CICS                                                    29660000
298700          WRITEQ TS                                               29670000
298800              QUEUE  (ASC-SEL-QUEUE-NAME)                         29680000
298900              FROM   (PO012-PO-SELECT-RECORD)                     29690000
299000              ITEM   (ASC-SEL-ITEM)                               29700000
299100              RESP   (PV-CICS-RESPONSE)                           29710000
299200              REWRITE                                             29720000
299300     END-EXEC.                                                    29730000
299400                                                                  29740000
299500     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               29750000
299600         SET DP013-CICS-ABEND                                     29760000
299700             DP013-NO-ROLLBACK     TO TRUE                        29770000
299800         MOVE '9200-REWRITE-SEL-QUEUE'                            29780000
299900                                   TO DP013-PARAGRAPH             29790000
300000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29800000
300100                                   TO DP013-MESSAGE-TEXT (1)      29810000
300200         PERFORM DP013-0000-PROCESS-ABEND                         29820000
300300     END-IF.                                                      29830000
300400                                                                  29840000
300500/                                                                 29850000
300600*----------------------------------------------------------------*29860000
300700*    NAME REFORMATOR MODULE                                      *29870000
300800*----------------------------------------------------------------*29880000
300900                                                                  29890000
301000     COPY DPPD024.                                                29900000
301100/                                                                 29910000
301200*----------------------------------------------------------------*29920000
301300*    ABEND PROCESSOR MODULE                                      *29930000
301400*----------------------------------------------------------------*29940000
301500                                                                  29950000
301600     COPY DPPD013.                                                29960000
301200*----------------------------------------------------------------*29970000
301300*    OPEN TO BUY MODULE                                          *29980000
301400*----------------------------------------------------------------*29990000
301500                                                                  30000000
301600     COPY POPD055.                                                30010000
