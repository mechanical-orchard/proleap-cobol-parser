000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.    ETKCS320.                                         00040001
000500 AUTHOR.        TROY BIRK.                                        00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  06-94.                                            00070001
000800 DATE-COMPILED.                                                   00080001
000900******************************************************************00090001
001000* PROGRAM NUMBER: ETKCS320       SYSTEM: ET     LANGUAGE: COBOL II00100001
001100*                                                                 00110001
001200* TRANID:  E320       MNEMONIC:  ETSINTXM      MAP: ETKM320       00120001
001300*                                                                 00130001
001400* PROGRAM NAME : EDI INTERCHANGE TRANSMISSION SELECTION           00140001
001500*                                                                 00150001
001600* ORIGINAL WORK REQUEST #: 2026                                   00160001
001700*                                                                 00170001
001800* PROGRAM OBJECTIVE:                                              00180001
001900*                                                                 00190001
002000*   TO ALLOW THE USER TO SPECIFY VARIOUS CRITERIA THAT WILL BE    00200001
002100*   USED TO DETERMINE WHICH INTERCHANGE TRANSMISSION WILL BE      00210001
002200*   LISTED BY THE  INTERCHANGE TRANSMISSION LIST (ETKCS321).      00220001
002300*                                                                 00230001
002400* DATASETS USED:   NONE                                           00240001
002500*                                                                 00250001
002600* PROGRAM NARRATIVE:                                              00260001
002700*                                                                 00270001
002800*   THIS SCREEN IS ACCESSED FROM THE EDI VENDOR SELECTION LIST.   00280001
002900*   (ETLVNDRS). THE VENDOR NAME AND ENT ID IS PASSED TO IT IN     00290001
003000*   A SELECTION TEMP STORAGE QUEUE.                               00300001
003100*                                                                 00310001
003200*   THE USER CAN SPECIFY AN INTERCHANGE CONTROL #, DIRECTION,     00320001
003300*   ERROR INDICATOR, NUMBER OF TRANSMISSIONS, TRAN SET, AND       00330001
003400*   BEGIN/END DATE. DIRECTION AND ERROR INDICATOR ARE REQUIRED    00340001
003500*   FIELDS, AND A VALID COMBINATION OF THE OTHER FIELDS MUST      00350001
003600*   ALSO BE ENTERED. THE VALID COMBINATION ARE AS FOLLOWS:        00360001
003700*                                                                 00370001
003800*   1) INTERCHANGE CONTROL NUMBER                                 00380001
003900*   2) NUMBER OF TRANSMISSIONS                                    00390001
004000*   3) NUMBER OF TRANSMISSIONS AND TRANS SET                      00400001
004100*   4) TRANSACTION SET AND BEGIN/END DATE                         00410001
004200*   5) BEGIN/END DATE                                             00420001
004300*                                                                 00430001
004400*   ONCE A VALID COMBINATION OF FIELDS ARE ENTERED, THE USER      00440001
004500*   CAN PRESS PF17 TO GO TO THE INTERCHANGE TRANSMISSION LIST.    00450001
004600*                                                                 00460001
004700* CONTROL CARD REQUIREMENTS: N/A                                  00470001
004800* JOBS PROGRAM IS FOUND IN:  N/A                                  00480001
004900* REPORTS PRODUCED:          N/A                                  00490001
005000*                                                                 00500001
005100***************************************************************** 00510001
005110* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00511003
005120*            - CHANGE CALL OF DPKUT100 TO                       * 00512003
005130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00513003
005140*              MAKING THE CALL DYNAMIC VS STATIC                * 00514003
005150*                                                               * 00515003
005160*---------------------------------------------------------------* 00516003
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210        00520005
CICS  *                                                                 00530004
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00540004
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00550004
CICS  *---------------------------------------------------------------* 00560004
005700***************************************************************** 00570001
005800                                                                  00580001
005900 ENVIRONMENT DIVISION.                                            00590001
006000                                                                  00600001
006100 DATA DIVISION.                                                   00610001
006200                                                                  00620001
006300 WORKING-STORAGE SECTION.                                         00630001
006400*                                                                 00640001
006500 01  PC-PROGRAM-CONSTANTS.                                        00650001
006600     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'ET320A  '. 00660001
006700     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'ETKM320 '. 00670001
006800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'ETKCS320'. 00680001
006900     05  PC-TSYMSG-NUMBERS.                                       00690001
007000         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00700001
007100         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00710001
007200         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00720001
007300         10  PC-TSYMSG-00010       PIC  9(05)  VALUE  00010.      00730001
007400         10  PC-TSYMSG-00017       PIC  9(05)  VALUE  00017.      00740001
007500         10  PC-TSYMSG-00069       PIC  9(05)  VALUE  00069.      00750001
007600         10  PC-TSYMSG-00070       PIC  9(05)  VALUE  00070.      00760001
007700         10  PC-TSYMSG-00137       PIC  9(05)  VALUE  00137.      00770001
007800         10  PC-TSYMSG-00146       PIC  9(05)  VALUE  00146.      00780001
007900         10  PC-TSYMSG-00240       PIC  9(05)  VALUE  00240.      00790001
008000         10  PC-TSYMSG-00315       PIC  9(05)  VALUE  00315.      00800001
008100         10  PC-TSYMSG-00550       PIC  9(05)  VALUE  00550.      00810001
008200         10  PC-TSYMSG-00551       PIC  9(05)  VALUE  00551.      00820001
008300         10  PC-TSYMSG-00718       PIC  9(05)  VALUE  00718.      00830001
008400         10  PC-TSYMSG-00831       PIC  9(05)  VALUE  00831.      00840001
008500     05  PC-CALENDAR-ROUTINE       PIC  X(08)  VALUE  'DPKUT500'. 00850001
008600*                                                                 00860001
008700 01  PS-PROGRAM-SWITCHES.                                         00870001
008800     05  PS-ERROR-SW               PIC  X      VALUE  'N'.        00880001
008900         88  PS-ERROR                          VALUE  'Y'.        00890001
009000         88  PS-NO-ERROR                       VALUE  'N'.        00900001
009100     05  PS-LIST-END-SW            PIC X       VALUE 'N'.         00910001
009200         88  PS-LIST-END                       VALUE 'Y'.         00920001
009300         88  PS-NO-LIST-END                    VALUE 'N'.         00930001
009400                                                                  00940001
009500 01  PV-PROGRAM-VARIABLES.                                        00950001
009600     05  PV-CICS-RESP            PIC S9(04) VALUE +0    COMP SYNC.00960001
009700     05  PV-ASTERISK-CNT         PIC S9(04) VALUE +0    COMP SYNC.00970001
009800                                                                  00980001
009900******************************************************************00990001
010000*    RECORD LAYOUT FOR THE VENDOR LIST TEMP STORAGE QUEUE.       *01000001
010100******************************************************************01010001
010200     COPY ETWS301.                                                01020001
010300                                                                  01030001
010400******************************************************************01040001
010500*    MAP LAYOUT                                                  *01050001
010600******************************************************************01060001
010700     COPY ETKM320.                                                01070001
010800     EJECT                                                        01080001
010900******************************************************************01090001
011000*  EXTENDED ATTIBUTES COPYBOOK                                   *01100001
011100******************************************************************01110001
011200                                                                  01120001
011300     COPY DPWS015.                                                01130001
011400                                                                  01140001
011500******************************************************************01150001
011600*  FUNCTION KEYS  COPYBOOK                                       *01160001
011700******************************************************************01170001
011800                                                                  01180001
011900     COPY DPWS016.                                                01190001
012000                                                                  01200001
012100******************************************************************01210001
012200*    COPY BOOK FOR NUMERIC EDIT SUBROUTINE (DPKUT100) PARAMETER  *01220001
012300*    LIST.                                                       *01230001
012400******************************************************************01240001
012500                                                                  01250001
012600     COPY DPWS010I.                                               01260001
012700                                                                  01270001
012800******************************************************************01280001
012900*    COPY BOOK FOR CURRENT SYSTEM DATE/TIME PROCEDURE DIVISION   *01290001
013000*    ROUTINE                                                      01300001
013100******************************************************************01310001
013200                                                                  01320001
013300     COPY DPWS017.                                                01330001
013400                                                                  01340001
013500******************************************************************01350001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          **01360004
013800******************************************************************01380001
013900     COPY DPWS030.                                                01390001
CICS       COPY DPWS930.                                                01391004
014000                                                                  01400001
014100***************************************************************** 01410001
014200*    STANDARD COMMAREA.                                           01420001
014300***************************************************************** 01430001
014400                                                                  01440001
014500     COPY DPWS020.                                                01450001
014600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01460001
014700                                                                  01470001
014800***************************************************************** 01480001
014900*    INTER-APPLICATION COMMAREA.                                  01490001
015000***************************************************************** 01500001
015100                                                                  01510001
015200         10  INTER-APPL-COMM-AREA PIC X(200).                     01520001
015300                                                                  01530001
015400     COPY ETWS300.                                                01540001
015500     COPY ETWS307.                                                01550001
015600***************************************************************** 01560001
015700*    SPECIFIC COMMMAREA FOR ETKCS320.                             01570001
015800***************************************************************** 01580001
015900         10  ASC-SPECIFIC-COMMAREA.                               01590001
016000             15  ASC-ENT-ID                  PIC S9(09) COMP.     01600001
016100             15  ASC-VENDOR-NAME             PIC X(30).           01610001
016200             15  ASC-CONTROL-NUM             PIC 9(09).           01620001
016300             15  ASC-CONTROL-NUM-X REDEFINES ASC-CONTROL-NUM      01630001
016400                                             PIC X(09).           01640001
016500             15  ASC-DIRECTION-IND           PIC X(01).           01650001
016600             15  ASC-ERROR-IND               PIC X(01).           01660001
016700             15  ASC-NUM-XMITS               PIC 9(03).           01670001
016800             15  ASC-NUM-XMITS-X REDEFINES ASC-NUM-XMITS          01680001
016900                                             PIC X(03).           01690001
017000             15  ASC-TRAN-SET                PIC X(03).           01700001
017100             15  ASC-BEGIN-DATE.                                  01710001
017200                 20  ASC-BEGIN-DATE-YYYY     PIC  X(04).          01720001
017300                 20  ASC-BEGIN-DATE-MM       PIC  X(02).          01730001
017400                 20  ASC-BEGIN-DATE-DD       PIC  X(02).          01740001
017500             15  ASC-END-DATE.                                    01750001
017600                 20  ASC-END-DATE-YYYY       PIC  X(04).          01760001
017700                 20  ASC-END-DATE-MM         PIC  X(02).          01770001
017800                 20  ASC-END-DATE-DD         PIC  X(02).          01780001
017900                                                                  01790001
018000             15  ASC-SEL-SUB                 PIC S9(04) COMP.     01800001
018100             15  ASC-SEL-ITEM                PIC S9(04) COMP.     01810001
018200             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05) COMP-3.   01820001
018300             15  ASC-SEL-QUEUE-NAME.                              01830001
018400                 20  ASC-SEL-TERM-ID         PIC  X(04).          01840001
018500                 20  ASC-SEL-TASK-NUMBER     PIC S9(05)           01850001
018600                                                        COMP-3.   01860001
018700                 20  ASC-SEL-SEQ             PIC  9.              01870001
018800             15  FILLER                      PIC  X(2783).        01880001
018900     EJECT                                                        01890001
019000                                                                  01900001
019100*----------------------------------------------------------------*01910001
019200*    COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                 01920001
019300*----------------------------------------------------------------*01930001
019400                                                                  01940001
019500     COPY DPWS500.                                                01950001
019600                                                                  01960001
019700***************************************************************** 01970001
019800*   ABEND COPYBOOK.                                               01980001
019900***************************************************************** 01990001
020000     COPY DPWS013.                                                02000001
020100                                                                  02010001
020200                                                                  02020001
020300 EJECT                                                            02030001
020400 LINKAGE SECTION.                                                 02040001
020500                                                                  02050001
020600 01  DFHCOMMAREA.                                                 02060001
020700     05  FILLER                         OCCURS  1 TO 4072 TIMES   02070001
020800                                        DEPENDING ON EIBCALEN.    02080001
020900         10  FILLER                     PIC X.                    02090001
021000                                                                  02100001
021100                                                                  02110001
021200 PROCEDURE DIVISION.                                              02120001
021300***************************************************************** 02130001
021400** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02140001
021500** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02150001
021600** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02160001
021700**                                                             ** 02170001
021800** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02180001
021900** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02190001
022000***************************************************************** 02200001
022100 0000-MAIN-MODULE.                                                02210001
022200     INITIALIZE DP030-CICS-API-FIELDS.                            02220001
022300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02230001
022400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02240001
022500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02250001
022600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02260001
022700     MOVE LENGTH OF ET320AI        TO DP030-MAP-LENGTH (1).       02270001
022800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02280001
022900     PERFORM 0001-CALL-CICS-ARCH-API.                             02290001
023000*                                                                 02300001
023100     PERFORM 1000-CONTROL-PROCESSING.                             02310001
023200*                                                                 02320001
023300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02330001
023400     PERFORM 0001-CALL-CICS-ARCH-API.                             02340001
023500                                                                  02350001
023600 0001-CALL-CICS-ARCH-API.                                         02360001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02370004
023800                                    DFHCOMMAREA                   02380004
023900                                    DP030-CICS-API-FIELDS         02390004
024000                                    DP020-STANDARD-COMMAREA       02400004
024100                                    ET320AI.                      02410004
024200*                                                                 02420001
024300     IF  DP030-RC-CALL-SUCCESSFUL                                 02430001
024400         CONTINUE                                                 02440001
024500     ELSE                                                         02450001
024600         SET DP013-NO-ROLLBACK                                    02460001
024700             DP013-XCTL-DISPLAY-RESTART                           02470001
024800             DP013-CICS-ABEND      TO TRUE                        02480001
024900         MOVE 'BEFORE 0000-MAIN-MODULE'                           02490001
025000                                   TO DP013-PARAGRAPH             02500001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02510004
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02520004
025300         MOVE DP030-RETURN-CODE                                   02530001
025400                                   TO DP013-MESSAGE-TEXT (3)      02540001
025500         PERFORM DP013-0000-PROCESS-ABEND                         02550001
025600     END-IF.                                                      02560001
025700 EJECT                                                            02570001
025800******************************************************************02580001
025900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02590001
026000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02600001
026100******************************************************************02610001
026200                                                                  02620001
026300 1000-CONTROL-PROCESSING.                                         02630001
026400                                                                  02640001
026500     EVALUATE TRUE                                                02650001
026600         WHEN DP020-NEXT-ACT-INITIAL                              02660001
026700             INITIALIZE ASC-SPECIFIC-COMMAREA                     02670001
026800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 02680001
026900             PERFORM 4000-BUILD-INITIAL-PANEL                     02690001
027000                                                                  02700001
027100         WHEN DP020-NEXT-ACT-READ-MAP                             02710001
027200             PERFORM 2000-FKEY-PROCESSING                         02720001
027300                                                                  02730001
027400         WHEN DP020-NEXT-ACT-RETURN                               02740001
027500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02750001
027600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02760001
027700                                                                  02770001
027800         WHEN OTHER                                               02780001
027900             SET DP013-LOGIC-ABEND                                02790001
028000                 DP013-NO-ROLLBACK TO TRUE                        02800001
028100             MOVE '1000-CONTROL-PROCESSING'                       02810001
028200                                   TO  DP013-PARAGRAPH            02820001
028300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02830001
028400                                   TO  DP013-MESSAGE-TEXT(1)      02840001
028500             MOVE DP020-NEXT-APPL-ACTIVITY                        02850001
028600                                   TO DP013-MESSAGE-TEXT(2)       02860001
028700             PERFORM DP013-0000-PROCESS-ABEND                     02870001
028800     END-EVALUATE.                                                02880001
028900                                                                  02890001
029000******************************************************************02900001
029100* MOVE VALUES FROM THE INTER APPL COMMAREA TO THE APPLICATION     02910001
029200* SPECIFIC COMMAREA. PERFORM 2140-GET-NEXT-ITEM TO GET THE FIRST  02920001
029300* ITEM FROM THE LIST QUEUE.                                       02930001
029400******************************************************************02940001
029500 1100-PROCESS-INTER-APPL-COMM.                                    02950001
029600                                                                  02960001
029700     MOVE ET300-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS      02970001
029800     MOVE ET300-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME          02980001
029900     MOVE ET301-MAX-ITEMS TO ASC-SEL-SUB                          02990001
030000     MOVE ZERO TO ASC-SEL-ITEM.                                   03000001
030100     PERFORM 2140-GET-NEXT-ITEM.                                  03010001
030200*                                                                 03020001
030300******************************************************************03030001
030400* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*03040001
030500* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*03050001
030600* EDITS.                                                         *03060001
030700******************************************************************03070001
030800                                                                  03080001
030900 2000-FKEY-PROCESSING.                                            03090001
031000     EVALUATE TRUE                                                03100001
031100                                                                  03110001
031200         WHEN DP020-SRC-AID = DP016-CLEAR                         03120001
031300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03130001
031400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03140001
031500                                                                  03150001
031600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03160001
031700             MOVE SPACES TO ASC-CONTROL-NUM-X                     03170001
031800                            ASC-DIRECTION-IND                     03180001
031900                            ASC-NUM-XMITS-X                       03190001
032000                            ASC-TRAN-SET                          03200001
032100                            ASC-BEGIN-DATE                        03210001
032200                            ASC-END-DATE                          03220001
032300             MOVE 'N'    TO ASC-ERROR-IND                         03230001
032400                                                                  03240001
032500             PERFORM 4000-BUILD-INITIAL-PANEL                     03250001
032600             PERFORM 3200-RESET-ATTRIBUTES                        03260001
032700                                                                  03270001
032800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             03280001
032900                 PERFORM 2140-GET-NEXT-ITEM                       03290001
033000                 IF PS-LIST-END                                   03300001
033100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         03310001
033200                     SET PS-NO-LIST-END TO TRUE                   03320001
033300                 ELSE                                             03330001
033400                     PERFORM 4000-BUILD-INITIAL-PANEL             03340001
033500                 END-IF                                           03350001
033600                                                                  03360001
033700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             03370001
033800                 PERFORM 2150-GET-PREV-ITEM                       03380001
033900                 IF PS-LIST-END                                   03390001
034000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         03400001
034100                     SET PS-NO-LIST-END TO TRUE                   03410001
034200                 ELSE                                             03420001
034300                     PERFORM 4000-BUILD-INITIAL-PANEL             03430001
034400                 END-IF                                           03440001
034500                                                                  03450001
034600         WHEN OTHER                                               03460001
034700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03470001
034800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03480001
034900             IF  PS-NO-ERROR                                      03490001
035000                 SET DP030-CONTINUE-GO TO TRUE                    03500001
035100                 PERFORM 2100-CHECK-FUNCTION-KEY                  03510001
035200             ELSE                                                 03520001
035300                 SET DP030-OVERRIDE-GO TO TRUE                    03530001
035400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03540001
035500             END-IF                                               03550001
035600     END-EVALUATE.                                                03560001
035700                                                                  03570001
035800                                                                  03580001
035900******************************************************************03590001
036000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *03600001
036100* FIRST. NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED    *03610001
036200* FROM THE CICS ARCHITECTURE API.                                *03620001
036300******************************************************************03630001
036400                                                                  03640001
036500 2100-CHECK-FUNCTION-KEY.                                         03650001
036600     EVALUATE TRUE                                                03660001
036700         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 03670001
036800             PERFORM 2110-PREPARE-INTER-APPL-COMM                 03680001
036900                                                                  03690001
037000         WHEN DP020-SRC-AID = DP016-ENTER                         03700001
037100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03710001
037200                                                                  03720001
037300         WHEN OTHER                                               03730001
037400             SET DP013-NO-ROLLBACK                                03740001
037500                 DP013-XCTL-DISPLAY-RESTART                       03750001
037600                 DP013-CICS-ABEND  TO TRUE                        03760001
037700             MOVE '2100-CHECK-FUNCTION-KEY'                       03770001
037800                                   TO DP013-PARAGRAPH             03780001
037900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03790001
038000                                   TO DP013-MESSAGE-TEXT (1)      03800001
038100             PERFORM DP013-0000-PROCESS-ABEND                     03810001
038200     END-EVALUATE.                                                03820001
038300                                                                  03830001
038400                                                                  03840001
038500******************************************************************03850001
038600** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03860001
038700** INTER-APPLICATION COMMAREA.                                  **03870001
038800******************************************************************03880001
038900                                                                  03890001
039000 2110-PREPARE-INTER-APPL-COMM.                                    03900001
039100                                                                  03910001
039200      INITIALIZE ET307-INTER-APPL-COMMAREA.                       03920001
039300      MOVE ASC-ENT-ID           TO ET307-ENT-ID.                  03930001
039400      MOVE ASC-VENDOR-NAME      TO ET307-VENDOR-NAME.             03940001
039500      MOVE ASC-CONTROL-NUM-X    TO ET307-CONTROL-NUM-X.           03950001
039600      MOVE ASC-DIRECTION-IND    TO ET307-DIRECTION-IND.           03960001
039700      MOVE ASC-ERROR-IND        TO ET307-ERROR-IND.               03970001
039800      MOVE ASC-NUM-XMITS-X      TO ET307-NUM-XMITS-X.             03980001
039900      MOVE ASC-TRAN-SET         TO ET307-TRAN-SET.                03990001
040000      MOVE ASC-BEGIN-DATE       TO ET307-BEGIN-DT.                04000001
040100      MOVE ASC-END-DATE         TO ET307-END-DT.                  04010001
040200                                                                  04020001
040300******************************************************************04030001
040400** GET THE NEXT ITEM FROM THE LIST QUEUE.                         04040001
040500******************************************************************04050001
040600 2140-GET-NEXT-ITEM.                                              04060001
040700     ADD +1                       TO ASC-SEL-SUB.                 04070001
040800     IF  ASC-SEL-SUB > ET301-MAX-ITEMS                            04080001
040900         ADD +1                   TO ASC-SEL-ITEM                 04090001
041000         MOVE +1                  TO ASC-SEL-SUB                  04100001
041100     END-IF.                                                      04110001
041200     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 04120001
041300         PERFORM 9100-READ-SEL-QUEUE                              04130001
041400         IF  ET301-ITEM (ASC-SEL-SUB) > ZERO                      04140001
041500             MOVE ET301-ENT-ID    (ASC-SEL-SUB)                   04150001
041600                                   TO ASC-ENT-ID                  04160001
041700             MOVE ET301-VENDOR-NAME (ASC-SEL-SUB)                 04170001
041800                                   TO ASC-VENDOR-NAME             04180001
041900             MOVE SPACES TO ASC-CONTROL-NUM-X                     04190001
042000                            ASC-DIRECTION-IND                     04200001
042100                            ASC-NUM-XMITS-X                       04210001
042200                            ASC-TRAN-SET                          04220001
042300                            ASC-BEGIN-DATE                        04230001
042400                            ASC-END-DATE                          04240001
042500             MOVE 'N'    TO ASC-ERROR-IND                         04250001
042600                                                                  04260001
042700             SET ET301-INQ (ASC-SEL-SUB) TO TRUE                  04270001
042800             PERFORM 9200-REWRITE-SEL-QUEUE                       04280001
042900         ELSE                                                     04290001
043000             SUBTRACT +1 FROM ASC-SEL-SUB                         04300001
043100*            ---- BOTTOM OF LIST ----                             04310001
043200             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             04320001
043300             SET DP020-MSG-INFORMATIONAL TO TRUE                  04330001
043400             SET PS-LIST-END             TO TRUE                  04340001
043500         END-IF                                                   04350001
043600     ELSE                                                         04360001
043700         SUBTRACT +1 FROM ASC-SEL-ITEM                            04370001
043800         MOVE ET301-MAX-ITEMS     TO ASC-SEL-SUB                  04380001
043900*        ---- BOTTOM OF LIST ----                                 04390001
044000         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             04400001
044100         SET DP020-MSG-INFORMATIONAL TO TRUE                      04410001
044200         SET PS-LIST-END             TO TRUE                      04420001
044300     END-IF.                                                      04430001
044400                                                                  04440001
044500******************************************************************04450001
044600** GET THE PREVIOUS ITEM FROM THE LIST QUEUE.                     04460001
044700******************************************************************04470001
044800 2150-GET-PREV-ITEM.                                              04480001
044900                                                                  04490001
045000     SUBTRACT +1 FROM ASC-SEL-SUB.                                04500001
045100     IF  ASC-SEL-SUB < +1                                         04510001
045200         SUBTRACT +1 FROM ASC-SEL-ITEM                            04520001
045300         MOVE ET301-MAX-ITEMS     TO ASC-SEL-SUB                  04530001
045400     END-IF.                                                      04540001
045500                                                                  04550001
045600     IF  ASC-SEL-ITEM > ZERO                                      04560001
045700         PERFORM 9100-READ-SEL-QUEUE                              04570001
045800             MOVE ET301-ENT-ID    (ASC-SEL-SUB)                   04580001
045900                                   TO ASC-ENT-ID                  04590001
046000             MOVE ET301-VENDOR-NAME (ASC-SEL-SUB)                 04600001
046100                                   TO ASC-VENDOR-NAME             04610001
046200             MOVE SPACES TO ASC-CONTROL-NUM-X                     04620001
046300                            ASC-DIRECTION-IND                     04630001
046400                            ASC-NUM-XMITS-X                       04640001
046500                            ASC-TRAN-SET                          04650001
046600                            ASC-BEGIN-DATE                        04660001
046700                            ASC-END-DATE                          04670001
046800             MOVE 'N'    TO ASC-ERROR-IND                         04680001
046900     ELSE                                                         04690001
047000         MOVE +1                  TO ASC-SEL-ITEM                 04700001
047100                                     ASC-SEL-SUB                  04710001
047200*        ---- TOP OF LIST ----                                    04720001
047300         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             04730001
047400         SET DP020-MSG-INFORMATIONAL TO TRUE                      04740001
047500         SET PS-LIST-END             TO TRUE                      04750001
047600     END-IF.                                                      04760001
047700                                                                  04770001
047800******************************************************************04780001
047900* MOVE FIELDS FROM THE MAP TO THE ASC COMMAREA                    04790001
048000******************************************************************04800001
048100 2200-MOVE-SCREEN-TO-COMMAREA.                                    04810001
048200                                                                  04820001
048300     IF  AINTCNTL > ZERO                                          04830001
048400         MOVE AINTCNTI       TO ASC-CONTROL-NUM-X                 04840001
048500     ELSE                                                         04850001
048600         IF  AINTCNTF = DP015-ERASE-EOF                           04860001
048700             MOVE SPACE      TO ASC-CONTROL-NUM-X                 04870001
048800         END-IF                                                   04880001
048900     END-IF.                                                      04890001
049000                                                                  04900001
049100     IF  ADIRL > ZERO                                             04910001
049200         MOVE ADIRI          TO ASC-DIRECTION-IND                 04920001
049300     ELSE                                                         04930001
049400         IF  ADIRF = DP015-ERASE-EOF                              04940001
049500             MOVE SPACE      TO ASC-DIRECTION-IND                 04950001
049600         END-IF                                                   04960001
049700     END-IF.                                                      04970001
049800                                                                  04980001
049900     IF  AERRINDL > ZERO                                          04990001
050000         MOVE AERRINDI       TO ASC-ERROR-IND                     05000001
050100     ELSE                                                         05010001
050200         IF  AERRINDF = DP015-ERASE-EOF                           05020001
050300             MOVE SPACE      TO ASC-ERROR-IND                     05030001
050400         END-IF                                                   05040001
050500     END-IF.                                                      05050001
050600                                                                  05060001
050700     IF  ANUMTRNL > ZERO                                          05070001
050800         MOVE ANUMTRNI       TO ASC-NUM-XMITS-X                   05080001
050900     ELSE                                                         05090001
051000         IF  ANUMTRNF = DP015-ERASE-EOF                           05100001
051100             MOVE SPACE      TO ASC-NUM-XMITS-X                   05110001
051200         END-IF                                                   05120001
051300     END-IF.                                                      05130001
051400                                                                  05140001
051500     IF  ATSETL > ZERO                                            05150001
051600         MOVE ATSETI         TO ASC-TRAN-SET                      05160001
051700     ELSE                                                         05170001
051800         IF  ATSETF = DP015-ERASE-EOF                             05180001
051900             MOVE SPACE      TO ASC-TRAN-SET                      05190001
052000         END-IF                                                   05200001
052100     END-IF.                                                      05210001
052200                                                                  05220001
052300     IF  ABEGDTDL > ZERO                                          05230001
052400         MOVE ABEGDTDI       TO ASC-BEGIN-DATE-DD                 05240001
052500     ELSE                                                         05250001
052600         IF  ABEGDTDF = DP015-ERASE-EOF                           05260001
052700             MOVE SPACE      TO ASC-BEGIN-DATE-DD                 05270001
052800         END-IF                                                   05280001
052900     END-IF.                                                      05290001
053000                                                                  05300001
053100     IF  ABEGDTML > ZERO                                          05310001
053200         MOVE ABEGDTMI       TO ASC-BEGIN-DATE-MM                 05320001
053300     ELSE                                                         05330001
053400         IF  ABEGDTMF = DP015-ERASE-EOF                           05340001
053500             MOVE SPACE      TO ASC-BEGIN-DATE-MM                 05350001
053600         END-IF                                                   05360001
053700     END-IF.                                                      05370001
053800                                                                  05380001
053900     IF  ABEGDTYL > ZERO                                          05390001
054000         MOVE ABEGDTYI       TO ASC-BEGIN-DATE-YYYY               05400001
054100     ELSE                                                         05410001
054200         IF  ABEGDTYF = DP015-ERASE-EOF                           05420001
054300             MOVE SPACE      TO ASC-BEGIN-DATE-YYYY               05430001
054400         END-IF                                                   05440001
054500     END-IF.                                                      05450001
054600                                                                  05460001
054700     IF  AENDDTDL > ZERO                                          05470001
054800         MOVE AENDDTDI       TO ASC-END-DATE-DD                   05480001
054900     ELSE                                                         05490001
055000         IF  AENDDTDF = DP015-ERASE-EOF                           05500001
055100             MOVE SPACE      TO ASC-END-DATE-DD                   05510001
055200         END-IF                                                   05520001
055300     END-IF.                                                      05530001
055400                                                                  05540001
055500     IF  AENDDTML > ZERO                                          05550001
055600         MOVE AENDDTMI       TO ASC-END-DATE-MM                   05560001
055700     ELSE                                                         05570001
055800         IF  AENDDTMF = DP015-ERASE-EOF                           05580001
055900             MOVE SPACE      TO ASC-END-DATE-MM                   05590001
056000         END-IF                                                   05600001
056100     END-IF.                                                      05610001
056200                                                                  05620001
056300     IF  AENDDTYL > ZERO                                          05630001
056400         MOVE AENDDTYI       TO ASC-END-DATE-YYYY                 05640001
056500     ELSE                                                         05650001
056600         IF  AENDDTYF = DP015-ERASE-EOF                           05660001
056700             MOVE SPACE      TO ASC-END-DATE-YYYY                 05670001
056800         END-IF                                                   05680001
056900     END-IF.                                                      05690001
057000                                                                  05700001
057100                                                                  05710001
057200******************************************************************05720001
057300* PERFORM THE FOLLOWING EDITS:                                    05730001
057400* ERROR INDICATOR IS REQUIRED AND MUST BE A Y ON N.               05740001
057500* DIRECTION REQUIRED AND MUST BE A R ON S.                        05750001
057600* IF INTERCHANGE CONTROL NUMBER OR NUMBER OF TRANSMIT ARE ENTERED,05760001
057700*    THEY MUST BE NUMERIC.                                        05770001
057800* IF BEGIN DATE IS ENTERED, END DATE MUST ALSO BE ENTERED AND     05780001
057900*    VICE VERSA.                                                  05790001
058000* END DATE CANNOT BE GREATED THAN BEGIN DATE.                     05800001
058100*                                                                 05810001
058200* A VAILD COMBINATION OF FIELDS MUST BE ENTERED (SEE COMMENTS IN  05820001
058300*  THE IDENTIFICATION DIVISION FOR THE VALID COMBOS).             05830001
058400******************************************************************05840001
058500 3000-EDIT-DATA-IN-COMMAREA.                                      05850001
058600                                                                  05860001
058700     PERFORM 3200-RESET-ATTRIBUTES.                               05870001
058800                                                                  05880001
058900     IF ASC-ERROR-IND = SPACES                                    05890001
059000         MOVE DP015-UNP-ALP-BRT-OFF  TO AERRINDA                  05900001
059100         MOVE DP015-RED              TO AERRINDC                  05910001
059200         MOVE DP015-REVERSE          TO AERRINDH                  05920001
059300         MOVE -1                     TO AERRINDL                  05930001
059400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05940001
059500         IF PS-NO-ERROR                                           05950001
059600             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          05960001
059700             SET PS-ERROR                                         05970001
059800                 DP020-MSG-FATAL     TO TRUE                      05980001
059900         END-IF                                                   05990001
060000     ELSE                                                         06000001
060100         IF (ASC-ERROR-IND = 'Y') OR                              06010001
060200            (ASC-ERROR-IND = 'N')                                 06020001
060300             CONTINUE                                             06030001
060400         ELSE                                                     06040001
060500             SET PS-ERROR                                         06050001
060600                 DP020-MSG-FATAL         TO TRUE                  06060001
060700             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      06070001
060800             MOVE DP015-UNP-ALP-BRT-OFF  TO AERRINDA              06080001
060900             MOVE DP015-RED              TO AERRINDC              06090001
061000             MOVE DP015-REVERSE          TO AERRINDH              06100001
061100             MOVE -1                     TO AERRINDL              06110001
061200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06120001
061300         END-IF                                                   06130001
061400     END-IF                                                       06140001
061500                                                                  06150001
061600     IF ASC-DIRECTION-IND = SPACES                                06160001
061700         MOVE DP015-UNP-ALP-BRT-OFF  TO ADIRA                     06170001
061800         MOVE DP015-RED              TO ADIRC                     06180001
061900         MOVE DP015-REVERSE          TO ADIRH                     06190001
062000         MOVE -1                     TO ADIRL                     06200001
062100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06210001
062200         IF PS-NO-ERROR                                           06220001
062300             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          06230001
062400             SET PS-ERROR                                         06240001
062500                 DP020-MSG-FATAL     TO TRUE                      06250001
062600         END-IF                                                   06260001
062700     ELSE                                                         06270001
062800         IF (ASC-DIRECTION-IND = 'R') OR                          06280001
062900            (ASC-DIRECTION-IND = 'S')                             06290001
063000             CONTINUE                                             06300001
063100         ELSE                                                     06310001
063200             SET PS-ERROR                                         06320001
063300                 DP020-MSG-FATAL         TO TRUE                  06330001
063400             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      06340001
063500             MOVE DP015-UNP-ALP-BRT-OFF  TO ADIRA                 06350001
063600             MOVE DP015-RED              TO ADIRC                 06360001
063700             MOVE DP015-REVERSE          TO ADIRH                 06370001
063800             MOVE -1                     TO ADIRL                 06380001
063900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06390001
064000         END-IF                                                   06400001
064100     END-IF.                                                      06410001
064200                                                                  06420001
064300     IF (ASC-CONTROL-NUM-X = SPACE) AND                           06430001
064400        (ASC-NUM-XMITS-X   = SPACE) AND                           06440001
064500        (ASC-TRAN-SET        = SPACE) AND                         06450001
064600        (ASC-BEGIN-DATE-YYYY = SPACE) AND                         06460001
064700        (ASC-BEGIN-DATE-MM   = SPACE) AND                         06470001
064800        (ASC-BEGIN-DATE-DD   = SPACE) AND                         06480001
064900        (ASC-END-DATE-YYYY   = SPACE) AND                         06490001
065000        (ASC-END-DATE-MM     = SPACE) AND                         06500001
065100        (ASC-END-DATE-DD     = SPACE)                             06510001
065200         MOVE -1                     TO ADIRL                     06520001
065300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      06530001
065400         SET  PS-ERROR                                            06540001
065500              DP020-MSG-FATAL        TO TRUE                      06550001
065600         MOVE PC-TSYMSG-00831      TO DP020-MSG-NUMBER            06560001
065700     END-IF.                                                      06570001
065800                                                                  06580001
065900     IF PS-NO-ERROR                                               06590001
066000       IF ASC-CONTROL-NUM-X  NOT = SPACE                          06600001
066100         MOVE ASC-CONTROL-NUM-X           TO DP010I-UNEDITED-FIELD06610001
066200         MOVE LENGTH OF ASC-CONTROL-NUM-X TO DP010I-MAXIMUM-DIGITS06620001
066300         MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS  06630001
066400         SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                 06640001
066500                                                                  06650001
066610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06661002
066620                         USING DP010I-NUMERIC-EDIT-AREA           06662002
066700                                                                  06670001
066800         IF DP010I-ERROR-DETECTED                                 06680001
066900             CONTINUE                                             06690001
067000         ELSE                                                     06700001
067100             MOVE DP010I-NUMERIC-FIELD   TO ASC-CONTROL-NUM       06710001
067200         END-IF                                                   06720001
067300                                                                  06730001
067400         IF ASC-CONTROL-NUM-X NOT NUMERIC                         06740001
067500             MOVE DP015-UNP-NUM-BRT-OFF  TO AINTCNTA              06750001
067600             MOVE DP015-RED              TO AINTCNTC              06760001
067700             MOVE DP015-REVERSE          TO AINTCNTH              06770001
067800             MOVE -1                     TO AINTCNTL              06780001
067900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06790001
068000             SET DP020-MSG-FATAL         TO TRUE                  06800001
068100             IF PS-NO-ERROR                                       06810001
068200                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      06820001
068300                 SET PS-ERROR                                     06830001
068400                     DP020-MSG-FATAL     TO TRUE                  06840001
068500             END-IF                                               06850001
068600         END-IF                                                   06860001
068700       END-IF                                                     06870001
068800     END-IF.                                                      06880001
068900                                                                  06890001
069000     IF ASC-NUM-XMITS-X NOT = SPACE                               06900001
069100         MOVE ASC-NUM-XMITS-X         TO DP010I-UNEDITED-FIELD    06910001
069200         MOVE LENGTH OF ASC-NUM-XMITS-X TO DP010I-MAXIMUM-DIGITS  06920001
069300         MOVE ZERO                    TO DP010I-MAXIMUM-DECIMALS  06930001
069400         SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                 06940001
069500                                                                  06950001
069610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06961002
069620                         USING DP010I-NUMERIC-EDIT-AREA           06962002
069700                                                                  06970001
069800         IF DP010I-ERROR-DETECTED                                 06980001
069900             CONTINUE                                             06990001
070000         ELSE                                                     07000001
070100             MOVE DP010I-NUMERIC-FIELD   TO ASC-NUM-XMITS         07010001
070200         END-IF                                                   07020001
070300                                                                  07030001
070400         IF ASC-NUM-XMITS-X NOT NUMERIC                           07040001
070500             MOVE DP015-UNP-NUM-BRT-OFF  TO ANUMTRNA              07050001
070600             MOVE DP015-RED              TO ANUMTRNC              07060001
070700             MOVE DP015-REVERSE          TO ANUMTRNH              07070001
070800             MOVE -1                     TO ANUMTRNL              07080001
070900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07090001
071000             SET DP020-MSG-FATAL         TO TRUE                  07100001
071100             IF PS-NO-ERROR                                       07110001
071200                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      07120001
071300                 SET PS-ERROR                                     07130001
071400                     DP020-MSG-FATAL     TO TRUE                  07140001
071500             END-IF                                               07150001
071600         END-IF                                                   07160001
071700     END-IF.                                                      07170001
071800                                                                  07180001
071900     IF  PS-NO-ERROR                                              07190001
072000         IF ASC-BEGIN-DATE > SPACES                               07200001
072100             PERFORM DP017-0000-GET-CURR-DATE-TIME                07210001
072200             MOVE DP017-CURRENT-DATE-YMD  TO DPG51-SYSTEM-DATE    07220001
072300             SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE             07230001
072400             SET  DPG52-LK-DTE-ISO            TO TRUE             07240001
072500             MOVE ASC-BEGIN-DATE TO DPG52-LK-DATE-INPUT           07250001
072600             PERFORM 3100-CALL-CALENDAR-ROUTINE                   07260001
072700             IF (DPG54-DATE-INVALID) OR                           07270001
072800                (DPG54-SEVERE-ERROR)                              07280001
072900                 SET  PS-ERROR                                    07290001
073000                      DP020-MSG-FATAL        TO TRUE              07300001
073100*        ---- BAD DATE  ----                                      07310001
073200                 MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  07320001
073300                 MOVE DP015-UNP-NUM-BRT-OFF  TO ABEGDTDA          07330001
073400                                                ABEGDTMA          07340001
073500                                                ABEGDTYA          07350001
073600                 MOVE DP015-RED              TO ABEGDTDC          07360001
073700                                                ABEGDTMC          07370001
073800                                                ABEGDTYC          07380001
073900                 MOVE DP015-REVERSE          TO ABEGDTDH          07390001
074000                                                ABEGDTMH          07400001
074100                                                ABEGDTYH          07410001
074200                 MOVE -1                     TO ABEGDTML          07420001
074300                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07430001
074400             END-IF                                               07440001
074500         END-IF                                                   07450001
074600     END-IF.                                                      07460001
074700                                                                  07470001
074800     IF  PS-NO-ERROR                                              07480001
074900         IF ASC-END-DATE > SPACES                                 07490001
075000             PERFORM DP017-0000-GET-CURR-DATE-TIME                07500001
075100             MOVE DP017-CURRENT-DATE-YMD  TO DPG51-SYSTEM-DATE    07510001
075200             SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE             07520001
075300             SET  DPG52-LK-DTE-ISO            TO TRUE             07530001
075400             MOVE ASC-END-DATE TO DPG52-LK-DATE-INPUT             07540001
075500             PERFORM 3100-CALL-CALENDAR-ROUTINE                   07550001
075600             IF (DPG54-DATE-INVALID) OR                           07560001
075700                (DPG54-SEVERE-ERROR)                              07570001
075800                 SET  PS-ERROR                                    07580001
075900                      DP020-MSG-FATAL        TO TRUE              07590001
076000*        ---- BAD DATE  ----                                      07600001
076100                 MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  07610001
076200                 MOVE DP015-UNP-NUM-BRT-OFF  TO AENDDTDA          07620001
076300                                                AENDDTMA          07630001
076400                                                AENDDTYA          07640001
076500                 MOVE DP015-RED              TO AENDDTDC          07650001
076600                                                AENDDTMC          07660001
076700                                                AENDDTYC          07670001
076800                 MOVE DP015-REVERSE          TO AENDDTDH          07680001
076900                                                AENDDTMH          07690001
077000                                                AENDDTYH          07700001
077100                 MOVE -1                     TO AENDDTML          07710001
077200                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07720001
077300             END-IF                                               07730001
077400         END-IF                                                   07740001
077500     END-IF.                                                      07750001
077600                                                                  07760001
077700     IF  PS-NO-ERROR                                              07770001
077800         IF (ASC-BEGIN-DATE NOT = SPACES) AND                     07780001
077900            (ASC-END-DATE  NOT = SPACES) AND                      07790001
078000            (ASC-END-DATE <  ASC-BEGIN-DATE)                      07800001
078100                 SET  PS-ERROR                                    07810001
078200                      DP020-MSG-FATAL        TO TRUE              07820001
078300*        ---- END DATE BEFORE THAN BEGIN DATE ----                07830001
078400                 MOVE PC-TSYMSG-00240        TO DP020-MSG-NUMBER  07840001
078500                 MOVE DP015-UNP-NUM-BRT-OFF  TO AENDDTDA          07850001
078600                                                AENDDTMA          07860001
078700                                                AENDDTYA          07870001
078800                 MOVE DP015-RED              TO AENDDTDC          07880001
078900                                                AENDDTMC          07890001
079000                                                AENDDTYC          07900001
079100                 MOVE DP015-REVERSE          TO AENDDTDH          07910001
079200                                                AENDDTMH          07920001
079300                                                AENDDTYH          07930001
079400                 MOVE -1                     TO AENDDTML          07940001
079500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07950001
079600         END-IF                                                   07960001
079700     END-IF.                                                      07970001
079800                                                                  07980001
079900     IF PS-NO-ERROR                                               07990001
080000         IF ((ASC-BEGIN-DATE = SPACES) AND                        08000001
080100            (ASC-END-DATE  NOT = SPACES))                         08010001
080200                 SET  PS-ERROR                                    08020001
080300                      DP020-MSG-FATAL        TO TRUE              08030001
080400*        ---- START DATE AND END DATE REQUIRED ---                08040001
080500                 MOVE PC-TSYMSG-00315        TO DP020-MSG-NUMBER  08050001
080600                 MOVE DP015-UNP-NUM-BRT-OFF  TO ABEGDTDA          08060001
080700                                                ABEGDTMA          08070001
080800                                                ABEGDTYA          08080001
080900                 MOVE DP015-RED              TO ABEGDTDC          08090001
081000                                                ABEGDTMC          08100001
081100                                                ABEGDTYC          08110001
081200                 MOVE DP015-REVERSE          TO ABEGDTDH          08120001
081300                                                ABEGDTMH          08130001
081400                                                ABEGDTYH          08140001
081500                 MOVE -1                     TO ABEGDTML          08150001
081600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08160001
081700         ELSE                                                     08170001
081800             IF ((ASC-BEGIN-DATE NOT = SPACES) AND                08180001
081900                (ASC-END-DATE  = SPACES))                         08190001
082000                 SET  PS-ERROR                                    08200001
082100                      DP020-MSG-FATAL        TO TRUE              08210001
082200*        ---- START DATE AND END DATE REQUIRED ---                08220001
082300                 MOVE PC-TSYMSG-00315        TO DP020-MSG-NUMBER  08230001
082400                 MOVE DP015-UNP-NUM-BRT-OFF  TO AENDDTDA          08240001
082500                                                AENDDTMA          08250001
082600                                                AENDDTYA          08260001
082700                 MOVE DP015-RED              TO AENDDTDC          08270001
082800                                                AENDDTMC          08280001
082900                                                AENDDTYC          08290001
083000                 MOVE DP015-REVERSE          TO AENDDTDH          08300001
083100                                                AENDDTMH          08310001
083200                                                AENDDTYH          08320001
083300                 MOVE -1                     TO AENDDTML          08330001
083400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08340001
083500             END-IF                                               08350001
083600         END-IF                                                   08360001
083700     END-IF.                                                      08370001
083800                                                                  08380001
083900     IF PS-NO-ERROR                                               08390001
084000         IF ASC-CONTROL-NUM-X NOT = SPACES                        08400001
084100             IF ASC-NUM-XMITS-X = SPACES AND                      08410001
084200                ASC-TRAN-SET    = SPACES AND                      08420001
084300                ASC-BEGIN-DATE  = SPACES AND                      08430001
084400                ASC-END-DATE  = SPACES                            08440001
084500                 CONTINUE                                         08450001
084600             ELSE                                                 08460001
084700*     --- CONTROL NUM MUST BE ALONE (BAD COMBINATION OF FIELDS) --08470001
084800                 SET  PS-ERROR                                    08480001
084900                      DP020-MSG-FATAL        TO TRUE              08490001
085000                 MOVE PC-TSYMSG-00831        TO DP020-MSG-NUMBER  08500001
085100                 MOVE DP015-UNP-NUM-BRT-OFF  TO AINTCNTA          08510001
085200                 MOVE DP015-RED              TO AINTCNTC          08520001
085300                 MOVE DP015-REVERSE          TO AINTCNTH          08530001
085400                 MOVE -1                     TO AINTCNTL          08540001
085500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08550001
085600             END-IF                                               08560001
085700         ELSE                                                     08570001
085800             IF ASC-NUM-XMITS-X NOT = SPACES                      08580001
085900                 IF ASC-BEGIN-DATE  = SPACES AND                  08590001
086000                    ASC-END-DATE  = SPACES                        08600001
086100                     CONTINUE                                     08610001
086200                 ELSE                                             08620001
086300*        -- NUMBER OF XMITS AND BEGIN DATE/END DATE (BAD COMBO)-- 08630001
086400                     SET  PS-ERROR                                08640001
086500                          DP020-MSG-FATAL        TO TRUE          08650001
086600                     MOVE PC-TSYMSG-00831      TO DP020-MSG-NUMBER08660001
086700                     MOVE DP015-UNP-NUM-BRT-OFF  TO ANUMTRNA      08670001
086800                     MOVE DP015-RED              TO ANUMTRNC      08680001
086900                     MOVE DP015-REVERSE          TO ANUMTRNH      08690001
087000                     MOVE -1                     TO ANUMTRNL      08700001
087100                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          08710001
087200                 END-IF                                           08720001
087300             ELSE                                                 08730001
087400                 IF ASC-TRAN-SET NOT = SPACES AND                 08740001
087500                    ASC-BEGIN-DATE  = SPACES  AND                 08750001
087600                    ASC-END-DATE  = SPACES                        08760001
087700*        ---- ONLY TRANSACTION SET WAS ENTERED (INVALID COMBO) -- 08770001
087800                     SET  PS-ERROR                                08780001
087900                          DP020-MSG-FATAL        TO TRUE          08790001
088000                     MOVE PC-TSYMSG-00831      TO DP020-MSG-NUMBER08800001
088100                     MOVE DP015-UNP-NUM-BRT-OFF  TO ATSETA        08810001
088200                     MOVE DP015-RED              TO ATSETC        08820001
088300                     MOVE DP015-REVERSE          TO ATSETH        08830001
088400                     MOVE -1                     TO ATSETL        08840001
088500                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          08850001
088600                 END-IF                                           08860001
088700             END-IF                                               08870001
088800         END-IF                                                   08880001
088900     END-IF.                                                      08890001
089000                                                                  08900001
089100     IF  PS-NO-ERROR                                              08910001
089200         MOVE -1                      TO AINTCNTL                 08920001
089300         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     08930001
089400     END-IF.                                                      08940001
089500                                                                  08950001
089600******************************************************************08960001
089700** CALL THE CALENDAR ROUTINE.                                     08970001
089800******************************************************************08980001
089900                                                                  08990001
090000 3100-CALL-CALENDAR-ROUTINE.                                      09000001
090100                                                                  09010001
090200     CALL PC-CALENDAR-ROUTINE USING DPG51                         09020001
090300                                    DPG52                         09030001
090400                                    DPG53                         09040001
090500                                    DPG54                         09050001
090600                                    DPG55                         09060001
090700                                    DPG56.                        09070001
090800                                                                  09080001
090900******************************************************************09090001
091000**  MAKE ALL FIELDS UNPROTECTED, UNDERLINED, AND GREEN.           09100001
091100******************************************************************09110001
091200 3200-RESET-ATTRIBUTES.                                           09120001
091300                                                                  09130001
091400     MOVE DP015-UNP-NUM-NOR-OFF  TO AINTCNTA                      09140001
091500                                    ANUMTRNA                      09150001
091600                                    ATSETA                        09160001
091700                                    ABEGDTDA                      09170001
091800                                    ABEGDTMA                      09180001
091900                                    ABEGDTYA                      09190001
092000                                    AENDDTDA                      09200001
092100                                    AENDDTMA                      09210001
092200                                    AENDDTYA.                     09220001
092300     MOVE DP015-UNP-ALP-NOR-OFF  TO ADIRA                         09230001
092400                                    AERRINDA.                     09240001
092500     MOVE DP015-GREEN            TO AINTCNTC                      09250001
092600                                    ADIRC                         09260001
092700                                    AERRINDC                      09270001
092800                                    ANUMTRNC                      09280001
092900                                    ATSETC                        09290001
093000                                    ABEGDTDC                      09300001
093100                                    ABEGDTMC                      09310001
093200                                    ABEGDTYC                      09320001
093300                                    AENDDTDC                      09330001
093400                                    AENDDTMC                      09340001
093500                                    AENDDTYC.                     09350001
093600     MOVE DP015-UNDERLINE        TO AINTCNTH                      09360001
093700                                    ADIRH                         09370001
093800                                    AERRINDH                      09380001
093900                                    ANUMTRNH                      09390001
094000                                    ATSETH                        09400001
094100                                    ABEGDTDH                      09410001
094200                                    ABEGDTMH                      09420001
094300                                    ABEGDTYH                      09430001
094400                                    AENDDTDH                      09440001
094500                                    AENDDTMH                      09450001
094600                                    AENDDTYH.                     09460001
094700                                                                  09470001
094800******************************************************************09480001
094900*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *09490001
095000*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *09500001
095100*  IT HERE.                                                      *09510001
095200******************************************************************09520001
095300                                                                  09530001
095400 4000-BUILD-INITIAL-PANEL.                                        09540001
095500                                                                  09550001
095600     MOVE -1                     TO AINTCNTL.                     09560001
095700     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         09570001
095800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09580001
095900                                                                  09590001
096000******************************************************************09600001
096100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *09610001
096200******************************************************************09620001
096300 4400-MOVE-COMMAREA-TO-SCREEN.                                    09630001
096400                                                                  09640001
096500     MOVE ASC-VENDOR-NAME        TO  AVENDNMO.                    09650001
096600     MOVE ASC-CONTROL-NUM-X      TO  AINTCNTO.                    09660001
096700     MOVE ASC-DIRECTION-IND      TO  ADIRO.                       09670001
096800     MOVE ASC-ERROR-IND          TO  AERRINDO.                    09680001
096900     MOVE ASC-NUM-XMITS-X        TO  ANUMTRNO.                    09690001
097000     MOVE ASC-TRAN-SET           TO  ATSETO.                      09700001
097100     MOVE ASC-BEGIN-DATE-YYYY    TO  ABEGDTYO.                    09710001
097200     MOVE ASC-BEGIN-DATE-MM      TO  ABEGDTMO.                    09720001
097300     MOVE ASC-BEGIN-DATE-DD      TO  ABEGDTDO.                    09730001
097400     MOVE ASC-END-DATE-YYYY      TO  AENDDTYO.                    09740001
097500     MOVE ASC-END-DATE-MM        TO  AENDDTMO.                    09750001
097600     MOVE ASC-END-DATE-DD        TO  AENDDTDO.                    09760001
097700                                                                  09770001
097800 EJECT                                                            09780001
097900******************************************************************09790001
098000* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *09800001
098100******************************************************************09810001
098200                                                                  09820001
098300 9100-READ-SEL-QUEUE.                                             09830001
098400     EXEC CICS                                                    09840001
098500         READQ TS                                                 09850001
098600             QUEUE (ASC-SEL-QUEUE-NAME)                           09860001
098700             INTO  (ET301-SELECTED-VNDRS)                         09870001
098800             ITEM  (ASC-SEL-ITEM)                                 09880001
098900             RESP  (PV-CICS-RESP)                                 09890001
099000     END-EXEC.                                                    09900001
099100                                                                  09910001
099200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       09920001
099300         CONTINUE                                                 09930001
099400     ELSE                                                         09940001
099500         SET DP013-LOGIC-ABEND                                    09950001
099600             DP013-NO-ROLLBACK     TO TRUE                        09960001
099700         MOVE '9100-READ-SEL-QUEUE'                               09970001
099800                                   TO DP013-PARAGRAPH             09980001
099900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   09990001
100000                                   TO DP013-MESSAGE-TEXT (1)      10000001
100100         PERFORM DP013-0000-PROCESS-ABEND                         10010001
100200     END-IF.                                                      10020001
100300*                                                                 10030001
100400******************************************************************10040001
100500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *10050001
100600******************************************************************10060001
100700 9200-REWRITE-SEL-QUEUE.                                          10070001
100800     EXEC CICS                                                    10080001
100900          WRITEQ TS                                               10090001
101000              QUEUE  (ASC-SEL-QUEUE-NAME)                         10100001
101100              FROM   (ET301-SELECTED-VNDRS)                       10110001
101200              ITEM   (ASC-SEL-ITEM)                               10120001
101300              RESP   (PV-CICS-RESP)                               10130001
101400              REWRITE                                             10140001
101500     END-EXEC.                                                    10150001
101600                                                                  10160001
101700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   10170001
101800         SET DP013-CICS-ABEND                                     10180001
101900             DP013-NO-ROLLBACK     TO TRUE                        10190001
102000         MOVE '9200-REWRITE-SEL-QUEUE'                            10200001
102100                                   TO DP013-PARAGRAPH             10210001
102200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   10220001
102300                                   TO DP013-MESSAGE-TEXT (1)      10230001
102400         PERFORM DP013-0000-PROCESS-ABEND                         10240001
102500     END-IF.                                                      10250001
102600                                                                  10260001
102700******************************************************************10270001
102800*    CURRENT SYSTEM DATE/TIME MODULE                              10280001
102900******************************************************************10290001
103000                                                                  10300001
103100     COPY DPPD017.                                                10310001
103200                                                                  10320001
103300******************************************************************10330001
103400*    ABEND PROCESSOR MODULE                                      *10340001
103500******************************************************************10350001
103600                                                                  10360001
103700     COPY DPPD013.                                                10370001
