000200 IDENTIFICATION DIVISION.                                         00020000
000220                                                                  00022051
000400 PROGRAM-ID.   TRKUP411.                                          00040074
000500 AUTHOR.       TKMA479.                                           00050074
000600 INSTALLATION. KOHLS DEPARTMENT STORES.                           00060000
000700 DATE-WRITTEN. AUGUST 2009.                                       00070099
000800 DATE-COMPILED.                                                   00080000
000810                                                                  00081051
000820                                                                  00082051
000900* --------------------------------------------------------------  00090075
001000* PURGE OF TRT_IMPRT_CART CREATING A TAPE FILE                    00100099
001710* --------------------------------------------------------------  00171075
001720                                                                  00172074
002000 ENVIRONMENT DIVISION.                                            00200000
002020                                                                  00202051
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002610                                                                  00261058
002700 INPUT-OUTPUT SECTION.                                            00270000
002710                                                                  00271051
002800 FILE-CONTROL.                                                    00280000
002810                                                                  00281051
003200     SELECT PURGE-OUTPUT-FILE  ASSIGN TO OUT01.                   00320074
003300                                                                  00330074
004800 DATA DIVISION.                                                   00480000
004820                                                                  00482051
005000 FILE SECTION.                                                    00500000
005810                                                                  00581051
005900 FD  PURGE-OUTPUT-FILE                                            00590074
006000     RECORDING MODE IS F                                          00600000
006100     LABEL RECORDS ARE STANDARD                                   00610000
006200     RECORD CONTAINS 146 CHARACTERS                               00620099
006300     BLOCK CONTAINS 0 CHARACTERS.                                 00630062
006310                                                                  00631051
006400 01  PURGE-DETAIL-REC          PIC  X(146).                       00640099
006500                                                                  00650000
010000 WORKING-STORAGE SECTION.                                         01000000
010207                                                                  01020751
010230 01  PC-PROGRAM-CONSTANTS.                                        01023000
010300     05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'TRKUP411'.     01030074
010400     05  PC-MAX-RETRIES          PIC S9(03) VALUE +5 COMP-3.      01040053
010900                                                                  01090000
011000 01  PS-PROGRAM-SWITCHES.                                         01100000
011010                                                                  01101051
011100     05  PS-END-OF-CART-CSR-SW     PIC  X(01) VALUE 'N'.          01110088
011200         88  PS-END-OF-CART-CSR-YES           VALUE 'Y'.          01120088
011300         88  PS-END-OF-CART-CSR-NO            VALUE 'N'.          01130088
011310                                                                  01131051
016300 01  DK-CONTROL-KEY.                                              01630013
016400     05  DK-CNTL-DATE.                                            01640056
016401         10  DK-CNTL-DATE-MO     PIC  9(02).                      01640158
016420         10  FILLER              PIC  X(01).                      01642056
016440         10  DK-CNTL-DATE-DY     PIC  9(02).                      01644058
016441         10  FILLER              PIC  X(01).                      01644156
016450         10  DK-CNTL-DATE-CCYY   PIC  9(04).                      01645056
016500     05  FILLER                  PIC  X(01).                      01650053
016510     05  DK-CNTL-IND             PIC  X(01).                      01651053
016511         88  DK-CNTL-PURGE-YES              VALUE 'Y'.            01651153
016512         88  DK-CNTL-PURGE-NO               VALUE 'N'.            01651253
016520     05  FILLER                  PIC  X(68).                      01652056
016600                                                                  01660013
018600 01  PV-ABEND-FIELDS.                                             01860000
018700     05  PV-ABEND-CODE           PIC S9(04) VALUE +0 COMP.        01870053
018900     05  PV-ABEND-PROGRAM        PIC  X(08) VALUE 'TRKUP411'.     01890099
019000     05  PV-ABEND-PARAGRAPH      PIC  X(25) VALUE SPACES.         01900053
019100     05  PV-ABEND-MESSAGE        PIC  X(50) VALUE SPACES.         01910056
019200     05  PV-ABEND-OPERATION      PIC  X(20) VALUE SPACES.         01920056
019500     05  PV-DB2-OPER-MSG-1       PIC  X(79) VALUE SPACES.         01950061
019600     05  PV-DB2-OPER-MSG-2       PIC  X(79) VALUE SPACES.         01960061
019700                                                                  01970000
019720 01  PV-INPUT-TMST.                                               01972058
019740     05  PV-CNTL-TMST-CCYY       PIC  9(04).                      01974058
019760     05  FILLER                  PIC  X(01) VALUE '-'.            01976058
019770     05  PV-CNTL-TMST-MO         PIC  9(02).                      01977058
019780     05  FILLER                  PIC  X(01) VALUE '-'.            01978058
019790     05  PV-CNTL-TMST-DY         PIC  9(02).                      01979058
019791     05  FILLER                  PIC  X(01) VALUE '-'.            01979158
019793     05  PV-CNTL-TMST-HH         PIC  X(02) VALUE '00'.           01979394
019794     05  FILLER                  PIC  X(01) VALUE '.'.            01979458
019795     05  PV-CNTL-TMST-MM         PIC  X(02) VALUE '00'.           01979594
019796     05  FILLER                  PIC  X(01) VALUE '.'.            01979658
019797     05  PV-CNTL-TMST-SS         PIC  X(02) VALUE '00'.           01979794
019798     05  FILLER                  PIC  X(01) VALUE '.'.            01979858
019799     05  PV-CNTL-TMST-LAST6      PIC  X(06) VALUE '000000'.       01979994
019801                                                                  01980158
019802 01  PV-INPUT-CNTL-TMST          REDEFINES                        01980258
019803     PV-INPUT-TMST               PIC  X(26).                      01980358
019804                                                                  01980483
019805 01  WS-CURRENT-TMST             PIC  X(26).                      01980583
019806                                                                  01980683
019810                                                                  01981058
019900 01  PV-PROGRAM-VARIABLES.                                        01990056
020000     05  PV-DISPLAY-CART-INP     PIC  ZZZ,ZZZ,ZZ9.                02000092
031320     05  PV-DISPLAY-CART-WRT     PIC  ZZZ,ZZZ,ZZ9.                03132092
031410     05  PV-DISPLAY-CART-DEL     PIC  ZZZ,ZZZ,ZZ9.                03141092
031500     05  PV-DISPLAY-COMMITS      PIC  ZZZ,ZZZ,ZZ9.                03150053
031510     05  PV-DISPLAY-SQLCODE      PIC  -------999.                 03151053
031600     05  PV-RETRY-COUNTER        PIC S9(04) VALUE +0 COMP.        03160053
031700     05  PV-SQLCODE              PIC S9(09).                      03170053
031710     05  PV-ROW-LIMIT            PIC 9(09).                       03171099
031720     05  PV-COMMIT-LIMIT         PIC 9(09).                       03172099
031800                                                                  03180000
035100 01  PA-PROGRAM-ACCUMULATORS.                                     03510000
035200     05  PA-CART-INPUT-COUNT       PIC S9(09) VALUE +0 COMP-3.    03520090
035210     05  PA-CART-WRITE-COUNT       PIC S9(09) VALUE +0 COMP-3.    03521090
035310     05  PA-CART-DELETE-COUNT      PIC S9(09) VALUE +0 COMP-3.    03531090
035410     05  PA-TOT-COMMIT-COUNT     PIC S9(09) VALUE +0 COMP-3.      03541053
035411     05  PA-COMMIT-COUNT         PIC S9(09) VALUE +0 COMP-3.      03541171
035412                                                                  03541260
035413                                                                  03541360
035414* -------------------------------------------------------------- *03541460
035415*    WORKING STORGAGE HOLD AREA FOR WFLDCN & WFLDTR FILES         03541560
035416* -------------------------------------------------------------- *03541660
035417                                                                  03541760
035418 01  WS-WFLDCN-RECORD.                                            03541860
035419     05  WS-WFLDCN-DATA          PIC  X(130).                     03541960
035420                                                                  03542060
035440* -------------------------------------------------------------- *03544051
035600*    WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                   03560051
035610* -------------------------------------------------------------- *03561051
035620                                                                  03562051
035800     COPY DPWS004.                                                03580022
036100                                                                  03610000
036110                                                                  03611051
036200* --------------------------------------------------------------  03620075
078000*    COMMUNICATIONS AREA FOR DB2                                  07800051
078010* --------------------------------------------------------------  07801075
078020                                                                  07802051
078200     EXEC SQL                                                     07820000
078300          INCLUDE SQLCA                                           07830000
078400     END-EXEC.                                                    07840000
078600                                                                  07860051
078700* --------------------------------------------------------------  07870075
079500*    DB2 TABLE DECLARATION - TRT00008                             07950075
079600*      TABLE (TRT_IMPRT_CART)                                     07960075
079610* --------------------------------------------------------------  07961075
079620                                                                  07962051
079800     EXEC SQL                                                     07980000
079900          INCLUDE TRT00008                                        07990075
080000     END-EXEC.                                                    08000000
080010                                                                  08001099
080020* --------------------------------------------------------------  08002099
080030*    DB2 TABLE DECLARATION - WST00010                             08003099
080040*      TABLE (WST_ATTR_ELEM)                                      08004099
080050* --------------------------------------------------------------  08005099
080060                                                                  08006099
080070     EXEC SQL                                                     08007099
080080          INCLUDE WST00010                                        08008099
080090     END-EXEC.                                                    08009099
080100                                                                  08010000
081000* --------------------------------------------------------------  08100075
089900*    COBOL CURSOR DELCARATION TO READ TRT_IMPRT_CART              08990075
089910* --------------------------------------------------------------  08991075
089920                                                                  08992051
090100     EXEC SQL                                                     09010000
090110                                                                  09011051
090200       DECLARE CART-CSR CURSOR WITH HOLD FOR                      09020099
090210                                                                  09021051
090300           SELECT CONTNR_ID                                       09030075
090400                 ,CONTNR_SEQ_NBR                                  09040075
090500                 ,PO_NBR                                          09050075
090600                 ,UPC_NBR                                         09060075
090700                 ,SSCC_ID                                         09070075
090800                 ,CRE_BY_USR_ID                                   09080075
090900                 ,CRE_TMST                                        09090075
091000                 ,UNT_QTY                                         09100075
091100                 ,LAST_UPD_BY_USR_ID                              09110075
091200                 ,LAST_UPD_TMST                                   09120075
091300           FROM TRT_IMPRT_CART                                    09130075
091500           WHERE CRE_TMST < :PV-INPUT-CNTL-TMST                   09150084
091600                                                                  09160051
091800     END-EXEC.                                                    09180000
095000                                                                  09500051
098900 PROCEDURE DIVISION.                                              09890000
098920                                                                  09892051
099100 0001-PROGRAM-MAINLINE.                                           09910053
099110                                                                  09911051
099310* ------------------------------------------------------ *        09931051
099400*    INITIALIZATION.                                              09940051
099402* ------------------------------------------------------ *        09940251
099410                                                                  09941051
099500     PERFORM 1000-INITIALIZE.                                     09950000
100010                                                                  10001051
100100     PERFORM 3000-RETRIEVE-CARTONS.                               10010077
100200                                                                  10020000
100300     PERFORM 9000-EOJ-ROUTINE.                                    10030000
100800                                                                  10080000
100900     DISPLAY '****  END OF TRKUP411  ****'.                       10090077
101000                                                                  10100000
101100     STOP RUN.                                                    10110000
101200                                                                  10120000
101210                                                                  10121051
101300* ------------------------------------------------------ *        10130054
101410* ------------------------------------------------------ *        10141054
101420                                                                  10142051
101600 1000-INITIALIZE.                                                 10160000
101700                                                                  10170000
101801     INITIALIZE WS-CURRENT-TMST.                                  10180183
101802                                                                  10180299
101803     PERFORM 7000-GET-COMMIT-LIMIT.                               10180399
101804     PERFORM 8000-GET-ROW-LIMIT.                                  10180499
101823                                                                  10182393
101844     EXEC SQL                                                     10184499
101845         SELECT (CURRENT TIMESTAMP - 2 YEARS)                     10184599
101846           INTO :WS-CURRENT-TMST                                  10184699
101847           FROM SYSIBM.SYSDUMMY1                                  10184799
101848     END-EXEC.                                                    10184899
101849                                                                  10184983
101850     EVALUATE TRUE                                                10185099
101851       WHEN SQLCODE = +0                                          10185199
101852          DISPLAY '** PROCESSING DEFAULT PATH **'                 10185299
101853          DISPLAY 'CURRENT TIMESTAMP (MINUS 2 YEARS) => '         10185399
101854                                           WS-CURRENT-TMST        10185499
101855       WHEN OTHER                                                 10185599
101856           MOVE 'INIT'                 TO PV-ABEND-PARAGRAPH      10185699
101857           MOVE 'GET CURRENT TMST'      TO PV-ABEND-OPERATION     10185799
101858           PERFORM 9900-DB2-ABEND                                 10185899
101859     END-EVALUATE.                                                10185999
101861                                                                  10186156
101863     MOVE WS-CURRENT-TMST(1:4) TO PV-CNTL-TMST-CCYY               10186399
101864     MOVE WS-CURRENT-TMST(6:2) TO PV-CNTL-TMST-MO                 10186499
101865     MOVE WS-CURRENT-TMST(9:2) TO PV-CNTL-TMST-DY                 10186599
101893                                                                  10189363
101894     DISPLAY '**** START OF TRKUP411 ****'.                       10189493
101897     DISPLAY '*                                        '.         10189793
101898     DISPLAY '* PURGE CUTOFF DATE    : ' PV-INPUT-TMST.           10189893
101899     DISPLAY '* PURGE ROW LIMIT      : ' PV-ROW-LIMIT.            10189999
101900                                                                  10190093
101910     OPEN OUTPUT PURGE-OUTPUT-FILE.                               10191076
102600                                                                  10260000
176920                                                                  17692051
177100 3000-RETRIEVE-CARTONS.                                           17710076
177101                                                                  17710167
177400     PERFORM 3100-OPEN-CART-CURSOR.                               17740076
177620                                                                  17762051
177700     PERFORM 3200-FETCH-CART-CURSOR.                              17770076
177920                                                                  17792051
178000     IF PS-END-OF-CART-CSR-YES                                    17800076
178100        DISPLAY ' '                                               17810000
178200        DISPLAY '**************************************'          17820000
178300        DISPLAY '**     NO CARTONS AVAILABLE TO'                  17830085
178400        DISPLAY '**     PURGE ON TRT_IMPRT_CART'                  17840085
178500        DISPLAY '**************************************'          17850000
178600        DISPLAY ' '                                               17860000
178700        PERFORM 3700-CLOSE-CART-CURSOR                            17870076
178800        STOP RUN                                                  17880000
178900     END-IF.                                                      17890000
179120                                                                  17912051
179200     PERFORM                                                      17920000
179300       UNTIL PS-END-OF-CART-CSR-YES                               17930076
179400                                                                  17940000
180300         PERFORM 3500-WRITE-CART-RECORD                           18030076
180400         PERFORM 5210-DELETE-CART-ROW                             18040098
180500         IF PS-END-OF-CART-CSR-NO                                 18050099
181200            PERFORM 3200-FETCH-CART-CURSOR                        18120099
181300         END-IF                                                   18130099
181400                                                                  18140000
181500     END-PERFORM.                                                 18150000
181720                                                                  18172051
181800     PERFORM 3700-CLOSE-CART-CURSOR.                              18180076
182050                                                                  18205051
182100 3100-OPEN-CART-CURSOR.                                           18210076
182200                                                                  18220000
182300     EXEC SQL                                                     18230000
182400         OPEN CART-CSR                                            18240076
182500     END-EXEC.                                                    18250000
182600                                                                  18260000
182700     EVALUATE TRUE                                                18270000
182710                                                                  18271051
182800       WHEN SQLCODE = +0                                          18280052
182900           SET PS-END-OF-CART-CSR-NO TO TRUE                      18290076
183000                                                                  18300000
183100       WHEN OTHER                                                 18310000
183300           MOVE '3100-OPEN-CART-CURSOR' TO PV-ABEND-PARAGRAPH     18330076
183400           MOVE 'OPEN CART-CSR'         TO PV-ABEND-OPERATION     18340076
183500           PERFORM 9900-DB2-ABEND                                 18350000
183510                                                                  18351051
183600     END-EVALUATE.                                                18360000
183700                                                                  18370000
183710                                                                  18371051
183900 3200-FETCH-CART-CURSOR.                                          18390076
184000                                                                  18400000
184010     INITIALIZE DCLTRT00008.                                      18401099
184020                                                                  18402099
184100     EXEC SQL                                                     18410000
184110                                                                  18411051
184200         FETCH CART-CSR                                           18420076
184210                                                                  18421051
184300          INTO :TRT00008-CONTNR-ID                                18430076
184400             , :TRT00008-CONTNR-SEQ-NBR                           18440076
184500             , :TRT00008-PO-NBR                                   18450076
184510             , :TRT00008-UPC-NBR                                  18451076
184520             , :TRT00008-SSCC-ID                                  18452076
184530             , :TRT00008-CRE-BY-USR-ID                            18453076
184540             , :TRT00008-CRE-TMST                                 18454076
184550             , :TRT00008-UNT-QTY                                  18455076
184560             , :TRT00008-LAST-UPD-BY-USR-ID                       18456076
184570             , :TRT00008-LAST-UPD-TMST                            18457076
184590                                                                  18459051
184600     END-EXEC.                                                    18460000
184700                                                                  18470000
184800     EVALUATE TRUE                                                18480000
184810                                                                  18481051
184900       WHEN SQLCODE = +0                                          18490052
185000          ADD 1 TO PA-CART-INPUT-COUNT                            18500095
186000       WHEN SQLCODE = +100                                        18600000
186100           SET PS-END-OF-CART-CSR-YES TO TRUE                     18610076
186300       WHEN OTHER                                                 18630000
186500           MOVE '3200-FETCH-CART-CURSOR' TO PV-ABEND-PARAGRAPH    18650076
186600           MOVE 'FETCH CART-CSR'         TO PV-ABEND-OPERATION    18660076
186700           PERFORM 9900-DB2-ABEND                                 18670000
186710                                                                  18671051
186800     END-EVALUATE.                                                18680000
186900                                                                  18690000
186910                                                                  18691051
187100 3500-WRITE-CART-RECORD.                                          18710080
187310                                                                  18731051
187500     WRITE PURGE-DETAIL-REC FROM DCLTRT00008.                     18750099
187510                                                                  18751051
187600     ADD +1 TO PA-CART-WRITE-COUNT.                               18760080
187700                                                                  18770000
187800                                                                  18780051
196800 3700-CLOSE-CART-CURSOR.                                          19680076
196900                                                                  19690000
197000     EXEC SQL                                                     19700000
197100         CLOSE CART-CSR                                           19710076
197200     END-EXEC.                                                    19720000
197300                                                                  19730000
197400     EVALUATE TRUE                                                19740000
197410                                                                  19741051
197500       WHEN SQLCODE = +0                                          19750052
197600           CONTINUE                                               19760000
197700                                                                  19770000
197800       WHEN OTHER                                                 19780000
198000           MOVE '3700-CLOSE-CART-CURSOR' TO PV-ABEND-PARAGRAPH    19800076
198100           MOVE 'CLOSE CART-CSR'         TO PV-ABEND-OPERATION    19810076
198200           PERFORM 9900-DB2-ABEND                                 19820000
198210                                                                  19821051
198300     END-EVALUATE.                                                19830000
198400                                                                  19840000
198410                                                                  19841051
198600 3800-COMMIT.                                                     19860000
198700                                                                  19870000
198800     EXEC SQL                                                     19880099
198900         COMMIT                                                   19890099
199000     END-EXEC.                                                    19900099
199100                                                                  19910099
199200     EVALUATE TRUE                                                19920000
199300       WHEN SQLCODE = +0                                          19930052
199310           ADD +1 TO PA-TOT-COMMIT-COUNT                          19931036
199500           DISPLAY '** COMMIT **'                                 19950094
199600       WHEN OTHER                                                 19960000
199700           MOVE '3800-COMMIT'              TO PV-ABEND-PARAGRAPH  19970051
199800           MOVE 'COMMIT TRT_IMPRT_CART' TO PV-ABEND-OPERATION     19980080
199900           PERFORM 9900-DB2-ABEND                                 19990000
200000     END-EVALUATE.                                                20000000
200110                                                                  20011051
213078 5210-DELETE-CART-ROW.                                            21307876
213079                                                                  21307951
213080     INITIALIZE PV-RETRY-COUNTER.                                 21308051
213081                                                                  21308151
213082     PERFORM WITH TEST AFTER                                      21308251
213083       UNTIL SQLCODE = +0 OR +100                                 21308352
213084         OR PV-RETRY-COUNTER > PC-MAX-RETRIES                     21308451
213085                                                                  21308551
213086         EXEC SQL                                                 21308699
213087            DELETE FROM TRT_IMPRT_CART                            21308799
213088            WHERE CURRENT OF CART-CSR                             21308899
213089         END-EXEC                                                 21308999
213090                                                                  21309099
213091         EVALUATE TRUE                                            21309151
213093            WHEN SQLCODE = +0                                     21309352
213096                ADD 1 TO  PA-COMMIT-COUNT                         21309694
213098                ADD 1 TO PA-CART-DELETE-COUNT                     21309898
213099                IF PA-COMMIT-COUNT > PV-COMMIT-LIMIT              21309999
213100                    PERFORM 3800-COMMIT                           21310098
213101                    MOVE +0 TO PA-COMMIT-COUNT                    21310198
213102                END-IF                                            21310298
213103                IF PA-CART-DELETE-COUNT >= PV-ROW-LIMIT AND       21310399
213104                   PV-ROW-LIMIT > 0                               21310499
213105                   SET PS-END-OF-CART-CSR-YES TO TRUE             21310599
213106                   PERFORM 3800-COMMIT                            21310699
213107                   MOVE +0 TO PA-COMMIT-COUNT                     21310799
213108                END-IF                                            21310899
213109            WHEN SQLCODE = -911  OR  -913                         21310951
213110                ADD +1 TO PV-RETRY-COUNTER                        21311051
213111            WHEN OTHER                                            21311151
213112                MOVE '5210-DELETE-CART-ROW' TO PV-ABEND-PARAGRAPH 21311290
213113                MOVE 'DELETE TRT_IMPRT_CART' TO PV-ABEND-OPERATION21311390
213114                MOVE DCLTRT00008             TO PV-DB2-OPER-MSG-1 21311490
213115                PERFORM 9900-DB2-ABEND                            21311551
213116                                                                  21311651
213117         END-EVALUATE                                             21311751
213118                                                                  21311851
213119     END-PERFORM.                                                 21311951
213120                                                                  21312051
213121     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21312151
213122         MOVE '5210-DELETE-CART-ROW'  TO PV-ABEND-PARAGRAPH       21312290
213123         MOVE 'DELETE TRT_IMPRT_CART' TO PV-ABEND-OPERATION       21312390
213124         MOVE DCLTRT00008             TO PV-DB2-OPER-MSG-1        21312490
213125         PERFORM 9900-DB2-ABEND                                   21312551
213126     END-IF.                                                      21312651
213127                                                                  21312751
213128******************************************************************21312899
213129 7000-GET-COMMIT-LIMIT.                                           21312999
213130                                                                  21313099
213131*  BRINGS BACK COMMIT LIMIT FROM PARM TABLE                       21313199
213132                                                                  21313299
213140     EXEC SQL                                                     21314099
213150         SELECT ATTR_ELEM_NBR                                     21315099
213180         INTO  :WST00010-ATTR-ELEM-NBR                            21318099
213300         FROM WST_ATTR_ELEM                                       21330099
213611         WHERE INTGRTN_TYP_CDE = 'TRCARTCNTL'                     21361199
213612           AND ATTR_DEFN_SEQ_NBR = 2                              21361299
213623     END-EXEC.                                                    21362399
213624                                                                  21362499
213626     EVALUATE TRUE                                                21362699
213627         WHEN SQLCODE = ZERO                                      21362799
213628            MOVE WST00010-ATTR-ELEM-NBR TO PV-COMMIT-LIMIT        21362899
213629            DISPLAY '*** COMMIT LIMIT ***'                        21362999
213630            DISPLAY 'COMMIT LIMT = ' PV-COMMIT-LIMIT              21363099
213631            DISPLAY ' '                                           21363199
213632         WHEN OTHER                                               21363299
213633             MOVE '7000-GET-COMMIT-LIMIT'  TO PV-ABEND-PARAGRAPH  21363399
213634             DISPLAY 'MAX COMMIT LIMIT ' PV-COMMIT-LIMIT          21363499
213635             PERFORM 9900-DB2-ABEND                               21363599
213636     END-EVALUATE.                                                21363699
213637******************************************************************21363799
213638 8000-GET-ROW-LIMIT.                                              21363899
213639                                                                  21363999
213640*  BRINGS BACK ROW LIMIT FROM PARM TABLE                          21364099
213641                                                                  21364199
213642     EXEC SQL                                                     21364299
213643         SELECT ATTR_ELEM_NBR                                     21364399
213644         INTO  :WST00010-ATTR-ELEM-NBR                            21364499
213645         FROM WST_ATTR_ELEM                                       21364599
213646         WHERE INTGRTN_TYP_CDE = 'TRCARTCNTL'                     21364699
213647           AND ATTR_DEFN_SEQ_NBR = 1                              21364799
213648     END-EXEC.                                                    21364899
213649                                                                  21364999
213650     EVALUATE TRUE                                                21365099
213651         WHEN SQLCODE = ZERO                                      21365199
213652            MOVE WST00010-ATTR-ELEM-NBR TO PV-ROW-LIMIT           21365299
213653            DISPLAY '*** ROW LIMIT ***'                           21365399
213654            DISPLAY 'PURGE ROW LIMT = ' PV-ROW-LIMIT              21365499
213655            DISPLAY ' '                                           21365599
213656         WHEN OTHER                                               21365699
213657             MOVE '8000-GET-ROW LIMIT'  TO PV-ABEND-PARAGRAPH     21365799
213658             DISPLAY 'MAX ROW LIMIT ' PV-ROW-LIMIT                21365899
213659             PERFORM 9900-DB2-ABEND                               21365999
213660     END-EVALUATE.                                                21366099
213670                                                                  21367099
213700                                                                  21370051
692800* -------------------------------------------------------------- *69280051
692900*    9000-EOJ-ROUTINE                                             69290051
692910* -------------------------------------------------------------- *69291051
693010                                                                  69301051
693100 9000-EOJ-ROUTINE.                                                69310000
693201                                                                  69320140
693210     IF PA-COMMIT-COUNT     > +1   AND                            69321052
693211        PA-TOT-COMMIT-COUNT = +0                                  69321152
693220         ADD +1 TO PA-TOT-COMMIT-COUNT.                           69322040
693300                                                                  69330000
693310* ---------------------------------------- *                      69331051
693400*    CLOSE  FILE.                                                 69340099
693401* ---------------------------------------- *                      69340151
693402                                                                  69340251
693500     CLOSE PURGE-OUTPUT-FILE.                                     69350099
694200                                                                  69420000
694210* ---------------------------------------- *                      69421051
694300*    DISPLAY PROGRAM EXECUTION TOTALS.                            69430051
694301* ---------------------------------------- *                      69430151
694310                                                                  69431051
694311     MOVE PA-CART-INPUT-COUNT   TO PV-DISPLAY-CART-INP.           69431180
694312     MOVE PA-CART-WRITE-COUNT   TO PV-DISPLAY-CART-WRT.           69431280
694313     MOVE PA-CART-DELETE-COUNT  TO PV-DISPLAY-CART-DEL.           69431380
694314                                                                  69431471
694319     MOVE PA-TOT-COMMIT-COUNT TO PV-DISPLAY-COMMITS.              69431971
694320                                                                  69432051
694640     DISPLAY '* ---------------------------------------'.         69464080
694700     DISPLAY '* TOTAL CART INPUT     : ' PV-DISPLAY-CART-INP      69470080
694800     DISPLAY '* TOTAL CART DELETED   : ' PV-DISPLAY-CART-DEL      69480080
694810     DISPLAY '* TOTAL CART WRITTEN   : ' PV-DISPLAY-CART-WRT      69481080
694913     DISPLAY '* ---------------------------------------'.         69491380
695312     DISPLAY '* TOTAL COMMITS TAKEN  : ' PV-DISPLAY-COMMITS       69531252
695313     DISPLAY '**---------------------------------------'.         69531380
695314     DISPLAY '                                         '.         69531480
695500                                                                  69550056
695600                                                                  69560056
695700* -------------------------------------------------------------- *69570056
695800*    CALL THE ABEND PROCESSOR IN THE EVENT THAT A GENERAL        *69580056
695900*    ABEND OCCURS.                                               *69590056
696000* -------------------------------------------------------------- *69600056
696100                                                                  69610056
696200 9800-GENERAL-ABEND.                                              69620056
696300                                                                  69630056
696400     DISPLAY PV-ABEND-PROGRAM '**********************'.           69640056
696500     DISPLAY PV-ABEND-PROGRAM ' 9800-GENERAL-ABEND   '.           69650056
696600     DISPLAY PV-ABEND-PROGRAM '** ABEND            **'.           69660056
696700     DISPLAY PV-ABEND-PROGRAM ' ' PV-ABEND-PARAGRAPH.             69670056
696800     DISPLAY PV-ABEND-PROGRAM ' ' PV-ABEND-MESSAGE.               69680056
696810     DISPLAY PV-ABEND-PROGRAM '**********************'.           69681056
696820                                                                  69682058
696830     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         69683058
696900                                                                  69690000
697000                                                                  69700051
701900* -------------------------------------------------------------- *70190052
702000*    9900-DB2-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE   70200051
702100*    EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.              70210051
702110* -------------------------------------------------------------- *70211052
702210                                                                  70221051
702300 9900-DB2-ABEND.                                                  70230000
702400                                                                  70240000
702500     MOVE SQLCODE    TO PV-SQLCODE.                               70250000
702600     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       70260000
702610                                                                  70261051
702700     DISPLAY '***------------------------------------***'.        70270058
702701     DISPLAY '***             DB2 ERROR              ***'.        70270158
702710     DISPLAY '***                                    ***'.        70271058
702800     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE.               70280000
702900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 70290000
703000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               70300000
703100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               70310000
703200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPER-MSG-1.                70320061
703300     DISPLAY '***           = ' PV-DB2-OPER-MSG-2.                70330061
703600                                                                  70360000
703610                                                                  70361051
703620* -------------------------------------------------------------- *70362052
703800*    THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION        70380052
703900*    STATEMENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND        70390052
704000*    MODULE 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A    70400052
704100*    READABLE FORMAT.                                             70410052
704110* -------------------------------------------------------------- *70411052
704210                                                                  70421051
704300     COPY DPPD004.                                                70430021
704400                                                                  70440000
704500     IF SQLCODE NOT = -911                                        70450000
704600         EXEC SQL                                                 70460000
704700             ROLLBACK                                             70470000
704800         END-EXEC                                                 70480000
704900     END-IF.                                                      70490000
705000                                                                  70500000
706200     MOVE +4013 TO PV-ABEND-CODE.                                 70620051
706210                                                                  70621051
706300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         70630000
