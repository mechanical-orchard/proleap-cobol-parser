000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.             TMKRP014.                                00030000
000400 AUTHOR.                 TAMARA KOLTUN.                           00040000
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN            09/25/96.                                00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900***************************************************               00090000
001000*  THIS PROGRAM CREATES A TRAILER STATUS REPORT.  *               00100000
001100*  TOTALS PER STATUS CHANGE                       *               00110000
001200***************************************************               00120000
001300                                                                  00130000
001400 ENVIRONMENT DIVISION.                                            00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600                                                                  00160000
001700 FILE-CONTROL.                                                    00170000
001800                                                                  00180000
001900     SELECT TROUBLE-EXTRACT-FILE      ASSIGN TO INP01.            00190000
002000     SELECT UNRESOLVED-TROUBLE-REPORT ASSIGN TO RPT01.            00200000
002100                                                                  00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 FILE SECTION.                                                    00250000
002600 FD  TROUBLE-EXTRACT-FILE                                         00260000
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     BLOCK CONTAINS 0 RECORDS.                                    00290000
003000                                                                  00300000
003100 01  TROUBLE-EXTRACT-RECORD         PIC X(400).                   00310000
003200                                                                  00320000
003300 FD  UNRESOLVED-TROUBLE-REPORT                                    00330000
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700                                                                  00370000
003800 01  UNRESOLVED-TRBLE-RECORD        PIC X(132).                   00380000
003900                                                                  00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100 01  PS-SWITCHES.                                                 00410000
004200     05  PS-EOF-SW                   PIC  X(01)    VALUE 'N'.     00420000
004300         88  PS-EOF                                VALUE 'Y'.     00430000
004400         88  PS-NOT-EOF                            VALUE 'N'.     00440000
004500     05  PS-NO-DETAILS-SW            PIC  X(01)    VALUE ' '.     00450000
004600         88  PS-NO-DETAILS                         VALUE 'N'.     00460000
004700     05  PS-FIRST-TIME-THRU-SW       PIC  X(01)    VALUE 'F'.     00470000
004800         88  PS-FIRST-TIME-THRU                    VALUE 'F'.     00480000
004900         88  PS-NOT-FIRST-TIME-THRU                VALUE 'N'.     00490000
005000     05  PS-SUPPRESS-DETAIL-HEAD-SW  PIC  X(01)    VALUE 'Y'.     00500000
005100         88  PS-SUPPRESS-DETAIL-HEAD               VALUE 'N'.     00510000
005200         88  PS-PRINT-DETAIL-HEAD                  VALUE 'Y'.     00520000
005300     05  PS-DC-CHANGED-SW            PIC  X(01)    VALUE 'C'.     00530000
005400         88  PS-DC-CHANGED                         VALUE 'C'.     00540000
005500         88  PS-DC-NOT-CHANGED                     VALUE 'N'.     00550000
005600     05  PS-PROCESS-AREA-CHANGED-SW  PIC  X(01)    VALUE 'C'.     00560000
005700         88  PS-PROCESS-AREA-CHANGED               VALUE 'C'.     00570000
005800         88  PS-PROCESS-AREA-NOT-CHANGED           VALUE 'N'.     00580000
005900     05  PS-TRBL-RSN-CDE-CHANGED-SW  PIC  X(01)    VALUE 'C'.     00590000
006000         88 PS-TRBL-RSN-CDE-CHANGED                VALUE 'C'.     00600000
006100         88 PS-TRBL-RSN-CDE-NOT-CHANGED            VALUE 'N'.     00610000
006200     05  PS-RECEIVER-CHANGED-SW      PIC  X(01)    VALUE 'C'.     00620000
006300         88 PS-RECEIVER-CHANGED                    VALUE 'C'.     00630000
006400         88 PS-RECEIVER-NOT-CHANGED                VALUE 'N'.     00640000
006500     05  PS-PO-CHANGED-SW            PIC  X(01)    VALUE 'C'.     00650000
006600         88 PS-PO-CHANGED                          VALUE 'C'.     00660000
006700         88 PS-PO-NOT-CHANGED                      VALUE 'N'.     00670000
006800     05  PS-LINE-LIMIT-REAHED-SW     PIC  X(01)    VALUE 'N'.     00680000
006900         88 PS-LINE-LIMIT-REACHED                  VALUE 'Y'.     00690000
007000         88 PS-LINE-LIMIT-NOT-REACHED              VALUE 'N'.     00700000
007100     05  PS-REPORT-SORT-CDE-SW       PIC X(01)     VALUE 'N'.     00710000
007200         88 PS-REPORT-SORT-CDE-CHANGED             VALUE 'Y'.     00720000
007300         88 PS-REPORT-SORT-CDE-NOT-CHANGED         VALUE 'N'.     00730000
007400                                                                  00740000
007500 01  PC-PROGRAM-CONSTANTS.                                        00750000
007600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00760000
007700                                    'TMKRP014'.                   00770000
007800     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60      00780000
007900                                                   COMP SYNC.     00790000
008000     05  PC-SPECIAL-RUN-NOTE         PIC X(27)     VALUE          00800000
008100                                    '** SPECIAL REQUESTED RUN **'.00810000
008200     05  PC-ONE                      PIC 9(01)     VALUE  1.      00820000
008300     05  PC-NOT-FOUND                PIC X(17)     VALUE          00830000
008400                                         '*** NOT FOUND ***'.     00840000
008500     05  PC-NOT-FND                  PIC X(06)     VALUE 'NOTFND'.00850000
008600                                                                  00860000
008700     05  PC-ENROUTE                  PIC X(10)     VALUE          00870000
008800                                         '*ENROUTE* '.            00880000
008900     05  PC-RECEIVER-DESC            PIC X(25)     VALUE          00890000
009000         '    RECEIVERS IN TROUBLE:'.                             00900000
009100     05  PC-PO-RECEIVER-DESC         PIC X(25)     VALUE          00910000
009200         '  TROUBLE BY PO/RECEIVER:'.                             00920000
009300     05  PC-UNIT-DESC                PIC X(25)     VALUE          00930000
009400         '        UNITS IN TROUBLE:'.                             00940000
009500     05  PC-CARTON-DESC              PIC X(25)     VALUE          00950000
009600         '      CARTONS IN TROUBLE:'.                             00960000
009700     05  PC-ARRIVED-CDE              PIC X(1)      VALUE '1'.     00970000
009800     05  PC-ENROUTE-CDE              PIC X(1)      VALUE '2'.     00980000
009900     05  PC-ON-SITE-CDE              PIC X(1)      VALUE '3'.     00990000
010000     05  PC-OFF-SITE-CDE             PIC X(1)      VALUE '4'.     01000000
010100     05  PC-ARRIVED-DESC             PIC X(07)     VALUE          01010000
010200                                                   'ARRIVED'.     01020000
010300     05  PC-ENROUTE-DESC             PIC X(07)     VALUE          01030000
010400                                                   'ENROUTE'.     01040000
010500     05  PC-ON-SITE-DESC             PIC X(07)     VALUE          01050000
010600                                                   'ON-SITE'.     01060000
010700     05  PC-OFF-SITE-DESC            PIC X(08)     VALUE          01070000
010800                                                   'OFF-SITE'.    01080000
010900                                                                  01090000
011000 01  PV-PROGRAM-VARIABLES.                                        01100000
011100     05  PV-SUB-1                    PIC S9(4)     VALUE ZERO     01110000
011200                                                    COMP SYNC.    01120000
011300     05  PV-SUB-2                    PIC S9(4)     VALUE ZERO     01130000
011400                                                    COMP.         01140000
011500     05  PV-MAX-SUB                  PIC S9(4)     VALUE ZERO     01150000
011600                                                    COMP.         01160000
011700     05  PV-HALF-SUB                 PIC S9(4)     VALUE ZERO     01170000
011800                                                    COMP.         01180000
011900     05  PV-REMAINDER                PIC S9(4)     VALUE ZERO     01190000
012000                                                    COMP.         01200000
012100     05  PV-SAVE-PROCESS-AREA        PIC  X(06)    VALUE SPACES.  01210000
012200     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01220000
012300                                                   COMP SYNC.     01230000
012400     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01240000
012400     05  PV-ABEND-SQLCODE            PIC  X(10)    VALUE SPACES.  01241002
012500     05  PV-LINE-COUNT               PIC S9(04)    VALUE +80      01250000
012600                                                   COMP SYNC.     01260000
012700     05  PV-PAGE-COUNT               PIC S9(04)    VALUE ZERO.    01270000
012800     05  PV-START-DATE               PIC  X(08)    VALUE SPACE.   01280000
012900     05  PV-END-DATE                 PIC  X(08)    VALUE SPACE.   01290000
012900     05  PV-CURRENT-DATE             PIC  X(10)    VALUE SPACE.   01291001
013000     05  PV-START-EXTRACT.                                        01300000
013100         10 PV-START-YYYY            PIC 9(04)     VALUE 0.       01310000
013200         10 FILLER                   PIC X(01)     VALUE SPACE.   01320000
013300         10 PV-START-MM              PIC 9(02)     VALUE 0.       01330000
013400         10 FILLER                   PIC X(01)     VALUE SPACE.   01340000
013500         10 PV-START-DD              PIC 9(02)     VALUE 0.       01350000
013600         10 FILLER                   PIC X(01)     VALUE SPACE.   01360000
013700     05  PV-END-EXTRACT.                                          01370000
013800         10 PV-END-YYYY              PIC 9(04)     VALUE 0.       01380000
013900         10 FILLER                   PIC X(01)     VALUE SPACE.   01390000
014000         10 PV-END-MM                PIC 9(02)     VALUE 0.       01400000
014100         10 FILLER                   PIC X(01)     VALUE SPACE.   01410000
014200         10 PV-END-DD                PIC 9(02)     VALUE 0.       01420000
014300         10 FILLER                   PIC X(01)     VALUE SPACE.   01430000
014400     05  PV-REPORT-DATE              PIC X(10)     VALUE SPACE.   01440000
014500     05  PV-RECEIVER-HOLD            PIC 9(09).                   01450000
014600     05  PV-RECEIVER-HOLD-RED REDEFINES PV-RECEIVER-HOLD.         01460000
014700         10 FILLER                   PIC 9(05).                   01470000
014800         10 PV-RECEIVER-NBR          PIC 9(04).                   01480000
014900     05  PV-TRBL-RSN-CDE-SAVE        PIC S9(4) VALUE +9999 COMP.  01490000
015000     05  PV-NOTIF-DATE-SAVE          PIC  X(8) VALUE SPACES.      01500000
015100     05  PV-TEMP-TROUBLE-RECORD      PIC X(38) VALUE SPACES.      01510000
015200     05  PV-REC-SEQ-NBR-SAVE         PIC S9(9) COMP               01520000
015300                                               VALUE +99999999.   01530000
015400     05  PV-PO-NBR-SAVE              PIC S9(9) COMP               01540000
015500                                               VALUE +99999999.   01550000
015600     05  PV-DC-SAVE                  PIC  X(9) VALUE 'XXXXXXXXX'. 01560000
015700     05  PV-OPER-UNT-ID-SAVE         PIC  9(4) VALUE 9999.        01570000
015800     05  PV-FCLTY-ID-SAVE            PIC S9(4) VALUE +9999 COMP.  01580000
015900     05  PV-FCLTY-AREA-SAVE          PIC  X(6) VALUE 'XXXXXX'.    01590000
016000     05  PV-OPER-UNT-ID-GROUP        PIC X(04) VALUE SPACES.      01600002
016300     05  PV-REPORT-SORT-CDE-SAVE     PIC X(01) VALUE SPACE.       01630000
016400                                                                  01640000
016500     COPY DPWS132O.                                               01650000
016600                                                                  01660000
016700 01  CT-CPU-TIME.                                                 01670000
016800     03  CT-HOUR                     PIC  9(02)    VALUE ZERO.    01680000
016900     03  CT-MINUTE                   PIC  9(02)    VALUE ZERO.    01690000
017000     03  FILLER                      PIC  9(04)    VALUE ZERO.    01700000
017100                                                                  01710000
017200 01  CD-CPU-DATE.                                                 01720000
017300     03  CD-YEAR                     PIC  9(02)    VALUE ZERO.    01730000
017400     03  CD-MONTH                    PIC  9(02)    VALUE ZERO.    01740000
017500     03  CD-DAY                      PIC  9(02)    VALUE ZERO.    01750000
017600                                                                  01760000
017700 01  PA-PROGRAM-ACCUMULATORS.                                     01770000
017800     05  PA-TROUBL-CART-CONT         PIC  S9(10)  VALUE 0 COMP-3. 01780000
017900     05  PA-TROUBL-UNITS-COUNT       PIC  S9(10)  VALUE 0 COMP-3. 01790000
018000     05  PA-PR-AREA-TRBL-CNT         PIC  S9(10)  VALUE 0 COMP-3. 01800000
018100     05  PA-PR-AREA-CRTN-COUNT       PIC  S9(10)  VALUE 0 COMP-3. 01810000
018200     05  PA-PR-AREA-UNTS-COUNT       PIC  S9(10)  VALUE 0 COMP-3. 01820000
018300     05  PA-DC-TRBL-CNT              PIC  S9(10)  VALUE 0 COMP-3. 01830000
018400     05  PA-DC-TRBL-CNT-ENROUTE      PIC  S9(10)  VALUE 0 COMP-3. 01840000
018500     05  PA-DC-TRBL-CNT-ARRIVED      PIC  S9(10)  VALUE 0 COMP-3. 01850000
018600     05  PA-DC-POTRBL-CNT            PIC  S9(10)  VALUE 0 COMP-3. 01860000
018700     05  PA-DC-POTRBL-CNT-ENROUTE    PIC  S9(10)  VALUE 0 COMP-3. 01870000
018800     05  PA-DC-POTRBL-CNT-ARRIVED    PIC  S9(10)  VALUE 0 COMP-3. 01880000
018900     05  PA-DC-CRTN-CNT              PIC  S9(10)  VALUE 0 COMP-3. 01890000
019000     05  PA-DC-CRTN-CNT-ENROUTE      PIC  S9(10)  VALUE 0 COMP-3. 01900000
019100     05  PA-DC-CRTN-CNT-ARRIVED      PIC  S9(10)  VALUE 0 COMP-3. 01910000
019200     05  PA-DC-UNTS-CNT              PIC  S9(10)  VALUE 0 COMP-3. 01920000
019300     05  PA-DC-UNTS-CNT-ENROUTE      PIC  S9(10)  VALUE 0 COMP-3. 01930000
019400     05  PA-DC-UNTS-CNT-ARRIVED      PIC  S9(10)  VALUE 0 COMP-3. 01940000
019500                                                                  01950000
019600 01  PA-TROUBLE-COUNT-TABLE.                                      01960000
019700     05  PA-TROUBLE-COUNT-RECORD                                  01970000
019800         OCCURS 200 TIMES                                         01980000
019900         INDEXED BY PA-TRBL-IDX.                                  01990000
020000         10  PA-TRBL-RSN-DESC        PIC   X(20)  VALUE SPACES.   02000000
020100         10  PA-TRBL-CNT             PIC  S9(10)  VALUE 0 COMP-3. 02010000
020200         10  PA-TRBL-CNT-ENROUTE     PIC  S9(10)  VALUE 0 COMP-3. 02020000
020300         10  PA-TRBL-CNT-ARRIVED     PIC  S9(10)  VALUE 0 COMP-3. 02030000
020400                                                                  02040000
020500 01  HL1-HEADING-LINE-1.                                          02050000
020600     05  FILLER                      PIC  X(02)    VALUE SPACES.  02060000
020700     05  HL1-SPECIAL-RUN-NOTE        PIC  X(27)    VALUE SPACES.  02070000
020800     05  FILLER                      PIC  X(10)    VALUE SPACES.  02080000
020900     05  FILLER                      PIC  X(36)    VALUE          02090000
021000                 'UNRESOLVED TROUBLE REPORT BY DC FOR '.          02100000
021100     05  HL1-REPORT-DATE             PIC  X(10)    VALUE SPACES.  02110000
021200     05  FILLER                      PIC  X(03)    VALUE ' AT'.   02120000
021300     05  FILLER                      PIC  X(01)    VALUE SPACES.  02130000
021400     05  HL1-REPORT-TIME             PIC  X(05)    VALUE SPACES.  02140000
021500     05  FILLER                      PIC  X(39)    VALUE SPACES.  02150000
021600                                                                  02160000
021700 01  HL2-HEADING-LINE-2.                                          02170000
021800     05  FILLER                      PIC  X(52)    VALUE SPACES.  02180000
021900     05  HL2-REPORT-AREA             PIC  X(29)    VALUE          02190000
022000                               'AGING (RECEIPT DATE) SEQUENCE'.   02200000
022100     05  FILLER                      PIC  X(56)    VALUE SPACES.  02210000
022200                                                                  02220000
022300 01  HL3-HEADING-LINE-3.                                          02230000
022400     05  FILLER                      PIC  X(02)  VALUE SPACES.    02240000
022500     05  FILLER                      PIC  X(03)  VALUE  'DC:'.    02250000
022600     05  FILLER                      PIC  X(02)  VALUE SPACE.     02260000
022700     05  HL3-DC-NAME                 PIC  X(05)  VALUE SPACE.     02270000
022800     05  FILLER                      PIC  X(51)  VALUE SPACES.    02280000
022900     05  PV-TROUBLE-STATUS           PIC  X(08)  VALUE SPACES.    02290000
023000*    05  FILLER                      PIC  X(101)   VALUE SPACES.  02300000
023100                                                                  02310000
023200 01  HL4-HEADING-LINE-4.                                          02320000
023300     05  FILLER                      PIC  X(02)    VALUE SPACES.  02330000
023400     05  FILLER                      PIC  X(07)    VALUE          02340000
023500                                                  'PROCESS'.      02350000
023600     05  FILLER                      PIC  X(03)    VALUE SPACES.  02360000
023700     05  FILLER                      PIC  X(07)    VALUE          02370000
023800                                                  'RECEIPT'.      02380000
023900     05  FILLER                      PIC  X(03)    VALUE SPACES.  02390000
024000     05  FILLER                      PIC  X(35)    VALUE SPACES.  02400000
024100     05  FILLER                      PIC  X(06)    VALUE 'CARTON'.02410000
024200     05  FILLER                      PIC  X(117)   VALUE SPACE.   02420000
024300                                                                  02430000
024400 01  HL5-HEADING-LINE-5.                                          02440000
024500     05  FILLER                      PIC  X(03)    VALUE SPACES.  02450000
024600     05  FILLER                      PIC  X(04)    VALUE 'AREA'.  02460000
024700     05  FILLER                      PIC  X(06)    VALUE SPACE.   02470000
024800     05  FILLER                      PIC  X(04)    VALUE 'DATE'.  02480000
024900     05  FILLER                      PIC  X(07)    VALUE SPACE.   02490000
025000     05  FILLER                      PIC  X(11)    VALUE          02500000
025100                                                  'PO/RECEIVER'.  02510000
025200     05  FILLER                      PIC  X(04)    VALUE SPACES.  02520000
025300     05  FILLER                      PIC  X(11)    VALUE          02530000
025400                                                 'VENDOR NAME'.   02540000
025500     05  FILLER                      PIC  X(07)    VALUE SPACES.  02550000
025600     05  FILLER                      PIC  X(05)    VALUE 'COUNT'. 02560000
025700     05  FILLER                      PIC  X(04)    VALUE SPACES.  02570000
025800     05  FILLER                      PIC  X(05)    VALUE 'UNITS'. 02580000
025900     05  FILLER                      PIC  X(03)    VALUE SPACES.  02590000
026000     05  FILLER                      PIC  X(14)    VALUE          02600000
026100                                              'TROUBLE REASON'.   02610000
026200     05  FILLER                      PIC  X(08)    VALUE SPACES.  02620000
026300     05  FILLER                      PIC  X(11)    VALUE          02630000
026400                                              'NOTIFY DATE'.      02640000
026500     05  FILLER                      PIC  X(02)    VALUE SPACES.  02650000
026600     05  FILLER                      PIC  X(10)    VALUE          02660000
026700                                              'BUYER NAME'.       02670000
026800     05  FILLER                      PIC  X(15)    VALUE SPACES.  02680000
026900                                                                  02690000
027000                                                                  02700000
027100 01  DL1-DETAIL-LINE-1.                                           02710000
027200     05  FILLER                      PIC  X(02)      VALUE SPACES.02720000
027300     05  DL1-PROCESS-AREA            PIC  X(06)      VALUE SPACES.02730000
027400     05  FILLER                      PIC  X(03)      VALUE SPACES.02740000
027500     05  DL1-RECEIPT-DATE            PIC  X(10)      VALUE SPACES.02750000
027600     05  FILLER                      PIC  X(01)      VALUE SPACES.02760000
027700     05  DL1-PO                      PIC  X(09)      VALUE SPACES.02770000
027800     05  DL1-DASH                    PIC  X(01)      VALUE '-'.   02780000
027900     05  DL1-RECEIVER                PIC  X(04)      VALUE SPACES.02790000
028000     05  FILLER                      PIC  X(02)      VALUE SPACES.02800000
028100     05  DL1-VENDOR-NAME             PIC  X(15)      VALUE ZEROS. 02810000
028200     05  FILLER                      PIC  X(02)      VALUE SPACES.02820000
028300     05  DL1-CARTON-COUNT            PIC  Z(3),Z(3)  VALUE ZEROS. 02830000
028400     05  FILLER                      PIC  X(02)      VALUE SPACES.02840000
028500     05  DL1-UNITS                   PIC  Z(3),Z(3)  VALUE ZEROS. 02850000
028600     05  FILLER                      PIC  X(02)      VALUE SPACES.02860000
028700     05  DL1-TROUBLE-REASON          PIC  X(20)      VALUE SPACES.02870000
028800     05  FILLER                      PIC  X(03)      VALUE SPACES.02880000
028900     05  DL1-NOTIFY-MM               PIC  X(02)      VALUE SPACES.02890000
029000     05  FILLER                      PIC  X(01)      VALUE '/'.   02900000
029100     05  DL1-NOTIFY-DD               PIC  X(02)      VALUE SPACES.02910000
029200     05  FILLER                      PIC  X(01)      VALUE '/'.   02920000
029300     05  DL1-NOTIFY-YYYY             PIC  X(04)      VALUE SPACES.02930000
029400     05  FILLER                      PIC  X(03)      VALUE SPACES.02940000
029500     05  DL1-BUYER-NAME              PIC  X(25)      VALUE SPACES.02950000
029600     05  FILLER                      PIC  X(02)      VALUE SPACES.02960000
029700                                                                  02970000
029800 01  TL1-TOTAL-LINE-1.                                            02980000
029900     05  FILLER                      PIC  X(44)  VALUE            02990000
030000                 'PROCESS AREA TOTALS:  RECEIVERS IN TROUBLE  '.  03000000
030100     05  FILLER                      PIC  X(02)      VALUE SPACES.03010000
030200     05  TL1-TRBL-RCVR-COUNT         PIC  Z(2),Z(2)9 VALUE ZEROS. 03020000
030300     05  FILLER                      PIC  X(03)      VALUE SPACES.03030000
030400     05  TL1-CARTON-COUNT            PIC  Z(3),Z(2)9 VALUE SPACES.03040000
030500     05  FILLER                      PIC  X(02)      VALUE SPACES.03050000
030600     05  TL1-UNITS-COUNT             PIC  Z(3),Z(2)9 VALUE SPACES.03060000
030700     05  FILLER                      PIC  X(100)     VALUE SPACES.03070000
030800                                                                  03080000
030900 01  TLH-TOTAL-LINE-HEADING.                                      03090000
031000     05  FILLER                      PIC  X(02)      VALUE SPACES.03100000
031100     05  FILLER                      PIC  X(10)      VALUE        03110000
031200         'DC TOTALS:'.                                            03120000
031300     05  FILLER                      PIC  X(38)      VALUE SPACES.03130000
031400     05  FILLER                      PIC  X(33)      VALUE        03140000
031500         'TOTAL       ENROUTE       ARRIVED'.                     03150000
031600                                                                  03160000
031700 01  TL2-TOTAL-LINE-2.                                            03170000
031800     05  FILLER                      PIC  X(19)      VALUE SPACES.03180000
031900     05  TL2-TOTAL-DESCRIPTION       PIC  X(25)      VALUE SPACES.03190000
032000     05  FILLER                      PIC  X(02)      VALUE SPACES.03200000
032100     05  TL2-TROUBLE-CNT             PIC  Z,ZZZ,ZZ9  VALUE ZEROS. 03210000
032200     05  FILLER                      PIC  X(05)      VALUE SPACES.03220000
032300     05  TL2-TROUBLE-CNT-ENROUTE     PIC  Z,ZZZ,ZZ9  VALUE ZEROS. 03230000
032400     05  FILLER                      PIC  X(05)      VALUE SPACES.03240000
032500     05  TL2-TROUBLE-CNT-ARRIVED     PIC  Z,ZZZ,ZZ9  VALUE ZEROS. 03250000
032600     05  FILLER                      PIC  X(51)      VALUE SPACES.03260000
032700                                                                  03270000
032800 01  TRH-TROUBLE-RECAP-HEADING-1.                                 03280000
032900     05  FILLER                      PIC  X(02)      VALUE SPACES.03290000
033000     05  FILLER                      PIC  X(24)      VALUE        03300000
033100         'DC TROUBLE REASON RECAP:'.                              03310000
033200                                                                  03320000
033300 01  TRH-TROUBLE-RECAP-HEADING-2.                                 03330000
033400     05  FILLER                      PIC  X(04)      VALUE SPACES.03340000
033500     05  FILLER                      PIC  X(20)      VALUE        03350000
033600         'TROUBLE REASON      '.                                  03360000
033700     05  FILLER                      PIC  X(03)      VALUE SPACES.03370000
033800     05  FILLER                      PIC  X(06)      VALUE        03380000
033900         ' TOTAL'.                                                03390000
034000     05  FILLER                      PIC  X(02)      VALUE SPACES.03400000
034100     05  FILLER                      PIC  X(07)      VALUE        03410000
034200         'ENROUTE'.                                               03420000
034300     05  FILLER                      PIC  X(02)      VALUE SPACES.03430000
034400     05  FILLER                      PIC  X(07)      VALUE        03440000
034500         'ARRIVED'.                                               03450000
034600     05  FILLER                      PIC  X(08)      VALUE SPACES.03460000
034700     05  FILLER                      PIC  X(20)      VALUE        03470000
034800         'TROUBLE REASON      '.                                  03480000
034900     05  FILLER                      PIC  X(03)      VALUE SPACES.03490000
035000     05  FILLER                      PIC  X(06)      VALUE        03500000
035100         ' TOTAL'.                                                03510000
035200     05  FILLER                      PIC  X(02)      VALUE SPACES.03520000
035300     05  FILLER                      PIC  X(07)      VALUE        03530000
035400         'ENROUTE'.                                               03540000
035500     05  FILLER                      PIC  X(02)      VALUE SPACES.03550000
035600     05  FILLER                      PIC  X(07)      VALUE        03560000
035700         'ARRIVED'.                                               03570000
035800                                                                  03580000
035900 01  TRD-TROUBLE-RECAP-DETAIL-LINE.                               03590000
036000     05  FILLER                      PIC  X(04)      VALUE SPACES.03600000
036100     05  TRD1-TROUBLE-RECAP-REC.                                  03610000
036200         10 TRD1-TROUBLE-DESC        PIC  X(20)      VALUE SPACES.03620000
036300         10 FILLER                   PIC  X(03)      VALUE SPACES.03630000
036400         10 TRD1-TRBL-CNT            PIC  ZZ,ZZ9     VALUE ZERO.  03640000
036500         10 FILLER                   PIC  X(02)      VALUE SPACES.03650000
036600         10 TRD1-TRBL-CNT-ENROUTE    PIC  ZZ,ZZ9     VALUE ZERO.  03660000
036700         10 FILLER                   PIC  X(02)      VALUE SPACES.03670000
036800         10 TRD1-TRBL-CNT-ARRIVED    PIC  ZZ,ZZ9     VALUE ZERO.  03680000
036900         10 FILLER                   PIC  X(08)      VALUE SPACES.03690000
037000     05  TRD2-TROUBLE-RECAP-REC.                                  03700000
037100         10 TRD2-TROUBLE-DESC        PIC  X(20)      VALUE SPACES.03710000
037200         10 FILLER                   PIC  X(03)      VALUE SPACES.03720000
037300         10 TRD2-TRBL-CNT            PIC  ZZ,ZZ9     VALUE ZERO.  03730000
037400         10 FILLER                   PIC  X(02)      VALUE SPACES.03740000
037500         10 TRD2-TRBL-CNT-ENROUTE    PIC  ZZ,ZZ9     VALUE ZERO.  03750000
037600         10 FILLER                   PIC  X(02)      VALUE SPACES.03760000
037700         10 TRD2-TRBL-CNT-ARRIVED    PIC  ZZ,ZZ9     VALUE ZERO.  03770000
037800                                                                  03780000
037900 01  BL-BLANK-LINE                   PIC  X(132)     VALUE SPACES.03790000
038000                                                                  03800000
038100 01  NI-NO-INFORMATION-LINE.                                      03810000
038200     05  FILLER                      PIC X(02)  VALUE SPACE.      03820000
038300     05  FILLER                      PIC X(23)  VALUE             03830000
038400                                     '** NO DATA TO REPORT **'.   03840000
038500     05  FILLER                      PIC X(108) VALUE SPACE.      03850000
038600                                                                  03860000
038700 01  ER-END-REPORT-LINE.                                          03870000
038800     05  FILLER                      PIC X(02)  VALUE SPACE.      03880000
038900     05  FILLER                      PIC X(16)  VALUE             03890000
039000                                     '** END REPORT **'.          03900000
039100     05  FILLER                      PIC X(116) VALUE SPACE.      03910000
039200                                                                  03920000
039300     COPY DPWS004.                                                03930000
039400                                                                  03940000
039500     COPY TMRD001.                                                03950000
039600                                                                  03960000
039700* COPYBOOK FOR LOCATION MODULE XLKUT071                           03970001
039800                                                                  03980001
039900     COPY XLWS071.                                                03990001
040000                                                                  04000001
041500*---------------------------------------------------------------* 04150000
041600*    DB2 AREA FOR COMMUNICATIONS                                * 04160000
041700*---------------------------------------------------------------* 04170000
041800     EXEC SQL                                                     04180000
041900          INCLUDE SQLCA                                           04190000
042000     END-EXEC.                                                    04200000
042100***************************************************************** 04210000
042200 PROCEDURE DIVISION.                                              04220000
042300***************************************************************** 04230000
042400                                                                  04240000
042500 0000-MAINLINE.                                                   04250000
042600***************************************************************** 04260000
042700*  THIS PARAGRAPH DRIVES THE PROGRAM.                           * 04270000
042800***************************************************************** 04280000
042900     PERFORM 1000-INITIALIZE.                                     04290000
043000                                                                  04300000
043100     PERFORM 2000-MAIN-PROCESS                                    04310000
043200           UNTIL  PS-EOF.                                         04320000
043300                                                                  04330000
043400     PERFORM 9000-END-PROCESS THRU 9000-EXIT.                     04340000
043500                                                                  04350000
043600 0000-EXIT.  STOP RUN.                                            04360000
043700                                                                  04370000
043800 1000-INITIALIZE.                                                 04380000
043900      OPEN INPUT  TROUBLE-EXTRACT-FILE.                           04390000
044000      OPEN OUTPUT UNRESOLVED-TROUBLE-REPORT.                      04400000
044100      INITIALIZE  PA-TROUBLE-COUNT-TABLE.                         04410000
044200**** READING THE HEADER RECORD.                                   04420000
044300      READ TROUBLE-EXTRACT-FILE  INTO                             04430000
044400                                  TM001-TROUBLE-EXT-RECORD        04440000
044500          AT END                                                  04450000
044600             SET PS-EOF TO TRUE                                   04460000
044700          NOT AT END                                              04470000
044800             MOVE TM001-RUN-BEGIN-DATE  TO PV-START-EXTRACT       04480000
044900             MOVE TM001-RUN-END-DATE    TO PV-END-EXTRACT         04490000
045000             STRING                                               04500000
045100                   PV-START-MM                                    04510000
045200                   '/'                                            04520000
045300                   PV-START-DD                                    04530000
045400                   '/'                                            04540000
045500                   PV-START-YYYY                                  04550000
045600                DELIMITED BY SIZE                                 04560000
045700                INTO PV-REPORT-DATE                               04570000
045800              END-STRING                                          04580000
045900             STRING                                               04590000
046000                   PV-START-YYYY                                  04600000
046100                   PV-START-MM                                    04610000
046200                   PV-START-DD                                    04620000
046300                DELIMITED BY SIZE                                 04630000
046400                INTO PV-START-DATE                                04640000
046500             END-STRING                                           04650000
046600             STRING                                               04660000
046700                   PV-END-YYYY                                    04670000
046800                   PV-END-MM                                      04680000
046900                   PV-END-DD                                      04690000
047000                DELIMITED BY SIZE                                 04700000
047100                INTO PV-END-DATE                                  04710000
047200             END-STRING                                           04720000
047300             MOVE PV-REPORT-DATE     TO HL1-REPORT-DATE           04730000
047400                                                                  04740000
047400*** SQL STATEMENT ONLY USED TO KEEP PGM DB2                       04740101
047410     EXEC SQL                                                     04741001
047420         SET :PV-CURRENT-DATE = CURRENT DATE                      04742001
047430     END-EXEC.                                                    04742101
047400                                                                  04743001
047500     ACCEPT CT-CPU-TIME          FROM TIME.                       04750000
047600     MOVE   CT-HOUR              TO DP132O-RUN-HOUR.              04760000
047700     MOVE   CT-MINUTE            TO DP132O-RUN-MINUTE.            04770000
047800     MOVE   DP132O-RUN-TIME      TO HL1-REPORT-TIME               04780000
047900                                                                  04790000
048000     ACCEPT CD-CPU-DATE          FROM DATE.                       04800000
048100     MOVE CD-YEAR                TO DP132O-RUN-YEAR.              04810000
048200     MOVE CD-MONTH               TO DP132O-RUN-MONTH.             04820000
048300     MOVE CD-DAY                 TO DP132O-RUN-DAY.               04830000
048400                                                                  04840000
048500     MOVE 'TMKRP014'             TO DP132O-PROGRAM-NAME.          04850000
048600     MOVE PC-ONE                 TO DP132O-REPORT-NUMBER          04860000
048700                                                                  04870000
048800     IF TM001-RUN-SPECIAL                                         04880000
048900        MOVE PC-SPECIAL-RUN-NOTE TO HL1-SPECIAL-RUN-NOTE          04890000
049000     ELSE                                                         04900000
049100        MOVE SPACE               TO HL1-SPECIAL-RUN-NOTE          04910000
049200     END-IF.                                                      04920000
049300                                                                  04930000
049400 1000-EXIT.  EXIT.                                                04940000
049500                                                                  04950000
049600 2000-MAIN-PROCESS.                                               04960000
049700      READ TROUBLE-EXTRACT-FILE  INTO                             04970000
049800                                  TM001-TROUBLE-EXT-RECORD        04980000
049900          AT END                                                  04990000
050000            IF PV-PAGE-COUNT   = 0                                05000000
050100               SET PS-NO-DETAILS    TO TRUE                       05010000
050200               PERFORM 6900-PRINT-HEADINGS      THRU 6900-EXIT    05020000
050300            ELSE                                                  05030000
050400               SET PS-EOF    TO TRUE                              05040000
050500*              MOVE SPACES TO PV-TROUBLE-STATUS                   05050000
050600               PERFORM 6210-WRITE-PREVIOUS-DTL-REC                05060000
050700               PERFORM 6000-PRINT-TOTALS        THRU 6000-EXIT    05070000
050800            END-IF                                                05080000
050900          NOT AT END                                              05090000
051000            IF TM001-RPT-RESOLVED                                 05100000
051100               CONTINUE                                           05110000
051200            ELSE                                                  05120000
051300               IF PS-FIRST-TIME-THRU                              05130000
051400                  PERFORM 2050-FIRST-TIME-THRU    THRU 2050-EXIT  05140000
051500                  PERFORM 6100-ACCUMULATE-TOTALS  THRU 6100-EXIT  05150000
051600                  SET PS-NOT-FIRST-TIME-THRU      TO TRUE         05160000
051700               ELSE                                               05170000
051800                  PERFORM 2100-SET-FLAGS          THRU 2100-EXIT  05180000
051900                  PERFORM 3000-WRITE-REPORT       THRU 3000-EXIT  05190000
052000            END-IF                                                05200000
052100          END-IF                                                  05210000
052200       END-READ.                                                  05220000
052300                                                                  05230000
052400 2000-EXIT.  EXIT.                                                05240000
052500                                                                  05250000
052600 2050-FIRST-TIME-THRU.                                            05260000
052700      IF TM001-FCLTY-AREA-ID = LOW-VALUE  OR                      05270000
052800         TM001-FCLTY-AREA-ID = SPACES                             05280000
052900         MOVE PC-NOT-FND                   TO DL1-PROCESS-AREA    05290000
053000                                              PV-SAVE-PROCESS-AREA05300000
053100      ELSE                                                        05310000
053200         MOVE TM001-FCLTY-AREA-ID          TO DL1-PROCESS-AREA    05320000
053300                                              PV-SAVE-PROCESS-AREA05330000
053400      END-IF                                                      05340000
053500                                                                  05350000
053600      PERFORM 6215-MOVES                   THRU 6215-EXIT.        05360000
053700      MOVE TM001-OPER-UNT-ID          TO PV-OPER-UNT-ID-SAVE      05370000
053800      MOVE TM001-FCLTY-ID             TO PV-FCLTY-ID-SAVE         05380000
053900      MOVE TM001-FCLTY-AREA-ID        TO PV-FCLTY-AREA-SAVE       05390000
054000      MOVE TM001-PO-NBR               TO PV-PO-NBR-SAVE           05400000
054100      MOVE TM001-REC-SEQ-NBR          TO PV-REC-SEQ-NBR-SAVE      05410000
054200      MOVE TM001-TRBL-RSN-CDE         TO PV-TRBL-RSN-CDE-SAVE     05420000
054300      MOVE TM001-REPORT-SORT-CDE      TO PV-REPORT-SORT-CDE-SAVE  05430000
054400      MOVE 0                         TO PA-PR-AREA-TRBL-CNT       05440000
054500                                        PA-DC-TRBL-CNT            05450000
054600                                        PA-DC-TRBL-CNT-ENROUTE    05460000
054700                                        PA-DC-TRBL-CNT-ARRIVED    05470000
054800                                        PA-DC-POTRBL-CNT          05480000
054900                                        PA-DC-POTRBL-CNT-ENROUTE  05490000
055000                                        PA-DC-POTRBL-CNT-ARRIVED  05500000
055100                                        PA-PR-AREA-CRTN-COUNT     05510000
055200                                        PA-DC-CRTN-CNT            05520000
055300                                        PA-DC-CRTN-CNT-ENROUTE    05530000
055400                                        PA-DC-CRTN-CNT-ARRIVED    05540000
055500                                        PA-TROUBL-CART-CONT       05550000
055600                                        PA-PR-AREA-UNTS-COUNT     05560000
055700                                        PA-DC-UNTS-CNT            05570000
055800                                        PA-DC-UNTS-CNT-ENROUTE    05580000
055900                                        PA-DC-UNTS-CNT-ARRIVED    05590000
056000                                        PA-TROUBL-UNITS-COUNT.    05600000
056100     PERFORM 2500-SET-TROUBLE-STATUS THRU 2500-EXIT.              05610000
056200                                                                  05620000
056300 2050-EXIT.  EXIT.                                                05630000
056400                                                                  05640000
056500 2100-SET-FLAGS.                                                  05650000
056600     IF TM001-OPER-UNT-ID NOT = PV-OPER-UNT-ID-SAVE OR            05660000
056700        TM001-FCLTY-ID    NOT = PV-FCLTY-ID-SAVE                  05670000
056800         SET PS-DC-CHANGED               TO TRUE                  05680000
056900         MOVE TM001-OPER-UNT-ID TO PV-OPER-UNT-ID-SAVE            05690000
057000         MOVE TM001-FCLTY-ID    TO PV-FCLTY-ID-SAVE               05700000
057100         MOVE TM001-REPORT-SORT-CDE TO PV-REPORT-SORT-CDE-SAVE    05710000
057200         SET PS-PROCESS-AREA-CHANGED     TO TRUE                  05720000
057300         MOVE TM001-FCLTY-AREA-ID        TO PV-FCLTY-AREA-SAVE    05730000
057400         SET PS-PO-CHANGED               TO TRUE                  05740000
057500         MOVE TM001-PO-NBR               TO PV-PO-NBR-SAVE        05750000
057600         SET PS-RECEIVER-CHANGED         TO TRUE                  05760000
057700         MOVE TM001-REC-SEQ-NBR          TO PV-REC-SEQ-NBR-SAVE   05770000
057800         SET PS-TRBL-RSN-CDE-CHANGED     TO TRUE                  05780000
057900         MOVE TM001-TRBL-RSN-CDE         TO PV-TRBL-RSN-CDE-SAVE  05790000
058000         GO TO 2100-EXIT                                          05800000
058100     ELSE                                                         05810000
058200         SET PS-DC-NOT-CHANGED TO TRUE                            05820000
058300     END-IF.                                                      05830000
058400                                                                  05840000
058500     IF TM001-REPORT-SORT-CDE NOT = PV-REPORT-SORT-CDE-SAVE       05850000
058600        MOVE TM001-REPORT-SORT-CDE TO PV-REPORT-SORT-CDE-SAVE     05860000
058700        SET PS-REPORT-SORT-CDE-CHANGED TO TRUE                    05870000
058800     END-IF.                                                      05880000
058900                                                                  05890000
059000     IF TM001-FCLTY-AREA-ID IS NOT = PV-FCLTY-AREA-SAVE           05900000
059100        SET PS-PROCESS-AREA-CHANGED      TO TRUE                  05910000
059200        MOVE TM001-FCLTY-AREA-ID         TO PV-FCLTY-AREA-SAVE    05920000
059300        SET PS-PO-CHANGED                TO TRUE                  05930000
059400        MOVE TM001-PO-NBR                TO PV-PO-NBR-SAVE        05940000
059500        SET PS-RECEIVER-CHANGED          TO TRUE                  05950000
059600        MOVE TM001-REC-SEQ-NBR           TO PV-REC-SEQ-NBR-SAVE   05960000
059700        SET PS-TRBL-RSN-CDE-CHANGED      TO TRUE                  05970000
059800        MOVE TM001-TRBL-RSN-CDE          TO PV-TRBL-RSN-CDE-SAVE  05980000
059900        GO TO 2100-EXIT                                           05990000
060000     ELSE                                                         06000000
060100         SET PS-PROCESS-AREA-NOT-CHANGED TO TRUE                  06010000
060200     END-IF.                                                      06020000
060300                                                                  06030000
060400     IF TM001-PO-NBR  NOT =  PV-PO-NBR-SAVE                       06040000
060500         SET PS-PO-CHANGED              TO TRUE                   06050000
060600         MOVE TM001-PO-NBR              TO PV-PO-NBR-SAVE         06060000
060700         SET PS-RECEIVER-CHANGED        TO TRUE                   06070000
060800         MOVE TM001-REC-SEQ-NBR         TO PV-REC-SEQ-NBR-SAVE    06080000
060900         SET PS-TRBL-RSN-CDE-CHANGED    TO TRUE                   06090000
061000         MOVE TM001-TRBL-RSN-CDE        TO PV-TRBL-RSN-CDE-SAVE   06100000
061100         GO TO 2100-EXIT                                          06110000
061200     ELSE                                                         06120000
061300         SET PS-PO-NOT-CHANGED          TO TRUE                   06130000
061400     END-IF.                                                      06140000
061500                                                                  06150000
061600     IF TM001-REC-SEQ-NBR  NOT =  PV-REC-SEQ-NBR-SAVE             06160000
061700         SET PS-RECEIVER-CHANGED        TO TRUE                   06170000
061800         MOVE TM001-REC-SEQ-NBR         TO PV-REC-SEQ-NBR-SAVE    06180000
061900         SET PS-TRBL-RSN-CDE-CHANGED    TO TRUE                   06190000
062000         MOVE TM001-TRBL-RSN-CDE        TO PV-TRBL-RSN-CDE-SAVE   06200000
062100         GO TO 2100-EXIT                                          06210000
062200     ELSE                                                         06220000
062300         SET PS-RECEIVER-NOT-CHANGED    TO TRUE                   06230000
062400     END-IF.                                                      06240000
062500                                                                  06250000
062600     IF TM001-TRBL-RSN-CDE NOT =  PV-TRBL-RSN-CDE-SAVE            06260000
062700         MOVE TM001-TRBL-RSN-CDE         TO PV-TRBL-RSN-CDE-SAVE  06270000
062800         SET PS-TRBL-RSN-CDE-CHANGED     TO TRUE                  06280000
062900     ELSE                                                         06290000
063000         SET PS-TRBL-RSN-CDE-NOT-CHANGED TO TRUE                  06300000
063100     END-IF.                                                      06310000
063200                                                                  06320000
063300 2100-EXIT.  EXIT.                                                06330000
063400                                                                  06340000
063500 2500-SET-TROUBLE-STATUS.                                         06350000
      ******************************************************************06350100
      *THIS PARAGRAPH SETS THE TROUBLE STATUS TO THAT INDICATED IN THE  06350200
      *REPORT SORT CODE -- EITHER ARRIVED, ENROUTE, ON-SITE, OR OFF-SITE06350300
      ******************************************************************06350400
063600     EVALUATE TRUE                                                06350500
063700        WHEN PV-REPORT-SORT-CDE-SAVE EQUAL TO PC-ARRIVED-CDE      06350600
063800           MOVE PC-ARRIVED-DESC TO PV-TROUBLE-STATUS              06350700
063900        WHEN PV-REPORT-SORT-CDE-SAVE EQUAL TO PC-ENROUTE-CDE      06350800
064000           MOVE PC-ENROUTE-DESC TO PV-TROUBLE-STATUS              06350900
064100        WHEN PV-REPORT-SORT-CDE-SAVE EQUAL TO PC-ON-SITE-CDE      06351000
064200           MOVE PC-ON-SITE-DESC TO PV-TROUBLE-STATUS              06352000
064300        WHEN PV-REPORT-SORT-CDE-SAVE EQUAL TO PC-OFF-SITE-CDE     06353000
064400           MOVE PC-OFF-SITE-DESC TO PV-TROUBLE-STATUS             06354000
064500     END-EVALUATE.                                                06355000
064600                                                                  06356000
064700 2500-EXIT. EXIT.                                                 06357000
064800                                                                  06358000
064900 3000-WRITE-REPORT.                                               06359000
065000     IF PS-DC-CHANGED                                             06360000
065100*        MOVE SPACES TO PV-TROUBLE-STATUS                         06370000
065200         PERFORM 6200-PRINT-DETAILS     THRU 6200-EXIT            06380000
065300         PERFORM 6000-PRINT-TOTALS      THRU 6000-EXIT            06390000
065400         PERFORM 6100-ACCUMULATE-TOTALS THRU 6100-EXIT            06400000
065500         PERFORM 2500-SET-TROUBLE-STATUS THRU 2500-EXIT           06410000
065600         PERFORM 6900-PRINT-HEADINGS THRU 6900-EXIT               06420000
065700         SET PS-REPORT-SORT-CDE-NOT-CHANGED TO TRUE               06430000
065800     ELSE                                                         06440000
065900         IF  PS-PROCESS-AREA-CHANGED                              06450000
066000         OR  PS-REPORT-SORT-CDE-CHANGED                           06460000
066100             PERFORM 6200-PRINT-DETAILS     THRU 6200-EXIT        06470000
                   PERFORM 6000-PRINT-TOTALS      THRU 6000-EXIT        06480000
067100             PERFORM 6100-ACCUMULATE-TOTALS THRU 6100-EXIT        06490000
066600             IF  PS-REPORT-SORT-CDE-CHANGED                       06500000
066700                 PERFORM 2500-SET-TROUBLE-STATUS THRU 2500-EXIT   06510000
066800                 PERFORM 6900-PRINT-HEADINGS THRU 6900-EXIT       06520000
066900                 SET PS-REPORT-SORT-CDE-NOT-CHANGED TO TRUE       06530000
                       SET PS-PROCESS-AREA-NOT-CHANGED TO TRUE          06540000
066500             END-IF                                               06550000
067200         ELSE                                                     06560000
067300             PERFORM 6200-PRINT-DETAILS     THRU 6200-EXIT        06570000
067400             PERFORM 6100-ACCUMULATE-TOTALS THRU 6100-EXIT        06580000
067500         END-IF                                                   06590000
067600     END-IF.                                                      06600000
067700                                                                  06610000
067800 3000-EXIT.  EXIT.                                                06620000
067900                                                                  06630000
068000 6000-PRINT-TOTALS.                                               06640000
068100     IF  PS-PROCESS-AREA-CHANGED                                  06650000
068200     OR  PS-DC-CHANGED                                            06660000
068300     OR  PS-EOF                                                   06670000
068700         INITIALIZE TL1-TRBL-RCVR-COUNT                           06680000
068800                    TL1-CARTON-COUNT                              06690000
068900                    TL1-UNITS-COUNT                               06700000
069000         MOVE PA-PR-AREA-TRBL-CNT   TO TL1-TRBL-RCVR-COUNT        06710000
069100         MOVE PA-PR-AREA-CRTN-COUNT TO TL1-CARTON-COUNT           06720000
069200         MOVE PA-PR-AREA-UNTS-COUNT TO TL1-UNITS-COUNT            06730000
069300         WRITE UNRESOLVED-TRBLE-RECORD                            06740000
069400                      FROM TL1-TOTAL-LINE-1                       06750000
069500                           AFTER ADVANCING 2 LINES                06760000
069600         ADD 2   TO PV-LINE-COUNT                                 06770000
069700         WRITE UNRESOLVED-TRBLE-RECORD                            06780000
069800                      FROM BL-BLANK-LINE                          06790000
069900                           AFTER ADVANCING 2 LINES                06800000
070000         ADD 2   TO PV-LINE-COUNT                                 06810000
070100         MOVE 0  TO  PA-PR-AREA-TRBL-CNT                          06820000
070200                     PA-PR-AREA-CRTN-COUNT                        06830000
070300                     PA-PR-AREA-UNTS-COUNT                        06840000
070400     END-IF.                                                      06850000
070500                                                                  06860000
070600     IF PS-DC-CHANGED                                             06870000
070700     OR PS-EOF                                                    06880000
070800     OR PS-REPORT-SORT-CDE-CHANGED                                06890000
070900          SET PS-SUPPRESS-DETAIL-HEAD   TO TRUE                   06900000
071000          PERFORM 6900-PRINT-HEADINGS   THRU 6900-EXIT            06910000
071100          SET PS-PRINT-DETAIL-HEAD      TO TRUE                   06920000
071200                                                                  06930000
071300          WRITE UNRESOLVED-TRBLE-RECORD                           06940000
071400                        FROM TLH-TOTAL-LINE-HEADING               06950000
071500                              AFTER ADVANCING 2 LINES             06960000
071600          ADD 2   TO PV-LINE-COUNT                                06970000
071700                                                                  06980000
071800* WRITE THE "RECEIVERS IN TROUBLE" TOTAL LINE                     06990000
071900          MOVE PC-RECEIVER-DESC  TO TL2-TOTAL-DESCRIPTION         07000000
072000          MOVE PA-DC-TRBL-CNT    TO TL2-TROUBLE-CNT               07010000
072100          MOVE PA-DC-TRBL-CNT-ENROUTE                             07020000
072200                                 TO TL2-TROUBLE-CNT-ENROUTE       07030000
072300          MOVE PA-DC-TRBL-CNT-ARRIVED                             07040000
072400                                 TO TL2-TROUBLE-CNT-ARRIVED       07050000
072500          WRITE UNRESOLVED-TRBLE-RECORD                           07060000
072600                        FROM TL2-TOTAL-LINE-2                     07070000
072700                              AFTER ADVANCING 1 LINE              07080000
072800          ADD 1   TO PV-LINE-COUNT                                07090000
072900                                                                  07100000
073000* WRITE THE "TROUBLE BY PO/RECEIVER" TOTAL LINE                   07110000
073100          MOVE PC-PO-RECEIVER-DESC                                07120000
073200                                 TO TL2-TOTAL-DESCRIPTION         07130000
073300          MOVE PA-DC-POTRBL-CNT  TO TL2-TROUBLE-CNT               07140000
073400          MOVE PA-DC-POTRBL-CNT-ENROUTE                           07150000
073500                                 TO TL2-TROUBLE-CNT-ENROUTE       07160000
073600          MOVE PA-DC-POTRBL-CNT-ARRIVED                           07170000
073700                                 TO TL2-TROUBLE-CNT-ARRIVED       07180000
073800          WRITE UNRESOLVED-TRBLE-RECORD                           07190000
073900                        FROM TL2-TOTAL-LINE-2                     07200000
074000                              AFTER ADVANCING 1 LINE              07210000
074100          ADD 1   TO PV-LINE-COUNT                                07220000
074200                                                                  07230000
074300                                                                  07240000
074400* WRITE THE "UNITS IN TROUBLE: TOTAL LINE                         07250000
074500          MOVE PC-UNIT-DESC      TO TL2-TOTAL-DESCRIPTION         07260000
074600          MOVE PA-DC-UNTS-CNT    TO TL2-TROUBLE-CNT               07270000
074700          MOVE PA-DC-UNTS-CNT-ENROUTE                             07280000
074800                                 TO TL2-TROUBLE-CNT-ENROUTE       07290000
074900          MOVE PA-DC-UNTS-CNT-ARRIVED                             07300000
075000                                 TO TL2-TROUBLE-CNT-ARRIVED       07310000
075100          WRITE UNRESOLVED-TRBLE-RECORD                           07320000
075200                        FROM TL2-TOTAL-LINE-2                     07330000
075300                              AFTER ADVANCING 1 LINE              07340000
075400          ADD 1   TO PV-LINE-COUNT                                07350000
075500                                                                  07360000
075600*   WRITE THE "CARTONS IN TROUBLE" TOTAL LINE                     07370000
075700          MOVE PC-CARTON-DESC    TO TL2-TOTAL-DESCRIPTION         07380000
075800          MOVE PA-DC-CRTN-CNT    TO TL2-TROUBLE-CNT               07390000
075900          MOVE PA-DC-CRTN-CNT-ENROUTE                             07400000
076000                                 TO TL2-TROUBLE-CNT-ENROUTE       07410000
076100          MOVE PA-DC-CRTN-CNT-ARRIVED                             07420000
076200                                 TO TL2-TROUBLE-CNT-ARRIVED       07430000
076300          WRITE UNRESOLVED-TRBLE-RECORD                           07440000
076400                        FROM TL2-TOTAL-LINE-2                     07450000
076500                              AFTER ADVANCING 1 LINES             07460000
076600          ADD 1   TO PV-LINE-COUNT                                07470000
076700                                                                  07480000
076800*         SORT THE TABLE OF TROUBLE REASON CODES IN DESCENDING    07490000
076900*         ORDER BY THE TOTAL TROUBLE COUNT.                       07500000
077000          PERFORM 6400-SORT-TROUBLE-TABLE                         07510000
077100          PERFORM 6500-PRINT-TROUBLE-TABLE                        07520000
077200                                                                  07530000
077300          WRITE UNRESOLVED-TRBLE-RECORD                           07540000
077400            FROM ER-END-REPORT-LINE                               07550000
077500                AFTER ADVANCING 2 LINES                           07560000
077600                                                                  07570000
                                                                        07580000
                IF PS-DC-CHANGED                                        07581000
                OR PS-EOF                                               07581100
                    MOVE 0 TO PV-PAGE-COUNT                             07581200
                END-IF                                                  07581300
                                                                        07581400
                IF PS-DC-CHANGED                                        07581500
                OR PS-EOF                                               07581600
                OR PS-REPORT-SORT-CDE-CHANGED                           07581700
                    INITIALIZE PA-TROUBLE-COUNT-TABLE                   07581800
                    MOVE 0  TO PA-DC-TRBL-CNT                           07581900
                               PA-DC-TRBL-CNT-ENROUTE                   07582000
                               PA-DC-TRBL-CNT-ARRIVED                   07583000
                               PA-DC-POTRBL-CNT                         07584000
                               PA-DC-POTRBL-CNT-ENROUTE                 07585000
                               PA-DC-POTRBL-CNT-ARRIVED                 07586000
                               PA-DC-CRTN-CNT                           07587000
                               PA-DC-CRTN-CNT-ENROUTE                   07588000
                               PA-DC-CRTN-CNT-ARRIVED                   07589000
                               PA-DC-UNTS-CNT                           07590000
                               PA-DC-UNTS-CNT-ENROUTE                   07600000
                               PA-DC-UNTS-CNT-ARRIVED                   07610000
                END-IF                                                  07620000
079100     END-IF.                                                      07630000
079200                                                                  07640000
079300 6000-EXIT.  EXIT.                                                07650000
079400                                                                  07660000
079500***************************************************************** 07670000
079600* ADD 1 TO THE TROUBLE COUNT FOR EACH TROUBLE RECORD PROCESSED  * 07680000
079700* ADD THE ASSOCIATED CARTON COUNT AND ITEM QUANTITY ONLY ONCE   * 07690000
079800* FOR EACH RECEIVER                                             * 07700000
079900***************************************************************** 07710000
080000 6100-ACCUMULATE-TOTALS.                                          07720000
080100     IF PS-FIRST-TIME-THRU OR PS-RECEIVER-CHANGED                 07730000
080200       ADD 1                         TO PA-PR-AREA-TRBL-CNT       07740000
080300                                        PA-DC-TRBL-CNT            07750000
080400       ADD TM001-RCVR-CART-CNT       TO PA-PR-AREA-CRTN-COUNT     07760000
080500                                        PA-DC-CRTN-CNT            07770000
080600                                        PA-TROUBL-CART-CONT       07780000
080700       ADD TM001-RCVR-ITEM-QTY       TO PA-PR-AREA-UNTS-COUNT     07790000
080800                                        PA-DC-UNTS-CNT            07800000
080900                                        PA-TROUBL-UNITS-COUNT     07810000
081000       IF TM001-RECEIPT-DATE = 99990909                           07820000
081100           ADD 1                     TO PA-DC-TRBL-CNT-ENROUTE    07830000
081200           ADD TM001-RCVR-CART-CNT   TO PA-DC-CRTN-CNT-ENROUTE    07840000
081300           ADD TM001-RCVR-ITEM-QTY   TO PA-DC-UNTS-CNT-ENROUTE    07850000
081400       ELSE                                                       07860000
081500           ADD 1                     TO PA-DC-TRBL-CNT-ARRIVED    07870000
081600           ADD TM001-RCVR-CART-CNT   TO PA-DC-CRTN-CNT-ARRIVED    07880000
081700           ADD TM001-RCVR-ITEM-QTY   TO PA-DC-UNTS-CNT-ARRIVED    07890000
081800       END-IF                                                     07900000
081900     END-IF.                                                      07910000
082000                                                                  07920000
082100     IF PS-FIRST-TIME-THRU OR PS-TRBL-RSN-CDE-CHANGED             07930000
082200         ADD 1                       TO PA-DC-POTRBL-CNT          07940000
082300         IF TM001-RECEIPT-DATE = 99990909                         07950000
082400             ADD 1                   TO PA-DC-POTRBL-CNT-ENROUTE  07960000
082500         ELSE                                                     07970000
082600             ADD 1                   TO PA-DC-POTRBL-CNT-ARRIVED  07980000
082700         END-IF                                                   07990000
082800         PERFORM 6300-ACCUMULATE-TROUBLE-TABLE                    08000000
082900     END-IF.                                                      08010000
083000                                                                  08020000
083100 6100-EXIT.  EXIT.                                                08030000
083200                                                                  08040000
083300 6200-PRINT-DETAILS.                                              08050000
083400     IF PV-LINE-COUNT > PC-LINE-LIMIT                             08060000
083500        SET PS-LINE-LIMIT-REACHED     TO TRUE                     08070000
083600        MOVE 0 TO PV-LINE-COUNT                                   08080000
083700        PERFORM 6900-PRINT-HEADINGS   THRU 6900-EXIT              08090000
083800     END-IF                                                       08100000
083900                                                                  08110000
084000      IF PS-DC-CHANGED                                            08120000
            OR PS-PROCESS-AREA-CHANGED                                  08130000
084100         PERFORM 6210-WRITE-PREVIOUS-DTL-REC  THRU 6210-EXIT      08140000
084200         IF TM001-FCLTY-AREA-ID = LOW-VALUE                       08150000
084300         OR TM001-FCLTY-AREA-ID = SPACE                           08160000
084400            MOVE PC-NOT-FND            TO DL1-PROCESS-AREA        08170000
084500                                          PV-SAVE-PROCESS-AREA    08180000
084600         ELSE                                                     08190000
084700            IF PS-PROCESS-AREA-NOT-CHANGED                        08200000
084800               MOVE SPACES TO DL1-PROCESS-AREA                    08210000
084900            ELSE                                                  08220000
085000               MOVE TM001-FCLTY-AREA-ID   TO DL1-PROCESS-AREA     08230000
085100                                          PV-SAVE-PROCESS-AREA    08240000
085200            END-IF                                                08250000
085300         END-IF                                                   08260000
085400         PERFORM 6215-MOVES                   THRU 6215-EXIT      08270000
085500         GO TO  6200-EXIT                                         08280000
085600     END-IF                                                       08290000
085700                                                                  08300000
085800      IF PS-PO-CHANGED OR PS-RECEIVER-CHANGED                     08310000
085900         PERFORM 6210-WRITE-PREVIOUS-DTL-REC  THRU 6210-EXIT      08320000
086000         MOVE SPACE                            TO DL1-PROCESS-AREA08330000
086100         PERFORM 6215-MOVES                   THRU 6215-EXIT      08340000
086200         GO TO  6200-EXIT                                         08350000
086300     END-IF                                                       08360000
086400                                                                  08370000
086500     IF PS-TRBL-RSN-CDE-CHANGED                                   08380000
086600         PERFORM 6210-WRITE-PREVIOUS-DTL-REC THRU 6210-EXIT       08390000
086700         MOVE SPACE                   TO DL1-PROCESS-AREA         08400000
086800         MOVE SPACE                   TO DL1-RECEIPT-DATE         08410000
086900         MOVE SPACE                   TO DL1-PO                   08420000
087000         MOVE SPACE                   TO DL1-DASH                 08430000
087100         MOVE SPACE                   TO DL1-RECEIVER             08440000
087200         MOVE SPACE                   TO DL1-VENDOR-NAME          08450000
087300         MOVE 0                       TO PA-TROUBL-CART-CONT      08460000
087400         MOVE 0                       TO PA-TROUBL-UNITS-COUNT    08470000
087500         MOVE TM001-TRBL-RSN-CDE-DESC TO DL1-TROUBLE-REASON       08480000
087600         MOVE TM001-NOTIF-MM          TO DL1-NOTIFY-MM            08490000
087700         MOVE TM001-NOTIF-DD          TO DL1-NOTIFY-DD            08500000
087800         MOVE TM001-NOTIF-YYYY        TO DL1-NOTIFY-YYYY          08510000
087900         MOVE SPACE                   TO DL1-BUYER-NAME           08520000
088000     END-IF.                                                      08530000
088100                                                                  08540000
088200 6200-EXIT.  EXIT.                                                08550000
088300                                                                  08560000
088400 6210-WRITE-PREVIOUS-DTL-REC.                                     08570000
088500     MOVE PA-TROUBL-CART-CONT     TO DL1-CARTON-COUNT             08580000
088600     MOVE PA-TROUBL-UNITS-COUNT   TO DL1-UNITS                    08590000
088700                                                                  08600000
088800     WRITE UNRESOLVED-TRBLE-RECORD                                08610000
088900      FROM DL1-DETAIL-LINE-1                                      08620000
089000           AFTER ADVANCING 1 LINE                                 08630000
089100     ADD 1    TO PV-LINE-COUNT.                                   08640000
089200                                                                  08650000
089300 6210-EXIT.  EXIT.                                                08660000
089400                                                                  08670000
089500 6215-MOVES.                                                      08680000
089600     IF TM001-RECEIPT-MM   = SPACE OR                             08690000
089700        TM001-RECEIPT-DD   = SPACE OR                             08700000
089800        TM001-RECEIPT-YYYY = SPACE                                08710000
089900        MOVE PC-NOT-FND   TO DL1-RECEIPT-DATE                     08720000
090000     ELSE                                                         08730000
090100        IF TM001-RECEIPT-DATE = 99990909                          08740000
090200            MOVE PC-ENROUTE TO DL1-RECEIPT-DATE                   08750000
090300        ELSE                                                      08760000
090400            STRING                                                08770000
090500                 TM001-RECEIPT-MM                                 08780000
090600                 '/'                                              08790000
090700                 TM001-RECEIPT-DD                                 08800000
090800                 '/'                                              08810000
090900                 TM001-RECEIPT-YYYY                               08820000
091000              DELIMITED BY SIZE                                   08830000
091100              INTO DL1-RECEIPT-DATE                               08840000
091200            END-STRING                                            08850000
091300        END-IF                                                    08860000
091400     END-IF                                                       08870000
091500     MOVE TM001-PO-NBR            TO DL1-PO                       08880000
091600     MOVE '-'                     TO DL1-DASH                     08890000
091700*    MOVE TM001-REC-SEQ-NBR       TO DL1-RECEIVER                 08900000
091800     MOVE TM001-REC-SEQ-NBR       TO PV-RECEIVER-HOLD             08910000
091900     MOVE PV-RECEIVER-NBR         TO DL1-RECEIVER                 08920000
092000     MOVE TM001-ENT-NAME-DESC     TO DL1-VENDOR-NAME              08930000
092100     MOVE 0                       TO PA-TROUBL-CART-CONT          08940000
092200     MOVE 0                       TO PA-TROUBL-UNITS-COUNT        08950000
092300     MOVE TM001-TRBL-RSN-CDE-DESC TO DL1-TROUBLE-REASON           08960000
092400     MOVE TM001-NOTIF-MM          TO DL1-NOTIFY-MM                08970000
092500     MOVE TM001-NOTIF-DD          TO DL1-NOTIFY-DD                08980000
092600     MOVE TM001-NOTIF-YYYY        TO DL1-NOTIFY-YYYY              08990000
092700     MOVE TM001-BYR-NAME          TO DL1-BUYER-NAME.              09000000
092800                                                                  09010000
092900 6215-EXIT.  EXIT.                                                09020000
093000                                                                  09030000
093100****************************************************************  09040000
093200*  IT IS A NEW REASON CODE...FIRST CHECK IF THE REASON CODE    *  09050000
093300*  ALREADY EXISTS ON THE TABLE.  IF SO ADD TO THAT RECORD,     *  09060000
093400*  OTHERWISE ADD A NEW RECORD WITH THIS TROUBLE REASON CODE.   *  09070000
093500****************************************************************  09080000
093600 6300-ACCUMULATE-TROUBLE-TABLE.                                   09090000
093700                                                                  09100000
093800     SET PA-TRBL-IDX TO 1.                                        09110000
093900     SEARCH PA-TROUBLE-COUNT-RECORD VARYING PA-TRBL-IDX           09120000
094000*        TABLE FULL -- DISPLAY ABEND ERROR                        09130000
094100         AT END                                                   09140000
094200              DISPLAY '****************************************'  09150000
094300                      '****************************************'  09160000
094400              DISPLAY '** ABEND -- TMKRP014                    '  09170000
094500                      '                                     ***'  09180000
094600              DISPLAY '** PARAGRAPH:  6300-ACCUMULATE-TROUBLE-T'  09190000
094700                      'ABLE                                 ***'  09200000
094800              DISPLAY '** TABLE OVERFLOW ERROR ON INTERNAL TABL'  09210000
094900                    'E: ''PA-TROUBLE-COUNT-TABLE''          ***'  09220000
095000              DISPLAY '****************************************'  09230000
095100                      '****************************************'  09240000
095200              MOVE +4004 TO PV-ABEND-CODE                         09250000
095300              CALL 'ILBOABN0' USING PV-ABEND-CODE                 09260000
095400                                                                  09270000
095500*        IF THIS REASON CODE IS NOT ON THE TABLE, ADD IT          09280000
095600         WHEN PA-TRBL-RSN-DESC(PA-TRBL-IDX) = SPACES              09290000
095700             MOVE TM001-TRBL-RSN-CDE-DESC                         09300000
095800                                 TO PA-TRBL-RSN-DESC(PA-TRBL-IDX) 09310000
095900             SET PV-MAX-SUB TO PA-TRBL-IDX                        09320000
096000                                                                  09330000
096100*        THIS REASON CODE IS ALREADY ON THE TABLE...EXIT SEARCH   09340000
096200         WHEN PA-TRBL-RSN-DESC(PA-TRBL-IDX)                       09350000
096300                                  = TM001-TRBL-RSN-CDE-DESC       09360000
096400             NEXT SENTENCE                                        09370000
096500     END-SEARCH.                                                  09380000
096600                                                                  09390000
096700*    ADD TO THE COUNTS FOR THE CURRENT REASON CODE                09400000
096800     ADD +1                  TO PA-TRBL-CNT(PA-TRBL-IDX).         09410000
096900                                                                  09420000
097000     IF TM001-RECEIPT-DATE = 99990909                             09430000
097100         ADD +1              TO PA-TRBL-CNT-ENROUTE(PA-TRBL-IDX)  09440000
097200     ELSE                                                         09450000
097300         ADD +1              TO PA-TRBL-CNT-ARRIVED(PA-TRBL-IDX)  09460000
097400     END-IF.                                                      09470000
097500                                                                  09480000
097600                                                                  09490000
097700                                                                  09500000
097800 6400-SORT-TROUBLE-TABLE.                                         09510000
097900******************************************************************09520000
098000*    THIS PARAGRAPH CALLS 6410 TO BUBBLE SORT THE TROUBLE TABLE   09530000
098100******************************************************************09540000
098200                                                                  09550000
098300     MOVE 1 TO PV-SUB-1.                                          09560000
098400                                                                  09570000
098500     PERFORM 6410-BUBBLE-SORT                                     09580000
098600       UNTIL PV-SUB-1 NOT < PV-MAX-SUB.                           09590000
098700                                                                  09600000
098800                                                                  09610000
098900 6410-BUBBLE-SORT.                                                09620000
099000******************************************************************09630000
099100*    THIS PARAGRAPH CALLS 6411 TO SORT THE REASON CODE TABLE.     09640000
099200******************************************************************09650000
099300     COMPUTE PV-SUB-2 = PV-SUB-1 + 1.                             09660000
099400                                                                  09670000
099500     PERFORM 6411-LOOP-BUBBLE-SORT                                09680000
099600       UNTIL PV-SUB-2 > PV-MAX-SUB.                               09690000
099700                                                                  09700000
099800     ADD 1 TO PV-SUB-1.                                           09710000
099900                                                                  09720000
100000                                                                  09730000
100100 6411-LOOP-BUBBLE-SORT.                                           09740000
100200******************************************************************09750000
100300*    THIS PARAGRAPH SORTS THE REASON CODE TABLE IN DESCENDING     09760000
100400*    ORDER OF THE TROUBLE COUNT                                   09770000
100500******************************************************************09780000
100600                                                                  09790000
100700     IF PA-TRBL-CNT (PV-SUB-1) < PA-TRBL-CNT (PV-SUB-2)           09800000
100800         MOVE PA-TROUBLE-COUNT-RECORD (PV-SUB-1)                  09810000
100900                                     TO PV-TEMP-TROUBLE-RECORD    09820000
101000         MOVE PA-TROUBLE-COUNT-RECORD (PV-SUB-2)                  09830000
101100                           TO  PA-TROUBLE-COUNT-RECORD (PV-SUB-1) 09840000
101200         MOVE PV-TEMP-TROUBLE-RECORD                              09850000
101300                           TO  PA-TROUBLE-COUNT-RECORD (PV-SUB-2) 09860000
101400     END-IF.                                                      09870000
101500                                                                  09880000
101600     ADD 1 TO PV-SUB-2.                                           09890000
101700                                                                  09900000
101800 6500-PRINT-TROUBLE-TABLE.                                        09910000
101900******************************************************************09920000
102000*    THIS PARAGRAPH WILL PRINT THE TROUBLE REASON CODE TABLE      09930000
102100******************************************************************09940000
102200                                                                  09950000
102300     MOVE +1       TO PV-SUB-1.                                   09960000
102400                                                                  09970000
102500     DIVIDE PV-MAX-SUB BY 2                                       09980000
102600         GIVING PV-HALF-SUB                                       09990000
102700         REMAINDER PV-REMAINDER                                   10000000
102800     END-DIVIDE.                                                  10010000
102900                                                                  10020000
103000     COMPUTE PV-SUB-2 = PV-HALF-SUB + PV-REMAINDER + 1.           10030000
103100                                                                  10040000
103200     IF  PV-REMAINDER > 0                                         10050000
103300         ADD +1 TO PV-HALF-SUB                                    10060000
103400     END-IF.                                                      10070000
103500                                                                  10080000
103600*    WRITE THE RECAP HEADING LINES                                10090000
103700     WRITE UNRESOLVED-TRBLE-RECORD                                10100000
103800         FROM TRH-TROUBLE-RECAP-HEADING-1                         10110000
103900         AFTER ADVANCING 2 LINES.                                 10120000
104000     ADD 2   TO PV-LINE-COUNT.                                    10130000
104100     WRITE UNRESOLVED-TRBLE-RECORD                                10140000
104200         FROM TRH-TROUBLE-RECAP-HEADING-2                         10150000
104300         AFTER ADVANCING 1 LINES.                                 10160000
104400     ADD 1   TO PV-LINE-COUNT.                                    10170000
104500                                                                  10180000
104600*    DUMP ALL THE REASON CODES FROM THE TROUBLE COUNT TABLE       10190000
104700     PERFORM UNTIL PV-SUB-1 > PV-HALF-SUB                         10200000
104800         MOVE PA-TRBL-RSN-DESC (PV-SUB-1)                         10210000
104900                   TO TRD1-TROUBLE-DESC                           10220000
105000         MOVE PA-TRBL-CNT (PV-SUB-1)                              10230000
105100                   TO TRD1-TRBL-CNT                               10240000
105200         MOVE PA-TRBL-CNT-ENROUTE (PV-SUB-1)                      10250000
105300                   TO TRD1-TRBL-CNT-ENROUTE                       10260000
105400         MOVE PA-TRBL-CNT-ARRIVED (PV-SUB-1)                      10270000
105500                   TO TRD1-TRBL-CNT-ARRIVED                       10280000
105600                                                                  10290000
105700         ADD +1 TO PV-SUB-1                                       10300000
105800                                                                  10310000
105900*        IF THE NEXT RECORD IS VALID, PRINT IT, OTHERWISE PRINT   10320000
106000*        SPACES                                                   10330000
106100         IF PV-SUB-2 <= PV-MAX-SUB                                10340000
106200             MOVE PA-TRBL-RSN-DESC (PV-SUB-2)                     10350000
106300                   TO TRD2-TROUBLE-DESC                           10360000
106400             MOVE PA-TRBL-CNT (PV-SUB-2)                          10370000
106500                   TO TRD2-TRBL-CNT                               10380000
106600             MOVE PA-TRBL-CNT-ENROUTE (PV-SUB-2)                  10390000
106700                   TO TRD2-TRBL-CNT-ENROUTE                       10400000
106800             MOVE PA-TRBL-CNT-ARRIVED (PV-SUB-2)                  10410000
106900                   TO TRD2-TRBL-CNT-ARRIVED                       10420000
107000             ADD +1 TO PV-SUB-2                                   10430000
107100         ELSE                                                     10440000
107200             MOVE SPACES TO TRD2-TROUBLE-RECAP-REC                10450000
107300         END-IF                                                   10460000
107400                                                                  10470000
107500* IF THE RECAP RUNS OFF THE END OF THE PAGE, GO ON TO THE NEXT ONE10480000
107600         IF PV-LINE-COUNT  > PC-LINE-LIMIT                        10490000
107700            SET PS-LINE-LIMIT-REACHED     TO TRUE                 10500000
107800            MOVE 0 TO PV-LINE-COUNT                               10510000
107900            PERFORM 6900-PRINT-HEADINGS   THRU 6900-EXIT          10520000
108000         END-IF                                                   10530000
108100                                                                  10540000
108200         WRITE UNRESOLVED-TRBLE-RECORD                            10550000
108300             FROM TRD-TROUBLE-RECAP-DETAIL-LINE                   10560000
108400             AFTER ADVANCING 1 LINE                               10570000
108500         ADD 1   TO PV-LINE-COUNT                                 10580000
108600                                                                  10590000
108700     END-PERFORM.                                                 10600000
108800                                                                  10610000
108900                                                                  10620000
109000 6910-GET-FCLTY-NAME.                                             10630000
109099     INITIALIZE XL071-COMMAREA-REC.                               10640002
109100     MOVE TM001-OPER-UNT-ID   TO PV-OPER-UNT-ID-SAVE              10640102
109110                                 XL071-LOCATION-NUMBER.           10641002
109200     MOVE PV-OPER-UNT-ID-SAVE TO PV-OPER-UNT-ID-GROUP.            10650000
109300                                                                  10660002
109400     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC.         10670002
109900                                                                  10720000
110100     EVALUATE TRUE                                                10740000
110200         WHEN XL071-NO-ERRORS                                     10750002
110300           CONTINUE                                               10760000
110400         WHEN XL071-LOC-NOT-FOUND                                 10770006
110500         WHEN XL071-SQLCODE-N = -904                              10780006
110600         WHEN XL071-SQLCODE-N = -913                              10790006
110700             MOVE PC-NOT-FND TO HL3-DC-NAME                       10800002
110800         WHEN XL071-BAD-DB2-RETURN                                10810002
111100              MOVE XL071-SQLCODE TO PV-ABEND-SQLCODE              10840003
111100              DISPLAY '** ABEND ** IN TMKRP014'                   10841002
111200              DISPLAY 'PARAGRAPH:6910-GET-FCLTY-NAME'             10850000
111200              DISPLAY 'SQLCODE  : ' PV-ABEND-SQLCODE              10851002
111300              DISPLAY                                             10860000
111400             'MESSAGE:  SQL ERROR SELECTING FROM XLT_LOC'         10870002
111500              PERFORM 9999-SQL-ERROR   THRU 9999-EXIT             10880000
111600     END-EVALUATE.                                                10890000
111700 6910-EXIT.  EXIT.                                                10900000
111800                                                                  10910000
111900                                                                  10920000
112000 6900-PRINT-HEADINGS.                                             10930000
112100                                                                  10940000
112200     MOVE 0                    TO PV-LINE-COUNT.                  10950000
112300     ADD 1                     TO PV-PAGE-COUNT.                  10960000
112400     MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    10970000
112500     WRITE UNRESOLVED-TRBLE-RECORD                                10980000
112600           FROM DP132O-STANDRD-HEADER-132-COLS                    10990000
112700                AFTER ADVANCING PAGE                              11000000
112800*    WRITE UNRESOLVED-TRBLE-RECORD                                11010000
112900*          FROM HL-STATUS-HEADING-LINE                            11020000
113000*          AFTER ADVANCING 2 LINES                                11030000
113100     WRITE UNRESOLVED-TRBLE-RECORD                                11040000
113200      FROM HL1-HEADING-LINE-1                                     11050000
113300           AFTER ADVANCING 2 LINES                                11060000
113400     WRITE UNRESOLVED-TRBLE-RECORD                                11070000
113500      FROM HL2-HEADING-LINE-2                                     11080000
113600           AFTER ADVANCING 1 LINE                                 11090000
113700     ADD 3    TO PV-LINE-COUNT                                    11100000
113800                                                                  11110000
113900     MOVE  PV-SAVE-PROCESS-AREA   TO DL1-PROCESS-AREA             11120000
114000                                                                  11130000
114100     IF PS-NO-DETAILS                                             11140000
114200        WRITE UNRESOLVED-TRBLE-RECORD                             11150000
114300                 FROM NI-NO-INFORMATION-LINE                      11160000
114400                        AFTER ADVANCING 2 LINES                   11170000
114500        GO TO 6900-EXIT                                           11180000
114600     END-IF.                                                      11190000
114700                                                                  11200000
114800*    THE SECOND CLAUSE (PS-PRINT-DETAIL-HEAD) WILL PREVENT THIS   11210000
114900*    PARAGRAPH FROM SELECTING THE NEXT DC NAME WHEN PRINTING THE  11220000
115000*    PC TOTAL PAGE (THE CURRENT RECORD AT THIS TIME IS FOR THE    11230000
115100*    NEXT DC, AND WE WANT TO DISPLAY THE OLD DC)                  11240000
115200     IF ((PS-DC-CHANGED AND NOT PS-LINE-LIMIT-REACHED)            11250000
115300     OR HL3-DC-NAME = SPACES)                                     11260000
115400     AND PS-PRINT-DETAIL-HEAD                                     11270000
115500        PERFORM 6910-GET-FCLTY-NAME    THRU 6910-EXIT             11280000
115600        MOVE XL071-LOC-5-ABBR-NM       TO HL3-DC-NAME             11290002
115700     END-IF.                                                      11300000
115800                                                                  11310000
115900     WRITE UNRESOLVED-TRBLE-RECORD                                11320000
116000                   FROM HL3-HEADING-LINE-3                        11330000
116100                        AFTER ADVANCING 3 LINES.                  11340000
116200     ADD 3   TO PV-LINE-COUNT.                                    11350000
116300                                                                  11360000
116400     IF (PS-PROCESS-AREA-CHANGED                                  11370000
           OR PS-LINE-LIMIT-REACHED)                                    11380000
116500     AND PS-PRINT-DETAIL-HEAD                                     11390000
116600        WRITE UNRESOLVED-TRBLE-RECORD                             11400000
116700                      FROM HL4-HEADING-LINE-4                     11410000
116800                           AFTER ADVANCING 2 LINES                11420000
116900        ADD 2   TO PV-LINE-COUNT                                  11430000
117000        WRITE UNRESOLVED-TRBLE-RECORD                             11440000
117100                      FROM HL5-HEADING-LINE-5                     11450000
117200                           AFTER ADVANCING 1 LINE                 11460000
117300        ADD 1   TO PV-LINE-COUNT                                  11470000
117400        WRITE UNRESOLVED-TRBLE-RECORD                             11480000
117500                      FROM BL-BLANK-LINE                          11490000
117600                           AFTER ADVANCING 1 LINE                 11500000
117700        ADD 1   TO PV-LINE-COUNT                                  11510000
117800     END-IF.                                                      11520000
117900                                                                  11530000
118000     IF PS-LINE-LIMIT-REACHED                                     11540000
118100        SET PS-LINE-LIMIT-NOT-REACHED TO TRUE                     11550000
118200     END-IF.                                                      11560000
118300                                                                  11570000
118400 6900-EXIT.   EXIT.                                               11580000
118500                                                                  11590000
118600 9000-END-PROCESS.                                                11600000
118700     CLOSE  TROUBLE-EXTRACT-FILE                                  11610000
118800            UNRESOLVED-TROUBLE-REPORT.                            11620000
118900 9000-EXIT.  EXIT.                                                11630000
119000                                                                  11640000
119100 9999-SQL-ERROR.                                                  11650000
119200                                                                  11660000
119300     COPY DPPD004.                                                11670000
119400                                                                  11680000
119500     MOVE +4013 TO PV-ABEND-CODE.                                 11690000
119600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         11700000
119700 9999-EXIT.   EXIT.                                               11710000
119800                                                                  11720000
