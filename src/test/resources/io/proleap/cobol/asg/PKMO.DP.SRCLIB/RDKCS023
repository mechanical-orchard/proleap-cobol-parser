000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    RDKCS023.                                         00040000
000500 AUTHOR.        PAT DOYLE - IBS.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  03-15-96.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    U023 - MANUAL REFERRAL SCREEN.                             * 00110000
001200*                                                               * 00120000
001300*    THIS SCREEN HAS 4 DIFFERENT PURPOSES PERTAINING TO THE     * 00130018
001400*    KOHLS MERCHANDISE CARD (ALSO KNOWN AS DUE BILL):           * 00140000
001500*    1) AUDIT - ALLOWS THE AUDIT DEPARTMENT TO UPDATE PREVIOUS  * 00150000
001600*       TRANSACTIONS AS WELL AS ADD TRANSACTIONS.               * 00160000
001700*    2) REFERRAL - ALLOWS THE LOSS PREVENTION DEPARTMENT TO     * 00170000
001800*       MANUALLY AUTHORIZE TRANSACTIONS WHEN THE AUTOMATED      * 00180000
001900*       REFERRAL SYSTEM IS DOWN.                                * 00190000
002000*    3) VOID - ALLOWS TRANSACTIONS TO BE VOIDED.  THIS CAN BE   * 00200000
002100*       DONE BY ENTERING THE SCREEN THROUGH THE 'VOID'          * 00210000
002200*       FUNCTION KEY FROM THE CRITERIA SPEC SCREEN, OR BY       * 00220000
002300*       REQUESTING A VOID UNDER OPTIONS (1) OR (2) ABOVE.       * 00230000
002400*    4) REV VOID - ALLOWS TRANSACTIONS TO BE UNVOIDED.  THIS CAN* 00240018
002500*       BE DONE BY ENTERING THE SCREEN THROUGH THE 'VOID'       * 00250018
002600*       FUNCTION KEY FROM THE CRITERIA SPEC SCREEN, OR BY       * 00260018
002700*       REQUESTING A REV VOID UNDER OPTIONS (1) OR (2) ABOVE.   * 00270018
002800*                                                               * 00280000
002900*    NOTE:  THIS SCREEN IS AN 'UPDATABLE LIST', SO IT DOES NOT  * 00290000
003000*    STRICTLY FOLLOW THE ARCHITECTURE TEMPLATE PROGRAM.  IT IS  * 00300000
003100*    A MODIFIED VERSION OF THE REGULAR LIST PROGRAM.            * 00310000
003200*---------------------------------------------------------------* 00320000
003300*-  08/19/96 - AJR - RETREIVED CONTROL NUMBER TO BE DISPLAYED ON* 00330000
003400*-                   THE SCREEN AND PASSED TO THE NEXT PROGRAMS.* 00340000
003500*---------------------------------------------------------------* 00350000
003600*   12/09/96 - KARI SUTTON - WR# 4197                           * 00360000
003700*   - REARRANGED THE SCREEN TO MAKE THE APPROVAL NUMBER A PART  * 00370000
003800*     OF THE SCROLLABLE LIST, INSTEAD OF BEING A PART OF THE    * 00380000
003900*     HEADER INFORMATION.  THE APPROVAL NUMBER FOR THE TRANS-   * 00390000
004000*     ACTION IN  PROGRESS WILL NOT BE CALCULATED AND DISPLAYED  * 00400000
004100*     UNTIL THE F2 CONFIRM IS PRESSED (THE WAY THE HEADER WORKED* 00410000
004200*     BEFORE THIS CHANGE).                                      * 00420000
004300*   - ADDED TABLE TKMCCOM TO THE PROGRAM TO GET THE MOST CURRENT* 00430018
004400*     COMMENT ASSOCIATED WITH THE CARD, IF ANY, AND DISPLAY THE * 00440000
004500*     COMMENT AT THE BOTTOM OF THE SCREEN.                      * 00450000
004600*   - WHENEVER CONTROL IS RETURNED BACK TO THIS PROGRAM OR THE  * 00460000
004700*     REFRESH KEY IS PRESSED, THE COMMENT IS REFRESHED WITH THE * 00470000
004800*     MOST CURRENT.                                             * 00480000
004900*   - ADDED LOGIC TO TRANSFER TO THE COMMENT SCREEN IN ADD MODE.* 00490000
005000*   - ADDED LOGIC TO ONLY KEEP THE LAST SIX DIGITS OF THE       * 00500000
005100*     DRIVERS LICENSE WHEN INSERTED ON ISSUE.                   * 00510000
005200*   - ADDED A SELECT STATEMENT AFTER THE INSERT STATEMENTS IN   * 00520000
005300*     8300-REFER-INSERT AND 8200-AUDIT-INSERT TO GET THE        * 00530000
005400*     TIMESTAMP FROM THE INSERT AND MOVE IT TO THE ASC-TRN-AUTH-* 00540000
005500*     TMST.  WHEN THE DETAIL FUNCTION KEY IS PRESSED, THE       * 00550000
005600*     SELECTION QUEUE NEEDS THE AUTHORIZATION TIMESTAMP TO BE   * 00560000
005700*     PASSED TO THE DETAIL PROGRAM (RDKCS026).                  * 00570000
005800*---------------------------------------------------------------* 00580000
005900*   03/10/97 - CHRISTINE MALONE - WR# 4303                      * 00590000
006000*     CASH BACK MAY BE ISSUED ONLY IN AN APPROVAL SITUATION.    * 00600000
006100*     CHANGED THE PROGRAM TO SEND AND INDICATION TO RDPD000     * 00610000
006200*     THAT WE ARE COMING FROM RDKCS023 THEREFORE, CASH BACK     * 00620000
006300*     MAY NOT BE ISSUED.                                        * 00630000
006400*---------------------------------------------------------------* 00640000
006500*   04/15/97 - CHRISTINE MALONE - KMRC CASH BACK                * 00650000
006600*     CHANGED THE PROGRAM TO ALLOW CASH BACK, EXCEPT WHEN IN    * 00660000
006700*     THE AUDIT FUNCTION, BY SENDING AN INDICATION TO RDPD000.  * 00670000
006800*---------------------------------------------------------------* 00680000
006900*   06/17/97 - CHRISTINE MALONE - WR# 5220 - GIFT CARDS         * 00690000
007000*   - RETRIEVED CARD TYPE FROM TSVT00001 IN ORDER TO DISPLAY ON * 00700018
007100*     THE SCREEN AND PASS TO THE NEXT PROGRAMS.                 * 00710000
007200*   - INCREASED THE CARD ID LENGTH TO 13 DIGITS.  THE LONGER    * 00720000
007300*     CARD ID WILL BE DISPLAYED ON THE SCREEN.                  * 00730000
007400*   - MADE CHANGES TO ALLOW A 2, ISSUE GIFT CARD TO BE DISPLAYED* 00740000
007500*     IN THE ACTIVITY TYPE FIELD.                               * 00750000
007600*   - ADDED CODE TO EDIT THE ACTIVITY TYPE AGAINST THE CARD TYPE* 00760000
007700*     IF A KMRC CARD IS BEING ISSUED, THE ID ENTERED MUST BE A  * 00770000
007800*     KMRC CARD TYPE ON THE SVT_KOHLS_CRD_ACCT.                 * 00780018
007900*     SIMULAR LOGIC FOR ISSUING A GIFT CARD.*                     00790018
008000*---------------------------------------------------------------* 00800018
008100*   03/13/98 - SCOTT BARTELT - WR# 5942                         * 00810018
008200*     ADDED THE 'REV VOID' FUNCTION.  THIS WILL ALLOW A USER TO * 00820018
008300*     "UNDO" A VOID WHICH WAS PREVIOUSLY MADE.  WHEN THE 'REV   * 00830018
008400*     VOID' FUNCTION KEY IS PRESSED THE VOIDED TRANSACTION AND  * 00840018
008500*     THE CORRESPONDING REVERSAL WILL BE HILIGHTED IN YELLOW.   * 00850018
008600*     UPON A SECOND 'REV VOID' FUNCTION KEY DEPRESSION, THE     * 00860018
008700*     TRN_VOID_IND WILL BE CHANGED TO SPACES ON THE ORIGINAL    * 00870018
008800*     TRANSACTION, AND THE REVERSAL WHICH WAS CREATED WILL BE   * 00880018
008900*     DELETED.                                                  * 00890018
009000*---------------------------------------------------------------* 00900018
009100*   12/21/98 - DAVE MUSKAT (COMPUWARE) - WR# 6041               * 00910018
009200*     CHANGES FOR Y2K:                                          * 00920018
009300*     ADDED A CENTURY FIELD (PV-TRAN-CC) TO THE DATE DEFINED    * 00930018
009400*     UNDER PV-TRAN-ID.  ADDED CODE TO POPULATE THE NEW CENTURY * 00940018
009500*     FIELD WITH EXISTING FIELD PV-DB2-CC.  THE MAPSET FIELDS   * 00950018
009600*     THAT DISPLAY PV-TRAN-ID WERE EXPANDED TO DISPLAY THE NEW  * 00960018
009700*     CENTURY FIELD.                                            * 00970018
009800*     REMOVED NON-STANDARD CODING TO CALL THE KOHLS CALENDAR    * 00980018
009900*     ROUTINE.  ADDED STANDARD CODING TO CALL THE KOHLS         * 00990018
010000*     CALENDAR ROUTINE.                                         * 01000018
010100*---------------------------------------------------------------* 01010018
010200*   05/13/99 - DAVE MUSKAT (COMPUWARE) - WR# COSA               * 01020018
010300*     CHANGES FOR COSA:                                         * 01030018
010400*     FIXED AN INCONSTISTENCY IN THE VOID REVERSAL PROCESSING:  * 01040018
010500*     WHEN FORMATTING THE DCLGEN TO INSERT THE VOID REVERSAL    * 01050018
010600*     ROW INTO SVT_KOHLS_CRD_TXN,                                 01060018
010700*                       THE "NEW" KMCACT-APP-AUTH-AMT WAS       * 01070018
010800*     GETTING MOVED TO THE "NEW" KMCACT-ORIG-AUTH-AMT.          * 01080018
010900*     THIS WAS CHANGED TO OBTAIN THE "NEW" KMCACT-ORIG-AUTH-AMT * 01090018
011000*     BY MULTIPLYING THE "ORIGINAL" KMCACT-ORIG-AUTH-AMT BY -1. * 01100018
011100*     TO DO THIS, KMCACT-ORIG-AUTH-AMT HAD TO BE ADDED TO THE   * 01110018
011200*     CARD-CSR CURSOR, AND NEW FIELD ASC-ORIG-AUTH-AMT HAD TO   * 01120018
011300*     BE ADDED TO HOLD THE "ORIGINAL" KMCACT-ORIG-AUTH-AMT.     * 01130018
011400*     ALSO, ADDED SETTING OF NEW INDICATOR SV005-VOID-IND TO    * 01140018
011500*     CONDITION SV005-NOT-VOID PRIOR TO PERFORM OF PRARAGRAPH   * 01150018
011600*     SV005-A100-MAINLINE.                                      * 01160018
011700*---------------------------------------------------------------* 01170018
011800*   05/17/99 - AMY REILAND - PITS:                              * 01180018
011900*     CHANGED PROGRAM TO ALLOW AUDIT VOIDS ON CARDS IN ANY      * 01190018
012000*     STATUS CODE.                                              * 01200018
012100*---------------------------------------------------------------* 01210018
012200*   01-30-2014 -  COGNIZANT                                       01220018
012300*     ACTIVITY STATUS CODE HAS BEEN CHANGED TO VERIFIED STATUS    01230018
012400*     FOR ALL TRANSACTIONS ENTERED THROUGH ONLINE AND POSTED      01240018
012500*     TIMESTAMP FIELD OF SVT_KOHLS_CRD_TXN TABLE WILL BE INSERTED 01250018
012600*     WITH CURRENT TIMESTAMP                                      01260018
012700******************************************************************01270034
012800*---------------------------------------------------------------* 01280018
012900*   03-17-2014 - COGNIZANT                                        01290018
013000*     FIXED THE TIMESTAMP ISSUE (SQLCODE -180) WHEN THE           01300018
013100*     RECORDS ARE INSERTED                                        01310018
013200******************************************************************01320018
013300* 9/19/15        JIM ARENDT   CHG0124679                          01330032
013400*  AS PART OF THE LP REFUND REMEDIATION PROJECT USERS CAN NOW     01340032
013500*  ENTER EITHER THE FULL ENCRYPTED OR UN-ENCRYPTED DRIVERS LICENSE01350032
013600*  NUMBER.                                                        01360032
013700******************************************************************01370032
013800* 9/20/18        JIM HUNTER   CHG0208819                          01380034
013900*  MAINFRAME REFACTORING - REPLACE CGU042MC WITH DPWS036.         01390034
013901******************************************************************01390136
013910* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 01391036
013920*            - CHANGE CALL OF DPKUT100 TO                       * 01392036
013930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 01393036
013940*              MAKING THE CALL DYNAMIC VS STATIC                * 01394036
013950*                                                               * 01395036
013960*---------------------------------------------------------------* 01396036
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293         01397037
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        01398037
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       01399037
014000******************************************************************01400034
014100 ENVIRONMENT DIVISION.                                            01410018
014200                                                                  01420018
014300 DATA DIVISION.                                                   01430018
014400                                                                  01440018
014500 WORKING-STORAGE SECTION.                                         01450018
014600                                                                  01460018
014700 01  DK-DB2-KEYS.                                                 01470018
014800     05  DK-CARD-ID                     PIC S9(12)V VALUE ZEROS   01480018
014900                                                    COMP-3.       01490018
015000     05  DK-POS-DATE-ISO                PIC  X(10).               01500018
015100     05  DK-ACTIVITY-TYPE               PIC S9(01)  COMP-3.       01510018
015200     05  DK-STORE-NBR                   PIC S9(04)  COMP.         01520018
015300     05  DK-TERMINAL                    PIC S9(04)  COMP.         01530018
015400     05  DK-TRANSACTION                 PIC S9(04)  COMP.         01540018
015500     05  DK-AMOUNT-REQUESTED            PIC S9(07)V99 COMP-3.     01550018
015600     05  DK-TRN-AUTH-TMST               PIC  X(26).               01560018
015700*        SAVE REVERSE VOID DATA                                   01570018
015800     05  DK-DELETE-AMOUNT               PIC S9(07)V99 COMP-3.     01580018
015900     05  DK-DELETE-TMST                 PIC  X(26).               01590018
016000     05  DK-UPDTE-AMOUNT                PIC S9(07)V99 COMP-3.     01600018
016100     05  DK-UPDTE-TMST                  PIC  X(26).               01610018
016200     05  DK-CURR-TMST                   PIC  X(26).               01620018
016300     05  DK-DRV-LIC-NBR-LONG            PIC  X(50)  VALUE SPACE.  01630031
016400                                                                  01640018
016500 01  PC-PROGRAM-CONSTANTS.                                        01650018
016600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01660018
016700                                                    'RD023A  '.   01670018
016800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01680018
016900                                                    'RDKM023 '.   01690018
017000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01700018
017100                                                    'RDKCS023'.   01710018
017200     05  PC-OPERATING-COMPANY           PIC  X(02)  VALUE '03'.   01720018
017300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01730018
017400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      01740018
017500     05  PC-AUDIT-VOID-FORMAT           PIC  X(01)  VALUE '2'.    01750018
017600     05  PC-REFERRAL-FORMAT             PIC  X(01)  VALUE '3'.    01760018
017700     05  PC-REFER-VOID-FORMAT           PIC  X(01)  VALUE '4'.    01770018
017800     05  PC-AUDIT-FORMAT                PIC  X(01)  VALUE '5'.    01780018
017900     05  PC-CORPEJ-FORMAT               PIC  X(01)  VALUE '6'.    01790018
018000     05  PC-INSERT-AUTH                 PIC  X(08)  VALUE         01800018
018100                                                    'RDINSRT'.    01810018
018200     05  PC-ADD-VALUE-AUTH              PIC  X(08)  VALUE         01820022
018300                                                    'RDADDVAL'.   01830022
018400     05  PC-TENDER-AUTH                 PIC  X(08)  VALUE         01840024
018500                                                    'RDTENDER'.   01850024
018600     05  PC-VOID-AUTH                   PIC  X(08)  VALUE         01860022
018700                                                    'RDVOID'.     01870022
018800     05  PC-REV-VOID-AUTH               PIC  X(08)  VALUE         01880018
018900                                                    'RDREVVD'.    01890018
019000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +08     01900018
019100                                                    COMP SYNC.    01910018
019200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01920018
019300                                                    COMP SYNC.    01930018
019400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01940018
019500                                                    +1000000      01950018
019600                                                    COMP-3.       01960018
019700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01970018
019800                                                    COMP SYNC.    01980018
019900     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    01990018
020000                                                                  02000018
020100     05  PC-MAX-TRIES                   PIC S9(03)  VALUE 7       02010018
020200                                                    COMP-3.       02020018
020300     05  PC-TSYMSG-NUMBERS.                                       02030018
020400         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  02040018
020500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  02050018
020600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  02060018
020700         10  PC-TSYMSG-00009            PIC  9(05)  VALUE 00009.  02070018
020800         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.  02080018
020900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  02090018
021000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  02100018
021100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  02110018
021200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  02120018
021300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  02130018
021400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  02140018
021500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  02150018
021600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  02160018
021700         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  02170018
021800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  02180018
021900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  02190018
022000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  02200018
022100         10  PC-TSYMSG-00233            PIC  9(05)  VALUE 00233.  02210018
022200         10  PC-TSYMSG-00234            PIC  9(05)  VALUE 00234.  02220018
022300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  02230018
022400         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  02240018
022500         10  PC-TSYMSG-00342            PIC  9(05)  VALUE 00342.  02250018
022600         10  PC-TSYMSG-00778            PIC  9(05)  VALUE 00778.  02260018
022700         10  PC-TSYMSG-01210            PIC  9(05)  VALUE 01210.  02270018
022800         10  PC-TSYMSG-01228            PIC  9(05)  VALUE 01228.  02280018
022900         10  PC-TSYMSG-01229            PIC  9(05)  VALUE 01229.  02290018
023000         10  PC-TSYMSG-01230            PIC  9(05)  VALUE 01230.  02300018
023100         10  PC-TSYMSG-01231            PIC  9(05)  VALUE 01231.  02310018
023200         10  PC-TSYMSG-01232            PIC  9(05)  VALUE 01232.  02320018
023300         10  PC-TSYMSG-01233            PIC  9(05)  VALUE 01233.  02330018
023400         10  PC-TSYMSG-01235            PIC  9(05)  VALUE 01235.  02340018
023500         10  PC-TSYMSG-01236            PIC  9(05)  VALUE 01236.  02350018
023600         10  PC-TSYMSG-01237            PIC  9(05)  VALUE 01237.  02360018
023700         10  PC-TSYMSG-01243            PIC  9(05)  VALUE 01243.  02370018
023800         10  PC-TSYMSG-01257            PIC  9(05)  VALUE 01257.  02380018
023900         10  PC-TSYMSG-01263            PIC  9(05)  VALUE 01263.  02390018
024000         10  PC-TSYMSG-01266            PIC  9(05)  VALUE 01266.  02400018
024100         10  PC-TSYMSG-01280            PIC  9(05)  VALUE 01280.  02410018
024200         10  PC-TSYMSG-01281            PIC  9(05)  VALUE 01281.  02420018
024300         10  PC-TSYMSG-01602            PIC  9(05)  VALUE 01602.  02430018
024400         10  PC-TSYMSG-01603            PIC  9(05)  VALUE 01603.  02440000
024500         10  PC-TSYMSG-01694            PIC  9(05)  VALUE 01694.  02450018
024600         10  PC-TSYMSG-01695            PIC  9(05)  VALUE 01695.  02460018
024700         10  PC-TSYMSG-01696            PIC  9(05)  VALUE 01696.  02470018
024800         10  PC-TSYMSG-02530            PIC  9(05)  VALUE 02530.  02480018
024900         10  PC-TSYMSG-03762            PIC  9(05)  VALUE 03762.  02490020
025000         10  PC-TSYMSG-03763            PIC  9(05)  VALUE 03763.  02500023
025100         10  PC-TSYMSG-03764            PIC  9(05)  VALUE 03764.  02510024
025200         10  PC-TSYMSG-99904            PIC  9(05)  VALUE 99904.  02520000
025300         10  PC-TSYMSG-99910            PIC  9(05)  VALUE 99910.  02530018
025400     05  PC-1                           PIC  9(01)  VALUE 1.      02540000
025500                                                                  02550018
025600 01  TB-TABLE-CONTROL-NUMBER.                                     02560018
025700     05  TB-CNTL-NBR99           PIC  9(14).                      02570018
025800     05  TB-CONTROL-NBR9 REDEFINES TB-CNTL-NBR99.                 02580018
025900         10  TB-CRD-PROD-YR9     PIC  9(04).                      02590018
026000         10  TB-SHIPT-REQ-NBR9   PIC  9(04).                      02600018
026100         10  TB-CNTL-NBR9        PIC  9(06).                      02610018
026200                                                                  02620018
026300 01  PS-PROGRAM-SWITCHES.                                         02630000
026400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02640000
026500         88  PS-NO-ERROR                            VALUE 'Y'.    02650000
026600         88  PS-ERROR                               VALUE 'N'.    02660000
026700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02670000
026800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02680000
026900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02690000
027000     05  PS-AUDIT-ROW-FOUND-SW          PIC  X(01)  VALUE 'N'.    02700000
027100         88  PS-AUDIT-ROW-FOUND                     VALUE 'Y'.    02710000
027200         88  PS-AUDIT-ROW-NOT-FOUND                 VALUE 'N'.    02720000
027300     05  PS-COMMENT-ROW-FOUND-SW        PIC  X(01)  VALUE 'Y'.    02730000
027400         88  PS-COMMENT-ROW-FOUND                   VALUE 'Y'.    02740000
027500         88  PS-COMMENT-ROW-NOT-FOUND               VALUE 'N'.    02750000
027600     05  PS-FIRST-COMMENT-ROW-SW        PIC  X(01)  VALUE 'Y'.    02760000
027700         88  PS-FIRST-COMMENT-ROW                   VALUE 'Y'.    02770000
027800         88  PS-NOT-FIRST-COMMENT-ROW               VALUE 'N'.    02780000
027900     05  PS-FUNCTION-KEY-REQUEST-SW     PIC  X(01).               02790018
028000         88  PS-VOID-REQUEST                        VALUE 'V'.    02800018
028100         88  PS-REV-VOID-REQUEST                    VALUE 'R'.    02810018
028200                                                                  02820000
028300 01  PV-PROGRAM-VARIABLES.                                        02830000
028400     05  PV-SUB                         PIC S9(04)  VALUE +0      02840000
028500                                                    COMP SYNC.    02850000
028600     05  PV-COMMENT-SUB                 PIC S9(04)  VALUE +0      02860000
028700                                                    COMP SYNC.    02870000
028800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02880000
028900                                                    COMP SYNC.    02890000
029000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02900000
029100                                                    COMP-3.       02910000
029200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02920000
029300                                                    COMP-3.       02930000
029400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02940000
029500                                                    COMP-3.       02950000
029600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02960000
029700                                                    COMP-3.       02970000
029800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02980000
029900                                                    COMP-3.       02990000
030000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      03000000
030100                                                    COMP-3.       03010000
030200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      03020000
030300                                                    COMP-3.       03030000
030400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      03040000
030500                                                    COMP SYNC.    03050000
030600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      03060000
030700                                                    COMP SYNC.    03070000
030800     05  PV-ITEM                        PIC S9(04)  VALUE +0      03080000
030900                                                    COMP SYNC.    03090000
031000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      03100000
031100                                                    COMP SYNC.    03110000
031200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      03120000
031300                                                    COMP SYNC.    03130000
031400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      03140000
031500                                                    COMP SYNC.    03150000
031600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      03160000
031700                                                    COMP SYNC.    03170000
031800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      03180000
031900                                                    COMP SYNC.    03190000
032000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03200000
032100                                                    COMP SYNC.    03210000
032200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03220000
032300                                                    COMP SYNC.    03230000
032400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      03240000
032500                                                    COMP SYNC.    03250000
032600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      03260000
032700                                                    COMP SYNC.    03270000
032800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      03280000
032900                                                    COMP SYNC.    03290000
033000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      03300000
033100                                                    COMP SYNC.    03310000
033200     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      03320000
033300                                                    COMP SYNC.    03330000
033400     05  PV-NUMBER-OF-TRIES             PIC S9(04)  VALUE +0      03340000
033500                                                    COMP SYNC.    03350000
033600     05  PV-TRAN-ID.                                              03360000
033700         10  PV-TRAN-CC                 PIC X(02).                03370018
033800         10  PV-TRAN-YY                 PIC X(02).                03380018
033900         10  PV-TRAN-MM                 PIC X(02).                03390000
034000         10  PV-TRAN-DD                 PIC X(02).                03400000
034100         10  PV-TRAN-S1                 PIC X(01).                03410000
034200         10  PV-TRAN-STR-NBR            PIC 9(04).                03420000
034300         10  PV-TRAN-S2                 PIC X(01).                03430000
034400         10  PV-TRAN-TRMNL-NBR          PIC X(04).                03440000
034500         10  PV-TRAN-S3                 PIC X(01).                03450000
034600         10  PV-TRAN-TRN-NBR            PIC X(04).                03460000
034700     05  PV-DB2-DATE.                                             03470000
034800         10  PV-DB2-CC                  PIC X(02).                03480000
034900         10  PV-DB2-YY                  PIC X(02).                03490000
035000         10  FILLER                     PIC X(01).                03500000
035100         10  PV-DB2-MM                  PIC X(02).                03510000
035200         10  FILLER                     PIC X(01).                03520000
035300         10  PV-DB2-DD                  PIC X(02).                03530000
035400     05  PV-USERID                      PIC 9(11).                03540000
035500     05  PV-RESP                        PIC S9(4)   COMP.         03550000
035600     05  PV-HOLD-COMMENT-TMST           PIC  X(26)  VALUE SPACES. 03560000
035700     05  PV-UNPACKED-PRE-DNNTD-AMT      PIC 9(07)V99.             03570018
035800     05  PV-DISPLAY-PRE-DNNTD-AMT       PIC Z,ZZZ,ZZZ.99.         03580000
035900     05  PV-STR-NBR                     PIC S9(4) COMP.           03590018
036000     05  PV-DB2-DL-NBR.                                           03600031
036100         10  FILLER                     PIC X(01)   VALUE '%'.    03610031
036200         10  PV-DB2-LONG-DL             PIC X(50)   VALUE SPACE.  03620031
036300                                                                  03630031
036400     05  PV-DRV-LIC-NBR-LONG            PIC X(50)   VALUE SPACE.  03640031
036500     05  PV-DRV-LIC-NBR-BYTE      REDEFINES PV-DRV-LIC-NBR-LONG   03650031
036600                                        OCCURS 50 TIMES           03660031
036700                                        PIC  X(01).               03670031
036800                                                                  03680000
036900*----------------------------------------------------------------*03690000
037000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *03700000
037100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *03710000
037200*   APPLICATION-SPECIFIC COMMAREA.                               *03720000
037300*----------------------------------------------------------------*03730000
037400 01  LQW-LIST-QUEUE-WORK-AREA.                                    03740018
037500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03750000
037600     05  LQW-ITEM-ENTRIES               OCCURS 08 TIMES           03760000
037700                                        INDEXED BY LQW-IDX.       03770000
037800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03780000
037900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03790000
038000         10  LQW-SELECTED-SW            PIC  X(01).               03800000
038100             88  LQW-SELECT                         VALUE 'S'     03810030
038200                                                          's'.    03820031
038300             88  LQW-DESELECT                       VALUE ' '.    03830000
038400         10  LQW-HILITE-SW              PIC  X(01).               03840000
038500         10  LQW-POS-DATE-ISO           PIC  X(10).               03850000
038600         10  LQW-STORE-NBR              PIC  9(04).               03860000
038700         10  LQW-TERMINAL               PIC  9(04).               03870018
038800         10  LQW-TRANSACTION            PIC  9(04).               03880018
038900         10  LQW-REVERSAL-IND           PIC  X(01).               03890000
039000         10  LQW-VOID-IND               PIC  X(01).               03900000
039100         10  LQW-OPP-REV-VOID-SW        PIC  X(01).               03910018
039200             88  LQW-OPP-REV-VOID                   VALUE 'Y'.    03920018
039300             88  LQW-NO-OPP-REV-VOID                VALUE 'N'.    03930018
039400         10  LQW-ACTIVITY-TYPE-DESC     PIC  X(07).               03940000
039500         10  LQW-AMOUNT                 PIC S9(07)V99.            03950000
039600         10  LQW-AUTO-MANUAL            PIC  X(01).               03960000
039700         10  LQW-USERID                 PIC  X(11).               03970000
039800         10  LQW-APPROVAL-NUMBER        PIC  X(06).               03980000
039900         10  LQW-ACTIVITY-STATUS        PIC  X(13).               03990000
040000         10  LQW-ACTIVITY-STAT-CDE      PIC  9(01).               04000000
040100         10  LQW-ACTIVITY-TYPE          PIC  9(01).               04010000
040200         10  LQW-TRN-AUTH-TMST          PIC  X(26).               04020000
040300         10  LQW-ORIG-AUTH-AMT          PIC S9(07)V99.            04030018
040400         10  LQW-ST-CDE                 PIC  X(02).               04040018
040500         10  LQW-HOLD-SEL-LN            PIC  X(01).               04050018
040600                                                                  04060000
040700*---------------------------------------------------------------* 04070000
040800*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 04080000
040900*---------------------------------------------------------------* 04090000
041000                                                                  04100000
041100     COPY RDWS022.                                                04110018
041200                                                                  04120000
041300*---------------------------------------------------------------* 04130000
041400*    MAP LAYOUT                                                 * 04140000
041500*---------------------------------------------------------------* 04150000
041600                                                                  04160000
041700     COPY RDKM023.                                                04170000
041800                                                                  04180000
041900 01  MR-OCCURS-LAYOUT                   REDEFINES  RD023AO.       04190000
042000     05  FILLER                         PIC X(230).               04200018
042100     05  MR-SCROLL-AREA                 OCCURS 08 TIMES.          04210000
042200         10  MR-SELECTL                 PIC S9(04) COMP.          04220000
042300         10  MR-SELECTA                 PIC  X(01).               04230000
042400         10  MR-SELECTC                 PIC  X(01).               04240000
042500         10  MR-SELECTH                 PIC  X(01).               04250000
042600         10  MR-SELECTI                 PIC  X(01).               04260000
042700                                                                  04270000
042800         10  MR-TRAN-IDL                PIC S9(04) COMP.          04280000
042900         10  MR-TRAN-IDA                PIC  X(01).               04290000
043000         10  MR-TRAN-IDC                PIC  X(01).               04300000
043100         10  MR-TRAN-IDH                PIC  X(01).               04310000
043200         10  MR-TRAN-ID                 PIC  X(23).               04320018
043300                                                                  04330000
043400         10  MR-REVERSAL-INDL           PIC S9(04) COMP.          04340000
043500         10  MR-REVERSAL-INDA           PIC  X(01).               04350000
043600         10  MR-REVERSAL-INDC           PIC  X(01).               04360000
043700         10  MR-REVERSAL-INDH           PIC  X(01).               04370000
043800         10  MR-REVERSAL-IND            PIC  X(01).               04380000
043900                                                                  04390000
044000         10  MR-VOID-INDL               PIC S9(04) COMP.          04400000
044100         10  MR-VOID-INDA               PIC  X(01).               04410000
044200         10  MR-VOID-INDC               PIC  X(01).               04420000
044300         10  MR-VOID-INDH               PIC  X(01).               04430000
044400         10  MR-VOID-IND                PIC  X(01).               04440000
044500                                                                  04450000
044600         10  MR-ACTIVITY-TYPEL          PIC S9(04) COMP.          04460000
044700         10  MR-ACTIVITY-TYPEA          PIC  X(01).               04470000
044800         10  MR-ACTIVITY-TYPEC          PIC  X(01).               04480000
044900         10  MR-ACTIVITY-TYPEH          PIC  X(01).               04490000
045000         10  MR-ACTIVITY-TYPE-DESC      PIC  X(06).               04500000
045100                                                                  04510000
045200         10  MR-AMOUNTL                 PIC S9(04) COMP.          04520000
045300         10  MR-AMOUNTA                 PIC  X(01).               04530000
045400         10  MR-AMOUNTC                 PIC  X(01).               04540000
045500         10  MR-AMOUNTH                 PIC  X(01).               04550000
045600         10  MR-AMOUNT-X.                                         04560000
045700             15  MR-AMOUNT              PIC ZZZZ.99-.             04570000
045800                                                                  04580000
045900         10  MR-AUTO-MANUALL            PIC S9(04) COMP.          04590000
046000         10  MR-AUTO-MANUALA            PIC  X(01).               04600000
046100         10  MR-AUTO-MANUALC            PIC  X(01).               04610000
046200         10  MR-AUTO-MANUALH            PIC  X(01).               04620000
046300         10  MR-AUTO-MANUAL             PIC  X(01).               04630000
046400                                                                  04640000
046500         10  MR-USERIDL                 PIC S9(04) COMP.          04650000
046600         10  MR-USERIDA                 PIC  X(01).               04660000
046700         10  MR-USERIDC                 PIC  X(01).               04670000
046800         10  MR-USERIDH                 PIC  X(01).               04680000
046900         10  MR-USERID                  PIC  X(11).               04690000
047000                                                                  04700000
047100         10  MR-APPROVAL-NUMBERL        PIC S9(04) COMP.          04710000
047200         10  MR-APPROVAL-NUMBERA        PIC  X(01).               04720000
047300         10  MR-APPROVAL-NUMBERC        PIC  X(01).               04730000
047400         10  MR-APPROVAL-NUMBERH        PIC  X(01).               04740000
047500         10  MR-APPROVAL-NUMBER         PIC  X(06).               04750000
047600                                                                  04760000
047700         10  MR-ACTIVITY-STATUSL        PIC S9(04) COMP.          04770000
047800         10  MR-ACTIVITY-STATUSA        PIC  X(01).               04780000
047900         10  MR-ACTIVITY-STATUSC        PIC  X(01).               04790000
048000         10  MR-ACTIVITY-STATUSH        PIC  X(01).               04800000
048100         10  MR-ACTIVITY-STATUS         PIC  X(10).               04810000
048200                                                                  04820000
048300     05  MR-COMMENT-AREA                OCCURS 04 TIMES.          04830000
048400         10  MR-COMMENTL                PIC S9(04) COMP.          04840000
048500         10  MR-COMMENTA                PIC  X(01).               04850000
048600         10  MR-COMMENTC                PIC  X(01).               04860000
048700         10  MR-COMMENTH                PIC  X(01).               04870000
048800         10  MR-COMMENT                 PIC  X(65).               04880000
048900******************************************************************04890018
049000** WORKING STORAGE FOR CONVERSION TO CARD NUMBER                 *04900018
049100******************************************************************04910018
049200     COPY SVWS007.                                                04920018
049300*---------------------------------------------------------------* 04930000
049400*    KMC APPROVAL NUMBER COPYBOOK.                              * 04940000
049500*---------------------------------------------------------------* 04950000
049600     COPY SVWS006.                                                04960018
049700                                                                  04970000
049800*---------------------------------------------------------------* 04980018
049900*    CHECK DIGIT ROUTINE COPYBOOK.                              * 04990018
050000*---------------------------------------------------------------* 05000018
050100     COPY DPWS036.                                                05010034
050200                                                                  05020018
050300*---------------------------------------------------------------* 05030000
050400*    REFUND AUTH PROGRAM CONSTANT COPYBOOK.                     * 05040000
050500*---------------------------------------------------------------* 05050000
050600     COPY SVWS004.                                                05060018
050700                                                                  05070000
050800*---------------------------------------------------------------* 05080000
050900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 05090000
051000*---------------------------------------------------------------* 05100000
051100                                                                  05110000
051200     COPY DPWS015.                                                05120018
051300                                                                  05130000
051400*---------------------------------------------------------------* 05140000
051500*    FUNCTION KEYS COPYBOOK.                                    * 05150000
051600*---------------------------------------------------------------* 05160000
051700                                                                  05170000
051800     COPY DPWS016.                                                05180018
051900                                                                  05190000
052000*----------------------------------------------------------------*05200000
052100*    WORK AREA FOR THE CICSAUTH SUBROUTINE.                      *05210000
052200*----------------------------------------------------------------*05220000
052300     COPY DPWS008.                                                05230018
052400                                                                  05240000
052500*---------------------------------------------------------------* 05250000
052600*    NUMERIC EDIT LAYOUT.                                       * 05260000
052700*---------------------------------------------------------------* 05270000
052800                                                                  05280000
052900     COPY DPWS010I.                                               05290018
053000*---------------------------------------------------------------* 05300000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 05310037
053200*---------------------------------------------------------------* 05320000
053300                                                                  05330000
053400     COPY DPWS030.                                                05340018
CICS       COPY DPWS930.                                                05341037
053500*---------------------------------------------------------------* 05350000
053600*    STANDARD COMMAREA.                                         * 05360000
053700*---------------------------------------------------------------* 05370000
053800                                                                  05380000
053900     COPY DPWS020.                                                05390018
054000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05400000
054100                                                                  05410000
054200*---------------------------------------------------------------* 05420000
054300* INTER-APPLICATION COMMAREA.                                   * 05430000
054400*   RDWS020 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 05440000
054500*             SPEC SCREEN.                                      * 05450000
054600*   RDWS021 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 05460000
054700*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 05470000
054800*   RDWS023 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 05480000
054900*             THIS LIST PROGRAMMING TO GO TO THE COMMENT        * 05490000
055000*             SCREEN.                                           * 05500000
055100*   SAWS031 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 05510018
055200*             THIS LIST PROGRAMMING TO GO TO THE CORPEJ         * 05520018
055300*             SCREEN.                                           * 05530018
055400*---------------------------------------------------------------* 05540000
055500                                                                  05550000
055600         10  INTER-APPL-COMM-AREA       PIC X(200).               05560000
055700     COPY RDWS020.                                                05570018
055800     COPY RDWS021.                                                05580018
055900     COPY RDWS023.                                                05590018
056000     COPY SAWS031.                                                05600018
056100*---------------------------------------------------------------* 05610000
056200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05620000
056300*---------------------------------------------------------------* 05630000
056400         10  ASC-SPECIFIC-COMMAREA.                               05640000
056500             15  ASC-LIST-KEYS.                                   05650000
056600                 20  ASC-KEY-CARD-ID                 PIC  9(12).  05660018
056700                 20  ASC-KEY-ACTIVITY-TYPE           PIC  9(01).  05670000
056800                 20  ASC-KEY-POS-DATE-ISO            PIC  X(10).  05680000
056900                 20  ASC-KEY-STORE-NBR               PIC  9(04).  05690018
057000                 20  ASC-KEY-TERMINAL                PIC  9(04).  05700000
057100                 20  ASC-KEY-TRANSACTION             PIC  9(04).  05710000
057200                 20  ASC-KEY-AMOUNT-REQUESTED        PIC          05720000
057300                                                     S9(07)V99.   05730000
057400                 20  ASC-KEY-DRIVERS-LICENSE         PIC  X(21).  05740000
057500                 20  ASC-KEY-DRIVERS-LICENSE-LONG    PIC  X(50).  05750031
057600                 20  ASC-SAVE-TIMESTAMP              PIC  X(26).  05760000
057700*                    USED TO SAVE REVERSE VOID DATA               05770018
057800                 20  ASC-REV-VOID-TMST               PIC  X(26).  05780018
057900                 20  ASC-DELETE-AMOUNT               PIC          05790018
058000                                                     S9(07)V99.   05800018
058100                 20  ASC-DELETE-TMST                 PIC  X(26).  05810018
058200             15  ASC-30-DIGIT-CARD-NBR               PIC  X(30).  05820018
058300             15  ASC-CURR-ROW-KEYS.                               05830000
058400                 20  ASC-CURR-POS-DATE-ISO           PIC  X(10).  05840000
058500                 20  ASC-CURR-ACTVY-STAT-CDE         PIC  9(01).  05850000
058600             15  ASC-CONTROL-NBR                     PIC  9(14).  05860018
058700             15  ASC-CRD-TYP-CDE                     PIC  9(01).  05870018
058800             15  ASC-CRD-TYP-DESC                    PIC  X(30).  05880000
058900             15  ASC-CARD-STATUS                     PIC  X(02).  05890000
059000             15  ASC-CARD-STATUS-DESC                PIC  X(14).  05900000
059100             15  ASC-ACTIVITY-TYPE-HEADER-DESC       PIC  X(12).  05910000
059200             15  ASC-AUTH-DECISION                   PIC  X(12).  05920000
059300             15  ASC-AUTH-CODE                       PIC  9(01).  05930000
059400             15  ASC-DUPLICATE-FLAG                  PIC  X(01).  05940000
059500             15  ASC-APPROVED-TENDER-AMT             PIC          05950000
059600                                                    S9(07)V99.    05960000
059700             15  ASC-ORIGINAL-BALANCE                PIC          05970000
059800                                                    S9(07)V99.    05980000
059900             15  ASC-REMAINING-BALANCE               PIC          05990000
060000                                                    S9(07)V99.    06000000
060100             15  ASC-SAVE-ORIGINAL-BALANCE           PIC          06010000
060200                                                    S9(07)V99.    06020000
060300             15  ASC-APPROVAL-NUMBER                 PIC X(06).   06030000
060400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06040000
060500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  06050000
060600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06060000
060700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06070000
060800                                                                  06080000
060900                 20  ASC-ITEM-ARRAY.                              06090000
061000                     25  ASC-ITEM-ENTRIES OCCURS 08 TIMES.        06100000
061100                         30  ASC-LIST-ITEM-NUMBER                 06110000
061200                                                     PIC S9(09)   06120000
061300                                                     COMP-3.      06130000
061400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  06140000
061500                             88  ASC-VALID-SELECT    VALUE ' '    06150000
061600                                                           'S'    06160000
061700                                                           's'    06170031
061800                                                           'B'    06180000
061900                                                           'b'    06190031
062000                                                           'E'    06200030
062100                                                           'e'.   06210031
062200                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   06220000
062300                             88  ASC-TEMP-SELECT     VALUE 'S'    06230030
062400                                                           's'.   06240031
062500                             88  ASC-TEMP-BEGIN      VALUE 'B'    06250030
062600                                                           'b'.   06260031
062700                             88  ASC-TEMP-END        VALUE 'E'    06270030
062800                                                           'e'.   06280031
062900                         30  ASC-SELECTED-SW         PIC  X(01).  06290000
063000                             88  ASC-NO-SELECT       VALUE ' '.   06300000
063100                             88  ASC-SELECT          VALUE 'S'    06310030
063200                                                           's'.   06320031
063300                             88  ASC-BEGIN           VALUE 'B'    06330030
063400                                                           'b'.   06340031
063500                             88  ASC-END             VALUE 'E'    06350030
063600                                                           'e'.   06360031
063700                         30  ASC-HILITE-SW           PIC  X(01).  06370000
063800                             88  ASC-HILITE-SEL      VALUE 'S'.   06380000
063900                             88  ASC-HILITE-LINE-RD  VALUE 'L'.   06390018
064000                             88  ASC-HILITE-LINE-YL  VALUE 'Y'.   06400018
064100                             88  ASC-NO-HILITE       VALUE ' '.   06410000
064200                         30  ASC-POS-DATE-ISO        PIC  X(10).  06420000
064300                         30  ASC-STORE-NBR           PIC  9(04).  06430000
064400                         30  ASC-TERMINAL            PIC  9(04).  06440018
064500                         30  ASC-TRANSACTION         PIC  9(04).  06450018
064600                         30  ASC-REVERSAL-IND        PIC  9(01).  06460000
064700                         30  ASC-VOID-IND            PIC  X(01).  06470000
064800                         30  ASC-OPP-REV-VOID-SW     PIC  X(01).  06480018
064900                             88  ASC-OPP-REV-VOID    VALUE 'Y'.   06490018
065000                             88  ASC-NO-OPP-REV-VOID VALUE 'N'.   06500018
065100                         30  ASC-ACTIVITY-TYPE-DESC  PIC  X(07).  06510000
065200                         30  ASC-AMOUNT              PIC          06520000
065300                                                     S9(07)V99.   06530000
065400                         30  ASC-AUTO-MANUAL         PIC  X(01).  06540000
065500                         30  ASC-USERID              PIC  X(11).  06550000
065600                         30  ASC-APPROVAL-NUMBER-LST PIC  X(06).  06560000
065700                         30  ASC-ACTIVITY-STATUS     PIC  X(13).  06570000
065800                         30  ASC-ACTIVITY-STAT-CDE   PIC  9(01).  06580000
065900                         30  ASC-ACTIVITY-TYPE       PIC  9(01).  06590000
066000                         30  ASC-TRN-AUTH-TMST       PIC  X(26).  06600000
066100                         30  ASC-ORIG-AUTH-AMT       PIC          06610018
066200                                                     S9(07)V99.   06620018
066300                         30  ASC-ST-CDE              PIC X(02).   06630018
066400                         30  ASC-HOLD-SEL-LN         PIC X(01).   06640018
066500                                                                  06650018
066600             15  ASC-COMMENT-LINES        OCCURS 04 TIMES.        06660000
066700                 20  ASC-COMMENT-LINE                PIC  X(65).  06670000
066800             15  ASC-BLK-SUB                         PIC S9(04)   06680000
066900                                                          COMP    06690000
067000                                                          SYNC.   06700000
067100             15  ASC-ITEM-SUB                        PIC S9(04)   06710000
067200                                                          COMP    06720000
067300                                                          SYNC.   06730000
067400             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   06740000
067500                                                          COMP-3. 06750000
067600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   06760000
067700                                                          COMP-3. 06770000
067800             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   06780000
067900                                                          COMP-3. 06790000
068000             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   06800000
068100                                                          COMP-3. 06810000
068200             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   06820000
068300                                                          COMP-3. 06830000
068400             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   06840000
068500                                                          COMP    06850000
068600                                                          SYNC.   06860000
068700             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   06870000
068800                                                          COMP-3. 06880000
068900             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   06890000
069000                                                          COMP-3. 06900000
069100             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  06910000
069200                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   06920000
069300                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   06930000
069400             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  06940000
069500                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   06950000
069600                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   06960000
069700             15  ASC-LIST-QUEUE-NAME.                             06970000
069800                 20  ASC-LIST-TERM-ID                PIC  X(04).  06980000
069900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   06990000
070000                                                          COMP-3. 07000000
070100                 20  ASC-LIST-SEQ                    PIC  9(01).  07010000
070200             15  ASC-SEL-QUEUE-NAME.                              07020000
070300                 20  ASC-SEL-TERM-ID                 PIC  X(04).  07030000
070400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   07040000
070500                                                          COMP-3. 07050000
070600                 20  ASC-SEL-SEQ                     PIC  9(01).  07060000
070700                                                                  07070000
070800             15  ASC-START-ITEM-REQUEST.                          07080000
070900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  07090000
071000             15  ASC-CURR-DATE-ISO                   PIC  X(10).  07100000
071100             15  ASC-FORMAT-IND                      PIC  X(01).  07110000
071200             15  ASC-TRANS-STATUS                    PIC  X(01).  07120000
071300                 88  ASC-AUDIT-UPDATE-OK             VALUE '1'.   07130000
071400                 88  ASC-AUDIT-UPDATE-ERROR          VALUE '2'.   07140000
071500                 88  ASC-AUDIT-UPDATE                VALUES       07150000
071600                                                     '1' '2'.     07160000
071700                 88  ASC-AUDIT-INSERT-OK             VALUE '3'.   07170000
071800                 88  ASC-AUDIT-INSERT-ERROR          VALUE '4'.   07180000
071900                 88  ASC-AUDIT-INSERT                VALUES       07190000
072000                                                     '3' '4'.     07200000
072100                 88  ASC-REFER-INSERT-OK             VALUE '5'.   07210000
072200                 88  ASC-REFER-INSERT-ERROR          VALUE '6'.   07220000
072300                 88  ASC-REFER-DUPLICATE-ERROR       VALUE '8'.   07230000
072400                 88  ASC-REFER-INSERT                VALUES       07240000
072500                                                     '5' '6' '8'. 07250000
072600                 88  ASC-TRANS-COMPLETE              VALUE '7'.   07260000
072700                 88  ASC-TRANS-PENDING               VALUES       07270000
072800                                                     '1' '3' '5'. 07280000
072900                 88  ASC-TRANS-ERROR                 VALUES       07290000
073000                                                     '2' '4' '6'  07300000
073100                                                     '8'.         07310000
073200                 88  ASC-TRANS-NOT-COMPLETE          VALUES  ' '  07320000
073300                                                     '1' '2' '3'  07330000
073400                                                     '4' '5' '6'  07340000
073500                                                     '8'.         07350000
073600             15  ASC-VOID-STATUS                     PIC  X(01).  07360000
073700                 88  ASC-NO-VOID-REQUEST             VALUE ' '.   07370000
073800                 88  ASC-VOID-REQUEST-OK             VALUE '1'.   07380000
073900             15  ASC-REVERSE-VOID-STATUS             PIC  X(01).  07390018
074000                 88  ASC-NO-REVERSE-VOID-REQUEST     VALUE ' '.   07400018
074100                 88  ASC-REVERSE-VOID-REQUEST-OK     VALUE '1'.   07410018
074200             15  ASC-VOID-ERROR-SW                   PIC  X(01).  07420000
074300                 88  ASC-VOID-ERROR                  VALUE 'Y'.   07430000
074400                 88  ASC-NO-VOID-ERROR               VALUE ' '.   07440000
074500             15  ASC-VOID-MSG-NBR                    PIC  9(05).  07450000
074600             15  ASC-OVERRIDE-SW                     PIC  X(01).  07460000
074700                 88  ASC-OVERRIDE-NOT-COMPLETE       VALUE ' '.   07470000
074800                 88  ASC-OVERRIDE-COMPLETE           VALUE 'C'.   07480000
074900             15  ASC-GO-TO-OVERRIDE-SW               PIC  X(01).  07490000
075000                 88  ASC-GO-TO-OVERRIDE              VALUE 'Y'.   07500000
075100                 88  ASC-NO-GO-TO-OVERRIDE           VALUE ' '.   07510000
075200             15  ASC-GO-TO-COMMENTS-SW               PIC  X(01).  07520000
075300                 88  ASC-GO-TO-COMMENTS              VALUE 'Y'.   07530000
075400                 88  ASC-NO-GO-TO-COMMENTS           VALUE ' '.   07540000
075500             15  ASC-DISPLAY-APPROVAL-SW             PIC  X(01).  07550000
075600                 88  ASC-DISPLAY-APPROVAL            VALUE 'Y'.   07560000
075700                 88  ASC-NO-DISPLAY-APPROVAL         VALUE ' '.   07570000
075800             15  ASC-HOLD-FIELDS.                                 07580018
075900                 20  ASC-HLD-CARD-ID                 PIC  9(12).  07590018
076000                 20  ASC-HLD-ACTIVITY-TYPE           PIC  9(01).  07600018
076100                 20  ASC-HLD-REVERSAL-IND            PIC  9(01).  07610018
076200                 20  ASC-HLD-POS-DATE-ISO            PIC  X(10).  07620018
076300                 20  ASC-HLD-STORE-NBR               PIC  9(04).  07630018
076400                 20  ASC-HLD-TERMINAL                PIC  9(04).  07640018
076500                 20  ASC-HLD-TRANSACTION             PIC  9(04).  07650018
076600                 20  ASC-HLD-TRANS-AMOUNT            PIC          07660018
076700                                                      S9(07)V99.  07670018
076800                 20  ASC-MATCH-FND-SW                PIC  X(01).  07680018
076900*        10  FILLER                                  PIC X(229).  07690031
077000         10  FILLER                                  PIC X(179).  07700031
077100*----------------------------------------------------------------*07710000
077200*    DATE/TIME COPYBOOK.                                         *07720000
077300*----------------------------------------------------------------*07730000
077400                                                                  07740000
077500     COPY DPWS017.                                                07750018
077600*---------------------------------------------------------------* 07760000
077700*    ABEND PROCESSING COPYBOOK.                                 * 07770000
077800*---------------------------------------------------------------* 07780000
077900                                                                  07790000
078000     COPY DPWS013.                                                07800018
078100                                                                  07810000
078200*---------------------------------------------------------------* 07820018
078300*    DB2 AREA FOR SVT_CRD_PROD                                  * 07830018
078400*---------------------------------------------------------------* 07840018
078500     EXEC SQL                                                     07850018
078600          INCLUDE SVT00000                                        07860018
078700     END-EXEC.                                                    07870018
078800*---------------------------------------------------------------* 07880000
078900*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                            * 07890018
079000*---------------------------------------------------------------* 07900000
079100     EXEC SQL                                                     07910000
079200          INCLUDE SVT00001                                        07920018
079300     END-EXEC.                                                    07930000
079400*---------------------------------------------------------------* 07940000
079500*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                             * 07950018
079600*---------------------------------------------------------------* 07960000
079700     EXEC SQL                                                     07970000
079800          INCLUDE SVT00002                                        07980018
079900     END-EXEC.                                                    07990000
080000*---------------------------------------------------------------* 08000000
080100*    DB2 AREA FOR SVT_CRD_ACCT_CMMT                             * 08010018
080200*---------------------------------------------------------------* 08020000
080300     EXEC SQL                                                     08030000
080400          INCLUDE SVT00003                                        08040018
080500     END-EXEC.                                                    08050000
080600*---------------------------------------------------------------* 08060018
080700*    DB2 AREA FOR SVT_CRD_ACCT_LCK                              * 08070018
080800*---------------------------------------------------------------* 08080018
080900     EXEC SQL                                                     08090018
081000          INCLUDE SVT00004                                        08100018
081100     END-EXEC.                                                    08110018
081200*---------------------------------------------------------------* 08120018
081300*    DB2 AREA FOR SVT_CRD_STK_DNMNTN                            * 08130018
081400*---------------------------------------------------------------* 08140018
081500     EXEC SQL                                                     08150018
081600          INCLUDE SVT00008                                        08160018
081700     END-EXEC.                                                    08170018
081800*---------------------------------------------------------------* 08180031
081900*    DB2 AREA FOR ENCRYPTED DL NBR (RDT_DRVR_LIC_TRANSL)        * 08190031
082000*---------------------------------------------------------------* 08200031
082100     EXEC SQL                                                     08210031
082200          INCLUDE RDT00004                                        08220031
082300     END-EXEC.                                                    08230031
082400*---------------------------------------------------------------* 08240000
082500*    DB2 AREA FOR COMMUNICATIONS                                * 08250000
082600*---------------------------------------------------------------* 08260000
082700     EXEC SQL                                                     08270000
082800          INCLUDE SQLCA                                           08280000
082900     END-EXEC.                                                    08290000
083000                                                                  08300000
083100*---------------------------------------------------------------* 08310000
083200*    AUTH PROCEDURE COPYBOOK.                                   * 08320000
083300*---------------------------------------------------------------* 08330000
083400     COPY SVWS005.                                                08340018
083500                                                                  08350000
083600*---------------------------------------------------------------* 08360000
083700*    CURSOR TO DISPLAY THE CARD ACTIVITY HISTORY.               * 08370000
083800*---------------------------------------------------------------* 08380000
083900                                                                  08390000
084000     EXEC SQL                                                     08400000
084100          DECLARE CARD-CSR CURSOR                                 08410000
084200          FOR SELECT                                              08420000
084300                TRN_AUTH_TMST                                     08430000
084400              , TRN_RVRSL_CDE                                     08440000
084500              , TRN_VOID_IND                                      08450000
084600              , ACTVY_TYP_CDE                                     08460000
084700              , POS_DTE                                           08470000
084800              , STR_NBR                                           08480000
084900              , POS_TRMNL_NBR                                     08490000
085000              , POS_TRN_NBR                                       08500000
085100              , APP_AUTH_AMT                                      08510000
085200              , POS_OPRT_ID                                       08520000
085300              , APVL_USR_ID                                       08530000
085400              , ACTVY_STAT_CDE                                    08540000
085500              , ORIG_AUTH_AMT                                     08550018
085600              , ST_CDE                                            08560018
085700          FROM                                                    08570000
085800                SVT_KOHLS_CRD_TXN                                 08580018
085900          WHERE                                                   08590000
086000                CRD_NBR        = :DK-CARD-ID                      08600000
086100          ORDER BY                                                08610000
086200                TRN_AUTH_TMST DESC                                08620000
086300          WITH UR                                                 08630018
086400     END-EXEC.                                                    08640000
086500                                                                  08650000
086600*---------------------------------------------------------------* 08660000
086700*    CURSOR TO ACCESS THE MOST CURRENT COMMENT.                 * 08670000
086800*---------------------------------------------------------------* 08680000
086900                                                                  08690000
087000     EXEC SQL                                                     08700000
087100          DECLARE COMMENT-CSR CURSOR                              08710000
087200          FOR SELECT                                              08720000
087300                CRE_TMST                                          08730000
087400              , CMNT_SEQ_NBR                                      08740000
087500              , CMNT_TXT                                          08750000
087600          FROM                                                    08760000
087700                SVT_CRD_ACCT_CMMT                                 08770018
087800          WHERE                                                   08780000
087900                CRD_NBR        = :DK-CARD-ID                      08790000
088000          ORDER BY                                                08800000
088100                CRE_TMST DESC                                     08810000
088200              , CMNT_SEQ_NBR                                      08820000
088300          WITH UR                                                 08830018
088400     END-EXEC.                                                    08840000
088500                                                                  08850000
088600                                                                  08860000
088700 LINKAGE SECTION.                                                 08870000
088800                                                                  08880000
088900 01  DFHCOMMAREA.                                                 08890000
089000     05  FILLER                         OCCURS  1 TO 4072 TIMES   08900000
089100                                        DEPENDING ON EIBCALEN.    08910000
089200         10  FILLER                     PIC X.                    08920000
089300                                                                  08930000
089400 PROCEDURE DIVISION.                                              08940000
089500*----------------------------------------------------------------*08950000
089600*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *08960000
089700*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *08970000
089800*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *08980000
089900*----------------------------------------------------------------*08990000
090000 0000-MAIN-MODULE.                                                09000000
090100     INITIALIZE DP030-CICS-API-FIELDS.                            09010000
090200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09020000
090300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09030000
090400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         09040000
090500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09050000
090600     MOVE LENGTH OF RD023AI        TO DP030-MAP-LENGTH (1).       09060000
090700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09070000
090800     PERFORM 0001-CALL-CICS-ARCH-API.                             09080000
090900                                                                  09090000
091000     PERFORM 1000-CONTROL-PROCESSING                              09100000
091100     PERFORM 9000-DELETE-LOCK                                     09110018
091200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09120000
091300     PERFORM 0001-CALL-CICS-ARCH-API.                             09130000
091400                                                                  09140000
091500*----------------------------------------------------------------*09150000
091600*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *09160000
091700*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *09170000
091800*----------------------------------------------------------------*09180000
091900 0001-CALL-CICS-ARCH-API.                                         09190000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09200037
092100                                    DFHCOMMAREA                   09210037
092200                                    DP030-CICS-API-FIELDS         09220037
092300                                    DP020-STANDARD-COMMAREA       09230037
092400                                    RD023AI.                      09240037
092500                                                                  09250000
092600     IF  DP030-RC-CALL-SUCCESSFUL                                 09260000
092700         CONTINUE                                                 09270000
092800     ELSE                                                         09280000
092900         SET DP013-NO-ROLLBACK                                    09290000
093000             DP013-XCTL-DISPLAY-RESTART                           09300000
093100             DP013-CICS-ABEND      TO TRUE                        09310000
093200         MOVE '0001-CALL-CICS-ARCH-API'                           09320000
093300                                   TO DP013-PARAGRAPH             09330000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09331037
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09332037
093600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09360000
093700         PERFORM DP013-0000-PROCESS-ABEND                         09370000
093800     END-IF.                                                      09380000
093900*----------------------------------------------------------------*09390000
094000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09400000
094100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09410000
094200*                                                                *09420000
094300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09430000
094400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09440000
094500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09450000
094600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09460000
094700*----------------------------------------------------------------*09470000
094800                                                                  09480000
094900 1000-CONTROL-PROCESSING.                                         09490000
095000                                                                  09500000
095100     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       09510000
095200     EVALUATE TRUE                                                09520000
095300         WHEN DP020-NEXT-ACT-INITIAL                              09530000
095400             INITIALIZE ASC-SPECIFIC-COMMAREA                     09540000
095500             MOVE 'N' TO ASC-MATCH-FND-SW                         09550018
095600                                                                  09560018
095700             IF DP017-CURRENT-TIME-HOUR < 3                       09570000
095800                 PERFORM 1200-GET-YESTERDAYS-DATE                 09580000
095900             ELSE                                                 09590000
096000                 MOVE DP017-EDITED-DATE-YYYYMMDD                  09600000
096100                                   TO ASC-CURR-DATE-ISO           09610000
096200             END-IF                                               09620000
096300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09630000
096400                                      ASC-SEL-TERM-ID             09640000
096500             MOVE DP020-SRC-TASK-NUMBER                           09650000
096600                                   TO ASC-LIST-TASK-NUMBER        09660000
096700                                      ASC-SEL-TASK-NUMBER         09670000
096800             MOVE PC-LIST-QUEUE-SEQ                               09680000
096900                                   TO ASC-LIST-SEQ                09690000
097000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 09700000
097100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09710000
097200***-----$TEMPLATE NOTE$-------------------------------------------09720000
097300*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,09730000
097400*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  09740000
097500*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.09750000
097600***---------------------------------------------------------------09760000
097700             IF  PS-COMMAREA-NOT-VALID                            09770000
097800                 SET DP020-MSG-FATAL                              09780000
097900                                   TO TRUE                        09790000
098000                 SET DP020-NEXT-ACT-APPL-ERROR                    09800000
098100                                   TO TRUE                        09810000
098200             ELSE                                                 09820000
098300                 PERFORM 4000-BUILD-INITIAL-PANEL                 09830000
098400             END-IF                                               09840000
098500                                                                  09850000
098600         WHEN DP020-NEXT-ACT-READ-MAP                             09860000
098700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09870000
098800                                   TO PV-TOP-ITEM                 09880000
098900             IF ASC-GO-TO-OVERRIDE                                09890000
099000                 SET ASC-NO-GO-TO-OVERRIDE TO TRUE                09900000
099100                 MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS        09910000
099200             END-IF                                               09920000
099300             IF ASC-GO-TO-COMMENTS                                09930000
099400                 SET ASC-NO-GO-TO-COMMENTS TO TRUE                09940000
099500                 MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS        09950000
099600             END-IF                                               09960000
099700             PERFORM 2000-PROCESS-PANEL                           09970000
099800                                                                  09980000
099900         WHEN DP020-NEXT-ACT-RETURN                               09990000
100000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10000000
100100                                   TO PV-TOP-ITEM                 10010000
100200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10020000
100300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 10030000
100400             IF ASC-GO-TO-OVERRIDE OR ASC-GO-TO-COMMENTS          10040000
100500                 PERFORM 2050-DELETE-LIST-QUEUE                   10050000
100600                 PERFORM 4000-BUILD-INITIAL-PANEL                 10060000
100700                 IF ASC-GO-TO-OVERRIDE                            10070000
100800                     SET ASC-NO-GO-TO-OVERRIDE TO TRUE            10080000
100900                 ELSE                                             10090000
101000                     SET ASC-NO-GO-TO-COMMENTS TO TRUE            10100000
101100                 END-IF                                           10110000
101200                 MOVE ZERO TO ASC-NUMBER-OF-SELECTED-ITEMS        10120000
101300             END-IF                                               10130000
101400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10140000
101500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10150000
101600                                                                  10160000
101700         WHEN OTHER                                               10170000
101800             SET DP013-LOGIC-ABEND TO TRUE                        10180000
101900             SET DP013-NO-ROLLBACK TO TRUE                        10190000
102000             MOVE '1000-CONTROL-PROCESSING'                       10200000
102100                                   TO DP013-PARAGRAPH             10210000
102200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    10220000
102300                                   TO DP013-MESSAGE-TEXT(1)       10230000
102400             PERFORM DP013-0000-PROCESS-ABEND                     10240000
102500     END-EVALUATE.                                                10250000
102600                                                                  10260000
102700*----------------------------------------------------------------*10270000
102800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *10280000
102900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *10290000
103000*----------------------------------------------------------------*10300000
103100                                                                  10310000
103200 1100-PROCESS-INTER-APPL-COMM.                                    10320000
103300                                                                  10330000
103400     SET PS-COMMAREA-VALID         TO TRUE.                       10340000
103500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     10350000
103600     MOVE DP020-INT-APPL-FORMAT-IND                               10360000
103700                                   TO ASC-FORMAT-IND.             10370000
103800     SET SV007-FORMAT-IN           TO TRUE                        10380018
103900     MOVE 0                        TO SV007-CARD-NUMBER-LENGTH    10390018
104000     MOVE RD020-30-DIGIT-CARD-NBR  TO SV007-CARD-NUMBER-IN9       10400018
104100     PERFORM SV007-FORMAT-CARD                                    10410018
104200     MOVE SV007-CARD-NBR           TO ASC-KEY-CARD-ID             10420018
104300                                      DK-CARD-ID.                 10430018
104400     MOVE SV007-CARD-NUMBER        TO ASC-30-DIGIT-CARD-NBR       10440018
104500     PERFORM 1150-GET-CARD-INFO.                                  10450000
104600     IF PS-COMMAREA-VALID                                         10460000
104700         EVALUATE TRUE                                            10470000
104800             WHEN ASC-FORMAT-IND = PC-REFERRAL-FORMAT             10480000
104900                 PERFORM 1110-EDIT-DATA-PASSED                    10490000
105000                 PERFORM 1160-GET-CRIT-SPEC-FIELDS                10500000
105100             WHEN ASC-FORMAT-IND = PC-AUDIT-FORMAT                10510000
105200                 PERFORM 1110-EDIT-DATA-PASSED                    10520000
105300                 PERFORM 1140-CHECK-CARD-STATUS                   10530000
105400                 PERFORM 1160-GET-CRIT-SPEC-FIELDS                10540000
105500             WHEN ASC-FORMAT-IND = PC-REFER-VOID-FORMAT           10550000
105600                 PERFORM 1130-EDIT-VOID-DATA-PASSED               10560000
105700                 PERFORM 1140-CHECK-CARD-STATUS                   10570000
105800             WHEN ASC-FORMAT-IND = PC-AUDIT-VOID-FORMAT           10580018
105900                 PERFORM 1130-EDIT-VOID-DATA-PASSED               10590018
106000             WHEN ASC-FORMAT-IND = PC-CORPEJ-FORMAT               10600018
106100                 PERFORM 1110-EDIT-DATA-PASSED                    10610018
106200         END-EVALUATE                                             10620000
106300     END-IF.                                                      10630000
106400                                                                  10640000
106500*----------------------------------------------------------------*10650000
106600* EDIT DATA PASSED FOR A REFERRAL OR AUDIT.                      *10660000
106700*----------------------------------------------------------------*10670000
106800 1110-EDIT-DATA-PASSED.                                           10680000
106900                                                                  10690000
107000     IF RD020-CARD-ID       = ZERO  OR                            10700000
107100        RD020-ACTIVITY-TYPE = ZERO  OR                            10710000
107200        RD020-POS-DATE-ISO  = SPACES OR                           10720000
107300        RD020-POS-DATE-ISO  = SV004-DEFAULT-DATE OR               10730018
107400        RD020-STORE-NBR     = ZERO  OR                            10740000
107500        RD020-TERMINAL      = ZERO  OR                            10750000
107600        RD020-TRANSACTION   = ZERO                                10760000
107700         SET PS-COMMAREA-NOT-VALID TO  TRUE                       10770000
107800*        --- ENTRY OF FIELD IS REQUIRED ---                       10780000
107900         MOVE PC-TSYMSG-00330      TO DP020-MSG-NUMBER            10790000
108000     END-IF.                                                      10800000
108100     IF PS-COMMAREA-VALID                                         10810000
108200         IF RD020-AMOUNT = ZERO                                   10820000
108300             SET PS-COMMAREA-NOT-VALID                            10830000
108400                                   TO  TRUE                       10840000
108500*            --- MUST BE GREATER THAN ZERO ---                    10850000
108600             MOVE PC-TSYMSG-00342  TO DP020-MSG-NUMBER            10860000
108700         END-IF                                                   10870000
108800     END-IF.                                                      10880000
108900     IF PS-COMMAREA-VALID                                         10890000
109000         IF DP020-INT-APPL-FORMAT-IND = PC-AUDIT-FORMAT           10900000
109100             IF RD020-POS-DATE-ISO >= ASC-CURR-DATE-ISO           10910000
109200                 SET PS-COMMAREA-NOT-VALID                        10920000
109300                                   TO  TRUE                       10930000
109400*                --- MUST BE A PAST DATE ---                      10940000
109500                 MOVE PC-TSYMSG-00234                             10950000
109600                                   TO DP020-MSG-NUMBER            10960000
109700             END-IF                                               10970000
109800         ELSE                                                     10980000
109900             IF DP020-INT-APPL-FORMAT-IND = PC-REFERRAL-FORMAT    10990000
110000                 IF RD020-POS-DATE-ISO = ASC-CURR-DATE-ISO        11000000
110100                     CONTINUE                                     11010000
110200                 ELSE                                             11020000
110300                     SET PS-COMMAREA-NOT-VALID                    11030000
110400                                   TO  TRUE                       11040000
110500*                    --- MUST BE CURRENT DATE ---                 11050000
110600                     MOVE PC-TSYMSG-01229                         11060000
110700                                   TO DP020-MSG-NUMBER            11070000
110800                 END-IF                                           11080000
110900             END-IF                                               11090000
111000         END-IF                                                   11100000
111100     END-IF.                                                      11110000
111200                                                                  11120000
111300     IF PS-COMMAREA-VALID                                         11130000
111400         IF RD020-ACTIVITY-TYPE = SV004-ISSUE-KMRC-ACT-TYP        11140018
111500             IF ASC-CRD-TYP-CDE NOT = SV004-KMRC-CRD-TYP          11150018
111600                 SET PS-COMMAREA-NOT-VALID                        11160000
111700                                       TO TRUE                    11170000
111800*                --- MUST BE A KMRC CARD TO ISSUE A KMRC CARD --- 11180000
111900                 MOVE PC-TSYMSG-01602 TO DP020-MSG-NUMBER         11190000
112000             END-IF                                               11200000
112100         END-IF                                                   11210000
112200     END-IF.                                                      11220000
112300                                                                  11230000
112400     IF PS-COMMAREA-VALID                                         11240000
112500         IF RD020-ACTIVITY-TYPE = SV004-ISSUE-GIFT-CRD-ACT-TYP    11250018
112600             IF ASC-CRD-TYP-CDE NOT = SV004-GIFT-CRD-TYP          11260018
112700                 SET PS-COMMAREA-NOT-VALID                        11270000
112800                                       TO TRUE                    11280000
112900*                --- MUST BE A GIFT CARD TO ISSUE A GIFT CARD --- 11290000
113000                 MOVE PC-TSYMSG-01602 TO DP020-MSG-NUMBER         11300000
113100             END-IF                                               11310000
113200         END-IF                                                   11320000
113300     END-IF.                                                      11330000
113400                                                                  11340000
113500     IF PS-COMMAREA-VALID                                         11350000
113600         IF RD020-ACTIVITY-TYPE = SV004-ISSUE-GIFT-CRD-ACT-TYP    11360018
113700             IF SVT00000-PRE-DNNTD-CRD-AMT > ZERO                 11370018
113800                 IF RD020-AMOUNT NOT = SVT00000-PRE-DNNTD-CRD-AMT 11380018
113900                     SET PS-COMMAREA-NOT-VALID                    11390000
114000                                       TO TRUE                    11400000
114100*                --- PRE-DENOMINATED CARD AMOUNT DOES NOT EQUAL---11410000
114200*                --- ENTERED AMOUNT                            ---11420000
114300                     MOVE SVT00000-PRE-DNNTD-CRD-AMT              11430018
114400                                      TO PV-UNPACKED-PRE-DNNTD-AMT11440000
114500                     MOVE PV-UNPACKED-PRE-DNNTD-AMT               11450000
114600                                      TO PV-DISPLAY-PRE-DNNTD-AMT 11460000
114700                     MOVE PV-DISPLAY-PRE-DNNTD-AMT                11470000
114800                                          TO DP020-MSG-TEXT       11480000
114900                     MOVE PC-TSYMSG-01603 TO DP020-MSG-NUMBER     11490000
115000                 END-IF                                           11500000
115100             END-IF                                               11510000
115200         END-IF                                                   11520000
115300     END-IF.                                                      11530000
115400                                                                  11540000
115500     IF PS-COMMAREA-VALID                                         11550000
115600         IF RD020-ACTIVITY-TYPE = SV004-ISSUE-KMRC-ACT-TYP        11560018
115700             IF  RD020-DRIVERS-LICENSE      = SPACES              11570025
115800             AND RD020-DRIVERS-LICENSE-LONG = SPACES              11580031
115900                 SET PS-COMMAREA-NOT-VALID                        11590000
116000                                       TO TRUE                    11600000
116100*                --- ENTRY OF FIELD IS REQUIRED ---               11610000
116200                 MOVE PC-TSYMSG-00330 TO DP020-MSG-NUMBER         11620000
116300             END-IF                                               11630000
116400         END-IF                                                   11640000
116500     END-IF.                                                      11650000
116600                                                                  11660000
116700     IF PS-COMMAREA-VALID AND                                     11670000
116800        DP020-INT-APPL-FORMAT-IND = PC-AUDIT-FORMAT               11680000
116900         INITIALIZE  DPG51                                        11690018
117000                     DPG52                                        11700018
117100                     DPG53                                        11710018
117200                     DPG54                                        11720018
117300                     DPG55                                        11730018
117400                     DPG56                                        11740018
117500         MOVE ASC-CURR-DATE-ISO    TO DPG52-LK-DATE-INPUT         11750000
117600         SET DPG52-LK-DTE-ISO-FMT                                 11760000
117700             DPG51-ACTUAL-CALENDAR-ONLY                           11770000
117800             DPG51-DECREMENT-DATE  TO TRUE                        11780000
117900         MOVE SV004-AUDIT-DATE-RANGE-DAYS                         11790018
118000                                   TO DPG51-INCR-DECR-DAYS-9      11800000
118100         MOVE ZEROES               TO DPG51-INCR-DECR-BUS-DAYS-9  11810018
118200         CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51            11820018
118300                                                 DPG52            11830018
118400                                                 DPG53            11840018
118500                                                 DPG54            11850018
118600                                                 DPG55            11860018
118700                                                 DPG56            11870018
118800         EVALUATE TRUE                                            11880000
118900           WHEN DPG54-SEVERE-ERROR                                11890000
119000           WHEN DPG54-DATE-INVALID                                11900000
119100               SET PS-COMMAREA-NOT-VALID                          11910000
119200                                   TO  TRUE                       11920000
119300*              --- INVALID DATE ---                               11930000
119400               MOVE PC-TSYMSG-00009                               11940000
119500                                   TO DP020-MSG-NUMBER            11950000
119600           WHEN OTHER                                             11960000
119700               IF DPG55-DB2-ISO-DATE-FMT > RD020-POS-DATE-ISO     11970000
119800                   SET PS-COMMAREA-NOT-VALID                      11980000
119900                                   TO  TRUE                       11990000
120000*                  --- DATE MUST BE WITHIN X DAYS OF CURRENT ---  12000000
120100                   MOVE PC-TSYMSG-01228                           12010000
120200                                   TO DP020-MSG-NUMBER            12020000
120300                   MOVE SV004-AUDIT-DATE-RANGE-DAYS               12030018
120400                                   TO DP020-MSG-TEXT              12040000
120500               END-IF                                             12050000
120600         END-EVALUATE                                             12060000
120700     END-IF.                                                      12070000
120800                                                                  12080000
120900     IF PS-COMMAREA-VALID                                         12090000
121000       AND DP020-INT-APPL-FORMAT-IND = PC-REFERRAL-FORMAT         12100000
121100         MOVE RD020-STORE-NBR      TO PV-STR-NBR                  12110018
121200                                                                  12120018
121300         EXEC SQL                                                 12130000
121400             SELECT OPN_DTE                                       12140018
121500                  , CLO_DTE                                       12150018
121600                  , POS_CAP_LVL_ID                                12160018
121700               INTO :XST00001-OPN-DTE                             12170018
121800                  , :XST00001-CLO-DTE                             12180018
121900                  , :XST00025-POS-CAP-LVL-ID                      12190018
122000               FROM XST_LOC        A                              12200018
122100                  , XST_LOC_ATTR   B                              12210018
122200              WHERE A.LOC_NBR = :PV-STR-NBR                       12220018
122300                AND A.LOC_NBR = B.LOC_NBR                         12230018
122400              WITH UR                                             12240018
122500         END-EXEC                                                 12250000
122600         EVALUATE TRUE                                            12260000
122700           WHEN SQLCODE = ZERO                                    12270000
122800               IF XST00001-OPN-DTE <= ASC-CURR-DATE-ISO           12280018
122900                 AND XST00001-CLO-DTE >= ASC-CURR-DATE-ISO        12290018
123000                   CONTINUE                                       12300000
123100               ELSE                                               12310000
123200                   SET PS-COMMAREA-NOT-VALID                      12320000
123300                                   TO  TRUE                       12330000
123400*                  --- STORE MUST BE OPEN ---                     12340000
123500                   MOVE PC-TSYMSG-01263                           12350000
123600                                   TO DP020-MSG-NUMBER            12360000
123700               END-IF                                             12370000
123800           WHEN OTHER                                             12380000
123900              MOVE '1110-EDIT-DATA-PASSED'                        12390000
124000                                       TO DP013-PARAGRAPH         12400000
124100              MOVE 'UNABLE TO SELECT STORE NUMBER'                12410000
124200                                       TO DP013-MESSAGE-TEXT (1)  12420000
124300              MOVE SQLCA               TO DP013-SQLCA             12430000
124400              MOVE 'XST_LOC'           TO DP013-DB2-TABLE-NAME (1)12440018
124500              SET DP013-DB2-ABEND      TO TRUE                    12450000
124600              PERFORM DP013-0000-PROCESS-ABEND                    12460000
124700         END-EVALUATE                                             12470000
124800     END-IF.                                                      12480000
124900                                                                  12490022
125000     IF PS-COMMAREA-VALID                                         12500022
125100       AND DP020-INT-APPL-FORMAT-IND = PC-REFERRAL-FORMAT         12510022
125200       AND (RD020-ACTIVITY-TYPE = SV004-ISSUE-GIFT-CRD-ACT-TYP    12520022
125300       OR RD020-ACTIVITY-TYPE = SV004-ISSUE-KMRC-ACT-TYP)         12530022
125400         SET DP008-RSRC-TYPE-FUNC  TO  TRUE                       12540022
125500         MOVE PC-ADD-VALUE-AUTH    TO  DP008-RESOURCE-NAME        12550022
125600         SET DP008-ACCESS-TYPE-USE TO  TRUE                       12560022
125700         EXEC CICS                                                12570022
125800              LINK                                                12580022
125900                 PROGRAM  (DP008-SECURITY-SUBROUTINE)             12590022
126000                 COMMAREA (DP008-SECURITY-COMMAREA)               12600022
126100                 LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)        12610022
126200                 RESP     (PV-RESP)                               12620022
126300         END-EXEC                                                 12630022
126400         IF  PV-RESP NOT = DFHRESP(NORMAL)                        12640022
126500             SET PS-COMMAREA-NOT-VALID                            12650022
126600                                   TO  TRUE                       12660022
126700*            --- BAD LINK TO SECURITY MODULE ---                  12670022
126800             MOVE PC-TSYMSG-00233  TO DP020-MSG-NUMBER            12680022
126900         ELSE                                                     12690022
127000             IF  DP008-ACCESS-ALLOWED                             12700022
127100                 CONTINUE                                         12710022
127200             ELSE                                                 12720022
127300                 SET PS-COMMAREA-NOT-VALID                        12730022
127400                                   TO  TRUE                       12740022
127500*                --- USERID DOES NOT HAVE AUTHORITY TO ADD        12750022
127600*                    VALUE TO A CARD UNDER REFERRAL ---           12760022
127700                 MOVE PC-TSYMSG-03763                             12770023
127800                                   TO DP020-MSG-NUMBER            12780022
127900             END-IF                                               12790022
128000         END-IF                                                   12800022
128100     END-IF.                                                      12810022
128200                                                                  12820024
128300     IF PS-COMMAREA-VALID                                         12830024
128400       AND DP020-INT-APPL-FORMAT-IND = PC-REFERRAL-FORMAT         12840024
128500       AND RD020-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP             12850024
128600         SET DP008-RSRC-TYPE-FUNC  TO  TRUE                       12860024
128700         MOVE PC-TENDER-AUTH       TO  DP008-RESOURCE-NAME        12870024
128800         SET DP008-ACCESS-TYPE-USE TO  TRUE                       12880024
128900         EXEC CICS                                                12890024
129000              LINK                                                12900024
129100                 PROGRAM  (DP008-SECURITY-SUBROUTINE)             12910024
129200                 COMMAREA (DP008-SECURITY-COMMAREA)               12920024
129300                 LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)        12930024
129400                 RESP     (PV-RESP)                               12940024
129500         END-EXEC                                                 12950024
129600         IF  PV-RESP NOT = DFHRESP(NORMAL)                        12960024
129700             SET PS-COMMAREA-NOT-VALID                            12970024
129800                                   TO  TRUE                       12980024
129900*            --- BAD LINK TO SECURITY MODULE ---                  12990024
130000             MOVE PC-TSYMSG-00233  TO DP020-MSG-NUMBER            13000024
130100         ELSE                                                     13010024
130200             IF  DP008-ACCESS-ALLOWED                             13020024
130300                 CONTINUE                                         13030024
130400             ELSE                                                 13040024
130500                 SET PS-COMMAREA-NOT-VALID                        13050024
130600                                   TO  TRUE                       13060024
130700*                --- USERID DOES NOT HAVE AUTHORITY TO INSERT     13070024
130800*                    A TENDER ON A CARD UNDER REFERRAL ---        13080024
130900                 MOVE PC-TSYMSG-03764                             13090024
131000                                   TO DP020-MSG-NUMBER            13100024
131100             END-IF                                               13110024
131200         END-IF                                                   13120024
131300     END-IF.                                                      13130024
131400                                                                  13140024
131500*----------------------------------------------------------------*13150000
131600* EDIT DATA PASSED FOR A VOID.                                   *13160000
131700*----------------------------------------------------------------*13170000
131800                                                                  13180000
131900 1130-EDIT-VOID-DATA-PASSED.                                      13190000
132000     IF RD020-CARD-ID       = ZERO                                13200000
132100         SET PS-COMMAREA-NOT-VALID TO  TRUE                       13210000
132200*        --- ENTRY OF FIELD IS REQUIRED ---                       13220000
132300         MOVE PC-TSYMSG-00330      TO DP020-MSG-NUMBER            13230000
132400     END-IF.                                                      13240000
132500                                                                  13250000
132600*----------------------------------------------------------------*13260000
132700*    MAKE SURE CARD IS IN 'AV' (AVAILABLE) STATUS.               *13270000
132800*----------------------------------------------------------------*13280000
132900                                                                  13290000
133000 1140-CHECK-CARD-STATUS.                                          13300000
133100     IF ASC-CARD-STATUS NOT = SV004-CRD-STAT-TYP-AVAILABLE        13310018
133200         SET PS-COMMAREA-NOT-VALID TO  TRUE                       13320000
133300*        --- CARD IS NOT IN 'AVAILABLE' STATUS ---                13330000
133400         MOVE PC-TSYMSG-01237      TO DP020-MSG-NUMBER            13340000
133500     END-IF.                                                      13350000
133600                                                                  13360000
133700*----------------------------------------------------------------*13370000
133800*    FETCH THE CARD STATUS, CONTROL NUMBER AND CARD TYPE         *13380000
133900*    FROM SVT_KOHLS_CRD_ACCT                                     *13390018
134000*----------------------------------------------------------------*13400000
134100                                                                  13410000
134200 1150-GET-CARD-INFO.                                              13420000
134300     EXEC SQL                                                     13430000
134400         SELECT CRD_STAT_CDE                                      13440000
134500               ,T.CRD_PROD_YR                                     13450018
134600               ,T.SHIPT_REQ_NBR                                   13460018
134700               ,CNTL_NBR                                          13470018
134800               ,T.CRD_TYP_CDE                                     13480000
134900               ,PRE_DNNTD_CRD_AMT                                 13490000
135000           INTO :SVT00001-CRD-STAT-CDE,                           13500018
135100                :SVT00001-CRD-PROD-YR,                            13510018
135200                :SVT00001-SHIPT-REQ-NBR,                          13520018
135300                :SVT00001-CNTL-NBR,                               13530018
135400                :SVT00001-CRD-TYP-CDE,                            13540018
135500                :SVT00000-PRE-DNNTD-CRD-AMT                       13550018
135600           FROM SVT_KOHLS_CRD_ACCT T                              13560018
135700              , SVT_CRD_PROD C                                    13570018
135800          WHERE CRD_NBR = :DK-CARD-ID                             13580000
135900            AND T.CRD_PROD_YR = C.CRD_PROD_YR                     13590018
136000            AND T.SHIPT_REQ_NBR = C.SHIPT_REQ_NBR                 13600018
136100          WITH UR                                                 13610018
136200     END-EXEC.                                                    13620000
136300                                                                  13630018
136400     EVALUATE TRUE                                                13640000
136500       WHEN SQLCODE = ZERO                                        13650000
136600           MOVE SVT00001-CRD-STAT-CDE                             13660018
136700                                   TO ASC-CARD-STATUS             13670000
136800           SET SV004-CARD-ST-IDX   TO 1                           13680018
136900           SEARCH SV004-CARD-ST-OCC                               13690018
137000               AT END                                             13700000
137100                   MOVE SPACES     TO ASC-CARD-STATUS-DESC        13710000
137200               WHEN SV004-CARD-ST-CD (SV004-CARD-ST-IDX)          13720018
137300                                   = SVT00001-CRD-STAT-CDE        13730018
137400                   MOVE SV004-CARD-ST-SDESC (SV004-CARD-ST-IDX)   13740018
137500                                   TO ASC-CARD-STATUS-DESC        13750000
137600           END-SEARCH                                             13760000
137700           PERFORM 7300-TB-CONTROL-NBR                            13770018
137800           MOVE TB-CNTL-NBR99      TO ASC-CONTROL-NBR             13780018
137900                                                                  13790000
138000           MOVE SVT00001-CRD-TYP-CDE TO ASC-CRD-TYP-CDE           13800018
138100           SET SV004-CARD-TYP-IDX   TO 1                          13810018
138200           SEARCH SV004-CARD-TYP-OCC                              13820018
138300               AT END                                             13830000
138400                   MOVE SPACES     TO ASC-CRD-TYP-DESC            13840000
138500               WHEN SV004-CARD-TYP-CD (SV004-CARD-TYP-IDX)        13850018
138600                                   = SVT00001-CRD-TYP-CDE         13860018
138700                   MOVE SV004-CARD-TYP-DESC (SV004-CARD-TYP-IDX)  13870018
138800                                   TO ASC-CRD-TYP-DESC            13880000
138900           END-SEARCH                                             13890000
139000                                                                  13900000
139100       WHEN SQLCODE = +100                                        13910000
139200          MOVE SPACES              TO ASC-CARD-STATUS             13920000
139300                                      ASC-CARD-STATUS-DESC        13930000
139400                                      ASC-CRD-TYP-DESC            13940000
139500          SET PS-COMMAREA-NOT-VALID TO TRUE                       13950000
139600*        --- CARD IS NOT FOUND  ---                               13960000
139700          MOVE PC-TSYMSG-01210     TO DP020-MSG-NUMBER            13970000
139800       WHEN OTHER                                                 13980000
139900          MOVE '1150-GET-CARD-INFO'                               13990000
140000                                   TO DP013-PARAGRAPH             14000000
140100          MOVE 'UNABLE TO SELECT CARD ID'                         14010000
140200                                   TO DP013-MESSAGE-TEXT (1)      14020000
140300          MOVE SQLCA               TO DP013-SQLCA                 14030000
140400          MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)   14040018
140500          SET DP013-DB2-ABEND      TO TRUE                        14050000
140600          PERFORM DP013-0000-PROCESS-ABEND                        14060000
140700     END-EVALUATE.                                                14070000
140800                                                                  14080000
140900*----------------------------------------------------------------*14090000
141000*    MOVE THE FIELDS PASSED FROM THE CRITERIA SPEC SCREEN TO     *14100000
141100*    THE APPLICATION SPECIFIC COMMAREA.                          *14110000
141200*----------------------------------------------------------------*14120000
141300                                                                  14130000
141400 1160-GET-CRIT-SPEC-FIELDS.                                       14140000
141500                                                                  14150000
141600     MOVE RD020-ACTIVITY-TYPE  TO ASC-KEY-ACTIVITY-TYPE.          14160000
141700     SET SV004-ACT-TYP-IDX     TO 1.                              14170018
141800     SEARCH SV004-ACT-TYP-OCC                                     14180018
141900         AT END                                                   14190000
142000             MOVE SPACES       TO ASC-ACTIVITY-TYPE-HEADER-DESC   14200000
142100         WHEN SV004-ACT-TYP-CD (SV004-ACT-TYP-IDX)                14210018
142200                       = RD020-ACTIVITY-TYPE                      14220000
142300             MOVE SV004-ACT-TYP-SDESC (SV004-ACT-TYP-IDX)         14230018
142400                               TO ASC-ACTIVITY-TYPE-HEADER-DESC   14240000
142500     END-SEARCH.                                                  14250000
142600     MOVE RD020-POS-DATE-ISO   TO ASC-KEY-POS-DATE-ISO.           14260000
142700     MOVE RD020-STORE-NBR      TO ASC-KEY-STORE-NBR.              14270000
142800     MOVE RD020-TERMINAL       TO ASC-KEY-TERMINAL.               14280000
142900     MOVE RD020-TRANSACTION    TO ASC-KEY-TRANSACTION.            14290000
143000     MOVE RD020-AMOUNT         TO ASC-KEY-AMOUNT-REQUESTED.       14300000
143100     IF (RD020-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP) OR           14310018
143200        (RD020-ACTIVITY-TYPE = SV004-ISSUE-GIFT-CRD-ACT-TYP)      14320018
143300         MOVE SPACES           TO ASC-KEY-DRIVERS-LICENSE         14330000
143400                                  ASC-KEY-DRIVERS-LICENSE-LONG    14340031
143500     ELSE                                                         14350000
143600         MOVE RD020-DRIVERS-LICENSE                               14360000
143700                               TO ASC-KEY-DRIVERS-LICENSE         14370000
143800         MOVE RD020-DRIVERS-LICENSE-LONG                          14380031
143900                               TO ASC-KEY-DRIVERS-LICENSE-LONG    14390031
144000     END-IF.                                                      14400000
144100                                                                  14410000
144200*----------------------------------------------------------------*14420000
144300* IF THE CURRENT TIME IS BETWEEN MIDNIGHT AND 3 AM, THE PREVIOUS *14430000
144400* DAY'S DATE WILL BE USED AS THE CURRENT DATE.  THIS PARAGRAPH   *14440000
144500* GETS THE PREVIOUS DAY'S DATE.                                  *14450000
144600*----------------------------------------------------------------*14460000
144700                                                                  14470000
144800 1200-GET-YESTERDAYS-DATE.                                        14480000
144900                                                                  14490000
145000     INITIALIZE DPG51                                             14500018
145100                DPG52                                             14510018
145200                DPG53                                             14520018
145300                DPG54                                             14530018
145400                DPG55                                             14540018
145500                DPG56.                                            14550018
145600     MOVE DP017-CURRENT-DATE-YYYYMMDD                             14560000
145700                               TO DPG52-LK-DATE-INPUT.            14570000
145800     SET DPG52-LK-DTE-ISO                                         14580000
145900         DPG51-ACTUAL-CALENDAR-ONLY                               14590000
146000         DPG51-DECREMENT-DATE  TO TRUE.                           14600000
146100     MOVE 1                    TO DPG51-INCR-DECR-DAYS-9.         14610000
146200     MOVE ZEROES               TO DPG51-INCR-DECR-BUS-DAYS-9.     14620018
146300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                14630018
146400                                             DPG52                14640018
146500                                             DPG53                14650018
146600                                             DPG54                14660018
146700                                             DPG55                14670018
146800                                             DPG56.               14680018
146900     EVALUATE TRUE                                                14690000
147000       WHEN DPG54-SEVERE-ERROR                                    14700000
147100       WHEN DPG54-DATE-INVALID                                    14710000
147200           SET DP013-NO-ROLLBACK                                  14720000
147300               DP013-XCTL-DISPLAY-RESTART                         14730000
147400               DP013-CICS-ABEND  TO TRUE                          14740000
147500           MOVE '1200-GET-YESTERDAYS-DATE'                        14750000
147600                                 TO DP013-PARAGRAPH               14760000
147700           MOVE 'DATE MODULE ERROR, GETTING YESTERDAYS DATE'      14770000
147800                                 TO DP013-MESSAGE-TEXT (1)        14780000
147900           PERFORM DP013-0000-PROCESS-ABEND                       14790000
148000       WHEN OTHER                                                 14800000
148100         MOVE DPG55-DB2-ISO-DATE-FMT TO ASC-CURR-DATE-ISO         14810000
148200     END-EVALUATE.                                                14820000
148300                                                                  14830000
148400*----------------------------------------------------------------*14840000
148500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITING OF THE DATA    *14850000
148600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *14860000
148700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *14870000
148800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *14880000
148900* FUNCTION KEYS CAN GET THIS FAR.                                *14890000
149000*----------------------------------------------------------------*14900000
149100                                                                  14910000
149200 2000-PROCESS-PANEL.                                              14920000
149300     EVALUATE TRUE                                                14930000
149400         WHEN DP020-SRC-AID = DP016-CLEAR                         14940000
149500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    14950000
149600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   14960000
149700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14970000
149800                                                                  14980000
149900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    14990000
150000             MOVE ASC-KEY-CARD-ID          TO DK-CARD-ID          15000018
150100             INITIALIZE ASC-VOID-STATUS                           15010000
150200                        ASC-REVERSE-VOID-STATUS                   15020018
150300             MOVE 'N' TO ASC-MATCH-FND-SW                         15030018
150400             PERFORM 2050-DELETE-LIST-QUEUE                       15040000
150500             PERFORM 4000-BUILD-INITIAL-PANEL                     15050000
150600                                                                  15060000
150700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    15070000
150800             INITIALIZE ASC-VOID-STATUS                           15080000
150900                        ASC-REVERSE-VOID-STATUS                   15090018
151000             PERFORM 2140-DESELECT-ALL-ITEMS                      15100000
151100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15110000
151200                                                                  15120000
151300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  15130000
151400             INITIALIZE ASC-VOID-STATUS                           15140000
151500                        ASC-REVERSE-VOID-STATUS                   15150018
151600             PERFORM 2150-SELECT-ALL-ITEMS                        15160000
151700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15170000
151800                                                                  15180000
151900         WHEN OTHER                                               15190000
152000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 15200000
152100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   15210000
152200             IF  PS-NO-ERROR                                      15220000
152300                 SET DP030-CONTINUE-GO                            15230000
152400                                   TO TRUE                        15240000
152500                 PERFORM 2100-CHECK-FUNCTION-KEY                  15250000
152600             ELSE                                                 15260000
152700                 SET DP030-OVERRIDE-GO                            15270000
152800                                   TO TRUE                        15280000
152900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             15290000
153000             END-IF                                               15300000
153100     END-EVALUATE.                                                15310000
153200*----------------------------------------------------------------*15320000
153300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *15330000
153400*----------------------------------------------------------------*15340000
153500 2050-DELETE-LIST-QUEUE.                                          15350000
153600                                                                  15360000
153700     EXEC CICS                                                    15370000
153800         DELETEQ TS                                               15380000
153900             QUEUE (ASC-LIST-QUEUE-NAME)                          15390000
154000             RESP  (PV-CICS-RESP)                                 15400000
154100     END-EXEC.                                                    15410000
154200                                                                  15420000
154300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       15430000
154400        (PV-CICS-RESP = DFHRESP(QIDERR))                          15440000
154500         CONTINUE                                                 15450000
154600     ELSE                                                         15460000
154700         SET DP013-CICS-ABEND      TO TRUE                        15470000
154800         SET DP013-NO-ROLLBACK     TO TRUE                        15480000
154900                                                                  15490000
155000         MOVE '2050-DELETE-LIST-QUEUE'                            15500000
155100                                   TO DP013-PARAGRAPH             15510000
155200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    15520000
155300                                   TO DP013-MESSAGE-TEXT (1)      15530000
155400         PERFORM DP013-0000-PROCESS-ABEND                         15540000
155500     END-IF.                                                      15550000
155600                                                                  15560000
155700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  15570000
155800*----------------------------------------------------------------*15580000
155900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*15590000
156000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *15600000
156100* CICS ARCHITECTURE API.                                         *15610000
156200*----------------------------------------------------------------*15620000
156300 2100-CHECK-FUNCTION-KEY.                                         15630000
156400                                                                  15640000
156500     EVALUATE TRUE                                                15650000
156600                                                                  15660000
156700*----------------------------------------------------------------*15670018
156800*    LOCAL 06 (LOCAL CORP EJ)                                    *15680018
156900*----------------------------------------------------------------*15690018
157000         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               15700018
157100                                                                  15710018
157200          IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO                 15720018
157300            SET DP030-OVERRIDE-GO TO TRUE                         15730018
157400*           --  A LIST ITEM MUST BE SELECTED --                   15740018
157500            MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER             15750018
157600            SET DP020-MSG-FATAL   TO TRUE                         15760018
157700          ELSE                                                    15770018
157800            IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1                  15780018
157900              SET DP030-OVERRIDE-GO TO TRUE                       15790018
158000*             --  ONLY ONE LIST ITEM MAY BE SELECTED --           15800018
158100              MOVE PC-TSYMSG-00047                                15810018
158200                                  TO DP020-MSG-NUMBER             15820018
158300              SET DP020-MSG-FATAL TO TRUE                         15830018
158400            ELSE                                                  15840018
158500              INITIALIZE SA031-INTER-APPL-COMMAREA                15850018
158600              MOVE +1             TO ASC-BLK-SUB                  15860018
158700                                     ASC-ITEM-SUB                 15870018
158800              PERFORM 2105-MOVE-EJ-FIELDS                         15880018
158900                VARYING ASC-ITEM-SUB                              15890018
159000                FROM +1 BY +1                                     15900018
159100                UNTIL ASC-ITEM-SUB > +8                           15910018
159200            END-IF                                                15920018
159300          END-IF                                                  15930018
159400*----------------------------------------------------------------*15940018
159500*    LOCAL 05 (LOCAL REVERSE VOID)                               *15950018
159600*----------------------------------------------------------------*15960018
159700         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               15970018
159800                                                                  15980018
159900             INITIALIZE ASC-VOID-STATUS                           15990018
160000                                                                  16000018
160100             EVALUATE TRUE                                        16010018
160200*              *** ORIGINAL REVERSE VOID REQUEST ***              16020018
160300*              *** (NO OUTSTANDING REQUEST)      ***              16030018
160400               WHEN ASC-NO-REVERSE-VOID-REQUEST                   16040018
160500                   IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO         16050018
160600                     IF ASC-NUMBER-OF-SELECTED-ITEMS > 1          16060018
160700*                       --- ONLY ONE LIST ITEM MAY BE SELECTED -- 16070018
160800                       MOVE PC-TSYMSG-00047 TO DP020-MSG-NUMBER   16080018
160900                       SET DP020-MSG-FATAL  TO TRUE               16090018
161000                     ELSE                                         16100018
161100                       SET PS-REV-VOID-REQUEST TO TRUE            16110018
161200                       PERFORM 7000-EDIT-SELECTED-FUNCTION        16120018
161300                     END-IF                                       16130018
161400                   ELSE                                           16140018
161500*                  --- A LIST ITEM MUST BE SELECTED ---           16150018
161600                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     16160018
161700                     SET DP020-MSG-FATAL  TO TRUE                 16170018
161800                   END-IF                                         16180018
161900                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           16190018
162000                                                                  16200018
162100                                                                  16210018
162200*              *** CONFIRMATION OF REVERSE VOID REQUEST ***       16220018
162300               WHEN ASC-REVERSE-VOID-REQUEST-OK                   16230018
162400                   IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO         16240018
162500                     IF ASC-NUMBER-OF-SELECTED-ITEMS > 1          16250018
162600*                        --- ONLY ONE LIST ITEM MAY BE SELECTED --16260018
162700                       MOVE PC-TSYMSG-00047 TO DP020-MSG-NUMBER   16270018
162800                       SET DP020-MSG-FATAL  TO TRUE               16280018
162900                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       16290018
163000                     ELSE                                         16300018
163100                       PERFORM 8700-PROCESS-REFER-VOID            16310018
163200                       INITIALIZE ASC-HOLD-FIELDS                 16320018
163300*                      (DOES A COMMIT SO THAT THE REV VOID WILL BE16330018
163400*                       PICKED UP WHEN REFRESHING THE SCREEN)     16340018
163500                       EXEC CICS                                  16350018
163600                           SYNCPOINT                              16360018
163700                       END-EXEC                                   16370018
163800                       PERFORM 2050-DELETE-LIST-QUEUE             16380018
163900                       PERFORM 4000-BUILD-INITIAL-PANEL           16390018
164000                     END-IF                                       16400018
164100                   ELSE                                           16410018
164200*                    --- A LIST ITEM MUST BE SELECTED ---         16420018
164300                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     16430018
164400                     SET DP020-MSG-FATAL  TO TRUE                 16440018
164500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         16450018
164600                 END-IF                                           16460018
164700                                                                  16470018
164800             END-EVALUATE                                         16480018
164900                                                                  16490018
165000                                                                  16500018
165100*----------------------------------------------------------------*16510018
165200*    LOCAL 04 (LOCAL GO TO COMMENT SCREEN)                       *16520000
165300*----------------------------------------------------------------*16530000
165400         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               16540000
165500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              16550000
165600                 SET DP030-OVERRIDE-GO                            16560000
165700                               TO TRUE                            16570000
165800*                --- NO LIST ITEMS CAN BE SELECTED ---            16580000
165900                 MOVE PC-TSYMSG-00778                             16590000
166000                               TO DP020-MSG-NUMBER                16600000
166100                 SET DP020-MSG-FATAL                              16610000
166200                               TO TRUE                            16620000
166300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16630018
166400             ELSE                                                 16640000
166500                 INITIALIZE RD023-INTER-APPL-COMMAREA             16650000
166600                 MOVE ASC-KEY-CARD-ID TO RD023-CARD-ID            16660000
166700                 MOVE ASC-CRD-TYP-CDE TO RD023-CARD-TYPE          16670000
166800                 MOVE ASC-30-DIGIT-CARD-NBR                       16680018
166900                   TO RD023-30-DIGIT-CARD-NBR                     16690018
167000                 SET ASC-GO-TO-COMMENTS TO TRUE                   16700000
167100             END-IF                                               16710000
167200                                                                  16720000
167300                                                                  16730000
167400*----------------------------------------------------------------*16740000
167500*    LOCAL 03 (LOCAL GO TO OVERRIDE SCREEN)                      *16750000
167600*----------------------------------------------------------------*16760000
167700         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               16770000
167800             INITIALIZE ASC-VOID-STATUS                           16780000
167900                        ASC-REVERSE-VOID-STATUS                   16790018
168000             IF ASC-TRANS-COMPLETE                                16800000
168100                 SET DP030-OVERRIDE-GO                            16810000
168200                               TO TRUE                            16820000
168300*                --- TRANSACTION ALREADY COMPLETE, CANNOT BE      16830000
168400*                    PROCESSED AGAIN ---                          16840000
168500                 MOVE PC-TSYMSG-01233                             16850000
168600                               TO DP020-MSG-NUMBER                16860000
168700                 SET DP020-MSG-FATAL                              16870000
168800                               TO TRUE                            16880000
168900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16890000
169000             ELSE                                                 16900000
169100                 IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO          16910000
169200                     PERFORM 6010-DELETE-SEL-QUEUE                16920018
169300                     INITIALIZE RD021-INTER-APPL-COMMAREA         16930000
169400                     MOVE 1    TO RD021-NUMBER-OF-SELECTED-ITEMS  16940000
169500                                  ASC-NUMBER-OF-SELECTED-ITEMS    16950000
169600                     MOVE ASC-ORIGINAL-BALANCE                    16960000
169700                               TO ASC-SAVE-ORIGINAL-BALANCE       16970000
169800                     PERFORM 5500-PREPARE-SEL-FOR-OVERRIDE        16980000
169900                     SET ASC-GO-TO-OVERRIDE TO TRUE               16990000
170000                 ELSE                                             17000000
170100                     SET DP030-OVERRIDE-GO                        17010000
170200                               TO TRUE                            17020000
170300*                    --- NO LIST ITEMS CAN BE SELECTED ---        17030000
170400                     MOVE PC-TSYMSG-00778                         17040000
170500                               TO DP020-MSG-NUMBER                17050000
170600                     SET DP020-MSG-FATAL                          17060000
170700                               TO TRUE                            17070000
170800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         17080000
170900                 END-IF                                           17090000
171000             END-IF                                               17100000
171100                                                                  17110000
171200*----------------------------------------------------------------*17120000
171300*    LOCAL 02 (LOCAL GO TO DETAIL INQUIRY SCREEN)                *17130000
171400*----------------------------------------------------------------*17140000
171500         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               17150000
171600                                                                  17160000
171700             INITIALIZE ASC-VOID-STATUS                           17170000
171800                        ASC-REVERSE-VOID-STATUS                   17180018
171900                        ASC-VOID-ERROR-SW                         17190018
172000             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              17200000
172100                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 1              17210000
172200                     SET DP030-OVERRIDE-GO                        17220000
172300                               TO TRUE                            17230000
172400*                    --- ONLY ONE LIST ITEM MAY BE SELECTED ---   17240000
172500                     MOVE PC-TSYMSG-00047                         17250000
172600                               TO DP020-MSG-NUMBER                17260000
172700                     SET DP020-MSG-FATAL                          17270000
172800                               TO TRUE                            17280000
172900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         17290000
173000                 ELSE                                             17300000
173100                     INITIALIZE RD021-INTER-APPL-COMMAREA         17310000
173200                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            17320000
173300                               TO RD021-NUMBER-OF-SELECTED-ITEMS  17330000
173400                                                                  17340018
173500                     PERFORM 2160-UNHILITE-LINE-ITEMS             17350018
173600                                                                  17360018
173700                     PERFORM 5000-PREPARE-SEL-QUEUE               17370018
173800                 END-IF                                           17380000
173900             ELSE                                                 17390000
174000                 SET DP030-OVERRIDE-GO                            17400000
174100                               TO TRUE                            17410000
174200*                --- A LIST ITEM MUST BE SELECTED ---             17420000
174300                 MOVE PC-TSYMSG-00057                             17430000
174400                               TO DP020-MSG-NUMBER                17440000
174500                 SET DP020-MSG-FATAL                              17450000
174600                               TO TRUE                            17460000
174700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             17470000
174800             END-IF                                               17480000
174900                                                                  17490000
175000*----------------------------------------------------------------*17500000
175100*    LOCAL 01 (VOID)                                             *17510000
175200*----------------------------------------------------------------*17520000
175300         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               17530000
175400                                                                  17540000
175500           INITIALIZE ASC-REVERSE-VOID-STATUS                     17550018
175600                                                                  17560018
175700           EVALUATE TRUE                                          17570000
175800*            *** ORIGINAL VOID REQUEST (NO OUTSTANDING REQUEST) **17580000
175900             WHEN ASC-NO-VOID-REQUEST                             17590000
176000                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          17600000
176100                     IF ASC-NUMBER-OF-SELECTED-ITEMS > 1          17610000
176200*                        --- ONLY ONE LIST ITEM MAY BE SELECTED --17620000
176300                         MOVE PC-TSYMSG-00047                     17630000
176400                                   TO DP020-MSG-NUMBER            17640000
176500                         SET DP020-MSG-FATAL                      17650000
176600                                   TO TRUE                        17660000
176700                     ELSE                                         17670000
176800                         SET PS-VOID-REQUEST TO TRUE              17680018
176900                         PERFORM 7000-EDIT-SELECTED-FUNCTION      17690018
177000                     END-IF                                       17700000
177100                 ELSE                                             17710000
177200*                    --- A LIST ITEM MUST BE SELECTED ---         17720000
177300                     MOVE PC-TSYMSG-00057                         17730000
177400                                   TO DP020-MSG-NUMBER            17740000
177500                     SET DP020-MSG-FATAL                          17750000
177600                                   TO TRUE                        17760000
177700                 END-IF                                           17770000
177800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             17780000
177900                                                                  17790000
178000*            *** CONFIRMATION OF VOID REQUEST ***                 17800000
178100             WHEN ASC-VOID-REQUEST-OK                             17810000
178200                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          17820000
178300                     IF ASC-NUMBER-OF-SELECTED-ITEMS > 1          17830000
178400                         INITIALIZE ASC-VOID-STATUS               17840000
178500*                        --- ONLY ONE LIST ITEM MAY BE SELECTED --17850000
178600                         MOVE PC-TSYMSG-00047                     17860000
178700                                   TO DP020-MSG-NUMBER            17870000
178800                         SET DP020-MSG-FATAL                      17880000
178900                                   TO TRUE                        17890000
179000                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     17900000
179100                     ELSE                                         17910000
179200                         IF ASC-FORMAT-IND = PC-REFER-VOID-FORMAT 17920000
179300                           OR ASC-FORMAT-IND = PC-REFERRAL-FORMAT 17930000
179400                             PERFORM 8500-PROCESS-REFER-VOID      17940000
179500                         ELSE                                     17950000
179600                             PERFORM 8600-PROCESS-AUDIT-VOID      17960000
179700                         END-IF                                   17970000
179800*                        (DOES A COMMIT SO THAT THE VOID WILL BE  17980000
179900*                         PICKED UP WHEN REFRESHING THE SCREEN)   17990000
180000                         EXEC CICS                                18000000
180100                             SYNCPOINT                            18010000
180200                         END-EXEC                                 18020000
180300                         MOVE ASC-KEY-CARD-ID        TO DK-CARD-ID18030018
180400                         PERFORM 2050-DELETE-LIST-QUEUE           18040000
180500                         PERFORM 4000-BUILD-INITIAL-PANEL         18050000
180600                     END-IF                                       18060000
180700                 ELSE                                             18070000
180800                     INITIALIZE ASC-VOID-STATUS                   18080000
180900*                    --- A LIST ITEM MUST BE SELECTED ---         18090000
181000                     MOVE PC-TSYMSG-00057                         18100000
181100                                   TO DP020-MSG-NUMBER            18110000
181200                     SET DP020-MSG-FATAL                          18120000
181300                                   TO TRUE                        18130000
181400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         18140000
181500                 END-IF                                           18150000
181600           END-EVALUATE                                           18160000
181700                                                                  18170000
181800*----------------------------------------------------------------*18180000
181900*    CONFIRM                                                     *18190000
182000*----------------------------------------------------------------*18200000
182100         WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                     18210000
182200             IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO               18220000
182300                 INITIALIZE ASC-VOID-STATUS                       18230000
182400                            ASC-REVERSE-VOID-STATUS               18240018
182500             END-IF                                               18250000
182600             EVALUATE TRUE                                        18260000
182700                 WHEN ASC-NUMBER-OF-SELECTED-ITEMS > ZERO         18270000
182800*                    --- NO LIST ITEMS CAN BE SELECTED ---        18280000
182900                     MOVE PC-TSYMSG-00778                         18290000
183000                                   TO DP020-MSG-NUMBER            18300000
183100                     SET DP020-MSG-FATAL                          18310000
183200                                   TO TRUE                        18320000
183300                                                                  18330000
183400                 WHEN ASC-AUDIT-UPDATE-OK                         18340000
183500                     PERFORM 8100-AUDIT-UPDATE                    18350000
183600*                   (DOES A COMMIT SO THAT THE STATUS UPDATE WILL 18360000
183700*                    BE PICKED UP WHEN REFRESHING THE SCREEN)     18370000
183800                     EXEC CICS                                    18380000
183900                         SYNCPOINT                                18390000
184000                     END-EXEC                                     18400000
184100                     MOVE ASC-KEY-CARD-ID          TO DK-CARD-ID  18410018
184200                     PERFORM 2050-DELETE-LIST-QUEUE               18420000
184300                     PERFORM 4000-BUILD-INITIAL-PANEL             18430000
184400                                                                  18440000
184500                 WHEN ASC-AUDIT-INSERT-OK                         18450000
184600                     PERFORM 8200-AUDIT-INSERT                    18460000
184700                                                                  18470000
184800                 WHEN ASC-REFER-INSERT-OK                         18480000
184900                     PERFORM 8300-REFER-INSERT                    18490000
185000                                                                  18500000
185100                 WHEN ASC-AUDIT-UPDATE-ERROR                      18510000
185200*                --- TRANSACTION WAS ALREADY VERIFIED,            18520000
185300*                    UPDATE NOT ALLOWED ---                       18530000
185400                     MOVE PC-TSYMSG-01230                         18540000
185500                                   TO DP020-MSG-NUMBER            18550000
185600                     SET DP020-MSG-FATAL                          18560000
185700                                   TO TRUE                        18570000
185800                                                                  18580000
185900                 WHEN ASC-AUDIT-INSERT-ERROR                      18590000
186000*                    --- USERID DOES NOT HAVE AUTHORITY TO ADD    18600000
186100*                        ACTIVITY WHICH DOES NOT EXIST ---        18610000
186200                     MOVE PC-TSYMSG-01231                         18620000
186300                                   TO DP020-MSG-NUMBER            18630000
186400                     SET DP020-MSG-FATAL                          18640000
186500                                   TO TRUE                        18650000
186600                                                                  18660000
186700                 WHEN ASC-REFER-INSERT-ERROR                      18670000
186800*                    --- A TRANSACTION CANNOT BE APPROVED IF THE  18680000
186900*                        AUTH MODULE DECLINED OR REFERRED --      18690000
187000                     MOVE PC-TSYMSG-01232                         18700000
187100                                   TO DP020-MSG-NUMBER            18710000
187200                     SET DP020-MSG-FATAL                          18720000
187300                                   TO TRUE                        18730000
187400                                                                  18740000
187500                 WHEN ASC-REFER-DUPLICATE-ERROR                   18750000
187600*                    --- DUPLICATE TRANSACTION, CANNOT INSERT --  18760000
187700                     MOVE PC-TSYMSG-01266                         18770000
187800                                   TO DP020-MSG-NUMBER            18780000
187900                     SET DP020-MSG-FATAL                          18790000
188000                                   TO TRUE                        18800000
188100                                                                  18810000
188200                 WHEN ASC-TRANS-COMPLETE                          18820000
188300*                    --- TRANS IS ALREADY COMPLETE, CANNOT BE     18830000
188400*                        PROCESSED A SECOND TIME --               18840000
188500                     MOVE PC-TSYMSG-01233                         18850000
188600                                   TO DP020-MSG-NUMBER            18860000
188700                     SET DP020-MSG-FATAL                          18870000
188800                                   TO TRUE                        18880000
188900                                                                  18890000
189000             END-EVALUATE                                         18900000
189100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 18910000
189200                                                                  18920000
189300*----------------------------------------------------------------*18930000
189400*    OTHER KEYS                                                  *18940000
189500*----------------------------------------------------------------*18950000
189600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  18960000
189700             IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO               18970000
189800                 INITIALIZE ASC-VOID-STATUS                       18980000
189900                            ASC-REVERSE-VOID-STATUS               18990018
190000             END-IF                                               19000000
190100             MOVE +1               TO PV-TOP-ITEM                 19010000
190200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 19020000
190300                                                                  19030000
190400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   19040000
190500             IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO               19050000
190600                 INITIALIZE ASC-VOID-STATUS                       19060000
190700                            ASC-REVERSE-VOID-STATUS               19070018
190800             END-IF                                               19080000
190900             PERFORM 2110-BROWSE-BACKWARD                         19090000
191000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 19100000
191100                                                                  19110000
191200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   19120000
191300             IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO               19130000
191400                 INITIALIZE ASC-VOID-STATUS                       19140000
191500                            ASC-REVERSE-VOID-STATUS               19150018
191600             END-IF                                               19160000
191700             PERFORM 2120-BROWSE-FORWARD                          19170000
191800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 19180000
191900                                                                  19190000
192000         WHEN DP020-SRC-AID = DP016-ENTER                         19200000
192100             IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO               19210000
192200                 INITIALIZE ASC-VOID-STATUS                       19220000
192300                            ASC-REVERSE-VOID-STATUS               19230018
192400             END-IF                                               19240000
192500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   19250000
192600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 19260000
192700                                                                  19270000
192800         WHEN OTHER                                               19280000
192900             SET DP013-NO-ROLLBACK                                19290000
193000                 DP013-XCTL-DISPLAY-RESTART                       19300000
193100                 DP013-CICS-ABEND  TO TRUE                        19310000
193200             MOVE '2100-CHECK-FUNCTION-KEY'                       19320000
193300                                   TO DP013-PARAGRAPH             19330000
193400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      19340000
193500                                   TO DP013-MESSAGE-TEXT (1)      19350000
193600             PERFORM DP013-0000-PROCESS-ABEND                     19360000
193700     END-EVALUATE.                                                19370000
193800                                                                  19380018
193900*----------------------------------------------------------------*19390018
194000*    MOVE FIELDS TO THE COMMAREA TO JUMP TO THE EJ SCREEN -      *19400018
194100*    SAKCS426                                                    *19410018
194200*----------------------------------------------------------------*19420018
194300 2105-MOVE-EJ-FIELDS.                                             19430018
194400     IF ASC-TEMP-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                19440018
194500         MOVE ASC-POS-DATE-ISO (ASC-BLK-SUB ASC-ITEM-SUB)         19450018
194600                               TO SA031-SALES-DATE-FROM           19460018
194700                                  SA031-SALES-DATE-TO             19470018
194800         MOVE 'N'              TO SA031-SAME-DATE-SW              19480018
194900         MOVE ASC-STORE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            19490018
195000                               TO SA031-STORE                     19500018
195100         MOVE ASC-TERMINAL  (ASC-BLK-SUB ASC-ITEM-SUB)            19510018
195200                               TO SA031-REGISTER                  19520018
195300         MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)          19530018
195400                               TO SA031-TRANSACTION               19540018
195500     END-IF.                                                      19550018
195600                                                                  19560018
195700*----------------------------------------------------------------*19570000
195800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *19580000
195900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *19590000
196000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *19600000
196100*    MESSAGE.                                                    *19610000
196200*----------------------------------------------------------------*19620000
196300                                                                  19630000
196400 2110-BROWSE-BACKWARD.                                            19640000
196500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    19650000
196600         GIVING PV-TOP-ITEM.                                      19660000
196700                                                                  19670000
196800     IF  ((PV-TOP-ITEM < +1)                                      19680000
196900       OR (PV-TOP-ITEM = +1))                                     19690000
197000         MOVE +1                   TO PV-TOP-ITEM                 19700000
197100         IF  DP020-MSG-NUMBER-X = SPACE                           19710000
197200*            -- TOP OF LIST --                                    19720000
197300             MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER            19730000
197400             SET DP020-MSG-INFORMATIONAL                          19740000
197500                                   TO TRUE                        19750000
197600         END-IF                                                   19760000
197700     END-IF.                                                      19770000
197800                                                                  19780000
197900*----------------------------------------------------------------*19790000
198000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *19800000
198100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *19810000
198200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *19820000
198300*----------------------------------------------------------------*19830000
198400                                                                  19840000
198500 2120-BROWSE-FORWARD.                                             19850000
198600                                                                  19860000
198700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              19870000
198800         GIVING PV-TOP-ITEM.                                      19880000
198900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   19890000
199000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            19900000
199100                                   TO PV-TOP-ITEM                 19910000
199200         IF  DP020-MSG-NUMBER-X = SPACE                           19920000
199300*            -- BOTTOM OF LIST --                                 19930000
199400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            19940000
199500             SET DP020-MSG-INFORMATIONAL                          19950000
199600                                   TO TRUE                        19960000
199700         END-IF                                                   19970000
199800     ELSE                                                         19980000
199900         COMPUTE PV-BOTTOM-ITEM =                                 19990000
200000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 20000000
200100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            20010000
200200             IF  DP020-MSG-NUMBER-X = SPACE                       20020000
200300*                -- BOTTOM OF LIST --                             20030000
200400                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         20040000
200500                 SET DP020-MSG-INFORMATIONAL                      20050000
200600                                       TO TRUE                    20060000
200700             END-IF                                               20070000
200800         END-IF                                                   20080000
200900     END-IF.                                                      20090000
201000*----------------------------------------------------------------*20100000
201100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *20110000
201200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *20120000
201300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *20130000
201400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *20140000
201500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *20150000
201600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *20160000
201700*----------------------------------------------------------------*20170000
201800                                                                  20180000
201900 2130-CHECK-FOR-JUMP-BROWSE.                                      20190000
202000     SET PS-NO-ERROR               TO TRUE.                       20200000
202100     IF (ASC-START-ITEM-REQUEST = SPACE)                          20210000
202200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            20220000
202300                                   TO PV-TOP-ITEM                 20230000
202400     ELSE                                                         20240000
202500         MOVE ASC-START-ITEM-REQUEST                              20250000
202600                                   TO DP010I-UNEDITED-FIELD       20260000
202700         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       20270000
202800         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     20280000
202900         SET DP010I-NEGATIVE-NOT-ALLOWED                          20290000
203000                                   TO TRUE                        20300000
203110         CALL DP010I-NUMERIC-EDIT-ROUTINE                         20311035
203120                         USING DP010I-NUMERIC-EDIT-AREA           20312035
203200                                                                  20320000
203300         IF  NOT DP010I-ERROR-DETECTED                            20330000
203400             MOVE DP010I-NUMERIC-FIELD                            20340000
203500                                   TO  ASC-START-ITEM-REQUEST-N   20350000
203600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  20360000
203700                 IF  ASC-START-ITEM-REQUEST-N >                   20370000
203800                                          ASC-NUMBER-OF-ITEMS-READ20380000
203900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         20390000
204000                     COMPUTE PV-TOP-ITEM =                        20400000
204100                             ASC-NUMBER-OF-ITEMS-READ             20410000
204200                             - PC-ITEMS-PER-PANEL + 1             20420000
204300                     IF  PV-TOP-ITEM < +1                         20430000
204400                         MOVE +1   TO PV-TOP-ITEM                 20440000
204500                         IF  DP020-MSG-NUMBER-X = SPACE           20450000
204600*                            --- BOTTOM OF LIST ---               20460000
204700                             MOVE PC-TSYMSG-00070                 20470000
204800                                   TO DP020-MSG-NUMBER            20480000
204900                             SET DP020-MSG-INFORMATIONAL          20490000
205000                                   TO TRUE                        20500000
205100                         END-IF                                   20510000
205200                     END-IF                                       20520000
205300                 ELSE                                             20530000
205400                     MOVE ASC-START-ITEM-REQUEST-N                20540000
205500                                   TO PV-TOP-ITEM                 20550000
205600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      20560000
205700                     COMPUTE PV-BOTTOM-ITEM =                     20570000
205800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     20580000
205900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ20590000
206000                         IF  DP020-MSG-NUMBER-X = SPACE           20600000
206100*                            -- BOTTOM OF LIST --                 20610000
206200                             MOVE PC-TSYMSG-00070                 20620000
206300                                   TO DP020-MSG-NUMBER            20630000
206400                             SET DP020-MSG-INFORMATIONAL          20640000
206500                                   TO TRUE                        20650000
206600                         END-IF                                   20660000
206700                     END-IF                                       20670000
206800                 END-IF                                           20680000
206900             ELSE                                                 20690000
207000*                --- VALUE OUT OF RANGE ----                      20700000
207100                 MOVE PC-TSYMSG-00101                             20710000
207200                                   TO DP020-MSG-NUMBER            20720000
207300                 MOVE -1           TO ASTRTITL                    20730000
207400                 SET DP030-SET-CURSOR-APPL-1                      20740000
207500                                   TO TRUE                        20750000
207600                 MOVE DP015-REVERSE                               20760000
207700                                   TO ASTRTITH                    20770000
207800                 MOVE DP015-RED    TO ASTRTITC                    20780000
207900                 MOVE DP015-UNP-NUM-BRT-MDT                       20790000
208000                                   TO ASTRTITA                    20800000
208100                 SET DP020-MSG-FATAL                              20810000
208200                                   TO TRUE                        20820000
208300                 SET PS-ERROR      TO TRUE                        20830000
208400             END-IF                                               20840000
208500                                                                  20850000
208600         ELSE                                                     20860000
208700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            20870000
208800*            --- MUST BE NUMERIC ---                              20880000
208900             MOVE -1               TO ASTRTITL                    20890000
209000             SET DP030-SET-CURSOR-APPL-1                          20900000
209100                                   TO TRUE                        20910000
209200             MOVE DP015-REVERSE    TO ASTRTITH                    20920000
209300             MOVE DP015-RED        TO ASTRTITC                    20930000
209400             MOVE DP015-UNP-NUM-BRT-MDT                           20940000
209500                                   TO ASTRTITA                    20950000
209600             SET DP020-MSG-FATAL   TO TRUE                        20960000
209700             SET PS-ERROR          TO TRUE                        20970000
209800         END-IF                                                   20980000
209900     END-IF.                                                      20990000
210000*----------------------------------------------------------------*21000000
210100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *21010000
210200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *21020000
210300*----------------------------------------------------------------*21030000
210400 2140-DESELECT-ALL-ITEMS.                                         21040000
210500     MOVE +1                       TO ASC-BLK-SUB.                21050000
210600                                                                  21060000
210700     PERFORM 2141-CLEAR-SELECTED-INDS                             21070000
210800         VARYING ASC-ITEM-SUB                                     21080000
210900         FROM 1 BY 1                                              21090000
211000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 21100000
211100                                                                  21110000
211200     ADD +1                        TO ASC-BLK-SUB.                21120000
211300                                                                  21130000
211400     PERFORM 2141-CLEAR-SELECTED-INDS                             21140000
211500         VARYING ASC-ITEM-SUB                                     21150000
211600         FROM 1 BY 1                                              21160000
211700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 21170000
211800                                                                  21180000
211900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               21190000
212000                                   TO PV-LIST-ITEM-NUMBER.        21200000
212100                                                                  21210000
212200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            21220000
212300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21230000
212400                                                                  21240000
212500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     21250000
212600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      21260000
212700         MOVE +1                   TO ASC-BLK-SUB                 21270000
212800                                                                  21280000
212900         PERFORM 5100-WRITE-TEMP-STORAGE                          21290000
213000                                                                  21300000
213100         MOVE +1                   TO PV-BLOCK-NUMBER             21310000
213200                                                                  21320000
213300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         21330000
213400             PV-FIRST-BLOCK-IN-ARRAY - 1                          21340000
213500                                                                  21350000
213600         PERFORM                                                  21360000
213700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       21370000
213800                                                                  21380000
213900             PERFORM 4410-READ-TEMP-STORAGE                       21390000
214000                                                                  21400000
214100             PERFORM 2141-CLEAR-SELECTED-INDS                     21410000
214200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 21420000
214300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21430000
214400                                                                  21440000
214500             PERFORM 5100-WRITE-TEMP-STORAGE                      21450000
214600                                                                  21460000
214700             ADD +1                TO PV-BLOCK-NUMBER             21470000
214800                                                                  21480000
214900         END-PERFORM                                              21490000
215000                                                                  21500000
215100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         21510000
215200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     21520000
215300                                                                  21530000
215400         PERFORM                                                  21540000
215500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       21550000
215600                   ASC-HIGHEST-BLOCK-WRITTEN                      21560000
215700                                                                  21570000
215800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          21580000
215900                                   TO PV-BLOCK-NUMBER             21590000
216000                                                                  21600000
216100             PERFORM 4410-READ-TEMP-STORAGE                       21610000
216200                                                                  21620000
216300             PERFORM 2141-CLEAR-SELECTED-INDS                     21630000
216400                 VARYING ASC-ITEM-SUB                             21640000
216500                 FROM 1 BY 1                                      21650000
216600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21660000
216700                                                                  21670000
216800             PERFORM 5100-WRITE-TEMP-STORAGE                      21680000
216900                                                                  21690000
217000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      21700000
217100                                                                  21710000
217200         END-PERFORM                                              21720000
217300                                                                  21730000
217400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21740000
217500                                   TO PV-BLOCK-NUMBER             21750000
217600                                                                  21760000
217700         PERFORM 4410-READ-TEMP-STORAGE                           21770000
217800     END-IF.                                                      21780000
217900                                                                  21790000
218000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 21800000
218100     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  21810000
218200     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    21820000
218300                                                                  21830000
218400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        21840000
218500                                                                  21850000
218600*----------------------------------------------------------------*21860000
218700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *21870000
218800*----------------------------------------------------------------*21880000
218900                                                                  21890000
219000 2141-CLEAR-SELECTED-INDS.                                        21900000
219100                                                                  21910000
219200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           21920000
219300             NOT EQUAL ZERO                                       21930000
219400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21940000
219500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21950000
219600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    21960000
219700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  21970000
219800                                   TO TRUE                        21980000
219900         END-IF                                                   21990000
220000     END-IF.                                                      22000000
220100                                                                  22010000
220200*----------------------------------------------------------------*22020000
220300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *22030000
220400*  FOR ALL ITEMS.                                                *22040000
220500*----------------------------------------------------------------*22050000
220600                                                                  22060000
220700 2150-SELECT-ALL-ITEMS.                                           22070000
220800                                                                  22080000
220900     MOVE +1                       TO ASC-BLK-SUB.                22090000
221000                                                                  22100000
221100     PERFORM 2151-SET-SELECTED-INDS                               22110000
221200         VARYING ASC-ITEM-SUB                                     22120000
221300         FROM 1 BY 1                                              22130000
221400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 22140000
221500                                                                  22150000
221600     ADD +1                        TO ASC-BLK-SUB.                22160000
221700                                                                  22170000
221800     PERFORM 2151-SET-SELECTED-INDS                               22180000
221900         VARYING ASC-ITEM-SUB                                     22190000
222000         FROM 1 BY 1                                              22200000
222100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 22210000
222200                                                                  22220000
222300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               22230000
222400                                   TO PV-LIST-ITEM-NUMBER.        22240000
222500                                                                  22250000
222600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            22260000
222700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22270000
222800                                                                  22280000
222900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     22290000
223000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    22300000
223100         MOVE +1                   TO ASC-BLK-SUB                 22310000
223200                                                                  22320000
223300         PERFORM 5100-WRITE-TEMP-STORAGE                          22330000
223400                                                                  22340000
223500         MOVE +1                   TO PV-BLOCK-NUMBER             22350000
223600                                                                  22360000
223700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         22370000
223800             PV-FIRST-BLOCK-IN-ARRAY - 1                          22380000
223900                                                                  22390000
224000         PERFORM                                                  22400000
224100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       22410000
224200                                                                  22420000
224300             PERFORM 4410-READ-TEMP-STORAGE                       22430000
224400                                                                  22440000
224500             PERFORM 2151-SET-SELECTED-INDS                       22450000
224600                 VARYING ASC-ITEM-SUB                             22460000
224700                 FROM 1 BY 1                                      22470000
224800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          22480000
224900                                                                  22490000
225000             PERFORM 5100-WRITE-TEMP-STORAGE                      22500000
225100                                                                  22510000
225200             ADD +1                TO PV-BLOCK-NUMBER             22520000
225300                                                                  22530000
225400         END-PERFORM                                              22540000
225500                                                                  22550000
225600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         22560000
225700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     22570000
225800                                                                  22580000
225900         PERFORM                                                  22590000
226000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       22600000
226100                   ASC-HIGHEST-BLOCK-WRITTEN                      22610000
226200                                                                  22620000
226300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          22630000
226400                                   TO PV-BLOCK-NUMBER             22640000
226500                                                                  22650000
226600             PERFORM 4410-READ-TEMP-STORAGE                       22660000
226700                                                                  22670000
226800             PERFORM 2151-SET-SELECTED-INDS                       22680000
226900                 VARYING ASC-ITEM-SUB                             22690000
227000                 FROM 1 BY 1                                      22700000
227100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          22710000
227200                                                                  22720000
227300             PERFORM 5100-WRITE-TEMP-STORAGE                      22730000
227400                                                                  22740000
227500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      22750000
227600                                                                  22760000
227700         END-PERFORM                                              22770000
227800                                                                  22780000
227900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             22790000
228000                                   TO PV-BLOCK-NUMBER             22800000
228100                                                                  22810000
228200         PERFORM 4410-READ-TEMP-STORAGE                           22820000
228300     END-IF.                                                      22830000
228400                                                                  22840000
228500                                                                  22850000
228600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             22860000
228700                       ASC-NUMBER-OF-SELECTED-ITEMS.              22870000
228800                                                                  22880000
228900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        22890000
229000                                                                  22900000
229100*----------------------------------------------------------------*22910000
229200*    MARK EACH ITEM AS BEING SELECTED.                           *22920000
229300*----------------------------------------------------------------*22930000
229400                                                                  22940000
229500 2151-SET-SELECTED-INDS.                                          22950000
229600                                                                  22960000
229700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           22970000
229800             NOT EQUAL ZERO                                       22980000
229900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             22990000
230000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             23000000
230100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        23010000
230200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  23020000
230300                               TO  TRUE                           23030000
230400         END-IF                                                   23040000
230500     END-IF.                                                      23050000
230600                                                                  23060018
230700*----------------------------------------------------------------*23070018
230800*    UN-HILITE ALL LINE ITEMS BECAUSE A DIFFERENT SCREEN IS BEING*23080018
230900*    ACCESSED.                                                   *23090018
231000*----------------------------------------------------------------*23100018
231100 2160-UNHILITE-LINE-ITEMS.                                        23110018
231200                                                                  23120018
231300     MOVE +1 TO ASC-BLK-SUB.                                      23130018
231400     SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE.                23140018
231500     PERFORM                                                      23150018
231600       VARYING ASC-ITEM-SUB                                       23160018
231700       FROM 1 BY 1                                                23170018
231800       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                    23180018
231900                                                                  23190018
232000         SET ASC-NO-HILITE (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     23200018
232100                                                                  23210018
232200     END-PERFORM.                                                 23220018
232300                                                                  23230018
232400     ADD +1 TO ASC-BLK-SUB.                                       23240018
232500     SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE.                23250018
232600     PERFORM                                                      23260018
232700       VARYING ASC-ITEM-SUB                                       23270018
232800       FROM 1 BY 1                                                23280018
232900       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                    23290018
233000                                                                  23300018
233100         SET ASC-NO-HILITE (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     23310018
233200                                                                  23320018
233300     END-PERFORM.                                                 23330018
233400                                                                  23340018
233500*----------------------------------------------------------------*23350000
233600*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *23360000
233700*  SCREEN INTO THE COMMAREA.  ALL EDITING IS DONE IN THE COMM.   *23370000
233800*----------------------------------------------------------------*23380000
233900 2200-MOVE-SCREEN-TO-COMMAREA.                                    23390000
234000                                                                  23400000
234100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             23410000
234200     MOVE +1                       TO PV-SUB.                     23420000
234300                                                                  23430000
234400     PERFORM 3100-SET-SUBSCRIPTS.                                 23440000
234500     IF  ASTRTITL > ZERO                                          23450000
234600         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      23460000
234700     ELSE                                                         23470000
234800         IF  ASTRTITF = DP015-ERASE-EOF                           23480000
234900             INITIALIZE ASC-START-ITEM-REQUEST                    23490000
235000         END-IF                                                   23500000
235100     END-IF.                                                      23510000
235200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          23520000
235300         VARYING PV-SUB                                           23530000
235400         FROM 1 BY 1                                              23540000
235500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      23550000
235600*----------------------------------------------------------------*23560000
235700*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *23570000
235800*----------------------------------------------------------------*23580000
235900 2210-MOVE-LINES-TO-COMMAREA.                                     23590000
236000     IF  MR-SELECTL (PV-SUB) > ZERO                               23600000
236100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             23610000
236200         MOVE MR-SELECTI (PV-SUB)                                 23620000
236300                                   TO ASC-TEMP-SELECTED-SW        23630000
236400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      23640000
236500*        CHECK TO SEE IF LINE SELECTED HAS CHANGED.               23650018
236600*        IF IT DID MUST FIND NEW MATCHING TRANSACTION             23660018
236700         IF ASC-HOLD-SEL-LN (ASC-BLK-SUB, ASC-ITEM-SUB)           23670018
236800            NOT = MR-SELECTI (PV-SUB)                             23680018
236900               MOVE 'N' TO ASC-MATCH-FND-SW                       23690018
237000         END-IF                                                   23700018
237100     ELSE                                                         23710000
237200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                23720000
237300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     23730000
237400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        23740000
237500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      23750000
237600         END-IF                                                   23760000
237700     END-IF.                                                      23770000
237800     ADD +1                        TO ASC-ITEM-SUB.               23780000
237900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23790000
238000         ADD +1                    TO ASC-BLK-SUB                 23800000
238100         MOVE +1                   TO ASC-ITEM-SUB                23810000
238200     END-IF.                                                      23820000
238300*----------------------------------------------------------------*23830000
238400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *23840000
238500*  COMMAREA (EDITING IS NOT DONE AGAINST THE SCREEN DIRECTLY).   *23850000
238600*----------------------------------------------------------------*23860000
238700 3000-EDIT-DATA-IN-COMMAREA.                                      23870000
238800     SET PS-NO-ERROR               TO TRUE.                       23880000
238900     PERFORM 3200-RESET-ATTRIBUTES.                               23890000
239000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     23900000
239100**                                                                23910000
239200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              23920000
239300* EDITING IS DONE FROM THE BOTTOM UP.                             23930000
239400**                                                                23940000
239500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       23950000
239600         ASC-ITEMS-DISPLAYED - 1.                                 23960000
239700     PERFORM 3100-SET-SUBSCRIPTS.                                 23970000
239800     PERFORM 3300-EDIT-SELECTIONS                                 23980000
239900         VARYING PV-SUB                                           23990000
240000         FROM PV-SUB BY -1                                        24000000
240100         UNTIL PV-SUB < +1                                        24010000
240200                                                                  24020000
240300     IF  PS-NO-ERROR                                              24030000
240400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        24040000
240500     END-IF.                                                      24050000
240600                                                                  24060000
240700     IF  ((PS-NO-ERROR)                                           24070000
240800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   24080000
240900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    24090000
241000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  24100000
241100     END-IF.                                                      24110000
241200*----------------------------------------------------------------*24120000
241300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *24130000
241400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*24140000
241500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *24150000
241600*                                                                *24160000
241700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *24170000
241800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *24180000
241900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *24190000
242000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *24200000
242100*----------------------------------------------------------------*24210000
242200                                                                  24220000
242300 3100-SET-SUBSCRIPTS.                                             24230000
242400                                                                  24240000
242500     COMPUTE ASC-ITEM-SUB =                                       24250000
242600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        24260000
242700                                                                  24270000
242800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         24280000
242900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            24290000
243000         IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                     24300000
243100             MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB              24310000
243200         END-IF                                                   24320000
243300                                                                  24330000
243400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               24340000
243500     ELSE                                                         24350000
243600         MOVE +1                     TO ASC-BLK-SUB               24360000
243700     END-IF.                                                      24370000
243800*----------------------------------------------------------------*24380000
243900*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *24390000
244000*----------------------------------------------------------------*24400000
244100                                                                  24410000
244200 3200-RESET-ATTRIBUTES.                                           24420000
244300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   24430000
244400     MOVE DP015-GREEN              TO ASTRTITC.                   24440000
244500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   24450000
244600                                                                  24460000
244700     PERFORM                                                      24470000
244800         VARYING PV-SUB                                           24480000
244900         FROM 1 BY 1                                              24490000
245000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        24500000
245100         MOVE DP015-UNP-ALP-NOR-OFF                               24510000
245200                                   TO MR-SELECTA (PV-SUB)         24520000
245300         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         24530000
245400         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         24540000
245500     END-PERFORM.                                                 24550000
245600*----------------------------------------------------------------*24560000
245700*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *24570000
245800*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *24580000
245900*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *24590000
246000*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *24600000
246100*----------------------------------------------------------------*24610000
246200 3300-EDIT-SELECTIONS.                                            24620000
246300     EVALUATE TRUE                                                24630000
246400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     24640000
246500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         24650000
246600                 CONTINUE                                         24660000
246700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         24670000
246800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        24680000
246900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   24690000
247000                 MOVE ASC-TEMP-SELECTED-SW                        24700000
247100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24710000
247200                                TO ASC-SELECTED-SW                24720000
247300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24730000
247400             END-IF                                               24740000
247500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     24750000
247600                 = SPACE                                          24760000
247700             EVALUATE TRUE                                        24770000
247800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       24780000
247900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS24790000
248000                     MOVE SPACE TO ASC-SELECTED-SW                24800000
248100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24810000
248200                     SET ASC-NO-HILITE                            24820000
248300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 24830000
248400                                TO TRUE                           24840000
248500                     SET ASC-NO-VOID-ERROR                        24850000
248600                                TO TRUE                           24860000
248700                     MOVE ZERO TO ASC-VOID-MSG-NBR                24870000
248800                     SET ASC-NO-VOID-REQUEST                      24880018
248900                         ASC-NO-REVERSE-VOID-REQUEST TO TRUE      24890018
249000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        24900000
249100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    24910000
249200                     MOVE SPACE TO ASC-SELECTED-SW                24920000
249300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24930000
249400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          24940000
249500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      24950000
249600                     MOVE SPACE TO ASC-SELECTED-SW                24960000
249700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24970000
249800             END-EVALUATE                                         24980000
249900         WHEN OTHER                                               24990000
250000*            --- INVALID VALUE ---                                25000000
250100             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           25010000
250200             SET DP020-MSG-FATAL    TO TRUE                       25020000
250300             MOVE -1                TO MR-SELECTL (PV-SUB)        25030000
250400             SET DP030-SET-CURSOR-APPL-1                          25040000
250500                                    TO TRUE                       25050000
250600             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        25060000
250700             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        25070000
250800             SET PS-ERROR TO TRUE                                 25080000
250900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            25090000
251000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     25100000
251100                 MOVE SPACE         TO ASC-SELECTED-SW            25110000
251200                                        (ASC-BLK-SUB ASC-ITEM-SUB)25120000
251300             END-IF                                               25130000
251400     END-EVALUATE.                                                25140000
251500                                                                  25150000
251600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 25160000
251700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               25170000
251800     IF  ASC-ITEM-SUB < 1                                         25180000
251900         SUBTRACT +1 FROM ASC-BLK-SUB                             25190000
252000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                25200000
252100     END-IF.                                                      25210000
252200*----------------------------------------------------------------*25220000
252300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *25230000
252400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *25240000
252500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *25250000
252600*  THE ENDING.                                                   *25260000
252700*----------------------------------------------------------------*25270000
252800 3310-EDIT-RANGE.                                                 25280000
252900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                25290000
253000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   25300000
253100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)25310000
253200                                   TO ASC-SELECTED-SW             25320000
253300                                        (ASC-BLK-SUB ASC-ITEM-SUB)25330000
253400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 25340000
253500         ELSE                                                     25350000
253600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     25360000
253700                 CONTINUE                                         25370000
253800             ELSE                                                 25380000
253900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        25390000
254000                 MOVE PC-TSYMSG-00054                             25400000
254100                                   TO DP020-MSG-NUMBER            25410000
254200                 SET DP020-MSG-FATAL                              25420000
254300                                   TO TRUE                        25430000
254400                 MOVE -1           TO MR-SELECTL (PV-SUB)         25440000
254500                 SET DP030-SET-CURSOR-APPL-1                      25450000
254600                                   TO TRUE                        25460000
254700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         25470000
254800                 MOVE DP015-UNDERLINE                             25480000
254900                                   TO MR-SELECTH (PV-SUB)         25490000
255000                 SET PS-ERROR      TO TRUE                        25500000
255100             END-IF                                               25510000
255200         END-IF                                                   25520000
255300     ELSE                                                         25530000
255400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25540000
255500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 25550000
255600                                   TO ASC-SELECTED-SW             25560000
255700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   25570000
255800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   25580000
255900         ELSE                                                     25590000
256000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       25600000
256100                 CONTINUE                                         25610000
256200             ELSE                                                 25620000
256300*                -- ONLY ONE END-OF-RANGE ALLOWED --              25630000
256400                 MOVE PC-TSYMSG-00055                             25640000
256500                                   TO DP020-MSG-NUMBER            25650000
256600                 SET DP020-MSG-FATAL                              25660000
256700                                   TO TRUE                        25670000
256800                 MOVE -1           TO MR-SELECTL (PV-SUB)         25680000
256900                 SET DP030-SET-CURSOR-APPL-1                      25690000
257000                                   TO TRUE                        25700000
257100                 SET PS-ERROR      TO TRUE                        25710000
257200             END-IF                                               25720000
257300         END-IF                                                   25730000
257400     END-IF.                                                      25740000
257500                                                                  25750000
257600*----------------------------------------------------------------*25760000
257700*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *25770000
257800*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *25780000
257900*----------------------------------------------------------------*25790000
258000 3400-CHECK-RANGE-SEQUENCE.                                       25800000
258100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       25810000
258200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      25820000
258300       AND  ASC-START-OF-SELECTED-RANGE >                         25830000
258400                                         ASC-END-OF-SELECTED-RANGE25840000
258500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                25850000
258600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 25860000
258700         SET DP020-MSG-FATAL TO TRUE                              25870000
258800         SET PS-ERROR TO TRUE                                     25880000
258900         PERFORM 3410-POSITION-AT-ERROR                           25890000
259000     END-IF.                                                      25900000
259100*----------------------------------------------------------------*25910000
259200*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *25920000
259300*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *25930000
259400*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *25940000
259500*----------------------------------------------------------------*25950000
259600 3410-POSITION-AT-ERROR.                                          25960000
259700     SET DP030-SET-CURSOR-APPL-1                                  25970000
259800                                   TO TRUE.                       25980000
259900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25990000
260000                    - PV-TOP-ITEM + 1.                            26000000
260100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26010000
260200         CONTINUE                                                 26020000
260300     ELSE                                                         26030000
260400         MOVE -1                   TO MR-SELECTL (PV-SUB)         26040000
260500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         26050000
260600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         26060000
260700     END-IF.                                                      26070000
260800                                                                  26080000
260900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   26090000
261000                    - PV-TOP-ITEM + 1.                            26100000
261100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26110000
261200         CONTINUE                                                 26120000
261300     ELSE                                                         26130000
261400         MOVE -1                   TO MR-SELECTL (PV-SUB)         26140000
261500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         26150000
261600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         26160000
261700     END-IF.                                                      26170000
261800*----------------------------------------------------------------*26180000
261900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *26190000
262000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *26200000
262100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *26210000
262200*----------------------------------------------------------------*26220000
262300                                                                  26230000
262400 3500-MARK-RANGE-AS-SELECTED.                                     26240000
262500     MOVE +1                       TO  ASC-BLK-SUB.               26250000
262600     PERFORM 3510-MARK-SELECTED-INDS                              26260000
262700         VARYING ASC-ITEM-SUB                                     26270000
262800         FROM 1 BY 1                                              26280000
262900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 26290000
263000                                                                  26300000
263100     ADD +1                        TO ASC-BLK-SUB.                26310000
263200     PERFORM 3510-MARK-SELECTED-INDS                              26320000
263300         VARYING ASC-ITEM-SUB                                     26330000
263400         FROM 1 BY 1                                              26340000
263500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 26350000
263600                                                                  26360000
263700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               26370000
263800                                   TO  PV-LIST-ITEM-NUMBER.       26380000
263900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            26390000
264000         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         26400000
264100               PC-ITEMS-PER-PANEL).                               26410000
264200                                                                  26420000
264300     MOVE ASC-START-OF-SELECTED-RANGE                             26430000
264400                                   TO PV-START-OF-SELECTED-RANGE. 26440000
264500     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            26450000
264600         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  26460000
264700               PC-ITEMS-PER-PANEL).                               26470000
264800                                                                  26480000
264900     MOVE ASC-END-OF-SELECTED-RANGE                               26490000
265000                                   TO  PV-END-OF-SELECTED-RANGE.  26500000
265100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             26510000
265200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    26520000
265300               PC-ITEMS-PER-PANEL).                               26530000
265400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             26540000
265500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             26550000
265600                                                                  26560000
265700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    26570000
265800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        26580000
265900         MOVE +1                   TO ASC-BLK-SUB                 26590000
266000         PERFORM 5100-WRITE-TEMP-STORAGE                          26600000
266100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         26610000
266200             PV-FIRST-BLOCK-IN-ARRAY - 1                          26620000
266300                                                                  26630000
266400         PERFORM                                                  26640000
266500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      26650000
266600                   PV-PREV-BLOCK-IN-ARRAY                         26660000
266700             MOVE PV-FIRST-BLOCK-IN-RANGE                         26670000
266800                                   TO PV-BLOCK-NUMBER             26680000
266900             PERFORM 4410-READ-TEMP-STORAGE                       26690000
267000             PERFORM 3510-MARK-SELECTED-INDS                      26700000
267100                 VARYING ASC-ITEM-SUB                             26710000
267200                 FROM 1 BY 1                                      26720000
267300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          26730000
267400             PERFORM 5100-WRITE-TEMP-STORAGE                      26740000
267500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     26750000
267600         END-PERFORM                                              26760000
267700                                                                  26770000
267800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         26780000
267900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     26790000
268000         PERFORM                                                  26800000
268100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       26810000
268200                   PV-LAST-BLOCK-IN-RANGE                         26820000
268300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          26830000
268400                                   TO PV-BLOCK-NUMBER             26840000
268500             PERFORM 4410-READ-TEMP-STORAGE                       26850000
268600             PERFORM 3510-MARK-SELECTED-INDS                      26860000
268700                 VARYING ASC-ITEM-SUB                             26870000
268800                 FROM 1 BY 1                                      26880000
268900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          26890000
269000             PERFORM 5100-WRITE-TEMP-STORAGE                      26900000
269100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      26910000
269200         END-PERFORM                                              26920000
269300                                                                  26930000
269400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             26940000
269500                                   TO PV-BLOCK-NUMBER             26950000
269600         PERFORM 4410-READ-TEMP-STORAGE                           26960000
269700     END-IF.                                                      26970000
269800                                                                  26980000
269900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 26990000
270000                                      ASC-END-OF-SELECTED-RANGE.  27000000
270100                                                                  27010000
270200*----------------------------------------------------------------*27020000
270300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *27030000
270400*----------------------------------------------------------------*27040000
270500                                                                  27050000
270600 3510-MARK-SELECTED-INDS.                                         27060000
270700                                                                  27070000
270800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         27080000
270900                                ASC-ITEM-SUB) >                   27090000
271000         ASC-START-OF-SELECTED-RANGE)                             27100000
271100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         27110000
271200                                ASC-ITEM-SUB) =                   27120000
271300         ASC-START-OF-SELECTED-RANGE)                             27130000
271400                                                                  27140000
271500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     27150000
271600                                    ASC-ITEM-SUB) <               27160000
271700             ASC-END-OF-SELECTED-RANGE)                           27170000
271800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     27180000
271900                                    ASC-ITEM-SUB) =               27190000
272000             ASC-END-OF-SELECTED-RANGE)                           27200000
272100                                                                  27210000
272200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          27220000
272300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   27230000
272400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   27240000
272500                               TO TRUE                            27250000
272600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              27260000
272700                               TO TRUE                            27270000
272800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    27280000
272900             END-IF                                               27290000
273000         END-IF                                                   27300000
273100     END-IF.                                                      27310000
273200                                                                  27320000
273300*----------------------------------------------------------------*27330000
273400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *27340000
273500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *27350000
273600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *27360000
273700*    DISPLAY THE PANEL TO USER.                                  *27370000
273800*----------------------------------------------------------------*27380000
273900                                                                  27390000
274000 4000-BUILD-INITIAL-PANEL.                                        27400000
274100                                                                  27410000
274200     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             27420000
274300                                ASC-BLOCK-ENTRIES (2)             27430000
274400                                ASC-VOID-ERROR-SW                 27440000
274500                                ASC-VOID-MSG-NBR                  27450000
274600                                ASC-COMMENT-LINE (1)              27460000
274700                                ASC-COMMENT-LINE (2)              27470000
274800                                ASC-COMMENT-LINE (3)              27480000
274900                                ASC-COMMENT-LINE (4).             27490000
275000     MOVE +1                 TO ASC-BLK-SUB.                      27500000
275100     SET ASC-ITEMS-LEFT-ON-DB                                     27510000
275200                             TO TRUE.                             27520000
275300                                                                  27530000
275400     MOVE +0                 TO ASC-ITEM-SUB                      27540000
275500                                ASC-NUMBER-OF-ITEMS-READ          27550000
275600                                ASC-NUMBER-OF-SELECTED-ITEMS      27560000
275700                                ASC-HIGHEST-BLOCK-WRITTEN         27570000
275800                                ASC-START-OF-SELECTED-RANGE       27580000
275900                                ASC-END-OF-SELECTED-RANGE         27590000
276000                                ASC-ITEM-AT-TOP-OF-PANEL.         27600000
276100                                                                  27610000
276200     MOVE ZERO               TO ASC-ORIGINAL-BALANCE.             27620000
276300                                                                  27630000
276400     IF (ASC-FORMAT-IND = PC-REFERRAL-FORMAT OR                   27640000
276500         ASC-FORMAT-IND = PC-AUDIT-FORMAT) AND                    27650000
276600         ASC-TRANS-NOT-COMPLETE                                   27660000
276700         PERFORM 4200-BUILD-TRANS-LINE                            27670000
276800     ELSE                                                         27680000
276900         IF ASC-FORMAT-IND = PC-AUDIT-VOID-FORMAT OR              27690000
277000            ASC-FORMAT-IND = PC-REFER-VOID-FORMAT                 27700000
277100             MOVE ASC-ORIGINAL-BALANCE TO ASC-REMAINING-BALANCE   27710000
277200     END-IF.                                                      27720000
277300                                                                  27730000
277400     PERFORM 4100-PREPARE-CURSOR.                                 27740000
277500                                                                  27750000
277600     PERFORM 4010-OPEN-CURSOR.                                    27760000
277700                                                                  27770000
277800     PERFORM 4300-READ-ITEMS-FROM-DB.                             27780000
277900                                                                  27790000
278000     PERFORM 4020-CLOSE-CURSOR.                                   27800000
278100                                                                  27810000
278200     PERFORM 4320-OPEN-COMMENT-CSR.                               27820000
278300                                                                  27830000
278400     MOVE 1 TO PV-COMMENT-SUB.                                    27840000
278500     PERFORM 4322-FETCH-COMMENT-CSR.                              27850000
278600                                                                  27860000
278700     PERFORM 4322-FETCH-COMMENT-CSR                               27870000
278800         VARYING PV-COMMENT-SUB                                   27880000
278900         FROM 2 BY 1                                              27890000
279000         UNTIL PV-COMMENT-SUB > 4                                 27900000
279100            OR PS-COMMENT-ROW-NOT-FOUND                           27910000
279200            OR SVT00003-CRE-TMST NOT = PV-HOLD-COMMENT-TMST.      27920018
279300                                                                  27930000
279400     PERFORM 4324-CLOSE-COMMENT-CSR.                              27940000
279500                                                                  27950000
279600     IF (ASC-FORMAT-IND = PC-AUDIT-FORMAT AND                     27960000
279700         ASC-TRANS-NOT-COMPLETE)                                  27970000
279800         IF ASC-AUDIT-UPDATE                                      27980000
279900             MOVE ASC-ORIGINAL-BALANCE                            27990000
280000                           TO ASC-REMAINING-BALANCE               28000000
280100         ELSE                                                     28010000
280200             IF ASC-KEY-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP      28020018
280300                 COMPUTE ASC-REMAINING-BALANCE                    28030000
280400                         = ASC-ORIGINAL-BALANCE                   28040000
280500                           - ASC-APPROVED-TENDER-AMT              28050000
280600             ELSE                                                 28060000
280700                 COMPUTE ASC-REMAINING-BALANCE                    28070000
280800                         = ASC-ORIGINAL-BALANCE                   28080000
280900                           + ASC-APPROVED-TENDER-AMT              28090000
281000             END-IF                                               28100000
281100         END-IF                                                   28110000
281200     END-IF.                                                      28120000
281300                                                                  28130000
281400     IF ASC-VOID-REQUEST-OK OR ASC-REVERSE-VOID-REQUEST-OK        28140018
281500         IF ASC-TRANS-COMPLETE                                    28150000
281600             MOVE ASC-ORIGINAL-BALANCE                            28160000
281700                               TO ASC-REMAINING-BALANCE           28170000
281800         ELSE                                                     28180000
281900             IF ASC-KEY-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP      28190018
282000                 COMPUTE ASC-REMAINING-BALANCE                    28200000
282100                         = ASC-ORIGINAL-BALANCE                   28210000
282200                           - ASC-APPROVED-TENDER-AMT              28220000
282300             ELSE                                                 28230000
282400                 COMPUTE ASC-REMAINING-BALANCE                    28240000
282500                         = ASC-ORIGINAL-BALANCE                   28250000
282600                           + ASC-APPROVED-TENDER-AMT              28260000
282700             END-IF                                               28270000
282800         END-IF                                                   28280000
282900         SET ASC-NO-VOID-REQUEST                                  28290000
283000             ASC-NO-REVERSE-VOID-REQUEST                          28300018
283100                               TO TRUE                            28310000
283200     END-IF.                                                      28320000
283300                                                                  28330000
283400     IF ASC-OVERRIDE-COMPLETE                                     28340000
283500         MOVE ASC-ORIGINAL-BALANCE                                28350000
283600                               TO ASC-REMAINING-BALANCE           28360000
283700         MOVE ASC-SAVE-ORIGINAL-BALANCE                           28370000
283800                               TO ASC-ORIGINAL-BALANCE            28380000
283900     END-IF.                                                      28390000
284000                                                                  28400000
284100     MOVE +1                   TO  PV-TOP-ITEM.                   28410000
284200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          28420000
284300         SET DP020-NEXT-ACT-APPL-ERROR                            28430000
284400                               TO TRUE                            28440000
284500         SET DP020-MSG-FATAL   TO  TRUE                           28450000
284600*        --- NO LIST ITEMS FOUND FOR THE CRITERIA SPECIFIED ---   28460000
284700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               28470000
284800     ELSE                                                         28480000
284900         MOVE -1               TO MR-SELECTL (1)                  28490000
285000         SET DP030-SET-CURSOR-APPL-1                              28500000
285100                               TO TRUE                            28510000
285200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     28520000
285300     END-IF.                                                      28530000
285400*----------------------------------------------------------------*28540000
285500* OPEN THE CARD CURSOR.                                          *28550000
285600*----------------------------------------------------------------*28560000
285700                                                                  28570000
285800 4010-OPEN-CURSOR.                                                28580000
285900     EXEC SQL                                                     28590000
286000         OPEN CARD-CSR                                            28600000
286100     END-EXEC.                                                    28610000
286200     EVALUATE TRUE                                                28620000
286300         WHEN SQLCODE = ZERO                                      28630000
286400             CONTINUE                                             28640000
286500         WHEN OTHER                                               28650000
286600             MOVE '4010-OPEN-CURSOR'                              28660000
286700                               TO DP013-PARAGRAPH                 28670000
286800             MOVE 'OPEN CARD CURSOR - '                           28680000
286900                               TO DP013-MESSAGE-TEXT (1)          28690000
287000             MOVE SQLCA        TO DP013-SQLCA                     28700000
287100             MOVE 'SVT_KOHLS_CRD_TXN ' TO DP013-DB2-TABLE-NAME (1)28710018
287200             SET DP013-DB2-ABEND                                  28720000
287300                 DP013-XCTL-DISPLAY-RESTART                       28730000
287400                               TO TRUE                            28740000
287500             PERFORM DP013-0000-PROCESS-ABEND                     28750000
287600     END-EVALUATE.                                                28760000
287700                                                                  28770000
287800*----------------------------------------------------------------*28780000
287900* CLOSE THE TMESSAGE CURSOR.                                     *28790000
288000*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *28800000
288100*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *28810000
288200*   USER.                                                        *28820000
288300*----------------------------------------------------------------*28830000
288400                                                                  28840000
288500 4020-CLOSE-CURSOR.                                               28850000
288600     EXEC SQL                                                     28860000
288700         CLOSE CARD-CSR                                           28870000
288800     END-EXEC.                                                    28880000
288900                                                                  28890000
289000     EVALUATE TRUE                                                28900000
289100         WHEN SQLCODE = ZERO                                      28910000
289200             CONTINUE                                             28920000
289300         WHEN OTHER                                               28930000
289400             MOVE '4020-CLOSE-CURSOR'                             28940000
289500                               TO DP013-PARAGRAPH                 28950000
289600             MOVE 'CLOSE CARD CURSOR '                            28960000
289700                               TO DP013-MESSAGE-TEXT (1)          28970000
289800             MOVE SQLCA        TO DP013-SQLCA                     28980000
289900             MOVE 'SVT_KOHLS_CRD_TXN ' TO DP013-DB2-TABLE-NAME (1)28990018
290000             SET DP013-DB2-ABEND                                  29000000
290100                 DP013-XCTL-DISPLAY-RESTART                       29010000
290200                               TO TRUE                            29020000
290300             PERFORM DP013-0000-PROCESS-ABEND                     29030000
290400     END-EVALUATE.                                                29040000
290500                                                                  29050000
290600*----------------------------------------------------------------*29060000
290700*    SET UP THE HOST VARIABLES.                                  *29070000
290800*----------------------------------------------------------------*29080000
290900                                                                  29090000
291000 4100-PREPARE-CURSOR.                                             29100000
291100                                                                  29110000
291200     MOVE ASC-KEY-CARD-ID          TO DK-CARD-ID.                 29120018
291300                                                                  29130000
291400*----------------------------------------------------------------*29140000
291500* BUILD TO FIRST LINE OF THE SCROLLABLE AREA, WHICH WILL BE      *29150000
291600* THE CURRENT TRANSACTION PASSED FROM THE CRITERIA SPEC SCREEN.  *29160000
291700* (IF A VOID IS REQUESTED, THIS WILL NOT BE PERFORMED.)          *29170000
291800* THE FIRST STEP IS TO PERFORM THE AUTHORIZATION MODULE.  THEN   *29180000
291900* THE TRANSACTION LINE IS BUILT AND EDITED.                      *29190000
292000*----------------------------------------------------------------*29200000
292100                                                                  29210000
292200 4200-BUILD-TRANS-LINE.                                           29220000
292300                                                                  29230000
292400     PERFORM 4205-CARD-AUTH-PROCEDURE.                            29240000
292500                                                                  29250000
292600     ADD +1                    TO ASC-ITEM-SUB.                   29260000
292700     ADD +1                    TO ASC-NUMBER-OF-ITEMS-READ.       29270000
292800     MOVE ASC-NUMBER-OF-ITEMS-READ                                29280000
292900                               TO ASC-LIST-ITEM-NUMBER            29290000
293000                                      (ASC-BLK-SUB ASC-ITEM-SUB). 29300000
293100     MOVE SPACES               TO ASC-HILITE-SW                   29310000
293200                                       (ASC-BLK-SUB ASC-ITEM-SUB).29320000
293300                                                                  29330018
293400     IF ASC-FORMAT-IND = PC-REFERRAL-FORMAT                       29340000
293500         MOVE ASC-KEY-POS-DATE-ISO                                29350000
293600                               TO ASC-CURR-POS-DATE-ISO           29360000
293700         MOVE SV004-STAT-AUTH-RECEIVED-CD                         29370018
293800                               TO ASC-CURR-ACTVY-STAT-CDE         29380000
293900     ELSE                                                         29390000
294000         MOVE ASC-KEY-POS-DATE-ISO                                29400000
294100                               TO ASC-CURR-POS-DATE-ISO           29410000
294200         PERFORM 4210-FIND-AUDIT-ROW                              29420000
294300     END-IF.                                                      29430000
294400                                                                  29440018
294500     MOVE ASC-CURR-POS-DATE-ISO                                   29450000
294600                               TO ASC-POS-DATE-ISO                29460000
294700                                       (ASC-BLK-SUB ASC-ITEM-SUB).29470000
294800     MOVE ASC-KEY-STORE-NBR    TO ASC-STORE-NBR                   29480000
294900                                       (ASC-BLK-SUB ASC-ITEM-SUB).29490000
295000     MOVE ASC-KEY-TERMINAL     TO ASC-TERMINAL                    29500000
295100                                       (ASC-BLK-SUB ASC-ITEM-SUB).29510000
295200     MOVE ASC-KEY-TRANSACTION  TO ASC-TRANSACTION                 29520000
295300                                       (ASC-BLK-SUB ASC-ITEM-SUB).29530000
295400     MOVE SV004-REV-CDE-NORMAL TO ASC-REVERSAL-IND                29540018
295500                                       (ASC-BLK-SUB ASC-ITEM-SUB).29550000
295600                                                                  29560018
295700     SET SV004-ACT-TYP-IDX     TO 1.                              29570018
295800     SEARCH SV004-ACT-TYP-OCC                                     29580018
295900         AT END                                                   29590000
296000             MOVE SPACES       TO ASC-ACTIVITY-TYPE-DESC          29600000
296100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29610000
296200             MOVE ASC-KEY-ACTIVITY-TYPE                           29620000
296300                               TO ASC-ACTIVITY-TYPE               29630000
296400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29640000
296500         WHEN SV004-ACT-TYP-CD (SV004-ACT-TYP-IDX)                29650018
296600                               = ASC-KEY-ACTIVITY-TYPE            29660000
296700             MOVE SV004-ACT-TYP-SDESC (SV004-ACT-TYP-IDX)         29670018
296800                               TO ASC-ACTIVITY-TYPE-DESC          29680000
296900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29690000
297000             MOVE ASC-KEY-ACTIVITY-TYPE                           29700000
297100                               TO ASC-ACTIVITY-TYPE               29710000
297200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29720000
297300     END-SEARCH.                                                  29730000
297400                                                                  29740018
297500     IF ASC-FORMAT-IND = PC-REFERRAL-FORMAT                       29750000
297600         IF ASC-AUTH-CODE = SV004-AUTH-APPROVE-CD                 29760018
297700             MOVE ASC-APPROVED-TENDER-AMT                         29770000
297800                               TO ASC-AMOUNT                      29780000
297900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29790000
298000         ELSE                                                     29800000
298100             MOVE ASC-KEY-AMOUNT-REQUESTED                        29810000
298200                               TO ASC-AMOUNT                      29820000
298300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29830000
298400         END-IF                                                   29840000
298500     ELSE                                                         29850000
298600         MOVE ASC-KEY-AMOUNT-REQUESTED                            29860000
298700                               TO ASC-AMOUNT                      29870000
298800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29880000
298900     END-IF.                                                      29890000
299000                                                                  29900018
299100     IF ASC-KEY-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP              29910018
299200         MULTIPLY -1 BY ASC-AMOUNT                                29920000
299300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29930000
299400     END-IF.                                                      29940000
299500                                                                  29950018
299600     MOVE SV004-MANUAL-IND     TO ASC-AUTO-MANUAL                 29960018
299700                                       (ASC-BLK-SUB ASC-ITEM-SUB).29970000
299800     MOVE DP020-USERID         TO ASC-USERID                      29980000
299900                                       (ASC-BLK-SUB ASC-ITEM-SUB).29990000
300000                                                                  30000018
300100     SET SV004-ACT-ST-IDX      TO 1.                              30010018
300200     SEARCH SV004-ACT-ST-OCC                                      30020018
300300         AT END                                                   30030000
300400             MOVE SPACES       TO ASC-ACTIVITY-STATUS             30040000
300500                               (ASC-BLK-SUB ASC-ITEM-SUB)         30050000
300600         WHEN SV004-ACT-ST-CD (SV004-ACT-ST-IDX)                  30060018
300700                       = ASC-CURR-ACTVY-STAT-CDE                  30070000
300800             MOVE SV004-ACT-ST-DESC (SV004-ACT-ST-IDX)            30080018
300900                               TO ASC-ACTIVITY-STATUS             30090000
301000                               (ASC-BLK-SUB ASC-ITEM-SUB)         30100000
301100     END-SEARCH.                                                  30110000
301200                                                                  30120018
301300     MOVE ASC-CURR-ACTVY-STAT-CDE                                 30130000
301400                               TO ASC-ACTIVITY-STAT-CDE           30140000
301500                               (ASC-BLK-SUB ASC-ITEM-SUB).        30150000
301600     MOVE SV004-NOT-VOID-TRANS TO ASC-VOID-IND                    30160018
301700                               (ASC-BLK-SUB ASC-ITEM-SUB).        30170000
301800                                                                  30180000
301900*----------------------------------------------------------------*30190000
302000* GET AUTHORIZATION DECISION.                                    *30200000
302100*----------------------------------------------------------------*30210000
302200 4205-CARD-AUTH-PROCEDURE.                                        30220000
302300                                                                  30230000
302400     MOVE ASC-KEY-CARD-ID          TO SV005-KMC-ID.               30240018
302500     MOVE ASC-CRD-TYP-CDE          TO SV005-CARD-TYPE.            30250018
302600     MOVE ASC-KEY-ACTIVITY-TYPE    TO SV005-ACTIVITY-TYPE.        30260018
302700     MOVE ZERO                     TO SV005-REVERSAL-CODE.        30270018
302800     MOVE ASC-KEY-POS-DATE-ISO     TO SV005-POS-DATE.             30280018
302900     MOVE ASC-KEY-STORE-NBR        TO SV005-STORE-NBR.            30290018
303000     MOVE ASC-KEY-TERMINAL         TO SV005-TERMINAL-NBR.         30300018
303100     MOVE ASC-KEY-TRANSACTION      TO SV005-TRANSACTION-NBR.      30310018
303200     MOVE ASC-KEY-AMOUNT-REQUESTED TO SV005-TRANS-AMT.            30320018
303300                                                                  30330000
303400     IF ASC-FORMAT-IND = PC-AUDIT-FORMAT                          30340000
303500         SET SV005-PV-FROM-RDKCS023-AUDIT     TO TRUE             30350018
303600     ELSE                                                         30360000
303700         SET SV005-PV-FROM-RDKCS023-AUTH      TO TRUE             30370018
303800     END-IF.                                                      30380000
303900                                                                  30390000
304000     SET SV005-NOT-VOID    TO TRUE.                               30400018
304100     PERFORM SV005-A100-MAINLINE.                                 30410018
304200                                                                  30420018
304300     MOVE SV005-RESPONSE-CODE      TO ASC-AUTH-CODE.              30430018
304400                                                                  30440018
304500     SET SV004-AUTH-CD-IDX         TO 1.                          30450018
304600     SEARCH SV004-AUTH-CD-OCC                                     30460018
304700         AT END                                                   30470000
304800             MOVE SPACES           TO ASC-AUTH-DECISION           30480000
304900         WHEN SV004-AUTH-CD (SV004-AUTH-CD-IDX)                   30490018
305000                       = SV005-RESPONSE-CODE                      30500018
305100             MOVE SV004-AUTH-CD-DESC (SV004-AUTH-CD-IDX)          30510018
305200                                   TO ASC-AUTH-DECISION           30520000
305300     END-SEARCH.                                                  30530000
305400                                                                  30540018
305500     MOVE SV005-APPROVED-TENDER-AMT                               30550018
305600                                   TO ASC-APPROVED-TENDER-AMT.    30560000
305700     MOVE SV005-KMC-APPROVAL-NBR   TO ASC-APPROVAL-NUMBER.        30570018
305800     MOVE SV005-KMC-REMAINING-BALANCE                             30580018
305900                                   TO ASC-REMAINING-BALANCE.      30590000
306000     MOVE SV005-DUPLICATE-FLAG     TO ASC-DUPLICATE-FLAG.         30600018
306100                                                                  30610018
306200     IF ASC-FORMAT-IND = PC-REFERRAL-FORMAT                       30620000
306300         IF ASC-AUTH-CODE = SV004-AUTH-APPROVE-CD                 30630018
306400             IF SV005-DUPLICATE                                   30640018
306500                 SET ASC-REFER-DUPLICATE-ERROR                    30650000
306600                     ASC-DISPLAY-APPROVAL                         30660000
306700                                   TO TRUE                        30670000
306800*                --- DUPLICATE TRANSACTION, CANNOT INSERT --      30680000
306900                 MOVE PC-TSYMSG-01266                             30690000
307000                                   TO DP020-MSG-NUMBER            30700000
307100                 SET DP020-MSG-FATAL                              30710000
307200                                   TO TRUE                        30720000
307300             ELSE                                                 30730000
307400                 SET ASC-REFER-INSERT-OK                          30740000
307500                                   TO TRUE                        30750000
307600             END-IF                                               30760000
307700         ELSE                                                     30770000
307800             SET ASC-REFER-INSERT-ERROR                           30780000
307900                                   TO TRUE                        30790000
308000             IF SV006-PS-LCK-ERROR                                30800018
308100*                --- CARD NUMBER IN LOCK TABLE ---                30810018
308200                MOVE PC-TSYMSG-02530                              30820018
308300                               TO DP020-MSG-NUMBER                30830018
308400             ELSE                                                 30840018
308500                IF SV005-PGM-ABEND                                30850018
308600*                --- TRANSACTION IS CURRENTLY UNAVAILABLE ---     30860000
308700                    MOVE PC-TSYMSG-99904                          30870018
308800                               TO DP020-MSG-NUMBER                30880000
308900                    SET DP020-MSG-FATAL                           30890018
309000                               TO TRUE                            30900000
309100                END-IF                                            30910018
309200             END-IF                                               30920018
309300         END-IF                                                   30930018
309400     END-IF.                                                      30940000
309500                                                                  30950000
309600*----------------------------------------------------------------*30960000
309700* FIND THE ROW THAT THE AUDIT USER HAS REQUESTED FROM THE        *30970000
309800* CRITERIA SPEC SCREEN.  IF NOT FOUND, CHECK IF THE USER HAS THE *30980000
309900* AUTHORITY TO ADD IT.                                           *30990000
310000*----------------------------------------------------------------*31000000
310100                                                                  31010000
310200 4210-FIND-AUDIT-ROW.                                             31020000
310300                                                                  31030000
310400     SET PS-AUDIT-ROW-NOT-FOUND TO TRUE.                          31040000
310500     MOVE ASC-KEY-ACTIVITY-TYPE    TO DK-ACTIVITY-TYPE.           31050000
310600     MOVE ASC-CURR-POS-DATE-ISO    TO DK-POS-DATE-ISO.            31060000
310700     MOVE ASC-KEY-STORE-NBR        TO DK-STORE-NBR.               31070000
310800     MOVE ASC-KEY-TERMINAL         TO DK-TERMINAL.                31080018
310900     MOVE ASC-KEY-TRANSACTION      TO DK-TRANSACTION.             31090000
311000                                                                  31100018
311100     IF ASC-KEY-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP              31110018
311200         MULTIPLY -1 BY ASC-KEY-AMOUNT-REQUESTED                  31120000
311300                                   GIVING DK-AMOUNT-REQUESTED     31130000
311400     ELSE                                                         31140000
311500         MOVE ASC-KEY-AMOUNT-REQUESTED                            31150000
311600                                   TO DK-AMOUNT-REQUESTED         31160000
311700     END-IF.                                                      31170000
311800                                                                  31180018
311900     PERFORM 4211-SELECT-AUDIT-ROW                                31190000
312000         VARYING PV-NUMBER-OF-TRIES FROM 1 BY 1                   31200000
312100         UNTIL PS-AUDIT-ROW-FOUND                                 31210000
312200         OR PV-NUMBER-OF-TRIES > PC-MAX-TRIES.                    31220000
312300                                                                  31230000
312400     IF PS-AUDIT-ROW-FOUND                                        31240000
312500         ADD DK-AMOUNT-REQUESTED                                  31250000
312600                               TO ASC-ORIGINAL-BALANCE            31260000
312700         IF SVT00002-ACTVY-STAT-CDE = SV004-STAT-AUTH-RECEIVED-CD 31270018
312800             MOVE SV004-STAT-VERIFIED-CD                          31280018
312900                               TO ASC-CURR-ACTVY-STAT-CDE         31290000
313000             SET ASC-AUDIT-UPDATE-OK                              31300000
313100                               TO TRUE                            31310000
313200         ELSE                                                     31320000
313300             MOVE SV004-STAT-VERIFIED-CD                          31330018
313400                               TO ASC-CURR-ACTVY-STAT-CDE         31340000
313500             SET ASC-HILITE-LINE-RD (ASC-BLK-SUB ASC-ITEM-SUB)    31350018
313600                               TO TRUE                            31360000
313700             SET ASC-AUDIT-UPDATE-ERROR                           31370000
313800                               TO TRUE                            31380000
313900*            --- TRANSACTION WAS ALREADY VERIFIED,                31390000
314000*                UPDATE NOT ALLOWED ---                           31400000
314100             MOVE PC-TSYMSG-01230                                 31410000
314200                               TO DP020-MSG-NUMBER                31420000
314300             SET DP020-MSG-FATAL                                  31430000
314400                               TO TRUE                            31440000
314500         END-IF                                                   31450000
314600     ELSE                                                         31460000
314700         IF ASC-AUTH-CODE = SV004-AUTH-HARD-DEC-CD                31470018
314800             SET ASC-AUDIT-UPDATE-ERROR                           31480000
314900                               TO TRUE                            31490000
315000*            --- AUDIT CANNOT INSERT ACTIVITY ON A                31500000
315100*                HARD DECLINE ---                                 31510000
315200             MOVE PC-TSYMSG-01257                                 31520000
315300                               TO DP020-MSG-NUMBER                31530000
315400             SET DP020-MSG-FATAL                                  31540000
315500                               TO TRUE                            31550000
315600         ELSE                                                     31560000
315700           MOVE SV004-STAT-NO-AUTH-CD                             31570018
315800                                 TO ASC-CURR-ACTVY-STAT-CDE       31580000
315900           MOVE SPACES           TO ASC-TRN-AUTH-TMST             31590000
316000                                    (ASC-BLK-SUB ASC-ITEM-SUB)    31600000
316100           PERFORM 4213-CHECK-INSERT-AUTH                         31610000
316200        END-IF                                                    31620000
316300     END-IF.                                                      31630000
316400                                                                  31640000
316500*----------------------------------------------------------------*31650000
316600* SELECT A ROW FROM THE SVT_KOHLS_CRD_TXN TABLE.                 *31660018
316700*----------------------------------------------------------------*31670000
316800                                                                  31680000
316900 4211-SELECT-AUDIT-ROW.                                           31690000
317000                                                                  31700018
317100     EXEC SQL                                                     31710000
317200         SELECT ACTVY_STAT_CDE,                                   31720000
317300                TRN_AUTH_TMST                                     31730000
317400           INTO :SVT00002-ACTVY-STAT-CDE,                         31740018
317500                :SVT00002-TRN-AUTH-TMST                           31750018
317600           FROM SVT_KOHLS_CRD_TXN                                 31760018
317700          WHERE CRD_NBR       = :DK-CARD-ID                       31770000
317800            AND TRN_RVRSL_CDE = :SV004-REV-CDE-NORMAL             31780018
317900            AND TRN_VOID_IND  = :SV004-NOT-VOID-TRANS             31790018
318000            AND ACTVY_TYP_CDE = :DK-ACTIVITY-TYPE                 31800000
318100            AND POS_DTE       = :DK-POS-DATE-ISO                  31810000
318200            AND STR_NBR       = :DK-STORE-NBR                     31820000
318300            AND POS_TRMNL_NBR = :DK-TERMINAL                      31830018
318400            AND POS_TRN_NBR   = :DK-TRANSACTION                   31840018
318500            AND APP_AUTH_AMT  = :DK-AMOUNT-REQUESTED              31850000
318600          WITH UR                                                 31860018
318700     END-EXEC.                                                    31870000
318800                                                                  31880000
318900***  (NEED TO CHECK FOR -811 IN CASE THERE IS MORE THAN ONE ROW)  31890000
319000     EVALUATE TRUE                                                31900000
319100       WHEN SQLCODE = ZERO                                        31910000
319200       WHEN SQLCODE = -811                                        31920000
319300           SET PS-AUDIT-ROW-FOUND                                 31930000
319400                               TO TRUE                            31940000
319500           MOVE SVT00002-TRN-AUTH-TMST                            31950018
319600                               TO ASC-SAVE-TIMESTAMP              31960000
319700                                  ASC-TRN-AUTH-TMST               31970000
319800                                  (ASC-BLK-SUB ASC-ITEM-SUB)      31980000
319900       WHEN SQLCODE = +100                                        31990000
320000          PERFORM 4212-ADD-1-TO-POS-DATE                          32000000
320100       WHEN OTHER                                                 32010000
320200          MOVE '4211-SELECT-AUDIT-ROW'                            32020000
320300                               TO DP013-PARAGRAPH                 32030000
320400          MOVE 'UNABLE TO SELECT CARD ACTIVITY'                   32040000
320500                               TO DP013-MESSAGE-TEXT (1)          32050000
320600          MOVE SQLCA           TO DP013-SQLCA                     32060000
320700          MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1)    32070018
320800          SET DP013-DB2-ABEND  TO TRUE                            32080000
320900          PERFORM DP013-0000-PROCESS-ABEND                        32090000
321000     END-EVALUATE.                                                32100000
321100                                                                  32110000
321200*----------------------------------------------------------------*32120000
321300*    ADD 1 TO THE POS DATE TO TRY AND FIND THE REQUESTED ROW.    *32130000
321400*----------------------------------------------------------------*32140000
321500                                                                  32150000
321600 4212-ADD-1-TO-POS-DATE.                                          32160000
321700                                                                  32170000
321800     INITIALIZE DPG51                                             32180018
321900                DPG52                                             32190018
322000                DPG53                                             32200018
322100                DPG54                                             32210018
322200                DPG55                                             32220018
322300                DPG56.                                            32230018
322400     MOVE DK-POS-DATE-ISO          TO DPG52-LK-DATE-INPUT.        32240000
322500     SET DPG52-LK-DTE-ISO-FMT                                     32250000
322600         DPG51-ACTUAL-CALENDAR-ONLY                               32260000
322700         DPG51-INCREMENT-DATE      TO TRUE.                       32270000
322800     MOVE PC-1                     TO DPG51-INCR-DECR-DAYS-9.     32280000
322900     MOVE ZEROES                   TO DPG51-INCR-DECR-BUS-DAYS-9. 32290018
323000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                32300018
323100                                             DPG52                32310018
323200                                             DPG53                32320018
323300                                             DPG54                32330018
323400                                             DPG55                32340018
323500                                             DPG56.               32350018
323600     EVALUATE TRUE                                                32360000
323700       WHEN DPG54-SEVERE-ERROR                                    32370000
323800       WHEN DPG54-DATE-INVALID                                    32380000
323900         SET DP013-NO-ROLLBACK                                    32390000
324000             DP013-XCTL-DISPLAY-RESTART                           32400000
324100             DP013-CICS-ABEND      TO TRUE                        32410000
324200         MOVE '4212-ADD-1-TO-POS-DATE'                            32420000
324300                                   TO DP013-PARAGRAPH             32430000
324400         MOVE 'BAD RETURN FROM DATE MODULE'                       32440000
324500                                   TO DP013-MESSAGE-TEXT (2)      32450000
324600         PERFORM DP013-0000-PROCESS-ABEND                         32460000
324700       WHEN OTHER                                                 32470000
324800           MOVE DPG55-DB2-ISO-DATE-FMT                            32480000
324900                                   TO DK-POS-DATE-ISO             32490000
325000     END-EVALUATE.                                                32500000
325100                                                                  32510000
325200*----------------------------------------------------------------*32520000
325300* THE ROW THAT THE AUDIT USER HAS REQUESTED WAS NOT FOUND, SO    *32530000
325400* CHECK IF THE USER HAS THE AUTHORITY TO ADD IT.                 *32540000
325500*----------------------------------------------------------------*32550000
325600                                                                  32560000
325700 4213-CHECK-INSERT-AUTH.                                          32570000
325800                                                                  32580000
325900     SET DP008-RSRC-TYPE-FUNC      TO  TRUE.                      32590000
326000     MOVE PC-INSERT-AUTH           TO  DP008-RESOURCE-NAME.       32600000
326100     SET DP008-ACCESS-TYPE-USE     TO  TRUE.                      32610000
326200                                                                  32620000
326300     EXEC CICS                                                    32630000
326400          LINK                                                    32640000
326500             PROGRAM  (DP008-SECURITY-SUBROUTINE)                 32650000
326600             COMMAREA (DP008-SECURITY-COMMAREA)                   32660000
326700             LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)            32670000
326800             RESP     (PV-RESP)                                   32680000
326900     END-EXEC.                                                    32690000
327000                                                                  32700000
327100     IF  PV-RESP NOT = DFHRESP(NORMAL)                            32710000
327200         SET ASC-AUDIT-INSERT-ERROR                               32720000
327300                                   TO TRUE                        32730000
327400*        --- BAD LINK TO SECURITY MODULE ---                      32740000
327500         MOVE PC-TSYMSG-00233      TO DP020-MSG-NUMBER            32750000
327600         SET DP020-MSG-FATAL       TO TRUE                        32760000
327700     ELSE                                                         32770000
327800         IF  DP008-ACCESS-ALLOWED                                 32780000
327900             SET ASC-AUDIT-INSERT-OK                              32790000
328000                                   TO TRUE                        32800000
328100         ELSE                                                     32810000
328200             SET ASC-AUDIT-INSERT-ERROR                           32820000
328300                                   TO TRUE                        32830000
328400*            --- USERID DOES NOT HAVE AUTHORITY TO ADD ACTIVITY   32840000
328500*                WHICH DOES NOT EXIST ---                         32850000
328600             MOVE PC-TSYMSG-01231  TO DP020-MSG-NUMBER            32860000
328700             SET DP020-MSG-FATAL   TO TRUE                        32870000
328800         END-IF                                                   32880000
328900     END-IF.                                                      32890000
329000                                                                  32900000
329100*----------------------------------------------------------------*32910000
329200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *32920000
329300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *32930000
329400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *32940000
329500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *32950000
329600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *32960000
329700*                                                                *32970000
329800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *32980000
329900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *32990000
330000*    UPON INITIALIZATION.                                        *33000000
330100*----------------------------------------------------------------*33010000
330200                                                                  33020000
330300 4300-READ-ITEMS-FROM-DB.                                         33030000
330400                                                                  33040000
330500     PERFORM                                                      33050000
330600         VARYING PV-READ-COUNT                                    33060000
330700         FROM 1 BY 1                                              33070000
330800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    33080000
330900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         33090000
331000                                                                  33100000
331100         PERFORM 4310-FETCH                                       33110000
331200*        FOR AUDIT SCREEN, MAKE SURE THE ROW AT THE TOP OF THE    33120000
331300*        SCREEN IS NOT REPEATED FURTHER DOWN IN THE LIST.         33130000
331400         IF DP020-INT-APPL-FORMAT-IND = PC-AUDIT-FORMAT AND       33140000
331500            PS-AUDIT-ROW-FOUND AND                                33150000
331600            ASC-ITEMS-LEFT-ON-DB                                  33160000
331700            IF SVT00002-TRN-AUTH-TMST = ASC-SAVE-TIMESTAMP        33170018
331800                PERFORM 4310-FETCH                                33180000
331900            END-IF                                                33190000
332000         END-IF                                                   33200000
332100                                                                  33210000
332200         IF  ASC-ITEMS-LEFT-ON-DB                                 33220000
332300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                33230000
332400                 ADD +1        TO ASC-ITEM-SUB                    33240000
332500             ELSE                                                 33250000
332600                 ADD +1        TO ASC-BLK-SUB                     33260000
332700                 MOVE +1       TO ASC-ITEM-SUB                    33270000
332800                                                                  33280000
332900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         33290000
333000                     MOVE +1   TO ASC-BLK-SUB                     33300000
333100                     SET ASC-BLOCK-MODIFIED (1)                   33310000
333200                               TO TRUE                            33320000
333300                     PERFORM 5100-WRITE-TEMP-STORAGE              33330000
333400                     MOVE ASC-BLOCK-ENTRIES                       33340000
333500                               (PC-MAX-BLOCKS-IN-ARRAY)           33350000
333600                               TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)  33360000
333700                     ADD +1    TO ASC-BLK-SUB                     33370000
333800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   33380000
333900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      33390000
334000                               TO TRUE                            33400000
334100                 END-IF                                           33410000
334200             END-IF                                               33420000
334300             ADD +1            TO ASC-NUMBER-OF-ITEMS-READ        33430000
334400             MOVE ASC-NUMBER-OF-ITEMS-READ                        33440000
334500                               TO ASC-LIST-ITEM-NUMBER            33450000
334600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  33460000
334700             MOVE SPACES       TO ASC-HILITE-SW                   33470000
334800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33480000
334900             MOVE SVT00002-POS-DTE                                33490018
335000                               TO ASC-POS-DATE-ISO                33500000
335100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33510000
335200             MOVE SVT00002-STR-NBR                                33520018
335300                               TO ASC-STORE-NBR                   33530000
335400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33540000
335500             MOVE SVT00002-POS-TRMNL-NBR                          33550018
335600                               TO ASC-TERMINAL                    33560000
335700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33570000
335800             MOVE SVT00002-POS-TRN-NBR                            33580018
335900                               TO ASC-TRANSACTION                 33590000
336000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33600000
336100             IF SVT00002-TRN-RVRSL-CDE = SV004-REV-CDE-NORMAL     33610018
336200                 MOVE SV004-REV-CDE-NORMAL                        33620018
336300                               TO ASC-REVERSAL-IND                33630000
336400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33640000
336500             ELSE                                                 33650000
336600                 MOVE SVT00002-TRN-RVRSL-CDE                      33660018
336700                               TO ASC-REVERSAL-IND                33670000
336800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33680000
336900             END-IF                                               33690000
337000             SET SV004-ACT-TYP-IDX TO 1                           33700018
337100             SEARCH SV004-ACT-TYP-OCC                             33710018
337200                 AT END                                           33720000
337300                     MOVE SPACES                                  33730000
337400                               TO ASC-ACTIVITY-TYPE-DESC          33740000
337500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33750000
337600                     MOVE SVT00002-ACTVY-TYP-CDE                  33760018
337700                               TO ASC-ACTIVITY-TYPE               33770000
337800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33780000
337900                 WHEN SV004-ACT-TYP-CD (SV004-ACT-TYP-IDX)        33790018
338000                               = SVT00002-ACTVY-TYP-CDE           33800018
338100                     MOVE SV004-ACT-TYP-SDESC (SV004-ACT-TYP-IDX) 33810018
338200                               TO ASC-ACTIVITY-TYPE-DESC          33820000
338300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33830000
338400                     MOVE SVT00002-ACTVY-TYP-CDE                  33840018
338500                               TO ASC-ACTIVITY-TYPE               33850000
338600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33860000
338700             END-SEARCH                                           33870000
338800             MOVE SVT00002-APP-AUTH-AMT                           33880018
338900                               TO ASC-AMOUNT                      33890000
339000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33900000
339100             IF SVT00002-APVL-USR-ID = SPACES                     33910018
339200                 MOVE SV004-AUTO-IND                              33920018
339300                               TO ASC-AUTO-MANUAL                 33930000
339400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33940000
339500                 MOVE SVT00002-POS-OPRT-ID                        33950018
339600                               TO PV-USERID                       33960000
339700                 MOVE PV-USERID                                   33970000
339800                               TO ASC-USERID                      33980000
339900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 33990000
340000             ELSE                                                 34000000
340100                 MOVE SV004-MANUAL-IND                            34010018
340200                               TO ASC-AUTO-MANUAL                 34020000
340300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34030000
340400                 MOVE SVT00002-APVL-USR-ID                        34040018
340500                               TO ASC-USERID                      34050000
340600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34060000
340700             END-IF                                               34070000
340800             SET SV004-ACT-ST-IDX TO 1                            34080018
340900             SEARCH SV004-ACT-ST-OCC                              34090018
341000                 AT END                                           34100000
341100                     MOVE SPACES                                  34110000
341200                               TO ASC-ACTIVITY-STATUS             34120000
341300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34130000
341400                 WHEN SV004-ACT-ST-CD (SV004-ACT-ST-IDX)          34140018
341500                               = SVT00002-ACTVY-STAT-CDE          34150018
341600                     MOVE SV004-ACT-ST-DESC (SV004-ACT-ST-IDX)    34160018
341700                               TO ASC-ACTIVITY-STATUS             34170000
341800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34180000
341900             END-SEARCH                                           34190000
342000             MOVE SV004-STAT-VERIFIED-CD                          34200018
342100                               TO ASC-ACTIVITY-STAT-CDE           34210000
342200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34220000
342300             MOVE SVT00002-ORIG-AUTH-AMT                          34230018
342400                               TO ASC-ORIG-AUTH-AMT               34240018
342500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34250018
342600             MOVE SVT00002-TRN-VOID-IND                           34260018
342700                               TO ASC-VOID-IND                    34270000
342800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34280000
342900             MOVE SVT00002-TRN-AUTH-TMST                          34290018
343000                               TO ASC-TRN-AUTH-TMST               34300000
343100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34310000
343200             MOVE SVT00002-ST-CDE                                 34320018
343300                               TO ASC-ST-CDE                      34330018
343400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34340018
343500             IF SVT00002-TRN-VOID-IND = SV004-NOT-VOID-TRANS      34350018
343600                 ADD SVT00002-APP-AUTH-AMT                        34360018
343700                               TO ASC-ORIGINAL-BALANCE            34370000
343800             END-IF                                               34380000
343900             MOVE ASC-KEY-CARD-ID                                 34390018
344000                               TO SV006-KMC-ID                    34400018
344100             MOVE SVT00002-APP-AUTH-AMT                           34410018
344200                               TO SV006-TENDER-AMT                34420018
344300             MOVE ASC-TERMINAL (ASC-BLK-SUB ASC-ITEM-SUB)         34430018
344400                               TO SV006-TERMINAL-NBR              34440018
344500             MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)      34450018
344600                               TO SV006-TRANSACTION-NBR           34460018
344700             PERFORM SV006-A100-MAINLINE                          34470018
344800             MOVE SV006-KMC-APPROVAL-NBR                          34480018
344900                               TO ASC-APPROVAL-NUMBER-LST         34490000
345000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 34500000
345100         END-IF                                                   34510000
345200     END-PERFORM.                                                 34520000
345300                                                                  34530000
345400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          34540000
345500         MOVE +1               TO ASC-BLK-SUB                     34550000
345600         PERFORM 5100-WRITE-TEMP-STORAGE                          34560000
345700         ADD +1                TO ASC-BLK-SUB                     34570000
345800         PERFORM 5100-WRITE-TEMP-STORAGE                          34580000
345900                                                                  34590000
346000         MOVE 1                TO ASC-BLK-SUB                     34600000
346100                                  PV-BLOCK-NUMBER                 34610000
346200         PERFORM 4410-READ-TEMP-STORAGE                           34620000
346300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             34630000
346400             MOVE 2            TO ASC-BLK-SUB                     34640000
346500                                  PV-BLOCK-NUMBER                 34650000
346600             PERFORM 4410-READ-TEMP-STORAGE                       34660000
346700         END-IF                                                   34670000
346800     END-IF.                                                      34680000
346900*----------------------------------------------------------------*34690000
347000*    FETCH THE CARD CURSOR.                                      *34700000
347100*----------------------------------------------------------------*34710000
347200                                                                  34720000
347300 4310-FETCH.                                                      34730000
347400                                                                  34740000
347500     EXEC SQL                                                     34750000
347600          FETCH CARD-CSR                                          34760000
347700          INTO  :SVT00002-TRN-AUTH-TMST                           34770018
347800              , :SVT00002-TRN-RVRSL-CDE                           34780018
347900              , :SVT00002-TRN-VOID-IND                            34790018
348000              , :SVT00002-ACTVY-TYP-CDE                           34800018
348100              , :SVT00002-POS-DTE                                 34810018
348200              , :SVT00002-STR-NBR                                 34820018
348300              , :SVT00002-POS-TRMNL-NBR                           34830018
348400              , :SVT00002-POS-TRN-NBR                             34840018
348500              , :SVT00002-APP-AUTH-AMT                            34850018
348600              , :SVT00002-POS-OPRT-ID                             34860018
348700              , :SVT00002-APVL-USR-ID                             34870018
348800              , :SVT00002-ACTVY-STAT-CDE                          34880018
348900              , :SVT00002-ORIG-AUTH-AMT                           34890018
349000              , :SVT00002-ST-CDE                                  34900018
349100     END-EXEC.                                                    34910000
349200                                                                  34920000
349300     EVALUATE TRUE                                                34930000
349400         WHEN SQLCODE = ZERO                                      34940000
349500         WHEN SQLCODE = +100                                      34950000
349600              CONTINUE                                            34960000
349700         WHEN OTHER                                               34970000
349800              MOVE '4310-FETCH-CURSOR'                            34980000
349900                               TO DP013-PARAGRAPH                 34990000
350000              MOVE 'FETCH CARD CURSOR'                            35000000
350100                               TO DP013-MESSAGE-TEXT (1)          35010000
350200              MOVE SQLCA       TO DP013-SQLCA                     35020000
350300              MOVE 'SVT_KOHLS_CRD_TXN '                           35030018
350400                               TO DP013-DB2-TABLE-NAME (1)        35040018
350500              SET DP013-DB2-ABEND                                 35050000
350600                               TO TRUE                            35060000
350700              PERFORM DP013-0000-PROCESS-ABEND                    35070000
350800     END-EVALUATE.                                                35080000
350900                                                                  35090000
351000     IF  SQLCODE EQUAL +100                                       35100000
351100         SET ASC-NO-ITEMS-LEFT-ON-DB                              35110000
351200                                   TO TRUE                        35120000
351300     END-IF.                                                      35130000
351400                                                                  35140000
351500*----------------------------------------------------------------*35150000
351600*    OPEN THE COMMENT CURSOR.                                    *35160000
351700*----------------------------------------------------------------*35170000
351800 4320-OPEN-COMMENT-CSR.                                           35180000
351900                                                                  35190000
352000     EXEC SQL                                                     35200000
352100         OPEN COMMENT-CSR                                         35210000
352200     END-EXEC.                                                    35220000
352300                                                                  35230000
352400     EVALUATE TRUE                                                35240000
352500         WHEN SQLCODE = ZERO                                      35250000
352600             CONTINUE                                             35260000
352700         WHEN OTHER                                               35270000
352800             MOVE '4320-OPEN-COMMENT-CSR'                         35280000
352900                               TO DP013-PARAGRAPH                 35290000
353000             MOVE 'OPEN COMMENT CURSOR'                           35300000
353100                               TO DP013-MESSAGE-TEXT (1)          35310000
353200             MOVE SQLCA        TO DP013-SQLCA                     35320000
353300             MOVE 'SVT_CRD_ACCT_CMMT ' TO DP013-DB2-TABLE-NAME (1)35330018
353400             SET DP013-DB2-ABEND                                  35340000
353500                 DP013-XCTL-DISPLAY-RESTART                       35350000
353600                               TO TRUE                            35360000
353700             PERFORM DP013-0000-PROCESS-ABEND                     35370000
353800     END-EVALUATE.                                                35380000
353900                                                                  35390000
354000*----------------------------------------------------------------*35400000
354100*    FETCH THE COMMENT CURSOR.                                   *35410000
354200*----------------------------------------------------------------*35420000
354300 4322-FETCH-COMMENT-CSR.                                          35430000
354400                                                                  35440000
354500     EXEC SQL                                                     35450000
354600          FETCH COMMENT-CSR                                       35460000
354700          INTO  :SVT00003-CRE-TMST                                35470018
354800              , :SVT00003-CMNT-SEQ-NBR                            35480018
354900              , :SVT00003-CMNT-TXT                                35490018
355000     END-EXEC.                                                    35500000
355100                                                                  35510000
355200     EVALUATE TRUE                                                35520000
355300         WHEN SQLCODE = ZERO                                      35530000
355400              IF PS-FIRST-COMMENT-ROW                             35540000
355500                  MOVE SVT00003-CMNT-TXT                          35550018
355600                              TO ASC-COMMENT-LINE (PV-COMMENT-SUB)35560000
355700                  MOVE SVT00003-CRE-TMST                          35570018
355800                              TO PV-HOLD-COMMENT-TMST             35580000
355900                  SET PS-NOT-FIRST-COMMENT-ROW TO TRUE            35590000
356000              ELSE                                                35600000
356100                  IF SVT00003-CRE-TMST = PV-HOLD-COMMENT-TMST     35610018
356200                      MOVE SVT00003-CMNT-TXT                      35620018
356300                              TO ASC-COMMENT-LINE (PV-COMMENT-SUB)35630000
356400                  END-IF                                          35640000
356500              END-IF                                              35650000
356600                                                                  35660000
356700         WHEN SQLCODE = +100                                      35670000
356800              SET PS-COMMENT-ROW-NOT-FOUND TO TRUE                35680000
356900         WHEN OTHER                                               35690000
357000              MOVE '4322-FETCH-COMMENT-CSR'                       35700000
357100                               TO DP013-PARAGRAPH                 35710000
357200              MOVE 'FETCH COMMENT CSR'                            35720000
357300                               TO DP013-MESSAGE-TEXT (1)          35730000
357400              MOVE SQLCA       TO DP013-SQLCA                     35740000
357500              MOVE 'SVT_CRD_ACCT_CMMT '                           35750018
357600                               TO DP013-DB2-TABLE-NAME (1)        35760018
357700              SET DP013-DB2-ABEND                                 35770000
357800                               TO TRUE                            35780000
357900              PERFORM DP013-0000-PROCESS-ABEND                    35790000
358000     END-EVALUATE.                                                35800000
358100                                                                  35810000
358200*----------------------------------------------------------------*35820000
358300* CLOSE THE COMMENT CURSOR.                                      *35830000
358400*----------------------------------------------------------------*35840000
358500                                                                  35850000
358600 4324-CLOSE-COMMENT-CSR.                                          35860000
358700     EXEC SQL                                                     35870000
358800         CLOSE COMMENT-CSR                                        35880000
358900     END-EXEC.                                                    35890000
359000                                                                  35900000
359100     EVALUATE TRUE                                                35910000
359200         WHEN SQLCODE = ZERO                                      35920000
359300             CONTINUE                                             35930000
359400         WHEN OTHER                                               35940000
359500             MOVE '4324-CLOSE-COMMENT-CSR'                        35950000
359600                               TO DP013-PARAGRAPH                 35960000
359700             MOVE 'CLOSE COMMENT CSR '                            35970000
359800                               TO DP013-MESSAGE-TEXT (1)          35980000
359900             MOVE SQLCA        TO DP013-SQLCA                     35990000
360000             MOVE 'SVT_CRD_ACCT_CMMT ' TO DP013-DB2-TABLE-NAME (1)36000018
360100             SET DP013-DB2-ABEND                                  36010000
360200                 DP013-XCTL-DISPLAY-RESTART                       36020000
360300                               TO TRUE                            36030000
360400             PERFORM DP013-0000-PROCESS-ABEND                     36040000
360500     END-EVALUATE.                                                36050000
360600                                                                  36060000
360700*----------------------------------------------------------------*36070000
360800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *36080000
360900*----------------------------------------------------------------*36090000
361000                                                                  36100000
361100 4400-MOVE-COMMAREA-TO-SCREEN.                                    36110000
361200     MOVE ASC-CRD-TYP-CDE           TO ACRDTYPO.                  36120018
361300     MOVE ASC-CRD-TYP-DESC          TO ACRDDESO.                  36130018
361400     MOVE ASC-KEY-CARD-ID           TO SV007-CARD-NUMBER9         36140018
361500     MOVE 13                       TO SV007-CARD-NUMBER-DIS-LENGTH36150018
361600     SET SV007-FORMAT-DISPLAY TO TRUE                             36160018
361700     PERFORM SV007-FORMAT-CARD                                    36170018
361800     MOVE SV007-CARD-NUMBER-DISPLAY TO ACARDIDO.                  36180018
361900     MOVE ASC-CONTROL-NBR           TO ACNTLIDO.                  36190000
362000     MOVE ASC-CARD-STATUS-DESC      TO ASTATUSO.                  36200000
362100                                                                  36210018
362200     IF ASC-KEY-ACTIVITY-TYPE = ZERO                              36220000
362300         MOVE SPACES                TO AACTTYPO                   36230000
362400     ELSE                                                         36240000
362500         MOVE ASC-KEY-ACTIVITY-TYPE TO AACTTYPO                   36250000
362600     END-IF.                                                      36260000
362700                                                                  36270018
362800     MOVE ASC-ACTIVITY-TYPE-HEADER-DESC                           36280000
362900                                    TO AACTDESO.                  36290000
363000     MOVE ASC-KEY-AMOUNT-REQUESTED  TO AREQAMTO.                  36300000
363100     MOVE ASC-AUTH-DECISION         TO AAUTHDCO.                  36310000
363200     MOVE ASC-APPROVED-TENDER-AMT   TO AAPPAMTO.                  36320000
363300     MOVE ASC-ORIGINAL-BALANCE      TO AORGBALO.                  36330000
363400     MOVE ASC-REMAINING-BALANCE     TO AREMBALO.                  36340000
363500                                                                  36350018
363600     IF ASC-REMAINING-BALANCE < ZERO                              36360000
363700         MOVE DP015-YELLOW          TO AREMBALC                   36370000
363800     ELSE                                                         36380000
363900         MOVE DP015-BLUE            TO AREMBALC                   36390000
364000     END-IF.                                                      36400000
364100                                                                  36410018
364200     IF ASC-FORMAT-IND = PC-REFERRAL-FORMAT                       36420000
364300       AND ASC-APPROVED-TENDER-AMT < ASC-KEY-AMOUNT-REQUESTED     36430000
364400         MOVE DP015-YELLOW          TO AAPPAMTC                   36440000
364500                                       AREQAMTC                   36450000
364600     ELSE                                                         36460000
364700         MOVE DP015-BLUE            TO AAPPAMTC                   36470000
364800                                       AREQAMTC                   36480000
364900     END-IF.                                                      36490000
365000                                                                  36500000
365100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             36510000
365200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          36520000
365300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          36530000
365400             MOVE +1                TO ASC-BLK-SUB                36540000
365500             PERFORM 5100-WRITE-TEMP-STORAGE                      36550000
365600             ADD +1                 TO ASC-BLK-SUB                36560000
365700             PERFORM 5100-WRITE-TEMP-STORAGE                      36570000
365800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             36580000
365900                 GIVING PV-BLOCK-NUMBER                           36590000
366000                 REMAINDER PV-REMAINDER                           36600000
366100             IF  PV-REMAINDER > ZERO                              36610000
366200                 ADD +1             TO PV-BLOCK-NUMBER            36620000
366300             END-IF                                               36630000
366400             MOVE +1                TO ASC-BLK-SUB                36640000
366500             PERFORM 4410-READ-TEMP-STORAGE                       36650000
366600             ADD +1                 TO ASC-BLK-SUB                36660000
366700                                       PV-BLOCK-NUMBER            36670000
366800             PERFORM 4410-READ-TEMP-STORAGE                       36680000
366900     END-IF.                                                      36690000
367000                                                                  36700018
367100     MOVE +1                        TO ASC-BLK-SUB.               36710000
367200     COMPUTE ASC-ITEM-SUB =                                       36720000
367300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              36730000
367400         + PC-ITEMS-PER-PANEL).                                   36740000
367500                                                                  36750000
367600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        36760000
367700         ADD +1                     TO ASC-BLK-SUB                36770000
367800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            36780000
367900     END-IF.                                                      36790000
368000                                                                  36800000
368100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           36810000
368200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                36820000
368300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        36830000
368400                                                                  36840018
368500     PERFORM 4420-FORMAT-LIST-LINES                               36850000
368600         VARYING PV-SUB                                           36860000
368700         FROM PC-ITEMS-PER-PANEL BY -1                            36870000
368800         UNTIL PV-SUB < +1.                                       36880000
368900                                                                  36890000
369000     COMPUTE ASC-ITEMS-DISPLAYED =                                36900000
369100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          36910000
369200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    36920000
369300                                      ASTRTITO.                   36930000
369400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    36940000
369500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    36950000
369600                                                                  36960000
369700     PERFORM 4440-FORMAT-COMMENT-LINES                            36970000
369800         VARYING PV-COMMENT-SUB                                   36980000
369900         FROM 1 BY 1                                              36990000
370000         UNTIL PV-COMMENT-SUB > 4.                                37000000
370100                                                                  37010000
370200     IF ASC-VOID-ERROR                                            37020000
370300         MOVE ASC-VOID-MSG-NBR     TO DP020-MSG-NUMBER            37030000
370400         SET DP020-MSG-FATAL       TO TRUE                        37040000
370500     END-IF.                                                      37050000
370600                                                                  37060000
370700     IF  DP020-MSG-NUMBER-X = SPACE                               37070000
370800       EVALUATE TRUE                                              37080000
370900         WHEN ASC-VOID-REQUEST-OK                                 37090000
371000*            --- PRESS 'VOID' KEY AGAIN TO CONFIRM VOID ---       37100000
371100             MOVE PC-TSYMSG-01235      TO DP020-MSG-NUMBER        37110000
371200             SET DP020-MSG-INFORMATIONAL                          37120000
371300                                   TO TRUE                        37130000
371400         WHEN ASC-REVERSE-VOID-REQUEST-OK                         37140018
371500*            --- PRESS 'REV VOID' KEY AGAIN TO CONFIRM ---        37150018
371600*            --- THE VOID REVERSAL ---                            37160018
371700             MOVE PC-TSYMSG-01695      TO DP020-MSG-NUMBER        37170018
371800             SET DP020-MSG-INFORMATIONAL                          37180018
371900                                   TO TRUE                        37190018
372000         WHEN ASC-TRANS-PENDING                                   37200000
372100*            --- PRESS F2 TO CONFIRM REQUEST ---                  37210000
372200             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            37220000
372300             SET DP020-MSG-INFORMATIONAL                          37230000
372400                                   TO TRUE                        37240000
372500         WHEN ASC-ITEM-AT-BOT-OF-PANEL                            37250000
372600                                      < ASC-NUMBER-OF-ITEMS-READ  37260000
372700*            --- MORE ITEMS TO DISPLAY ----                       37270000
372800             MOVE PC-TSYMSG-00279                                 37280000
372900                                   TO DP020-MSG-NUMBER            37290000
373000             SET DP020-MSG-INFORMATIONAL                          37300000
373100                                   TO TRUE                        37310000
373200         WHEN ASC-ITEM-AT-BOT-OF-PANEL                            37320018
373300                                      >= ASC-NUMBER-OF-ITEMS-READ 37330018
373400*            --- BOTTOM OF LIST ---                               37340018
373500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            37350018
373600             SET DP020-MSG-INFORMATIONAL                          37360018
373700                                   TO TRUE                        37370018
373800       END-EVALUATE                                               37380000
373900     END-IF.                                                      37390000
374000                                                                  37400000
374100*----------------------------------------------------------------*37410000
374200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *37420000
374300*----------------------------------------------------------------*37430000
374400                                                                  37440000
374500 4410-READ-TEMP-STORAGE.                                          37450000
374600                                                                  37460000
374700     EXEC CICS                                                    37470000
374800         READQ TS                                                 37480000
374900             QUEUE (ASC-LIST-QUEUE-NAME)                          37490000
375000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               37500000
375100             ITEM  (PV-BLOCK-NUMBER)                              37510000
375200             RESP  (PV-CICS-RESP)                                 37520000
375300     END-EXEC.                                                    37530000
375400                                                                  37540000
375500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       37550000
375600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     37560000
375700         CONTINUE                                                 37570000
375800     ELSE                                                         37580000
375900         SET DP013-CICS-ABEND     TO TRUE                         37590000
376000         SET DP013-NO-ROLLBACK    TO TRUE                         37600000
376100         MOVE '4410-READ-TEMP-STORAGE'                            37610000
376200                                  TO DP013-PARAGRAPH              37620000
376300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      37630000
376400                                  TO DP013-MESSAGE-TEXT(1)        37640000
376500         PERFORM DP013-0000-PROCESS-ABEND                         37650000
376600     END-IF.                                                      37660000
376700                                                                  37670000
376800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      37680000
376900                                  TO TRUE.                        37690000
377000                                                                  37700000
377100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         37710000
377200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               37720000
377300     END-IF.                                                      37730000
377400*----------------------------------------------------------------*37740000
377500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *37750000
377600*----------------------------------------------------------------*37760000
377700                                                                  37770000
377800 4420-FORMAT-LIST-LINES.                                          37780000
377900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      37790000
378000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                37800000
378100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA          (PV-SUB)  37810018
378200         MOVE DP015-HL-OFF       TO MR-SELECTH          (PV-SUB)  37820018
378300                                    MR-TRAN-IDH         (PV-SUB)  37830018
378400                                    MR-REVERSAL-INDH    (PV-SUB)  37840018
378500                                    MR-VOID-INDH        (PV-SUB)  37850018
378600                                    MR-ACTIVITY-TYPEH   (PV-SUB)  37860018
378700                                    MR-AMOUNTH          (PV-SUB)  37870018
378800                                    MR-AUTO-MANUALH     (PV-SUB)  37880018
378900                                    MR-USERIDH          (PV-SUB)  37890018
379000                                    MR-APPROVAL-NUMBERH (PV-SUB)  37900018
379100                                    MR-ACTIVITY-STATUSH (PV-SUB)  37910018
379200         MOVE SPACE              TO MR-SELECTI (PV-SUB)           37920018
379300                                    MR-TRAN-ID (PV-SUB)           37930018
379400                                    MR-REVERSAL-IND (PV-SUB)      37940018
379500                                    MR-VOID-IND (PV-SUB)          37950018
379600                                    MR-ACTIVITY-TYPE-DESC         37960018
379700                                                     (PV-SUB)     37970018
379800                                    MR-AMOUNT-X (PV-SUB)          37980018
379900                                    MR-AUTO-MANUAL (PV-SUB)       37990018
380000                                    MR-USERID (PV-SUB)            38000018
380100                                    MR-APPROVAL-NUMBER (PV-SUB)   38010018
380200                                    MR-ACTIVITY-STATUS (PV-SUB)   38020018
380300     ELSE                                                         38030018
380400         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      38040018
380500                                                   > SPACE        38050018
380600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 38060018
380700                                 TO MR-SELECTI (PV-SUB)           38070018
380800*            SAVE ORIGINAL LINE SELECTED TO DETERMINE IF LATER    38080018
380900*            USER SPACES OUT THIS SELECTION AND SELECTS NEW TRANS 38090018
381000                                    ASC-HOLD-SEL-LN               38100018
381100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38110018
381200*            SAVE REVERSE VOID TIMESTAMP AND AMOUNT               38120018
381300             MOVE ASC-AMOUNT (ASC-BLK-SUB ASC-ITEM-SUB)           38130018
381400                  TO  ASC-DELETE-AMOUNT                           38140018
381500             MOVE ASC-TRN-AUTH-TMST (ASC-BLK-SUB ASC-ITEM-SUB)    38150018
381600                  TO  ASC-DELETE-TMST                             38160018
381700         ELSE                                                     38170018
381800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      38180018
381900                                 TO MR-SELECTI (PV-SUB)           38190018
382000         END-IF                                                   38200018
382100                                                                  38210018
382200         IF  DP030-SET-CURSOR-TRAILER                             38220018
382300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)38230018
382400                 > SPACE)                                         38240018
382500               OR (PV-SUB = 1))                                   38250018
382600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               38260018
382700                MOVE -1          TO MR-SELECTL (PV-SUB)           38270018
382800             END-IF                                               38280018
382900         END-IF                                                   38290018
383000                                                                  38300018
383100*        THIS CODE IS USED FOR THE REVERSE VOID FUNCTION.         38310018
383200*        THE PURPOSE IS TO HILITE THE CORRESPONDING TRANSACTION   38320018
383300*        WHICH GOES WITH THE ONE WHICH WAS SELECTED FOR DOING     38330018
383400*        THE REVERSE VOID.  IT ALSO UN-HILITES THE CORRESPONDING  38340018
383500*        TRANSACTION IF THE SELECTION WAS SPACED OUT OR IF ANOTHER38350018
383600*        SELECTION WAS MADE PRIOR TO THE FIRST ONE BEING COMPLETED38360018
383700         IF ASC-REVERSE-VOID-REQUEST-OK                           38370018
383800*          USED TO RESTRICT REVERSE VOID TO HIGHLIGHT ONE TRANS   38380018
383900           IF  ASC-MATCH-FND-SW = 'N'                       AND   38390018
384000              (ASC-KEY-CARD-ID = ASC-HLD-CARD-ID)           AND   38400018
384100              (ASC-VOID-IND      (ASC-BLK-SUB ASC-ITEM-SUB)       38410018
384200                                 = SV004-VOID-TRANS)        AND   38420018
384300              (ASC-ACTIVITY-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)       38430018
384400                                 = ASC-HLD-ACTIVITY-TYPE)   AND   38440018
384500              (ASC-REVERSAL-IND  (ASC-BLK-SUB ASC-ITEM-SUB)       38450018
384600                                 = ASC-HLD-REVERSAL-IND)    AND   38460018
384700              (ASC-POS-DATE-ISO  (ASC-BLK-SUB ASC-ITEM-SUB)       38470018
384800                                 = ASC-HLD-POS-DATE-ISO)    AND   38480018
384900              (ASC-STORE-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)       38490018
385000                                 = ASC-HLD-STORE-NBR)       AND   38500018
385100              (ASC-TERMINAL      (ASC-BLK-SUB ASC-ITEM-SUB)       38510018
385200                                 = ASC-HLD-TERMINAL)        AND   38520018
385300              (ASC-TRANSACTION   (ASC-BLK-SUB ASC-ITEM-SUB)       38530018
385400                                 = ASC-HLD-TRANSACTION)     AND   38540018
385500*              SAVE REVERSE VOID AMOUNT                           38550018
385600              (ASC-AMOUNT        (ASC-BLK-SUB ASC-ITEM-SUB)       38560018
385700                                 = ASC-HLD-TRANS-AMOUNT)          38570018
385800* WILL FIND NON 'S' MATCH PROVIDED USER F8'S SO MATCHING TRANS    38580018
385900* IS HIGHLIGHTED. OTHERWISE, MATCH WILL BE FOUND BY SEARCHING TS  38590018
386000* IN PARAGRAPH 8850-                                              38600018
386100                SET ASC-HILITE-LINE-YL (ASC-BLK-SUB ASC-ITEM-SUB) 38610018
386200                    ASC-OPP-REV-VOID   (ASC-BLK-SUB ASC-ITEM-SUB) 38620018
386300                                                    TO TRUE       38630018
386400*               USED TO RESTRICT REV VOID TO HIGHLIGHT ONE TRANS  38640018
386500                MOVE 'Y' TO ASC-MATCH-FND-SW                      38650018
386600*               SAVE REVERSE VOID TIMESTAMP OF HIGHLIGHTED MATCH  38660018
386700                MOVE ASC-TRN-AUTH-TMST (ASC-BLK-SUB ASC-ITEM-SUB) 38670018
386800                  TO  ASC-REV-VOID-TMST                           38680018
386900           ELSE                                                   38690018
387000             IF ASC-OPP-REV-VOID (ASC-BLK-SUB ASC-ITEM-SUB)       38700018
387100               SET ASC-NO-HILITE       (ASC-BLK-SUB ASC-ITEM-SUB) 38710018
387200                   ASC-NO-OPP-REV-VOID (ASC-BLK-SUB ASC-ITEM-SUB) 38720018
387300                                                    TO TRUE       38730018
387400             END-IF                                               38740018
387500*            LOGIC TO FIND MATCHING TRANS AFTER INITIAL MATCH     38750018
387600*            FOUND AND USER F8/F7 TO OTHER SCREENS                38760018
387700             IF (ASC-KEY-CARD-ID = ASC-HLD-CARD-ID)           AND 38770018
387800              (ASC-VOID-IND      (ASC-BLK-SUB ASC-ITEM-SUB)       38780018
387900                                 = SV004-VOID-TRANS)        AND   38790018
388000              (ASC-ACTIVITY-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)       38800018
388100                                 = ASC-HLD-ACTIVITY-TYPE)   AND   38810018
388200              (ASC-REVERSAL-IND  (ASC-BLK-SUB ASC-ITEM-SUB)       38820018
388300                                 = ASC-HLD-REVERSAL-IND)    AND   38830018
388400              (ASC-POS-DATE-ISO  (ASC-BLK-SUB ASC-ITEM-SUB)       38840018
388500                                 = ASC-HLD-POS-DATE-ISO)    AND   38850018
388600              (ASC-STORE-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)       38860018
388700                                 = ASC-HLD-STORE-NBR)       AND   38870018
388800              (ASC-TERMINAL      (ASC-BLK-SUB ASC-ITEM-SUB)       38880018
388900                                 = ASC-HLD-TERMINAL)        AND   38890018
389000              (ASC-TRANSACTION   (ASC-BLK-SUB ASC-ITEM-SUB)       38900018
389100                                 = ASC-HLD-TRANSACTION)     AND   38910018
389200              (ASC-AMOUNT        (ASC-BLK-SUB ASC-ITEM-SUB)       38920018
389300                                 = ASC-HLD-TRANS-AMOUNT)    AND   38930018
389400              (ASC-TRN-AUTH-TMST (ASC-BLK-SUB ASC-ITEM-SUB)       38940018
389500                                 = ASC-REV-VOID-TMST)             38950018
389600* WILL FIND NON 'S' MATCH PROVIDED USER F8'S SO MATCHING TRANS    38960018
389700* IS HIGHLIGHTED. OTHERWISE, MATCH WILL BE FOUND BY SEARCHING TS  38970018
389800* IN PARAGRAPH 8850-                                              38980018
389900                SET ASC-HILITE-LINE-YL (ASC-BLK-SUB ASC-ITEM-SUB) 38990018
390000                    ASC-OPP-REV-VOID   (ASC-BLK-SUB ASC-ITEM-SUB) 39000018
390100                                                    TO TRUE       39010018
390200             END-IF                                               39020018
390300           END-IF                                                 39030018
390400         ELSE                                                     39040018
390500           IF ASC-OPP-REV-VOID (ASC-BLK-SUB ASC-ITEM-SUB)         39050018
390600             SET ASC-NO-HILITE       (ASC-BLK-SUB ASC-ITEM-SUB)   39060018
390700                 ASC-NO-OPP-REV-VOID (ASC-BLK-SUB ASC-ITEM-SUB)   39070018
390800                                                    TO TRUE       39080018
390900           END-IF                                                 39090018
391000         END-IF                                                   39100018
391100                                                                  39110018
391200         MOVE ASC-POS-DATE-ISO    (ASC-BLK-SUB ASC-ITEM-SUB)      39120018
391300                               TO PV-DB2-DATE                     39130018
391400         MOVE PV-DB2-CC        TO PV-TRAN-CC                      39140018
391500         MOVE PV-DB2-YY        TO PV-TRAN-YY                      39150018
391600         MOVE PV-DB2-MM        TO PV-TRAN-MM                      39160018
391700         MOVE PV-DB2-DD        TO PV-TRAN-DD                      39170018
391800         MOVE ASC-STORE-NBR       (ASC-BLK-SUB ASC-ITEM-SUB)      39180018
391900                               TO PV-TRAN-STR-NBR                 39190018
392000         MOVE ASC-TERMINAL        (ASC-BLK-SUB ASC-ITEM-SUB)      39200018
392100                               TO PV-TRAN-TRMNL-NBR               39210018
392200         MOVE ASC-TRANSACTION     (ASC-BLK-SUB ASC-ITEM-SUB)      39220018
392300                               TO PV-TRAN-TRN-NBR                 39230018
392400         MOVE '/'              TO PV-TRAN-S1                      39240018
392500                                  PV-TRAN-S2                      39250018
392600                                  PV-TRAN-S3                      39260018
392700         MOVE PV-TRAN-ID       TO MR-TRAN-ID (PV-SUB)             39270018
392800         IF ASC-REVERSAL-IND      (ASC-BLK-SUB ASC-ITEM-SUB)      39280018
392900                                 = SV004-REV-CDE-NORMAL           39290018
393000             MOVE SV004-REV-CDE-NORMAL-DISPLAY                    39300018
393100                                 TO MR-REVERSAL-IND (PV-SUB)      39310018
393200         ELSE                                                     39320018
393300             MOVE ASC-REVERSAL-IND (ASC-BLK-SUB ASC-ITEM-SUB)     39330018
393400                                 TO MR-REVERSAL-IND (PV-SUB)      39340018
393500         END-IF                                                   39350018
393600         IF ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB)               39360018
393700                                  = SV004-VOID-TRANS              39370018
393800             MOVE SV004-VOID-DISPLAY                              39380018
393900                                 TO MR-VOID-IND (PV-SUB)          39390018
394000         ELSE                                                     39400018
394100             MOVE ASC-VOID-IND      (ASC-BLK-SUB ASC-ITEM-SUB)    39410018
394200                                 TO MR-VOID-IND (PV-SUB)          39420018
394300         END-IF                                                   39430018
394400         IF MR-VOID-IND (PV-SUB) = 'N'                            39440018
394500            MOVE ' ' TO MR-VOID-IND (PV-SUB)                      39450018
394600         END-IF                                                   39460018
394700         MOVE ASC-ACTIVITY-TYPE-DESC                              39470018
394800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    39480018
394900                                 TO MR-ACTIVITY-TYPE-DESC (PV-SUB)39490018
395000         MOVE ASC-AMOUNT            (ASC-BLK-SUB ASC-ITEM-SUB)    39500018
395100                                 TO MR-AMOUNT (PV-SUB)            39510018
395200         MOVE ASC-AUTO-MANUAL       (ASC-BLK-SUB ASC-ITEM-SUB)    39520018
395300                                 TO MR-AUTO-MANUAL (PV-SUB)       39530018
395400         MOVE ASC-USERID            (ASC-BLK-SUB ASC-ITEM-SUB)    39540018
395500                                 TO MR-USERID (PV-SUB)            39550018
395600         IF (ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) > 1) 39560018
395700           OR                                                     39570018
395800           ((ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) = 1) 39580018
395900             AND (ASC-FORMAT-IND = PC-AUDIT-VOID-FORMAT OR        39590018
396000                                   PC-REFER-VOID-FORMAT))         39600018
396100             MOVE ASC-APPROVAL-NUMBER-LST                         39610018
396200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  39620018
396300                                 TO MR-APPROVAL-NUMBER (PV-SUB)   39630018
396400         ELSE                                                     39640018
396500             IF ASC-DISPLAY-APPROVAL                              39650018
396600                 MOVE ASC-APPROVAL-NUMBER                         39660018
396700                                 TO MR-APPROVAL-NUMBER (PV-SUB)   39670018
396800                 MOVE DP015-YELLOW                                39680018
396900                                 TO MR-APPROVAL-NUMBERC (PV-SUB)  39690018
397000             ELSE                                                 39700018
397100                     MOVE SPACES TO MR-APPROVAL-NUMBER (PV-SUB)   39710018
397200             END-IF                                               39720018
397300         END-IF                                                   39730018
397400         MOVE ASC-ACTIVITY-STATUS   (ASC-BLK-SUB ASC-ITEM-SUB)    39740018
397500                                 TO MR-ACTIVITY-STATUS (PV-SUB)   39750018
397600         IF ASC-LIST-ITEM-NUMBER    (ASC-BLK-SUB ASC-ITEM-SUB)    39760018
397700                                 = 1                              39770018
397800           AND ((ASC-REMAINING-BALANCE < ZERO)                    39780018
397900           OR (ASC-FORMAT-IND = PC-REFERRAL-FORMAT                39790018
398000               AND ASC-APPROVED-TENDER-AMT                        39800018
398100                                 < ASC-KEY-AMOUNT-REQUESTED))     39810018
398200             MOVE DP015-YELLOW   TO MR-AMOUNTC (PV-SUB)           39820018
398300         ELSE                                                     39830018
398400             MOVE DP015-BLUE     TO MR-AMOUNTC (PV-SUB)           39840018
398500         END-IF                                                   39850018
398600         IF ASC-HILITE-SEL          (ASC-BLK-SUB ASC-ITEM-SUB)    39860018
398700             MOVE -1             TO MR-SELECTL (PV-SUB)           39870018
398800             SET DP030-SET-CURSOR-APPL-1                          39880018
398900                                 TO TRUE                          39890018
399000             MOVE DP015-RED      TO MR-SELECTC (PV-SUB)           39900018
399100             MOVE DP015-REVERSE  TO MR-SELECTH (PV-SUB)           39910018
399200         END-IF                                                   39920018
399300         IF ASC-HILITE-LINE-RD      (ASC-BLK-SUB ASC-ITEM-SUB)    39930018
399400             MOVE DP015-RED      TO MR-TRAN-IDC         (PV-SUB)  39940018
399500             MOVE DP015-REVERSE  TO MR-TRAN-IDH         (PV-SUB)  39950018
399600             MOVE DP015-RED      TO MR-REVERSAL-INDC    (PV-SUB)  39960018
399700             MOVE DP015-REVERSE  TO MR-REVERSAL-INDH    (PV-SUB)  39970018
399800             MOVE DP015-RED      TO MR-VOID-INDC        (PV-SUB)  39980018
399900             MOVE DP015-REVERSE  TO MR-VOID-INDH        (PV-SUB)  39990018
400000             MOVE DP015-RED      TO MR-ACTIVITY-TYPEC   (PV-SUB)  40000018
400100             MOVE DP015-REVERSE  TO MR-ACTIVITY-TYPEH   (PV-SUB)  40010018
400200             MOVE DP015-RED      TO MR-AMOUNTC          (PV-SUB)  40020018
400300             MOVE DP015-REVERSE  TO MR-AMOUNTH          (PV-SUB)  40030018
400400             MOVE DP015-RED      TO MR-AUTO-MANUALC     (PV-SUB)  40040018
400500             MOVE DP015-REVERSE  TO MR-AUTO-MANUALH     (PV-SUB)  40050018
400600             MOVE DP015-RED      TO MR-USERIDC          (PV-SUB)  40060018
400700             MOVE DP015-REVERSE  TO MR-USERIDH          (PV-SUB)  40070018
400800             MOVE DP015-RED      TO MR-APPROVAL-NUMBERC (PV-SUB)  40080018
400900             MOVE DP015-REVERSE  TO MR-APPROVAL-NUMBERH (PV-SUB)  40090018
401000             MOVE DP015-RED      TO MR-ACTIVITY-STATUSC (PV-SUB)  40100018
401100             MOVE DP015-REVERSE  TO MR-ACTIVITY-STATUSH (PV-SUB)  40110018
401200         ELSE                                                     40120018
401300           IF ASC-HILITE-LINE-YL      (ASC-BLK-SUB ASC-ITEM-SUB)  40130018
401400               MOVE DP015-YELLOW   TO MR-TRAN-IDC         (PV-SUB)40140018
401500               MOVE DP015-REVERSE  TO MR-TRAN-IDH         (PV-SUB)40150018
401600               MOVE DP015-YELLOW   TO MR-REVERSAL-INDC    (PV-SUB)40160018
401700               MOVE DP015-REVERSE  TO MR-REVERSAL-INDH    (PV-SUB)40170018
401800               MOVE DP015-YELLOW   TO MR-VOID-INDC        (PV-SUB)40180018
401900               MOVE DP015-REVERSE  TO MR-VOID-INDH        (PV-SUB)40190018
402000               MOVE DP015-YELLOW   TO MR-ACTIVITY-TYPEC   (PV-SUB)40200018
402100               MOVE DP015-REVERSE  TO MR-ACTIVITY-TYPEH   (PV-SUB)40210018
402200               MOVE DP015-YELLOW   TO MR-AMOUNTC          (PV-SUB)40220018
402300               MOVE DP015-REVERSE  TO MR-AMOUNTH          (PV-SUB)40230018
402400               MOVE DP015-YELLOW   TO MR-AUTO-MANUALC     (PV-SUB)40240018
402500               MOVE DP015-REVERSE  TO MR-AUTO-MANUALH     (PV-SUB)40250018
402600               MOVE DP015-YELLOW   TO MR-USERIDC          (PV-SUB)40260018
402700               MOVE DP015-REVERSE  TO MR-USERIDH          (PV-SUB)40270018
402800               MOVE DP015-YELLOW   TO MR-APPROVAL-NUMBERC (PV-SUB)40280018
402900               MOVE DP015-REVERSE  TO MR-APPROVAL-NUMBERH (PV-SUB)40290018
403000               MOVE DP015-YELLOW   TO MR-ACTIVITY-STATUSC (PV-SUB)40300018
403100               MOVE DP015-REVERSE  TO MR-ACTIVITY-STATUSH (PV-SUB)40310018
403200           ELSE                                                   40320018
403300               MOVE DP015-BLUE     TO MR-TRAN-IDC         (PV-SUB)40330018
403400               MOVE DP015-HL-OFF   TO MR-TRAN-IDH         (PV-SUB)40340018
403500               MOVE DP015-BLUE     TO MR-REVERSAL-INDC    (PV-SUB)40350018
403600               MOVE DP015-HL-OFF   TO MR-REVERSAL-INDH    (PV-SUB)40360018
403700               MOVE DP015-BLUE     TO MR-VOID-INDC        (PV-SUB)40370018
403800               MOVE DP015-HL-OFF   TO MR-VOID-INDH        (PV-SUB)40380018
403900               MOVE DP015-BLUE     TO MR-ACTIVITY-TYPEC   (PV-SUB)40390018
404000               MOVE DP015-HL-OFF   TO MR-ACTIVITY-TYPEH   (PV-SUB)40400018
404100               IF MR-AMOUNTC (PV-SUB) = DP015-YELLOW              40410018
404200                   CONTINUE                                       40420018
404300               ELSE                                               40430018
404400                   MOVE DP015-BLUE TO MR-AMOUNTC          (PV-SUB)40440018
404500               END-IF                                             40450018
404600               MOVE DP015-HL-OFF   TO MR-AMOUNTH          (PV-SUB)40460018
404700               MOVE DP015-BLUE     TO MR-AUTO-MANUALC     (PV-SUB)40470018
404800               MOVE DP015-HL-OFF   TO MR-AUTO-MANUALH     (PV-SUB)40480018
404900               MOVE DP015-BLUE     TO MR-USERIDC          (PV-SUB)40490018
405000               MOVE DP015-HL-OFF   TO MR-USERIDH          (PV-SUB)40500018
405100               IF MR-APPROVAL-NUMBERC (PV-SUB) = DP015-YELLOW     40510018
405200                   CONTINUE                                       40520018
405300               ELSE                                               40530018
405400                   MOVE DP015-BLUE TO MR-APPROVAL-NUMBERC (PV-SUB)40540018
405500               END-IF                                             40550018
405600               MOVE DP015-HL-OFF   TO MR-APPROVAL-NUMBERH (PV-SUB)40560018
405700               MOVE DP015-BLUE     TO MR-ACTIVITY-STATUSC (PV-SUB)40570018
405800               MOVE DP015-HL-OFF   TO MR-ACTIVITY-STATUSH (PV-SUB)40580018
405900           END-IF                                                 40590018
406000         END-IF                                                   40600018
406100     END-IF.                                                      40610018
406200                                                                  40620018
406300     SUBTRACT +1 FROM ASC-ITEM-SUB                                40630018
406400     IF  ASC-ITEM-SUB < + 1                                       40640018
406500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  40650018
406600         MOVE +1                 TO ASC-BLK-SUB                   40660018
406700     END-IF.                                                      40670018
406800                                                                  40680018
406900*----------------------------------------------------------------*40690018
407000*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *40700018
407100*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *40710018
407200*  ISSUE A WARNING.                                              *40720018
407300*----------------------------------------------------------------*40730018
407400 4430-CHECK-FOR-BEGIN-AND-END.                                    40740018
407500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       40750018
407600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     40760018
407700*            -- NO END-OF-RANGE SPECFIED ---                      40770018
407800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            40780018
407900             SET DP020-MSG-WARNING TO TRUE                        40790018
408000             PERFORM 4431-POSITION-AT-WARNING                     40800018
408100         END-IF                                                   40810018
408200     ELSE                                                         40820018
408300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     40830018
408400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                40840018
408500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            40850018
408600             SET DP020-MSG-WARNING TO TRUE                        40860018
408700             PERFORM 4431-POSITION-AT-WARNING                     40870018
408800         END-IF                                                   40880018
408900     END-IF.                                                      40890018
409000*----------------------------------------------------------------*40900018
409100*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *40910018
409200*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *40920018
409300*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *40930018
409400*  POSITION THE CURSOR THERE.                                    *40940018
409500*----------------------------------------------------------------*40950018
409600 4431-POSITION-AT-WARNING.                                        40960018
409700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 40970018
409800                    - PV-TOP-ITEM + 1.                            40980018
409900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      40990018
410000         CONTINUE                                                 41000018
410100     ELSE                                                         41010018
410200         SET DP030-SET-CURSOR-APPL-1                              41020018
410300                                   TO TRUE                        41030018
410400         MOVE -1                   TO MR-SELECTL (PV-SUB)         41040018
410500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         41050018
410600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         41060018
410700     END-IF.                                                      41070018
410800                                                                  41080018
410900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   41090018
411000                    - PV-TOP-ITEM + 1.                            41100018
411100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      41110018
411200         CONTINUE                                                 41120018
411300     ELSE                                                         41130018
411400         SET DP030-SET-CURSOR-APPL-1                              41140018
411500                                   TO TRUE                        41150018
411600         MOVE -1                   TO MR-SELECTL (PV-SUB)         41160018
411700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         41170018
411800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         41180018
411900     END-IF.                                                      41190018
412000                                                                  41200018
412100*----------------------------------------------------------------*41210018
412200 4440-FORMAT-COMMENT-LINES.                                       41220018
412300                                                                  41230018
412400     MOVE ASC-COMMENT-LINE (PV-COMMENT-SUB)                       41240018
412500                               TO MR-COMMENT (PV-COMMENT-SUB).    41250018
412600                                                                  41260018
412700*----------------------------------------------------------------*41270018
412800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *41280018
412900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *41290018
413000* FOR THE SELECTED ITEMS QUEUE.                                  *41300018
413100*                                                                *41310018
413200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *41320018
413300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *41330018
413400* THE ARRAY IS FULL.                                             *41340018
413500*----------------------------------------------------------------*41350018
413600                                                                  41360018
413700 5000-PREPARE-SEL-QUEUE.                                          41370018
413800                                                                  41380018
413900     MOVE +1                   TO  ASC-BLK-SUB.                   41390018
414000     PERFORM 5100-WRITE-TEMP-STORAGE.                             41400018
414100     ADD +1                    TO  ASC-BLK-SUB.                   41410018
414200     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) > 0                   41420018
414300         PERFORM 5100-WRITE-TEMP-STORAGE.                         41430018
414400                                                                  41440018
414500     MOVE ASC-SEL-QUEUE-NAME   TO  RD021-SEL-QUEUE-NAME.          41450018
414600     PERFORM 6010-DELETE-SEL-QUEUE.                               41460018
414700                                                                  41470018
414800     SET ASC-UPDATE-TSQ        TO  TRUE.                          41480018
414900                                                                  41490018
415000     SET RD022-IDX             TO  1.                             41500018
415100     MOVE ZERO                 TO RD021-NUMBER-OF-TS-ITEMS.       41510018
415200     INITIALIZE RD022-SELECTED-ITEM-ARRAY.                        41520018
415300                                                                  41530018
415400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           41540018
415500             VARYING PV-ITEM                                      41550018
415600             FROM 1 BY 1                                          41560018
415700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     41570018
415800                                                                  41580018
415900     IF  RD022-IDX > 1                                            41590018
416000         PERFORM 5205-WRITE-SEL-QUEUE                             41600018
416100         ADD +1                TO RD021-NUMBER-OF-TS-ITEMS        41610018
416200     END-IF.                                                      41620018
416300*----------------------------------------------------------------*41630018
416400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *41640018
416500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *41650018
416600*----------------------------------------------------------------*41660018
416700                                                                  41670018
416800 5100-WRITE-TEMP-STORAGE.                                         41680018
416900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     41690018
417000                                   TO PV-LIST-ITEM-NUMBER.        41700018
417100     COMPUTE PV-BLOCK-NUMBER =                                    41710018
417200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    41720018
417300                                                                  41730018
417400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             41740018
417500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             41750018
417600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      41760018
417700             PERFORM 5105-REWRITE-ASC-LISTQ                       41770018
417800         END-IF                                                   41780018
417900     ELSE                                                         41790018
418000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       41800018
418100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            41810018
418200         PERFORM 5110-WRITE-ASC-LISTQ                             41820018
418300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   41830018
418400     END-IF.                                                      41840018
418500                                                                  41850018
418600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             41860018
418700*----------------------------------------------------------------*41870018
418800*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *41880018
418900*  SPECIFIC COMMAREA.                                            *41890018
419000*----------------------------------------------------------------*41900018
419100 5105-REWRITE-ASC-LISTQ.                                          41910018
419200     EXEC CICS                                                    41920018
419300         WRITEQ TS                                                41930018
419400             QUEUE (ASC-LIST-QUEUE-NAME)                          41940018
419500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               41950018
419600             ITEM  (PV-BLOCK-NUMBER)                              41960018
419700             REWRITE                                              41970018
419800             RESP  (PV-CICS-RESP)                                 41980018
419900     END-EXEC.                                                    41990018
420000                                                                  42000018
420100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           42010018
420200         CONTINUE                                                 42020018
420300     ELSE                                                         42030018
420400         SET DP013-CICS-ABEND            TO TRUE                  42040018
420500         SET DP013-NO-ROLLBACK           TO TRUE                  42050018
420600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       42060018
420700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     42070018
420800                                         TO DP013-MESSAGE-TEXT(1) 42080018
420900         PERFORM DP013-0000-PROCESS-ABEND                         42090018
421000     END-IF.                                                      42100018
421100                                                                  42110018
421200*----------------------------------------------------------------*42120018
421300*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *42130018
421400*  SPECIFIC COMMAREA.                                            *42140018
421500*----------------------------------------------------------------*42150018
421600 5110-WRITE-ASC-LISTQ.                                            42160018
421700     EXEC CICS                                                    42170018
421800         WRITEQ TS                                                42180018
421900             QUEUE (ASC-LIST-QUEUE-NAME)                          42190018
422000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               42200018
422100             ITEM  (PV-BLOCK-NUMBER)                              42210018
422200             RESP  (PV-CICS-RESP)                                 42220018
422300     END-EXEC.                                                    42230018
422400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      42240018
422500         SET DP013-CICS-ABEND      TO TRUE                        42250018
422600         SET DP013-NO-ROLLBACK     TO TRUE                        42260018
422700         MOVE '5110-WRITE-ASC-LISTQ'                              42270018
422800                                   TO DP013-PARAGRAPH             42280018
422900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           42290018
423000                                   TO DP013-MESSAGE-TEXT(1)       42300018
423100         PERFORM DP013-0000-PROCESS-ABEND                         42310018
423200     END-IF.                                                      42320018
423300*----------------------------------------------------------------*42330018
423400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *42340018
423500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *42350018
423600*----------------------------------------------------------------*42360018
423700                                                                  42370018
423800 5200-FILL-SEL-QUEUE-RECORD.                                      42380018
423900                                                                  42390018
424000     PERFORM 6112-READ-LIST-QUEUE.                                42400018
424100                                                                  42410018
424200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       42420018
424300         PERFORM                                                  42430018
424400         VARYING LQW-IDX                                          42440018
424500         FROM 1 BY 1                                              42450018
424600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            42460018
424700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          42470018
424800                                                                  42480018
424900             IF  LQW-SELECT (LQW-IDX)                             42490018
425000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              42500018
425100                                   TO RD022-ITEM (RD022-IDX)      42510018
425200                 MOVE ASC-KEY-CARD-ID                             42520018
425300                                   TO RD022-CARD-ID (RD022-IDX)   42530018
425400                 MOVE ASC-CRD-TYP-CDE                             42540018
425500                                   TO RD022-CARD-TYPE (RD022-IDX) 42550018
425600                 MOVE ASC-CONTROL-NBR                             42560018
425700                                   TO RD022-CNTL-NBR              42570018
425800                                                    (RD022-IDX)   42580018
425900                 MOVE LQW-TRN-AUTH-TMST (LQW-IDX)                 42590018
426000                                   TO RD022-TRN-AUTH-TMST         42600018
426100                                        (RD022-IDX)               42610018
426200                 SET RD022-IDX UP BY 1                            42620018
426300                 IF  RD022-IDX > RD022-MAX-ITEMS                  42630018
426400                     PERFORM 5205-WRITE-SEL-QUEUE                 42640018
426500                     ADD +1        TO RD021-NUMBER-OF-TS-ITEMS    42650018
426600                     INITIALIZE RD022-SELECTED-ITEM-ARRAY         42660018
426700                     SET RD022-IDX TO  1                          42670018
426800                 END-IF                                           42680018
426900             END-IF                                               42690018
427000         END-PERFORM                                              42700018
427100     END-IF.                                                      42710018
427200                                                                  42720018
427300*----------------------------------------------------------------*42730018
427400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *42740018
427500*----------------------------------------------------------------*42750018
427600                                                                  42760018
427700 5205-WRITE-SEL-QUEUE.                                            42770018
427800                                                                  42780018
427900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            42790018
428000                                   TO RD022-SELECTED-ITEMS.       42800018
428100                                                                  42810018
428200     EXEC CICS                                                    42820018
428300          WRITEQ TS                                               42830018
428400              QUEUE (ASC-SEL-QUEUE-NAME)                          42840018
428500              FROM  (RD022-MESSAGE-SEL-REC)                       42850018
428600              ITEM  (PV-SEL-QUEUE-ITEM)                           42860018
428700              RESP  (PV-CICS-RESP)                                42870018
428800     END-EXEC.                                                    42880018
428900                                                                  42890018
429000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          42900018
429100         CONTINUE                                                 42910018
429200     ELSE                                                         42920018
429300         SET DP013-CICS-ABEND      TO TRUE                        42930018
429400         SET DP013-NO-ROLLBACK     TO TRUE                        42940018
429500         MOVE '5205-WRITE-SEL-QUEUE'                              42950018
429600                                   TO DP013-PARAGRAPH             42960018
429700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          42970018
429800                                   TO DP013-MESSAGE-TEXT(1)       42980018
429900         PERFORM DP013-0000-PROCESS-ABEND                         42990018
430000     END-IF.                                                      43000018
430100                                                                  43010018
430200*----------------------------------------------------------------*43020018
430300*  PREPARE SELECTION QUEUE TO GO TO OVERRIDE PROGRAM.  IT IS     *43030018
430400*  ALWAYS THE FIRST ITEM ON THE LIST WHICH IS TO BE PROCESSED,   *43040018
430500*  SO IT IS NOT NECESSARY TO READ THROUGH THE ENTIRE LIST.       *43050018
430600*----------------------------------------------------------------*43060018
430700                                                                  43070018
430800 5500-PREPARE-SEL-FOR-OVERRIDE.                                   43080018
430900                                                                  43090018
431000     SET ASC-UPDATE-TSQ        TO  TRUE.                          43100018
431100                                                                  43110018
431200     SET RD022-IDX             TO  1.                             43120018
431300     MOVE ZERO                 TO RD021-NUMBER-OF-TS-ITEMS.       43130018
431400     INITIALIZE RD022-SELECTED-ITEM-ARRAY.                        43140018
431500     MOVE 1                    TO PV-ITEM.                        43150018
431600     MOVE ASC-SEL-QUEUE-NAME   TO RD021-SEL-QUEUE-NAME.           43160018
431700                                                                  43170018
431800     PERFORM 6112-READ-LIST-QUEUE.                                43180018
431900                                                                  43190018
432000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       43200018
432100         SET LQW-IDX TO 1                                         43210018
432200         MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                      43220018
432300                               TO RD022-ITEM (RD022-IDX)          43230018
432400         MOVE ASC-KEY-CARD-ID  TO RD022-CARD-ID (RD022-IDX)       43240018
432500         MOVE ASC-CRD-TYP-CDE  TO RD022-CARD-TYPE (RD022-IDX)     43250018
432600         MOVE ASC-CONTROL-NBR  TO RD022-CNTL-NBR                  43260018
432700                                                (RD022-IDX)       43270018
432800         MOVE LQW-TRN-AUTH-TMST (LQW-IDX)                         43280018
432900                               TO RD022-TRN-AUTH-TMST             43290018
433000                                    (RD022-IDX)                   43300018
433100         MOVE LQW-ACTIVITY-TYPE (LQW-IDX)                         43310018
433200                               TO RD022-ACTIVITY-TYPE             43320018
433300                                    (RD022-IDX)                   43330018
433400         MOVE LQW-POS-DATE-ISO (LQW-IDX)                          43340018
433500                               TO RD022-POS-DATE-ISO              43350018
433600                                    (RD022-IDX)                   43360018
433700         MOVE LQW-STORE-NBR (LQW-IDX)                             43370018
433800                               TO RD022-STORE-NBR                 43380018
433900                                    (RD022-IDX)                   43390018
434000         MOVE LQW-TERMINAL (LQW-IDX)                              43400018
434100                               TO RD022-TERMINAL                  43410018
434200                                    (RD022-IDX)                   43420018
434300         MOVE LQW-TRANSACTION (LQW-IDX)                           43430018
434400                               TO RD022-TRANSACTION               43440018
434500                                    (RD022-IDX)                   43450018
434600         MOVE ASC-AUTH-CODE    TO RD022-AUTH-RESPONSE-CDE         43460018
434700                                    (RD022-IDX)                   43470018
434800         MOVE ASC-DUPLICATE-FLAG                                  43480018
434900                               TO RD022-DUPLICATE-FLAG            43490018
435000                                    (RD022-IDX)                   43500018
435100         MOVE ASC-KEY-AMOUNT-REQUESTED                            43510018
435200                               TO RD022-AMT-REQUESTED             43520018
435300                                    (RD022-IDX)                   43530018
435400         MOVE ASC-APPROVED-TENDER-AMT                             43540018
435500                               TO RD022-APPROVED-AMT              43550018
435600                                    (RD022-IDX)                   43560018
435700         MOVE ASC-ORIGINAL-BALANCE                                43570018
435800                               TO RD022-ORIG-BALANCE              43580018
435900                                    (RD022-IDX)                   43590018
436000         MOVE SPACE            TO RD022-ACTION-SW (RD022-IDX)     43600018
436100         SET RD022-IDX UP BY 1                                    43610018
436200         IF  RD022-IDX > RD022-MAX-ITEMS                          43620018
436300             PERFORM 5205-WRITE-SEL-QUEUE                         43630018
436400             ADD +1            TO RD021-NUMBER-OF-TS-ITEMS        43640018
436500             INITIALIZE RD022-SELECTED-ITEM-ARRAY                 43650018
436600             SET RD022-IDX     TO  1                              43660018
436700         END-IF                                                   43670018
436800     END-IF.                                                      43680018
436900                                                                  43690018
437000*----------------------------------------------------------------*43700018
437100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *43710018
437200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *43720018
437300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *43730018
437400*  THE USER.                                                     *43740018
437500*----------------------------------------------------------------*43750018
437600 6000-REFRESH-PANEL-FROM-TEMP.                                    43760018
437700     IF  ASC-UPDATE-TSQ                                           43770018
437800         SET ASC-NO-TSQ-UPDATE     TO TRUE                        43780018
437900         MOVE ZERO                 TO PV-SAVE-ITEM                43790018
438000                                      PV-SEL-QUEUE-ITEM           43800018
438100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        43810018
438200                                   TO PV-HOLD-SELECTED-ITEMS      43820018
438300         MOVE +1                   TO PV-ITEMS-PROCESSED          43830018
438400         PERFORM 6100-UPDATE-TSQ                                  43840018
438500             UNTIL PV-ITEMS-PROCESSED >                           43850018
438600                                     PV-HOLD-SELECTED-ITEMS       43860018
438700         PERFORM 6010-DELETE-SEL-QUEUE                            43870018
438800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         43880018
438900                    ASC-BLOCK-ENTRIES (2)                         43890018
439000     END-IF.                                                      43900018
439100                                                                  43910018
439200*----------------------------------------------------------------*43920018
439300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *43930018
439400*----------------------------------------------------------------*43940018
439500 6010-DELETE-SEL-QUEUE.                                           43950018
439600                                                                  43960018
439700     EXEC CICS                                                    43970018
439800         DELETEQ TS                                               43980018
439900             QUEUE (ASC-SEL-QUEUE-NAME)                           43990018
440000             RESP  (PV-CICS-RESP)                                 44000018
440100     END-EXEC.                                                    44010018
440200                                                                  44020018
440300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      44030018
440400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         44040018
440500         CONTINUE                                                 44050018
440600     ELSE                                                         44060018
440700         SET DP013-CICS-ABEND  TO TRUE                            44070018
440800         SET DP013-NO-ROLLBACK TO TRUE                            44080018
440900         MOVE '6010-DELETE-SEL-QUEUE'                             44090018
441000                               TO DP013-PARAGRAPH                 44100018
441100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         44110018
441200                               TO DP013-MESSAGE-TEXT (1)          44120018
441300         PERFORM DP013-0000-PROCESS-ABEND                         44130018
441400     END-IF.                                                      44140018
441500                                                                  44150018
441600*----------------------------------------------------------------*44160018
441700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *44170018
441800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *44180018
441900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *44190018
442000*    THE TEMP QUEUE.                                             *44200018
442100*----------------------------------------------------------------*44210018
442200                                                                  44220018
442300 6100-UPDATE-TSQ.                                                 44230018
442400                                                                  44240018
442500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             44250018
442600     PERFORM 6105-READ-SEL-QUEUE.                                 44260018
442700     PERFORM                                                      44270018
442800         VARYING RD022-IDX                                        44280018
442900         FROM 1 BY 1                                              44290018
443000         UNTIL ((PV-ITEMS-PROCESSED >                             44300018
443100                              PV-HOLD-SELECTED-ITEMS)             44310018
443200         OR (RD022-IDX GREATER THAN RD022-MAX-ITEMS))             44320018
443300         IF  RD022-ACTION-SW (RD022-IDX) > SPACE                  44330018
443400             PERFORM 6110-PROCESS-ITEMS                           44340018
443500         END-IF                                                   44350018
443600         ADD +1                TO PV-ITEMS-PROCESSED              44360018
443700     END-PERFORM.                                                 44370018
443800     IF PV-SAVE-ITEM > 0                                          44380018
443900         PERFORM 6111-WRITE-LIST-QUEUE                            44390018
444000     END-IF.                                                      44400018
444100                                                                  44410018
444200*----------------------------------------------------------------*44420018
444300*    READ THE LIST QUEUE RECORD.                                 *44430018
444400*----------------------------------------------------------------*44440018
444500                                                                  44450018
444600 6105-READ-SEL-QUEUE.                                             44460018
444700                                                                  44470018
444800     EXEC CICS                                                    44480018
444900          READQ TS                                                44490018
445000              QUEUE (ASC-SEL-QUEUE-NAME)                          44500018
445100              INTO  (RD022-MESSAGE-SEL-REC)                       44510018
445200              ITEM  (PV-SEL-QUEUE-ITEM)                           44520018
445300              RESP  (PV-CICS-RESP)                                44530018
445400     END-EXEC.                                                    44540018
445500                                                                  44550018
445600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          44560018
445700         CONTINUE                                                 44570018
445800     ELSE                                                         44580018
445900         SET DP013-CICS-ABEND      TO  TRUE                       44590018
446000         SET DP013-NO-ROLLBACK     TO  TRUE                       44600018
446100         MOVE '6105-READ-SEL-QUEUE'                               44610018
446200                                   TO  DP013-PARAGRAPH            44620018
446300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           44630018
446400                                   TO  DP013-MESSAGE-TEXT(1)      44640018
446500         PERFORM DP013-0000-PROCESS-ABEND                         44650018
446600     END-IF.                                                      44660018
446700*----------------------------------------------------------------*44670018
446800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*44680018
446900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*44690018
447000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *44700018
447100*----------------------------------------------------------------*44710018
447200                                                                  44720018
447300 6110-PROCESS-ITEMS.                                              44730018
447400                                                                  44740018
447500     IF RD022-OVERRIDE-COMPLETE(RD022-IDX)                        44750018
447600         SET ASC-TRANS-COMPLETE TO TRUE                           44760018
447700         SET ASC-OVERRIDE-COMPLETE                                44770018
447800             ASC-DISPLAY-APPROVAL                                 44780018
447900                                TO TRUE                           44790018
448000         MOVE RD022-OVERRIDE-AMT(RD022-IDX)                       44800018
448100                                TO ASC-APPROVED-TENDER-AMT        44810018
448200         MOVE RD022-APPROVAL-NBR(RD022-IDX)                       44820018
448300                                TO ASC-APPROVAL-NUMBER            44830018
448400     END-IF.                                                      44840018
448500                                                                  44850018
448600     COMPUTE PV-ITEM = 1 + ((RD022-ITEM (RD022-IDX) - 1)          44860018
448700                     / PC-ITEMS-PER-PANEL).                       44870018
448800                                                                  44880018
448900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           44890018
449000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          44900018
449100             PERFORM 6111-WRITE-LIST-QUEUE                        44910018
449200         END-IF                                                   44920018
449300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    44930018
449400                                                                  44940018
449500         PERFORM 6112-READ-LIST-QUEUE                             44950018
449600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               44960018
449700             CONTINUE                                             44970018
449800         END-IF                                                   44980018
449900     END-IF.                                                      44990018
450000                                                                  45000018
450100     COMPUTE PV-SUB = (RD022-ITEM (RD022-IDX)                     45010018
450200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              45020018
450300     SET LQW-DESELECT (PV-SUB) TO    TRUE                         45030018
450400     MOVE LQW-SELECTED-SW (PV-SUB)                                45040018
450500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  45050018
450600                                                                  45060018
450700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                45070018
450800                                                                  45080018
450900*----------------------------------------------------------------*45090018
451000*    WRITE THE TS QUEUE RECORD JUST UPDATED.                     *45100018
451100*----------------------------------------------------------------*45110018
451200                                                                  45120018
451300 6111-WRITE-LIST-QUEUE.                                           45130018
451400                                                                  45140018
451500     EXEC CICS                                                    45150018
451600         WRITEQ TS                                                45160018
451700             QUEUE (ASC-LIST-QUEUE-NAME)                          45170018
451800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     45180018
451900             ITEM  (PV-SAVE-ITEM)                                 45190018
452000             REWRITE                                              45200018
452100             RESP  (PV-CICS-RESP)                                 45210018
452200     END-EXEC.                                                    45220018
452300                                                                  45230018
452400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          45240018
452500         CONTINUE                                                 45250018
452600     ELSE                                                         45260018
452700         SET DP013-CICS-ABEND  TO  TRUE                           45270018
452800         SET DP013-NO-ROLLBACK TO  TRUE                           45280018
452900         MOVE '6111-WRITE-LIST-QUEUE'                             45290018
453000                               TO  DP013-PARAGRAPH                45300018
453100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  45310018
453200                               TO  DP013-MESSAGE-TEXT(1)          45320018
453300         PERFORM DP013-0000-PROCESS-ABEND                         45330018
453400     END-IF.                                                      45340018
453500                                                                  45350018
453600*----------------------------------------------------------------*45360018
453700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*45370018
453800*----------------------------------------------------------------*45380018
453900                                                                  45390018
454000 6112-READ-LIST-QUEUE.                                            45400018
454100                                                                  45410018
454200     EXEC CICS                                                    45420018
454300         READQ TS                                                 45430018
454400             QUEUE (ASC-LIST-QUEUE-NAME)                          45440018
454500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     45450018
454600             ITEM  (PV-ITEM)                                      45460018
454700             RESP  (PV-CICS-RESP)                                 45470018
454800     END-EXEC.                                                    45480018
454900                                                                  45490018
455000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          45500018
455100         CONTINUE                                                 45510018
455200     ELSE                                                         45520018
455300         SET DP013-CICS-ABEND        TO TRUE                      45530018
455400         SET DP013-NO-ROLLBACK       TO TRUE                      45540018
455500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           45550018
455600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    45560018
455700                                     TO DP013-MESSAGE-TEXT(1)     45570018
455800         PERFORM DP013-0000-PROCESS-ABEND                         45580018
455900     END-IF.                                                      45590018
456000                                                                  45600018
456100*----------------------------------------------------------------*45610018
456200*    1.) VOID REQUEST:                                           *45620018
456300*       FOR VOIDS DONE THROUGH THE REFERRAL (LOSS PREVENTION)    *45630018
456400*       MENU:                                                    *45640018
456500*          A.) EDIT THE TRANSACTION WHICH WAS SELECTED TO BE     *45650018
456600*              VOIDED.  (FIND THE SELECTED TRANSACTION AND MAKE  *45660018
456700*              SURE IT HAS NOT ALREADY BEEN VOIDED.)             *45670018
456800*       FOR VOIDS DONE THROUGH THE AUDIT MENU:                   *45680018
456900*          A.) NO EDITS ARD DONE.                                *45690018
457000*                                                                *45700018
457100*    2.) REVERSE VOID REQUEST:                                   *45710018
457200*          A.) EDIT THE TRANSACTION WHICH WAS SELECTED TO HAVE   *45720018
457300*              THE VOID "UNDONE".  (FIND THE SELECTED TRANSACTION*45730018
457400*              AND MAKE SURE IT HAS BEEN VOIDED.)                *45740018
457500*----------------------------------------------------------------*45750018
457600 7000-EDIT-SELECTED-FUNCTION.                                     45760018
457700                                                                  45770018
457800     EVALUATE TRUE                                                45780018
457900                                                                  45790018
458000       WHEN PS-VOID-REQUEST                                       45800018
458100           PERFORM 7100-FIND-SELECTED-VOID                        45810018
458200                                                                  45820018
458300       WHEN PS-REV-VOID-REQUEST                                   45830018
458400           PERFORM 7200-FIND-SELECTED-REV-VOID                    45840018
458500                                                                  45850018
458600     END-EVALUATE.                                                45860018
458700                                                                  45870018
458800*----------------------------------------------------------------*45880018
458900*    FINDS SELECTED ITEM TO BE VOIDED, AND EDITS IT.             *45890018
459000*    NOTE:  THIS PARAGRAPH FOLLOWS SIMILAR LOGIC AS 'SELECT-     *45900018
459100*           ALL-ITEMS' AND 'DESELECT-ALL-ITEMS'.                 *45910018
459200*----------------------------------------------------------------*45920018
459300                                                                  45930018
459400 7100-FIND-SELECTED-VOID.                                         45940018
459500                                                                  45950018
459600     COMPUTE PV-BOTTOM-ITEM =                                     45960018
459700         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    45970018
459800                                                                  45980018
459900     MOVE +1                       TO ASC-BLK-SUB.                45990018
460000                                                                  46000018
460100     PERFORM                                                      46010018
460200         VARYING ASC-ITEM-SUB                                     46020018
460300         FROM 1 BY 1                                              46030018
460400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  46040018
460500                                                                  46050018
460600         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 46060018
460700             PERFORM 7110-EDIT-VOID-LINE                          46070018
460800         END-IF                                                   46080018
460900     END-PERFORM.                                                 46090018
461000                                                                  46100018
461100     ADD +1                        TO ASC-BLK-SUB.                46110018
461200                                                                  46120018
461300     PERFORM                                                      46130018
461400         VARYING ASC-ITEM-SUB                                     46140018
461500         FROM 1 BY 1                                              46150018
461600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  46160018
461700                                                                  46170018
461800         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 46180018
461900             PERFORM 7110-EDIT-VOID-LINE                          46190018
462000         END-IF                                                   46200018
462100     END-PERFORM.                                                 46210018
462200                                                                  46220018
462300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               46230018
462400                                   TO PV-LIST-ITEM-NUMBER.        46240018
462500                                                                  46250018
462600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            46260018
462700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    46270018
462800                                                                  46280018
462900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     46290018
463000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    46300018
463100         MOVE +1                   TO ASC-BLK-SUB                 46310018
463200                                                                  46320018
463300         PERFORM 5100-WRITE-TEMP-STORAGE                          46330018
463400                                                                  46340018
463500         MOVE +1                   TO PV-BLOCK-NUMBER             46350018
463600                                                                  46360018
463700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         46370018
463800             PV-FIRST-BLOCK-IN-ARRAY - 1                          46380018
463900                                                                  46390018
464000         PERFORM                                                  46400018
464100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       46410018
464200                                                                  46420018
464300             PERFORM 4410-READ-TEMP-STORAGE                       46430018
464400                                                                  46440018
464500             PERFORM                                              46450018
464600                 VARYING ASC-ITEM-SUB                             46460018
464700                 FROM 1 BY 1                                      46470018
464800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          46480018
464900                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     46490018
465000                         PERFORM 7110-EDIT-VOID-LINE              46500018
465100                     END-IF                                       46510018
465200             END-PERFORM                                          46520018
465300                                                                  46530018
465400             PERFORM 5100-WRITE-TEMP-STORAGE                      46540018
465500                                                                  46550018
465600             ADD +1                TO PV-BLOCK-NUMBER             46560018
465700                                                                  46570018
465800         END-PERFORM                                              46580018
465900                                                                  46590018
466000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         46600018
466100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     46610018
466200                                                                  46620018
466300         PERFORM                                                  46630018
466400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       46640018
466500                   ASC-HIGHEST-BLOCK-WRITTEN                      46650018
466600                                                                  46660018
466700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          46670018
466800                                   TO PV-BLOCK-NUMBER             46680018
466900                                                                  46690018
467000             PERFORM 4410-READ-TEMP-STORAGE                       46700018
467100                                                                  46710018
467200             PERFORM                                              46720018
467300                 VARYING ASC-ITEM-SUB                             46730018
467400                 FROM 1 BY 1                                      46740018
467500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          46750018
467600                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     46760018
467700                         PERFORM 7110-EDIT-VOID-LINE              46770018
467800                     END-IF                                       46780018
467900             END-PERFORM                                          46790018
468000                                                                  46800018
468100             PERFORM 5100-WRITE-TEMP-STORAGE                      46810018
468200                                                                  46820018
468300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      46830018
468400                                                                  46840018
468500         END-PERFORM                                              46850018
468600                                                                  46860018
468700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             46870018
468800                                   TO PV-BLOCK-NUMBER             46880018
468900                                                                  46890018
469000         PERFORM 4410-READ-TEMP-STORAGE                           46900018
469100     END-IF.                                                      46910018
469200                                                                  46920018
469300*----------------------------------------------------------------*46930018
469400*    EDITS THE SELECTED LINE TO SEE IF IT IS OK TO VOID.         *46940018
469500*    1)  FOR REFERRAL AND AUDIT USERS:                           *46950018
469600*        -- IF IT IS THE FIRST LINE (CURRENT TRANSACTION) WHICH  *46960018
469700*           IS STILL PENDING, IT CANNOT BE VOIDED UNTIL THE      *46970018
469800*           TRANSACTION IS COMPLETE.                             *46980018
469900*    2)  FOR REFERRAL (LOSS PREVENTION) USERS:                   *46990018
470000*        -- IF TRANSACTION IS ALREADY VOIDED, IT IS AN ERROR.    *47000018
470100*    3)  FOR AUDIT USERS:                                        *47010018
470200*        A) IF TRANSACTION IS ALREADY VOIDED, IT IS ASSUMED THAT *47020018
470300*           THEY WANT TO SETTLE IT:                              *47030018
470400*           -- IF IT IS ALREADY SETTLED (STATUS 2 OR 3), IT IS   *47040018
470500*              AN ERROR.                                         *47050018
470600*        B) IF TRANSACTION HAS NOT BEEN VOIDED, IT IS ASSUMED    *47060018
470700*           THAT THEY WANT TO VOID IT:                           *47070018
470800*           -- IF THEY ARE AUTHORIZED TO INSERT, THEY CAN GO     *47080018
470900*              AHEAD, OTHERWISE IT IS AN ERROR.                  *47090018
471000*----------------------------------------------------------------*47100018
471100                                                                  47110018
471200 7110-EDIT-VOID-LINE.                                             47120018
471300                                                                  47130018
471400     SET ASC-NO-VOID-ERROR TO TRUE.                               47140018
471500     MOVE ZERO TO ASC-VOID-MSG-NBR.                               47150018
471600                                                                  47160018
471700     IF  (ASC-FORMAT-IND = PC-REFERRAL-FORMAT                     47170018
471800       OR ASC-FORMAT-IND = PC-AUDIT-FORMAT)                       47180018
471900       AND ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) = 1    47190018
472000       AND ASC-TRANS-NOT-COMPLETE                                 47200018
472100         IF ASC-AUDIT-UPDATE                                      47210018
472200*        --- MUST UPDATE TRANS BEFORE VOIDING IT ---              47220018
472300             MOVE PC-TSYMSG-01281  TO DP020-MSG-NUMBER            47230018
472400                                      ASC-VOID-MSG-NBR            47240018
472500             SET DP020-MSG-FATAL   TO TRUE                        47250018
472600             SET ASC-VOID-ERROR    TO TRUE                        47260018
472700             SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)        47270018
472800                               TO TRUE                            47280018
472900             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 47290018
473000                               TO TRUE                            47300018
473100             PERFORM 5100-WRITE-TEMP-STORAGE                      47310018
473200         ELSE                                                     47320018
473300*        --- MUST ADD TRANS BEFORE VOIDING IT ---                 47330018
473400             MOVE PC-TSYMSG-01280  TO DP020-MSG-NUMBER            47340018
473500                                      ASC-VOID-MSG-NBR            47350018
473600             SET DP020-MSG-FATAL   TO TRUE                        47360018
473700             SET ASC-VOID-ERROR    TO TRUE                        47370018
473800             SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)        47380018
473900                               TO TRUE                            47390018
474000             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 47400018
474100                               TO TRUE                            47410018
474200             PERFORM 5100-WRITE-TEMP-STORAGE                      47420018
474300         END-IF                                                   47430018
474400     END-IF.                                                      47440018
474500                                                                  47450018
474600     IF ASC-NO-VOID-ERROR                                         47460018
474700       EVALUATE TRUE                                              47470018
474800         WHEN ASC-FORMAT-IND = PC-REFER-VOID-FORMAT               47480018
474900         WHEN ASC-FORMAT-IND = PC-REFERRAL-FORMAT                 47490018
475000                                                                  47500018
475100             PERFORM 7112-EDIT-REFER-VOID                         47510018
475200                                                                  47520018
475300         WHEN ASC-FORMAT-IND = PC-AUDIT-VOID-FORMAT               47530018
475400         WHEN ASC-FORMAT-IND = PC-AUDIT-FORMAT                    47540018
475500                                                                  47550018
475600             PERFORM 7114-EDIT-AUDIT-VOID                         47560018
475700                                                                  47570018
475800       END-EVALUATE                                               47580018
475900     END-IF.                                                      47590018
476000                                                                  47600018
476100     IF ASC-VOID-ERROR                                            47610018
476200         SET ASC-NO-VOID-REQUEST       TO TRUE                    47620018
476300     ELSE                                                         47630018
476400         SET ASC-VOID-REQUEST-OK       TO TRUE                    47640018
476500*        --- PRESS 'VOID' KEY AGAIN    TO CONFIRM VOID ---        47650018
476600         MOVE PC-TSYMSG-01235          TO DP020-MSG-NUMBER        47660018
476700         SET DP020-MSG-INFORMATIONAL                              47670018
476800                                       TO TRUE                    47680018
476900     END-IF.                                                      47690018
477000                                                                  47700018
477100 7112-EDIT-REFER-VOID.                                            47710018
477200                                                                  47720018
477300     IF ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB)                   47730018
477400                               = SV004-VOID-TRANS                 47740018
477500*        --- TRANSACTION HAS ALREADY BEEN VOIDED ---              47750018
477600         MOVE PC-TSYMSG-01236  TO DP020-MSG-NUMBER                47760018
477700                                  ASC-VOID-MSG-NBR                47770018
477800         SET DP020-MSG-FATAL   TO TRUE                            47780018
477900         SET ASC-VOID-ERROR    TO TRUE                            47790018
478000         SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)            47800018
478100                               TO TRUE                            47810018
478200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     47820018
478300                               TO TRUE                            47830018
478400         PERFORM 5100-WRITE-TEMP-STORAGE                          47840018
478500     ELSE                                                         47850018
478600         SET DP008-RSRC-TYPE-FUNC  TO  TRUE                       47860021
478700         MOVE PC-VOID-AUTH         TO  DP008-RESOURCE-NAME        47870021
478800         SET DP008-ACCESS-TYPE-USE TO  TRUE                       47880021
478900         EXEC CICS                                                47890021
479000              LINK                                                47900021
479100                 PROGRAM  (DP008-SECURITY-SUBROUTINE)             47910021
479200                 COMMAREA (DP008-SECURITY-COMMAREA)               47920021
479300                 LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)        47930021
479400                 RESP     (PV-RESP)                               47940021
479500         END-EXEC                                                 47950021
479600         IF  PV-RESP NOT = DFHRESP(NORMAL)                        47960021
479700*            --- BAD LINK TO SECURITY MODULE ---                  47970021
479800             MOVE PC-TSYMSG-00233  TO DP020-MSG-NUMBER            47980021
479900                                      ASC-VOID-MSG-NBR            47990021
480000             SET DP020-MSG-FATAL   TO TRUE                        48000021
480100             SET ASC-VOID-ERROR    TO TRUE                        48010021
480200             SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)        48020021
480300                               TO TRUE                            48030021
480400             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 48040021
480500                               TO TRUE                            48050021
480600             PERFORM 5100-WRITE-TEMP-STORAGE                      48060021
480700         ELSE                                                     48070021
480800             IF  DP008-ACCESS-ALLOWED                             48080021
480900                 SET ASC-NO-VOID-ERROR TO TRUE                    48090021
481000             ELSE                                                 48100021
481100*                --- USERID DOES NOT HAVE AUTHORITY TO VOID       48110021
481200*                    ACTIVITY ---                                 48120021
481300                 MOVE PC-TSYMSG-03762                             48130021
481400                                   TO DP020-MSG-NUMBER            48140021
481500                                      ASC-VOID-MSG-NBR            48150021
481600                 SET DP020-MSG-FATAL                              48160021
481700                                    TO TRUE                       48170021
481800                 SET ASC-VOID-ERROR TO TRUE                       48180021
481900                 SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)    48190021
482000                                   TO TRUE                        48200021
482100                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             48210021
482200                                   TO TRUE                        48220021
482300                 PERFORM 5100-WRITE-TEMP-STORAGE                  48230021
482400             END-IF                                               48240021
482500         END-IF                                                   48250021
482600     END-IF.                                                      48260018
482700                                                                  48270018
482800 7114-EDIT-AUDIT-VOID.                                            48280018
482900                                                                  48290018
483000     EVALUATE TRUE                                                48300018
483100       WHEN ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB)               48310018
483200                               = SV004-VOID-TRANS                 48320018
483300                                                                  48330018
483400         IF ASC-ACTIVITY-STAT-CDE (ASC-BLK-SUB ASC-ITEM-SUB)      48340018
483500                               = SV004-STAT-AUTH-RECEIVED-CD      48350018
483600             CONTINUE                                             48360018
483700         ELSE                                                     48370018
483800*            --- TRANSACTION WAS ALREADY VERIFIED,                48380018
483900*                UPDATE NOT ALLOWED ---                           48390018
484000             MOVE PC-TSYMSG-01230  TO DP020-MSG-NUMBER            48400018
484100                                      ASC-VOID-MSG-NBR            48410018
484200             SET DP020-MSG-FATAL   TO TRUE                        48420018
484300             SET ASC-VOID-ERROR    TO TRUE                        48430018
484400             SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)        48440018
484500                               TO TRUE                            48450018
484600             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 48460018
484700                               TO TRUE                            48470018
484800             PERFORM 5100-WRITE-TEMP-STORAGE                      48480018
484900         END-IF                                                   48490018
485000                                                                  48500018
485100       WHEN ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB)               48510018
485200                               = SV004-NOT-VOID-TRANS             48520018
485300                                                                  48530018
485400         SET DP008-RSRC-TYPE-FUNC  TO  TRUE                       48540018
485500         MOVE PC-VOID-AUTH         TO  DP008-RESOURCE-NAME        48550019
485600         SET DP008-ACCESS-TYPE-USE TO  TRUE                       48560018
485700         EXEC CICS                                                48570018
485800              LINK                                                48580018
485900                 PROGRAM  (DP008-SECURITY-SUBROUTINE)             48590018
486000                 COMMAREA (DP008-SECURITY-COMMAREA)               48600018
486100                 LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)        48610018
486200                 RESP     (PV-RESP)                               48620018
486300         END-EXEC                                                 48630018
486400         IF  PV-RESP NOT = DFHRESP(NORMAL)                        48640018
486500*            --- BAD LINK TO SECURITY MODULE ---                  48650018
486600             MOVE PC-TSYMSG-00233  TO DP020-MSG-NUMBER            48660018
486700                                      ASC-VOID-MSG-NBR            48670018
486800             SET DP020-MSG-FATAL   TO TRUE                        48680018
486900             SET ASC-VOID-ERROR    TO TRUE                        48690018
487000             SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)        48700018
487100                               TO TRUE                            48710018
487200             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 48720018
487300                               TO TRUE                            48730018
487400             PERFORM 5100-WRITE-TEMP-STORAGE                      48740018
487500         ELSE                                                     48750018
487600             IF  DP008-ACCESS-ALLOWED                             48760018
487700                 CONTINUE                                         48770018
487800             ELSE                                                 48780018
487900*                --- USERID DOES NOT HAVE AUTHORITY TO VOID       48790020
488000*                    ACTIVITY ---                                 48800020
488100                 MOVE PC-TSYMSG-03762                             48810020
488200                                   TO DP020-MSG-NUMBER            48820018
488300                                      ASC-VOID-MSG-NBR            48830018
488400                 SET DP020-MSG-FATAL                              48840018
488500                                    TO TRUE                       48850018
488600                 SET ASC-VOID-ERROR TO TRUE                       48860018
488700                 SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)    48870018
488800                                   TO TRUE                        48880018
488900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             48890018
489000                                   TO TRUE                        48900018
489100                 PERFORM 5100-WRITE-TEMP-STORAGE                  48910018
489200             END-IF                                               48920018
489300         END-IF                                                   48930018
489400                                                                  48940018
489500     END-EVALUATE.                                                48950018
489600                                                                  48960018
489700*----------------------------------------------------------------*48970018
489800*    FINDS SELECTED ITEM TO PERFORM THE REVERSE VOID ON.         *48980018
489900*    NOTE:  THIS PARAGRAPH FOLLOWS SIMILAR LOGIC AS 'SELECT-     *48990018
490000*           ALL-ITEMS' AND 'DESELECT-ALL-ITEMS'.                 *49000018
490100*----------------------------------------------------------------*49010018
490200 7200-FIND-SELECTED-REV-VOID.                                     49020018
490300                                                                  49030018
490400     COMPUTE PV-BOTTOM-ITEM =                                     49040018
490500         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    49050018
490600                                                                  49060018
490700     MOVE +1                       TO ASC-BLK-SUB.                49070018
490800                                                                  49080018
490900     PERFORM                                                      49090018
491000         VARYING ASC-ITEM-SUB                                     49100018
491100         FROM 1 BY 1                                              49110018
491200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  49120018
491300                                                                  49130018
491400         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 49140018
491500             PERFORM 7210-EDIT-REVERSE-VOID-LINE                  49150018
491600         END-IF                                                   49160018
491700     END-PERFORM.                                                 49170018
491800                                                                  49180018
491900     ADD +1                        TO ASC-BLK-SUB.                49190018
492000                                                                  49200018
492100     PERFORM                                                      49210018
492200         VARYING ASC-ITEM-SUB                                     49220018
492300         FROM 1 BY 1                                              49230018
492400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  49240018
492500                                                                  49250018
492600         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 49260018
492700             PERFORM 7210-EDIT-REVERSE-VOID-LINE                  49270018
492800         END-IF                                                   49280018
492900     END-PERFORM.                                                 49290018
493000                                                                  49300018
493100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               49310018
493200                                   TO PV-LIST-ITEM-NUMBER.        49320018
493300                                                                  49330018
493400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            49340018
493500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    49350018
493600                                                                  49360018
493700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     49370018
493800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    49380018
493900         MOVE +1                   TO ASC-BLK-SUB                 49390018
494000                                                                  49400018
494100         PERFORM 5100-WRITE-TEMP-STORAGE                          49410018
494200                                                                  49420018
494300         MOVE +1                   TO PV-BLOCK-NUMBER             49430018
494400                                                                  49440018
494500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         49450018
494600             PV-FIRST-BLOCK-IN-ARRAY - 1                          49460018
494700                                                                  49470018
494800         PERFORM                                                  49480018
494900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       49490018
495000                                                                  49500018
495100             PERFORM 4410-READ-TEMP-STORAGE                       49510018
495200                                                                  49520018
495300             PERFORM                                              49530018
495400                 VARYING ASC-ITEM-SUB                             49540018
495500                 FROM 1 BY 1                                      49550018
495600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          49560018
495700                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     49570018
495800                         PERFORM 7210-EDIT-REVERSE-VOID-LINE      49580018
495900                     END-IF                                       49590018
496000             END-PERFORM                                          49600018
496100                                                                  49610018
496200             PERFORM 5100-WRITE-TEMP-STORAGE                      49620018
496300                                                                  49630018
496400             ADD +1                TO PV-BLOCK-NUMBER             49640018
496500                                                                  49650018
496600         END-PERFORM                                              49660018
496700                                                                  49670018
496800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         49680018
496900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     49690018
497000                                                                  49700018
497100         PERFORM                                                  49710018
497200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       49720018
497300                   ASC-HIGHEST-BLOCK-WRITTEN                      49730018
497400                                                                  49740018
497500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          49750018
497600                                   TO PV-BLOCK-NUMBER             49760018
497700                                                                  49770018
497800             PERFORM 4410-READ-TEMP-STORAGE                       49780018
497900                                                                  49790018
498000             PERFORM                                              49800018
498100                 VARYING ASC-ITEM-SUB                             49810018
498200                 FROM 1 BY 1                                      49820018
498300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          49830018
498400                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     49840018
498500                         PERFORM 7210-EDIT-REVERSE-VOID-LINE      49850018
498600                     END-IF                                       49860018
498700             END-PERFORM                                          49870018
498800                                                                  49880018
498900             PERFORM 5100-WRITE-TEMP-STORAGE                      49890018
499000                                                                  49900018
499100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      49910018
499200                                                                  49920018
499300         END-PERFORM                                              49930018
499400                                                                  49940018
499500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             49950018
499600                                   TO PV-BLOCK-NUMBER             49960018
499700                                                                  49970018
499800         PERFORM 4410-READ-TEMP-STORAGE                           49980018
499900     END-IF.                                                      49990018
500000                                                                  50000018
500100*----------------------------------------------------------------*50010018
500200*    CONTROL THE EDITS ON THE LINE TO HAVE THE REVERSE VOID.     *50020018
500300*----------------------------------------------------------------*50030018
500400 7210-EDIT-REVERSE-VOID-LINE.                                     50040018
500500                                                                  50050018
500600     SET ASC-NO-VOID-ERROR TO TRUE.                               50060018
500700     MOVE ZERO TO ASC-VOID-MSG-NBR.                               50070018
500800                                                                  50080018
500900     IF ASC-NO-REVERSE-VOID-REQUEST                               50090018
501000       PERFORM 7212-REV-VOID-AUTHORIZATION                        50100018
501100     END-IF.                                                      50110018
501200                                                                  50120018
501300     IF ASC-NO-VOID-ERROR                                         50130018
501400       PERFORM 7214-REV-VOID-BEEN-VOIDED                          50140018
501500     END-IF.                                                      50150018
501600                                                                  50160018
501700     IF ASC-VOID-ERROR                                            50170018
501800         SET ASC-NO-REVERSE-VOID-REQUEST TO TRUE                  50180018
501900     ELSE                                                         50190018
502000         SET ASC-REVERSE-VOID-REQUEST-OK TO TRUE                  50200018
502100*        --- PRESS 'REV VOID' KEY AGAIN TO CONFIRM ---            50210018
502200         MOVE PC-TSYMSG-01695          TO DP020-MSG-NUMBER        50220018
502300         SET DP020-MSG-INFORMATIONAL                              50230018
502400                                       TO TRUE                    50240018
502500         SET ASC-HILITE-LINE-YL (ASC-BLK-SUB ASC-ITEM-SUB)        50250018
502600                                       TO TRUE                    50260018
502700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     50270018
502800                                       TO TRUE                    50280018
502900                                                                  50290018
503000*        THESE FIELDS ARE SAVED TO BE USED LATER IN LOCATING      50300018
503100*        THE CORRESPONDING TRANSACTION SO THAT IT CAN BE HILIGHTED50310018
503200         IF ASC-REVERSAL-IND    (ASC-BLK-SUB ASC-ITEM-SUB)        50320018
503300                                = SV004-REV-CDE-NORMAL            50330018
503400           MOVE SV004-REV-CDE-REVERSAL TO ASC-HLD-REVERSAL-IND    50340018
503500         ELSE                                                     50350018
503600           MOVE SV004-REV-CDE-NORMAL   TO ASC-HLD-REVERSAL-IND    50360018
503700         END-IF                                                   50370018
503800                                                                  50380018
503900         COMPUTE ASC-HLD-TRANS-AMOUNT =                           50390018
504000              ASC-AMOUNT (ASC-BLK-SUB ASC-ITEM-SUB) * -1          50400018
504100                                                                  50410018
504200         MOVE ASC-KEY-CARD-ID TO ASC-HLD-CARD-ID                  50420018
504300         MOVE ASC-ACTIVITY-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)        50430018
504400                                TO ASC-HLD-ACTIVITY-TYPE          50440018
504500         MOVE ASC-POS-DATE-ISO  (ASC-BLK-SUB ASC-ITEM-SUB)        50450018
504600                                TO ASC-HLD-POS-DATE-ISO           50460018
504700         MOVE ASC-STORE-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)        50470018
504800                                TO ASC-HLD-STORE-NBR              50480018
504900         MOVE ASC-TERMINAL      (ASC-BLK-SUB ASC-ITEM-SUB)        50490018
505000                                TO ASC-HLD-TERMINAL               50500018
505100         MOVE ASC-TRANSACTION   (ASC-BLK-SUB ASC-ITEM-SUB)        50510018
505200                                TO ASC-HLD-TRANSACTION            50520018
505300     END-IF.                                                      50530018
505400                                                                  50540018
505500*----------------------------------------------------------------*50550018
505600*    VERIFY THE USER HAS AUTHORITY TO PERFORM A REV VOID.        *50560018
505700*----------------------------------------------------------------*50570018
505800 7212-REV-VOID-AUTHORIZATION.                                     50580018
505900                                                                  50590018
506000     SET DP008-RSRC-TYPE-FUNC  TO  TRUE.                          50600018
506100     MOVE PC-REV-VOID-AUTH     TO  DP008-RESOURCE-NAME.           50610018
506200     SET DP008-ACCESS-TYPE-USE TO  TRUE.                          50620018
506300                                                                  50630018
506400     EXEC CICS                                                    50640018
506500         LINK                                                     50650018
506600           PROGRAM  (DP008-SECURITY-SUBROUTINE)                   50660018
506700           COMMAREA (DP008-SECURITY-COMMAREA)                     50670018
506800           LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)              50680018
506900           RESP     (PV-RESP)                                     50690018
507000     END-EXEC.                                                    50700018
507100                                                                  50710018
507200     IF PV-RESP NOT = DFHRESP(NORMAL)                             50720018
507300*  --- BAD LINK TO SECURITY MODULE ---                            50730018
507400       MOVE PC-TSYMSG-00233  TO DP020-MSG-NUMBER                  50740018
507500                                ASC-VOID-MSG-NBR                  50750018
507600       SET DP020-MSG-FATAL   TO TRUE                              50760018
507700       SET ASC-VOID-ERROR    TO TRUE                              50770018
507800       SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)              50780018
507900                             TO TRUE                              50790018
508000       SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                       50800018
508100                             TO TRUE                              50810018
508200       PERFORM 5100-WRITE-TEMP-STORAGE                            50820018
508300     ELSE                                                         50830018
508400       IF DP008-ACCESS-ALLOWED                                    50840018
508500         CONTINUE                                                 50850018
508600       ELSE                                                       50860018
508700*   --- USERID DOES NOT HAVE AUTHORITY ---                        50870018
508800*   --- TO PERFORM A REVERSE VOID ---                             50880018
508900         MOVE PC-TSYMSG-99910 TO DP020-MSG-NUMBER                 50890018
509000                                 ASC-VOID-MSG-NBR                 50900018
509100         SET DP020-MSG-FATAL  TO TRUE                             50910018
509200         SET ASC-VOID-ERROR   TO TRUE                             50920018
509300         SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)            50930018
509400                              TO TRUE                             50940018
509500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     50950018
509600                              TO TRUE                             50960018
509700         PERFORM 5100-WRITE-TEMP-STORAGE                          50970018
509800       END-IF                                                     50980018
509900     END-IF.                                                      50990018
510000                                                                  51000018
510100*----------------------------------------------------------------*51010018
510200*    VERIFY THE LINE HAS ALREADY BEEN VOIDED.                    *51020018
510300*----------------------------------------------------------------*51030018
510400 7214-REV-VOID-BEEN-VOIDED.                                       51040018
510500                                                                  51050018
510600     IF ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB) NOT               51060018
510700                               = SV004-VOID-TRANS                 51070018
510800*        --- TRANSACTION HAS NOT BEEN VOIDED ---                  51080018
510900         MOVE PC-TSYMSG-01696  TO DP020-MSG-NUMBER                51090018
511000                                  ASC-VOID-MSG-NBR                51100018
511100         SET DP020-MSG-FATAL   TO TRUE                            51110018
511200         SET ASC-VOID-ERROR    TO TRUE                            51120018
511300         SET ASC-HILITE-SEL (ASC-BLK-SUB ASC-ITEM-SUB)            51130018
511400                               TO TRUE                            51140018
511500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     51150018
511600                               TO TRUE                            51160018
511700         PERFORM 5100-WRITE-TEMP-STORAGE                          51170018
511800     END-IF.                                                      51180018
511900*----------------------------------------------------------------*51190018
512000 7300-TB-CONTROL-NBR.                                             51200018
512100     MOVE SVT00001-CRD-PROD-YR   TO TB-CRD-PROD-YR9.              51210018
512200     MOVE SVT00001-SHIPT-REQ-NBR TO TB-SHIPT-REQ-NBR9.            51220018
512300     MOVE SVT00001-CNTL-NBR      TO TB-CNTL-NBR9.                 51230018
512400                                                                  51240018
512500*----------------------------------------------------------------*51250000
512600*    PERFORM AN UPDATE FROM THE AUDIT SCREEN.                    *51260000
512700*----------------------------------------------------------------*51270000
512800 8100-AUDIT-UPDATE.                                               51280000
512900                                                                  51290000
513000     MOVE ASC-KEY-CARD-ID          TO DK-CARD-ID.                 51300018
513100     MOVE ASC-SAVE-TIMESTAMP       TO DK-TRN-AUTH-TMST.           51310000
513200     EXEC SQL                                                     51320000
513300         UPDATE SVT_KOHLS_CRD_TXN                                 51330018
513400         SET ACTVY_STAT_CDE = :SV004-STAT-VERIFIED-CD             51340018
513500          WHERE CRD_NBR       = :DK-CARD-ID                       51350000
513600            AND TRN_AUTH_TMST = :DK-TRN-AUTH-TMST                 51360000
513700     END-EXEC.                                                    51370000
513800                                                                  51380000
513900     EVALUATE TRUE                                                51390000
514000         WHEN SQLCODE = +0                                        51400000
514100             PERFORM 9000-DELETE-LOCK                             51410018
514200             SET ASC-TRANS-COMPLETE                               51420018
514300                              TO TRUE                             51430000
514400*            --- UPDATE SUCCESSFUL ---                            51440000
514500             MOVE PC-TSYMSG-00059                                 51450000
514600                              TO DP020-MSG-NUMBER                 51460000
514700             SET DP020-MSG-INFORMATIONAL                          51470000
514800                              TO TRUE                             51480000
514900                                                                  51490018
515000         WHEN OTHER                                               51500018
515100             PERFORM 9000-DELETE-LOCK                             51510018
515200             MOVE '8100-AUDIT-UPDATE'                             51520000
515300                              TO DP013-PARAGRAPH                  51530000
515400             MOVE 'UPDATE ACTIVITY STATUS'                        51540000
515500                              TO DP013-MESSAGE-TEXT (1)           51550000
515600             MOVE SQLCA       TO DP013-SQLCA                      51560000
515700             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1) 51570018
515800             SET DP013-DB2-ABEND                                  51580000
515900                              TO TRUE                             51590000
516000             SET DP013-XCTL-DISPLAY-RESTART                       51600000
516100                              TO TRUE                             51610000
516200             PERFORM DP013-0000-PROCESS-ABEND                     51620000
516300                                                                  51630018
516400     END-EVALUATE.                                                51640000
516500                                                                  51650000
516600*----------------------------------------------------------------*51660000
516700*    PERFORM AN INSERT FROM THE AUDIT SCREEN.                    *51670000
516800*----------------------------------------------------------------*51680000
516900                                                                  51690000
517000 8200-AUDIT-INSERT.                                               51700000
517100                                                                  51710000
517200     MOVE ASC-KEY-CARD-ID      TO SVT00002-CRD-NBR.               51720018
517300*    MOVE ASC-KEY-DRIVERS-LICENSE                                 51730031
517400*                              TO SVT00002-DRV-LIC-NBR.           51740031
517500     IF ASC-KEY-DRIVERS-LICENSE > SPACES                          51750031
517600        MOVE ASC-KEY-DRIVERS-LICENSE                              51760031
517700                               TO SVT00002-DRV-LIC-NBR            51770031
517800     ELSE                                                         51780031
517900        PERFORM 8400-DL-ROUTINE                                   51790031
518000        MOVE RDT00004-DRVR-LIC-NBR-TEXT                           51800031
518100                                  (1:RDT00004-DRVR-LIC-NBR-LEN)   51810031
518200                               TO SVT00002-DRV-LIC-NBR            51820031
518300     END-IF.                                                      51830031
518400     MOVE SV004-REV-CDE-NORMAL TO SVT00002-TRN-RVRSL-CDE.         51840018
518500     MOVE SV004-NOT-VOID-TRANS TO SVT00002-TRN-VOID-IND.          51850018
518600     MOVE ASC-KEY-ACTIVITY-TYPE                                   51860000
518700                               TO SVT00002-ACTVY-TYP-CDE.         51870018
518800     MOVE ASC-KEY-POS-DATE-ISO TO SVT00002-POS-DTE.               51880018
518900     MOVE ASC-KEY-STORE-NBR    TO SVT00002-STR-NBR.               51890018
519000     MOVE SVT00002-STR-NBR TO DK-STORE-NBR.                       51900018
519100     PERFORM 8550-GET-STATE-CODE.                                 51910018
519200     MOVE ASC-KEY-TERMINAL     TO SVT00002-POS-TRMNL-NBR.         51920018
519300     MOVE ASC-KEY-TRANSACTION  TO SVT00002-POS-TRN-NBR.           51930018
519400                                                                  51940018
519500     IF ASC-KEY-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP              51950018
519600         MULTIPLY -1 BY ASC-KEY-AMOUNT-REQUESTED                  51960000
519700                               GIVING SVT00002-APP-AUTH-AMT       51970018
519800         MULTIPLY -1 BY ASC-KEY-AMOUNT-REQUESTED                  51980018
519900                               GIVING SVT00002-ORIG-AUTH-AMT      51990018
520000     ELSE                                                         52000000
520100         MOVE ASC-KEY-AMOUNT-REQUESTED                            52010000
520200                               TO SVT00002-APP-AUTH-AMT           52020018
520300         MOVE ASC-KEY-AMOUNT-REQUESTED                            52030018
520400                               TO SVT00002-ORIG-AUTH-AMT          52040018
520500     END-IF.                                                      52050000
520600                                                                  52060018
520700     MOVE ZERO                 TO SVT00002-POS-OPRT-ID.           52070018
520800     MOVE DP020-USERID         TO SVT00002-APVL-USR-ID.           52080018
520900     MOVE SV004-STAT-VERIFIED-CD                                  52090018
521000                               TO SVT00002-ACTVY-STAT-CDE.        52100018
521100     EXEC SQL                                                     52110018
521200         SET :DK-CURR-TMST = CURRENT TIMESTAMP                    52120000
521300     END-EXEC.                                                    52130018
521400                                                                  52140018
521500     MOVE DK-CURR-TMST TO SVT00002-TRN-PSTD-TMST                  52150018
521600                                                                  52160018
521700                                                                  52170000
521800     EXEC SQL                                                     52180000
521900         INSERT INTO SVT_KOHLS_CRD_TXN                            52190018
522000            (CRD_NBR,                                             52200000
522100             DRV_LIC_NBR,                                         52210000
522200             TRN_RVRSL_CDE,                                       52220000
522300             TRN_VOID_IND,                                        52230000
522400             ACTVY_TYP_CDE,                                       52240000
522500             POS_DTE,                                             52250000
522600             STR_NBR,                                             52260000
522700             POS_TRMNL_NBR,                                       52270000
522800             POS_TRN_NBR,                                         52280000
522900             TRN_PSTD_TMST,                                       52290000
523000             APP_AUTH_AMT,                                        52300000
523100             POS_OPRT_ID,                                         52310000
523200             APVL_USR_ID,                                         52320000
523300             ACTVY_STAT_CDE,                                      52330000
523400             ORIG_AUTH_AMT,                                       52340018
523500             ST_CDE)                                              52350018
523600         VALUES                                                   52360000
523700            (:SVT00002-CRD-NBR,                                   52370018
523800             :SVT00002-DRV-LIC-NBR,                               52380018
523900             :SVT00002-TRN-RVRSL-CDE,                             52390018
524000             :SVT00002-TRN-VOID-IND,                              52400018
524100             :SVT00002-ACTVY-TYP-CDE,                             52410018
524200             :SVT00002-POS-DTE,                                   52420018
524300             :SVT00002-STR-NBR,                                   52430018
524400             :SVT00002-POS-TRMNL-NBR,                             52440018
524500             :SVT00002-POS-TRN-NBR,                               52450018
524600             :SVT00002-TRN-PSTD-TMST,                             52460018
524700             :SVT00002-APP-AUTH-AMT,                              52470018
524800             :SVT00002-POS-OPRT-ID,                               52480018
524900             :SVT00002-APVL-USR-ID,                               52490018
525000             :SVT00002-ACTVY-STAT-CDE,                            52500018
525100             :SVT00002-ORIG-AUTH-AMT,                             52510018
525200             :SVT00002-ST-CDE)                                    52520018
525300     END-EXEC.                                                    52530000
525400                                                                  52540000
525500     EVALUATE TRUE                                                52550000
525600         WHEN SQLCODE = +0                                        52560000
525700             PERFORM 9000-DELETE-LOCK                             52570018
525800             SET ASC-TRANS-COMPLETE                               52580000
525900                 ASC-DISPLAY-APPROVAL                             52590000
526000                               TO TRUE                            52600000
526100*            --- ADD SUCCESSFUL ---                               52610000
526200             MOVE PC-TSYMSG-00034                                 52620000
526300                               TO DP020-MSG-NUMBER                52630000
526400             SET DP020-MSG-INFORMATIONAL                          52640000
526500                               TO TRUE                            52650000
526600                                                                  52660000
526700         WHEN OTHER                                               52670000
526800             PERFORM 9000-DELETE-LOCK                             52680018
526900             MOVE '8200-AUDIT-INSERT'                             52690000
527000                               TO DP013-PARAGRAPH                 52700000
527100             MOVE 'INSERT TRANSACTION FROM AUDIT'                 52710000
527200                               TO DP013-MESSAGE-TEXT(1)           52720000
527300             MOVE SQLCA        TO DP013-SQLCA                     52730000
527400             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME(1)  52740018
527500             SET DP013-DB2-ABEND                                  52750000
527600                 DP013-XCTL-DISPLAY-RESTART                       52760000
527700                               TO TRUE                            52770000
527800             PERFORM DP013-0000-PROCESS-ABEND                     52780000
527900                                                                  52790018
528000     END-EVALUATE.                                                52800000
528100                                                                  52810000
528200     EXEC SQL                                                     52820000
528300         SELECT  TRN_AUTH_TMST                                    52830000
528400           INTO :SVT00002-TRN-AUTH-TMST                           52840018
528500           FROM  SVT_KOHLS_CRD_TXN                                52850018
528600          WHERE  CRD_NBR        = :SVT00002-CRD-NBR               52860018
528700            AND  DRV_LIC_NBR    = :SVT00002-DRV-LIC-NBR           52870018
528800            AND  TRN_RVRSL_CDE  = :SVT00002-TRN-RVRSL-CDE         52880018
528900            AND  TRN_VOID_IND   = :SVT00002-TRN-VOID-IND          52890018
529000            AND  ACTVY_TYP_CDE  = :SVT00002-ACTVY-TYP-CDE         52900018
529100            AND  POS_DTE        = :SVT00002-POS-DTE               52910018
529200            AND  STR_NBR        = :SVT00002-STR-NBR               52920018
529300            AND  POS_TRMNL_NBR  = :SVT00002-POS-TRMNL-NBR         52930018
529400            AND  POS_TRN_NBR    = :SVT00002-POS-TRN-NBR           52940018
529500            AND  TRN_PSTD_TMST  = :SVT00002-TRN-PSTD-TMST         52950018
529600            AND  APP_AUTH_AMT   = :SVT00002-APP-AUTH-AMT          52960018
529700            AND  POS_OPRT_ID    = :SVT00002-POS-OPRT-ID           52970018
529800            AND  APVL_USR_ID    = :SVT00002-APVL-USR-ID           52980018
529900            AND  ACTVY_STAT_CDE = :SVT00002-ACTVY-STAT-CDE        52990018
530000            AND  ORIG_AUTH_AMT  = :SVT00002-ORIG-AUTH-AMT         53000018
530100         WITH UR                                                  53010018
530200     END-EXEC.                                                    53020000
530300                                                                  53030000
530400     EVALUATE TRUE                                                53040000
530500         WHEN SQLCODE = +0                                        53050000
530600             MOVE SVT00002-TRN-AUTH-TMST                          53060018
530700                               TO ASC-TRN-AUTH-TMST (1 1)         53070000
530800         WHEN OTHER                                               53080000
530900             MOVE '8200-AUDIT-INSERT'                             53090000
531000                               TO DP013-PARAGRAPH                 53100000
531100             MOVE 'SELECT RECENTLY INSERTED TRANS  '              53110000
531200                               TO DP013-MESSAGE-TEXT(1)           53120000
531300             MOVE SQLCA        TO DP013-SQLCA                     53130000
531400             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME(1)  53140018
531500             SET DP013-DB2-ABEND                                  53150000
531600                 DP013-XCTL-DISPLAY-RESTART                       53160000
531700                               TO TRUE                            53170000
531800             PERFORM DP013-0000-PROCESS-ABEND                     53180000
531900     END-EVALUATE.                                                53190000
532000                                                                  53200000
532100*----------------------------------------------------------------*53210000
532200*    PERFORM AN INSERT FROM THE REFERRAL SCREEN.                 *53220000
532300*----------------------------------------------------------------*53230000
532400                                                                  53240000
532500 8300-REFER-INSERT.                                               53250000
532600                                                                  53260000
532700     MOVE ASC-KEY-CARD-ID      TO SVT00002-CRD-NBR.               53270018
532800*    MOVE ASC-KEY-DRIVERS-LICENSE                                 53280031
532900*                              TO SVT00002-DRV-LIC-NBR.           53290031
533000     IF ASC-KEY-DRIVERS-LICENSE > SPACES                          53300031
533100        MOVE ASC-KEY-DRIVERS-LICENSE                              53310031
533200                               TO SVT00002-DRV-LIC-NBR            53320031
533300     ELSE                                                         53330031
533400        PERFORM 8400-DL-ROUTINE                                   53340031
533500        MOVE RDT00004-DRVR-LIC-NBR-TEXT                           53350031
533600                                  (1:RDT00004-DRVR-LIC-NBR-LEN)   53360031
533700                               TO SVT00002-DRV-LIC-NBR            53370031
533800     END-IF.                                                      53380031
533900     MOVE SV004-REV-CDE-NORMAL TO SVT00002-TRN-RVRSL-CDE.         53390018
534000     MOVE SV004-NOT-VOID-TRANS TO SVT00002-TRN-VOID-IND.          53400018
534100     MOVE ASC-KEY-ACTIVITY-TYPE                                   53410000
534200                               TO SVT00002-ACTVY-TYP-CDE.         53420018
534300     MOVE ASC-KEY-POS-DATE-ISO TO SVT00002-POS-DTE.               53430018
534400     MOVE ASC-KEY-STORE-NBR    TO SVT00002-STR-NBR.               53440018
534500     MOVE SVT00002-STR-NBR TO DK-STORE-NBR.                       53450018
534600     PERFORM 8550-GET-STATE-CODE.                                 53460018
534700     MOVE ASC-KEY-TERMINAL     TO SVT00002-POS-TRMNL-NBR.         53470018
534800     MOVE ASC-KEY-TRANSACTION  TO SVT00002-POS-TRN-NBR.           53480018
534900                                                                  53490018
535000     IF ASC-KEY-ACTIVITY-TYPE = SV004-TENDER-ACT-TYP              53500018
535100         MULTIPLY -1 BY ASC-APPROVED-TENDER-AMT                   53510000
535200                               GIVING SVT00002-APP-AUTH-AMT       53520018
535300         MULTIPLY -1 BY ASC-APPROVED-TENDER-AMT                   53530000
535400                               GIVING SVT00002-ORIG-AUTH-AMT      53540018
535500     ELSE                                                         53550000
535600         MOVE ASC-APPROVED-TENDER-AMT                             53560000
535700                               TO SVT00002-APP-AUTH-AMT           53570018
535800                                  SVT00002-ORIG-AUTH-AMT          53580018
535900     END-IF.                                                      53590000
536000                                                                  53600018
536100     MOVE ZERO                 TO SVT00002-POS-OPRT-ID.           53610018
536200     MOVE DP020-USERID         TO SVT00002-APVL-USR-ID.           53620018
536300     MOVE SV004-STAT-VERIFIED-CD                                  53630018
536400                               TO SVT00002-ACTVY-STAT-CDE.        53640018
536500     EXEC SQL                                                     53650018
536600         SET :DK-CURR-TMST = CURRENT TIMESTAMP                    53660000
536700     END-EXEC.                                                    53670018
536800                                                                  53680018
536900     MOVE DK-CURR-TMST TO SVT00002-TRN-PSTD-TMST                  53690018
537000                                                                  53700018
537100     EXEC SQL                                                     53710000
537200         INSERT INTO SVT_KOHLS_CRD_TXN                            53720018
537300            (CRD_NBR,                                             53730000
537400             DRV_LIC_NBR,                                         53740000
537500             TRN_RVRSL_CDE,                                       53750000
537600             TRN_VOID_IND,                                        53760000
537700             ACTVY_TYP_CDE,                                       53770000
537800             POS_DTE,                                             53780000
537900             STR_NBR,                                             53790000
538000             POS_TRMNL_NBR,                                       53800000
538100             POS_TRN_NBR,                                         53810000
538200             TRN_PSTD_TMST,                                       53820000
538300             APP_AUTH_AMT,                                        53830000
538400             POS_OPRT_ID,                                         53840000
538500             APVL_USR_ID,                                         53850000
538600             ACTVY_STAT_CDE,                                      53860000
538700             ORIG_AUTH_AMT,                                       53870018
538800             ST_CDE)                                              53880018
538900         VALUES                                                   53890000
539000            (:SVT00002-CRD-NBR,                                   53900018
539100             :SVT00002-DRV-LIC-NBR,                               53910018
539200             :SVT00002-TRN-RVRSL-CDE,                             53920018
539300             :SVT00002-TRN-VOID-IND,                              53930018
539400             :SVT00002-ACTVY-TYP-CDE,                             53940018
539500             :SVT00002-POS-DTE,                                   53950018
539600             :SVT00002-STR-NBR,                                   53960018
539700             :SVT00002-POS-TRMNL-NBR,                             53970018
539800             :SVT00002-POS-TRN-NBR,                               53980018
539900             :SVT00002-TRN-PSTD-TMST,                             53990018
540000             :SVT00002-APP-AUTH-AMT,                              54000018
540100             :SVT00002-POS-OPRT-ID,                               54010018
540200             :SVT00002-APVL-USR-ID,                               54020018
540300             :SVT00002-ACTVY-STAT-CDE,                            54030018
540400             :SVT00002-ORIG-AUTH-AMT,                             54040018
540500             :SVT00002-ST-CDE)                                    54050018
540600     END-EXEC.                                                    54060000
540700                                                                  54070018
540800     EVALUATE TRUE                                                54080000
540900         WHEN SQLCODE = +0                                        54090000
541000             PERFORM 9000-DELETE-LOCK                             54100018
541100             SET ASC-TRANS-COMPLETE                               54110000
541200                 ASC-DISPLAY-APPROVAL                             54120000
541300                               TO TRUE                            54130000
541400*            --- ADD SUCCESSFUL ---                               54140000
541500             MOVE PC-TSYMSG-00034                                 54150000
541600                               TO DP020-MSG-NUMBER                54160000
541700             SET DP020-MSG-INFORMATIONAL                          54170000
541800                               TO TRUE                            54180000
541900                                                                  54190000
542000         WHEN OTHER                                               54200000
542100             PERFORM 9000-DELETE-LOCK                             54210018
542200             MOVE '8300-REFER-INSERT'                             54220000
542300                               TO DP013-PARAGRAPH                 54230000
542400             MOVE 'INSERT TRANSACTION FROM REFERRAL'              54240000
542500                               TO DP013-MESSAGE-TEXT(1)           54250000
542600             MOVE SQLCA        TO DP013-SQLCA                     54260000
542700             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME(1)  54270018
542800             SET DP013-DB2-ABEND                                  54280000
542900                 DP013-XCTL-DISPLAY-RESTART                       54290000
543000                               TO TRUE                            54300000
543100             PERFORM DP013-0000-PROCESS-ABEND                     54310000
543200     END-EVALUATE.                                                54320000
543300                                                                  54330000
543400     EXEC SQL                                                     54340000
543500         SELECT  TRN_AUTH_TMST                                    54350000
543600           INTO :SVT00002-TRN-AUTH-TMST                           54360018
543700           FROM  SVT_KOHLS_CRD_TXN                                54370018
543800          WHERE  CRD_NBR        = :SVT00002-CRD-NBR               54380018
543900            AND  DRV_LIC_NBR    = :SVT00002-DRV-LIC-NBR           54390018
544000            AND  TRN_RVRSL_CDE  = :SVT00002-TRN-RVRSL-CDE         54400018
544100            AND  TRN_VOID_IND   = :SVT00002-TRN-VOID-IND          54410018
544200            AND  ACTVY_TYP_CDE  = :SVT00002-ACTVY-TYP-CDE         54420018
544300            AND  POS_DTE        = :SVT00002-POS-DTE               54430018
544400            AND  STR_NBR        = :SVT00002-STR-NBR               54440018
544500            AND  POS_TRMNL_NBR  = :SVT00002-POS-TRMNL-NBR         54450018
544600            AND  POS_TRN_NBR    = :SVT00002-POS-TRN-NBR           54460018
544700            AND  TRN_PSTD_TMST  = :SVT00002-TRN-PSTD-TMST         54470018
544800            AND  APP_AUTH_AMT   = :SVT00002-APP-AUTH-AMT          54480018
544900            AND  POS_OPRT_ID    = :SVT00002-POS-OPRT-ID           54490018
545000            AND  APVL_USR_ID    = :SVT00002-APVL-USR-ID           54500018
545100            AND  ACTVY_STAT_CDE = :SVT00002-ACTVY-STAT-CDE        54510018
545200            AND  ORIG_AUTH_AMT  = :SVT00002-ORIG-AUTH-AMT         54520018
545300          WITH UR                                                 54530018
545400     END-EXEC.                                                    54540000
545500                                                                  54550000
545600     EVALUATE TRUE                                                54560000
545700         WHEN SQLCODE = +0                                        54570000
545800             MOVE SVT00002-TRN-AUTH-TMST                          54580018
545900                               TO ASC-TRN-AUTH-TMST (1 1)         54590000
546000         WHEN OTHER                                               54600000
546100             MOVE '8300-REFER-INSERT'                             54610000
546200                               TO DP013-PARAGRAPH                 54620000
546300             MOVE 'SELECT RECENTLY INSERTED TRANS  '              54630000
546400                               TO DP013-MESSAGE-TEXT(1)           54640000
546500             MOVE SQLCA        TO DP013-SQLCA                     54650000
546600             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME(1)  54660018
546700             SET DP013-DB2-ABEND                                  54670000
546800                 DP013-XCTL-DISPLAY-RESTART                       54680000
546900                               TO TRUE                            54690000
547000             PERFORM DP013-0000-PROCESS-ABEND                     54700000
547100     END-EVALUATE.                                                54710000
547200                                                                  54720000
547300*----------------------------------------------------------------*54730025
547400 8400-DL-ROUTINE.                                                 54740031
547500                                                                  54750031
547600     MOVE ASC-KEY-DRIVERS-LICENSE-LONG                            54760031
547700                                    TO PV-DRV-LIC-NBR-LONG.       54770031
547800                                                                  54780031
547900     PERFORM VARYING PV-SUB                                       54790031
548000        FROM 50 BY -1                                             54800031
548100          UNTIL PV-SUB EQUAL 1                                    54810031
548200                                                                  54820031
548300           IF PV-DRV-LIC-NBR-BYTE (PV-SUB) > SPACE                54830031
548400              CONTINUE                                            54840031
548500           ELSE                                                   54850031
548600              MOVE PC-PERCENT   TO PV-DRV-LIC-NBR-BYTE (PV-SUB)   54860031
548700           END-IF                                                 54870031
548800                                                                  54880031
548900     END-PERFORM.                                                 54890031
549000                                                                  54900031
549100     MOVE PV-DRV-LIC-NBR-LONG       TO PV-DB2-LONG-DL.            54910031
549200     MOVE PV-DB2-DL-NBR             TO DK-DRV-LIC-NBR-LONG.       54920031
549300                                                                  54930031
549400     PERFORM 8450-SELECT-DRVR-LIC-TRANSL.                         54940031
549500                                                                  54950031
549600*----------------------------------------------------------------*54960031
549700* USING THE ENCRYPTED DRIVERS LICENSE NUMBER, RETRIEVE THE       *54970031
549800* UN-ENCRYPTED VERSION FROM RDT_DRVR_LIC_TRANSL TABLE.           *54980031
549900*----------------------------------------------------------------*54990031
550000 8450-SELECT-DRVR-LIC-TRANSL.                                     55000031
550100                                                                  55010031
550200     EXEC SQL                                                     55020031
550300        SELECT  DRVR_LIC_NBR                                      55030031
550400          INTO :RDT00004-DRVR-LIC-NBR                             55040031
550500          FROM RDT_DRVR_LIC_TRANSL                                55050031
550600         WHERE ENCRPD_DRVRLIC_NBR LIKE :DK-DRV-LIC-NBR-LONG       55060031
550700     END-EXEC.                                                    55070031
550800                                                                  55080031
550900     EVALUATE TRUE                                                55090031
551000         WHEN SQLCODE = ZERO                                      55100031
551100              CONTINUE                                            55110031
551200                                                                  55120031
551300         WHEN SQLCODE = +100                                      55130031
551400              MOVE ZEROES    TO RDT00004-DRVR-LIC-NBR-LEN         55140031
551500              MOVE SPACES    TO RDT00004-DRVR-LIC-NBR-TEXT        55150031
551600                                                                  55160031
551700         WHEN SQLWARN0 NOT = SPACES                               55170031
551800         WHEN SQLCODE < ZERO                                      55180031
551900         WHEN SQLCODE > ZERO                                      55190031
552000             MOVE '8450-SELECT-DRVR-LIC-TRANSL'                   55200031
552100                                   TO DP013-PARAGRAPH             55210031
552200             MOVE 'SELECT DL CONVERT'                             55220031
552300                                   TO DP013-MESSAGE-TEXT (1)      55230031
552400             MOVE ASC-KEY-DRIVERS-LICENSE-LONG                    55240031
552500                                   TO DP013-MESSAGE-TEXT (2)      55250031
552600             MOVE SQLCA        TO DP013-SQLCA                     55260031
552700             MOVE 'RDT_DRVR_LIC_TRANSL'                           55270031
552800                                   TO DP013-DB2-TABLE-NAME (1)    55280031
552900             SET DP013-DB2-ABEND                                  55290031
553000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               55300031
553100             PERFORM DP013-0000-PROCESS-ABEND                     55310031
553200     END-EVALUATE.                                                55320031
553300                                                                  55330031
553400*----------------------------------------------------------------*55340000
553500*    VOID A TRANSACTION -- FOR REFERRAL (LOSS PREVENTION).       *55350000
553600*    FIRST, THE SELECTED TRANSACTION MUST BE FOUND. THEN IT IS   *55360000
553700*    CHECKED TO SEE IF IT IS ALREADY VOID, AND IF NOT, IT IS     *55370000
553800*    VOIDED.                                                     *55380000
553900*    NOTE:  THIS PARAGRAPH FOLLOWS SIMILAR LOGIC AS 'SELECT-     *55390000
554000*           ALL-ITEMS' AND 'DESELECT-ALL-ITEMS'.                 *55400000
554100*----------------------------------------------------------------*55410000
554200                                                                  55420000
554300 8500-PROCESS-REFER-VOID.                                         55430000
554400                                                                  55440000
554500     COMPUTE PV-BOTTOM-ITEM =                                     55450000
554600         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    55460000
554700                                                                  55470000
554800     MOVE +1                       TO ASC-BLK-SUB.                55480000
554900                                                                  55490000
555000     PERFORM                                                      55500000
555100         VARYING ASC-ITEM-SUB                                     55510000
555200         FROM 1 BY 1                                              55520000
555300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  55530000
555400                                                                  55540000
555500         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 55550000
555600             PERFORM 8510-VOID-LINE                               55560000
555700         END-IF                                                   55570000
555800     END-PERFORM.                                                 55580000
555900                                                                  55590000
556000     ADD +1                        TO ASC-BLK-SUB.                55600000
556100                                                                  55610000
556200     PERFORM                                                      55620000
556300         VARYING ASC-ITEM-SUB                                     55630000
556400         FROM 1 BY 1                                              55640000
556500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  55650000
556600                                                                  55660000
556700         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 55670000
556800             PERFORM 8510-VOID-LINE                               55680000
556900         END-IF                                                   55690000
557000     END-PERFORM.                                                 55700000
557100                                                                  55710000
557200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               55720000
557300                                   TO PV-LIST-ITEM-NUMBER.        55730000
557400                                                                  55740000
557500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            55750000
557600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    55760000
557700                                                                  55770000
557800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     55780000
557900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    55790000
558000         MOVE +1                   TO ASC-BLK-SUB                 55800000
558100                                                                  55810000
558200         PERFORM 5100-WRITE-TEMP-STORAGE                          55820000
558300                                                                  55830000
558400         MOVE +1                   TO PV-BLOCK-NUMBER             55840000
558500                                                                  55850000
558600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         55860000
558700             PV-FIRST-BLOCK-IN-ARRAY - 1                          55870000
558800                                                                  55880000
558900         PERFORM                                                  55890000
559000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       55900000
559100                                                                  55910000
559200             PERFORM 4410-READ-TEMP-STORAGE                       55920000
559300                                                                  55930000
559400             PERFORM                                              55940000
559500                 VARYING ASC-ITEM-SUB                             55950000
559600                 FROM 1 BY 1                                      55960000
559700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          55970000
559800                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     55980000
559900                         PERFORM 8510-VOID-LINE                   55990000
560000                     END-IF                                       56000000
560100             END-PERFORM                                          56010000
560200                                                                  56020000
560300             PERFORM 5100-WRITE-TEMP-STORAGE                      56030000
560400                                                                  56040000
560500             ADD +1                TO PV-BLOCK-NUMBER             56050000
560600                                                                  56060000
560700         END-PERFORM                                              56070000
560800                                                                  56080000
560900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         56090000
561000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     56100000
561100                                                                  56110000
561200         PERFORM                                                  56120000
561300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       56130000
561400                   ASC-HIGHEST-BLOCK-WRITTEN                      56140000
561500                                                                  56150000
561600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          56160000
561700                                   TO PV-BLOCK-NUMBER             56170000
561800                                                                  56180000
561900             PERFORM 4410-READ-TEMP-STORAGE                       56190000
562000                                                                  56200000
562100             PERFORM                                              56210000
562200                 VARYING ASC-ITEM-SUB                             56220000
562300                 FROM 1 BY 1                                      56230000
562400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          56240000
562500                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     56250000
562600                         PERFORM 8510-VOID-LINE                   56260000
562700                     END-IF                                       56270000
562800             END-PERFORM                                          56280000
562900                                                                  56290000
563000             PERFORM 5100-WRITE-TEMP-STORAGE                      56300000
563100                                                                  56310000
563200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      56320000
563300                                                                  56330000
563400         END-PERFORM                                              56340000
563500                                                                  56350000
563600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             56360000
563700                                   TO PV-BLOCK-NUMBER             56370000
563800                                                                  56380000
563900         PERFORM 4410-READ-TEMP-STORAGE                           56390000
564000     END-IF.                                                      56400000
564100                                                                  56410000
564200*----------------------------------------------------------------*56420000
564300*    RE-DO THE EDITS BEFORE PERFORMING THE VOID, IN CASE THE     *56430000
564400*    USER CHANGED THE SELECTION TO A DIFFERENT LINE.             *56440000
564500*----------------------------------------------------------------*56450000
564600                                                                  56460000
564700 8510-VOID-LINE.                                                  56470000
564800                                                                  56480000
564900     PERFORM 7110-EDIT-VOID-LINE.                                 56490000
565000                                                                  56500000
565100     IF ASC-VOID-ERROR                                            56510000
565200         SET ASC-NO-VOID-REQUEST                                  56520000
565300                               TO TRUE                            56530000
565400     ELSE                                                         56540000
565500         PERFORM 8511-UPDATE-FOR-VOID                             56550000
565600     END-IF.                                                      56560000
565700                                                                  56570000
565800     PERFORM 5100-WRITE-TEMP-STORAGE.                             56580000
565900                                                                  56590000
566000*----------------------------------------------------------------*56600000
566100*    UPDATE THE SVT_KOHLS_CRD_TXN TABLE FOR THE VOID.             56610018
566200*                                            THE SELECTED ROW    *56620018
566300*    WILL BE UPDATED BY SETTING THE VOID INDICATOR, AND ANOTHER  *56630000
566400*    ROW WILL BE ADDED TO THE TABLE AS A REVERSAL OF THE VOID.   *56640000
566500*----------------------------------------------------------------*56650000
566600                                                                  56660000
566700 8511-UPDATE-FOR-VOID.                                            56670000
566800                                                                  56680000
566900     MOVE ASC-KEY-CARD-ID                                         56690018
567000                             TO DK-CARD-ID.                       56700000
567100     MOVE ASC-ACTIVITY-TYPE     (ASC-BLK-SUB ASC-ITEM-SUB)        56710000
567200                             TO DK-ACTIVITY-TYPE.                 56720000
567300     MOVE ASC-POS-DATE-ISO      (ASC-BLK-SUB ASC-ITEM-SUB)        56730000
567400                             TO DK-POS-DATE-ISO.                  56740000
567500     MOVE ASC-STORE-NBR         (ASC-BLK-SUB ASC-ITEM-SUB)        56750000
567600                             TO DK-STORE-NBR.                     56760000
567700     MOVE ASC-TERMINAL          (ASC-BLK-SUB ASC-ITEM-SUB)        56770000
567800                             TO DK-TERMINAL.                      56780018
567900     MOVE ASC-TRANSACTION       (ASC-BLK-SUB ASC-ITEM-SUB)        56790000
568000                             TO DK-TRANSACTION.                   56800000
568100     MOVE ASC-AMOUNT            (ASC-BLK-SUB ASC-ITEM-SUB)        56810000
568200                             TO DK-AMOUNT-REQUESTED.              56820000
568300     MOVE ASC-TRN-AUTH-TMST    (ASC-BLK-SUB ASC-ITEM-SUB)         56830000
568400                             TO DK-TRN-AUTH-TMST.                 56840018
568500     IF (ASC-FORMAT-IND = PC-AUDIT-VOID-FORMAT                    56850000
568600      OR ASC-FORMAT-IND = PC-AUDIT-FORMAT)                        56860000
568700         IF ASC-ACTIVITY-STAT-CDE                                 56870000
568800                                (ASC-BLK-SUB ASC-ITEM-SUB)        56880000
568900                               = SV004-STAT-AUTH-RECEIVED-CD      56890018
569000             MOVE SV004-STAT-VERIFIED-CD                          56900018
569100                               TO SVT00002-ACTVY-STAT-CDE         56910018
569200         ELSE                                                     56920000
569300             MOVE SV004-STAT-VERIFIED-CD                          56930000
569400                               TO SVT00002-ACTVY-STAT-CDE         56940018
569500         END-IF                                                   56950000
569600     ELSE                                                         56960000
569700         MOVE SV004-STAT-VERIFIED-CD                              56970000
569800                               TO SVT00002-ACTVY-STAT-CDE         56980018
569900     END-IF.                                                      56990000
570000                                                                  57000000
570100     EXEC SQL                                                     57010000
570200         UPDATE SVT_KOHLS_CRD_TXN                                 57020018
570300         SET TRN_VOID_IND = :SV004-VOID-TRANS,                    57030018
570400             ACTVY_STAT_CDE =:SVT00002-ACTVY-STAT-CDE             57040018
570500          WHERE CRD_NBR       = :DK-CARD-ID                       57050000
570600            AND TRN_RVRSL_CDE = :SV004-REV-CDE-NORMAL             57060018
570700            AND TRN_VOID_IND  = :SV004-NOT-VOID-TRANS             57070018
570800            AND ACTVY_TYP_CDE = :DK-ACTIVITY-TYPE                 57080018
570900            AND POS_DTE       = :DK-POS-DATE-ISO                  57090018
571000            AND STR_NBR       = :DK-STORE-NBR                     57100018
571100            AND POS_TRMNL_NBR = :DK-TERMINAL                      57110018
571200            AND POS_TRN_NBR   = :DK-TRANSACTION                   57120018
571300            AND APP_AUTH_AMT  = :DK-AMOUNT-REQUESTED              57130018
571400            AND TRN_AUTH_TMST = :DK-TRN-AUTH-TMST                 57140000
571500     END-EXEC.                                                    57150000
571600                                                                  57160000
571700     EVALUATE TRUE                                                57170000
571800         WHEN SQLCODE = +0                                        57180000
571900             CONTINUE                                             57190018
572000         WHEN OTHER                                               57200000
572100             PERFORM 9000-DELETE-LOCK                             57210018
572200             MOVE '8511-UPDATE-FOR-VOID'                          57220000
572300                               TO DP013-PARAGRAPH                 57230000
572400             MOVE 'UPDATE VOID TRANS'                             57240000
572500                               TO DP013-MESSAGE-TEXT (1)          57250000
572600             MOVE SQLCA        TO DP013-SQLCA                     57260000
572700             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1) 57270018
572800             SET DP013-DB2-ABEND                                  57280000
572900                               TO TRUE                            57290000
573000             SET DP013-XCTL-DISPLAY-RESTART                       57300000
573100                               TO TRUE                            57310000
573200             PERFORM DP013-0000-PROCESS-ABEND                     57320000
573300     END-EVALUATE.                                                57330000
573400                                                                  57340000
573500     MOVE ASC-KEY-CARD-ID      TO SVT00002-CRD-NBR.               57350018
573600     MOVE SPACES               TO SVT00002-DRV-LIC-NBR.           57360018
573700     MOVE SV004-REV-CDE-REVERSAL                                  57370018
573800                               TO SVT00002-TRN-RVRSL-CDE.         57380018
573900     MOVE SV004-VOID-TRANS     TO SVT00002-TRN-VOID-IND.          57390018
574000     MOVE ASC-ACTIVITY-TYPE     (ASC-BLK-SUB ASC-ITEM-SUB)        57400000
574100                               TO SVT00002-ACTVY-TYP-CDE.         57410018
574200     MOVE ASC-POS-DATE-ISO      (ASC-BLK-SUB ASC-ITEM-SUB)        57420000
574300                               TO SVT00002-POS-DTE.               57430018
574400     MOVE ASC-STORE-NBR         (ASC-BLK-SUB ASC-ITEM-SUB)        57440000
574500                               TO SVT00002-STR-NBR.               57450018
574600     MOVE ASC-TERMINAL          (ASC-BLK-SUB ASC-ITEM-SUB)        57460000
574700                               TO SVT00002-POS-TRMNL-NBR.         57470018
574800     MOVE ASC-TRANSACTION       (ASC-BLK-SUB ASC-ITEM-SUB)        57480000
574900                               TO SVT00002-POS-TRN-NBR.           57490018
575000     MOVE ASC-ST-CDE            (ASC-BLK-SUB ASC-ITEM-SUB)        57500018
575100                               TO SVT00002-ST-CDE.                57510018
575200     COMPUTE SVT00002-APP-AUTH-AMT                                57520018
575300             = ASC-AMOUNT (ASC-BLK-SUB ASC-ITEM-SUB) * -1.        57530000
575400     MOVE ZERO                 TO SVT00002-POS-OPRT-ID.           57540018
575500     MOVE DP020-USERID         TO SVT00002-APVL-USR-ID.           57550018
575600     IF (ASC-FORMAT-IND = PC-AUDIT-VOID-FORMAT                    57560000
575700      OR ASC-FORMAT-IND = PC-AUDIT-FORMAT)                        57570000
575800         MOVE SV004-STAT-VERIFIED-CD                              57580018
575900                               TO SVT00002-ACTVY-STAT-CDE         57590018
576000     ELSE                                                         57600000
576100         MOVE SV004-STAT-VERIFIED-CD                              57610018
576200                               TO SVT00002-ACTVY-STAT-CDE         57620018
576300     END-IF.                                                      57630000
576400     COMPUTE SVT00002-ORIG-AUTH-AMT                               57640018
576500             = ASC-ORIG-AUTH-AMT (ASC-BLK-SUB ASC-ITEM-SUB) * -1. 57650018
576600                                                                  57660000
576700     EXEC SQL                                                     57670000
576800         INSERT INTO SVT_KOHLS_CRD_TXN                            57680018
576900            (CRD_NBR,                                             57690000
577000             DRV_LIC_NBR,                                         57700000
577100             TRN_RVRSL_CDE,                                       57710000
577200             TRN_VOID_IND,                                        57720000
577300             ACTVY_TYP_CDE,                                       57730000
577400             POS_DTE,                                             57740000
577500             STR_NBR,                                             57750000
577600             POS_TRMNL_NBR,                                       57760000
577700             POS_TRN_NBR,                                         57770000
577800             TRN_PSTD_TMST,                                       57780000
577900             APP_AUTH_AMT,                                        57790000
578000             POS_OPRT_ID,                                         57800000
578100             APVL_USR_ID,                                         57810000
578200             ACTVY_STAT_CDE,                                      57820000
578300             ORIG_AUTH_AMT,                                       57830018
578400             ST_CDE)                                              57840018
578500         VALUES                                                   57850000
578600            (:SVT00002-CRD-NBR,                                   57860018
578700             :SVT00002-DRV-LIC-NBR,                               57870018
578800             :SVT00002-TRN-RVRSL-CDE,                             57880018
578900             :SVT00002-TRN-VOID-IND,                              57890018
579000             :SVT00002-ACTVY-TYP-CDE,                             57900018
579100             :SVT00002-POS-DTE,                                   57910018
579200             :SVT00002-STR-NBR,                                   57920018
579300             :SVT00002-POS-TRMNL-NBR,                             57930018
579400             :SVT00002-POS-TRN-NBR,                               57940018
579500              CURRENT TIMESTAMP,                                  57950018
579600             :SVT00002-APP-AUTH-AMT,                              57960018
579700             :SVT00002-POS-OPRT-ID,                               57970018
579800             :SVT00002-APVL-USR-ID,                               57980018
579900             :SVT00002-ACTVY-STAT-CDE,                            57990018
580000             :SVT00002-ORIG-AUTH-AMT,                             58000018
580100             :SVT00002-ST-CDE)                                    58010018
580200     END-EXEC.                                                    58020000
580300                                                                  58030000
580400     EVALUATE TRUE                                                58040000
580500         WHEN SQLCODE = +0                                        58050000
580600             PERFORM 9000-DELETE-LOCK                             58060018
580700*            --- VOID SUCCESSFUL ---                              58070000
580800             MOVE PC-TSYMSG-01243  TO DP020-MSG-NUMBER            58080000
580900             SET DP020-MSG-INFORMATIONAL                          58090000
581000                                   TO TRUE                        58100000
581100             MOVE SV004-VOID-TRANS TO ASC-VOID-IND                58110018
581200                                    (ASC-BLK-SUB ASC-ITEM-SUB)    58120000
581300         WHEN OTHER                                               58130000
581400             PERFORM 9000-DELETE-LOCK                             58140018
581500             MOVE '8511-UPDATE-FOR-VOID'                          58150000
581600                                  TO DP013-PARAGRAPH              58160000
581700             MOVE 'INSERT FOR VOID'                               58170000
581800                                  TO DP013-MESSAGE-TEXT(1)        58180000
581900             MOVE SQLCA           TO DP013-SQLCA                  58190000
582000             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME(1)  58200018
582100             SET DP013-DB2-ABEND                                  58210000
582200                 DP013-XCTL-DISPLAY-RESTART                       58220000
582300                                  TO TRUE                         58230000
582400             PERFORM DP013-0000-PROCESS-ABEND                     58240000
582500     END-EVALUATE.                                                58250000
582600                                                                  58260000
582700*----------------------------------------------------------------*58270018
582800*    VOID A TRANSACTION -- FOR AUDIT.                            *58280018
582900*    FIRST, THE SELECTED TRANSACTION MUST BE FOUND. THEN         *58290018
583000*----------------------------------------------------------------*58300018
583100 8550-GET-STATE-CODE.                                             58310018
583200                                                                  58320018
583300     EXEC SQL                                                     58330018
583400         SELECT ST_CDE                                            58340018
583500           INTO :XST00001-ST-CDE                                  58350018
583600           FROM XST_LOC                                           58360018
583700         WHERE LOC_NBR = :DK-STORE-NBR                            58370018
583800         WITH UR                                                  58380018
583900     END-EXEC.                                                    58390018
584000                                                                  58400018
584100     EVALUATE TRUE                                                58410018
584200         WHEN SQLCODE = 0                                         58420018
584300             MOVE XST00001-ST-CDE       TO SVT00002-ST-CDE        58430018
584400         WHEN OTHER                                               58440018
584500             MOVE '8550-GET-STATE-CODE'                           58450018
584600                                        TO DP013-PARAGRAPH        58460018
584700             MOVE 'SELECT FROM XST00001' TO DP013-MESSAGE-TEXT (1)58470018
584800             MOVE SQLCA                 TO DP013-SQLCA            58480018
584900             MOVE 'XST_LOC '            TO                        58490018
585000                                        DP013-DB2-TABLE-NAME (1)  58500018
585100             SET DP013-DB2-ABEND        TO TRUE                   58510018
585200             PERFORM DP013-0000-PROCESS-ABEND                     58520018
585300     END-EVALUATE.                                                58530018
585400                                                                  58540018
585500*----------------------------------------------------------------*58550018
585600*    VOID A TRANSACTION -- FOR AUDIT.                            *58560000
585700*    FIRST, THE SELECTED TRANSACTION MUST BE FOUND. THEN         *58570000
585800*    PROCESSING DEPENDS ON THE VOID INDICATOR:  IF IT IS NOT     *58580000
585900*    VOID, THE TRANSACTION WILL BE VOIDED.  IF IT IS VOID, THE   *58590000
586000*    TRANSACTION WILL BE SETTLED (STATUS CHANGED TO 3).          *58600000
586100*    NOTE:  THIS PARAGRAPH FOLLOWS SIMILAR LOGIC AS 'SELECT-     *58610000
586200*           ALL-ITEMS' AND 'DESELECT-ALL-ITEMS'  AND             *58620000
586300*           'PROCESS-REFER-VOID'.                                *58630000
586400*----------------------------------------------------------------*58640000
586500                                                                  58650000
586600 8600-PROCESS-AUDIT-VOID.                                         58660000
586700                                                                  58670000
586800     COMPUTE PV-BOTTOM-ITEM =                                     58680000
586900         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    58690000
587000                                                                  58700000
587100     MOVE +1                       TO ASC-BLK-SUB.                58710000
587200                                                                  58720000
587300     PERFORM                                                      58730000
587400         VARYING ASC-ITEM-SUB                                     58740000
587500         FROM 1 BY 1                                              58750000
587600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  58760000
587700                                                                  58770000
587800         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 58780000
587900             PERFORM 8610-AUDIT-VOID-LINE                         58790000
588000         END-IF                                                   58800000
588100     END-PERFORM.                                                 58810000
588200                                                                  58820000
588300     ADD +1                        TO ASC-BLK-SUB.                58830000
588400                                                                  58840000
588500     PERFORM                                                      58850000
588600         VARYING ASC-ITEM-SUB                                     58860000
588700         FROM 1 BY 1                                              58870000
588800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  58880000
588900                                                                  58890000
589000         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 58900000
589100             PERFORM 8610-AUDIT-VOID-LINE                         58910000
589200         END-IF                                                   58920000
589300     END-PERFORM.                                                 58930000
589400                                                                  58940000
589500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               58950000
589600                                   TO PV-LIST-ITEM-NUMBER.        58960000
589700                                                                  58970000
589800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            58980000
589900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    58990000
590000                                                                  59000000
590100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     59010000
590200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    59020000
590300         MOVE +1                   TO ASC-BLK-SUB                 59030000
590400                                                                  59040000
590500         PERFORM 5100-WRITE-TEMP-STORAGE                          59050000
590600                                                                  59060000
590700         MOVE +1                   TO PV-BLOCK-NUMBER             59070000
590800                                                                  59080000
590900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         59090000
591000             PV-FIRST-BLOCK-IN-ARRAY - 1                          59100000
591100                                                                  59110000
591200         PERFORM                                                  59120000
591300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       59130000
591400                                                                  59140000
591500             PERFORM 4410-READ-TEMP-STORAGE                       59150000
591600                                                                  59160000
591700             PERFORM                                              59170000
591800                 VARYING ASC-ITEM-SUB                             59180000
591900                 FROM 1 BY 1                                      59190000
592000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          59200000
592100                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     59210000
592200                         PERFORM 8610-AUDIT-VOID-LINE             59220000
592300                     END-IF                                       59230000
592400             END-PERFORM                                          59240000
592500                                                                  59250000
592600             PERFORM 5100-WRITE-TEMP-STORAGE                      59260000
592700                                                                  59270000
592800             ADD +1                TO PV-BLOCK-NUMBER             59280000
592900                                                                  59290000
593000         END-PERFORM                                              59300000
593100                                                                  59310000
593200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         59320000
593300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     59330000
593400                                                                  59340000
593500         PERFORM                                                  59350000
593600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       59360000
593700                   ASC-HIGHEST-BLOCK-WRITTEN                      59370000
593800                                                                  59380000
593900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          59390000
594000                                   TO PV-BLOCK-NUMBER             59400000
594100                                                                  59410000
594200             PERFORM 4410-READ-TEMP-STORAGE                       59420000
594300                                                                  59430000
594400             PERFORM                                              59440000
594500                 VARYING ASC-ITEM-SUB                             59450000
594600                 FROM 1 BY 1                                      59460000
594700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          59470000
594800                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     59480000
594900                         PERFORM 8610-AUDIT-VOID-LINE             59490000
595000                     END-IF                                       59500000
595100             END-PERFORM                                          59510000
595200                                                                  59520000
595300             PERFORM 5100-WRITE-TEMP-STORAGE                      59530000
595400                                                                  59540000
595500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      59550000
595600                                                                  59560000
595700         END-PERFORM                                              59570000
595800                                                                  59580000
595900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             59590000
596000                                   TO PV-BLOCK-NUMBER             59600000
596100                                                                  59610000
596200         PERFORM 4410-READ-TEMP-STORAGE                           59620000
596300     END-IF.                                                      59630000
596400                                                                  59640000
596500*----------------------------------------------------------------*59650000
596600*    RE-DO THE EDITS BEFORE PERFORMING THE VOID, IN CASE THE     *59660000
596700*    USER CHANGED THE SELECTION TO A DIFFERENT LINE.             *59670000
596800*----------------------------------------------------------------*59680000
596900                                                                  59690000
597000 8610-AUDIT-VOID-LINE.                                            59700000
597100                                                                  59710000
597200     PERFORM 7110-EDIT-VOID-LINE.                                 59720000
597300                                                                  59730000
597400     IF ASC-VOID-ERROR                                            59740000
597500         SET ASC-NO-VOID-REQUEST                                  59750000
597600                               TO TRUE                            59760000
597700     ELSE                                                         59770000
597800         PERFORM 8611-DO-AUDIT-VOID                               59780000
597900     END-IF.                                                      59790000
598000                                                                  59800000
598100     PERFORM 5100-WRITE-TEMP-STORAGE.                             59810000
598200                                                                  59820000
598300*----------------------------------------------------------------*59830000
598400*    UPDATE THE SVT_KOHLS_CRD_TXN TABLE FOR THE VOID.            *59840018
598500*    PROCESSING DEPENDS ON THE VOID INDICATOR:  IF IT IS NOT     *59850000
598600*    VOID, THE TRANSACTION WILL BE VOIDED (THE SAME AS IT WOULD  *59860000
598700*    BE DONE IN REFERRAL MODE).  IF IT IS VOID, THE TRANSACTION  *59870000
598800*    WILL BE SETTLED (STATUS CHANGED TO 3).                      *59880000
598900*    NOTE: THIS PARAGRAPH IS PERFORMED ONLY IF IT PASSED THE     *59890000
599000*          EDITS, INCLUDING CHECKING FOR PROPER INSERT AUTHORITY *59900000
599100*          IF THE TRANSACTION IS TO BE VOIDED.                   *59910000
599200*----------------------------------------------------------------*59920000
599300                                                                  59930000
599400 8611-DO-AUDIT-VOID.                                              59940000
599500                                                                  59950000
599600     EVALUATE TRUE                                                59960000
599700         WHEN ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB)             59970000
599800                               = SV004-VOID-TRANS                 59980018
599900             PERFORM 8612-AUDIT-VOID-SETTLE                       59990000
600000                                                                  60000000
600100         WHEN ASC-VOID-IND (ASC-BLK-SUB ASC-ITEM-SUB)             60010000
600200                               = SV004-NOT-VOID-TRANS             60020018
600300             PERFORM 8511-UPDATE-FOR-VOID                         60030000
600400                                                                  60040000
600500     END-EVALUATE.                                                60050000
600600                                                                  60060000
600700*----------------------------------------------------------------*60070000
600800*    SETTLE THE VOID (CHANGE THE STATUS CODE TO 3).              *60080000
600900*----------------------------------------------------------------*60090000
601000                                                                  60100000
601100 8612-AUDIT-VOID-SETTLE.                                          60110000
601200                                                                  60120000
601300     MOVE ASC-KEY-CARD-ID          TO DK-CARD-ID.                 60130018
601400     MOVE ASC-TRN-AUTH-TMST        (ASC-BLK-SUB ASC-ITEM-SUB)     60140000
601500                                   TO DK-TRN-AUTH-TMST.           60150000
601600                                                                  60160000
601700     EXEC SQL                                                     60170000
601800         UPDATE SVT_KOHLS_CRD_TXN                                 60180018
601900         SET ACTVY_STAT_CDE = :SV004-STAT-VERIFIED-CD             60190018
602000          WHERE CRD_NBR       = :DK-CARD-ID                       60200000
602100            AND TRN_AUTH_TMST = :DK-TRN-AUTH-TMST                 60210000
602200     END-EXEC.                                                    60220000
602300                                                                  60230000
602400     EVALUATE TRUE                                                60240000
602500         WHEN SQLCODE = +0                                        60250000
602600             PERFORM 9000-DELETE-LOCK                             60260018
602700*            --- VOID SUCCESSFUL ---                              60270000
602800             MOVE PC-TSYMSG-01243                                 60280000
602900                              TO DP020-MSG-NUMBER                 60290000
603000             SET DP020-MSG-INFORMATIONAL                          60300000
603100                              TO TRUE                             60310000
603200         WHEN OTHER                                               60320000
603300             PERFORM 9000-DELETE-LOCK                             60330018
603400             MOVE '8612-AUDIT-VOID-SETTLE'                        60340000
603500                              TO DP013-PARAGRAPH                  60350000
603600             MOVE 'UPDATE ACTIVITY STATUS'                        60360000
603700                              TO DP013-MESSAGE-TEXT (1)           60370000
603800             MOVE SQLCA       TO DP013-SQLCA                      60380000
603900             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1) 60390018
604000             SET DP013-DB2-ABEND                                  60400000
604100                              TO TRUE                             60410000
604200             SET DP013-XCTL-DISPLAY-RESTART                       60420000
604300                              TO TRUE                             60430000
604400             PERFORM DP013-0000-PROCESS-ABEND                     60440000
604500     END-EVALUATE.                                                60450000
604600                                                                  60460000
604700*----------------------------------------------------------------*60470018
604800*    REV VOID A TRANSACTION -- THE SELECTED TRANSACTION MUST BE  *60480018
604900*    FOUND.                                                      *60490018
605000*    NOTE:  THIS PARAGRAPH FOLLOWS SIMILAR LOGIC AS 'SELECT-     *60500018
605100*           ALL-ITEMS' AND 'DESELECT-ALL-ITEMS'.                 *60510018
605200*----------------------------------------------------------------*60520018
605300 8700-PROCESS-REFER-VOID.                                         60530018
605400                                                                  60540018
605500     COMPUTE PV-BOTTOM-ITEM =                                     60550018
605600         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1.                    60560018
605700                                                                  60570018
605800     MOVE +1                       TO ASC-BLK-SUB.                60580018
605900                                                                  60590018
606000     PERFORM                                                      60600018
606100         VARYING ASC-ITEM-SUB                                     60610018
606200         FROM 1 BY 1                                              60620018
606300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  60630018
606400                                                                  60640018
606500         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 60650018
606600             PERFORM 8710-REVERSE-VOID-LINE                       60660018
606700         END-IF                                                   60670018
606800     END-PERFORM.                                                 60680018
606900                                                                  60690018
607000     MOVE +1                       TO ASC-BLK-SUB.                60700018
607100     ADD +1                        TO ASC-BLK-SUB.                60710018
607200                                                                  60720018
607300     PERFORM                                                      60730018
607400         VARYING ASC-ITEM-SUB                                     60740018
607500         FROM 1 BY 1                                              60750018
607600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  60760018
607700                                                                  60770018
607800         IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                 60780018
607900             PERFORM 8710-REVERSE-VOID-LINE                       60790018
608000         END-IF                                                   60800018
608100     END-PERFORM.                                                 60810018
608200                                                                  60820018
608300     MOVE +2                       TO ASC-BLK-SUB.                60830018
608400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               60840018
608500                                   TO PV-LIST-ITEM-NUMBER.        60850018
608600                                                                  60860018
608700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            60870018
608800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    60880018
608900                                                                  60890018
609000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     60900018
609100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    60910018
609200         MOVE +1                   TO ASC-BLK-SUB                 60920018
609300                                                                  60930018
609400         PERFORM 5100-WRITE-TEMP-STORAGE                          60940018
609500                                                                  60950018
609600         MOVE +1                   TO PV-BLOCK-NUMBER             60960018
609700                                                                  60970018
609800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         60980018
609900             PV-FIRST-BLOCK-IN-ARRAY - 1                          60990018
610000                                                                  61000018
610100         PERFORM                                                  61010018
610200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       61020018
610300                                                                  61030018
610400             PERFORM 4410-READ-TEMP-STORAGE                       61040018
610500                                                                  61050018
610600             PERFORM                                              61060018
610700                 VARYING ASC-ITEM-SUB                             61070018
610800                 FROM 1 BY 1                                      61080018
610900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          61090018
611000                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     61100018
611100                         PERFORM 8710-REVERSE-VOID-LINE           61110018
611200                     END-IF                                       61120018
611300             END-PERFORM                                          61130018
611400                                                                  61140018
611500             PERFORM 5100-WRITE-TEMP-STORAGE                      61150018
611600                                                                  61160018
611700             ADD +1                TO PV-BLOCK-NUMBER             61170018
611800                                                                  61180018
611900         END-PERFORM                                              61190018
612000                                                                  61200018
612100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         61210018
612200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     61220018
612300                                                                  61230018
612400         PERFORM                                                  61240018
612500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       61250018
612600                   ASC-HIGHEST-BLOCK-WRITTEN                      61260018
612700                                                                  61270018
612800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          61280018
612900                                   TO PV-BLOCK-NUMBER             61290018
613000                                                                  61300018
613100             PERFORM 4410-READ-TEMP-STORAGE                       61310018
613200                                                                  61320018
613300             PERFORM                                              61330018
613400                 VARYING ASC-ITEM-SUB                             61340018
613500                 FROM 1 BY 1                                      61350018
613600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          61360018
613700                     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     61370018
613800                         PERFORM 8710-REVERSE-VOID-LINE           61380018
613900                     END-IF                                       61390018
614000             END-PERFORM                                          61400018
614100                                                                  61410018
614200             PERFORM 5100-WRITE-TEMP-STORAGE                      61420018
614300                                                                  61430018
614400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      61440018
614500                                                                  61450018
614600         END-PERFORM                                              61460018
614700                                                                  61470018
614800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             61480018
614900                                   TO PV-BLOCK-NUMBER             61490018
615000                                                                  61500018
615100         PERFORM 4410-READ-TEMP-STORAGE                           61510018
615200     END-IF.                                                      61520018
615300                                                                  61530018
615400*----------------------------------------------------------------*61540018
615500*    RE-DO THE EDITS BEFORE PERFORMING THE REVERSAL ON THE VOID, *61550018
615600*    IN CASE THE USER CHANGED THE SELECTION TO A DIFFERENT LINE. *61560018
615700*----------------------------------------------------------------*61570018
615800 8710-REVERSE-VOID-LINE.                                          61580018
615900                                                                  61590018
616000     PERFORM 7210-EDIT-REVERSE-VOID-LINE.                         61600018
616100                                                                  61610018
616200     IF ASC-VOID-ERROR                                            61620018
616300         SET ASC-NO-REVERSE-VOID-REQUEST TO TRUE                  61630018
616400     ELSE                                                         61640018
616500         PERFORM 8711-UPDATE-FOR-REVERSE-VOID                     61650018
616600     END-IF.                                                      61660018
616700                                                                  61670018
616800     PERFORM 5100-WRITE-TEMP-STORAGE.                             61680018
616900                                                                  61690018
617000*----------------------------------------------------------------*61700018
617100*    UPDATE THE SVT_KOHLS_CRD_TXN TABLE FOR THE VOID REVERSAL.   *61710018
617200*                                                     THE        *61720018
617300*    SELECTED VOID WILL BE REVERSED BY SETTING THE VOID INDICATOR*61730018
617400*    ON THE ORIGINAL TRANSACTION TO A SPACE, AND THE RECORD WHICH*61740018
617500*    WAS ADDED TO THE TABLE AS A REVERSAL OF THE VOID WILL BE    *61750018
617600*    DELETED.                                                    *61760018
617700*----------------------------------------------------------------*61770018
617800 8711-UPDATE-FOR-REVERSE-VOID.                                    61780018
617900                                                                  61790018
618000     MOVE ASC-KEY-CARD-ID                                         61800018
618100                             TO DK-CARD-ID.                       61810018
618200     MOVE ASC-ACTIVITY-TYPE     (ASC-BLK-SUB ASC-ITEM-SUB)        61820018
618300                             TO DK-ACTIVITY-TYPE.                 61830018
618400     MOVE ASC-POS-DATE-ISO      (ASC-BLK-SUB ASC-ITEM-SUB)        61840018
618500                             TO DK-POS-DATE-ISO.                  61850018
618600     MOVE ASC-STORE-NBR         (ASC-BLK-SUB ASC-ITEM-SUB)        61860018
618700                             TO DK-STORE-NBR.                     61870018
618800     MOVE ASC-TERMINAL          (ASC-BLK-SUB ASC-ITEM-SUB)        61880018
618900                             TO DK-TERMINAL.                      61890018
619000     MOVE ASC-TRANSACTION       (ASC-BLK-SUB ASC-ITEM-SUB)        61900018
619100                              TO DK-TRANSACTION.                  61910018
619200                                                                  61920018
619300*    USED TO RESTRICT REV VOID DELETE TO ONE TRANS                61930018
619400                                                                  61940018
619500     IF ASC-MATCH-FND-SW = 'N'                                    61950018
619600         PERFORM 8850-SELECT-ALL-ITEMS                            61960018
619700     END-IF.                                                      61970018
619800                                                                  61980018
619900     IF ASC-HLD-REVERSAL-IND = 0                                  61990018
620000*       ORIGINAL TRANSACTION WAS SELECTED TO BE REV VOID          62000018
620100        MOVE ASC-HLD-TRANS-AMOUNT                                 62010018
620200                                TO DK-UPDTE-AMOUNT                62020018
620300        MOVE ASC-REV-VOID-TMST  TO DK-UPDTE-TMST                  62030018
620400        MOVE ASC-DELETE-AMOUNT  TO DK-DELETE-AMOUNT               62040018
620500        MOVE ASC-DELETE-TMST    TO DK-DELETE-TMST                 62050018
620600     ELSE                                                         62060018
620700*       ORIGINAL TRANSACTION WAS NOT SELECTED                     62070018
620800        MOVE ASC-HLD-TRANS-AMOUNT                                 62080018
620900                                TO DK-DELETE-AMOUNT               62090018
621000        MOVE ASC-REV-VOID-TMST  TO DK-DELETE-TMST                 62100018
621100        MOVE ASC-DELETE-AMOUNT  TO DK-UPDTE-AMOUNT                62110018
621200        MOVE ASC-DELETE-TMST    TO DK-UPDTE-TMST                  62120018
621300     END-IF.                                                      62130018
621400     EXEC SQL                                                     62140018
621500         UPDATE SVT_KOHLS_CRD_TXN                                 62150018
621600         SET TRN_VOID_IND = :SV004-NOT-VOID-TRANS                 62160018
621700          WHERE CRD_NBR       = :DK-CARD-ID                       62170018
621800            AND TRN_RVRSL_CDE = :SV004-REV-CDE-NORMAL             62180018
621900            AND TRN_VOID_IND  = :SV004-VOID-TRANS                 62190018
622000            AND ACTVY_TYP_CDE = :DK-ACTIVITY-TYPE                 62200018
622100            AND POS_DTE       = :DK-POS-DATE-ISO                  62210018
622200            AND STR_NBR       = :DK-STORE-NBR                     62220018
622300            AND POS_TRMNL_NBR = :DK-TERMINAL                      62230018
622400            AND POS_TRN_NBR   = :DK-TRANSACTION                   62240018
622500            AND APP_AUTH_AMT  = :DK-UPDTE-AMOUNT                  62250018
622600            AND TRN_AUTH_TMST = :DK-UPDTE-TMST                    62260018
622700     END-EXEC.                                                    62270018
622800                                                                  62280018
622900     EVALUATE TRUE                                                62290018
623000         WHEN SQLCODE = +0                                        62300018
623100             CONTINUE                                             62310018
623200         WHEN OTHER                                               62320018
623300             PERFORM 9000-DELETE-LOCK                             62330018
623400             MOVE '8711-UPDATE-FOR-REVERSE-VOID'                  62340018
623500                               TO DP013-PARAGRAPH                 62350018
623600             MOVE 'UPDATE REVERSE VOID TRANS'                     62360018
623700                               TO DP013-MESSAGE-TEXT (1)          62370018
623800             MOVE SQLCA        TO DP013-SQLCA                     62380018
623900             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1) 62390018
624000             SET DP013-DB2-ABEND                                  62400018
624100                               TO TRUE                            62410018
624200             SET DP013-XCTL-DISPLAY-RESTART                       62420018
624300                               TO TRUE                            62430018
624400             PERFORM DP013-0000-PROCESS-ABEND                     62440018
624500     END-EVALUATE.                                                62450018
624600                                                                  62460018
624700                                                                  62470018
624800     EXEC SQL                                                     62480018
624900         DELETE FROM SVT_KOHLS_CRD_TXN                            62490018
625000          WHERE CRD_NBR       = :DK-CARD-ID                       62500018
625100            AND TRN_RVRSL_CDE = :SV004-REV-CDE-REVERSAL           62510018
625200            AND TRN_VOID_IND  = :SV004-VOID-TRANS                 62520018
625300            AND ACTVY_TYP_CDE = :DK-ACTIVITY-TYPE                 62530018
625400            AND POS_DTE       = :DK-POS-DATE-ISO                  62540018
625500            AND STR_NBR       = :DK-STORE-NBR                     62550018
625600            AND POS_TRMNL_NBR = :DK-TERMINAL                      62560018
625700            AND POS_TRN_NBR   = :DK-TRANSACTION                   62570018
625800            AND APP_AUTH_AMT  = :DK-DELETE-AMOUNT                 62580018
625900            AND TRN_AUTH_TMST = :DK-DELETE-TMST                   62590018
626000     END-EXEC.                                                    62600018
626100                                                                  62610018
626200     EVALUATE TRUE                                                62620018
626300         WHEN SQLCODE = +0                                        62630018
626400             PERFORM 9000-DELETE-LOCK                             62640018
626500*            --- REVERSE VOID SUCCESSFUL ---                      62650018
626600             MOVE PC-TSYMSG-01694  TO DP020-MSG-NUMBER            62660018
626700             SET DP020-MSG-INFORMATIONAL                          62670018
626800                                   TO TRUE                        62680018
626900         WHEN OTHER                                               62690018
627000             PERFORM 9000-DELETE-LOCK                             62700018
627100             MOVE '8711-UPDATE-FOR-REVERSE-VOID'                  62710018
627200                               TO DP013-PARAGRAPH                 62720018
627300             MOVE 'DELETE REVERSE VOID TRANS'                     62730018
627400                               TO DP013-MESSAGE-TEXT (1)          62740018
627500             MOVE SQLCA        TO DP013-SQLCA                     62750018
627600             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1) 62760018
627700             SET DP013-DB2-ABEND                                  62770018
627800                               TO TRUE                            62780018
627900             SET DP013-XCTL-DISPLAY-RESTART                       62790018
628000                               TO TRUE                            62800018
628100             PERFORM DP013-0000-PROCESS-ABEND                     62810018
628200     END-EVALUATE.                                                62820018
628300                                                                  62830018
628400*----------------------------------------------------------------*62840018
628500*                                                                *62850018
628600* SEARCH BOTH ASC- BLOCKS AND TS TO FIND CORRESPONDING REV VOID  *62860018
628700* MATCH.  THIS SEARCH IS NECESSARY BECAUSE MATCHING TRANS MIGHT  *62870018
628800* NEVER BE HIGHLIGHTED ON THE SCREEN.                            *62880018
628900*                                                                *62890018
629000*----------------------------------------------------------------*62900018
629100 8850-SELECT-ALL-ITEMS.                                           62910018
629200                                                                  62920018
629300     MOVE +1                       TO ASC-BLK-SUB.                62930018
629400                                                                  62940018
629500     PERFORM 8851-SET-SELECTED-INDS                               62950018
629600         VARYING ASC-ITEM-SUB                                     62960018
629700         FROM 1 BY 1                                              62970018
629800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 62980018
629900                                                                  62990018
630000     ADD +1                        TO ASC-BLK-SUB.                63000018
630100                                                                  63010018
630200     PERFORM 8851-SET-SELECTED-INDS                               63020018
630300         VARYING ASC-ITEM-SUB                                     63030018
630400         FROM 1 BY 1                                              63040018
630500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 63050018
630600                                                                  63060018
630700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               63070018
630800                                   TO PV-LIST-ITEM-NUMBER.        63080018
630900                                                                  63090018
631000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            63100018
631100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    63110018
631200                                                                  63120018
631300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     63130018
631400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    63140018
631500         MOVE +1                   TO ASC-BLK-SUB                 63150018
631600                                                                  63160018
631700         PERFORM 5100-WRITE-TEMP-STORAGE                          63170018
631800                                                                  63180018
631900         MOVE +1                   TO PV-BLOCK-NUMBER             63190018
632000                                                                  63200018
632100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         63210018
632200             PV-FIRST-BLOCK-IN-ARRAY - 1                          63220018
632300                                                                  63230018
632400         PERFORM                                                  63240018
632500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       63250018
632600                                                                  63260018
632700             PERFORM 4410-READ-TEMP-STORAGE                       63270018
632800                                                                  63280018
632900             PERFORM 8851-SET-SELECTED-INDS                       63290018
633000                 VARYING ASC-ITEM-SUB                             63300018
633100                 FROM 1 BY 1                                      63310018
633200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          63320018
633300                                                                  63330018
633400             PERFORM 5100-WRITE-TEMP-STORAGE                      63340018
633500                                                                  63350018
633600             ADD +1                TO PV-BLOCK-NUMBER             63360018
633700                                                                  63370018
633800         END-PERFORM                                              63380018
633900                                                                  63390018
634000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         63400018
634100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     63410018
634200                                                                  63420018
634300         PERFORM                                                  63430018
634400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       63440018
634500                   ASC-HIGHEST-BLOCK-WRITTEN                      63450018
634600                                                                  63460018
634700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          63470018
634800                                   TO PV-BLOCK-NUMBER             63480018
634900                                                                  63490018
635000             PERFORM 4410-READ-TEMP-STORAGE                       63500018
635100                                                                  63510018
635200             PERFORM 8851-SET-SELECTED-INDS                       63520018
635300                 VARYING ASC-ITEM-SUB                             63530018
635400                 FROM 1 BY 1                                      63540018
635500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          63550018
635600                                                                  63560018
635700             PERFORM 5100-WRITE-TEMP-STORAGE                      63570018
635800                                                                  63580018
635900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      63590018
636000                                                                  63600018
636100         END-PERFORM                                              63610018
636200                                                                  63620018
636300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             63630018
636400                                   TO PV-BLOCK-NUMBER             63640018
636500                                                                  63650018
636600         PERFORM 4410-READ-TEMP-STORAGE                           63660018
636700     END-IF.                                                      63670018
636800                                                                  63680018
636900                                                                  63690018
637000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             63700018
637100                       ASC-NUMBER-OF-SELECTED-ITEMS.              63710018
637200                                                                  63720018
637300*----------------------------------------------------------------*63730018
637400*    MARK EACH ITEM AS BEING SELECTED.                           *63740018
637500*----------------------------------------------------------------*63750018
637600 8851-SET-SELECTED-INDS.                                          63760018
637700                                                                  63770018
637800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           63780018
637900             NOT EQUAL ZERO                                       63790018
638000*          USED TO RESTRICT REVERSE VOID DELETE TO ONE TRANS      63800018
638100           IF  ASC-MATCH-FND-SW = 'N'                       AND   63810018
638200              (ASC-KEY-CARD-ID = ASC-HLD-CARD-ID)           AND   63820018
638300              (ASC-VOID-IND      (ASC-BLK-SUB ASC-ITEM-SUB)       63830018
638400                                 = SV004-VOID-TRANS)        AND   63840018
638500              (ASC-ACTIVITY-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)       63850018
638600                                 = ASC-HLD-ACTIVITY-TYPE)   AND   63860018
638700              (ASC-REVERSAL-IND  (ASC-BLK-SUB ASC-ITEM-SUB)       63870018
638800                                 = ASC-HLD-REVERSAL-IND)    AND   63880018
638900              (ASC-POS-DATE-ISO  (ASC-BLK-SUB ASC-ITEM-SUB)       63890018
639000                                 = ASC-HLD-POS-DATE-ISO)    AND   63900018
639100              (ASC-STORE-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)       63910018
639200                                 = ASC-HLD-STORE-NBR)       AND   63920018
639300              (ASC-TERMINAL      (ASC-BLK-SUB ASC-ITEM-SUB)       63930018
639400                                 = ASC-HLD-TERMINAL)        AND   63940018
639500              (ASC-TRANSACTION   (ASC-BLK-SUB ASC-ITEM-SUB)       63950018
639600                                 = ASC-HLD-TRANSACTION)     AND   63960018
639700              (ASC-AMOUNT        (ASC-BLK-SUB ASC-ITEM-SUB)       63970018
639800                                 = ASC-HLD-TRANS-AMOUNT)          63980018
639900*               SAVE MATCHING REVERSE VOID TIMESTAMP              63990018
640000                MOVE ASC-TRN-AUTH-TMST (ASC-BLK-SUB ASC-ITEM-SUB) 64000018
640100                  TO  ASC-REV-VOID-TMST                           64010018
640200         END-IF                                                   64020018
640300     END-IF.                                                      64030018
640400                                                                  64040018
640500*----------------------------------------------------------------*64050018
640600 9000-DELETE-LOCK.                                                64060018
640700                                                                  64070018
640800     MOVE ASC-KEY-CARD-ID    TO SV005-KMC-ID.                     64080018
640900     EXEC SQL                                                     64090018
641000         DELETE FROM SVT_CRD_ACCT_LCK                             64100018
641100          WHERE CRD_NBR       = :SV005-KMC-ID                     64110018
641200     END-EXEC.                                                    64120018
641300                                                                  64130018
641400     EVALUATE TRUE                                                64140018
641500         WHEN SQLCODE = +0                                        64150018
641600         WHEN SQLCODE = +100                                      64160018
641700         WHEN SQLCODE = -310                                      64170018
641800         WHEN SQLCODE = -904                                      64180018
641900         WHEN SQLCODE = -913                                      64190018
642000             CONTINUE                                             64200018
642100         WHEN OTHER                                               64210018
642200             MOVE '9000-DELETE-LOCK'                              64220018
642300                              TO DP013-PARAGRAPH                  64230018
642400             MOVE 'UPDATE ACTIVITY STATUS'                        64240018
642500                              TO DP013-MESSAGE-TEXT (1)           64250018
642600             MOVE SQLCA       TO DP013-SQLCA                      64260018
642700             MOVE 'SVT_CRD_ACCT_LCK' TO DP013-DB2-TABLE-NAME (1)  64270018
642800             SET DP013-DB2-ABEND                                  64280018
642900                              TO TRUE                             64290018
643000             SET DP013-XCTL-DISPLAY-RESTART                       64300018
643100                              TO TRUE                             64310018
643200             PERFORM DP013-0000-PROCESS-ABEND                     64320018
643300     END-EVALUATE.                                                64330018
643400                                                                  64340018
643500*----------------------------------------------------------------*64350000
643600*    AUTHORIZATION PROCEDURE MODULE.                             *64360000
643700*----------------------------------------------------------------*64370000
643800                                                                  64380000
643900     COPY SVPD005.                                                64390018
644000*----------------------------------------------------------------*64400000
644100*    DATE PROCESSING MODULE                                      *64410000
644200*----------------------------------------------------------------*64420000
644300                                                                  64430000
644400     COPY DPPD017.                                                64440018
644500                                                                  64450018
644600*----------------------------------------------------------------*64460018
644700**  CONVERSION OF CARD NUMBER                                    *64470018
644800*----------------------------------------------------------------*64480018
644900     COPY SVPD007.                                                64490018
645000*----------------------------------------------------------------*64500000
645100*    ABEND PROCESSOR MODULE                                      *64510000
645200*----------------------------------------------------------------*64520000
645300                                                                  64530000
645400     COPY DPPD013.                                                64540018
