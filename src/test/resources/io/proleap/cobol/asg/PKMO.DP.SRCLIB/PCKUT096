000100 TITLE 'PROCESSED FREIGHT FOR EFCS'.                              00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    PCKUT096.                                         00030000
000400 AUTHOR.        JEAN KURK.                                        00040000
000500 DATE-WRITTEN.  OCTOBER, 2011.                                    00050000
000600                                                                  00060000
000700*THIS PROGRAM WILL EXTRACT DATA FOR PROCESSED FREIGHT TO BE       00070000
000800*ADDED TO THE INBOUND CARTON FORECAST REPORTS FOR THE EFCS.       00080000
000900*                                                                 00090000
001000 ENVIRONMENT DIVISION.                                            00100000
001100 INPUT-OUTPUT SECTION.                                            00110000
001200                                                                  00120000
001300 FILE-CONTROL.                                                    00130000
001400     SELECT OUT-EXTRACT-FILE       ASSIGN TO OUT01.               00140000
001500                                                                  00150000
001600 DATA DIVISION.                                                   00160000
001700 FILE SECTION.                                                    00170000
001800                                                                  00180000
001900 FD  OUT-EXTRACT-FILE                                             00190000
002000     RECORDING MODE IS F                                          00200000
002100     LABEL RECORDS ARE STANDARD                                   00210000
002200     BLOCK CONTAINS 0 RECORDS.                                    00220000
002300                                                                  00230000
002400 01  OUT-EXTRACT-RECORD              PIC X(400).                  00240000
002500                                                                  00250000
003300                                                                  00330000
003400 WORKING-STORAGE SECTION.                                         00340000
003500                                                                  00350000
003600 01  WS-RESND-CODE                    PIC S9(04)   VALUE ZERO.    00360000
003700                                                                  00370000
003800 01  WS-PROGRAM-SWITCHES.                                         00380000
003900     05  WS-END-CSR-SW                PIC X(1)   VALUE 'N'.       00390000
004000         88  WS-END-CSR                          VALUE 'Y'.       00400000
004100                                                                  00410000
004200 01  CC-CONTROL-CARD-PARAMETERS.                                  00420000
004300      05 CC-DC-NBR                    PIC 9(04).                  00430000
004400      05 FILLER                       PIC X(76) VALUE SPACE.      00440000
004500                                                                  00450000
004600 01  DK-DATABASE-KEYS.                                            00460000
004700      05 DK-TRIP-ID                   PIC S9(09) COMP VALUE 0.    00470000
004800      05 DK-LOC-NBR                   PIC S9(04) COMP VALUE 0.    00480000
004900      05 DK-KOHLS-LOC-NBR             PIC S9(09) COMP VALUE 0.    00490000
005000                                                                  00500000
005100 01  WS-PROGRAM-VARIABLES.                                        00510000
005200     05  WS-SQLCODE                   PIC 9(9)    VALUE ZERO.     00520000
005300     05  WS-PREV-DC-NBR               PIC 9(4)    VALUE ZERO.     00530000
005400     05  WS-DC-COUNT                  PIC 9(4)    VALUE ZERO.     00540000
005500     05  WS-DISPLAY-NUMBER            PIC 9999999999.             00550000
005600     05  WS-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00560000
005700     05  WS-DISPLAY-TRIP              PIC ZZZZZZZZ9.              00570000
005800     05  WS-FETCH-CNT                 PIC S9(9)   COMP-3          00580000
005900                                                  VALUE ZEROS.    00590000
006000     05  WS-WRITE-COUNT               PIC S9(9)   COMP-3          00600000
006100                                                  VALUE ZEROS.    00610000
006200     05  WS-OPER-UNT-ID               PIC S9(04) COMP SYNC        00620000
006300                                                    VALUE ZERO.   00630000
006400     05  WS-SHIPT-UNT-ID-CNT          PIC S9(09) COMP-3.          00640000
006500     05  WS-WRITE-COUNT2              PIC S9(9)  COMP-3 VALUE 0.  00650000
006600                                                                  00660000
006700     05  WS-WMOS-LOC-NBR.                                         00670000
006800         49  WS-WMOS-LOC-NBR-LEN      PIC S9(4) COMP.             00680000
006900         49  WS-WMOS-LOC-NBR-TEXT     PIC X(50).                  00690000
007000                                                                  00700000
007100     05  WS-LOC-NBR-STRUC.                                        00710000
007200         49 WS-LOC-NBR               PIC 999.                     00720000
007300         49 WS-LOC-NBR-FILL          PIC X(47).                   00730000
007400                                                                  00740000
007500                                                                  00750000
007600 01  WS-DC-COUNT-TABLE.                                           00760000
007700     05  WS-DC-ENTRY                  OCCURS 20 TIMES             00770000
007800                                      INDEXED BY WS-DC-IDX.       00780000
007900         10  WS-DC-NBR                PIC ZZ99.                   00790000
008000         10  WS-DC-COUNTER            PIC S9(9)   COMP-3          00800000
008100                                                  VALUE ZEROS.    00810000
008200 01  PV-PROGRAM-VARIABLES.                                        00820000
008300     05  PV-VEH-NBR-NULL              PIC S9(04) COMP VALUE 0.    00830000
008400                                                                  00840000
008500 01  PC-PROGRAM-CONSTANTS.                                        00850000
008600     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT096'.00860000
008700 01  WS-ABEND-FIELDS.                                             00870000
008800     05  WS-ABEND-CODE                PIC S9(04)   VALUE ZERO.    00880000
008900     05  WS-ABEND-PROGRAM             PIC X(8)   VALUE 'PCKUT096'.00890000
009000     05  WS-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00900000
009100     05  WS-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00910000
009200     05  WS-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    00920000
009300     05  WS-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    00930000
009400     05  WS-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    00940000
009500     05  WS-ABEND-STATUS              PIC XX     VALUE SPACES.    00950000
009600     05  WS-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00960000
009700     05  WS-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00970000
009800     05  WS-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00980000
009900     05  WS-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00990000
010000                                                                  01000000
010200*    EXPORT EXTRACT FILE LAYOUT                                   01020000
010300     COPY PCRD068.                                                01030000
010400                                                                  01040000
010500*    DCLGEN FOR THE PARAMETER TABLE                               01050000
010600     EXEC SQL                                                     01060000
010700         INCLUDE TKRPRPM                                          01070000
010800     END-EXEC                                                     01080000
010900                                                                  01090000
010910*    DCLGEN FOR THE LOCATION XREF TABLE                           01091000
010920     EXEC SQL                                                     01092000
010930         INCLUDE WSV00000                                         01093000
010940     END-EXEC                                                     01094000
010950                                                                  01095000
011000*    DCLGEN FOR THE TSUOBTR TABLE                                 01100000
011100     EXEC SQL                                                     01110000
011200         INCLUDE TSUOBTR                                          01120000
011300     END-EXEC                                                     01130000
011400                                                                  01140000
011500*    DCLGEN FOR THE TSUOBTS TABLE                                 01150000
011600     EXEC SQL                                                     01160000
011700         INCLUDE TSUOBTS                                          01170000
011800     END-EXEC                                                     01180000
011900                                                                  01190000
012000*    DCLGEN FOR THE TCNTRID TABLE                                 01200000
012100     EXEC SQL                                                     01210000
012200         INCLUDE TCNTRID                                          01220000
012300     END-EXEC                                                     01230000
012400                                                                  01240000
012410*    DCLGEN FOR PROCESS FILE TABLE                                01241000
012420     EXEC SQL                                                     01242000
012430         INCLUDE SUT00113                                         01243000
012440     END-EXEC                                                     01244000
012450                                                                  01245000
012500*    DCLGEN FOR XL APPLICATION ID XLT_LOC TABLE                   01250000
012600     EXEC SQL                                                     01260000
012700         INCLUDE XLT00010                                         01270000
012800     END-EXEC                                                     01280000
012900                                                                  01290000
013000*    DCLGEN FOR SUT_TRIP_SUM TABLE                                01300000
013100     EXEC SQL                                                     01310000
013200         INCLUDE SUT00007                                         01320000
013300     END-EXEC                                                     01330000
013400                                                                  01340000
013500*    DCLGEN FOR SUT_OTBND_CART TABLE (OUTBOUND CARTON)            01350000
013600     EXEC SQL                                                     01360000
013700         INCLUDE SUT00024                                         01370000
013800     END-EXEC                                                     01380000
013900                                                                  01390000
014000*    DCLGEN FOR SUT_OTBND_LOC TABLE (SHIPPING UNIT LOCATION)      01400000
014100     EXEC SQL                                                     01410000
014200         INCLUDE SUT00027                                         01420000
014300     END-EXEC                                                     01430000
014400                                                                  01440000
014500*    DCLGEN FOR SUT_OTBND_UPC TABLE                               01450000
014600     EXEC SQL                                                     01460000
014700         INCLUDE SUT00028                                         01470000
014800     END-EXEC                                                     01480000
014900                                                                  01490000
015000*    DCLGEN FOR TSUCDOT TABLE (CARTON DIVERT/OUTBOUND TRIP ASSOC) 01500000
015100     EXEC SQL                                                     01510000
015200         INCLUDE TSUCDOT                                          01520000
015300     END-EXEC                                                     01530000
015400                                                                  01540000
015500*    DCLGEN FOR TSUOBSC TABLE                                     01550000
015600     EXEC SQL                                                     01560000
015700         INCLUDE TSUOBSC                                          01570000
015800     END-EXEC                                                     01580000
015900                                                                  01590000
016000*    DCLGEN FOR TSUCRDV TABLE                                     01600000
016100     EXEC SQL                                                     01610000
016200         INCLUDE TSUCRDV                                          01620000
016300     END-EXEC                                                     01630000
016400                                                                  01640000
016500*    DCLGEN FOR TCNDRST TABLE                                     01650000
016600     EXEC SQL                                                     01660000
016700         INCLUDE TCNDRST                                          01670000
016800     END-EXEC                                                     01680000
016900                                                                  01690000
017000*    DCLGEN FOR TCNDCDR TABLE                                     01700000
017100     EXEC SQL                                                     01710000
017200         INCLUDE TCNDCDR                                          01720000
017300     END-EXEC                                                     01730000
017400                                                                  01740000
017600* CURSOR FOR PROCESSED FREIGHT                                    01760000
017700     EXEC SQL                                                     01770000
017800         DECLARE PROC-FRGT CURSOR FOR                             01780000
017900             SELECT                                               01790000
018000                OBTR.OTBND_TRIP_ID                                01800000
018010              , OBTR.ORGN_OPER_UNT_ID                             01801000
018100              , OBTS.OTBND_STAT_TMST                              01810000
018200              , OBTS.TRIP_STAT_CDE                                01820000
018300              , TRID.SCAC_CDE                                     01830000
018400              , TRID.TRLR_ID                                      01840000
018500              , OBTS.DOOR_ID                                      01850000
018600             FROM                                                 01860000
018700                   TSUOBTR OBTR                                   01870000
018800              ,    TSUOBTS OBTS                                   01880000
018900              ,    TCNTRID TRID                                   01890000
019000             WHERE OBTR.OTBND_TRIP_ID   = OBTS.OTBND_TRIP_ID      01900000
019100               AND OBTR.TRLR_SRL_NBR    = TRID.TRLR_SRL_NBR       01910000
019200               AND OBTR.TRIP_ACTV_CDE   = 'A'                     01920000
019300               AND OBTS.TRIP_STAT_CDE   IN ('DC','DS','DO','SO')  01930000
019400               AND OBTR.DOOR_TYP_CDE    = 'SH'                    01940000
019500               AND OBTR.DEST_OPER_UNT_ID                          01950000
019600                                   = :DK-LOC-NBR                  01960000
019700               AND OBTS.OTBND_STAT_TMST >                         01970000
019800                            (TIMESTAMP(CURRENT TIMESTAMP) -       01980000
019900                                       :KRPRPM-FUNC-QTY DAYS)     01990000
020000               AND OBTS.OTBND_STAT_TMST =                         02000000
020100                       (SELECT MAX(OBTS1.OTBND_STAT_TMST)         02010000
020200                        FROM TSUOBTS OBTS1                        02020000
020300                        WHERE OBTS.OTBND_TRIP_ID =                02030000
020400                                   OBTS1.OTBND_TRIP_ID)           02040000
020500           WITH UR                                                02050000
020600     END-EXEC.                                                    02060000
020800******************************************************************02080000
020900* VARIOUS CURSORS, SELECTS, AND WORKING STORAGE AREAS FOR         02090000
021000* RETRIEVING CARTONS                                              02100000
021100******************************************************************02110000
021200     COPY PCWS049.                                                02120000
021300     COPY PCWS050.                                                02130000
021400                                                                  02140000
021500*  USED FOR DB2 ERROR MESSAGE BUILDING                            02150000
021600     COPY DPWS004.                                                02160000
021700                                                                  02170000
021800*   DB2 SQL COMMUNICATION AREA                                    02180000
021900     EXEC SQL                                                     02190000
022000          INCLUDE SQLCA                                           02200000
022100     END-EXEC.                                                    02210000
022200                                                                  02220000
022300 PROCEDURE DIVISION.                                              02230000
022400                                                                  02240000
022500     PERFORM 1000-INIT.                                           02250000
022600                                                                  02260000
022700     PERFORM 2000-PROCESS-CSR UNTIL WS-END-CSR.                   02270000
022800                                                                  02280000
022900     PERFORM 9000-TERMINATE.                                      02290000
023000                                                                  02300000
023100     GOBACK.                                                      02310000
023200                                                                  02320000
023300 1000-INIT.                                                       02330000
023400                                                                  02340000
023500     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                02350000
023600     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS: '              02360000
023700             CC-CONTROL-CARD-PARAMETERS.                          02370000
023800     MOVE CC-DC-NBR             TO WS-OPER-UNT-ID.                02380000
023900*                                                                 02390000
024000     PERFORM 1100-GET-DAYS.                                       02400000
024100     MOVE CC-DC-NBR             TO DK-KOHLS-LOC-NBR.              02410000
024200     PERFORM 1200-CONVERT-EFC-TO-STORE.                           02420000
024300                                                                  02430000
024400     OPEN OUTPUT OUT-EXTRACT-FILE.                                02440000
024600                                                                  02460000
024700     PERFORM 7000-OPEN-CSR.                                       02470000
024800     PERFORM 7010-FETCH-CSR.                                      02480000
024900                                                                  02490000
025000 1100-GET-DAYS.                                                   02500000
025100                                                                  02510000
025200     EXEC SQL                                                     02520000
025300         SELECT FUNC_QTY                                          02530000
025400           INTO :KRPRPM-FUNC-QTY                                  02540000
025500           FROM TKRPRPM                                           02550000
025600          WHERE LOC_ID            = :WS-OPER-UNT-ID               02560000
025700            AND FUNC_PRC_STAT_CDE = 'AC'                          02570000
025800            AND SYS_PRC_FUNC_CDE  = 'IBFRCS'                      02580000
025900           WITH UR                                                02590000
026000     END-EXEC.                                                    02600000
026100                                                                  02610000
026200     EVALUATE TRUE                                                02620000
026300         WHEN SQLCODE = ZERO                                      02630000
026400             CONTINUE                                             02640000
026500         WHEN SQLCODE = +100                                      02650000
026600             MOVE +30 TO KRPRPM-FUNC-QTY                          02660000
026700         WHEN SQLWARN0 NOT = SPACE                                02670000
026800         WHEN SQLCODE  NOT = ZERO                                 02680000
026900             MOVE '1100-GET-DAYS'      TO WS-ABEND-PARAGRAPH      02690000
027000             MOVE 'SELECT FUNC_QTY'    TO WS-ABEND-OPERATION      02700000
027100             MOVE 'TKRPRPM'            TO WS-ABEND-STRUCTURE-1    02710000
027200             PERFORM 9900-DB2-ABEND                               02720000
027300     END-EVALUATE.                                                02730000
027400                                                                  02740000
027600 1200-CONVERT-EFC-TO-STORE.                                       02760000
027700                                                                  02770000
027800     EXEC SQL                                                     02780000
027900         SELECT WMOS_LOC_NBR                                      02790000
028000           INTO :WS-WMOS-LOC-NBR                                  02800000
028100           FROM WSV_LOC_XREF                                      02810000
028200          WHERE KOHLS_LOC_NBR     = :DK-KOHLS-LOC-NBR             02820000
028300            AND ACTV_IND          = 'Y'                           02830000
028400            AND CURRENT TIMESTAMP                                 02840000
028500                       BETWEEN EFF_BEG_DTE AND EFF_END_DTE        02850000
028600           WITH UR                                                02860000
028700     END-EXEC.                                                    02870000
028800                                                                  02880000
028900     EVALUATE TRUE                                                02890000
029000         WHEN SQLCODE = ZERO                                      02900000
029100             MOVE WS-WMOS-LOC-NBR-TEXT TO WS-LOC-NBR-STRUC        02910000
029200             MOVE WS-LOC-NBR           TO DK-LOC-NBR              02920000
029300             DISPLAY 'STORE NUMBER ' WS-LOC-NBR                   02930000
029400         WHEN SQLCODE = +100                                      02940000
029500             MOVE 0                    TO DK-LOC-NBR              02950000
029600         WHEN SQLWARN0 NOT = SPACE                                02960000
029700         WHEN SQLCODE  NOT = ZERO                                 02970000
029800             MOVE '1200-CONVERT-EFC'   TO WS-ABEND-PARAGRAPH      02980000
029900             MOVE 'SELECT LOC NBR'     TO WS-ABEND-OPERATION      02990000
030000             MOVE 'WSV_LOC_XREF'       TO WS-ABEND-STRUCTURE-1    03000000
030100             PERFORM 9900-DB2-ABEND                               03010000
030200     END-EVALUATE.                                                03020000
030300                                                                  03030000
030400 2000-PROCESS-CSR.                                                03040000
030500                                                                  03050000
030600     INITIALIZE PC068-RECORD-LAYOUT.                              03060000
030700                                                                  03070000
030800     MOVE SUOBTS-OTBND-STAT-TMST TO PC068-ARRIVAL-DATE.           03080000
030900     EVALUATE SUOBTS-TRIP-STAT-CDE                                03090000
031000         WHEN 'DC'                                                03100000
031100             MOVE 'E'            TO PC068-SORT-BY-LOC-IND         03110000
031200         WHEN 'DO'                                                03120000
031300             MOVE 'D'            TO PC068-SORT-BY-LOC-IND         03130000
031400         WHEN 'DS'                                                03140000
031500             MOVE 'F'            TO PC068-SORT-BY-LOC-IND         03150000
031600         WHEN 'SO'                                                03160000
031700             MOVE 'G'            TO PC068-SORT-BY-LOC-IND         03170000
031800         WHEN OTHER                                               03180000
031900             MOVE ' '            TO PC068-SORT-BY-LOC-IND         03190000
032000     END-EVALUATE.                                                03200000
032100     MOVE '3'                    TO PC068-PROCESS-GROUP.          03210000
032200     MOVE 'TLR'                  TO PC068-RECORD-TYPE.            03220000
032300     MOVE WS-OPER-UNT-ID         TO PC068-OPER-UNT-ID             03230000
032310                                    PC068-EFC-NBR.                03231000
032400     MOVE SUOBTR-OTBND-TRIP-ID   TO PC068-TRIP-ID.                03240000
032410     MOVE SUOBTR-ORGN-OPER-UNT-ID TO PC068-CURR-LOC.              03241000
032500     MOVE CNTRID-SCAC-CDE        TO PC068-SCAC.                   03250000
032600     MOVE CNTRID-TRLR-ID         TO PC068-TRLR-NBR.               03260000
032700     MOVE SUOBTS-DOOR-ID         TO PC068-TRLR-LOC.               03270000
032800                                                                  03280000
032900     MOVE SUOBTR-OTBND-TRIP-ID   TO DK-TRIP-ID.                   03290000
032910                                                                  03291000
033000     PERFORM 3100-GET-COUNTS.                                     03300000
033010                                                                  03301000
033100     MOVE SUT00007-CART-QTY      TO PC068-TOT-CTN-CNT             03310000
033110                                    PC068-EFC-CTN-CNT-TRLR.       03311000
033200     MOVE SUT00007-UNT-QTY       TO PC068-UNIT-CNT-TRLR           03320000
033210                                    PC068-EFC-UNT-CNT-TRLR.       03321000
033300                                                                  03330000
033310     PERFORM 3200-GET-PROC-COUNT.                                 03331000
033320                                                                  03332000
033330     MOVE WS-SHIPT-UNT-ID-CNT    TO PC068-REPLEN-CARTON-CNT.      03333000
033350                                                                  03335000
033351*                                                                 03335145
033360* 08/2014 - DMH BEGIN                                             03336045
033370*                                                                 03337045
033371     MOVE ZEROES                 TO PC068-HAZ-CTN-CNT             03337145
033372                                    PC068-HAZ-UNT-CNT             03337245
033373                                    PC068-CNTL-FLOW-CTN-CNT       03337345
033374                                    PC068-CNTL-FLOW-UNT-CNT.      03337445
033375     MOVE ' '                    TO PC068-CNTL-FLOW-SW.           03337545
033380*                                                                 03338045
033390* 08/2014 - DMH BEGIN                                             03339045
033391*                                                                 03339145
033400     PERFORM 8100-WRITE-OUTPUT-REC.                               03340000
033500                                                                  03350000
034500     PERFORM 7010-FETCH-CSR.                                      03450000
034700                                                                  03470000
034800 3100-GET-COUNTS.                                                 03480000
034900                                                                  03490000
035000     EXEC SQL                                                     03500000
035100         SELECT A.CART_QTY,                                       03510000
035200                A.UNT_QTY                                         03520000
035300         INTO   :SUT00007-CART-QTY,                               03530000
035400                :SUT00007-UNT-QTY                                 03540000
035500         FROM   SUT_TRIP_SUM A                                    03550000
035600         WHERE  A.OTBND_TRIP_ID = :DK-TRIP-ID                     03560000
035700         AND    A.CRE_TMST IN                                     03570000
035800                   (SELECT MAX(B.CRE_TMST)                        03580000
035900                    FROM SUT_TRIP_SUM B                           03590000
036000                    WHERE B.OTBND_TRIP_ID =                       03600000
036100                              A.OTBND_TRIP_ID)                    03610000
036110         WITH UR                                                  03611044
036200     END-EXEC.                                                    03620000
036300                                                                  03630000
036400     EVALUATE TRUE                                                03640000
036500         WHEN SQLCODE = ZERO                                      03650000
036600             MOVE DK-TRIP-ID TO WS-DISPLAY-TRIP                   03660000
036700             DISPLAY '3100 SUCCESSFUL ' WS-DISPLAY-TRIP           03670000
036800             CONTINUE                                             03680000
036900         WHEN SQLCODE = +100                                      03690000
037000             MOVE 0  TO SUT00007-CART-QTY                         03700000
037100             MOVE 0  TO SUT00007-UNT-QTY                          03710000
037200         WHEN OTHER                                               03720000
037300             MOVE '3100-GET-TRIP-ID' TO WS-ABEND-PARAGRAPH        03730000
037400             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03740000
037500             MOVE 'TSHIPMT'       TO WS-ABEND-STRUCTURE-1         03750000
037600             PERFORM 9900-DB2-ABEND                               03760000
037700     END-EVALUATE.                                                03770000
037800                                                                  03780000
037810 3200-GET-PROC-COUNT.                                             03781000
037820                                                                  03782000
037900     EXEC SQL                                                     03790000
037910         SELECT COUNT(DISTINCT(SHIPT_UNT_ID))                     03791000
037920           INTO :WS-SHIPT-UNT-ID-CNT                              03792000
037930           FROM SUT_TRLR_RPLN_CART                                03793000
037940         WHERE INBND_TRIP_ID = :DK-TRIP-ID                        03794000
037950           WITH UR                                                03795000
037960     END-EXEC.                                                    03796000
037970                                                                  03797000
037980     EVALUATE TRUE                                                03798000
037990         WHEN SQLCODE = ZERO                                      03799000
037997             CONTINUE                                             03799700
037999         WHEN SQLCODE = +100                                      03799900
038000             CONTINUE                                             03800000
038001         WHEN OTHER                                               03800100
038002             MOVE '3200-GET-PROC-COUNT' TO WS-ABEND-PARAGRAPH     03800200
038003             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03800300
038004             MOVE 'SUT_TRLR_RPLN_CART' TO WS-ABEND-STRUCTURE-1    03800400
038005             PERFORM 9900-DB2-ABEND                               03800500
038006     END-EVALUATE.                                                03800600
038007                                                                  03800700
038010 7000-OPEN-CSR.                                                   03801000
038100                                                                  03810000
038200     EXEC SQL                                                     03820000
038300         OPEN PROC-FRGT                                           03830000
038400     END-EXEC.                                                    03840000
038500                                                                  03850000
038600     EVALUATE TRUE                                                03860000
038700         WHEN SQLCODE = ZERO                                      03870000
038800             CONTINUE                                             03880000
038900         WHEN SQLWARN0 NOT = SPACE                                03890000
039000         WHEN SQLCODE  NOT = ZERO                                 03900000
039100             MOVE '7000-OPEN-CSR'       TO WS-ABEND-PARAGRAPH     03910000
039200             MOVE 'OPEN CURSOR'         TO WS-ABEND-OPERATION     03920000
039300             MOVE 'TSUOBTR'             TO WS-ABEND-STRUCTURE-1   03930000
039400             PERFORM 9900-DB2-ABEND                               03940000
039500     END-EVALUATE.                                                03950000
039600                                                                  03960000
039700 7010-FETCH-CSR.                                                  03970000
039800                                                                  03980000
039900     EXEC SQL                                                     03990000
040000         FETCH PROC-FRGT                                          04000000
040100         INTO                                                     04010000
040200             :SUOBTR-OTBND-TRIP-ID                                04020000
040210         ,   :SUOBTR-ORGN-OPER-UNT-ID                             04021000
040300         ,   :SUOBTS-OTBND-STAT-TMST                              04030000
040400         ,   :SUOBTS-TRIP-STAT-CDE                                04040000
040500         ,   :CNTRID-SCAC-CDE                                     04050000
040600         ,   :CNTRID-TRLR-ID                                      04060000
040700         ,   :SUOBTS-DOOR-ID                                      04070000
040800     END-EXEC.                                                    04080000
040900                                                                  04090000
041000     EVALUATE TRUE                                                04100000
041100         WHEN SQLCODE = ZERO                                      04110000
041200             ADD 1                    TO WS-FETCH-CNT             04120000
041300             PERFORM 7015-READ-TSUCDOT-TABLE                      04130000
041400         WHEN SQLCODE = +100                                      04140000
041500             SET WS-END-CSR           TO TRUE                     04150000
041600         WHEN SQLWARN0 NOT = SPACE                                04160000
041700         WHEN SQLCODE  NOT = ZERO                                 04170000
041800             MOVE '7010-FETCH-CSR'       TO WS-ABEND-PARAGRAPH    04180000
041900             MOVE 'FETCH CURSOR'         TO WS-ABEND-OPERATION    04190000
042000             MOVE 'TSUOBTR'              TO WS-ABEND-STRUCTURE-1  04200000
042100             PERFORM 9900-DB2-ABEND                               04210000
042200     END-EVALUATE.                                                04220000
042300                                                                  04230000
042400*-------------------------------------------------------------    04240000
042500*7015-READ TSUCDOT - CARTON DIVERT/TRIP ASSOCIATION TABLE         04250000
042600*                    TO GET OPER UNIT ID, DOOR ID AND START       04260000
042700*                    / END DIVERT TIMESTAMPS                      04270000
042800*-------------------------------------------------------------    04280000
042900 7015-READ-TSUCDOT-TABLE.                                         04290000
043000                                                                  04300000
043100     EXEC SQL                                                     04310000
043200         SELECT A.OPER_UNT_ID,                                    04320000
043300                A.DOOR_ID,                                        04330000
043400                A.STRT_DIVERT_TMST,                               04340000
043500                A.END_DIVERT_TMST                                 04350000
043600         INTO   :SUCDOT-OTBND-TRIP-ID,                            04360000
043700                :SUCDOT-DOOR-ID,                                  04370000
043800                :SUCDOT-STRT-DIVERT-TMST,                         04380000
043900                :SUCDOT-END-DIVERT-TMST                           04390000
044000         FROM   TSUCDOT A                                         04400000
044100         WHERE  A.OTBND_TRIP_ID = :DK-TRIP-ID                     04410000
044110         WITH UR                                                  04411045
044200     END-EXEC.                                                    04420000
044300                                                                  04430000
044400     EVALUATE TRUE                                                04440000
044500         WHEN SQLCODE = ZERO                                      04450000
044600           MOVE SUCDOT-STRT-DIVERT-TMST TO PC049-DK-START-TMST    04460000
044700           MOVE SUCDOT-END-DIVERT-TMST  TO PC049-DK-END-TMST      04470000
044800           MOVE SUCDOT-OTBND-TRIP-ID    TO PC049-DK-OTBND-TRIP-ID 04480000
044900           MOVE SUCDOT-OPER-UNT-ID      TO PC049-DK-OPER-UNT-ID   04490000
045000           MOVE ZERO                    TO PC049-PV-STORE-01      04500000
045100                                           PC049-PV-STORE-02      04510000
045200                                           PC049-PV-STORE-03      04520000
045300                                           PC049-PV-STORE-04      04530000
045400           PERFORM P3000-DOOR-STR-CSR                             04540000
045500         WHEN SQLCODE = +100                                      04550000
045600           CONTINUE                                               04560000
045610         WHEN SQLCODE = -811                                      04561000
045620           CONTINUE                                               04562000
045700         WHEN OTHER                                               04570000
045800           MOVE '7015-READ-TSUCDOT' TO WS-ABEND-PARAGRAPH         04580000
045900           MOVE 'SELECT'            TO WS-ABEND-OPERATION         04590000
046000           MOVE 'TSUCDOT'           TO WS-ABEND-STRUCTURE-1       04600000
046100           PERFORM 9900-DB2-ABEND                                 04610000
046200     END-EVALUATE.                                                04620000
046300                                                                  04630000
046500 7020-CLOSE-CSR.                                                  04650000
046600     EXEC SQL                                                     04660000
046700         CLOSE PROC-FRGT                                          04670000
046800     END-EXEC.                                                    04680000
046900                                                                  04690000
047000     EVALUATE TRUE                                                04700000
047100         WHEN SQLCODE = ZERO                                      04710000
047200             CONTINUE                                             04720000
047300         WHEN SQLWARN0 NOT = SPACE                                04730000
047400         WHEN SQLCODE  NOT = ZERO                                 04740000
047500             MOVE '7020-CLOSE-CSR'       TO WS-ABEND-PARAGRAPH    04750000
047600             MOVE 'CLOSE CURSOR'         TO WS-ABEND-OPERATION    04760000
047700             MOVE 'TSUOBTR'              TO WS-ABEND-STRUCTURE-1  04770000
047800             PERFORM 9900-DB2-ABEND                               04780000
047900     END-EVALUATE.                                                04790000
048000                                                                  04800000
048200 8100-WRITE-OUTPUT-REC.                                           04820000
048210                                                                  04821000
048300     WRITE OUT-EXTRACT-RECORD  FROM                               04830000
048400                          PC068-RECORD-LAYOUT.                    04840000
048500     ADD 1 TO WS-WRITE-COUNT.                                     04850000
048600                                                                  04860000
049500 9000-TERMINATE.                                                  04950000
049600                                                                  04960000
049700     PERFORM 7020-CLOSE-CSR.                                      04970000
049800                                                                  04980000
049900     CLOSE OUT-EXTRACT-FILE.                                      04990000
050100                                                                  05010000
050600     DISPLAY '************************'.                          05060000
050700     DISPLAY '******* PCKUT096 *******'.                          05070000
050800     DISPLAY '************************'.                          05080000
050900     DISPLAY SPACES                                               05090000
051000                                                                  05100000
052200     MOVE WS-FETCH-CNT          TO WS-DISPLAY-COUNT.              05220000
052300     DISPLAY 'TOTAL RECS FETCHED = ' WS-DISPLAY-COUNT.            05230000
052400                                                                  05240000
052500     MOVE WS-WRITE-COUNT         TO WS-DISPLAY-COUNT.             05250000
052600     DISPLAY 'TOTAL RECORDS WRITTEN TO FILE 1 = '                 05260000
052700                                               WS-DISPLAY-COUNT.  05270000
052800     MOVE WS-WRITE-COUNT2        TO WS-DISPLAY-COUNT.             05280000
052900     DISPLAY 'TOTAL RECORDS WRITTEN TO FILE 2 = '                 05290000
053000                                               WS-DISPLAY-COUNT.  05300000
053100                                                                  05310000
053200     DISPLAY SPACES                                               05320000
053300     DISPLAY '************************'.                          05330000
053500                                                                  05350000
053600 9900-DB2-ABEND.                                                  05360000
053700                                                                  05370000
053800     MOVE SQLCODE TO WS-SQLCODE.                                  05380000
053900     DISPLAY '*** DB2 ERROR '.                                    05390000
054000     DISPLAY '*** SQLCODE   = ' WS-SQLCODE.                       05400000
054100     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 05410000
054200     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               05420000
054300     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               05430000
054400     DISPLAY '*** MESSAGE   = ' WS-DB2-OPERATION-MESSAGE-1.       05440000
054500     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-2.       05450000
054600     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-3.       05460000
054700     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             05470000
054800                                                                  05480000
054900     IF WS-ABEND-STRUCTURE-2 > SPACES                             05490000
055000         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2          05500000
055100     END-IF.                                                      05510000
055200                                                                  05520000
055300     COPY DPPD004.                                                05530000
055400                                                                  05540000
055500     MOVE +4013                  TO WS-ABEND-CODE.                05550000
055600     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         05560000
055700                                                                  05570000
055800***************************************************************** 05580000
055900* PCPD049 - PROCEDURE DIVISION USED TO DETERMINE TRAILER CONTENTS 05590000
056000     COPY PCPD049.                                                05600000
