000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RDKCS021.                                         00020000
000300 AUTHOR.        TODD MICHALEK.                                    00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  MARCH 1996.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*    U021 - STORED VALUE CARD ASSIGNMENT/ISSUE                   *00080000
000900*                                                                *00090000
001000*    ON INITIAL ENTRY THE PROGRAM DISPLAYS THE MAP WITH ALL      *00100000
001100*    FIELDS SPACED OUT.  THE PROGRAM PERFORMS TWO FUNCTIONS:     *00110000
001200*    - THE STORE ASSIGNMENT FUNCTION - THE STARTING CONTROL      *00120000
001300*    NUMBER OR STARTING CARD NUMBER MUST BE ENTERED.             *00130000
001400*    THE USER CAN EITHER ENTER THE NBR OF CARDS, OR THE ENDING   *00140000
001500*    CONTROL OR CARD NBR. IF THE NUMBER OF CARDS IS ENTERED, THE *00150000
001600*    ENDING CNTL NBR IS PLACED IN THE ENDING CNTL NBR FIELD.     *00160000
001700*    THE STORE TO WHICH THE RANGE WILL BE ASSIGNED MUST ALSO BE  *00170000
001800*    ENTERED.  ON ENTRY OR ASSIGN, THE PROGRAM EDITS THE CNTL    *00180000
001900*    NBR.  THE CARDS MUST BE VALID CNTL NBRS ON THE             * 00190000
002000*    SVT_KOHLS_CRD_ACCT TABLE.                                  * 00200000
002100*    ALL THE CARDS WITHIN THE RANGE REQUESTED MUST BE IN         *00210000
002200*    AN "AV" (AVAILABLE) STATUS.  IF THEY ARE NOT, AN ERROR      *00220000
002300*    MESSAGE WILL BE DISPLAYED WITH THE FIRST CNTL NBR IN ERROR  *00230000
002400*    DISPLAYED IN THE ERROR MESSAGE.  IF THEY ARE THE CORRECT    *00240000
002500*    STATUS AND THE ASSIGN FUNCTION WAS PRESSED, THE CARDS WILL  *00250000
002600*    HAVE DISTRIBUTION INFORMATION AND STORE FIELDS UPDATED.     *00260000
002700*                                                                *00270000
002800*    - THE ISSUANCE FUNCTION -  THE STARTING CONTROL NUMBER      *00280000
002900*    OR THE STARTING CARD NUMBER MUST BE ENTERED.                *00290000
003000*    THE USER CAN EITHER ENTER THE NBR OF CARDS, OR ENDING CNTL  *00300000
003100*    OR CARD NUMBER. IF THE NUMBER OF CARDS IS ENTERED, THE      *00310000
003200*    ENDING CNTL NBR IS PLACED IN THE ENDING CNTL NBR FIELD.     *00320000
003300*    THE STORE, TERMINAL, TRANSACTION AND ISSUANCE AMOUNT MUST   *00330000
003400*    ALSO BE ENTERED.  IF THE CARDS ARE PRE-DENOMINATED, THE     *00340000
003500*    DENOMINATION WILL BE RETRIEVED AND PLACED IN THE ISSUE AMT. *00350000
003600*    ON ENTRY OR ISSUE, THE PROGRAM EDITS THE CNTL NUMBERS.      *00360000
003700*    THE CNTL NUMBERS MUST BE VALID CNTL NBRS ON THE             *00370000
003800*    SVT_KOHLS_CRD_ACCT TABLE.                                   *00380000
003900*    ALL THE CARDS WITHIN THE RANGE REQUESTED MUST BE IN         *00390000
004000*    AN "AV" (AVAILABLE) STATUS. IF THEY ARE NOT, AN ERROR       *00400000
004100*    MESSAGE WILL BE DISPLAYED WITH THE FIRST CNTL NBR IN ERROR  *00410000
004200*    DISPLAYED IN THE ERROR MESSAGE.  IF EVERYTHING IS           *00420000
004300*    VALIDATED, THE MESSAGE TO PRESS THE CONFIRM KEY WILL        *00430000
004400*    DISPLAY.  ONCE CONFIRM IS PRESSED, THE CARD NUMBERS         *00440000
004500*    ASSOCIATED WITH THE RANGE OF CONTROL NUMBERS ARE SENT THRU  *00450000
004600*    THE AUTHORIZATION ALGORITHM.  IF A DECLINE IS RETURNED ON   *00460000
004700*    ANY CARD, THE UPDATE WILL NOT BE PERFORMED.  IF ALL CARDS   *00470000
004800*    ARE APPROVED, THE ISSUE ACTIVITY TRANSACTION WILL BE ADDED  *00480000
004900*    FOR EACH CARD ONTO THE SVT_KOHLS_CRD_TXN TABLE.             *00490000
005000******************************************************************00500000
005010*CHANGE HISTORY:                                                  00510007
005020* WR/PBI   DATE        DESCRIPTION OF CHANGES                     00520008
005030* -------  ----------  ----------------------------------------   00530008
005040*  *****   01-30-2014  ACTIVITY STATUS CODE HAS BEEN CHANGED TO   00540008
005041*                      VERIFIED STATUS FOR ALL TRANSACTIONS       00550008
005042*                      ENTERED THROUGH ONLINE AND POSTED          00560008
005043*                      TIMESTAMP FIELD OF SVT_KOHLS_CRD_TXN       00570008
005044*                      TABLE WILL BE INSERTED WITH                00580008
005045*                      CURRENT TIMESTAMP - COGNIZANT              00590008
005046******************************************************************00600008
005010*CHANGE HISTORY:                                                  00610010
005020* WR/PBI     DATE        DESCRIPTION OF CHANGES                   00620010
005030* -------    ----------  ---------------------------------------- 00630010
005040* CHG0141575 05-17-2016  RECOMPILE FOR SVWS004 AND SVRD022        00640011
      *                        ACCENTURE                                00650010
005046******************************************************************00660010
208819*CHANGE HISTORY:                                                  00670013
208819* WR/PBI     DATE        DESCRIPTION OF CHANGES                   00680013
208819* -------    ----------  ---------------------------------------- 00690013
208819* CHG0208819 09-20-2018  MAINFRAME REFACTORING - REPLACE CGU042MC 00700013
208819*                        WITH DPWS036.                            00710013
208819******************************************************************00720013
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293         00721014
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00722014
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00723014
CICS  ******************************************************************00723115
005000*CHANGE HISTORY:                                                  00723215
005000* WR/PBI     DATE        DESCRIPTION OF CHANGES                   00723315
005000* -------    ----------  ---------------------------------------- 00723415
005000* CHG0281369 02-14-2023  JEAN KURK                                00723516
005000*                        CHANGE CALL TO UPC CHECK DIGIT ROUTINE   00723618
005000*                        TO BY DYNAMIC                            00723718
005000******************************************************************00724015
005100 ENVIRONMENT DIVISION.                                            00730000
005200 DATA DIVISION.                                                   00740000
005300 WORKING-STORAGE SECTION.                                         00750000
005400 01  DK-DB2-KEYS.                                                 00760000
005500     05  DK-CRD-PROD-YR          PIC S9(04)V COMP.                00770000
005600     05  DK-SHIPT-REQ-NBR        PIC S9(04)V COMP.                00780000
005700     05  DK-CNTL-NBR             PIC S9(09)V COMP.                00790000
005800     05  DK-CRD-PROD-YR-FROM     PIC S9(04)V COMP.                00800000
005900     05  DK-SHIPT-REQ-NBR-FROM   PIC S9(04)V COMP.                00810000
006000     05  DK-CNTL-NBR-FROM        PIC S9(09)V COMP.                00820000
006100     05  DK-CNTL-NBR-TO          PIC S9(09)V COMP.                00830000
006200     05  DK-STORE-NBR            PIC S9(04) COMP.                 00840000
006300     05  DK-CARD-NBR             PIC S9(12)V COMP-3.              00850000
006400     05  DK-CRD-PROD-YR-KEY      PIC S9(04)V COMP.                00860000
006500     05  DK-SHIPT-REQ-NBR-KEY    PIC S9(04)V COMP.                00870000
006600     05  DK-CNTL-NBR-KEY         PIC S9(09)V COMP.                00880000
006700                                                                  00890000
006800 01  PC-PROGRAM-CONSTANTS.                                        00900000
006900     05  PC-CURRENT-PROGRAM-NAME PIC  X(08)  VALUE 'RDKCS021'.    00910000
007000     05  PC-CURRENT-MAP-NAME     PIC  X(08)  VALUE 'RD021A  '.    00920000
007100     05  PC-CURRENT-MAPSET-NAME  PIC  X(08)  VALUE 'RDKM021 '.    00930000
007200     05  PC-VOID-AUTH                   PIC  X(08)  VALUE         00940008
007300                                                    'RDVOID'.     00950008
007400     05  PC-ISSUE-AUTH                  PIC  X(08)  VALUE         00960000
007500                                                    'RDISSUE'.    00970000
007600     05  PC-TSYMSG-NUMBERS.                                       00980000
007700         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.       00990000
007800         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       01000000
007900         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       01010000
008000         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       01020000
008100         10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       01030000
008200         10  PC-TSYMSG-00017      PIC  9(05)  VALUE  00017.       01040000
008300         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       01050000
008400         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       01060000
008500         10  PC-TSYMSG-00233      PIC  9(05)  VALUE  00233.       01070000
008600         10  PC-TSYMSG-00482      PIC  9(05)  VALUE  00482.       01080000
008700         10  PC-TSYMSG-01207      PIC  9(05)  VALUE  01207.       01090000
008800         10  PC-TSYMSG-01209      PIC  9(05)  VALUE  01209.       01100000
008900         10  PC-TSYMSG-01210      PIC  9(05)  VALUE  01210.       01110000
009000         10  PC-TSYMSG-01212      PIC  9(05)  VALUE  01212.       01120000
009100         10  PC-TSYMSG-01231      PIC  9(05)  VALUE  01231.       01130000
009200         10  PC-TSYMSG-01243      PIC  9(05)  VALUE  01243.       01140000
009300         10  PC-TSYMSG-01366      PIC  9(05)  VALUE  01366.       01150000
009400         10  PC-TSYMSG-01606      PIC  9(05)  VALUE  01606.       01160000
009500         10  PC-TSYMSG-01611      PIC  9(05)  VALUE  01611.       01170000
009600         10  PC-TSYMSG-01613      PIC  9(05)  VALUE  01613.       01180000
009700         10  PC-TSYMSG-02403      PIC  9(05)  VALUE  02403.       01190000
009800         10  PC-TSYMSG-02404      PIC  9(05)  VALUE  02404.       01200000
009900         10  PC-TSYMSG-02405      PIC  9(05)  VALUE  02405.       01210000
010000         10  PC-TSYMSG-02517      PIC  9(05)  VALUE  02517.       01220000
010100         10  PC-TSYMSG-02530      PIC  9(05)  VALUE  02530.       01230000
010200         10  PC-TSYMSG-02920      PIC  9(05)  VALUE  02920.       01240000
010300         10  PC-TSYMSG-02922      PIC  9(05)  VALUE  02922.       01250000
010400         10  PC-TSYMSG-03141      PIC  9(05)  VALUE  03141.       01260000
010410         10  PC-TSYMSG-03762      PIC  9(05)  VALUE  03762.       01270009
010500         10  PC-TSYMSG-99910      PIC  9(05)  VALUE  99910.       01280000
010600     05  PC-MAXIMUM-SEQ-NBR       PIC  9(06)  VALUE 999999.       01290000
010900     05  PC-OLD-SAFEWAY           PIC  X(07)  VALUE '1110212'.    01320000
011000                                                                  01330000
011100 01  PS-PROGRAM-SWITCHES.                                         01340000
011200     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01350000
011300         88  PS-ERROR                         VALUE  'Y'.         01360000
011400         88  PS-NO-ERROR                      VALUE  'N'.         01370000
011500     05  PS-DB2-ERROR-SW          PIC  X(01)  VALUE  'N'.         01380000
011600         88  PS-DB2-ERROR                     VALUE  'Y'.         01390000
011700         88  PS-NO-DB2-ERROR                  VALUE  'N'.         01400000
011800     05  PS-NBR-REQESTED-SW       PIC  X(01)  VALUE  'N'.         01410000
011900         88  PS-NBR-REQUESTED-CHANGED         VALUE  'Y'.         01420000
012000         88  PS-NBR-REQUESTED-NOT-CHANGED     VALUE  'N'.         01430000
012100     05  PS-TO-CNTL-SW            PIC  X(01)  VALUE  'N'.         01440000
012200         88  PS-TO-CNTL-CHANGED               VALUE  'Y'.         01450000
012300         88  PS-TO-CNTL-NOT-CHANGED           VALUE  'N'.         01460000
012400     05  PS-FROM-CNTL-SW          PIC  X(01)  VALUE  'N'.         01470000
012500         88  PS-FROM-CNTL-CHANGED             VALUE  'Y'.         01480000
012600         88  PS-FROM-CNTL-NOT-CHANGED         VALUE  'N'.         01490000
012700     05  PS-TO-NMBR-SW            PIC  X(01)  VALUE  'N'.         01500000
012800         88  PS-TO-NMBR-CHANGED               VALUE  'Y'.         01510000
012900         88  PS-TO-NMBR-NOT-CHANGED           VALUE  'N'.         01520000
013000     05  PS-FROM-NMBR-SW          PIC  X(01)  VALUE  'N'.         01530000
013100         88  PS-FROM-NMBR-CHANGED             VALUE  'Y'.         01540000
013200         88  PS-FROM-NMBR-NOT-CHANGED         VALUE  'N'.         01550000
013300     05  PS-CONTROL-NBR-SW        PIC  X(01)  VALUE  'N'.         01560000
013400         88  PS-CONTROL-NBR-ERROR             VALUE  'Y'.         01570000
013500         88  PS-NO-CONTROL-NBR-ERROR          VALUE  'N'.         01580000
013600     05  PS-END-OF-CARD-CSR-SW    PIC  X(01)  VALUE  'N'.         01590000
013700         88  PS-END-OF-CARD-CSR               VALUE  'Y'.         01600000
013800         88  PS-NOT-END-OF-CARD-CSR           VALUE  'N'.         01610000
013900     05  PS-END-OF-VOIDS-CSR-SW    PIC  X(01) VALUE  'N'.         01620000
014000         88  PS-END-OF-VOIDS-CSR              VALUE  'Y'.         01630000
014100         88  PS-NOT-END-OF-VOIDS-CSR          VALUE  'N'.         01640000
014200     05  PS-VALID-CARD-SW          PIC  X(01) VALUE  'N'.         01650000
014300         88  PS-VALID-CARD                    VALUE  'Y'.         01660000
014400         88  PS-INVALID-CARD                  VALUE  'N'.         01670000
014500     05  PS-CRDSTK-CDE-FOUND-SW    PIC  X(01) VALUE  'N'.         01680000
014600         88  PS-CRDSTK-CDE-FOUND              VALUE  'Y'.         01690000
014700         88  PS-CRDSTK-CDE-NOT-FOUND          VALUE  'N'.         01700000
014800     05  PS-FROM-CARD-NBR-SW       PIC  X(01) VALUE  'N'.         01710000
014900         88  PS-FROM-CARD-NBR-YES             VALUE  'Y'.         01720000
015000         88  PS-FROM-CARD-NBR-NO              VALUE  'N'.         01730000
015100                                                                  01740000
015200 01  PV-PROGRAM-VARIABLES.                                        01750000
015300     05  PV-RESP                 PIC S9(4)   COMP.                01760000
015400     05  PV-DATE                 PIC  X(10)  VALUE SPACES.        01770000
015500     05  PV-TIME                 PIC  X(08)  VALUE SPACES.        01780000
015600     05  PV-VALID-CARD-ARRAY     PIC  X(01)  VALUE SPACES.        01790000
015700     05  PV-INVALID-VOID-CARDS   PIC S9(12)V COMP-3.              01800000
015800     05  PV-INVALID-CNTL-NBR     PIC S9(09)V COMP.                01810000
015900     05  PV-CNTL-NBR             PIC  9(14)  VALUE ZERO.          01820000
016000     05  PV-CNTL-NBR-R REDEFINES PV-CNTL-NBR.                     01830000
016100         10  PV-REQ-DTE          PIC  9(04).                      01840000
016200         10  PV-REQ-DTE-R REDEFINES PV-REQ-DTE.                   01850000
016300             15  PV-REQ-DTE-CC   PIC 99.                          01860000
016400             15  PV-REQ-DTE-YY   PIC 99.                          01870000
016500         10  PV-REQ-NBR          PIC  9(04).                      01880000
016600         10  PV-SEQ-NBR          PIC  9(06).                      01890000
016700                                                                  01900000
016800     05  PV-CNTL-NBR-FROM        PIC  9(14)  VALUE ZERO.          01910000
016900     05  PV-START-CNTL-NBR REDEFINES PV-CNTL-NBR-FROM.            01920000
017000         10  PV-START-REQ-DTE    PIC  9(04).                      01930000
017100         10  PV-START-REQ-DTE-R REDEFINES PV-START-REQ-DTE.       01940000
017200             15  PV-START-REQ-DTE-CC PIC 99.                      01950000
017300             15  PV-START-REQ-DTE-YY PIC 99.                      01960000
017400         10  PV-START-REQ-NBR    PIC  9(04).                      01970000
017500         10  PV-START-SEQ-NBR    PIC  9(06).                      01980000
017600     05  PV-CNTL-NBR-TO          PIC  9(14)  VALUE ZERO.          01990000
017700     05  PV-ENDING-CNTL-NBR REDEFINES PV-CNTL-NBR-TO.             02000000
017800         10  PV-ENDING-REQ-DTE   PIC  9(04).                      02010000
017900         10  PV-ENDING-REQ-DTE-R REDEFINES PV-ENDING-REQ-DTE.     02020000
018000             15  PV-ENDING-REQ-DTE-CC PIC 99.                     02030000
018100             15  PV-ENDING-REQ-DTE-YY PIC 99.                     02040000
018200         10  PV-ENDING-REQ-NBR   PIC  9(04).                      02050000
018300         10  PV-ENDING-SEQ-NBR   PIC  9(06).                      02060000
018400                                                                  02070000
018500     05  PV-HOLD-SEQ-NBR         PIC  9(08)  VALUE ZEROS.         02080000
018600     05  PV-HOLD-NBR-REQUESTED   PIC  9(08)  VALUE ZEROS.         02090000
018700     05  PV-CRD-TYP-CDE          PIC S9(01)  COMP-3 VALUE ZERO.   02100000
018800     05  PV-NBR                  PIC  9(14)  VALUE ZERO.          02110000
018900     05  PV-PRE-DNNTD-CRD-AMT    PIC S9(07)V99                    02120000
019000                                             VALUE ZEROS          02130000
019100                                             COMP-3.              02140000
019200     05  PV-WORK-GIFT-CARD-ID.                                    02150000
019300         10  PV-WORK-CARD-ID-PREFIX      PIC  X(02).              02160000
019400         10  PV-WORK-CARD-ID             PIC  X(10).              02170000
019500         10  PV-WORK-CARD-ID-CHECK-DIGIT PIC  X(01).              02180000
019600     05  PV-WORK-GIFT-CARD-ID-REDEF                               02190000
019700                      REDEFINES PV-WORK-GIFT-CARD-ID PIC 9(13).   02200000
019800                                                                  02210000
019900     05  PV-CARD-NBR             PIC S9(12)V COMP-3.              02220000
020000     05  PV-30-DIGIT-CARD-NBR.                                    02230000
020100         10 PV-30-DIGIT-UPC              PIC  9(11) VALUE ZEROES. 02240000
020200         10  PV-19-DIGIT-CARD-NBR.                                02250000
020300           15  PV-19-DIGIT-KOHLS-BIN-NBR PIC  9(06) VALUE ZEROES. 02260000
020400           15  PV-19-DIGIT-CARD-TYPE     PIC  9(01) VALUE ZEROES. 02270000
020500           15  PV-19-DIGIT-ACCOUNT-NBR   PIC  9(12) VALUE ZEROES. 02280000
020600           15  PV-19-DIGIT-ACCOUNT-NBR-R                          02290000
020700                              REDEFINES PV-19-DIGIT-ACCOUNT-NBR.  02300000
020800              20 PV-19-DIGIT-NBR-2       PIC X(2).                02310000
020900              20 PV-19-DIGIT-NBR-10      PIC X(10).               02320000
021000         10  PV-19-DIGIT-CARD-NBR-REDEF                           02330000
021100             REDEFINES PV-19-DIGIT-CARD-NBR PIC 9(19).            02340000
021200                                                                  02350000
021300     05  PV-CRD-STK-TYP-ID                 PIC  X(08).            02360008
021400     05  PV-CRD-STK-TYP-SPLIT REDEFINES PV-CRD-STK-TYP-ID.        02370000
021500         10  PV-CRD-STK-ID-3CHAR           PIC  X(03).            02380000
021600             88 PV-CARD-STOCK-SAFEWAY      VALUE 'SAF', 'SWH'.    02390000
021700         10  FILLER                        PIC  X(05).            02400000
021800                                                                  02410000
021900*----------------------------------------------------------------*02420000
022000*    MAP LAYOUT                                                  *02430000
022100*----------------------------------------------------------------*02440000
022200     COPY RDKM021.                                                02450000
022300*----------------------------------------------------------------*02460000
022400*    ATTRIBUTE SETTINGS COPYBOOK.                                *02470000
022500*----------------------------------------------------------------*02480000
022600     COPY DPWS015.                                                02490000
022700*----------------------------------------------------------------*02500000
022800*    FUNCTION KEYS COPYBOOK                                      *02510000
022900*----------------------------------------------------------------*02520000
023000     COPY DPWS016.                                                02530000
023100**--------------------------------------------------------------**02540000
023200** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **02550000
023300** SUB-ROUTINE (DPKUT100).                                      **02560000
023400**--------------------------------------------------------------**02570000
023500     COPY DPWS010I.                                               02580000
023600**--------------------------------------------------------------**02590000
023700** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*02600000
023800** APPLICATION PROGRAMMING INTERFACE MODULE.                    **02610014
023900**--------------------------------------------------------------**02620000
024000     COPY DPWS030.                                                02630000
CICS       COPY DPWS930.                                                02631014
024100*----------------------------------------------------------------*02640000
024200*    CURRENT DATE AND TIME COPYBOOK                              *02650000
024300*----------------------------------------------------------------*02660000
024400     COPY DPWS017.                                                02670000
024500*----------------------------------------------------------------*02680000
024600* STORED VALUE CARD CONSTANTS                                    *02690000
024700*----------------------------------------------------------------*02700000
024800     COPY SVWS004.                                                02710000
024900*----------------------------------------------------------------*02720000
025000* STORED VALUE APPROVAL NUMBER WORKING STORAGE AREA              *02730000
025100*----------------------------------------------------------------*02740000
025200     COPY SVWS006.                                                02750000
025300*----------------------------------------------------------------*02760000
025400* CONVERT CARD NUMBER WORKING STORAGE AREA                       *02770000
025500*----------------------------------------------------------------*02780000
025600     COPY SVWS007.                                                02790000
025700*----------------------------------------------------------------*02800000
025800* CHECK DIGIT ROUTINE - USED BY THE AUTH MODULE                  *02810000
025900*----------------------------------------------------------------*02820000
208819     COPY DPWS036.                                                02830013
026100*----------------------------------------------------------------*02840000
026200*   UPC CHECK DIGIT ROUTINE PARAMETER LIST LAYOUT                *02850018
026300*----------------------------------------------------------------*02860000
026400     COPY DPWS040I.                                               02870000
026500**--------------------------------------------------------------**02880000
026600*    STANDARD COMMAREA.                                           02890000
026700**--------------------------------------------------------------**02900000
026800     COPY DPWS020.                                                02910000
026900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02920000
027000***************************************************************** 02930000
027100* INTER-APPLICATION COMMAREA.                                   * 02940000
027200***************************************************************** 02950000
027300         10  INTER-APPL-COMM-AREA PIC X(200).                     02960000
027400     COPY RDWS030.                                                02970000
027500***************************************************************** 02980000
027600*    SPECIFIC COMMMAREA FOR RDKCS021.                             02990000
027700***************************************************************** 03000000
027800         10  ASC-SPECIFIC-COMMAREA.                               03010000
027900             15  ASC-CNTL-FROM             PIC  X(14).            03020000
028000             15  ASC-CNTL-FROM-9 REDEFINES ASC-CNTL-FROM          03030000
028100                                           PIC  9(14).            03040000
028200             15  ASC-CNTL-TO               PIC  X(14).            03050000
028300             15  ASC-CNTL-TO-9 REDEFINES ASC-CNTL-TO              03060000
028400                                           PIC  9(14).            03070000
028500             15  ASC-NMBR-FROM             PIC X(30).             03080000
028600             15  ASC-NMBR-FROM-9 REDEFINES ASC-NMBR-FROM          03090000
028700                                           PIC 9(30).             03100000
028800             15  ASC-NMBR-TO               PIC X(30).             03110000
028900             15  ASC-NMBR-TO-9 REDEFINES ASC-NMBR-TO              03120000
029000                                           PIC 9(30).             03130000
029100             15  ASC-REQUESTED-STORE       PIC  X(05).            03140000
029200             15  ASC-REQUESTED-STORE-9  REDEFINES                 03150000
029300                 ASC-REQUESTED-STORE       PIC  9(05).            03160000
029400             15  ASC-REQUESTED-STORE-NAME  PIC  X(20).            03170000
029500             15  ASC-CRD-TYP-CDE           PIC S9(01)  COMP-3.    03180000
029600             15  ASC-CRD-TYP-DESC          PIC  X(20).            03190000
029700             15  ASC-NUMBER-REQUESTED      PIC  X(06).            03200000
029800             15  ASC-NUMBER-REQUESTED-9  REDEFINES                03210000
029900                 ASC-NUMBER-REQUESTED      PIC  9(06).            03220000
030000             15  ASC-ISSUE-STORE           PIC  X(05).            03230000
030100             15  ASC-ISSUE-STORE-9  REDEFINES                     03240000
030200                 ASC-ISSUE-STORE           PIC  9(05).            03250000
030300             15  ASC-ISSUE-STORE-NAME      PIC  X(20).            03260000
030400             15  ASC-TERMINAL              PIC  X(04).            03270000
030500             15  ASC-TERMINAL-9  REDEFINES  ASC-TERMINAL          03280000
030600                                           PIC  9(04).            03290000
030700             15  ASC-TRANSACTION           PIC  X(04).            03300000
030800             15  ASC-TRANSACTION-9  REDEFINES  ASC-TRANSACTION    03310000
030900                                           PIC  9(04).            03320000
031000             15  ASC-ISSUE-AMOUNT          PIC  X(07).            03330000
031100             15  ASC-ISSUE-AMOUNT-9        PIC  9(04)V99.         03340000
031200             15  ASC-ADD-SW                PIC  X(01).            03350000
031300                 88  ASC-ADD                           VALUE 'Y'. 03360000
031400                 88  ASC-NO-ADD                        VALUE ' '. 03370000
031500             15  ASC-PRE-DNNTD-CRD-AMT     PIC  9(07)V99.         03380000
031600             15  ASC-FIRSTTIME-SW          PIC  X(01).            03390000
031700                 88  ASC-FIRSTTIME                     VALUE 'Y'. 03400000
031800                 88  ASC-NOT-FIRSTTIME                 VALUE 'N'. 03410000
031900             15  ASC-CARD-CONTROL-SW       PIC  X(01).            03420000
032000                 88  ASC-CARD-NBR                      VALUE 'N'. 03430000
032100                 88  ASC-CNTL-NBR                      VALUE 'C'. 03440000
032200             15  ASC-REQSTED-STORE         PIC  X(01).            03450000
032300                 88 REQUESTED-STORE-FIRST-TIME         VALUE 'N'. 03460000
032400                 88 REQUESTED-STORE-MISSING            VALUE 'Y'. 03470000
032500                                                                  03480000
032600             15  ASC-CONFIRM-THE-VOIDS-SW  PIC X(01).             03490000
032700                 88  ASC-CONFIRM-THE-VOIDS            VALUE  'Y'. 03500000
032800                 88  ASC-CONFIRM-NO-VOIDS             VALUE  'N'. 03510000
032900                                                                  03520000
033000             15  ASC-ALL-VOIDS-ARE-VALID-SW PIC X(01).            03530000
033100                 88  ASC-ALL-VOIDS-ARE-VALID          VALUE  'Y'. 03540000
033200                 88  ASC-ALL-VOIDS-NOT-VALID          VALUE  'N'. 03550000
033300                                                                  03560000
033400             15  ASC-VALID-SECURITY-SW     PIC X(01).             03570000
033500                 88  ASC-VALID-SECURITY               VALUE  'Y'. 03580000
033600                 88  ASC-INVALID-SECURITY             VALUE  'N'. 03590000
033700                                                                  03600000
033800             15  ASC-ST-CDE                 PIC X(02).            03610000
033900         10  FILLER                        PIC  X(2661).          03620000
034000*----------------------------------------------------------------*03630000
034100*    ABEND PROCESSING COPYBOOK.                                  *03640000
034200*----------------------------------------------------------------*03650000
034300     COPY DPWS013.                                                03660000
034400                                                                  03670000
034500*----------------------------------------------------------------*03680000
034600*    WORK AREA FOR THE CICSAUTH SUBROUTINE.                      *03690000
034700*----------------------------------------------------------------*03700000
034800     COPY DPWS008.                                                03710000
034900                                                                  03720000
035000*    DB2 AREA FOR SVT_CRD_PROD                                    03730000
035100                                                                  03740000
035200     EXEC SQL                                                     03750000
035300          INCLUDE SVT00000                                        03760000
035400     END-EXEC.                                                    03770000
035500                                                                  03780000
035600*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                              03790000
035700     EXEC SQL                                                     03800000
035800          INCLUDE SVT00001                                        03810000
035900     END-EXEC.                                                    03820000
036000                                                                  03830000
036100*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                               03840000
036200     EXEC SQL                                                     03850000
036300          INCLUDE SVT00002                                        03860000
036400     END-EXEC.                                                    03870000
036500                                                                  03880000
036600*    DB2 AREA FOR SVT_CRD_ACCT_LCK                                03890000
036700     EXEC SQL                                                     03900000
036800          INCLUDE SVT00004                                        03910000
036900     END-EXEC.                                                    03920000
037000                                                                  03930000
037100*    DB2 AREA FOR SVT_CRD_STK_DNMNTN                              03940000
037200     EXEC SQL                                                     03950000
037300          INCLUDE SVT00008                                        03960000
037400     END-EXEC.                                                    03970000
037500                                                                  03980000
037600*    DB2 AREA FOR COMMUNICATIONS                                  03990000
037700     EXEC SQL                                                     04000000
037800          INCLUDE SQLCA                                           04010000
037900     END-EXEC.                                                    04020000
038000*----------------------------------------------------------------*04030000
038100* AUTHORIZATION MODULE WORKING STORAGE AREA                      *04040000
038200*----------------------------------------------------------------*04050000
038300     COPY SVWS005.                                                04060000
038400*                                                                 04070000
038500*    CURSOR TO GET ALL THE CARDS FOR A RANGE OF CONTROL NUMBERS   04080000
038600     EXEC SQL                                                     04090000
038700          DECLARE CARD-CSR CURSOR                                 04100000
038800          FOR SELECT                                              04110000
038900              CRD_PROD_YR                                         04120000
039000            , SHIPT_REQ_NBR                                       04130000
039100            , CNTL_NBR                                            04140000
039200            , CRD_NBR                                             04150000
039300            , CRD_DISTRB_DTE                                      04160000
039400            , CRD_DISTRB_TM                                       04170000
039500            , DISTRB_USR_ID                                       04180000
039600          FROM SVT_KOHLS_CRD_ACCT                                 04190000
039700          WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM            04200000
039800            AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM          04210000
039900            AND (CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND           04220000
040000                                  :DK-CNTL-NBR-TO)                04230000
040100          ORDER BY CRD_PROD_YR, SHIPT_REQ_NBR, CNTL_NBR           04240000
040200          WITH UR                                                 04250000
040300     END-EXEC.                                                    04260000
040400                                                                  04270000
040500*    CURSOR TO GET ALL THE VOIDS FOR A RANGE OF CONTROL NUMBERS   04280000
040600     EXEC SQL                                                     04290000
040700          DECLARE VOIDS-CSR CURSOR                                04300000
040800          FOR SELECT                                              04310000
040900             B.CRD_NBR                                            04320000
041000            , B.TRN_AUTH_TMST                                     04330000
041100            , B.DRV_LIC_NBR                                       04340000
041200            , B.TRN_RVRSL_CDE                                     04350000
041300            , B.TRN_VOID_IND                                      04360000
041400            , B.ACTVY_TYP_CDE                                     04370000
041500            , B.POS_DTE                                           04380000
041600            , B.STR_NBR                                           04390000
041700            , B.POS_TRMNL_NBR                                     04400000
041800            , B.POS_TRN_NBR                                       04410000
041900            , B.TRN_PSTD_TMST                                     04420000
042000            , B.APP_AUTH_AMT                                      04430000
042100            , B.POS_OPRT_ID                                       04440000
042200            , B.APVL_USR_ID                                       04450000
042300            , B.ACTVY_STAT_CDE                                    04460000
042400            , B.ORIG_AUTH_AMT                                     04470000
042500          FROM SVT_KOHLS_CRD_ACCT      A                          04480000
042600              ,SVT_KOHLS_CRD_TXN       B                          04490000
042700          WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM            04500000
042800            AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM          04510000
042900            AND CNTL_NBR BETWEEN                                  04520000
043000                :DK-CNTL-NBR-FROM AND  :DK-CNTL-NBR-TO            04530000
043100            AND A.CRD_NBR       = B.CRD_NBR                       04540000
043200            AND B.TRN_VOID_IND  <> :SV004-VOID-TRANS              04550000
043300            AND B.APVL_USR_ID   <> :DP020-USERID                  04560000
043400          WITH UR                                                 04570000
043500     END-EXEC.                                                    04580000
043600                                                                  04590000
043700*----------------------------------------------------------------*04600000
043800* SELECT ALL TRANSACTIONS FOR CARD RANGE TO FIND OUT IF EACH CARD*04610000
043900* HAS ONE AND ONLY ONE TRANSACTION.                              *04620000
044000* SELECT:                                                        *04630000
044100*   HAS A SUB SELECT WHERE THE RESULTS SET IS PUT INTO A VIRTUAL *04640000
044200*   TABLE AND THEN THOSE RESULTS ARE EVALUATED FOR VALUES OF     *04650000
044300*   0 OR > 1.                                                    *04660000
044400*                                                                *04670000
044500* IF ALL CARDS MEET THE ONE AND ONLY ONE TRANSACTION RULE THEN   *04680000
044600* A SWITCH IS SET TO CONTINUE TO PROCESS                         *04690000
044700*----------------------------------------------------------------*04700000
044800*    CURSOR TO GET ALL THE CNTL NUMBERS OF CARDS WITH TRANSACTION 04710000
044900*    EQUAL TO 0 OR GREATER THAN 1.                                04720000
045000     EXEC SQL                                                     04730000
045100          DECLARE INVALID-CSR CURSOR                              04740000
045200          FOR SELECT  VT1.CRD_NBR ,VT1.CNTL_NBR                   04750000
045300               FROM (                                             04760000
045400                 SELECT A.CRD_NBR                                 04770000
045500                        ,A.CNTL_NBR                               04780000
045600                        ,COALESCE(COUNT(*),0 ) AS PV_TXN_CNT      04790000
045700                   FROM SVT_KOHLS_CRD_ACCT A                      04800000
045800                        LEFT OUTER JOIN SVT_KOHLS_CRD_TXN B       04810000
045900                      ON A.CRD_NBR       =  B.CRD_NBR             04820000
046000                   WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM   04830000
046100                     AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM 04840000
046200                     AND (CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND  04850000
046300                                           :DK-CNTL-NBR-TO)       04860000
046400                     AND A.CRD_STAT_CDE  = 'AV'                   04870000
046500                GROUP BY A.CRD_NBR ,A.CNTL_NBR) AS VT1            04880000
046600               WHERE PV_TXN_CNT > 1                               04890000
046700               OR PV_TXN_CNT = 0                                  04900000
046800               ORDER BY 2                                         04910000
046900         WITH UR                                                  04920000
047000     END-EXEC.                                                    04930000
047100                                                                  04940000
047200 LINKAGE SECTION.                                                 04950000
047300 01  DFHCOMMAREA.                                                 04960000
047400     05  FILLER                         OCCURS  1 TO 4072 TIMES   04970000
047500                                        DEPENDING ON EIBCALEN.    04980000
047600         10  FILLER                     PIC X.                    04990000
047700                                                                  05000000
047800 PROCEDURE DIVISION.                                              05010000
047900***************************************************************** 05020000
048000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 05030000
048100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 05040000
048200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 05050000
048300**                                                             ** 05060000
048400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 05070000
048500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 05080000
048600***************************************************************** 05090000
048700 0000-MAIN-MODULE.                                                05100000
048800     INITIALIZE DP030-CICS-API-FIELDS.                            05110000
048900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05120000
049000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05130000
049100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05140000
049200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05150000
049300     MOVE LENGTH OF RD021AI        TO DP030-MAP-LENGTH (1).       05160000
049400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05170000
049500     PERFORM 0001-CALL-CICS-ARCH-API.                             05180000
049600*                                                                 05190000
049700     PERFORM 1000-CONTROL-PROCESSING.                             05200000
049800*                                                                 05210000
049900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05220000
050000     PERFORM 0001-CALL-CICS-ARCH-API.                             05230000
050100                                                                  05240000
050200 0001-CALL-CICS-ARCH-API.                                         05250000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05260014
050400                                    DFHCOMMAREA                   05270014
050500                                    DP030-CICS-API-FIELDS         05280014
050600                                    DP020-STANDARD-COMMAREA       05290014
050700                                    RD021AI.                      05300014
050800                                                                  05310000
050900     IF  DP030-RC-CALL-SUCCESSFUL                                 05320000
051000         CONTINUE                                                 05330000
051100     ELSE                                                         05340000
051200         SET DP013-NO-ROLLBACK                                    05350000
051300             DP013-XCTL-DISPLAY-RESTART                           05360000
051400             DP013-CICS-ABEND      TO TRUE                        05370000
051500         MOVE 'BEFORE 0000-MAIN-MODULE'                           05380000
051600                                   TO DP013-PARAGRAPH             05390000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05391014
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05392014
051900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05420000
052000         PERFORM DP013-0000-PROCESS-ABEND                         05430000
052100     END-IF.                                                      05440000
052200*----------------------------------------------------------------*05450000
052300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *05460000
052400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *05470000
052500*----------------------------------------------------------------*05480000
052600 1000-CONTROL-PROCESSING.                                         05490000
052700                                                                  05500000
052800     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       05510000
052900                                                                  05520000
053000     EVALUATE TRUE                                                05530000
053100         WHEN DP020-NEXT-ACT-INITIAL                              05540000
053200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05550000
053300             SET ASC-FIRSTTIME                                    05560000
053400                 REQUESTED-STORE-FIRST-TIME TO TRUE               05570000
053500             MOVE SV004-CORPORATE-LOCATION                        05580000
053600                                         TO ASC-ISSUE-STORE-9     05590000
053700             PERFORM 4000-BUILD-INITIAL-PANEL                     05600000
053800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05610000
053900                                                                  05620000
054000         WHEN DP020-NEXT-ACT-READ-MAP                             05630000
054100             PERFORM 2000-PROCESS-PANEL                           05640000
054200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05650000
054300                                                                  05660000
054400         WHEN DP020-NEXT-ACT-RETURN                               05670000
054500             MOVE RD030-FROM-30-DIGT-CRD-NBR TO ASC-NMBR-FROM     05680000
054600             MOVE RD030-TO-30-DIGT-CRD-NBR   TO ASC-NMBR-TO       05690000
054700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05700000
054800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05710000
054900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05720000
055000         WHEN OTHER                                               05730000
055100             SET DP013-LOGIC-ABEND                                05740000
055200                 DP013-NO-ROLLBACK TO TRUE                        05750000
055300             MOVE '1000-CONTROL-PROCESSING'                       05760000
055400                                   TO DP013-PARAGRAPH             05770000
055500             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   05780000
055600                                   TO DP013-MESSAGE-TEXT(1)       05790000
055700             MOVE DP020-NEXT-APPL-ACTIVITY                        05800000
055800                                   TO DP013-MESSAGE-TEXT(2)       05810000
055900             PERFORM DP013-0000-PROCESS-ABEND                     05820000
056000     END-EVALUATE.                                                05830000
056100*----------------------------------------------------------------*05840000
056200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05850000
056300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05860000
056400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05870000
056500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05880000
056600* FUNCTION KEYS CAN GET THIS FAR.                                *05890000
056700*----------------------------------------------------------------*05900000
056800 2000-PROCESS-PANEL.                                              05910000
056900                                                                  05920000
057000     EVALUATE TRUE                                                05930000
057100                                                                  05940000
057200         WHEN DP020-SRC-AID = DP016-CLEAR                         05950000
057300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05960000
057400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05970000
057500                                                                  05980000
057600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05990000
057700             INITIALIZE ASC-SPECIFIC-COMMAREA                     06000000
057800             SET ASC-FIRSTTIME                                    06010000
057900                 REQUESTED-STORE-FIRST-TIME TO TRUE               06020000
058000             MOVE SV004-CORPORATE-LOCATION                        06030000
058100                                         TO ASC-ISSUE-STORE-9     06040000
058200             PERFORM 4000-BUILD-INITIAL-PANEL                     06050000
058300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06060000
058400             PERFORM 3200-RESET-ATTRIBUTES                        06070000
058500* PRINT ORDER                                                     06080000
058600         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              06090000
058700             IF ASC-ADD                                           06100000
058800                 SET ASC-NO-ADD   TO TRUE                         06110000
058900             END-IF                                               06120000
059000                                                                  06130000
059100         WHEN OTHER                                               06140000
059200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06150000
059300* CLEAR OUT STORE DESCRIPTION IF, AFTER A STORE FUNCTION UPDATE,  06160000
059400*   THE STORE NUMBER IS NO LONG ENTERED                           06170000
059500             IF ASC-REQUESTED-STORE = SPACES                      06180000
059600                 MOVE SPACES     TO ASC-REQUESTED-STORE-NAME      06190000
059700                                    ADSTRNO                       06200000
059800             END-IF                                               06210000
059900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06220000
060000             IF ADSTRL > ZERO  OR ASC-REQUESTED-STORE > ZERO      06230000
060100                CONTINUE                                          06240000
060200             ELSE                                                 06250000
060300                 MOVE ASC-CNTL-FROM-9 TO PV-CNTL-NBR-FROM         06260000
060400                 PERFORM 7000-CONTROL-NBR-FROM                    06270000
060500                 PERFORM 6670-GET-STR-WCNTL-NBR                   06280000
060600                 IF SQLCODE = +0                                  06290000
060700                     MOVE SVT00001-STR-NBR                        06300000
060800                                          TO ASC-REQUESTED-STORE-906310000
060900                     MOVE ASC-REQUESTED-STORE-9                   06320000
061000                                          TO ADSTRO               06330000
061100                 ELSE                                             06340000
061200                     IF SQLCODE = +100                            06350000
061300                         MOVE ZEROES                              06360000
061400                                          TO ASC-REQUESTED-STORE-906370000
061500                                             ADSTRO               06380000
061600                         MOVE DP015-UNP-ALP-BRT-OFF               06390000
061700                                          TO ADSTRA               06400000
061800                         MOVE DP015-RED   TO ADSTRC               06410000
061900                         MOVE DP015-REVERSE                       06420000
062000                                          TO ADSTRH               06430000
062100                         MOVE -1          TO ADSTRL               06440000
062200                     END-IF                                       06450000
062300                 END-IF                                           06460000
062400                 MOVE ASC-REQUESTED-STORE-9                       06470000
062500                                          TO DK-STORE-NBR         06480000
062600                 PERFORM 4200-SELECT-STORE-NAME                   06490000
062700                 IF SQLCODE = +0                                  06500000
062800                     MOVE XST00001-LOC-NM                         06510000
062900                                 TO ASC-REQUESTED-STORE-NAME      06520000
063000                                    ADSTRNO                       06530000
063100                     MOVE XST00001-ST-CDE                         06540000
063200                                 TO ASC-ST-CDE                    06550000
063300                 ELSE                                             06560000
063400                     IF SQLCODE = +100                            06570000
063500                         MOVE SPACES                              06580000
063600                                 TO ASC-REQUESTED-STORE-NAME      06590000
063700                                    ADSTRNO                       06600000
063800                         MOVE DP015-UNP-ALP-BRT-OFF               06610000
063900                                 TO ADSTRA                        06620000
064000                         MOVE DP015-RED                           06630000
064100                                 TO ADSTRC                        06640000
064200                         MOVE DP015-REVERSE                       06650000
064300                                 TO ADSTRH                        06660000
064400                         MOVE -1 TO ADSTRL                        06670000
064500                     END-IF                                       06680000
064600                 END-IF                                           06690000
064700             END-IF                                               06700000
064800             IF PS-ERROR OR                                       06710000
064900                (REQUESTED-STORE-MISSING                          06720000
065000                 AND DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID))      06730000
065100                 SET DP030-OVERRIDE-GO TO TRUE                    06740000
065200             ELSE                                                 06750000
065300                 SET DP030-CONTINUE-GO TO TRUE                    06760000
065400                 PERFORM 2100-CHECK-FUNCTION-KEY                  06770000
065500             END-IF                                               06780000
065600     END-EVALUATE.                                                06790000
065700*----------------------------------------------------------------*06800000
065800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *06810000
065900* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *06820000
066000* FROM THE CICS ARCHITECTURE API.                                *06830000
066100*----------------------------------------------------------------*06840000
066200 2100-CHECK-FUNCTION-KEY.                                         06850000
066300                                                                  06860000
066400     IF ASC-CONFIRM-THE-VOIDS                                     06870000
066500     AND  NOT  DP020-FK-CONFIRM (DP020-SRC-AID)                   06880000
066600         SET ASC-CONFIRM-NO-VOIDS   TO TRUE                       06890000
066700     END-IF.                                                      06900000
066800                                                                  06910000
066900     EVALUATE TRUE                                                06920000
067000         WHEN DP020-SRC-AID = DP016-ENTER                         06930000
067100             IF ASC-ADD                                           06940000
067200                 SET ASC-NO-ADD   TO TRUE                         06950000
067300             END-IF                                               06960000
067400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06970000
067500* ASSIGN                                                          06980000
067600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06990000
067700             IF ASC-ADD                                           07000000
067800                 SET ASC-NO-ADD   TO TRUE                         07010000
067900             END-IF                                               07020000
068000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07030000
068100             PERFORM 5000-SET-CURRENT-DATE                        07040000
068200             PERFORM 5100-SET-CURRENT-TIME                        07050000
068300             PERFORM 5200-UPDATE-DISTRB                           07060000
068400             IF PS-NO-DB2-ERROR                                   07070000
068500*----PC-TSYMSG-00059 - UPDATE(S) SUCCESSFUL                       07080000
068600                 MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER         07090000
068700                 SET DP020-MSG-INFORMATIONAL                      07100000
068800                                      TO TRUE                     07110000
068900             END-IF                                               07120000
069000* ISSUE                                                           07130000
069100         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07140000
069200             MOVE PC-ISSUE-AUTH TO DP008-RESOURCE-NAME            07150000
069300             PERFORM 7300-CHECK-AUTH                              07160000
069400             IF ASC-VALID-SECURITY                                07170000
069500                 PERFORM 2500-ISSUE-CARDS                         07180000
069600             ELSE                                                 07190000
069700                 SET PS-ERROR                                     07200000
069800                     DP020-MSG-FATAL        TO TRUE               07210000
069900*      --- YOU DO NOT HAVE SECURITY CLEARANCE FOR THE REQUESTED   07220000
070000*          FUNCTION                                               07230000
070100                 MOVE PC-TSYMSG-99910       TO DP020-MSG-NUMBER   07240000
070200                 MOVE DP015-UNP-ALP-BRT-OFF TO ADCDTOA            07250000
070300                                               ADCDFRA            07260000
070400                 MOVE DP015-RED             TO ADCDFRC            07270000
070500                                               ADCDTOC            07280000
070600                 MOVE DP015-REVERSE         TO ADCDTOH            07290000
070700                                               ADCDFRH            07300000
070800                 MOVE -1                    TO ADCDTOL            07310000
070900                                               ADCDFRL            07320000
071000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07330000
071100             END-IF                                               07340000
071200* MAINT                                                           07350000
071300         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              07360000
071400             PERFORM 2110-PREPARE-INTER-APPL-COMM                 07370000
071500* VOID                                                            07380000
071600         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              07390000
071700             MOVE PC-VOID-AUTH TO DP008-RESOURCE-NAME             07400008
071800             PERFORM 7300-CHECK-AUTH                              07410000
071900             IF ASC-VALID-SECURITY                                07420000
072000                 PERFORM 2120-VALIDATE-CARDS-FOR-VOIDS            07430000
072100             ELSE                                                 07440000
072200                 SET PS-ERROR                                     07450000
072300                     DP020-MSG-FATAL         TO TRUE              07460000
072400*      --- USERID DOES NOT HAVE AUTHORITY TO ADD ACTIVITY         07470000
072500*          WHICH DOES NOT EXIST ---                               07480000
072600                 MOVE PC-TSYMSG-03762        TO DP020-MSG-NUMBER  07490009
072700                 MOVE DP015-UNP-ALP-BRT-OFF  TO ADCDTOA           07500000
072800                                                ADCDFRA           07510000
072900                 MOVE DP015-RED              TO ADCDFRC           07520000
073000                                                ADCDTOC           07530000
073100                 MOVE DP015-REVERSE          TO ADCDTOH           07540000
073200                                                ADCDFRH           07550000
073300                 MOVE -1                     TO ADCDTOL           07560000
073400                                                ADCDFRL           07570000
073500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07580000
073600             END-IF                                               07590000
073700                                                                  07600000
073800         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    07610000
073900             IF ASC-ADD                                           07620000
074000                 SET DP030-CONTINUE-GO                            07630000
074100                                 TO TRUE                          07640000
074200                 PERFORM 4600-CARD-ISSUANCE                       07650000
074300                 IF (PS-NO-DB2-ERROR                              07660000
074400                 AND PS-NO-ERROR)                                 07670000
074500*----ADD SUCCESSFUL                                               07680000
074600                     MOVE PC-TSYMSG-00034   TO DP020-MSG-NUMBER   07690000
074700                     SET DP020-MSG-INFORMATIONAL                  07700000
074800                         DP030-ERASE-UNPROT  TO TRUE              07710000
074900*----ERASE UNPROTECTED FIELDS AFTER A SUCCESSFUL ADD              07720000
075000                     MOVE LOW-VALUES         TO AISUSTRO          07730000
075100                                                ASTRDESO          07740000
075200                     MOVE ZEROS              TO ATERMO            07750000
075300                                                ATRANO            07760000
075400                                                AISUAMTO          07770000
075500                     INITIALIZE ASC-SPECIFIC-COMMAREA             07780000
075600                     SET REQUESTED-STORE-FIRST-TIME               07790000
075700                         ASC-FIRSTTIME       TO TRUE              07800000
075800                     MOVE SV004-CORPORATE-LOCATION                07810000
075900                                         TO ASC-ISSUE-STORE-9     07820000
076000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07830000
076100                 END-IF                                           07840000
076200             ELSE                                                 07850000
076300                 IF ASC-CONFIRM-THE-VOIDS                         07860000
076400                     PERFORM 2170-PROCESS-VOIDS                   07870000
076500                 ELSE                                             07880000
076600*----PC-TSYMSG-02922 - ADD OR VOID PROCESS MUST BE REQUESTED      07890000
076700*                      BEFORE CONFIRM PROCESS                     07900000
076800                     MOVE PC-TSYMSG-02922                         07910000
076900                                 TO DP020-MSG-NUMBER              07920000
077000                     SET DP020-MSG-INFORMATIONAL                  07930000
077100                                 TO TRUE                          07940000
077200                 END-IF                                           07950000
077300             END-IF                                               07960000
077400                                                                  07970000
077500         WHEN OTHER                                               07980000
077600             SET DP013-NO-ROLLBACK                                07990000
077700                 DP013-XCTL-DISPLAY-RESTART                       08000000
077800                 DP013-CICS-ABEND  TO TRUE                        08010000
077900             MOVE '2000-PROCESS-PANEL'                            08020000
078000                                   TO DP013-PARAGRAPH             08030000
078100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08040000
078200                                   TO DP013-MESSAGE-TEXT (1)      08050000
078300             PERFORM DP013-0000-PROCESS-ABEND                     08060000
078400     END-EVALUATE.                                                08070000
078500*----------------------------------------------------------------*08080000
078600* MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE     *08090000
078700* INTER-APPLICATION COMMAREA.                                    *08100000
078800*----------------------------------------------------------------*08110000
078900 2110-PREPARE-INTER-APPL-COMM.                                    08120000
079000                                                                  08130000
079100     INITIALIZE RD030-INTER-APPL-COMMAREA.                        08140000
079200                                                                  08150000
079300     MOVE ASC-CNTL-FROM TO PV-NBR.                                08160000
079400     IF PV-NBR IS NUMERIC                                         08170000
079500         MOVE PV-NBR TO RD030-FROM-CNTL-NUMBER                    08180000
079600     ELSE                                                         08190000
079700         MOVE ZEROES TO RD030-FROM-CNTL-NUMBER                    08200000
079800     END-IF.                                                      08210000
079900                                                                  08220000
080000     MOVE ASC-CNTL-TO TO PV-NBR.                                  08230000
080100     IF PV-NBR IS NUMERIC                                         08240000
080200         MOVE PV-NBR TO RD030-TO-CNTL-NUMBER                      08250000
080300     ELSE                                                         08260000
080400         MOVE ZEROES TO RD030-TO-CNTL-NUMBER                      08270000
080500     END-IF.                                                      08280000
080600                                                                  08290000
080700     IF RD030-FROM-CNTL-NUMBER = RD030-TO-CNTL-NUMBER             08300000
080800         MOVE ASC-CNTL-FROM-9      TO PV-CNTL-NBR-FROM            08310000
080900         PERFORM 7000-CONTROL-NBR-FROM                            08320000
081000         PERFORM 4670-GET-CARD-NUMBER                             08330000
081100         IF SQLCODE = 0                                           08340000
081200             MOVE SVT00001-CRD-NBR TO RD030-CARD-NUMBER           08350000
081300         ELSE                                                     08360000
081400             MOVE ZEROS            TO RD030-CARD-NUMBER           08370000
081500         END-IF                                                   08380000
081600     ELSE                                                         08390000
081700         MOVE ZEROS                TO RD030-CARD-NUMBER           08400000
081800     END-IF.                                                      08410000
081900                                                                  08420000
082000     MOVE ASC-NMBR-FROM            TO SV007-CARD-NUMBER-IN        08430000
082100     SET SV007-FORMAT-BOTH         TO TRUE                        08440000
082200     MOVE ZERO                     TO SV007-CARD-NUMBER-LENGTH    08450000
082300     PERFORM SV007-FORMAT-CARD                                    08460000
082400     IF SV007-CARD-12-OUT2 = "00"                                 08470000
082500     AND SV007-CARD-NUMBER9 NOT = ZERO                            08480000
082600       MOVE SV007-CARD-ID        TO SV007-CRD-NBR                 08490000
082700       MOVE ZEROES               TO SV007-CARD-NUMBER9            08500000
082800       MOVE SV007-CRD-NBR        TO SV007-CARD-13-OUT-10-9        08510000
082900       PERFORM 6400-GET-CHECK-DIGIT                               08520000
083000     END-IF                                                       08530000
083100     MOVE SV007-CARD-NUMBER9     TO RD030-FROM-30-DIGT-CRD-NBR    08540000
083200                                                                  08550000
083300     MOVE ASC-NMBR-TO            TO SV007-CARD-NUMBER-IN          08560000
083400     SET SV007-FORMAT-BOTH       TO TRUE                          08570000
083500     MOVE ZERO                     TO SV007-CARD-NUMBER-LENGTH    08580000
083600     PERFORM SV007-FORMAT-CARD                                    08590000
083700     IF SV007-CARD-12-OUT2 = "00"                                 08600000
083800     AND SV007-CARD-NUMBER9 NOT = ZERO                            08610000
083900       MOVE SV007-CARD-ID        TO SV007-CRD-NBR                 08620000
084000       MOVE ZEROES               TO SV007-CARD-NUMBER9            08630000
084100       MOVE SV007-CRD-NBR        TO SV007-CARD-13-OUT-10-9        08640000
084200       PERFORM 6400-GET-CHECK-DIGIT                               08650000
084300     END-IF                                                       08660000
084400     MOVE SV007-CARD-NUMBER9 TO RD030-TO-30-DIGT-CRD-NBR.         08670000
084500                                                                  08680000
084600                                                                  08690000
084700*----------------------------------------------------------------*08700000
084800* CHECK SECURITY OF USER TO DETERMINE IF VALID FOR VOID PROCESS  *08710000
084900*                                                                *08720000
085000* CHECK CARDS FOR ONE AND ONLY ONE TRANSACTION                   *08730000
085100*----------------------------------------------------------------*08740000
085200 2120-VALIDATE-CARDS-FOR-VOIDS.                                   08750000
085300                                                                  08760000
085400     PERFORM 2122-SELECT-INVALID-VOIDS.                           08770000
085500                                                                  08780000
085600     IF ASC-ALL-VOIDS-ARE-VALID                                   08790000
085700         SET ASC-CONFIRM-THE-VOIDS TO TRUE                        08800000
085800*            --- PRESS F2 TO CONFIRM REQUEST ---                  08810000
085900         MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER                 08820000
086000         SET DP020-MSG-INFORMATIONAL TO TRUE                      08830000
086100     ELSE                                                         08840000
086200         SET PS-ERROR                                             08850000
086300             DP020-MSG-FATAL         TO TRUE                      08860000
086400*  INVALID CARD &VAR SELECTED FOR VOID PROCESS                    08870000
086500         MOVE DK-CRD-PROD-YR-FROM    TO  PV-REQ-DTE               08880000
086600         MOVE DK-SHIPT-REQ-NBR-FROM  TO  PV-REQ-NBR               08890000
086700         MOVE PV-INVALID-CNTL-NBR    TO  PV-SEQ-NBR               08900000
086800         MOVE PV-CNTL-NBR            TO DP020-MSG-TEXT            08910000
086900         MOVE PC-TSYMSG-02920        TO DP020-MSG-NUMBER          08920000
087000         MOVE DP015-UNP-ALP-BRT-OFF  TO ADCDTOA                   08930000
087100                                        ADCDFRA                   08940000
087200         MOVE DP015-RED              TO ADCDFRC                   08950000
087300                                        ADCDTOC                   08960000
087400         MOVE DP015-REVERSE          TO ADCDTOH                   08970000
087500                                        ADCDFRH                   08980000
087600         MOVE -1                     TO ADCDTOL                   08990000
087700                                        ADCDFRL                   09000000
087800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      09010000
087900     END-IF.                                                      09020000
088000                                                                  09030000
088100*----------------------------------------------------------------*09040000
088200* OPEN INVALID CURSOR AND FETCH THE FIRST RECORD IF THERE IS ONE *09050000
088300* CLOSE CURSOR                                                   *09060000
088400*----------------------------------------------------------------*09070000
088500 2122-SELECT-INVALID-VOIDS.                                       09080000
088600                                                                  09090000
088700     PERFORM 2123-OPEN-INVALID-CSR.                               09100000
088800                                                                  09110000
088900     PERFORM 2124-FETCH-INVALID-CSR.                              09120000
089000                                                                  09130000
089100     PERFORM 2125-CLOSE-INVALID-CSR.                              09140000
089200*----------------------------------------------------------------*09150000
089300* OPEN THE INVALID CURSOR                                        *09160000
089400*----------------------------------------------------------------*09170000
089500 2123-OPEN-INVALID-CSR.                                           09180000
089600                                                                  09190000
089700     EXEC SQL                                                     09200000
089800         OPEN INVALID-CSR                                         09210000
089900     END-EXEC.                                                    09220000
090000     EVALUATE TRUE                                                09230000
090100         WHEN SQLCODE = ZERO                                      09240000
090200             CONTINUE                                             09250000
090300         WHEN OTHER                                               09260000
090400             MOVE '2123-OPEN-INVALID-CSR'  TO DP013-PARAGRAPH     09270000
090500             MOVE 'OPEN INVALID CSR - ' TO DP013-MESSAGE-TEXT (1) 09280000
090600             MOVE SQLCA                 TO DP013-SQLCA            09290000
090700             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        09300000
090800                                        DP013-DB2-TABLE-NAME (1)  09310000
090900             SET DP013-DB2-ABEND                                  09320000
091000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09330000
091100             PERFORM DP013-0000-PROCESS-ABEND                     09340000
091200     END-EVALUATE.                                                09350000
091300*----------------------------------------------------------------*09360000
091400* FETCH THE INVALID CSR                                          *09370000
091500*----------------------------------------------------------------*09380000
091600 2124-FETCH-INVALID-CSR.                                          09390000
091700                                                                  09400000
091800     SET ASC-ALL-VOIDS-NOT-VALID    TO TRUE                       09410000
091900                                                                  09420000
092000     EXEC SQL                                                     09430000
092100         FETCH INVALID-CSR                                        09440000
092200          INTO :PV-INVALID-VOID-CARDS                             09450000
092300              ,:PV-INVALID-CNTL-NBR                               09460000
092400     END-EXEC.                                                    09470000
092500     EVALUATE TRUE                                                09480000
092600         WHEN SQLCODE = ZERO                                      09490000
092700             CONTINUE                                             09500000
092800                                                                  09510000
092900         WHEN SQLCODE = +100                                      09520000
093000             SET ASC-ALL-VOIDS-ARE-VALID                          09530000
093100                                 TO TRUE                          09540000
093200         WHEN OTHER                                               09550000
093300             MOVE '2124-FETCH-INVALID-CSR'                        09560000
093400                                 TO DP013-PARAGRAPH               09570000
093500             MOVE 'BAD FETCH ON INVALID CSR'                      09580000
093600                                        TO DP013-MESSAGE-TEXT (1) 09590000
093700             MOVE SQLCA                 TO DP013-SQLCA            09600000
093800             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        09610000
093900                                        DP013-DB2-TABLE-NAME (1)  09620000
094000             SET DP013-DB2-ABEND                                  09630000
094100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09640000
094200             PERFORM DP013-0000-PROCESS-ABEND                     09650000
094300     END-EVALUATE.                                                09660000
094400                                                                  09670000
094500*----------------------------------------------------------------*09680000
094600* CLOSE THE INVALID CURSOR.                                      *09690000
094700*----------------------------------------------------------------*09700000
094800 2125-CLOSE-INVALID-CSR.                                          09710000
094900                                                                  09720000
095000     EXEC SQL                                                     09730000
095100         CLOSE INVALID-CSR                                        09740000
095200     END-EXEC.                                                    09750000
095300     EVALUATE TRUE                                                09760000
095400         WHEN SQLCODE = ZERO                                      09770000
095500             CONTINUE                                             09780000
095600         WHEN OTHER                                               09790000
095700             MOVE '2125-CLOSE-INVALID-CSR' TO DP013-PARAGRAPH     09800000
095800             MOVE 'CLOSE INVALID CSR  ' TO DP013-MESSAGE-TEXT (1) 09810000
095900             MOVE SQLCA                 TO DP013-SQLCA            09820000
096000             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        09830000
096100                                        DP013-DB2-TABLE-NAME (1)  09840000
096200             SET DP013-DB2-ABEND                                  09850000
096300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09860000
096400             PERFORM DP013-0000-PROCESS-ABEND                     09870000
096500     END-EVALUATE.                                                09880000
096600                                                                  09890000
096700*----------------------------------------------------------------*09900000
096800* PROCESS THE RANGE OF CARDS THAT ARE BEING VOIDED.              *09910000
096900*----------------------------------------------------------------*09920000
097000 2170-PROCESS-VOIDS.                                              09930000
097100                                                                  09940000
097200     PERFORM 2172-OPEN-VOIDS-CSR.                                 09950000
097300                                                                  09960000
097400     PERFORM 2174-FETCH-VOIDS-CSR.                                09970000
097500                                                                  09980000
097600     PERFORM 2176-PROCESS-VOID-CSR                                09990000
097700         UNTIL PS-END-OF-VOIDS-CSR.                               10000000
097800                                                                  10010000
097900*    --- VOID SUCCESSFUL ---                                      10020000
098000     MOVE PC-TSYMSG-01243        TO DP020-MSG-NUMBER.             10030000
098100     SET DP020-MSG-INFORMATIONAL                                  10040000
098200         ASC-CONFIRM-NO-VOIDS    TO TRUE.                         10050000
098300                                                                  10060000
098400     PERFORM  2178-CLOSE-VOIDS-CSR.                               10070000
098500                                                                  10080000
098600*----------------------------------------------------------------*10090000
098700* OPEN THE VOID CURSOR                                           *10100000
098800*----------------------------------------------------------------*10110000
098900 2172-OPEN-VOIDS-CSR.                                             10120000
099000                                                                  10130000
099100     EXEC SQL                                                     10140000
099200         OPEN VOIDS-CSR                                           10150000
099300     END-EXEC.                                                    10160000
099400     EVALUATE TRUE                                                10170000
099500         WHEN SQLCODE = ZERO                                      10180000
099600             CONTINUE                                             10190000
099700         WHEN OTHER                                               10200000
099800             MOVE '2172-OPEN-VOIDS-CSR'  TO DP013-PARAGRAPH       10210000
099900             MOVE 'OPEN CARD CURSOR - ' TO DP013-MESSAGE-TEXT (1) 10220000
100000             MOVE SQLCA                 TO DP013-SQLCA            10230000
100100             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        10240000
100200                                        DP013-DB2-TABLE-NAME (1)  10250000
100300             SET DP013-DB2-ABEND                                  10260000
100400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10270000
100500             PERFORM DP013-0000-PROCESS-ABEND                     10280000
100600     END-EVALUATE.                                                10290000
100700*----------------------------------------------------------------*10300000
100800* FETCH THE VOID CURSOR                                          *10310000
100900*----------------------------------------------------------------*10320000
101000 2174-FETCH-VOIDS-CSR.                                            10330000
101100                                                                  10340000
101200     EXEC SQL                                                     10350000
101300         FETCH VOIDS-CSR                                          10360000
101400          INTO :SVT00002-CRD-NBR                                  10370000
101500              ,:SVT00002-TRN-AUTH-TMST                            10380000
101600              ,:SVT00002-DRV-LIC-NBR                              10390000
101700              ,:SVT00002-TRN-RVRSL-CDE                            10400000
101800              ,:SVT00002-TRN-VOID-IND                             10410000
101900              ,:SVT00002-ACTVY-TYP-CDE                            10420000
102000              ,:SVT00002-POS-DTE                                  10430000
102100              ,:SVT00002-STR-NBR                                  10440000
102200              ,:SVT00002-POS-TRMNL-NBR                            10450000
102300              ,:SVT00002-POS-TRN-NBR                              10460000
102400              ,:SVT00002-TRN-PSTD-TMST                            10470002
102500              ,:SVT00002-APP-AUTH-AMT                             10480000
102600              ,:SVT00002-POS-OPRT-ID                              10490000
102700              ,:SVT00002-APVL-USR-ID                              10500000
102800              ,:SVT00002-ACTVY-STAT-CDE                           10510000
102900              ,:SVT00002-ORIG-AUTH-AMT                            10520000
103000     END-EXEC.                                                    10530000
103100     EVALUATE TRUE                                                10540000
103200         WHEN SQLCODE = ZERO                                      10550000
103300             CONTINUE                                             10560000
103400         WHEN SQLCODE = +100                                      10570000
103500             SET PS-END-OF-VOIDS-CSR    TO TRUE                   10580000
103600         WHEN OTHER                                               10590000
103700             MOVE '2174-FETCH-VOIDS-CSR'                          10600000
103800                                        TO DP013-PARAGRAPH        10610000
103900             MOVE 'FETCH VOIDS CSR   -' TO DP013-MESSAGE-TEXT (1) 10620000
104000             MOVE SQLCA                 TO DP013-SQLCA            10630000
104100             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        10640000
104200                                        DP013-DB2-TABLE-NAME (1)  10650000
104300             SET DP013-DB2-ABEND        TO TRUE                   10660000
104400*                DP013-XCTL-DISPLAY-RESTART TO TRUE               10670000
104500             PERFORM DP013-0000-PROCESS-ABEND                     10680000
104600     END-EVALUATE.                                                10690000
104700                                                                  10700000
104800*----------------------------------------------------------------*10710000
104900* UPDATE THE TXN TABLE FOR RANGE OF CARDS BEING REQUESTED.       *10720000
105000*  SET VOID IND  AND ACTVY-STAT-CDE                              *10730000
105100*                                                                *10740000
105200*  ALSO INSERT INTO TXN TABLE FOR THE RANGE OF CARDS BEING       *10750000
105300*  REQUESTED.                                                    *10760000
105400*  CHANGE AMT'S TO NEGATIVE  AND PROCESS USER ID                  10770000
105500*----------------------------------------------------------------*10780000
105600 2176-PROCESS-VOID-CSR.                                           10790000
105700                                                                  10800000
105800     EXEC SQL                                                     10810000
105900         UPDATE SVT_KOHLS_CRD_TXN                                 10820000
106000         SET TRN_VOID_IND     = :SV004-VOID-TRANS                 10830000
106100            ,ACTVY_STAT_CDE   = :SV004-STAT-VERIFIED-CD           10840000
106200          WHERE CRD_NBR       = :SVT00002-CRD-NBR                 10850000
106300            AND TRN_RVRSL_CDE = :SVT00002-TRN-RVRSL-CDE           10860000
106400            AND TRN_VOID_IND  = :SVT00002-TRN-VOID-IND            10870000
106500            AND ACTVY_TYP_CDE = :SVT00002-ACTVY-TYP-CDE           10880000
106600            AND POS_DTE       = :SVT00002-POS-DTE                 10890000
106700            AND STR_NBR       = :SVT00002-STR-NBR                 10900000
106800            AND POS_TRMNL_NBR = :SVT00002-POS-TRMNL-NBR           10910000
106900            AND POS_TRN_NBR   = :SVT00002-POS-TRN-NBR             10920000
107000            AND APP_AUTH_AMT  = :SVT00002-APP-AUTH-AMT            10930000
107100            AND TRN_AUTH_TMST = :SVT00002-TRN-AUTH-TMST           10940000
107200     END-EXEC.                                                    10950000
107300                                                                  10960000
107400     EVALUATE TRUE                                                10970000
107500         WHEN SQLCODE = +0                                        10980000
107600             CONTINUE                                             10990000
107700         WHEN OTHER                                               11000000
107800             MOVE '2176-PROCESS-VOIDS-CSR'                        11010000
107900                               TO DP013-PARAGRAPH                 11020000
108000             MOVE 'UPDATE VOID TRANS'                             11030000
108100                               TO DP013-MESSAGE-TEXT (1)          11040000
108200             MOVE SQLCA        TO DP013-SQLCA                     11050000
108300             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME (1) 11060000
108400             SET DP013-DB2-ABEND                                  11070000
108500                               TO TRUE                            11080000
108600             SET DP013-XCTL-DISPLAY-RESTART                       11090000
108700                               TO TRUE                            11100000
108800             PERFORM DP013-0000-PROCESS-ABEND                     11110000
108900     END-EVALUATE.                                                11120000
109000                                                                  11130000
109100*----------------------------------------------------------------*11140000
109200* SET INSERT TO                                                  *11150000
109300*  VOID IND         RVRSL-CDE                                    *11160000
109400*  DEFAULT TIMESTAMP                                             *11170000
109500*  NEGATIVE AMT'S FOR APP-AUTH-AMT AND ORIG                      *11180000
109600*  APVL-USR-ID   = PROCESS USERID                                *11190000
109700*  ACTVY-STAT-CDE   TO   NO-AUTH-CDE                             *11200000
109800*----------------------------------------------------------------*11210000
109900     MOVE SV004-REV-CDE-REVERSAL  TO SVT00002-TRN-RVRSL-CDE.      11220000
110000     MOVE SV004-VOID-TRANS        TO SVT00002-TRN-VOID-IND.       11230000
110200     COMPUTE SVT00002-APP-AUTH-AMT                                11240000
110300             = (SVT00002-APP-AUTH-AMT  * -1).                     11250000
110400     MOVE ZERO                    TO SVT00002-POS-OPRT-ID.        11260000
110500     MOVE DP020-USERID            TO SVT00002-APVL-USR-ID.        11270000
110600     MOVE SV004-STAT-VERIFIED-CD  TO SVT00002-ACTVY-STAT-CDE.     11280006
110700     COMPUTE SVT00002-ORIG-AUTH-AMT                               11290000
110800             = (SVT00002-ORIG-AUTH-AMT  * -1).                    11300000
110900                                                                  11310000
111000     EXEC SQL                                                     11320000
111100         INSERT INTO SVT_KOHLS_CRD_TXN                            11330000
111200            (CRD_NBR,                                             11340000
111300             DRV_LIC_NBR,                                         11350000
111400             TRN_RVRSL_CDE,                                       11360000
111500             TRN_VOID_IND,                                        11370000
111600             ACTVY_TYP_CDE,                                       11380000
111700             POS_DTE,                                             11390000
111800             STR_NBR,                                             11400000
111900             POS_TRMNL_NBR,                                       11410000
112000             POS_TRN_NBR,                                         11420000
112100             TRN_PSTD_TMST,                                       11430000
112200             APP_AUTH_AMT,                                        11440000
112300             POS_OPRT_ID,                                         11450000
112400             APVL_USR_ID,                                         11460000
112500             ACTVY_STAT_CDE,                                      11470000
112600             ORIG_AUTH_AMT,                                       11480000
112700             ST_CDE)                                              11490000
112800         VALUES                                                   11500000
112900            (:SVT00002-CRD-NBR,                                   11510000
113000             :SVT00002-DRV-LIC-NBR,                               11520000
113100             :SVT00002-TRN-RVRSL-CDE,                             11530000
113200             :SVT00002-TRN-VOID-IND,                              11540000
113300             :SVT00002-ACTVY-TYP-CDE,                             11550000
113400             :SVT00002-POS-DTE,                                   11560000
113500             :SVT00002-STR-NBR,                                   11570000
113600             :SVT00002-POS-TRMNL-NBR,                             11580000
113700             :SVT00002-POS-TRN-NBR,                               11590000
113800              CURRENT TIMESTAMP,                                  11600006
113900             :SVT00002-APP-AUTH-AMT,                              11610000
114000             :SVT00002-POS-OPRT-ID,                               11620000
114100             :SVT00002-APVL-USR-ID,                               11630000
114200             :SVT00002-ACTVY-STAT-CDE,                            11640000
114300             :SVT00002-ORIG-AUTH-AMT,                             11650000
114400             :SVT00002-ST-CDE)                                    11660000
114500     END-EXEC.                                                    11670000
114600                                                                  11680000
114700     EVALUATE TRUE                                                11690000
114800         WHEN SQLCODE = +0                                        11700000
114900             CONTINUE                                             11710000
115000         WHEN OTHER                                               11720000
115100             MOVE '2176-PROCESS-VOIDS-CSR'                        11730000
115200                                  TO DP013-PARAGRAPH              11740000
115300             MOVE 'INSERT FOR VOID'                               11750000
115400                                  TO DP013-MESSAGE-TEXT(1)        11760000
115500             MOVE SQLCA           TO DP013-SQLCA                  11770000
115600             MOVE 'SVT_KOHLS_CRD_TXN' TO DP013-DB2-TABLE-NAME(1)  11780000
115700             SET DP013-DB2-ABEND                                  11790000
115800                 DP013-XCTL-DISPLAY-RESTART                       11800000
115900                                  TO TRUE                         11810000
116000             PERFORM DP013-0000-PROCESS-ABEND                     11820000
116100     END-EVALUATE.                                                11830000
116200                                                                  11840000
116300     INITIALIZE  DCLSVT00002.                                     11850000
116400                                                                  11860000
116500     PERFORM 2174-FETCH-VOIDS-CSR.                                11870000
116600                                                                  11880000
116700*----------------------------------------------------------------*11890000
116800* CLOSE THE CARD CURSOR.                                         *11900000
116900*----------------------------------------------------------------*11910000
117000 2178-CLOSE-VOIDS-CSR.                                            11920000
117100                                                                  11930000
117200     EXEC SQL                                                     11940000
117300         CLOSE VOIDS-CSR                                          11950000
117400     END-EXEC.                                                    11960000
117500     EVALUATE TRUE                                                11970000
117600         WHEN SQLCODE = ZERO                                      11980000
117700             CONTINUE                                             11990000
117800         WHEN OTHER                                               12000000
117900             MOVE '2178-CLOSE-VOIDS-CSR' TO DP013-PARAGRAPH       12010000
118000             MOVE 'CLOSE VOIDS CSR   -' TO DP013-MESSAGE-TEXT (1) 12020000
118100             MOVE SQLCA                 TO DP013-SQLCA            12030000
118200             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        12040000
118300                                        DP013-DB2-TABLE-NAME (1)  12050000
118400             SET DP013-DB2-ABEND                                  12060000
118500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               12070000
118600             PERFORM DP013-0000-PROCESS-ABEND                     12080000
118700     END-EVALUATE.                                                12090000
118800                                                                  12100000
118900*----------------------------------------------------------------*12110000
119000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *12120000
119100* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *12130000
119200* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *12140000
119300*----------------------------------------------------------------*12150000
119400 2200-MOVE-SCREEN-TO-COMMAREA.                                    12160000
119500     SET PS-NBR-REQUESTED-NOT-CHANGED                             12170000
119600         PS-TO-NMBR-NOT-CHANGED                                   12180000
119700         PS-FROM-NMBR-NOT-CHANGED                                 12190000
119800         PS-TO-CNTL-NOT-CHANGED                                   12200000
119900         PS-FROM-CNTL-NOT-CHANGED TO TRUE.                        12210000
120000                                                                  12220000
120100     IF ADNBFRL > ZERO                                            12230000
120200         MOVE ADNBFRI                 TO ASC-NMBR-FROM            12240000
120300         SET PS-FROM-NMBR-CHANGED     TO TRUE                     12250000
120400     ELSE                                                         12260000
120500         IF ADNBFRF = DP015-ERASE-EOF                             12270000
120600             MOVE SPACE               TO ASC-NMBR-FROM            12280000
120700             SET PS-FROM-NMBR-CHANGED TO TRUE                     12290000
120800         END-IF                                                   12300000
120900     END-IF.                                                      12310000
121000                                                                  12320000
121100     IF ADNBTOL > ZERO                                            12330000
121200         MOVE ADNBTOI                 TO ASC-NMBR-TO              12340000
121300         SET PS-TO-NMBR-CHANGED       TO TRUE                     12350000
121400     ELSE                                                         12360000
121500         IF ADNBTOF = DP015-ERASE-EOF                             12370000
121600             MOVE SPACE               TO ASC-NMBR-TO              12380000
121700             SET PS-TO-NMBR-CHANGED   TO TRUE                     12390000
121800         END-IF                                                   12400000
121900     END-IF.                                                      12410000
122000                                                                  12420000
122100     IF ADCDFRL > ZERO                                            12430000
122200         MOVE ADCDFRI                 TO ASC-CNTL-FROM            12440000
122300         SET PS-FROM-CNTL-CHANGED     TO TRUE                     12450000
122400     ELSE                                                         12460000
122500         IF ADCDFRF = DP015-ERASE-EOF                             12470000
122600             MOVE SPACE               TO ASC-CNTL-FROM            12480000
122700             SET PS-FROM-CNTL-CHANGED TO TRUE                     12490000
122800         END-IF                                                   12500000
122900     END-IF.                                                      12510000
123000                                                                  12520000
123100     IF ADCDTOL > ZERO                                            12530000
123200         MOVE ADCDTOI                 TO ASC-CNTL-TO              12540000
123300         SET PS-TO-CNTL-CHANGED       TO TRUE                     12550000
123400     ELSE                                                         12560000
123500         IF ADCDTOF = DP015-ERASE-EOF                             12570000
123600             MOVE SPACE               TO ASC-CNTL-TO              12580000
123700             SET PS-TO-CNTL-CHANGED   TO TRUE                     12590000
123800         END-IF                                                   12600000
123900     END-IF.                                                      12610000
124000                                                                  12620000
124100     IF ADSTRL > ZERO                                             12630000
124200         MOVE ADSTRI                  TO ASC-REQUESTED-STORE      12640000
124300     ELSE                                                         12650000
124400         IF ADSTRF = DP015-ERASE-EOF                              12660000
124500             MOVE SPACE               TO ASC-REQUESTED-STORE      12670000
124600         END-IF                                                   12680000
124700     END-IF.                                                      12690000
124800                                                                  12700000
124900     IF ANBRREQL > ZERO                                           12710000
125000         MOVE ANBRREQI                TO ASC-NUMBER-REQUESTED     12720000
125100         SET PS-NBR-REQUESTED-CHANGED TO TRUE                     12730000
125200     ELSE                                                         12740000
125300         IF ANBRREQF = DP015-ERASE-EOF                            12750000
125400             MOVE ZEROS               TO ASC-NUMBER-REQUESTED-9   12760000
125500             SET PS-NBR-REQUESTED-CHANGED                         12770000
125600                                      TO TRUE                     12780000
125700         END-IF                                                   12790000
125800     END-IF.                                                      12800000
125900                                                                  12810000
126000     IF AISUSTRL > ZERO                                           12820000
126100         MOVE AISUSTRI                TO ASC-ISSUE-STORE          12830000
126200     ELSE                                                         12840000
126300         IF AISUSTRF = DP015-ERASE-EOF                            12850000
126400             MOVE SPACES              TO ASC-ISSUE-STORE          12860000
126500                                         ASC-ISSUE-STORE-NAME     12870000
126600         END-IF                                                   12880000
126700     END-IF.                                                      12890000
126800                                                                  12900000
126900     IF ATERML > ZERO                                             12910000
127000         MOVE ATERMI                  TO ASC-TERMINAL             12920000
127100     ELSE                                                         12930000
127200         IF ATERMF = DP015-ERASE-EOF                              12940000
127300             MOVE SPACES              TO ASC-TERMINAL             12950000
127400         END-IF                                                   12960000
127500     END-IF.                                                      12970000
127600                                                                  12980000
127700     IF ATRANL > ZERO                                             12990000
127800         MOVE ATRANI                  TO ASC-TRANSACTION          13000000
127900     ELSE                                                         13010000
128000         IF ATRANF = DP015-ERASE-EOF                              13020000
128100             MOVE SPACES              TO ASC-TRANSACTION          13030000
128200         END-IF                                                   13040000
128300     END-IF.                                                      13050000
128400                                                                  13060000
128500     IF AISUAMTL > ZERO                                           13070000
128600         MOVE AISUAMTI                TO ASC-ISSUE-AMOUNT         13080000
128700     ELSE                                                         13090000
128800         IF AISUAMTF = DP015-ERASE-EOF                            13100000
128900             MOVE SPACES              TO ASC-ISSUE-AMOUNT         13110000
129000         END-IF                                                   13120000
129100     END-IF.                                                      13130000
129200*----------------------------------------------------------------*13140000
129300* CHECK THAT ALL CARDS ARE VALID FOR ISSUE.  IF SO,              *13150000
129400* ISSUE ALL CARDS IN RANGE SPECIFIED.                            *13160000
129500*----------------------------------------------------------------*13170000
129600 2500-ISSUE-CARDS.                                                13180000
129700                                                                  13190000
129800     SET PS-NO-CONTROL-NBR-ERROR                                  13200000
129900         PS-NOT-END-OF-CARD-CSR TO TRUE.                          13210000
130000     PERFORM 5000-SET-CURRENT-DATE.                               13220000
130100     PERFORM 5100-SET-CURRENT-TIME.                               13230000
130200     MOVE ASC-CNTL-FROM-9       TO PV-CNTL-NBR-FROM.              13240000
130300     MOVE ASC-CNTL-TO-9         TO PV-CNTL-NBR-TO.                13250000
130400     PERFORM 7000-CONTROL-NBR-FROM.                               13260000
130500     PERFORM 7200-CONTROL-NBR-TO.                                 13270000
130600*-------------------------------------------------------*         13280000
130700*   AUTHORIZE THE CARDS USING THE AUTHORIZATION MODULE  *         13290000
130800*-------------------------------------------------------*         13300000
130900     PERFORM 4650-OPEN-CARD-CSR.                                  13310000
131000     PERFORM 4640-FETCH-NEXT-CARD.                                13320000
131100     PERFORM 4610-AUTHORIZE-CARDS                                 13330000
131200         UNTIL (PS-END-OF-CARD-CSR                                13340000
131300         OR     PS-CONTROL-NBR-ERROR).                            13350000
131400     PERFORM 4660-CLOSE-CARD-CSR.                                 13360000
131500     SET PS-NOT-END-OF-CARD-CSR TO TRUE.                          13370000
131600     PERFORM 4650-OPEN-CARD-CSR.                                  13380000
131700     PERFORM 4640-FETCH-NEXT-CARD.                                13390000
131800     PERFORM 5500-CLEAN-UP-SVT-CRD-ACCT-LCK                       13400000
131900         UNTIL PS-END-OF-CARD-CSR.                                13410000
132000     PERFORM 4660-CLOSE-CARD-CSR.                                 13420000
132100     IF PS-NO-CONTROL-NBR-ERROR                                   13430000
132200         MOVE ASC-ISSUE-AMOUNT-9 TO SV004-PRE-DENOMINATIONS       13440000
132300         IF (ASC-CRD-TYP-CDE = SV004-GIFT-CRD-TYP                 13450000
132400         AND NOT SV004-STD-GIFT-CARD-DENOM)                       13460000
132500*----PC-TSYMSG-01606 - DENOMINATION IS NOT STANDARD.PRESS CONFIRM 13470000
132600             MOVE PC-TSYMSG-01606 TO DP020-MSG-NUMBER             13480000
132700             SET DP020-MSG-WARNING                                13490000
132800                 DP030-SET-CURSOR-APPL-1                          13500000
132900                 ASC-ADD TO TRUE                                  13510000
133000             MOVE -1     TO AISUAMTL                              13520000
133100             MOVE DP015-ASK-NOR-OFF TO ADCDTOA                    13530000
133200                                       ADCDFRA                    13540000
133300                                       ADNBTOA                    13550000
133400                                       ADNBFRA                    13560000
133500                                       ANBRREQA                   13570000
133600                                       AISUSTRA                   13580000
133700                                       ATERMA                     13590000
133800                                       ATRANA                     13600000
133900                                       AISUAMTA                   13610000
134000             MOVE DP015-BLUE        TO ADCDTOC                    13620000
134100                                       ADCDFRC                    13630000
134200                                       ADNBTOC                    13640000
134300                                       ADNBFRC                    13650000
134400                                       ANBRREQC                   13660000
134500                                       AISUSTRC                   13670000
134600                                       ATERMC                     13680000
134700                                       ATRANC                     13690000
134800                                       AISUAMTC                   13700000
134900            MOVE DP015-HL-OFF       TO ADCDTOH                    13710000
135000                                       ADCDFRH                    13720000
135100                                       ADNBTOH                    13730000
135200                                       ADNBFRH                    13740000
135300                                       ANBRREQH                   13750000
135400                                       AISUSTRH                   13760000
135500                                       ATERMH                     13770000
135600                                       ATRANH                     13780000
135700                                       AISUAMTH                   13790000
135800         ELSE                                                     13800000
135900             SET DP030-CONTINUE-GO TO TRUE                        13810000
136000             PERFORM 4600-CARD-ISSUANCE                           13820000
136100             IF (PS-NO-DB2-ERROR                                  13830000
136200             AND PS-NO-ERROR)                                     13840000
136300*----ADD SUCCESSFUL                                               13850000
136400                 MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER         13860000
136500                 SET DP020-MSG-INFORMATIONAL                      13870000
136600                     DP030-ERASE-UNPROT TO TRUE                   13880000
136700*----ERASE UNPROTECTED FIELDS AFTER A SUCCESSFUL ADD              13890000
136800                 MOVE LOW-VALUES TO AISUSTRO                      13900000
136900                                    ASTRDESO                      13910000
137000                 MOVE ZEROS      TO ATERMO                        13920000
137100                                    ATRANO                        13930000
137200                                    AISUAMTO                      13940000
137300                 INITIALIZE ASC-SPECIFIC-COMMAREA                 13950000
137400                 SET ASC-FIRSTTIME                                13960000
137500                     REQUESTED-STORE-FIRST-TIME TO TRUE           13970000
137600                 MOVE SV004-CORPORATE-LOCATION                    13980000
137700                                         TO ASC-ISSUE-STORE-9     13990000
137800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14000000
137900             END-IF                                               14010000
138000         END-IF                                                   14020000
138100     END-IF.                                                      14030000
138200*----------------------------------------------------------------*14040000
138300* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *14050000
138400* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *14060000
138500* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *14070000
138600*----------------------------------------------------------------*14080000
138700 3000-EDIT-DATA-IN-COMMAREA.                                      14090000
138800     PERFORM 3200-RESET-ATTRIBUTES.                               14100000
138900     IF ASC-ISSUE-AMOUNT > SPACES                                 14110000
139000         MOVE ASC-ISSUE-AMOUNT   TO DP010I-UNEDITED-FIELD         14120000
139100         MOVE LENGTH OF ASC-ISSUE-AMOUNT                          14130000
139200                                 TO DP010I-MAXIMUM-DIGITS         14140000
139300         MOVE 2                  TO DP010I-MAXIMUM-DECIMALS       14150000
139400         SET DP010I-NEGATIVE-NOT-ALLOWED                          14160000
139500                                 TO TRUE                          14170000
139600         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14180000
139700                                 USING DP010I-NUMERIC-EDIT-AREA   14190000
139800         IF DP010I-ERROR-DETECTED                                 14200000
139900             SET PS-ERROR        TO TRUE                          14210000
140000             SET DP020-MSG-FATAL TO TRUE                          14220000
140100*----PC-TSYMSG-00008 - MUST BE NUMERIC                            14230000
140200             MOVE PC-TSYMSG-00008                                 14240000
140300                                 TO DP020-MSG-NUMBER              14250000
140400             MOVE DP015-UNP-ALP-BRT-OFF                           14260000
140500                                 TO AISUAMTA                      14270000
140600             MOVE DP015-RED      TO AISUAMTC                      14280000
140700             MOVE DP015-REVERSE  TO AISUAMTH                      14290000
140800             MOVE -1             TO AISUAMTL                      14300000
140900             SET DP030-SET-CURSOR-APPL-1                          14310000
141000                                 TO TRUE                          14320000
141100         ELSE                                                     14330000
141200             MOVE DP010I-NUMERIC-FIELD TO ASC-ISSUE-AMOUNT-9      14340000
141300             MOVE ASC-ISSUE-AMOUNT-9   TO AISUAMTO                14350000
141400             IF DP010I-NUMERIC-FIELD = ZEROS                      14360000
141500                 SET PS-ERROR                                     14370000
141600                     DP020-MSG-FATAL   TO TRUE                    14380000
141700*----PC-TSYMSG-00010 - CANNOT BE ZERO                             14390000
141800                 MOVE PC-TSYMSG-00010  TO DP020-MSG-NUMBER        14400000
141900                 MOVE DP015-UNP-ALP-BRT-OFF                       14410000
142000                                       TO AISUAMTA                14420000
142100                 MOVE DP015-RED        TO AISUAMTC                14430000
142200                 MOVE DP015-REVERSE    TO AISUAMTH                14440000
142300                 MOVE -1               TO AISUAMTL                14450000
142400                 SET DP030-SET-CURSOR-APPL-1                      14460000
142500                                       TO TRUE                    14470000
142600             END-IF                                               14480000
142700         END-IF                                                   14490000
142800     ELSE                                                         14500000
142900         MOVE ZEROS                    TO AISUAMTO                14510000
143000                                          ASC-ISSUE-AMOUNT-9      14520000
143100     END-IF.                                                      14530000
143200                                                                  14540000
143300     IF ASC-TRANSACTION > SPACES                                  14550000
143400         MOVE ASC-TRANSACTION    TO DP010I-UNEDITED-FIELD         14560000
143500         MOVE LENGTH OF ASC-TRANSACTION                           14570000
143600                                 TO DP010I-MAXIMUM-DIGITS         14580000
143700         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       14590000
143800         SET DP010I-NEGATIVE-NOT-ALLOWED                          14600000
143900                                 TO TRUE                          14610000
144000         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14620000
144100                                 USING DP010I-NUMERIC-EDIT-AREA   14630000
144200         IF DP010I-ERROR-DETECTED                                 14640000
144300             SET PS-ERROR                                         14650000
144400                 DP020-MSG-FATAL TO TRUE                          14660000
144500*----PC-TSYMSG-00008 - MUST BE NUMERIC                            14670000
144600             MOVE PC-TSYMSG-00008                                 14680000
144700                                 TO DP020-MSG-NUMBER              14690000
144800             MOVE DP015-UNP-ALP-BRT-OFF                           14700000
144900                                 TO ATRANA                        14710000
145000             MOVE DP015-RED      TO ATRANC                        14720000
145100             MOVE DP015-REVERSE  TO ATRANH                        14730000
145200             MOVE -1             TO ATRANL                        14740000
145300             SET DP030-SET-CURSOR-APPL-1                          14750000
145400                                 TO TRUE                          14760000
145500         ELSE                                                     14770000
145600             MOVE DP010I-NUMERIC-FIELD                            14780000
145700                                 TO ASC-TRANSACTION-9             14790000
145800             MOVE ASC-TRANSACTION-9                               14800000
145900                                 TO ATRANO                        14810000
146000             IF DP010I-NUMERIC-FIELD = ZEROS                      14820000
146100                 SET PS-ERROR                                     14830000
146200                     DP020-MSG-FATAL                              14840000
146300                                 TO TRUE                          14850000
146400*----PC-TSYMSG-00010 - CANNOT BE ZERO                             14860000
146500                 MOVE PC-TSYMSG-00010                             14870000
146600                                 TO DP020-MSG-NUMBER              14880000
146700                 MOVE DP015-UNP-ALP-BRT-OFF                       14890000
146800                                 TO ATRANA                        14900000
146900                 MOVE DP015-RED  TO ATRANC                        14910000
147000                 MOVE DP015-REVERSE                               14920000
147100                                 TO ATRANH                        14930000
147200                 MOVE -1         TO ATRANL                        14940000
147300                 SET DP030-SET-CURSOR-APPL-1                      14950000
147400                                 TO TRUE                          14960000
147500             END-IF                                               14970000
147600         END-IF                                                   14980000
147700     END-IF.                                                      14990000
147800                                                                  15000000
147900     IF ASC-TERMINAL > SPACES                                     15010000
148000         MOVE ASC-TERMINAL       TO DP010I-UNEDITED-FIELD         15020000
148100         MOVE LENGTH OF ASC-TERMINAL                              15030000
148200                                 TO DP010I-MAXIMUM-DIGITS         15040000
148300         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       15050000
148400         SET DP010I-NEGATIVE-NOT-ALLOWED                          15060000
148500                                 TO TRUE                          15070000
148600         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15080000
148700                                 USING DP010I-NUMERIC-EDIT-AREA   15090000
148800         IF DP010I-ERROR-DETECTED                                 15100000
148900             SET PS-ERROR                                         15110000
149000                 DP020-MSG-FATAL TO TRUE                          15120000
149100*----PC-TSYMSG-00008 - MUST BE NUMERIC                            15130000
149200             MOVE PC-TSYMSG-00008                                 15140000
149300                                 TO DP020-MSG-NUMBER              15150000
149400             MOVE DP015-UNP-ALP-BRT-OFF                           15160000
149500                                 TO ATERMA                        15170000
149600             MOVE DP015-RED      TO ATERMC                        15180000
149700             MOVE DP015-REVERSE  TO ATERMH                        15190000
149800             MOVE -1             TO ATERML                        15200000
149900             SET DP030-SET-CURSOR-APPL-1                          15210000
150000                                 TO TRUE                          15220000
150100         ELSE                                                     15230000
150200             MOVE DP010I-NUMERIC-FIELD                            15240000
150300                                 TO ASC-TERMINAL-9                15250000
150400             MOVE ASC-TERMINAL-9 TO ATERMO                        15260000
150500             IF DP010I-NUMERIC-FIELD = ZEROS                      15270000
150600                 SET PS-ERROR                                     15280000
150700                     DP020-MSG-FATAL                              15290000
150800                                 TO TRUE                          15300000
150900*----PC-TSYMSG-00010 - CANNOT BE ZERO                             15310000
151000                 MOVE PC-TSYMSG-00010                             15320000
151100                                 TO DP020-MSG-NUMBER              15330000
151200                 MOVE DP015-UNP-ALP-BRT-OFF                       15340000
151300                                 TO ATERMA                        15350000
151400                 MOVE DP015-RED  TO ATERMC                        15360000
151500                 MOVE DP015-REVERSE                               15370000
151600                                 TO ATERMH                        15380000
151700                 MOVE -1         TO ATERML                        15390000
151800                 SET DP030-SET-CURSOR-APPL-1                      15400000
151900                                 TO TRUE                          15410000
152000             END-IF                                               15420000
152100         END-IF                                                   15430000
152200     END-IF.                                                      15440000
152300                                                                  15450000
152400     IF ASC-ISSUE-STORE > SPACES                                  15460000
152500         MOVE ASC-ISSUE-STORE                                     15470000
152600                                 TO DP010I-UNEDITED-FIELD         15480000
152700         MOVE LENGTH OF ASC-ISSUE-STORE                           15490000
152800                                 TO DP010I-MAXIMUM-DIGITS         15500000
152900         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       15510000
153000         SET DP010I-NEGATIVE-NOT-ALLOWED                          15520000
153100                                 TO TRUE                          15530000
153200         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15540000
153300                                 USING DP010I-NUMERIC-EDIT-AREA   15550000
153400         IF DP010I-ERROR-DETECTED                                 15560000
153500* SPACE OUT A PREVIOUSLY VALID STORE NAME, BASED ON A NEWLY       15570000
153600*   ENTERED INVALID STORE NUMBER                                  15580000
153700             MOVE SPACES         TO ASC-ISSUE-STORE-NAME          15590000
153800                                    ASTRDESO                      15600000
153900             SET PS-ERROR                                         15610000
154000                 DP020-MSG-FATAL TO TRUE                          15620000
154100*----PC-TSYMSG-00008 - MUST BE NUMERIC                            15630000
154200             MOVE PC-TSYMSG-00008                                 15640000
154300                                 TO DP020-MSG-NUMBER              15650000
154400             MOVE DP015-UNP-ALP-BRT-OFF                           15660000
154500                                 TO AISUSTRA                      15670000
154600             MOVE DP015-RED      TO AISUSTRC                      15680000
154700             MOVE DP015-REVERSE  TO AISUSTRH                      15690000
154800             MOVE -1             TO AISUSTRL                      15700000
154900             SET DP030-SET-CURSOR-APPL-1                          15710000
155000                                 TO TRUE                          15720000
155100         ELSE                                                     15730000
155200             MOVE DP010I-NUMERIC-FIELD                            15740000
155300                                 TO ASC-ISSUE-STORE-9             15750000
155400             MOVE ASC-ISSUE-STORE-9                               15760000
155500                                 TO AISUSTRO                      15770000
155600             IF DP010I-NUMERIC-FIELD = ZEROS                      15780000
155700* SPACE OUT A PREVIOUSLY VALID STORE NAME, BASED ON A NEWLY       15790000
155800*   ENTERED INVALID STORE NUMBER                                  15800000
155900                 MOVE SPACES     TO ASC-ISSUE-STORE-NAME          15810000
156000                                    ASTRDESO                      15820000
156100                 SET PS-ERROR                                     15830000
156200                     DP020-MSG-FATAL                              15840000
156300                                 TO TRUE                          15850000
156400*----PC-TSYMSG-01212 - UPDATE NOT ALLOWED FOR STORE '000'         15860000
156500                 MOVE PC-TSYMSG-01212                             15870000
156600                                 TO DP020-MSG-NUMBER              15880000
156700                 MOVE DP015-UNP-ALP-BRT-OFF                       15890000
156800                                 TO AISUSTRA                      15900000
156900                 MOVE DP015-RED  TO AISUSTRC                      15910000
157000                 MOVE DP015-REVERSE                               15920000
157100                                 TO AISUSTRH                      15930000
157200                 MOVE -1         TO AISUSTRL                      15940000
157300                 SET DP030-SET-CURSOR-APPL-1                      15950000
157400                                 TO TRUE                          15960000
157500             ELSE                                                 15970000
157600                 MOVE ASC-ISSUE-STORE-9                           15980000
157700                                 TO DK-STORE-NBR                  15990000
157800                 PERFORM 4200-SELECT-STORE-NAME                   16000000
157900                 IF SQLCODE = +0                                  16010000
158000                     MOVE XST00001-LOC-NM                         16020000
158100                                 TO ASC-ISSUE-STORE-NAME          16030000
158200                                    ASTRDESO                      16040000
158300                     MOVE XST00001-ST-CDE TO ASC-ST-CDE           16050000
158400                 ELSE                                             16060000
158500                     IF SQLCODE = +100                            16070000
158600                         MOVE SPACES                              16080000
158700                                 TO ASC-ISSUE-STORE-NAME          16090000
158800                                    ASTRDESO                      16100000
158900                         MOVE DP015-UNP-ALP-BRT-OFF               16110000
159000                                     TO AISUSTRA                  16120000
159100                         MOVE DP015-RED                           16130000
159200                                     TO AISUSTRC                  16140000
159300                         MOVE DP015-REVERSE                       16150000
159400                                     TO AISUSTRH                  16160000
159500                         MOVE -1     TO AISUSTRL                  16170000
159600                     END-IF                                       16180000
159700                 END-IF                                           16190000
159800             END-IF                                               16200000
159900         END-IF                                                   16210000
160000     END-IF.                                                      16220000
160100                                                                  16230000
160200     IF ASC-REQUESTED-STORE > SPACES                              16240000
160300         MOVE ASC-REQUESTED-STORE                                 16250000
160400                                 TO DP010I-UNEDITED-FIELD         16260000
160500         MOVE LENGTH OF ASC-REQUESTED-STORE                       16270000
160600                                 TO DP010I-MAXIMUM-DIGITS         16280000
160700         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       16290000
160800         SET DP010I-NEGATIVE-NOT-ALLOWED                          16300000
160900                                 TO TRUE                          16310000
161000         CALL DP010I-NUMERIC-EDIT-ROUTINE                         16320000
161100                                 USING DP010I-NUMERIC-EDIT-AREA   16330000
161200         IF DP010I-ERROR-DETECTED                                 16340000
161300* SPACE OUT A PREVIOUSLY VALID STORE NAME, BASED ON A NEWLY       16350000
161400*   ENTERED INVALID STORE NUMBER                                  16360000
161500             MOVE SPACES         TO ASC-REQUESTED-STORE-NAME      16370000
161600                                    ADSTRNO                       16380000
161700             SET PS-ERROR                                         16390000
161800                 DP020-MSG-FATAL TO TRUE                          16400000
161900*----PC-TSYMSG-00008 - MUST BE NUMERIC                            16410000
162000             MOVE PC-TSYMSG-00008                                 16420000
162100                                 TO DP020-MSG-NUMBER              16430000
162200             MOVE DP015-UNP-ALP-BRT-OFF                           16440000
162300                                 TO ADSTRA                        16450000
162400             MOVE DP015-RED      TO ADSTRC                        16460000
162500             MOVE DP015-REVERSE  TO ADSTRH                        16470000
162600             MOVE -1             TO ADSTRL                        16480000
162700             SET DP030-SET-CURSOR-APPL-1                          16490000
162800                                 TO TRUE                          16500000
162900         ELSE                                                     16510000
163000             MOVE DP010I-NUMERIC-FIELD                            16520000
163100                                 TO ASC-REQUESTED-STORE-9         16530000
163200             MOVE ASC-REQUESTED-STORE-9                           16540000
163300                                 TO ADSTRO                        16550000
163400             IF DP010I-NUMERIC-FIELD = ZEROS                      16560000
163500* SPACE OUT A PREVIOUSLY VALID STORE NAME, BASED ON A NEWLY       16570000
163600*   ENTERED INVALID STORE NUMBER                                  16580000
163700                 MOVE SPACES     TO ASC-REQUESTED-STORE-NAME      16590000
163800                                    ADSTRNO                       16600000
163900                 SET PS-ERROR                                     16610000
164000                     DP020-MSG-FATAL                              16620000
164100                                 TO TRUE                          16630000
164200*----PC-TSYMSG-01212 - UPDATE NOT ALLOWED FOR STORE '000'         16640000
164300                 MOVE PC-TSYMSG-01212                             16650000
164400                                 TO DP020-MSG-NUMBER              16660000
164500                 MOVE DP015-UNP-ALP-BRT-OFF                       16670000
164600                                 TO ADSTRA                        16680000
164700                 MOVE DP015-RED  TO ADSTRC                        16690000
164800                 MOVE DP015-REVERSE                               16700000
164900                                 TO ADSTRH                        16710000
165000                 MOVE -1         TO ADSTRL                        16720000
165100                 SET DP030-SET-CURSOR-APPL-1                      16730000
165200                                 TO TRUE                          16740000
165300             ELSE                                                 16750000
165400                 MOVE ASC-REQUESTED-STORE-9                       16760000
165500                                 TO DK-STORE-NBR                  16770000
165600                 PERFORM 4200-SELECT-STORE-NAME                   16780000
165700                 IF SQLCODE = +0                                  16790000
165800                     MOVE XST00001-LOC-NM                         16800000
165900                                 TO ASC-REQUESTED-STORE-NAME      16810000
166000                                    ADSTRNO                       16820000
166100                     MOVE XST00001-ST-CDE TO ASC-ST-CDE           16830000
166200                 ELSE                                             16840000
166300                     IF SQLCODE = +100                            16850000
166400                         MOVE SPACES                              16860000
166500                                 TO ASC-REQUESTED-STORE-NAME      16870000
166600                                    ADSTRNO                       16880000
166700                         MOVE DP015-UNP-ALP-BRT-OFF               16890000
166800                                     TO ADSTRA                    16900000
166900                         MOVE DP015-RED                           16910000
167000                                     TO ADSTRC                    16920000
167100                         MOVE DP015-REVERSE                       16930000
167200                                     TO ADSTRH                    16940000
167300                         MOVE -1     TO ADSTRL                    16950000
167400                     END-IF                                       16960000
167500                 END-IF                                           16970000
167600             END-IF                                               16980000
167700         END-IF                                                   16990000
167800     END-IF.                                                      17000000
167900                                                                  17010000
168000     EVALUATE TRUE                                                17020000
168100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              17030000
168200             IF ASC-REQUESTED-STORE > SPACES                      17040000
168300                 CONTINUE                                         17050000
168400             ELSE                                                 17060000
168500                 SET PS-ERROR                                     17070000
168600                     DP020-MSG-FATAL         TO TRUE              17080000
168700*----PC-TSYMSG-00007 - REQUIRED ENTRY                             17090000
168800                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  17100000
168900                 MOVE DP015-UNP-ALP-BRT-OFF  TO ADSTRA            17110000
169000                 MOVE DP015-RED              TO ADSTRC            17120000
169100                 MOVE DP015-REVERSE          TO ADSTRH            17130000
169200                 MOVE -1                     TO ADSTRL            17140000
169300                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              17150000
169400             END-IF                                               17160000
169500     END-EVALUATE.                                                17170000
169600                                                                  17180000
169700     IF PS-NO-DB2-ERROR                                           17190000
169800         IF ASC-NUMBER-REQUESTED > SPACES                         17200000
169900             MOVE ASC-NUMBER-REQUESTED                            17210000
170000                                 TO DP010I-UNEDITED-FIELD         17220000
170100             MOVE LENGTH OF ASC-NUMBER-REQUESTED                  17230000
170200                                 TO DP010I-MAXIMUM-DIGITS         17240000
170300             MOVE ZERO           TO DP010I-MAXIMUM-DECIMALS       17250000
170400             SET DP010I-NEGATIVE-NOT-ALLOWED                      17260000
170500                                 TO TRUE                          17270000
170600             CALL DP010I-NUMERIC-EDIT-ROUTINE                     17280000
170700                                 USING DP010I-NUMERIC-EDIT-AREA   17290000
170800             IF DP010I-ERROR-DETECTED                             17300000
170900                 SET PS-ERROR                                     17310000
171000                     DP020-MSG-FATAL                              17320000
171100                                 TO TRUE                          17330000
171200*----PC-TSYMSG-00008 - MUST BE NUMERIC                            17340000
171300                 MOVE PC-TSYMSG-00008                             17350000
171400                                 TO DP020-MSG-NUMBER              17360000
171500                 MOVE DP015-UNP-ALP-BRT-OFF                       17370000
171600                                 TO ANBRREQA                      17380000
171700                 MOVE DP015-RED  TO ANBRREQC                      17390000
171800                 MOVE DP015-REVERSE                               17400000
171900                                 TO ANBRREQH                      17410000
172000                 MOVE -1         TO ANBRREQL                      17420000
172100                 SET DP030-SET-CURSOR-APPL-1                      17430000
172200                                 TO TRUE                          17440000
172300             ELSE                                                 17450000
172400                 MOVE DP010I-NUMERIC-FIELD                        17460000
172500                                 TO ASC-NUMBER-REQUESTED-9        17470000
172600                 MOVE ASC-NUMBER-REQUESTED-9                      17480000
172700                                 TO ANBRREQO                      17490000
172800             END-IF                                               17500000
172900         END-IF                                                   17510000
173000     END-IF.                                                      17520000
173100                                                                  17530000
173200     IF PS-NO-DB2-ERROR                                           17540000
173300         PERFORM 3050-EDIT-CARD-CONTROL-NBRS                      17550000
173400     END-IF.                                                      17560000
173500                                                                  17570000
173600     IF PS-NO-DB2-ERROR AND PS-NO-ERROR                           17580000
173700         IF ASC-CNTL-FROM > SPACES                                17590000
173800             MOVE ASC-CNTL-FROM  TO DP010I-UNEDITED-FIELD         17600000
173900             MOVE LENGTH OF ASC-CNTL-FROM                         17610000
174000                                 TO DP010I-MAXIMUM-DIGITS         17620000
174100             MOVE ZERO           TO DP010I-MAXIMUM-DECIMALS       17630000
174200             SET DP010I-NEGATIVE-NOT-ALLOWED                      17640000
174300                 DP010I-15-DIG-2-DEC-FORMAT                       17650000
174400                                 TO TRUE                          17660000
174500             CALL DP010I-NUMERIC-EDIT-ROUTINE                     17670000
174600                                 USING DP010I-NUMERIC-EDIT-AREA   17680000
174700             IF DP010I-ERROR-DETECTED                             17690000
174800                 SET PS-ERROR                                     17700000
174900                     DP020-MSG-FATAL                              17710000
175000                                 TO TRUE                          17720000
175100*----PC-TSYMSG-00008 - MUST BE NUMERIC                            17730000
175200                 MOVE PC-TSYMSG-00008                             17740000
175300                                 TO DP020-MSG-NUMBER              17750000
175400                 MOVE DP015-UNP-ALP-BRT-OFF                       17760000
175500                                 TO ADCDFRA                       17770000
175600                 MOVE DP015-RED  TO ADCDFRC                       17780000
175700                 MOVE DP015-REVERSE                               17790000
175800                                 TO ADCDFRH                       17800000
175900                 MOVE -1         TO ADCDFRL                       17810000
176000                 SET DP030-SET-CURSOR-APPL-1                      17820000
176100                                 TO TRUE                          17830000
176200             ELSE                                                 17840000
176300                 MOVE DP010I-NUM-FIELD-15-DIG-2-DEC               17850000
176400                                 TO ASC-CNTL-FROM-9               17860000
176500                                    PV-CNTL-NBR                   17870000
176600                 PERFORM 7100-CONTROL-NBR                         17880000
176700                 MOVE PV-CNTL-NBR TO ASC-CNTL-FROM                17890000
176800                 PERFORM 4100-SELECT-INVALID-CARD-ID              17900000
176900                 IF PS-NO-DB2-ERROR                               17910000
177000                     IF SQLCODE = +100                            17920000
177100                         SET PS-ERROR                             17930000
177200                             DP020-MSG-FATAL                      17940000
177300                                 TO TRUE                          17950000
177400*----PC-TSYMSG-01366 - CONTROL NUMBER NOT FOUND                   17960000
177500                         MOVE PC-TSYMSG-01366                     17970000
177600                                 TO DP020-MSG-NUMBER              17980000
177700                         MOVE DP015-UNP-ALP-BRT-OFF               17990000
177800                                 TO ADCDFRA                       18000000
177900                         MOVE DP015-RED                           18010000
178000                                 TO ADCDFRC                       18020000
178100                         MOVE DP015-REVERSE                       18030000
178200                                 TO ADCDFRH                       18040000
178300                         MOVE -1 TO ADCDFRL                       18050000
178400                         SET DP030-SET-CURSOR-APPL-1              18060000
178500                                 TO TRUE                          18070000
178600                     END-IF                                       18080000
178700                     IF SQLCODE = ZERO                            18090000
178800                         IF ASC-CNTL-NBR                          18100000
178900                             MOVE SVT00001-CRD-NBR                18110000
179000                                 TO ASC-NMBR-FROM-9               18120000
179100                         END-IF                                   18130000
179200                     END-IF                                       18140000
179300                 END-IF                                           18150000
179400             END-IF                                               18160000
179500         ELSE                                                     18170000
179600             SET PS-ERROR                                         18180000
179700                 DP020-MSG-FATAL TO TRUE                          18190000
179800*----PC-TSYMSG-00007 - REQUIRED ENTRY                             18200000
179900             MOVE PC-TSYMSG-00007                                 18210000
180000                                 TO DP020-MSG-NUMBER              18220000
180100             MOVE DP015-UNP-ALP-BRT-OFF                           18230000
180200                                 TO ADCDFRA                       18240000
180300             MOVE DP015-RED      TO ADCDFRC                       18250000
180400             MOVE DP015-REVERSE  TO ADCDFRH                       18260000
180500             MOVE -1             TO ADCDFRL                       18270000
180600             SET DP030-SET-CURSOR-APPL-1                          18280000
180700                                 TO TRUE                          18290000
180800         END-IF                                                   18300000
180900     END-IF.                                                      18310000
181000                                                                  18320000
181100     IF  PS-NO-ERROR AND PS-NO-DB2-ERROR                          18330000
181200         IF ASC-CNTL-TO > SPACES                                  18340000
181300             MOVE ASC-CNTL-TO    TO DP010I-UNEDITED-FIELD         18350000
181400             MOVE LENGTH OF ASC-CNTL-TO                           18360000
181500                                 TO DP010I-MAXIMUM-DIGITS         18370000
181600             MOVE ZERO           TO DP010I-MAXIMUM-DECIMALS       18380000
181700             SET DP010I-NEGATIVE-NOT-ALLOWED                      18390000
181800                 DP010I-15-DIG-2-DEC-FORMAT                       18400000
181900                                 TO TRUE                          18410000
182000             CALL DP010I-NUMERIC-EDIT-ROUTINE                     18420000
182100                                 USING DP010I-NUMERIC-EDIT-AREA   18430000
182200             IF DP010I-ERROR-DETECTED                             18440000
182300                 SET PS-ERROR                                     18450000
182400                     DP020-MSG-FATAL                              18460000
182500                                 TO TRUE                          18470000
182600*----PC-TSYMSG-00008 - MUST BE NUMERIC                            18480000
182700                 MOVE PC-TSYMSG-00008                             18490000
182800                                 TO DP020-MSG-NUMBER              18500000
182900                 MOVE DP015-UNP-ALP-BRT-OFF                       18510000
183000                                 TO ADCDTOA                       18520000
183100                 MOVE DP015-RED  TO ADCDTOC                       18530000
183200                 MOVE DP015-REVERSE                               18540000
183300                                 TO ADCDTOH                       18550000
183400                 MOVE -1         TO ADCDTOL                       18560000
183500                 SET DP030-SET-CURSOR-APPL-1                      18570000
183600                                 TO TRUE                          18580000
183700             ELSE                                                 18590000
183800                 MOVE DP010I-NUM-FIELD-15-DIG-2-DEC               18600000
183900                                 TO ASC-CNTL-TO-9                 18610000
184000                                    PV-CNTL-NBR                   18620000
184100                 PERFORM 7100-CONTROL-NBR                         18630000
184200                 MOVE PV-CNTL-NBR TO ASC-CNTL-TO                  18640000
184300                 PERFORM 4100-SELECT-INVALID-CARD-ID              18650000
184400                 IF PS-NO-DB2-ERROR                               18660000
184500                     IF SQLCODE = +100                            18670000
184600                         SET PS-ERROR                             18680000
184700                             DP020-MSG-FATAL                      18690000
184800                                 TO TRUE                          18700000
184900*----PC-TSYMSG-01366 - CONTROL NUMBER NOT FOUND                   18710000
185000                         MOVE PC-TSYMSG-01366                     18720000
185100                                 TO DP020-MSG-NUMBER              18730000
185200                         MOVE DP015-UNP-ALP-BRT-OFF               18740000
185300                                 TO ADCDTOA                       18750000
185400                         MOVE DP015-RED                           18760000
185500                                 TO ADCDTOC                       18770000
185600                         MOVE DP015-REVERSE                       18780000
185700                                 TO ADCDTOH                       18790000
185800                         MOVE -1 TO ADCDTOL                       18800000
185900                         SET DP030-SET-CURSOR-APPL-1              18810000
186000                                 TO TRUE                          18820000
186100                     END-IF                                       18830000
186200                     IF SQLCODE = ZERO                            18840000
186300                         IF ASC-CNTL-NBR                          18850000
186400                             MOVE SVT00001-CRD-NBR                18860000
186500                                 TO ASC-NMBR-TO-9                 18870000
186600                         END-IF                                   18880000
186700                     END-IF                                       18890000
186800                 END-IF                                           18900000
186900             END-IF                                               18910000
187000         ELSE                                                     18920000
187100             IF (ASC-NUMBER-REQUESTED-9 = ZEROS                   18930000
187200             OR  ASC-NUMBER-REQUESTED  = SPACES)                  18940000
187300                 SET PS-ERROR                                     18950000
187400                     DP020-MSG-FATAL TO TRUE                      18960000
187500*----PC-TSYMSG-00007 - REQUIRED ENTRY                             18970000
187600                 MOVE PC-TSYMSG-00007                             18980000
187700                                 TO DP020-MSG-NUMBER              18990000
187800                 MOVE DP015-UNP-ALP-BRT-OFF                       19000000
187900                                 TO ADCDTOA                       19010000
188000                 MOVE DP015-RED  TO ADCDTOC                       19020000
188100                 MOVE DP015-REVERSE                               19030000
188200                                 TO ADCDTOH                       19040000
188300                 MOVE -1         TO ADCDTOL                       19050000
188400                 SET DP030-SET-CURSOR-APPL-1                      19060000
188500                                 TO TRUE                          19070000
188600             ELSE                                                 19080000
188700                 PERFORM 3300-CALC-ENDING-CNTL                    19090000
188800             END-IF                                               19100000
188900         END-IF                                                   19110000
189000     END-IF.                                                      19120000
189100                                                                  19130000
189200     IF  PS-NO-ERROR AND PS-NO-DB2-ERROR                          19140000
189300         PERFORM 3100-CROSS-EDIT-IN-COMMAREA                      19150000
189400         IF PS-NO-ERROR                                           19160000
189500             EVALUATE TRUE                                        19170000
189600                 WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)      19180000
189700                     MOVE ASC-CNTL-FROM-9                         19190000
189800                                 TO PV-CNTL-NBR-FROM              19200000
189900                     PERFORM 7000-CONTROL-NBR-FROM                19210000
190000                     MOVE ASC-CNTL-TO-9                           19220000
190100                                 TO PV-CNTL-NBR-TO                19230000
190200                     PERFORM 7200-CONTROL-NBR-TO                  19240000
190300                     PERFORM 4300-SELECT-INVALID-CARD-IDS         19250000
190400                     IF PS-NO-DB2-ERROR                           19260000
190500                         IF SQLCODE = 0 OR SQLCODE = -811         19270000
190600                             PERFORM 4350-SELECT-INVALID-CARD-IDS 19280000
190700                             IF PS-NO-DB2-ERROR                   19290000
190800                                 SET PS-ERROR                     19300000
190900                                     DP020-MSG-FATAL TO TRUE      19310000
191000*----PC-TSYMSG-01207 - CONTROL NBR &VAR IS NOT IN A VALID         19320000
191100*----                  STATUS FOR THIS FUNCTION                   19330000
191200                                 MOVE PC-TSYMSG-01207             19340000
191300                                              TO DP020-MSG-NUMBER 19350000
191400                                 MOVE DP015-UNP-ALP-BRT-OFF       19360000
191500                                                    TO ADCDTOA    19370000
191600                                                       ADCDFRA    19380000
191700                                 MOVE DP015-RED     TO ADCDTOC    19390000
191800                                                       ADCDFRC    19400000
191900                                 MOVE DP015-REVERSE TO ADCDTOH    19410000
192000                                                       ADCDFRH    19420000
192100                                 MOVE -1            TO ADCDTOL    19430000
192200                                                       ADCDFRL    19440000
192300                                 SET DP030-SET-CURSOR-APPL-1      19450000
192400                                                    TO TRUE       19460000
192500                             END-IF                               19470000
192600                         END-IF                                   19480000
192700                     END-IF                                       19490000
192800                                                                  19500000
192900                     PERFORM 4700-SELECT-INVALID-CARD-IDS         19510000
193000                     IF PS-NO-DB2-ERROR                           19520000
193100                         IF SQLCODE = 0 OR SQLCODE = -811         19530000
193200                             PERFORM 4750-SELECT-INVALID-CARD-IDS 19540000
193300                             IF PS-NO-DB2-ERROR                   19550000
193400                                 SET PS-ERROR                     19560000
193500                                     DP020-MSG-FATAL TO TRUE      19570000
193600*----PC-TSYMSG-03141 - CONTROL NBR &VAR IS ALREADY ASSIGNED       19580000
193700*----                  TO A STORE                                 19590000
193800                                 MOVE PC-TSYMSG-03141             19600000
193900                                        TO DP020-MSG-NUMBER       19610000
194000                                 MOVE DP015-UNP-ALP-BRT-OFF       19620000
194100                                                     TO ADCDTOA   19630000
194200                                                        ADCDFRA   19640000
194300                                 MOVE DP015-RED      TO ADCDTOC   19650000
194400                                                        ADCDFRC   19660000
194500                                 MOVE DP015-REVERSE  TO ADCDTOH   19670000
194600                                                        ADCDFRH   19680000
194700                                 MOVE -1             TO ADCDTOL   19690000
194800                                                        ADCDFRL   19700000
194900                                 SET DP030-SET-CURSOR-APPL-1      19710000
195000                                                     TO TRUE      19720000
195100                             END-IF                               19730000
195200                         END-IF                                   19740000
195300                     END-IF                                       19750000
195400                                                                  19760000
195500                 WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)      19770000
195600                     IF ASC-ISSUE-AMOUNT > SPACES                 19780000
195700                         CONTINUE                                 19790000
195800                     ELSE                                         19800000
195900                         SET PS-ERROR                             19810000
196000                             DP020-MSG-FATAL                      19820000
196100                             DP030-SET-CURSOR-APPL-1 TO TRUE      19830000
196200*----PC-TSYMSG-00007 - REQUIRED ENTRY                             19840000
196300                         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER 19850000
196400                         MOVE DP015-UNP-ALP-BRT-OFF TO AISUAMTA   19860000
196500                         MOVE DP015-RED             TO AISUAMTC   19870000
196600                         MOVE DP015-REVERSE         TO AISUAMTH   19880000
196700                         MOVE -1                    TO AISUAMTL   19890000
196800                     END-IF                                       19900000
196900                     IF ASC-TRANSACTION > SPACES                  19910000
197000                         CONTINUE                                 19920000
197100                     ELSE                                         19930000
197200                         SET PS-ERROR                             19940000
197300                             DP020-MSG-FATAL                      19950000
197400                             DP030-SET-CURSOR-APPL-1 TO TRUE      19960000
197500*----PC-TSYMSG-00007 - REQUIRED ENTRY                             19970000
197600                         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER 19980000
197700                         MOVE DP015-UNP-ALP-BRT-OFF TO ATRANA     19990000
197800                         MOVE DP015-RED             TO ATRANC     20000000
197900                         MOVE DP015-REVERSE         TO ATRANH     20010000
198000                         MOVE -1                    TO ATRANL     20020000
198100                     END-IF                                       20030000
198200                     IF ASC-TERMINAL > SPACES                     20040000
198300                          CONTINUE                                20050000
198400                     ELSE                                         20060000
198500                         SET PS-ERROR                             20070000
198600                             DP020-MSG-FATAL                      20080000
198700                             DP030-SET-CURSOR-APPL-1 TO TRUE      20090000
198800*----PC-TSYMSG-00007 - REQUIRED ENTRY                             20100000
198900                         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER 20110000
199000                         MOVE DP015-UNP-ALP-BRT-OFF TO ATERMA     20120000
199100                         MOVE DP015-RED             TO ATERMC     20130000
199200                         MOVE DP015-REVERSE         TO ATERMH     20140000
199300                         MOVE -1                    TO ATERML     20150000
199400                     END-IF                                       20160000
199500                     IF ASC-REQUESTED-STORE > SPACES              20170000
199600                         MOVE 'N' TO ASC-REQSTED-STORE            20180000
199700                     ELSE                                         20190000
199800                         IF REQUESTED-STORE-FIRST-TIME            20200000
199900                             MOVE 'Y' TO ASC-REQSTED-STORE        20210000
200000                             SET DP030-SET-CURSOR-APPL-1          20220000
200100                                 DP020-MSG-WARNING TO TRUE        20230000
200200*----PC-TSYMSG-02517 - ASSIGN STORE NOT ENTERED                   20240000
200300                             MOVE PC-TSYMSG-02517                 20250000
200400                                 TO DP020-MSG-NUMBER              20260000
200500                             MOVE DP015-UNP-ALP-BRT-OFF TO ADSTRA 20270000
200600                             MOVE DP015-YELLOW          TO ADSTRC 20280000
200700                             MOVE DP015-REVERSE         TO ADSTRH 20290000
200800                             MOVE -1                    TO ADSTRL 20300000
200900                         ELSE                                     20310000
201000                             MOVE 'N' TO ASC-REQSTED-STORE        20320000
201100                         END-IF                                   20330000
201200                     END-IF                                       20340000
201300                     IF ASC-ISSUE-STORE > SPACES                  20350000
201400                         CONTINUE                                 20360000
201500                     ELSE                                         20370000
201600                         SET PS-ERROR                             20380000
201700                             DP030-SET-CURSOR-APPL-1              20390000
201800                             DP020-MSG-FATAL TO TRUE              20400000
201900*----PC-TSYMSG-00007 - REQUIRED ENTRY                             20410000
202000                         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER 20420000
202100                         MOVE DP015-UNP-ALP-BRT-OFF TO AISUSTRA   20430000
202200                         MOVE DP015-RED             TO AISUSTRC   20440000
202300                         MOVE DP015-REVERSE         TO AISUSTRH   20450000
202400                         MOVE -1                    TO AISUSTRL   20460000
202500                     END-IF                                       20470000
202600*  ALL CARDS MUST BE IN AVAILABLE STATUS IN ORDER TO BE ISSUED    20480000
202700                     MOVE ASC-CNTL-FROM-9 TO PV-CNTL-NBR-FROM     20490000
202800                     PERFORM 7000-CONTROL-NBR-FROM                20500000
202900                     MOVE ASC-CNTL-TO-9 TO PV-CNTL-NBR-TO         20510000
203000                     PERFORM 7200-CONTROL-NBR-TO                  20520000
203100                     PERFORM 4300-SELECT-INVALID-CARD-IDS         20530000
203200                     IF PS-NO-DB2-ERROR                           20540000
203300                         IF SQLCODE = 0 OR SQLCODE = -811         20550000
203400                             PERFORM 4350-SELECT-INVALID-CARD-IDS 20560000
203500                             IF PS-NO-DB2-ERROR                   20570000
203600                                 SET PS-ERROR                     20580000
203700                                     DP020-MSG-FATAL TO TRUE      20590000
203800*----PC-TSYMSG-01207 - CONTROL NBR &VAR IS NOT IN A VALID         20600000
203900*----                  STATUS FOR THIS FUNCTION                   20610000
204000                                 MOVE PC-TSYMSG-01207             20620000
204100                                     TO DP020-MSG-NUMBER          20630000
204200                                 MOVE DP015-UNP-ALP-BRT-OFF       20640000
204300                                                TO ADCDTOA        20650000
204400                                                   ADCDFRA        20660000
204500                                 MOVE DP015-RED TO ADCDTOC        20670000
204600                                                   ADCDFRC        20680000
204700                                 MOVE DP015-REVERSE TO ADCDTOH    20690000
204800                                                       ADCDFRH    20700000
204900                                 MOVE -1            TO ADCDTOL    20710000
205000                                                       ADCDFRL    20720000
205100                                 SET DP030-SET-CURSOR-APPL-1      20730000
205200                                                    TO TRUE       20740000
205300                             END-IF                               20750000
205400                         END-IF                                   20760000
205500                     END-IF                                       20770000
205600                                                                  20780000
205700                 WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)      20790000
205800                     MOVE ASC-CNTL-FROM-9 TO PV-CNTL-NBR-FROM     20800000
205900                     PERFORM 7000-CONTROL-NBR-FROM                20810000
206000                     MOVE ASC-CNTL-TO-9 TO PV-CNTL-NBR-TO         20820000
206100                     PERFORM 7200-CONTROL-NBR-TO                  20830000
206200                     PERFORM 4300-SELECT-INVALID-CARD-IDS         20840000
206300                     IF PS-NO-DB2-ERROR                           20850000
206400                         IF SQLCODE = 0 OR SQLCODE = -811         20860000
206500                             PERFORM  4350-SELECT-INVALID-CARD-IDS20870000
206600                             IF PS-NO-DB2-ERROR                   20880000
206700                                 SET PS-ERROR                     20890000
206800                                     DP020-MSG-FATAL TO TRUE      20900000
206900*----PC-TSYMSG-01207 - CONTROL NBR &VAR IS NOT IN A VALID         20910000
207000*----                  STATUS FOR THIS FUNCTION                   20920000
207100                                 MOVE PC-TSYMSG-01207             20930000
207200                                     TO DP020-MSG-NUMBER          20940000
207300                                 MOVE DP015-UNP-ALP-BRT-OFF       20950000
207400                                                       TO ADCDTOA 20960000
207500                                                          ADCDFRA 20970000
207600                                 MOVE DP015-RED        TO ADCDTOC 20980000
207700                                                          ADCDFRC 20990000
207800                                 MOVE DP015-REVERSE    TO ADCDTOH 21000000
207900                                                          ADCDFRH 21010000
208000                                 MOVE -1               TO ADCDTOL 21020000
208100                                                          ADCDFRL 21030000
208200                                 SET DP030-SET-CURSOR-APPL-1      21040000
208300                                                       TO TRUE    21050000
208400                             END-IF                               21060000
208500                         END-IF                                   21070000
208600                     END-IF                                       21080000
208700                                                                  21090000
208800             END-EVALUATE                                         21100000
208900                                                                  21110000
209000             IF PS-NO-ERROR AND PS-NO-DB2-ERROR                   21120000
209100                 MOVE -1                     TO ADNBFRL           21130000
209200                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              21140000
209300             END-IF                                               21150000
209400         END-IF                                                   21160000
209500     END-IF.                                                      21170000
209600*----------------------------------------------------------------*21180000
209700* DETERMINE WHETHER CARD NUMBER OR CONTROL NUMBER WAS ENTERED.   *21190000
209800*----------------------------------------------------------------*21200000
209900 3050-EDIT-CARD-CONTROL-NBRS.                                     21210000
210000     IF ASC-FIRSTTIME OR                                          21220000
210100       ((ASC-NMBR-TO > SPACES OR ASC-NMBR-FROM > SPACES)  AND     21230000
210200        (ASC-CNTL-TO = SPACES AND ASC-CNTL-FROM = SPACES))  OR    21240000
210300       ((ASC-NMBR-TO = SPACES AND ASC-NMBR-FROM = SPACES)  AND    21250000
210400        (ASC-CNTL-TO > SPACES OR ASC-CNTL-FROM > SPACES))         21260000
210500         SET ASC-NOT-FIRSTTIME   TO TRUE                          21270000
210600         IF (ASC-NMBR-TO > SPACES OR ASC-NMBR-FROM > SPACES)      21280000
210700           AND (ASC-CNTL-TO > SPACES OR ASC-CNTL-FROM > SPACES)   21290000
210800             SET PS-ERROR                                         21300000
210900                 DP020-MSG-FATAL TO TRUE                          21310000
211000*----PC-TSYMSG-02403 - CANNOT ENTER BOTH THE CARD AND CONTROL     21320000
211100*----                  CONTROL NUMBERS                            21330000
211200             MOVE PC-TSYMSG-02403       TO DP020-MSG-NUMBER       21340000
211300             MOVE DP015-UNP-ALP-BRT-OFF TO ADCDTOA                21350000
211400                                           ADCDFRA                21360000
211500                                           ADNBTOA                21370000
211600                                           ADNBFRA                21380000
211700             MOVE DP015-RED             TO ADCDTOC                21390000
211800                                           ADCDFRC                21400000
211900                                           ADNBTOC                21410000
212000                                           ADNBFRC                21420000
212100             MOVE DP015-REVERSE         TO ADCDTOH                21430000
212200                                           ADCDFRH                21440000
212300                                           ADNBTOH                21450000
212400                                           ADNBFRH                21460000
212500             MOVE -1                    TO ADCDTOL                21470000
212600                                           ADCDFRL                21480000
212700                                           ADNBTOL                21490000
212800                                           ADNBFRL                21500000
212900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  21510000
213000         ELSE                                                     21520000
213100             IF ASC-NMBR-FROM > SPACES OR ASC-NMBR-TO > SPACES    21530000
213200                 SET ASC-CARD-NBR      TO TRUE                    21540000
213300                 PERFORM 3070-EDIT-CARD-NMBR-TO                   21550000
213400                 PERFORM 3080-EDIT-CARD-NMBR-FROM                 21560000
213500             ELSE                                                 21570000
213600                 IF ASC-CNTL-FROM > SPACES OR ASC-CNTL-TO > SPACES21580000
213700                     SET ASC-CNTL-NBR      TO TRUE                21590000
213800                 END-IF                                           21600000
213900             END-IF                                               21610000
214000         END-IF                                                   21620000
214100     ELSE                                                         21630000
214200         IF ASC-CARD-NBR                                          21640000
214300             IF PS-TO-CNTL-CHANGED OR PS-FROM-CNTL-CHANGED        21650000
214400                 IF PS-TO-CNTL-CHANGED                            21660000
214500                     SET PS-ERROR                                 21670000
214600                         DP020-MSG-FATAL TO TRUE                  21680000
214700*----PC-TSYMSG-02405 - CONTROL NUMBER NOT ASSOCIATED WITH CARD    21690000
214800*                      NUMBER. PRESS ENTER.                       21700000
214900                     MOVE PC-TSYMSG-02405 TO DP020-MSG-NUMBER     21710000
215000                     MOVE DP015-UNP-ALP-BRT-OFF  TO ADCDTOA       21720000
215100                     MOVE DP015-RED              TO ADCDTOC       21730000
215200                     MOVE DP015-REVERSE          TO ADCDTOH       21740000
215300                     MOVE -1                     TO ADCDTOL       21750000
215400                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          21760000
215500                 END-IF                                           21770000
215600                 IF PS-FROM-CNTL-CHANGED                          21780000
215700                     SET PS-ERROR                                 21790000
215800                         DP020-MSG-FATAL TO TRUE                  21800000
215900*----PC-TSYMSG-02405 - CONTROL NUMBER NOT ASSOCIATED WITH CARD    21810000
216000*                      NUMBER. PRESS ENTER.                       21820000
216100                     MOVE PC-TSYMSG-02405 TO DP020-MSG-NUMBER     21830000
216200                     MOVE DP015-UNP-ALP-BRT-OFF  TO ADCDFRA       21840000
216300                     MOVE DP015-RED              TO ADCDFRC       21850000
216400                     MOVE DP015-REVERSE          TO ADCDFRH       21860000
216500                     MOVE -1                     TO ADCDFRL       21870000
216600                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          21880000
216700                 END-IF                                           21890000
216800             ELSE                                                 21900000
216900                 PERFORM 3070-EDIT-CARD-NMBR-TO                   21910000
217000                 PERFORM 3080-EDIT-CARD-NMBR-FROM                 21920000
217100             END-IF                                               21930000
217200         ELSE                                                     21940000
217300             IF ASC-CNTL-NBR                                      21950000
217400                 IF PS-TO-NMBR-CHANGED                            21960000
217500                     SET PS-ERROR                                 21970000
217600                         DP020-MSG-FATAL TO TRUE                  21980000
217700*----PC-TSYMSG-02404 - CARD NUMBER NOT ASSOCIATED WITH CONTROL    21990000
217800*                      NUMBER. PRESS ENTER.                       22000000
217900                     MOVE PC-TSYMSG-02404 TO DP020-MSG-NUMBER     22010000
218000                     MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBTOA       22020000
218100                     MOVE DP015-RED              TO ADNBTOC       22030000
218200                     MOVE DP015-REVERSE          TO ADNBTOH       22040000
218300                     MOVE -1                     TO ADNBTOL       22050000
218400                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          22060000
218500                 END-IF                                           22070000
218600                 IF PS-FROM-NMBR-CHANGED                          22080000
218700                     SET PS-ERROR                                 22090000
218800                         DP020-MSG-FATAL TO TRUE                  22100000
218900*----PC-TSYMSG-02404 - CARD NUMBER NOT ASSOCIATED WITH CONTROL    22110000
219000*                      NUMBER. PRESS ENTER.                       22120000
219100                     MOVE PC-TSYMSG-02404 TO DP020-MSG-NUMBER     22130000
219200                     MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBFRA       22140000
219300                     MOVE DP015-RED              TO ADNBFRC       22150000
219400                     MOVE DP015-REVERSE          TO ADNBFRH       22160000
219500                     MOVE -1                     TO ADNBFRL       22170000
219600                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          22180000
219700                 END-IF                                           22190000
219800             END-IF                                               22200000
219900         END-IF                                                   22210000
220000     END-IF.                                                      22220000
220100*----------------------------------------------------------------*22230000
220200* EDIT THE CARD NUMBER  'TO' FIELD.                              *22240000
220300* THE CARD NUMBER FIELD ON THE MAP IS DEFINED WITH A LENGTH OF   *22250000
220400* 30. THE CARD#'S ENTERED/SCANNED CAN BE 10, 12, 13, 19 AND 30   *22260000
220500* DIGITS IN LENGTH.                                              *22270000
220600*----------------------------------------------------------------*22280000
220700 3070-EDIT-CARD-NMBR-TO.                                          22290000
220800                                                                  22300000
220900     IF ASC-NMBR-TO > SPACES                                      22310000
221000       SET SV007-FORMAT-IN             TO TRUE                    22320000
221100       MOVE 0                          TO SV007-CARD-NUMBER-LENGTH22330000
221200       MOVE ASC-NMBR-TO                TO SV007-CARD-NUMBER-IN    22340000
221300       SET SV007-FORMAT-BOTH           TO TRUE                    22350000
221400       PERFORM SV007-FORMAT-CARD                                  22360000
221500       IF SV007-FORMAT-ERROR                                      22370000
221600           SET PS-ERROR                                           22380000
221700               DP020-MSG-FATAL         TO TRUE                    22390000
221800           MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER        22400000
221900           MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBTOA                 22410000
222000           MOVE DP015-RED              TO ADNBTOC                 22420000
222100           MOVE DP015-REVERSE          TO ADNBTOH                 22430000
222200           MOVE -1                     TO ADNBTOL                 22440000
222300           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    22450000
222400       ELSE                                                       22460000
222500           MOVE SV007-CARD-NBR       TO DK-CARD-NBR               22470000
222600           MOVE SV007-CARD-NUMBER    TO ASC-NMBR-TO               22480000
222700           MOVE SV007-CARD-NUMBER-DISPLAY TO ADNBTOO              22490000
222800           PERFORM 4680-GET-CONTROL-NUMBER                        22500000
222900           IF SQLCODE = 0                                         22510000
223000              MOVE ASC-CNTL-TO-9 TO PV-CNTL-NBR                   22520000
223100              PERFORM 7100-CONTROL-NBR                            22530000
223200              MOVE PV-CNTL-NBR TO ASC-CNTL-TO                     22540000
223300              IF SVT00001-CRD-PROD-YR NOT EQUAL DK-CRD-PROD-YR    22550000
223400                OR SVT00001-SHIPT-REQ-NBR NOT EQUAL               22560000
223500                                               DK-SHIPT-REQ-NBR   22570000
223600                OR SVT00001-CNTL-NBR NOT EQUAL DK-CNTL-NBR        22580000
223700                MOVE SVT00001-CRD-PROD-YR   TO PV-REQ-DTE         22590000
223800                MOVE SVT00001-SHIPT-REQ-NBR TO PV-REQ-NBR         22600000
223900                MOVE SVT00001-CNTL-NBR      TO PV-SEQ-NBR         22610000
224000                MOVE PV-CNTL-NBR            TO ASC-CNTL-TO-9      22620000
224100                                               ADCDTOO            22630000
224200                SET PS-TO-CNTL-CHANGED       TO TRUE              22640000
224300              END-IF                                              22650000
224400           ELSE                                                   22660000
224500              SET PS-ERROR                                        22670000
224600                  DP020-MSG-FATAL  TO TRUE                        22680000
224700*----PC-TSYMSG-01210 - CARD ID NOT FOUND                          22690000
224800              MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER            22700000
224900              MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBTOA              22710000
225000              MOVE DP015-RED              TO ADNBTOC              22720000
225100              MOVE DP015-REVERSE          TO ADNBTOH              22730000
225200              MOVE -1                     TO ADNBTOL              22740000
225300              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 22750000
225400           END-IF                                                 22760000
225500       END-IF                                                     22770000
225600     ELSE                                                         22780000
225700        MOVE SPACES                  TO ASC-CNTL-TO               22790000
225800        SET PS-TO-CNTL-CHANGED TO TRUE                            22800000
225900        IF (ASC-NUMBER-REQUESTED-9 = ZEROS                        22810000
226000          OR  ASC-NUMBER-REQUESTED  = SPACES)                     22820000
226100          SET PS-ERROR                                            22830000
226200              DP020-MSG-FATAL         TO TRUE                     22840000
226300*----PC-TSYMSG-00007 - REQUIRED ENTRY                             22850000
226400          MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER         22860000
226500          MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBTOA                  22870000
226600          MOVE DP015-RED              TO ADNBTOC                  22880000
226700          MOVE DP015-REVERSE          TO ADNBTOH                  22890000
226800          MOVE -1                     TO ADNBTOL                  22900000
226900          SET DP030-SET-CURSOR-APPL-1 TO TRUE                     22910000
227000        END-IF                                                    22920000
227100     END-IF.                                                      22930000
227200                                                                  22940000
227300*----------------------------------------------------------------*22950000
227400* EDIT THE CARD NUMBER FROM FIELD.                               *22960000
227500* THE CARD NUMBER FIELD ON THE MAP IS DEFINED WITH A LENGTH OF   *22970000
227600* 30. THE CARD#'S ENTERED/SCANNED CAN BE 10, 12, 13, 19 AND 30   *22980000
227700* DIGITS IN LENGTH.                                              *22990000
227800*----------------------------------------------------------------*23000000
227900 3080-EDIT-CARD-NMBR-FROM.                                        23010000
228000                                                                  23020000
228100     IF ASC-NMBR-FROM > SPACES                                    23030000
228200       SET SV007-FORMAT-BOTH           TO TRUE                    23040000
228300       MOVE 0                          TO SV007-CARD-NUMBER-LENGTH23050000
228400       MOVE ASC-NMBR-FROM              TO SV007-CARD-NUMBER-IN    23060000
228500       PERFORM SV007-FORMAT-CARD                                  23070000
228600       IF SV007-FORMAT-ERROR                                      23080000
228700           SET PS-ERROR                                           23090000
228800               DP020-MSG-FATAL         TO TRUE                    23100000
228900           MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER        23110000
229000           MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBFRA                 23120000
229100           MOVE DP015-RED              TO ADNBFRC                 23130000
229200           MOVE DP015-REVERSE          TO ADNBFRH                 23140000
229300           MOVE -1                     TO ADNBFRL                 23150000
229400           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    23160000
229500       ELSE                                                       23170000
229600           MOVE SV007-CARD-NBR       TO DK-CARD-NBR               23180000
229700           MOVE SV007-CARD-NUMBER    TO ASC-NMBR-FROM             23190000
229800           MOVE SV007-CARD-NUMBER-DISPLAY TO ADNBFRO              23200000
229900            PERFORM 4680-GET-CONTROL-NUMBER                       23210000
230000            IF SQLCODE = 0                                        23220000
230100               MOVE ASC-CNTL-FROM-9 TO PV-CNTL-NBR                23230000
230200               PERFORM 7100-CONTROL-NBR                           23240000
230300               MOVE PV-CNTL-NBR TO ASC-CNTL-FROM                  23250000
230400               IF SVT00001-CRD-PROD-YR NOT EQUAL DK-CRD-PROD-YR   23260000
230500                OR SVT00001-SHIPT-REQ-NBR NOT EQUAL               23270000
230600                                              DK-SHIPT-REQ-NBR    23280000
230700                OR SVT00001-CNTL-NBR NOT EQUAL DK-CNTL-NBR        23290000
230800                   MOVE SVT00001-CRD-PROD-YR   TO PV-REQ-DTE      23300000
230900                   MOVE SVT00001-SHIPT-REQ-NBR TO PV-REQ-NBR      23310000
231000                   MOVE SVT00001-CNTL-NBR      TO PV-SEQ-NBR      23320000
231100                   MOVE PV-CNTL-NBR            TO ASC-CNTL-FROM-9 23330000
231200                                                  ADCDFRO         23340000
231300                   SET PS-FROM-CNTL-CHANGED  TO TRUE              23350000
231400               END-IF                                             23360000
231500            ELSE                                                  23370000
231600               SET PS-ERROR                                       23380000
231700                   DP020-MSG-FATAL  TO TRUE                       23390000
231800*----PC-TSYMSG-01210 - CARD ID NOT FOUND                          23400000
231900               MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER           23410000
232000               MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBFRA             23420000
232100               MOVE DP015-RED              TO ADNBFRC             23430000
232200               MOVE DP015-REVERSE          TO ADNBFRH             23440000
232300               MOVE -1                     TO ADNBFRL             23450000
232400               SET DP030-SET-CURSOR-APPL-1 TO TRUE                23460000
232500            END-IF                                                23470000
232600       END-IF                                                     23480000
232700     ELSE                                                         23490000
232800        MOVE SPACES                  TO ASC-CNTL-FROM             23500000
232900        SET PS-FROM-CNTL-CHANGED                                  23510000
233000            PS-ERROR                                              23520000
233100            DP020-MSG-FATAL          TO TRUE                      23530000
233200*----PC-TSYMSG-00007 - REQUIRED ENTRY                             23540000
233300        MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER           23550000
233400        MOVE DP015-UNP-ALP-BRT-OFF  TO ADNBFRA                    23560000
233500        MOVE DP015-RED              TO ADNBFRC                    23570000
233600        MOVE DP015-REVERSE          TO ADNBFRH                    23580000
233700        MOVE -1                     TO ADNBFRL                    23590000
233800        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       23600000
233900     END-IF.                                                      23610000
234000                                                                  23620000
234100*----------------------------------------------------------------*23630000
234200* MORE COMPLEX EDITS                                             *23640000
234300*----------------------------------------------------------------*23650000
234400 3100-CROSS-EDIT-IN-COMMAREA.                                     23660000
234500     IF ASC-CNTL-TO > SPACES AND                                  23670000
234600        ASC-CNTL-FROM > SPACES                                    23680000
234700         IF ASC-CNTL-TO < ASC-CNTL-FROM                           23690000
234800             SET PS-ERROR                                         23700000
234900                 DP020-MSG-FATAL         TO TRUE                  23710000
235000*----PC-TSYMSG-01209 - THE BEGINNING CONTROL NBR MUST BE LESS     23720000
235100*----                  THAN THE ENDING CONTROL NBR                23730000
235200             MOVE PC-TSYMSG-01209 TO DP020-MSG-NUMBER             23740000
235300             MOVE DP015-UNP-ALP-BRT-OFF  TO ADCDTOA               23750000
235400                                            ADCDFRA               23760000
235500             MOVE DP015-RED              TO ADCDTOC               23770000
235600                                            ADCDFRC               23780000
235700             MOVE DP015-REVERSE          TO ADCDTOH               23790000
235800                                            ADCDFRH               23800000
235900             MOVE -1                     TO ADCDTOL               23810000
236000                                            ADCDFRL               23820000
236100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  23830000
236200         ELSE                                                     23840000
236300             IF (PS-NBR-REQUESTED-CHANGED                         23850000
236400             AND PS-TO-CNTL-CHANGED)                              23860000
236500                 PERFORM 3400-CALC-NUMBER-REQUESTED               23870000
236600             ELSE                                                 23880000
236700                 IF PS-TO-CNTL-CHANGED                            23890000
236800                     PERFORM 3400-CALC-NUMBER-REQUESTED           23900000
236900                 ELSE                                             23910000
237000                     IF PS-NBR-REQUESTED-CHANGED                  23920000
237100                         IF ASC-NUMBER-REQUESTED-9 = ZERO         23930000
237200                             PERFORM 3400-CALC-NUMBER-REQUESTED   23940000
237300                         ELSE                                     23950000
237400                             PERFORM 3300-CALC-ENDING-CNTL        23960000
237500                         END-IF                                   23970000
237600                     ELSE                                         23980000
237700                         IF PS-FROM-CNTL-CHANGED                  23990000
237800                             PERFORM 3400-CALC-NUMBER-REQUESTED   24000000
237900                         END-IF                                   24010000
238000                     END-IF                                       24020000
238100                 END-IF                                           24030000
238200             END-IF                                               24040000
238300         END-IF                                                   24050000
238400     END-IF.                                                      24060000
238500                                                                  24070000
238600*  ONLY ALLOW 1 SET OF CONTROL NUMBERS TO BE UPDATED AT ONE TIME. 24080000
238700     IF (PS-NO-ERROR                                              24090000
238800     AND PS-NO-DB2-ERROR)                                         24100000
238900         MOVE ASC-CNTL-FROM      TO PV-START-CNTL-NBR             24110000
239000         MOVE ASC-CNTL-TO        TO PV-ENDING-CNTL-NBR            24120000
239100         IF (PV-START-REQ-DTE = PV-ENDING-REQ-DTE                 24130000
239200         AND PV-START-REQ-NBR = PV-ENDING-REQ-NBR)                24140000
239300             CONTINUE                                             24150000
239400         ELSE                                                     24160000
239500             SET PS-ERROR                                         24170000
239600                 DP020-MSG-FATAL                                  24180000
239700                 DP030-SET-CURSOR-APPL-1                          24190000
239800                                 TO TRUE                          24200000
239900*----PC-TSYMSG-01611 - CONTROL NUMBERS CANNOT SPAN MULTIPLE       24210000
240000*----                  REQUESTS.                                  24220000
240100             MOVE PC-TSYMSG-01611                                 24230000
240200                                 TO DP020-MSG-NUMBER              24240000
240300             MOVE DP015-UNP-ALP-BRT-OFF                           24250000
240400                                 TO ADCDTOA                       24260000
240500                                    ADCDFRA                       24270000
240600             MOVE DP015-RED      TO ADCDTOC                       24280000
240700                                    ADCDFRC                       24290000
240800             MOVE DP015-REVERSE  TO ADCDTOH                       24300000
240900                                    ADCDFRH                       24310000
241000             MOVE -1             TO ADCDTOL                       24320000
241100                                    ADCDFRL                       24330000
241200         END-IF                                                   24340000
241300     END-IF.                                                      24350000
241400                                                                  24360000
241500     IF (PS-NO-ERROR                                              24370000
241600     AND PS-NO-DB2-ERROR)                                         24380000
241700        MOVE ASC-CNTL-FROM-9     TO PV-CNTL-NBR                   24390000
241800        PERFORM 7100-CONTROL-NBR                                  24400000
241900        MOVE PV-CNTL-NBR TO ASC-CNTL-FROM                         24410000
242000        PERFORM 4500-SELECT-CARD-TYPE                             24420000
242100                                                                  24430000
242200        IF PS-NO-ERROR AND PS-NO-DB2-ERROR                        24440000
242300           MOVE DK-CRD-PROD-YR   TO DK-CRD-PROD-YR-KEY            24450000
242400           MOVE DK-SHIPT-REQ-NBR TO DK-SHIPT-REQ-NBR-KEY          24460000
242500           MOVE DK-CNTL-NBR      TO DK-CNTL-NBR-KEY               24470000
242600           PERFORM 4670-GET-CARD-NUMBER                           24480000
242700           IF SQLCODE = 0                                         24490000
242800              MOVE 'Y' TO PS-FROM-CARD-NBR-SW                     24500000
242900              IF ASC-CRD-TYP-CDE = SV004-GIFT-CRD-TYP             24510000
243000                PERFORM 3110-PROCESS-GIFT-CARD                    24520000
243100                MOVE 'N' TO PS-FROM-CARD-NBR-SW                   24530000
243200              ELSE                                                24540000
243300                PERFORM 3140-PROCESS-KMRC-CARD                    24550000
243400                MOVE 'N' TO PS-FROM-CARD-NBR-SW                   24560000
243500              END-IF                                              24570000
243600           END-IF                                                 24580000
243700        END-IF                                                    24590000
243800                                                                  24600000
243900        IF PS-NO-ERROR AND PS-NO-DB2-ERROR                        24610000
244000            MOVE ASC-CNTL-FROM-9                                  24620000
244100                                 TO PV-CNTL-NBR-FROM              24630000
244200            PERFORM 7000-CONTROL-NBR-FROM                         24640000
244300            MOVE ASC-CNTL-TO-9                                    24650000
244400                                 TO PV-CNTL-NBR-TO                24660000
244500            PERFORM 7200-CONTROL-NBR-TO                           24670000
244600            PERFORM 4550-VALIDATE-ALL-CARD-TYPES                  24680000
244700            IF SQLCODE = 0 OR SQLCODE = -811                      24690000
244800                MOVE 'MULTIPLE CARD TYPES '                       24700000
244900                                 TO ASC-CRD-TYP-DESC              24710000
245000                                    ACRDTYPO                      24720000
245100                MOVE DP015-UNP-ALP-BRT-OFF                        24730000
245200                                 TO ACRDTYPA                      24740000
245300                MOVE DP015-RED   TO ACRDTYPC                      24750000
245400                MOVE DP015-REVERSE                                24760000
245500                                 TO ACRDTYPH                      24770000
245600                MOVE -1          TO ACRDTYPL                      24780000
245700                SET PS-ERROR                                      24790000
245800                    DP020-MSG-FATAL                               24800000
245900                    DP030-SET-CURSOR-APPL-1                       24810000
246000                                 TO TRUE                          24820000
246100             ELSE                                                 24830000
246200               MOVE DK-CRD-PROD-YR   TO DK-CRD-PROD-YR-KEY        24840000
246300               MOVE DK-SHIPT-REQ-NBR TO DK-SHIPT-REQ-NBR-KEY      24850000
246400               MOVE DK-CNTL-NBR-TO   TO DK-CNTL-NBR-KEY           24860000
246500               PERFORM 4670-GET-CARD-NUMBER                       24870000
246600               IF SQLCODE = 0                                     24880000
246700                  IF ASC-CRD-TYP-CDE = SV004-GIFT-CRD-TYP         24890000
246800                     PERFORM 3110-PROCESS-GIFT-CARD               24900000
246900                  ELSE                                            24910000
247000                     PERFORM 3140-PROCESS-KMRC-CARD               24920000
247100                  END-IF                                          24930000
247200               END-IF                                             24940000
247300               IF PS-NO-ERROR AND PS-NO-DB2-ERROR                 24950000
247400                 IF ASC-CRD-TYP-CDE = SV004-KMRC-CRD-TYP          24960000
247500                     MOVE SV004-KMRC-CRD-DESC                     24970000
247600                                 TO ASC-CRD-TYP-DESC              24980000
247700                 ELSE                                             24990000
247800                     IF ASC-CRD-TYP-CDE = SV004-GIFT-CRD-TYP      25000000
247900                         MOVE SV004-GIFT-CRD-DESC                 25010000
248000                                 TO ASC-CRD-TYP-DESC              25020000
248100                     ELSE                                         25030000
248200                         MOVE SPACES                              25040000
248300                                 TO ASC-CRD-TYP-DESC              25050000
248400                     END-IF                                       25060000
248500                 END-IF                                           25070000
248600                 MOVE ASC-CRD-TYP-DESC                            25080000
248700                                 TO ACRDTYPO                      25090000
248800               END-IF                                             25100000
248900             END-IF                                               25110000
249000         END-IF                                                   25120000
249100     END-IF.                                                      25130000
249200                                                                  25140000
249300*  IF THE CARD IS PRE-DENOMINATED, PUT THE PRE-DENOMINATED AMOUNT 25150000
249400*  IN THE ISSUE AMOUNT FIELD.                                     25160000
249500     IF (PS-NO-ERROR                                              25170000
249600     AND PS-NO-DB2-ERROR)                                         25180000
249700         IF ASC-PRE-DNNTD-CRD-AMT = ZEROS                         25190000
249800             CONTINUE                                             25200000
249900         ELSE                                                     25210000
250000             IF ASC-PRE-DNNTD-CRD-AMT = ASC-ISSUE-AMOUNT-9        25220000
250100                 CONTINUE                                         25230000
250200             ELSE                                                 25240000
250300                 MOVE ASC-PRE-DNNTD-CRD-AMT                       25250000
250400                                 TO AISUAMTO                      25260000
250500                                    ASC-ISSUE-AMOUNT-9            25270000
250600                 MOVE AISUAMTO   TO ASC-ISSUE-AMOUNT              25280000
250700             END-IF                                               25290000
250800         END-IF                                                   25300000
250900     END-IF.                                                      25310000
251000                                                                  25320000
251100*----------------------------------------------------------------*25330000
251200* PROCESS SETUP OF GIFT CARDS                                    *25340000
251300* IF CARD TYPE CODE = 2 IT IS A GIFT CARD. IF THE CARD NUMBER IS *25350000
251400* 12 DIGITS THEN 19 DIGITS ARE EXPECTED TO RETURN TO THE SCREEN. *25360000
251500* IF 10 DIGITS THEN 13 DIGITS ARE TO RETURN TO THE SCREEN.       *25370000
251600*----------------------------------------------------------------*25380000
251700 3110-PROCESS-GIFT-CARD.                                          25390000
251800                                                                  25400000
251900     MOVE ZEROES           TO PV-30-DIGIT-CARD-NBR.               25410000
252000     MOVE SVT00001-CRD-NBR TO PV-19-DIGIT-ACCOUNT-NBR             25420000
252100                              PV-CARD-NBR.                        25430000
252200                                                                  25440000
252300     MOVE 'N' TO PS-CRDSTK-CDE-FOUND-SW                           25450000
252400                                                                  25460000
252500     PERFORM 4560-EXTRACT-CRDSTK-CODE                             25470000
252600                                                                  25480000
252700     IF PS-CRDSTK-CDE-FOUND                                       25490000
252800         MOVE SVT00000-CRD-STK-TYP-ID TO PV-CRD-STK-TYP-ID        25500000
252900                                                                  25510000
253000         IF  PV-CARD-STOCK-SAFEWAY                                25520000
253100            MOVE SV004-SAFEWAY-BIN                                25530000
253200                        TO PV-19-DIGIT-KOHLS-BIN-NBR              25540000
253300         ELSE                                                     25550000
253400            MOVE SV004-KOHLS-IIN                                  25560000
253500                        TO PV-19-DIGIT-KOHLS-BIN-NBR              25570000
253600         END-IF                                                   25580000
253700     ELSE                                                         25590000
253800         MOVE SV004-KOHLS-IIN                                     25600000
253900                        TO PV-19-DIGIT-KOHLS-BIN-NBR              25610000
254000     END-IF                                                       25620000
254100                                                                  25630000
254200     IF PS-NO-ERROR                                               25640000
254300        MOVE SVT00001-CRD-SPCTY-TYP-CDE                           25650000
254400                              TO PV-19-DIGIT-CARD-TYPE            25660000
254500        MOVE SVT00008-UPC-NBR TO PV-30-DIGIT-UPC                  25670000
254600        IF PS-FROM-CARD-NBR-YES                                   25680000
254700           MOVE PV-30-DIGIT-CARD-NBR                              25690000
254800                              TO ASC-NMBR-FROM                    25700000
254900                                                                  25710000
255000        ELSE                                                      25720000
255100           MOVE PV-30-DIGIT-CARD-NBR                              25730000
255200                              TO ASC-NMBR-TO                      25740000
255300        END-IF                                                    25750000
255400     END-IF.                                                      25760000
255500                                                                  25770000
255600*----------------------------------------------------------------*25780000
255700* PROCESS SETUP OF KMRC CARDS                                    *25790000
255800* IF CARD TYPE CODE = 1 IT IS A KMRC CARD. IF THE CARD NUMBER IS *25800000
255900* 10 DIGITS THEN 10 DIGITS ARE EXPECTED TO RETURN TO THE SCREEN. *25810000
256000* IF 12 DIGITS THEN 19 DIGITS ARE TO RETURN TO THE SCREEN.       *25820000
256100*----------------------------------------------------------------*25830000
256200 3140-PROCESS-KMRC-CARD.                                          25840000
256300                                                                  25850000
256400     MOVE ZEROES           TO PV-30-DIGIT-CARD-NBR.               25860000
256500     MOVE SVT00001-CRD-NBR TO PV-19-DIGIT-ACCOUNT-NBR             25870000
256600                              PV-CARD-NBR.                        25880000
256700     IF PV-19-DIGIT-NBR-2 NOT = ZERO                              25890000
256800        MOVE SVT00008-UPC-NBR TO PV-30-DIGIT-UPC                  25900000
256900        MOVE SV004-KOHLS-IIN                                      25910000
257000                        TO PV-19-DIGIT-KOHLS-BIN-NBR              25920000
257100        MOVE SVT00001-CRD-SPCTY-TYP-CDE                           25930000
257200                          TO PV-19-DIGIT-CARD-TYPE                25940000
257300     END-IF.                                                      25950000
257400     IF PS-FROM-CARD-NBR-YES                                      25960000
257500        MOVE PV-30-DIGIT-CARD-NBR                                 25970000
257600                          TO ASC-NMBR-FROM                        25980000
257700     ELSE                                                         25990000
257800        MOVE PV-30-DIGIT-CARD-NBR                                 26000000
257900                          TO ASC-NMBR-TO                          26010000
258000     END-IF.                                                      26020000
258100                                                                  26030000
258200*----------------------------------------------------------------*26040000
258300* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *26050000
258400* MAP.                                                           *26060000
258500*----------------------------------------------------------------*26070000
258600 3200-RESET-ATTRIBUTES.                                           26080000
258700     MOVE DP015-UNP-ALP-NOR-OFF  TO ADCDFRA                       26090000
258800                                    ADCDTOA                       26100000
258900                                    ADNBFRA                       26110000
259000                                    ADNBTOA                       26120000
259100                                    ADSTRA                        26130000
259200                                    ANBRREQA                      26140000
259300                                    AISUSTRA                      26150000
259400                                    ATERMA                        26160000
259500                                    ATRANA                        26170000
259600                                    AISUAMTA.                     26180000
259700     MOVE DP015-GREEN            TO ADCDFRC                       26190000
259800                                    ADCDTOC                       26200000
259900                                    ADNBFRC                       26210000
260000                                    ADNBTOC                       26220000
260100                                    ADSTRC                        26230000
260200                                    ANBRREQC                      26240000
260300                                    AISUSTRC                      26250000
260400                                    ATERMC                        26260000
260500                                    ATRANC                        26270000
260600                                    AISUAMTC.                     26280000
260700     MOVE DP015-UNDERLINE        TO ADCDFRH                       26290000
260800                                    ADCDTOH                       26300000
260900                                    ADNBFRH                       26310000
261000                                    ADNBTOH                       26320000
261100                                    ADSTRH                        26330000
261200                                    ANBRREQH                      26340000
261300                                    AISUSTRH                      26350000
261400                                    ATERMH                        26360000
261500                                    ATRANH                        26370000
261600                                    AISUAMTH.                     26380000
261700     MOVE DP015-ASK-NOR-OFF      TO ADSTRNA                       26390000
261800                                    ASTRDESA.                     26400000
261900     MOVE DP015-BLUE             TO ADSTRNC                       26410000
262000                                    ASTRDESC.                     26420000
262100     MOVE DP015-HL-OFF           TO ADSTRNH                       26430000
262200                                    ASTRDESH.                     26440000
262300*----------------------------------------------------------------*26450000
262400*    CALCULATE AND VALIDATE THE ENDING CONTROL NUMBER.           *26460000
262500*----------------------------------------------------------------*26470000
262600 3300-CALC-ENDING-CNTL.                                           26480000
262700     MOVE ASC-CNTL-FROM          TO PV-START-CNTL-NBR.            26490000
262800     COMPUTE PV-HOLD-SEQ-NBR                                      26500000
262900          = (PV-START-SEQ-NBR                                     26510000
263000          +  ASC-NUMBER-REQUESTED-9                               26520000
263100          -  1).                                                  26530000
263200     IF PV-HOLD-SEQ-NBR > PC-MAXIMUM-SEQ-NBR                      26540000
263300         SET PS-ERROR                                             26550000
263400             DP030-SET-CURSOR-APPL-1                              26560000
263500             DP020-MSG-FATAL TO TRUE                              26570000
263600*----PC-TSYMSG-00005 - INVALID VALUE                              26580000
263700         MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER              26590000
263800         MOVE DP015-UNP-ALP-BRT-OFF                               26600000
263900                                 TO ANBRREQA                      26610000
264000         MOVE DP015-RED          TO ANBRREQC                      26620000
264100         MOVE DP015-REVERSE      TO ANBRREQH                      26630000
264200         MOVE -1                 TO ANBRREQL                      26640000
264300     ELSE                                                         26650000
264400         MOVE PV-START-CNTL-NBR  TO PV-ENDING-CNTL-NBR            26660000
264500         MOVE PV-HOLD-SEQ-NBR    TO PV-ENDING-SEQ-NBR             26670000
264600         MOVE PV-ENDING-CNTL-NBR TO ASC-CNTL-TO-9                 26680000
264700                                    ADCDTOO                       26690000
264800         MOVE ASC-CNTL-TO-9      TO PV-CNTL-NBR                   26700000
264900         PERFORM 7100-CONTROL-NBR                                 26710000
265000         MOVE PV-CNTL-NBR TO ASC-CNTL-TO                          26720000
265100         PERFORM 4100-SELECT-INVALID-CARD-ID                      26730000
265200         IF PS-NO-DB2-ERROR                                       26740000
265300             IF SQLCODE = +100                                    26750000
265400                  SET PS-ERROR                                    26760000
265500                      DP030-SET-CURSOR-APPL-1                     26770000
265600                      DP020-MSG-FATAL                             26780000
265700                                 TO TRUE                          26790000
265800*----PC-TSYMSG-01366 - CONTROL NUMBER NOT FOUND                   26800000
265900                  MOVE PC-TSYMSG-01366                            26810000
266000                                 TO DP020-MSG-NUMBER              26820000
266100                  MOVE DP015-UNP-ALP-BRT-OFF                      26830000
266200                                 TO ADCDTOA                       26840000
266300                  MOVE DP015-RED TO ADCDTOC                       26850000
266400                  MOVE DP015-REVERSE                              26860000
266500                                 TO ADCDTOH                       26870000
266600                  MOVE -1        TO ADCDTOL                       26880000
266700             END-IF                                               26890000
266800             IF SQLCODE = ZERO                                    26900000
266900                 MOVE SVT00001-CRD-NBR TO ASC-NMBR-TO-9           26910000
267000             END-IF                                               26920000
267100         END-IF                                                   26930000
267200     END-IF.                                                      26940000
267300*----------------------------------------------------------------*26950000
267400*    CALCULATE THE NUMBER REQUESTED BASED ON THE STARTING AND    *26960000
267500*    ENDING CNTL NUMBER.                                         *26970000
267600*----------------------------------------------------------------*26980000
267700 3400-CALC-NUMBER-REQUESTED.                                      26990000
267800     MOVE ASC-CNTL-FROM          TO PV-START-CNTL-NBR.            27000000
267900     MOVE ASC-CNTL-TO            TO PV-ENDING-CNTL-NBR.           27010000
268000     COMPUTE PV-HOLD-NBR-REQUESTED =                              27020000
268100            (PV-ENDING-SEQ-NBR                                    27030000
268200           - PV-START-SEQ-NBR                                     27040000
268300           + 1).                                                  27050000
268400     MOVE PV-HOLD-NBR-REQUESTED  TO ASC-NUMBER-REQUESTED-9        27060000
268500                                    ANBRREQO.                     27070000
268600*----------------------------------------------------------------*27080000
268700*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *27090000
268800*    ENTRY.                                                      *27100000
268900*----------------------------------------------------------------*27110000
269000 4000-BUILD-INITIAL-PANEL.                                        27120000
269100     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        27130000
269200     MOVE -1                       TO ADNBFRL.                    27140000
269300     MOVE 'N' TO ASC-REQSTED-STORE.                               27150000
269400*----------------------------------------------------------------*27160000
269500* SELECT CARD ID - DETERMINING VALIDITY OF ENTRY                 *27170000
269600*----------------------------------------------------------------*27180000
269700 4100-SELECT-INVALID-CARD-ID.                                     27190000
269800     EXEC SQL                                                     27200000
269900         SELECT  CRD_NBR                                          27210000
270000           INTO :SVT00001-CRD-NBR                                 27220000
270100           FROM  SVT_KOHLS_CRD_ACCT                               27230000
270200           WHERE CRD_PROD_YR    = :DK-CRD-PROD-YR                 27240000
270300             AND SHIPT_REQ_NBR  = :DK-SHIPT-REQ-NBR               27250000
270400             AND CNTL_NBR       = :DK-CNTL-NBR                    27260000
270500           WITH UR                                                27270000
270600     END-EXEC.                                                    27280000
270700                                                                  27290000
270800     EVALUATE TRUE                                                27300000
270900         WHEN SQLCODE = +100                                      27310000
271000         WHEN SQLCODE = 0                                         27320000
271100         WHEN SQLCODE = -811                                      27330000
271200             CONTINUE                                             27340000
271300         WHEN SQLCODE = -911                                      27350000
271400         WHEN SQLCODE = -913                                      27360000
271500             MOVE '4100-SELECT-INVALID-CARD-ID'                   27370000
271600                                 TO DP013-PARAGRAPH               27380000
271700             MOVE 'SELECT CONTROL NBR - DETERMINE VALIDITY'       27390000
271800                                 TO DP013-MESSAGE-TEXT (1)        27400000
271900             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)27410000
272000             MOVE SQLCA          TO DP013-SQLCA                   27420000
272100             SET DP013-LINK-RETURN                                27430000
272200                 DP013-DB2-ABEND                                  27440000
272300                 DP013-ROLLBACK  TO TRUE                          27450000
272400             PERFORM DP013-0000-PROCESS-ABEND                     27460000
272500             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          27470000
272600*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           27480000
272700*----                  TRANSACTION FOR DATABASE &VAR              27490000
272800             MOVE PC-TSYMSG-00482                                 27500000
272900                                 TO DP020-MSG-NUMBER              27510000
273000             SET PS-DB2-ERROR    TO TRUE                          27520000
273100             SET DP020-MSG-FATAL TO TRUE                          27530000
273200             SET DP020-NEXT-ACT-APPL-ERROR                        27540000
273300                                 TO TRUE                          27550000
273400         WHEN OTHER                                               27560000
273500             MOVE '4100-SELECT-INVALID-CARD-ID'                   27570000
273600                                 TO DP013-PARAGRAPH               27580000
273700             MOVE 'SELECT CARD ID - DETERMINE VALIDITY'           27590000
273800                                 TO DP013-MESSAGE-TEXT (1)        27600000
273900             MOVE SQLCA          TO DP013-SQLCA                   27610000
274000             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)27620000
274100             SET DP013-DB2-ABEND                                  27630000
274200                 DP013-XCTL-DISPLAY-RESTART                       27640000
274300                                   TO TRUE                        27650000
274400             PERFORM DP013-0000-PROCESS-ABEND                     27660000
274500     END-EVALUATE.                                                27670000
274600*----------------------------------------------------------------*27680000
274700* SELECT STORE NAME                                              *27690000
274800*----------------------------------------------------------------*27700000
274900 4200-SELECT-STORE-NAME.                                          27710000
275000     EXEC SQL                                                     27720000
275100         SELECT LOC_NM                                            27730000
275200              , ST_CDE                                            27740000
275300           INTO :XST00001-LOC-NM                                  27750000
275400              , :XST00001-ST-CDE                                  27760000
275500           FROM  XST_LOC                                          27770000
275600           WHERE LOC_NBR = :DK-STORE-NBR AND                      27780000
275700                 LOC_TYP_CDE IN ('HQ', 'DS', 'SV') AND            27790000
275800                 CLO_DTE > CURRENT DATE                           27800000
275900           WITH UR                                                27810000
276000     END-EXEC.                                                    27820000
276100                                                                  27830000
276200     EVALUATE TRUE                                                27840000
276300         WHEN SQLCODE = 0                                         27850000
276400             CONTINUE                                             27860000
276500         WHEN SQLCODE = +100                                      27870000
276600* SPACE OUT A PREVIOUSLY VALID STORE NAME, BASED ON A NEWLY       27880000
276700*   ENTERED INVALID STORE NUMBER                                  27890000
276800             SET PS-ERROR                                         27900000
276900                 DP020-MSG-FATAL                                  27910000
277000                 DP030-SET-CURSOR-APPL-1                          27920000
277100                                     TO TRUE                      27930000
277200*----PC-TSYMSG-00017 - STORE DOES NOT EXIST                       27940000
277300             MOVE PC-TSYMSG-00017    TO DP020-MSG-NUMBER          27950000
277400         WHEN SQLCODE = -911                                      27960000
277500         WHEN SQLCODE = -913                                      27970000
277600             MOVE '4200-SELECT-STORE-NAME'                        27980000
277700                                 TO DP013-PARAGRAPH               27990000
277800             MOVE 'SELECT STORE NAME'                             28000000
277900                                 TO DP013-MESSAGE-TEXT (1)        28010000
278000             MOVE 'XST00001'     TO DP013-DB2-TABLE-NAME (1)      28020000
278100             MOVE SQLCA          TO DP013-SQLCA                   28030000
278200             SET DP013-LINK-RETURN                                28040000
278300                 DP013-DB2-ABEND                                  28050000
278400                 DP013-ROLLBACK  TO TRUE                          28060000
278500             PERFORM DP013-0000-PROCESS-ABEND                     28070000
278600             MOVE 'XST00001'     TO DP020-MSG-TEXT                28080000
278700*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           28090000
278800*----                  TRANSACTION FOR DATABASE &VAR              28100000
278900             MOVE PC-TSYMSG-00482                                 28110000
279000                                 TO DP020-MSG-NUMBER              28120000
279100             SET PS-DB2-ERROR    TO TRUE                          28130000
279200             SET DP020-MSG-FATAL TO TRUE                          28140000
279300             SET DP020-NEXT-ACT-APPL-ERROR                        28150000
279400                                 TO TRUE                          28160000
279500         WHEN OTHER                                               28170000
279600             MOVE '4200-SELECT-STORE-NAME'                        28180000
279700                                 TO DP013-PARAGRAPH               28190000
279800             MOVE 'SELECT STORE NAME'                             28200000
279900                                 TO DP013-MESSAGE-TEXT (1)        28210000
280000             MOVE SQLCA          TO DP013-SQLCA                   28220000
280100             MOVE 'XST00001'     TO DP013-DB2-TABLE-NAME (1)      28230000
280200             SET DP013-DB2-ABEND                                  28240000
280300                 DP013-XCTL-DISPLAY-RESTART                       28250000
280400                                   TO TRUE                        28260000
280500             PERFORM DP013-0000-PROCESS-ABEND                     28270000
280600     END-EVALUATE.                                                28280000
280700*----------------------------------------------------------------*28290000
280800* SELECT CARD ID'S THAT ARE INVALID FOR THE SELECTED CARD ID     *28300000
280900* RANGE/STATUS CODE                                              *28310000
281000*----------------------------------------------------------------*28320000
281100 4300-SELECT-INVALID-CARD-IDS.                                    28330000
281200     EXEC SQL                                                     28340000
281300         SELECT  'Y'                                              28350000
281400           INTO :PV-VALID-CARD-ARRAY                              28360000
281500           FROM  SVT_KOHLS_CRD_ACCT                               28370000
281600          WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM            28380000
281700            AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM          28390000
281800            AND (CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND           28400000
281900                                  :DK-CNTL-NBR-TO)                28410000
282000            AND    CRD_STAT_CDE ^= 'AV'                           28420000
282100          WITH UR                                                 28430000
282200     END-EXEC.                                                    28440000
282300                                                                  28450000
282400     EVALUATE TRUE                                                28460000
282500         WHEN SQLCODE = +100                                      28470000
282600         WHEN SQLCODE = 0                                         28480000
282700         WHEN SQLCODE = -811                                      28490000
282800             CONTINUE                                             28500000
282900         WHEN SQLCODE = -911                                      28510000
283000         WHEN SQLCODE = -913                                      28520000
283100             MOVE '4300-SELECT-INVALID-CARD-IDS'                  28530000
283200                                 TO DP013-PARAGRAPH               28540000
283300             MOVE 'SELECT INVALID CONTROL NBRS IN A RANGE'        28550000
283400                                 TO DP013-MESSAGE-TEXT (1)        28560000
283500             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)28570000
283600             MOVE SQLCA          TO DP013-SQLCA                   28580000
283700             SET DP013-LINK-RETURN                                28590000
283800                 DP013-DB2-ABEND                                  28600000
283900                 DP013-ROLLBACK  TO TRUE                          28610000
284000             PERFORM DP013-0000-PROCESS-ABEND                     28620000
284100             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          28630000
284200*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           28640000
284300*----                  TRANSACTION FOR DATABASE &VAR              28650000
284400             MOVE PC-TSYMSG-00482                                 28660000
284500                                 TO DP020-MSG-NUMBER              28670000
284600             SET PS-DB2-ERROR    TO TRUE                          28680000
284700             SET DP020-MSG-FATAL TO TRUE                          28690000
284800             SET DP020-NEXT-ACT-APPL-ERROR                        28700000
284900                                 TO TRUE                          28710000
285000         WHEN OTHER                                               28720000
285100             MOVE '4300-SELECT-INVALID-CARD-IDS'                  28730000
285200                                 TO DP013-PARAGRAPH               28740000
285300             MOVE 'SELECT INVALID CONTROL NBRS IN RANGE'          28750000
285400                                 TO DP013-MESSAGE-TEXT (1)        28760000
285500             MOVE SQLCA          TO DP013-SQLCA                   28770000
285600             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)28780000
285700             SET DP013-DB2-ABEND                                  28790000
285800                 DP013-XCTL-DISPLAY-RESTART                       28800000
285900                                   TO TRUE                        28810000
286000             PERFORM DP013-0000-PROCESS-ABEND                     28820000
286100     END-EVALUATE.                                                28830000
286200*----------------------------------------------------------------*28840000
286300* SELECT THE MINIMUM CARD ID THAT IS INVALID FOR THE SELECTED    *28850000
286400* CARD ID RANGE/STATUS CODE                                      *28860000
286500*----------------------------------------------------------------*28870000
286600 4350-SELECT-INVALID-CARD-IDS.                                    28880000
286700     EXEC SQL                                                     28890000
286800         SELECT MIN(CNTL_NBR)                                     28900000
286900           INTO :SVT00001-CNTL-NBR                                28910000
287000           FROM  SVT_KOHLS_CRD_ACCT                               28920000
287100          WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM            28930000
287200            AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM          28940000
287300            AND (CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND           28950000
287400                                  :DK-CNTL-NBR-TO)                28960000
287500            AND    CRD_STAT_CDE ^= 'AV'                           28970000
287600          WITH UR                                                 28980000
287700     END-EXEC.                                                    28990000
287800                                                                  29000000
287900     EVALUATE TRUE                                                29010000
288000         WHEN SQLCODE = 0                                         29020000
288100             MOVE DK-CRD-PROD-YR-FROM TO PV-REQ-DTE               29030000
288200             MOVE DK-SHIPT-REQ-NBR-FROM TO PV-REQ-NBR             29040000
288300             MOVE SVT00001-CNTL-NBR TO PV-SEQ-NBR                 29050000
288400             MOVE PV-CNTL-NBR TO DP020-MSG-TEXT                   29060000
288500         WHEN SQLCODE = -911                                      29070000
288600         WHEN SQLCODE = -913                                      29080000
288700             MOVE '4350-SELECT-INVALID-CARD-IDS'                  29090000
288800                                 TO DP013-PARAGRAPH               29100000
288900             MOVE 'SELECT FIRST INVALID CONTROL NBR IN A RANGE'   29110000
289000                                 TO DP013-MESSAGE-TEXT (1)        29120000
289100             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)29130000
289200             MOVE SQLCA          TO DP013-SQLCA                   29140000
289300             SET DP013-LINK-RETURN                                29150000
289400                 DP013-DB2-ABEND                                  29160000
289500                 DP013-ROLLBACK  TO TRUE                          29170000
289600             PERFORM DP013-0000-PROCESS-ABEND                     29180000
289700             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          29190000
289800*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           29200000
289900*----                  TRANSACTION FOR DATABASE &VAR              29210000
290000             MOVE PC-TSYMSG-00482                                 29220000
290100                                 TO DP020-MSG-NUMBER              29230000
290200             SET PS-DB2-ERROR    TO TRUE                          29240000
290300             SET DP020-MSG-FATAL TO TRUE                          29250000
290400             SET DP020-NEXT-ACT-APPL-ERROR                        29260000
290500                                 TO TRUE                          29270000
290600         WHEN OTHER                                               29280000
290700             MOVE '4350-SELECT-INVALID-CARD-IDS'                  29290000
290800                                 TO DP013-PARAGRAPH               29300000
290900             MOVE 'SELECT FIRST INVALID CONTROL NBR IN A RANGE'   29310000
291000                                 TO DP013-MESSAGE-TEXT (1)        29320000
291100             MOVE SQLCA          TO DP013-SQLCA                   29330000
291200             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)29340000
291300             SET DP013-DB2-ABEND                                  29350000
291400                 DP013-XCTL-DISPLAY-RESTART                       29360000
291500                                   TO TRUE                        29370000
291600             PERFORM DP013-0000-PROCESS-ABEND                     29380000
291700     END-EVALUATE.                                                29390000
291800*----------------------------------------------------------------*29400000
291900*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *29410000
292000*----------------------------------------------------------------*29420000
292100 4400-MOVE-COMMAREA-TO-SCREEN.                                    29430000
292200                                                                  29440000
292300     MOVE ASC-CNTL-FROM          TO ADCDFRO.                      29450000
292400     MOVE ASC-CNTL-TO            TO ADCDTOO.                      29460000
292500     MOVE ASC-NMBR-FROM          TO SV007-CARD-NUMBER             29470000
292600     SET SV007-FORMAT-DISPLAY TO TRUE                             29480000
292700     MOVE 0                      TO SV007-CARD-NUMBER-LENGTH      29490000
292800     PERFORM SV007-FORMAT-CARD                                    29500000
292900     IF ASC-NMBR-FROM IS NUMERIC AND SV007-CARD-12-OUT2 = "00"    29510000
293000         MOVE SV007-CARD-ID        TO SV007-CRD-NBR               29520000
293100         MOVE ZEROES               TO SV007-CARD-NUMBER9          29530000
293200         MOVE SV007-CRD-NBR        TO SV007-CARD-13-OUT-10-9      29540000
293300         PERFORM 6400-GET-CHECK-DIGIT                             29550000
293400         MOVE SV007-CARD-13-OUT    TO SV007-CARD-NUMBER-DISPLAY   29560000
293500     END-IF                                                       29570000
293600     MOVE SV007-CARD-NUMBER-DISPLAY TO ADNBFRO                    29580000
293700     MOVE ASC-NMBR-TO            TO SV007-CARD-NUMBER             29590000
293800     SET SV007-FORMAT-DISPLAY TO TRUE                             29600000
293900     MOVE 0                      TO SV007-CARD-NUMBER-LENGTH      29610000
294000     PERFORM SV007-FORMAT-CARD                                    29620000
294100     IF ASC-NMBR-TO IS NUMERIC AND SV007-CARD-12-OUT2 = "00"      29630000
294200         MOVE SV007-CARD-ID        TO SV007-CRD-NBR               29640000
294300         MOVE ZEROES               TO SV007-CARD-NUMBER9          29650000
294400         MOVE SV007-CRD-NBR        TO SV007-CARD-13-OUT-10-9      29660000
294500         PERFORM 6400-GET-CHECK-DIGIT                             29670000
294600         MOVE SV007-CARD-13-OUT    TO SV007-CARD-NUMBER-DISPLAY   29680000
294700     END-IF                                                       29690000
294800     MOVE SV007-CARD-NUMBER-DISPLAY TO ADNBTOO                    29700000
294900     MOVE ASC-REQUESTED-STORE    TO ADSTRO.                       29710000
295000     MOVE ASC-REQUESTED-STORE-NAME                                29720000
295100                                 TO ADSTRNO.                      29730000
295200     MOVE ASC-CRD-TYP-DESC       TO ACRDTYPO.                     29740000
295300     MOVE ASC-NUMBER-REQUESTED   TO ANBRREQO.                     29750000
295400     MOVE ASC-ISSUE-STORE        TO AISUSTRO.                     29760000
295500     MOVE ASC-ISSUE-STORE-NAME   TO ASTRDESO.                     29770000
295600     MOVE ASC-TERMINAL-9         TO ATERMO.                       29780000
295700     MOVE ASC-TRANSACTION-9      TO ATRANO.                       29790000
295800     MOVE ASC-ISSUE-AMOUNT-9     TO AISUAMTO.                     29800000
295900*----------------------------------------------------------------*29810000
296000* SELECT THE CARD TYPE AND DENOMINATION OF THE FIRST CONTROL     *29820000
296100* NUMBER SPECIFIED.                                              *29830000
296200*----------------------------------------------------------------*29840000
296300 4500-SELECT-CARD-TYPE.                                           29850000
296400     EXEC SQL                                                     29860000
296500         SELECT CRD_TYP_CDE,                                      29870000
296600                PRE_DNNTD_CRD_AMT                                 29880000
296700           INTO :PV-CRD-TYP-CDE,                                  29890000
296800                :PV-PRE-DNNTD-CRD-AMT                             29900000
296900           FROM  SVT_CRD_PROD                                     29910000
297000          WHERE  :DK-CRD-PROD-YR   = CRD_PROD_YR                  29920000
297100            AND  :DK-SHIPT-REQ-NBR = SHIPT_REQ_NBR                29930000
297200          WITH UR                                                 29940000
297300     END-EXEC.                                                    29950000
297400                                                                  29960000
297500     EVALUATE TRUE                                                29970000
297600         WHEN SQLCODE = 0                                         29980000
297700             MOVE PV-CRD-TYP-CDE TO ASC-CRD-TYP-CDE               29990000
297800             MOVE PV-PRE-DNNTD-CRD-AMT                            30000000
297900                                 TO ASC-PRE-DNNTD-CRD-AMT         30010000
298000         WHEN SQLCODE = -911                                      30020000
298100         WHEN SQLCODE = -913                                      30030000
298200             MOVE '4500-SELECT-CARD-TYPE'                         30040000
298300                                 TO DP013-PARAGRAPH               30050000
298400             MOVE 'SELECT CARD TYPE OF THE FIRST CONTROL NBR  '   30060000
298500                                 TO DP013-MESSAGE-TEXT (1)        30070000
298600             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)30080000
298700             MOVE SQLCA          TO DP013-SQLCA                   30090000
298800             SET DP013-LINK-RETURN                                30100000
298900                 DP013-DB2-ABEND                                  30110000
299000                 DP013-ROLLBACK  TO TRUE                          30120000
299100             PERFORM DP013-0000-PROCESS-ABEND                     30130000
299200             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          30140000
299300*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           30150000
299400*----                  TRANSACTION FOR DATABASE &VAR              30160000
299500             MOVE PC-TSYMSG-00482                                 30170000
299600                                 TO DP020-MSG-NUMBER              30180000
299700             SET PS-DB2-ERROR    TO TRUE                          30190000
299800             SET DP020-MSG-FATAL TO TRUE                          30200000
299900             SET DP020-NEXT-ACT-APPL-ERROR                        30210000
300000                                 TO TRUE                          30220000
300100         WHEN OTHER                                               30230000
300200             MOVE '4500-SELECT-CARD-TYPE'                         30240000
300300                                 TO DP013-PARAGRAPH               30250000
300400             MOVE 'SELECT CARD TYPE OF THE FIRST CONTROL NBR  '   30260000
300500                                 TO DP013-MESSAGE-TEXT (1)        30270000
300600             MOVE SQLCA          TO DP013-SQLCA                   30280000
300700             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)30290000
300800             SET DP013-DB2-ABEND                                  30300000
300900                 DP013-XCTL-DISPLAY-RESTART                       30310000
301000                                   TO TRUE                        30320000
301100             PERFORM DP013-0000-PROCESS-ABEND                     30330000
301200     END-EVALUATE.                                                30340000
301300*----------------------------------------------------------------*30350000
301400* VALIDATE THAT ALL THE CONTROL NUMBERS SPECIFIED HAVE THE SAME  *30360000
301500* CARD TYPE.                                                     *30370000
301600*----------------------------------------------------------------*30380000
301700 4550-VALIDATE-ALL-CARD-TYPES.                                    30390000
301800     EXEC SQL                                                     30400000
301900         SELECT  'Y'                                              30410000
302000           INTO :PV-VALID-CARD-ARRAY                              30420000
302100           FROM  SVT_KOHLS_CRD_ACCT T                             30430000
302200          WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM            30440000
302300            AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM          30450000
302400            AND  ((CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND         30460000
302500                                    :DK-CNTL-NBR-TO)              30470000
302600             AND   CRD_TYP_CDE ^= :PV-CRD-TYP-CDE)                30480000
302700          WITH UR                                                 30490000
302800     END-EXEC.                                                    30500000
302900                                                                  30510000
303000     EVALUATE TRUE                                                30520000
303100         WHEN SQLCODE = +100                                      30530000
303200         WHEN SQLCODE = 0                                         30540000
303300         WHEN SQLCODE = -811                                      30550000
303400             CONTINUE                                             30560000
303500         WHEN SQLCODE = -911                                      30570000
303600         WHEN SQLCODE = -913                                      30580000
303700             MOVE '4550-VALIDATE-ALL-CARD-TYPES'                  30590000
303800                                 TO DP013-PARAGRAPH               30600000
303900             MOVE 'DO THE CNTL NBRS HAVE THE SAME CRD TYPE'       30610000
304000                                 TO DP013-MESSAGE-TEXT (1)        30620000
304100             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)30630000
304200             MOVE SQLCA          TO DP013-SQLCA                   30640000
304300             SET DP013-LINK-RETURN                                30650000
304400                 DP013-DB2-ABEND                                  30660000
304500                 DP013-ROLLBACK  TO TRUE                          30670000
304600             PERFORM DP013-0000-PROCESS-ABEND                     30680000
304700             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          30690000
304800*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           30700000
304900*----                  TRANSACTION FOR DATABASE &VAR              30710000
305000             MOVE PC-TSYMSG-00482                                 30720000
305100                                 TO DP020-MSG-NUMBER              30730000
305200             SET PS-DB2-ERROR    TO TRUE                          30740000
305300             SET DP020-MSG-FATAL TO TRUE                          30750000
305400             SET DP020-NEXT-ACT-APPL-ERROR                        30760000
305500                                 TO TRUE                          30770000
305600         WHEN OTHER                                               30780000
305700             MOVE '4550-VALIDATE-ALL-CARD-TYPES'                  30790000
305800                                 TO DP013-PARAGRAPH               30800000
305900             MOVE 'DO THE CNTL NBRS HAVE THE SAME CRD TYPE'       30810000
306000                                 TO DP013-MESSAGE-TEXT (1)        30820000
306100             MOVE SQLCA          TO DP013-SQLCA                   30830000
306200             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)30840000
306300             SET DP013-DB2-ABEND                                  30850000
306400                 DP013-XCTL-DISPLAY-RESTART                       30860000
306500                                   TO TRUE                        30870000
306600             PERFORM DP013-0000-PROCESS-ABEND                     30880000
306700     END-EVALUATE.                                                30890000
306800                                                                  30900000
306900*----------------------------------------------------------------*30910000
307000*  EXTRACT PRODUCER CODE                                          30920000
307100*----------------------------------------------------------------*30930000
307200 4560-EXTRACT-CRDSTK-CODE.                                        30940000
307300                                                                  30950000
307400     EXEC SQL                                                     30960000
307500          SELECT A.CRD_STK_TYP_ID                                 30970000
307600                ,C.UPC_NBR                                        30980000
307700            INTO :SVT00000-CRD-STK-TYP-ID                         30990000
307800                ,:SVT00008-UPC-NBR                                31000000
307900            FROM SVT_CRD_PROD A,                                  31010000
308000                 SVT_KOHLS_CRD_ACCT B,                            31020000
308100                 SVT_CRD_STK_DNMNTN C                             31030000
308200           WHERE B.CRD_NBR = :PV-CARD-NBR                         31040000
308300             AND A.CRD_PROD_YR   = B.CRD_PROD_YR                  31050000
308400             AND A.SHIPT_REQ_NBR = B.SHIPT_REQ_NBR                31060000
308500             AND B.CRD_TYP_CDE   = C.CRD_TYP_CDE                  31070000
308600             AND A.CRD_STK_TYP_ID = C.CRD_STK_TYP_ID              31080000
308700             AND A.PRE_DNNTD_CRD_AMT = C.PRE_DNNTD_CRD_AMT        31090000
308800           WITH UR                                                31100000
308900     END-EXEC.                                                    31110000
309000                                                                  31120000
309100     EVALUATE TRUE                                                31130000
309200       WHEN SQLCODE = ZERO                                        31140000
309300           MOVE 'Y' TO PS-CRDSTK-CDE-FOUND-SW                     31150000
309400       WHEN SQLCODE = +100                                        31160000
309500           SET PS-ERROR                                           31170000
309600               DP020-MSG-FATAL                                    31180000
309700               DP030-SET-CURSOR-APPL-1 TO TRUE                    31190000
309800           MOVE PC-TSYMSG-01210 TO DP020-MSG-NUMBER               31200000
309900           MOVE DP015-UNP-ALP-BRT-OFF TO ADNBFRA                  31210000
310000           MOVE DP015-RED             TO ADNBFRC                  31220000
310100           MOVE DP015-REVERSE         TO ADNBFRH                  31230000
310200           MOVE -1                    TO ADNBFRL                  31240000
310300       WHEN OTHER                                                 31250000
310400          MOVE '4560-EXTRACT-CRDSTK-CODE'                         31260000
310500                                   TO DP013-PARAGRAPH             31270000
310600          MOVE 'INVALID ACCT NUMBER'                              31280000
310700                                   TO DP013-MESSAGE-TEXT (1)      31290000
310800          MOVE SQLCA               TO DP013-SQLCA                 31300000
310900          MOVE 'SVT_CRD_PROD'       TO DP013-DB2-TABLE-NAME (1)   31310000
311000          MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (2)   31320000
311100          MOVE 'SVT_CRD_STC_DNMNTN' TO DP013-DB2-TABLE-NAME (3)   31330000
311200          SET DP013-DB2-ABEND      TO TRUE                        31340000
311300          PERFORM DP013-0000-PROCESS-ABEND                        31350000
311400     END-EVALUATE.                                                31360000
311500*----------------------------------------------------------------*31370000
311600* WHEN F2 CONFIRM IS PRESSED, THIS WILL BE PERFORMED TO ADD AN   *31380000
311700* ISSUANCE ACTIVITY TRANSACTION TO EACH CARD NUMBER ASSOCIATED   *31390000
311800* WITH THE CONTROL NUMBER RANGE SPECIFIED.                       *31400000
311900*----------------------------------------------------------------*31410000
312000 4600-CARD-ISSUANCE.                                              31420000
312100     PERFORM 5000-SET-CURRENT-DATE.                               31430000
312200     MOVE ASC-CNTL-FROM-9        TO PV-CNTL-NBR-FROM.             31440000
312300     PERFORM 7000-CONTROL-NBR-FROM                                31450000
312400     MOVE ASC-CNTL-TO-9          TO PV-CNTL-NBR-TO.               31460000
312500     PERFORM 7200-CONTROL-NBR-TO.                                 31470000
312600     SET PS-NOT-END-OF-CARD-CSR  TO TRUE.                         31480000
312700     PERFORM 4650-OPEN-CARD-CSR.                                  31490000
312800     PERFORM 4640-FETCH-NEXT-CARD.                                31500000
312900     PERFORM 4630-INSERT-ISSUE-ACTIVITY                           31510000
313000         UNTIL PS-END-OF-CARD-CSR.                                31520000
313100     PERFORM 4660-CLOSE-CARD-CSR.                                 31530000
313200*----------------------------------------------------------------*31540000
313300* RUN EACH CARD THRU THE AUTHORIZATION MODULE TO ENSURE THE CARD *31550000
313400* IS VALID TO BE ISSUED.                                         *31560000
313500*----------------------------------------------------------------*31570000
313600 4610-AUTHORIZE-CARDS.                                            31580000
313700     MOVE SVT00001-CRD-NBR         TO SV005-KMC-ID.               31590000
313800     MOVE ASC-CRD-TYP-CDE          TO SV005-CARD-TYPE.            31600000
313900     IF ASC-CRD-TYP-CDE = SV004-GIFT-CRD-TYP                      31610000
314000         MOVE SV004-ISSUE-GIFT-CRD-ACT-TYP                        31620000
314100                                   TO SV005-ACTIVITY-TYPE         31630000
314200     ELSE                                                         31640000
314300         MOVE SV004-ISSUE-KMRC-ACT-TYP                            31650000
314400                                   TO SV005-ACTIVITY-TYPE         31660000
314500     END-IF.                                                      31670000
314600     MOVE ZERO                     TO SV005-REVERSAL-CODE.        31680000
314700     MOVE PV-DATE                  TO SV005-POS-DATE.             31690000
314800     MOVE ASC-ISSUE-STORE-9        TO SV005-STORE-NBR.            31700000
314900     MOVE ASC-TERMINAL             TO SV005-TERMINAL-NBR.         31710000
315000     MOVE ASC-TRANSACTION          TO SV005-TRANSACTION-NBR.      31720000
315100     MOVE ASC-ISSUE-AMOUNT-9       TO SV005-TRANS-AMT.            31730000
315200     SET SV005-PV-FROM-RDKCS023-AUDIT TO TRUE.                    31740000
315300     SET SV005-NOT-VOID    TO TRUE.                               31750000
315400     PERFORM SV005-A100-MAINLINE.                                 31760000
315500     IF SV005-APPROVE                                             31770000
315600*        MOVE SV005-APPROVED-TENDER-AMT                           31780000
315700         PERFORM 4640-FETCH-NEXT-CARD                             31790000
315800     ELSE                                                         31800000
315900         SET PS-CONTROL-NBR-ERROR                                 31810000
316000             PS-ERROR                                             31820000
316100             DP020-MSG-FATAL                                      31830000
316200             DP030-SET-CURSOR-APPL-1                              31840000
316300                                 TO TRUE                          31850000
316400             IF SV006-PS-NO-LCK-ERROR                             31860000
316500*----PC-TSYMSG-01613 - CONTROL NUMBER &VAR WAS DECLINED           31870000
316600                MOVE SVT00001-CRD-PROD-YR TO PV-REQ-DTE           31880000
316700                MOVE SVT00001-SHIPT-REQ-NBR TO PV-REQ-NBR         31890000
316800                MOVE SVT00001-CNTL-NBR TO PV-SEQ-NBR              31900000
316900                MOVE PV-CNTL-NBR                                  31910000
317000                                 TO DP020-MSG-TEXT                31920000
317100                MOVE PC-TSYMSG-01613                              31930000
317200                                 TO DP020-MSG-NUMBER              31940000
317300                PERFORM 5400-DELETE-SVT-CRD-ACCT-LCK              31950000
317400             ELSE                                                 31960000
317500*----PC-TSYMSG-02530 - CARD NUMBER &VAR IN LOCK TABLE             31970000
317600                MOVE SVT00001-CRD-NBR                             31980000
317700                                 TO DP020-MSG-TEXT                31990000
317800                MOVE PC-TSYMSG-02530                              32000000
317900                                 TO DP020-MSG-NUMBER              32010000
318000             END-IF                                               32020000
318100             MOVE DP015-UNP-ALP-BRT-OFF                           32030000
318200                                 TO ADCDTOA                       32040000
318300                                    ADCDFRA                       32050000
318400             MOVE DP015-RED      TO ADCDTOC                       32060000
318500                                    ADCDFRC                       32070000
318600             MOVE DP015-REVERSE  TO ADCDTOH                       32080000
318700                                    ADCDFRH                       32090000
318800             MOVE -1             TO ADCDTOL                       32100000
318900                                    ADCDFRL                       32110000
319000     END-IF.                                                      32120000
319100*----------------------------------------------------------------*32130000
319200* INSERTS THE CARD ISSUANCE ACTIVITY INTO THE SVT_KOHLS_CRD_TXN  *32140000
319300* TABLE FOR THOSE CARDS ASSOCIATED WITH THE CONTROL NUMBERS      *32150000
319400* SPECIFIED.                                                     *32160000
319500*----------------------------------------------------------------*32170000
319600 4630-INSERT-ISSUE-ACTIVITY.                                      32180000
319700     MOVE SVT00001-CRD-NBR         TO SVT00002-CRD-NBR.           32190000
319800     MOVE ASC-ST-CDE               TO SVT00002-ST-CDE             32200000
319900     IF ASC-CRD-TYP-CDE = SV004-GIFT-CRD-TYP                      32210000
320000         MOVE SV004-ISSUE-GIFT-CRD-ACT-TYP                        32220000
320100                                   TO SVT00002-ACTVY-TYP-CDE      32230000
320200         MOVE SPACES               TO SVT00002-DRV-LIC-NBR        32240000
320300     ELSE                                                         32250000
320400         MOVE SV004-ISSUE-KMRC-ACT-TYP                            32260000
320500                                   TO SVT00002-ACTVY-TYP-CDE      32270000
320600         MOVE '98100000'           TO SVT00002-DRV-LIC-NBR        32280000
320700     END-IF.                                                      32290000
320800     MOVE SV004-REV-CDE-NORMAL     TO SVT00002-TRN-RVRSL-CDE.     32300000
320900     MOVE SV004-NOT-VOID-TRANS     TO SVT00002-TRN-VOID-IND.      32310000
321000     MOVE PV-DATE                  TO SVT00002-POS-DTE.           32320000
321100     MOVE ASC-ISSUE-STORE-9        TO SVT00002-STR-NBR.           32330000
321200     MOVE ASC-TERMINAL             TO SVT00002-POS-TRMNL-NBR.     32340000
321300     MOVE ASC-TRANSACTION          TO SVT00002-POS-TRN-NBR.       32350000
321400     MOVE ASC-ISSUE-AMOUNT-9       TO SVT00002-APP-AUTH-AMT       32360000
321500                                      SVT00002-ORIG-AUTH-AMT.     32370000
321700     MOVE ZERO                     TO SVT00002-POS-OPRT-ID.       32380000
321800     MOVE DP020-USERID            TO SVT00002-APVL-USR-ID.        32390000
321900*    MOVE SV004-ISSUE-MNEMONIC     TO SVT00002-APVL-USR-ID.       32400000
322000     MOVE SV004-STAT-VERIFIED-CD                                  32410006
322100                                   TO SVT00002-ACTVY-STAT-CDE.    32420000
322200     IF ASC-REQUESTED-STORE > SPACES                              32430000
322300        IF SVT00001-CRD-DISTRB-DTE = '9999-09-09'                 32440000
322400           MOVE PV-DATE       TO SVT00001-CRD-DISTRB-DTE          32450000
322500           MOVE PV-TIME       TO SVT00001-CRD-DISTRB-TM           32460000
322600           MOVE DP020-USERID  TO SVT00001-DISTRB-USR-ID           32470000
322700        END-IF                                                    32480000
322800        MOVE ASC-REQUESTED-STORE-9    TO SVT00001-STR-NBR         32490000
322900        EXEC SQL                                                  32500000
323000             UPDATE SVT_KOHLS_CRD_ACCT                            32510000
323100                SET   STR_NBR        = :SVT00001-STR-NBR          32520000
323200                     ,CRD_DISTRB_DTE = :SVT00001-CRD-DISTRB-DTE   32530000
323300                     ,CRD_DISTRB_TM  = :SVT00001-CRD-DISTRB-TM    32540000
323400                     ,DISTRB_USR_ID                               32550000
323500                                     = :SVT00001-DISTRB-USR-ID    32560000
323600                WHERE CRD_NBR        = :SVT00001-CRD-NBR          32570000
323700        END-EXEC                                                  32580000
323800                                                                  32590000
323900        EVALUATE TRUE                                             32600000
324000            WHEN SQLCODE = ZERO                                   32610000
324100                 CONTINUE                                         32620000
324200*           TIMEOUT  -911, -913                                   32630000
324300            WHEN SQLCODE = -911                                   32640000
324400            WHEN SQLCODE = -913                                   32650000
324500                 PERFORM 5400-DELETE-SVT-CRD-ACCT-LCK             32660000
324600                 MOVE '4630-INSERT-ISSUE-ACTIVITY'                32670000
324700                                     TO DP013-PARAGRAPH           32680000
324800                 MOVE 'UPDATE THE STORED VALUE CARD TABLE'        32690000
324900                                     TO DP013-MESSAGE-TEXT (1)    32700000
325000                 MOVE 'SVT_KOHLS_CRD_ACCT'                        32710000
325100                                     TO DP013-DB2-TABLE-NAME (1)  32720000
325200                 MOVE SQLCA          TO DP013-SQLCA               32730000
325300                 SET DP013-LINK-RETURN                            32740000
325400                     DP013-DB2-ABEND                              32750000
325500                     DP013-ROLLBACK  TO TRUE                      32760000
325600                 PERFORM DP013-0000-PROCESS-ABEND                 32770000
325700                 MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT      32780000
325800*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           32790000
325900*----                  TRANSACTION FOR DATABASE &VAR              32800000
326000                 MOVE PC-TSYMSG-00482                             32810000
326100                                     TO DP020-MSG-NUMBER          32820000
326200                 SET PS-DB2-ERROR    TO TRUE                      32830000
326300                 SET DP020-MSG-WARNING                            32840000
326400                                     TO TRUE                      32850000
326500     END-IF.                                                      32860000
326600     EXEC SQL                                                     32870000
326700         INSERT INTO SVT_KOHLS_CRD_TXN                            32880000
326800            (CRD_NBR,                                             32890000
326900             DRV_LIC_NBR,                                         32900000
327000             TRN_RVRSL_CDE,                                       32910000
327100             TRN_VOID_IND,                                        32920000
327200             ACTVY_TYP_CDE,                                       32930000
327300             POS_DTE,                                             32940000
327400             STR_NBR,                                             32950000
327500             POS_TRMNL_NBR,                                       32960000
327600             POS_TRN_NBR,                                         32970000
327700             TRN_PSTD_TMST,                                       32980000
327800             APP_AUTH_AMT,                                        32990000
327900             POS_OPRT_ID,                                         33000000
328000             APVL_USR_ID,                                         33010000
328100             ACTVY_STAT_CDE,                                      33020000
328200             ORIG_AUTH_AMT,                                       33030000
328300             ST_CDE)                                              33040000
328400     VALUES                                                       33050000
328500           (:SVT00002-CRD-NBR,                                    33060000
328600            :SVT00002-DRV-LIC-NBR,                                33070000
328700            :SVT00002-TRN-RVRSL-CDE,                              33080000
328800            :SVT00002-TRN-VOID-IND,                               33090000
328900            :SVT00002-ACTVY-TYP-CDE,                              33100000
329000            :SVT00002-POS-DTE,                                    33110000
329100            :SVT00002-STR-NBR,                                    33120000
329200            :SVT00002-POS-TRMNL-NBR,                              33130000
329300            :SVT00002-POS-TRN-NBR,                                33140000
329400             CURRENT TIMESTAMP,                                   33150006
329500            :SVT00002-APP-AUTH-AMT,                               33160000
329600            :SVT00002-POS-OPRT-ID,                                33170000
329700            :SVT00002-APVL-USR-ID,                                33180000
329800            :SVT00002-ACTVY-STAT-CDE,                             33190000
329900            :SVT00002-ORIG-AUTH-AMT,                              33200000
330000            :SVT00002-ST-CDE)                                     33210000
330100     END-EXEC.                                                    33220000
330200                                                                  33230000
330300     EVALUATE TRUE                                                33240000
330400         WHEN SQLCODE = ZERO                                      33250000
330500             PERFORM 5400-DELETE-SVT-CRD-ACCT-LCK                 33260000
330600             PERFORM 4640-FETCH-NEXT-CARD                         33270000
330700         WHEN OTHER                                               33280000
330800             PERFORM 5400-DELETE-SVT-CRD-ACCT-LCK                 33290000
330900             MOVE '4630-INSERT-ISSUE-ACTIVITY'                    33300000
331000                                        TO DP013-PARAGRAPH        33310000
331100             MOVE 'INSERT ISSUANCES - ' TO DP013-MESSAGE-TEXT (1) 33320000
331200             MOVE SQLCA                 TO DP013-SQLCA            33330000
331300             MOVE 'SVT_KOHLS_CRD_TXN'   TO                        33340000
331400                                        DP013-DB2-TABLE-NAME (1)  33350000
331500             SET DP013-DB2-ABEND                                  33360000
331600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               33370000
331700             PERFORM DP013-0000-PROCESS-ABEND                     33380000
331800     END-EVALUATE.                                                33390000
331900                                                                  33400000
332000*----------------------------------------------------------------*33410000
332100* READS EACH CARD NUMBER WITHIN THE CONTROL NUMBER RANGE.        *33420000
332200*----------------------------------------------------------------*33430000
332300 4640-FETCH-NEXT-CARD.                                            33440000
332400     EXEC SQL                                                     33450000
332500         FETCH CARD-CSR                                           33460000
332600          INTO :SVT00001-CRD-PROD-YR                              33470000
332700              ,:SVT00001-SHIPT-REQ-NBR                            33480000
332800              ,:SVT00001-CNTL-NBR                                 33490000
332900              ,:SVT00001-CRD-NBR                                  33500000
333000              ,:SVT00001-CRD-DISTRB-DTE                           33510000
333100              ,:SVT00001-CRD-DISTRB-TM                            33520000
333200              ,:SVT00001-DISTRB-USR-ID                            33530000
333300     END-EXEC.                                                    33540000
333400     EVALUATE TRUE                                                33550000
333500         WHEN SQLCODE = ZERO                                      33560000
333600             CONTINUE                                             33570000
333700         WHEN SQLCODE = +100                                      33580000
333800             SET PS-END-OF-CARD-CSR     TO TRUE                   33590000
333900         WHEN OTHER                                               33600000
334000             MOVE '4640-FETCH-NEXT-CARD'                          33610000
334100                                        TO DP013-PARAGRAPH        33620000
334200             MOVE 'FETCH CARD CURSOR -' TO DP013-MESSAGE-TEXT (1) 33630000
334300             MOVE SQLCA                 TO DP013-SQLCA            33640000
334400             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        33650000
334500                                        DP013-DB2-TABLE-NAME (1)  33660000
334600             SET DP013-DB2-ABEND        TO TRUE                   33670000
334700*                DP013-XCTL-DISPLAY-RESTART TO TRUE               33680000
334800             PERFORM DP013-0000-PROCESS-ABEND                     33690000
334900     END-EVALUATE.                                                33700000
335000*----------------------------------------------------------------*33710000
335100* OPEN THE CARD CURSOR USED TO RETRIEVE EACH CARD NUMBER WITHIN  *33720000
335200* THE CONTROL NUMBER RANGE SPECIFIED.                            *33730000
335300*----------------------------------------------------------------*33740000
335400 4650-OPEN-CARD-CSR.                                              33750000
335500     EXEC SQL                                                     33760000
335600         OPEN CARD-CSR                                            33770000
335700     END-EXEC.                                                    33780000
335800     EVALUATE TRUE                                                33790000
335900         WHEN SQLCODE = ZERO                                      33800000
336000             CONTINUE                                             33810000
336100         WHEN OTHER                                               33820000
336200             MOVE '4650-OPEN-CARD-CSR'  TO DP013-PARAGRAPH        33830000
336300             MOVE 'OPEN CARD CURSOR - ' TO DP013-MESSAGE-TEXT (1) 33840000
336400             MOVE SQLCA                 TO DP013-SQLCA            33850000
336500             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        33860000
336600                                        DP013-DB2-TABLE-NAME (1)  33870000
336700             SET DP013-DB2-ABEND                                  33880000
336800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               33890000
336900             PERFORM DP013-0000-PROCESS-ABEND                     33900000
337000     END-EVALUATE.                                                33910000
337100*----------------------------------------------------------------*33920000
337200* CLOSE THE CARD CURSOR.                                         *33930000
337300*----------------------------------------------------------------*33940000
337400 4660-CLOSE-CARD-CSR.                                             33950000
337500     EXEC SQL                                                     33960000
337600         CLOSE CARD-CSR                                           33970000
337700     END-EXEC.                                                    33980000
337800     EVALUATE TRUE                                                33990000
337900         WHEN SQLCODE = ZERO                                      34000000
338000             CONTINUE                                             34010000
338100         WHEN OTHER                                               34020000
338200             MOVE '4660-CLOSE-CARD-CSR' TO DP013-PARAGRAPH        34030000
338300             MOVE 'CLOSE CARD CURSOR -' TO DP013-MESSAGE-TEXT (1) 34040000
338400             MOVE SQLCA                 TO DP013-SQLCA            34050000
338500             MOVE 'SVT_KOHLS_CRD_ACCT'  TO                        34060000
338600                                        DP013-DB2-TABLE-NAME (1)  34070000
338700             SET DP013-DB2-ABEND                                  34080000
338800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               34090000
338900             PERFORM DP013-0000-PROCESS-ABEND                     34100000
339000     END-EVALUATE.                                                34110000
339100*----------------------------------------------------------------*34120000
339200* SELECT THE CARD NUMBER ASSOCIATED WITH A CONTROL NUMBER TO     *34130000
339300* PASS TO THE MAINTENANCE PROGRAM.                               *34140000
339400*----------------------------------------------------------------*34150000
339500 4670-GET-CARD-NUMBER.                                            34160000
339600     EXEC SQL                                                     34170000
339700         SELECT CRD_NBR                                           34180000
339800               ,CRD_SPCTY_TYP_CDE                                 34190000
339900           INTO :SVT00001-CRD-NBR                                 34200000
340000               ,:SVT00001-CRD-SPCTY-TYP-CDE                       34210000
340100           FROM  SVT_KOHLS_CRD_ACCT                               34220000
340200          WHERE CRD_PROD_YR    = :DK-CRD-PROD-YR-KEY              34230000
340300            AND SHIPT_REQ_NBR  = :DK-SHIPT-REQ-NBR-KEY            34240000
340400            AND CNTL_NBR       = :DK-CNTL-NBR-KEY                 34250000
340500          WITH UR                                                 34260000
340600     END-EXEC.                                                    34270000
340700                                                                  34280000
340800     EVALUATE TRUE                                                34290000
340900         WHEN SQLCODE = 0                                         34300000
341000         WHEN SQLCODE = +100                                      34310000
341100             CONTINUE                                             34320000
341200         WHEN SQLCODE = -911                                      34330000
341300         WHEN SQLCODE = -913                                      34340000
341400             MOVE '4670-GET-CARD-NUMBER'                          34350000
341500                                 TO DP013-PARAGRAPH               34360000
341600             MOVE 'SELECT CARD NUMBER BASED ON CONTROL NUMBER'    34370000
341700                                 TO DP013-MESSAGE-TEXT (1)        34380000
341800             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)34390000
341900             MOVE SQLCA          TO DP013-SQLCA                   34400000
342000             SET DP013-LINK-RETURN                                34410000
342100                 DP013-DB2-ABEND                                  34420000
342200                 DP013-ROLLBACK  TO TRUE                          34430000
342300             PERFORM DP013-0000-PROCESS-ABEND                     34440000
342400             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          34450000
342500*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           34460000
342600*----                  TRANSACTION FOR DATABASE &VAR              34470000
342700             MOVE PC-TSYMSG-00482                                 34480000
342800                                 TO DP020-MSG-NUMBER              34490000
342900             SET PS-DB2-ERROR    TO TRUE                          34500000
343000             SET DP020-MSG-FATAL TO TRUE                          34510000
343100             SET DP020-NEXT-ACT-APPL-ERROR                        34520000
343200                                 TO TRUE                          34530000
343300         WHEN OTHER                                               34540000
343400             MOVE '4670-GET-CARD-NUMBER'                          34550000
343500                                 TO DP013-PARAGRAPH               34560000
343600             MOVE 'SELECT CARD NUMBER BASED ON CONTROL NUMBER'    34570000
343700                                 TO DP013-MESSAGE-TEXT (1)        34580000
343800             MOVE SQLCA          TO DP013-SQLCA                   34590000
343900             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)34600000
344000             SET DP013-DB2-ABEND                                  34610000
344100                 DP013-XCTL-DISPLAY-RESTART                       34620000
344200                                   TO TRUE                        34630000
344300             PERFORM DP013-0000-PROCESS-ABEND                     34640000
344400     END-EVALUATE.                                                34650000
344500*----------------------------------------------------------------*34660000
344600* SELECT THE CONTROL NUMBER ASSOCIATED WITH A CARD NUMBER.       *34670000
344700*----------------------------------------------------------------*34680000
344800 4680-GET-CONTROL-NUMBER.                                         34690000
344900     EXEC SQL                                                     34700000
345000         SELECT  CRD_PROD_YR                                      34710000
345100               , SHIPT_REQ_NBR                                    34720000
345200               , CNTL_NBR                                         34730000
345300           INTO :SVT00001-CRD-PROD-YR                             34740000
345400               ,:SVT00001-SHIPT-REQ-NBR                           34750000
345500               ,:SVT00001-CNTL-NBR                                34760000
345600          FROM   SVT_KOHLS_CRD_ACCT                               34770000
345700          WHERE (CRD_NBR = :DK-CARD-NBR)                          34780000
345800          WITH UR                                                 34790000
345900     END-EXEC.                                                    34800000
346000                                                                  34810000
346100     EVALUATE TRUE                                                34820000
346200         WHEN SQLCODE = 0                                         34830000
346300             CONTINUE                                             34840000
346400         WHEN SQLCODE = +100                                      34850000
346500             CONTINUE                                             34860000
346600         WHEN SQLCODE = -911                                      34870000
346700         WHEN SQLCODE = -913                                      34880000
346800             MOVE '4680-GET-CONTROL-NUMBER'                       34890000
346900                                 TO DP013-PARAGRAPH               34900000
347000             MOVE 'SELECT CONTROL NUMBER BASED ON CARD NUMBER'    34910000
347100                                 TO DP013-MESSAGE-TEXT (1)        34920000
347200             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)34930000
347300             MOVE SQLCA          TO DP013-SQLCA                   34940000
347400             SET DP013-LINK-RETURN                                34950000
347500                 DP013-DB2-ABEND                                  34960000
347600                 DP013-ROLLBACK  TO TRUE                          34970000
347700             PERFORM DP013-0000-PROCESS-ABEND                     34980000
347800             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          34990000
347900*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           35000000
348000*----                  TRANSACTION FOR DATABASE &VAR              35010000
348100             MOVE PC-TSYMSG-00482                                 35020000
348200                                 TO DP020-MSG-NUMBER              35030000
348300             SET PS-DB2-ERROR    TO TRUE                          35040000
348400             SET DP020-MSG-FATAL TO TRUE                          35050000
348500             SET DP020-NEXT-ACT-APPL-ERROR                        35060000
348600                                 TO TRUE                          35070000
348700         WHEN OTHER                                               35080000
348800             MOVE '4680-GET-CONTROL-NUMBER'                       35090000
348900                                 TO DP013-PARAGRAPH               35100000
349000             MOVE 'SELECT CONTROL NUMBER BASED ON CARD NUMBER'    35110000
349100                                 TO DP013-MESSAGE-TEXT (1)        35120000
349200             MOVE SQLCA          TO DP013-SQLCA                   35130000
349300             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)35140000
349400             SET DP013-DB2-ABEND                                  35150000
349500                 DP013-XCTL-DISPLAY-RESTART                       35160000
349600                                   TO TRUE                        35170000
349700             PERFORM DP013-0000-PROCESS-ABEND                     35180000
349800     END-EVALUATE.                                                35190000
349900                                                                  35200000
350000*----------------------------------------------------------------*35210000
350100* SELECT CARD ID'S THAT ARE INVALID FOR THE SELECTED CARD ID     *35220000
350200* RANGE/STATUS CODE                                              *35230000
350300*----------------------------------------------------------------*35240000
350400 4700-SELECT-INVALID-CARD-IDS.                                    35250000
350500     EXEC SQL                                                     35260000
350600         SELECT  'Y'                                              35270000
350700           INTO :PV-VALID-CARD-ARRAY                              35280000
350800           FROM  SVT_KOHLS_CRD_ACCT                               35290000
350900          WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM            35300000
351000            AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM          35310000
351100            AND (CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND           35320000
351200                                  :DK-CNTL-NBR-TO)                35330000
351300            AND    STR_NBR      <> 090                            35340000
351400          WITH UR                                                 35350000
351500     END-EXEC.                                                    35360000
351600                                                                  35370000
351700     EVALUATE TRUE                                                35380000
351800         WHEN SQLCODE = +100                                      35390000
351900         WHEN SQLCODE = 0                                         35400000
352000         WHEN SQLCODE = -811                                      35410000
352100             CONTINUE                                             35420000
352200         WHEN SQLCODE = -911                                      35430000
352300         WHEN SQLCODE = -913                                      35440000
352400             MOVE '4700-SELECT-INVALID-CARD-IDS'                  35450000
352500                                 TO DP013-PARAGRAPH               35460000
352600             MOVE 'SELECT INVALID CONTROL NBRS IN A RANGE'        35470000
352700                                 TO DP013-MESSAGE-TEXT (1)        35480000
352800             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)35490000
352900             MOVE SQLCA          TO DP013-SQLCA                   35500000
353000             SET DP013-LINK-RETURN                                35510000
353100                 DP013-DB2-ABEND                                  35520000
353200                 DP013-ROLLBACK  TO TRUE                          35530000
353300             PERFORM DP013-0000-PROCESS-ABEND                     35540000
353400             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          35550000
353500*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           35560000
353600*----                  TRANSACTION FOR DATABASE &VAR              35570000
353700             MOVE PC-TSYMSG-00482                                 35580000
353800                                 TO DP020-MSG-NUMBER              35590000
353900             SET PS-DB2-ERROR    TO TRUE                          35600000
354000             SET DP020-MSG-FATAL TO TRUE                          35610000
354100             SET DP020-NEXT-ACT-APPL-ERROR                        35620000
354200                                 TO TRUE                          35630000
354300         WHEN OTHER                                               35640000
354400             MOVE '4700-SELECT-INVALID-CARD-IDS'                  35650000
354500                                 TO DP013-PARAGRAPH               35660000
354600             MOVE 'SELECT INVALID CONTROL NBRS IN RANGE'          35670000
354700                                 TO DP013-MESSAGE-TEXT (1)        35680000
354800             MOVE SQLCA          TO DP013-SQLCA                   35690000
354900             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)35700000
355000             SET DP013-DB2-ABEND                                  35710000
355100                 DP013-XCTL-DISPLAY-RESTART                       35720000
355200                                   TO TRUE                        35730000
355300             PERFORM DP013-0000-PROCESS-ABEND                     35740000
355400     END-EVALUATE.                                                35750000
355500                                                                  35760000
355600*----------------------------------------------------------------*35770000
355700* SELECT THE MINIMUM CARD ID THAT IS INVALID FOR THE SELECTED    *35780000
355800* CARD ID RANGE/STATUS CODE                                      *35790000
355900*----------------------------------------------------------------*35800000
356000 4750-SELECT-INVALID-CARD-IDS.                                    35810000
356100     EXEC SQL                                                     35820000
356200         SELECT MIN(CNTL_NBR)                                     35830000
356300           INTO :SVT00001-CNTL-NBR                                35840000
356400           FROM  SVT_KOHLS_CRD_ACCT                               35850000
356500          WHERE CRD_PROD_YR     = :DK-CRD-PROD-YR-FROM            35860000
356600            AND SHIPT_REQ_NBR   = :DK-SHIPT-REQ-NBR-FROM          35870000
356700            AND (CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND           35880000
356800                                  :DK-CNTL-NBR-TO)                35890000
356900            AND    STR_NBR      <> 090                            35900000
357000          WITH UR                                                 35910000
357100     END-EXEC.                                                    35920000
357200                                                                  35930000
357300     EVALUATE TRUE                                                35940000
357400         WHEN SQLCODE = 0                                         35950000
357500             MOVE DK-CRD-PROD-YR-FROM TO PV-REQ-DTE               35960000
357600             MOVE DK-SHIPT-REQ-NBR-FROM TO PV-REQ-NBR             35970000
357700             MOVE SVT00001-CNTL-NBR TO PV-SEQ-NBR                 35980000
357800             MOVE PV-CNTL-NBR TO DP020-MSG-TEXT                   35990000
357900         WHEN SQLCODE = -911                                      36000000
358000         WHEN SQLCODE = -913                                      36010000
358100             MOVE '4750-SELECT-INVALID-CARD-IDS'                  36020000
358200                                 TO DP013-PARAGRAPH               36030000
358300             MOVE 'SELECT FIRST INVALID CONTROL NBR IN A RANGE'   36040000
358400                                 TO DP013-MESSAGE-TEXT (1)        36050000
358500             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)36060000
358600             MOVE SQLCA          TO DP013-SQLCA                   36070000
358700             SET DP013-LINK-RETURN                                36080000
358800                 DP013-DB2-ABEND                                  36090000
358900                 DP013-ROLLBACK  TO TRUE                          36100000
359000             PERFORM DP013-0000-PROCESS-ABEND                     36110000
359100             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          36120000
359200*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           36130000
359300*----                  TRANSACTION FOR DATABASE &VAR              36140000
359400             MOVE PC-TSYMSG-00482                                 36150000
359500                                 TO DP020-MSG-NUMBER              36160000
359600             SET PS-DB2-ERROR    TO TRUE                          36170000
359700             SET DP020-MSG-FATAL TO TRUE                          36180000
359800             SET DP020-NEXT-ACT-APPL-ERROR                        36190000
359900                                 TO TRUE                          36200000
360000         WHEN OTHER                                               36210000
360100             MOVE '4750-SELECT-INVALID-CARD-IDS'                  36220000
360200                                 TO DP013-PARAGRAPH               36230000
360300             MOVE 'SELECT FIRST INVALID CONTROL NBR IN A RANGE'   36240000
360400                                 TO DP013-MESSAGE-TEXT (1)        36250000
360500             MOVE SQLCA          TO DP013-SQLCA                   36260000
360600             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)36270000
360700             SET DP013-DB2-ABEND                                  36280000
360800                 DP013-XCTL-DISPLAY-RESTART                       36290000
360900                                   TO TRUE                        36300000
361000             PERFORM DP013-0000-PROCESS-ABEND                     36310000
361100     END-EVALUATE.                                                36320000
361200                                                                  36330000
361300*----------------------------------------------------------------*36340000
361400* SET CURRENT DATE                                               *36350000
361500*----------------------------------------------------------------*36360000
361600 5000-SET-CURRENT-DATE.                                           36370000
361700     EXEC SQL                                                     36380000
361800         SET :PV-DATE = CURRENT DATE                              36390000
361900     END-EXEC.                                                    36400000
362000                                                                  36410000
362100     EVALUATE TRUE                                                36420000
362200         WHEN SQLCODE = ZERO                                      36430000
362300             CONTINUE                                             36440000
362400         WHEN OTHER                                               36450000
362500             MOVE '5000-SET-CURRENT-DATE'                         36460000
362600                                 TO DP013-PARAGRAPH               36470000
362700             MOVE 'SET CURRENT DATE'                              36480000
362800                                 TO DP013-MESSAGE-TEXT(1)         36490000
362900             MOVE SQLCA          TO DP013-SQLCA                   36500000
363000             SET DP013-DB2-ABEND                                  36510000
363100                 DP013-XCTL-DISPLAY-RESTART                       36520000
363200                                 TO TRUE                          36530000
363300             PERFORM DP013-0000-PROCESS-ABEND                     36540000
363400     END-EVALUATE.                                                36550000
363500*----------------------------------------------------------------*36560000
363600* SET CURRENT TIME                                               *36570000
363700*----------------------------------------------------------------*36580000
363800 5100-SET-CURRENT-TIME.                                           36590000
363900     EXEC SQL                                                     36600000
364000         SET :PV-TIME = CURRENT TIME                              36610000
364100     END-EXEC.                                                    36620000
364200                                                                  36630000
364300     EVALUATE TRUE                                                36640000
364400         WHEN SQLCODE = ZERO                                      36650000
364500             CONTINUE                                             36660000
364600         WHEN OTHER                                               36670000
364700             MOVE '5100-SET-CURRENT-TIME'                         36680000
364800                                 TO DP013-PARAGRAPH               36690000
364900             MOVE 'SET CURRENT TIME'                              36700000
365000                                 TO DP013-MESSAGE-TEXT(1)         36710000
365100             MOVE SQLCA          TO DP013-SQLCA                   36720000
365200             SET DP013-DB2-ABEND                                  36730000
365300                     DP013-XCTL-DISPLAY-RESTART                   36740000
365400                                 TO TRUE                          36750000
365500             PERFORM DP013-0000-PROCESS-ABEND                     36760000
365600     END-EVALUATE.                                                36770000
365700*----------------------------------------------------------------*36780000
365800* PREPARE FIELDS FOR STORED VALUE CARD TABLE UPDATE              *36790000
365900*   - STORE ASSIGNMENT FUNCTION                                  *36800000
366000*----------------------------------------------------------------*36810000
366100 5200-UPDATE-DISTRB.                                              36820000
366200     MOVE SV004-CRD-STAT-TYP-AVAILABLE                            36830000
366300                                 TO SVT00001-CRD-STAT-CDE.        36840000
366400     MOVE PV-DATE                TO SVT00001-CRD-DISTRB-DTE.      36850000
366500     MOVE PV-TIME                TO SVT00001-CRD-DISTRB-TM.       36860000
366600     MOVE DP020-USERID           TO SVT00001-DISTRB-USR-ID.       36870000
366700     MOVE ASC-REQUESTED-STORE-9  TO SVT00001-STR-NBR.             36880000
366800     MOVE ASC-CNTL-FROM-9        TO PV-CNTL-NBR-FROM.             36890000
366900     PERFORM 7000-CONTROL-NBR-FROM                                36900000
367000     MOVE ASC-CNTL-TO-9          TO PV-CNTL-NBR-TO.               36910000
367100     PERFORM 7200-CONTROL-NBR-TO.                                 36920000
367200     PERFORM 5250-APPLY-UPDATE-TO-DISTRB.                         36930000
367300*----------------------------------------------------------------*36940000
367400*  UPDATE THE STORED VALUE CARD TABLE                            *36950000
367500*   - STORE ASSIGNMENT FUNCTION                                  *36960000
367600*----------------------------------------------------------------*36970000
367700 5250-APPLY-UPDATE-TO-DISTRB.                                     36980000
367800     EXEC SQL                                                     36990000
367900         UPDATE SVT_KOHLS_CRD_ACCT                                37000000
368000             SET CRD_STAT_CDE = :SVT00001-CRD-STAT-CDE            37010000
368100               , CRD_DISTRB_DTE = :SVT00001-CRD-DISTRB-DTE        37020000
368200               , CRD_DISTRB_TM = :SVT00001-CRD-DISTRB-TM          37030000
368300               , DISTRB_USR_ID = :SVT00001-DISTRB-USR-ID          37040000
368400               , STR_NBR = :SVT00001-STR-NBR                      37050000
368500             WHERE CRD_PROD_YR    = :DK-CRD-PROD-YR-FROM          37060000
368600               AND SHIPT_REQ_NBR  = :DK-SHIPT-REQ-NBR-FROM        37070000
368700               AND (CNTL_NBR BETWEEN :DK-CNTL-NBR-FROM AND        37080000
368800                                     :DK-CNTL-NBR-TO)             37090000
368900     END-EXEC.                                                    37100000
369000                                                                  37110000
369100     EVALUATE TRUE                                                37120000
369200         WHEN SQLCODE = ZERO                                      37130000
369300             CONTINUE                                             37140000
369400         WHEN SQLCODE = -911                                      37150000
369500         WHEN SQLCODE = -913                                      37160000
369600             MOVE '5250-APPLY-UPDATE-TO-DISTRB'                   37170000
369700                                 TO DP013-PARAGRAPH               37180000
369800             MOVE 'UPDATE THE STORED VALUE CARD TABLE'            37190000
369900                                 TO DP013-MESSAGE-TEXT (1)        37200000
370000             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)37210000
370100             MOVE SQLCA          TO DP013-SQLCA                   37220000
370200             SET DP013-LINK-RETURN                                37230000
370300                 DP013-DB2-ABEND                                  37240000
370400                 DP013-ROLLBACK  TO TRUE                          37250000
370500             PERFORM DP013-0000-PROCESS-ABEND                     37260000
370600             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          37270000
370700*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           37280000
370800*----                  TRANSACTION FOR DATABASE &VAR              37290000
370900             MOVE PC-TSYMSG-00482                                 37300000
371000                                 TO DP020-MSG-NUMBER              37310000
371100             SET PS-DB2-ERROR    TO TRUE                          37320000
371200             SET DP020-MSG-WARNING                                37330000
371300                                 TO TRUE                          37340000
371400         WHEN OTHER                                               37350000
371500             MOVE '5250-APPLY-UPDATE-TO-DISTRB'                   37360000
371600                                   TO DP013-PARAGRAPH             37370000
371700             MOVE 'UPDATE THE STORED VALUE CARD TABLE'            37380000
371800                                   TO DP013-MESSAGE-TEXT(1)       37390000
371900             MOVE SQLCA            TO DP013-SQLCA                 37400000
372000             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)37410000
372100             SET DP013-DB2-ABEND                                  37420000
372200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           37430000
372300             PERFORM DP013-0000-PROCESS-ABEND                     37440000
372400     END-EVALUATE.                                                37450000
372500*----------------------------------------------------------------*37460000
372600 5400-DELETE-SVT-CRD-ACCT-LCK.                                    37470000
372700     EXEC SQL                                                     37480000
372800         DELETE FROM SVT_CRD_ACCT_LCK                             37490000
372900            WHERE CRD_NBR = :SV005-KMC-ID                         37500000
373000     END-EXEC.                                                    37510000
373100                                                                  37520000
373200     EVALUATE TRUE                                                37530000
373300         WHEN SQLCODE = ZERO                                      37540000
373400         WHEN SQLCODE = +100                                      37550000
373500         WHEN SQLCODE = -310                                      37560000
373600         WHEN SQLCODE = -904                                      37570000
373700         WHEN SQLCODE = -913                                      37580000
373800              CONTINUE                                            37590000
373900         WHEN OTHER                                               37600000
374000             MOVE '5400-DELETE-SVT-CRD-ACCT-LCK'                  37610000
374100                                        TO DP013-PARAGRAPH        37620000
374200             MOVE 'DELETE CARD NUMBER ' TO DP013-MESSAGE-TEXT (1) 37630000
374300             MOVE SQLCA                 TO DP013-SQLCA            37640000
374400             MOVE 'SVT_CRD_ACCT_LCK'    TO                        37650000
374500                                        DP013-DB2-TABLE-NAME (1)  37660000
374600             SET DP013-DB2-ABEND                                  37670000
374700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               37680000
374800             PERFORM DP013-0000-PROCESS-ABEND                     37690000
374900     END-EVALUATE.                                                37700000
375000*----------------------------------------------------------------*37710000
375100*----------------------------------------------------------------*37720000
375200 5500-CLEAN-UP-SVT-CRD-ACCT-LCK.                                  37730000
375300     MOVE SVT00001-CRD-NBR TO SV005-KMC-ID.                       37740000
375400     PERFORM 5400-DELETE-SVT-CRD-ACCT-LCK.                        37750000
375500     PERFORM 4640-FETCH-NEXT-CARD.                                37760000
375600*----------------------------------------------------------------*37770000
375700 6670-GET-STR-WCNTL-NBR.                                          37780000
375800     EXEC SQL                                                     37790000
375900         SELECT  STR_NBR                                          37800000
376000           INTO :SVT00001-STR-NBR                                 37810000
376100           FROM  SVT_KOHLS_CRD_ACCT                               37820000
376200           WHERE CRD_PROD_YR    = :DK-CRD-PROD-YR-FROM            37830000
376300             AND SHIPT_REQ_NBR  = :DK-SHIPT-REQ-NBR-FROM          37840000
376400             AND CNTL_NBR       = :DK-CNTL-NBR-FROM               37850000
376500           WITH UR                                                37860000
376600     END-EXEC.                                                    37870000
376700                                                                  37880000
376800     EVALUATE TRUE                                                37890000
376900         WHEN SQLCODE = 0                                         37900000
377000         WHEN SQLCODE = +100                                      37910000
377100             CONTINUE                                             37920000
377200         WHEN SQLCODE = -911                                      37930000
377300         WHEN SQLCODE = -913                                      37940000
377400             MOVE '6670-GET-STR-WCNTL-NBR'                        37950000
377500                                 TO DP013-PARAGRAPH               37960000
377600             MOVE 'SELECT STORE NBR BASED ON CONTROL NUMBER'      37970000
377700                                 TO DP013-MESSAGE-TEXT (1)        37980000
377800             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)37990000
377900             MOVE SQLCA          TO DP013-SQLCA                   38000000
378000             SET DP013-LINK-RETURN                                38010000
378100                 DP013-DB2-ABEND                                  38020000
378200                 DP013-ROLLBACK  TO TRUE                          38030000
378300             PERFORM DP013-0000-PROCESS-ABEND                     38040000
378400             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          38050000
378500*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           38060000
378600*----                  TRANSACTION FOR DATABASE &VAR              38070000
378700             MOVE PC-TSYMSG-00482                                 38080000
378800                                 TO DP020-MSG-NUMBER              38090000
378900             SET PS-DB2-ERROR    TO TRUE                          38100000
379000             SET DP020-MSG-FATAL TO TRUE                          38110000
379100             SET DP020-NEXT-ACT-APPL-ERROR                        38120000
379200                                 TO TRUE                          38130000
379300         WHEN OTHER                                               38140000
379400             MOVE '6670-GET-STR-WCNTL-NBR'                        38150000
379500                                 TO DP013-PARAGRAPH               38160000
379600             MOVE 'SELECT STORE NBR BASED ON CONTROL NUMBER'      38170000
379700                                 TO DP013-MESSAGE-TEXT (1)        38180000
379800             MOVE SQLCA          TO DP013-SQLCA                   38190000
379900             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)38200000
380000             SET DP013-DB2-ABEND                                  38210000
380100                 DP013-XCTL-DISPLAY-RESTART                       38220000
380200                                   TO TRUE                        38230000
380300             PERFORM DP013-0000-PROCESS-ABEND                     38240000
380400     END-EVALUATE.                                                38250000
380500 7000-CONTROL-NBR-FROM.                                           38260000
380600                                                                  38270000
380700     IF PV-START-REQ-DTE < 1900                                   38280000
380800         IF PV-START-REQ-DTE-YY > 90                              38290000
380900             MOVE 19 TO PV-START-REQ-DTE-CC                       38300000
381000         ELSE                                                     38310000
381100             MOVE 20 TO PV-START-REQ-DTE-CC                       38320000
381200         END-IF                                                   38330000
381300     END-IF.                                                      38340000
381400                                                                  38350000
381500     MOVE PV-START-REQ-DTE       TO DK-CRD-PROD-YR-FROM           38360000
381600                                    DK-CRD-PROD-YR-KEY.           38370000
381700     MOVE PV-START-REQ-NBR       TO DK-SHIPT-REQ-NBR-FROM         38380000
381800                                    DK-SHIPT-REQ-NBR-KEY.         38390000
381900     MOVE PV-START-SEQ-NBR       TO DK-CNTL-NBR-FROM              38400000
382000                                    DK-CNTL-NBR-KEY.              38410000
382100     MOVE PV-START-CNTL-NBR      TO ASC-CNTL-FROM.                38420000
382200                                                                  38430000
382300 7100-CONTROL-NBR.                                                38440000
382400                                                                  38450000
382500     IF PV-REQ-DTE < 1900                                         38460000
382600         IF PV-REQ-DTE-YY > 90                                    38470000
382700             MOVE 19 TO PV-REQ-DTE-CC                             38480000
382800         ELSE                                                     38490000
382900             MOVE 20 TO PV-REQ-DTE-CC                             38500000
383000         END-IF                                                   38510000
383100     END-IF.                                                      38520000
383200                                                                  38530000
383300     MOVE PV-REQ-DTE       TO DK-CRD-PROD-YR.                     38540000
383400     MOVE PV-REQ-NBR       TO DK-SHIPT-REQ-NBR.                   38550000
383500     MOVE PV-SEQ-NBR       TO DK-CNTL-NBR.                        38560000
383600                                                                  38570000
383700 7200-CONTROL-NBR-TO.                                             38580000
383800                                                                  38590000
383900     IF PV-ENDING-REQ-DTE < 1900                                  38600000
384000         IF PV-ENDING-REQ-DTE-YY > 90                             38610000
384100             MOVE 19 TO PV-ENDING-REQ-DTE-CC                      38620000
384200         ELSE                                                     38630000
384300             MOVE 20 TO PV-ENDING-REQ-DTE-CC                      38640000
384400         END-IF                                                   38650000
384500     END-IF.                                                      38660000
384600                                                                  38670000
384700     MOVE PV-ENDING-SEQ-NBR       TO DK-CNTL-NBR-TO.              38680000
384800     MOVE PV-ENDING-CNTL-NBR      TO ASC-CNTL-TO.                 38690000
384900                                                                  38700000
385000*----------------------------------------------------------------*38710000
385100* THE ROW THAT THE AUDIT USER HAS REQUESTED WAS NOT FOUND, SO    *38720000
385200* CHECK IF THE USER HAS THE AUTHORITY TO ADD IT.                 *38730000
385300*----------------------------------------------------------------*38740000
385400                                                                  38750000
385500 7300-CHECK-AUTH.                                                 38760000
385600                                                                  38770000
385700     SET ASC-INVALID-SECURITY      TO  TRUE.                      38780000
385800     SET DP008-RSRC-TYPE-FUNC      TO  TRUE.                      38790000
385900     SET DP008-ACCESS-TYPE-USE     TO  TRUE.                      38800000
386000                                                                  38810000
386100     EXEC CICS                                                    38820000
386200          LINK                                                    38830000
386300             PROGRAM  (DP008-SECURITY-SUBROUTINE)                 38840000
386400             COMMAREA (DP008-SECURITY-COMMAREA)                   38850000
386500             LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)            38860000
386600             RESP     (PV-RESP)                                   38870000
386700     END-EXEC.                                                    38880000
386800                                                                  38890000
386900     IF  PV-RESP NOT = DFHRESP(NORMAL)                            38900000
387000*        --- BAD LINK TO SECURITY MODULE ---                      38910000
387100         MOVE PC-TSYMSG-00233      TO DP020-MSG-NUMBER            38920000
387200         SET DP020-MSG-FATAL       TO TRUE                        38930000
387300     ELSE                                                         38940000
387400         IF  DP008-ACCESS-ALLOWED                                 38950000
387500             SET ASC-VALID-SECURITY TO TRUE                       38960000
387600         END-IF                                                   38970000
387700     END-IF.                                                      38980000
387800                                                                  38990000
387900*----------------------------------------------------------------*39000000
388000*    CONVERSION OF CARD NUMBER                                   *39010000
388100*----------------------------------------------------------------*39020000
388200     COPY SVPD007.                                                39030000
388300*----------------------------------------------------------------*39040000
388400*    ABEND PROCESSOR MODULE                                      *39050000
388500*----------------------------------------------------------------*39060000
388600     COPY DPPD013.                                                39070000
388700*----------------------------------------------------------------*39080000
388800*    UPDATE DATE AND TIME                                        *39090000
388900*----------------------------------------------------------------*39100000
389000     COPY DPPD017.                                                39110000
389100*----------------------------------------------------------------*39120000
389200*    AUTHORIZATION MODULE                                        *39130000
389300*----------------------------------------------------------------*39140000
389400     COPY SVPD005.                                                39150000
389500                                                                  39160000
389600*----------------------------------------------------------------*39170000
389700* EXPAND CARD NUMBER                                             *39180000
389800* IF THE CARD NUMBER IS A GIFT CARD ADD THE PREFIX AND CHECK     *39190000
389900* DIGIT.                                                         *39200000
390000*----------------------------------------------------------------*39210000
390100 6400-GET-CHECK-DIGIT.                                            39220000
390200                                                                  39230000
390300     PERFORM 6500-SELECT-CRD-AMT.                                 39240000
390400                                                                  39250000
390500     IF SV007-PRE-DNNTD-CRD-AMT = ZERO                            39260000
390600       MOVE SV007-NON-DNNTD-PREFIX TO SV007-CARD-PREFIX-OUT       39270000
390700     ELSE                                                         39280000
390800       MOVE SV007-PRE-DNNTD-PREFIX TO SV007-CARD-PREFIX-OUT       39290000
390900     END-IF.                                                      39300000
391000                                                                  39310000
391100     INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS.                     39320000
391200     SET DP040I-COMP-CHECK-DIGIT-OPTION                           39330000
391300                                  TO TRUE.                        39340000
391400     MOVE SV007-CARD-ID           TO DP040I-UPC-CODE.             39350000
391500     CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                          39360015
391600          USING DP040I-UPC-CHECK-DIGIT-PARMS.                     39370000
391700     IF DP040I-NO-ERROR-DETECTED                                  39380000
391800         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT                       39390000
391900                                  TO SV007-CHECK-DIGIT-OUT        39400000
392000     END-IF.                                                      39410000
392100                                                                  39420000
392200*----------------------------------------------------------------*39430000
392300* SELECT THE CRD AMT TO DETERMINE CARD PREFIX                    *39440000
392400*----------------------------------------------------------------*39450000
392500 6500-SELECT-CRD-AMT.                                             39460000
392600                                                                  39470000
392700     EXEC SQL                                                     39480000
392800         SELECT  PRE_DNNTD_CRD_AMT                                39490000
392900           INTO :SV007-PRE-DNNTD-CRD-AMT                          39500000
393000           FROM  SVT_KOHLS_CRD_ACCT T                             39510000
393100                ,SVT_CRD_PROD C                                   39520000
393200          WHERE CRD_NBR = :SV007-CRD-NBR                          39530000
393300            AND T.CRD_PROD_YR = C.CRD_PROD_YR                     39540000
393400            AND T.SHIPT_REQ_NBR = C.SHIPT_REQ_NBR                 39550000
393500     END-EXEC.                                                    39560000
393600                                                                  39570000
393700     EVALUATE TRUE                                                39580000
393800         WHEN SQLCODE = 0                                         39590000
393900             CONTINUE                                             39600000
394000         WHEN SQLCODE = -911                                      39610000
394100         WHEN SQLCODE = -913                                      39620000
394200             MOVE '6500-SELECT-CRD-AMT'                           39630000
394300                                 TO DP013-PARAGRAPH               39640000
394400             MOVE 'SELECT PRE_DNNTD_CRD_AMT FOR CRD NBR       '   39650000
394500                                 TO DP013-MESSAGE-TEXT (1)        39660000
394600             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)39670000
394700             MOVE 'SVT_CRD_PROD      ' TO DP013-DB2-TABLE-NAME (1)39680000
394800             MOVE SQLCA          TO DP013-SQLCA                   39690000
394900             SET DP013-LINK-RETURN                                39700000
395000                 DP013-DB2-ABEND                                  39710000
395100                 DP013-ROLLBACK  TO TRUE                          39720000
395200             PERFORM DP013-0000-PROCESS-ABEND                     39730000
395300             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP020-MSG-TEXT          39740000
395400*----PC-TSYMSG-00482 - THERE IS A CONFLICT WITH ANOTHER           39750000
395500*----                  TRANSACTION FOR DATABASE &VAR              39760000
395600             MOVE PC-TSYMSG-00482                                 39770000
395700                                 TO DP020-MSG-NUMBER              39780000
395800             SET SV007-DB2-ERROR    TO TRUE                       39790000
395900             SET DP020-MSG-FATAL TO TRUE                          39800000
396000             SET DP020-NEXT-ACT-APPL-ERROR                        39810000
396100                                 TO TRUE                          39820000
396200         WHEN OTHER                                               39830000
396300             MOVE '6500-SELECT-CRD-AMT'                           39840000
396400                                 TO DP013-PARAGRAPH               39850000
396500             MOVE 'SELECT CARD TYPE OF THE FIRST CONTROL NBR  '   39860000
396600                                 TO DP013-MESSAGE-TEXT (1)        39870000
396700             MOVE SQLCA          TO DP013-SQLCA                   39880000
396800             MOVE 'SVT_KOHLS_CRD_ACCT' TO DP013-DB2-TABLE-NAME (1)39890000
396900             SET DP013-DB2-ABEND                                  39900000
397000                 DP013-XCTL-DISPLAY-RESTART                       39910000
397100                                   TO TRUE                        39920000
397200             PERFORM DP013-0000-PROCESS-ABEND                     39930000
397300     END-EVALUATE.                                                39940000
397400                                                                  39950000
