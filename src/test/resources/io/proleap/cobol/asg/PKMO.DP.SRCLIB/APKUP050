000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    APKUP050.                                         00040000
000500 AUTHOR.        JOYCE KNOKE - TCC.                                00050000
000600 DATE-WRITTEN.  08/25/97.                                         00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*                                                               * 00090000
001000*        PROCESS REVERSAL OF PREPAID IMPORT COSTS               * 00100000
001100*                                                               * 00110000
001200*    THE PURPOSE OF THIS PROGRAM IS TO CREATE EXPENSE           * 00120000
001300*    JOURNAL TRANSACTIONS NEEDED TO REVERSE PREPAYMENT          * 00130000
001400*    ENTRIES, OF VARIOUS IMPORT COSTS FROM THE APPROPRIATE      * 00140000
001500*    GENERAL LEDGER ACCOUNTS. IT WILL ALSO UPDATE THE           * 00150000
001600*    INVOICE, RECEIPT AND REVERSAL TRACKING DATABASES TO        * 00160000
001700*    RECORD THE FACT THAT THE REVERSAL WAS CREATED.             * 00170000
001800*                                                               * 00180000
001900*---------------------------------------------------------------* 00190000
002000*                                                               * 00200000
002100* DB2 TABLES:                                                   * 00210000
002200*  1. AP CONTROL TABLE                 (TAPCNTL)                * 00220000
002300*  2. INVOICE TABLE                    (TINVOIC)                * 00230000
002400*  3. INVOICE CHARGES/ALLOWANCES TABLE (TALCHRG)                * 00240000
002500*  4. AP CHARGE TYPE TABLE             (TACCTYP)                * 00250000
002600*  5. AP JOURNAL TRANS OUTPUT FILE     (TOUTAP1)                * 00260000
002700*  6. AP TRAN CODE TABLE               (TTRNCDE)                * 00270000
002800*  7. AP EXTERNAL ENTERPRISE TABLE     (TEXTENT)                * 00280000
002900*                                                               * 00290000
003000* INPUT:                                                        * 00300000
003100*                                                               * 00310000
003200*  1. IMPORT-PO-VARIANCE-FILE                                   * 00320000
003300*                                                               * 00330000
003400*---------------------------------------------------------------* 00340000
003500*   CHANGES:                                                    * 00350000
003600*                                                               * 00360000
003700*   12/12/97                                                    * 00370000
003800*        CHANGED THE VALUE OF PC-HUNDRED-PERCENT TO 1 INSTEAD OF* 00380000
003900*        100.  THE MISPLACEMENT OF THE DECIMAL POINT WAS CAUSING* 00390000
004000*        THE REVERSAL AMOUNT TO BE MISCALCULATED FOR SOME POS.  * 00400000
004100*   MADE BY:  NANCY EILBES                     PITS/WR#:4164    * 00410000
004200*                                                               * 00420000
004300*   01/15/98                                                    * 00430000
004400*        CHANGED INVOICE_CSR SO INVOICES WITH EITHER AN 'N' OR  * 00440000
004500*        ' ' IN THE TINVOIC TABLE ARE RETRIEVED FOR A PURCHASE  * 00450000
004600*        ORDER NUMBER AND A SEQUENCE NUMBER.  ALSO ADDED THE    * 00460000
004700*        PAYT_REQ_SEQ_NBR FIELD FROM THE TINVOIC TABLE TO THE   * 00470000
004800*        INVOICE_CSR.  ADDED THE DISCOUNT_CSR TO RETRIEVE       * 00480000
004900*        THE DISCOUNT RECORDS FOR THE PAYT_REQ_SEQ_NBR FROM THE * 00490000
005000*        TINVOIC TABLE.  ADDED APPD052 TO CALCULATE THE DISCOUNT* 00500000
005100*        FOR A PARTICULAR INVOICE.  SUBTRACT THIS DISCOUNT      * 00510000
005200*        AMOUNT FROM THE INVC_NET_COST_AMT FIELD TO ARRIVE AT   * 00520000
005300*        THE TRUE NET COST.  PREVIOUSLY THE NET COST AMOUNT     * 00530000
005400*        THAT WAS PASSED ALONG FROM THIS PROGRAM DID NOT INCLUDE* 00540000
005500*        THE DISCOUNT PERCENTAGE.                               * 00550000
005600*   MADE BY:  MARK BURNSIDE                    PITS/WR#:4164    * 00560000
005700*                                                               * 00570000
005800*   03/13/98                                                    * 00580000
005900*        CHANGED THE WAY THE PJ DOCNO IS FORMATTED.  INSTEAD OF * 00590000
006000*        USING THE FIRST 10 CHARACTERS OF THE INVOICE ID, THE   * 00600000
006100*        DOCNO WILL BE MADE UP OF THE LAST 10 CHARACTERS.       * 00610000
006200*        (PARA MODIFIED F100-, PARA CREATED G200-)              * 00620000
006300*   MADE BY:  MIKE BESKE                       PITS/WR#:4164    * 00630000
006400*                                                               * 00640000
006500*   05/18/98                                                    * 00650000
006600*        ADDED AN ADDITIONAL WHERE CONDITION TO THE INVOICE     * 00660000
006700*        CURSOR.  THE CURSOR WILL NO LONGER SELECT INVOICES WITH* 00670000
006800*        A STATUS OF 'DE'.  THIS WILL SOLVE THE PROBLEM OF      * 00680000
006900*        REVERSING DELETED INVOICES.                            * 00690000
007000*   MADE BY:  MIKE BESKE                       PITS/WR#:????    * 00700000
007100*                                                               * 00710000
007200*   08/26/98                                                    * 00720000
007300*        CHANGE LRECL FOR APRD033 FROM 135 TO 150.              * 00730000
007400*   MADE BY:  CHRIS KUNSTMANN                  PITS/WR#:4164    * 00740000
007500*   09/29/98                                                    * 00750000
007600*        TEMPORARY CHANGE TO HANDLE TEST CHANGES TO TOUTAP1.    * 00760000
007700*        CHANGED ALL OCCURANCES OR PJ_TRAN_ODR TO AJ_TRAN_ODR.  * 00770000
007800*        CHANGED ALL OCCURANCES OR PJ-TRAN-ODR TO AJ-TRAN-ODR.  * 00780000
007900*        DB2TDBA & DB2ADBA9 HAVE NEW NAMES. DB2QDBA & DB2PDBA   * 00790000
008000*        STILL HAVE THE OLD NAMES.                              * 00800000
008100* TOUTAP1 IS VARCHAR, SO THE LENGTH OF THE DATA BEING MOVED TO    00810000
008200*  OUTAP1-AJ-TRAN-ODR MUST BE MOVED TO OUTAP1-AJ-TRAN-ODR.        00820000
008300* PC-APTRAN-LEN MUST REFLECT ANY RECORD LENGTH CHANGES IN APTRAN. 00830000
008400* F 'TOUTAP1 CJK' FOR THE ABOVE CHANGES.                        * 00840000
008500*                                                               * 00850000
008600*   MADE BY:  ROBIN BERNOSKI                   PITS/WR#:4164    * 00860000
008700*   11/05/98                                                    * 00870000
008800*        MODIFICATIONS PERFORMED TO ALLOW FOR THE CHANGE FROM   * 00880000
008900*        USING THE PURCHASE JOURNAL TO USING THE NEW ADJUSTMENT * 00890000
009000*        JOURNAL.  CHANGES INCLUDED REMOVING ITEMS REFERRING    * 00900000
009100*        TO JULIAN DATES, PROGRAM NOW GENERATES TRAN CODE 65    * 00910000
009200*        INSTEAD OF 87, READS TTRNCDE TABLE TO OBTAIN THE DOC   * 00920000
009300*        NUMBER AND GL ACCOUNT NUMBERS, UTILIZES APRD045 INSTEAD* 00930000
009400*        OF APTRAN, DOCUMENT NUMBER IS INCREASED TO 16 DIGITS,  * 00940000
009500*        (13 DIGITS FROM INVC NUMBER AND 3 FROM CHARGE CODES).  * 00950000
009600*        CHANGES MADE TO BE ABLE TO INTERFACE WITH PEOPLESOFT.  * 00960000
009700*                                                               * 00970000
009800*   08/24/99                                                    * 00980000
009900*        REMOVED COPYBOOK APWS051 FROM PROGRAM                  * 00990000
010000*   MADE BY:  L SCHALLHORN                     PITS/WR#:6041    * 01000000
010100*                                                               * 01010000
010200*   11/10/2000                                                  * 01020000
010300*      ADDED LOGIC TO PROCESS THE NEW MOS FIELDS. THE NEW       * 01030000
010400*      FIELD IS HANDLED THE SAME WAY THE NEW STORE DISCOUNT     * 01040000
010500*      IS HANDLED.                                              * 01050000
010600*   MADE BY: JILL JUEL                   WR/IR #: 20224         * 01060000
010700*                                                               * 01070000
010800*   05/24/2001                                                  * 01080000
010900*      REMOVED EXTRANEOUS DISPLAYS AND ADDED A DISPLAY OF THE   * 01090000
011000*      PROGRAM NAME IN THE INITIALIZE PARAGRAPH.                * 01100000
011100*   MADE BY: NANCY EILBES                WR/IR #: 20704         * 01110000
011200*                                                               * 01120000
011300*   07/23/2001                                                  * 01130000
011400*      INCREASED THE VALUE OF PC-AP045-LEN FROM 400 TO 500.     * 01140000
011500*      THIS REFLECTS THE MODIFICATIONS MADE TO THE TOUTAP1      * 01150000
011600*      TABLE AND COPYBOOK APRD045.                              * 01160000
011700*   MADE BY: ALEXIS KEIKER               WR/IR #: 22467         * 01170000
011800*                                                               * 01180000
011900*   08/16/01                                                    * 01190000
012000*      MODIFIED THE INVOICE_CSR TO EXCLUDE STATUS CODE 'PR'.    * 01200000
012100*      THIS WILL PREVENT CREATING REVERSAL ENTRIES FOR EXPENSE  * 01210000
012200*      INVOICES THT HAVE NOT BEEN PAID DUE TO THE PENDING       * 01220000
012300*      REVIEW STATUS.                                           * 01230000
012400*   MADE BY: ALEXIS KEIKER               WR/IR #: 20530         * 01240000
012500*                                                               * 01250000
012600*   05/16/2002                                                  * 01260000
012700*     CHANGE MADE:  NI-SKU CHANGES.  RECOMPILE FROM PRODUCTION  * 01270000
012800*     TO INCORPORATE CHANGES TO COPYBOOK APRD045.  ALSO REMOVED * 01280000
012900*     TABLES TPURCHS AND TENTNME IN PARAGRAPH S800.  JOIN WAS   * 01290000
013000*     UNNECESSARY TO OBTAIN ENT-ID.  TEXTENT IS ONLY TABLE      * 01300000
013100*     NEEDED FOR THIS (USING AP045-VND-NBR AS CRITERIA).        * 01310000
013200*   MADE BY:  KEVIN CATLIN                   WR/IR #: 21278     * 01320000
013300*                                                               * 01330000
013400*   06/17/2002                                                  * 01340000
013500*      ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.      * 01350000
013600*   MADE BY: KEVIN CATLIN                    WR# 23500          * 01360000
013700*                                                               * 01370000
013800*   06/18/2002                                                  * 01380000
013900*      ARK PO PROJECT PHASE 1.  REMOVED TABLE TPAYREQ AND ITS   * 01390000
014000*      REFERENCED COLUMNS FROM PROGRAM.  CHANGED UPDATES TO     * 01400000
014100*      TINVOIC TO USE NEW KEYS OF PO_NBR AND INVC_ID.           * 01410000
014200*   MADE BY: KEVIN CATLIN                WR#: 23500             * 01420000
014300*                                                               * 01430000
014400*   06/25/02 RECOMPILE FROM PRODUCTION TO PICK UP CHANGES TO    * 01440000
014500*            COPYBOOKS APPD052 AND APWS052.                     * 01450000
014600*            BY:  KEVIN CATLIN                 WR#: 23839       * 01460000
014700*                                                               * 01470000
014800*   08/08/2002                                                  * 01480000
014900*      COLBY HANGER EXPENSE PROCESSING.  MODIFIED PROGRAM TO    * 01490000
015000*      CREATE TRANSACTION RECORDS FOR HANGER CHARGES ON COLBY   * 01500000
015100*      MERCHANDISE INVOICES.  ADDED ALLOWANCE CHARGE PROCESSING * 01510000
015200*      TO MERCHANDISE INVOICES IN PARAGRAPH C100.  WILL NOW USE * 01520000
015300*      INVOIC-GRO-COST-AMT FOR CALCULATING DISCOUNTS IN PARA    * 01530000
015400*      D200 INSTEAD OF NET-COST-AMT.                            * 01540000
015500*   MADE BY: KEVIN CATLIN                WR#: 23254             * 01550000
015600*                                                               * 01560000
015700*   08/24/2002                                                  * 01570000
015800*      ARK PO PROJECT PHASE 2.  REMOVE ALL REFERENCES TO        * 01580000
015900*      PAYT-REQ-SEQ-NBR.  REPLACE PAYT_REQ_SEQ_NBR WITH THE NEW * 01590000
016000*      INDEX OF PO_NBR AND INVC_ID.  REMOVED ALL REFERENCES TO  * 01600000
016100*      TPPDREV AND TRECEIV.  RESTRUCTURED PARAGRAPHS B200,      * 01610000
016200*      C100, D100, AND E100.                                    * 01620000
016300*   MADE BY: KEVIN CATLIN                WR#: 23500             * 01630000
016400*                                                               * 01640000
016500*   11/04/02                                                    * 01650000
016600*        ADDED AN ADDITIONAL WHERE CONDITION TO THE ALW_CHRG_CSR* 01660000
016700*        CURSOR.  THE TACCTYP TABLE NOW HAS EFFECTIVE DATING AND* 01670000
016800*        THAT IS WHAT THE ADDL WHERE CONDITION REFERENCES.  THIS* 01680000
016900*        WAS ALSO ADDED TO THE SQL IN S300-.                    * 01690000
017000*        REPLACED INPUT COPYBOOK APRD033 WITH APRD036.          * 01700000
017100*        MODIFIED ALL OF THE AMOUNT FIELDS FROM 9(7)V99         * 01710000
017200*        TO S9(9)V99 COMP-3 IN COPYBOOK APWS052.THIS WAS DONE   * 01720000
017300*        TO CORRECT A DISCOUNT BALANCING ISSUE.                 * 01730000
017400*   MADE BY:  MIKE BESKE                 WR# 23750              * 01740000
017500*                                                               * 01750000
017600*  DATE  03/25/2003                                             * 01760000
017700*      CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE * 01770000
017800*      TO COPYBOOK APWS052.                                     * 01780000
017900*      MADE BY: KEVIN CATLIN            WR/IR #: WR24481        * 01790000
018000*                                                               * 01800000
018100*   DATE  09/17/2003                                            * 01810000
018200*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP       * 01820000
018300*       CHANGE TO COPYBOOK APRD045.                             * 01830000
018400*       MADE BY: MIKE BESKE              WR/IR #: WR21316       * 01840000
018500*                                                               * 01850000
018600* DATE  01/30/2004                                              * 01860000
018700*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE  * 01870000
018800*     TO COPYBOOKS APWS052 AND APPD052. THIS INVOLVES THE VENDOR* 01880000
018900*     INSURANCE EXCEPTION OF NOT CHARGING BACK THE VENDOR FOR   * 01890000
019000*     INSURANCE CHARGE CODES: 'INS' AND '445'.  THE VENDORS ARE * 01900000
019100*     ANDEL JEWELRY '117498121' AND CITIZEN WATCH '078822863'.  * 01910000
019200*     MADE BY: MIKE BESKE              WR/IR #: P000628860      * 01920000
019300*                                                               * 01930000
019400* DATE  03/03/2004                                              * 01940000
019500*     CHANGE MADE: CORRECTED THE CODE THAT FORMATS THE DOC NBR  * 01950000
019600*     FOR THE ADJUSTMENTS IN G200-FORMAT-DOC-NO.  THE OLD STRING* 01960000
019700*     LOGIC WAS NOT ALLOWING FOR IMBEDDED SPACE CHARACTERS.     * 01970000
019800*     THIS CORRECTION WILL NOW ALLOW IMBEDDED SPACE CHARACTERS. * 01980000
019900*     MADE BY: MIKE BESKE              WR/IR #: P000638015      * 01990000
020000*                                                               * 02000000
020100* DATE  04/08/2004                                              * 02010000
020200*     CHANGE MADE: ADDED ADDITIONAL CODE TO PARA G200- THAT     * 02020000
020300*     WILL CORRECT A PROBLEM WHERE INVOIC ID 17 TO 22 CHARACTERS* 02030000
020400*     WAS NOT HAVING THE CHARGE CODE BEING APENDED TO THE END   * 02040000
020500*     OF THE FORMATTED DOC NUMBER.                              * 02050000
020600*     MADE BY: MIKE BESKE              WR/IR #: WR26553         * 02060000
020700*                                                               * 02070000
020800* DATE  04/22/2004                                              * 02080000
020900*     CHANGE MADE: CHANGED PC-STORNO VALUE FROM '090' TO '00090'* 02090000
021000*     AS PART OF THE STORE CONSTRAINTS PROJECT.                 * 02100000
021100*     MADE BY: MIKE BESKE              WR/IR #: WR25805         * 02110000
021200*                                                               * 02120000
021210* DATE  04/29/2005                                              * 02121000
021220*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGES * 02122000
021230*     TO COPYBOOKS APWS052 AND APPD052.                         * 02123000
021240*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28651         * 02124000
021250*                                                               * 02125000
021251* DATE  12/02/2005                                              * 02125100
021252*     CHANGE MADE: MODIFIED INVOICE_CSR TO RETRIEVE INVOICES    * 02125200
021253*     WITH STATUS CODES OF 'OP' OR 'PD'                         * 02125300
021254*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR29735         * 02125400
021255*                                                               * 02125500
021256* DATE  03/02/2006                                              * 02125600
021257*     CHANGE MADE: TEMPORARY FIX TO INCLUDE BROADCAST AND CO-OP * 02125700
021258*     ALLOWANCES IN THE GROSS ALLOWANCE AMOUNT.                 * 02125800
021259*     MADE BY: GREG WISIALOWSKI        WR/IR #:  P000855667     * 02125900
021260*                                                               * 02126000
021261* DATE  03/13/2006                                              * 02126100
021262*     CHANGE MADE: REMOVE TEMPORARY FIX DUE TO IMPLEMENTATION   * 02126200
021263*     OF VENDOR ALLOWANCE.                                      * 02126300
021264*     MADE BY: GREG WISIALOWSKI        WR/IR #:  WR30028        * 02126400
021265*                                                               * 02126500
021266*   DATE  03/16/2009                                            * 02126600
021267*     CHANGE MADE: RECOMPILE FOR ADDITION OF DMA-NBR TO         * 02126700
021268*     APRD036.                                                  * 02126800
021269*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR31546         * 02126900
021270*                                                               * 02127000
021271*   DATE  08/31/2010                                            * 02127100
021272*     CHANGE MADE: MODIFY INVOICE_CSR TO SELECT ROWS WITH A     * 02127200
021273*     STATUS_CDE = 'RL'.  CHANGING THE PROCESSING SEQUENCE      * 02127300
021274*     SO THAT APK038 IS BEFORE APK037 CAUSES THE CURSOR TO      * 02127400
021275*     NOT GENERATE THE 65 AND 73 TRANCODES SINCE THE STATUS_CDE * 02127500
021276*     AT THE TIME OF EXECUTION IS NO LONGER 'OP' OR 'PD'.       * 02127600
021277*     MADE BY: ROLF NOHE               WR/IR #: WR38002         * 02127700
021278*                                                               * 02127800
021279* DATE  06/30/2012                                              * 02127900
021280*     CHANGE MADE: ACCEPT THE OPEN ACCOUNT PROCESSING OPTION    * 02128000
021290*                  BY ADDING VALUE '1OA'                        * 02129000
021300*     MADE BY: TOM MARTIN              WR/IR #: WR39735         * 02130000
021310*                                                               * 02131008
021320* DATE  11/21/2019                                              * 02132008
021330*     CHANGE MADE: ADDED LOGIC IN C100-PROCESS-INVOICES TO      * 02133008
021340*     CHECK IF THE TOTAL 1ST COST AMOUNT EXCEEDS THE LIMIT OF   * 02134008
021341*     THE SIZE OF THE DISTRIB LINE AMOUNT.  WHEN IT DOES, THE   * 02134108
021342*     THE AMOUNT IS ALLOCATED ACROSS MULTIPLE ADJUSTMENTS SO    * 02134208
021343*     THE ENTIRE AMOUNT WILL BE REPRESENTED INSTEAD OF BEING    * 02134308
021344*     TRUNCATED. A SUFFIX WILL BE ADDED TO THE DOC NUMBER FOR   * 02134408
021345*     UNIQUENESS.                                               * 02134508
021350*     MADE BY: NANCY EILBES            WR/IR #: CHG0236101      * 02135008
021360*                                                               * 02136010
021370* DATE  03/14/2023                                              * 02137011
021380*     CHANGE MADE: AP DIRECT IMPORT MODIFICATIONS               * 02138010
021390*     ADD VALUE '1NX' TO IMPRT-CHRG-PRC-CDE-VALID LIST. REMOVE  * 02139010
021391*     'AMC' FROM SAME.                                          * 02139110
021392*     BY: NANCY EILBES                    WR #: CHG0285533      * 02139211
021400*---------------------------------------------------------------* 02140000
021500 EJECT                                                            02150000
021600                                                                  02160000
021700 ENVIRONMENT DIVISION.                                            02170000
021800 CONFIGURATION SECTION.                                           02180000
021900 SOURCE-COMPUTER. IBM-3090.                                       02190000
022000 OBJECT-COMPUTER. IBM-3090.                                       02200000
022100                                                                  02210000
022200*                                                                 02220000
022300 INPUT-OUTPUT SECTION.                                            02230000
022400 FILE-CONTROL.                                                    02240000
022500*                                                                 02250000
022600     SELECT IMPORT-PO-VARIANCE-FILE ASSIGN TO UT-S-INP01.         02260000
022700*                                                                 02270000
022800 DATA DIVISION.                                                   02280000
022900 FILE SECTION.                                                    02290000
023000*                                                                 02300000
023100 FD  IMPORT-PO-VARIANCE-FILE                                      02310000
023200     RECORDING MODE IS F                                          02320000
023300     BLOCK CONTAINS 0 CHARACTERS                                  02330000
023400     LABEL RECORDS ARE STANDARD                                   02340000
023500     DATA RECORD IS IMPORT-PO-VARIANCE-RECORD.                    02350000
023600*                                                                 02360000
023700 01  IMPORT-PO-VARIANCE-RECORD   PIC X(170).                      02370000
023800*                                                                 02380000
023900 EJECT                                                            02390000
024000 WORKING-STORAGE SECTION.                                         02400000
024100                                                                  02410000
024200 01  PC-PROGRAM-CONSTANTS.                                        02420000
024300     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                02430000
024400         '**** WORKING STORAGE ** APKUP050 ****'.                 02440000
024500     05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUP050'.    02450000
024600     05  PC-DPKUT500             PIC  X(08)  VALUE 'DPKUT500'.    02460000
024700     05  PC-RETRY-MAX            PIC S9(04)  VALUE +3             02470000
024800                                             COMP SYNC.           02480000
024900     05  PC-RETRY-COUNT          PIC S9(04)  VALUE ZEROS.         02490000
025000     05  PC-REGION               PIC  X(02)  VALUE '03'.          02500000
025100     05  PC-STORNO               PIC  X(05)  VALUE '00090'.       02510000
025200     05  PC-SEQNO                PIC  X(01)  VALUE '0'.           02520000
025300     05  PC-IN-PROCESS-CODE      PIC  X(01)  VALUE '9'.           02530000
025400     05  PC-RUN-COMPLETE-CODE    PIC  X(01)  VALUE '0'.           02540000
025500     05  PC-HUNDRED-PERCENT      PIC  9(3)V9(5) VALUE 1.          02550000
025600* TOUTAP1 CJK                                                     02560000
025700* PC-AP045-LEN MUST REFLECT ANY RECORD LENGTH CHANGES IN APRD045. 02570000
025800     05  PC-AP045-LEN            PIC S9(04)  VALUE 500    COMP.   02580000
025810     05  PC-DISTRIB-LINE-LIMIT   PIC S9(7)V9(2) VALUE 9999999.99  02581001
025820                                               COMP-3.            02582001
025900                                                                  02590000
026000 01  PV-PROGRAM-VARIABLES.                                        02600000
026100     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      02610000
026200     05  PV-NULL-IND             PIC S9(4)     VALUE ZERO         02620000
026300                                               COMP SYNC.         02630000
026400     05  PV-TIME-OF-DAY          PIC  X(06)     VALUE SPACES.     02640000
026500     05  FILLER REDEFINES PV-TIME-OF-DAY.                         02650000
026600         10  PV-DAY-HOUR         PIC  X(02).                      02660000
026700         10  PV-DAY-MINUTE       PIC  X(02).                      02670000
026800         10  PV-DAY-SECOND       PIC  X(02).                      02680000
026900     05  PV-TIME.                                                 02690000
027000         10  FILLER              PIC  X(01)     VALUE '-'.        02700000
027100         10  PV-TIME-HOUR        PIC  9(02)     VALUE ZEROS.      02710000
027200         10  FILLER              PIC  X(01)     VALUE '.'.        02720000
027300         10  PV-TIME-MINUTE      PIC  9(02)     VALUE ZEROS.      02730000
027400         10  FILLER              PIC  X(01)     VALUE '.'.        02740000
027500         10  PV-TIME-SECOND      PIC  9(02)     VALUE ZEROS.      02750000
027600         10  FILLER              PIC  X(01)     VALUE '.'.        02760000
027700         10  PV-TIME-MIL         PIC  X(06)     VALUE '999999'.   02770000
027800     05  PV-CURRENT-DATE         PIC  X(10)     VALUE SPACES.     02780000
027900     05  PV-CHRG-CDE             PIC  X(03)    VALUE SPACES.      02790000
028000     05  PV-GL-ACCT-NBR          PIC  X(06)    VALUE SPACES.      02800000
028100     05  PV-VENDOR-NAME          PIC  X(30)    VALUE SPACES.      02810000
028200     05  FILLER   REDEFINES   PV-VENDOR-NAME.                     02820000
028300         10  PV-VENDOR-NAME-R    PIC  X(15).                      02830000
028400         10  FILLER              PIC  X(15).                      02840000
028500     05  PV-INVOICE              PIC  X(13)    VALUE SPACES.      02850000
028600     05  PV-CHARGE-CODE          PIC  X(03)    VALUE SPACES.      02860000
028700     05  PV-STRING               PIC  X(22)    VALUE SPACES.      02870000
028720     05  PV-SUFFIX-COUNT         PIC  9(01)    VALUE ZERO.        02872005
028730     05  PV-SUFFIX-2.                                             02873004
028740         10  PV-SUFFIX-2-SLASH   PIC  X(01)    VALUE SPACE.       02874005
028750         10  PV-SUFFIX-2-CNT     PIC  X(01)    VALUE SPACE.       02875005
028800     05  PV-START                PIC  S9(04)   VALUE ZEROS        02880000
028900                                               COMP.              02890000
029000     05  PV-START2               PIC  S9(04)   VALUE ZEROS        02900000
029100                                               COMP.              02910000
029200     05  PV-PO-NBR-9             PIC   9(9)    VALUE ZEROS.       02920000
029300                                                                  02930000
029400     05  PV-PO-NBR               PIC  S9(9)    VALUE ZEROS        02940000
029500                                               COMP.              02950000
029600     05  PV-NEW-REVERSAL         PIC S9(7)V9(2) VALUE ZEROS       02960000
029700                                               COMP-3.            02970000
029800     05  PV-ORIGINAL-POSTING     PIC S9(9)V9(2) VALUE ZEROS       02980005
029900                                               COMP-3.            02990000
030000     05  PV-INVOICE-COUNT        PIC S9(9)     VALUE ZEROS        03000000
030100                                               COMP.              03010000
030200     05  PV-CR-TRAN-COUNT        PIC S9(9)     VALUE ZEROS        03020000
030300                                               COMP.              03030000
030400     05  PV-CH-TRAN-COUNT        PIC S9(9)     VALUE ZEROS        03040000
030500                                               COMP.              03050000
030600     05  PV-IMP-EXT-COUNT        PIC S9(9)     VALUE ZEROS        03060000
030700                                               COMP.              03070000
030800     05  PV-TINVOIC-UPDATE-COUNT PIC S9(9)     VALUE ZEROS        03080000
030900                                               COMP.              03090000
031000     05  PV-CKPT-STAT-CODE       PIC X(01)     VALUE SPACE.       03100000
031100     05  PV-IMPRT-CHRG-PRC-CDE   PIC X(03)     VALUE SPACE.       03110000
031200         88  IMPRT-CHRG-PRC-CDE-VALID          VALUE              03120000
031300                                  '1OA', '1ST', '1LC', '1NX'.     03130009
031400     05  PV-PSTG-TYP-CDE         PIC X(03)     VALUE SPACE.       03140000
031500     05  PV-ENT-ID               PIC S9(9)     VALUE ZEROS        03150000
031600                                               COMP.              03160000
031700     05  PV-NEW-REVERSAL-ACCUM   PIC S9(9)V9(2) VALUE ZEROS       03170000
031800                                               COMP-3.            03180000
031900     05  PV-TOTAL-NEW-REVERSAL   PIC S9(9)V9(2) VALUE ZEROS.      03190000
032000     05  PV-AP-65-TRN-CDE        PIC X(02)     VALUE SPACE.       03200000
032100     05  PV-AP-73-TRN-CDE        PIC X(02)     VALUE SPACE.       03210000
032200     05  PV-TRN-TYP-CDE-65       PIC X(03)     VALUE SPACE.       03220000
032300     05  PV-TRN-TYP-CDE-73       PIC X(03)     VALUE SPACE.       03230000
032400     05  PV-GL-ACCT-NBR-65       PIC X(06)     VALUE SPACE.       03240000
032500     05  PV-GL-ACCT-NBR-73       PIC X(06)     VALUE SPACE.       03250000
032600     05  PV-PSTG-TYP-CDE-65      PIC X(02)     VALUE SPACE.       03260000
032700     05  PV-PSTG-TYP-CDE-73      PIC X(02)     VALUE SPACE.       03270000
032800     05  PV-BTCH-SRC-CDE-65      PIC X(03)     VALUE SPACE.       03280000
032900     05  PV-BTCH-SRC-CDE-73      PIC X(03)     VALUE SPACE.       03290000
033000     05  PV-BTCH-NBR.                                             03300000
033010         10  PV-BTCH-DTE         PIC X(10)     VALUE SPACE.       03301000
033020         10  PV-SRC-CDE          PIC X(03)     VALUE SPACE.       03302000
033021         10  PV-SEQ-NBR          PIC X(02)     VALUE SPACE.       03302100
033022                                                                  03302200
033023 01  PS-PROGRAM-SWITCHES.                                         03302300
033024     05  PS-END-INVOICES-SW      PIC  X(01)  VALUE ' '.           03302400
033025         88  PS-END-INVOICES                 VALUE 'Y'.           03302500
033026         88  PS-MORE-INVOICES                VALUE ' '.           03302600
033027     05  PS-END-EXTRACT-SW       PIC  X(01)  VALUE ' '.           03302700
033028         88  PS-END-EXTRACT                  VALUE 'Y'.           03302800
033029         88  PS-MORE-EXTRACT                 VALUE ' '.           03302900
033030     05  PS-END-ALW-CHARGES-SW   PIC  X(01)  VALUE ' '.           03303000
033040         88  PS-END-ALW-CHARGES              VALUE 'Y'.           03304000
033050         88  PS-MORE-ALW-CHARGES             VALUE ' '.           03305000
033060     05  PS-ALW-CHRG-TRANS-SW    PIC  X(01)  VALUE ' '.           03306000
033070         88  PS-ALW-CHRG-TRANS               VALUE 'Y'.           03307000
033080         88  PS-NON-ALW-CHRG-TRANS           VALUE ' '.           03308000
033090     05  PS-RUN-TYPE-SW          PIC  X(01)  VALUE ' '.           03309000
033100         88  NORMAL-RUN                      VALUE '0'.           03310000
033200         88  RESTART-RUN                     VALUE '9'.           03320000
033300     05  PS-END-OF-IMPORT-DISCOUNT-SW  PIC  X(01)  VALUE ' '.     03330000
033400         88  PS-END-OF-IMPORT-DISCOUNTS      VALUE 'Y'.           03340000
033500         88  PS-MORE-IMPORT-DISCOUNTS        VALUE ' '.           03350000
033600                                                                  03360000
033700 01  CKPT-RESTART-INFO.                                           03370000
033800     05  CR-PO-NBR                PIC 9(09)   VALUE ZEROS.        03380000
033900     05  CR-INVOICE-COUNT         PIC S9(9)   VALUE ZEROS  COMP.  03390000
034000     05  CR-CR-TRAN-COUNT         PIC S9(9)   VALUE ZEROS  COMP.  03400000
034100     05  CR-CH-TRAN-COUNT         PIC S9(9)   VALUE ZEROS  COMP.  03410000
034200     05  CR-IMP-EXT-COUNT         PIC S9(9)   VALUE ZEROS  COMP.  03420000
034300     05  CR-TINVOIC-UPDATE-COUNT  PIC S9(9)   VALUE ZEROS  COMP.  03430000
034400                                                                  03440000
034500 01  CKPT-RESTART-TMST.                                           03450000
034600     05  CR-CURR-TMST             PIC X(26)     VALUE SPACES.     03460000
034700     05  CR-NEXT-TMST             PIC X(26)     VALUE SPACES.     03470000
034800/                                                                 03480000
034900*                                                                 03490000
035000*    AP045 TRANSACTION FILE                                       03500000
035100*                                                                 03510000
035200     COPY APRD045.                                                03520000
035300/                                                                 03530000
035400*                                                                 03540000
035500*    IMPORT PO COST VARIANCE REPORTING FILE.                      03550000
035600*                                                                 03560000
035700     COPY APRD036.                                                03570000
035800/                                                                 03580000
035900*                                                                 03590000
036000*    TAPCNTL DCLGEN                                               03600000
036100*                                                                 03610000
036200     EXEC SQL                                                     03620000
036300         INCLUDE TAPCNTL                                          03630000
036400     END-EXEC.                                                    03640000
036500/                                                                 03650000
036600*                                                                 03660000
036700*    TEXTENT DCLGEN                                               03670000
036800*                                                                 03680000
036900     EXEC SQL                                                     03690000
037000         INCLUDE TEXTENT                                          03700000
037100     END-EXEC.                                                    03710000
037200/                                                                 03720000
037300*                                                                 03730000
037400*    TINVOIC DCLGEN                                               03740000
037500*                                                                 03750000
037600     EXEC SQL                                                     03760000
037700         INCLUDE TINVOIC                                          03770000
037800     END-EXEC.                                                    03780000
037900/                                                                 03790000
038000*                                                                 03800000
038100*    TMDINVC DCLGEN                                               03810000
038200*                                                                 03820000
038300     EXEC SQL                                                     03830000
038400         INCLUDE TMDINVC                                          03840000
038500     END-EXEC.                                                    03850000
038600/                                                                 03860000
038700*                                                                 03870000
038800*    TALCHRG DCLGEN                                               03880000
038900*                                                                 03890000
039000     EXEC SQL                                                     03900000
039100         INCLUDE TALCHRG                                          03910000
039200     END-EXEC.                                                    03920000
039300/                                                                 03930000
039400*                                                                 03940000
039500*    TACCTYP DCLGEN                                               03950000
039600*                                                                 03960000
039700     EXEC SQL                                                     03970000
039800         INCLUDE TACCTYP                                          03980000
039900     END-EXEC.                                                    03990000
040000/                                                                 04000000
040100*                                                                 04010000
040200*    TOUTAP1 DCLGEN                                               04020000
040300* TOUTAP1 IS VARCHAR, SO THE LENGTH OF THE DATA BEING MOVED TO    04030000
040400*  OUTAP1-AJ-TRAN-ODR MUST BE MOVED TO OUTAP1-AJ-TRAN-ODR.        04040000
040500*                                                                 04050000
040600     EXEC SQL                                                     04060000
040700         INCLUDE TOUTAP1                                          04070000
040800     END-EXEC.                                                    04080000
040900/                                                                 04090000
041000*                                                                 04100000
041100*      TCKRSTCNTL TABLE LAYOUT                                    04110000
041200*                                                                 04120000
041300         EXEC SQL                                                 04130000
041400             INCLUDE TCKRSTCN                                     04140000
041500         END-EXEC.                                                04150000
041600/                                                                 04160000
041700*                                                                 04170000
041800*      TCKRSTINF TABLE LAYOUT                                     04180000
041900*                                                                 04190000
042000         EXEC SQL                                                 04200000
042100             INCLUDE TCKRSTIN                                     04210000
042200         END-EXEC.                                                04220000
042300/                                                                 04230000
042400*                                                                 04240000
042500*      TTRNCDE TABLE LAYOUT                                       04250000
042600*                                                                 04260000
042700         EXEC SQL                                                 04270000
042800             INCLUDE TTRNCDE                                      04280000
042900         END-EXEC.                                                04290000
043000/                                                                 04300000
043100*                                                                 04310000
043200*    SQL COMMUNICATIONS AREA DCLGEN                               04320000
043300*                                                                 04330000
043400     EXEC SQL                                                     04340000
043500         INCLUDE SQLCA                                            04350000
043600     END-EXEC.                                                    04360000
043700/                                                                 04370000
043800*---------------------------------------------------------------- 04380000
043900*    CURSOR DECLARATIONS                                          04390000
044000*---------------------------------------------------------------- 04400000
044100*---------------------------------------------------------------- 04410000
044200* INVOICE_CSR RETURNS ALL EXPENSE AND MERCHANDISE INVOICES WHICH  04420000
044300* HAVE NOT BEEN REVERSED.                                         04430000
044400*---------------------------------------------------------------- 04440000
044500     EXEC SQL                                                     04450000
044600         DECLARE INVOICE_CSR CURSOR FOR                           04460000
044700           SELECT                                                 04470000
044800                 INVC_ID                                          04480000
044900                ,INVC_TYP_CDE                                     04490000
045000                ,GRO_COST_AMT                                     04500000
045100                ,INVC_NET_COST_AMT                                04510000
045200                ,RMIT_VND_ID                                      04520000
045300             FROM                                                 04530000
045400                 TINVOIC                                          04540000
045500             WHERE  PO_NBR           = :PV-PO-NBR                 04550000
045600               AND  STATUS_CDE IN ('OP','PD','RL')                04560000
045700               AND  PPD_RVRSL_IND   IN ('N',' ')                  04570000
045800     END-EXEC.                                                    04580000
045900/                                                                 04590000
046000*---------------------------------------------------------------- 04600000
046100* ALW_CHRG_CSR RETRIEVES ALL CHARGES AND CORRESPONDING ACCOUNT    04610000
046200* NUMBERS, FOR AN EXPENSE INVOICE.                                04620000
046300*---------------------------------------------------------------- 04630000
046400     EXEC SQL                                                     04640000
046500       DECLARE ALW_CHRG_CSR CURSOR FOR                            04650000
046600         SELECT AC.ALW_CHRG_SEQ_NBR                               04660000
046700               ,AC.ALW_CHRG_AMT                                   04670000
046800               ,AT.ALW_CHRG_CDE                                   04680000
046900               ,AT.GL_ACCT_NBR                                    04690000
047000               ,AT.AUTO_RVRSL_IND                                 04700000
047100            FROM TALCHRG AC                                       04710000
047200                ,TACCTYP AT                                       04720000
047300            WHERE AC.PO_NBR       = :PV-PO-NBR                    04730000
047400             AND AC.INVC_ID       = :INVOIC-INVC-ID               04740000
047500             AND AC.ALW_CHRG_CDE  =  AT.ALW_CHRG_CDE              04750000
047600             AND :AP036-1ST-INVC-DTE BETWEEN AT.EFF_STRT_DTE      04760000
047700                                         AND AT.EFF_END_DTE       04770000
047800            ORDER BY ALW_CHRG_CDE                                 04780000
047900                    ,ALW_CHRG_SEQ_NBR                             04790000
048000     END-EXEC.                                                    04800000
048100/                                                                 04810000
048200*---------------------------------------------------------------- 04820000
048300* DISCOUNT_CSR RETRIEVES DISCOUNT PERCENTAGES FOR IMPORT          04830000
048400* INVOICES.                                                       04840000
048500*---------------------------------------------------------------- 04850000
048600     EXEC SQL                                                     04860000
048700         DECLARE DISCOUNT_CSR CURSOR FOR                          04870000
048800           SELECT                                                 04880000
048900                 ALW_CHRG_AMT                                     04890000
049000                ,ALW_CHRG_PCT                                     04900000
049100                ,ALW_CHRG_CDE                                     04910000
049200                ,ALW_CHRG_TYP_CDE                                 04920000
049300             FROM TALCHRG                                         04930000
049400             WHERE  PO_NBR           = :PV-PO-NBR                 04940000
049500               AND  INVC_ID          = :INVOIC-INVC-ID            04950000
049600               AND  ALW_CHRG_TYP_CDE = 'A'                        04960000
049700     END-EXEC.                                                    04970000
049800/                                                                 04980000
049900*---------------------------------------------------------------- 04990000
050000*  WORKING STORAGE AREA FOR DPKUT500                              05000000
050100*---------------------------------------------------------------- 05010000
050200     COPY DPWS500.                                                05020000
050300/                                                                 05030000
050400*---------------------------------------------------------------- 05040000
050500*  WORKING STORAGE AREA FOR APPD052                               05050000
050600*---------------------------------------------------------------- 05060000
050700     COPY APWS052.                                                05070000
050800/                                                                 05080000
050900*---------------------------------------------------------------- 05090000
051000*  ABEND DATA AREAS                                               05100000
051100*---------------------------------------------------------------- 05110000
051200 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          05120000
051300                                             COMP SYNC.           05130000
051400     88  AC-DB2-ERROR                        VALUE +4013.         05140000
051500     88  AC-DATE-ERROR                       VALUE +4019.         05150000
051600                                                                  05160000
051700                                                                  05170000
051800 01  ABEND-AREAS.                                                 05180000
051900     05  AA-ABEND-LIT            PIC  X(40)  VALUE                05190000
052000             '*****       ABEND'.                                 05200000
052100     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                05210000
052200             '*****   PROGRAM: APKUP050'.                         05220000
052300     05  AA-PARAGRAPH-LIT.                                        05230000
052400         10  FILLER              PIC  X(17)  VALUE                05240000
052500             '***** PARAGRAPH: '.                                 05250000
052600         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        05260000
052700     05  AA-MESSAGE-LINE.                                         05270000
052800         10  FILLER              PIC  X(06)  VALUE '*****'.       05280000
052900         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        05290000
053000     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                05300000
053100             '*****    DB2 ERROR'.                                05310000
053200     05  AA-DB2-OPERATION-LIT.                                    05320000
053300         10  FILLER              PIC  X(17)  VALUE                05330000
053400             '***** OPERATION: '.                                 05340000
053500         10  AA-DB2-OPERATION.                                    05350000
053600             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        05360000
053700             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        05370000
053800     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        05380000
053900     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        05390000
054000     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        05400000
054100                                                                  05410000
054200/                                                                 05420000
054300*---------------------------------------------------------------- 05430000
054400*  SQLCA FORMATTED MESSAGE AREA                                   05440000
054500*---------------------------------------------------------------- 05450000
054600     COPY DPWS004.                                                05460000
054700*                                                                 05470000
054800/                                                                 05480000
054900 01  FILLER                      PIC  X(35)  VALUE                05490000
055000     '**** END OF W/S ** APKUP050 ****'.                          05500000
055100 EJECT                                                            05510000
055200 PROCEDURE DIVISION.                                              05520000
055300                                                                  05530000
055400     PERFORM A100-MAINLINE.                                       05540000
055500     GOBACK.                                                      05550000
055600                                                                  05560000
055700 EJECT                                                            05570000
055800 A100-MAINLINE.                                                   05580000
055900                                                                  05590000
056000     MOVE 'A100-MAINLINE' TO PV-CURRENT-PARAGRAPH.                05600000
056100                                                                  05610000
056200     PERFORM B100-INITIALIZE.                                     05620000
056300                                                                  05630000
056400     PERFORM B200-PROCESS-EXTRACT-FILE                            05640000
056500         UNTIL PS-END-EXTRACT.                                    05650000
056600                                                                  05660000
056700     PERFORM B300-END-OF-PROGRAM.                                 05670000
056800                                                                  05680000
056900 EJECT                                                            05690000
057000*---------------------------------------------------------------- 05700000
057100*    INITIALIZATION PROCESSING                                    05710000
057200*---------------------------------------------------------------- 05720000
057300 B100-INITIALIZE.                                                 05730000
057400                                                                  05740000
057500     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              05750000
057600                                                                  05760000
057700     DISPLAY 'EXECUTING PROGRAM: ' PC-PROGRAM-NAME.               05770000
057800                                                                  05780000
057900     OPEN INPUT  IMPORT-PO-VARIANCE-FILE.                         05790000
058000                                                                  05800000
058100     INITIALIZE DCLTAPCNTL                                        05810000
058200                DCLTINVOIC                                        05820000
058300                DCLTALCHRG                                        05830000
058400                DCLTACCTYP                                        05840000
058500                DCLTOUTAP1                                        05850000
058600                DCLTMDINVC.                                       05860000
058700                                                                  05870000
058800     INITIALIZE PS-PROGRAM-SWITCHES.                              05880000
058900                                                                  05890000
059000     PERFORM S100-SELECT-AP-CONTROL.                              05900000
059100     MOVE APCNTL-BTCH-PRC-DTE    TO PV-CURRENT-DATE               05910000
059200                                    PV-BTCH-DTE.                  05920000
059300                                                                  05930000
059400     MOVE '65' TO PV-AP-65-TRN-CDE.                               05940000
059500     PERFORM S600-SELECT-65-TRAN-CODE.                            05950000
059600                                                                  05960000
059700     MOVE '73' TO PV-AP-73-TRN-CDE.                               05970000
059800     PERFORM S700-SELECT-73-TRAN-CODE.                            05980000
059900                                                                  05990000
060000     PERFORM R400-GET-CHECKPOINT-CNTL.                            06000000
060100     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    06010000
060200                                                                  06020000
060300     IF RESTART-RUN                                               06030000
060400         PERFORM H200-CHECKPOINT-RESTART                          06040000
060500     ELSE                                                         06050000
060600         PERFORM R300-READ-EXTRACT-FILE                           06060000
060700     END-IF.                                                      06070000
060800                                                                  06080000
060900 EJECT                                                            06090000
061000*---------------------------------------------------------------- 06100000
061100*    CONTROLS THE PROCESSING OF THE IMPORT PO EXTRACT FILE        06110000
061200*      -CALCULATE THE PERCENTAGE RECEIVED                         06120000
061300*      -FETCH ALL INVOICES FOR PO BEING PROCESSED                 06130000
061400*---------------------------------------------------------------- 06140000
061500 B200-PROCESS-EXTRACT-FILE.                                       06150000
061600                                                                  06160000
061700     MOVE 'B200-PROCESS-EXTRACT-FILE' TO                          06170000
061800                             PV-CURRENT-PARAGRAPH.                06180000
061900                                                                  06190000
062000     SET PS-MORE-INVOICES TO TRUE.                                06200000
062100     PERFORM X100-OPEN-INVOICE-CSR.                               06210000
062200     PERFORM R100-FETCH-INVOICES.                                 06220000
062300                                                                  06230000
062400     PERFORM C100-PROCESS-INVOICES                                06240000
062500         UNTIL PS-END-INVOICES.                                   06250000
062600                                                                  06260000
062700     PERFORM Y100-CLOSE-INVOICE-CSR.                              06270000
062800                                                                  06280000
062900     ADD 1 TO PV-IMP-EXT-COUNT.                                   06290000
063000     PERFORM H100-CHECKPOINT-COMMIT.                              06300000
063100     PERFORM R300-READ-EXTRACT-FILE.                              06310000
063200                                                                  06320000
063300 EJECT                                                            06330000
063400*---------------------------------------------------------------- 06340000
063500*    END OF PROGRAM                                               06350000
063600*---------------------------------------------------------------- 06360000
063700 B300-END-OF-PROGRAM.                                             06370000
063800                                                                  06380000
063900     DISPLAY 'NBR OF IMPORT-EXTRACT-RECORDS = ' PV-IMP-EXT-COUNT. 06390000
064000     DISPLAY 'NBR OF INVOICES PROCESSED     = ' PV-INVOICE-COUNT. 06400000
064100     DISPLAY 'NBR OF CH TRANS CREATED       = ' PV-CH-TRAN-COUNT. 06410000
064200     DISPLAY 'NBR OF CR TRANS CREATED       = ' PV-CR-TRAN-COUNT. 06420000
064300     DISPLAY 'NBR OF TINVOIC UPDATES        = '                   06430000
064400                              PV-TINVOIC-UPDATE-COUNT.            06440000
064500                                                                  06450000
064600     CLOSE IMPORT-PO-VARIANCE-FILE.                               06460000
064700                                                                  06470000
064800     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              06480000
064900     PERFORM U500-UPDATE-TCKRSTCNTL.                              06490000
065000     PERFORM U700-COMMIT.                                         06500000
065100                                                                  06510000
065200 EJECT                                                            06520000
065300*---------------------------------------------------------------- 06530000
065400*    CONTROLS THE PROCESSING OF REVERSING IMPORT INVOICE AMTS     06540000
065500*    MERCHANDISE INVOICE                                          06550000
065600*      SELECT MERCHANDISE INVOICE                                 06560000
065700*      USE GROSS COST AMONT AS ORIGINAL POSTING AMOUNT            06570000
065800*      SELECT ACCOUNT TYPE                                        06580000
065900*      SUM PRIOR REVERSALS FOR FIRST COST                         06590000
066000*      CALCULATE THE NEW REVERSAL AMOUNT                          06600000
066100*      INSERT NEW REVERSAL AMOUNT                                 06610000
066200*      CREATE CR & CH (APRD045) TRANSACTIONS                      06620000
066300*      INSERT APTRAN RECORDS                                      06630000
066400*      CHECK REVERSALS = ORIGINAL POSTING AMOUNT UPDATE TINVOIC   06640000
066500*    EXPENSE INVOICE                                              06650000
066600*      FETCH ALL CHARGES & SUM CHARGE AMOUNT AS ORIGINAL POSTING  06660000
066700*      SUM ALL REVERSALS                                          06670000
066800*      REVERSALS = TOTAL POSTING UPDATE TINVOIC                   06680000
066900*---------------------------------------------------------------- 06690000
067000 C100-PROCESS-INVOICES.                                           06700000
067100                                                                  06710000
067200     MOVE 'C100-PROCESS-INVOICES' TO PV-CURRENT-PARAGRAPH.        06720000
067300                                                                  06730000
067400     IF INVOIC-INVC-TYP-CDE = 'MI'                                06740000
067500         PERFORM S200-GET-MERCHANDISE-INVOICE                     06750000
067600         MOVE MDINVC-IMPRT-CHRG-PRC-CDE TO PV-IMPRT-CHRG-PRC-CDE  06760000
067700         IF IMPRT-CHRG-PRC-CDE-VALID                              06770000
067800             PERFORM D200-GET-DISCOUNT-AMTS                       06780000
067900             MOVE INVOIC-GRO-COST-AMT      TO PV-ORIGINAL-POSTING 06790000
068000             PERFORM S300-SELECT-TACCTYP                          06800000
068100             MOVE MDINVC-IMPRT-CHRG-PRC-CDE TO PV-CHRG-CDE        06810000
068200             MOVE ACCTYP-GL-ACCT-NBR  TO PV-GL-ACCT-NBR           06820000
068300* THE FOLLOWING LOGIC WAS ADDED TO ALLOW CREATION OF MULTIPLE     06830001
068301* DISTRIB LINES WHEN THE TOTAL COST ON THE MI IS OVER $10 MILLION.06830101
068302* THE FIELD ON THE DETAIL RECORD ISN'T LARGE ENOUGH TO HOLD THAT  06830201
068303* AMOUNT.                                                         06830301
068304             PERFORM UNTIL PV-ORIGINAL-POSTING = 0                06830401
068305                IF PV-ORIGINAL-POSTING >  PC-DISTRIB-LINE-LIMIT   06830501
068307                   MOVE PC-DISTRIB-LINE-LIMIT TO PV-NEW-REVERSAL  06830704
068308                   SUBTRACT PC-DISTRIB-LINE-LIMIT                 06830804
068309                       FROM PV-ORIGINAL-POSTING                   06830904
068310                   ADD 1 TO PV-SUFFIX-COUNT                       06831004
068311                   MOVE PV-SUFFIX-COUNT TO PV-SUFFIX-2-CNT        06831104
068312                   MOVE '/'             TO PV-SUFFIX-2-SLASH      06831204
068313                   PERFORM F100-CREATE-CR-TRANS                   06831306
068314                   PERFORM F200-CREATE-CH-TRANS                   06831406
068315                ELSE                                              06831501
068316                   MOVE PV-ORIGINAL-POSTING TO PV-NEW-REVERSAL    06831601
068317                   MOVE SPACES TO PV-SUFFIX-2                     06831706
068318                   PERFORM F100-CREATE-CR-TRANS                   06831806
068319                   PERFORM F200-CREATE-CH-TRANS                   06831906
068320                   MOVE ZERO TO PV-ORIGINAL-POSTING               06832001
068321                                PV-SUFFIX-COUNT                   06832104
068330                END-IF                                            06833000
068510             END-PERFORM                                          06851000
068600             PERFORM X200-OPEN-CHARGE-CODE-CSR                    06860000
068700             SET PS-MORE-ALW-CHARGES TO TRUE                      06870000
068800             MOVE ZEROS TO PV-ORIGINAL-POSTING                    06880000
068900             PERFORM R200-FETCH-ALW-CHRG                          06890000
069000             MOVE ACCTYP-ALW-CHRG-CDE TO PV-CHRG-CDE              06900000
069100             MOVE ACCTYP-GL-ACCT-NBR  TO PV-GL-ACCT-NBR           06910000
069200             PERFORM D100-PROCESS-ALW-CHRG                        06920000
069300                UNTIL PS-END-ALW-CHARGES                          06930000
069400             PERFORM Y200-CLOSE-CHARGE-CODE-CSR                   06940000
069500             PERFORM U400-UPDATE-TINVOIC                          06950000
069600             ADD 1 TO PV-TINVOIC-UPDATE-COUNT                     06960000
069700         ELSE                                                     06970000
069800             DISPLAY 'THIS CONTAINS AN INVALID IMPORT PRC CODE'   06980000
069900             DISPLAY 'PO ' PV-PO-NBR-9                            06990000
070000             DISPLAY 'INV ' INVOIC-INVC-ID                        07000000
070100         END-IF                                                   07010000
070200     END-IF.                                                      07020000
070300                                                                  07030000
070400     IF INVOIC-INVC-TYP-CDE = 'EI'                                07040000
070500         PERFORM X200-OPEN-CHARGE-CODE-CSR                        07050000
070600         SET PS-MORE-ALW-CHARGES TO TRUE                          07060000
070700         MOVE ZEROS TO PV-ORIGINAL-POSTING                        07070000
070800         PERFORM R200-FETCH-ALW-CHRG                              07080000
070900         MOVE ACCTYP-ALW-CHRG-CDE TO PV-CHRG-CDE                  07090000
071000         MOVE ACCTYP-GL-ACCT-NBR  TO PV-GL-ACCT-NBR               07100000
071100         PERFORM D100-PROCESS-ALW-CHRG                            07110000
071200             UNTIL PS-END-ALW-CHARGES                             07120000
071300         PERFORM Y200-CLOSE-CHARGE-CODE-CSR                       07130000
071400         PERFORM U400-UPDATE-TINVOIC                              07140000
071500         ADD 1 TO PV-TINVOIC-UPDATE-COUNT                         07150000
071600     END-IF.                                                      07160000
071700                                                                  07170000
071800     PERFORM R100-FETCH-INVOICES.                                 07180000
071900                                                                  07190000
072000 EJECT                                                            07200000
072100*---------------------------------------------------------------- 07210000
072200*    PROCESS ALL CHARGES FOR AN EXPENSE OR MERCHANDISE INVOICE    07220000
072300*      SUM PRIOR REVERSALS FOR FIRST COST                         07230000
072400*      CALCULATE THE NEW REVERSAL AMOUNT                          07240000
072500*      INSERT NEW REVERSAL AMOUNT                                 07250000
072600*      CREATE CR & CH (APRD045) TRANSACTIONS                      07260000
072700*      INSERT APRD045 RECORDS                                     07270000
072800*---------------------------------------------------------------- 07280000
072900 D100-PROCESS-ALW-CHRG.                                           07290000
073000                                                                  07300000
073100     MOVE 'D100-PROCESS-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.        07310000
073200                                                                  07320000
073300     IF ACCTYP-AUTO-RVRSL-IND = 'N'                               07330000
073400        PERFORM R200-FETCH-ALW-CHRG                               07340000
073500     ELSE                                                         07350000
073600        PERFORM UNTIL PS-END-ALW-CHARGES OR                       07360000
073700          NOT (ACCTYP-ALW-CHRG-CDE = PV-CHRG-CDE)                 07370000
073800           MOVE ALCHRG-ALW-CHRG-AMT     TO PV-ORIGINAL-POSTING    07380000
073900           MOVE ACCTYP-ALW-CHRG-CDE     TO PV-CHRG-CDE            07390000
074000           MOVE ACCTYP-GL-ACCT-NBR      TO PV-GL-ACCT-NBR         07400000
074100           MOVE PV-ORIGINAL-POSTING TO PV-NEW-REVERSAL            07410000
074200           ADD PV-NEW-REVERSAL TO PV-NEW-REVERSAL-ACCUM           07420000
074300           PERFORM R200-FETCH-ALW-CHRG                            07430000
074400        END-PERFORM                                               07440000
074500        SET PS-ALW-CHRG-TRANS TO TRUE                             07450000
074600        MOVE PV-NEW-REVERSAL-ACCUM TO PV-TOTAL-NEW-REVERSAL       07460000
074610        MOVE SPACES TO PV-SUFFIX-2                                07461007
074700        PERFORM F100-CREATE-CR-TRANS                              07470000
074800        PERFORM F200-CREATE-CH-TRANS                              07480000
074900     END-IF.                                                      07490000
075000                                                                  07500000
075100     SET  PS-NON-ALW-CHRG-TRANS TO TRUE.                          07510000
075200     MOVE ZEROS TO PV-ORIGINAL-POSTING.                           07520000
075300     MOVE ZEROS TO PV-TOTAL-NEW-REVERSAL.                         07530000
075400     MOVE ZEROS TO PV-NEW-REVERSAL-ACCUM.                         07540000
075500     MOVE ACCTYP-ALW-CHRG-CDE TO PV-CHRG-CDE.                     07550000
075600     MOVE ACCTYP-GL-ACCT-NBR  TO PV-GL-ACCT-NBR.                  07560000
075700                                                                  07570000
075800 EJECT                                                            07580000
075900*---------------------------------------------------------------- 07590000
076000*  ACCUMULATE THE DISCOUNT AMOUNTS FOR EACH INVOICE.              07600000
076100*---------------------------------------------------------------- 07610000
076200 D200-GET-DISCOUNT-AMTS.                                          07620000
076300                                                                  07630000
076400     SET PS-MORE-IMPORT-DISCOUNTS TO TRUE.                        07640000
076500                                                                  07650000
076600     PERFORM X300-OPEN-IMPORT-DISCOUNT-CSR.                       07660000
076700     PERFORM R600-FETCH-IMPORT-DISCOUNTS.                         07670000
076800                                                                  07680000
076900     INITIALIZE APPD052-VARIABLES.                                07690000
077000     MOVE INVOIC-GRO-COST-AMT TO APPD052-GROSS-INVOICE-COST.      07700000
077100                                                                  07710000
077200     PERFORM WITH TEST BEFORE                                     07720000
077300       UNTIL PS-END-OF-IMPORT-DISCOUNTS                           07730000
077400         PERFORM CALC-ALW-CHRG                                    07740000
077500         PERFORM R600-FETCH-IMPORT-DISCOUNTS                      07750000
077600     END-PERFORM.                                                 07760000
077700                                                                  07770000
077800     SUBTRACT APPD052-ALLOWANCE-AMT FROM INVOIC-GRO-COST-AMT.     07780000
077900                                                                  07790000
078000     PERFORM Y300-CLOSE-IMPORT-DISCOUNT-CSR.                      07800000
078100                                                                  07810000
078200     COPY APPD052.                                                07820000
078300                                                                  07830000
078400     EJECT                                                        07840000
078500*---------------------------------------------------------------- 07850000
078600*  CREATE 'DEBIT MEMO' FOR NEW REVERSAL AMOUNT                    07860000
078700*---------------------------------------------------------------- 07870000
078800 F100-CREATE-CR-TRANS.                                            07880000
078900                                                                  07890000
079000     MOVE 'F100-CREATE-CR-TRANS' TO PV-CURRENT-PARAGRAPH.         07900000
079100                                                                  07910000
079200     INITIALIZE AP045-TRANSACTION-FILE.                           07920000
079300     INITIALIZE AP045-DETAIL-FIELDS.                              07930000
079400                                                                  07940000
079500     MOVE '65'                       TO AP045-AP-TRN-CDE.         07950000
079600     SET AP045-DETAIL-RECORD         TO TRUE.                     07960000
079700     MOVE AP036-VENDOR-NBR           TO AP045-VND-NBR.            07970000
079800     MOVE PV-PSTG-TYP-CDE-65         TO AP045-PSTG-TYP-CDE.       07980000
079900     MOVE PV-TRN-TYP-CDE-65          TO AP045-TRN-TYP-CDE.        07990000
080000                                                                  08000000
080100     PERFORM G200-FORMAT-DOC-NO.                                  08010000
080200                                                                  08020000
080300     MOVE PV-BTCH-DTE                TO AP045-PS-BTCH-DTE.        08030000
080400     MOVE PV-BTCH-SRC-CDE-65         TO AP045-PS-BTCH-SRC-CDE.    08040000
080500     MOVE '00'                       TO AP045-PS-BTCH-SEQ-NBR.    08050000
080600     MOVE PC-STORNO                  TO AP045-STR-NBR.            08060000
080700     MOVE AP036-PO-NBR               TO AP045-PO-NBR.             08070000
080800     MOVE SPACES                     TO AP045-DEPT-NBR.           08080000
080900                                                                  08090000
081000     IF PV-GL-ACCT-NBR-65 = SPACES                                08100000
081100        MOVE PV-GL-ACCT-NBR          TO AP045-GL-ACCT-NBR         08110000
081200     ELSE                                                         08120000
081300        MOVE PV-GL-ACCT-NBR-65       TO AP045-GL-ACCT-NBR         08130000
081400     END-IF.                                                      08140000
081500                                                                  08150000
081600     MOVE PV-CURRENT-DATE            TO AP045-DOC-DTE.            08160000
081700                                                                  08170000
081800     MOVE 'APKUP050'                 TO AP045-ENTR-ID.            08180000
081900     SET AP045-ORGN-IMPORT           TO TRUE.                     08190000
082000     MOVE PV-CURRENT-DATE            TO AP045-ENTR-DTE.           08200000
082100     ACCEPT PV-TIME-OF-DAY           FROM TIME.                   08210000
082200     MOVE PV-DAY-HOUR                TO PV-TIME-HOUR.             08220000
082300     MOVE PV-DAY-MINUTE              TO PV-TIME-MINUTE.           08230000
082400     MOVE PV-DAY-SECOND              TO PV-TIME-SECOND.           08240000
082500     MOVE PV-TIME                    TO AP045-ENTR-TME.           08250000
082600     MOVE SPACES                     TO AP045-BAR-CDE.            08260000
082700     MOVE AP036-VENDOR-NAME          TO AP045-ENT-NME-DESC.       08270000
082800     PERFORM S800-GET-VENDOR-ID.                                  08280000
082900     MOVE EXTENT-ENT-ID              TO AP045-ENT-ID.             08290000
083000     MOVE PV-CURRENT-DATE            TO AP045-INV-CUTOFF-DTE.     08300000
083100     MOVE APCNTL-CURR-PSTG-FYR-NBR   TO AP045-PSTG-FYR-NBR.       08310000
083200     MOVE APCNTL-CURR-PSTG-FMN-NBR   TO AP045-PSTG-FMN-NBR.       08320000
083300     MOVE APCNTL-CURR-PSTG-FWK-NBR   TO AP045-PSTG-FWK-NBR.       08330000
083400                                                                  08340000
083500     IF PS-ALW-CHRG-TRANS                                         08350000
083600        MOVE PV-TOTAL-NEW-REVERSAL   TO AP045-GRO-COST-AMT        08360000
083700     ELSE                                                         08370000
083800        MOVE PV-NEW-REVERSAL         TO AP045-GRO-COST-AMT        08380000
083900     END-IF                                                       08390000
084000                                                                  08400000
084100     MOVE AP045-GRO-COST-AMT         TO AP045-NET-COST-AMT.       08410000
084200     MOVE ZEROS                      TO AP045-TERM-DISC-PCT       08420000
084300                                        AP045-NW-STR-DISC-PCT     08430000
084400                                        AP045-TRD-DISC-PCT        08440000
084500                                        AP045-FRGT-AMT            08450000
084600                                        AP045-MISC-CHRG-AMT       08460000
084700                                        AP045-MOS-DISC-PCT.       08470000
084800                                                                  08480000
084900     IF AP045-CREDIT                                              08490000
085000        IF AP045-NET-COST-AMT > 0                                 08500000
085100           MULTIPLY -1 BY AP045-NET-COST-AMT                      08510000
085200        END-IF                                                    08520000
085300        IF AP045-GRO-COST-AMT > 0                                 08530000
085400           MULTIPLY -1 BY AP045-GRO-COST-AMT                      08540000
085500        END-IF                                                    08550000
085600     END-IF.                                                      08560000
085700                                                                  08570000
085800* PC-AP045-LEN MUST REFLECT ANY RECORD LENGTH CHANGES IN APRD045. 08580000
085900     MOVE PC-AP045-LEN               TO OUTAP1-AJ-TRAN-ODR-LEN.   08590000
086000     MOVE AP045-TRANSACTION-FILE     TO OUTAP1-AJ-TRAN-ODR-TEXT.  08600000
086100     ADD 1 TO PV-CR-TRAN-COUNT.                                   08610000
086200     PERFORM U300-INSERT-TRANS-RECORDS.                           08620000
086300                                                                  08630000
086400 EJECT                                                            08640000
086500*---------------------------------------------------------------- 08650000
086600*  CREATE IMPORT CLEARING ACOUNT CHARGE FOR THE REVERSAL AMOUNT   08660000
086700*---------------------------------------------------------------- 08670000
086800 F200-CREATE-CH-TRANS.                                            08680000
086900                                                                  08690000
087000     MOVE 'F200-CREATE-CH-TRANS'     TO PV-CURRENT-PARAGRAPH.     08700000
087100                                                                  08710000
087200     MOVE '73'                       TO AP045-AP-TRN-CDE.         08720000
087300     SET AP045-DETAIL-RECORD         TO TRUE.                     08730000
087400     MOVE PV-TRN-TYP-CDE-73          TO AP045-TRN-TYP-CDE.        08740000
087500     MOVE PV-PSTG-TYP-CDE-73         TO AP045-PSTG-TYP-CDE.       08750000
087600                                                                  08760000
087700     IF PV-GL-ACCT-NBR-73 = ' '                                   08770000
087800        MOVE ACCTYP-GL-ACCT-NBR      TO AP045-GL-ACCT-NBR         08780000
087900     ELSE                                                         08790000
088000        MOVE PV-GL-ACCT-NBR-73       TO AP045-GL-ACCT-NBR         08800000
088100     END-IF.                                                      08810000
088200                                                                  08820000
088300     SET AP045-ORGN-IMPORT           TO TRUE.                     08830000
088400     MOVE PV-BTCH-DTE                TO AP045-PS-BTCH-DTE.        08840000
088500     MOVE PV-BTCH-SRC-CDE-73         TO AP045-PS-BTCH-SRC-CDE.    08850000
088600     MOVE '00'                       TO AP045-PS-BTCH-SEQ-NBR.    08860000
088700     MOVE APCNTL-CURR-PSTG-FYR-NBR   TO AP045-PSTG-FYR-NBR.       08870000
088800     MOVE APCNTL-CURR-PSTG-FMN-NBR   TO AP045-PSTG-FMN-NBR.       08880000
088900     MOVE APCNTL-CURR-PSTG-FWK-NBR   TO AP045-PSTG-FWK-NBR.       08890000
089000                                                                  08900000
089100     IF PS-ALW-CHRG-TRANS                                         08910000
089200        MOVE PV-TOTAL-NEW-REVERSAL   TO AP045-GRO-COST-AMT        08920000
089300     ELSE                                                         08930000
089400        MOVE PV-NEW-REVERSAL         TO AP045-GRO-COST-AMT        08940000
089500     END-IF                                                       08950000
089600                                                                  08960000
089700     MOVE AP045-GRO-COST-AMT         TO AP045-NET-COST-AMT.       08970000
089800     MOVE ZEROS                      TO AP045-TERM-DISC-PCT       08980000
089900                                        AP045-NW-STR-DISC-PCT     08990000
090000                                        AP045-TRD-DISC-PCT        09000000
090100                                        AP045-FRGT-AMT            09010000
090200                                        AP045-MISC-CHRG-AMT       09020000
090300                                        AP045-MOS-DISC-PCT.       09030000
090400                                                                  09040000
090500     IF AP045-CREDIT                                              09050000
090600        IF AP045-NET-COST-AMT > 0                                 09060000
090700           MULTIPLY -1 BY AP045-NET-COST-AMT                      09070000
090800        END-IF                                                    09080000
090900        IF AP045-GRO-COST-AMT > 0                                 09090000
091000           MULTIPLY -1 BY AP045-GRO-COST-AMT                      09100000
091100        END-IF                                                    09110000
091200     END-IF.                                                      09120000
091300                                                                  09130000
091400* PC-AP045-LEN MUST REFLECT ANY RECORD LENGTH CHANGES IN APRD045. 09140000
091500     MOVE PC-AP045-LEN               TO OUTAP1-AJ-TRAN-ODR-LEN.   09150000
091600     MOVE AP045-TRANSACTION-FILE     TO OUTAP1-AJ-TRAN-ODR-TEXT.  09160000
091700     ADD 1                           TO PV-CH-TRAN-COUNT.         09170000
091800     PERFORM U300-INSERT-TRANS-RECORDS.                           09180000
091900                                                                  09190000
092000 EJECT                                                            09200000
092100*---------------------------------------------------------------- 09210000
092200*  THIS PARAGRAPH FORMATS THE INVOICE ID TO BE THE PJ DOC NUMBER. 09220000
092300*---------------------------------------------------------------- 09230000
092400 G200-FORMAT-DOC-NO.                                              09240000
092500                                                                  09250000
092600     MOVE ZEROES                  TO PV-START PV-START2.          09260000
092700     MOVE SPACES                  TO PV-STRING.                   09270000
092800     MOVE INVOIC-INVC-ID          TO PV-STRING.                   09280000
092900     MOVE LENGTH OF PV-STRING     TO PV-START.                    09290000
093000                                                                  09300000
093100     PERFORM                                                      09310000
093200        UNTIL PV-STRING(PV-START:1) > SPACES OR                   09320000
093300              PV-START = +0                                       09330000
093400        COMPUTE PV-START = PV-START - 1                           09340000
093500     END-PERFORM.                                                 09350000
093600                                                                  09360000
093700     MOVE PV-START TO PV-START2.                                  09370000
093800                                                                  09380000
093900     IF PV-START < 13                                             09390000
094000        MOVE +1 TO PV-START                                       09400000
094100     ELSE                                                         09410000
094200        SUBTRACT +12 FROM PV-START                                09420000
094300     END-IF.                                                      09430000
094400                                                                  09440000
094500     IF PV-START2 = 22                                            09450000
094600        COMPUTE PV-START2 = PV-START2 - 9                         09460000
094700     END-IF.                                                      09470000
094800     IF PV-START2 = 21                                            09480000
094900        COMPUTE PV-START2 = PV-START2 - 8                         09490000
095000     END-IF.                                                      09500000
095100     IF PV-START2 = 20                                            09510000
095200        COMPUTE PV-START2 = PV-START2 - 7                         09520000
095300     END-IF.                                                      09530000
095400     IF PV-START2 = 19                                            09540000
095500        COMPUTE PV-START2 = PV-START2 - 6                         09550000
095600     END-IF.                                                      09560000
095700     IF PV-START2 = 18                                            09570000
095800        COMPUTE PV-START2 = PV-START2 - 5                         09580000
095900     END-IF.                                                      09590000
096000     IF PV-START2 = 17                                            09600000
096100        COMPUTE PV-START2 = PV-START2 - 4                         09610000
096200     END-IF.                                                      09620000
096300     IF PV-START2 = 16                                            09630000
096400        COMPUTE PV-START2 = PV-START2 - 3                         09640000
096500     END-IF.                                                      09650000
096600     IF PV-START2 = 15                                            09660000
096700        COMPUTE PV-START2 = PV-START2 - 2                         09670000
096800     END-IF.                                                      09680000
096900     IF PV-START2 = 14                                            09690000
097000        COMPUTE PV-START2 = PV-START2 - 1                         09700000
097100     END-IF.                                                      09710000
097200                                                                  09720000
097300     MOVE PV-STRING(PV-START:PV-START2) TO AP045-DOC-NBR.         09730000
097400     MOVE PV-CHRG-CDE TO AP045-DOC-NBR(PV-START2 + 1:3).          09740000
097410     MOVE PV-SUFFIX-2 TO AP045-DOC-NBR(PV-START2 + 4:2).          09741004
097500                                                                  09750000
097600*    MOVE PV-STRING(PV-START:13)  TO PV-INVOICE                   09760000
097700                                                                  09770000
097800*    STRING PV-INVOICE        DELIMITED BY SPACE                  09780000
097900*           PV-CHRG-CDE       DELIMITED BY SIZE                   09790000
098000*           INTO AP045-DOC-NBR.                                   09800000
098100                                                                  09810000
098200 EJECT                                                            09820000
098300*----------------------------------------------------------------*09830000
098400*    DO THE CHECKPOINT RESTART AND THE COMMIT.                   *09840000
098500*----------------------------------------------------------------*09850000
098600 H100-CHECKPOINT-COMMIT.                                          09860000
098700                                                                  09870000
098800     MOVE 'H100-CHECKPOINT-COMMIT' TO PV-CURRENT-PARAGRAPH.       09880000
098900                                                                  09890000
099000     EXEC SQL                                                     09900000
099100       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      09910000
099200     END-EXEC.                                                    09920000
099300                                                                  09930000
099400     EVALUATE TRUE                                                09940000
099500         WHEN SQLCODE = ZERO                                      09950000
099600              CONTINUE                                            09960000
099700                                                                  09970000
099800        WHEN SQLWARN0 NOT = SPACES                                09980000
099900        WHEN SQLCODE  NOT = ZERO                                  09990000
100000            MOVE 'UNSUCCESSFUL SET TMST'                          10000000
100100                                TO AA-DB2-OPERATION               10010000
100200            PERFORM Z999-DB2-ABEND                                10020000
100300     END-EVALUATE.                                                10030000
100400                                                                  10040000
100500     IF CR-CURR-TMST > CR-NEXT-TMST                               10050000
100600        MOVE PC-IN-PROCESS-CODE      TO PV-CKPT-STAT-CODE         10060000
100700        PERFORM U500-UPDATE-TCKRSTCNTL                            10070000
100800        PERFORM U600-UPDATE-TCKRSTINF                             10080000
100900        PERFORM U700-COMMIT                                       10090000
101000                                                                  10100000
101100        EXEC SQL                                                  10110000
101200         SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)     10120000
101300          INTO :CR-NEXT-TMST                                      10130000
101400          FROM TCKRSTCNTL                                         10140000
101500          WHERE PLAN_NAME = :PC-PROGRAM-NAME                      10150000
101600        END-EXEC                                                  10160000
101700                                                                  10170000
101800          EVALUATE TRUE                                           10180000
101900              WHEN SQLCODE = ZERO                                 10190000
102000                   CONTINUE                                       10200000
102100                                                                  10210000
102200          WHEN SQLWARN0 NOT = SPACES                              10220000
102300          WHEN SQLCODE  NOT = ZERO                                10230000
102400              MOVE 'UNSUCCESSFUL NEXT TMST'                       10240000
102500                                  TO AA-DB2-OPERATION             10250000
102600              PERFORM Z999-DB2-ABEND                              10260000
102700       END-EVALUATE                                               10270000
102800     END-IF.                                                      10280000
102900                                                                  10290000
103000*----------------------------------------------------------------*10300000
103100*    GET THE RESTART INFO                                        *10310000
103200*----------------------------------------------------------------*10320000
103300 H200-CHECKPOINT-RESTART.                                         10330000
103400                                                                  10340000
103500     MOVE 'H200-CHECKPOINT-RESTART' TO PV-CURRENT-PARAGRAPH.      10350000
103600                                                                  10360000
103700     PERFORM R500-GET-CHECKPOINT-INFO.                            10370000
103800                                                                  10380000
103900     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     10390000
104000                                                                  10400000
104100     PERFORM R300-READ-EXTRACT-FILE                               10410000
104200        WITH TEST AFTER                                           10420000
104300             UNTIL PS-END-EXTRACT                                 10430000
104400               OR (AP036-PO-NBR > CR-PO-NBR).                     10440000
104500                                                                  10450000
104600     DISPLAY '***********************************************'.   10460000
104700     DISPLAY '** APKUP050 CHECKPOINT RESTART **'                  10470000
104800     DISPLAY '** PO NUMBER ON RESTART = '  AP036-PO-NBR.          10480000
104900     DISPLAY '***********************************************'.   10490000
105000                                                                  10500000
105100     MOVE ZEROS                   TO PV-IMP-EXT-COUNT             10510000
105200                                     PV-INVOICE-COUNT             10520000
105300                                     PV-CH-TRAN-COUNT             10530000
105400                                     PV-CR-TRAN-COUNT             10540000
105500                                     PV-TINVOIC-UPDATE-COUNT.     10550000
105600                                                                  10560000
105700     MOVE CR-IMP-EXT-COUNT        TO PV-IMP-EXT-COUNT.            10570000
105800     MOVE CR-INVOICE-COUNT        TO PV-INVOICE-COUNT.            10580000
105900     MOVE CR-CH-TRAN-COUNT        TO PV-CH-TRAN-COUNT.            10590000
106000     MOVE CR-CR-TRAN-COUNT        TO PV-CR-TRAN-COUNT.            10600000
106100     MOVE CR-TINVOIC-UPDATE-COUNT TO PV-TINVOIC-UPDATE-COUNT.     10610000
106200                                                                  10620000
106300*---------------------------------------------------------------- 10630000
106400*    FETCH ALL EXPENSE INVOICES                                   10640000
106500*---------------------------------------------------------------- 10650000
106600 R100-FETCH-INVOICES.                                             10660000
106700                                                                  10670000
106800     MOVE 'R100-FETCH-INVOICES' TO PV-CURRENT-PARAGRAPH.          10680000
106900                                                                  10690000
107000     EXEC SQL                                                     10700000
107100         FETCH INVOICE_CSR                                        10710000
107200         INTO :INVOIC-INVC-ID                                     10720000
107300             ,:INVOIC-INVC-TYP-CDE                                10730000
107400             ,:INVOIC-GRO-COST-AMT                                10740000
107500             ,:INVOIC-INVC-NET-COST-AMT                           10750000
107600             ,:INVOIC-RMIT-VND-ID                                 10760000
107700     END-EXEC.                                                    10770000
107800                                                                  10780000
107900     EVALUATE TRUE                                                10790000
108000         WHEN SQLCODE = ZERO                                      10800000
108100              ADD 1 TO PV-INVOICE-COUNT                           10810000
108200                                                                  10820000
108300         WHEN SQLCODE = +100                                      10830000
108400              SET PS-END-INVOICES TO TRUE                         10840000
108500                                                                  10850000
108600         WHEN SQLWARN0 NOT = SPACES                               10860000
108700         WHEN SQLCODE  NOT = ZERO                                 10870000
108800             MOVE PV-CURRENT-PARAGRAPH                            10880000
108900                                TO AA-PARAGRAPH-NAME              10890000
109000             MOVE 'BAD FETCH WITH INVOICE_CSR'                    10900000
109100                                TO AA-DB2-OPERATION               10910000
109200             MOVE 'TINVOIC'     TO AA-DB2-TABLE-1                 10920000
109300             MOVE SPACES        TO AA-DB2-TABLE-2                 10930000
109400                                   AA-DB2-TABLE-3                 10940000
109500             PERFORM Z999-DB2-ABEND                               10950000
109600     END-EVALUATE.                                                10960000
109700                                                                  10970000
109800 EJECT                                                            10980000
109900*---------------------------------------------------------------- 10990000
110000*    FETCH ALL CHARGES FOR EXPENSEE   ONDING ACCOUNT NUMBERS      11000000
110100*---------------------------------------------------------------- 11010000
110200 R200-FETCH-ALW-CHRG.                                             11020000
110300                                                                  11030000
110400     MOVE 'R200-FETCH-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.          11040000
110500                                                                  11050000
110600     EXEC SQL                                                     11060000
110700         FETCH ALW_CHRG_CSR                                       11070000
110800         INTO  :ALCHRG-ALW-CHRG-SEQ-NBR                           11080000
110900             , :ALCHRG-ALW-CHRG-AMT                               11090000
111000             , :ACCTYP-ALW-CHRG-CDE                               11100000
111100             , :ACCTYP-GL-ACCT-NBR                                11110000
111200             , :ACCTYP-AUTO-RVRSL-IND                             11120000
111300     END-EXEC.                                                    11130000
111400                                                                  11140000
111500     EVALUATE TRUE                                                11150000
111600         WHEN SQLCODE = ZERO                                      11160000
111700             CONTINUE                                             11170000
111800         WHEN SQLCODE = +100                                      11180000
111900             SET PS-END-ALW-CHARGES TO TRUE                       11190000
112000         WHEN SQLWARN0 NOT = SPACES                               11200000
112100         WHEN SQLCODE  NOT = ZERO                                 11210000
112200             MOVE PV-CURRENT-PARAGRAPH                            11220000
112300                                 TO AA-PARAGRAPH-NAME             11230000
112400             MOVE                                                 11240000
112500               'UNSUCCESSFUL FETCH WITH ALW_CHRG_CSR'             11250000
112600                                 TO AA-DB2-OPERATION              11260000
112700             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                11270000
112800             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                11280000
112900             MOVE SPACES         TO AA-DB2-TABLE-3                11290000
113000             PERFORM Z999-DB2-ABEND                               11300000
113100     END-EVALUATE.                                                11310000
113200                                                                  11320000
113300 EJECT                                                            11330000
113400*---------------------------------------------------------------- 11340000
113500*    READ THE IMPORT-PO-VARIANCE-FILE INTO COPYBOOK APRD033       11350000
113600*---------------------------------------------------------------- 11360000
113700 R300-READ-EXTRACT-FILE.                                          11370000
113800                                                                  11380000
113900     MOVE 'R300-READ-EXTRACT-FILE' TO                             11390000
114000                             PV-CURRENT-PARAGRAPH.                11400000
114100                                                                  11410000
114200     READ IMPORT-PO-VARIANCE-FILE INTO AP036-IMPORT-REPORT-RECORD 11420000
114300         AT END                                                   11430000
114400             SET PS-END-EXTRACT TO TRUE.                          11440000
114500                                                                  11450000
114600     MOVE AP036-PO-NBR TO PV-PO-NBR-9.                            11460000
114700     MOVE PV-PO-NBR-9  TO PV-PO-NBR.                              11470000
114800                                                                  11480000
114900 EJECT                                                            11490000
115000*----------------------------------------------------------------*11500000
115100*    SELECT CHECKPOINT RESTART CONTROL INFO.                     *11510000
115200*----------------------------------------------------------------*11520000
115300 R400-GET-CHECKPOINT-CNTL.                                        11530000
115400                                                                  11540000
115500     MOVE 'R400-GET-CHECKPOINT-CNTL' TO PV-CURRENT-PARAGRAPH.     11550000
115600                                                                  11560000
115700     PERFORM WITH TEST AFTER                                      11570000
115800             VARYING PC-RETRY-COUNT FROM 1 BY 1                   11580000
115900             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             11590000
116000                     SQLCODE = ZERO                               11600000
116100                                                                  11610000
116200             EXEC SQL                                             11620000
116300              SELECT CKPT_STAT_CODE                               11630000
116400               INTO :PV-CKPT-STAT-CODE                            11640000
116500               FROM TCKRSTCNTL                                    11650000
116600               WHERE PLAN_NAME = :PC-PROGRAM-NAME                 11660000
116700             END-EXEC                                             11670000
116800                                                                  11680000
116900             EVALUATE TRUE                                        11690000
117000                 WHEN SQLCODE = ZERO                              11700000
117100                 WHEN SQLCODE = -904                              11710000
117200                 WHEN SQLCODE = -913                              11720000
117300                      CONTINUE                                    11730000
117400                                                                  11740000
117500                 WHEN SQLWARN0 NOT = SPACES                       11750000
117600                 WHEN SQLCODE  NOT = ZERO                         11760000
117700                     MOVE PV-CURRENT-PARAGRAPH                    11770000
117800                                         TO AA-PARAGRAPH-NAME     11780000
117900                     DISPLAY '********   PROGRAM:'                11790000
118000                              PC-WS-PROGRAM                       11800000
118100                     MOVE 'UNSUCCESSFUL SELECT'                   11810000
118200                                         TO AA-DB2-OPERATION      11820000
118300                     MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1        11830000
118400                     MOVE SPACES         TO AA-DB2-TABLE-2        11840000
118500                                            AA-DB2-TABLE-3        11850000
118600                     PERFORM Z999-DB2-ABEND                       11860000
118700             END-EVALUATE                                         11870000
118800     END-PERFORM.                                                 11880000
118900                                                                  11890000
119000     IF PC-RETRY-COUNT > PC-RETRY-MAX                             11900000
119100         MOVE PV-CURRENT-PARAGRAPH                                11910000
119200                             TO AA-PARAGRAPH-NAME                 11920000
119300         DISPLAY '********   PROGRAM:'                            11930000
119400                  PC-PROGRAM-NAME                                 11940000
119500         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    11950000
119600                             TO AA-DB2-OPERATION                  11960000
119700         MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1                    11970000
119800         PERFORM Z999-DB2-ABEND                                   11980000
119900     END-IF.                                                      11990000
120000                                                                  12000000
120100 EJECT                                                            12010000
120200*----------------------------------------------------------------*12020000
120300*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO  *12030000
120400*----------------------------------------------------------------*12040000
120500 R500-GET-CHECKPOINT-INFO.                                        12050000
120600                                                                  12060000
120700     MOVE 'R500-GET-CHECKPOINT-INFO' TO PV-CURRENT-PARAGRAPH.     12070000
120800                                                                  12080000
120900     PERFORM WITH TEST AFTER                                      12090000
121000             VARYING PC-RETRY-COUNT FROM 1 BY 1                   12100000
121100             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             12110000
121200                     SQLCODE = ZERO                               12120000
121300                                                                  12130000
121400             EXEC SQL                                             12140000
121500              SELECT WORK_STRG_DESC                               12150000
121600               INTO :TCKRSTINF-WORK-STRG-DESC                     12160000
121700               FROM TCKRSTINF                                     12170000
121800               WHERE PLAN_NAME = :PC-PROGRAM-NAME                 12180000
121900             END-EXEC                                             12190000
122000                                                                  12200000
122100             EVALUATE TRUE                                        12210000
122200                 WHEN SQLCODE = ZERO                              12220000
122300                 WHEN SQLCODE = -904                              12230000
122400                 WHEN SQLCODE = -913                              12240000
122500                      CONTINUE                                    12250000
122600                                                                  12260000
122700                 WHEN SQLWARN0 NOT = SPACES                       12270000
122800                 WHEN SQLCODE  NOT = ZERO                         12280000
122900                     MOVE PV-CURRENT-PARAGRAPH                    12290000
123000                                         TO AA-PARAGRAPH-NAME     12300000
123100                     DISPLAY '********   PROGRAM:'                12310000
123200                              PC-PROGRAM-NAME                     12320000
123300                     MOVE 'UNSUCCESSFUL SELECT'                   12330000
123400                                         TO AA-DB2-OPERATION      12340000
123500                     MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1        12350000
123600                     MOVE SPACES         TO AA-DB2-TABLE-2        12360000
123700                                            AA-DB2-TABLE-3        12370000
123800                     PERFORM Z999-DB2-ABEND                       12380000
123900             END-EVALUATE                                         12390000
124000     END-PERFORM.                                                 12400000
124100                                                                  12410000
124200     IF PC-RETRY-COUNT > PC-RETRY-MAX                             12420000
124300         MOVE PV-CURRENT-PARAGRAPH                                12430000
124400                             TO AA-PARAGRAPH-NAME                 12440000
124500         DISPLAY '********   PROGRAM:'                            12450000
124600                  PC-PROGRAM-NAME                                 12460000
124700         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    12470000
124800                             TO AA-DB2-OPERATION                  12480000
124900         MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1                    12490000
125000         MOVE SPACES         TO AA-DB2-TABLE-2                    12500000
125100                                AA-DB2-TABLE-3                    12510000
125200         PERFORM Z999-DB2-ABEND                                   12520000
125300     END-IF.                                                      12530000
125400                                                                  12540000
125500 EJECT                                                            12550000
125600*---------------------------------------------------------------- 12560000
125700*    FETCH ALL IMPORT DISCOUNT RECORDS                            12570000
125800*---------------------------------------------------------------- 12580000
125900 R600-FETCH-IMPORT-DISCOUNTS.                                     12590000
126000                                                                  12600000
126100     MOVE 'R600-FETCH-IMPORT-DISCOUNTS' TO PV-CURRENT-PARAGRAPH.  12610000
126200                                                                  12620000
126300     EXEC SQL                                                     12630000
126400         FETCH DISCOUNT_CSR                                       12640000
126500         INTO :ALCHRG-ALW-CHRG-AMT                                12650000
126600            , :ALCHRG-ALW-CHRG-PCT                                12660000
126700            , :ALCHRG-ALW-CHRG-CDE                                12670000
126800            , :ALCHRG-ALW-CHRG-TYP-CDE                            12680000
126900     END-EXEC.                                                    12690000
127000                                                                  12700000
127100     EVALUATE TRUE                                                12710000
127200         WHEN SQLCODE = ZERO                                      12720000
127300              CONTINUE                                            12730000
127400                                                                  12740000
127500         WHEN SQLCODE = +100                                      12750000
127600              SET PS-END-OF-IMPORT-DISCOUNTS TO TRUE              12760000
127700                                                                  12770000
127800         WHEN SQLWARN0 NOT = SPACES                               12780000
127900         WHEN SQLCODE  NOT = ZERO                                 12790000
128000             MOVE PV-CURRENT-PARAGRAPH                            12800000
128100                                TO AA-PARAGRAPH-NAME              12810000
128200             MOVE 'BAD FETCH WITH DISCOUNT_CSR'                   12820000
128300                                TO AA-DB2-OPERATION               12830000
128400             MOVE 'TALCHRG'     TO AA-DB2-TABLE-1                 12840000
128500             MOVE SPACES        TO AA-DB2-TABLE-2                 12850000
128600                                   AA-DB2-TABLE-3                 12860000
128700             PERFORM Z999-DB2-ABEND                               12870000
128800     END-EVALUATE.                                                12880000
128900                                                                  12890000
129000 EJECT                                                            12900000
129100*---------------------------------------------------------------- 12910000
129200*    RETRIEVES THE BATCH DATE FROM THE AP CONTROL TABLE           12920000
129300*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   12930000
129400*           CALCULATION OF PAYMENT DUE DATE SO PROCESSING CANNOT  12940000
129500*           PROCEED AND THE PROGRAM MUST ABEND.                   12950000
129600*---------------------------------------------------------------- 12960000
129700 S100-SELECT-AP-CONTROL.                                          12970000
129800                                                                  12980000
129900     MOVE 'S100-SELECT-AP-CONTROL' TO PV-CURRENT-PARAGRAPH.       12990000
130000                                                                  13000000
130100     EXEC SQL                                                     13010000
130200         SELECT  BTCH_PRC_DTE                                     13020000
130300                ,CURR_PSTG_FYR_NBR                                13030000
130400                ,CURR_PSTG_FMN_NBR                                13040000
130500                ,CURR_PSTG_FWK_NBR                                13050000
130600         INTO    :APCNTL-BTCH-PRC-DTE                             13060000
130700                ,:APCNTL-CURR-PSTG-FYR-NBR                        13070000
130800                ,:APCNTL-CURR-PSTG-FMN-NBR                        13080000
130900                ,:APCNTL-CURR-PSTG-FWK-NBR                        13090000
131000         FROM TAPCNTL                                             13100000
131100     END-EXEC.                                                    13110000
131200                                                                  13120000
131300     EVALUATE TRUE                                                13130000
131400         WHEN SQLCODE = ZERO                                      13140000
131500              CONTINUE                                            13150000
131600                                                                  13160000
131700         WHEN SQLWARN0 NOT = SPACES                               13170000
131800         WHEN SQLCODE  NOT = ZERO                                 13180000
131900         MOVE PV-CURRENT-PARAGRAPH                                13190000
132000                            TO AA-PARAGRAPH-NAME                  13200000
132100         MOVE 'UNSUCCESSFUL SELECT OF PAYMENT CONTROL TBL'        13210000
132200                            TO AA-DB2-OPERATION                   13220000
132300         MOVE 'TAPCNTL'     TO AA-DB2-TABLE-1                     13230000
132400         MOVE SPACES        TO AA-DB2-TABLE-2                     13240000
132500                               AA-DB2-TABLE-3                     13250000
132600                                                                  13260000
132700         PERFORM Z999-DB2-ABEND                                   13270000
132800     END-EVALUATE.                                                13280000
132900                                                                  13290000
133000 EJECT                                                            13300000
133100*---------------------------------------------------------------- 13310000
133200*    SELECT THE MERCHANDISE INVOICE TABLE                         13320000
133300*      RETREIVES THE IMPORT CHARGE PRICE CODE                     13330000
133400*---------------------------------------------------------------- 13340000
133500 S200-GET-MERCHANDISE-INVOICE.                                    13350000
133600                                                                  13360000
133700     MOVE 'S200-GET-MERCHANDISE-INVOICE'                          13370000
133800                                 TO PV-CURRENT-PARAGRAPH.         13380000
133900                                                                  13390000
134000     EXEC SQL                                                     13400000
134100         SELECT                                                   13410000
134200             IMPRT_CHRG_PRC_CDE                                   13420000
134300         INTO                                                     13430000
134400             :MDINVC-IMPRT-CHRG-PRC-CDE                           13440000
134500         FROM TMDINVC                                             13450000
134600         WHERE PO_NBR  = :PV-PO-NBR                               13460000
134700           AND INVC_ID = :INVOIC-INVC-ID                          13470000
134800     END-EXEC.                                                    13480000
134900                                                                  13490000
135000     EVALUATE TRUE                                                13500000
135100         WHEN SQLCODE = ZERO                                      13510000
135200            CONTINUE                                              13520000
135300                                                                  13530000
135400         WHEN SQLCODE = +100                                      13540000
135500         WHEN SQLWARN0 NOT = SPACES                               13550000
135600         WHEN SQLCODE  NOT = ZERO                                 13560000
135700             MOVE PV-CURRENT-PARAGRAPH                            13570000
135800                                 TO AA-PARAGRAPH-NAME             13580000
135900             MOVE 'UNSUCCESSFUL SELECT FOR MERCH INVOICE'         13590000
136000                                 TO AA-DB2-OPERATION              13600000
136100             MOVE 'TMDINVC'      TO AA-DB2-TABLE-1                13610000
136200             MOVE SPACES         TO AA-DB2-TABLE-2                13620000
136300                                    AA-DB2-TABLE-3                13630000
136400             PERFORM Z999-DB2-ABEND                               13640000
136500     END-EVALUATE.                                                13650000
136600 EJECT                                                            13660000
136700*---------------------------------------------------------------- 13670000
136800*  SELECT TACCTYP FOR CHARGE CODE AND GL NUMBER                   13680000
136900*---------------------------------------------------------------- 13690000
137000 S300-SELECT-TACCTYP.                                             13700000
137100                                                                  13710000
137200     MOVE 'S300-SELECT-TACCTYP' TO PV-CURRENT-PARAGRAPH.          13720000
137300                                                                  13730000
137400     EXEC SQL                                                     13740000
137500         SELECT ALW_CHRG_CDE,                                     13750000
137600                GL_ACCT_NBR                                       13760000
137700         INTO   :ACCTYP-ALW-CHRG-CDE,                             13770000
137800                :ACCTYP-GL-ACCT-NBR                               13780000
137900         FROM   TACCTYP                                           13790000
138000         WHERE  ALW_CHRG_CDE    = :MDINVC-IMPRT-CHRG-PRC-CDE      13800000
138100           AND  AUTO_RVRSL_IND  = 'Y'                             13810000
138200           AND :AP036-1ST-INVC-DTE BETWEEN EFF_STRT_DTE           13820000
138300                                       AND EFF_END_DTE            13830000
138400     END-EXEC.                                                    13840000
138500                                                                  13850000
138600     EVALUATE TRUE                                                13860000
138700         WHEN SQLCODE = ZERO                                      13870000
138800            CONTINUE                                              13880000
138900                                                                  13890000
139000         WHEN SQLWARN0 NOT = SPACES                               13900000
139100         WHEN SQLCODE  NOT = ZERO                                 13910000
139200             MOVE PV-CURRENT-PARAGRAPH                            13920000
139300                                 TO AA-PARAGRAPH-NAME             13930000
139400             MOVE 'UNSUCCESSFUL SELECT FOR ACCT NUMBER'           13940000
139500                                 TO AA-DB2-OPERATION              13950000
139600             MOVE 'TACCTYP'      TO AA-DB2-TABLE-1                13960000
139700             MOVE SPACES         TO AA-DB2-TABLE-2                13970000
139800                                    AA-DB2-TABLE-3                13980000
139900             PERFORM Z999-DB2-ABEND                               13990000
140000     END-EVALUATE.                                                14000000
140100 EJECT                                                            14010000
140200*---------------------------------------------------------------- 14020000
140300*  SELECTING THE ACCOUNT NUMBER AND DOCUMENT NUMBER FOR THE       14030000
140400*  TRAN CODES '65'.                                               14040000
140500*---------------------------------------------------------------- 14050000
140600 S600-SELECT-65-TRAN-CODE.                                        14060000
140700     MOVE 'S600-SELECT-65-TRAN-CODE'     TO PV-CURRENT-PARAGRAPH. 14070000
140800                                                                  14080000
140900     EXEC SQL                                                     14090000
141000         SELECT                                                   14100000
141100             PSTG_TYP_CDE                                         14110000
141200            ,TRN_TYP_CDE                                          14120000
141300            ,GL_ACCT_NBR                                          14130000
141400            ,BTCH_SRC_CDE                                         14140000
141500           INTO                                                   14150000
141600             :TRNCDE-PSTG-TYP-CDE                                 14160000
141700            ,:TRNCDE-TRN-TYP-CDE                                  14170000
141800            ,:TRNCDE-GL-ACCT-NBR                                  14180000
141900            ,:TRNCDE-BTCH-SRC-CDE                                 14190000
142000           FROM  TTRNCDE                                          14200000
142100           WHERE AP_TRN_CDE    = :PV-AP-65-TRN-CDE                14210000
142200             AND EFF_STRT_DTE <= :PV-CURRENT-DATE                 14220000
142300             AND EFF_END_DTE  >= :PV-CURRENT-DATE                 14230000
142400     END-EXEC.                                                    14240000
142500                                                                  14250000
142600     EVALUATE TRUE                                                14260000
142700           WHEN SQLCODE = ZERO                                    14270000
142800                MOVE TRNCDE-PSTG-TYP-CDE TO PV-PSTG-TYP-CDE-65    14280000
142900                MOVE TRNCDE-TRN-TYP-CDE  TO PV-TRN-TYP-CDE-65     14290000
143000                MOVE TRNCDE-GL-ACCT-NBR  TO PV-GL-ACCT-NBR-65     14300000
143100                MOVE TRNCDE-BTCH-SRC-CDE TO PV-BTCH-SRC-CDE-65    14310000
143200           WHEN SQLWARN0 NOT = SPACES                             14320000
143300           WHEN SQLCODE  NOT = ZERO                               14330000
143400               MOVE PV-CURRENT-PARAGRAPH                          14340000
143500                                 TO AA-PARAGRAPH-NAME             14350000
143600               MOVE 'UNSUCCESSFUL SELECT FOR TTRNCDE'             14360000
143700                                 TO AA-DB2-OPERATION              14370000
143800               MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1              14380000
143900               MOVE SPACES         TO AA-DB2-TABLE-2              14390000
144000                                      AA-DB2-TABLE-3              14400000
144100               PERFORM Z999-DB2-ABEND                             14410000
144200     END-EVALUATE.                                                14420000
144300                                                                  14430000
144400 EJECT                                                            14440000
144500*---------------------------------------------------------------- 14450000
144600*  SELECTING THE ACCOUNT NUMBER AND DOCUMENT NUMBER FOR THE       14460000
144700*  TRAN CODES '73'.                                               14470000
144800*---------------------------------------------------------------- 14480000
144900 S700-SELECT-73-TRAN-CODE.                                        14490000
145000                                                                  14500000
145100     MOVE 'S700-SELECT-73-TRAN-CODE'     TO PV-CURRENT-PARAGRAPH. 14510000
145200                                                                  14520000
145300     EXEC SQL                                                     14530000
145400         SELECT                                                   14540000
145500             PSTG_TYP_CDE                                         14550000
145600            ,TRN_TYP_CDE                                          14560000
145700            ,GL_ACCT_NBR                                          14570000
145800            ,BTCH_SRC_CDE                                         14580000
145900           INTO                                                   14590000
146000             :TRNCDE-PSTG-TYP-CDE                                 14600000
146100            ,:TRNCDE-TRN-TYP-CDE                                  14610000
146200            ,:TRNCDE-GL-ACCT-NBR                                  14620000
146300            ,:TRNCDE-BTCH-SRC-CDE                                 14630000
146400           FROM  TTRNCDE                                          14640000
146500           WHERE AP_TRN_CDE    = :PV-AP-73-TRN-CDE                14650000
146600             AND EFF_STRT_DTE <= :PV-CURRENT-DATE                 14660000
146700*            AND EFF_END_DTE  <= :PV-CURRENT-DATE                 14670000
146800     END-EXEC.                                                    14680000
146900                                                                  14690000
147000     EVALUATE TRUE                                                14700000
147100           WHEN SQLCODE = ZERO                                    14710000
147200                MOVE TRNCDE-PSTG-TYP-CDE TO PV-PSTG-TYP-CDE-73    14720000
147300                MOVE TRNCDE-TRN-TYP-CDE  TO PV-TRN-TYP-CDE-73     14730000
147400                MOVE TRNCDE-GL-ACCT-NBR  TO PV-GL-ACCT-NBR-73     14740000
147500                MOVE TRNCDE-BTCH-SRC-CDE TO PV-BTCH-SRC-CDE-73    14750000
147600                     CONTINUE                                     14760000
147700           WHEN SQLWARN0 NOT = SPACES                             14770000
147800           WHEN SQLCODE  NOT = ZERO                               14780000
147900               MOVE PV-CURRENT-PARAGRAPH                          14790000
148000                                 TO AA-PARAGRAPH-NAME             14800000
148100               MOVE 'UNSUCCESSFUL SELECT FOR TTRNCDE'             14810000
148200                                 TO AA-DB2-OPERATION              14820000
148300               MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1              14830000
148400               MOVE SPACES         TO AA-DB2-TABLE-2              14840000
148500                                      AA-DB2-TABLE-3              14850000
148600               PERFORM Z999-DB2-ABEND                             14860000
148700     END-EVALUATE.                                                14870000
148800                                                                  14880000
148900                                                                  14890000
149000 S800-GET-VENDOR-ID.                                              14900000
149100*-----------------------------------------------------------      14910000
149200*  RETRIEVES VENDOR ID FOR PO BEING PROCESSED.                    14920000
149300*-----------------------------------------------------------      14930000
149400     MOVE 'S800-GET-VENDOR-ID' TO PV-CURRENT-PARAGRAPH.           14940000
149500                                                                  14950000
149600     EXEC SQL                                                     14960000
149700         SELECT  ENT_ID                                           14970000
149800           INTO :EXTENT-ENT-ID                                    14980000
149900           FROM TEXTENT                                           14990000
150000          WHERE DUN_NBR = :AP045-VND-NBR                          15000000
150100     END-EXEC.                                                    15010000
150200                                                                  15020000
150300     EVALUATE TRUE                                                15030000
150400         WHEN SQLCODE = ZERO                                      15040000
150500             CONTINUE                                             15050000
150600                                                                  15060000
150700         WHEN SQLCODE = +100                                      15070000
150800             CONTINUE                                             15080000
150900                                                                  15090000
151000         WHEN SQLWARN0 NOT = SPACES                               15100000
151100         WHEN SQLCODE  NOT = ZERO                                 15110000
151200             MOVE PV-CURRENT-PARAGRAPH                            15120000
151300                                          TO AA-PARAGRAPH-NAME    15130000
151400             MOVE 'TEXTENT'               TO AA-DB2-TABLE-1       15140000
151500             MOVE SPACES                  TO AA-DB2-TABLE-2       15150000
151600                                             AA-DB2-TABLE-3       15160000
151700             PERFORM Z999-DB2-ABEND                               15170000
151800     END-EVALUATE.                                                15180000
151900                                                                  15190000
152000                                                                  15200000
152100 EJECT                                                            15210000
152200*---------------------------------------------------------------- 15220000
152300*  INSERT AP TRANSACTION RECORD INTO TOUTAP1                      15230000
152400*---------------------------------------------------------------- 15240000
152500 U300-INSERT-TRANS-RECORDS.                                       15250000
152600     MOVE 'U300-INSERT-TRANS-RECORDS' TO PV-CURRENT-PARAGRAPH.    15260000
152700     PERFORM WITH TEST AFTER                                      15270000
152800             VARYING PC-RETRY-COUNT FROM 1 BY 1                   15280000
152900             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             15290000
153000                     SQLCODE = ZERO                               15300000
153100                                                                  15310000
153200* TOUTAP1 IS VARCHAR, SO THE LENGTH OF THE DATA BEING MOVED TO    15320000
153300*  OUTAP1-AJ-TRAN-ODR MUST BE MOVED TO OUTAP1-AJ-TRAN-ODR.        15330000
153400             EXEC SQL                                             15340000
153500                 INSERT INTO TOUTAP1                              15350000
153600                         (AJ_TRAN_ODR)                            15360000
153700                 VALUES  (:OUTAP1-AJ-TRAN-ODR)                    15370000
153800             END-EXEC                                             15380000
153900                                                                  15390000
154000             EVALUATE TRUE                                        15400000
154100                 WHEN SQLCODE = ZERO                              15410000
154200                 WHEN SQLCODE = -904                              15420000
154300                 WHEN SQLCODE = -913                              15430000
154400                      CONTINUE                                    15440000
154500                                                                  15450000
154600                 WHEN SQLWARN0 NOT = SPACES                       15460000
154700                 WHEN SQLCODE  NOT = ZERO                         15470000
154800                     MOVE PV-CURRENT-PARAGRAPH                    15480000
154900                                         TO AA-PARAGRAPH-NAME     15490000
155000                     MOVE 'UNSUCCESSFUL INSERT'                   15500000
155100                                         TO AA-DB2-OPERATION      15510000
155200                     MOVE 'TOUTAP1'      TO AA-DB2-TABLE-1        15520000
155300                     MOVE SPACES         TO AA-DB2-TABLE-2        15530000
155400                                            AA-DB2-TABLE-3        15540000
155500                     PERFORM Z999-DB2-ABEND                       15550000
155600             END-EVALUATE                                         15560000
155700     END-PERFORM.                                                 15570000
155800                                                                  15580000
155900     IF PC-RETRY-COUNT > PC-RETRY-MAX                             15590000
156000         MOVE PV-CURRENT-PARAGRAPH                                15600000
156100                             TO AA-PARAGRAPH-NAME                 15610000
156200         MOVE 'MAX RETRIES EXCEEDED ON INSERT'                    15620000
156300                             TO AA-DB2-OPERATION                  15630000
156400         MOVE 'TOUTAP1'      TO AA-DB2-TABLE-1                    15640000
156500         MOVE SPACES         TO AA-DB2-TABLE-2                    15650000
156600                                AA-DB2-TABLE-3                    15660000
156700         PERFORM Z999-DB2-ABEND                                   15670000
156800     END-IF.                                                      15680000
156900                                                                  15690000
157000     EVALUATE TRUE                                                15700000
157100         WHEN SQLCODE = ZEROS                                     15710000
157200              CONTINUE                                            15720000
157300         WHEN OTHER                                               15730000
157400             MOVE PV-CURRENT-PARAGRAPH                            15740000
157500                                 TO AA-PARAGRAPH-NAME             15750000
157600             MOVE 'UNSUCCESSFUL INSERT'                           15760000
157700                                 TO AA-DB2-OPERATION              15770000
157800             MOVE 'TOUTAP1'      TO AA-DB2-TABLE-1                15780000
157900             MOVE SPACES         TO AA-DB2-TABLE-2                15790000
158000                                    AA-DB2-TABLE-3                15800000
158100             PERFORM Z999-DB2-ABEND                               15810000
158200     END-EVALUATE.                                                15820000
158300                                                                  15830000
158400 EJECT                                                            15840000
158500*---------------------------------------------------------------- 15850000
158600*  UPDATE THE REVERSAL IND WHEN THE REVERSAL AMOUNT EQUALS        15860000
158700*  ORIGINAL POSTING AMOUNT                                        15870000
158800*---------------------------------------------------------------- 15880000
158900 U400-UPDATE-TINVOIC.                                             15890000
159000                                                                  15900000
159100     MOVE 'U400-UPDATE-TINVOIC' TO PV-CURRENT-PARAGRAPH.          15910000
159200                                                                  15920000
159300     PERFORM WITH TEST AFTER                                      15930000
159400             VARYING PC-RETRY-COUNT FROM 1 BY 1                   15940000
159500             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             15950000
159600                     SQLCODE = ZERO                               15960000
159700                                                                  15970000
159800         EXEC SQL                                                 15980000
159900             UPDATE TINVOIC                                       15990000
160000               SET   PPD_RVRSL_IND    = 'Y'                       16000000
160100               WHERE PO_NBR  = :PV-PO-NBR                         16010000
160200                 AND INVC_ID = :INVOIC-INVC-ID                    16020000
160300         END-EXEC                                                 16030000
160400                                                                  16040000
160500         EVALUATE TRUE                                            16050000
160600             WHEN SQLCODE = ZERO                                  16060000
160700             WHEN SQLCODE = -904                                  16070000
160800             WHEN SQLCODE = -913                                  16080000
160900                  CONTINUE                                        16090000
161000                                                                  16100000
161100             WHEN SQLWARN0 NOT = SPACES                           16110000
161200             WHEN SQLCODE  NOT = ZERO                             16120000
161300                  MOVE PV-CURRENT-PARAGRAPH                       16130000
161400                                 TO AA-PARAGRAPH-NAME             16140000
161500                  DISPLAY '******** PO: '                         16150000
161600                                 PV-PO-NBR-9                      16160000
161700                  DISPLAY '******** INVOICE: '                    16170000
161800                                 INVOIC-INVC-ID                   16180000
161900                  MOVE 'UNSUCCESSFUL UPDATE'                      16190000
162000                                 TO AA-DB2-OPERATION              16200000
162100                  MOVE 'TINVOIC'      TO AA-DB2-TABLE-1           16210000
162200                  MOVE SPACES         TO AA-DB2-TABLE-2           16220000
162300                                         AA-DB2-TABLE-3           16230000
162400                  PERFORM Z999-DB2-ABEND                          16240000
162500         END-EVALUATE                                             16250000
162600     END-PERFORM.                                                 16260000
162700                                                                  16270000
162800     IF PC-RETRY-COUNT > PC-RETRY-MAX                             16280000
162900         MOVE PV-CURRENT-PARAGRAPH                                16290000
163000                             TO AA-PARAGRAPH-NAME                 16300000
163100         DISPLAY '******** PO: '                                  16310000
163200                  PV-PO-NBR-9                                     16320000
163300         DISPLAY '******** INVOICE: '                             16330000
163400                  INVOIC-INVC-ID                                  16340000
163500         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    16350000
163600                             TO AA-DB2-OPERATION                  16360000
163700         MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                    16370000
163800         MOVE SPACES         TO AA-DB2-TABLE-2                    16380000
163900                                AA-DB2-TABLE-3                    16390000
164000         PERFORM Z999-DB2-ABEND                                   16400000
164100     END-IF.                                                      16410000
164200                                                                  16420000
164300     EVALUATE TRUE                                                16430000
164400         WHEN SQLCODE = ZEROS                                     16440000
164500             CONTINUE                                             16450000
164600         WHEN OTHER                                               16460000
164700             MOVE PV-CURRENT-PARAGRAPH                            16470000
164800                                 TO AA-PARAGRAPH-NAME             16480000
164900             DISPLAY '******** PO: '                              16490000
165000                      PV-PO-NBR-9                                 16500000
165100             DISPLAY '******** INVOICE: '                         16510000
165200                      INVOIC-INVC-ID                              16520000
165300             MOVE 'UNSUCCESSFUL UPDATE'                           16530000
165400                                 TO AA-DB2-OPERATION              16540000
165500             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                16550000
165600             MOVE SPACES         TO AA-DB2-TABLE-2                16560000
165700                                    AA-DB2-TABLE-3                16570000
165800             PERFORM Z999-DB2-ABEND                               16580000
165900     END-EVALUATE.                                                16590000
166000                                                                  16600000
166100 EJECT                                                            16610000
166200*----------------------------------------------------------------*16620000
166300*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *16630000
166400*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *16640000
166500*----------------------------------------------------------------*16650000
166600 U500-UPDATE-TCKRSTCNTL.                                          16660000
166700                                                                  16670000
166800     MOVE 'U500-UPDATE-TCKRSTCNTL' TO PV-CURRENT-PARAGRAPH.       16680000
166900                                                                  16690000
167000     PERFORM WITH TEST AFTER                                      16700000
167100             VARYING PC-RETRY-COUNT FROM 1 BY 1                   16710000
167200             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             16720000
167300                     SQLCODE = ZERO                               16730000
167400                                                                  16740000
167500             EXEC SQL                                             16750000
167600                 UPDATE TCKRSTCNTL                                16760000
167700                 SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE          16770000
167800                 WHERE PLAN_NAME      = :PC-PROGRAM-NAME          16780000
167900             END-EXEC                                             16790000
168000                                                                  16800000
168100             EVALUATE TRUE                                        16810000
168200                 WHEN SQLCODE = ZERO                              16820000
168300                 WHEN SQLCODE = -904                              16830000
168400                 WHEN SQLCODE = -913                              16840000
168500                      CONTINUE                                    16850000
168600                                                                  16860000
168700                 WHEN SQLWARN0 NOT = SPACES                       16870000
168800                 WHEN SQLCODE  NOT = ZERO                         16880000
168900                     MOVE PV-CURRENT-PARAGRAPH                    16890000
169000                                         TO AA-PARAGRAPH-NAME     16900000
169100                     DISPLAY '********   PROGRAM:'                16910000
169200                              PC-PROGRAM-NAME                     16920000
169300                     MOVE 'UNSUCCESSFUL UPDATE'                   16930000
169400                                         TO AA-DB2-OPERATION      16940000
169500                     MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1        16950000
169600                     MOVE SPACES         TO AA-DB2-TABLE-2        16960000
169700                                            AA-DB2-TABLE-3        16970000
169800                     PERFORM Z999-DB2-ABEND                       16980000
169900             END-EVALUATE                                         16990000
170000     END-PERFORM.                                                 17000000
170100                                                                  17010000
170200     IF PC-RETRY-COUNT > PC-RETRY-MAX                             17020000
170300         MOVE PV-CURRENT-PARAGRAPH                                17030000
170400                             TO AA-PARAGRAPH-NAME                 17040000
170500         DISPLAY '********   PROGRAM:'                            17050000
170600                  PC-PROGRAM-NAME                                 17060000
170700         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    17070000
170800                             TO AA-DB2-OPERATION                  17080000
170900         MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1                    17090000
171000         MOVE SPACES         TO AA-DB2-TABLE-2                    17100000
171100                                AA-DB2-TABLE-3                    17110000
171200         PERFORM Z999-DB2-ABEND                                   17120000
171300     END-IF.                                                      17130000
171400                                                                  17140000
171500     EJECT                                                        17150000
171600                                                                  17160000
171700*----------------------------------------------------------------*17170000
171800*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *17180000
171900*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *17190000
172000*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *17200000
172100*----------------------------------------------------------------*17210000
172200 U600-UPDATE-TCKRSTINF.                                           17220000
172300                                                                  17230000
172400     MOVE 'U600-UPDATE-TCKRSTINF' TO PV-CURRENT-PARAGRAPH.        17240000
172500                                                                  17250000
172600     MOVE PV-PO-NBR               TO CR-PO-NBR.                   17260000
172700     MOVE PV-IMP-EXT-COUNT        TO CR-IMP-EXT-COUNT.            17270000
172800     MOVE PV-INVOICE-COUNT        TO CR-INVOICE-COUNT.            17280000
172900     MOVE PV-CH-TRAN-COUNT        TO CR-CH-TRAN-COUNT.            17290000
173000     MOVE PV-CR-TRAN-COUNT        TO CR-CR-TRAN-COUNT.            17300000
173100     MOVE PV-TINVOIC-UPDATE-COUNT TO CR-TINVOIC-UPDATE-COUNT.     17310000
173200     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.   17320000
173300     MOVE 4022                TO TCKRSTINF-WORK-STRG-DESC-LEN.    17330000
173400                                                                  17340000
173500     PERFORM WITH TEST AFTER                                      17350000
173600             VARYING PC-RETRY-COUNT FROM 1 BY 1                   17360000
173700             UNTIL   PC-RETRY-COUNT > PC-RETRY-MAX OR             17370000
173800                     SQLCODE = ZERO                               17380000
173900                                                                  17390000
174000             EXEC SQL                                             17400000
174100                 UPDATE TCKRSTINF                                 17410000
174200                 SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC 17420000
174300                 WHERE PLAN_NAME      = :PC-PROGRAM-NAME          17430000
174400             END-EXEC                                             17440000
174500                                                                  17450000
174600             EVALUATE TRUE                                        17460000
174700                 WHEN SQLCODE = ZERO                              17470000
174800                 WHEN SQLCODE = -904                              17480000
174900                 WHEN SQLCODE = -913                              17490000
175000                      CONTINUE                                    17500000
175100                                                                  17510000
175200                 WHEN SQLWARN0 NOT = SPACES                       17520000
175300                 WHEN SQLCODE  NOT = ZERO                         17530000
175400                     MOVE PV-CURRENT-PARAGRAPH                    17540000
175500                                         TO AA-PARAGRAPH-NAME     17550000
175600                     DISPLAY '********   PROGRAM:'                17560000
175700                              PC-PROGRAM-NAME                     17570000
175800                     MOVE 'UNSUCCESSFUL UPDATE'                   17580000
175900                                         TO AA-DB2-OPERATION      17590000
176000                     MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1        17600000
176100                     MOVE SPACES         TO AA-DB2-TABLE-2        17610000
176200                                            AA-DB2-TABLE-3        17620000
176300                     PERFORM Z999-DB2-ABEND                       17630000
176400             END-EVALUATE                                         17640000
176500     END-PERFORM.                                                 17650000
176600                                                                  17660000
176700     IF PC-RETRY-COUNT > PC-RETRY-MAX                             17670000
176800         MOVE PV-CURRENT-PARAGRAPH                                17680000
176900                             TO AA-PARAGRAPH-NAME                 17690000
177000         DISPLAY '********   PROGRAM:'                            17700000
177100                  PC-PROGRAM-NAME                                 17710000
177200         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    17720000
177300                             TO AA-DB2-OPERATION                  17730000
177400         MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1                    17740000
177500         MOVE SPACES         TO AA-DB2-TABLE-2                    17750000
177600                                AA-DB2-TABLE-3                    17760000
177700         PERFORM Z999-DB2-ABEND                                   17770000
177800     END-IF.                                                      17780000
177900                                                                  17790000
178000 EJECT                                                            17800000
178100*----------------------------------------------------------------*17810000
178200*    COMMITS DB2 UPDATES FOR THE PO PROCESSED.                   *17820000
178300*----------------------------------------------------------------*17830000
178400 U700-COMMIT.                                                     17840000
178500                                                                  17850000
178600     MOVE 'U700-COMMIT'         TO PV-CURRENT-PARAGRAPH.          17860000
178700                                                                  17870000
178800     EXEC SQL                                                     17880000
178900         COMMIT                                                   17890000
179000     END-EXEC.                                                    17900000
179100                                                                  17910000
179200     EVALUATE TRUE                                                17920000
179300         WHEN SQLCODE = ZEROS                                     17930000
179400              CONTINUE                                            17940000
179500         WHEN OTHER                                               17950000
179600             MOVE PV-CURRENT-PARAGRAPH                            17960000
179700                                 TO AA-PARAGRAPH-NAME             17970000
179800             MOVE 'UNSUCCESSFUL COMMIT'                           17980000
179900                                 TO AA-DB2-OPERATION              17990000
180000             MOVE SPACES         TO AA-DB2-TABLE-1                18000000
180100                                    AA-DB2-TABLE-2                18010000
180200                                    AA-DB2-TABLE-3                18020000
180300             PERFORM Z999-DB2-ABEND                               18030000
180400     END-EVALUATE.                                                18040000
180500                                                                  18050000
180600 EJECT                                                            18060000
180700*---------------------------------------------------------------- 18070000
180800*    OPENS THE INVOICE CURSOR.                                    18080000
180900*---------------------------------------------------------------- 18090000
181000 X100-OPEN-INVOICE-CSR.                                           18100000
181100                                                                  18110000
181200     MOVE 'X100-OPEN-INVOICE-CSR '      TO PV-CURRENT-PARAGRAPH.  18120000
181300                                                                  18130000
181400     EXEC SQL                                                     18140000
181500         OPEN INVOICE_CSR                                         18150000
181600     END-EXEC.                                                    18160000
181700                                                                  18170000
181800     EVALUATE TRUE                                                18180000
181900         WHEN SQLCODE = ZERO                                      18190000
182000              CONTINUE                                            18200000
182100                                                                  18210000
182200         WHEN SQLWARN0 NOT = SPACES                               18220000
182300         WHEN SQLCODE  NOT = ZERO                                 18230000
182400             MOVE PV-CURRENT-PARAGRAPH                            18240000
182500                                TO AA-PARAGRAPH-NAME              18250000
182600             MOVE 'UNSUCCESSFUL OPEN ON INVOICE_CSR'              18260000
182700                                TO AA-DB2-OPERATION               18270000
182800             MOVE 'TINVOIC'     TO AA-DB2-TABLE-1                 18280000
182900             MOVE SPACES        TO AA-DB2-TABLE-2                 18290000
183000                                   AA-DB2-TABLE-3                 18300000
183100             PERFORM Z999-DB2-ABEND                               18310000
183200     END-EVALUATE.                                                18320000
183300                                                                  18330000
183400 EJECT                                                            18340000
183500*---------------------------------------------------------------- 18350000
183600*    OPENS THE CHARGE CODE CURSOR.                                18360000
183700*---------------------------------------------------------------- 18370000
183800 X200-OPEN-CHARGE-CODE-CSR.                                       18380000
183900                                                                  18390000
184000     MOVE 'X200-OPEN-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.    18400000
184100                                                                  18410000
184200     EXEC SQL                                                     18420000
184300         OPEN ALW_CHRG_CSR                                        18430000
184400     END-EXEC.                                                    18440000
184500                                                                  18450000
184600     EVALUATE TRUE                                                18460000
184700         WHEN SQLCODE = ZERO                                      18470000
184800              CONTINUE                                            18480000
184900                                                                  18490000
185000         WHEN SQLWARN0 NOT = SPACES                               18500000
185100         WHEN SQLCODE  NOT = ZERO                                 18510000
185200             MOVE PV-CURRENT-PARAGRAPH                            18520000
185300                                 TO AA-PARAGRAPH-NAME             18530000
185400             MOVE 'UNSUCCESSFUL OPEN ON ALW_CHRG_CSR'             18540000
185500                                 TO AA-DB2-OPERATION              18550000
185600             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                18560000
185700             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                18570000
185800             MOVE SPACES         TO AA-DB2-TABLE-3                18580000
185900             PERFORM Z999-DB2-ABEND                               18590000
186000     END-EVALUATE.                                                18600000
186100                                                                  18610000
186200 EJECT                                                            18620000
186300*---------------------------------------------------------------- 18630000
186400*    OPENS THE IMPORT DISCOUNT CURSOR.                            18640000
186500*---------------------------------------------------------------- 18650000
186600 X300-OPEN-IMPORT-DISCOUNT-CSR.                                   18660000
186700                                                                  18670000
186800     MOVE 'X300-OPEN-IMPORT-DISCOUNT-CSR' TO PV-CURRENT-PARAGRAPH.18680000
186900                                                                  18690000
187000     EXEC SQL                                                     18700000
187100         OPEN DISCOUNT_CSR                                        18710000
187200     END-EXEC.                                                    18720000
187300                                                                  18730000
187400     EVALUATE TRUE                                                18740000
187500         WHEN SQLCODE = ZERO                                      18750000
187600              CONTINUE                                            18760000
187700                                                                  18770000
187800         WHEN SQLWARN0 NOT = SPACES                               18780000
187900         WHEN SQLCODE  NOT = ZERO                                 18790000
188000             MOVE PV-CURRENT-PARAGRAPH                            18800000
188100                                TO AA-PARAGRAPH-NAME              18810000
188200             MOVE 'UNSUCCESSFUL OPEN ON DISCOUNT_CSR'             18820000
188300                                TO AA-DB2-OPERATION               18830000
188400             MOVE 'TALCHRG'     TO AA-DB2-TABLE-1                 18840000
188500             MOVE SPACES        TO AA-DB2-TABLE-2                 18850000
188600                                   AA-DB2-TABLE-3                 18860000
188700             PERFORM Z999-DB2-ABEND                               18870000
188800     END-EVALUATE.                                                18880000
188900                                                                  18890000
189000 EJECT                                                            18900000
189100*---------------------------------------------------------------- 18910000
189200*    CLOSES THE INVOICE CSR                                       18920000
189300*---------------------------------------------------------------- 18930000
189400 Y100-CLOSE-INVOICE-CSR.                                          18940000
189500                                                                  18950000
189600     MOVE 'Y100-CLOSE-INVOICE-CSR'       TO PV-CURRENT-PARAGRAPH. 18960000
189700                                                                  18970000
189800     EXEC SQL                                                     18980000
189900         CLOSE INVOICE_CSR                                        18990000
190000     END-EXEC.                                                    19000000
190100                                                                  19010000
190200     EVALUATE TRUE                                                19020000
190300         WHEN SQLCODE = ZERO                                      19030000
190400              CONTINUE                                            19040000
190500                                                                  19050000
190600         WHEN SQLWARN0 NOT = SPACES                               19060000
190700         WHEN SQLCODE  NOT = ZERO                                 19070000
190800             MOVE PV-CURRENT-PARAGRAPH                            19080000
190900                                   TO AA-PARAGRAPH-NAME           19090000
191000             MOVE 'UNSUCCESSFUL CLOSE OF INVOICE_CSR'             19100000
191100                                   TO AA-DB2-OPERATION            19110000
191200             MOVE 'TINVOIC'        TO AA-DB2-TABLE-1              19120000
191300             MOVE SPACES           TO AA-DB2-TABLE-2              19130000
191400                                      AA-DB2-TABLE-3              19140000
191500             PERFORM Z999-DB2-ABEND                               19150000
191600     END-EVALUATE.                                                19160000
191700                                                                  19170000
191800 EJECT                                                            19180000
191900*---------------------------------------------------------------- 19190000
192000*    CLOSES THE CHARGE CODE CURSOR.                               19200000
192100*---------------------------------------------------------------- 19210000
192200 Y200-CLOSE-CHARGE-CODE-CSR.                                      19220000
192300                                                                  19230000
192400     MOVE 'Y200-CLOSE-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.   19240000
192500                                                                  19250000
192600     EXEC SQL                                                     19260000
192700         CLOSE ALW_CHRG_CSR                                       19270000
192800     END-EXEC.                                                    19280000
192900                                                                  19290000
193000     EVALUATE TRUE                                                19300000
193100         WHEN SQLCODE = ZERO                                      19310000
193200              CONTINUE                                            19320000
193300                                                                  19330000
193400         WHEN SQLWARN0 NOT = SPACES                               19340000
193500         WHEN SQLCODE  NOT = ZERO                                 19350000
193600             MOVE PV-CURRENT-PARAGRAPH                            19360000
193700                                 TO AA-PARAGRAPH-NAME             19370000
193800             MOVE 'UNSUCCESSFUL CLOSE ON ALW_CHRG_CSR'            19380000
193900                                 TO AA-DB2-OPERATION              19390000
194000             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                19400000
194100             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                19410000
194200             MOVE SPACES         TO AA-DB2-TABLE-3                19420000
194300             PERFORM Z999-DB2-ABEND                               19430000
194400     END-EVALUATE.                                                19440000
194500                                                                  19450000
194600 EJECT                                                            19460000
194700*---------------------------------------------------------------- 19470000
194800*    CLOSES THE IMPORT DISCOUNT CSR                               19480000
194900*---------------------------------------------------------------- 19490000
195000 Y300-CLOSE-IMPORT-DISCOUNT-CSR.                                  19500000
195100                                                                  19510000
195200     MOVE 'Y300-CLOSE-IMPORT-DISCOUNT-CSR'                        19520000
195300                                 TO PV-CURRENT-PARAGRAPH.         19530000
195400                                                                  19540000
195500     EXEC SQL                                                     19550000
195600         CLOSE DISCOUNT_CSR                                       19560000
195700     END-EXEC.                                                    19570000
195800                                                                  19580000
195900     EVALUATE TRUE                                                19590000
196000         WHEN SQLCODE = ZERO                                      19600000
196100              CONTINUE                                            19610000
196200                                                                  19620000
196300         WHEN SQLWARN0 NOT = SPACES                               19630000
196400         WHEN SQLCODE  NOT = ZERO                                 19640000
196500             MOVE PV-CURRENT-PARAGRAPH                            19650000
196600                                   TO AA-PARAGRAPH-NAME           19660000
196700             MOVE 'UNSUCCESSFUL CLOSE OF DISCOUNT_CSR'            19670000
196800                                   TO AA-DB2-OPERATION            19680000
196900             MOVE 'TALCHRG'        TO AA-DB2-TABLE-1              19690000
197000             MOVE SPACES           TO AA-DB2-TABLE-2              19700000
197100                                      AA-DB2-TABLE-3              19710000
197200             PERFORM Z999-DB2-ABEND                               19720000
197300     END-EVALUATE.                                                19730000
197400                                                                  19740000
197500 EJECT                                                            19750000
197600*---------------------------------------------------------------- 19760000
197700*    ABEND ROUTINE FOR DB2 ERRORS                                 19770000
197800*---------------------------------------------------------------- 19780000
197900 Z999-DB2-ABEND.                                                  19790000
198000                                                                  19800000
198100     CLOSE IMPORT-PO-VARIANCE-FILE.                               19810000
198200     DISPLAY 'PO BEING PROCESSED = ' PV-PO-NBR-9.                 19820000
198300     DISPLAY 'CHRG CD BEING PROCESSED = '                         19830000
198400                                    MDINVC-IMPRT-CHRG-PRC-CDE.    19840000
198500     DISPLAY AA-ABEND-LIT.                                        19850000
198600     DISPLAY AA-DB2-ERROR-LIT.                                    19860000
198700     DISPLAY AA-PROGRAM-LIT.                                      19870000
198800     DISPLAY AA-PARAGRAPH-LIT.                                    19880000
198900     DISPLAY AA-DB2-OPERATION-LIT.                                19890000
199000     DISPLAY AA-DB2-TABLE-1.                                      19900000
199100     DISPLAY AA-DB2-TABLE-2.                                      19910000
199200     DISPLAY AA-DB2-TABLE-3.                                      19920000
199300     SET AC-DB2-ERROR TO TRUE.                                    19930000
199400                                                                  19940000
199500     COPY DPPD004.                                                19950000
199600                                                                  19960000
199700     CALL 'ILBOABN0' USING ABEND-CODE.                            19970000
