       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKUT407.                                         00020000
       AUTHOR.        BARBARA HULL.                                     00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  06-11-98.                                         00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      * MLKUT407 - THIS PROGRAM IS THE EXTRACT PROGRAM FOR THE SALES    00090000
      * AND INVENTORY RANKING REPORTS.                                  00100000
      *                                                                 00110000
      * THE FILE PRODUCED WILL CONTAIN FOUR DIFFERENT RECORD TYPES:     00120000
      * STORE DETAIL, STORE TOTAL, MAJOR CLASS AND DEPARTMENT RECORDS.  00130000
      * EACH TYPE WILL SUMMARIZE SALES YTD AND MONTH END INVENTORY      00140000
      * INFORMATION.                                                    00150000
      *                                                                 00160000
      * A TABLE IS BUILT OF TOTALS AT THE STORE DETAIL LEVEL. FROM      00170000
      * THIS TABLE TOTALS ARE ACCUMULATED FOR THE MAJOR CLASS,          00180000
      * DEPARTMENT AND STORE TOTAL LEVELS.                              00190000
      *                                                                 00200000
00021 ******************************************************************00210000
00022 * 11/17/98 - PAUL KEBER - STRATAGEM.                              00220000
00023 * REPLACED THE TMNSCLS CURSOR AND THE TWKSCLS SELECT WITH DATABASE00230000
00024 * UNLOAD INPUT FILES WHICH HAVE BEEN SORTED IN DEPARTMENT, CLASS, 00240000
00025 * STORE SEQUENCE.  THESE TWO FILES ARE PROCESSED TOGETHER.        00250000
W26603******************************************************************00260000
W26603* CHG ID   DATE        DESCRIPTION                               *00270000
W26603* ------   ----------  ----------------------------------------- *00280000
W26603* W26603   03-23-2004  STORE EXPANSION.  EXPANDED LRECL OF       *00290000
W26603*                      INP01, INP02, AND OUT01.                  *00300000
W26603*                      EXPANDED WORKING STORAGE VARIABLES.       *00310000
W26603*                      ADDED 'WITH UR' TO DB2 SELECTS.           *00320000
W26603*                      REPLACED TSTR000 WITH XMT_LOC TABLE.      *00330000
W26603*                      - RONNA MCDONALD                          *00340000
W26006* W26006   02-24-2005  REMOVE REFERENCES TO OBSOLETE STORE TABLE.*00341002
W26006*                      - ERIN SEARL                              *00346002
      ******************************************************************00350000
      *                                                                 00360000
       ENVIRONMENT DIVISION.                                            00370000
      *                                                                 00380000
       CONFIGURATION SECTION.                                           00390000
      *                                                                 00400000
       SOURCE-COMPUTER.        IBM-3090.                                00410000
       OBJECT-COMPUTER.        IBM-3090.                                00420000
      *                                                                 00430000
       INPUT-OUTPUT SECTION.                                            00440000
       FILE-CONTROL.                                                    00450000
                                                                        00460000
           SELECT TMNSCLS-UNLOAD-FILE                                   00470000
               ASSIGN TO INP01.                                         00480000
                                                                        00490000
           SELECT TWKSCLS-UNLOAD-FILE                                   00500000
               ASSIGN TO INP02.                                         00510000
                                                                        00520000
           SELECT RANK-EXTRACT-FILE                                     00530000
               ASSIGN TO OUT01.                                         00540000
                                                                        00550000
      ******************************************************************00560000
       DATA DIVISION.                                                   00570000
      ******************************************************************00580000
                                                                        00590000
       FILE SECTION.                                                    00600000
                                                                        00610000
       FD  TMNSCLS-UNLOAD-FILE                                          00620000
           RECORDING MODE IS F                                          00630000
           LABEL RECORDS ARE STANDARD                                   00640000
           BLOCK CONTAINS 0 RECORDS.                                    00650000
                                                                        00660000
W26603*01  TMNSCLS-UNLOAD-RECORD       PIC X(21).                       00670000
W26603 01  TMNSCLS-UNLOAD-RECORD       PIC X(23).                       00680000
                                                                        00690000
       FD  TWKSCLS-UNLOAD-FILE                                          00700000
           RECORDING MODE IS F                                          00710000
           LABEL RECORDS ARE STANDARD                                   00720000
           BLOCK CONTAINS 0 RECORDS.                                    00730000
                                                                        00740000
W26603*01  TWKSCLS-UNLOAD-RECORD       PIC X(13).                       00750000
W26603 01  TWKSCLS-UNLOAD-RECORD       PIC X(14).                       00760000
                                                                        00770000
       FD  RANK-EXTRACT-FILE                                            00780000
           RECORDING MODE IS F                                          00790000
           LABEL RECORDS ARE STANDARD                                   00800000
           BLOCK CONTAINS 0 RECORDS.                                    00810000
                                                                        00820000
W26603*01  RANK-EXTRACT-RECORD         PIC X(70).                       00830000
W26603 01  RANK-EXTRACT-RECORD         PIC X(90).                       00840000
      *                                                                 00850000
      ******************************************************************00860000
       WORKING-STORAGE SECTION.                                         00870000
      ******************************************************************00880000
                                                                        00890000
      *** OUTPUT STORE RANKING EXTRACT RECORD                           00900000
           COPY MLRD108.                                                00910000
                                                                        00920000
       01  PV-PROGRAM-VARIABLES.                                        00930000
W26603     05  PV-XMT-LOC-READ         PIC S9(09)     VALUE +0  COMP.   00950000
           05  PV-TMNSCLS-READ         PIC S9(09)     VALUE +0  COMP.   00960000
           05  PV-TWKSCLS-READ         PIC S9(09)     VALUE +0  COMP.   00970000
           05  PV-TMDSEAR-READ         PIC S9(09)     VALUE +0  COMP.   00980000
                                                                        00990000
           05  PV-TMNSCLS-BYPASSED     PIC S9(09)     VALUE +0  COMP.   01000000
                                                                        01010000
           05  PV-TOTAL-RECS-WRITTEN   PIC S9(09)     VALUE +0  COMP.   01020000
           05  PV-DETAIL-STORE-RECS-WRITTEN                             01030000
                                       PIC S9(09)     VALUE +0  COMP.   01040000
           05  PV-TOTAL-STORE-RECS-WRITTEN                              01050000
                                       PIC S9(09)     VALUE +0  COMP.   01060000
           05  PV-MAJ-CLASS-RECS-WRITTEN                                01070000
                                       PIC S9(09)     VALUE +0  COMP.   01080000
           05  PV-DEPT-RECS-WRITTEN    PIC S9(09)     VALUE +0  COMP.   01090000
                                                                        01100000
           05  PV-DEPARTMENT-DOLLARS.                                   01110000
               10  PV-DEPT-EOM-INVENTORY                                01120000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01130000
W26603         10  PV-DEPT-MTH-SALES   PIC S9(11)V99  VALUE +0  COMP-3. 01140000
W26603         10  PV-DEPT-YTD-SALES   PIC S9(11)V99  VALUE +0  COMP-3. 01150000
               10  PV-DEPT-YTD-SALES-LY                                 01160000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01170000
                                                                        01180000
           05  PV-MAJ-CLASS-DOLLARS.                                    01190000
               10  PV-MAJ-CLASS-EOM-INVENTORY                           01200000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01210000
               10  PV-MAJ-CLASS-MTH-SALES                               01220000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01230000
               10  PV-MAJ-CLASS-YTD-SALES                               01240000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01250000
               10  PV-MAJ-CLASS-YTD-SALES-LY                            01260000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01270000
                                                                        01280000
           05  PV-STORE-DOLLARS.                                        01290000
               10  PV-STORE-EOM-INVENTORY                               01300000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01310000
W26603         10  PV-STORE-MTH-SALES  PIC S9(11)V99  VALUE +0  COMP-3. 01320000
W26603         10  PV-STORE-YTD-SALES  PIC S9(11)V99  VALUE +0  COMP-3. 01330000
               10  PV-STORE-YTD-SALES-LY                                01340000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01350000
                                                                        01360000
           05  PV-OPN-FSCL-MN-DTE      PIC X(10).                       01370000
           05  PV-OPN-FSCL-MN-NBR      PIC X(02).                       01380000
                                                                        01390000
           05  PV-CRNT-LY-THIS-DAY-KY-DTE                               01400000
                                       PIC X(10).                       01410000
           05  PV-CRNT-FSCL-YR-BEG-DTE PIC X(10).                       01420000
           05  PV-PRIOR-FSCL-YR-BEG-DTE                                 01430000
                                       PIC X(10).                       01440000
           05  PV-OPEN-FSCL-MN-END-DTE-18                               01450000
                                       PIC X(18).                       01460000
           05  FILLER REDEFINES PV-OPEN-FSCL-MN-END-DTE-18.             01470000
               10  PV-OPEN-FSCL-MN-END-DTE-10                           01480000
                                       PIC X(10).                       01490000
               10  PV-OPEN-FSCL-MN-END-DTE-8                            01500000
                                       PIC X(8).                        01510000
                                                                        01520000
       01  CD-COUNTER-DISPLAY.                                          01530000
           05  CD-COUNT-HOLD1          PIC ZZZ,ZZZ,ZZ9.                 01540000
                                                                        01550000
       01  SA-SAVE-AREAS.                                               01560000
           05  SA-OLD-BUYER-3.                                          01570000
               10  FILLER              PIC X           VALUE SPACE.     01580000
               10  SA-OLD-BUYER-2      PIC X(02)       VALUE SPACE.     01590000
           05  SA-OLD-DEPT             PIC X(03)       VALUE SPACE.     01600000
           05  SA-OLD-DESCRIPTION      PIC X(20)       VALUE SPACE.     01610000
           05  SA-OLD-DIV-2            PIC X(02)       VALUE SPACE.     01620000
           05  SA-OLD-MANAGER          PIC X(02)       VALUE SPACE.     01630000
           05  SA-OLD-MAJ-CLASS        PIC X(02)       VALUE SPACE.     01640000
                                                                        01650000
       01  PS-PROGRAM-SUBSCRIPTS                       COMP SYNC.       01660000
           05  PS-STR-SUB              PIC S9(04)      COMP             01670000
                                                       VALUE ZERO.      01680000
                                                                        01690000
       01  PS-PROGRAM-SWITCHES.                                         01700000
           05  PS-STORE-MATCH          PIC  X(01)      VALUE 'N'.       01710000
               88  PS-STORE-NOT-MATCHED                VALUE 'N'.       01720000
               88  PS-STORE-MATCHED                    VALUE 'Y'.       01730000
           05  PS-TMNSCLS-DONE         PIC  X(01)      VALUE 'N'.       01740000
               88  PS-TMNSCLS-IS-DONE                  VALUE 'Y'.       01750000
               88  PS-TMNSCLS-IS-NOT-DONE              VALUE 'N'.       01760000
           05  PS-TMNSCLS-FOUND        PIC  X(01)      VALUE 'N'.       01770000
               88  PS-TMNSCLS-IS-FOUND                 VALUE 'Y'.       01780000
W26603     05  PS-XMT-LOC-DONE         PIC  X(01)      VALUE 'N'.       01810000
W26603         88  PS-XMT-LOC-IS-DONE                  VALUE 'Y'.       01820000
           05  PS-TWKSCLS-DONE         PIC  X(01)      VALUE 'N'.       01830000
               88  PS-TWKSCLS-IS-DONE                  VALUE 'Y'.       01840000
               88  PS-TWKSCLS-IS-NOT-DONE              VALUE 'N'.       01850000
           05  PS-TWKSCLS-PROCESSED    PIC  X(01)      VALUE 'N'.       01860000
               88  PS-TWKSCLS-IS-PROCESSED             VALUE 'Y'.       01870000
               88  PS-TWKSCLS-IS-NOT-PROCESSED         VALUE 'N'.       01880000
                                                                        01890000
       01  ST-STORE-TABLE.                                              01900000
           05  ST-STORE-TABLE-SIZE     PIC S9(04)     VALUE +0  COMP.   01910000
W26603     05  ST-STORE-ENTRY          OCCURS 99999 TIMES.              01920000
W26603         10  ST-STORE-NUMBER     PIC 9(05)      VALUE ZERO.       01930000
               10  ST-STORE-AMOUNTS.                                    01940000
W26603             15  ST-MTH-SALES    PIC S9(11)V99  VALUE +0  COMP-3. 01950000
W26603             15  ST-YTD-SALES    PIC S9(11)V99  VALUE +0  COMP-3. 01960000
                   15  ST-EOM-INVENTORY                                 01970000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 01980000
W26603             15  ST-YTD-SALES-LY PIC S9(11)V99  VALUE +0  COMP-3. 01990000
                                                                        02000000
       01  TS-TOTAL-STORE-TABLE.                                        02010000
           05  TS-TOTAL-STORE-TABLE-SIZE                                02020000
                                       PIC S9(04)     VALUE +0  COMP.   02030000
W26603     05  TS-TOTAL-STORE-ENTRY    OCCURS 99999 TIMES.              02040000
               10  TS-TOTAL-STORE-NUMBER                                02050000
W26603                                 PIC 9(05)      VALUE ZERO.       02060000
               10  TS-TOTAL-AMOUNTS.                                    02070000
                   15  TS-TOTAL-MTH-SALES                               02080000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 02090000
                   15  TS-TOTAL-YTD-SALES                               02100000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 02110000
                   15  TS-TOTAL-EOM-INVENTORY                           02120000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 02130000
                   15  TS-TOTAL-YTD-SALES-LY                            02140000
W26603                                 PIC S9(11)V99  VALUE +0  COMP-3. 02150000
                                                                        02160000
       01  WS-TMNSCLS-UNLOAD-REC.                                       02170000
           05  WS-TMNSCLS-FSCL-MN-NBR  PIC  X(02)    VALUE SPACES.      02180000
           05  WS-TMNSCLS-DEPT-NBR     PIC  X(03)    VALUE SPACES.      02190000
           05  WS-TMNSCLS-MAJ-CL-NBR   PIC  X(02)    VALUE SPACES.      02200000
           05  WS-TMNSCLS-STR-NBR      PIC S9(04)    VALUE +0  COMP.    02210000
W26603     05  WS-TMNSCLS-SLS-RTL-AMT  PIC S9(11)V99 VALUE +0 COMP-3.   02220000
           05  WS-TMNSCLS-END-INV-RTL-AMT                               02230000
W26603                                 PIC S9(11)V99 VALUE +0 COMP-3.   02240000
                                                                        02250000
       01  WS-TWKSCLS-UNLOAD-REC.                                       02260000
           05  WS-TWKSCLS-DEPT-NBR     PIC  X(03)    VALUE SPACES.      02270000
           05  WS-TWKSCLS-MAJ-CL-NBR   PIC  X(02)    VALUE SPACES.      02280000
           05  WS-TWKSCLS-STR-NBR      PIC S9(04)    VALUE +0  COMP.    02290000
W26603     05  WS-TWKSCLS-SLS-RTL-AMT  PIC S9(11)V99 VALUE +0 COMP-3.   02300000
                                                                        02310000
       EJECT                                                            02320000
                                                                        02330000
       01 ABEND-AREAS.                                                  02340000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           02350000
                                                   COMP SYNC.           02360000
               88  AC-BAD-DATA                     VALUE +4003.         02370000
               88  AC-DB2-ERROR                    VALUE +4013.         02380000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                02390000
                 '*****       ABEND'.                                   02400000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                02410000
                   '*****   PROGRAM: MLKUT407'.                         02420000
           05  AA-PARAGRAPH-LIT.                                        02430000
               10  FILLER              PIC X(17)   VALUE                02440000
                   '***** PARAGRAPH: '.                                 02450000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        02460000
           05  AA-MESSAGE-LINE.                                         02470000
               10  FILLER              PIC X(06)   VALUE '*****'.       02480000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        02490000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                02500000
                   '*****    DB2 ERROR'.                                02510000
           05  AA-DB2-OPERATION-LIT.                                    02520000
               10  FILLER              PIC X(17)   VALUE                02530000
                   '***** OPERATION: '.                                 02540000
               10  AA-DB2-OPERATION.                                    02550000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        02560000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        02570000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        02580000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        02590000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        02600000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        02610000
                                                                        02620000
       EJECT                                                            02630000
                                                                        02640000
      ******************************************************************02650000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                02660000
      ******************************************************************02670000
           COPY DPWS004.                                                02680000
                                                                        02690000
      ******************************************************************02700000
      *  DB2 ERRORS                                                     02710000
      ******************************************************************02720000
           COPY SQLCA2.                                                 02730000
                                                                        02740000
      ******************************************************************02750000
      *  DB2 MLCNTL TABLE LAYOUT                                        02760000
      ******************************************************************02770000
           EXEC SQL                                                     02780000
                INCLUDE TMLCNTL                                         02790000
           END-EXEC.                                                    02800000
                                                                        02810000
      ******************************************************************02820000
      *  DB2 MDSEAR TABLE LAYOUT                                        02830000
      ******************************************************************02840000
           EXEC SQL                                                     02850000
                INCLUDE TMDSEAR                                         02860000
           END-EXEC.                                                    02870000
                                                                        02880000
      ******************************************************************02890000
      *  DB2 LOC TABLE LAYOUT                                           02900001
      ******************************************************************02910000
           EXEC SQL                                                     02920000
W26603          INCLUDE XMT00001                                        02940000
           END-EXEC.                                                    02950000
                                                                        02960000
      ******************************************************************02970000
      *  DB2 COMMUNICATION AREA                                         02980000
      ******************************************************************02990000
           EXEC SQL                                                     03000000
                INCLUDE SQLCA                                           03010000
           END-EXEC.                                                    03020000
                                                                        03030000
      ******************************************************************03040000
      *  DB2 LOC CURSOR                                                 03050001
      ******************************************************************03060000
           EXEC SQL                                                     03070000
                DECLARE LOC_CURSOR CURSOR FOR                           03080001
W26603           SELECT LOC_NBR                                         03150000
W26603             FROM XMT_LOC                                         03160000
W26603            WHERE LOC_TYP_CDE  = 'DS'                             03170000
W26603              AND CLO_DTE     >= :PV-OPN-FSCL-MN-DTE              03180000
W26603            ORDER BY LOC_NBR                                      03190000
           END-EXEC.                                                    03200000
                                                                        03210000
       EJECT                                                            03220000
                                                                        03230000
      ******************************************************************03240000
       PROCEDURE DIVISION.                                              03250000
      ******************************************************************03260000
                                                                        03270000
      ******************************************************************03280000
       0100-MAINLINE-MLKUT407.                                          03290000
      ******************************************************************03300000
      *                                                                 03310000
           PERFORM 1000-INITIALIZATION.                                 03320000
                                                                        03330000
           PERFORM 2000-GET-DB2-DATA-CR8-RPT.                           03340000
                                                                        03350000
           IF PS-TMNSCLS-IS-FOUND                                       03360000
               PERFORM 5200-CREATE-MAJ-CLASS-RECORD                     03370000
                                                                        03380000
               PERFORM 5300-CREATE-DEPT-RECORD                          03390000
                                                                        03400000
               PERFORM 5400-CREATE-STORE-TOTAL-REC                      03410000
                 VARYING PS-STR-SUB FROM 1 BY 1                         03420000
                   UNTIL PS-STR-SUB > TS-TOTAL-STORE-TABLE-SIZE         03430000
           END-IF.                                                      03440000
                                                                        03450000
           PERFORM 8000-EOJ.                                            03460000
                                                                        03470000
           STOP RUN.                                                    03480000
                                                                        03490000
       EJECT                                                            03500000
                                                                        03510000
      ******************************************************************03520000
       1000-INITIALIZATION.                                             03530000
      ******************************************************************03540000
      *                                                                 03550000
           OPEN INPUT  TMNSCLS-UNLOAD-FILE                              03560000
                       TWKSCLS-UNLOAD-FILE.                             03570000
           OPEN OUTPUT RANK-EXTRACT-FILE.                               03580000
                                                                        03590000
           PERFORM 7000-SELECT-TMLCNTL.                                 03600000
                                                                        03610000
           DISPLAY ' '.                                                 03620000
           DISPLAY '*** OPEN FISCAL DATES USED ARE:  '                  03630000
           DISPLAY '      MLCNTL-OPN-FSCL-MN-DTE = '                    03640000
             PV-OPN-FSCL-MN-DTE.                                        03650000
                                                                        03660000
           MOVE PV-OPN-FSCL-MN-DTE     TO PV-OPEN-FSCL-MN-END-DTE-10.   03670000
           MOVE ZERO                   TO PV-OPEN-FSCL-MN-END-DTE-8.    03680000
                                                                        03690000
           PERFORM 1100-BUILD-STORE-TABLE.                              03700000
                                                                        03710000
       EJECT                                                            03720000
                                                                        03730000
      ******************************************************************03740000
       1100-BUILD-STORE-TABLE.                                          03750000
      ******************************************************************03760000
      *                                                                 03770000
W26603     PERFORM 7300-OPEN-CURSOR-XMT-LOC.                            03780000
                                                                        03790000
W26603     PERFORM 7310-FETCH-XMT-LOC.                                  03800000
                                                                        03810000
           PERFORM                                                      03820000
W26603       UNTIL PS-XMT-LOC-IS-DONE                                   03830000
W26603             MOVE XMT00001-LOC-NBR                                03840000
                                       TO PS-STR-SUB                    03850000
W26603             MOVE XMT00001-LOC-NBR                                03860000
                           TO ST-STORE-NUMBER (PS-STR-SUB)              03870000
                              TS-TOTAL-STORE-NUMBER (PS-STR-SUB)        03880000
W26603             PERFORM 7310-FETCH-XMT-LOC                           03890000
           END-PERFORM.                                                 03900000
                                                                        03910000
W26603     PERFORM 7320-CLOSE-CURSOR-XMT-LOC.                           03920000
                                                                        03930000
           MOVE PS-STR-SUB         TO ST-STORE-TABLE-SIZE               03940000
                                      TS-TOTAL-STORE-TABLE-SIZE.        03950000
                                                                        03960000
       EJECT                                                            03970000
                                                                        03980000
      ******************************************************************03990000
       2000-GET-DB2-DATA-CR8-RPT.                                       04000000
      ******************************************************************04010000
      *                                                                 04020000
           PERFORM 4000-READ-TMNSCLS-UNLOAD.                            04030000
                                                                        04040000
           IF PS-TMNSCLS-IS-NOT-DONE                                    04050000
               MOVE 'Y'                TO PS-TMNSCLS-FOUND              04060000
               PERFORM 4100-READ-TWKSCLS-UNLOAD                         04070000
               MOVE WS-TMNSCLS-MAJ-CL-NBR TO SA-OLD-MAJ-CLASS           04080000
               PERFORM 7400-SELECT-TMDSEAR                              04090000
               MOVE MDSEAR-BYR-NBR     TO SA-OLD-BUYER-3                04100000
               MOVE MDSEAR-DMA-NBR     TO SA-OLD-MANAGER                04110000
               MOVE WS-TMNSCLS-DEPT-NBR TO SA-OLD-DEPT                  04120000
               MOVE MDSEAR-GMA-NBR     TO SA-OLD-DIV-2                  04130000
               MOVE MDSEAR-DESC        TO SA-OLD-DESCRIPTION            04140000
           END-IF.                                                      04150000
                                                                        04160000
           PERFORM                                                      04170000
               UNTIL PS-TMNSCLS-IS-DONE                                 04180000
               PERFORM 2050-GET-MORE-DATA-N-CR8-RPT                     04190000
           END-PERFORM.                                                 04200000
                                                                        04210000
       EJECT                                                            04220000
                                                                        04230000
      ******************************************************************04240000
       2050-GET-MORE-DATA-N-CR8-RPT.                                    04250000
      ******************************************************************04260000
      *                                                                 04270000
           IF WS-TMNSCLS-DEPT-NBR > SA-OLD-DEPT                         04280000
               PERFORM 5200-CREATE-MAJ-CLASS-RECORD                     04290000
               PERFORM 5300-CREATE-DEPT-RECORD                          04300000
               PERFORM 5400-CREATE-STORE-TOTAL-REC                      04310000
                 VARYING PS-STR-SUB FROM 1 BY 1                         04320000
                   UNTIL PS-STR-SUB > ST-STORE-TABLE-SIZE               04330000
               PERFORM 7400-SELECT-TMDSEAR                              04340000
               MOVE MDSEAR-BYR-NBR     TO SA-OLD-BUYER-3                04350000
               MOVE MDSEAR-DMA-NBR     TO SA-OLD-MANAGER                04360000
               MOVE MDSEAR-GMA-NBR     TO SA-OLD-DIV-2                  04370000
               MOVE MDSEAR-DESC        TO SA-OLD-DESCRIPTION            04380000
           ELSE                                                         04390000
               IF WS-TMNSCLS-MAJ-CL-NBR > SA-OLD-MAJ-CLASS              04400000
                   PERFORM 5200-CREATE-MAJ-CLASS-RECORD                 04410000
                   PERFORM 7400-SELECT-TMDSEAR                          04420000
                   MOVE MDSEAR-BYR-NBR TO SA-OLD-BUYER-3                04430000
                   MOVE MDSEAR-DMA-NBR TO SA-OLD-MANAGER                04440000
                   MOVE MDSEAR-GMA-NBR TO SA-OLD-DIV-2                  04450000
                   MOVE MDSEAR-DESC    TO SA-OLD-DESCRIPTION            04460000
               END-IF                                                   04470000
           END-IF.                                                      04480000
                                                                        04490000
           MOVE WS-TMNSCLS-DEPT-NBR    TO SA-OLD-DEPT.                  04500000
           MOVE WS-TMNSCLS-MAJ-CL-NBR  TO SA-OLD-MAJ-CLASS.             04510000
           MOVE WS-TMNSCLS-STR-NBR     TO PS-STR-SUB.                   04520000
                                                                        04530000
           IF ST-STORE-NUMBER (PS-STR-SUB) NOT = ZERO                   04540000
      ***      FIND ALL TMNSCLS RECORDS WITH THE SAME DEPARTMENT, MAJOR 04550000
      ***      CLASS, AND STORE NUMBER AND ADD TO STORE DETAIL RECORD   04560000
      ***      TOTALS                                                   04570000
               PERFORM 2055-SUM-STORE-INFORMATION                       04580000
                 UNTIL WS-TMNSCLS-STR-NBR > PS-STR-SUB                  04590000
                   OR WS-TMNSCLS-MAJ-CL-NBR > SA-OLD-MAJ-CLASS          04600000
                   OR WS-TMNSCLS-DEPT-NBR > SA-OLD-DEPT                 04610000
                   OR PS-TMNSCLS-IS-DONE                                04620000
      ***      FIND THE TWKSCLS RECORD MATCHING THE TMNSCLS RECORDS     04630000
               SET PS-TWKSCLS-IS-NOT-PROCESSED TO TRUE                  04640000
               PERFORM 2060-GET-TWKSCLS-SLS-RTL-AMT                     04650000
                 UNTIL PS-TWKSCLS-IS-PROCESSED                          04660000
                   OR PS-TWKSCLS-IS-DONE                                04670000
      ***      ADD STORE AMOUNTS TO STORE TOTALS, DEPT AND MAJOR CLASS  04680000
      ***      LEVEL TOTALS, AND CREATE A STORE DETAIL RECORD           04690000
               ADD PV-STORE-MTH-SALES                                   04700000
                   TO TS-TOTAL-MTH-SALES  (PS-STR-SUB)                  04710000
                      PV-DEPT-MTH-SALES                                 04720000
                      PV-MAJ-CLASS-MTH-SALES                            04730000
               ADD PV-STORE-YTD-SALES                                   04740000
                   TO TS-TOTAL-YTD-SALES  (PS-STR-SUB)                  04750000
                      PV-DEPT-YTD-SALES                                 04760000
                      PV-MAJ-CLASS-YTD-SALES                            04770000
               ADD PV-STORE-EOM-INVENTORY                               04780000
                   TO TS-TOTAL-EOM-INVENTORY (PS-STR-SUB)               04790000
                      PV-DEPT-EOM-INVENTORY                             04800000
                      PV-MAJ-CLASS-EOM-INVENTORY                        04810000
               ADD PV-STORE-YTD-SALES-LY                                04820000
                   TO TS-TOTAL-YTD-SALES-LY (PS-STR-SUB)                04830000
                      PV-DEPT-YTD-SALES-LY                              04840000
                      PV-MAJ-CLASS-YTD-SALES-LY                         04850000
               PERFORM 5100-CREATE-STORE-DETAIL-REC                     04860000
           ELSE                                                         04870000
               ADD +1                  TO PV-TMNSCLS-BYPASSED           04880000
               PERFORM 4000-READ-TMNSCLS-UNLOAD                         04890000
                 UNTIL WS-TMNSCLS-STR-NBR > PS-STR-SUB                  04900000
                   OR WS-TMNSCLS-MAJ-CL-NBR > SA-OLD-MAJ-CLASS          04910000
                   OR WS-TMNSCLS-DEPT-NBR > SA-OLD-DEPT                 04920000
                   OR PS-TMNSCLS-IS-DONE                                04930000
           END-IF.                                                      04940000
                                                                        04950000
       EJECT                                                            04960000
                                                                        04970000
      ******************************************************************04980000
       2055-SUM-STORE-INFORMATION.                                      04990000
      ******************************************************************05000000
      *                                                                 05010000
           ADD WS-TMNSCLS-SLS-RTL-AMT  TO PV-STORE-YTD-SALES.           05020000
           IF WS-TMNSCLS-FSCL-MN-NBR = PV-OPN-FSCL-MN-NBR               05030000
               ADD WS-TMNSCLS-END-INV-RTL-AMT                           05040000
                                       TO PV-STORE-EOM-INVENTORY        05050000
               ADD WS-TMNSCLS-SLS-RTL-AMT                               05060000
                                       TO PV-STORE-MTH-SALES            05070000
           END-IF.                                                      05080000
           PERFORM 4000-READ-TMNSCLS-UNLOAD.                            05090000
                                                                        05100000
       EJECT                                                            05110000
                                                                        05120000
      ******************************************************************05130000
       2060-GET-TWKSCLS-SLS-RTL-AMT.                                    05140000
      ******************************************************************05150000
                                                                        05160000
           IF WS-TWKSCLS-STR-NBR = PS-STR-SUB                           05170000
             AND WS-TWKSCLS-MAJ-CL-NBR = SA-OLD-MAJ-CLASS               05180000
             AND WS-TWKSCLS-DEPT-NBR = SA-OLD-DEPT                      05190000
               MOVE WS-TWKSCLS-SLS-RTL-AMT TO PV-STORE-YTD-SALES-LY     05200000
               SET PS-TWKSCLS-IS-PROCESSED TO TRUE                      05210000
           ELSE                                                         05220000
               IF (WS-TWKSCLS-STR-NBR > PS-STR-SUB                      05230000
                   AND WS-TWKSCLS-MAJ-CL-NBR = SA-OLD-MAJ-CLASS         05240000
                   AND WS-TWKSCLS-DEPT-NBR = SA-OLD-DEPT)               05250000
                 OR (WS-TWKSCLS-MAJ-CL-NBR > SA-OLD-MAJ-CLASS           05260000
                     AND WS-TWKSCLS-DEPT-NBR = SA-OLD-DEPT)             05270000
                 OR WS-TWKSCLS-DEPT-NBR > SA-OLD-DEPT                   05280000
                 OR PS-TWKSCLS-IS-DONE                                  05290000
                   SET PS-TWKSCLS-IS-PROCESSED TO TRUE                  05300000
               ELSE                                                     05310000
                   PERFORM 4100-READ-TWKSCLS-UNLOAD                     05320000
               END-IF                                                   05330000
           END-IF.                                                      05340000
                                                                        05350000
                                                                        05360000
       EJECT                                                            05370000
                                                                        05380000
      ******************************************************************05390000
       4000-READ-TMNSCLS-UNLOAD.                                        05400000
      ******************************************************************05410000
      *                                                                 05420000
           READ TMNSCLS-UNLOAD-FILE INTO WS-TMNSCLS-UNLOAD-REC          05430000
             AT END                                                     05440000
                 MOVE 'Y' TO PS-TMNSCLS-DONE                            05450000
             NOT AT END                                                 05460000
                 ADD +1   TO PV-TMNSCLS-READ                            05470000
           END-READ.                                                    05480000
                                                                        05490000
       EJECT                                                            05500000
                                                                        05510000
      ******************************************************************05520000
       4100-READ-TWKSCLS-UNLOAD.                                        05530000
      ******************************************************************05540000
      *                                                                 05550000
           READ TWKSCLS-UNLOAD-FILE INTO WS-TWKSCLS-UNLOAD-REC          05560000
             AT END                                                     05570000
                 MOVE 'Y' TO PS-TWKSCLS-DONE                            05580000
             NOT AT END                                                 05590000
                 ADD +1   TO PV-TWKSCLS-READ                            05600000
           END-READ.                                                    05610000
                                                                        05620000
       EJECT                                                            05630000
                                                                        05640000
      ******************************************************************05650000
       5100-CREATE-STORE-DETAIL-REC.                                    05660000
      ******************************************************************05670000
      *                                                                 05680000
           INITIALIZE ML108-STORE-RANKING-RECORD.                       05690000
           MOVE SA-OLD-BUYER-2         TO ML108-BUYER-NUMBER.           05700000
           MOVE SA-OLD-DEPT            TO ML108-DEPT-NUMBER.            05710000
           MOVE SA-OLD-DESCRIPTION     TO ML108-DESCRIPTION.            05720000
           MOVE SA-OLD-DIV-2           TO ML108-DIVISION-NUMBER.        05730000
           MOVE SA-OLD-MANAGER         TO ML108-MANAGER-NUMBER.         05740000
           MOVE SA-OLD-MAJ-CLASS       TO ML108-CLASS-NUMBER.           05750000
           MOVE ST-STORE-NUMBER (PS-STR-SUB)                            05760000
                                       TO ML108-STORE-NUMBER.           05770000
           MOVE PV-STORE-MTH-SALES     TO ML108-MTH-SALES-DOLLARS.      05780000
           MOVE PV-STORE-YTD-SALES     TO ML108-YTD-SALES-DOLLARS.      05790000
           MOVE PV-STORE-EOM-INVENTORY TO ML108-EOM-INVENTORY-DOLLARS.  05800000
           MOVE PV-STORE-YTD-SALES-LY  TO ML108-YTD-SALES-DOLLARS-LY.   05810000
                                                                        05820000
           INITIALIZE PV-STORE-DOLLARS.                                 05830000
                                                                        05840000
           PERFORM 5999-WRITE-EXTRACT-RECORD.                           05850000
                                                                        05860000
           ADD 1 TO PV-DETAIL-STORE-RECS-WRITTEN.                       05870000
                                                                        05880000
       EJECT                                                            05890000
                                                                        05900000
      ******************************************************************05910000
       5200-CREATE-MAJ-CLASS-RECORD.                                    05920000
      ******************************************************************05930000
      *                                                                 05940000
           INITIALIZE ML108-STORE-RANKING-RECORD.                       05950000
           MOVE SA-OLD-BUYER-2         TO ML108-BUYER-NUMBER.           05960000
           MOVE SA-OLD-DEPT            TO ML108-DEPT-NUMBER.            05970000
           MOVE SA-OLD-MAJ-CLASS       TO ML108-CLASS-NUMBER.           05980000
           MOVE SA-OLD-DESCRIPTION     TO ML108-DESCRIPTION.            05990000
                                                                        06000000
           MOVE PV-MAJ-CLASS-MTH-SALES TO ML108-MTH-SALES-DOLLARS.      06010000
           MOVE PV-MAJ-CLASS-YTD-SALES TO ML108-YTD-SALES-DOLLARS.      06020000
           MOVE PV-MAJ-CLASS-EOM-INVENTORY                              06030000
                                       TO ML108-EOM-INVENTORY-DOLLARS.  06040000
           MOVE PV-MAJ-CLASS-YTD-SALES-LY                               06050000
                                       TO ML108-YTD-SALES-DOLLARS-LY.   06060000
           INITIALIZE PV-MAJ-CLASS-DOLLARS.                             06070000
                                                                        06080000
           MOVE SA-OLD-DIV-2           TO ML108-DIVISION-NUMBER.        06090000
           MOVE SA-OLD-MANAGER         TO ML108-MANAGER-NUMBER.         06100000
                                                                        06110000
           PERFORM 5999-WRITE-EXTRACT-RECORD.                           06120000
                                                                        06130000
           ADD 1                       TO PV-MAJ-CLASS-RECS-WRITTEN.    06140000
                                                                        06150000
       EJECT                                                            06160000
                                                                        06170000
      ******************************************************************06180000
       5300-CREATE-DEPT-RECORD.                                         06190000
      ******************************************************************06200000
      *                                                                 06210000
           INITIALIZE ML108-STORE-RANKING-RECORD.                       06220000
           MOVE SA-OLD-BUYER-2         TO ML108-BUYER-NUMBER.           06230000
           MOVE SA-OLD-DEPT            TO ML108-DEPT-NUMBER.            06240000
           PERFORM 7450-SELECT-TMDSEAR-DEPT.                            06250000
           MOVE MDSEAR-DESC            TO ML108-DESCRIPTION.            06260000
                                                                        06270000
           MOVE PV-DEPT-MTH-SALES      TO ML108-MTH-SALES-DOLLARS.      06280000
           MOVE PV-DEPT-YTD-SALES      TO ML108-YTD-SALES-DOLLARS.      06290000
           MOVE PV-DEPT-EOM-INVENTORY  TO ML108-EOM-INVENTORY-DOLLARS.  06300000
           MOVE PV-DEPT-YTD-SALES-LY   TO ML108-YTD-SALES-DOLLARS-LY.   06310000
           INITIALIZE PV-DEPARTMENT-DOLLARS.                            06320000
                                                                        06330000
           MOVE SA-OLD-DIV-2           TO ML108-DIVISION-NUMBER.        06340000
           MOVE SA-OLD-MANAGER         TO ML108-MANAGER-NUMBER.         06350000
                                                                        06360000
           PERFORM 5999-WRITE-EXTRACT-RECORD.                           06370000
                                                                        06380000
           ADD 1                       TO PV-DEPT-RECS-WRITTEN.         06390000
                                                                        06400000
       EJECT                                                            06410000
                                                                        06420000
      ******************************************************************06430000
       5400-CREATE-STORE-TOTAL-REC.                                     06440000
      ******************************************************************06450000
      *                                                                 06460000
           IF TS-TOTAL-STORE-NUMBER (PS-STR-SUB) NOT = ZERO             06470000
               INITIALIZE ML108-STORE-RANKING-RECORD                    06480000
               MOVE SA-OLD-BUYER-2     TO ML108-BUYER-NUMBER            06490000
               MOVE SA-OLD-DEPT        TO ML108-DEPT-NUMBER             06500000
               MOVE SA-OLD-DIV-2       TO ML108-DIVISION-NUMBER         06510000
               MOVE SA-OLD-MANAGER     TO ML108-MANAGER-NUMBER          06520000
               MOVE TS-TOTAL-STORE-NUMBER (PS-STR-SUB)                  06530000
                                       TO ML108-STORE-NUMBER            06540000
               MOVE TS-TOTAL-MTH-SALES (PS-STR-SUB)                     06550000
                                       TO ML108-MTH-SALES-DOLLARS       06560000
               MOVE TS-TOTAL-YTD-SALES (PS-STR-SUB)                     06570000
                                       TO ML108-YTD-SALES-DOLLARS       06580000
               MOVE TS-TOTAL-EOM-INVENTORY (PS-STR-SUB)                 06590000
                                       TO ML108-EOM-INVENTORY-DOLLARS   06600000
               MOVE TS-TOTAL-YTD-SALES-LY (PS-STR-SUB)                  06610000
                                       TO ML108-YTD-SALES-DOLLARS-LY    06620000
                                                                        06630000
               INITIALIZE TS-TOTAL-AMOUNTS (PS-STR-SUB)                 06640000
                                                                        06650000
               PERFORM 5999-WRITE-EXTRACT-RECORD                        06660000
                                                                        06670000
               ADD 1                   TO PV-TOTAL-STORE-RECS-WRITTEN.  06680000
                                                                        06690000
       EJECT                                                            06700000
                                                                        06710000
      ******************************************************************06720000
       5999-WRITE-EXTRACT-RECORD.                                       06730000
      ******************************************************************06740000
      *                                                                 06750000
           WRITE RANK-EXTRACT-RECORD                                    06760000
               FROM  ML108-STORE-RANKING-RECORD.                        06770000
                                                                        06780000
           ADD 1 TO PV-TOTAL-RECS-WRITTEN.                              06790000
                                                                        06800000
       EJECT                                                            06810000
                                                                        06820000
      ******************************************************************06830000
       7000-SELECT-TMLCNTL.                                             06840000
      ******************************************************************06850000
      *                                                                 06860000
           EXEC SQL                                                     06870000
               SELECT OPN_FSCL_MN_DTE,                                  06880000
                      OPN_FSCL_MN_NBR                                   06890000
               INTO  :PV-OPN-FSCL-MN-DTE,                               06900000
                     :PV-OPN-FSCL-MN-NBR                                06910000
               FROM TMLCNTL                                             06920000
W26603         WITH UR                                                  06930000
           END-EXEC.                                                    06940000
                                                                        06950000
           EVALUATE TRUE                                                06960000
               WHEN SQLCODE = ZERO                                      06970000
                   CONTINUE                                             06980000
               WHEN OTHER                                               06990000
                   MOVE '7000-SELECT-TMLCNTL'                           07000000
                                       TO AA-PARAGRAPH-NAME             07010000
                   MOVE 'TMLCNTL ROW NOT FOUND'                         07020000
                                       TO AA-MESSAGE                    07030000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              07040000
                   PERFORM 9901-SQL-ERROR                               07050000
           END-EVALUATE.                                                07060000
                                                                        07070000
       EJECT                                                            07080000
                                                                        07090000
      ******************************************************************07100000
W26603 7300-OPEN-CURSOR-XMT-LOC.                                        07110000
      ******************************************************************07120000
      *                                                                 07130000
                                                                        07140000
           EXEC SQL                                                     07150000
               OPEN LOC_CURSOR                                          07160001
           END-EXEC.                                                    07170000
                                                                        07180000
           EVALUATE TRUE                                                07190000
               WHEN SQLCODE = 0                                         07200000
                   CONTINUE                                             07210000
               WHEN OTHER                                               07220000
W26603             MOVE '7300-OPEN-CURSOR-XMT-LOC'                      07230000
                                       TO AA-PARAGRAPH-NAME             07240000
W26603             MOVE 'XMT_LOC TABLE ERROR'                           07250000
                                       TO AA-MESSAGE                    07260000
                   MOVE 'OPEN CURSOR'  TO AA-DB2-OPERATION              07270000
                   PERFORM 9901-SQL-ERROR                               07280000
           END-EVALUATE.                                                07290000
                                                                        07300000
       EJECT                                                            07310000
                                                                        07320000
      ******************************************************************07330000
W26603 7310-FETCH-XMT-LOC.                                              07340000
      ******************************************************************07350000
      *                                                                 07360000
           EXEC SQL                                                     07370000
               FETCH LOC_CURSOR                                         07380001
W26603         INTO  :XMT00001-LOC-NBR                                  07400000
           END-EXEC.                                                    07410000
                                                                        07420000
           EVALUATE TRUE                                                07430000
               WHEN SQLCODE = ZERO                                      07440000
W26603             ADD +1              TO PV-XMT-LOC-READ               07450000
               WHEN SQLCODE = +100                                      07460000
W26603             MOVE 'Y'            TO PS-XMT-LOC-DONE               07470000
               WHEN OTHER                                               07480000
W26603             MOVE '7310-FETCH-XMT-LOC'                            07490000
                                       TO AA-PARAGRAPH-NAME             07500000
W26603             MOVE 'XMT_LOC TABLE ERROR'                           07510000
                                       TO AA-MESSAGE                    07520000
                   MOVE 'FETCH'        TO AA-DB2-OPERATION              07530000
                   PERFORM 9901-SQL-ERROR                               07540000
           END-EVALUATE.                                                07550000
                                                                        07560000
       EJECT                                                            07570000
                                                                        07580000
      ******************************************************************07590000
W26603 7320-CLOSE-CURSOR-XMT-LOC.                                       07600000
      ******************************************************************07610000
      *                                                                 07620000
                                                                        07630000
           EXEC SQL                                                     07640000
               CLOSE LOC_CURSOR                                         07650001
           END-EXEC.                                                    07660000
                                                                        07670000
           EVALUATE TRUE                                                07680000
               WHEN SQLCODE = ZERO                                      07690000
                   CONTINUE                                             07700000
               WHEN OTHER                                               07710000
W26603             MOVE '7320-CLOSE-CURSOR-XMT-LOC'                     07720000
                                       TO AA-PARAGRAPH-NAME             07730000
W26603             MOVE 'XMT-LOC TABLE ERROR'                           07740000
                                       TO AA-MESSAGE                    07750000
                   MOVE 'CLOSE CURSOR' TO AA-DB2-OPERATION              07760000
                   PERFORM 9901-SQL-ERROR                               07770000
           END-EVALUATE.                                                07780000
                                                                        07790000
       EJECT                                                            07800000
                                                                        07810000
      ******************************************************************07820000
       7400-SELECT-TMDSEAR.                                             07830000
      ******************************************************************07840000
      *                                                                 07850000
           EXEC SQL                                                     07860000
               SELECT BYR_NBR,                                          07870000
                      GMA_NBR,                                          07880000
                      DMA_NBR,                                          07890000
                      MDSEAR_DESC                                       07900000
                 INTO :MDSEAR-BYR-NBR,                                  07910000
                      :MDSEAR-GMA-NBR,                                  07920000
                      :MDSEAR-DMA-NBR,                                  07930000
                      :MDSEAR-DESC                                      07940000
                 FROM TMDSEAR                                           07950000
                WHERE (DEPT_NBR   = :WS-TMNSCLS-DEPT-NBR)               07960000
                  AND (MAJ_CL_NBR   = :WS-TMNSCLS-MAJ-CL-NBR)           07970000
                  AND (OPERCO_NBR = '03')                               07980000
                  AND (MDSELV_CDE = 'MCL')                              07990000
                  AND (:PV-OPEN-FSCL-MN-END-DTE-18                      08000000
                    BETWEEN CHAR(STRT_DTE,ISO)                          08010000
                        AND CHAR(END_DTE,ISO))                          08020000
W26603         WITH UR                                                  08030000
           END-EXEC.                                                    08040000
                                                                        08050000
           EVALUATE TRUE                                                08060000
               WHEN SQLCODE = ZERO                                      08070000
                   ADD +1              TO PV-TMDSEAR-READ               08080000
               WHEN SQLCODE = +100                                      08090000
                   MOVE '999'          TO MDSEAR-BYR-NBR                08100000
                   MOVE '99'           TO MDSEAR-GMA-NBR                08110000
                   MOVE '99'           TO MDSEAR-DMA-NBR                08120000
                   MOVE 'UNKNOWN -- DEFAULT'                            08130000
                                       TO MDSEAR-DESC                   08140000
               WHEN OTHER                                               08150000
                   MOVE '7400-SELECT-TMDSEAR'                           08160000
                                       TO AA-PARAGRAPH-NAME             08170000
                   MOVE 'TMDSEAR TABLE ERROR'                           08180000
                                       TO AA-MESSAGE                    08190000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              08200000
                   PERFORM 9901-SQL-ERROR                               08210000
           END-EVALUATE.                                                08220000
                                                                        08230000
       EJECT                                                            08240000
                                                                        08250000
      ******************************************************************08260000
       7450-SELECT-TMDSEAR-DEPT.                                        08270000
      ******************************************************************08280000
      *                                                                 08290000
           EXEC SQL                                                     08300000
               SELECT MDSEAR_DESC                                       08310000
                 INTO :MDSEAR-DESC                                      08320000
                 FROM TMDSEAR                                           08330000
                WHERE (DEPT_NBR   = :SA-OLD-DEPT)                       08340000
                  AND (OPERCO_NBR = '03')                               08350000
                  AND (MDSELV_CDE = 'DPT')                              08360000
                  AND (:PV-OPEN-FSCL-MN-END-DTE-18                      08370000
                    BETWEEN CHAR(STRT_DTE,ISO)                          08380000
                        AND CHAR(END_DTE,ISO))                          08390000
W26603         WITH UR                                                  08400000
           END-EXEC.                                                    08410000
                                                                        08420000
           EVALUATE TRUE                                                08430000
               WHEN SQLCODE = ZERO                                      08440000
                   ADD +1              TO PV-TMDSEAR-READ               08450000
               WHEN SQLCODE = +100                                      08460000
                   MOVE 'UNKNOWN -- DEFAULT'                            08470000
                                       TO MDSEAR-DESC                   08480000
               WHEN OTHER                                               08490000
                   MOVE '7450-SELECT-TMDSEAR-DEPT'                      08500000
                                       TO AA-PARAGRAPH-NAME             08510000
                   MOVE 'TMDSEAR TABLE ERROR'                           08520000
                                       TO AA-MESSAGE                    08530000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              08540000
                   PERFORM 9901-SQL-ERROR                               08550000
           END-EVALUATE.                                                08560000
                                                                        08570000
       EJECT                                                            08580000
                                                                        08590000
      ******************************************************************08600000
       8000-EOJ.                                                        08610000
      ******************************************************************08620000
      *                                                                 08630000
           DISPLAY ' '.                                                 08640000
           DISPLAY '*** RECORD COUNT SUMMARY'.                          08650000
W26603     MOVE PV-XMT-LOC-READ          TO CD-COUNT-HOLD1.             08660000
W26603     DISPLAY 'XMT-LOC ROWS READ = ' CD-COUNT-HOLD1.               08670000
           MOVE PV-TMNSCLS-READ          TO CD-COUNT-HOLD1.             08680000
           DISPLAY 'TMNSCLS ROWS READ = ' CD-COUNT-HOLD1.               08690000
           MOVE PV-TWKSCLS-READ          TO CD-COUNT-HOLD1.             08700000
           DISPLAY 'TWKSCLS ROWS READ = ' CD-COUNT-HOLD1.               08710000
           MOVE PV-TMDSEAR-READ          TO CD-COUNT-HOLD1.             08720000
           DISPLAY 'TMDSEAR ROWS READ = ' CD-COUNT-HOLD1.               08730000
           DISPLAY ' '.                                                 08740000
           MOVE PV-TMNSCLS-BYPASSED      TO CD-COUNT-HOLD1.             08750000
           DISPLAY 'TMNSCLS ROWS BYPASSED FOR PROCESSING = '            08760000
                    CD-COUNT-HOLD1.                                     08770000
           DISPLAY ' '.                                                 08780000
           MOVE PV-DETAIL-STORE-RECS-WRITTEN                            08790000
                                         TO CD-COUNT-HOLD1.             08800000
           DISPLAY 'STORE DETAIL RECORDS WRITTEN = '                    08810000
                    CD-COUNT-HOLD1.                                     08820000
           MOVE PV-TOTAL-STORE-RECS-WRITTEN                             08830000
                                         TO CD-COUNT-HOLD1.             08840000
           DISPLAY 'STORE TOTAL RECORDS WRITTEN  = '                    08850000
                    CD-COUNT-HOLD1.                                     08860000
           MOVE PV-MAJ-CLASS-RECS-WRITTEN TO CD-COUNT-HOLD1.            08870000
           DISPLAY 'MAJOR CLASS RECORDS WRITTEN  = '                    08880000
                    CD-COUNT-HOLD1.                                     08890000
           MOVE PV-DEPT-RECS-WRITTEN     TO CD-COUNT-HOLD1.             08900000
           DISPLAY 'DEPARTMENT RECORDS WRITTEN  =  '                    08910000
                    CD-COUNT-HOLD1.                                     08920000
           MOVE PV-TOTAL-RECS-WRITTEN    TO CD-COUNT-HOLD1.             08930000
           DISPLAY 'TOTAL RECORDS WRITTEN =        '                    08940000
                    CD-COUNT-HOLD1.                                     08950000
                                                                        08960000
           CLOSE RANK-EXTRACT-FILE.                                     08970000
                                                                        08980000
       EJECT                                                            08990000
                                                                        09000000
      ******************************************************************09010000
       9900-COMMON-ABEND-ROUTINE.                                       09020000
      ******************************************************************09030000
      *                                                                 09040000
           DISPLAY AA-ABEND-LIT.                                        09050000
           DISPLAY AA-PROGRAM-LIT.                                      09060000
           DISPLAY AA-PARAGRAPH-LIT.                                    09070000
           DISPLAY AA-MESSAGE-LINE.                                     09080000
           DISPLAY ABEND-CODE.                                          09090000
                                                                        09100000
           CALL 'ILBOABN0' USING ABEND-CODE.                            09110000
                                                                        09120000
       EJECT                                                            09130000
                                                                        09140000
      ******************************************************************09150000
       9901-SQL-ERROR.                                                  09160000
      ******************************************************************09170000
      *                                                                 09180000
           CLOSE TMNSCLS-UNLOAD-FILE                                    09190000
                 TWKSCLS-UNLOAD-FILE                                    09200000
                 RANK-EXTRACT-FILE.                                     09210000
                                                                        09220000
           DISPLAY AA-ABEND-LIT.                                        09230000
           DISPLAY AA-DB2-ERROR-LIT.                                    09240000
           DISPLAY AA-PROGRAM-LIT.                                      09250000
           DISPLAY AA-PARAGRAPH-LIT.                                    09260000
           DISPLAY AA-MESSAGE-LINE.                                     09270000
           DISPLAY AA-DB2-OPERATION-LIT.                                09280000
           SET AC-DB2-ERROR TO TRUE.                                    09290000
           MOVE +4013                  TO ABEND-CODE.                   09300000
                                                                        09310000
           COPY DPPD004.                                                09320000
           CALL 'ILBOABN0' USING ABEND-CODE.                            09330000
                                                                        09340000
