000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT623.                                         00020000
000300 AUTHOR.        BUDDY BARNES.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   DEC, 2010.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*  AHKUT623.   "ARCHIVE HISTORY" PROJECT. DATA OFFLOAD.          *00090000
001000*                                                                *00100000
001000*                                                                *00101000
001100*  PURPOSE:                                                      *00102000
001200*  THIS PROGRAM TAKES A DRIVER FILE OF ROWS EXTRACTED FROM       *00103000
001300*  TIMCNTK IN ORDER TO CREATE AN ARCHIVE FILE OF TIMCNPO ROWS    *00104000
001300*  WHICH WILL THEN BE USED TO DELETE ROWS FROM TIMCNPO.          *00105000
001600*                                                                *00107000
001700*  PROCESSING OVERVIEW:                                          *00108000
001800*  THIS PROGRAM ACCESSES TIMCNPO AND BASED ON A DRIVER FILE      *00109000
001900*  OF TIMCNTK ROWS CREATING AN OUTPUT FILE OF RECORDS CONTAINING:*00110000
002100*  1) THE FULL ROW OF DATA FROM TIMCNPO                          *00130000
002200*  THESE RECORDS ARE SORTED FOR EASE                             *00140000
002300*  AND EFFICIENCY OF SUBSEQUENT PROCESSING.                      *00150000
002400*                                                                *00160000
002500*  FOR EACH CONTAINER/PO RETURNED THE FULL ROW OF DATA IS WRITTEN*00170000
002600*  TO THE EXTRACT FILE TO BE USED FOR ARCHIVING AND DELETING.    *00180000
003000******************************************************************00190000
006020******************************************************************00200000
006030 ENVIRONMENT DIVISION.                                            00210000
006040 CONFIGURATION SECTION.                                           00220000
006050 SOURCE-COMPUTER.        IBM-3090.                                00230000
006060 OBJECT-COMPUTER.        IBM-3090.                                00240000
006070                                                                  00250000
006080 INPUT-OUTPUT SECTION.                                            00260000
006090 FILE-CONTROL.                                                    00270000
006100                                                                  00280000
006200     SELECT  IN-DRIVER-FILE               ASSIGN TO INP01.        00290000
006200     SELECT  OUT-ARCHIVE-FILE             ASSIGN TO OUT01.        00291000
006300                                                                  00300000
006400 DATA DIVISION.                                                   00310000
006500 FILE SECTION.                                                    00320000
006600                                                                  00330000
006700 FD  IN-DRIVER-FILE                                               00340000
006800     RECORDING MODE IS F                                          00350000
006900     LABEL RECORDS ARE STANDARD                                   00360000
007000     BLOCK CONTAINS 0 RECORDS.                                    00370000
007100 01  IN-DRIVER-RECORD                PIC  X(672).                 00380000
007200                                                                  00390000
006600                                                                  00391000
006700 FD  OUT-ARCHIVE-FILE                                             00392000
006800     RECORDING MODE IS F                                          00393000
006900     LABEL RECORDS ARE STANDARD                                   00394000
007000     BLOCK CONTAINS 0 RECORDS.                                    00395000
007100 01  OUT-ARCHIVE-RECORD              PIC  X(266).                 00396006
007200                                                                  00397000
007300 WORKING-STORAGE SECTION.                                         00400000
007400                                                                  00410000
007500 01  PC-PROGRAM-CONSTANTS.                                        00420000
007600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT623'.  00430000
007700     05  PC-PGM-PROGRESS-DESC.                                    00440000
007800         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00450000
007800         10  PC-CONTINUING           PIC X(10) VALUE 'CONTINUING'.00460000
008500         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00470000
008600         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00480000
008700     05  PC-ABEND-INFO.                                           00490000
008800         10  PC-ABEND                PIC X(11) VALUE              00500000
008900                                               '** ABEND **'.     00510000
009000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00520000
009100                                               '- PARA       : '. 00530000
009200         10  PC-ABEND-MSG-DISPLAY-PARA                            00540000
009300                                     PIC X(15) VALUE              00550000
009400                                               '  CALLED PARA: '. 00560000
009500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00570000
009600                                               '  FOR ABEND# : '. 00580000
009700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00590000
009800                                               '- ERROR IS   : '. 00600000
009900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00610000
010000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00620000
010100                                               '- ACTION     : '. 00630000
010200     05  PC-TEST-AND-SET-NULL-IND.                                00640000
010300         10  PC-NOT-NULL             PIC S9(4) COMP               00650000
010400                                               VALUE ZERO.        00660000
010500         10  PC-NULL                 PIC S9(4) COMP               00670000
010600                                               VALUE -1.          00680000
010700         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00690000
010800                                               VALUE -2.          00700000
010900         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00710000
011000                                                                  00720000
011100     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 010000.      00730000
011200                                                                  00740000
011300 01  PS-PROGRAM-SWITCHES.                                         00750000
011400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00760000
011500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00770000
011600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00780000
008900     05  PS-DRIVER-FILE-SW        PIC  X(01)    VALUE 'Y'.        00781003
009000         88  MORE-DRIVER                        VALUE 'Y'.        00782003
009100         88  END-OF-DRIVER                      VALUE 'N'.        00783003
012000                                                                  00790000
012100 01  PV-PROGRAM-VARIABLES.                                        00800000
012400     05  DISPLAY-CNTR-NBR            PIC  X(12) VALUE SPACES.     00810000
012500     05  PV-PRG-TMST                 PIC X(26) VALUE SPACES.      00820000
012600     05  PV-PRG-TMST-DETAIL REDEFINES PV-PRG-TMST.                00830000
012700         10  PV-PRG-DATE             PIC X(10).                   00840000
012800         10  PV-PRG-TIME             PIC X(16).                   00850000
013000     05  PV-TABLE-ROW-FETCHED-CNT    PIC  9(9) VALUE 0.           00860000
013100     05  PV-ARCHIVE-WRITTEN-CNT       PIC  9(9) VALUE 0.          00870001
006800     05  PV-TIMCNTK-INPUT-COUNT   PIC 9(09)     VALUE ZERO        00871005
006900                                                COMP-3.           00872005
013800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00880000
013900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00890000
014000     05  PV-DB2-TABLE-NAME-1         PIC X(18) VALUE SPACES.      00900000
014100     05  PV-DB2-TABLE-NAME-2         PIC X(18) VALUE SPACES.      00910000
014200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           00920000
014300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           00930000
014400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        00940000
014500                                                                  00941001
014600     05  PV-TMST                     PIC X(26) VALUE SPACES.      00942001
014700     05  PV-TIMESTAMP-DETAIL                                      00943001
014800         REDEFINES                                                00944001
014900         PV-TMST.                                                 00945001
015000         10  PV-TIMESTAMP-19.                                     00946001
015100             15  PV-TMS-DATE.                                     00947001
015200                 20  PV-TMS-YEAR.                                 00948001
015300                     25  PV-TMS-CC   PIC X(02).                   00949001
015400                     25  PV-TMS-YY   PIC X(02).                   00949101
015500                 20  FILLER          PIC X(01).                   00949201
015600                 20  PV-TMS-MONTH    PIC X(02).                   00949301
015700                 20  FILLER          PIC X(01).                   00949401
015800                 20  PV-TMS-DAY      PIC X(02).                   00949501
015900             15  FILLER              PIC X(01).                   00949601
016000             15  PV-TMS-HOUR         PIC X(02).                   00949701
016100             15  FILLER              PIC X(01).                   00949801
016200             15  PV-TMS-MINUTE       PIC X(02).                   00949901
016300             15  FILLER              PIC X(01).                   00950001
016400             15  PV-TMS-SECOND       PIC X(02).                   00951001
016500         10  FILLER                  PIC X(01).                   00952001
016600         10  PV-TMS-MSECOND          PIC X(06).                   00953001
014500                                                                  00960000
018200*---------------------------------------------------------------* 01280000
018300*  RECORD LAYOUT FOR DRIVER FILE.                               * 01290000
018400*---------------------------------------------------------------* 01300000
018500     COPY AHRD007.                                                01310000
018700                                                                  01320000
018200*---------------------------------------------------------------* 01321000
018300*  RECORD LAYOUT FOR ARCHIVE FILE.                              * 01322000
018400*---------------------------------------------------------------* 01323000
018500     COPY AHRD008.                                                01324000
018700                                                                  01325000
018800 01  DM-DISPLAY-MESSAGE.                                          01330000
018900     05  DM-01-10.                                                01340000
019000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01350000
019100         10  FILLER                  PIC X(02) VALUE ': '.        01360000
019200     05  DM-11-80.                                                01370000
019300         10  FILLER                  PIC X(27) VALUE              01380000
019400                                    'BEGIN DRIVER FILE CREATION.'.01390000
019500         10  FILLER                  PIC X(01) VALUE SPACE.       01400000
019600         10  FILLER                  PIC X(42) VALUE ALL '*'.     01410000
019700     05  DM-81-120.                                               01420000
019800         10  FILLER                  PIC X(40) VALUE ALL '*'.     01430000
019900                                                                  01440000
020000 01  DP-DISPLAY-PROGRESS-MSG.                                     01450000
020100     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01460000
020200     05  FILLER                      PIC X(02) VALUE SPACE.       01470000
020300     05  DP-STATUS-DESCRIPTION       PIC X(13) VALUE SPACE.       01480000
020400     05  FILLER                      PIC X(04) VALUE ' AT '.      01490000
020500     05  DP-TIMESTAMP                PIC X(26) VALUE SPACE.       01500000
020600     05  FILLER                      PIC X(03) VALUE '.  '.       01510000
020700     05  FILLER                      PIC X(09) VALUE 'FETCHES: '. 01520000
020800     05  DP-TABLE-ROW-FETCHED-CNT    PIC ZZZ,ZZZ,ZZ9              01530000
020900                                               VALUE ZERO.        01540000
021000     05  FILLER                      PIC X(02) VALUE ', '.        01550000
021100     05  FILLER                      PIC X(09) VALUE 'WRITTEN: '. 01560000
021200     05  DP-DRIVER-WRITTEN-CNT       PIC ZZZ,ZZZ,ZZ9              01570000
021300                                               VALUE ZERO.        01580000
021400     05  FILLER                      PIC X(01) VALUE '.'.         01590000
021500                                                                  01600000
021600 01  ABEND-CODE                      PIC S9(04)                   01610000
021700                                               VALUE ZEROES       01620000
021800                                               COMP SYNC.         01630000
021900                                                                  01640000
022000*---------------------------------------------------------------* 01650000
022100*  DB2 FORMATTED MESSAGE AREA                                     01660000
022200*---------------------------------------------------------------* 01670000
022300     COPY DPWS004.                                                01680000
022400                                                                  01690000
022500*---------------------------------------------------------------* 01700000
022600*    DB2 AREA FOR TIMCNPO                                       * 01710000
022700*---------------------------------------------------------------* 01720000
022800     EXEC SQL                                                     01730000
022900          INCLUDE TIMCNPO                                         01740000
023000     END-EXEC.                                                    01750000
023100                                                                  01760000
023200*---------------------------------------------------------------* 01770000
023300*    DB2 AREA FOR SYSDUMMY                                      * 01780000
023400*---------------------------------------------------------------* 01790000
023500     EXEC SQL                                                     01800000
023600          INCLUDE SYSDUMMY                                        01810000
023700     END-EXEC.                                                    01820000
023800                                                                  01830000
023900*---------------------------------------------------------------* 01840000
024000*    DB2 AREA FOR COMMUNICATIONS                                * 01850000
024100*---------------------------------------------------------------* 01860000
024200     EXEC SQL                                                     01870000
024300          INCLUDE SQLCA                                           01880000
024400     END-EXEC.                                                    01890000
024500                                                                  01900000
024600*---------------------------------------------------------------* 01910000
024700*    DEFINE CURSOR FOR ACCESSING TIMCNPO                        * 01920000
024800*---------------------------------------------------------------* 01930000
024900     EXEC SQL                                                     01940000
025000         DECLARE TABLE-CURSOR CURSOR FOR                          01950000
025100           SELECT                                                 01960000
025200              CONTNR_ID                                           01970000
025300             ,CONTNR_SEQ_NBR                                      01980000
025400             ,PO_NBR                                              01990001
025500             ,CSTM_ENTR_ID                                        02000001
025600             ,MSTR_BOL_NBR                                        02010001
025700             ,HSE_BOL_NBR                                         02020001
025800             ,LTR_OF_CR_NBR                                       02030001
025900             ,PO_RCVD_DELY_TMST                                   02040001
026000             ,PO_C_O_PROD_CDE                                     02050001
026100             ,PO_CART_CNT                                         02060001
026200             ,PO_CBMT_QTY                                         02070001
026300             ,PO_WT_KGRM_QTY                                      02080001
026400             ,PO_UNT_QTY                                          02090001
026500             ,CRE_BY_USR_ID                                       02100001
026600             ,CRE_TMST                                            02110001
026700             ,LAST_UPD_BY_USR_ID                                  02120001
026800             ,LAST_UPD_TMST                                       02130001
026900             ,EXTL_REF_NBR                                        02140001
027000             ,BKR_FRGT_RLSE_CDE                                   02150001
027100             ,DO_RCVD_CDE                                         02160001
027200             ,CONTNR_PU_CDE                                       02170001
027300             ,ACTL_POE_DELY_CDE                                   02180001
027400             ,DVN_CDE                                             02190001
027500             ,DCONSLR_RET_CDE                                     02200001
027600             ,SPLT_XMIT_CDE                                       02210001
027700             ,DOC_RCVD_ORGN_TMST                                  02220001
027700             ,DCONSLR_DELY_CDE                                    02230001
027900             FROM TIMCNPO                                         02470000
028100            WHERE CONTNR_ID = :AH007-CONTNR-ID                    02480000
028100              AND CONTNR_SEQ_NBR = :AH007-CONTNR-SEQ-NBR          02481004
028500         FOR FETCH ONLY                                           02510000
028600         WITH UR                                                  02520000
028700         OPTIMIZE FOR 1 ROW                                       02530000
028800     END-EXEC.                                                    02540000
029000                                                                  02550000
029100 PROCEDURE DIVISION.                                              02560000
029200                                                                  02570000
029300 0000-PROGRAM-MAINLINE.                                           02580000
029400                                                                  02590000
029500     PERFORM 1000-INITIALIZE.                                     02600000
029600                                                                  02610000
029700     PERFORM 1500-READ-DRIVER-RECORD                              02620002
029800         UNTIL END-OF-DRIVER.                                     02630003
029900                                                                  02640000
030000     PERFORM 6000-EOJ-ROUTINE.                                    02650000
030100     STOP RUN.                                                    02660000
030200                                                                  02670000
030400******************************************************************02680000
030500*  INITIALIZATIONS                                               *02690000
030600******************************************************************02700000
030700 1000-INITIALIZE.                                                 02710000
030800                                                                  02720000
030900     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02730000
031000     DISPLAY DM-DISPLAY-MESSAGE.                                  02740000
031400                                                                  02750000
031500     OPEN INPUT  IN-DRIVER-FILE.                                  02760000
031500     OPEN OUTPUT OUT-ARCHIVE-FILE.                                02761000
031200     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02850000
032500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02860000
033100     INITIALIZE DCLTIMCNPO                                        02900000
033200                AH008-ARCHIVE-RECORD-LAYOUT.                      02910001
033800                                                                  02970000
031200 1500-READ-DRIVER-RECORD.                                         02972103
031400     READ IN-DRIVER-FILE INTO AH007-DRIVER-RECORD-LAYOUT          02972303
031600          AT END SET END-OF-DRIVER  TO TRUE.                      02972403
031700                                                                  02972503
031800     IF MORE-DRIVER                                               02972603
031900         ADD 1 TO PV-TIMCNTK-INPUT-COUNT                          02972703
029600                                                                  02973203
032600         SET PS-TABLE-LOOP-NOT-DONE TO TRUE                       02973303
032700         PERFORM 9100-OPEN-TABLE-CURSOR                           02973403
033000                                                                  02973503
029700         PERFORM 2000-GET-NEXT-FROM-CURSOR                        02973603
029800             UNTIL PS-TABLE-LOOP-DONE                             02973703
                                                                        02973803
032700         PERFORM 9130-CLOSE-TABLE-CURSOR                          02973905
032000     END-IF.                                                      02974003
                                                                        02975003
033900******************************************************************02980000
034000*  FETCH NEXT FROM CURSOR & WRITE OUTPUT DRIVER FILE RECORD.     *02990000
034100******************************************************************03000000
034200 2000-GET-NEXT-FROM-CURSOR.                                       03010000
034300                                                                  03020000
036900     PERFORM 9110-FETCH-TABLE-CURSOR.                             03021003
           IF SQLCODE = 0                                               03022003
034400         MOVE IMCNPO-CONTNR-ID  TO DISPLAY-CNTR-NBR               03030003
034410*        DISPLAY 'FETCHED CONTAINER = ' DISPLAY-CNTR-NBR          03040003
034610                                                                  03050000
036100         PERFORM 2010-POPULATE-ARCHIVE-RECORD                     03060003
036200         PERFORM 9650-WRITE-ARCHIVE-RECORD                        03070003
036300         PERFORM 2100-CHECK-PGM-PROGRESS                          03080003
036600     END-IF.                                                      03090003
037100******************************************************************03140000
037200*  MOVE COLUMNS FROM TABLES TO FIELDS IN ARCHIVE FILE RECORD.    *03150007
037300******************************************************************03160000
037400 2010-POPULATE-ARCHIVE-RECORD.                                    03170002
037500                                                                  03180000
           MOVE IMCNPO-CONTNR-ID          TO   AH008-CONTNR-ID.         04070503
           MOVE IMCNPO-CONTNR-SEQ-NBR     TO   AH008-CONTNR-SEQ-NBR.    04070603
           MOVE IMCNPO-PO-NBR             TO   AH008-PO-NBR.            04070703
           MOVE IMCNPO-CSTM-ENTR-ID       TO   AH008-CSTM-ENTR-ID.      04070803
           MOVE IMCNPO-MSTR-BOL-NBR       TO   AH008-MSTR-BOL-NBR.      04070903
           MOVE IMCNPO-HSE-BOL-NBR        TO   AH008-HSE-BOL-NBR.       04071003
           MOVE IMCNPO-LTR-OF-CR-NBR      TO   AH008-LTR-OF-CR-NBR.     04071103
           MOVE IMCNPO-PO-RCVD-DELY-TMST  TO   AH008-PO-RCVD-DELY-TMST. 04071203
           MOVE IMCNPO-PO-C-O-PROD-CDE    TO   AH008-PO-C-O-PROD-CDE.   04071303
           MOVE IMCNPO-PO-CART-CNT        TO   AH008-PO-CART-CNT.       04071403
           MOVE IMCNPO-PO-CBMT-QTY        TO   AH008-PO-CBMT-QTY.       04071503
           MOVE IMCNPO-PO-WT-KGRM-QTY     TO   AH008-PO-WT-KGRM-QTY.    04071703
           MOVE IMCNPO-PO-UNT-QTY         TO   AH008-PO-UNT-QTY.        04071803
           MOVE IMCNPO-CRE-BY-USR-ID      TO   AH008-CRE-BY-USR-ID.     04071903
           MOVE IMCNPO-CRE-TMST           TO   AH008-CRE-TMST.          04072003
           MOVE IMCNPO-LAST-UPD-BY-USR-ID TO   AH008-LAST-UPD-BY-USR-ID.04072103
           MOVE IMCNPO-LAST-UPD-TMST      TO   AH008-LAST-UPD-TMST.     04072203
           MOVE IMCNPO-EXTL-REF-NBR       TO   AH008-EXTL-REF-NBR.      04072303
           MOVE IMCNPO-BKR-FRGT-RLSE-CDE  TO   AH008-BKR-FRGT-RLSE-CDE. 04072403
           MOVE IMCNPO-DO-RCVD-CDE        TO   AH008-DO-RCVD-CDE.       04072503
           MOVE IMCNPO-CONTNR-PU-CDE      TO   AH008-CONTNR-PU-CDE.     04072603
           MOVE IMCNPO-ACTL-POE-DELY-CDE  TO   AH008-ACTL-POE-DELY-CDE. 04072703
           MOVE IMCNPO-DVN-CDE            TO   AH008-DVN-CDE.           04072803
           MOVE IMCNPO-DCONSLR-RET-CDE    TO   AH008-DCONSLR-RET-CDE.   04072903
           MOVE IMCNPO-SPLT-XMIT-CDE      TO   AH008-SPLT-XMIT-CDE.     04073003
           MOVE IMCNPO-DOC-RCVD-ORGN-TMST TO   AH008-DOC-RCVD-ORGN-TMST.04073103
           MOVE IMCNPO-DCONSLR-DELY-CDE   TO   AH008-DCONSLR-DELY-CDE.  04073203
042200                                                                  04073303
040700******************************************************************04073403
040800*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *04073503
040900*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *04073603
041000*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *04073703
041100******************************************************************04073803
041200 2100-CHECK-PGM-PROGRESS.                                         04073903
041300     DIVIDE    PV-ARCHIVE-WRITTEN-CNT                             04074003
041400         BY        PC-HOW-OFTEN-TO-DISPLAY                        04074100
041500         GIVING    PV-DISPLAY-NTH-MULTIPLE                        04075000
041600         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      04076000
041700                                                                  04077000
041800     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           04078000
041900         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      04079000
042000         PERFORM 6200-DISPLAY-PGM-PROGRESS                        04080000
042100     END-IF.                                                      04090000
042200                                                                  04100000
046400******************************************************************04110000
046500*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *04120000
046600******************************************************************04130000
046700 6000-EOJ-ROUTINE.                                                04140000
046800                                                                  04150000
047100     CLOSE IN-DRIVER-FILE.                                        04160001
047100     CLOSE OUT-ARCHIVE-FILE.                                      04161001
047200                                                                  04170000
046900     MOVE PC-ENDING  TO  DP-STATUS-DESCRIPTION.                   04200000
047500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04210000
047600                                                                  04220000
047700     DISPLAY 'TOTAL CONTAINER/PO PROCESSED = '                    04230001
047700                                  PV-ARCHIVE-WRITTEN-CNT.         04240001
047900                                                                  04250000
048000******************************************************************04260000
048100*  DISPLAY PROGRAM PROGRESS.                                     *04270000
048200******************************************************************04280000
048300 6200-DISPLAY-PGM-PROGRESS.                                       04290000
048400                                                                  04300000
048500     EXEC SQL                                                     04310000
048600          SET :PV-TMST = CURRENT TIMESTAMP                        04320000
048700     END-EXEC.                                                    04330000
048800                                                                  04340000
048900     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                04350000
049000     MOVE PV-TMST                   TO DP-TIMESTAMP.              04360000
049100     MOVE PV-TABLE-ROW-FETCHED-CNT  TO DP-TABLE-ROW-FETCHED-CNT.  04370000
049200     MOVE PV-ARCHIVE-WRITTEN-CNT     TO DP-DRIVER-WRITTEN-CNT.    04380001
049300                                                                  04390000
049400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             04400000
049600                                                                  04410000
049700******************************************************************04420000
049800*  OPEN   TABLE CURSOR                                           *04430000
049900******************************************************************04440000
050000 9100-OPEN-TABLE-CURSOR.                                          04450000
050100     EXEC SQL                                                     04460000
050200          OPEN TABLE-CURSOR                                       04470000
050300     END-EXEC.                                                    04480000
050400                                                                  04490000
050500     EVALUATE TRUE                                                04500000
050600         WHEN SQLCODE = ZERO                                      04510000
050700              CONTINUE                                            04520000
050800         WHEN SQLCODE = +100                                      04530000
050900              SET PS-TABLE-LOOP-DONE TO TRUE                      04540000
051000              MOVE '9100-OPEN-TABLE-CURSOR'                       04550000
051100                                 TO PV-PARAGRAPH-NAME             04560000
051200              MOVE 'OPEN TABLE CURSOR - NO ROWS SELECTED'         04570000
051300                                 TO PV-DB2-OPERATION-MSG-1        04580000
051400              MOVE 'TIMCNPO'     TO PV-DB2-TABLE-NAME-1           04590000
051500              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           04600000
051600              PERFORM 9999-DB2-ABEND                              04610000
051700         WHEN SQLWARN0 NOT EQUAL SPACE                            04620000
051800         WHEN SQLCODE  NOT EQUAL ZERO                             04630000
051900              MOVE '9100-OPEN-TABLE-CURSOR'                       04640000
052000                                 TO PV-PARAGRAPH-NAME             04650000
052100              MOVE 'OPEN TABLE CURSOR'                            04660000
052200                                 TO PV-DB2-OPERATION-MSG-1        04670000
052300              MOVE 'TIMCNPO'     TO PV-DB2-TABLE-NAME-1           04680000
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           04690000
052500              PERFORM 9999-DB2-ABEND                              04700000
052600     END-EVALUATE.                                                04710000
052700                                                                  04720000
052900******************************************************************04730000
053000*  FETCH TABLE CURSOR                                            *04740000
053100******************************************************************04750000
053200 9110-FETCH-TABLE-CURSOR.                                         04760000
053300     EXEC SQL                                                     04770000
053400         FETCH TABLE-CURSOR                                       04780000
053500          INTO  :IMCNPO-CONTNR-ID                                 04790002
053600               ,:IMCNPO-CONTNR-SEQ-NBR                            04800002
053700               ,:IMCNPO-PO-NBR                                    04810002
053800               ,:IMCNPO-CSTM-ENTR-ID                              04820002
053900               ,:IMCNPO-MSTR-BOL-NBR                              04830002
054000               ,:IMCNPO-HSE-BOL-NBR                               04840002
054100               ,:IMCNPO-LTR-OF-CR-NBR                             04850002
054200               ,:IMCNPO-PO-RCVD-DELY-TMST                         04860002
054300               ,:IMCNPO-PO-C-O-PROD-CDE                           04870002
054400               ,:IMCNPO-PO-CART-CNT                               04880002
054500               ,:IMCNPO-PO-CBMT-QTY                               04890002
054600               ,:IMCNPO-PO-WT-KGRM-QTY                            04900002
054700               ,:IMCNPO-PO-UNT-QTY                                04910002
054800               ,:IMCNPO-CRE-BY-USR-ID                             04920002
054900               ,:IMCNPO-CRE-TMST                                  04930002
055000               ,:IMCNPO-LAST-UPD-BY-USR-ID                        04940002
055100               ,:IMCNPO-LAST-UPD-TMST                             04950002
055200               ,:IMCNPO-EXTL-REF-NBR                              04960002
055300               ,:IMCNPO-BKR-FRGT-RLSE-CDE                         04970002
055400               ,:IMCNPO-DO-RCVD-CDE                               04980002
055500               ,:IMCNPO-CONTNR-PU-CDE                             04990002
055600               ,:IMCNPO-ACTL-POE-DELY-CDE                         05000002
055700               ,:IMCNPO-DVN-CDE                                   05010002
055800               ,:IMCNPO-DCONSLR-RET-CDE                           05020002
055900               ,:IMCNPO-SPLT-XMIT-CDE                             05030002
056000               ,:IMCNPO-DOC-RCVD-ORGN-TMST                        05040002
056100               ,:IMCNPO-DCONSLR-DELY-CDE                          05050002
056300     END-EXEC.                                                    05290000
056400                                                                  05300000
056500     EVALUATE TRUE                                                05310000
056600         WHEN SQLCODE = ZERO                                      05320000
056700              ADD +1                 TO PV-TABLE-ROW-FETCHED-CNT  05330000
056800         WHEN SQLCODE = +100                                      05340000
056900              SET PS-TABLE-LOOP-DONE TO TRUE                      05350000
057000         WHEN SQLWARN0 NOT EQUAL SPACE                            05360000
057100         WHEN SQLCODE NOT EQUAL ZERO                              05370000
057200              MOVE '9110-FETCH-TABLE-CURSOR'                      05380000
057300                                 TO PV-PARAGRAPH-NAME             05390000
057400              MOVE 'FETCH TABLE CURSOR'                           05400000
057500                                 TO PV-DB2-OPERATION-MSG-1        05410000
057600              MOVE 'TIMCNPO'     TO PV-DB2-TABLE-NAME-1           05420000
057700              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           05430000
057800              PERFORM 9999-DB2-ABEND                              05440000
057900     END-EVALUATE.                                                05450000
058100                                                                  05460000
058200******************************************************************05470000
058300*  CLOSE TABLE CURSOR                                            *05480000
058400******************************************************************05490000
058500 9130-CLOSE-TABLE-CURSOR.                                         05500000
058600     EXEC SQL                                                     05510000
058700          CLOSE TABLE-CURSOR                                      05520000
058800     END-EXEC.                                                    05530000
058900                                                                  05540000
059000     EVALUATE TRUE                                                05550000
059100         WHEN SQLCODE = ZERO                                      05560000
059200              CONTINUE                                            05570000
059300         WHEN SQLWARN0 NOT EQUAL SPACE                            05580000
059400         WHEN SQLCODE NOT EQUAL ZERO                              05590000
059500              MOVE '9130-CLOSE-TABLE-CURSOR'                      05600000
059600                                 TO PV-PARAGRAPH-NAME             05610000
059700              MOVE 'CLOSE TABLE CURSOR'                           05620000
059800                                 TO PV-DB2-OPERATION-MSG-1        05630000
059900              MOVE 'TIMCNPO'     TO PV-DB2-TABLE-NAME-1           05640000
060000              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           05650000
060100              PERFORM 9999-DB2-ABEND                              05660000
060200     END-EVALUATE.                                                05670000
060600                                                                  05680000
060700******************************************************************05690000
060800*  WRITE A RECORD TO THE DRIVER FILE                             *05700000
060900******************************************************************05710000
061000 9650-WRITE-ARCHIVE-RECORD.                                       05720002
061100     WRITE  OUT-ARCHIVE-RECORD  FROM  AH008-ARCHIVE-RECORD-LAYOUT.05730001
061200     ADD +1 TO PV-ARCHIVE-WRITTEN-CNT.                            05740001
061400                                                                  05750000
061700******************************************************************05760000
061800*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *05770000
061900*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *05780000
062000*  SQL ERROR OR WARNING CODE OCCURS.                             *05790000
062100******************************************************************05800000
062200 9999-DB2-ABEND.                                                  05810000
062300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05820000
062400             ' 9999-DB2-ABEND'.                                   05830000
062500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05840000
062600             ' ** ABEND           **'.                            05850000
062700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05860000
062800             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05870000
062900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05880000
063000             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.     05890000
063100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05900000
063200             ' **                 ** = ' PV-DB2-TABLE-NAME-2.     05910000
063300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05920000
063400             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05930000
063500                                                                  05940000
063600     DISPLAY PC-CURRENT-PROGRAM-NAME                              05950000
063700             ' ** SQLCODE         ** = ' SQLCODE.                 05960000
063800     MOVE SQLCODE TO PV-SQLCODE.                                  05970000
063900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05980000
064000             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05990000
064100                                                                  06000000
064200     DISPLAY PC-CURRENT-PROGRAM-NAME                              06010000
064300             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            06020000
064400                                                                  06030000
064600*----------------------------------------------------------------*06040000
064700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *06050000
064800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *06060000
064900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *06070000
065000* FORMAT.                                                        *06080000
065100*----------------------------------------------------------------*06090000
065200     COPY DPPD004.                                                06100000
065300                                                                  06110000
065400     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     06120000
065500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           06130000
065700                                                                  06140000
065800*----------------------------------------------------------------*06150000
065900* CALL ABEND                                                     *06160000
066000*----------------------------------------------------------------*06170000
066100     MOVE +4013                  TO ABEND-CODE.                   06180000
066200     CALL 'ILBOABN0' USING ABEND-CODE.                            06190000
