000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SVKRP016.                                00050000
000600 AUTHOR.                 JEFF BOLWERK.                            00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            AUGUST, 1996.                            00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*                                                                 00120000
001300*  CREATE REPORT OF ALL KMRC AND GIFT CARD CONTROL AND CARD       00130000
001400*  NUMBERS THAT WERE SELECTED TO BE EMBOSSED.                     00140000
001500******************************************************************00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700******************************************************************00170000
001800                                                                  00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT KMRC-EXTRACT-FILE                                     00280000
002900         ASSIGN TO INP01.                                         00290000
003000                                                                  00300000
003100     SELECT GIFT-EXTRACT-FILE                                     00310000
003200         ASSIGN TO INP02.                                         00320000
003300                                                                  00330000
003400     SELECT KMRC-CNTL-RECORD-DETAIL-REPORT                        00340000
003500         ASSIGN TO RPT01.                                         00350000
003600                                                                  00360000
003700     SELECT GIFT-CNTL-RECORD-DETAIL-REPORT                        00370000
003800         ASSIGN TO RPT02.                                         00380000
003900                                                                  00390000
004000******************************************************************00400000
004100 DATA DIVISION.                                                   00410000
004200******************************************************************00420000
004300                                                                  00430000
004400 FILE SECTION.                                                    00440000
004500                                                                  00450000
004600 FD  KMRC-EXTRACT-FILE                                            00460000
004700     RECORDING MODE IS F                                          00470000
004800     LABEL RECORDS ARE STANDARD                                   00480000
004900     BLOCK CONTAINS 0 RECORDS.                                    00490000
005000                                                                  00500000
005110 01  KMRC-EXTRACT-RECORD                 PIC X(182).              00511054
005200                                                                  00520000
005300                                                                  00530000
005400 FD  GIFT-EXTRACT-FILE                                            00540000
005500     RECORDING MODE IS F                                          00550000
005600     LABEL RECORDS ARE STANDARD                                   00560000
005700     BLOCK CONTAINS 0 RECORDS.                                    00570000
005800                                                                  00580000
005901 01  GIFT-EXTRACT-RECORD                 PIC X(182).              00590154
006000                                                                  00600000
006100                                                                  00610000
006200 FD  KMRC-CNTL-RECORD-DETAIL-REPORT                               00620000
006300     RECORDING MODE IS F                                          00630000
006400     LABEL RECORDS ARE STANDARD                                   00640000
006500     BLOCK CONTAINS 0 RECORDS.                                    00650000
006600                                                                  00660000
006700 01  KMRC-CNTL-RECORD-DETAIL-LINE        PIC X(132).              00670000
006800                                                                  00680000
006900 FD  GIFT-CNTL-RECORD-DETAIL-REPORT                               00690000
007000     RECORDING MODE IS F                                          00700000
007100     LABEL RECORDS ARE STANDARD                                   00710000
007200     BLOCK CONTAINS 0 RECORDS.                                    00720000
007300                                                                  00730000
007400 01  GIFT-CNTL-RECORD-DETAIL-LINE        PIC X(132).              00740000
007500                                                                  00750000
007600******************************************************************00760000
007700 WORKING-STORAGE SECTION.                                         00770000
007800******************************************************************00780000
007900                                                                  00790000
008000*                                                                 00800000
008100*  KOHL'S STANDARD REPORT HEADER FOR 132 COLUMN REPORT            00810000
008200*                                                                 00820000
008300                                                                  00830000
008400     COPY DPWS132O.                                               00840000
008500                                                                  00850000
008600*                                                                 00860000
008700*  KOHL'S KMRC CONTROL NUMBER EXTRACT FILE                        00870000
008800*                                                                 00880000
008900                                                                  00890000
009000     COPY SVRD006.                                                00900000
009100*                                                                 00910000
009200*  KOHL'S GIFT CARD CONTROL NUMBER EXTRACT FILE                   00920000
009300*                                                                 00930000
009400                                                                  00940000
009500     COPY SVRD008.                                                00950000
009600                                                                  00960000
009700                                                                  00970000
009800 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00980000
009900                                                     COMP SYNC.   00990000
010000                                                                  01000000
010100 01  HL1-HEADING-LINE-1.                                          01010000
010200     05  FILLER                        PIC  X(42)  VALUE SPACES.  01020000
010300     05  FILLER                        PIC  X(04)  VALUE SPACES.  01030000
010400     05  HL-1-MEMBER-NAME              PIC  X(08)  VALUE SPACES.  01040000
010500     05  FILLER                        PIC  X(03)  VALUE          01050000
010600                                                   ' - '.         01060000
010700     05  HL-1-DESC                     PIC  X(32)  VALUE SPACES.  01070000
010800     05  FILLER                        PIC  X(43)  VALUE SPACES.  01080000
010900 01  HL1-HEADING-LINE-1A.                                         01090000
011000     05  FILLER                        PIC  X(37)  VALUE SPACES.  01100000
011100     05  HL-1A-DESC                    PIC  X(58)  VALUE SPACES.  01110000
011200     05  FILLER                        PIC  X(37)  VALUE SPACES.  01120000
011300                                                                  01130000
011400 01  HL2-HEADING-LINE-2.                                          01140000
011500     05  FILLER                        PIC  X(10)  VALUE SPACES.  01150000
011600     05  FILLER                        PIC  X(07)  VALUE          01160000
011700         'CONTROL'.                                               01170000
011800     05  FILLER                        PIC  X(08)  VALUE SPACES.  01180000
011900     05  FILLER                        PIC  X(04)  VALUE 'CARD'.  01190000
012000     05  FILLER                        PIC  X(13)  VALUE SPACES.  01200000
012100     05  FILLER                        PIC  X(07)  VALUE          01210000
012200         'CONTROL'.                                               01220000
012300     05  FILLER                        PIC  X(08)  VALUE SPACE.   01230000
012400     05  FILLER                        PIC  X(04)  VALUE 'CARD'.  01240000
012500     05  FILLER                        PIC  X(12)  VALUE SPACES.  01250000
012600     05  FILLER                        PIC  X(07)  VALUE          01260000
012700         'CONTROL'.                                               01270000
012800     05  FILLER                        PIC  X(09)  VALUE SPACE.   01280000
012900     05  FILLER                        PIC  X(04)  VALUE 'CARD'.  01290000
013000     05  FILLER                        PIC  X(11)  VALUE SPACES.  01300000
013100     05  FILLER                        PIC  X(07)  VALUE          01310000
013200         'CONTROL'.                                               01320000
013300     05  FILLER                        PIC  X(08)  VALUE SPACE.   01330000
013400     05  FILLER                        PIC  X(04)  VALUE 'CARD'.  01340000
013500     05  FILLER                        PIC  X(09)  VALUE SPACE.   01350000
013600                                                                  01360000
013700 01  HL3-HEADING-LINE-3.                                          01370000
013800     05  FILLER                        PIC  X(10)  VALUE SPACE.   01380000
013900     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01390000
014000     05  FILLER                        PIC  X(08)  VALUE SPACE.   01400000
014100     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01410000
014200     05  FILLER                        PIC  X(12)  VALUE SPACE.   01420000
014300     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01430000
014400     05  FILLER                        PIC  X(08)  VALUE SPACE.   01440000
014500     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01450000
014600     05  FILLER                        PIC  X(11)  VALUE SPACE.   01460000
014700     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01470000
014800     05  FILLER                        PIC  X(09)  VALUE SPACE.   01480000
014900     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01490000
015000     05  FILLER                        PIC  X(10)  VALUE SPACE.   01500000
015100     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01510000
015200     05  FILLER                        PIC  X(08)  VALUE SPACE.   01520000
015300     05  FILLER                        PIC  X(06)  VALUE 'NUMBER'.01530000
015400     05  FILLER                        PIC  X(08)  VALUE SPACE.   01540000
015500                                                                  01550000
015600 01  DL-DETAIL-LINE.                                              01560000
015700     05  FILLER                        PIC  X(05)  VALUE SPACE.   01570000
015800     05  DL-CNTL-NBR-1                 PIC  X(14)  VALUE ZEROS.   01580000
015900     05  FILLER                        PIC  X(02)  VALUE SPACE.   01590000
016000     05  DL-CARD-NBR-1                 PIC  X(13)  VALUE SPACES.  01600000
016100     05  FILLER                        PIC  X(03)  VALUE SPACE.   01610000
016200     05  DL-CNTL-NBR-2                 PIC  X(14)  VALUE ZEROS.   01620000
016300     05  FILLER                        PIC  X(02)  VALUE SPACE.   01630000
016400     05  DL-CARD-NBR-2                 PIC  X(13)  VALUE SPACES.  01640000
016500     05  FILLER                        PIC  X(02)  VALUE SPACE.   01650000
016600     05  DL-CNTL-NBR-3                 PIC  X(14)  VALUE ZEROS.   01660000
016700     05  FILLER                        PIC  X(02)  VALUE SPACE.   01670000
016800     05  DL-CARD-NBR-3                 PIC  X(13)  VALUE SPACES.  01680000
016900     05  FILLER                        PIC  X(02)  VALUE SPACE.   01690000
017000     05  DL-CNTL-NBR-4                 PIC  X(14)  VALUE ZEROS.   01700000
017100     05  FILLER                        PIC  X(02)  VALUE SPACE.   01710000
017200     05  DL-CARD-NBR-4                 PIC  X(13)  VALUE SPACES.  01720000
017300     05  FILLER                        PIC  X(04)  VALUE SPACE.   01730000
017400                                                                  01740000
017500 01  END-OF-REPORT-LINE.                                          01750000
017600     05  FILLER                        PIC  X(51)  VALUE SPACE.   01760000
017700     05  FILLER                        PIC  X(29)  VALUE          01770000
017800         '*****   END OF REPORT   *****'.                         01780000
017900     05  FILLER                        PIC  X(52)  VALUE SPACE.   01790000
018000                                                                  01800000
018100                                                                  01810000
018200 01  PC-PROGRAM-CONSTANTS.                                        01820000
018300     05  PC-PROGRAM-NAME                 PIC  X(08)  VALUE        01830000
018400                                                    'SVKRP016'.   01840000
018500     05  PC-LINES-PER-PAGE               PIC S9(04)  VALUE +60    01850000
018600                                                     COMP SYNC.   01860000
018700     05  PC-KMRC-HEADER-COUNT            PIC S9(04)  VALUE +6     01870000
018800                                                     COMP SYNC.   01880000
018900     05  PC-GIFT-HEADER-COUNT            PIC S9(04)  VALUE +7     01890000
019000                                                     COMP SYNC.   01900000
019100     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01910000
019200                                                    'SVKRP016'.   01920000
019300     05  PC-KMRC-HL-1-DESC             PIC  X(32)  VALUE          01930000
019400         'KMRC REQUESTED CARD NUMBERS     '.                      01940000
019500     05  PC-GIFT-HL-1-DESC             PIC  X(32)  VALUE          01950000
019600         'GIFT CARD REQUESTED CARD NUMBERS'.                      01960000
019700     05  PC-KMRC-MAX-DETAIL-LINES      PIC S9(04)  VALUE +54      01970032
019800                                                   COMP-3.        01980032
019900     05  PC-GIFT-MAX-DETAIL-LINES      PIC S9(04)  VALUE +53      01990032
020000                                                   COMP-3.        02000032
020100     05  PC-COL-CNT                    PIC S9(04)  VALUE +4       02010032
020200                                                   COMP-3.        02020032
020300                                                                  02030000
020400 01  PS-PROGRAM-SWITCHES.                                         02040000
020500     05  PS-END-OF-KMRC-FILE-SW          PIC  X(01)  VALUE 'N'.   02050000
020600         88  PS-END-OF-KMRC-FILE                     VALUE 'Y'.   02060000
020700     05  PS-END-OF-GIFT-FILE-SW          PIC  X(01)  VALUE 'N'.   02070000
020800         88  PS-END-OF-GIFT-FILE                     VALUE 'Y'.   02080000
020900     05  PS-DETAIL-LINE-WRITTEN-SW       PIC  X(01)  VALUE 'Y'.   02090000
021000         88  PS-DETAIL-WRITTEN                       VALUE 'Y'.   02100000
021100         88  PS-DETAIL-NOT-WRITTEN                   VALUE 'N'.   02110000
021200     05  PS-KOHLS-PROD-SW                PIC  X(01)  VALUE 'Y'.   02120029
021300         88  PS-KOHLS-PROD                           VALUE 'Y'.   02130009
021400         88  PS-NOT-KOHLS-PROD                       VALUE 'N'.   02140009
021500                                                                  02150000
021600 01  PV-PROGRAM-VARIABLES.                                        02160000
021700     05  PV-PAGE-COUNT                   PIC S9(04)  VALUE +0     02170000
021800                                                     COMP.        02180000
021900     05  PV-COLUMN-COUNT                 PIC  9(02)  VALUE ZEROS  02190000
022000                                                     COMP.        02200000
022100     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 02210000
022200     05  PV-HOLD-CNTL.                                            02220000
022300         10  PV-HOLD-SHIPMENT-REQUEST.                            02230000
022400             15  PV-HOLD-YEAR            PIC  9(04)  VALUE ZEROS. 02240000
022500             15  PV-HOLD-REQUEST         PIC  9(04)  VALUE ZEROS. 02250000
022600         10  PV-HOLD-SEQUENCE            PIC  9(06)  VALUE ZEROS. 02260000
022700     05  PV-CRD-PROD-YR                  PIC S9(04)  VALUE ZEROS  02270004
022800                                                     COMP.        02280005
022900     05  PV-SHIPT-REQ-NBR                PIC S9(04)  VALUE ZEROS  02290002
023000                                                     COMP.        02300005
023302     05  PV-GIFT-CARD-NBR-FULL         PIC  9(12).                02330241
023400                                                                  02340000
023500     05  PV-MEMBER-NAME                PIC  X(08)  VALUE SPACES.  02350000
023520     05  PV-MEMBER-NAME-SAVE           PIC  X(08)  VALUE SPACES.  02352047
023600                                                                  02360000
023700     05  PV-GIFT-HL-1A-NON-DNNTD.                                 02370000
023800         10  FILLER                    PIC  X(07)  VALUE SPACES.  02380000
023900         10  FILLER                    PIC  X(36)  VALUE          02390000
024000         'NON-DENOMINATED GIFT CARDS - STOCK: '.                  02400000
024100         10  PV-NON-DNNTD-STOCK-TYPE   PIC  X(08)  VALUE SPACES.  02410000
024200         10  FILLER                    PIC  X(07)  VALUE SPACES.  02420000
024300     05  PV-GIFT-HL-1A-PRE-DNNTD.                                 02430000
024400         10  FILLER                    PIC  X(05)  VALUE SPACES.  02440000
024500         10  FILLER                    PIC  X(23)  VALUE          02450000
024600         'PRE-DENOMINATED VALUE $'.                               02460000
024700         10  PV-DNNTD-AMOUNT           PIC  ZZZZ.99               02470000
024800                                                   VALUE ZEROS.   02480000
024900         10  FILLER                    PIC  X(10)  VALUE          02490000
025000         ' - STOCK: '.                                            02500000
025100         10  PV-PRE-DNNTD-STOCK-TYPE   PIC  X(08)  VALUE SPACES.  02510000
025200         10  FILLER                    PIC  X(05)  VALUE SPACES.  02520000
025300     05  PV-DB2-OPERATION-ATTEMPTED    PIC  X(30)  VALUE SPACES.  02530000
025400                                                                  02540000
025500     05  PV-KMRC-DETAIL-TABLE.                                    02550000
025600         10  PV-KMRC-COLUMNS    OCCURS 4 TIMES.                   02560032
025700             15  PV-KMRC-ROWS   OCCURS 60 TIMES.                  02570032
025800                 20  PV-KMRC-CNTL-NBR    PIC  X(14).              02580000
025910                 20  PV-KMRC-CARD-NBR    PIC  X(12).              02591040
026000                                                                  02600038
026100     05  PV-GIFT-DETAIL-TABLE.                                    02610000
026200         10  PV-GIFT-COLUMNS    OCCURS 4 TIMES.                   02620032
026300             15  PV-GIFT-ROWS   OCCURS 60 TIMES.                  02630032
026400                 20  PV-GIFT-CNTL-NBR    PIC  X(14).              02640000
026520                 20  PV-GIFT-CARD-NBR    PIC  X(12).              02652041
026600                                                                  02660000
026700     05  PV-KMRC-COL                     PIC S9(04)  VALUE ZERO   02670032
026800                                                     COMP-3.      02680032
026900     05  PV-KMRC-ROW                     PIC S9(04)  VALUE ZERO   02690032
027000                                                     COMP-3.      02700032
027100     05  PV-GIFT-COL                     PIC S9(04)  VALUE ZERO   02710032
027200                                                     COMP-3.      02720032
027300     05  PV-GIFT-ROW                     PIC S9(04)  VALUE ZERO   02730032
027400                                                     COMP-3.      02740032
027500                                                                  02750032
027600 01  SD-SYSTEM-DATE.                                              02760000
027700     05  SD-SYSTEM-YEAR                  PIC  9(02)  VALUE ZEROS. 02770000
027800     05  SD-SYSTEM-MONTH                 PIC  9(02)  VALUE ZEROS. 02780000
027900     05  SD-SYSTEM-DAY                   PIC  9(02)  VALUE ZEROS. 02790000
028000                                                                  02800000
028100 01  ST-SYSTEM-TIME.                                              02810000
028200     05  ST-SYSTEM-HOUR                  PIC  9(02)  VALUE ZEROS. 02820000
028300     05  ST-SYSTEM-MINUTE                PIC  9(02)  VALUE ZEROS. 02830000
028400     05  FILLER                          PIC  9(04)  VALUE ZEROS. 02840000
028500******************************************************************02850000
028600*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *02860000
028700******************************************************************02870000
028800     COPY DPWS004.                                                02880000
028900******************************************************************02890000
029000*    STORED VALUE CARD CONTROL NUMBER TABLE                      *02900000
029100******************************************************************02910000
029200     EXEC SQL                                                     02920000
029300         INCLUDE SVT00000                                         02930000
029400     END-EXEC.                                                    02940000
029500                                                                  02950000
029600******************************************************************02960000
029700*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *02970000
029800******************************************************************02980000
029900     EXEC SQL                                                     02990000
030000         INCLUDE SQLCA                                            03000000
030100     END-EXEC.                                                    03010000
030200     COPY SQLCA2.                                                 03020000
030300******************************************************************03030000
030400 PROCEDURE DIVISION.                                              03040000
030500******************************************************************03050000
030600                                                                  03060000
030700******************************************************************03070000
030800*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03080000
030900******************************************************************03090000
031000 0000-PROGRAM-MAINLINE.                                           03100000
031100                                                                  03110000
031200     PERFORM 1000-INITIALIZE.                                     03120000
031300                                                                  03130000
031400     PERFORM 2000-PROCESS-CONTROL-KMRC-RECS                       03140000
031500         UNTIL PS-END-OF-KMRC-FILE.                               03150000
031600                                                                  03160000
031700     PERFORM 1100-INIT-FOR-GIFT.                                  03170032
031800     PERFORM 3000-PROCESS-CONTROL-GIFT-RECS                       03180000
031900         UNTIL PS-END-OF-GIFT-FILE.                               03190000
032000                                                                  03200000
032100     PERFORM 9000-EOJ-ROUTINE.                                    03210000
032200                                                                  03220000
032300     STOP RUN.                                                    03230000
032400                                                                  03240000
032500******************************************************************03250000
032600*  1000-INITIALIZE - PERFORMS THE FOLLOWING TASKS:                03260000
032700*      1.)  OPENS FILES ASSOCIATED WITH JOB.                      03270000
032800******************************************************************03280000
032900 1000-INITIALIZE.                                                 03290000
033000                                                                  03300000
033100     OPEN INPUT  KMRC-EXTRACT-FILE                                03310000
033200                 GIFT-EXTRACT-FILE                                03320000
033300          OUTPUT KMRC-CNTL-RECORD-DETAIL-REPORT                   03330000
033400                 GIFT-CNTL-RECORD-DETAIL-REPORT.                  03340000
033500                                                                  03350000
033600     MOVE ZEROS  TO  PV-PAGE-COUNT.                               03360000
033700                                                                  03370000
033800     ACCEPT SD-SYSTEM-DATE  FROM DATE.                            03380000
033900     ACCEPT ST-SYSTEM-TIME  FROM TIME.                            03390000
034000                                                                  03400000
034100     MOVE SD-SYSTEM-YEAR           TO  DP132O-RUN-MONTH.          03410000
034200     MOVE SD-SYSTEM-MONTH          TO  DP132O-RUN-DAY.            03420000
034300     MOVE SD-SYSTEM-DAY            TO  DP132O-RUN-YEAR.           03430000
034400     MOVE ST-SYSTEM-HOUR           TO  DP132O-RUN-HOUR.           03440000
034500     MOVE ST-SYSTEM-MINUTE         TO  DP132O-RUN-MINUTE.         03450000
034600     MOVE PC-CURRENT-PROGRAM-NAME  TO  DP132O-PROGRAM-NAME.       03460000
034700     MOVE 1                        TO  DP132O-REPORT-NUMBER.      03470000
034800                                                                  03480000
034900     INITIALIZE PV-KMRC-DETAIL-TABLE.                             03490038
035000                                                                  03500038
035100     PERFORM 4000-READ-KMRC-EXTRACT-FILE.                         03510032
035200                                                                  03520000
035300******************************************************************03530032
035400*   PROCESS THE KMRC CONTROL FILE                                 03540032
035500******************************************************************03550032
035600 1100-INIT-FOR-GIFT.                                              03560032
035700                                                                  03570032
035800     IF PV-KMRC-ROW > 0                                           03580036
035900         PERFORM 5000-WRITE-KMRC-DETAIL-LINES                     03590036
036000     END-IF.                                                      03600036
036100                                                                  03610036
036200     MOVE 2                        TO  DP132O-REPORT-NUMBER.      03620032
036300     MOVE ZEROS                    TO  PV-PAGE-COUNT.             03630032
036400                                                                  03640032
036500     INITIALIZE PV-GIFT-DETAIL-TABLE.                             03650038
036600                                                                  03660038
036700     PERFORM 4100-READ-GIFT-EXTRACT-FILE.                         03670032
036800                                                                  03680032
036900******************************************************************03690000
037000*   PROCESS THE KMRC CONTROL FILE                                 03700000
037100******************************************************************03710000
037200 2000-PROCESS-CONTROL-KMRC-RECS.                                  03720000
037300                                                                  03730000
037400     IF SV006-DR-KMRC-EMB-SEARCH-CODE IS NUMERIC                  03740052
037500         MOVE SV006-DR-KMRC-CNTL-NBR TO PV-HOLD-CNTL              03750052
037600         IF PV-HOLD-YEAR = PV-CRD-PROD-YR AND                     03760052
037700            PV-HOLD-REQUEST = PV-SHIPT-REQ-NBR                    03770052
037800             IF PS-KOHLS-PROD                                     03780052
037900                 IF PV-KMRC-ROW = PC-KMRC-MAX-DETAIL-LINES        03790052
038000                    AND PV-KMRC-COL = PC-COL-CNT                  03800052
038100                     PERFORM 5000-WRITE-KMRC-DETAIL-LINES         03810052
038200                     PERFORM 2100-LOAD-KMRC-DETAIL-TABLE          03820052
038300                 ELSE                                             03830052
038400                     PERFORM 2100-LOAD-KMRC-DETAIL-TABLE          03840052
038500                 END-IF                                           03850052
038600             END-IF                                               03860052
038700         ELSE                                                     03870052
038800             IF PV-KMRC-ROW > 0                                   03880052
038900                 PERFORM 5000-WRITE-KMRC-DETAIL-LINES             03890052
039000             END-IF                                               03900052
039100             MOVE PV-HOLD-YEAR TO PV-CRD-PROD-YR                  03910052
039200             MOVE PV-HOLD-REQUEST TO PV-SHIPT-REQ-NBR             03920052
039300             PERFORM 4300-SELECT-REQUEST-INFO                     03930052
039400             IF PS-KOHLS-PROD                                     03940052
039500                 MOVE +1 TO PV-KMRC-COL                           03950052
039600                 MOVE 0  TO PV-KMRC-ROW                           03960052
039700                 PERFORM 2100-LOAD-KMRC-DETAIL-TABLE              03970052
039800             END-IF                                               03980052
039900         END-IF                                                   03990052
040000     ELSE                                                         04000052
040111         IF PV-MEMBER-NAME = SPACES                               04011152
040112            MOVE SV006-HR-KMRC-MEMBER-NAME TO PV-MEMBER-NAME      04011252
040113                                              PV-MEMBER-NAME-SAVE 04011352
040114         ELSE                                                     04011452
040115            MOVE PV-MEMBER-NAME            TO PV-MEMBER-NAME-SAVE 04011552
040116            MOVE SV006-HR-KMRC-MEMBER-NAME TO PV-MEMBER-NAME      04011652
040117         END-IF                                                   04011752
040200         MOVE ZERO                      TO PV-PAGE-COUNT          04020052
040300     END-IF.                                                      04030052
040400                                                                  04040052
040500     PERFORM 4000-READ-KMRC-EXTRACT-FILE.                         04050052
040600                                                                  04060052
040790******************************************************************04079051
040800*   LOAD ONE PAGE OF KMRC CARD AND CNTL NUMBERS INTO A TABLE.     04080000
040900******************************************************************04090000
041000 2100-LOAD-KMRC-DETAIL-TABLE.                                     04100000
041100                                                                  04110000
041200     IF PV-KMRC-ROW = PC-KMRC-MAX-DETAIL-LINES                    04120032
041300         ADD +1 TO PV-KMRC-COL                                    04130032
041400         MOVE +1 TO PV-KMRC-ROW                                   04140032
041500     ELSE                                                         04150032
041600         ADD +1 TO PV-KMRC-ROW                                    04160032
041700     END-IF.                                                      04170032
041800                                                                  04180032
041900     MOVE SV006-DR-KMRC-CNTL-NBR                                  04190032
042000                  TO PV-KMRC-CNTL-NBR (PV-KMRC-COL, PV-KMRC-ROW). 04200032
042100     MOVE SV006-DR-KMRC-CARD-NBR                                  04210032
042200                  TO PV-KMRC-CARD-NBR (PV-KMRC-COL, PV-KMRC-ROW). 04220032
042300                                                                  04230000
042400******************************************************************04240000
042500*   PROCESS THE GIFT CARD CONTROL FILE                            04250000
042600******************************************************************04260000
042700 3000-PROCESS-CONTROL-GIFT-RECS.                                  04270000
042800                                                                  04280000
042900     IF SV008-DR-GIFT-EMB-SEARCH-CODE IS NUMERIC                  04290032
043000         MOVE SV008-DR-GIFT-CNTL-NBR TO PV-HOLD-CNTL              04300032
043100         IF PV-HOLD-YEAR = PV-CRD-PROD-YR AND                     04310032
043200            PV-HOLD-REQUEST = PV-SHIPT-REQ-NBR                    04320032
043300             IF PS-KOHLS-PROD                                     04330032
043400                 IF PV-GIFT-ROW = PC-GIFT-MAX-DETAIL-LINES        04340032
043500                    AND PV-GIFT-COL = PC-COL-CNT                  04350032
043600                     PERFORM 5100-WRITE-GIFT-DETAIL-LINES         04360032
043700                     PERFORM 3100-LOAD-GIFT-DETAIL-TABLE          04370032
043800                 ELSE                                             04380032
043900                     PERFORM 3100-LOAD-GIFT-DETAIL-TABLE          04390032
044000                 END-IF                                           04400032
044100             END-IF                                               04410032
044200         ELSE                                                     04420032
044300             IF PV-GIFT-ROW > 0                                   04430032
044400                 PERFORM 5100-WRITE-GIFT-DETAIL-LINES             04440033
044500             END-IF                                               04450032
044600             MOVE PV-HOLD-YEAR TO PV-CRD-PROD-YR                  04460032
044700             MOVE PV-HOLD-REQUEST TO PV-SHIPT-REQ-NBR             04470032
044800             PERFORM 4300-SELECT-REQUEST-INFO                     04480032
044900             IF SVT00000-PRE-DNNTD-CRD-AMT > 0                    04490032
045000                 MOVE SVT00000-PRE-DNNTD-CRD-AMT                  04500032
045100                                  TO PV-DNNTD-AMOUNT              04510032
045200                 MOVE SVT00000-CRD-STK-TYP-ID                     04520032
045300                                  TO PV-PRE-DNNTD-STOCK-TYPE      04530032
045400                 MOVE PV-GIFT-HL-1A-PRE-DNNTD                     04540033
045500                                  TO HL-1A-DESC                   04550032
045600             ELSE                                                 04560032
045700                 MOVE SVT00000-CRD-STK-TYP-ID                     04570032
045800                                  TO PV-NON-DNNTD-STOCK-TYPE      04580032
045900                 MOVE PV-GIFT-HL-1A-NON-DNNTD                     04590033
046000                                  TO HL-1A-DESC                   04600032
046100             END-IF                                               04610032
046200             IF PS-KOHLS-PROD                                     04620032
046300                 MOVE +1 TO PV-GIFT-COL                           04630032
046400                 MOVE 0  TO PV-GIFT-ROW                           04640032
046500                 PERFORM 3100-LOAD-GIFT-DETAIL-TABLE              04650032
046600             END-IF                                               04660032
046700         END-IF                                                   04670032
046800     ELSE                                                         04680032
046820         IF PV-MEMBER-NAME = SPACES                               04682047
046830            MOVE SV008-HR-GIFT-MEMBER-NAME TO PV-MEMBER-NAME      04683047
046840                                              PV-MEMBER-NAME-SAVE 04684047
046850         ELSE                                                     04685047
046860            MOVE PV-MEMBER-NAME            TO PV-MEMBER-NAME-SAVE 04686047
046861            MOVE SV008-HR-GIFT-MEMBER-NAME TO PV-MEMBER-NAME      04686147
046880         END-IF                                                   04688047
047000         MOVE ZERO                      TO PV-PAGE-COUNT          04700032
047100     END-IF.                                                      04710032
047200                                                                  04720032
047300     PERFORM 4100-READ-GIFT-EXTRACT-FILE.                         04730032
047400                                                                  04740000
047500******************************************************************04750000
047600*   LOAD ONE PAGE OF GIFT CARD AND CNTL NUMBERS INTO A TABLE.     04760000
047700******************************************************************04770000
047800 3100-LOAD-GIFT-DETAIL-TABLE.                                     04780000
047900                                                                  04790000
048000     IF PV-GIFT-ROW = PC-GIFT-MAX-DETAIL-LINES                    04800032
048100         ADD +1 TO PV-GIFT-COL                                    04810032
048200         MOVE +1 TO PV-GIFT-ROW                                   04820032
048300     ELSE                                                         04830032
048400         ADD +1 TO PV-GIFT-ROW                                    04840032
048500     END-IF.                                                      04850032
048600                                                                  04860032
048700     MOVE SV008-DR-GIFT-CNTL-NBR                                  04870032
048800                  TO PV-GIFT-CNTL-NBR (PV-GIFT-COL, PV-GIFT-ROW). 04880032
049201     MOVE SV008-DR-CARD-NBR                                       04920141
049202                  TO  PV-GIFT-CARD-NBR-FULL.                      04920241
049300     MOVE PV-GIFT-CARD-NBR-FULL                                   04930032
049400                  TO PV-GIFT-CARD-NBR (PV-GIFT-COL, PV-GIFT-ROW). 04940032
049500                                                                  04950000
049600******************************************************************04960000
049700* 4000   READS THE KMRC INPUT FILE.                              *04970000
049800******************************************************************04980000
049900                                                                  04990000
050000 4000-READ-KMRC-EXTRACT-FILE.                                     05000000
050100                                                                  05010000
050200     READ KMRC-EXTRACT-FILE                                       05020000
050300         INTO SV006-DETAIL-RECORD-KMRC                            05030052
050400         AT END                                                   05040000
050500            SET PS-END-OF-KMRC-FILE  TO  TRUE.                    05050000
050600                                                                  05060009
050700******************************************************************05070000
050800* 4100   READS THE GIFT CARD INPUT FILE.                         *05080000
050900******************************************************************05090000
051000                                                                  05100000
051100 4100-READ-GIFT-EXTRACT-FILE.                                     05110000
051200                                                                  05120000
051300     READ GIFT-EXTRACT-FILE                                       05130000
051400         INTO SV008-DETAIL-RECORD-GIFT                            05140000
051500         AT END                                                   05150000
051600            SET PS-END-OF-GIFT-FILE TO TRUE.                      05160000
051700                                                                  05170009
051800******************************************************************05180009
051900* 4300   SELECT REQUEST INFO                                     *05190032
052000******************************************************************05200009
052100                                                                  05210009
052200 4300-SELECT-REQUEST-INFO.                                        05220032
052300                                                                  05230014
052400     EXEC SQL                                                     05240009
052500         SELECT  CRD_PRDR_CDE                                     05250009
052600                ,PRE_DNNTD_CRD_AMT                                05260032
052700                ,CRD_STK_TYP_ID                                   05270032
052800           INTO  :SVT00000-CRD-PRDR-CDE                           05280009
052900                ,:SVT00000-PRE-DNNTD-CRD-AMT                      05290032
053000                ,:SVT00000-CRD-STK-TYP-ID                         05300032
053100           FROM  SVT_CRD_PROD                                     05310009
053200          WHERE CRD_PROD_YR = :PV-CRD-PROD-YR                     05320009
053300            AND SHIPT_REQ_NBR = :PV-SHIPT-REQ-NBR                 05330009
053400     END-EXEC.                                                    05340009
053500                                                                  05350018
053600     EVALUATE TRUE                                                05360009
053700         WHEN SQLCODE = +0                                        05370009
053800             IF SVT00000-CRD-PRDR-CDE = 'K'                       05380009
053900                 SET PS-KOHLS-PROD TO TRUE                        05390031
054000             ELSE                                                 05400009
054100                 SET PS-NOT-KOHLS-PROD TO TRUE                    05410031
054200             END-IF                                               05420009
054300         WHEN OTHER                                               05430009
054400             MOVE '4300-SELECT-REQUEST-INFO      '                05440032
054500                                 TO PV-PARAGRAPH-NAME             05450009
054600             MOVE 'READ SVT_CRD_PROD TABLE            '           05460009
054700                                 TO PV-DB2-OPERATION-ATTEMPTED    05470009
054800             PERFORM 9999-SQL-ABEND                               05480009
054900     END-EVALUATE.                                                05490009
055000                                                                  05500009
055100******************************************************************05510009
055200* 5000-WRITE-KMRC-DETAIL-LINES                                    05520009
055300*     WRITES THE DETAIL LINES TO THE REPORT.                      05530009
055400******************************************************************05540000
055500 5000-WRITE-KMRC-DETAIL-LINES.                                    05550000
055600                                                                  05560000
055621     IF PS-END-OF-KMRC-FILE                                       05562148
055622        MOVE PV-MEMBER-NAME TO PV-MEMBER-NAME-SAVE                05562248
055623     END-IF.                                                      05562348
055700     PERFORM 6000-WRITE-KMRC-HEADING-LINES.                       05570032
055800                                                                  05580032
055900     PERFORM VARYING PV-KMRC-ROW FROM 1 BY 1                      05590033
056000                     UNTIL PV-KMRC-ROW > PC-KMRC-MAX-DETAIL-LINES 05600034
056100             MOVE PV-KMRC-CNTL-NBR (1, PV-KMRC-ROW)               05610033
056200                                         TO DL-CNTL-NBR-1         05620000
056300             MOVE PV-KMRC-CARD-NBR (1, PV-KMRC-ROW)               05630033
056400                                         TO DL-CARD-NBR-1         05640000
056500             SET PS-DETAIL-NOT-WRITTEN  TO  TRUE                  05650000
056600                                                                  05660000
056700             MOVE PV-KMRC-CNTL-NBR (2, PV-KMRC-ROW)               05670033
056800                                         TO DL-CNTL-NBR-2         05680000
056900             MOVE PV-KMRC-CARD-NBR (2, PV-KMRC-ROW)               05690033
057000                                         TO DL-CARD-NBR-2         05700000
057100                                                                  05710000
057200             MOVE PV-KMRC-CNTL-NBR (3, PV-KMRC-ROW)               05720033
057300                                         TO DL-CNTL-NBR-3         05730000
057400             MOVE PV-KMRC-CARD-NBR (3, PV-KMRC-ROW)               05740033
057500                                         TO DL-CARD-NBR-3         05750000
057600                                                                  05760000
057700             MOVE PV-KMRC-CNTL-NBR (4, PV-KMRC-ROW)               05770033
057800                                         TO DL-CNTL-NBR-4         05780000
057900             MOVE PV-KMRC-CARD-NBR (4, PV-KMRC-ROW)               05790033
058000                                         TO DL-CARD-NBR-4         05800000
058100             WRITE KMRC-CNTL-RECORD-DETAIL-LINE                   05810000
058200             FROM DL-DETAIL-LINE                                  05820000
058300             AFTER ADVANCING  1  LINES                            05830000
058400             MOVE SPACES  TO  DL-DETAIL-LINE                      05840000
058500     END-PERFORM.                                                 05850000
058600                                                                  05860000
058700     MOVE +1   TO PV-KMRC-COL.                                    05870039
058800     MOVE ZERO TO PV-KMRC-ROW.                                    05880038
058900                                                                  05890038
059000     INITIALIZE PV-KMRC-DETAIL-TABLE.                             05900038
059100                                                                  05910035
059200******************************************************************05920000
059300* 5100-WRITE-GIFT-DETAIL-LINES                                    05930000
059400*     WRITES THE DETAIL LINES TO THE REPORT.                      05940000
059500******************************************************************05950000
059600 5100-WRITE-GIFT-DETAIL-LINES.                                    05960000
059700                                                                  05970000
059723     IF PS-END-OF-GIFT-FILE                                       05972348
059724        MOVE PV-MEMBER-NAME TO PV-MEMBER-NAME-SAVE                05972448
059725     END-IF.                                                      05972548
059800     PERFORM 6100-WRITE-GIFT-HEADING-LINES.                       05980032
059900                                                                  05990000
060000     PERFORM VARYING PV-GIFT-ROW FROM 1 BY 1                      06000033
060100                     UNTIL PV-GIFT-ROW > PC-GIFT-MAX-DETAIL-LINES 06010034
060200             MOVE PV-GIFT-CNTL-NBR (1, PV-GIFT-ROW)               06020033
060300                                         TO DL-CNTL-NBR-1         06030000
060400             MOVE PV-GIFT-CARD-NBR (1, PV-GIFT-ROW)               06040033
060500                                         TO DL-CARD-NBR-1         06050000
060600             SET PS-DETAIL-NOT-WRITTEN  TO  TRUE                  06060000
060700                                                                  06070000
060800             MOVE PV-GIFT-CNTL-NBR (2, PV-GIFT-ROW)               06080033
060900                                         TO DL-CNTL-NBR-2         06090000
061000             MOVE PV-GIFT-CARD-NBR (2, PV-GIFT-ROW)               06100033
061100                                         TO DL-CARD-NBR-2         06110000
061200                                                                  06120000
061300             MOVE PV-GIFT-CNTL-NBR (3, PV-GIFT-ROW)               06130033
061400                                         TO DL-CNTL-NBR-3         06140000
061500             MOVE PV-GIFT-CARD-NBR (3, PV-GIFT-ROW)               06150033
061600                                         TO DL-CARD-NBR-3         06160000
061700                                                                  06170000
061800             MOVE PV-GIFT-CNTL-NBR (4, PV-GIFT-ROW)               06180033
061900                                         TO DL-CNTL-NBR-4         06190000
062000             MOVE PV-GIFT-CARD-NBR (4, PV-GIFT-ROW)               06200033
062100                                         TO DL-CARD-NBR-4         06210000
062200             WRITE GIFT-CNTL-RECORD-DETAIL-LINE                   06220000
062300             FROM DL-DETAIL-LINE                                  06230000
062400             AFTER ADVANCING  1  LINES                            06240000
062500             MOVE SPACES  TO  DL-DETAIL-LINE                      06250000
062600     END-PERFORM.                                                 06260000
062700                                                                  06270000
062800     MOVE +1   TO PV-GIFT-COL.                                    06280039
062900     MOVE ZERO TO PV-GIFT-ROW.                                    06290038
063000                                                                  06300038
063100     INITIALIZE PV-GIFT-DETAIL-TABLE.                             06310038
063200                                                                  06320035
063300******************************************************************06330000
063400* 6000-WRITE-KMRC-HEADING-LINES                                   06340000
063500*     PRODUCE HEADING ASSOCIATED WITH THE KMRC REPORT.            06350000
063600******************************************************************06360000
063700 6000-WRITE-KMRC-HEADING-LINES.                                   06370000
063800                                                                  06380037
063900     ADD 1              TO PV-PAGE-COUNT.                         06390000
064000     MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    06400000
064100                                                                  06410000
064200     WRITE KMRC-CNTL-RECORD-DETAIL-LINE                           06420000
064300         FROM DP132O-STANDRD-HEADER-132-COLS                      06430000
064400         AFTER ADVANCING PAGE.                                    06440000
064500                                                                  06450000
064630     MOVE PV-MEMBER-NAME-SAVE                                     06463047
064700                        TO HL-1-MEMBER-NAME.                      06470000
064800     MOVE PC-KMRC-HL-1-DESC                                       06480000
064900                        TO HL-1-DESC.                             06490000
065000     WRITE KMRC-CNTL-RECORD-DETAIL-LINE                           06500000
065100         FROM HL1-HEADING-LINE-1                                  06510000
065200         AFTER ADVANCING 1 LINES.                                 06520000
065300                                                                  06530000
065400     WRITE KMRC-CNTL-RECORD-DETAIL-LINE                           06540000
065500         FROM HL2-HEADING-LINE-2                                  06550000
065600         AFTER ADVANCING 2 LINES.                                 06560000
065700                                                                  06570000
065800     WRITE KMRC-CNTL-RECORD-DETAIL-LINE                           06580000
065900         FROM HL3-HEADING-LINE-3                                  06590000
066000         AFTER ADVANCING 1 LINES.                                 06600000
066100                                                                  06610000
066200******************************************************************06620000
066300* 6100-WRITE-GIFT-HEADING-LINES                                   06630000
066400*     PRODUCE HEADING ASSOCIATED WITH THE GIFT CARD REPORT.       06640000
066500******************************************************************06650000
066600 6100-WRITE-GIFT-HEADING-LINES.                                   06660000
066700                                                                  06670037
066800     ADD 1              TO PV-PAGE-COUNT.                         06680000
066900     MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    06690000
067000                                                                  06700000
067100     WRITE GIFT-CNTL-RECORD-DETAIL-LINE                           06710000
067200         FROM DP132O-STANDRD-HEADER-132-COLS                      06720000
067300         AFTER ADVANCING PAGE.                                    06730000
067400                                                                  06740000
067501     MOVE PV-MEMBER-NAME-SAVE                                     06750147
067600                        TO HL-1-MEMBER-NAME.                      06760000
067700     MOVE PC-GIFT-HL-1-DESC                                       06770000
067800                        TO HL-1-DESC.                             06780000
067900     WRITE GIFT-CNTL-RECORD-DETAIL-LINE                           06790000
068000         FROM HL1-HEADING-LINE-1                                  06800000
068100         AFTER ADVANCING 1 LINES.                                 06810000
068200                                                                  06820000
068300     WRITE GIFT-CNTL-RECORD-DETAIL-LINE                           06830000
068400         FROM HL1-HEADING-LINE-1A                                 06840000
068500         AFTER ADVANCING 1 LINES.                                 06850000
068600                                                                  06860000
068700     WRITE GIFT-CNTL-RECORD-DETAIL-LINE                           06870000
068800         FROM HL2-HEADING-LINE-2                                  06880000
068900         AFTER ADVANCING 2 LINES.                                 06890000
069000                                                                  06900000
069100     WRITE GIFT-CNTL-RECORD-DETAIL-LINE                           06910000
069200         FROM HL3-HEADING-LINE-3                                  06920000
069300         AFTER ADVANCING 1 LINES.                                 06930000
069400                                                                  06940000
069500******************************************************************06950000
069600* 9000-EOJ-ROUTINE  -  CLOSES ALL FILES                           06960000
069700******************************************************************06970000
069800 9000-EOJ-ROUTINE.                                                06980000
069900                                                                  06990000
070000     IF PV-GIFT-ROW > 0                                           07000036
070100         PERFORM 5100-WRITE-GIFT-DETAIL-LINES                     07010036
070200     END-IF.                                                      07020036
070300                                                                  07030000
070400     CLOSE KMRC-EXTRACT-FILE                                      07040000
070500           GIFT-EXTRACT-FILE                                      07050000
070600           KMRC-CNTL-RECORD-DETAIL-REPORT                         07060000
070700           GIFT-CNTL-RECORD-DETAIL-REPORT.                        07070000
070800                                                                  07080036
070900******************************************************************07090000
071000*     9999-SQL-ABEND                                             *07100000
071100* ==> PROCESSES:                                                 *07110000
071200*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *07120000
071300******************************************************************07130000
071400 9999-SQL-ABEND.                                                  07140000
071500      DISPLAY '9999-SQL-ABEND'.                                   07150000
071600      DISPLAY '**  ABEND     **'.                                 07160000
071700      DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.              07170000
071800      DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.            07180000
071900      DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.   07190000
072000******************************************************************07200000
072100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *07210000
072200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *07220000
072300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *07230000
072400* FORMAT.                                                        *07240000
072500******************************************************************07250000
072600     COPY DPPD004.                                                07260000
072700     MOVE +4013 TO ABEND-CODE.                                    07270000
072800     CALL 'ILBOABN0' USING ABEND-CODE.                            07280057
