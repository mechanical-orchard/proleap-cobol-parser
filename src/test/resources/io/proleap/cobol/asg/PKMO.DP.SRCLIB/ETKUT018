000100*                                                                 00010007
000200*                                                                 00020007
000300*                                                                 00030007
000400 IDENTIFICATION DIVISION.                                         00040007
000500                                                                  00050007
000600 PROGRAM-ID.              ETKUT018.                               00060007
000700 AUTHOR.                  KIM WRIGHT.                             00070007
000800 INSTALLATION.            KOHLS DEPARTMENT STORES.                00080007
000900 DATE-WRITTEN.            05/06/94.                               00090007
001000 DATE-COMPILED.                                                   00100007
001100                                                                  00110007
001200******************************************************************00120007
001300*     ETKUT018  -  INTERCHANGE ID EXTRACT PROGRAM                 00130007
001400*                                                                 00140007
001500*     THE PURPOSE OF THIS PROGRAM IS TO READ AN ADVANCED SHIPPING 00150007
001600*     NOTICE FILE AND USE THE INTERCHANGE ID AND INTERCHANGE      00160007
001700*     QUALIFIER TO LOOK UP THE DUNNS NUMBER.  THE FILE IS THEN    00170007
001800*     WRITTEN BACK OUT WITH THE DUNNS NUMBER REPLACING THE INTER- 00180007
001900*     CHANGE DATA ON THE 'ID ' SEGMENT.  THE OTHER SEGMENTS WILL  00190007
002000*     BE WRITTEN OUT WITHOUT BEING CHANGED.                       00200007
002100*                                                                 00210007
002200******************************************************************00220007
002300*     DATE 07/15/94                                               00230007
002400*                                                                 00240007
002500*     WRITE OUT THE INTERCHANGE ID AND INTERCHANGE QUALIFIERS FOR 00250007
002600*     TRADING PARTNERSHIPS NOT FOUND TO A REPORT INSTEAD OF       00260007
002700*     DISPLAYS.                                                   00270007
002800*                                                                 00280007
002900*     MADE BY: KIM WRIGHT                                         00290007
003000******************************************************************00300007
003100*     DATE 01/18/95                                               00310007
003200*                                                                 00320007
003300*     CREATE A SECOND FILE TO INDICATE HALLMARK ASN STATUS.  IF   00330007
003400*     A NON-NUMERIC PURCHASE ORDER NUMBER IS SENT, OR A P.O. IS   00340007
003500*     NOT FOUND ON THE TPURCHS DATABASE, A STATUS CODE WILL BE    00350007
003600*     SWITCHED TO INDICATE RECYCLE STATUS.                        00360007
003700*                                                                 00370007
003800*     NEW OUTPUT FILE: ET-HALLMARK-STATUS-FILE                    00380007
003900*     CHANGE MADE TO ETRD012                                      00390007
004000*     NEW COPYBOOK: ETRD013                                       00400007
004100*                                                                 00410007
004200*     MADE BY: K. WRIGHT                                          00420007
004300******************************************************************00430007
004400* 02-10-2003 C.WYSOCKI      PITS#: PM00526243                     00440007
004500* B100-PROCESS-ASN-RECORD:  SET PS-NO-HALLMARK TO TRUE IF MULTIPLE00450007
004600* ENT IDS RETURNED FROM ENT ID RETRIEVE.                          00460007
004700*                                                                 00470007
004710* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00471008
004720*            - CHANGE CALL OF DPKUT100 TO                       * 00472008
004730*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00473008
004740*              MAKING THE CALL DYNAMIC VS STATIC                * 00474008
004750*                                                               * 00475008
004760*---------------------------------------------------------------* 00476008
004800 ENVIRONMENT DIVISION.                                            00480007
004900*                                                                 00490007
005000*                                                                 00500007
005100 CONFIGURATION SECTION.                                           00510007
005200                                                                  00520007
005300 SOURCE-COMPUTER. IBM-3090.                                       00530007
005400 OBJECT-COMPUTER. IBM-3090.                                       00540007
005500*                                                                 00550007
005600*                                                                 00560007
005700 INPUT-OUTPUT SECTION.                                            00570007
005800                                                                  00580007
005900 FILE-CONTROL.                                                    00590007
006000                                                                  00600007
006100     SELECT ET-PARM-CARD                                          00610007
006200         ASSIGN TO INPARM.                                        00620007
006300                                                                  00630007
006400     SELECT ET-ASN-FILE                                           00640007
006500         ASSIGN TO IN01.                                          00650007
006600                                                                  00660007
006700     SELECT ET-ASN-ADJ-FILE                                       00670007
006800         ASSIGN TO OUT01.                                         00680007
006900                                                                  00690007
007000     SELECT ET-HALLMARK-STATUS-FILE                               00700007
007100         ASSIGN TO OUT02.                                         00710007
007200                                                                  00720007
007300     SELECT ET-ASN-RPT-FILE                                       00730007
007400         ASSIGN TO RPT01.                                         00740007
007500*                                                                 00750007
007600*                                                                 00760007
007700 DATA DIVISION.                                                   00770007
007800*                                                                 00780007
007900*                                                                 00790007
008000 FILE SECTION.                                                    00800007
008100                                                                  00810007
008200 FD  ET-PARM-CARD                                                 00820007
008300     RECORDING MODE IS F                                          00830007
008400     LABEL RECORDS ARE STANDARD                                   00840007
008500     BLOCK CONTAINS 0 RECORDS                                     00850007
008600     RECORD CONTAINS 80 CHARACTERS                                00860007
008700     DATA RECORD IS ET-PARM-RECORD.                               00870007
008800                                                                  00880007
008900 01  ET-PARM-RECORD                     PIC X(80).                00890007
009000                                                                  00900007
009100 FD  ET-ASN-FILE                                                  00910007
009200     RECORDING MODE IS F                                          00920007
009300     LABEL RECORDS ARE STANDARD                                   00930007
009400     BLOCK CONTAINS 0 RECORDS                                     00940007
009500     RECORD CONTAINS 350 CHARACTERS                               00950007
009600     DATA RECORD IS ET-ASN-FILE-RECORD.                           00960007
009700                                                                  00970007
009800 01  ET-ASN-FILE-RECORD                 PIC X(350).               00980007
009900                                                                  00990007
010000 FD  ET-ASN-ADJ-FILE                                              01000007
010100     RECORDING MODE IS F                                          01010007
010200     LABEL RECORDS ARE STANDARD                                   01020007
010300     BLOCK CONTAINS 0 RECORDS                                     01030007
010400     RECORD CONTAINS 350 CHARACTERS                               01040007
010500     DATA RECORD IS ET-ASN-ADJ-FILE-RECORD.                       01050007
010600                                                                  01060007
010700 01  ET-ASN-ADJ-FILE-RECORD             PIC X(350).               01070007
010800                                                                  01080007
010900 FD  ET-HALLMARK-STATUS-FILE                                      01090007
011000     RECORDING MODE IS F                                          01100007
011100     LABEL RECORDS ARE STANDARD                                   01110007
011200     BLOCK CONTAINS 0 RECORDS                                     01120007
011300     RECORD CONTAINS 57 CHARACTERS                                01130007
011400     DATA RECORD IS ET-HALLMARK-STATUS-RECORD.                    01140007
011500                                                                  01150007
011600 01  ET-HALLMARK-STATUS-RECORD          PIC X(57).                01160007
011700                                                                  01170007
011800 FD  ET-ASN-RPT-FILE                                              01180007
011900     RECORDING MODE IS F                                          01190007
012000     LABEL RECORDS ARE STANDARD                                   01200007
012100     BLOCK CONTAINS 0 RECORDS                                     01210007
012200     RECORD CONTAINS 132 CHARACTERS                               01220007
012300     DATA RECORD IS ET-ASN-RPT-FILE-RECORD.                       01230007
012400                                                                  01240007
012500 01  ET-ASN-RPT-FILE-RECORD             PIC X(132).               01250007
012600                                                                  01260007
012700                                                                  01270007
012800 EJECT                                                            01280007
012900*                                                                 01290007
013000*                                                                 01300007
013100 WORKING-STORAGE SECTION.                                         01310007
013200                                                                  01320007
013300                                                                  01330007
013400******************************************************************01340007
013500*  SYSTEM DATE AND TIME STORAGE AREA                              01350007
013600******************************************************************01360007
013700                                                                  01370007
013800 01  WS-PARM-REC.                                                 01380007
013900     05  WS-PROD-TEST-PARM               PIC X.                   01390007
014000     05  FILLER                          PIC X(79).               01400007
014100                                                                  01410007
014200 01  WS-TODAYS-DATE.                                              01420007
014300     05  WS-YY                           PIC 9(02)   VALUE ZEROES.01430007
014400     05  WS-MO                           PIC 9(02)   VALUE ZEROES.01440007
014500     05  WS-DD                           PIC 9(02)   VALUE ZEROES.01450007
014600                                                                  01460007
014700 01  WS-TODAYS-DATE-DB2.                                          01470007
014800     05  WS-CC-DB2                       PIC 9(02)   VALUE 19.    01480007
014900     05  WS-YY-DB2                       PIC 9(02)   VALUE ZEROES.01490007
015000     05  FILLER                          PIC X(01)   VALUE '-'.   01500007
015100     05  WS-MO-DB2                       PIC 9(02)   VALUE ZEROES.01510007
015200     05  FILLER                          PIC X(01)   VALUE '-'.   01520007
015300     05  WS-DD-DB2                       PIC 9(02)   VALUE ZEROES.01530007
015400                                                                  01540007
015500 01  WS-TODAYS-TIME.                                              01550007
015600     05  WS-HH                           PIC 9(02)   VALUE ZEROES.01560007
015700     05  WS-MM                           PIC 9(02)   VALUE ZEROES.01570007
015800     05  WS-SS                           PIC 9(02)   VALUE ZEROES.01580007
015900                                                                  01590007
016000 01  WS-PO-NUM-DIG                       PIC S9(09)  COMP.        01600007
016100                                                                  01610007
016200 01  PV-PROGRAM-VARIABLES.                                        01620007
016300     05  PV-PARAGRAPH-NAME               PIC X(30).               01630007
016400     05  PV-DB2-OPER-ATTEMPTED           PIC X(30).               01640007
016500     05  PV-COUNTER                      PIC S9(4) COMP.          01650007
016600                                                                  01660007
016700 01  PS-PROGRAM-SWITCHES.                                         01670007
016800     05  PS-ENT-ID-SW                    PIC X(01).               01680007
016900         88  PS-ENT-ID-FOUND                VALUE 'Y'.            01690007
017000         88  PS-ENT-ID-NOT-FOUND            VALUE 'N'.            01700007
017100     05  PS-MULTIPLE-ENT-ID-SW           PIC X(01).               01710007
017200         88  PS-MULTIPLE-ENT-ID             VALUE 'Y'.            01720007
017300         88  PS-SINGLE-ENT-ID               VALUE 'N'.            01730007
017400     05  PS-END-OF-FILE-SW               PIC X(01).               01740007
017500         88  PS-END-OF-FILE                 VALUE 'Y'.            01750007
017600         88  PS-NOT-END-OF-FILE             VALUE 'N'.            01760007
017700     05  PS-TP-SETUP-SW                  PIC X(01).               01770007
017800         88  PS-TP-SETUP                    VALUE 'Y'.            01780007
017900         88  PS-TP-NOT-SETUP                VALUE 'N'.            01790007
018000     05  PS-HALLMARK-SW                  PIC X(01).               01800007
018100         88  PS-HALLMARK                    VALUE 'Y'.            01810007
018200         88  PS-NO-HALLMARK                 VALUE 'N'.            01820007
018300                                                                  01830007
018400 01  PC-PROGRAM-COUNTERS.                                         01840007
018500     05  PC-PAGE-CNTR                    PIC S9(05)  VALUE +0     01850007
018600                                                     COMP-3.      01860007
018700     05  PC-LINE-CNTR                    PIC S9(05)  VALUE +60    01870007
018800                                                     COMP-3.      01880007
018900 01  PC-PROGRAM-CONSTANTS.                                        01890007
019000     05  PC-IDENTIFICATION-SEGMENT       PIC X(03) VALUE 'ID '.   01900007
019100     05  PC-MAX-LINES                    PIC S9(05) VALUE +58.    01910007
019200     05  PC-HALLMARK-DUN-NBR         PIC X(09) VALUE '003949435'. 01920007
019300     05  PC-BEAUTY-BANK-DUN-NBR      PIC X(09) VALUE '000882225'. 01930007
019400     05  PC-HEADER-ID-PRF                PIC X(03)  VALUE 'PRF'.  01940007
019500                                                                  01950007
019600 01  RT-REPORT-TITLE.                                             01960007
019700     05  FILLER                          PIC X(51)   VALUE SPACES.01970007
019800     05  FILLER                          PIC X(30)   VALUE        01980007
019900         'TRADING PARTNERSHIP NOT SET UP'.                        01990007
020000     05  FILLER                          PIC X(51)   VALUE SPACES.02000007
020100                                                                  02010007
020200 01  RH-REPORT-HEADING.                                           02020007
020300     05  FILLER                          PIC X(43)   VALUE SPACES.02030007
020400     05  FILLER                          PIC X(21)   VALUE        02040007
020500         'INTERCHANGE QUALIFIER'.                                 02050007
020600     05  FILLER                          PIC X(10)   VALUE SPACES.02060007
020700     05  FILLER                          PIC X(14)   VALUE        02070007
020800         'INTERCHANGE ID'.                                        02080007
020900     05  FILLER                          PIC X(44)   VALUE SPACES.02090007
021000                                                                  02100007
021100 01  RD-REPORT-DETAIL.                                            02110007
021200     05  FILLER                          PIC X(53)   VALUE SPACES.02120007
021300     05  RD-INTERCHANGE-QUAL             PIC X(02)   VALUE SPACES.02130007
021400     05  FILLER                          PIC X(20)   VALUE SPACES.02140007
021500     05  RD-INTERCHANGE-ID               PIC X(15)   VALUE SPACES.02150007
021600     05  FILLER                          PIC X(42)   VALUE SPACES.02160007
021700                                                                  02170007
021800 01  ABEND-CODE                          PIC S9(04)  VALUE +0     02180007
021900                                                     COMP SYNC.   02190007
022000     88 ABEND-4013                                   VALUE +4013. 02200007
022100                                                                  02210007
022200***************************************************************** 02220007
022300*    ASN INPUT RECORD LAYOUT                                      02230007
022400***************************************************************** 02240007
022500     COPY ETRD012.                                                02250007
022600                                                                  02260007
022700***************************************************************** 02270007
022800*    HALLMARK ASN STATUS RECORD LAYOUT                            02280007
022900***************************************************************** 02290007
023000     COPY ETRD013.                                                02300007
023100                                                                  02310007
023200***************************************************************** 02320007
023300*    ASN DETAIL OUTPUT RECORD LAYOUT                              02330007
023400***************************************************************** 02340007
023500     COPY SNRD001I.                                               02350007
023600                                                                  02360007
023700***************************************************************** 02370007
023800*  COPY BOOK OF WORKING STORAGE FOR SQL ABEND ROUTINE             02380007
023900***************************************************************** 02390007
024000     COPY DPWS004.                                                02400007
024100                                                                  02410007
024200******************************************************************02420007
024300*    KOHLS STANDARD REPORT HEADER - 132 CHARACTERS                02430007
024400******************************************************************02440007
024500     COPY DPWS132O.                                               02450007
024600                                                                  02460007
024700******************************************************************02470007
024800*    NUMERIC EDIT ROUTINE                                         02480007
024900******************************************************************02490007
025000     COPY DPWS010I.                                               02500007
025100                                                                  02510007
025200***************************************************************** 02520007
025300*  PURCHASE ORDER TABLE                                           02530007
025400***************************************************************** 02540007
025500                                                                  02550007
025600     EXEC SQL                                                     02560007
025700        INCLUDE TPURCHS                                           02570007
025800     END-EXEC.                                                    02580007
025900                                                                  02590007
026000***************************************************************** 02600007
026100*  TRADING PARTNERSHIP TABLE                                      02610007
026200***************************************************************** 02620007
026300                                                                  02630007
026400     EXEC SQL                                                     02640007
026500        INCLUDE TTRDPRT                                           02650007
026600     END-EXEC.                                                    02660007
026700                                                                  02670007
026800***************************************************************** 02680007
026900*  TRADING PARTNERSHIP TRANSACTION TABLE                          02690007
027000***************************************************************** 02700007
027100                                                                  02710007
027200     EXEC SQL                                                     02720007
027300        INCLUDE TTRDTRN                                           02730007
027400     END-EXEC.                                                    02740007
027500                                                                  02750007
027600***************************************************************** 02760007
027700*  ENTITY TABLE                                                   02770007
027800***************************************************************** 02780007
027900                                                                  02790007
028000     EXEC SQL                                                     02800007
028100        INCLUDE TEXTENT                                           02810007
028200     END-EXEC.                                                    02820007
028300                                                                  02830007
028400***************************************************************** 02840007
028500*  SELECT ALL THE ENTITY IDS FOR EACH INTERCHANGE ID.             02850007
028600***************************************************************** 02860007
028700                                                                  02870007
028800     EXEC SQL                                                     02880007
028900        DECLARE ENTITY_CUR CURSOR FOR                             02890007
029000           SELECT ENT_ID                                          02900007
029100           FROM TTRDPRT,                                          02910007
029200                TTRDTRN                                           02920007
029300           WHERE VEND_INCHG_ID_DESC   = :ET012-INTERCHANGE-ID-QUAL02930007
029400                                                            AND   02940007
029500                 VEND_INCHG_ID        = :ET012-INTERCHANGE-ID AND 02950007
029600                 TTRDTRN.TP_DKEY      = TTRDPRT.TP_DKEY     AND   02960007
029700                 TRAN_SET_CDE         = '856'               AND   02970007
029800                 PROD_TEST_IND        = :WS-PROD-TEST-PARM  AND   02980007
029900                 TTRDPRT.ACTV_DTE    <= CURRENT DATE        AND   02990007
030000                 TTRDPRT.INACTV_DTE   > CURRENT DATE        AND   03000007
030100                 TTRDTRN.ACTV_DTE    <= CURRENT DATE        AND   03010007
030200                 TTRDTRN.INACTV_DTE   > CURRENT DATE              03020007
030300     END-EXEC.                                                    03030007
030400                                                                  03040007
030500                                                                  03050007
030600     EXEC SQL                                                     03060007
030700        INCLUDE SQLCA                                             03070007
030800     END-EXEC.                                                    03080007
030900                                                                  03090007
031000     COPY SQLCA2.                                                 03100007
031100 EJECT                                                            03110007
031200*                                                                 03120007
031300*                                                                 03130007
031400 LINKAGE SECTION.                                                 03140007
031500*                                                                 03150007
031600*                                                                 03160007
031700*                                                                 03170007
031800 PROCEDURE DIVISION.                                              03180007
031900                                                                  03190007
032000 A100-MAIN-MODULE.                                                03200007
032100******************************************************************03210007
032200*  OPEN FILES                                                     03220007
032300*  READ THE FIRST ADVANCED SHIPPING NOTICE RECORD                 03230007
032400*  PROCESS EACH ASN RECORD IN THE FILE                            03240007
032500*  CLOSE THE FILES                                                03250007
032600******************************************************************03260007
032700*    DISPLAY 'A100-MAIN-MODULE'.                                  03270007
032800                                                                  03280007
032900     OPEN INPUT  ET-ASN-FILE                                      03290007
033000                 ET-PARM-CARD                                     03300007
033100          OUTPUT ET-ASN-ADJ-FILE                                  03310007
033200                 ET-ASN-RPT-FILE                                  03320007
033300                 ET-HALLMARK-STATUS-FILE.                         03330007
033400                                                                  03340007
033500     PERFORM A150-INITIALIZE.                                     03350007
033600                                                                  03360007
033700     SET PS-NOT-END-OF-FILE TO TRUE.                              03370007
033800                                                                  03380007
033900     PERFORM Z100-READ-ASN-FILE.                                  03390007
034000                                                                  03400007
034100     SET PS-NO-HALLMARK TO TRUE.                                  03410007
034200                                                                  03420007
034300     PERFORM B100-PROCESS-ASN-RECORD                              03430007
034400         UNTIL PS-END-OF-FILE.                                    03440007
034500                                                                  03450007
034600     IF PS-HALLMARK                                               03460007
034700*       **** WRITE PREVIOUS HALLMARK STATUS RECORD                03470007
034800        PERFORM Z250-WRITE-STATUS-FILE                            03480007
034900     END-IF.                                                      03490007
035000                                                                  03500007
035100     CLOSE ET-ASN-FILE                                            03510007
035200           ET-PARM-CARD                                           03520007
035300           ET-ASN-RPT-FILE                                        03530007
035400           ET-ASN-ADJ-FILE                                        03540007
035500           ET-HALLMARK-STATUS-FILE.                               03550007
035600                                                                  03560007
035700     STOP RUN.                                                    03570007
035800                                                                  03580007
035900 EJECT                                                            03590007
036000 A150-INITIALIZE.                                                 03600007
036100******************************************************************03610007
036200*    INITIALIZATION REPORT HEADER FIELDS.                         03620007
036300*                                                                 03630007
036400*    PERFORMED BY A100-MAIN-MODULE.                               03640007
036500******************************************************************03650007
036600*    DISPLAY 'A150-INITIALIZE'.                                   03660007
036700                                                                  03670007
036800     READ ET-PARM-CARD INTO WS-PARM-REC.                          03680007
036900                                                                  03690007
037000     ACCEPT WS-TODAYS-DATE                                        03700007
037100         FROM DATE.                                               03710007
037200                                                                  03720007
037300     MOVE WS-DD      TO DP132O-RUN-DAY                            03730007
037400                        WS-DD-DB2.                                03740007
037500     MOVE WS-MO      TO DP132O-RUN-MONTH                          03750007
037600                        WS-MO-DB2.                                03760007
037700     MOVE WS-YY      TO DP132O-RUN-YEAR                           03770007
037800                        WS-YY-DB2.                                03780007
037900                                                                  03790007
038000     ACCEPT WS-TODAYS-TIME                                        03800007
038100         FROM TIME.                                               03810007
038200                                                                  03820007
038300     MOVE WS-HH             TO DP132O-RUN-HOUR.                   03830007
038400     MOVE WS-MM             TO DP132O-RUN-MINUTE.                 03840007
038500                                                                  03850007
038600     MOVE 'ETKUT018' TO DP132O-PROGRAM-NAME.                      03860007
038700                                                                  03870007
038800 EJECT                                                            03880007
038900 B100-PROCESS-ASN-RECORD.                                         03890007
039000******************************************************************03900007
039100*  FOR EACH 'ID' SEGMENT ON THE INPUT FILE, READ THE TRADING      03910007
039200*  PARTNER TABLES TO DETERMINE WHETHER THE VENDOR IS ACTIVE AND   03920007
039300*  WHAT THE ENTITY ID IS.  IF MULTIPLE ENTITY ID'S ARE FOUND      03930007
039400*  MOVE SPACES TO THE DUNNS NUMBER AND RE-WRITE THE RECORD.       03940007
039500*  IF NO ENTITY ID'S ARE FOUND, ABEND.  OTHERWISE, RETRIEVE THE   03950007
039600*  DUNNS NUMBER FROM THE TEXTENT TABLE USING THE ENTITY ID.       03960007
039700*  WRITE OUT THE ID SEGMENT.  NON-'ID' SEGMENTS WILL BE WRITTEN   03970007
039800*  TO THE OUTPUT FILE WITHOUT BEING ALTERED.                      03980007
039900*                                                                 03990007
040000*  PERFORMED BY A100-MAIN-MODULE.                                 04000007
040100******************************************************************04010007
040200*    DISPLAY 'B100-PROCESS-ASN-RECORD'.                           04020007
040300                                                                  04030007
040400     SET PS-ENT-ID-NOT-FOUND TO TRUE.                             04040007
040500     SET PS-SINGLE-ENT-ID    TO TRUE.                             04050007
040600     MOVE +0 TO PV-COUNTER.                                       04060007
040700                                                                  04070007
040800     IF ET012-HEADER-LEVEL-ID = PC-IDENTIFICATION-SEGMENT         04080007
040900                                                                  04090007
041000        IF PS-HALLMARK                                            04100007
041100*          **** WRITE PREVIOUS HALLMARK STATUS RECORD             04110007
041200           PERFORM Z250-WRITE-STATUS-FILE                         04120007
041300        END-IF                                                    04130007
041400                                                                  04140007
041500        SET PS-TP-SETUP TO TRUE                                   04150007
041600                                                                  04160007
041700        PERFORM Z400-OPEN-CURSOR                                  04170007
041800        PERFORM Z500-FETCH-ROWS                                   04180007
041900                                                                  04190007
042000        PERFORM C100-PROCESS-ENTITY-ID                            04200007
042100             UNTIL SQLCODE = +100                                 04210007
042200                                                                  04220007
042300        PERFORM Z600-CLOSE-CURSOR                                 04230007
042400                                                                  04240007
042500        IF PS-ENT-ID-FOUND AND PS-MULTIPLE-ENT-ID                 04250007
042600           MOVE SPACES TO EXTENT-DUN-NBR                          04260007
042700           SET PS-NO-HALLMARK TO TRUE                             04270007
042800        ELSE                                                      04280007
042900           IF PS-ENT-ID-FOUND                                     04290007
043000              PERFORM Z300-RETREIVE-DUNN-NUMBER                   04300007
043100                                                                  04310007
043200              IF EXTENT-DUN-NBR = PC-HALLMARK-DUN-NBR             04320007
043300              OR EXTENT-DUN-NBR = PC-BEAUTY-BANK-DUN-NBR          04330007
043400                 SET PS-HALLMARK TO TRUE                          04340007
043500                 MOVE ET012-EDI-VENDOR-ID TO ET013-EDI-VENDOR-ID  04350007
043600                 MOVE EXTENT-DUN-NBR      TO ET013-DUNNS-NUMBER   04360007
043700                 MOVE ET012-ASN-NUMBER    TO ET013-ASN-NUMBER     04370007
043800                                                                  04380007
043900                 IF ET012-RECYCLE-DATE = SPACES OR ZEROES         04390007
044000                       MOVE WS-TODAYS-DATE TO ET012-RECYCLE-DATE  04400007
044100                 END-IF                                           04410007
044200                                                                  04420007
044300                 SET ET013-ASN-OK TO TRUE                         04430007
044400              ELSE                                                04440007
044500                 SET PS-NO-HALLMARK TO TRUE                       04450007
044600              END-IF                                              04460007
044700           ELSE                                                   04470007
044800              SET PS-TP-NOT-SETUP TO TRUE                         04480007
044900                                                                  04490007
045000              MOVE ET012-INTERCHANGE-ID-QUAL TO                   04500007
045100                          RD-INTERCHANGE-QUAL                     04510007
045200              MOVE ET012-INTERCHANGE-ID      TO                   04520007
045300                          RD-INTERCHANGE-ID                       04530007
045400                                                                  04540007
045500              IF PC-LINE-CNTR > PC-MAX-LINES                      04550007
045600                 PERFORM Z700-PRINT-HEADING                       04560007
045700              END-IF                                              04570007
045800                                                                  04580007
045900              PERFORM Z800-PRINT-DETAIL                           04590007
046000                                                                  04600007
046100           END-IF                                                 04610007
046200        END-IF                                                    04620007
046300                                                                  04630007
046400        IF PS-TP-SETUP                                            04640007
046500            MOVE ET012-ADV-SHIP-NOTICE TO                         04650007
046600                     ADVANCE-SHIP-NOTICE-DTL-RECORD               04660007
046700            MOVE SPACES TO SN001I-EDI-VEND-ID                     04670007
046800            MOVE EXTENT-DUN-NBR TO SN001I-VEND-DUNNS-NBR          04680007
046900            PERFORM Z200-WRITE-ASN-FILE                           04690007
047000        END-IF                                                    04700007
047100                                                                  04710007
047200     ELSE                                                         04720007
047300                                                                  04730007
047400        IF PS-TP-SETUP                                            04740007
047500           MOVE ET012-ADV-SHIP-NOTICE TO                          04750007
047600                ADVANCE-SHIP-NOTICE-DTL-RECORD                    04760007
047700           PERFORM Z200-WRITE-ASN-FILE                            04770007
047800                                                                  04780007
047900           IF ET012-HEADER-LEVEL-ID = PC-HEADER-ID-PRF   AND      04790007
048000                     PS-HALLMARK                                  04800007
048100                                                                  04810007
048200              MOVE ET012-PO-NUMBER TO DP010I-UNEDITED-FIELD       04820007
048300              MOVE +15             TO DP010I-MAXIMUM-DIGITS       04830007
048400              MOVE +0              TO DP010I-MAXIMUM-DECIMALS     04840007
048500                                                                  04850007
048600              SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE             04860007
048700                                                                  04870007
048800              CALL DP010I-NUMERIC-EDIT-ROUTINE                    04880007
048900                   USING DP010I-NUMERIC-EDIT-AREA                 04890007
049000                                                                  04900007
049100              IF DP010I-ERROR-DETECTED                            04910007
049200                  SET ET013-ASN-RECYCLE TO TRUE                   04920007
049300              ELSE                                                04930007
049400                  MOVE DP010I-NUM-FIELD-15-DIG-2-DEC TO           04940007
049500                              WS-PO-NUM-DIG                       04950007
049600                  PERFORM C200-SELECT-PO-NBR                      04960007
049700              END-IF                                              04970007
049800           END-IF                                                 04980007
049900                                                                  04990007
050000        END-IF                                                    05000007
050100                                                                  05010007
050200     END-IF.                                                      05020007
050300                                                                  05030007
050400     PERFORM Z100-READ-ASN-FILE.                                  05040007
050500                                                                  05050007
050600 EJECT                                                            05060007
050700 C100-PROCESS-ENTITY-ID.                                          05070007
050800******************************************************************05080007
050900*  SET A FLAG IF AN ENTITY ID IS FOUND ON THE TRADING PARTNERSHIP 05090007
051000*  TABLES.  SET ANOTHER FLAG IS MORE THAN ONE ENTITY IS FOUND.    05100007
051100*                                                                 05110007
051200*  PERFORMED BY B100-PROCESS-ASN-RECORD.                          05120007
051300******************************************************************05130007
051400*    DISPLAY 'C100-PROCESS-ENTITY-ID'.                            05140007
051500                                                                  05150007
051600     IF SQLCODE = +000                                            05160007
051700        SET PS-ENT-ID-FOUND TO TRUE                               05170007
051800        ADD +1 TO PV-COUNTER                                      05180007
051900                                                                  05190007
052000        IF PV-COUNTER > 1                                         05200007
052100           SET PS-MULTIPLE-ENT-ID TO TRUE                         05210007
052200        END-IF                                                    05220007
052300     END-IF.                                                      05230007
052400                                                                  05240007
052500     PERFORM Z500-FETCH-ROWS.                                     05250007
052600                                                                  05260007
052700 EJECT                                                            05270007
052800 C200-SELECT-PO-NBR.                                              05280007
052900******************************************************************05290007
053000*  SELECT THE PO NUMBER FROM THE TPURCHS TABLE                    05300007
053100*                                                                 05310007
053200*  PERFORMED BY B100-PROCESS-ASN-RECORD.                          05320007
053300******************************************************************05330007
053400*    DISPLAY 'C200-SELECT-PO-NBR'.                                05340007
053500                                                                  05350007
053600     EXEC SQL                                                     05360007
053700          SELECT PO_NBR                                           05370007
053800          INTO   :PURCHS-PO-NBR                                   05380007
053900          FROM   TPURCHS                                          05390007
054000          WHERE  TPURCHS.PO_NBR = :WS-PO-NUM-DIG                  05400007
054100     END-EXEC.                                                    05410007
054200                                                                  05420007
054300     EVALUATE TRUE                                                05430007
054400                                                                  05440007
054500         WHEN SQLCODE = +000                                      05450007
054600         WHEN SQLCODE = -811                                      05460007
054700             CONTINUE                                             05470007
054800         WHEN SQLCODE = +100                                      05480007
054900             SET ET013-ASN-RECYCLE TO TRUE                        05490007
055000         WHEN OTHER                                               05500007
055100             MOVE 'C200-SELECT-PO-NBR ' TO PV-PARAGRAPH-NAME      05510007
055200             MOVE 'SELECT ON TPURCHS'   TO PV-DB2-OPER-ATTEMPTED  05520007
055300                                                                  05530007
055400             PERFORM Z999-SQL-ERROR                               05540007
055500                                                                  05550007
055600     END-EVALUATE.                                                05560007
055700                                                                  05570007
055800                                                                  05580007
055900 EJECT                                                            05590007
056000 Z100-READ-ASN-FILE.                                              05600007
056100******************************************************************05610007
056200*  READ THE ASN FILE.                                             05620007
056300*                                                                 05630007
056400*  PERFORMED BY A100-MAIN-MODULE.                                 05640007
056500*               B100-PROCESS-ASN-RECORD.                          05650007
056600******************************************************************05660007
056700*    DISPLAY 'Z100-READ-ASN-FILE'.                                05670007
056800                                                                  05680007
056900     READ ET-ASN-FILE                                             05690007
057000         INTO ET012-ADV-SHIP-NOTICE                               05700007
057100         AT END                                                   05710007
057200             SET PS-END-OF-FILE TO TRUE.                          05720007
057300                                                                  05730007
057400                                                                  05740007
057500 EJECT                                                            05750007
057600 Z200-WRITE-ASN-FILE.                                             05760007
057700******************************************************************05770007
057800*  WRITE THE OUTPUT FILE.                                         05780007
057900*                                                                 05790007
058000*  PERFORMED BY B100-PROCESS-ASN-RECORD.                          05800007
058100******************************************************************05810007
058200*    DISPLAY 'Z200-WRITE-ASN-FILE'.                               05820007
058300                                                                  05830007
058400     WRITE ET-ASN-ADJ-FILE-RECORD                                 05840007
058500         FROM ADVANCE-SHIP-NOTICE-DTL-RECORD.                     05850007
058600                                                                  05860007
058700 EJECT                                                            05870007
058800 Z250-WRITE-STATUS-FILE.                                          05880007
058900******************************************************************05890007
059000*  WRITE THE STATUS RECORD FOR THE PREVIOUS HALLMARK RECORD       05900007
059100*                                                                 05910007
059200*  PERFORMED BY B100-PROCESS-ASN-RECORD.                          05920007
059300******************************************************************05930007
059400*    DISPLAY 'Z250-WRITE-STATUS-FILE'.                            05940007
059500                                                                  05950007
059600     WRITE ET-HALLMARK-STATUS-RECORD                              05960007
059700         FROM ET013-HALLMARK-ASN-STATUS.                          05970007
059800                                                                  05980007
059900 EJECT                                                            05990007
060000 Z300-RETREIVE-DUNN-NUMBER.                                       06000007
060100******************************************************************06010007
060200*  RETRIEVE THE DUNNS NUMBER FROM THE TEXTENT TABLE.              06020007
060300*                                                                 06030007
060400*  PERFORMED BY B100-PROCESS-ASN-RECORD.                          06040007
060500******************************************************************06050007
060600*    DISPLAY 'Z300-RETREIVE-DUNN-NUMBER'.                         06060007
060700                                                                  06070007
060800     EXEC SQL                                                     06080007
060900          SELECT DUN_NBR                                          06090007
061000          INTO   :EXTENT-DUN-NBR                                  06100007
061100          FROM   TEXTENT                                          06110007
061200          WHERE  TEXTENT.ENT_ID = :TRDPRT-ENT-ID                  06120007
061300     END-EXEC.                                                    06130007
061400                                                                  06140007
061500     EVALUATE TRUE                                                06150007
061600                                                                  06160007
061700         WHEN SQLCODE = +000                                      06170007
061800             CONTINUE                                             06180007
061900         WHEN SQLCODE = +100                                      06190007
062000             MOVE SPACES TO EXTENT-DUN-NBR                        06200007
062100         WHEN SQLWARN NOT = SPACES                                06210007
062200         WHEN SQLCODE NOT = +000                                  06220007
062300             MOVE 'Z300-FETCH-CURSOR ' TO PV-PARAGRAPH-NAME       06230007
062400             MOVE 'FETCH ON TEXTENT' TO PV-DB2-OPER-ATTEMPTED     06240007
062500                                                                  06250007
062600             PERFORM Z999-SQL-ERROR                               06260007
062700                                                                  06270007
062800     END-EVALUATE.                                                06280007
062900                                                                  06290007
063000 EJECT                                                            06300007
063100 Z400-OPEN-CURSOR.                                                06310007
063200******************************************************************06320007
063300*  OPEN THE PURCHASE ORDER CURSOR.                                06330007
063400*                                                                 06340007
063500*  PERFORMED BY B100-PROCESS-ASN-RECORD.                          06350007
063600******************************************************************06360007
063700*    DISPLAY 'Z400-OPEN-CURSOR'.                                  06370007
063800                                                                  06380007
063900     EXEC SQL                                                     06390007
064000         OPEN ENTITY_CUR                                          06400007
064100     END-EXEC.                                                    06410007
064200                                                                  06420007
064300     EVALUATE TRUE                                                06430007
064400                                                                  06440007
064500         WHEN SQLCODE = +000                                      06450007
064600             CONTINUE                                             06460007
064700         WHEN SQLWARN NOT = SPACES                                06470007
064800         WHEN SQLCODE NOT = +000                                  06480007
064900             MOVE 'Z100-OPEN-CURSOR'  TO PV-PARAGRAPH-NAME        06490007
065000             MOVE 'OPEN ON PO CURSOR' TO PV-DB2-OPER-ATTEMPTED    06500007
065100                                                                  06510007
065200             PERFORM Z999-SQL-ERROR                               06520007
065300                                                                  06530007
065400     END-EVALUATE.                                                06540007
065500 EJECT                                                            06550007
065600 Z500-FETCH-ROWS.                                                 06560007
065700******************************************************************06570007
065800*   FETCH THE PURCHASE ORDER CURSOR ROWS                          06580007
065900*                                                                 06590007
066000*   PERFORMED BY B100-PROCESS-ASN-RECORD.                         06600007
066100*                C100-PROCESS-ENTITY-ID.                          06610007
066200******************************************************************06620007
066300*    DISPLAY 'Z500-FETCH-ROWS'.                                   06630007
066400                                                                  06640007
066500     EXEC SQL                                                     06650007
066600         FETCH ENTITY_CUR                                         06660007
066700         INTO  :TRDPRT-ENT-ID                                     06670007
066800     END-EXEC.                                                    06680007
066900                                                                  06690007
067000     EVALUATE TRUE                                                06700007
067100                                                                  06710007
067200         WHEN SQLCODE = +100                                      06720007
067300             CONTINUE                                             06730007
067400         WHEN SQLCODE = +000                                      06740007
067500             CONTINUE                                             06750007
067600         WHEN SQLWARN NOT = SPACES                                06760007
067700         WHEN SQLCODE NOT = +000                                  06770007
067800             MOVE 'Z 00-FETCH-ROWS'    TO PV-PARAGRAPH-NAME       06780007
067900             MOVE 'FETCH ON ENTITY ID' TO PV-DB2-OPER-ATTEMPTED   06790007
068000                                                                  06800007
068100             PERFORM Z999-SQL-ERROR                               06810007
068200                                                                  06820007
068300     END-EVALUATE.                                                06830007
068400 EJECT                                                            06840007
068500 Z600-CLOSE-CURSOR.                                               06850007
068600******************************************************************06860007
068700*   CLOSE THE PURCHASE ORDER CURSOR                               06870007
068800*                                                                 06880007
068900*   PERFORMED BY B100-PROCESS-ASN-RECORD.                         06890007
069000******************************************************************06900007
069100*    DISPLAY 'Z600-CLOSE-CURSOR'.                                 06910007
069200                                                                  06920007
069300     EXEC SQL                                                     06930007
069400         CLOSE ENTITY_CUR                                         06940007
069500     END-EXEC.                                                    06950007
069600                                                                  06960007
069700     EVALUATE TRUE                                                06970007
069800                                                                  06980007
069900         WHEN SQLCODE = +000                                      06990007
070000             CONTINUE                                             07000007
070100         WHEN SQLWARN NOT = SPACES                                07010007
070200         WHEN SQLCODE NOT = +000                                  07020007
070300             MOVE 'Z 00-CLOSE-CURSOR'  TO PV-PARAGRAPH-NAME       07030007
070400             MOVE 'CLOSE ON ENTITY ID' TO PV-DB2-OPER-ATTEMPTED   07040007
070500                                                                  07050007
070600             PERFORM Z999-SQL-ERROR                               07060007
070700                                                                  07070007
070800     END-EVALUATE.                                                07080007
070900 EJECT                                                            07090007
071000 Z700-PRINT-HEADING.                                              07100007
071100******************************************************************07110007
071200*    PRINT HEADING                                                07120007
071300*                                                                 07130007
071400*    PERFORMED BY B100-PROCESS-ASN-RECORD.                        07140007
071500******************************************************************07150007
071600                                                                  07160007
071700     ADD  1 TO PC-PAGE-CNTR.                                      07170007
071800                                                                  07180007
071900     MOVE SPACES TO ET-ASN-RPT-FILE-RECORD.                       07190007
072000     WRITE ET-ASN-RPT-FILE-RECORD                                 07200007
072100         AFTER ADVANCING PAGE.                                    07210007
072200     MOVE +1 TO PC-LINE-CNTR.                                     07220007
072300                                                                  07230007
072400     MOVE 1 TO DP132O-REPORT-NUMBER.                              07240007
072500     MOVE PC-PAGE-CNTR TO DP132O-PAGE-NUMBER.                     07250007
072600                                                                  07260007
072700     WRITE ET-ASN-RPT-FILE-RECORD                                 07270007
072800         FROM DP132O-STANDRD-HEADER-132-COLS                      07280007
072900         AFTER ADVANCING 1 LINE.                                  07290007
073000     ADD +1 TO PC-LINE-CNTR.                                      07300007
073100                                                                  07310007
073200     WRITE ET-ASN-RPT-FILE-RECORD                                 07320007
073300         FROM RT-REPORT-TITLE                                     07330007
073400         AFTER ADVANCING 1 LINES.                                 07340007
073500     ADD +1 TO PC-LINE-CNTR.                                      07350007
073600                                                                  07360007
073700     WRITE ET-ASN-RPT-FILE-RECORD                                 07370007
073800         FROM RH-REPORT-HEADING                                   07380007
073900         AFTER ADVANCING 2 LINES.                                 07390007
074000     ADD +2 TO PC-LINE-CNTR.                                      07400007
074100                                                                  07410007
074200 EJECT                                                            07420007
074300 Z800-PRINT-DETAIL.                                               07430007
074400******************************************************************07440007
074500*    PRINT DETAIL LINES ON THE REPORT ( TRADING PARTNER NOT FOUND)07450007
074600*                                                                 07460007
074700*    PERFORMED BY B100-PROCESS-ASN-RECORD.                        07470007
074800******************************************************************07480007
074900                                                                  07490007
075000     WRITE ET-ASN-RPT-FILE-RECORD                                 07500007
075100         FROM RD-REPORT-DETAIL                                    07510007
075200         AFTER ADVANCING 2 LINE.                                  07520007
075300     ADD +2 TO PC-LINE-CNTR.                                      07530007
075400                                                                  07540007
075500 EJECT                                                            07550007
075600 Z999-SQL-ERROR.                                                  07560007
075700******************************************************************07570007
075800*    SQL ABEND ROUTINE                                            07580007
075900******************************************************************07590007
076000                                                                  07600007
076100     SET ABEND-4013 TO TRUE.                                      07610007
076200                                                                  07620007
076300     DISPLAY '**  ABEND     **'.                                  07630007
076400     DISPLAY '**  PROGRAM   **  =  ETKUT018'.                     07640007
076500     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            07650007
076600     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        07660007
076700*                                                                 07670007
076800*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07680007
076900*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07690007
077000*                                                                 07700007
077100     COPY DPPD004.                                                07710007
077200*                                                                 07720007
077300     CALL 'ILBOABN0'  USING ABEND-CODE.                           07730007
077400 EJECT                                                            07740007
