000100 IDENTIFICATION DIVISION.                                                 
000200 PROGRAM-ID.             PCKRP025.                                        
000300 AUTHOR.                 DEANNA BRANTNER.                                 
000400 INSTALLATION.           KOHLS DEPARTMENT STORES.                         
000500 DATE-WRITTEN.           JUNE 2006.                                       
000600 DATE-COMPILED.                                                           
000700************************************************************************  
000800* THIS IS COPY OF PCKRP022 BUT PROCESSING WAS ADDED TO USE CARTON STATUS  
000900* MODULE TO DETERMINE CARTON LOCATION.                                    
001000************************************************************************  
001100 ENVIRONMENT DIVISION.                                                    
001200 CONFIGURATION SECTION.                                                   
001300 SOURCE-COMPUTER.                        IBM-3090.                        
001400 OBJECT-COMPUTER.                        IBM-3090.                        
001500 INPUT-OUTPUT SECTION.                                                    
001600 FILE-CONTROL.                                                            
001700                                                                          
001800     SELECT EXTRACT-FILE                                                  
001900         ASSIGN TO INP01.                                                 
002000                                                                          
002100     SELECT  REPORT-FILE                                                  
002200         ASSIGN TO RPT01.                                                 
002300                                                                          
002400************************************************************************  
002500 DATA DIVISION.                                                           
002600 FILE SECTION.                                                            
002700                                                                          
002800 FD  EXTRACT-FILE                                                         
002900     RECORDING MODE IS F                                                  
003000     LABEL RECORDS ARE STANDARD                                           
003100     BLOCK CONTAINS 0 RECORDS.                                            
003200 01  ERROR-RECORD                     PIC X(150).                         
003300                                                                          
003400 FD  REPORT-FILE                                                          
003500     RECORDING MODE IS F                                                  
003600     LABEL RECORDS ARE STANDARD                                           
003700     BLOCK CONTAINS 0 RECORDS.                                            
003800 01  REPORT-RECORD                    PIC X(132).                         
003900                                                                          
004000************************************************************************  
004100 WORKING-STORAGE SECTION.                                                 
004200 01  PS-SWITCHES.                                                         
004300     05  PS-EOF-ERROR-SWITCH          PIC X(01) VALUE 'N'.                
004400         88  PS-EOF-ERROR-FILE                  VALUE 'Y'.                
004500                                                                          
004600     05  PS-END-CSR-SW                PIC X(01) VALUE 'N'.                
004700         88  PS-END-CSR-YES                     VALUE 'Y'.                
004800         88  PS-END-CSR-NO                      VALUE 'N'.                
004900     05  PS-END-CSR2-SW               PIC X(01) VALUE 'N'.                
005000         88  PS-END-CSR2-YES                    VALUE 'Y'.                
005100         88  PS-END-CSR2-NO                     VALUE 'N'.                
005200     05  PS-ERROR-SW                  PIC X(01) VALUE 'N'.                
005300         88  PS-ERROR-YES                       VALUE 'Y'.                
005400         88  PS-ERROR-NO                        VALUE 'N'.                
005500                                                                          
005600     05  PS-BLANK-LINE-SWITCH         PIC X(01) VALUE 'N'.                
005700         88  PS-BLANK-LINE                      VALUE 'Y'.                
005800         88  PS-BLANK-LINE-NO                   VALUE 'N'.                
005900     05  PS-DEPT-LINE-SWITCH          PIC X(01) VALUE 'N'.                
006000         88  PS-DEPT-LINE                       VALUE 'Y'.                
006100         88  PS-DEPT-LINE-NO                    VALUE 'N'.                
006200     05  PS-STORE-LINE-SWITCH         PIC X(01) VALUE 'N'.                
006300         88  PS-STORE-LINE                      VALUE 'Y'.                
006400         88  PS-STORE-LINE-NO                   VALUE 'N'.                
006500     05  PS-DC-LINE-SWITCH            PIC X(01) VALUE 'N'.                
006600         88  PS-DC-LINE                         VALUE 'Y'.                
006700         88  PS-DC-LINE-NO                      VALUE 'N'.                
006800                                                                          
006900     05  PS-LOAD-STATUS-SW              PIC  9(01)  VALUE 0.      01980000
007000         88  PS-ASSUMED                             VALUE 1.      01990000
007100         88  PS-DIVERTED                            VALUE 2.      02000000
007200                                                                          
007300*    05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01980000
007400*        88  PS-SKIP-NO                             VALUE 'N'.    01990000
007500*        88  PS-SKIP-YES                            VALUE 'Y'.    02000000
007600                                                                          
007700 01  DK-DB-KEYS.                                                          
007800     05  DK-STORE-NBR                 PIC S9(04) COMP VALUE ZERO.         
007900     05  DK-LINE-NBR                  PIC S9(09) COMP VALUE ZERO.         
008000                                                                          
008100 01  ABEND-CODE                       PIC S9(04) VALUE ZERO               
008200                                                 COMP SYNC.               
008300     88  ABEND-4013-DB2-ERROR                        VALUE +4013.         
008400                                                                          
008500 01  SD-SYSTEM-DATE.                                                      
008600     05  SD-SYSTEM-DATE-YY          PIC  9(02)   VALUE ZERO.              
008700     05  SD-SYSTEM-DATE-MM          PIC  9(02)   VALUE ZERO.              
008800     05  SD-SYSTEM-DATE-DD          PIC  9(02)   VALUE ZERO.              
008900                                                                          
009000 01  ST-SYSTEM-TIME.                                                      
009100     05  ST-SYSTEM-HOUR             PIC  9(02)   VALUE ZERO.              
009200     05  ST-SYSTEM-MINUTE           PIC  9(02)   VALUE ZERO.              
009300     05  FILLER                     PIC  9(04)   VALUE ZERO.              
009400                                                                          
009500 01  PV-VARIABLES.                                                        
009600     05  PV-COMPILE-DATE              PIC X(016) VALUE SPACES.    00350000
009700     05  PV-TMST                      PIC X(26) VALUE SPACES.             
009800     05  PV-READ-COUNT                PIC S9(7) COMP-3                    
009900                                                VALUE ZERO.               
009910     05  PV-NOCALL-CNT                PIC S9(7) COMP-3                    
009920                                                VALUE ZERO.               
009930     05  PV-CALL-CNT                  PIC S9(7) COMP-3                    
009940                                                VALUE ZERO.               
010000     05  PV-WRITE-COUNT               PIC S9(7) COMP-3                    
010100                                                VALUE ZERO.               
010200     05  PV-PAGE-COUNT                PIC S9(7) COMP-3                    
010300                                                VALUE ZERO.               
010400     05  PV-LINES-USED                PIC S9(4) COMP-3                    
010500                                                VALUE ZERO.               
010600     05  PV-CTNS-IN-CSR-COUNT         PIC S9(4) COMP-3                    
010700                                                VALUE ZERO.               
010800     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO               
010900                                                 COMP SYNC.               
011000     05  PV-DB2-FUNCTION              PIC X(30) VALUE SPACES.             
011100     05  PV-PARAGRAPH                 PIC X(30) VALUE SPACES.             
011200     05  PV-DISP-SML                  PIC Z(18).                          
011210     05  PV-DISP-NUMBER               PIC Z,ZZZ,ZZ9.                      
011300     05  PV-DISP-COUNT                PIC Z,ZZZ,ZZZ,ZZ9.                  
011400     05  PV-PREV-DEPT-NBR             PIC 9(05).                          
011500     05  PV-PREV-DC                   PIC 9(05).                          
011600     05  PV-PREV-STORE                PIC 9(05).                          
011700     05  PV-PREV-DEPT                 PIC 9(05).                          
011800     05  PV-PREV-PO                   PIC S9(09) COMP.                    
011900     05  PV-PREV-RCVR                 PIC S9(09) COMP.                    
012000     05  PV-PREV-LINE                 PIC  9(04).                         
012100     05  PV-OTBND-TRIP                PIC S9(09) COMP.                    
012200     05  PV-DEPT-EXP-TOTAL            PIC S9(09) COMP.                    
012300     05  PV-STORE-EXP-TOTAL           PIC S9(09) COMP.                    
012400     05  PV-GRAND-EXP-TOTAL           PIC S9(09) COMP.                    
012500     05  PV-TRIP                      PIC Z(10).                          
012510     05  PV-PREV-CARTON-ID           PIC S9(18)V VALUE ZEROES.            
012520     05  PV-PREV-STATUS               PIC X(40)   VALUE SPACES.           
012600     05  PV-CARTON                    PIC Z(18).                          
012700     05  PV-TALLY                     PIC S9(09) COMP.                    
012800     05  PV-DETLINE-PRT-COUNT         PIC S9(09) COMP VALUE ZERO.         
012900                                                                          
013000     05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.             
013100     05  PV-SAVE-START-DATE           PIC X(10) VALUE SPACES.             
013200     05  PV-DB2-DATE.                                                     
013300         10  PV-DB2-CC                  PIC X(02).                        
013400         10  PV-DB2-YY                  PIC X(02).                        
013500         10  FILLER                     PIC X(01).                        
013600         10  PV-DB2-MM                  PIC X(02).                        
013700         10  FILLER                     PIC X(01).                        
013800         10  PV-DB2-DD                  PIC X(02).                        
013900         10  FILLER                     PIC X(01).                        
014000         10  PV-DB2-HH                  PIC X(02).                        
014100         10  FILLER                     PIC X(01).                        
014200         10  PV-DB2-MN                  PIC X(02).                        
014300         10  FILLER                     PIC X(01).                        
014400         10  PV-DB2-SS                  PIC X(09).                        
014500     05  PV-KEY-DATE.                                                     
014600         10  PV-KEY-MM               PIC X(02).                           
014700         10  FILLER                  PIC X(01) VALUE '/'.                 
014800         10  PV-KEY-DD               PIC X(02).                           
014900         10  FILLER                  PIC X(01) VALUE '/'.                 
015000         10  PV-KEY-YY               PIC X(02).                           
015100                                                                          
015200     05  PV-CRTN-STAT-DESC            PIC X(07) VALUE SPACES.             
015300                                                                          
015400 01  PC-CONSTANTS.                                                        
015500     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRP025'.         
015600     05  PC-END-OF-PAGE               PIC S9(3) COMP-3 VALUE +60.         
015700     05  PC-MAX-RETRIES               PIC S9(04)    VALUE  +3             
015800                                                   COMP.                  
015900     05  PC-CRTN-STAT-DESC.                                       00500000
016000         10  PC-INVALID-DESC            PIC X(7) VALUE 'INVALID'. 00510000
016100         10  PC-INACT-DESC              PIC X(7) VALUE 'INACTIV'. 00520000
016200         10  PC-SC-OF-DESC              PIC X(7) VALUE 'SCD OFF'. 00530000
016300         10  PC-SC-ON-DESC              PIC X(7) VALUE 'SCND ON'. 00540000
016400         10  PC-DVRT-DESC               PIC X(7) VALUE 'DIVERTD'. 00550000
016500         10  PC-ASSUM-DESC              PIC X(7) VALUE 'ASSUMED'. 00560000
016600         10  PC-LOADED-DESC             PIC X(7) VALUE 'LOADED '. 00570000
016700         10  PC-CSEPK-DESC              PIC X(7) VALUE 'CASEPCK'. 00580000
016800         10  PC-CK-IN-DESC              PIC X(7) VALUE 'CHKD-IN'. 00590000
016900         10  PC-P2L-DESC                PIC X(7) VALUE 'P2L    '. 00600000
017000         10  PC-RDM-DESC                PIC X(7) VALUE 'CRD RDM'. 00610000
017100         10  PC-RECV-DESC               PIC X(7) VALUE 'CRD RCV'. 00620000
017200         10  PC-ASN-DESC                PIC X(7) VALUE 'CRD ASN'. 00630000
017300         10  PC-SMTH-DESC               PIC X(7) VALUE 'CRD SMO'. 00640000
017400         10  PC-XFER-DESC               PIC X(7) VALUE 'CRD XFR'. 00650000
017500         10  PC-MSTR-DESC               PIC X(7) VALUE 'CRD MST'. 00660000
017600         10  PC-BLD-DESC                PIC X(7) VALUE 'CRD BLD'. 00670000
017700         10  PC-ASSUMED                 PIC X(7) VALUE 'ASSUMED'. 00680000
017800         10  PC-ROUTE-JWL               PIC X(7) VALUE 'JEWELRY'. 00680000
017900         10  PC-ROUTE-DMG               PIC X(7) VALUE 'DAMAGED'. 00680000
018000                                                                          
018100***  STANDARD REPORT HEADER FOR 132 COLUMN REPORT                         
018200     COPY DPWS132O.                                                       
018300                                                                          
018400*    ERROR EXTRACT                                                        
018500     COPY PCRD038.                                                        
018600                                                                          
018700*COPYBOOK FOR CARTON STATUS MODULE - PCKUT713                             
018800     COPY PCWS046.                                                        
018900                                                                          
019000 01  HL-HEADING-LINE-1.                                                   
019100     05  FILLER                      PIC  X(63)  VALUE SPACES.            
019200     05  FILLER                      PIC  X(41)  VALUE                    
019300      'INVENTORY SUSPENSE REPORT                '.                        
019400     05  FILLER                      PIC  X(10)  VALUE SPACES.            
019500                                                                          
019600 01  HL-HEADING-LINE-1A.                                                  
019700     05  FILLER                      PIC  X(51)  VALUE SPACES.            
019800     05  FILLER                      PIC  X(47)  VALUE                    
019900      'INVENTORY STORES WITH UNBALANCED STORE EXPECTED'.                  
020000     05  FILLER                      PIC  X(10)  VALUE SPACES.            
020100                                                                          
020200 01  HL-HEADING-LINE-2A.                                                  
020300     05  FILLER                      PIC  X(07) VALUE  SPACES.            
020400     05  FILLER                      PIC  X(04) VALUE                     
020500         'DEPT'.                                                          
020600     05  FILLER                      PIC  X(02) VALUE  SPACES.            
020700     05  FILLER                      PIC  X(04) VALUE                     
020800         'SUB '.                                                          
020900     05  FILLER                      PIC  X(11) VALUE  SPACES.            
021000     05  FILLER                      PIC  X(04) VALUE                     
021100         'LINE'.                                                          
021200     05  FILLER                      PIC  X(33) VALUE  SPACES.            
021300     05  FILLER                      PIC  X(03) VALUE                     
021400         'REC'.                                                           
021500     05  FILLER                      PIC  X(02) VALUE  SPACES.            
021600     05  FILLER                      PIC  X(09) VALUE                     
021700         'STORE EXP'.                                                     
021800     05  FILLER                      PIC  X(47) VALUE  SPACES.            
021900     05  FILLER                      PIC  X(04) VALUE                     
022000         ' >3 '.                                                          
022100                                                                          
022200 01  HL-HEADING-LINE-2.                                                   
022300     05  FILLER                      PIC  X(05) VALUE                     
022400         'STORE'.                                                         
022500     05  FILLER                      PIC  X(02) VALUE  SPACES.            
022600     05  FILLER                      PIC  X(03) VALUE                     
022700         'NBR'.                                                           
022800     05  FILLER                      PIC  X(03) VALUE  SPACES.            
022900     05  FILLER                      PIC  X(03) VALUE                     
023000         'CLS'.                                                           
023100     05  FILLER                      PIC  X(04) VALUE  SPACES.            
023200     05  FILLER                      PIC  X(03) VALUE                     
023300         'SKU'.                                                           
023400     05  FILLER                      PIC  X(05) VALUE  SPACES.            
023500     05  FILLER                      PIC  X(03) VALUE                     
023600         'NBR'.                                                           
023700     05  FILLER                      PIC  X(04) VALUE  SPACES.            
023800     05  FILLER                      PIC  X(04) VALUE                     
023900         ' DC '.                                                          
024000     05  FILLER                      PIC  X(02) VALUE  SPACES.            
024100     05  FILLER                      PIC  X(11) VALUE                     
024200         'PO/RECEIVER'.                                                   
024300     05  FILLER                      PIC  X(03) VALUE  SPACES.            
024400     05  FILLER                      PIC  X(08) VALUE                     
024500         'VRFD DTE'.                                                      
024600     05  FILLER                      PIC  X(02) VALUE  SPACES.            
024700     05  FILLER                      PIC  X(03) VALUE                     
024800         'TYP'.                                                           
024900     05  FILLER                      PIC  X(04) VALUE  SPACES.            
025000     05  FILLER                      PIC  X(05) VALUE                     
025100         'UNITS'.                                                         
025200     05  FILLER                      PIC  X(04) VALUE  SPACES.            
025300     05  FILLER                      PIC  X(36) VALUE                     
025400         'OUTBOUND TRIP STATUS/CARTON LOCATION'.                          
025500     05  FILLER                      PIC  X(10) VALUE  SPACES.            
025600     05  FILLER                      PIC  X(05) VALUE                     
025700         'TRIPS'.                                                         
025800                                                                          
025900 01  HL-HEADING-LINE-3.                                                   
026000     05  FILLER                      PIC  X(05) VALUE                     
026100         '-----'.                                                         
026200     05  FILLER                      PIC  X(02) VALUE  SPACES.            
026300     05  FILLER                      PIC  X(04) VALUE                     
026400         '----'.                                                          
026500     05  FILLER                      PIC  X(02) VALUE  SPACES.            
026600     05  FILLER                      PIC  X(03) VALUE                     
026700         '---'.                                                           
026800     05  FILLER                      PIC  X(02) VALUE  SPACES.            
026900     05  FILLER                      PIC  X(08) VALUE                     
027000         '--------'.                                                      
027100     05  FILLER                      PIC  X(02) VALUE  SPACES.            
027200     05  FILLER                      PIC  X(04) VALUE                     
027300         '----'.                                                          
027400     05  FILLER                      PIC  X(02) VALUE  SPACES.            
027500     05  FILLER                      PIC  X(05) VALUE                     
027600         '-----'.                                                         
027700     05  FILLER                      PIC  X(02) VALUE  SPACES.            
027800     05  FILLER                      PIC  X(12) VALUE                     
027900         '------------'.                                                  
028000     05  FILLER                      PIC  X(02) VALUE  SPACES.            
028100     05  FILLER                      PIC  X(08) VALUE                     
028200         '--------'.                                                      
028300     05  FILLER                      PIC  X(02) VALUE  SPACES.            
028400     05  FILLER                      PIC  X(03) VALUE                     
028500         '---'.                                                           
028600     05  FILLER                      PIC  X(02) VALUE  SPACES.            
028700     05  FILLER                      PIC  X(09) VALUE                     
028800         '---------'.                                                     
028900     05  FILLER                      PIC  X(02) VALUE  SPACES.            
029000     05  FILLER                      PIC  X(44) VALUE                     
029100         '--------------------------------------------'.                  
029200     05  FILLER                      PIC  X(01) VALUE  SPACES.            
029300     05  FILLER                      PIC  X(05) VALUE                     
029400         '-----'.                                                         
029500                                                                          
029600 01  DL-DETAIL-LINE-1.                                                    
029700     05  DL-STORE                    PIC  ZZZZ9 VALUE ZERO.               
029800     05  FILLER                      PIC  X(02) VALUE  SPACES.            
029900     05  DL-DEPT-NBR                 PIC  9(03) VALUE ZERO.               
030000     05  FILLER                      PIC  X(02) VALUE  SPACES.            
030100     05  DL-SUB-CLASS                PIC  ZZZ9  VALUE ZERO.               
030200     05  FILLER                      PIC  X(02) VALUE  SPACES.            
030300     05  DL-SKU-NBR                  PIC  9(08) VALUE  ZEROES.            
030400     05  FILLER                      PIC  X(02) VALUE  SPACES.            
030500     05  DL-APP-PO-LNE-NBR           PIC  ZZZ9.                           
030600     05  DL-APP-PO-LNE-NBR-X REDEFINES DL-APP-PO-LNE-NBR                  
030700                                     PIC  X(04).                          
030800     05  FILLER                      PIC  X(02) VALUE  SPACES.            
030900     05  DL-DC                       PIC  ZZZZ9 VALUE ZERO.               
031000     05  FILLER                      PIC  X(02) VALUE  SPACES.            
031100     05  DL-PO-RCVR.                                                      
031200         10  DL-PO                   PIC  ZZZZZZZ9  VALUE ZERO.           
031300         10  DL-DASH                 PIC  X(01) VALUE  '-'.               
031400         10  DL-RCVR                 PIC  9(03) VALUE  ZEROES.            
031500     05  FILLER                      PIC  X(02) VALUE SPACES.             
031600     05  DL-VRFD-DATE                PIC  X(08) VALUE SPACES.             
031700     05  FILLER                      PIC  X(02) VALUE  SPACES.            
031800     05  DL-REC-TYP                  PIC  X(03) VALUE  SPACES.            
031900     05  FILLER                      PIC  X(04) VALUE  SPACES.            
032000     05  DL-STORE-EXP-UNITS          PIC  ZZZZ9-.                         
032100     05  FILLER                      PIC  X(03) VALUE  SPACES.            
032200     05  DL-STATUS                   PIC  X(46) VALUE  SPACES.            
032300     05  FILLER                      PIC  X(02) VALUE  SPACES.            
032400     05  DL-MULT-TRIP-IND            PIC  X(01) VALUE  SPACES.            
032500                                                                          
032600*01  DL-DETAIL-LINE-2.                                                    
032700*    05  FILLER                      PIC  X(07) VALUE  SPACES.            
032800*    05  FILLER                      PIC  X(05) VALUE  SPACES.            
032900*    05  FILLER                      PIC  X(06) VALUE  SPACES.            
033000*    05  FILLER                      PIC  X(10) VALUE  SPACES.            
033100*    05  FILLER                      PIC  X(06) VALUE  SPACES.            
033200*    05  FILLER                      PIC  X(07) VALUE  SPACES.            
033300*    05  FILLER                      PIC  X(14) VALUE SPACES.             
033400*    05  FILLER                      PIC  X(10) VALUE  SPACES.            
033500*    05  FILLER                      PIC  X(07) VALUE  SPACES.            
033600*    05  FILLER                      PIC  X(09) VALUE  SPACES.            
033700*    05  DL-STATUS-2                 PIC  X(46) VALUE  SPACES.            
033800*    05  FILLER                      PIC  X(03) VALUE  SPACES.            
033900                                                                          
034000 01 TOTAL-LINE-1.                                                         
034100     05  FILLER                  PIC  X(38)    VALUE SPACES.              
034200     05  FILLER                  PIC  X(24)    VALUE                      
034300              '*** DEPT EXP TOTAL:     '.                                 
034400     05  TL1-DEPT-EXP-TOTAL      PIC  ZZZZZZ9-.                           
034500                                                                          
034600 01 TOTAL-LINE-2.                                                         
034700     05  FILLER                  PIC  X(37)    VALUE SPACES.              
034800     05  FILLER                  PIC  X(22)    VALUE                      
034900              '*** STORE EXP TOTAL: '.                                    
035000     05  TL2-STORE-EXP-TOTAL     PIC  ZZZZZZZZZ9-.                        
035100                                                                          
035200 01 TOTAL-LINE-3.                                                         
035300     05  FILLER                  PIC  X(37)    VALUE SPACES.              
035400     05  FILLER                  PIC  X(21)    VALUE                      
035500              '*** GRAND EXP TOTAL: '.                                    
035600     05  TL3-GRAND-EXP-TOTAL     PIC ZZZZZZZZZZ9-.                        
035700                                                                          
035800 01  EP-EMPTY-REPORT-LINE.                                                
035900     05  FILLER                       PIC X(54)  VALUE SPACES.            
036000     05  FILLER                       PIC X(25)  VALUE                    
036100         '******* NO DATA *********'.                                     
036200     05  FILLER                       PIC X(54)  VALUE SPACES.            
036300                                                                          
036400 01  DL-BLANK-LINE                    PIC X(132) VALUE SPACES.            
036500                                                                          
036600 01  END-OF-REPORT-LINE.                                                  
036700     05  FILLER                  PIC  X(44)    VALUE SPACES.              
036800     05  FILLER                  PIC  X(45)    VALUE                      
036900          '*******   E N D   O F   R E P O R T   *******'.                
037000     05  FILLER                  PIC  X(43)    VALUE SPACES.              
037100                                                                          
037200*---------------------------------------------------------------*         
037300*    TSUOBTS - OUTBOUND TRAILER TRIP STATUS                     *         
037400*---------------------------------------------------------------*         
037500     EXEC SQL                                                             
037600          INCLUDE TSUOBTS                                                 
037700     END-EXEC.                                                            
037800                                                                          
037900*---------------------------------------------------------------*         
038000*    TRECEIV - RECEIVING TABLE                                            
038100*---------------------------------------------------------------*         
038200     EXEC SQL                                                             
038300          INCLUDE TRECEIV                                                 
038400     END-EXEC.                                                            
038500                                                                          
038600*---------------------------------------------------------------*         
038700     EXEC SQL                                                             
038800         INCLUDE SQLCA                                                    
038900     END-EXEC.                                                            
039000                                                                          
039100     COPY SQLCA2.                                                         
039200                                                                          
039300*---------------------------------------------------------------*         
039400*    SUT_OTBND_CART OUTBOUND CARTON TABLE                                 
039500*---------------------------------------------------------------*         
039600     EXEC SQL                                                             
039700          INCLUDE SUT00024                                                
039800     END-EXEC.                                                            
039900                                                                          
040000*---------------------------------------------------------------*         
040100*    SUT_OTBND_UPC UPC TABLE                                              
040200*---------------------------------------------------------------*         
040300     EXEC SQL                                                             
040400          INCLUDE SUT00028                                                
040500     END-EXEC.                                                            
040600                                                                          
040700*---------------------------------------------------------------*         
040800*    SUT_OTBND_VND                                                        
040900*---------------------------------------------------------------*         
041000     EXEC SQL                                                             
041100          INCLUDE SUT00026                                                
041200     END-EXEC.                                                            
041300                                                                          
041400*---------------------------------------------------------------*         
041500*    TPKSLIP                                                              
041600*---------------------------------------------------------------*         
041700     EXEC SQL                                                             
041800          INCLUDE TPKSLIP                                                 
041900     END-EXEC.                                                            
042000                                                                          
042100     EXEC SQL                                                             
042200          INCLUDE TSUCRDV                                                 
042300     END-EXEC.                                                            
042400                                                                          
042500     EXEC SQL                                                             
042600          INCLUDE TCNDCDR                                                 
042700     END-EXEC.                                                            
042800                                                                          
042900     EXEC SQL                                                             
043000          INCLUDE TSUOBTR                                                 
043100     END-EXEC.                                                            
043200                                                                          
043300     EXEC SQL                                                             
043400          INCLUDE TSUCDOT                                                 
043500     END-EXEC.                                                            
043600                                                                          
043700                                                                          
043800*----------------------------------------------------------------*        
043900*    CURSOR TO RETRIEVE CARTONS BY PO/RCVR/LINE/STORE                     
044000*----------------------------------------------------------------*        
044100     EXEC SQL                                                             
044200          DECLARE CARTON-CSR CURSOR FOR                                   
044300        SELECT  DISTINCT                                                  
044400                  A.SHIPT_UNT_ID                                          
044500             ,    A.SHPD_UNT_QTY                                          
044600          FROM  SUT_OTBND_UPC A                                           
044700               ,SUT_OTBND_CART B                                          
044800         WHERE  A.TRN_NBR           = :PC038-PO-NBR                       
044900           AND  A.RCVR_SEQ_NBR      = :PC038-RCVR-SEQ-NBR                 
045000           AND  A.TRN_LNE_NBR       = :DK-LINE-NBR                        
045100           AND  A.TRN_TYP_CDE       IN ('PO','CS')                        
045200           AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID                      
045300           AND  B.ACTV_IND          = 'Y'                                 
045400           AND  B.DEST_LOC_NBR      = :DK-STORE-NBR                       
045500         WITH UR                                                          
045600     END-EXEC                                                             
045700                                                                          
045800                                                                          
045900*    SECONDARY CARTON CURSOR.  USE ONLY IF NO ROWS IN CARTON-CSR          
046000     EXEC SQL                                                             
046100         DECLARE CARTON-CSR-2 CURSOR FOR                                  
046200          SELECT  DISTINCT A.SHIPT_UNT_ID                                 
046300             ,    A.SHPD_UNT_QTY                                          
046400            FROM  SUT_OTBND_UPC A                                         
046500                 ,SUT_OTBND_CART B                                        
046600                 ,SUT_OTBND_VND C                                         
046700                 ,TPKSLIP  D                                              
046800         WHERE  A.TRN_NBR           = :PC038-PO-NBR                       
046900           AND  A.TRN_LNE_NBR       = :DK-LINE-NBR                        
047000           AND  A.SHIPT_UNT_ID      = B.SHIPT_UNT_ID                      
047100           AND  B.ACTV_IND          = 'Y'                                 
047200           AND  B.CART_TYP_CDE NOT LIKE 'P'                               
047300           AND  B.DEST_LOC_NBR      = :DK-STORE-NBR                       
047400           AND  A.SHIPT_UNT_ID      = C.SHIPT_UNT_ID                      
047500           AND  A.TRN_NBR           = C.PO_NBR                            
047600           AND  C.PO_NBR            = D.PO_NBR                            
047700           AND  C.PKSL_SEQ_NBR      = D.SEQ_NBR                           
047800           AND  D.REC_SEQ_NBR       = :PC038-RCVR-SEQ-NBR                 
047900           AND  D.VER_STAT_CDE      = 'A'                                 
048000         WITH UR                                                          
048100     END-EXEC.                                                            
048200/                                                                         
048300 PROCEDURE DIVISION.                                                      
048400                                                                          
048500 0000-MAINLINE.                                                           
048600                                                                          
048700     PERFORM 1000-INITIALIZE.                                             
048800                                                                          
048900     PERFORM 2000-PROCESS UNTIL PS-EOF-ERROR-FILE.                        
049000                                                                          
049100     PERFORM 9000-EOJ.                                                    
049200                                                                          
049300     GOBACK.                                                              
049400                                                                          
049500 1000-INITIALIZE.                                                         
049600                                                                          
049700     DISPLAY ' PCKRP025 STARTED'                                          
049800     DISPLAY SPACES                                                       
049900     MOVE WHEN-COMPILED           TO PV-COMPILE-DATE                      
050000     DISPLAY ' COMPILED ON: ' PV-COMPILE-DATE (1:8)                       
050100                          ' ' PV-COMPILE-DATE (9:8)                       
050200                                                                          
050300     DISPLAY SPACES                                                       
050400     EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC                   
050500                                                                          
050600     OPEN OUTPUT REPORT-FILE                                              
050700* LOAD SYSTEM DATE INTO HEADINGS                                          
050800     ACCEPT SD-SYSTEM-DATE FROM DATE.                                     
050900     ACCEPT ST-SYSTEM-TIME FROM TIME.                                     
051000                                                                          
051100     MOVE SD-SYSTEM-DATE-YY      TO DP132O-RUN-YEAR.                      
051200     MOVE SD-SYSTEM-DATE-MM      TO DP132O-RUN-MONTH.                     
051300     MOVE SD-SYSTEM-DATE-DD      TO DP132O-RUN-DAY.                       
051400     MOVE ST-SYSTEM-HOUR         TO DP132O-RUN-HOUR.                      
051500     MOVE ST-SYSTEM-MINUTE       TO DP132O-RUN-MINUTE.                    
051600                                                                          
051700     MOVE PC-CURRENT-PROGRAM-NAME                                         
051800                                 TO DP132O-PROGRAM-NAME.                  
051900     MOVE 1                      TO DP132O-REPORT-NUMBER                  
052000                                    DP132O-PAGE-NUMBER                    
052100                                                                          
052200     PERFORM 8100-WRITE-MAIN-HEADINGS                                     
052300                                                                          
052400     OPEN INPUT EXTRACT-FILE                                              
052500     PERFORM 8000-READ-EXTRACT                                            
052600     MOVE PC038-DEPT-NBR          TO PV-PREV-DEPT                         
052700     MOVE PC038-LOC-NBR           TO PV-PREV-STORE                        
052800     IF PS-EOF-ERROR-FILE                                                 
052900         DISPLAY ' -- NO UNBALANCED STR EXP -- '                          
053000         WRITE REPORT-RECORD FROM EP-EMPTY-REPORT-LINE                    
053100             AFTER ADVANCING 3 LINES                                      
053200     ELSE                                                                 
053300         EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC               
053400         DISPLAY PV-TMST ' '   ' LOC = ' PC038-LOC-NBR                    
053500     END-IF.                                                              
053600                                                                          
053700*-----------------------------------------------------------------        
053800 2000-PROCESS.                                                            
053900*-----------------------------------------------------------------        
054000     IF   PC038-DEPT-NBR       =         PV-PREV-DEPT                     
054100         MOVE PC038-DEPT-NBR          TO DL-DEPT-NBR                      
054200      ELSE                                                                
054300         IF PV-DETLINE-PRT-COUNT > ZERO                                   
054400             SET PS-DEPT-LINE             TO TRUE                         
054500         END-IF                                                           
054600             MOVE PC038-DEPT-NBR          TO DL-DEPT-NBR                  
054700             MOVE PC038-DEPT-NBR          TO PV-PREV-DEPT                 
054800     END-IF.                                                              
054900                                                                          
055000     IF   PC038-LOC-NBR       =         PV-PREV-STORE                     
055100         MOVE PC038-LOC-NBR           TO DL-STORE                         
055200      ELSE                                                                
055300         SET PS-STORE-LINE            TO TRUE                             
055400         MOVE PC038-LOC-NBR           TO DL-STORE                         
055500         MOVE PC038-LOC-NBR           TO PV-PREV-STORE                    
055600         EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC               
055700         DISPLAY PV-TMST ' '                                              
055800                 ' LOC = ' PC038-LOC-NBR                                  
055900     END-IF.                                                              
056000                                                                          
056100     IF   PC038-PO-NBR            =     PV-PREV-PO                        
056200         IF   PC038-RCVR-SEQ-NBR  =     PV-PREV-RCVR                      
056300             MOVE PV-KEY-DATE TO DL-VRFD-DATE                             
056400          ELSE                                                            
056500             IF PC038-RCVR-SEQ-NBR > ZERO                                 
056600                 PERFORM 2400-GET-TRECEIV-VFYD-DATE                       
056700             ELSE                                                         
056800                 MOVE SPACES          TO DL-VRFD-DATE                     
056900             END-IF                                                       
057000         END-IF                                                           
057100                                                                          
057200      ELSE                                                                
057300                                                                          
057400         IF PC038-RCVR-SEQ-NBR > ZERO                                     
057500             PERFORM 2400-GET-TRECEIV-VFYD-DATE                           
057600         ELSE                                                             
057700             MOVE SPACES              TO DL-VRFD-DATE                     
057800         END-IF                                                           
057900     END-IF.                                                              
058000                                                                          
058100                                                                          
058200     MOVE PC038-OPER-UNT-ID           TO DL-DC.                           
058300     MOVE PC038-SUB-CL-NBR            TO DL-SUB-CLASS.                    
058400     MOVE PC038-PO-NBR                TO DL-PO.                           
058500     MOVE '-'                         TO DL-DASH.                         
058600     MOVE PC038-RCVR-SEQ-NBR          TO DL-RCVR.                         
058700     MOVE PC038-REC-TYP-CDE           TO DL-REC-TYP.                      
058800     MOVE PC038-SKU-9                 TO DL-SKU-NBR.                      
058900     IF PC038-APP-PO-LNE-NBR-X NUMERIC                                    
059000          MOVE PC038-APP-PO-LNE-NBR   TO DL-APP-PO-LNE-NBR                
059100     ELSE                                                                 
059200          MOVE PC038-APP-PO-LNE-NBR-X TO DL-APP-PO-LNE-NBR-X              
059300     END-IF.                                                              
059400                                                                          
059500     INITIALIZE PC046-COMMAREA-REC.                                       
059600     PERFORM 5000-RETRIEVE-CARTONS                                        
059700                                                                          
059800     MOVE PC038-MULTIPLE-TRIP-IND     TO DL-MULT-TRIP-IND.                
059900                                                                          
060000     INITIALIZE DL-MULT-TRIP-IND.                                         
060100                                                                          
060200     PERFORM 8000-READ-EXTRACT.                                           
060300                                                                          
060400*-----------------------------------------------------------------        
060500 2400-GET-TRECEIV-VFYD-DATE.                                              
060600                                                                          
060700     MOVE '2400-GET-TRECEIV-VFYD-DATE'    TO PV-PARAGRAPH.                
060800                                                                          
060900     INITIALIZE RECEIV-VERFYD-TMST.                                       
061000                                                                          
061100     PERFORM                                                              
061200         WITH TEST AFTER                                                  
061300         VARYING PV-RETRY-COUNTER                                         
061400         FROM 1 BY 1                                                      
061500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
061600            OR  (SQLCODE = +100)                                          
061700            OR  (SQLCODE = +0))                                           
061800                                                                          
061900         EXEC SQL                                                         
062000             SELECT VERFYD_TMST                                           
062100              INTO :RECEIV-VERFYD-TMST                                    
062200              FROM  TRECEIV                                               
062300             WHERE  ORD_NBR     = :PC038-PO-NBR                           
062400               AND  REC_SEQ_NBR = :PC038-RCVR-SEQ-NBR                     
062500         WITH UR                                                          
062600         END-EXEC                                                         
062700                                                                          
062800         EVALUATE TRUE                                                    
062900             WHEN SQLCODE = ZERO                                          
063000                 IF RECEIV-VERFYD-TMST NOT =                              
063100                                     '9999-09-09-09.09.09.999999'         
063200                     MOVE RECEIV-VERFYD-TMST TO PV-DB2-DATE               
063300                     MOVE PV-DB2-YY   TO PV-KEY-YY                        
063400                     MOVE PV-DB2-MM   TO PV-KEY-MM                        
063500                     MOVE PV-DB2-DD   TO PV-KEY-DD                        
063600                     MOVE PV-KEY-DATE TO DL-VRFD-DATE                     
063700                 ELSE                                                     
063800                     MOVE SPACES TO   DL-VRFD-DATE                        
063900                 END-IF                                                   
064000             WHEN SQLCODE = +100                                          
064100                 MOVE SPACES TO   DL-VRFD-DATE                            
064200             WHEN SQLCODE = -904                                          
064300             WHEN SQLCODE = -911                                          
064400             WHEN SQLCODE = -913                                          
064500                 CONTINUE                                                 
064600                                                                          
064700             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                      
064800                 DISPLAY '**************************************'         
064900                 DISPLAY 'WARNING ISSUED '                                
065000                 DISPLAY 'SELECT TRECEIV                        '         
065100                 DISPLAY '**************************************'         
065200                 PERFORM 9300-SQL-WARNING                                 
065300                                                                          
065400             WHEN SQLCODE < ZERO                                          
065500                 DISPLAY '**************************************'         
065600                 DISPLAY 'ERROR ISSUED ON                       '         
065700                 DISPLAY 'SELECT TRECEIV                        '         
065800                 DISPLAY '**************************************'         
065900                 PERFORM 9200-SQL-ERROR                                   
066000                                                                          
066100         END-EVALUATE                                                     
066200     END-PERFORM.                                                         
066300                                                                          
066400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
066500         SQLCODE NOT = ZERO                                               
066600         DISPLAY '**************************************'                 
066700         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '                 
066800         DISPLAY 'SELECT TRECEIV         '                                
066900         DISPLAY '**************************************'                 
067000         PERFORM 9200-SQL-ERROR                                           
067100     END-IF.                                                              
067200                                                                          
067300*----------------------------------------------------------------*        
067400 5000-RETRIEVE-CARTONS.                                                   
067500     MOVE '5000-RETRIEVE-CARTONS '    TO PV-PARAGRAPH.                    
067600                                                                          
067700                                                                          
068500     PERFORM 5001-CURSORS-AND-SUCH                                        
068000     IF PC038-APP-PO-LNE-NBR-X = 'MULT' OR SPACES                         
068100        PERFORM 6001-CHECK-FOR-BREAKS                                     
068200*        MOVE PC038-STR-EXPECTED-UNITS TO DL-STORE-EXP-UNITS              
              IF  SUT00028-SHPD-UNT-QTY > 0                                     
068300           MOVE SUT00028-SHPD-UNT-QTY      TO DL-STORE-EXP-UNITS          
              ELSE                                                              
                IF PC038-STR-EXPECTED-UNITS > 0                                 
                   MOVE PC038-STR-EXPECTED-UNITS TO DL-STORE-EXP-UNITS          
                ELSE                                                            
                   MOVE ZEROES                   TO DL-STORE-EXP-UNITS          
                END-IF                                                          
              END-IF                                                            
068400/    ELSE                                                                 
068500/        PERFORM 5001-CURSORS-AND-SUCH                                    
068610     END-IF.                                                              
068700                                                                          
068800 5001-CURSORS-AND-SUCH.                                                   
068900     MOVE PC038-APP-PO-LNE-NBR  TO DK-LINE-NBR.                           
069000     MOVE PC038-LOC-NBR         TO DK-STORE-NBR.                          
069100                                                                          
069200     SET PS-ERROR-NO                  TO TRUE                             
069300     PERFORM 5100-OPEN-CURSOR                                             
069400     PERFORM 5200-FETCH                                                   
069500                                                                          
069600     IF PS-END-CSR-NO                                                     
069700                                                                          
069800         PERFORM UNTIL PS-END-CSR-YES                                     
069900                      OR PS-ERROR-YES                                     
070000             PERFORM 5200-FETCH                                           
070100         END-PERFORM                                                      
070200         PERFORM 5300-CLOSE-CURSOR                                        
070300                                                                          
070400     ELSE                                                                 
070500                                                                          
070600         PERFORM 5300-CLOSE-CURSOR                                        
070700         PERFORM 5100A-OPEN-CURSOR                                        
070800         PERFORM 5200A-FETCH                                              
070801                                                                          
070811         IF  PS-END-CSR2-NO                                               
070900             PERFORM UNTIL PS-END-CSR2-YES                                
071000                     PERFORM 5200A-FETCH                                  
071100             END-PERFORM                                                  
071200             PERFORM 5300A-CLOSE-CURSOR                                   
071201                                                                          
071202*** DMH ADDED - 1/24/08 BEGIN                                             
071203         ELSE                                                             
071210             IF  PC038-REC-TYP-CDE  =  'CR'                               
071220                 PERFORM 5500-PROCESS-CR-RECEIVER                         
071230             END-IF                                                       
071231             PERFORM 5300A-CLOSE-CURSOR                                   
071232         END-IF                                                           
071240*** DMH ADDED - 1/24/08 END                                               
071300                                                                          
071400     END-IF.                                                              
071500                                                                          
071600*----------------------------------------------------------------*        
071700* OPEN THE CURSOR                                                         
071800*----------------------------------------------------------------*        
071900 5100-OPEN-CURSOR.                                                        
072000     MOVE '5100-OPEN-CURSOR'          TO PV-PARAGRAPH.                    
072100                                                                          
072200         SET PS-END-CSR-NO            TO TRUE                             
072300     MOVE ZERO                        TO PV-CTNS-IN-CSR-COUNT             
072400                                                                          
072500         EXEC SQL                                                         
072600              OPEN CARTON-CSR                                             
072700         END-EXEC                                                         
072800                                                                          
072900         EVALUATE TRUE                                                    
073000             WHEN SQLCODE = ZERO                                          
073100                 CONTINUE                                                 
073200             WHEN SQLCODE = -904                                          
073300             WHEN SQLCODE = -911                                          
073400             WHEN SQLCODE = -913                                          
073500                  PERFORM 9200-SQL-ERROR                                  
073600             WHEN SQLWARN0 NOT = SPACES                                   
073700             WHEN SQLCODE < ZERO                                          
073800             WHEN SQLCODE > ZERO                                          
073900                 PERFORM 9300-SQL-WARNING                                 
074000         END-EVALUATE.                                                    
074100*                                                                         
074200 5100A-OPEN-CURSOR.                                                       
074300     MOVE '5100A-OPEN-CURSOR'         TO PV-PARAGRAPH.                    
074400                                                                          
074500     MOVE ZERO                        TO PV-CTNS-IN-CSR-COUNT             
074600         SET PS-END-CSR2-NO           TO TRUE                             
074700         EXEC SQL                                                         
074800              OPEN CARTON-CSR-2                                           
074900         END-EXEC                                                         
075000                                                                          
075100         EVALUATE TRUE                                                    
075200             WHEN SQLCODE = ZERO                                          
075300                 CONTINUE                                                 
075400             WHEN SQLCODE = -904                                          
075500             WHEN SQLCODE = -911                                          
075600             WHEN SQLCODE = -913                                          
075700                 PERFORM 9200-SQL-ERROR                                   
075800             WHEN SQLWARN0 NOT = SPACES                                   
075900             WHEN SQLCODE < ZERO                                          
076000             WHEN SQLCODE > ZERO                                          
076100                 PERFORM 9300-SQL-WARNING                                 
076200         END-EVALUATE.                                                    
076300*                                                                         
076400*----------------------------------------------------------------*        
076500*    FETCH THE CURSOR                                                     
076600*----------------------------------------------------------------*        
076700 5200-FETCH.                                                              
076800                                                                          
076900     MOVE '5200-FETCH'                TO PV-PARAGRAPH.                    
077000                                                                          
077100     EXEC SQL                                                             
077200         FETCH CARTON-CSR                                                 
077300         INTO  :SUT00028-SHIPT-UNT-ID                                     
077400         ,     :SUT00028-SHPD-UNT-QTY                                     
077500     END-EXEC.                                                            
077600                                                                          
077700     EVALUATE TRUE                                                        
077800         WHEN SQLCODE = ZEROS                                             
077900*            IF PC038-STR-EXPECTED-UNITS < ZERO                           
078000*                MULTIPLY SUT00028-SHPD-UNT-QTY BY -1                     
078100*                   GIVING SUT00028-SHPD-UNT-QTY                          
078200*                END-MULTIPLY                                             
078300*            END-IF                                                       
078400             INITIALIZE PC046-COMMAREA-REC                                
078500             ADD 1                    TO PV-CTNS-IN-CSR-COUNT             
078600              MOVE SUT00028-SHIPT-UNT-ID TO  PC046-CARTON-ID              
078700              PERFORM 6000-CALL-CRTN-STATUS-PGM                           
078800         WHEN SQLCODE = +100                                              
045979              MOVE +0           TO SUT00028-SHIPT-UNT-ID                  
045980              MOVE +0           TO SUT00028-SHPD-UNT-QTY                  
078900             SET PS-END-CSR-YES       TO TRUE                             
079000         WHEN OTHER                                                       
079100             PERFORM 9200-SQL-ERROR                                       
079200     END-EVALUATE.                                                        
079300                                                                          
079400 5200A-FETCH.                                                             
079500                                                                          
079600     MOVE '5200A-FETCH'               TO PV-PARAGRAPH.                    
079700                                                                          
079800     EXEC SQL                                                             
079900         FETCH CARTON-CSR-2                                               
080000         INTO  :SUT00028-SHIPT-UNT-ID                                     
080100         ,     :SUT00028-SHPD-UNT-QTY                                     
080200     END-EXEC.                                                            
080300                                                                          
080400     EVALUATE TRUE                                                        
080500         WHEN SQLCODE = ZEROS                                             
080600             INITIALIZE PC046-COMMAREA-REC                                
080700              MOVE SUT00028-SHIPT-UNT-ID TO  PC046-CARTON-ID              
080800             ADD 1                    TO PV-CTNS-IN-CSR-COUNT             
080900              PERFORM 6000-CALL-CRTN-STATUS-PGM                           
081000         WHEN SQLCODE = +100                                              
045979              MOVE +0           TO SUT00028-SHIPT-UNT-ID                  
045980              MOVE +0           TO SUT00028-SHPD-UNT-QTY                  
081100             SET PS-END-CSR2-YES      TO TRUE                             
081200         WHEN OTHER                                                       
081300             PERFORM 9200-SQL-ERROR                                       
081400     END-EVALUATE.                                                        
081500                                                                          
081600*----------------------------------------------------------------*        
081700* CLOSE THE CURSOR.                                                       
081800*----------------------------------------------------------------*        
081900 5300-CLOSE-CURSOR.                                                       
082000                                                                          
082100     MOVE '5300-CLOSE-CURSOR'         TO PV-PARAGRAPH.                    
082200                                                                          
082300     EXEC SQL                                                             
082400          CLOSE CARTON-CSR                                                
082500     END-EXEC.                                                            
082600                                                                          
082700     EVALUATE TRUE                                                        
082800         WHEN SQLCODE = ZERO                                              
082900         WHEN SQLCODE = +100                                              
083000             CONTINUE                                                     
083100         WHEN SQLWARN0 NOT = SPACES                                       
083200         WHEN SQLCODE < ZERO                                              
083300         WHEN SQLCODE > ZERO                                              
083400             PERFORM 9200-SQL-ERROR                                       
083500     END-EVALUATE.                                                        
083600                                                                          
083700 5300A-CLOSE-CURSOR.                                                      
083800                                                                          
083900     MOVE '5300A-CLOSE-CURSOR'        TO PV-PARAGRAPH.                    
084000                                                                          
084100     EXEC SQL                                                             
084200          CLOSE CARTON-CSR-2                                              
084300     END-EXEC.                                                            
084400                                                                          
084500     EVALUATE TRUE                                                        
084600         WHEN SQLCODE = ZERO                                              
084700         WHEN SQLCODE = +100                                              
084800             CONTINUE                                                     
084900         WHEN SQLWARN0 NOT = SPACES                                       
085000         WHEN SQLCODE < ZERO                                              
085100         WHEN SQLCODE > ZERO                                              
085200             PERFORM 9200-SQL-ERROR                                       
085300     END-EVALUATE.                                                        
085400                                                                          
085410*** DMH ADDED - 1/24/08 BEGIN                                             
085430 5500-PROCESS-CR-RECEIVER.                                                
085431                                                                          
085432     IF PS-BLANK-LINE                                                     
085433        WRITE REPORT-RECORD FROM DL-BLANK-LINE                            
085434           AFTER ADVANCING 1 LINES                                        
085435        ADD 1                   TO PV-LINES-USED                          
085436        SET PS-BLANK-LINE-NO    TO TRUE                                   
085437     END-IF                                                               
085438                                                                          
085439     PERFORM 6001-CHECK-FOR-BREAKS                                        
085445                                                                          
085446     MOVE PC038-OPER-UNT-ID    TO PV-PREV-DC                              
085447     MOVE PC038-PO-NBR         TO PV-PREV-PO                              
085448     MOVE PC038-RCVR-SEQ-NBR   TO PV-PREV-RCVR                            
085449     MOVE PC038-APP-PO-LNE-NBR TO PV-PREV-LINE                            
085450                                                                          
085451     ADD PC038-UNITS-VARIANCE  TO PV-DEPT-EXP-TOTAL                       
085452                                  PV-STORE-EXP-TOTAL                      
085453                                  PV-GRAND-EXP-TOTAL.                     
085454                                                                          
085455     MOVE PC038-UNITS-VARIANCE TO DL-STORE-EXP-UNITS                      
085456     MOVE  SPACES  TO  DL-STATUS                                          
085457     MOVE  SPACES  TO  DL-MULT-TRIP-IND                                   
085458     PERFORM 8010-WRITE-DETAIL-LINE.                                      
085459     IF  PV-LINES-USED > PC-END-OF-PAGE                                   
085460         PERFORM 8100-WRITE-MAIN-HEADINGS                                 
085461     END-IF.                                                              
085470                                                                          
085488                                                                          
085489*** DMH ADDED - 1/24/08 END                                               
085490                                                                          
085500**************************************************************            
085600* DETERMINE LAST ACTIVITY FOR CARTON (CHECK IN REVERSE ORDER)             
085700* THIS WILL CALL PCKUT713 WHICH BRINGS BACK ALL INFORMATION ON            
085800* THE CARTON ENTERED.                                                     
085900**************************************************************            
086000 6000-CALL-CRTN-STATUS-PGM.                                               
086100                                                                          
086200     MOVE '6000-CALL-CRTN-STATUS-PGM '    TO PV-PARAGRAPH.                
086300                                                                          
086400     IF  PC046-CARTON-ID = PV-PREV-CARTON-ID                              
086500         MOVE PV-PREV-STATUS TO DL-STATUS                                 
086510         ADD +1  TO  PV-NOCALL-CNT                                        
086600     ELSE                                                                 
086700         MOVE SPACES TO PV-PREV-STATUS                                    
086710         MOVE PC046-CARTON-ID TO PV-PREV-CARTON-ID                        
086711         ADD +1  TO  PV-CALL-CNT                                          
086720         CALL PC046-CARTON-STATUS-MODULE                                  
086730                   USING PC046-COMMAREA-REC                               
086750         PERFORM 6005-VALIDATE-STATUS-CALL                                
086760     END-IF.                                                              
086800                                                                          
086900     IF PS-BLANK-LINE                                                     
087000        WRITE REPORT-RECORD FROM DL-BLANK-LINE                            
087100           AFTER ADVANCING 1 LINES                                        
087200        ADD 1                   TO PV-LINES-USED                          
087300        SET PS-BLANK-LINE-NO    TO TRUE                                   
087400     END-IF                                                               
087500                                                                          
087600     PERFORM 6001-CHECK-FOR-BREAKS                                        
087700                                                                          
087800                                                                          
087900*    MOVE PC038-STR-EXPECTED-UNITS TO DL-STORE-EXP-UNITS                  
088000*    MOVE SUT00028-SHPD-UNT-QTY    TO DL-STORE-EXP-UNITS                  
088100                                                                          
088200                                                                          
088300     MOVE PC038-OPER-UNT-ID    TO PV-PREV-DC                              
088400     MOVE PC038-PO-NBR         TO PV-PREV-PO                              
088500     MOVE PC038-RCVR-SEQ-NBR   TO PV-PREV-RCVR                            
088600     MOVE PC038-APP-PO-LNE-NBR TO PV-PREV-LINE                            
088700                                                                          
088800     MOVE ZERO               TO PV-TALLY                                  
088900     INSPECT DL-STATUS TALLYING PV-TALLY FOR ALL 'SU '                    
089000                                                                          
089100     EVALUATE TRUE                                                        
089200         WHEN PV-TALLY > ZERO                                             
089300             IF PC038-STR-EXPECTED-UNITS             < ZERO               
089400                 MULTIPLY SUT00028-SHPD-UNT-QTY BY -1                     
089500                     GIVING SUT00028-SHPD-UNT-QTY                         
089600                 END-MULTIPLY                                             
089700                 MOVE SUT00028-SHPD-UNT-QTY TO DL-STORE-EXP-UNITS         
089800                 PERFORM 8010-WRITE-DETAIL-LINE                           
089900                 IF PV-LINES-USED > PC-END-OF-PAGE                        
090000                     PERFORM 8100-WRITE-MAIN-HEADINGS                     
090100                 END-IF                                                   
090200                 ADD SUT00028-SHPD-UNT-QTY TO PV-DEPT-EXP-TOTAL           
090300                                              PV-STORE-EXP-TOTAL          
090400                                              PV-GRAND-EXP-TOTAL          
090500             END-IF                                                       
090600                                                                          
090700         WHEN PV-TALLY = ZERO                                             
090800             MOVE SUT00028-SHPD-UNT-QTY TO DL-STORE-EXP-UNITS             
090900             PERFORM 8010-WRITE-DETAIL-LINE                               
091000             IF PV-LINES-USED > PC-END-OF-PAGE                            
091100                 PERFORM 8100-WRITE-MAIN-HEADINGS                         
091200             END-IF                                                       
091300             ADD SUT00028-SHPD-UNT-QTY TO PV-DEPT-EXP-TOTAL               
091400                                          PV-STORE-EXP-TOTAL              
091500                                          PV-GRAND-EXP-TOTAL              
091600                                                                          
091700     END-EVALUATE.                                                        
091800*                                                                         
091900                                                                          
092000 6001-CHECK-FOR-BREAKS.                                                   
092100     IF PS-DEPT-LINE AND PV-DETLINE-PRT-COUNT > ZERO                      
092200        PERFORM 8500-DEPT-TOTAL                                           
092300        SET PS-DEPT-LINE-NO    TO TRUE                                    
092400     END-IF.                                                              
092500                                                                          
092600     IF PS-STORE-LINE                                                     
092700        PERFORM 8600-STORE-TOTAL                                          
092800        SET PS-STORE-LINE-NO    TO TRUE                                   
092900     END-IF.                                                              
093000                                                                          
093100**************************************************************            
093200* CHECK RETURN CODE FROM CRTN STATUS PROGRAM TO SEE IF SUCCESSFUL         
093300**************************************************************            
093400 6005-VALIDATE-STATUS-CALL.                                               
093500                                                                          
093600     IF PC046-SUCCESSFUL                                                  
093700             PERFORM 6006-LOAD-CARTON-STATUS                              
093800                                                                          
093900             MOVE SPACES TO DL-STATUS                                     
094000             IF PC046-OTBD-TRIP-ID > 0                                    
094100                 MOVE PC046-OTBD-TRIP-ID TO PV-TRIP                       
094110                 MOVE PC046-CARTON-ID    TO PV-CARTON                     
094200                 STRING PV-CARTON           DELIMITED BY SIZE             
094300                    ' '                     DELIMITED BY SIZE             
094310                    PV-TRIP                 DELIMITED BY SIZE             
094320                    ' '                     DELIMITED BY SIZE             
094400                    PC046-TRIP-STATUS       DELIMITED BY SIZE             
094500                    ' '                     DELIMITED BY SIZE             
094600                    PV-CRTN-STAT-DESC       DELIMITED BY SIZE             
094700                                               INTO DL-STATUS             
094710                 MOVE DL-STATUS TO PV-PREV-STATUS                         
094800             ELSE                                                         
094900                 MOVE PC046-CARTON-ID TO PV-CARTON                        
095000                 STRING PV-CARTON         DELIMITED BY SIZE               
095100                   ' '                    DELIMITED BY SIZE               
095200                  PV-CRTN-STAT-DESC       DELIMITED BY SIZE               
095300                                           INTO DL-STATUS                 
095310                 MOVE DL-STATUS TO PV-PREV-STATUS                         
095400             END-IF                                                       
095500     ELSE                                                                 
095600         IF PC046-ERROR                                                   
095700             DISPLAY '** ABEND - PROGRAM '                                
095800                     PC-CURRENT-PROGRAM-NAME ' **'                        
095900             DISPLAY '** BAD CALL TO CRTN STATUS PGM PCKUT713'            
096000             DISPLAY PC046-CRA-RET-MSG                                    
096100             MOVE +4019 TO ABEND-CODE                                     
096200             CALL 'ILBOABN0' USING ABEND-CODE                             
096300             MOVE '6005-'                TO PC046-CRA-REQ-ID              
096400         ELSE                                                             
096500             MOVE SPACES TO DL-STATUS                                     
096510                            PV-PREV-STATUS                                
096600         END-IF                                                           
096700     END-IF.                                                              
096800                                                                          
096900 6006-LOAD-CARTON-STATUS.                                                 
097000     EVALUATE PC046-CRTN-STATUS                                   26580000
097100         WHEN '01'                                                26590000
097200             MOVE PC-INVALID-DESC TO PV-CRTN-STAT-DESC            26600000
097300         WHEN '02'                                                26620000
097400             MOVE PC-INACT-DESC  TO PV-CRTN-STAT-DESC             26630000
097500         WHEN '03'                                                26650000
097600             MOVE PC-SC-OF-DESC  TO PV-CRTN-STAT-DESC             26660000
097700         WHEN '04'                                                26680000
097800             MOVE PC-SC-ON-DESC  TO PV-CRTN-STAT-DESC             26690000
097900         WHEN '05'                                                26710000
098000             PERFORM 6010-CHECK-ASSUMED                           26720000
098100                 IF PS-DIVERTED                                   26730000
098200                     MOVE PC-DVRT-DESC TO PV-CRTN-STAT-DESC       26740000
098300                 ELSE                                             26760000
098400                     MOVE PC-ASSUM-DESC TO PV-CRTN-STAT-DESC      26770000
098500                 END-IF                                           26790000
098600         WHEN '06'                                                26800000
098700             MOVE PC-LOADED-DESC TO PV-CRTN-STAT-DESC             26810000
098800         WHEN '07'                                                26830000
098900             MOVE PC-CSEPK-DESC  TO PV-CRTN-STAT-DESC             26840000
099000         WHEN '08'                                                26860000
099100             MOVE PC-CK-IN-DESC  TO PV-CRTN-STAT-DESC             26870000
099200         WHEN '09'                                                26890000
099300             MOVE PC-P2L-DESC    TO PV-CRTN-STAT-DESC             26900000
099400         WHEN '10'                                                26920000
099500             MOVE PC-RDM-DESC    TO PV-CRTN-STAT-DESC             26930000
099600         WHEN '11'                                                26950000
099700             MOVE PC-RECV-DESC   TO PV-CRTN-STAT-DESC             26960000
099800         WHEN '12'                                                26980000
099900             MOVE PC-ASN-DESC    TO PV-CRTN-STAT-DESC             26990000
100000         WHEN '13'                                                27010000
100100             MOVE PC-SMTH-DESC   TO PV-CRTN-STAT-DESC             27020000
100200         WHEN '14'                                                27040000
100300             MOVE PC-XFER-DESC   TO PV-CRTN-STAT-DESC             27050000
100400         WHEN '15'                                                27070000
100500             MOVE PC-MSTR-DESC   TO PV-CRTN-STAT-DESC             27080000
100600         WHEN '16'                                                27100000
100700             MOVE PC-BLD-DESC    TO PV-CRTN-STAT-DESC             27110000
100800         WHEN '17'                                                        
100900             MOVE PC-ROUTE-JWL        TO PV-CRTN-STAT-DESC                
101000         WHEN '18'                                                        
101100             MOVE PC-ROUTE-DMG        TO PV-CRTN-STAT-DESC                
101200     END-EVALUATE                                                 27130000
101300                                                                          
101400     IF PC046-BEGIN-DIVERT                                        27140000
101500         MOVE 'DVT BEG' TO PV-CRTN-STAT-DESC                      27150000
101600     ELSE                                                         27170000
101700         IF PC046-END-DIVERT                                      27180000
101800             MOVE 'DVT END' TO PV-CRTN-STAT-DESC                  27190000
101900         END-IF                                                   27210000
102000     END-IF.                                                      27220000
102100                                                                          
102200 6010-CHECK-ASSUMED.                                              26720000
102300                                                                  27810000
102400      PERFORM 7000-GET-DVRT-OPER-DOOR.                            27820000
102500                                                                  27830000
102600      MOVE CNDCDR-DOOR-TYP-CDE  TO  PC046-DOOR-TYP-CDE.           27840006
102700                                                                  27850006
102800      IF  CNDCDR-DOOR-TYP-CDE  =  'SH'                            27860006
102900          PERFORM 7005-GET-SHIP-TRIP                              27870000
103000      ELSE                                                        27880000
103100          IF  CNDCDR-DOOR-TYP-CDE  =  ('ST' OR 'DS')              27890000
103200              PERFORM 7010-GET-SHUT-STOR-TRIP                     27900000
103300          ELSE                                                    27910000
103400              SET PS-DIVERTED TO TRUE                             27920000
103500          END-IF                                                  27930000
103600      END-IF.                                                     27940000
103700                                                                  27950000
103800      IF  SUOBTR-OTBND-TRIP-ID  >  ZERO                           27960000
103900          PERFORM 7015-GET-BEG-DIVERT                             27970000
104000      ELSE                                                        27980000
104100          SET PS-DIVERTED TO TRUE                                 27990000
104200      END-IF.                                                     28000000
104300                                                                  28010000
104400*---------------------------------------------------------------* 28020000
104500*  GET THE OPER UNIT AND DIVERTED DOOR INFORMATION              * 28030000
104600*---------------------------------------------------------------* 28040000
104700 7000-GET-DVRT-OPER-DOOR.                                         28050000
104800                                                                  28060000
104900     MOVE '7000-GET-DVRT-OPER-DOOR'   TO PV-PARAGRAPH.                    
105000                                                                          
105100     PERFORM                                                              
105200         WITH TEST AFTER                                                  
105300         VARYING PV-RETRY-COUNTER                                         
105400         FROM 1 BY 1                                                      
105500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
105600            OR  (SQLCODE = +100)                                          
105700            OR  (SQLCODE = +0))                                           
105800                                                                          
105900     EXEC SQL                                                     28070000
106000          SELECT A.OPER_UNT_ID                                    28080000
106100               , A.DOOR_ID                                        28090000
106200               , A.DEST_OPER_UNT_ID                               28100000
106300               , C.DOOR_TYP_CDE                                   28110000
106400            INTO :SUCRDV-OPER-UNT-ID                              28120000
106500               , :SUCRDV-DOOR-ID                                  28130000
106600               , :SUCRDV-DEST-OPER-UNT-ID                         28140000
106700               , :CNDCDR-DOOR-TYP-CDE                             28150000
106800            FROM TSUCRDV A                                        28160000
106900               , TCNDCDR C                                        28170000
107000           WHERE A.SHIPT_UNT_ID  = :SUT00028-SHIPT-UNT-ID         28180000
107100             AND A.ACTV_CDE      =  'A'                           28190000
107200             AND A.OPER_UNT_ID   =  C.OPER_UNT_ID                 28200000
107300             AND A.DIVERT_NBR    =  C.DIVERT_NBR                  28210000
107400             AND A.DIVERT_LOC_ID =  C.DIVERT_LOC_ID               28220000
107500             AND A.DOOR_ID       =  C.DOOR_ID                     28230000
107600             AND A.DIVERT_TMST  IN                                28240000
107700                 (SELECT MAX(B.DIVERT_TMST)                       28250000
107800                    FROM TSUCRDV B                                28260000
107900                   WHERE B.SHIPT_UNT_ID  = :SUT00028-SHIPT-UNT-ID 28270000
108000                     AND B.ACTV_CDE      = 'A')                   28280000
108100         WITH UR                                                          
108200     END-EXEC                                                     28290000
108300                                                                  28300000
108400         EVALUATE TRUE                                                    
108500             WHEN SQLCODE = ZERO                                          
108600                 CONTINUE                                                 
108700             WHEN SQLCODE = +100                                          
108800                 SET PS-DIVERTED          TO TRUE                         
108900             WHEN SQLCODE = -904                                          
109000             WHEN SQLCODE = -911                                          
109100             WHEN SQLCODE = -913                                          
109200                 CONTINUE                                                 
109300                                                                          
109400             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                      
109410                  MOVE  SUT00028-SHIPT-UNT-ID                             
109420                    TO  PV-DISP-SML                                       
109500                 DISPLAY '**************************************'         
109600                 DISPLAY 'WARNING ISSUED '                                
109700                 DISPLAY 'SELECT TSUCRDV TCNDCDR                '         
109800                 DISPLAY '**************************************'         
109810                 DISPLAY '*  PV-DISP-SML                       *'         
109820                 DISPLAY '**************************************'         
109900                 PERFORM 9300-SQL-WARNING                                 
110000                                                                          
110100             WHEN SQLCODE < ZERO                                          
110110                  MOVE  SUT00028-SHIPT-UNT-ID                             
110120                    TO  PV-DISP-SML                                       
110200                 DISPLAY '**************************************'         
110300                 DISPLAY 'ERROR ISSUED ON                       '         
110400                 DISPLAY 'SELECT TSUCRDV TCNDCDR                '         
110500                 DISPLAY '**************************************'         
110510                 DISPLAY '*  PV-DISP-SML                       *'         
110520                 DISPLAY '**************************************'         
110600                 PERFORM 9200-SQL-ERROR                                   
110700                                                                          
110800         END-EVALUATE                                                     
110900     END-PERFORM.                                                         
111000                                                                          
111100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
111200         SQLCODE NOT = ZERO                                               
111210                  MOVE  SUT00028-SHIPT-UNT-ID                             
111220                    TO  PV-DISP-SML                                       
111300         DISPLAY '**************************************'                 
111400         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '                 
111500         DISPLAY 'SELECT TSUCRDV TCNDCDR '                                
111600         DISPLAY '**************************************'                 
111610                 DISPLAY '*  PV-DISP-SML                       *'         
111620                 DISPLAY '**************************************'         
111700         PERFORM 9200-SQL-ERROR                                           
111800     END-IF.                                                              
111900                                                                          
112000 7005-GET-SHIP-TRIP.                                              27870000
112100                                                                          
112200     INITIALIZE DCLTSUOBTR.                                       28770000
112300                                                                          
112400     PERFORM                                                              
112500         WITH TEST AFTER                                                  
112600         VARYING PV-RETRY-COUNTER                                         
112700         FROM 1 BY 1                                                      
112800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
112900            OR  (SQLCODE = +100)                                          
113000            OR  (SQLCODE = +0))                                           
113100                                                                          
113200                                                                          
113300     EXEC SQL                                                     28790000
113400          SELECT A.OTBND_TRIP_ID                                  28800000
113500            INTO :SUOBTR-OTBND-TRIP-ID                            28810000
113600            FROM TSUOBTR A                                        28820000
113700               , TSUOBTS B                                        28830000
113800           WHERE A.DEST_OPER_UNT_ID  = :SUCRDV-DEST-OPER-UNT-ID   28840000
113900             AND A.ORGN_OPER_UNT_ID  = :SUCRDV-OPER-UNT-ID        28850000
114000             AND A.DOOR_TYP_CDE      = 'SH'                       28860000
114100             AND A.OTBND_TRIP_ID     =  B.OTBND_TRIP_ID           28870000
114200             AND B.TRIP_STAT_CDE     = 'DO'                       28880000
114300             AND B.DOOR_ID           = :SUCRDV-DOOR-ID            28890000
114400             AND B.OTBND_STAT_TMST   IN                           28900000
114500                   (SELECT MAX(C.OTBND_STAT_TMST)                 28910000
114600                      FROM TSUOBTS C                              28920000
114700                     WHERE B.OTBND_TRIP_ID = C.OTBND_TRIP_ID)     28930000
114800         WITH UR                                                          
114900     END-EXEC                                                     28940000
115000                                                                  28300000
115100         EVALUATE TRUE                                                    
115200             WHEN SQLCODE = ZERO                                          
115300                 CONTINUE                                                 
115400             WHEN SQLCODE = +100                                          
115500                 SET PS-DIVERTED          TO TRUE                         
115600             WHEN SQLCODE = -904                                          
115700             WHEN SQLCODE = -911                                          
115800             WHEN SQLCODE = -913                                          
115900                 CONTINUE                                                 
116000                                                                          
116100             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                      
116200                 DISPLAY '**************************************'         
116300                 DISPLAY 'WARNING ISSUED '                                
116400                 DISPLAY 'SELECT TSUOBTR TSUOBTS                '         
116500                 DISPLAY '**************************************'         
116600                 PERFORM 9300-SQL-WARNING                                 
116700                                                                          
116800             WHEN SQLCODE < ZERO                                          
116900                 DISPLAY '**************************************'         
117000                 DISPLAY 'ERROR ISSUED ON                       '         
117100                 DISPLAY 'SELECT TSUOBTR TSUOBTS                '         
117200                 DISPLAY '**************************************'         
117300                 PERFORM 9200-SQL-ERROR                                   
117400                                                                          
117500         END-EVALUATE                                                     
117600     END-PERFORM.                                                         
117700                                                                          
117800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
117900         SQLCODE NOT = ZERO                                               
118000         DISPLAY '**************************************'                 
118100         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '                 
118200         DISPLAY 'SELECT TSUOBTR TSUOBTS '                                
118300         DISPLAY '**************************************'                 
118400         PERFORM 9200-SQL-ERROR                                           
118500     END-IF.                                                              
118600                                                                          
118700 7010-GET-SHUT-STOR-TRIP.                                         27900000
118800                                                                          
118900     INITIALIZE DCLTSUOBTR.                                       29430000
119000                                                                          
119100     PERFORM                                                              
119200         WITH TEST AFTER                                                  
119300         VARYING PV-RETRY-COUNTER                                         
119400         FROM 1 BY 1                                                      
119500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
119600            OR  (SQLCODE = +100)                                          
119700            OR  (SQLCODE = +0))                                           
119800                                                                          
119900     EXEC SQL                                                     29450000
120000          SELECT A.OTBND_TRIP_ID                                  29460000
120100            INTO :SUOBTR-OTBND-TRIP-ID                            29470000
120200            FROM TSUOBTR A                                        29480000
120300               , TSUOBTS B                                        29490000
120400           WHERE A.ORGN_OPER_UNT_ID  = :SUCRDV-OPER-UNT-ID        29500000
120500             AND A.DOOR_TYP_CDE     <> 'SH'                       29510000
120600             AND A.OTBND_TRIP_ID     =  B.OTBND_TRIP_ID           29520000
120700             AND A.ORGN_OPER_UNT_ID  =  B.STAT_OPER_UNT_ID        29530000
120800             AND B.TRIP_STAT_CDE     = 'DO'                       29540000
120900             AND B.DOOR_ID           = :SUCRDV-DOOR-ID            29550000
121000             AND B.OTBND_STAT_TMST   IN                           29560000
121100                   (SELECT MAX(C.OTBND_STAT_TMST)                 29570000
121200                      FROM TSUOBTS C                              29580000
121300                     WHERE B.OTBND_TRIP_ID = C.OTBND_TRIP_ID)     29590000
121400         WITH UR                                                          
121500     END-EXEC                                                     29600000
121600                                                                          
121700         EVALUATE TRUE                                                    
121800             WHEN SQLCODE = ZERO                                          
121900                 CONTINUE                                                 
122000             WHEN SQLCODE = +100                                          
122100                 SET PS-DIVERTED          TO TRUE                         
122200             WHEN SQLCODE = -904                                          
122300             WHEN SQLCODE = -911                                          
122400             WHEN SQLCODE = -913                                          
122500                 CONTINUE                                                 
122600                                                                          
122700             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                      
122800                 DISPLAY '**************************************'         
122900                 DISPLAY 'WARNING ISSUED '                                
123000                 DISPLAY 'SELECT TSUOBTR TSUOBTS                '         
123100                 DISPLAY '**************************************'         
123200                 PERFORM 9300-SQL-WARNING                                 
123300                                                                          
123400             WHEN SQLCODE < ZERO                                          
123500                 DISPLAY '**************************************'         
123600                 DISPLAY 'ERROR ISSUED ON                       '         
123700                 DISPLAY 'SELECT TSUOBTR TSUOBTS                '         
123800                 DISPLAY '**************************************'         
123900                 PERFORM 9200-SQL-ERROR                                   
124000                                                                          
124100         END-EVALUATE                                                     
124200     END-PERFORM.                                                         
124300                                                                          
124400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
124500         SQLCODE NOT = ZERO                                               
124600         DISPLAY '**************************************'                 
124700         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '                 
124800         DISPLAY 'SELECT TSUOBTR TSUOBTS '                                
124900         DISPLAY '**************************************'                 
125000         PERFORM 9200-SQL-ERROR                                           
125100     END-IF.                                                              
125200                                                                          
125300 7015-GET-BEG-DIVERT.                                             27970000
125400                                                                  30060000
125500                                                                  28060000
125600     MOVE '7015-GET-BEG-DIVERT'       TO PV-PARAGRAPH.                    
125700                                                                          
125800     PERFORM                                                              
125900         WITH TEST AFTER                                                  
126000         VARYING PV-RETRY-COUNTER                                         
126100         FROM 1 BY 1                                                      
126200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
126300            OR  (SQLCODE = +100)                                          
126400            OR  (SQLCODE = +0))                                           
126500                                                                          
126600     EXEC SQL                                                     30070000
126700          SELECT A.STRT_DIVERT_TMST                               30080000
126800            INTO :SUCDOT-STRT-DIVERT-TMST                         30090000
126900            FROM TSUCDOT A                                        30100000
127000           WHERE A.OTBND_TRIP_ID     = :SUOBTR-OTBND-TRIP-ID      30110000
127100             AND A.END_DIVERT_TMST   =                            30120000
127200                             '9999-09-09-09.09.09.999999'                 
127300     END-EXEC                                                     30130000
127400                                                                  30140000
127500         EVALUATE TRUE                                                    
127600             WHEN SQLCODE = ZERO                                          
127700              IF  SUCDOT-STRT-DIVERT-TMST  <  PC046-CRTN-STAT-TMST30170000
127800                  SET PS-ASSUMED  TO TRUE                         30180000
127900                  MOVE SUOBTR-OTBND-TRIP-ID  TO PC046-OTBD-TRIP-ID30190000
128000              ELSE                                                30200000
128100                  SET PS-DIVERTED TO TRUE                         30210000
128200              END-IF                                              30220000
128300                                                                          
128400             WHEN SQLCODE = +100                                          
128500                 SET PS-DIVERTED          TO TRUE                         
128600             WHEN SQLCODE = -904                                          
128700             WHEN SQLCODE = -911                                          
128800             WHEN SQLCODE = -913                                          
128900                 CONTINUE                                                 
129000                                                                          
129100             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                      
129200                 DISPLAY '**************************************'         
129300                 DISPLAY 'WARNING ISSUED '                                
129400                 DISPLAY 'SELECT TSUCDOT                        '         
129500                 DISPLAY '**************************************'         
129600                 PERFORM 9300-SQL-WARNING                                 
129700                                                                          
129800             WHEN SQLCODE < ZERO                                          
129900                 DISPLAY '**************************************'         
130000                 DISPLAY 'ERROR ISSUED ON                       '         
130100                 DISPLAY 'SELECT TSUCDOT                        '         
130200                 DISPLAY '**************************************'         
130300                 PERFORM 9200-SQL-ERROR                                   
130400                                                                          
130500         END-EVALUATE                                                     
130600     END-PERFORM.                                                         
130700                                                                          
130800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
130900         SQLCODE NOT = ZERO                                               
131000         DISPLAY '**************************************'                 
131100         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '                 
131200         DISPLAY 'SELECT TSUCDOT         '                                
131300         DISPLAY '**************************************'                 
131400         PERFORM 9200-SQL-ERROR                                           
131500     END-IF.                                                              
131600                                                                  29610000
131700*-----------------------------------------------------------------        
131800 8000-READ-EXTRACT.                                                       
131900                                                                          
132000*    DISPLAY PC038-LOC-NBR   ' / '                                        
132100*       PC038-DEPT-NBR       ' / '                                        
132200*       PC038-OPER-UNT-ID ' / '                                           
132300*       PC038-PO-NBR ' / '                                                
132400*       PC038-RCVR-SEQ-NBR ' / '                                          
132500*       PC038-APP-PO-LNE-NBR ' / '                                        
132600*       PC038-STR-EXPECTED-UNITS ' / '                                    
132700*       PV-DEPT-EXP-TOTAL ' / '                                           
132800*       PV-READ-COUNT                                                     
132900                                                                          
133000     READ EXTRACT-FILE                                                    
133100         INTO PC038-SE-UNBALANCED-RPT-REC                                 
133200     AT END                                                               
133300         SET PS-EOF-ERROR-FILE        TO TRUE                             
133400     NOT AT END                                                           
133500         ADD 1                        TO PV-READ-COUNT                    
133600                                                                          
133700*    IF PC038-DEPT-NBR = 015 AND PC038-SUB-CL-NBR = 81                    
133800*                                                                         
133900*        DISPLAY 'TRAP1'                                                  
134000*    END-IF                                                               
134100*                                                                         
134200*    IF PC038-DEPT-NBR = 453 AND PC038-PO-NBR = 4562481                   
134300*          AND  PC038-RCVR-SEQ-NBR = 4                                    
134400*                                                                         
134500*        DISPLAY 'TRAP2'                                                  
134600*    END-IF                                                               
134700                                                                          
134800     END-READ.                                                            
134900                                                                          
135000 8010-WRITE-DETAIL-LINE.                                                  
135100     WRITE                                                                
135200         REPORT-RECORD FROM DL-DETAIL-LINE-1                              
135300         AFTER ADVANCING 1 LINES                                          
135400     END-WRITE.                                                           
135500     ADD 1                        TO PV-LINES-USED                        
135600                                     PV-DETLINE-PRT-COUNT.                
135700                                                                          
135800*-----------------------------------------------------------------        
135900 8100-WRITE-MAIN-HEADINGS.                                                
136000                                                                          
136100     ADD 1                            TO PV-PAGE-COUNT.                   
136200     MOVE PV-PAGE-COUNT               TO DP132O-PAGE-NUMBER.              
136300     MOVE ZERO                        TO PV-LINES-USED                    
136400                                                                          
136500     WRITE REPORT-RECORD FROM DP132O-STANDRD-HEADER-132-COLS              
136600                 AFTER ADVANCING PAGE                                     
136700                                                                          
136800     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1                           
136900        AFTER ADVANCING 2 LINES.                                          
137000     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1A                          
137100        AFTER ADVANCING 1 LINES.                                          
137200     WRITE REPORT-RECORD FROM DL-BLANK-LINE                               
137300        AFTER ADVANCING 1 LINES.                                          
137400     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2A                          
137500        AFTER ADVANCING 1 LINES.                                          
137600     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2                           
137700        AFTER ADVANCING 1 LINES.                                          
137800                                                                          
137900     ADD 6                            TO PV-LINES-USED.                   
138000                                                                          
138100     WRITE REPORT-RECORD FROM HL-HEADING-LINE-3                           
138200        AFTER ADVANCING 1 LINES.                                          
138300                                                                          
138400                                                                          
138500     INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR.                           
138600     ADD  2                           TO PV-LINES-USED.                   
138700                                                                          
138800*-----------------------------------------------------------------        
138900*     WRITES THE DEPARTMENT TOTAL STORE EXPECTED UNIT LINE       *        
139000*-----------------------------------------------------------------        
139100 8500-DEPT-TOTAL.                                                         
139200                                                                          
139300     MOVE PV-DEPT-EXP-TOTAL     TO TL1-DEPT-EXP-TOTAL.                    
139400                                                                          
139500     WRITE REPORT-RECORD                                                  
139600       FROM TOTAL-LINE-1                                                  
139700         AFTER ADVANCING 1 LINES.                                         
139800                                                                          
139900     WRITE REPORT-RECORD FROM DL-BLANK-LINE                               
140000        AFTER ADVANCING 1 LINES.                                          
140100                                                                          
140200     ADD  2                      TO PV-LINES-USED.                        
140300     MOVE ZERO                   TO PV-DEPT-EXP-TOTAL                     
140400                                    PV-DETLINE-PRT-COUNT.                 
140500                                                                          
140600******************************************************************        
140700*     WRITES THE STORE TOTAL STORE EXPECTED UNIT LINE            *        
140800******************************************************************        
140900 8600-STORE-TOTAL.                                                        
141000                                                                          
141100     MOVE PV-STORE-EXP-TOTAL      TO TL2-STORE-EXP-TOTAL.                 
141200                                                                          
141300     WRITE REPORT-RECORD                                                  
141400       FROM TOTAL-LINE-2                                                  
141500         AFTER ADVANCING 1 LINES.                                         
141600                                                                          
141700     WRITE REPORT-RECORD FROM DL-BLANK-LINE                               
141800        AFTER ADVANCING 1 LINES.                                          
141900                                                                          
142000     ADD  2                      TO PV-LINES-USED.                        
142100     MOVE ZERO                   TO PV-STORE-EXP-TOTAL.                   
142200                                                                          
142300******************************************************************        
142400*     WRITES THE GRAND TOTAL STORE EXPECTED UNIT LINE            *        
142500******************************************************************        
142600 8700-GRAND-TOTAL.                                                        
142700                                                                          
142800     MOVE PV-GRAND-EXP-TOTAL      TO TL3-GRAND-EXP-TOTAL.                 
142900                                                                          
143000     WRITE REPORT-RECORD                                                  
143100       FROM TOTAL-LINE-3                                                  
143200         AFTER ADVANCING 1 LINES.                                         
143300                                                                          
143400     WRITE REPORT-RECORD FROM DL-BLANK-LINE                               
143500        AFTER ADVANCING 1 LINES.                                          
143600                                                                          
143700     ADD  2                      TO PV-LINES-USED.                        
143800     MOVE ZERO                   TO PV-GRAND-EXP-TOTAL.                   
143900                                                                          
144000******************************************************************        
144100 9000-EOJ.                                                                
144200                                                                          
144300     WRITE REPORT-RECORD FROM DL-BLANK-LINE                               
144400        AFTER ADVANCING 1 LINES.                                          
144500                                                                          
144600     IF PV-DETLINE-PRT-COUNT > ZERO                                       
144700         PERFORM 8500-DEPT-TOTAL                                          
144800     END-IF                                                               
144900                                                                          
145000     PERFORM 8600-STORE-TOTAL.                                            
145100     PERFORM 8700-GRAND-TOTAL.                                            
145200                                                                          
145300     WRITE REPORT-RECORD                                                  
145400       FROM END-OF-REPORT-LINE                                            
145500         AFTER ADVANCING 2 LINES.                                         
145600                                                                          
145700     CLOSE REPORT-FILE                                                    
145800           EXTRACT-FILE.                                                  
145900     MOVE PV-READ-COUNT               TO PV-DISP-COUNT                    
146000     DISPLAY ' RECORDS READ  = ' PV-DISP-COUNT.                           
146010     DISPLAY ' CALLS TO 713  = ' PV-CALL-CNT.                             
146020     DISPLAY ' NO CALLS 713  = ' PV-NOCALL-CNT.                           
146100                                                                          
146200 9100-ABEND.                                                              
146300                                                                          
146400     CLOSE EXTRACT-FILE                                                   
146500           REPORT-FILE                                                    
146600                                                                          
146700     MOVE +4013                       TO ABEND-CODE.                      
146800     CALL 'ILBOABN0' USING ABEND-CODE.                                    
146900                                                                          
147000 9200-SQL-ERROR.                                                          
147100                                                                          
147200     MOVE SQLCODE                     TO SQLCODE2.                        
147300     MOVE SQLERRD(3)                  TO SQLERRD3.                        
147400                                                                          
147500     DISPLAY '** ABEND **         ** = SQLERROR'.                         
147600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
147700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                           
147800     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                        
147900                                                                          
148000     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                        
148100     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                        
148200     DISPLAY '** SQLERRM          ** = ' SQLERRM.                         
148300     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                        
148400                                                                          
148500                                                                          
148600     MOVE +4013                       TO ABEND-CODE.                      
148700     CALL 'ILBOABN0' USING ABEND-CODE.                                    
148800                                                                          
148900 9300-SQL-WARNING.                                                        
149000                                                                          
149100     DISPLAY '9300-SQL-WARNING'.                                          
149200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
149300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                           
149400     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                        
149500                                                                          
149600     MOVE SQLCODE                     TO SQLCODE2.                        
149700     MOVE SQLERRD(3)                  TO SQLERRD3.                        
149800     DISPLAY '** ABEND **       ** = SQLWARNING'.                         
149900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                          
150000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                          
150100     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                          
150200     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                          
150300     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                          
150400     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                          
150500     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                          
150600     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                          
150700     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                          
150800     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                          
150900                                                                          
151000     MOVE +4013                       TO ABEND-CODE.                      
151100     CALL 'ILBOABN0' USING ABEND-CODE.                                    
151200                                                                          
