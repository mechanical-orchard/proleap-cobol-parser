000100******************************************************************00010034
000200 IDENTIFICATION DIVISION.                                         00020035
000300******************************************************************00030035
000400 PROGRAM-ID.    SUKUT165.                                         00040035
000500 AUTHOR.        JIM HUNTER                                        00050035
000600 INSTALLATION.  KOHLS.                                            00060035
000700 DATE-WRITTEN   MARCH, 2017.                                      00070035
000800 DATE-COMPILED.                                                   00080035
000900******************************************************************00090035
001000* THIS PROGRAM WILL READ THE ASSUMPTIVE TRIP ID FILE CREATED BY   00100035
001100* SUKUT164.                                                       00110035
001200* FOR EACH TRIP ID READ, A CURSOR WILL BE PERFORMED TO CHECK      00120035
001300* FOR CARTONS BELONGING TO THE TRIP THAT HAVE NOT BEEN SCANNED    00130035
001400* TO THE TRIP ID.   THOSE CARTONS WILL THEN BE CHECKED TO SEE IF  00140035
001500* THEY WERE SCANNED ON ANY TRIP ID (INDICATES A TRUCK MISLOAD).   00150035
001600*                                                                 00160035
001700* IF THE TRIP STORE AND THE SCAN STORE ON THE INPUT FILE ARE      00170035
001800* DIFFERENT, THERE IS A STORE MISLOAD.                            00180035
001900*                                                                 00190035
002000* MISLOADED CARTONS AND ASSUMPTIVELY RECEIVED CARTONS WILL BE     00200035
002100* WRITTEN TO THE OMS AND ASSUMPTIVE CARTON OUTPUT FILES.          00210035
002200* ONLY THE ASSUMPTIVELY RECEIVED CARTONS WILL BE WRITTEN TO THE   00220035
002300* INTRANSIT OUTPUT FILE WHICH WILL BE USED TO REDUCE THE STORE    00230035
002400* EXPECTED QTYS.                                                  00240035
002500*                                                                 00250035
002600* THIS PROGRAM WAS COPIED INITIALLY FROM SUKUT163.                00260035
002700******************************************************************00270035
002800******************************************************************00280035
002900* CHANGE LOG                                                      00290035
003000* DATE        CHANGED BY    DESC                                  00300035
003100* ---------- -------------  --------------------------------------00310035
003200* 03-16-2017 JIM HUNTER     INITIAL PROGRAM FOR STORE RECEIVING   00320035
003300*                           PROJECT.                              00330035
003400* 07-28-2017 JIM HUNTER                                           00340035
003500*    NEEDED TO ADD MULTIPLE SCAN (SSMS) CHECKS TO A CURSOR AND    00350035
003600*    ONE SQL STATEMENT BECAUSE WHEN THEY EXISTED WITH AN          00360035
003700*    AN AFTER LOAD (SSAU) THE AFTER LOADS WERE BYPASSED AND       00370035
003800*    WERE NOT ASSUMPTIVELY RECEIVED.                              00380035
003900******************************************************************00390035
004000 ENVIRONMENT DIVISION.                                            00400035
004100 CONFIGURATION SECTION.                                           00410035
004200                                                                  00420035
004300 SOURCE-COMPUTER.        IBM-3090.                                00430035
004400 OBJECT-COMPUTER.        IBM-3090.                                00440035
004500                                                                  00450035
004600 INPUT-OUTPUT SECTION.                                            00460035
004700 FILE-CONTROL.                                                    00470035
004800                                                                  00480035
004900     SELECT ASSUMPTIVE-TRIP-FILE-IN                               00490035
005000         ASSIGN TO IN01.                                          00500035
005100                                                                  00510035
005200     SELECT INTRANSIT-FILE-OUT                                    00520035
005300         ASSIGN TO OUT01.                                         00530035
005400                                                                  00540035
005500     SELECT OMS-FILE-OUT                                          00550035
005600         ASSIGN TO OUT02.                                         00560035
005700                                                                  00570035
005800     SELECT CARTON-INSERT-FILE-OUT                                00580035
005900         ASSIGN TO OUT03.                                         00590035
006000                                                                  00600035
006100******************************************************************00610035
006200 DATA DIVISION.                                                   00620035
006300 FILE SECTION.                                                    00630035
006400                                                                  00640035
006500 FD ASSUMPTIVE-TRIP-FILE-IN                                       00650035
006600     RECORDING MODE IS F                                          00660035
006700     LABEL RECORDS ARE STANDARD                                   00670035
006800     BLOCK CONTAINS 0 RECORDS.                                    00680035
006900                                                                  00690035
007000 01 ASSUMPTIVE-TRIP-RECORD-IN       PIC X(100).                   00700035
007100*                                                                 00710035
007200 FD INTRANSIT-FILE-OUT                                            00720035
007300     RECORDING MODE IS F                                          00730035
007400     LABEL RECORDS ARE STANDARD                                   00740035
007500     BLOCK CONTAINS 0 RECORDS.                                    00750035
007600                                                                  00760035
007700 01 INTRANSIT-RECORD-OUT            PIC X(100).                   00770035
007800*                                                                 00780035
007900 FD OMS-FILE-OUT                                                  00790035
008000     RECORDING MODE IS F                                          00800035
008100     LABEL RECORDS ARE STANDARD                                   00810035
008200     BLOCK CONTAINS 0 RECORDS.                                    00820035
008300                                                                  00830035
008400 01 OMS-RECORD-OUT                  PIC X(200).                   00840035
008500*                                                                 00850035
008600 FD CARTON-INSERT-FILE-OUT                                        00860035
008700     RECORDING MODE IS F                                          00870035
008800     LABEL RECORDS ARE STANDARD                                   00880035
008900     BLOCK CONTAINS 0 RECORDS.                                    00890035
009000                                                                  00900035
009100 01 CARTON-INSERT-RECORD-OUT        PIC X(100).                   00910035
009200*                                                                 00920035
009300******************************************************************00930035
009400 WORKING-STORAGE SECTION.                                         00940035
009500******************************************************************00950035
009600******************************************************************00960035
009700* ASSUMPTIVE RECORD INPUT FILE LAYOUT                             00970035
009800******************************************************************00980035
009900     COPY SURD152.                                                00990035
010000                                                                  01000035
010100******************************************************************01010035
010200* INTRANSIT RECORD OUTPUT FILE LAYOUT                             01020035
010300******************************************************************01030035
010400     COPY PCRD010.                                                01040035
010500                                                                  01050035
010600******************************************************************01060035
010700* OMS RECORD OUTPUT FILE LAYOUT                                   01070035
010800******************************************************************01080035
010900     COPY OFRD012.                                                01090035
011000                                                                  01100035
011100******************************************************************01110035
011200* CARTON INSERT RECORD OUTPUT FILE LAYOUT                         01120035
011300******************************************************************01130035
011400     COPY SURD153.                                                01140035
011500                                                                  01150035
011600******************************************************************01160035
011700* COPYBOOK FOR CARTON STATUS MODULE - PCKUT713                    01170035
011800******************************************************************01180035
011900     COPY PCWS046.                                                01190035
012000                                                                  01200035
012100******************************************************************01210035
012200* DB2 FORMATTED MESSAGE AREA                                      01220035
012300******************************************************************01230035
012400     COPY DPWS004.                                                01240035
012500                                                                  01250035
012600******************************************************************01260035
012700* COMMUNICATIONS AREA FOR DB2                                     01270035
012800******************************************************************01280035
012900     EXEC SQL                                                     01290035
013000          INCLUDE SQLCA                                           01300035
013100     END-EXEC.                                                    01310035
013200                                                                  01320035
013300*---------------------------------------------------------------* 01330035
013400*    SUT_OTBND_STR_SCN TABLE                                      01340035
013500*---------------------------------------------------------------* 01350035
013600     EXEC SQL                                                     01360035
013700          INCLUDE SUT00121                                        01370035
013800     END-EXEC.                                                    01380035
013900                                                                  01390035
014000*---------------------------------------------------------------* 01400035
014100*    SUT_OTBND_UPC UPC TABLE                                      01410035
014200*---------------------------------------------------------------* 01420035
014300     EXEC SQL                                                     01430035
014400          INCLUDE SUT00028                                        01440035
014500     END-EXEC.                                                    01450035
014600                                                                  01460035
014700*---------------------------------------------------------------* 01470035
014800*    XLT_UPC  TABLE                                               01480035
014900*---------------------------------------------------------------* 01490035
015000     EXEC SQL                                                     01500035
015100          INCLUDE XLT00006                                        01510035
015200     END-EXEC.                                                    01520035
015300                                                                  01530035
015400*---------------------------------------------------------------* 01540035
015500*    XLT_SKU  TABLE                                               01550035
015600*---------------------------------------------------------------* 01560035
015700     EXEC SQL                                                     01570035
015800          INCLUDE XLT00003                                        01580035
015900     END-EXEC.                                                    01590035
016000                                                                  01600035
016100*---------------------------------------------------------------* 01610035
016200*     SUT_OTBND_CART  TABLE                                       01620035
016300*---------------------------------------------------------------* 01630035
016400     EXEC SQL                                                     01640035
016500          INCLUDE SUT00024                                        01650035
016600     END-EXEC.                                                    01660035
016700                                                                  01670035
016800*---------------------------------------------------------------* 01680035
016900*    TSUOBTR - OUTBOUND TRAILER TRIP                            * 01690035
017000*---------------------------------------------------------------* 01700035
017100     EXEC SQL                                                     01710035
017200          INCLUDE TSUOBTR                                         01720035
017300     END-EXEC.                                                    01730035
017400                                                                  01740035
017500*---------------------------------------------------------------* 01750035
017600*    TSUOBTS - OUTBOUND TRAILER TRIP STATUS                     * 01760035
017700*---------------------------------------------------------------* 01770035
017800     EXEC SQL                                                     01780035
017900          INCLUDE TSUOBTS                                         01790035
018000     END-EXEC.                                                    01800035
018100                                                                  01810035
018200*---------------------------------------------------------------* 01820035
018300*    TCNTRID - TRAILIER ID TABLE                                  01830035
018400*---------------------------------------------------------------* 01840035
018500     EXEC SQL                                                     01850035
018600          INCLUDE TCNTRID                                         01860035
018700     END-EXEC.                                                    01870035
018800                                                                  01880035
018900*---------------------------------------------------------------* 01890035
019000*    SUT_OTBND_VND TABLE                                          01900035
019100*---------------------------------------------------------------* 01910035
019200     EXEC SQL                                                     01920035
019300          INCLUDE SUT00026                                        01930035
019400     END-EXEC.                                                    01940035
019500                                                                  01950035
019600*---------------------------------------------------------------* 01960035
019700*    TPKSLIP TABLE                                                01970035
019800*---------------------------------------------------------------* 01980035
019900     EXEC SQL                                                     01990035
020000          INCLUDE TPKSLIP                                         02000035
020100     END-EXEC.                                                    02010035
020200                                                                  02020035
020300*---------------------------------------------------------------* 02030035
020400*    TRECITM TABLE                                                02040035
020500*---------------------------------------------------------------* 02050035
020600     EXEC SQL                                                     02060035
020700          INCLUDE TRECITM                                         02070035
020800     END-EXEC.                                                    02080035
020900                                                                  02090035
021000*---------------------------------------------------------------* 02100035
021100*    TPURITM TABLE                                                02110035
021200*---------------------------------------------------------------* 02120035
021300     EXEC SQL                                                     02130035
021400          INCLUDE TPURITM                                         02140035
021500     END-EXEC.                                                    02150035
021600                                                                  02160035
021700*---------------------------------------------------------------* 02170035
021800*    XLV_SKU_STR TABLE                                            02180035
021900*---------------------------------------------------------------* 02190035
022000     EXEC SQL                                                     02200035
022100          INCLUDE XLV00002                                        02210035
022200     END-EXEC.                                                    02220035
022300                                                                  02230035
022310*---------------------------------------------------------------* 02231039
022320*    TSUCRDV TABLE                                                02232039
022330*---------------------------------------------------------------* 02233039
022340     EXEC SQL                                                     02234039
022350          INCLUDE TSUCRDV                                         02235039
022360     END-EXEC.                                                    02236039
022370                                                                  02237039
022400******************************************************************02240035
022500 01 ABEND-CODE                       PIC S9(04)    VALUE +0       02250035
022600                                                   COMP SYNC.     02260035
022700                                                                  02270035
022800 01 PS-PROGRAM-SWITCHES.                                          02280035
022900     05  PS-END-OF-FILE-SW             PIC  X(01)  VALUE 'N'.     02290035
023000         88  PS-END-OF-FILE                        VALUE 'Y'.     02300035
023100         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     02310035
023200     05  PS-END-OF-NOSCAN-CTN-CSR-SW   PIC  X(01)  VALUE 'N'.     02320035
023300         88  PS-END-OF-NOSCAN-CTN-CSR              VALUE 'Y'.     02330035
023400         88  PS-NOT-END-OF-NOSCAN-CTN-CSR          VALUE 'N'.     02340035
023500     05  PS-DONT-WRITE-OUTPUT-FILES-SW PIC  X(01)  VALUE 'N'.     02350035
023600         88  PS-WRITE-OUTPUT-FILES                 VALUE 'Y'.     02360035
023700         88  PS-DONT-WRITE-OUTPUT-FILES            VALUE 'N'.     02370035
023800                                                                  02380035
023900 01 PC-PROGRAM-CONSTANTS.                                         02390035
024000     05  PC-A                        PIC  X(01)    VALUE 'A'.     02400035
024100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT165'. 02410035
024200     05  PC-CRTN-STATUS-PGM          PIC  X(08) VALUE 'PCKUT713'. 02420035
024300     05  PC-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  02430035
024400     05  PC-DS                       PIC  X(02)    VALUE 'DS'.    02440035
024500     05  PC-SU                       PIC  X(02)    VALUE 'SU'.    02450035
024600                                                                  02460035
024700 01 PV-PROGRAM-VARIABLES.                                         02470035
024800     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  02480035
024900     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  02490035
025000     05  PV-PO-NBR                   PIC S9(9) COMP VALUE ZEROES. 02500035
025100     05  PV-RCVR-SEQ-NBR             PIC S9(9) COMP VALUE ZEROES. 02510035
025200     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             02520035
025300     05  PV-SHIPPED-TMST             PIC  X(26) VALUE SPACE.      02530035
025400     05  PV-OTBND-STAT-TMST-1        PIC  X(26) VALUE SPACE.      02540035
025500     05  PV-TMST-ON-TRLR             PIC  X(26) VALUE SPACE.      02550035
025600     05  PV-TRLR-SRL-NBR             PIC  S9(9) COMP VALUE ZERO.  02560035
025700     05  PV-TRLR-SRL-NBR-DISP        PIC  9(9)  VALUE ZEROES.     02570035
025800     05  PV-SHIPT-UNT-ID             PIC S9(18) COMP VALUE ZERO.  02580035
025900     05  PV-PREV-SHIPT-UNT-ID        PIC S9(18) COMP VALUE ZERO.  02590035
025901                                                                  02590137
025910     05  PV-DIVERT-TMST              PIC  X(26) VALUE SPACES.     02591037
025920     05  PV-DISPLAY-CARTON           PIC  9(20).                  02592040
025930     05  PV-DISPLAY-SQLCODE          PIC -999.                    02593040
026000                                                                  02600035
026010  01 DB2-KEYS.                                                    02601038
026070     05  DK-CARTON-ID             PIC S9(18)V COMP-3.             02607038
026080                                                                  02608038
026100 01 COUNTERS.                                                     02610035
026200     05  PV-READ-COUNTER             PIC  S9(9) COMP-3.           02620035
026300     05  PV-INTRANSIT-WRITE-COUNT    PIC  S9(9) COMP-3.           02630035
026400     05  PV-OMS-WRITE-COUNT          PIC  S9(9) COMP-3.           02640035
026500     05  PV-CARTON-WRITE-COUNT       PIC  S9(9) COMP-3.           02650035
026600                                                                  02660035
026700*---------------------------------------------------------------* 02670035
026800*    SCAN-CTN CURSOR TO FIND MISSING CARTONS                      02680035
026900*    NEEDED TO ADD MULTIPLE SCANS (SSMS) TO THE CHECK BECAUSE     02690035
027000*    WHEN THEY EXISTED WITH AN AFTER LOAD (SSAU) THE AFTER LOADS  02700035
027100*    WERE BYPASSED.                                               02710035
027200*---------------------------------------------------------------* 02720035
027300     EXEC SQL                                                     02730035
027400         DECLARE NOSCAN-CTN-CSR CURSOR FOR                        02740035
027500         SELECT  D.SHIPT_UNT_ID                                   02750035
027600                ,D.CART_SRC_CDE                                   02760035
027700                ,D.CRE_DTE                                        02770035
027800                ,D.CRE_TM                                         02780035
027900                ,SUM(A.SHPD_UNT_QTY)                              02790035
028000                ,A.UPC_NBR                                        02800035
028100                ,A.TRN_LNE_NBR                                    02810035
028200                ,A.TRN_NBR                                        02820035
028300                ,A.RCVR_SEQ_NBR                                   02830035
028400                ,A.TRN_TYP_CDE                                    02840035
028500                ,C.SKU_NBR                                        02850035
028600                ,C.INTR_UPC_ID                                    02860035
028700          FROM  SUT_OTBND_UPC  A                                  02870035
028800               ,XLT_UPC        B                                  02880035
028900               ,XLT_SKU        C                                  02890035
029000               ,SUT_OTBND_CART D                                  02900035
029100         WHERE  A.SHIPT_UNT_ID  =  D.SHIPT_UNT_ID                 02910035
029200           AND  A.UPC_NBR       =  B.UPC_NBR                      02920035
029300           AND  B.INTR_UPC_ID   =  C.INTR_UPC_ID                  02930035
029400           AND  D.OTBND_TRIP_ID = :SUT00024-OTBND-TRIP-ID         02940035
029500           AND NOT EXISTS                                         02950035
029600                (SELECT E.SCN_OTBND_TRIP_ID                       02960035
029700                   FROM SUT_OTBND_STR_SCN    E                    02970035
029800                  WHERE E.SHIPT_UNT_ID       =  D.SHIPT_UNT_ID    02980035
029900                    AND E.SCN_OTBND_TRIP_ID  =  D.OTBND_TRIP_ID   02990035
030000                    AND E.SCN_TYP_CDE       <> 'SSAU'             03000035
030100                    AND E.SCN_TYP_CDE       <> 'SSMS')            03010035
030200          GROUP BY A.UPC_NBR, A.TRN_LNE_NBR, A.TRN_NBR,           03020035
030300                   A.RCVR_SEQ_NBR, A.TRN_TYP_CDE,                 03030035
030400                   C.SKU_NBR, C.INTR_UPC_ID, D.SHIPT_UNT_ID,      03040035
030500                   D.CART_SRC_CDE, D.CRE_DTE, D.CRE_TM            03050035
030600          ORDER BY D.SHIPT_UNT_ID                                 03060035
030700        WITH UR                                                   03070035
030800     END-EXEC.                                                    03080035
030900                                                                  03090035
031000                                                                  03100035
031100******************************************************************03110035
031200 PROCEDURE DIVISION.                                              03120035
031300******************************************************************03130035
031400******************************************************************03140035
031500* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     03150035
031600*      PROGRAM.                                                   03160035
031700******************************************************************03170035
031800 0000-PROGRAM-MAINLINE.                                           03180035
031900                                                                  03190035
032000     DISPLAY '***** SUKUT165 STARTED *****'.                      03200035
032100                                                                  03210035
032200     PERFORM 1000-INITIALIZE.                                     03220035
032300     IF PS-NOT-END-OF-FILE                                        03230035
032400         PERFORM 2000-PROCESS-TRIP-FILE-IN                        03240035
032500            UNTIL PS-END-OF-FILE                                  03250035
032600     END-IF.                                                      03260035
032700     PERFORM 9000-EOJ-ROUTINE.                                    03270035
032800                                                                  03280035
032900     STOP RUN.                                                    03290035
033000                                                                  03300035
033100******************************************************************03310035
033200* DO FIRST TIME PROGRAM INITIALIZATION TASKS.                     03320035
033300*    -- OPEN INPUT FILE                                           03330035
033400*    -- OPEN OUTPUT FILE                                          03340035
033500*    -- GET CURRENT TIMESTAMP FOR THE OUTPUT INTRANSIT RECORD     03350035
033600*    -- READ INPUT FILE                                           03360035
033700******************************************************************03370035
033800 1000-INITIALIZE.                                                 03380035
033900                                                                  03390035
034000     INITIALIZE COUNTERS.                                         03400035
034100     OPEN INPUT  ASSUMPTIVE-TRIP-FILE-IN.                         03410035
034200     OPEN OUTPUT INTRANSIT-FILE-OUT                               03420035
034300                 OMS-FILE-OUT                                     03430035
034400                 CARTON-INSERT-FILE-OUT.                          03440035
034500                                                                  03450035
034600     EXEC SQL                                                     03460035
034700         SET :PC-CURRENT-TIMESTAMP  = CURRENT TIMESTAMP           03470035
034800     END-EXEC.                                                    03480035
034900                                                                  03490035
035000     PERFORM 7000-READ-ASSMPT-TRIP-FILE-IN.                       03500035
035100                                                                  03510035
035200******************************************************************03520035
035300* BEGIN RETRIEVING THE NECESSARY DATA                             03530035
035400******************************************************************03540035
035500 2000-PROCESS-TRIP-FILE-IN.                                       03550035
035600                                                                  03560035
035700                                                                  03570035
035800     DISPLAY 'TRIP ID BEING PROCESSED IS ' SU152-TRIP-ID.         03580035
035900                                                                  03590035
036000     SET PS-NOT-END-OF-NOSCAN-CTN-CSR   TO TRUE.                  03600035
036100     PERFORM 2100-OPEN-NOSCAN-CTN-CSR.                            03610035
036200     PERFORM 2200-FETCH-NOSCAN-CTN-CSR.                           03620035
036300     PERFORM 2300-PROCESS-NOSCAN-CTN-CSR UNTIL                    03630035
036400             PS-END-OF-NOSCAN-CTN-CSR.                            03640035
036500     PERFORM 2400-CLOSE-NOSCAN-CTN-CSR.                           03650035
036600                                                                  03660035
036700     PERFORM 7000-READ-ASSMPT-TRIP-FILE-IN.                       03670035
036800                                                                  03680035
036900                                                                  03690035
037000******************************************************************03700035
037100* OPEN NOT SCANNED CARTON CURSOR.                                 03710035
037200******************************************************************03720035
037300 2100-OPEN-NOSCAN-CTN-CSR.                                        03730035
037400                                                                  03740035
037500     MOVE SU152-TRIP-ID    TO SUT00024-OTBND-TRIP-ID.             03750035
037600                                                                  03760035
037700     EXEC SQL                                                     03770035
037800         OPEN NOSCAN-CTN-CSR                                      03780035
037900     END-EXEC.                                                    03790035
038000                                                                  03800035
038100     EVALUATE TRUE                                                03810035
038200         WHEN SQLCODE = ZERO                                      03820035
038300             CONTINUE                                             03830035
038400         WHEN SQLWARN0 NOT = SPACES                               03840035
038500         WHEN SQLCODE < ZERO                                      03850035
038600         WHEN SQLCODE > ZERO                                      03860035
038700             MOVE '2100-OPEN-NOSCAN-CTN-CSR' TO PV-PARAGRAPH-NAME 03870035
038800             MOVE 'SELECT SUT_OTBND_UPC '                         03880035
038900                                    TO PV-DB2-OPERATION-ATTEMPTED 03890035
039000             PERFORM 9100-SQL-ABEND                               03900035
039100     END-EVALUATE.                                                03910035
039200                                                                  03920035
039300                                                                  03930035
039400******************************************************************03940035
039500* FETCH NOT SCANNED CARTON CURSOR ROW.                            03950035
039600******************************************************************03960035
039700 2200-FETCH-NOSCAN-CTN-CSR.                                       03970035
039800                                                                  03980035
039900     INITIALIZE PC010-PCT-INTRANSIT-REC                           03990035
040000                OF012-EXTRACT-RECORD                              04000035
040100                SU153-EXTRACT-RECORD.                             04010035
040200                                                                  04020035
040300     EXEC SQL                                                     04030035
040400        FETCH NOSCAN-CTN-CSR                                      04040035
040500         INTO   :SUT00024-SHIPT-UNT-ID                            04050035
040600               ,:SUT00024-CART-SRC-CDE                            04060035
040700               ,:SUT00024-CRE-DTE                                 04070035
040800               ,:SUT00024-CRE-TM                                  04080035
040900               ,:SUT00028-SHPD-UNT-QTY                            04090035
041000               ,:SUT00028-UPC-NBR                                 04100035
041100               ,:SUT00028-TRN-LNE-NBR                             04110035
041200               ,:SUT00028-TRN-NBR                                 04120035
041300               ,:SUT00028-RCVR-SEQ-NBR                            04130035
041400               ,:SUT00028-TRN-TYP-CDE                             04140035
041500               ,:XLT00003-SKU-NBR                                 04150035
041600               ,:XLT00003-INTR-UPC-ID                             04160035
041700     END-EXEC.                                                    04170035
041800                                                                  04180035
041900     EVALUATE TRUE                                                04190035
042000         WHEN SQLCODE = ZERO                                      04200035
042100             COMPUTE PC010-IN-TRNST-QTY =                         04210035
042200                     SUT00028-SHPD-UNT-QTY * -1                   04220035
042300             END-COMPUTE                                          04230035
042400             MOVE SUT00028-UPC-NBR      TO PC010-UPC-NBR          04240035
042500             MOVE SUT00028-TRN-NBR      TO PC010-PO-NBR           04250035
042600             MOVE SUT00028-TRN-LNE-NBR  TO PC010-TRN-LNE-NBR      04260035
042700             MOVE SUT00028-TRN-TYP-CDE  TO PC010-OTB-TYP-CDE      04270035
042800             MOVE XLT00003-INTR-UPC-ID  TO PC010-INTR-UPC-ID      04280035
042900         WHEN SQLCODE = +100                                      04290035
043000             MOVE ZEROES                TO PC010-IN-TRNST-QTY     04300035
043100                                           PC010-UPC-NBR          04310035
043200                                           PC010-PO-NBR           04320035
043300                                           PC010-RCVR-SEQ-NBR     04330035
043400                                           PC010-TRN-LNE-NBR      04340035
043500             SET PS-END-OF-NOSCAN-CTN-CSR  TO  TRUE               04350035
043600         WHEN SQLWARN0 NOT = SPACES                               04360035
043700         WHEN SQLCODE < ZERO                                      04370035
043800         WHEN SQLCODE > ZERO                                      04380035
043900             MOVE '2200-FETCH-NOSCAN-CTN-CSR'                     04390035
044000                                           TO PV-PARAGRAPH-NAME   04400035
044100             MOVE 'SELECT SUT_OTBND_UPC '                         04410035
044200                                   TO PV-DB2-OPERATION-ATTEMPTED  04420035
044300             PERFORM 9100-SQL-ABEND                               04430035
044400     END-EVALUATE.                                                04440035
044500                                                                  04450035
044600                                                                  04460035
044700******************************************************************04470035
044800* PROCESS NOT SCANNED CARTON CURSOR ROW.                          04480035
044900******************************************************************04490035
045000 2300-PROCESS-NOSCAN-CTN-CSR.                                     04500035
045100                                                                  04510035
045200     IF SUT00028-TRN-TYP-CDE = 'CS'                               04520035
045300         CONTINUE                                                 04530035
045400     ELSE                                                         04540035
045500         IF SUT00028-TRN-TYP-CDE = 'FX'                           04550035
045600             CONTINUE                                             04560035
045700         ELSE                                                     04570035
045800             IF SUT00028-TRN-NBR    = PV-PO-NBR AND               04580035
045900                 SUT00028-RCVR-SEQ-NBR = PV-RCVR-SEQ-NBR          04590035
046000                 MOVE SUT00028-RCVR-SEQ-NBR TO PC010-RCVR-SEQ-NBR 04600035
046100             ELSE                                                 04610035
046200                 IF SUT00028-TRN-NBR = ZERO                       04620035
046300                   MOVE SUT00028-RCVR-SEQ-NBR                     04630035
046400                                            TO PC010-RCVR-SEQ-NBR 04640035
046500                 ELSE                                             04650035
046600                     IF SUT00028-RCVR-SEQ-NBR = ZERO              04660035
046700                         PERFORM 2350-GET-REC-SEQ-NBR             04670035
046800                     ELSE                                         04680035
046900                         MOVE SUT00028-RCVR-SEQ-NBR TO            04690035
047000                                           PC010-RCVR-SEQ-NBR     04700035
047100                     END-IF                                       04710035
047200                 END-IF                                           04720035
047300             END-IF                                               04730035
047400         END-IF                                                   04740035
047500     END-IF.                                                      04750035
047600                                                                  04760035
047700     IF SUT00028-TRN-TYP-CDE = 'FX'                               04770035
047800         CONTINUE                                                 04780035
047900     ELSE                                                         04790035
048000         IF SUT00024-SHIPT-UNT-ID  NOT = PV-PREV-SHIPT-UNT-ID     04800035
048100             PERFORM 3000-CALL-SUT-OTBND-STR-SCN                  04810035
048200             IF PS-WRITE-OUTPUT-FILES                             04820035
048300                 PERFORM 3100-WRITE-OUTPUT-FILES                  04830035
048400             END-IF                                               04840035
048500             MOVE SUT00024-SHIPT-UNT-ID TO PV-PREV-SHIPT-UNT-ID   04850035
048600         ELSE                                                     04860035
048700             IF PS-WRITE-OUTPUT-FILES                             04870035
048800                 PERFORM 3100-WRITE-OUTPUT-FILES                  04880035
048900             END-IF                                               04890035
049000         END-IF                                                   04900035
049100         MOVE SUT00028-TRN-NBR      TO PV-PO-NBR                  04910035
049200         MOVE SUT00028-RCVR-SEQ-NBR TO PV-RCVR-SEQ-NBR            04920035
049300     END-IF.                                                      04930035
049400                                                                  04940035
049500     PERFORM 2200-FETCH-NOSCAN-CTN-CSR.                           04950035
049600                                                                  04960035
049700                                                                  04970035
049800******************************************************************04980035
049900* GET REC SEQ NBR                                                 04990035
050000******************************************************************05000035
050100 2350-GET-REC-SEQ-NBR.                                            05010035
050200     EXEC SQL                                                     05020035
050300         SELECT  B.REC_SEQ_NBR                                    05030035
050400          INTO   :PKSLIP-REC-SEQ-NBR                              05040035
050500          FROM  SUT_OTBND_VND A                                   05050035
050600               ,TPKSLIP B                                         05060035
050700         WHERE  A.SHIPT_UNT_ID  =  :SUT00024-SHIPT-UNT-ID         05070035
050800           AND  A.PO_NBR        =  B.PO_NBR                       05080035
050900           AND  A.PKSL_SEQ_NBR  =  B.SEQ_NBR                      05090035
051000           AND  B.VER_STAT_CDE  =  :PC-A                          05100035
051100           WITH UR                                                05110035
051200     END-EXEC.                                                    05120035
051300                                                                  05130035
051400     EVALUATE TRUE                                                05140035
051500         WHEN SQLCODE = ZERO                                      05150035
051600             MOVE PKSLIP-REC-SEQ-NBR  TO  PC010-RCVR-SEQ-NBR      05160035
051700                                          SUT00028-RCVR-SEQ-NBR   05170035
051800         WHEN SQLCODE = +100                                      05180035
051900             MOVE ZERO                TO  PC010-RCVR-SEQ-NBR      05190035
052000                                          SUT00028-RCVR-SEQ-NBR   05200035
052100         WHEN SQLWARN0 NOT = SPACES                               05210035
052200         WHEN SQLCODE < ZERO                                      05220035
052300         WHEN SQLCODE > ZERO                                      05230035
052400             MOVE '2350-GET-REC-SEQ-NBR ' TO PV-PARAGRAPH-NAME    05240035
052500             MOVE 'SELECT TPKSLIP ' TO PV-DB2-OPERATION-ATTEMPTED 05250035
052600             PERFORM 9100-SQL-ABEND                               05260035
052700     END-EVALUATE.                                                05270035
052800                                                                  05280035
052900                                                                  05290035
053000******************************************************************05300035
053100* CLOSE NOT SCANNED CARTON CURSOR.                                05310035
053200******************************************************************05320035
053300 2400-CLOSE-NOSCAN-CTN-CSR.                                       05330035
053400     EXEC SQL                                                     05340035
053500        CLOSE NOSCAN-CTN-CSR                                      05350035
053600     END-EXEC.                                                    05360035
053700                                                                  05370035
053800     EVALUATE TRUE                                                05380035
053900         WHEN SQLCODE = ZERO                                      05390035
054000             CONTINUE                                             05400035
054100         WHEN SQLWARN0 NOT = SPACES                               05410035
054200         WHEN SQLCODE < ZERO                                      05420035
054300         WHEN SQLCODE > ZERO                                      05430035
054400             MOVE '2400-CLOSE-NOSCAN-CTN-CSR'                     05440035
054500                                            TO PV-PARAGRAPH-NAME  05450035
054600             MOVE 'SELECT SUT_OTBND_UPC'                          05460035
054700                                   TO PV-DB2-OPERATION-ATTEMPTED  05470035
054800             PERFORM 9100-SQL-ABEND                               05480035
054900     END-EVALUATE.                                                05490035
055000                                                                  05500035
055100                                                                  05510035
055200******************************************************************05520035
055300* CHECK IF CARTON WAS SCANNED ON ANY TRIP ID                      05530035
055400* IF IT WAS, WE ASSUME THAT INTRANSIT TABLES HAVE / ARE BEING     05540035
055500* UPDATED BY THE OTHER TRIP ID.                                   05550035
055600* IF IT WASN'T, THEN WE HAVE AN ASSUMPTIVE CARTON CONDITION.      05560035
055700* NEEDED TO ADD MULTIPLE SCANS (SSMS) TO THE CHECK BECAUSE        05570035
055800* WHEN THEY EXISTED WITH AN AFTER LOAD (SSAU) THE AFTER LOADS     05580035
055900* WERE BYPASSED.                                                  05590035
056000******************************************************************05600035
056100 3000-CALL-SUT-OTBND-STR-SCN.                                     05610035
056200     EXEC SQL                                                     05620035
056300         SELECT SHIPT_UNT_ID                                      05630035
056400           INTO :PV-SHIPT-UNT-ID                                  05640035
056500           FROM  SUT_OTBND_STR_SCN                                05650035
056600          WHERE  SHIPT_UNT_ID  =  :SUT00024-SHIPT-UNT-ID          05660035
056700            AND  SCN_TYP_CDE  <>  'SSAU'                          05670035
056800            AND  SCN_TYP_CDE  <>  'SSMS'                          05680035
056900           WITH UR                                                05690035
057000     END-EXEC.                                                    05700035
057100                                                                  05710035
057200     EVALUATE TRUE                                                05720035
057300         WHEN SQLCODE = ZERO                                      05730035
057400             SET PS-DONT-WRITE-OUTPUT-FILES  TO TRUE              05740035
057500         WHEN SQLCODE = -811                                      05750035
057600             SET PS-DONT-WRITE-OUTPUT-FILES  TO TRUE              05760035
057700         WHEN SQLCODE = +100                                      05770035
057800             SET PS-WRITE-OUTPUT-FILES  TO TRUE                   05780035
057900         WHEN SQLWARN0 NOT = SPACES                               05790035
058000         WHEN SQLCODE < ZERO                                      05800035
058100         WHEN SQLCODE > ZERO                                      05810035
058200             MOVE '3000-CALL-SUT-OTBND-STR-SCN'                   05820035
058300                                          TO PV-PARAGRAPH-NAME    05830035
058400             MOVE 'SELECT CARTON  ' TO PV-DB2-OPERATION-ATTEMPTED 05840035
058500             DISPLAY 'TRIP ID = ' SU152-TRIP-ID                   05850035
058600             DISPLAY 'CARTON  = ' SUT00024-SHIPT-UNT-ID           05860035
058700             PERFORM 9100-SQL-ABEND                               05870035
058800     END-EVALUATE.                                                05880035
058900                                                                  05890035
059000                                                                  05900035
059100******************************************************************05910035
059200* CALL THE NECESSARY TABLES TO GET THE INFO REQUIRED IN THE       05920035
059300* OUTPUT FILES.                                                   05930035
059400* DETERMINE WHICH OUTPUT FILES THE CURRENT RECORD SHOULD BE       05940035
059500* WRITTEN TO.   ASSUMPTIVE MISLOAD CARTONS (DIFFERENT TRIP ID     05950035
059600* AND SCAN STORES) SHOULD NOT BE WRITTEN TO THE INTRANSIT FILE.   05960035
059700******************************************************************05970035
059800 3100-WRITE-OUTPUT-FILES.                                         05980035
059900                                                                  05990035
060000     PERFORM 3110-RETRIEVE-SHIPPED-TMST.                          06000035
060100     PERFORM 3120-RETRIEVE-TRIP-INFO.                             06010035
060200     PERFORM 3130-RETRIEVE-TRAILER-ID.                            06020035
060300     PERFORM 3140-GET-COST.                                       06030035
060400     PERFORM 3150-GET-RETAIL.                                     06040035
060500     PERFORM 3160-SELECT-CARTON-TMST.                             06050035
060600                                                                  06060035
060700     IF  SU152-TRIP-STORE = SU152-SCAN-STORE                      06070035
060800         PERFORM 8000-WRITE-INTRANSIT-FILE-OUT                    06080035
060900         PERFORM 8100-WRITE-OMS-FILE-OUT                          06090035
061000         IF SUT00024-SHIPT-UNT-ID  NOT = PV-PREV-SHIPT-UNT-ID     06100035
061100             PERFORM 8200-WRITE-CARTON-FILE-OUT                   06110035
061200         END-IF                                                   06120035
061300     ELSE                                                         06130035
061400         PERFORM 8100-WRITE-OMS-FILE-OUT                          06140035
061500         IF SUT00024-SHIPT-UNT-ID  NOT = PV-PREV-SHIPT-UNT-ID     06150035
061600             PERFORM 8200-WRITE-CARTON-FILE-OUT                   06160035
061700         END-IF                                                   06170035
061800     END-IF.                                                      06180035
061900                                                                  06190035
062000                                                                  06200035
062100******************************************************************06210035
062200* RETRIEVE SHIPPED TMST FOR OUTPUT FILES.                         06220035
062300******************************************************************06230035
062400 3110-RETRIEVE-SHIPPED-TMST.                                      06240035
062500                                                                  06250035
062600     MOVE SU152-TRIP-ID      TO   SUOBTR-OTBND-TRIP-ID.           06260035
062700                                                                  06270035
062800     EXEC SQL                                                     06280035
062900         SELECT B.OTBND_STAT_TMST                                 06290035
063000          INTO  :PV-SHIPPED-TMST                                  06300035
063100          FROM  TSUOBTR A                                         06310035
063200               ,TSUOBTS B                                         06320035
063300         WHERE  A.OTBND_TRIP_ID     = :SUOBTR-OTBND-TRIP-ID       06330035
063400           AND  A.OTBND_TRIP_ID     = B.OTBND_TRIP_ID             06340035
063500           AND  B.TRIP_STAT_CDE     = :PC-DS                      06350035
063600              AND B.OTBND_STAT_TMST IN                            06360035
063700                  (SELECT MAX(C.OTBND_STAT_TMST)                  06370035
063800                    FROM TSUOBTS C                                06380035
063900               WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID          06390035
064000                  AND  C.TRIP_STAT_CDE = :PC-DS)                  06400035
064100           WITH UR                                                06410035
064200     END-EXEC.                                                    06420035
064300                                                                  06430035
064400     EVALUATE TRUE                                                06440035
064500         WHEN SQLCODE = ZERO                                      06450035
064600             CONTINUE                                             06460035
064700         WHEN SQLWARN0 NOT = SPACES                               06470035
064800         WHEN SQLCODE < ZERO                                      06480035
064900         WHEN SQLCODE > ZERO                                      06490035
065000             MOVE '3110-RETRIEVE-SHIPPED-TMST'                    06500035
065100                                        TO PV-PARAGRAPH-NAME      06510035
065200             MOVE 'SELECT TSUOBTS ' TO PV-DB2-OPERATION-ATTEMPTED 06520035
065300             PERFORM 9100-SQL-ABEND                               06530035
065400     END-EVALUATE.                                                06540035
065500                                                                  06550035
065600                                                                  06560035
065700******************************************************************06570035
065800* RETRIEVE TRIP INFORMATION FOR THE OUTPUT FILES.                 06580035
065900******************************************************************06590035
066000 3120-RETRIEVE-TRIP-INFO.                                         06600035
066100                                                                  06610035
066200     MOVE SU152-TRIP-ID      TO   SUOBTR-OTBND-TRIP-ID.           06620035
066300                                                                  06630035
066400     EXEC SQL                                                     06640035
066500         SELECT  A.ORGN_OPER_UNT_ID                               06650035
066600                ,A.DEST_OPER_UNT_ID                               06660035
066700                ,A.TRLR_SRL_NBR                                   06670035
066800                ,B.SHIP_SCAC_CDE                                  06680035
066900                ,B.TRLR_SEAL_ID                                   06690035
067000                ,B.DOOR_ID                                        06700035
067100                ,B.OTBND_STAT_TMST                                06710035
067200          INTO  :SUOBTR-ORGN-OPER-UNT-ID                          06720035
067300               ,:SUOBTR-DEST-OPER-UNT-ID                          06730035
067400               ,:SUOBTR-TRLR-SRL-NBR                              06740035
067500               ,:SUOBTS-SHIP-SCAC-CDE                             06750035
067600               ,:SUOBTS-TRLR-SEAL-ID                              06760035
067700               ,:SUOBTS-DOOR-ID                                   06770035
067800               ,:PV-OTBND-STAT-TMST-1                             06780035
067900          FROM  TSUOBTR A                                         06790035
068000               ,TSUOBTS B                                         06800035
068100         WHERE  A.OTBND_TRIP_ID     = :SUOBTR-OTBND-TRIP-ID       06810035
068200           AND  A.OTBND_TRIP_ID     = B.OTBND_TRIP_ID             06820035
068300           AND  B.TRIP_STAT_CDE     = :PC-SU                      06830035
068400              AND B.OTBND_STAT_TMST IN                            06840035
068500                  (SELECT MAX(C.OTBND_STAT_TMST)                  06850035
068600                    FROM TSUOBTS C                                06860035
068700               WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID          06870035
068800                  AND  C.TRIP_STAT_CDE = :PC-SU)                  06880035
068900           WITH UR                                                06890035
069000     END-EXEC.                                                    06900035
069100                                                                  06910035
069200     EVALUATE TRUE                                                06920035
069300         WHEN SQLCODE = ZERO                                      06930035
069400             CONTINUE                                             06940035
069500         WHEN SQLWARN0 NOT = SPACES                               06950035
069600         WHEN SQLCODE < ZERO                                      06960035
069700         WHEN SQLCODE > ZERO                                      06970035
069800             MOVE '3120-RETRIEVE-TRIP-INFO '                      06980035
069900                                        TO PV-PARAGRAPH-NAME      06990035
070000             MOVE 'SELECT TSUOBTS ' TO PV-DB2-OPERATION-ATTEMPTED 07000035
070100             PERFORM 9100-SQL-ABEND                               07010035
070200     END-EVALUATE.                                                07020035
070300                                                                  07030035
070400                                                                  07040035
070500******************************************************************07050035
070600*  RETRIEVE TRAILER INFO FOR THE OMS-GIV FILE                     07060035
070700*  ADDED 2/25/16 CLP                                              07070035
070800******************************************************************07080035
070900 3130-RETRIEVE-TRAILER-ID.                                        07090035
071000                                                                  07100035
071100     MOVE SUOBTR-TRLR-SRL-NBR   TO  PV-TRLR-SRL-NBR.              07110035
071200                                                                  07120035
071300     EXEC SQL                                                     07130035
071400         SELECT  A.TRLR_ID                                        07140035
071500                ,A.SCAC_CDE                                       07150035
071600          INTO  :CNTRID-TRLR-ID                                   07160035
071700               ,:CNTRID-SCAC-CDE                                  07170035
071800          FROM  TCNTRID A                                         07180035
071900         WHERE  A.TRLR_SRL_NBR      = :PV-TRLR-SRL-NBR            07190035
072000           WITH UR                                                07200035
072100     END-EXEC.                                                    07210035
072200                                                                  07220035
072300     EVALUATE TRUE                                                07230035
072400         WHEN SQLCODE = ZERO                                      07240035
072500             CONTINUE                                             07250035
072600         WHEN SQLWARN0 NOT = SPACES                               07260035
072700         WHEN SQLCODE < ZERO                                      07270035
072800         WHEN SQLCODE > ZERO                                      07280035
072900             MOVE '3130-RETRIEVE-TRAILER-ID'                      07290035
073000                                        TO PV-PARAGRAPH-NAME      07300035
073100             MOVE 'SELECT TCNTRID ' TO PV-DB2-OPERATION-ATTEMPTED 07310035
073200             MOVE PV-TRLR-SRL-NBR   TO PV-TRLR-SRL-NBR-DISP       07320035
073300             DISPLAY 'TRIP ID BEING PROCESSED IS ' SU152-TRIP-ID  07330035
073400             DISPLAY 'TRLR SRL NUMBER IS ' PV-TRLR-SRL-NBR-DISP   07340035
073500             PERFORM 9100-SQL-ABEND                               07350035
073600     END-EVALUATE.                                                07360035
073700                                                                  07370035
073800                                                                  07380035
073900***************************************************************** 07390035
074000*GET THE COST OF THE ITEM WHEN PO WAS CREATED                     07400035
074100* FOR ASN CARTON                                                  07410035
074200***************************************************************** 07420035
074300 3140-GET-COST.                                                   07430035
074400                                                                  07440035
074500     EXEC SQL                                                     07450035
074600        SELECT B.UNT_COST_AMT                                     07460035
074700          INTO  :PURITM-UNT-COST-AMT                              07470035
074800          FROM  TRECITM A                                         07480035
074900               ,TPURITM B                                         07490035
075000         WHERE A.ORD_NBR             = :SUT00028-TRN-NBR          07500035
075100           AND A.REC_SEQ_NBR         = :SUT00028-RCVR-SEQ-NBR     07510035
075200           AND A.ORD_LNE_NBR         = :SUT00028-TRN-LNE-NBR      07520035
075300           AND A.ORD_NBR             = B.PO_NBR                   07530035
075400           AND A.PO_VER_NBR          = B.VER_NBR                  07540035
075500           AND A.ORD_LNE_NBR         = B.APP_PO_LNE_NBR           07550035
075600           AND A.VER_STATUS_CDE      = 'A'                        07560035
075700          WITH UR                                                 07570035
075800     END-EXEC.                                                    07580035
075900                                                                  07590035
076000     EVALUATE TRUE                                                07600035
076100         WHEN SQLCODE = ZERO                                      07610035
076200             CONTINUE                                             07620035
076300         WHEN SQLCODE = +100                                      07630035
076400             MOVE ZERO TO PURITM-UNT-COST-AMT                     07640035
076500         WHEN SQLWARN0 NOT = SPACES                               07650035
076600         WHEN SQLCODE < ZERO                                      07660035
076700         WHEN SQLCODE > ZERO                                      07670035
076800             MOVE '3140-GET-COST'   TO PV-PARAGRAPH-NAME          07680035
076900             MOVE 'SELECT TPURITM ' TO PV-DB2-OPERATION-ATTEMPTED 07690035
077000             MOVE PV-TRLR-SRL-NBR TO PV-TRLR-SRL-NBR-DISP         07700035
077100             DISPLAY 'TRIP ID BEING PROCESSED IS ' SU152-TRIP-ID  07710035
077200             DISPLAY 'TRLR SRL NUMBER IS ' PV-TRLR-SRL-NBR-DISP   07720035
077300             DISPLAY 'PO IS    ' SUT00028-TRN-NBR                 07730035
077400             DISPLAY 'RECV IS  ' SUT00028-RCVR-SEQ-NBR            07740035
077500             DISPLAY 'LINE# IS ' SUT00028-TRN-LNE-NBR             07750035
077600             PERFORM 9100-SQL-ABEND                               07760035
077700     END-EVALUATE.                                                07770035
077800                                                                  07780035
077900                                                                  07790035
078000**************************************************************    07800035
078100* GET THE RETAIL FOR THE EXPECTED STORE-IF NOT THERE GET THE      07810035
078200* RETAIL FOR THE '0' STR                                          07820035
078300**************************************************************    07830035
078400 3150-GET-RETAIL.                                                 07840035
078500                                                                  07850035
078600     MOVE SU152-SCAN-STORE         TO XLV00002-STR-NBR.           07860035
078700                                                                  07870035
078800     EXEC SQL                                                     07880035
078900        SELECT A.UNT_RTL_AMT                                      07890035
079000          INTO  :XLV00002-UNT-RTL-AMT                             07900035
079100          FROM  XLV_SKU_STR A                                     07910035
079200         WHERE A.INTR_UPC_ID         = :XLT00003-INTR-UPC-ID      07920035
079300           AND A.STR_NBR             = :XLV00002-STR-NBR          07930035
079400          WITH UR                                                 07940035
079500     END-EXEC.                                                    07950035
079600                                                                  07960035
079700     EVALUATE TRUE                                                07970035
079800         WHEN SQLCODE = ZERO                                      07980035
079900             CONTINUE                                             07990035
080000         WHEN SQLCODE = +100                                      08000035
080100             PERFORM 3155-GET-0RETAIL                             08010035
080200         WHEN SQLWARN0 NOT = SPACES                               08020035
080300         WHEN SQLCODE < ZERO                                      08030035
080400         WHEN SQLCODE > ZERO                                      08040035
080500             MOVE '3150-GET-RETAIL   '  TO PV-PARAGRAPH-NAME      08050035
080600             MOVE 'SELECT XLV_SKU_STR' TO                         08060035
080700                                        PV-DB2-OPERATION-ATTEMPTED08070035
080800             MOVE PV-TRLR-SRL-NBR TO PV-TRLR-SRL-NBR-DISP         08080035
080900             DISPLAY 'TRIP ID BEING PROCESSED IS ' SU152-TRIP-ID  08090035
081000             DISPLAY 'TRLR SRL NUMBER IS ' PV-TRLR-SRL-NBR-DISP   08100035
081100             DISPLAY 'PO IS    ' SUT00028-TRN-NBR                 08110035
081200             DISPLAY 'RECV IS  ' SUT00028-RCVR-SEQ-NBR            08120035
081300             DISPLAY 'LINE# IS ' SUT00028-TRN-LNE-NBR             08130035
081400             PERFORM 9100-SQL-ABEND                               08140035
081500     END-EVALUATE.                                                08150035
081600                                                                  08160035
081700                                                                  08170035
081800**************************************************************    08180035
081900* GET THE RETAIL FOR THE '0' STORE.                               08190035
082000**************************************************************    08200035
082100 3155-GET-0RETAIL.                                                08210035
082200                                                                  08220035
082300     EXEC SQL                                                     08230035
082400        SELECT A.UNT_RTL_AMT                                      08240035
082500          INTO  :XLV00002-UNT-RTL-AMT                             08250035
082600          FROM  XLV_SKU_STR A                                     08260035
082700         WHERE A.INTR_UPC_ID         = :XLT00003-INTR-UPC-ID      08270035
082800           AND A.STR_NBR             = 0                          08280035
082900          WITH UR                                                 08290035
083000     END-EXEC.                                                    08300035
083100                                                                  08310035
083200     EVALUATE TRUE                                                08320035
083300         WHEN SQLCODE = ZERO                                      08330035
083400             CONTINUE                                             08340035
083500         WHEN SQLCODE = +100                                      08350035
083600             MOVE ZERO TO XLV00002-UNT-RTL-AMT                    08360035
083700         WHEN SQLWARN0 NOT = SPACES                               08370035
083800         WHEN SQLCODE < ZERO                                      08380035
083900         WHEN SQLCODE > ZERO                                      08390035
084000             MOVE '3155-GET-0RETAIL'   TO PV-PARAGRAPH-NAME       08400035
084100             MOVE 'SELECT XLV_SKU_STR' TO                         08410035
084200                                        PV-DB2-OPERATION-ATTEMPTED08420035
084300             MOVE PV-TRLR-SRL-NBR TO PV-TRLR-SRL-NBR-DISP         08430035
084400             DISPLAY 'TRIP ID BEING PROCESSED IS ' SU152-TRIP-ID  08440035
084500             DISPLAY 'TRLR SRL NUMBER IS ' PV-TRLR-SRL-NBR-DISP   08450035
084600             DISPLAY 'PO IS     ' SUT00028-TRN-NBR                08460035
084700             DISPLAY 'RECV IS   ' SUT00028-RCVR-SEQ-NBR           08470035
084800             DISPLAY 'LINE# IS  ' SUT00028-TRN-LNE-NBR            08480035
084900             DISPLAY 'UPC ID IS ' XLT00003-INTR-UPC-ID            08490035
085000             PERFORM 9100-SQL-ABEND                               08500035
085100     END-EVALUATE.                                                08510035
085200                                                                  08520035
085300                                                                  08530035
085400**************************************************************    08540035
085500* GET THE RETAIL FOR THE EXPECTED STORE-IF NOT THERE GET THE      08550035
085600* RETAIL FOR THE '0' STR                                          08560035
085700**************************************************************    08570035
085800 3160-SELECT-CARTON-TMST.                                         08580035
085900                                                                  08590035
086000     INITIALIZE PC046-COMMAREA-REC.                               08600035
086100     MOVE PC-CURRENT-PROGRAM-NAME  TO PC046-CALLING-PGM-NME.      08610035
086200     MOVE SUT00024-SHIPT-UNT-ID    TO PC046-CARTON-ID.            08620035
086300                                                                  08630035
086400     CALL PC-CRTN-STATUS-PGM                                      08640035
086500         USING PC046-COMMAREA-REC.                                08650035
086600                                                                  08660035
086700     IF  PC046-SUCCESSFUL                                         08670035
086800         MOVE PC046-CRTN-STAT-TMST TO PV-TMST-ON-TRLR             08680035
086900     ELSE                                                         08690035
086901*                                                                 08690135
086902* DMH 11/2/17 BEGIN                                               08690235
086910         IF  PC046-CRTN-STAT-ERROR                                08691035
086911             MOVE SUT00024-SHIPT-UNT-ID TO PV-DISPLAY-CARTON      08691142
086912             DISPLAY ' SUKUT165 - ' PV-DISPLAY-CARTON             08691242
086913                     ' DIVERT AFTER SCAN ON'                      08691342
086920             PERFORM 8112-GET-ON-TRLR-TIMESTAMP                   08692035
086930             MOVE PV-DIVERT-TMST TO PV-TMST-ON-TRLR               08693035
086940         ELSE                                                     08694035
086950* DMH 11/2/17 END                                                 08695035
086960*                                                                 08696035
087000         DISPLAY '** ABEND - PROGRAM ' PC-CURRENT-PROGRAM-NAME    08700035
087100         DISPLAY '** BAD CALL TO CRTN STATUS PGM PCKUT713'        08710035
087200         DISPLAY 'PC046-CRA-RET-CDE = ' PC046-CRA-RET-CDE         08720035
087300         DISPLAY PC046-CRA-RET-MSG                                08730035
087400         MOVE    +4019          TO ABEND-CODE                     08740035
087500         CALL    'ILBOABN0'  USING ABEND-CODE                     08750035
087600     END-IF.                                                      08760035
087700                                                                  08770035
087800                                                                  08780035
087900******************************************************************08790035
088000* READ INPUT FILE.                                                08800035
088100******************************************************************08810035
088200 7000-READ-ASSMPT-TRIP-FILE-IN.                                   08820035
088300                                                                  08830035
088400      INITIALIZE SU152-ASSUMPTIVE-CTN-REC.                        08840035
088500                                                                  08850035
088600      READ ASSUMPTIVE-TRIP-FILE-IN INTO                           08860035
088700           SU152-ASSUMPTIVE-CTN-REC                               08870035
088800            AT END SET PS-END-OF-FILE TO TRUE.                    08880035
088900                                                                  08890035
089000      IF PS-END-OF-FILE                                           08900035
089100         CONTINUE                                                 08910035
089200      ELSE                                                        08920035
089300         ADD +1 TO PV-READ-COUNTER                                08930035
089400      END-IF.                                                     08940035
089500                                                                  08950035
089600******************************************************************08960035
089700* WRITE INTRANSIT OUTPUT FILE - COPYBOOK PCRD010.                 08970035
089800******************************************************************08980035
089900 8000-WRITE-INTRANSIT-FILE-OUT.                                   08990035
090000                                                                  09000035
090100     MOVE SU152-TRIP-ID               TO PC010-TRIP-ID.           09010035
090200     MOVE SU152-SCAN-STORE            TO PC010-STR-NBR.           09020035
090300     MOVE PC-CURRENT-PROGRAM-NAME     TO PC010-UPD-USR-ID.        09030035
090400     MOVE PC-CURRENT-TIMESTAMP        TO PC010-EVENT-TMST.        09040035
090500     SET PC010-ASSUMPTIVE-UNLOAD      TO TRUE.                    09050035
090600     SET PC010-TRN-STR-EXPECTED       TO TRUE.                    09060035
090700     SET PC010-NOT-SHIPPED-FROM-DC    TO TRUE.                    09070035
090800     SET PC010-UNLOADED-AT-STORE      TO TRUE.                    09080035
090900                                                                  09090035
091000     WRITE  INTRANSIT-RECORD-OUT                                  09100035
091100      FROM  PC010-PCT-INTRANSIT-REC.                              09110035
091200     ADD    +1   TO PV-INTRANSIT-WRITE-COUNT.                     09120035
091300                                                                  09130035
091400                                                                  09140035
091500******************************************************************09150035
091600* WRITE OMS OUTPUT FILE - COPYBOOK OFRD012.                       09160035
091700******************************************************************09170035
091800 8100-WRITE-OMS-FILE-OUT.                                         09180035
091900                                                                  09190035
092000     MOVE SU152-SCAN-STORE            TO OF012-DEST-LOC-NBR.      09200035
092100     MOVE SU152-TRIP-ID               TO OF012-OTBND-TRIP-ID.     09210035
092200     MOVE PV-SHIPPED-TMST             TO OF012-SHIPPED-TMST.      09220035
092300     MOVE SUT00024-SHIPT-UNT-ID       TO OF012-SHIPT-UNT-ID.      09230035
092400     MOVE XLT00003-SKU-NBR            TO OF012-SKU-NBR.           09240035
092500     MOVE SUT00028-SHPD-UNT-QTY       TO OF012-SHPD-UNT-QTY.      09250035
092600     MOVE SUOBTR-ORGN-OPER-UNT-ID     TO OF012-ORGN-OPER-UNT-ID.  09260035
092700     MOVE CNTRID-TRLR-ID              TO OF012-TRLR-ID.           09270035
092800     MOVE SUOBTR-TRLR-SRL-NBR         TO OF012-TRLR-SRL-NBR.      09280035
092900     MOVE SUOBTS-TRLR-SEAL-ID         TO OF012-TRLR-SEAL-ID.      09290035
093000     MOVE SUOBTS-SHIP-SCAC-CDE        TO OF012-SHIP-SCAC-CDE.     09300035
093100     MOVE SUT00028-TRN-NBR            TO OF012-TRN-NBR.           09310035
093200     MOVE SUT00028-RCVR-SEQ-NBR       TO OF012-RCVR-SEQ-NBR.      09320035
093300     MOVE XLV00002-UNT-RTL-AMT        TO OF012-UNIT-RETAIL.       09330035
093400     MOVE PURITM-UNT-COST-AMT         TO OF012-COST-AMT.          09340035
093500     IF   SUT00024-CART-SRC-CDE       =  'ASN'                    09350035
093600         MOVE 'CKN'                   TO OF012-SML-TYPE           09360035
093700     ELSE                                                         09370035
093800         MOVE SUT00024-CART-SRC-CDE   TO OF012-SML-TYPE           09380035
093900     END-IF.                                                      09390035
094000     MOVE ZEROES                      TO OF012-MSTR-UNT-ID.       09400035
094100     MOVE PV-TMST-ON-TRLR             TO OF012-TMST-ON-TRLR.      09410035
094200     MOVE SUT00024-CRE-DTE            TO OF012-DTE-AT-DC.         09420035
094300     MOVE SUT00024-CRE-TM             TO OF012-TM-AT-DC.          09430035
094400     IF SU152-TRIP-STORE = SU152-SCAN-STORE                       09440035
094500         MOVE 'SSAR'                  TO OF012-SCN-TYP-CDE        09450035
094600     ELSE                                                         09460035
094700         MOVE 'SSAM'                  TO OF012-SCN-TYP-CDE        09470035
094800     END-IF.                                                      09480035
094900                                                                  09490035
095000     WRITE  OMS-RECORD-OUT                                        09500035
095100      FROM  OF012-EXTRACT-RECORD.                                 09510035
095200     ADD    +1   TO PV-OMS-WRITE-COUNT.                           09520035
095300                                                                  09530035
095400                                                                  09540035
095410******************************************************************09541035
095420*  THIS PARAGRAPH WILL BE USED TO GET THE DIVERT TIMESTAMP FOR    09542035
095430*  THE CARTON WHEN THE CALL TO PCKUT713 RETURNS A CODE INDICATING 09543035
095440*  THAT FOR THE CARTON BEING PROCESSED, THERE WAS AN ACTIVE SCAN  09544035
095450*  ON FOR THE CARTON FOLLOWED BY AN ACTIVE DIVERT ROW FOR THE     09545035
095460*  CARTON THAT WAS MORE RECENT THEN THE SCAN ON.  THIS CAN HAPPEN 09546035
095470*  IF THE CARTON THAT HAS AN ACTIVE SCAN ON ALSO WAS DIVERTED ON  09547035
095480*  THE DAY THAT SUK041 IS RUNNING AND SUK041 IS RUNNING BEFORE    09548036
095490*  JOB SUK015 (PROGRAM SUKP020) WOULD HAVE BEEN ABLE TO           09549035
095491*  INACTIVATE THE SCAN ON ENTRY.                                  09549135
095492* DMH 11/2/17                                                     09549236
095494******************************************************************09549435
095495 8112-GET-ON-TRLR-TIMESTAMP.                                      09549535
095496                                                                  09549635
095497     MOVE SUT00024-SHIPT-UNT-ID   TO DK-CARTON-ID.                09549735
095498                                                                  09549835
095499     EXEC SQL                                                     09549935
095500          SELECT  DIVERT_TMST                                     09550035
095501            INTO :PV-DIVERT-TMST                                  09550135
095502            FROM  TSUCRDV                                         09550235
095503           WHERE  SHIPT_UNT_ID = :DK-CARTON-ID                    09550335
095504             AND  ACTV_CDE     = 'A'                              09550435
095505             AND  DIVERT_TMST =                                   09550535
095506                   (SELECT MAX(B.DIVERT_TMST)                     09550635
095507                      FROM TSUCRDV B                              09550735
095508                     WHERE B.SHIPT_UNT_ID = :DK-CARTON-ID)        09550835
095509          WITH UR                                                 09550935
095510     END-EXEC.                                                    09551035
095511                                                                  09551135
095512     EVALUATE TRUE                                                09551235
095513         WHEN SQLCODE = ZERO                                      09551335
095514         WHEN SQLCODE = -811                                      09551435
095515              CONTINUE                                            09551535
095516         WHEN SQLWARN0 NOT = SPACES                               09551635
095517         WHEN SQLCODE < ZERO                                      09551735
095518         WHEN SQLCODE > ZERO                                      09551835
095519             MOVE '8112-GET-ON-TRLR-TIMESTAMP' TO                 09551935
095520                  PV-PARAGRAPH-NAME                               09552035
095521             MOVE 'SELECT TSUCRDV         ' TO                    09552135
095522                  PV-DB2-OPERATION-ATTEMPTED                      09552235
095523             MOVE DK-CARTON-ID TO PV-DISPLAY-CARTON               09552335
095524             MOVE SQLCODE TO PV-DISPLAY-SQLCODE                   09552435
095526             DISPLAY 'TRLR SRL NUMBER IS ' PV-TRLR-SRL-NBR-DISP   09552635
095527             DISPLAY 'CARTON IS ' PV-DISPLAY-CARTON               09552735
095528             DISPLAY 'SQLCODE IS ' PV-DISPLAY-SQLCODE             09552835
095529             PERFORM 9100-SQL-ABEND                               09552935
095530     END-EVALUATE.                                                09553035
095531                                                                  09553135
095540******************************************************************09554035
095600* WRITE CARTON OUTPUT FILE - COPYBOOK SURD153.                    09560035
095700******************************************************************09570035
095800 8200-WRITE-CARTON-FILE-OUT.                                      09580035
095900                                                                  09590035
096000     MOVE SUT00024-SHIPT-UNT-ID       TO SU153-SHIPT-UNT-ID.      09600035
096100     MOVE SU152-SCAN-STORE            TO SU153-SCN-LOC-NBR.       09610035
096200     MOVE SU152-TRIP-ID               TO SU153-OTBND-TRIP-ID.     09620035
096300     IF SU152-TRIP-STORE = SU152-SCAN-STORE                       09630035
096400         MOVE 'SSAR'                  TO SU153-SCN-TYPE-CDE       09640035
096500     ELSE                                                         09650035
096600         MOVE 'SSAM'                  TO SU153-SCN-TYPE-CDE       09660035
096700     END-IF.                                                      09670035
096800     SET SU153-INSERT-RECORD          TO TRUE.                    09680035
096900     MOVE SPACES                      TO SU153-CRTN-SCAN-TMST.    09690035
097000                                                                  09700035
097100     WRITE  CARTON-INSERT-RECORD-OUT                              09710035
097200      FROM  SU153-EXTRACT-RECORD.                                 09720035
097300     ADD    +1   TO PV-CARTON-WRITE-COUNT.                        09730035
097400                                                                  09740035
097500                                                                  09750035
097600******************************************************************09760035
097700* CLOSE FILES.   DISPLAY COUNTERS.                                09770035
097800******************************************************************09780035
097900 9000-EOJ-ROUTINE.                                                09790035
098000     CLOSE ASSUMPTIVE-TRIP-FILE-IN                                09800035
098100           INTRANSIT-FILE-OUT                                     09810035
098200           OMS-FILE-OUT                                           09820035
098300           CARTON-INSERT-FILE-OUT.                                09830035
098400                                                                  09840035
098500     MOVE PV-READ-COUNTER          TO PV-DISPLAY-COUNT.           09850035
098600     DISPLAY 'TOTAL RECORDS READ.: '  PV-DISPLAY-COUNT.           09860035
098700     MOVE PV-INTRANSIT-WRITE-COUNT TO PV-DISPLAY-COUNT.           09870035
098800     DISPLAY 'INTRANSIT RECS OUT.: '  PV-DISPLAY-COUNT.           09880035
098900     MOVE PV-OMS-WRITE-COUNT       TO PV-DISPLAY-COUNT.           09890035
099000     DISPLAY 'OMS RECS OUT.......: '  PV-DISPLAY-COUNT.           09900035
099100     MOVE PV-CARTON-WRITE-COUNT    TO PV-DISPLAY-COUNT.           09910035
099200     DISPLAY 'CARTON RECS OUT....: '  PV-DISPLAY-COUNT.           09920035
099300                                                                  09930035
099400     DISPLAY '*****  SUKUT165 ENDED  *****'.                      09940035
099500                                                                  09950035
099600******************************************************************09960035
099700* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL     09970035
099800* ERROR OR WARNING CODE OCCURS.                                   09980035
099900******************************************************************09990035
100000 9100-SQL-ABEND.                                                  10000035
100100     DISPLAY '9100-SQL-ABEND'.                                    10010035
100200     DISPLAY '** ABEND     **'.                                   10020035
100300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10030035
100400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10040035
100500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     10050035
100600     DISPLAY '** TRIP ID   ** = ' SU152-TRIP-ID.                  10060035
100700                                                                  10070035
100800******************************************************************10080035
100900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    10090035
101000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         10100035
101100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     10110035
101200* FORMAT.                                                         10120035
101300******************************************************************10130035
101400     COPY DPPD004.                                                10140035
101500                                                                  10150035
101600     MOVE +4013                  TO ABEND-CODE.                   10160035
101700     CALL 'ILBOABN0' USING ABEND-CODE.                            10170035
101800                                                                  10180035
