000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT682.                                         00020000
000300 AUTHOR.        BUDDY BARNES.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   JUN, 2011.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*  AHKUT682.   "ARCHIVE HISTORY" PROJECT. DATA OFFLOAD.          *00090000
001000*                                                                *00100000
001000*                                                                *00101000
001100*  PURPOSE:                                                      *00102000
001200*  THIS PROGRAM EXTRACTS ELIGIBLE ROWS BASED ON AUD_TMST ON      *00103003
001300*  TAUCSEN IN ORDER TO CREATE AN ARCHIVE FILE OF TAUCSEN         *00104002
001300*  WHICH WILL THEN BE USED TO DELETE ROWS FROM TAUCSEN           *00105000
001600*                                                                *00106000
001700*  PROCESSING OVERVIEW:                                          *00107000
001800*  THIS PROGRAM ACCESSES TAUCSEN AND BASED ON A CONTROL CARD DATE*00108003
001900*  APPLIES SELECTION CRITERIA, CREATING AN OUTPUT FILE OF        *00108103
002100*  1) THE FULL ROW OF DATA FROM TAUCSEN                          *00110000
002400*                                                                *00140000
002500*  FOR EACH CSTM ID RETURNED THE FULL ROW OF DATA IS WRITTEN     *00150003
002600*  TO THE EXTRACT FILE TO BE USED FOR ARCHIVING AND DELETING.    *00160000
003000******************************************************************00170000
006020******************************************************************00180000
006030 ENVIRONMENT DIVISION.                                            00190000
006040 CONFIGURATION SECTION.                                           00200000
006050 SOURCE-COMPUTER.        IBM-3090.                                00210000
006060 OBJECT-COMPUTER.        IBM-3090.                                00220000
006070                                                                  00230000
006080 INPUT-OUTPUT SECTION.                                            00240000
006090 FILE-CONTROL.                                                    00250000
006100                                                                  00260000
006200     SELECT  OUT-ARCHIVE-FILE             ASSIGN TO OUT01.        00280000
006300                                                                  00290000
006400 DATA DIVISION.                                                   00300000
006500 FILE SECTION.                                                    00310000
006600                                                                  00320000
006700 FD  OUT-ARCHIVE-FILE                                             00390000
006800     RECORDING MODE IS F                                          00391000
006900     LABEL RECORDS ARE STANDARD                                   00392000
007000     BLOCK CONTAINS 0 RECORDS.                                    00393000
007100 01  OUT-ARCHIVE-RECORD              PIC  X(345).                 00394000
007200                                                                  00395000
007300 WORKING-STORAGE SECTION.                                         00396000
007400                                                                  00397000
007500 01  PC-PROGRAM-CONSTANTS.                                        00398000
007600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT682'.  00399000
007700     05  PC-PGM-PROGRESS-DESC.                                    00400000
007800         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00410000
007800         10  PC-CONTINUING           PIC X(10) VALUE 'CONTINUING'.00420000
008500         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00430000
008600         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00440000
008700     05  PC-ABEND-INFO.                                           00450000
008800         10  PC-ABEND                PIC X(11) VALUE              00460000
008900                                               '** ABEND **'.     00470000
009000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00480000
009100                                               '- PARA       : '. 00490000
009200         10  PC-ABEND-MSG-DISPLAY-PARA                            00500000
009300                                     PIC X(15) VALUE              00510000
009400                                               '  CALLED PARA: '. 00520000
009500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00530000
009600                                               '  FOR ABEND# : '. 00540000
009700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00550000
009800                                               '- ERROR IS   : '. 00560000
009900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00570000
010000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00580000
010100                                               '- ACTION     : '. 00590000
010200     05  PC-TEST-AND-SET-NULL-IND.                                00600000
010300         10  PC-NOT-NULL             PIC S9(4) COMP               00610000
010400                                               VALUE ZERO.        00620000
010500         10  PC-NULL                 PIC S9(4) COMP               00630000
010600                                               VALUE -1.          00640000
010700         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00650000
010800                                               VALUE -2.          00660000
010900         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00670000
011000                                                                  00680000
011100     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 010000.      00690000
011200                                                                  00700000
011300 01  PS-PROGRAM-SWITCHES.                                         00710000
011400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00720000
011500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00730000
011600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00740000
012000                                                                  00780000
012100 01  PV-PROGRAM-VARIABLES.                                        00790000
012400     05  DISPLAY-CSTM-ENTR-ID        PIC  X(12) VALUE SPACES.     00800000
013600     05  PV-FUNC-QTY                  PIC S9(09) COMP.            00801004
012500     05  PV-PRG-TMST                 PIC X(26) VALUE SPACES.      00810000
012600     05  PV-PRG-TMST-DETAIL REDEFINES PV-PRG-TMST.                00820000
012700         10  PV-PRG-DATE             PIC X(10).                   00830000
012800         10  PV-PRG-TIME             PIC X(16).                   00840000
013000     05  PV-TABLE-ROW-FETCHED-CNT    PIC  9(9) VALUE 0.           00850000
013100     05  PV-ARCHIVE-WRITTEN-CNT       PIC  9(9) VALUE 0.          00860000
013800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00872000
013900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00873000
014000     05  PV-DB2-TABLE-NAME-1         PIC X(18) VALUE SPACES.      00874000
014100     05  PV-DB2-TABLE-NAME-2         PIC X(18) VALUE SPACES.      00875000
014200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           00876000
014300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           00877000
014400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        00878000
014500                                                                  00879000
014600     05  PV-TMST                     PIC X(26) VALUE SPACES.      00880000
014700     05  PV-TIMESTAMP-DETAIL                                      00890000
014800         REDEFINES                                                00900000
014900         PV-TMST.                                                 00910000
015000         10  PV-TIMESTAMP-19.                                     00920000
015100             15  PV-TMS-DATE.                                     00930000
015200                 20  PV-TMS-YEAR.                                 00940000
015300                     25  PV-TMS-CC   PIC X(02).                   00941000
015400                     25  PV-TMS-YY   PIC X(02).                   00942000
015500                 20  FILLER          PIC X(01).                   00943000
015600                 20  PV-TMS-MONTH    PIC X(02).                   00944000
015700                 20  FILLER          PIC X(01).                   00945000
015800                 20  PV-TMS-DAY      PIC X(02).                   00946000
015900             15  FILLER              PIC X(01).                   00947000
016000             15  PV-TMS-HOUR         PIC X(02).                   00948000
016100             15  FILLER              PIC X(01).                   00949000
016200             15  PV-TMS-MINUTE       PIC X(02).                   00949100
016300             15  FILLER              PIC X(01).                   00949200
016400             15  PV-TMS-SECOND       PIC X(02).                   00949300
016500         10  FILLER                  PIC X(01).                   00949400
016600         10  PV-TMS-MSECOND          PIC X(06).                   00949500
014500                                                                  00949600
018200*---------------------------------------------------------------* 00970000
018300*  RECORD LAYOUT FOR ARCHIVE FILE.                              * 00980000
018400*---------------------------------------------------------------* 00990000
018500     COPY AHRD028.                                                01000000
018700                                                                  01010000
018800 01  DM-DISPLAY-MESSAGE.                                          01020000
018900     05  DM-01-10.                                                01030000
019000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01040000
019100         10  FILLER                  PIC X(02) VALUE ': '.        01050000
019200     05  DM-11-80.                                                01060000
019300         10  FILLER                  PIC X(27) VALUE              01070000
019400                                    'BEGIN ARCHIV FILE CREATION.'.01080003
019500         10  FILLER                  PIC X(01) VALUE SPACE.       01090000
019600         10  FILLER                  PIC X(42) VALUE ALL '*'.     01100000
019700     05  DM-81-120.                                               01110000
019800         10  FILLER                  PIC X(40) VALUE ALL '*'.     01120000
019900                                                                  01130000
020000 01  DP-DISPLAY-PROGRESS-MSG.                                     01140000
020100     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01150000
020200     05  FILLER                      PIC X(02) VALUE SPACE.       01160000
020300     05  DP-STATUS-DESCRIPTION       PIC X(13) VALUE SPACE.       01170000
020400     05  FILLER                      PIC X(04) VALUE ' AT '.      01180000
020500     05  DP-TIMESTAMP                PIC X(26) VALUE SPACE.       01190000
020600     05  FILLER                      PIC X(03) VALUE '.  '.       01200000
020700     05  FILLER                      PIC X(09) VALUE 'FETCHES: '. 01210000
020800     05  DP-TABLE-ROW-FETCHED-CNT    PIC ZZZ,ZZZ,ZZ9              01220000
020900                                               VALUE ZERO.        01230000
021000     05  FILLER                      PIC X(02) VALUE ', '.        01240000
021100     05  FILLER                      PIC X(09) VALUE 'WRITTEN: '. 01250000
021200     05  DP-ARCHIVE-WRITTEN-CNT       PIC ZZZ,ZZZ,ZZ9             01260003
021300                                               VALUE ZERO.        01270000
021400     05  FILLER                      PIC X(01) VALUE '.'.         01280000
021500                                                                  01290000
021600 01  ABEND-CODE                      PIC S9(04)                   01300000
021700                                               VALUE ZEROES       01310000
021800                                               COMP SYNC.         01320000
021900                                                                  01330000
022000*---------------------------------------------------------------* 01340000
022100*  DB2 FORMATTED MESSAGE AREA                                     01350000
022200*---------------------------------------------------------------* 01360000
022300     COPY DPWS004.                                                01370000
022400                                                                  01380000
022500*---------------------------------------------------------------* 01390000
022600*    DB2 AREA FOR TAUCSEN                                       * 01400000
022700*---------------------------------------------------------------* 01410000
022800     EXEC SQL                                                     01420000
022900          INCLUDE TAUCSEN                                         01430000
023000     END-EXEC.                                                    01440000
023100                                                                  01450000
022500*---------------------------------------------------------------* 01451003
022600*    DB2 AREA FOR TKRPRPM                                       * 01452003
022700*---------------------------------------------------------------* 01453003
022800     EXEC SQL                                                     01454003
022900          INCLUDE TKRPRPM                                         01455003
023000     END-EXEC.                                                    01456003
023100                                                                  01457003
023200*---------------------------------------------------------------* 01460000
023300*    DB2 AREA FOR SYSDUMMY                                      * 01470000
023400*---------------------------------------------------------------* 01480000
023500     EXEC SQL                                                     01490000
023600          INCLUDE SYSDUMMY                                        01500000
023700     END-EXEC.                                                    01510000
023800                                                                  01520000
023900*---------------------------------------------------------------* 01530000
024000*    DB2 AREA FOR COMMUNICATIONS                                * 01540000
024100*---------------------------------------------------------------* 01550000
024200     EXEC SQL                                                     01560000
024300          INCLUDE SQLCA                                           01570000
024400     END-EXEC.                                                    01580000
024500                                                                  01590000
024600*---------------------------------------------------------------* 01600000
024700*    DEFINE CURSOR FOR ACCESSING TAUCSEN                        * 01610000
024800*---------------------------------------------------------------* 01620000
024900     EXEC SQL                                                     01630000
025000         DECLARE TABLE-CURSOR CURSOR FOR                          01640000
025100           SELECT                                                 01650000
025200              CSTM_ENTR_ID                                        01660000
025300             ,ENT_ID                                              01670000
025400             ,BKR_REF_NBR                                         01680000
025500             ,FILD_TMST                                           01690000
025600             ,EST_CLR_TMST                                        01700000
025700             ,ACTL_CLR_TMST                                       01710000
025800             ,EXM_TMST                                            01720000
025800             ,REJ_TMST                                            01730000
025800             ,REJ_DESC                                            01740000
025800             ,LQDN_TMST                                           01750000
025800             ,LQDN_SSPNN_TMST                                     01760000
025800             ,LQDN_SSPNN_DESC                                     01761000
025800             ,DAT_SRC_ENT_ID                                      01762000
025800             ,LAST_UPD_BY_USR_ID                                  01765000
025800             ,LAST_UPD_TMST                                       01765100
025800             ,AUD_FUNC_CDE                                        01765201
025800             ,AUD_TMST                                            01765301
025800             ,MOM_DEST_POE_CDE                                    01765400
025800             ,MOM_TRIP_TYP_CDE                                    01765500
025800             ,ENTR_TYP_CDE                                        01765600
027900             FROM TAUCSEN                                         01766000
028100            WHERE AUD_TMST <=                                     01768006
028100                    CURRENT TIMESTAMP - :PV-FUNC-QTY DAYS         01768106
028500         FOR FETCH ONLY                                           01769000
028600         WITH UR                                                  01770000
028700         OPTIMIZE FOR 1 ROW                                       01780000
028800     END-EXEC.                                                    01790000
029000                                                                  01800000
029100 PROCEDURE DIVISION.                                              01810000
029200                                                                  01820000
029300 0000-PROGRAM-MAINLINE.                                           01830000
029400                                                                  01840000
029500     PERFORM 1000-INITIALIZE.                                     01850000
029600                                                                  01860000
029700     PERFORM 2000-GET-NEXT-FROM-CURSOR                            01870003
029800         UNTIL PS-TABLE-LOOP-DONE.                                01880003
029900                                                                  01890000
030000     PERFORM 6000-EOJ-ROUTINE.                                    01900000
030100     STOP RUN.                                                    01910000
030200                                                                  01920000
030400******************************************************************01930000
030500*  INITIALIZATIONS                                               *01940000
030600******************************************************************01950000
030700 1000-INITIALIZE.                                                 01960000
030800                                                                  01970000
030900     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  01980000
031000     DISPLAY DM-DISPLAY-MESSAGE.                                  01990000
031400                                                                  02000000
031500     OPEN OUTPUT OUT-ARCHIVE-FILE.                                02020000
031600                                                                  02021003
328000     EXEC SQL                                                     02022003
328100         SELECT FUNC_QTY                                          02023003
328200           INTO   :PV-FUNC-QTY                                    02024003
328300           FROM   TKRPRPM                                         02025003
328400          WHERE LOC_ID           = 90                             02026003
328500            AND INTFC_SYS_CDE    = 'KHL'                          02027003
328600            AND SYS_PRC_FUNC_CDE = 'TRPGDY'                       02028003
328700            AND FUNC_PRC_STAT_CDE = 'AC'                          02029003
328800     END-EXEC.                                                    02029103
328900                                                                  02029203
329000     EVALUATE TRUE                                                02029303
329100         WHEN SQLCODE = +0                                        02029403
329200             CONTINUE                                             02029503
329300         WHEN OTHER                                               02029603
051900              MOVE '1000-INITIALIZE'                              02029703
052000                                 TO PV-PARAGRAPH-NAME             02029803
052100              MOVE 'SELECT FROM TABLE '                           02029903
052200                                 TO PV-DB2-OPERATION-MSG-1        02030003
052300              MOVE 'TKRPRPM'     TO PV-DB2-TABLE-NAME-1           02030103
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           02030203
052500              PERFORM 9999-DB2-ABEND                              02030303
329900     END-EVALUATE.                                                02030403
328900                                                                  02030503
031200     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02031000
033600     DISPLAY 'PURGE USING CURRENT TIMESTAMP - ' DP-TIMESTAMP      02032003
033600     DISPLAY 'MINUS - ' PV-FUNC-QTY ' DAYS'                       02033003
032500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02040000
032600     SET PS-TABLE-LOOP-NOT-DONE TO TRUE.                          02041003
032700     PERFORM 9100-OPEN-TABLE-CURSOR.                              02042003
033800                                                                  02043003
033100     INITIALIZE DCLTAUCSEN                                        02050000
033200                AH028-ARCHIVE-RECORD-LAYOUT.                      02060003
033300     PERFORM 9110-FETCH-TABLE-CURSOR.                             02061003
033400                                                                  02062003
033500     IF PS-TABLE-LOOP-DONE                                        02063003
033600         DISPLAY 'NO CUSTOMS ENTRY IDS SELECTED FROM CURSOR'      02064003
033700     END-IF.                                                      02065003
033800                                                                  02066003
033900******************************************************************02240000
034000*  FETCH NEXT FROM CURSOR & WRITE OUTPUT ARCHIVE FILE RECORD.    *02250003
034100******************************************************************02260000
034200 2000-GET-NEXT-FROM-CURSOR.                                       02270000
034300                                                                  02280000
034400     MOVE  AUCSEN-CSTM-ENTR-ID TO DISPLAY-CSTM-ENTR-ID.           02310003
034410*    DISPLAY 'FETCHED CUSTOMS ENTRY = ' DISPLAY-CSTM-ENTR-ID.     02320003
034610                                                                  02330000
036100     PERFORM 2010-POPULATE-ARCHIVE-RECORD.                        02340003
036200     PERFORM 9650-WRITE-ARCHIVE-RECORD.                           02350003
036300     PERFORM 2100-CHECK-PGM-PROGRESS.                             02360003
036600                                                                  02361003
036700     INITIALIZE DCLTAUCSEN                                        02362003
036800                AH028-ARCHIVE-RECORD-LAYOUT.                      02363003
036900     PERFORM 9110-FETCH-TABLE-CURSOR.                             02364003
036600                                                                  02370003
037100******************************************************************02380000
037200*  MOVE COLUMNS FROM TABLES TO FIELDS IN ARCHIVE FILE RECORD.    *02390000
037300******************************************************************02400000
037400 2010-POPULATE-ARCHIVE-RECORD.                                    02410000
037500                                                                  02420000
           MOVE AUCSEN-CSTM-ENTR-ID       TO AH028-CSTM-ENTR-ID.        02430000
           MOVE AUCSEN-ENT-ID             TO AH028-ENT-ID.              02440000
           MOVE AUCSEN-BKR-REF-NBR        TO AH028-BKR-REF-NBR.         02450000
           MOVE AUCSEN-FILD-TMST          TO AH028-FILD-TMST.           02460000
           MOVE AUCSEN-EST-CLR-TMST       TO AH028-EST-CLR-TMST.        02470000
           MOVE AUCSEN-ACTL-CLR-TMST      TO AH028-ACTL-CLR-TMST.       02480000
           MOVE AUCSEN-EXM-TMST           TO AH028-EXM-TMST.            02490000
           MOVE AUCSEN-REJ-TMST           TO AH028-REJ-TMST.            02500000
           MOVE AUCSEN-REJ-DESC           TO AH028-REJ-DESC.            02510000
           MOVE AUCSEN-LQDN-TMST          TO AH028-LQDN-TMST.           02520000
           MOVE AUCSEN-LQDN-SSPNN-TMST    TO AH028-LQDN-SSPNN-TMST.     02530000
           MOVE AUCSEN-LQDN-SSPNN-DESC    TO AH028-LQDN-SSPNN-DESC.     02540000
           MOVE AUCSEN-DAT-SRC-ENT-ID     TO AH028-DAT-SRC-ENT-ID.      02550000
           MOVE AUCSEN-LAST-UPD-BY-USR-ID TO AH028-LAST-UPD-BY-USR-ID.  02562000
           MOVE AUCSEN-LAST-UPD-TMST      TO AH028-LAST-UPD-TMST.       02562100
           MOVE AUCSEN-AUD-FUNC-CDE       TO AH028-AUD-FUNC-CDE.        02562201
           MOVE AUCSEN-AUD-TMST           TO AH028-AUD-TMST.            02562301
           MOVE AUCSEN-MOM-DEST-POE-CDE   TO AH028-MOM-DEST-POE-CDE.    02562400
           MOVE AUCSEN-MOM-TRIP-TYP-CDE   TO AH028-MOM-TRIP-TYP-CDE.    02562500
           MOVE AUCSEN-ENTR-TYP-CDE       TO AH028-ENTR-TYP-CDE.        02562600
042200                                                                  02563000
040700******************************************************************02564000
040800*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02565000
040900*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02566000
041000*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02567000
041100******************************************************************02568000
041200 2100-CHECK-PGM-PROGRESS.                                         02569000
041300     DIVIDE    PV-ARCHIVE-WRITTEN-CNT                             02570000
041400         BY        PC-HOW-OFTEN-TO-DISPLAY                        02580000
041500         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02590000
041600         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02600000
041700                                                                  02610000
041800     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02620000
041900         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02630000
042000         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02640000
042100     END-IF.                                                      02650000
042200                                                                  02660000
046400******************************************************************02670000
046500*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *02680000
046600******************************************************************02690000
046700 6000-EOJ-ROUTINE.                                                02700000
046800                                                                  02710000
047100     CLOSE OUT-ARCHIVE-FILE.                                      02730000
047200                                                                  02731003
047300     PERFORM 9130-CLOSE-TABLE-CURSOR.                             02732003
047200                                                                  02740000
046900     MOVE PC-ENDING  TO  DP-STATUS-DESCRIPTION.                   02750000
047500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02760000
047600                                                                  02770000
047700     DISPLAY 'TOTAL CUSTOMS ENTRY IDS = '                         02780003
047700                                  PV-ARCHIVE-WRITTEN-CNT.         02790000
047900                                                                  02800000
048000******************************************************************02810000
048100*  DISPLAY PROGRAM PROGRESS.                                     *02820000
048200******************************************************************02830000
048300 6200-DISPLAY-PGM-PROGRESS.                                       02840000
048400                                                                  02850000
048500     EXEC SQL                                                     02860000
048600          SET :PV-TMST = CURRENT TIMESTAMP                        02870000
048700     END-EXEC.                                                    02880000
048800                                                                  02890000
048900     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                02900000
049000     MOVE PV-TMST                   TO DP-TIMESTAMP.              02910000
049100     MOVE PV-TABLE-ROW-FETCHED-CNT  TO DP-TABLE-ROW-FETCHED-CNT.  02920000
049200     MOVE PV-ARCHIVE-WRITTEN-CNT     TO DP-ARCHIVE-WRITTEN-CNT.   02930003
049300                                                                  02940000
049400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             02950000
049600                                                                  02960000
049700******************************************************************02970000
049800*  OPEN   TABLE CURSOR                                           *02980000
049900******************************************************************02990000
050000 9100-OPEN-TABLE-CURSOR.                                          03000000
050100     EXEC SQL                                                     03010000
050200          OPEN TABLE-CURSOR                                       03020000
050300     END-EXEC.                                                    03030000
050400                                                                  03040000
050500     EVALUATE TRUE                                                03050000
050600         WHEN SQLCODE = ZERO                                      03060000
050700              CONTINUE                                            03070000
050800         WHEN SQLCODE = +100                                      03080000
050900              SET PS-TABLE-LOOP-DONE TO TRUE                      03090000
051000              MOVE '9100-OPEN-TABLE-CURSOR'                       03100000
051100                                 TO PV-PARAGRAPH-NAME             03110000
051200              MOVE 'OPEN TABLE CURSOR - NO ROWS SELECTED'         03120000
051300                                 TO PV-DB2-OPERATION-MSG-1        03130000
051400              MOVE 'TAUCSEN' TO PV-DB2-TABLE-NAME-1               03140000
051500              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03150000
051600              PERFORM 9999-DB2-ABEND                              03160000
051700         WHEN SQLWARN0 NOT EQUAL SPACE                            03170000
051800         WHEN SQLCODE  NOT EQUAL ZERO                             03180000
051900              MOVE '9100-OPEN-TABLE-CURSOR'                       03190000
052000                                 TO PV-PARAGRAPH-NAME             03200000
052100              MOVE 'OPEN TABLE CURSOR'                            03210000
052200                                 TO PV-DB2-OPERATION-MSG-1        03220000
052300              MOVE 'TAUCSEN' TO PV-DB2-TABLE-NAME-1               03230000
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03240000
052500              PERFORM 9999-DB2-ABEND                              03250000
052600     END-EVALUATE.                                                03260000
052700                                                                  03270000
052900******************************************************************03280000
053000*  FETCH TABLE CURSOR                                            *03290000
053100******************************************************************03300000
053200 9110-FETCH-TABLE-CURSOR.                                         03310000
053300     EXEC SQL                                                     03320000
053400         FETCH TABLE-CURSOR                                       03330000
053500          INTO  :AUCSEN-CSTM-ENTR-ID                              03340000
053600               ,:AUCSEN-ENT-ID                                    03350000
053700               ,:AUCSEN-BKR-REF-NBR                               03360000
053800               ,:AUCSEN-FILD-TMST                                 03370000
053900               ,:AUCSEN-EST-CLR-TMST                              03380000
054000               ,:AUCSEN-ACTL-CLR-TMST                             03390000
054100               ,:AUCSEN-EXM-TMST                                  03400000
054100               ,:AUCSEN-REJ-TMST                                  03410000
054100               ,:AUCSEN-REJ-DESC                                  03420000
054100               ,:AUCSEN-LQDN-TMST                                 03430000
054100               ,:AUCSEN-LQDN-SSPNN-TMST                           03440000
054100               ,:AUCSEN-LQDN-SSPNN-DESC                           03450000
054100               ,:AUCSEN-DAT-SRC-ENT-ID                            03460000
054100               ,:AUCSEN-LAST-UPD-BY-USR-ID                        03490000
054100               ,:AUCSEN-LAST-UPD-TMST                             03491000
054100               ,:AUCSEN-AUD-FUNC-CDE                              03491100
054100               ,:AUCSEN-AUD-TMST                                  03491200
054100               ,:AUCSEN-MOM-DEST-POE-CDE                          03492000
054100               ,:AUCSEN-MOM-TRIP-TYP-CDE                          03493000
054100               ,:AUCSEN-ENTR-TYP-CDE                              03494000
056300     END-EXEC.                                                    03500000
056400                                                                  03510000
056500     EVALUATE TRUE                                                03520000
056600         WHEN SQLCODE = ZERO                                      03530000
056700              ADD +1                 TO PV-TABLE-ROW-FETCHED-CNT  03540000
056800         WHEN SQLCODE = +100                                      03550000
056900              SET PS-TABLE-LOOP-DONE TO TRUE                      03560000
057000         WHEN SQLWARN0 NOT EQUAL SPACE                            03570000
057100         WHEN SQLCODE NOT EQUAL ZERO                              03580000
057200              MOVE '9110-FETCH-TABLE-CURSOR'                      03590000
057300                                 TO PV-PARAGRAPH-NAME             03600000
057400              MOVE 'FETCH TABLE CURSOR'                           03610000
057500                                 TO PV-DB2-OPERATION-MSG-1        03620000
057600              MOVE 'TAUCSEN' TO PV-DB2-TABLE-NAME-1               03630000
057700              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03640000
057800              PERFORM 9999-DB2-ABEND                              03650000
057900     END-EVALUATE.                                                03660000
058100                                                                  03670000
058200******************************************************************03680000
058300*  CLOSE TABLE CURSOR                                            *03690000
058400******************************************************************03700000
058500 9130-CLOSE-TABLE-CURSOR.                                         03710000
058600     EXEC SQL                                                     03720000
058700          CLOSE TABLE-CURSOR                                      03730000
058800     END-EXEC.                                                    03740000
058900                                                                  03750000
059000     EVALUATE TRUE                                                03760000
059100         WHEN SQLCODE = ZERO                                      03770000
059200              CONTINUE                                            03780000
059300         WHEN SQLWARN0 NOT EQUAL SPACE                            03790000
059400         WHEN SQLCODE NOT EQUAL ZERO                              03800000
059500              MOVE '9130-CLOSE-TABLE-CURSOR'                      03810000
059600                                 TO PV-PARAGRAPH-NAME             03820000
059700              MOVE 'CLOSE TABLE CURSOR'                           03830000
059800                                 TO PV-DB2-OPERATION-MSG-1        03840000
059900              MOVE 'TAUCSEN' TO PV-DB2-TABLE-NAME-1               03850000
060000              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03860000
060100              PERFORM 9999-DB2-ABEND                              03870000
060200     END-EVALUATE.                                                03880000
060600                                                                  03890000
060700******************************************************************03900000
060800*  WRITE A RECORD TO THE ARCHIVE FILE                            *03910000
060900******************************************************************03920000
061000 9650-WRITE-ARCHIVE-RECORD.                                       03930000
061100     WRITE  OUT-ARCHIVE-RECORD  FROM  AH028-ARCHIVE-RECORD-LAYOUT.03940000
061200     ADD +1 TO PV-ARCHIVE-WRITTEN-CNT.                            03950000
061400                                                                  03960000
061700******************************************************************03970000
061800*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *03980000
061900*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *03990000
062000*  SQL ERROR OR WARNING CODE OCCURS.                             *04000000
062100******************************************************************04010000
062200 9999-DB2-ABEND.                                                  04020000
062300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04030000
062400             ' 9999-DB2-ABEND'.                                   04040000
062500     DISPLAY PC-CURRENT-PROGRAM-NAME                              04050000
062600             ' ** ABEND           **'.                            04060000
062700     DISPLAY PC-CURRENT-PROGRAM-NAME                              04070000
062800             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04080000
062900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04090000
063000             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.     04100000
063100     DISPLAY PC-CURRENT-PROGRAM-NAME                              04110000
063200             ' **                 ** = ' PV-DB2-TABLE-NAME-2.     04120000
063300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04130000
063400             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04140000
063500                                                                  04150000
063600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04160000
063700             ' ** SQLCODE         ** = ' SQLCODE.                 04170000
063800     MOVE SQLCODE TO PV-SQLCODE.                                  04180000
063900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04190000
064000             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04200000
064100                                                                  04210000
064200     DISPLAY PC-CURRENT-PROGRAM-NAME                              04220000
064300             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04230000
064400                                                                  04240000
064600*----------------------------------------------------------------*04250000
064700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04260000
064800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04270000
064900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04280000
065000* FORMAT.                                                        *04290000
065100*----------------------------------------------------------------*04300000
065200     COPY DPPD004.                                                04310000
065300                                                                  04320000
065400     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04330000
065500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04340000
065700                                                                  04350000
065800*----------------------------------------------------------------*04360000
065900* CALL ABEND                                                     *04370000
066000*----------------------------------------------------------------*04380000
066100     MOVE +4013                  TO ABEND-CODE.                   04390000
066200     CALL 'ILBOABN0' USING ABEND-CODE.                            04400000
