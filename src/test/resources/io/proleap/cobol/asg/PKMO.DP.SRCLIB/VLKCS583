000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.                VLKCS583.                             00050000
000600 AUTHOR.                    MICHAEL WALTERS.                      00060000
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070000
000800 DATE-WRITTEN.              05-31-96.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  CICS PROGRAM - VLKCS583 - V583                                *00120000
001300*                                                                *00130000
001400*      PURCHASE ORDER SYSTEM PRETICKET REQUEST SCREEN            *00140039
001500*                                                                *00150000
001600*  THIS SCREEN WILL BE USED BY THE BUYING OFFICE TO CREATE A     *00160000
001700*  REQUEST FOR TICKETS TO BE MADE BY THE TICKETING OFFICE        *00170000
001800******************************************************************00180000
263627*---------------------------------------------------------------* 00181099
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00182099
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00183099
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00184099
263627*---------------------------------------------------------------* 00185099
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236         00186099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00187099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00188099
CICS  ***************************************************************** 00189099
001900                                                                  00190000
002000 EJECT                                                            00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600                                                                  00260000
002700 01  DK-DB2-KEYS.                                                 00270000
002800     05  DK-PO-NUMBER                   PIC S9(09) COMP.          00280000
002900     05  DK-PO-LNE-NBR                  PIC S9(09) COMP.          00290000
003000     05  DK-PO-REQ-NBR                  PIC S9(09) COMP.          00300000
003100     05  DK-ENT-ID                      PIC S9(09) COMP.          00310000
003200     05  DK-DEPT-NBR                    PIC  X(03).               00320000
003500     05  DK-TICKET-TYPE                 PIC  X(20).               00350000
003600     05  DK-TICKET-PLACEMENT            PIC  X(04).               00360000
003700                                                                  00370000
003800 01  PC-PROGRAM-CONSTANTS.                                        00380000
004400     05  PC-PRETICKET-FUNCTION-ID       PIC S9(04)  COMP          00440000
004500                                                    VALUE +5.     00450000
004600     05  PC-PRETICKET-TYP-CDE           PIC S9(04)  COMP          00460000
004700                                                    VALUE +1.     00470000
004800     05  PC-SERVICE-AGRMT-CDE           PIC  X(01)  VALUE '4'.    00480000
004900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00490000
005000                                                    'VL583A  '.   00500000
005100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00510000
005200                                                    'VLKM583 '.   00520000
005300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00530000
005400                                                    'VLKCS583'.   00540000
005500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00550099
005600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00560099
005700     05  PC-ADDR-QUEUE-SEQ              PIC  9(01)  VALUE 3.      00570099
005800     05  PC-RSN-QUEUE-SEQ               PIC  9(01)  VALUE 4.      00580099
005900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +05     00590099
006000                                                    COMP SYNC.    00600099
006100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00610099
006200                                                    COMP SYNC.    00620099
006300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00630099
006400                                                    +1000000      00640099
006500                                                    COMP-3.       00650099
006600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00660099
006700                                                    COMP SYNC.    00670099
006800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00680099
006900                                                    COMP-3.       00690099
007401     05  PC-DPKUT410                    PIC  X(08) VALUE          00740199
007402                                                   'DPKUT410'.    00740299
007403*                                                                 00740799
007404     05  PC-TSYMSG-NUMBERS.                                       00740899
007405         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00740999
007406         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00741099
007407         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00741199
007408         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00741299
007420         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00742099
007430         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00743099
007440         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00744099
007450         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00745099
007460         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00746099
007470         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00747099
007480         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00748099
007490         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00749099
007500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00750099
007600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00760099
007700         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  00770099
007800         10  PC-TSYMSG-00117            PIC  9(05)  VALUE 00117.  00780099
007900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00790099
008200         10  PC-TSYMSG-00522            PIC  9(05)  VALUE 00522.  00820099
008300         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00830099
008400         10  PC-TSYMSG-01134            PIC  9(05)  VALUE 01134.  00840099
008700         10  PC-TSYMSG-01331            PIC  9(05)  VALUE 01331.  00870099
008800         10  PC-TSYMSG-01334            PIC  9(05)  VALUE 01334.  00880099
008900         10  PC-TSYMSG-01335            PIC  9(05)  VALUE 01335.  00890099
009000         10  PC-TSYMSG-01336            PIC  9(05)  VALUE 01336.  00900099
009100         10  PC-TSYMSG-01337            PIC  9(05)  VALUE 01337.  00910099
009200         10  PC-TSYMSG-01338            PIC  9(05)  VALUE 01338.  00920099
009300         10  PC-TSYMSG-01339            PIC  9(05)  VALUE 01339.  00930099
009400         10  PC-TSYMSG-01340            PIC  9(05)  VALUE 01340.  00940099
009500         10  PC-TSYMSG-01341            PIC  9(05)  VALUE 01341.  00950099
009600         10  PC-TSYMSG-01342            PIC  9(05)  VALUE 01342.  00960099
009700         10  PC-TSYMSG-01343            PIC  9(05)  VALUE 01343.  00970099
009800         10  PC-TSYMSG-01347            PIC  9(05)  VALUE 01347.  00980099
009900         10  PC-TSYMSG-01351            PIC  9(05)  VALUE 01351.  00990099
010000         10  PC-TSYMSG-01353            PIC  9(05)  VALUE 01353.  01000099
010100         10  PC-TSYMSG-01357            PIC  9(05)  VALUE 01357.  01010099
010200         10  PC-TSYMSG-01358            PIC  9(05)  VALUE 01358.  01020099
010300         10  PC-TSYMSG-01359            PIC  9(05)  VALUE 01359.  01030099
010400         10  PC-TSYMSG-01360            PIC  9(05)  VALUE 01360.  01040099
010500         10  PC-TSYMSG-01364            PIC  9(05)  VALUE 01364.  01050099
010600         10  PC-TSYMSG-01365            PIC  9(05)  VALUE 01365.  01060099
010700         10  PC-TSYMSG-01367            PIC  9(05)  VALUE 01367.  01070099
010800         10  PC-TSYMSG-01392            PIC  9(05)  VALUE 01392.  01080099
010900         10  PC-TSYMSG-01393            PIC  9(05)  VALUE 01393.  01090099
011000         10  PC-TSYMSG-01467            PIC  9(05)  VALUE 01467.  01100099
011100         10  PC-TSYMSG-01470            PIC  9(05)  VALUE 01470.  01110099
011200*                                                                 01120099
011300 01  PS-PROGRAM-SWITCHES.                                         01130099
011400     05  PS-IMPORT-ERROR-SW             PIC  X(01)  VALUE 'N'.    01140099
011500         88  PS-NO-IMPORT-ERROR                     VALUE 'N'.    01150099
011600         88  PS-IMPORT-ERROR                        VALUE 'Y'.    01160099
011700     05  PS-REPOSITION-SW               PIC  X(01)  VALUE 'N'.    01170099
011800         88  PS-NOT-REPOSITION                      VALUE 'N'.    01180099
011900         88  PS-REPOSITION                          VALUE 'Y'.    01190099
012000     05  PS-FIRST-SELECT-SW             PIC  X(01)  VALUE 'N'.    01200099
012100         88  PS-FIRST-SELECT-NOT-FOUND              VALUE 'N'.    01210099
012200         88  PS-FIRST-SELECT-FOUND                  VALUE 'Y'.    01220099
012300     05  PS-RUSH-SW                     PIC  X(01)  VALUE 'N'.    01230099
012400         88  PS-NO-RUSH                             VALUE 'N'.    01240099
012500         88  PS-DISPLAY-RUSH                        VALUE 'Y'.    01250099
012600     05  PS-RESET-LINES-SW              PIC  X(01)  VALUE 'Y'.    01260099
012700         88  PS-NO-RESET-LINES                      VALUE 'N'.    01270099
012800         88  PS-RESET-LINES                         VALUE 'Y'.    01280099
012900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01290099
013000         88  PS-NO-ERROR                            VALUE 'Y'.    01300099
013100         88  PS-ERROR                               VALUE 'N'.    01310099
013200     05  PS-TICK-PLACE-SW               PIC  X(01)  VALUE 'N'.    01320099
013300         88  PS-NOT-A-VALID-TICK-PLACE              VALUE 'N'.    01330099
013400         88  PS-VALID-TICK-PLACE                    VALUE 'Y'.    01340099
013500     05  PS-VALID-QUANTITY-SW           PIC  X(01)  VALUE 'N'.    01350099
013600         88  PS-NOT-A-VALID-QUANTITY                VALUE 'N'.    01360099
013700         88  PS-VALID-QUANTITY                      VALUE 'Y'.    01370099
014100     05  PS-TICK-TYPE-SW                PIC  X(01)  VALUE 'N'.    01410099
014200         88  PS-NOT-A-VALID-TICK-TYPE               VALUE 'N'.    01420099
014300         88  PS-VALID-TICK-TYPE                     VALUE 'Y'.    01430099
014400     05  PS-TICK-FMT-SW                 PIC  X(01)  VALUE 'N'.    01440099
014500         88  PS-NOT-A-VALID-TICK-FMT                VALUE 'N'.    01450099
014600         88  PS-VALID-TICK-FMT                      VALUE 'Y'.    01460099
014700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01470099
014800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01480099
014900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01490099
015300     05  PS-ADDRESS-CURSOR-SW           PIC  X(01)  VALUE 'N'.    01530099
015400         88  PS-END-OF-ADDR-CURSOR                  VALUE 'Y'.    01540099
015500         88  PS-NOT-END-OF-ADDR-CURSOR              VALUE 'N'.    01550099
015600*                                                                 01560099
015700 01  PV-PROGRAM-VARIABLES.                                        01570099
015800     05  PV-OPTION-BLOCK                PIC  X(03).               01580099
015900         88 PV-VALID-OPTION-BLOCK                                 01590099
016000            VALUE 'GWP', '2PC', '3PC', '4PC', '5PC', 'N/A'.       01600099
016100     05  PV-REASON-COUNT                PIC S9(09) COMP.          01610099
016200     05  PV-REQUEST-CMNT-ID             PIC S9(09) COMP.          01620099
016300     05  PV-SHIPT-CMNT-ID               PIC S9(09) COMP.          01630099
016400     05  PV-TEMP-ATTRIBUTE              PIC  X(01).               01640099
016500     05  PV-TEMP-COLOR                  PIC  X(01).               01650099
016600     05  PV-TEMP-HILIGHT                PIC  X(01).               01660099
017500     05  PV-DISPLAY-QTY                 PIC  ZZZZ,ZZ9.            01750099
017600     05  PV-DISPLAY-COMP                PIC  9(09).               01760099
017700     05  PV-LNE-RQST-IND                PIC  X(01).               01770099
017800         88  PV-LNE-ON-RQST             VALUE '*'.                01780099
017900         88  PV-LNE-OFF-RQST            VALUE ' '.                01790099
018100     05  PV-VENDOR-DUE-DATE             PIC  X(10) VALUE SPACES.  01810099
018200     05  PV-VENDOR-CAN-DATE-DEFAULT     PIC  X(10) VALUE SPACES.  01820099
018300     05  PV-VENDOR-CAN-DATE             PIC  X(10) VALUE SPACES.  01830099
018500     05  PV-DATE-ISO.                                             01850099
018600         10  PV-DATE-CC-ISO             PIC  X(02).               01860099
018700         10  PV-DATE-YY-ISO             PIC  X(02).               01870099
018800         10  PV-DATE-DASH1              PIC  X VALUE '-'.         01880099
018900         10  PV-DATE-MM-ISO             PIC  X(02).               01890099
019000         10  PV-DATE-DASH2              PIC  X VALUE '-'.         01900099
019100         10  PV-DATE-DD-ISO             PIC  X(02).               01910099
019600     05  PV-DATE-USA.                                             01960099
019700         10  PV-DATE-MM-USA             PIC  X(02).               01970099
019800         10  PV-DATE-SLASH1             PIC  X VALUE '/'.         01980099
019900         10  PV-DATE-DD-USA             PIC  X(02).               01990099
020000         10  PV-DATE-SLASH2             PIC  X VALUE '/'.         02000099
020100         10  PV-DATE-CC-USA             PIC  X(02).               02010099
020200         10  PV-DATE-YY-USA             PIC  X(02).               02020099
020400     05  PV-TIMESTAMP           PIC X(26).                        02040099
020500     05  PV-TIMESTAMP-SPLIT.                                      02050099
020600         10  FILLER             PIC X(14).                        02060099
020700         10  PV-MINUTE          PIC X(02).                        02070099
020800         10  FILLER             PIC X(02).                        02080099
020900         10  PV-SECOND          PIC X(01).                        02090099
021000         10  FILLER             PIC X(01).                        02100099
021100         10  PV-NANOSEC-1-3     PIC X(03).                        02110099
021200         10  PV-NANOSEC-4-6     PIC X(03).                        02120099
021400     05  PV-RANDOM-KEY          PIC 9(09).                        02140099
021500     05  FILLER REDEFINES PV-RANDOM-KEY.                          02150099
021600         10  PV-RND-NANOSEC-4-6 PIC X(03).                        02160099
021700         10  PV-RND-NANOSEC-1-3 PIC X(03).                        02170099
021800         10  PV-RND-MINUTE      PIC X(02).                        02180099
021900         10  PV-RND-SECOND      PIC X(01).                        02190099
022800     05  PV-PO-LINE-NBR                 PIC 9(03).                02281099
022900     05  PV-SUB                         PIC S9(04)  VALUE +0      02290099
023000                                                    COMP SYNC.    02300099
023100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02310099
023200                                                    COMP SYNC.    02320099
023300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02330099
023400                                                    COMP-3.       02340099
023900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02390099
024000                                                    COMP-3.       02400099
024100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02410099
024200                                                    COMP-3.       02420099
024300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02430099
024400                                                    COMP-3.       02440099
024700     05  PV-ERROR-ITEM-NUMBER           PIC S9(09)  VALUE +0      02470099
024800                                                    COMP-3.       02480099
024900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02490099
025000                                                    COMP SYNC.    02500099
025100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02510099
025200                                                    COMP SYNC.    02520099
025300     05  PV-ITEM                        PIC S9(04)  VALUE +0      02530099
025400                                                    COMP SYNC.    02540099
025500     05  PV-RSN-ITEM                    PIC S9(04)  VALUE +0      02550099
025600                                                    COMP SYNC.    02560099
025700     05  PV-RSN-QUEUE-ITEM              PIC S9(04)  VALUE +0      02570099
025800                                                    COMP SYNC.    02580099
025900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02590099
026000                                                    COMP SYNC.    02600099
026100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02610099
026200                                                    COMP SYNC.    02620099
026300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02630099
026400                                                    COMP SYNC.    02640099
026500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02650099
026600                                                    COMP SYNC.    02660099
026700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02670099
026800                                                    COMP SYNC.    02680099
026900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02690099
027000                                                    COMP SYNC.    02700099
027100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02710099
027200                                                    COMP SYNC.    02720099
027300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02730099
027400                                                    COMP SYNC.    02740099
027500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02750099
027600                                                    COMP SYNC.    02760099
027700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02770099
027800                                                    COMP SYNC.    02780099
028100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02810099
028200                                                    COMP SYNC.    02820099
029801     05  PV-STATE-PROV                  PIC  X(20).               02980199
029810     05  PV-COUNTRY                     PIC  X(20).               02981099
029820     05  PV-DPKUT410-COMMAREA           PIC  X(01)   VALUE SPACES.02982099
029830                                                                  02983099
029900******************************************************************02990000
030000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03000000
030100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03010000
030200**  APPLICATION-SPECIFIC COMMAREA.                              **03020000
030300******************************************************************03030000
030400 01  LQW-LIST-QUEUE-WORK-AREA.                                    03040000
030500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03050000
030600     05  LQW-ITEM-ENTRIES               OCCURS 05 TIMES           03060099
030700                                        INDEXED BY LQW-IDX.       03070000
030800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03080000
030900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03090000
031000         10  LQW-SELECTED-SW            PIC  X(01).               03100000
031100             88  LQW-SELECT                         VALUE 'S'.    03110000
031200             88  LQW-DESELECT                       VALUE ' '.    03120000
031300         10  LQW-LNE-RQST-IND           PIC  X(01).               03130000
031400             88  LQW-LNE-ON-RQST        VALUE '*'.                03140000
031500             88  LQW-LNE-OFF-RQST       VALUE ' '.                03150000
031600         10  LQW-DB2-LNE-RQST-IND       PIC  X(01).               03160000
031700             88  LQW-DB2-LNE-ON-RQST    VALUE '*'.                03170000
031800             88  LQW-DB2-LNE-OFF-RQST   VALUE ' '.                03180000
031900         10  LQW-UPDATE-IND             PIC  X(01).               03190000
032000             88  LQW-LNE-UPDATE         VALUE 'Y'.                03200000
032100             88  LQW-NO-LNE-UPDATE      VALUE 'N'.                03210000
032200         10  LQW-PO-LNE-NBR             PIC S9(09) COMP.          03220000
032300         10  LQW-APP-PO-LNE-NBR         PIC S9(09) COMP.          03230000
032300         10  LQW-MAJ-CLASS              PIC  9(02).               03250099
032400         10  LQW-SUB-CLASS              PIC  9(02).               03250199
032600         10  LQW-SKU-NBR                PIC  X(08).               03261099
032700         10  LQW-SKU-DESCRIPTION        PIC  X(15).               03270099
032800         10  LQW-STICKER-NBR            PIC  9(03).               03280099
032900         10  LQW-TICKET-TYPE            PIC  X(17).               03290099
033000         10  LQW-TTYPE-MOD              PIC  X(01).               03300000
033100             88 LQW-NO-TTYPE-MOD             VALUE 'N'.           03310000
033200             88 LQW-TTYPE-MOD                VALUE 'Y'.           03320000
033300         10  LQW-TTYPE-PRINT            PIC  X(01).               03330040
033400             88 LQW-TTYPE-PRINT-NO           VALUE 'N'.           03340040
033500             88 LQW-TTYPE-PRINT-YES          VALUE 'Y'.           03350040
034200         10  LQW-PO-QUANTITY            PIC  9(08).               03360099
034300         10  LQW-RQST-QUANTITY          PIC  9(08).               03361099
033700         10  LQW-TICKET-PLACE           PIC  X(04).               03370000
033800         10  LQW-TPLACE-MOD             PIC  X(01).               03380000
033900             88 LQW-NO-TPLACE-MOD            VALUE 'N'.           03390000
034000             88 LQW-TPLACE-MOD               VALUE 'Y'.           03400000
034100         10  LQW-OPTION-BLOCK           PIC  X(03).               03410099
034400                                                                  03440000
034600*---------------------------------------------------------------* 03460000
034700*  RECORD LAYOUT FOR THE LINE SELECTION TEMP STORAGE QUEUE.     * 03470000
034800*---------------------------------------------------------------* 03480000
035000     COPY VLWS006.                                                03500099
035100                                                                  03510000
035300*---------------------------------------------------------------* 03530000
035400*  RECORD LAYOUT FOR THE ADDRESS TEMP STORAGE QUEUE.            * 03540000
035500*---------------------------------------------------------------* 03550000
035700     COPY VLWS007.                                                03570099
035800                                                                  03580000
036000*---------------------------------------------------------------* 03600000
036100*  RECORD LAYOUT FOR THE REASON CODE TEMP STORAGE QUEUE.        * 03610000
036200*---------------------------------------------------------------* 03620000
036400     COPY VLWS008.                                                03640099
036500                                                                  03650000
036700*---------------------------------------------------------------* 03670000
036800*    MAP LAYOUT                                                 * 03680000
036900*---------------------------------------------------------------* 03690000
037100     COPY VLKM583.                                                03710000
037200*                                                                 03720000
037300 01  MR-OCCURS-LAYOUT                   REDEFINES  VL583AO.       03730000
037400     05  FILLER                         PIC X(577).               03740099
037500     05  MR-SCROLL-AREA                 OCCURS 05 TIMES.          03750099
037600         10  MR-SELECTL                 PIC S9(04) COMP.          03760000
037700         10  MR-SELECTA                 PIC  X(01).               03770000
037800         10  MR-SELECTC                 PIC  X(01).               03780000
037900         10  MR-SELECTH                 PIC  X(01).               03790000
038000         10  MR-SELECTI                 PIC  X(01).               03800000
038100                                                                  03810000
038200         10  FILLER                     PIC  X(05).               03820000
038300         10  MR-LNE-RQST-IND            PIC  X(01).               03830000
038400         10  MR-PO-LINE-NBR             PIC  X(03).               03840000
038500                                                                  03850000
038600         10  MR-MAJ-CLASSL              PIC S9(04) COMP.          03860099
038600         10  MR-MAJ-CLASSA              PIC  X(01).               03861099
038600         10  MR-MAJ-CLASSC              PIC  X(01).               03862099
038600         10  MR-MAJ-CLASSH              PIC  X(01).               03863099
038700         10  MR-MAJ-CLASS               PIC  X(02).               03870099
038800                                                                  03880000
038600         10  MR-SUB-CLASSL              PIC S9(04) COMP.          03880199
038600         10  MR-SUB-CLASSA              PIC  X(01).               03880299
038600         10  MR-SUB-CLASSC              PIC  X(01).               03880399
038600         10  MR-SUB-CLASSH              PIC  X(01).               03880499
038700         10  MR-SUB-CLASS               PIC  X(02).               03880599
038800                                                                  03880699
038600         10  MR-SKU-NBRL                PIC S9(04) COMP.          03881099
038700         10  MR-SKU-NBRA                PIC  X(01).               03882099
038700         10  MR-SKU-NBRC                PIC  X(01).               03882199
038700         10  MR-SKU-NBRH                PIC  X(01).               03882299
038700         10  MR-SKU-NBR                 PIC  X(08).               03882599
038800                                                                  03883099
038900         10  MR-SKU-DESCL               PIC S9(04) COMP.          03890099
039000         10  MR-SKU-DESCA               PIC  X(01).               03900099
039000         10  MR-SKU-DESCC               PIC  X(01).               03901099
039000         10  MR-SKU-DESCH               PIC  X(01).               03902099
039000         10  MR-SKU-DESC                PIC  X(15).               03904099
039100                                                                  03910000
039200         10  MR-STICKER-NBRL            PIC S9(04) COMP.          03920099
039300         10  MR-STICKER-NBRA            PIC  X(01).               03930099
039300         10  MR-STICKER-NBRC            PIC  X(01).               03940099
039300         10  MR-STICKER-NBRH            PIC  X(01).               03941099
039300         10  MR-STICKER-NBR             PIC  X(03).               03942099
039400                                                                  03943099
039500         10  MR-TICKET-TYPEL            PIC S9(04) COMP.          03950000
039600         10  MR-TICKET-TYPEA            PIC  X(01).               03960000
039700         10  MR-TICKET-TYPEC            PIC  X(01).               03970000
039800         10  MR-TICKET-TYPEH            PIC  X(01).               03980000
039900         10  MR-TICKET-TYPE             PIC  X(17).               03990099
040000                                                                  04000000
040100         10  MR-QUANTITYL               PIC S9(04) COMP.          04010000
040200         10  MR-QUANTITYA               PIC  X(01).               04020000
040300         10  MR-QUANTITYC               PIC  X(01).               04030000
040400         10  MR-QUANTITYH               PIC  X(01).               04040000
040500         10  MR-QUANTITY                PIC  X(08).               04050000
040600                                                                  04060000
040700         10  MR-TICKET-PLACEL           PIC S9(04) COMP.          04070000
040800         10  MR-TICKET-PLACEA           PIC  X(01).               04080000
040900         10  MR-TICKET-PLACEC           PIC  X(01).               04090000
041000         10  MR-TICKET-PLACEH           PIC  X(01).               04100000
041100         10  MR-TICKET-PLACE            PIC  X(04).               04110000
041200                                                                  04120000
041300         10  MR-OPTION-BLOCKL           PIC S9(04) COMP.          04130099
041400         10  MR-OPTION-BLOCKA           PIC  X(01).               04140099
041500         10  MR-OPTION-BLOCKC           PIC  X(01).               04150099
041600         10  MR-OPTION-BLOCKH           PIC  X(01).               04160099
041700         10  MR-OPTION-BLOCK            PIC  X(03).               04170099
041800                                                                  04180099
042100*---------------------------------------------------------------* 04210000
042200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04220000
042300*---------------------------------------------------------------* 04230000
042500     COPY DPWS015.                                                04250099
042600                                                                  04260000
042700*---------------------------------------------------------------* 04270000
042800*    FUNCTION KEYS COPYBOOK.                                    * 04280000
042900*---------------------------------------------------------------* 04290000
043100     COPY DPWS016.                                                04310099
043200                                                                  04320000
043300*---------------------------------------------------------------* 04330000
043400*    NUMERIC EDIT LAYOUT.                                       * 04340000
043500*---------------------------------------------------------------* 04350000
043700     COPY DPWS010I.                                               04370099
043800                                                                  04380099
043900*---------------------------------------------------------------* 04390000
044000*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04400099
044100*---------------------------------------------------------------* 04410000
044300     COPY DPWS030.                                                04430099
CICS       COPY DPWS930.                                                04431099
044400                                                                  04440000
044500*----------------------------------------------------------------*04450000
044600*  WORK AREA PASSED IN CALL TO DPKUT500                          *04460000
044700*----------------------------------------------------------------*04470000
044800     COPY DPWS500.                                                04480099
044900                                                                  04490000
045001******************************************************************04500199
045002*  WORKING STORAGE AREA FOR COUNTRY AND STATE RETRIEVAL           04500299
045003******************************************************************04500399
045004     COPY DPWS410.                                                04500499
045010                                                                  04501099
045100*---------------------------------------------------------------* 04510000
045200*    STANDARD COMMAREA.                                         * 04520000
045300*---------------------------------------------------------------* 04530000
045500     COPY DPWS020.                                                04550099
045600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04560000
045700                                                                  04570000
045800*---------------------------------------------------------------* 04580000
045900* INTER-APPLICATION COMMAREA.                                   * 04590000
046000*   VLWS005 - IS THE INPUT LAYOUT WHEN COMING FROM THE PURCHASE * 04600000
046100*             ORDER ADD/UPDATE PROGRAM (POKCS003)               * 04610000
046200*   VLWS005 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04620000
046300*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 04630000
046400*---------------------------------------------------------------* 04640000
046600         10  INTER-APPL-COMM-AREA       PIC X(200).               04660000
046700     COPY VLWS005.                                                04670099
046800*---------------------------------------------------------------* 04680000
046900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04690000
047000*---------------------------------------------------------------* 04700000
047100         10  ASC-SPECIFIC-COMMAREA.                               04710000
047200             15  ASC-ENT-ID                   PIC S9(09) COMP.    04720099
047400             15  ASC-DEPT-NBR                 PIC X(03).          04740099
047500             15  ASC-PO-TYPE-CDE              PIC X(02).          04750099
047600                 88 ASC-IMPORT-PO                    VALUE 'IM'.  04760099
047700                                                                  04770000
047800             15  ASC-SCREEN-FIELDS.                               04780000
047900                 20  ASC-PO-NUMBER            PIC S9(09) COMP.    04790099
048000                 20  ASC-SKU-DEPT             PIC  X(03).         04800099
048100                 20  ASC-PO-REQ-NBR           PIC S9(09) COMP.    04810099
048300                 20  ASC-REQ-TYP-CDE          PIC  X(01).         04830099
048400                 20  ASC-REQ-TYP-CDE-DESC     PIC  X(10).         04840099
048500                 20  ASC-PRTY-STAT-CDE        PIC S9(04) COMP.    04850099
048700                 20  ASC-REQ-STAT-CDE         PIC X(01).          04870099
048800                     88 ASC-REQ-STAT-RUSH            VALUE 'R'.   04880000
048900                     88 ASC-REQ-STAT-HOLD            VALUE 'H'.   04890000
049000                     88 ASC-REQ-STAT-CANCELLED       VALUE 'C'.   04900000
049100                     88 ASC-REQ-STAT-ACTIVE          VALUE 'A'.   04910000
049200                     88 ASC-REQ-STAT-PRINTED         VALUE 'P'.   04920000
049300                     88 ASC-REQ-STAT-SHIPPED         VALUE 'S'.   04930000
049400                     88 ASC-REQ-STAT-INPROC          VALUE 'I'.   04940000
049500                 20  ASC-CURRENT-DATE         PIC  X(10).         04950099
049600                 20  ASC-REQUEST-DATE         PIC  X(10).         04960099
049700                 20  ASC-VENDOR-DFLT-DUE-DATE PIC  X(10).         04970099
049800                 20  ASC-VENDOR-DUE-DATE      PIC  X(10).         04980099
049900                 20  ASC-VENDOR-CAN-DATE      PIC  X(10).         04990099
050000                 20  ASC-PRINT-DUE-DATE       PIC  X(10).         05000099
050100                 20  ASC-VND-NAME             PIC  X(40).         05010099
050200                 20  ASC-ADDR-COUNTRY         PIC  X(20).         05020099
050300                 20  ASC-ADDR-SEQ-NBR         PIC S9(04) COMP.    05030099
050500                 20  ASC-ADDR-LINE-TABLE.                         05050000
050600                     25  FILLER OCCURS 08 TIMES                   05060000
050700                         INDEXED BY ASC-ADDR-IDX.                 05070000
050800                         30  ASC-ADDR-LINE        PIC  X(40).     05080099
050900                 20  ASC-DEFAULT-TICKET-TYPE      PIC  X(20).     05090099
051000                 20  ASC-DEFAULT-TTYPE-PRINT-SW   PIC  X(01).     05100099
051100                     88 ASC-DEFAULT-TTYPE-PRINT-NO   VALUE 'N'.   05110040
051200                     88 ASC-DEFAULT-TTYPE-PRINT-YES  VALUE 'Y'.   05120040
051300                 20  ASC-DEFAULT-TICKET-PLACE     PIC  X(04).     05130099
051400                 20  ASC-DEFAULT-OPTION-BLOCK     PIC  X(03).     05140099
051500                 20  ASC-DEFAULT-QUANTITY         PIC  X(08).     05150099
051600                 20  ASC-DEFAULT-QUANTITY-N REDEFINES             05160000
051700                     ASC-DEFAULT-QUANTITY         PIC  9(08).     05170099
051800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                05180099
051900                 20  ASC-BLOCK-MODIFIED-SW        PIC  X(01).     05190099
052000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   05200000
052100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   05210000
052200                                                                  05220000
052300                 20  ASC-ITEM-ARRAY.                              05230000
052400                     25  ASC-ITEM-ENTRIES OCCURS 05 TIMES.        05240099
052500                         30  ASC-LIST-ITEM-NUMBER                 05250000
052600                                                PIC S9(09) COMP-3.05260099
052800                         30  ASC-TEMP-SELECTED-SW PIC  X(01).     05280099
052900                             88  ASC-VALID-SELECT    VALUE ' '    05290000
053000                                                           'S'    05300000
053100                                                           'B'    05310000
053200                                                           'E'.   05320000
053300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05330000
053400                             88  ASC-TEMP-SELECT     VALUE 'S'.   05340000
053500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05350000
053600                             88  ASC-TEMP-END        VALUE 'E'.   05360000
053700                         30  ASC-SELECTED-SW      PIC  X(01).     05370099
053800                             88  ASC-NO-SELECT       VALUE ' '.   05380000
053900                             88  ASC-SELECT          VALUE 'S'.   05390000
054000                             88  ASC-BEGIN           VALUE 'B'.   05400000
054100                             88  ASC-END             VALUE 'E'.   05410000
054200                         30  ASC-LNE-RQST-IND        PIC  X(01).  05420000
054300                             88  ASC-LNE-ON-RQST     VALUE '*'.   05430000
054400                             88  ASC-LNE-OFF-RQST    VALUE ' '.   05440000
054500                         30  ASC-DB2-LNE-RQST-IND PIC  X(01).     05450099
054600                             88  ASC-DB2-LNE-ON-RQST VALUE '*'.   05460000
054700                             88  ASC-DB2-LNE-OFF-RQST             05470000
054800                                                     VALUE ' '.   05480000
054900                         30  ASC-UPDATE-IND       PIC  X(01).     05490099
055000                             88  ASC-LNE-UPDATE      VALUE 'Y'.   05500000
055100                             88  ASC-NO-LNE-UPDATE   VALUE 'N'.   05510000
055200                         30  ASC-PO-LINE-NBR      PIC S9(09)      05520099
055300                                                         COMP.    05530000
055400                         30  ASC-APP-PO-LINE-NBR  PIC S9(09)      05540099
055500                                                         COMP.    05550000
055700                         30  ASC-MAJ-CLASS        PIC  9(02).     05570099
055700                         30  ASC-SUB-CLASS        PIC  9(02).     05570199
056100                         30  ASC-SKU-NBR          PIC  9(08).     05610099
056100                         30  ASC-SKU-DESC         PIC  X(15).     05611099
056200                         30  ASC-STICKER-NBR      PIC  9(03).     05612099
056300                         30  ASC-TICKET-TYPE      PIC  X(17).     05630099
056400                         30  ASC-TTYPE-MOD-SW     PIC  X(01).     05640099
056500                             88 ASC-NO-TTYPE-MOD     VALUE 'N'.   05650000
056600                             88 ASC-TTYPE-MOD        VALUE 'Y'.   05660000
056700                         30  ASC-TTYPE-PRINT-SW   PIC  X(01).     05670099
056800                             88 ASC-TTYPE-PRINT-NO   VALUE 'N'.   05680040
056900                             88 ASC-TTYPE-PRINT-YES  VALUE 'Y'.   05690040
057500                         30  ASC-PO-QUANTITY.                     05691099
057600                             35  ASC-PO-QUANTITY-N PIC  9(08).    05692099
057700                         30  ASC-RQST-QUANTITY.                   05693099
057800                             35  ASC-RQST-QUANTITY-N PIC  9(08).  05694099
057000                         30  ASC-TICKET-PLACE     PIC  X(04).     05700099
057100                         30  ASC-TPLACE-MOD-SW    PIC  X(01).     05710099
057200                             88 ASC-NO-TPLACE-MOD    VALUE 'N'.   05720000
057300                             88 ASC-TPLACE-MOD       VALUE 'Y'.   05730000
057400                         30  ASC-OPTION-BLOCK      PIC  X(03).    05740099
057900                                                                  05790000
058000             15  ASC-REQUEST-LINE-COUNT         PIC S9(09) COMP.  05800000
058100             15  ASC-FORMAT-INDICATOR           PIC  X(01) .      05810000
058200                 88 ASC-CRIT-SPEC-FORMAT-IND       VALUE '1',     05820099
058300                                                      '5', '7'.   05830000
058400                 88 ASC-LIST-FORMAT-IND            VALUE '2', '3',05840099
058500                                                      '6'.        05850000
058600                 88 ASC-UPDATE-FORMAT-IND          VALUE '1', '2',05860099
058700                                                      '5'.        05870000
058800                 88 ASC-DELETE-FORMAT-IND          VALUE '3'.     05880099
058900                 88 ASC-ADD-FORMAT-IND             VALUE '6',     05890099
059000                                                      '7'.        05900000
059100                 88 ASC-RESUBMIT-FORMAT-IND        VALUE '6'.     05910099
059200                                                                  05920000
059300             15  ASC-RETURN-FORMAT-INDICATOR    PIC  X(01) .      05930000
059400                 88 ASC-RETURN-FROM-TPLACE         VALUE '1'.     05940099
059500                 88 ASC-RETURN-FROM-REASON         VALUE '2'.     05950099
059600                 88 ASC-RETURN-FROM-TKTTYPE        VALUE '3'.     05960099
059700             15  ASC-REASON-CODE-INDICATOR      PIC  X(01) .      05970000
059800                 88 ASC-REASON-CODES-EXIST         VALUE 'Y'.     05980099
059900                 88 ASC-REASON-CODES-DONT-EXIST    VALUE 'N'.     05990099
060000             15  ASC-ACTION-INDICATOR           PIC  X(01) .      06000000
060100                 88 ASC-ADD-PENDING                VALUE 'A' 'D'. 06010099
060200                 88 ASC-ADD-NEW-REQ                VALUE 'A'.     06020099
060300                 88 ASC-RESUB-REQ                  VALUE 'D' 'R'. 06030099
060400                 88 ASC-RESUB-REASON-PENDING       VALUE 'R'.     06040099
060500                 88 ASC-RESUB-REASON-COMPLETE      VALUE 'D'.     06050099
060600                 88 ASC-ADD-COMPLETE               VALUE 'C'.     06060099
060700                 88 ASC-UPDATE-REG                 VALUE 'U'.     06070099
060800                 88 ASC-UPDATE-RESUB               VALUE 'F'.     06080099
060900             15  ASC-ADDR-IND                   PIC  X(01) .      06090000
061000                 88 ASC-ADDR-DOESNT-EXIST          VALUE 'N'.     06100099
061100                 88 ASC-ADDR-INVALID               VALUE 'I'.     06110099
061200                 88 ASC-ADDR-EXISTS                VALUE 'Y'.     06120099
061300             15  ASC-BLK-SUB                 PIC S9(04) COMP SYNC.06130099
061600             15  ASC-ITEM-SUB                PIC S9(04) COMP SYNC.06160099
061900             15  ASC-SEL-SUB                 PIC S9(04) COMP.     06190099
062100             15  ASC-SEL-ITEM                PIC S9(04) COMP.     06210099
062300             15  ASC-USE-SELECTION-QUEUE-IND PIC  X(01).          06230099
062400                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 06240000
062500             15  ASC-NUMBER-OF-ITEMS-READ    PIC S9(09) COMP-3.   06250099
062700             15  ASC-NUMBER-OF-SELECTED-ITEMS  PIC S9(09) COMP-3. 06270099
062900             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(05) COMP-3.   06290099
063100             15  ASC-NUMBER-OF-RSN-CODES     PIC S9(09) COMP-3.   06310099
063300             15  ASC-NUMBER-OF-RSN-TS-ITEMS  PIC S9(05) COMP-3.   06330099
063500             15  ASC-ITEMS-DISPLAYED         PIC S9(03) COMP-3.   06350099
063700             15  ASC-ITEM-AT-TOP-OF-PANEL    PIC S9(09) COMP-3.   06370099
063900             15  ASC-ITEM-AT-BOT-OF-PANEL    PIC S9(09) COMP-3.   06390099
064100             15  ASC-ADDRESS-COUNT           PIC S9(04) COMP SYNC.06410099
064400             15  ASC-CURRENT-ADDR-ITEM       PIC S9(04) COMP SYNC.06440099
064700             15  ASC-HIGHEST-BLOCK-WRITTEN   PIC S9(04) COMP SYNC.06470099
065000             15  ASC-START-OF-SELECTED-RANGE PIC S9(09) COMP-3.   06500099
065200             15  ASC-END-OF-SELECTED-RANGE   PIC S9(09) COMP-3.   06520099
065400             15  ASC-ITEMS-LEFT-INDICATOR    PIC  X(01).          06540099
065500                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   06550000
065600                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   06560000
065700             15  ASC-TEMP-QUEUE-UPDATE-SW    PIC  X(01).          06570099
065800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   06580000
065900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   06590000
066000             15  ASC-LIST-QUEUE-NAME.                             06600000
066100                 20  ASC-LIST-TERM-ID        PIC  X(04).          06610099
066200                 20  ASC-LIST-TASK-NUMBER    PIC S9(05) COMP-3.   06620099
066400                 20  ASC-LIST-SEQ            PIC  9(01).          06640099
066500             15  ASC-ADDR-QUEUE-NAME.                             06650000
066600                 20  ASC-ADDR-TERM-ID        PIC  X(04).          06660099
066700                 20  ASC-ADDR-TASK-NUMBER    PIC S9(05) COMP-3.   06670099
066900                 20  ASC-ADDR-SEQ            PIC  9(01).          06690099
067000             15  ASC-SEL-QUEUE-NAME-IN       PIC  X(8).           06700099
067100             15  ASC-SEL-QUEUE-NAME-OUT.                          06710000
067200                 20  ASC-SEL-TERM-ID         PIC  X(04).          06720099
067300                 20  ASC-SEL-TASK-NUMBER     PIC S9(05) COMP-3.   06730099
067500                 20  ASC-SEL-SEQ             PIC  9(01).          06750099
067600             15  ASC-RSN-QUEUE-NAME.                              06760000
067700                 20  ASC-RSN-TERM-ID         PIC  X(04).          06770099
067800                 20  ASC-RSN-TASK-NUMBER     PIC S9(05) COMP-3.   06780099
068000                 20  ASC-RSN-SEQ             PIC  9(01).          06800099
068100             15  ASC-START-ITEM-REQUEST.                          06810000
068200                 20  ASC-START-ITEM-REQUEST-N  PIC  9(05).        06820099
068300                                                                  06830099
068400*---------------------------------------------------------------* 06840000
068500*    ABEND PROCESSING COPYBOOK.                                 * 06850000
068600*---------------------------------------------------------------* 06860000
068800     COPY DPWS013.                                                06880099
068900                                                                  06890000
069100*---------------------------------------------------------------* 06910000
069200*    DB2 AREA FOR THE PURCHASE ORDER ITEM TABLE                 * 06920000
069300*---------------------------------------------------------------* 06930000
069400     EXEC SQL                                                     06940000
069500          INCLUDE TPURITM                                         06950000
069600     END-EXEC.                                                    06960000
069700                                                                  06970099
069800*---------------------------------------------------------------* 06980000
069900*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 06990000
070000*---------------------------------------------------------------* 07000000
070100     EXEC SQL                                                     07010000
070200          INCLUDE TPURCHS                                         07020000
070300     END-EXEC.                                                    07030000
070400                                                                  07040099
070500*---------------------------------------------------------------* 07050000
070600*    DB2 AREA FOR THE VENDOR AGREEMENT TABLE                    * 07060047
070700*---------------------------------------------------------------* 07070000
070800     EXEC SQL                                                     07080000
070900          INCLUDE TVNDAGR                                         07090047
071000     END-EXEC.                                                    07100000
071100                                                                  07110099
071200*---------------------------------------------------------------* 07120047
071300*    DB2 AREA FOR THE PO AGREEMENT TABLE                        * 07130047
071400*---------------------------------------------------------------* 07140047
071500     EXEC SQL                                                     07150047
071600          INCLUDE TPOAGMT                                         07160047
071700     END-EXEC.                                                    07170047
071800                                                                  07180099
074700*---------------------------------------------------------------* 07470000
074800*    DB2 AREA FOR THE PO PLAN SHIPMENT TABLE                    * 07480000
074900*---------------------------------------------------------------* 07490000
075000     EXEC SQL                                                     07500000
075100          INCLUDE TPLNSHP                                         07510000
075200     END-EXEC.                                                    07520000
075300                                                                  07530099
075400*---------------------------------------------------------------* 07540000
075500*    DB2 AREA FOR THE ENTERPRISE REPRESENTATIVE TABLE           * 07550000
075600*---------------------------------------------------------------* 07560000
075700     EXEC SQL                                                     07570000
075800          INCLUDE TENTREP                                         07580000
075900     END-EXEC.                                                    07590000
076000                                                                  07600099
076100*---------------------------------------------------------------* 07610000
076200*    DB2 AREA FOR THE BUISNESS LOCATION TABLE                   * 07620000
076300*---------------------------------------------------------------* 07630000
076400     EXEC SQL                                                     07640000
076500          INCLUDE TBUSLOC                                         07650000
076600     END-EXEC.                                                    07660000
076700                                                                  07670099
076800*---------------------------------------------------------------* 07680000
076900*    DB2 AREA FOR THE PRETICKET REQUEST HEADER TABLE            * 07690000
077000*---------------------------------------------------------------* 07700000
077100     EXEC SQL                                                     07710000
077200          INCLUDE TPTKREQ                                         07720000
077300     END-EXEC.                                                    07730000
077400                                                                  07740099
078900*---------------------------------------------------------------* 07890000
079000*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 07900000
079100*---------------------------------------------------------------* 07910000
079200     EXEC SQL                                                     07920000
079300          INCLUDE TENTNME                                         07930000
079400     END-EXEC.                                                    07940000
079500                                                                  07950099
079600*---------------------------------------------------------------* 07960046
079700*    DB2 AREA FOR THE TICKET FORMAT TABLE                       * 07970046
079800*---------------------------------------------------------------* 07980046
079900     EXEC SQL                                                     07990046
080000          INCLUDE TTKTFMT                                         08000046
080100     END-EXEC.                                                    08010046
080200                                                                  08020099
080300*---------------------------------------------------------------* 08030000
080400*    DB2 AREA FOR THE PRETICKET REQUEST LINE ITEM TABLE         * 08040000
080500*---------------------------------------------------------------* 08050000
080600     EXEC SQL                                                     08060000
080700          INCLUDE TPTKLNE                                         08070000
080800     END-EXEC.                                                    08080000
080900                                                                  08090099
081000*---------------------------------------------------------------* 08100000
081100*    DB2 AREA FOR THE PRETICKET REQUEST COMMENT TABLE           * 08110000
081200*---------------------------------------------------------------* 08120000
081300     EXEC SQL                                                     08130000
081400          INCLUDE TPTKCMT                                         08140000
081500     END-EXEC.                                                    08150000
081600                                                                  08160099
081700*---------------------------------------------------------------* 08170000
081800*    DB2 AREA FOR THE PRETIC RQST REASON CODE ASSOCIATION TABLE * 08180000
081900*---------------------------------------------------------------* 08190000
082000     EXEC SQL                                                     08200000
082100          INCLUDE TPTKRSN                                         08210000
082200     END-EXEC.                                                    08220000
082300                                                                  08230099
082400*---------------------------------------------------------------* 08240000
082500*    DB2 AREA FOR THE PRETICKET PLACEMENT DESCRIPTION TABLE     * 08250000
082600*---------------------------------------------------------------* 08260000
082700     EXEC SQL                                                     08270000
082800          INCLUDE TPLDESC                                         08280000
083500     END-EXEC.                                                    08281099
082900                                                                  08290099
082400*---------------------------------------------------------------* 08291099
082500*    DB2 AREA FOR THE XLT_SKU TABLE                             * 08292099
082600*---------------------------------------------------------------* 08293099
082700     EXEC SQL                                                     08294099
082800          INCLUDE XLT00003                                        08295099
083500     END-EXEC.                                                    08296099
082900                                                                  08297099
082400*---------------------------------------------------------------* 08298099
082500*    DB2 AREA FOR THE XLT_VND_STYL TABLE                        * 08299099
082600*---------------------------------------------------------------* 08299199
082700     EXEC SQL                                                     08299299
082800          INCLUDE XLT00004                                        08299399
083500     END-EXEC.                                                    08299499
082900                                                                  08299599
083000*---------------------------------------------------------------* 08300000
083100*    DB2 AREA FOR COMMUNICATIONS                                * 08310000
083200*---------------------------------------------------------------* 08320000
083300     EXEC SQL                                                     08330000
083400          INCLUDE SQLCA                                           08340000
083500     END-EXEC.                                                    08350000
083600                                                                  08360000
083800*---------------------------------------------------------------* 08380000
083900* PO_PRETICK_CURSOR - GETS ALL THE DETAIL INFO FROM THE PURCHASE *08390000
084000* ORDER AND THE PRETICKET REQUEST DETAIL TABLE                  * 08400000
084100*---------------------------------------------------------------* 08410000
084300     EXEC SQL                                                     08430000
084400          DECLARE PO_PRETICK_CURSOR CURSOR                        08440000
084500          FOR SELECT                                              08450000
084600                A.PO_LNE_NBR                                      08460000
084700              , A.APP_PO_LNE_NBR                                  08470000
084800              , E.DEPT_NBR                                        08480099
084900              , E.MAJ_CL_NBR                                      08490099
084900              , E.SUB_CL_NBR                                      08500099
085100              , B.SKU_NBR                                         08510099
085100              , B.SKU_DESC                                        08511099
085200              , C.TKT_DESC                                        08520000
085300              , E.STKR_NBR                                        08530099
085400              , C.OPT_BLCK_CDE                                    08540000
085500              , C.TKT_PLCMNT_CDE                                  08550000
085600              , A.UNT_QTY                                         08560000
085700              , C.TKT_QTY                                         08570000
085800              , '*'                                               08580000
085800              , E.TKT_TYP_DESC                                    08581099
085900          FROM                                                    08590000
086000                TPURITM A                                         08600000
086100              , XLT_SKU B                                         08610099
086200              , TPTKLNE C                                         08620000
086300              , TPTKREQ D                                         08630000
086301              , XLT_VND_STYL E                                    08631099
086400          WHERE                                                   08640000
086500                A.PO_NBR         = :DK-PO-NUMBER                  08650000
086600            AND A.PO_NBR         = D.PO_NBR                       08660000
086700            AND D.PO_REQ_NBR     = :DK-PO-REQ-NBR                 08670000
086800            AND D.PO_REQ_NBR     = C.PO_REQ_NBR                   08680000
086900            AND A.VER_STATUS_CDE = 'A'                            08690000
087000            AND A.ITM_NBR        = B.ITM_NBR                      08700099
087100            AND A.PO_LNE_NBR     = C.PO_LNE_NBR                   08710000
087101            AND B.STYL_ID        = E.STYL_ID                      08711099
087200          UNION ALL                                               08720000
087300          SELECT                                                  08730000
087400                A.PO_LNE_NBR                                      08740000
087500              , A.APP_PO_LNE_NBR                                  08750000
087600              , D.DEPT_NBR                                        08760099
087700              , D.MAJ_CL_NBR                                      08770099
087700              , D.SUB_CL_NBR                                      08771099
087700              , B.SKU_NBR                                         08780099
087900              , B.SKU_DESC                                        08790000
088000              , ' '                                               08800000
088100              , D.STKR_NBR                                        08810099
088200              , ' '                                               08820000
088300              , ' '                                               08830000
088400              , A.UNT_QTY                                         08840000
088500              , A.UNT_QTY                                         08850000
088600              , ' '                                               08860000
088600              , D.TKT_TYP_DESC                                    08861099
088700          FROM                                                    08870000
088800                TPURITM A                                         08880000
088900              , XLT_SKU B                                         08890099
088900              , XLT_VND_STYL D                                    08891099
089000          WHERE                                                   08900000
089100                A.PO_NBR         = :DK-PO-NUMBER                  08910000
089200            AND A.VER_STATUS_CDE = 'A'                            08920000
089300            AND A.STATUS_CDE    <> 'CA'                           08930099
089400            AND A.ITM_NBR        = B.ITM_NBR                      08940099
089400            AND B.STYL_ID        = D.STYL_ID                      08941099
089500            AND NOT EXISTS                                        08950000
089600            (SELECT 1                                             08960000
089700             FROM TPTKLNE C                                       08970000
089800             WHERE C.PO_REQ_NBR = :DK-PO-REQ-NBR                  08980000
089900               AND A.PO_LNE_NBR = C.PO_LNE_NBR )                  08990000
090000          ORDER BY                                                09000000
090100                1                                                 09010000
090200     END-EXEC.                                                    09020000
090300                                                                  09030000
090500*---------------------------------------------------------------* 09050000
090600* PRETIC_ADDR_CURSOR - GET ALL THE PRETICKET ADDRESS FOR THIS   * 09060000
090700*---------------------------------------------------------------* 09070000
090900     EXEC SQL                                                     09090000
091000          DECLARE ADDRESS_CURSOR CURSOR                           09100000
091100          FOR SELECT                                              09110000
091200               A.SEQ_NBR                                          09120000
091300              ,A.ADDRESS_LINE1_DESC                               09130000
091400              ,A.ADDRESS_LINE2_DESC                               09140000
091500              ,A.ADDRESS_LINE3_DESC                               09150000
091600              ,A.ADDRESS_LINE4_DESC                               09160000
091700              ,A.ATTENTION_TO_TXT                                 09170000
091800              ,A.CITY_NAME                                        09180000
091910              ,A.ST_PROV_CDE                                      09191099
092000              ,A.ZIP_CDE                                          09200000
092010              ,A.CNTRY_CDE                                        09201099
092300              ,B.FIRST_NAME                                       09230000
092400              ,B.LAST_NAME                                        09240000
092500          FROM                                                    09250000
092600                TBUSLOC A                                         09260000
092700              , TENTREP B                                         09270000
092800          WHERE                                                   09280000
092900                A.ENT_ID         = :DK-ENT-ID                     09290000
093000            AND A.FUNCTION_ID    = :PC-PRETICKET-FUNCTION-ID      09300000
093100            AND A.FUNCTION_ID    = B.FUNCTION_ID                  09310000
093200            AND A.ENT_ID         = B.ENT_ID                       09320000
093300            AND A.SEQ_NBR        = B.ENT_BUS_LOC_ID               09330000
093400          ORDER BY                                                09340000
093500              A.SEQ_NBR                                           09350000
093600     END-EXEC.                                                    09360000
093700                                                                  09370000
093900 LINKAGE SECTION.                                                 09390000
094000                                                                  09400000
094100 01  DFHCOMMAREA.                                                 09410000
094200     05  FILLER                         OCCURS  1 TO 4072 TIMES   09420000
094300                                        DEPENDING ON EIBCALEN.    09430000
094400         10  FILLER                     PIC X.                    09440000
094500                                                                  09450000
094700 PROCEDURE DIVISION.                                              09470000
094800******************************************************************09480000
094900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **09490000
095000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **09500000
095100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **09510000
095200******************************************************************09520000
095300 0000-MAIN-MODULE.                                                09530000
095400     INITIALIZE DP030-CICS-API-FIELDS.                            09540000
095500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09550000
095600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09560000
095700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         09570000
095800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09580000
095900     MOVE LENGTH OF VL583AI        TO DP030-MAP-LENGTH (1).       09590000
096000     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              09600051
096100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09610051
096200     PERFORM 0001-CALL-CICS-ARCH-API.                             09620000
096300*                                                                 09630000
096400     PERFORM 1000-CONTROL-PROCESSING                              09640000
096500*                                                                 09650000
096600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09660000
096700     PERFORM 0001-CALL-CICS-ARCH-API.                             09670000
096800                                                                  09680000
096900******************************************************************09690000
097000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **09700000
097100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **09710000
097200******************************************************************09720000
097300 0001-CALL-CICS-ARCH-API.                                         09730000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09740099
097500                                    DFHCOMMAREA                   09750099
097600                                    DP030-CICS-API-FIELDS         09760099
097700                                    DP020-STANDARD-COMMAREA       09770099
097800                                    VL583AI.                      09780099
097900*                                                                 09790000
098000     IF  DP030-RC-CALL-SUCCESSFUL                                 09800000
098100         CONTINUE                                                 09810000
098200     ELSE                                                         09820000
098300         SET DP013-NO-ROLLBACK                                    09830000
098400             DP013-XCTL-DISPLAY-RESTART                           09840000
098500             DP013-CICS-ABEND      TO TRUE                        09850000
098600         MOVE '0001-CALL-CICS-ARCH-API'                           09860000
098700                                   TO DP013-PARAGRAPH             09870000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09871099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09872099
099000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09900000
099100         PERFORM DP013-0000-PROCESS-ABEND                         09910000
099200     END-IF.                                                      09920000
100200                                                                  09921099
099300*----------------------------------------------------------------*09930000
099400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09940000
099500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09950000
099600*                                                                *09960000
099700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09970000
099800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09980000
099900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09990000
100000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *10000000
100100*----------------------------------------------------------------*10010000
100300 1000-CONTROL-PROCESSING.                                         10030000
100500     EVALUATE TRUE                                                10050000
100600         WHEN DP020-NEXT-ACT-INITIAL                              10060000
100700             INITIALIZE ASC-SPECIFIC-COMMAREA                     10070000
100800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            10080000
100900                                      ASC-SEL-TERM-ID             10090000
101000                                      ASC-ADDR-TERM-ID            10100000
101100                                      ASC-RSN-TERM-ID             10110000
101200             MOVE DP020-SRC-TASK-NUMBER                           10120000
101300                                   TO ASC-LIST-TASK-NUMBER        10130000
101400                                      ASC-SEL-TASK-NUMBER         10140000
101500                                      ASC-ADDR-TASK-NUMBER        10150000
101600                                      ASC-RSN-TASK-NUMBER         10160000
101700             MOVE DP020-INT-APPL-FORMAT-IND                       10170000
101800                                   TO  ASC-FORMAT-INDICATOR       10180000
101900             MOVE PC-LIST-QUEUE-SEQ                               10190000
102000                                   TO ASC-LIST-SEQ                10200000
102100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 10210000
102200             MOVE PC-ADDR-QUEUE-SEQ                               10220000
102300                                   TO ASC-ADDR-SEQ                10230000
102400             MOVE PC-RSN-QUEUE-SEQ TO ASC-RSN-SEQ                 10240000
102500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 10250000
102600***-----$TEMPLATE NOTE$-------------------------------------------10260000
102700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,10270000
102800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  10280000
102900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.10290000
103000***---------------------------------------------------------------10300000
103100             IF  PS-COMMAREA-NOT-VALID                            10310000
103200                 MOVE PC-TSYMSG-99901                             10320000
103300                                   TO DP020-MSG-NUMBER            10330000
103400                 SET DP020-MSG-FATAL                              10340000
103500                                   TO TRUE                        10350000
103600                 SET DP020-NEXT-ACT-APPL-ERROR                    10360000
103700                                   TO TRUE                        10370000
103800             ELSE                                                 10380000
103900                 PERFORM 4000-BUILD-INITIAL-PANEL                 10390000
104000             END-IF                                               10400000
104100             IF ASC-DELETE-FORMAT-IND                             10410000
104200                 MOVE VL005-PRETKT-REQ-STAT                       10420085
104300                      TO ASC-REQ-STAT-CDE                         10430085
104400                 IF (ASC-REQ-STAT-PRINTED OR                      10440082
104500                          ASC-REQ-STAT-SHIPPED OR                 10450082
104600                          ASC-REQ-STAT-CANCELLED OR               10460082
104700                          ASC-REQ-STAT-INPROC)                    10470000
104800                    PERFORM 3200-RESET-ATTRIBUTES                 10480082
104900                    MOVE PC-TSYMSG-01359 TO DP020-MSG-NUMBER      10490082
105000                    SET DP020-MSG-INFORMATIONAL TO TRUE           10500082
105100                 ELSE                                             10510082
105200                    PERFORM 3200-RESET-ATTRIBUTES                 10520082
105300                    MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER      10530082
105400                    SET DP020-MSG-INFORMATIONAL TO TRUE           10540082
105500                 END-IF                                           10550084
105600             END-IF                                               10560000
105700                                                                  10570000
105800         WHEN DP020-NEXT-ACT-READ-MAP                             10580000
105900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10590000
106000                                   TO PV-TOP-ITEM                 10600000
106100             PERFORM 2000-PROCESS-PANEL                           10610000
106200                                                                  10620000
106300         WHEN DP020-NEXT-ACT-RETURN                               10630000
106400             MOVE DP020-INT-APPL-FORMAT-IND                       10640000
106500                                 TO ASC-RETURN-FORMAT-INDICATOR   10650000
106600             EVALUATE TRUE                                        10660003
106700             WHEN ASC-RETURN-FROM-REASON                          10670003
106800                 IF VL005-NUMBER-OF-RSN-CODES > 0                 10680000
106900* IF THERE ARE REASON CODES AND IT IS AN UPDATE, SET THE REASON   10690000
107000* CODE INDICATOR SAYING IT IS OK TO UPDATE IT - IF NOT AN UPDATE, 10700000
107100* IT IS A RESUBMIT...SET THE RESUBMIT REASON COMPLETE FLAG TO TRUE10710000
107200                     IF ASC-UPDATE-RESUB                          10720008
107300                         SET ASC-REASON-CODES-EXIST TO TRUE       10730099
107500                     ELSE                                         10750000
107600                         SET ASC-RESUB-REASON-COMPLETE TO TRUE    10760099
107800                     END-IF                                       10780000
107900                 ELSE                                             10790000
108000* IF THERE ARENT REASON CODES AND IT IS AN UPDATE, SET THE REASON 10800000
108100* CODE INDICATOR SAYING IT IS NOT OK TO UPDATE - IF THIS IS A     10810000
108200* A RESUBMIT...SET THE RESUBMIT REASON PENDING FLAG TO TRUE       10820000
108300                     IF ASC-UPDATE-RESUB                          10830008
108400                         SET ASC-REASON-CODES-DONT-EXIST TO TRUE  10840099
108600                     ELSE                                         10860000
108700                         SET ASC-RESUB-REASON-PENDING TO TRUE     10870099
108900                     END-IF                                       10890000
109000                 END-IF                                           10900000
109100                 MOVE VL005-NUMBER-OF-RSN-CODES                   10910000
109200                                 TO ASC-NUMBER-OF-RSN-CODES       10920000
109300                                                                  10930000
109400                 MOVE VL005-NUMBER-OF-RSN-TS-ITEMS                10940000
109500                                 TO ASC-NUMBER-OF-RSN-TS-ITEMS    10950000
109600                 MOVE ASC-ITEM-AT-TOP-OF-PANEL                    10960013
109700                                 TO PV-TOP-ITEM                   10970013
109800                 MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL    10980013
109900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10990010
110000                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               11000010
110100                                                                  11010011
110200             WHEN ASC-RETURN-FROM-TPLACE                          11020003
110300                 MOVE VL005-TKT-PLCMNT-CDE                        11030018
110400                      TO ASC-DEFAULT-TICKET-PLACE                 11040018
110500                 PERFORM 3020-DEFAULT-LINES                       11050018
110600                                                                  11060011
110700             WHEN ASC-RETURN-FROM-TKTTYPE                         11070003
110800                 MOVE VL005-TKT-FMT-DESC                          11080018
110900                      TO ASC-DEFAULT-TICKET-TYPE                  11090000
111000                 PERFORM 3020-DEFAULT-LINES                       11100018
111100                                                                  11110018
111200             WHEN OTHER                                           11120003
111300                 MOVE ASC-ITEM-AT-TOP-OF-PANEL                    11130003
111400                                 TO PV-TOP-ITEM                   11140003
111500                 MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL    11150003
111600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11160003
111700                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               11170003
111800             END-EVALUATE                                         11180004
111900                                                                  11190000
112000         WHEN OTHER                                               11200000
112100             SET DP013-LOGIC-ABEND TO TRUE                        11210000
112200             SET DP013-NO-ROLLBACK TO TRUE                        11220000
112300             MOVE '1000-CONTROL-PROCESSING'                       11230000
112400                                   TO DP013-PARAGRAPH             11240000
112500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    11250000
112600                                   TO DP013-MESSAGE-TEXT(1)       11260000
112700             PERFORM DP013-0000-PROCESS-ABEND                     11270000
112800     END-EVALUATE.                                                11280000
112900                                                                  11290000
113100*----------------------------------------------------------------*11310000
113200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *11320000
113300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *11330000
113400*----------------------------------------------------------------*11340000
113600 1100-PROCESS-INTER-APPL-COMM.                                    11360000
113800     SET PS-COMMAREA-VALID         TO TRUE.                       11380000
113900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     11390000
114000     EVALUATE TRUE                                                11400000
114100         WHEN ASC-CRIT-SPEC-FORMAT-IND                            11410000
114300             MOVE VL005-PO-NUMBER      TO ASC-PO-NUMBER           11430000
114400                                          DK-PO-NUMBER            11440000
114500             MOVE VL005-PO-REQ-NBR     TO ASC-PO-REQ-NBR          11450000
114600                                          DK-PO-REQ-NBR           11460000
114800             MOVE VL005-ENT-ID         TO ASC-ENT-ID              11480000
114900                                          DK-ENT-ID               11490000
115100             MOVE VL005-VENDOR-NAME    TO ASC-VND-NAME            11510000
115300             MOVE VL005-DEPT-NBR       TO ASC-DEPT-NBR            11530000
115400                                          ASC-SKU-DEPT            11540099
115400                                          DK-DEPT-NBR             11541099
115500         WHEN ASC-LIST-FORMAT-IND                                 11550000
115600             SET ASC-USE-SELECTION-QUEUE TO TRUE                  11560000
115700             MOVE VL005-NUMBER-OF-TS-ITEMS                        11570000
115800                               TO ASC-NUMBER-OF-TS-ITEMS          11580000
115900             MOVE VL005-SEL-QUEUE-NAME                            11590000
116000                               TO ASC-SEL-QUEUE-NAME-IN           11600000
116100             PERFORM 1120-PREPARE-LIST-ENTRY                      11610000
116200* ANY ADD FROM A LIST MUST BE A RESUBMIT - REQUEST OF ZERO        11620000
116300             IF ASC-RESUBMIT-FORMAT-IND                           11630000
116400                 MOVE +0               TO ASC-PO-REQ-NBR          11640000
116500                                          DK-PO-REQ-NBR           11650000
116600             END-IF                                               11660000
116800         WHEN OTHER                                               11680000
116900             SET PS-COMMAREA-NOT-VALID TO TRUE                    11690000
117000     END-EVALUATE.                                                11700000
117100                                                                  11710000
117200     MOVE VL005-REQ-ACTION-TYPE-SW TO ASC-ACTION-INDICATOR.       11720000
117300                                                                  11730000
117400*----------------------------------------------------------------*11740000
117500*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *11750000
117600*----------------------------------------------------------------*11760000
117800 1120-PREPARE-LIST-ENTRY.                                         11780000
118000     MOVE VL006-MAX-ITEMS TO ASC-SEL-SUB.                         11800000
118100     MOVE ZERO            TO ASC-SEL-ITEM.                        11810000
118200     PERFORM 1130-GET-NEXT-MESSAGE.                               11820000
118300                                                                  11830000
118400*----------------------------------------------------------------*11840000
118500*    GET THE NEXT MESSAGE IF A LIST OF MESSAGES IS BEING         *11850000
118600*    PROCESSED.                                                  *11860000
118700*----------------------------------------------------------------*11870000
118900 1130-GET-NEXT-MESSAGE.                                           11890000
119100     ADD +1                       TO ASC-SEL-SUB.                 11910000
119200     IF  ASC-SEL-SUB > VL006-MAX-ITEMS                            11920000
119300         ADD +1                   TO ASC-SEL-ITEM                 11930000
119400         MOVE +1                  TO ASC-SEL-SUB                  11940000
119500     END-IF.                                                      11950000
119600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                11960000
119700         PERFORM 9100-READ-SEL-QUEUE-IN                           11970000
119800         IF  VL006-ITEM (ASC-SEL-SUB) > ZERO                      11980000
119900             MOVE VL006-PO-NUMBER (ASC-SEL-SUB)                   11990000
120000                                       TO ASC-PO-NUMBER           12000000
120100                                          DK-PO-NUMBER            12010000
120200             MOVE VL006-PO-REQ-NBR (ASC-SEL-SUB)                  12020000
120300                                       TO ASC-PO-REQ-NBR          12030000
120400                                          DK-PO-REQ-NBR           12040000
120500             MOVE VL006-ENT-ID (ASC-SEL-SUB)                      12050000
120600                                       TO ASC-ENT-ID              12060000
120700                                          DK-ENT-ID               12070000
120800             MOVE VL006-VENDOR-NAME (ASC-SEL-SUB)                 12080000
120900                                       TO ASC-VND-NAME            12090000
121000             MOVE VL006-DEPT-NBR (ASC-SEL-SUB)                    12100000
121100                                       TO ASC-DEPT-NBR            12110000
121200                                          ASC-SKU-DEPT            12120099
121200                                          DK-DEPT-NBR             12121099
121300             SET VL006-INQ (ASC-SEL-SUB) TO TRUE                  12130000
121400             PERFORM 9200-REWRITE-SEL-QUEUE                       12140000
121500         ELSE                                                     12150000
121600             SUBTRACT +1 FROM ASC-SEL-SUB                         12160000
121700             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             12170000
121800             SET DP020-MSG-INFORMATIONAL TO TRUE                  12180000
121900         END-IF                                                   12190000
122000     ELSE                                                         12200000
122100         SUBTRACT +1 FROM ASC-SEL-ITEM                            12210000
122200         MOVE VL006-MAX-ITEMS     TO ASC-SEL-SUB                  12220000
122300         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             12230000
122400         SET DP020-MSG-INFORMATIONAL TO TRUE                      12240000
122500     END-IF.                                                      12250000
122600                                                                  12260000
122800*----------------------------------------------------------------*12280000
122900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *12290000
123000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *12300000
123100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *12310000
123200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *12320000
123300* FUNCTION KEYS CAN GET THIS FAR.                                *12330000
123400*----------------------------------------------------------------*12340000
123600 2000-PROCESS-PANEL.                                              12360000
123700     EVALUATE TRUE                                                12370000
123800*        WHEN A REQUEST WAS ADDED SUCCESSFULLY, DO NOT LET THE    12380000
123900*        PROGRAM GO TO ANOTHER SCREEN, OR DO ANY LOCAL            12390000
124000*        PROCESSING, EXCEPT THE SCROLLING                         12400000
124100         WHEN ASC-ADD-COMPLETE                                    12410000
124200             AND ( DP020-FK-DISPN-LOCAL (DP020-SRC-AID)           12420099
124300              OR   DP020-FK-DISPN-GO (DP020-SRC-AID) )            12430099
124400             AND NOT DP020-FK-PREV-PAGE (DP020-SRC-AID)           12440099
124500             AND NOT DP020-FK-NEXT-PAGE (DP020-SRC-AID)           12450099
124600                SET DP030-OVERRIDE-GO                             12460099
124700                    PS-ERROR           TO TRUE                    12470099
124900         WHEN DP020-SRC-AID = DP016-CLEAR                         12490000
125000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    12500000
125100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   12510000
125200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12520000
125400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    12540000
125500             MOVE ASC-PO-NUMBER    TO DK-PO-NUMBER                12550000
125600             MOVE ASC-PO-REQ-NBR   TO DK-PO-REQ-NBR               12560000
125700             MOVE ASC-ENT-ID       TO DK-ENT-ID                   12570000
125800             MOVE ASC-DEPT-NBR     TO DK-DEPT-NBR                 12580000
125900             MOVE DP020-INT-APPL-FORMAT-IND                       12590000
126000                                   TO  ASC-FORMAT-INDICATOR       12600000
126100             PERFORM 2050-DELETE-LIST-QUEUE                       12610000
126200             PERFORM 4220-DELETE-ADDR-QUEUE                       12620000
126300             PERFORM 4000-BUILD-INITIAL-PANEL                     12630000
126500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    12650000
126600             PERFORM 2140-DESELECT-ALL-ITEMS                      12660000
126700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12670000
126900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  12690000
127000             PERFORM 2150-SELECT-ALL-ITEMS                        12700000
127100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12710000
127300* PREV ADDRESS KEY WAS PRESSED                                    12730069
127400         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               12740069
127500             IF ASC-CURRENT-ADDR-ITEM = 1                         12750069
127600*                -- FIRST ADDRESS --                              12760069
127700                 MOVE PC-TSYMSG-01337      TO DP020-MSG-NUMBER    12770069
127800                 SET DP020-MSG-INFORMATIONAL TO TRUE              12780069
127900             ELSE                                                 12790069
128000                 SUBTRACT +1 FROM ASC-CURRENT-ADDR-ITEM           12800069
128100                 PERFORM 4240-READ-ADDR-QUEUE                     12810069
128200                 PERFORM 4250-MOVE-ADDR-TO-COMMAREA               12820069
128300             END-IF                                               12830069
128400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12840069
128600* NEXT ADDRESS KEY WAS PRESSED                                    12860069
128700         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               12870069
128800             IF ASC-CURRENT-ADDR-ITEM = ASC-ADDRESS-COUNT         12880069
128900*                -- LAST ADDRESS --                               12890069
129000                 MOVE PC-TSYMSG-01336      TO DP020-MSG-NUMBER    12900069
129100                 SET DP020-MSG-INFORMATIONAL TO TRUE              12910069
129200             ELSE                                                 12920069
129300                 ADD +1 TO ASC-CURRENT-ADDR-ITEM                  12930069
129400                 PERFORM 4240-READ-ADDR-QUEUE                     12940069
129500                 PERFORM 4250-MOVE-ADDR-TO-COMMAREA               12950069
129600             END-IF                                               12960069
129700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12970069
129800                                                                  12980069
129900* THE LINE ADD AND LINE DELETE PROCESS MUST BE IN THE FOLLOWING   12990066
130000* ORDER - FIRST MOVE SCREEN TO TEMP - THEN ADD OR DELETE THE LINES13000066
130100* ACCORDING TO THE "TEMP" SELECT FIELD (FOR THOSE THAT WERE JUST  13010066
130200* SELECTED), THEN EDIT THE COMMAREA. (THIS MUST BE DONE LAST      13020066
130300* BECAUSE SOME EDITS ARE DEPENDENT UPON IF THE LINE IS INCLUDED   13030066
130400* ON THE REQUEST)                                                 13040066
130500                                                                  13050066
130600* LINE ADD KEY WAS PRESSED                                        13060066
130700         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               13070066
130800* LINE DEL KEY WAS PRESSED                                        13080066
130900         WHEN DP020-FK-LOCAL-FUNC-07(DP020-SRC-AID)               13090066
131000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13100066
131200* CANT CHECK THE ASC FIELD TO SEE IF ANY LINES WERE SELECTED      13120066
131300* AS NEW SELECTIONS WILL NOT BE INCLUDED YET..THIS MESSAGE WILL   13130066
131400* BE OVERLAID WHEN THE FIRST TEMP-SELECTED LINE IS FOUND          13140066
131500             MOVE PC-TSYMSG-00057            TO DP020-MSG-NUMBER  13150066
131600             SET PS-FIRST-SELECT-NOT-FOUND                        13160067
131700                 DP020-MSG-WARNING           TO TRUE              13170099
 31800             IF  DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)           13180099
131900                 SET PV-LNE-ON-RQST          TO TRUE              13190066
132000             ELSE                                                 13200066
132100                 SET PV-LNE-OFF-RQST         TO TRUE              13210066
132200             END-IF                                               13220066
132300             PERFORM 2160-SEL-LNE-ADD-DEL                         13230066
132500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13250066
132700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13270073
132900*        WHEN THE REASON CODE FUNCTION KEY WAS PRESSED,           13290000
133000         WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)              13300000
133100             IF ASC-RESUB-REQ                                     13310000
133200             OR ASC-UPDATE-RESUB                                  13320008
133300                 MOVE ASC-RSN-QUEUE-NAME TO VL005-RSN-QUEUE-NAME  13330099
133500                 MOVE ASC-PO-REQ-NBR     TO VL005-PO-REQ-NBR      13350099
133700                 MOVE ASC-PO-NUMBER      TO VL005-PO-NUMBER       13370099
133900             ELSE                                                 13390000
134000                 MOVE PC-TSYMSG-01353    TO DP020-MSG-NUMBER      13400099
134200                 SET DP030-SET-CURSOR-APPL-1                      13420000
134300                     DP030-OVERRIDE-GO                            13430000
134400                     DP020-MSG-FATAL                              13440000
134500                     PS-ERROR      TO TRUE                        13450000
134600             END-IF                                               13460000
134800*        TICKET PLACEMENT KEY WAS PRESSED                         13480090
134900         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               13490000
135000*        TICKET TYPE KEY WAS PRESSED                              13500090
135100         WHEN DP020-FK-LOCAL-FUNC-09(DP020-SRC-AID)               13510000
135200*            2200- AND 3000- ARE EXECUTED HERE TO SET ALL THE     13520090
135300*            SELECTION FIELDS APPROPRIATELY (NEWLY SELECTED FIELDS13530090
135400*            WILL BE LOST OTHERWISE)                              13540090
135500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13550089
135600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13560089
135800             INITIALIZE VL005-INTER-APPL-COMMAREA                 13580033
135900             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    13590033
136000                            TO VL005-NUMBER-OF-SELECTED-ITEMS     13600033
136100             PERFORM 5000-PREPARE-SEL-QUEUE                       13610033
136300         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    13630000
136400             IF (ASC-REQ-STAT-PRINTED OR                          13640089
136500                 ASC-REQ-STAT-SHIPPED OR                          13650089
136600                 ASC-REQ-STAT-CANCELLED OR                        13660089
136700                 ASC-REQ-STAT-INPROC)                             13670089
136800                SET   ASC-REQ-STAT-CANCELLED TO TRUE              13680082
136900                PERFORM 7115-UPDATE-REQUEST-HDR-STAT              13690089
137000                PERFORM 7101-UPDATE-SELECTION-QUEUE               13700089
137100                PERFORM 3200-RESET-ATTRIBUTES                     13710089
137200                MOVE PC-TSYMSG-00522      TO DP020-MSG-NUMBER     13720000
137300                SET DP020-MSG-INFORMATIONAL TO TRUE               13730000
137400             ELSE                                                 13740082
137500                 PERFORM 7200-DELETE-REQUEST                      13750082
137600                 MOVE ASC-PO-NUMBER    TO DK-PO-NUMBER            13760082
137700                 MOVE ASC-PO-REQ-NBR   TO DK-PO-REQ-NBR           13770082
137800                 MOVE ASC-ENT-ID       TO DK-ENT-ID               13780082
137900                 MOVE ASC-DEPT-NBR     TO DK-DEPT-NBR             13790082
138000                 MOVE DP020-INT-APPL-FORMAT-IND                   13800082
138100                                       TO  ASC-FORMAT-INDICATOR   13810082
138200                 PERFORM 2050-DELETE-LIST-QUEUE                   13820082
138300                 PERFORM 4220-DELETE-ADDR-QUEUE                   13830082
138400                 PERFORM 3200-RESET-ATTRIBUTES                    13840082
138500             END-IF                                               13850084
138700         WHEN OTHER                                               13870000
138800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13880000
138900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13890000
139100             IF  PS-NO-ERROR                                      13910000
139200                 SET DP030-CONTINUE-GO TO TRUE                    13920099
139400                 PERFORM 2100-CHECK-FUNCTION-KEY                  13940000
139500             ELSE                                                 13950000
139600                 SET DP030-OVERRIDE-GO TO TRUE                    13960099
139800             END-IF                                               13980000
139900     END-EVALUATE.                                                13990000
140000                                                                  14000099
140100*----------------------------------------------------------------*14010000
140200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *14020000
140300*----------------------------------------------------------------*14030000
140400 2050-DELETE-LIST-QUEUE.                                          14040000
140600     EXEC CICS                                                    14060000
140700         DELETEQ TS                                               14070000
140800             QUEUE (ASC-LIST-QUEUE-NAME)                          14080000
140900             RESP  (PV-CICS-RESP)                                 14090000
141000     END-EXEC.                                                    14100000
141100                                                                  14110000
141200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       14120000
141300        (PV-CICS-RESP = DFHRESP(QIDERR))                          14130000
141400         CONTINUE                                                 14140000
141500     ELSE                                                         14150000
141600         SET DP013-CICS-ABEND      TO TRUE                        14160000
141700         SET DP013-NO-ROLLBACK     TO TRUE                        14170000
141800                                                                  14180000
141900         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         14190099
142100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    14210000
142200                                   TO DP013-MESSAGE-TEXT (1)      14220000
142300         PERFORM DP013-0000-PROCESS-ABEND                         14230000
142400     END-IF.                                                      14240000
142500                                                                  14250000
142600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  14260000
142700                                                                  14270099
142800*----------------------------------------------------------------*14280000
142900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*14290000
143000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *14300000
143100* CICS ARCHITECTURE API.                                         *14310000
143200*----------------------------------------------------------------*14320000
143300 2100-CHECK-FUNCTION-KEY.                                         14330000
143400     EVALUATE TRUE                                                14340000
143600* REQUEST SUBMIT KEY WAS PRESSED                                  14360099
143700         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               14370000
143800              IF ASC-ADD-PENDING                                  14380000
143900                  IF ASC-REQUEST-LINE-COUNT > 0                   14390000
144000                      PERFORM 7000-ADD-REQUEST                    14400000
144100                  ELSE                                            14410000
144200                      MOVE PC-TSYMSG-01358 TO DP020-MSG-NUMBER    14420099
144400                      SET DP020-MSG-INFORMATIONAL TO TRUE         14440099
144600                  END-IF                                          14460000
144700              ELSE                                                14470000
144800                  IF ASC-RESUB-REASON-PENDING                     14480000
144900                      MOVE PC-TSYMSG-01334 TO DP020-MSG-NUMBER    14490099
145100                      SET DP020-MSG-INFORMATIONAL TO TRUE         14510099
145300                  ELSE                                            14530000
145400                      MOVE PC-TSYMSG-00117 TO DP020-MSG-NUMBER    14540099
145600                      SET DP020-MSG-INFORMATIONAL TO TRUE         14560099
145800                  END-IF                                          14580000
145900              END-IF                                              14590000
146000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                14600000
146200* REQUEST UPDATE KEY WAS PRESSED                                  14620000
146300         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               14630000
146400              IF ASC-REASON-CODES-DONT-EXIST                      14640000
146500              AND ASC-UPDATE-RESUB                                14650008
146600                  MOVE PC-TSYMSG-01334 TO DP020-MSG-NUMBER        14660099
146800                  SET DP020-MSG-INFORMATIONAL TO TRUE             14680099
147000              ELSE                                                14700000
147100                  IF ASC-REQUEST-LINE-COUNT > 0                   14710000
147200                      IF ASC-UPDATE-REG                           14720009
147300                      OR ASC-UPDATE-RESUB                         14730008
147400                          PERFORM 7100-UPDATE-REQUEST             14740000
147500                      ELSE                                        14750000
147600                          MOVE PC-TSYMSG-01365 TO DP020-MSG-NUMBER14760099
147800                          SET DP020-MSG-INFORMATIONAL TO TRUE     14780099
148000                      END-IF                                      14800000
148100                  ELSE                                            14810000
148200                      MOVE PC-TSYMSG-01358 TO DP020-MSG-NUMBER    14820099
148400                      SET DP020-MSG-INFORMATIONAL TO TRUE         14840099
148600                  END-IF                                          14860000
148700              END-IF                                              14870000
148900* ENTER KEY WAS PRESSED                                           14890000
149000         WHEN DP020-SRC-AID = DP016-ENTER                         14900000
149100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   14910000
149200             IF  PS-ERROR                                         14920000
149300                 CONTINUE                                         14930000
149400             ELSE                                                 14940000
149500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14950000
149600             END-IF                                               14960000
149800         WHEN DP020-FK-DISPN-GO(DP020-SRC-AID)                    14980005
149900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              14990005
150000                 INITIALIZE VL005-INTER-APPL-COMMAREA             15000005
150100                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                15010005
150200                                TO VL005-NUMBER-OF-SELECTED-ITEMS 15020005
150300                 PERFORM 5000-PREPARE-SEL-QUEUE                   15030005
150400             ELSE                                                 15040005
150500                 SET DP030-OVERRIDE-GO TO TRUE                    15050099
150700                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         15070099
150900                 SET DP020-MSG-WARNING TO TRUE                    15090099
151100             END-IF                                               15110005
151300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  15130000
151400             MOVE +1               TO PV-TOP-ITEM                 15140000
151500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15150000
151700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   15170000
151800             PERFORM 2110-BROWSE-BACKWARD                         15180000
151900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15190000
152100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   15210000
152200             PERFORM 2120-BROWSE-FORWARD                          15220000
152300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15230000
152500         WHEN OTHER                                               15250000
152600             SET DP013-NO-ROLLBACK                                15260000
152700                 DP013-XCTL-DISPLAY-RESTART                       15270000
152800                 DP013-CICS-ABEND  TO TRUE                        15280000
152900             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    15290099
153100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      15310000
153200                                   TO DP013-MESSAGE-TEXT (1)      15320000
153300             PERFORM DP013-0000-PROCESS-ABEND                     15330000
153400     END-EVALUATE.                                                15340000
153500                                                                  15350000
153700*----------------------------------------------------------------*15370000
153800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *15380000
153900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *15390000
154000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *15400000
154100*    MESSAGE.                                                    *15410000
154200*----------------------------------------------------------------*15420000
154400 2110-BROWSE-BACKWARD.                                            15440000
154500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    15450000
154600         GIVING PV-TOP-ITEM.                                      15460000
154800     IF  ((PV-TOP-ITEM < +1)                                      15480000
154900       OR (PV-TOP-ITEM = +1))                                     15490000
155000         MOVE +1                   TO PV-TOP-ITEM                 15500000
155100*        -- TOP OF LIST --                                        15510000
155200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            15520000
155300         SET DP020-MSG-INFORMATIONAL TO TRUE                      15530000
155400     END-IF.                                                      15540000
155500                                                                  15550000
155700*----------------------------------------------------------------*15570000
155800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *15580000
155900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *15590000
156000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *15600000
156100*----------------------------------------------------------------*15610000
156300 2120-BROWSE-FORWARD.                                             15630000
156500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              15650000
156600         GIVING PV-TOP-ITEM.                                      15660000
156700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   15670000
156800         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             15680099
157000*        -- BOTTOM OF LIST --                                     15700000
157100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            15710000
157200         SET DP020-MSG-INFORMATIONAL TO TRUE                      15720099
157400     ELSE                                                         15740000
157500         COMPUTE PV-BOTTOM-ITEM =                                 15750000
157600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 15760000
157700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            15770000
157800*            -- BOTTOM OF LIST --                                 15780000
157900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            15790000
158000             SET DP020-MSG-INFORMATIONAL TO TRUE                  15800099
158200         END-IF                                                   15820000
158300     END-IF.                                                      15830000
158400                                                                  15840099
158500*----------------------------------------------------------------*15850000
158600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *15860000
158700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *15870000
158800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *15880000
158900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *15890000
159000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *15900000
159100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *15910000
159200*----------------------------------------------------------------*15920000
159400 2130-CHECK-FOR-JUMP-BROWSE.                                      15940000
159500     SET PS-NO-ERROR               TO TRUE.                       15950000
159600     IF (ASC-START-ITEM-REQUEST = SPACE)                          15960000
159700         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             15970099
159900     ELSE                                                         15990000
160000         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     16000099
160200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       16020000
160300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     16030000
160400         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  16040099
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         16070099
263627              USING DP010I-NUMERIC-EDIT-AREA                      16071099
160800         IF  NOT DP010I-ERROR-DETECTED                            16080000
160900             MOVE DP010I-NUMERIC-FIELD                            16090000
161000                                   TO  ASC-START-ITEM-REQUEST-N   16100000
161100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  16110000
161200                 IF  ASC-START-ITEM-REQUEST-N >                   16120000
161300                                          ASC-NUMBER-OF-ITEMS-READ16130000
161400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         16140000
161500                     COMPUTE PV-TOP-ITEM =                        16150000
161600                             ASC-NUMBER-OF-ITEMS-READ             16160000
161700                             - PC-ITEMS-PER-PANEL + 1             16170000
161800                     IF  PV-TOP-ITEM < +1                         16180000
161900                         MOVE +1   TO PV-TOP-ITEM                 16190000
162000                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 16200099
162200                         SET DP020-MSG-INFORMATIONAL TO TRUE      16220099
162400                     END-IF                                       16240000
162500                 ELSE                                             16250000
162600                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 16260099
162800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      16280000
162900                     COMPUTE PV-BOTTOM-ITEM =                     16290000
163000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     16300000
163100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ16310000
163200*                        -- BOTTOM OF LIST --                     16320000
163300                         MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER16330099
163500                         SET DP020-MSG-INFORMATIONAL TO TRUE      16350099
163700                     END-IF                                       16370000
163800                 END-IF                                           16380000
163900             ELSE                                                 16390000
164000*                --- VALUE OUT OF RANGE ----                      16400000
164100                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         16410099
164300                 MOVE -1           TO ASTRTITL                    16430000
164400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              16440099
164600                 MOVE DP015-REVERSE TO ASTRTITH                   16460099
164800                 MOVE DP015-RED    TO ASTRTITC                    16480000
164900                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           16490099
165100                 SET DP020-MSG-FATAL TO TRUE                      16510099
165300                 SET PS-ERROR      TO TRUE                        16530000
165400             END-IF                                               16540000
165600         ELSE                                                     16560000
165700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            16570000
165800             MOVE -1               TO ASTRTITL                    16580000
165900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  16590000
166000             MOVE DP015-REVERSE    TO ASTRTITH                    16600000
166100             MOVE DP015-RED        TO ASTRTITC                    16610000
166200             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               16620099
166400             SET DP020-MSG-FATAL   TO TRUE                        16640000
166500             SET PS-ERROR          TO TRUE                        16650000
166600         END-IF                                                   16660000
166700     END-IF.                                                      16670000
166800                                                                  16680099
166900*----------------------------------------------------------------*16690000
167000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *16700000
167100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *16710000
167200*----------------------------------------------------------------*16720000
167300 2140-DESELECT-ALL-ITEMS.                                         16730000
167400     MOVE +1                       TO ASC-BLK-SUB.                16740000
167600     PERFORM 2141-CLEAR-SELECTED-INDS                             16760000
167700         VARYING ASC-ITEM-SUB                                     16770000
167800         FROM 1 BY 1                                              16780000
167900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16790000
168100     ADD +1                        TO ASC-BLK-SUB.                16810000
168300     PERFORM 2141-CLEAR-SELECTED-INDS                             16830000
168400         VARYING ASC-ITEM-SUB                                     16840000
168500         FROM 1 BY 1                                              16850000
168600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16860000
168800     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       16880099
169100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16910000
169200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16920000
169400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16940000
169500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      16950000
169700         MOVE +1                   TO ASC-BLK-SUB                 16970000
169800         PERFORM 5100-WRITE-TEMP-STORAGE                          16980000
170000         MOVE +1                   TO PV-BLOCK-NUMBER             17000000
170200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17020000
170300             PV-FIRST-BLOCK-IN-ARRAY - 1                          17030000
170500         PERFORM                                                  17050000
170600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       17060000
170800             PERFORM 4410-READ-TEMP-STORAGE                       17080000
171000             PERFORM 2141-CLEAR-SELECTED-INDS                     17100000
171100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 17110000
171200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17120000
171400             PERFORM 5100-WRITE-TEMP-STORAGE                      17140000
171600             ADD +1                TO PV-BLOCK-NUMBER             17160000
171800         END-PERFORM                                              17180000
172000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17200000
172100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17210000
172300         PERFORM                                                  17230000
172400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17240000
172500                   ASC-HIGHEST-BLOCK-WRITTEN                      17250000
172700             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       17270099
173000             PERFORM 4410-READ-TEMP-STORAGE                       17300000
173200             PERFORM 2141-CLEAR-SELECTED-INDS                     17320000
173300                 VARYING ASC-ITEM-SUB                             17330000
173400                 FROM 1 BY 1                                      17340000
173500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17350000
173700             PERFORM 5100-WRITE-TEMP-STORAGE                      17370000
173900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17390000
174100         END-PERFORM                                              17410000
174300         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         17430099
174600         PERFORM 4410-READ-TEMP-STORAGE                           17460000
174700     END-IF.                                                      17470000
175000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 17500000
175100     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  17510099
175200     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    17520099
175400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        17540000
175500                                                                  17550000
175700*----------------------------------------------------------------*17570000
175800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *17580000
175900*----------------------------------------------------------------*17590000
176100 2141-CLEAR-SELECTED-INDS.                                        17610000
176300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           17630000
176400             NOT EQUAL ZERO                                       17640000
176500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17650000
176600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17660000
176700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    17670000
176800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)  TO TRUE         17680099
177000         END-IF                                                   17700000
177100     END-IF.                                                      17710000
177200                                                                  17720000
177400*----------------------------------------------------------------*17740000
177500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *17750000
177600*  FOR ALL ITEMS.                                                *17760000
177700*----------------------------------------------------------------*17770000
177900 2150-SELECT-ALL-ITEMS.                                           17790000
178100     MOVE +1                       TO ASC-BLK-SUB.                17810000
178300     PERFORM 2151-SET-SELECTED-INDS                               17830000
178400         VARYING ASC-ITEM-SUB                                     17840000
178500         FROM 1 BY 1                                              17850000
178600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17860000
178800     ADD +1                        TO ASC-BLK-SUB.                17880000
179000     PERFORM 2151-SET-SELECTED-INDS                               17900000
179100         VARYING ASC-ITEM-SUB                                     17910000
179200         FROM 1 BY 1                                              17920000
179300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17930000
179500     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       17950099
179800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17980000
179900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17990000
180100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     18010000
180200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    18020000
180400         MOVE +1                   TO ASC-BLK-SUB                 18040000
180500         PERFORM 5100-WRITE-TEMP-STORAGE                          18050000
180700         MOVE +1                   TO PV-BLOCK-NUMBER             18070000
180900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18090000
181000             PV-FIRST-BLOCK-IN-ARRAY - 1                          18100000
181200         PERFORM                                                  18120000
181300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       18130000
181500             PERFORM 4410-READ-TEMP-STORAGE                       18150000
181700             PERFORM 2151-SET-SELECTED-INDS                       18170000
181800                 VARYING ASC-ITEM-SUB                             18180000
181900                 FROM 1 BY 1                                      18190000
182000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18200000
182200             PERFORM 5100-WRITE-TEMP-STORAGE                      18220000
182400             ADD +1                TO PV-BLOCK-NUMBER             18240000
182600         END-PERFORM                                              18260000
182700                                                                  18270000
182800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18280000
182900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18290000
183100         PERFORM                                                  18310000
183200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18320000
183300                   ASC-HIGHEST-BLOCK-WRITTEN                      18330000
183500             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       18350099
183800             PERFORM 4410-READ-TEMP-STORAGE                       18380000
184000             PERFORM 2151-SET-SELECTED-INDS                       18400000
184100                 VARYING ASC-ITEM-SUB                             18410000
184200                 FROM 1 BY 1                                      18420000
184300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18430000
184500             PERFORM 5100-WRITE-TEMP-STORAGE                      18450000
184700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18470000
184900         END-PERFORM                                              18490000
185100         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          18510099
185400         PERFORM 4410-READ-TEMP-STORAGE                           18540000
185500     END-IF.                                                      18550000
185700                                                                  18570000
185800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             18580000
185900                       ASC-NUMBER-OF-SELECTED-ITEMS.              18590000
186100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        18610000
186200                                                                  18620000
186400*----------------------------------------------------------------*18640000
186500*    MARK EACH ITEM AS BEING SELECTED.                           *18650000
186600*----------------------------------------------------------------*18660000
186800 2151-SET-SELECTED-INDS.                                          18680000
187000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           18700000
187100             NOT EQUAL ZERO                                       18710000
187200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             18720000
187300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             18730000
187400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        18740000
187500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO  TRUE         18750099
187700         END-IF                                                   18770000
187800     END-IF.                                                      18780000
188300                                                                  18781099
187900*----------------------------------------------------------------*18790000
188000*  IF THE USER HITS THE LINEADD OR LINEDEL KEY, RUN THROUGH ALL  *18800000
188100*  THE SELECTED LINES AND CHANGED THE INDICATOR ACCORDINGLY      *18810000
188200*----------------------------------------------------------------*18820000
188400 2160-SEL-LNE-ADD-DEL.                                            18840000
188600     MOVE +1                       TO ASC-BLK-SUB.                18860000
188800     PERFORM 2161-SET-RQST-INDS                                   18880000
188900         VARYING ASC-ITEM-SUB                                     18890000
189000         FROM 1 BY 1                                              18900000
189100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18910000
189300     ADD +1                        TO ASC-BLK-SUB.                18930000
189500     PERFORM 2161-SET-RQST-INDS                                   18950000
189600         VARYING ASC-ITEM-SUB                                     18960000
189700         FROM 1 BY 1                                              18970000
189800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18980000
190000     MOVE ASC-LIST-ITEM-NUMBER(1 1)TO PV-LIST-ITEM-NUMBER.        19000099
190100                                                                  19010099
190300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19030000
190400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19040000
190500                                                                  19050000
190600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     19060000
190700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    19070000
190800         MOVE +1                   TO ASC-BLK-SUB                 19080000
191000         PERFORM 5100-WRITE-TEMP-STORAGE                          19100000
191200         MOVE +1                   TO PV-BLOCK-NUMBER             19120000
191400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19140000
191500             PV-FIRST-BLOCK-IN-ARRAY - 1                          19150000
191700         PERFORM                                                  19170000
191800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       19180000
192000             PERFORM 4410-READ-TEMP-STORAGE                       19200000
192200             PERFORM 2161-SET-RQST-INDS                           19220000
192300                 VARYING ASC-ITEM-SUB                             19230000
192400                 FROM 1 BY 1                                      19240000
192500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19250000
192700             PERFORM 5100-WRITE-TEMP-STORAGE                      19270000
192900             ADD +1                TO PV-BLOCK-NUMBER             19290000
193100         END-PERFORM                                              19310000
193200                                                                  19320000
193300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19330000
193400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19340000
193500                                                                  19350000
193600         PERFORM                                                  19360000
193700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19370000
193800                   ASC-HIGHEST-BLOCK-WRITTEN                      19380000
194000             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       19400099
194300             PERFORM 4410-READ-TEMP-STORAGE                       19430000
194500             PERFORM 2161-SET-RQST-INDS                           19450000
194600                 VARYING ASC-ITEM-SUB                             19460000
194700                 FROM 1 BY 1                                      19470000
194800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19480000
195000             PERFORM 5100-WRITE-TEMP-STORAGE                      19500000
195200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19520000
195400         END-PERFORM                                              19540000
195500                                                                  19550000
195600         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          19560099
195900         PERFORM 4410-READ-TEMP-STORAGE                           19590000
196000     END-IF.                                                      19600000
196100                                                                  19610000
196400*----------------------------------------------------------------*19640000
196500*    SET EACH REQUEST INIDICATOR ACCRDINGLY                      *19650000
196600* ---------------------------------------------------------------*19660000
196800 2161-SET-RQST-INDS.                                              19680000
196900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           19690000
197000             NOT EQUAL ZERO                                       19700000
197100* IF THE ITEM IS SELECTED, PROCESS IT (CHECKS ASC-TEMP-SELECT     19710067
197200* BECAUSE THE PROGRAM HASN'T GONE THROUGHT THE EDITS YET, AND     19720067
197300* THAT WHERE ASC-TEMP-SELECT IS MOVED TO ASC-SELECT               19730067
197400         IF ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             19740067
197500             IF PS-FIRST-SELECT-NOT-FOUND                         19750067
197600                 MOVE 0        TO DP020-MSG-NUMBER                19760067
197700                 SET PS-FIRST-SELECT-FOUND TO TRUE                19770099
197900             END-IF                                               19790067
198000* IF THE LINE REQUEST INDICATOR IS GOING TO CHANGE, MAKE THE      19800073
198100* CHANGE, AND SET THE UPDATE ACTION CODE TO INSERT OR DELETE      19810073
198200* THE LINES (ONLY COMES INTO PLAY WHEN UPDATING AN EXISTING RQST  19820073
198300             IF PV-LNE-RQST-IND =                                 19830000
198400                    ASC-LNE-RQST-IND (ASC-BLK-SUB ASC-ITEM-SUB)   19840000
198500                 CONTINUE                                         19850000
198600             ELSE                                                 19860000
198700                 MOVE PV-LNE-RQST-IND                             19870000
198800                    TO ASC-LNE-RQST-IND (ASC-BLK-SUB ASC-ITEM-SUB)19880099
198900                 SET ASC-LNE-UPDATE(ASC-BLK-SUB ASC-ITEM-SUB)     19890000
199000                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE      19900099
199200                 IF PV-LNE-ON-RQST                                19920000
199300                     ADD +1    TO ASC-REQUEST-LINE-COUNT          19930000
199400                     MOVE PC-TSYMSG-01393 TO DP020-MSG-NUMBER     19940099
199600                     SET DP020-MSG-INFORMATIONAL TO TRUE          19960099
199800                 ELSE                                             19980000
199900                     SUBTRACT +1 FROM ASC-REQUEST-LINE-COUNT      19990000
200000                     MOVE PC-TSYMSG-01392 TO DP020-MSG-NUMBER     20000099
200200                     SET DP020-MSG-INFORMATIONAL TO TRUE          20020099
200400                 END-IF                                           20040000
200500             END-IF                                               20050000
200600         END-IF                                                   20060000
200700     END-IF.                                                      20070000
201100                                                                  20071099
200800*----------------------------------------------------------------*20080071
200900*    SET EACH REQUEST INIDICATOR ACCRDINGLY                      *20090071
201000* ---------------------------------------------------------------*20100071
201200 2170-REFRESH-COMMAREA.                                           20120071
201300*  RE-READ QUEUE TO REFRESH CURRENT INFORMATION                   20130071
201400     MOVE ASC-LIST-ITEM-NUMBER (1 1)  TO PV-LIST-ITEM-NUMBER      20140072
201500                                  PV-TOP-ITEM                     20150071
201600     COMPUTE PV-BLOCK-NUMBER =                                    20160071
201700        1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL)      20170071
201800                                                                  20180071
201900     MOVE 1                    TO ASC-BLK-SUB                     20190071
202000     PERFORM 4410-READ-TEMP-STORAGE                               20200071
202100     IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN PV-BLOCK-NUMBER    20210071
202200         ADD 1                 TO ASC-BLK-SUB                     20220071
202300                                  PV-BLOCK-NUMBER                 20230071
202400         PERFORM 4410-READ-TEMP-STORAGE                           20240071
202500     END-IF.                                                      20250071
202600                                                                  20260071
202700******************************************************************20270000
202800** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **20280000
202900** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **20290000
203000******************************************************************20300000
203100 2200-MOVE-SCREEN-TO-COMMAREA.                                    20310000
203300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             20330000
203400     MOVE +1                       TO PV-SUB.                     20340000
203600     PERFORM 3100-SET-SUBSCRIPTS.                                 20360000
203700     IF  ASTRTITL > ZERO                                          20370000
203800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          20380000
203900     ELSE                                                         20390000
204000         IF  ASTRTITF = DP015-ERASE-EOF                           20400000
204100             INITIALIZE ASC-START-ITEM-REQUEST                    20410000
204200         END-IF                                                   20420000
204300     END-IF.                                                      20430000
204400                                                                  20440000
204500     IF  AREQTYPL > ZERO                                          20450000
204600         MOVE AREQTYPI         TO ASC-REQ-TYP-CDE                 20460000
204700     ELSE                                                         20470000
204800         IF  AREQTYPF = DP015-ERASE-EOF                           20480000
204900             INITIALIZE ASC-REQ-TYP-CDE                           20490000
205000         END-IF                                                   20500000
205100     END-IF.                                                      20510000
205200                                                                  20520000
205300     IF  AVDUEDTL > ZERO                                          20530000
205400         MOVE AVDUEDTI         TO PV-DATE-USA                     20540000
205500         MOVE PV-DATE-CC-USA   TO PV-DATE-CC-ISO                  20551099
205500         MOVE PV-DATE-YY-USA   TO PV-DATE-YY-ISO                  20552099
205500         MOVE PV-DATE-MM-USA   TO PV-DATE-MM-ISO                  20553099
205500         MOVE PV-DATE-DD-USA   TO PV-DATE-DD-ISO                  20554099
205600         MOVE PV-DATE-ISO      TO ASC-VENDOR-DUE-DATE             20560000
205700     ELSE                                                         20570000
205800         IF  AVDUEDTF = DP015-ERASE-EOF                           20580000
205900             INITIALIZE ASC-VENDOR-DUE-DATE                       20590000
206000         END-IF                                                   20600000
206100     END-IF.                                                      20610000
206200                                                                  20620000
206300     IF  ADTTYPL  > ZERO                                          20630000
206400         MOVE ADTTYPI          TO ASC-DEFAULT-TICKET-TYPE         20640000
206500     ELSE                                                         20650000
206600         IF  ADTTYPF  = DP015-ERASE-EOF                           20660000
206700             INITIALIZE ASC-DEFAULT-TICKET-TYPE                   20670000
206800         END-IF                                                   20680000
206900     END-IF.                                                      20690000
207000                                                                  20700000
207100     IF  ADTPLCL  > ZERO                                          20710000
207200         MOVE ADTPLCI          TO ASC-DEFAULT-TICKET-PLACE        20720000
207300     ELSE                                                         20730000
207400         IF  ADTPLCF  = DP015-ERASE-EOF                           20740000
207500             INITIALIZE ASC-DEFAULT-TICKET-PLACE                  20750000
207600         END-IF                                                   20760000
207700     END-IF.                                                      20770000
207800                                                                  20780000
207900     IF  ADOPBLKL > ZERO                                          20790000
208000         MOVE ADOPBLKI         TO ASC-DEFAULT-OPTION-BLOCK        20800000
208100     ELSE                                                         20810000
208200         IF  ADOPBLKF = DP015-ERASE-EOF                           20820000
208300             INITIALIZE ASC-DEFAULT-OPTION-BLOCK                  20830000
208400         END-IF                                                   20840000
208500     END-IF.                                                      20850000
208600                                                                  20860000
208700     IF  ADTKQTYL > ZERO                                          20870000
208800         MOVE ADTKQTYI         TO ASC-DEFAULT-QUANTITY            20880000
208900     ELSE                                                         20890000
209000         IF  ADTKQTYF = DP015-ERASE-EOF                           20900000
209100             INITIALIZE ASC-DEFAULT-QUANTITY                      20910000
209200         END-IF                                                   20920000
209300     END-IF.                                                      20930000
209400                                                                  20940000
209500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          20950000
209600         VARYING PV-SUB                                           20960000
209700         FROM 1 BY 1                                              20970000
209800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      20980000
209400                                                                  20981099
209900******************************************************************20990000
210000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**21000000
210100******************************************************************21010000
210200 2210-MOVE-LINES-TO-COMMAREA.                                     21020000
210300     IF  MR-SELECTL (PV-SUB) > ZERO                               21030000
210400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             21040000
210500         MOVE MR-SELECTI (PV-SUB) TO ASC-TEMP-SELECTED-SW         21050099
210700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21070000
210800     ELSE                                                         21080000
210900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                21090000
211000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     21100000
211100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        21110000
211200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21120000
211300         END-IF                                                   21130000
211400     END-IF.                                                      21140000
211500                                                                  21150000
211600     IF  MR-TICKET-TYPEL (PV-SUB) > ZERO                          21160000
211700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     21170000
211800             ASC-TTYPE-MOD (ASC-BLK-SUB ASC-ITEM-SUB)             21180000
211900             ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE    21190000
212000         MOVE MR-TICKET-TYPE  (PV-SUB) TO ASC-TICKET-TYPE         21200099
212200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21220000
212300     ELSE                                                         21230000
212400         IF  MR-TICKET-TYPEA (PV-SUB) = DP015-ERASE-EOF           21240000
212500                 SET ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)    21250089
212600                     ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     21260089
212700                 MOVE SPACE        TO ASC-TICKET-TYPE             21270000
212800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21280000
212900         END-IF                                                   21290000
213000     END-IF.                                                      21300000
213100                                                                  21310000
213200     IF  MR-TICKET-PLACEL (PV-SUB) > ZERO                         21320000
213300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     21330000
213400             ASC-TPLACE-MOD (ASC-BLK-SUB ASC-ITEM-SUB)            21340000
213500             ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)            21350000
213600                                   TO TRUE                        21360000
213700         MOVE MR-TICKET-PLACE  (PV-SUB) TO ASC-TICKET-PLACE       21370099
213900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21390000
214000     ELSE                                                         21400000
214100         IF  MR-TICKET-PLACEA (PV-SUB) = DP015-ERASE-EOF          21410000
214200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             21420000
214300                     ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)    21430000
214400                                   TO TRUE                        21440000
214500                 MOVE SPACE        TO ASC-TICKET-PLACE            21450000
214600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21460000
214700         END-IF                                                   21470000
214800     END-IF.                                                      21480000
214900                                                                  21490000
215000     IF  MR-OPTION-BLOCKL (PV-SUB) > ZERO                         21500000
215100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     21510000
215200             ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE    21520000
215300         MOVE MR-OPTION-BLOCK  (PV-SUB)  TO ASC-OPTION-BLOCK      21530099
215500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21550000
215600     ELSE                                                         21560000
215700         IF  MR-OPTION-BLOCKA (PV-SUB) = DP015-ERASE-EOF          21570000
215800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             21580000
215900                     ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)    21590000
216000                                   TO TRUE                        21600000
216100                 MOVE SPACE        TO ASC-OPTION-BLOCK            21610000
216200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21620000
216300         END-IF                                                   21630000
216400     END-IF.                                                      21640000
216500                                                                  21650000
216600     IF  MR-QUANTITYL (PV-SUB) > ZERO                             21660000
216700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     21670000
216800             ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE    21680000
216900         MOVE MR-QUANTITY (PV-SUB) TO ASC-RQST-QUANTITY           21690099
217100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21710000
217200     ELSE                                                         21720000
217300         IF  MR-QUANTITYA (PV-SUB) = DP015-ERASE-EOF              21730000
217400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             21740000
217500                     ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)    21750000
217600                                   TO TRUE                        21760000
217700                 MOVE ASC-PO-QUANTITY (ASC-BLK-SUB ASC-ITEM-SUB)  21770000
217800                                   TO ASC-RQST-QUANTITY           21780000
217900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21790000
218000         END-IF                                                   21800000
218100     END-IF.                                                      21810000
218200                                                                  21820000
218300     ADD +1                        TO ASC-ITEM-SUB.               21830000
218400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21840000
218500         ADD +1                    TO ASC-BLK-SUB                 21850000
218600         MOVE +1                   TO ASC-ITEM-SUB                21860000
218700     END-IF.                                                      21870000
218200                                                                  21871099
218800******************************************************************21880000
218900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **21890000
219000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **21900000
219100******************************************************************21910000
219200 3000-EDIT-DATA-IN-COMMAREA.                                      21920000
219300     SET PS-NO-ERROR               TO TRUE.                       21930000
219400     PERFORM 3200-RESET-ATTRIBUTES.                               21940000
219500* THE DEFAULT EDITTING IS DONE HERE SO THE EDITS OF THE DETAIL    21950058
219600* LINES WILL CATCH ANY ERROR WITH THE DEFAULTS. (SHOULD REALLY BE 21960058
219700* AFTER THE LINE EDITS!!)                                         21970058
219800                                                                  21980058
219900     MOVE ASC-DEFAULT-OPTION-BLOCK    TO PV-OPTION-BLOCK          21990058
220000     IF PV-VALID-OPTION-BLOCK                                     22000058
220100     OR PV-OPTION-BLOCK = SPACES                                  22010058
220200         CONTINUE                                                 22020058
220300     ELSE                                                         22030058
220400         MOVE PC-TSYMSG-01357         TO DP020-MSG-NUMBER         22040058
220500         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     22050058
220600         SET DP020-MSG-FATAL          TO TRUE                     22060058
220700         MOVE -1                      TO ADOPBLKL                 22070058
220800         MOVE DP015-REVERSE           TO ADOPBLKH                 22080058
220900         MOVE DP015-RED               TO ADOPBLKC                 22090058
221000     END-IF.                                                      22100058
221100                                                                  22110058
221200     IF ASC-DEFAULT-TICKET-PLACE > SPACES                         22120058
221300         MOVE ASC-DEFAULT-TICKET-PLACE    TO DK-TICKET-PLACEMENT  22130058
221400         PERFORM 3010-VALIDATE-TICKET-PLACE                       22140058
221500         IF PS-NOT-A-VALID-TICK-PLACE                             22150058
221600             MOVE PC-TSYMSG-01347         TO DP020-MSG-NUMBER     22160058
221700             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 22170058
221800             SET DP020-MSG-FATAL          TO TRUE                 22180058
221900             MOVE -1                      TO ADTPLCL              22190058
222000             MOVE DP015-REVERSE           TO ADTPLCH              22200058
222100             MOVE DP015-RED               TO ADTPLCC              22210058
222200         END-IF                                                   22220058
222300     ELSE                                                         22230058
222400         SET PS-NOT-A-VALID-TICK-PLACE    TO TRUE                 22240058
222500     END-IF.                                                      22250058
222600                                                                  22260058
222700     IF ASC-DEFAULT-QUANTITY     = SPACE                          22270089
222800         CONTINUE                                                 22280089
222900     ELSE                                                         22290089
223000         MOVE ASC-DEFAULT-QUANTITY TO DP010I-UNEDITED-FIELD       22300099
223200         MOVE +8                   TO DP010I-MAXIMUM-DIGITS       22320089
223300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     22330089
223400         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  22340099
223600                                                                  22360089
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         22371099
263627              USING DP010I-NUMERIC-EDIT-AREA                      22372099
223800                                                                  22380089
223900         EVALUATE TRUE                                            22390089
224000           WHEN DP010I-NO-ERROR-DETECTED                          22400099
224100             MOVE DP010I-NUMERIC-FIELD TO ASC-DEFAULT-QUANTITY-N  22410099
224300             IF  ASC-DEFAULT-QUANTITY-N      > 0                  22430099
224500                 AND ASC-DEFAULT-QUANTITY-N < 9999999             22450099
224700                 SET PS-VALID-QUANTITY TO TRUE                    22470058
224800             ELSE                                                 22480089
224900                  MOVE PC-TSYMSG-01467   TO DP020-MSG-NUMBER      22490089
225000                  SET DP020-MSG-FATAL    TO TRUE                  22500089
225100                  MOVE -1                TO ADTKQTYL              22510089
225200                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             22520099
225400                  MOVE DP015-RED         TO ADTKQTYC              22540089
225500                  MOVE DP015-REVERSE     TO ADTKQTYH              22550089
225600                  SET PS-ERROR TO TRUE                            22560089
225700             END-IF                                               22570089
225800           WHEN DP010I-NEG-NOT-ALLOWED                            22580099
225900           WHEN DP010I-MAX-DIGITS-EXCEEDED                        22590099
226000              MOVE PC-TSYMSG-01467   TO DP020-MSG-NUMBER          22600089
226100              SET DP020-MSG-FATAL    TO TRUE                      22610089
226200              MOVE -1                TO ADTKQTYL                  22620089
226300              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 22630099
226500              MOVE DP015-RED         TO ADTKQTYC                  22650089
226600              MOVE DP015-REVERSE     TO ADTKQTYH                  22660089
226700              SET PS-ERROR TO TRUE                                22670089
226800           WHEN OTHER                                             22680099
226900              MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER          22690089
227000              SET DP020-MSG-FATAL    TO TRUE                      22700089
227100              MOVE -1                TO ADTKQTYL                  22710089
227200              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 22720099
227400              MOVE DP015-RED         TO ADTKQTYC                  22740089
227500              MOVE DP015-REVERSE     TO ADTKQTYH                  22750089
227600              SET PS-ERROR TO TRUE                                22760089
227700         END-EVALUATE                                             22770089
227800     END-IF.                                                      22780089
227900                                                                  22790058
228000     IF ASC-DEFAULT-TICKET-TYPE  > SPACES                         22800058
228100         IF ASC-DEFAULT-TICKET-TYPE = 'DEFAULT'                   22810058
228200             SET PS-VALID-TICK-TYPE       TO TRUE                 22820058
228300         ELSE                                                     22830058
228400             MOVE ASC-DEFAULT-TICKET-TYPE TO DK-TICKET-TYPE       22840058
228400***************   DK-TICKET-TYPE  = TKT FMT ID BEFORE 3045-       22841099
228500             PERFORM 3045-DEFAULT-TICKET-FORMAT                   22850040
228400***************   DK-TICKET-TYPE  = TKT FMT DESC AFTER 3045-      22850299
230400             PERFORM 3050-VALIDATE-TICKET-FORMAT                  23040099
230500             IF PS-VALID-TICK-FMT                                 23050099
230600                 SET ASC-DEFAULT-TTYPE-PRINT-YES TO TRUE          23060099
230800             ELSE                                                 23080099
230900                 SET ASC-DEFAULT-TTYPE-PRINT-NO TO TRUE           23090099
231100             END-IF                                               23110099
231300         END-IF                                                   23130058
231400     ELSE                                                         23140058
231500         SET PS-NOT-A-VALID-TICK-TYPE     TO TRUE                 23150058
231600     END-IF.                                                      23160058
231700                                                                  23170058
231800     IF  (PS-VALID-TICK-PLACE)                                    23180058
231900     OR  (PV-VALID-OPTION-BLOCK)                                  23190058
232000     OR  (PS-VALID-TICK-TYPE)                                     23200058
232100     OR  (PS-VALID-QUANTITY)                                      23210058
232200         PERFORM 3020-DEFAULT-LINES                               23220058
232300     END-IF.                                                      23230058
232400                                                                  23240058
232500* LINE EDITTING                                                   23250058
232600**                                                                23260000
232700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              23270000
232800* EDITTING IS DONE FROM THE BOTTOM UP.                            23280000
232900**                                                                23290000
233000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     23300058
233100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       23310000
233200         ASC-ITEMS-DISPLAYED - 1.                                 23320000
233300     PERFORM 3100-SET-SUBSCRIPTS.                                 23330000
233400     PERFORM 3300-EDIT-SELECTIONS                                 23340000
233500         VARYING PV-SUB                                           23350000
233600         FROM PV-SUB BY -1                                        23360000
233700         UNTIL PV-SUB < +1.                                       23370000
233800                                                                  23380099
233900     IF  PS-NO-ERROR                                              23390000
234000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        23400000
234100     END-IF.                                                      23410000
234200                                                                  23420099
234300     IF  ((PS-NO-ERROR)                                           23430000
234400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   23440000
234500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    23450000
234600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  23460000
234700     END-IF.                                                      23470000
234800                                                                  23480000
234900* ALL "NON-LIST" EDITTING AFTER THIS                              23490000
235000                                                                  23500058
235100* PRETICKET ADDRESS EDIT CHECK.......                             23510000
235200* NO REQUEST CAN BE MADE IF THERE IS NO PRETICKET ADDRESS         23520000
235300     IF ASC-ADDR-DOESNT-EXIST                                     23530000
235400         MOVE PC-TSYMSG-01351         TO DP020-MSG-NUMBER         23540035
235500         SET PS-ERROR                                             23550000
235600             DP020-MSG-FATAL                                      23560000
235700             DP030-SET-CURSOR-APPL-1  TO TRUE                     23570000
235800         MOVE -1                      TO AADDR1L                  23580000
235900         MOVE DP015-REVERSE           TO AADDR1H                  23590000
236000         MOVE DP015-RED               TO AADDR1C                  23600000
236100     END-IF.                                                      23610000
236200* NO REQUEST CAN BE MADE IF THE ADDRESS IS INVALID                23620000
236300     IF ASC-ADDR-INVALID                                          23630000
236400         MOVE PC-TSYMSG-01335         TO DP020-MSG-NUMBER         23640035
236500         SET PS-ERROR                                             23650000
236600             DP020-MSG-FATAL                                      23660000
236700             DP030-SET-CURSOR-APPL-1  TO TRUE                     23670000
236800     END-IF.                                                      23680000
237000                                                                  23700000
237100* VENDOR DUE DATE EDIT CHECKS                                     23710000
237200* THE FIRST CALL WILL CHECK IF THE SCREEN VENDOR DUE DATE IS VALID23720099
237300* AND DETERMINE WHAT THE PRINT DUE DATE WOULD BE.  THE SECOND     23730000
237400* CALL WILL DETERMINE IF THE PRINT DUE DATE IS SET BEFORE THE     23740000
237500* CURRENT DATE - IF THIS HAPPENS, THE REQUEST WILL BE PUT IN      23750000
237600* "RUSH" STATUS, AND WILL DISPLAY A MESSAGE TELLING THE USER TO   23760000
237700* CALL THE VENDOR LOGISTICS OFFICE.                               23770000
237800     IF ASC-VENDOR-DUE-DATE = SPACES                              23780000
237900         MOVE ASC-VENDOR-DFLT-DUE-DATE TO ASC-VENDOR-DUE-DATE     23790000
238000     END-IF.                                                      23800000
238100                                                                  23810000
238200* VALIDATE THE DUE DATE, AND CALCULATE THE PRINT DUE DATE         23820000
238300     IF  PS-NO-ERROR                                              23830099
238400         PERFORM 3030-VALIDATE-VENDOR-DUE-DATE                    23840099
238500     END-IF.                                                      23850099
238700                                                                  23870000
238800* REQUEST TYPE EDIT CHECKS                                        23880000
238900     EVALUATE ASC-REQ-TYP-CDE                                     23890000
239000     WHEN 'P'                                                     23900000
239100         MOVE 'PRETICKET '                TO ASC-REQ-TYP-CDE-DESC 23910000
239200     WHEN 'L'                                                     23920000
239300         MOVE ASC-ENT-ID                  TO DK-ENT-ID            23930080
239400         MOVE ASC-DEPT-NBR                TO DK-DEPT-NBR          23940080
239500         PERFORM 3060-CHECK-BULK-IND                              23950047
239600         MOVE 'LOCKER STK'                TO ASC-REQ-TYP-CDE-DESC 23960000
239700     WHEN OTHER                                                   23970000
239800         SET DP030-SET-CURSOR-APPL-1      TO TRUE                 23980000
239900         MOVE PC-TSYMSG-01338             TO DP020-MSG-NUMBER     23990000
240000         MOVE -1                          TO AREQTYPL             24000000
240100         MOVE DP015-REVERSE               TO AREQTYPH             24010000
240200         MOVE DP015-RED                   TO AREQTYPC             24020000
240300         SET DP020-MSG-FATAL              TO TRUE                 24030000
240400     END-EVALUATE.                                                24040000
240500                                                                  24050000
240600*----------------------------------------------------------------*24060000
240700*    SELECT THE TICKET PLACEMENT CODE FROM THE TICKET PLACEMENT  *24070000
240800*    DESCRIPTION TABLE TO VERIFIY THAT IT EXISTS.                *24080000
240900*----------------------------------------------------------------*24090000
241100 3010-VALIDATE-TICKET-PLACE.                                      24110000
241300     PERFORM                                                      24130000
241400         WITH TEST AFTER                                          24140000
241500         VARYING PV-RETRY-COUNTER                                 24150000
241600         FROM 1 BY 1                                              24160000
241700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24170000
241800                   OR (SQLCODE = ZERO)                            24180000
241900                   OR (SQLCODE = +100))                           24190000
242000                                                                  24200000
242100         EXEC SQL                                                 24210000
242200             SELECT  TKT_PLCMNT_DESC                              24220099
242400             INTO    :PLDESC-TKT-PLCMNT-DESC                      24240099
242600             FROM    TPLDESC                                      24260099
242800             WHERE   TKT_PLCMNT_CDE = :DK-TICKET-PLACEMENT        24280099
243000         END-EXEC                                                 24300000
243100                                                                  24310000
243200         EVALUATE TRUE                                            24320000
243300             WHEN SQLCODE = ZERO                                  24330000
243400                 SET PS-VALID-TICK-PLACE TO TRUE                  24340000
243600             WHEN SQLCODE = +100                                  24360000
243700                 SET PS-NOT-A-VALID-TICK-PLACE                    24370000
243800                     PS-ERROR TO TRUE                             24380000
244000             WHEN SQLCODE = -904                                  24400000
244100             WHEN SQLCODE = -913                                  24410000
244200                 CONTINUE                                         24420000
244400             WHEN SQLWARN0 NOT = SPACES                           24440000
244500             WHEN SQLCODE < ZERO                                  24450000
244600             WHEN SQLCODE > ZERO                                  24460000
244700                 MOVE '3010-VALIDATE-TICKET-PLACE'                24470000
244800                                   TO DP013-PARAGRAPH             24480000
244900                 MOVE 'SELECT THE THE TICKET PLACEMENT'           24490000
245000                                   TO DP013-MESSAGE-TEXT (1)      24500000
245100                 MOVE DK-TICKET-PLACEMENT                         24510000
245200                                   TO DP013-MESSAGE-TEXT (2)      24520000
245300                 MOVE SQLCA        TO DP013-SQLCA                 24530000
245400                 MOVE 'TPLDESC '   TO DP013-DB2-TABLE-NAME (1)    24540000
245500                 SET DP013-DB2-ABEND                              24550000
245600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           24560000
245700                 PERFORM DP013-0000-PROCESS-ABEND                 24570000
245800         END-EVALUATE                                             24580000
245900     END-PERFORM.                                                 24590000
246000                                                                  24600099
246100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24610000
246200         MOVE '3010-VALIDATE-TICKET-PLACE'                        24620000
246300                                   TO DP013-PARAGRAPH             24630000
246400         MOVE 'MAX RETRIES EXCEEDED SELECTING TICKET PLACEMENT'   24640099
246500                                   TO DP013-MESSAGE-TEXT (1)      24650000
246600         MOVE SQLCA                TO DP013-SQLCA                 24660000
246700         MOVE 'TPLDESC '           TO DP013-DB2-TABLE-NAME (1)    24670000
246800         SET DP013-DB2-ABEND                                      24680000
246900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   24690099
247100         PERFORM DP013-0000-PROCESS-ABEND                         24710000
247200     END-IF.                                                      24720000
247300                                                                  24730099
247400*----------------------------------------------------------------*24740000
247500*  IF THE USER FILLS ONE OF THE DEFAULT VALUES, MOVE IT INTO     *24750099
247600*  EACH SELECTED LINE                                            *24760000
247700*----------------------------------------------------------------*24770000
247900 3020-DEFAULT-LINES.                                              24790018
248100     MOVE +1                       TO ASC-BLK-SUB.                24810000
248300     PERFORM 3021-SET-DEFAULT-VALUES                              24830000
248400         VARYING ASC-ITEM-SUB                                     24840000
248500         FROM 1 BY 1                                              24850000
248600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24860000
248800     ADD +1                        TO ASC-BLK-SUB.                24880000
249000     PERFORM 3021-SET-DEFAULT-VALUES                              24900000
249100         VARYING ASC-ITEM-SUB                                     24910000
249200         FROM 1 BY 1                                              24920000
249300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24930000
249500     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       24950099
249800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            24980000
249900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24990000
250100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     25010000
250200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    25020000
250300         MOVE +1                   TO ASC-BLK-SUB                 25030000
250500         PERFORM 5100-WRITE-TEMP-STORAGE                          25050000
250700         MOVE +1                   TO PV-BLOCK-NUMBER             25070000
250900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         25090000
251000             PV-FIRST-BLOCK-IN-ARRAY - 1                          25100000
251200         PERFORM                                                  25120000
251300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       25130000
251500             PERFORM 4410-READ-TEMP-STORAGE                       25150000
251700             PERFORM 3021-SET-DEFAULT-VALUES                      25170000
251800                 VARYING ASC-ITEM-SUB                             25180000
251900                 FROM 1 BY 1                                      25190000
252000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          25200000
252200             PERFORM 5100-WRITE-TEMP-STORAGE                      25220000
252400             ADD +1                TO PV-BLOCK-NUMBER             25240000
252600         END-PERFORM                                              25260000
252800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         25280000
252900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     25290000
253100         PERFORM                                                  25310000
253200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       25320000
253300                   ASC-HIGHEST-BLOCK-WRITTEN                      25330000
253500             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       25350099
253800             PERFORM 4410-READ-TEMP-STORAGE                       25380000
254000             PERFORM 3021-SET-DEFAULT-VALUES                      25400000
254100                 VARYING ASC-ITEM-SUB                             25410000
254200                 FROM 1 BY 1                                      25420000
254300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          25430000
254500             PERFORM 5100-WRITE-TEMP-STORAGE                      25450000
254700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      25470000
254900         END-PERFORM                                              25490000
255100         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          25510099
255400         PERFORM 4410-READ-TEMP-STORAGE                           25540000
255500     END-IF.                                                      25550000
255600                                                                  25560000
255700     MOVE SPACES                 TO ASC-DEFAULT-TICKET-PLACE      25570022
255800                                    ASC-DEFAULT-TICKET-TYPE       25580022
255900                                    ASC-DEFAULT-OPTION-BLOCK      25590022
256000                                    ASC-DEFAULT-QUANTITY.         25600022
256100                                                                  25610022
256200     SET PS-RESET-LINES    TO TRUE.                               25620091
256300     MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM                 25630091
256400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        25640091
256500     SET PS-NO-RESET-LINES TO TRUE.                               25650091
256700                                                                  25670000
256800 3021-SET-DEFAULT-VALUES.                                         25680000
256900     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) > 0      25690017
257000     AND ASC-TEMP-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               25700089
257100         IF  ASC-DEFAULT-TICKET-TYPE  > SPACES                    25710000
257200             IF  ASC-DEFAULT-TICKET-TYPE = 'DEFAULT'              25720025
257300                 PERFORM 4320-GET-DEFAULT-TICKET-TYPE             25730038
257400             ELSE                                                 25740025
257500                 MOVE ASC-DEFAULT-TICKET-TYPE                     25750025
257600                       TO ASC-TICKET-TYPE                         25760025
257700                          (ASC-BLK-SUB ASC-ITEM-SUB)              25770025
257800                 MOVE ASC-DEFAULT-TTYPE-PRINT-SW                  25780040
257900                       TO ASC-TTYPE-PRINT-SW                      25790040
258000                          (ASC-BLK-SUB ASC-ITEM-SUB)              25800040
258100                 IF ASC-RETURN-FROM-TKTTYPE                       25810003
258200                      SET ASC-TTYPE-PRINT-YES                     25820040
258300                          (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE      25830099
258500                 END-IF                                           25850089
258600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE      25860025
258700             END-IF                                               25870026
258800             SET ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)        25880089
258900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          25890089
259000         END-IF                                                   25900026
259100                                                                  25910000
259200         IF  ASC-DEFAULT-TICKET-PLACE > SPACES                    25920000
259300             MOVE ASC-DEFAULT-TICKET-PLACE                        25930000
259400                   TO ASC-TICKET-PLACE (ASC-BLK-SUB ASC-ITEM-SUB) 25940000
259500             SET ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)        25950089
259600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          25960089
259700         END-IF                                                   25970017
259800                                                                  25980000
259900         IF  ASC-DEFAULT-OPTION-BLOCK > SPACES                    25990000
260000             IF ASC-DEFAULT-OPTION-BLOCK = 'N/A'                  26000000
260100                MOVE SPACES                                       26010000
260200                   TO ASC-OPTION-BLOCK (ASC-BLK-SUB ASC-ITEM-SUB) 26020000
260300             ELSE                                                 26030000
260400                MOVE ASC-DEFAULT-OPTION-BLOCK                     26040000
260500                   TO ASC-OPTION-BLOCK (ASC-BLK-SUB ASC-ITEM-SUB) 26050000
260600             END-IF                                               26060000
260700             SET ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)        26070089
260800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          26080089
260900         END-IF                                                   26090017
261000                                                                  26100000
261100         IF  ASC-DEFAULT-QUANTITY     > SPACES                    26110000
261200             MOVE ASC-DEFAULT-QUANTITY                            26120000
261300               TO ASC-RQST-QUANTITY (ASC-BLK-SUB ASC-ITEM-SUB)    26130000
261400             SET ASC-LNE-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)        26140089
261500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          26150089
261600          END-IF                                                  26160000
261800     END-IF.                                                      26180076
261900                                                                  26190000
262100*----------------------------------------------------------------*26210000
262200*    VALIDATE THE VENDOR DUE DATE - CORRECT FORMAT, AND WITHIN   *26220000
262300*    THE CORRECT RANGE.                                          *26230000
262400*----------------------------------------------------------------*26240000
262600 3030-VALIDATE-VENDOR-DUE-DATE.                                   26260000
262700     INITIALIZE DPG51 DPG52 DPG53                                 26270099
262800                DPG54 DPG55 DPG56.                                26280099
262900                                                                  26290000
263000     SET DPG51-ACTUAL-CALENDAR-ONLY                               26300000
263100         DPG51-DECREMENT-DATE         TO TRUE.                    26310000
263300     IF ASC-ADDR-COUNTRY = 'US'                                   26330000
263400        OR ASC-ADDR-COUNTRY = SPACES                              26340099
263500         MOVE 12  TO DPG51-INCR-DECR-BUS-DAYS-9                   26350000
263600     ELSE                                                         26360000
263700         MOVE 14  TO DPG51-INCR-DECR-BUS-DAYS-9                   26370000
263800     END-IF.                                                      26380000
264000     MOVE ASC-VENDOR-DUE-DATE         TO DPG52-LK-DATE-INPUT.     26400000
264100     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    26410000
264200                                                                  26420000
264300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    26430099
264400                                             DPG54 DPG55 DPG56.   26440099
264500                                                                  26450000
264600     EVALUATE TRUE                                                26460000
264700         WHEN DPG54-NO-ERROR                                      26470000
264800             EVALUATE TRUE                                        26480000
264900*                VENDOR DUE DATE BEFORE THE CURRENT DATE          26490000
265000                 WHEN ASC-VENDOR-DUE-DATE <  ASC-CURRENT-DATE     26500000
265100                     SET DP030-SET-CURSOR-APPL-1                  26510000
265200                         DP020-MSG-FATAL                          26520000
265300                         PS-ERROR             TO TRUE             26530000
265400                     MOVE PC-TSYMSG-01340     TO DP020-MSG-NUMBER 26540000
265500                     MOVE -1                  TO AVDUEDTL         26550000
265600                     MOVE DP015-REVERSE       TO AVDUEDTH         26560000
265700                     MOVE DP015-RED           TO AVDUEDTC         26570000
265900*                VENDOR DUE DATE IS AFTER THE PO CANCEL DATE      26590000
266000                 WHEN ASC-VENDOR-DUE-DATE >  ASC-VENDOR-CAN-DATE  26600000
266100                     SET DP030-SET-CURSOR-APPL-1                  26610000
266200                         DP020-MSG-FATAL                          26620000
266300                         PS-ERROR             TO TRUE             26630000
266400                     MOVE ASC-VENDOR-CAN-DATE TO PV-DATE-ISO      26640000
205500                     MOVE PV-DATE-CC-ISO      TO PV-DATE-CC-USA   26651099
205500                     MOVE PV-DATE-YY-ISO      TO PV-DATE-YY-USA   26652099
205500                     MOVE PV-DATE-MM-ISO      TO PV-DATE-MM-USA   26653099
205500                     MOVE PV-DATE-DD-ISO      TO PV-DATE-DD-USA   26654099
266600                     MOVE PV-DATE-USA         TO DP020-MSG-TEXT   26660000
266700                     MOVE PC-TSYMSG-01364     TO DP020-MSG-NUMBER 26670000
266800                     MOVE -1                  TO AVDUEDTL         26680000
266900                     MOVE DP015-REVERSE       TO AVDUEDTH         26690000
267000                     MOVE DP015-RED           TO AVDUEDTC         26700000
267200* VENDOR DUE DATE IS FORMATTED CORRECTLY, AND IS WITHIN THE       26720000
267300* CORRECT RANGE OF DATES, CHECK CALCULATED PRINT DATE             26730000
267400                 WHEN OTHER                                       26740000
267500                     MOVE DPG55-DB2-ISO-DATE-FMT                  26750000
267600                                            TO ASC-PRINT-DUE-DATE 26760000
267700                                               PV-DATE-ISO        26770000
205500                     MOVE PV-DATE-CC-ISO    TO PV-DATE-CC-USA     26781099
205500                     MOVE PV-DATE-YY-ISO    TO PV-DATE-YY-USA     26782099
205500                     MOVE PV-DATE-MM-ISO    TO PV-DATE-MM-USA     26783099
205500                     MOVE PV-DATE-DD-ISO    TO PV-DATE-DD-USA     26784099
267900                     MOVE PV-DATE-USA       TO APDUEDTO           26790000
268100                     IF ASC-PRINT-DUE-DATE <= ASC-CURRENT-DATE    26810000
268200*                        DISPLAY WARNING ABOUT RUSH ORDER         26820000
268300                         SET DP030-SET-CURSOR-APPL-1              26830000
268400                             PS-DISPLAY-RUSH  TO TRUE             26840000
268500                         MOVE -1              TO AVDUEDTL         26850000
268600                         MOVE DP015-REVERSE   TO AVDUEDTH         26860000
268700                         MOVE DP015-YELLOW    TO AVDUEDTC         26870000
268800                         SET ASC-REQ-STAT-RUSH TO TRUE            26880099
269000                     ELSE                                         26900000
269100* IF THE CURRENT STATUS IS RUSH, THAT MEANS THE USER CHANGED THE  26910029
269200* DUE DATE IN ORDER TO GET IT OUT OF RUSH.  AT THAT POINT, WE NEED26920029
269300* TO DETERMIN WHAT THE NEW STATUS SHOULD BE.  IF THE ACTION FLAG  26930029
269400* IS TO UPDATE OR ADD A RESUBMITTED REQUEST, THE STATUS SHOULD BE 26940029
269500* HOLD, OTHERWISE IT IS JUST A NORMAL REQUEST, AND IT SHOULD BE   26950029
269600* CHANGED TO ACTIVE.                                              26960029
269700                         IF ASC-REQ-STAT-RUSH                     26970029
269800                             IF ASC-RESUB-REQ                     26980029
269900                             OR ASC-UPDATE-RESUB                  26990029
270000                                 SET ASC-REQ-STAT-HOLD   TO TRUE  27000030
270100                             ELSE                                 27010029
270200                                 SET ASC-REQ-STAT-ACTIVE TO TRUE  27020030
270300                             END-IF                               27030029
270400                         END-IF                                   27040029
270500                         SET PS-NO-RUSH       TO TRUE             27050029
270600                     END-IF                                       27060000
270700             END-EVALUATE                                         27070000
270900         WHEN DPG54-DATE-INVALID                                  27090000
271000*            DISPLAY INVALID DATE ERROR MESSAGE                   27100000
271100             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 27110000
271200             MOVE PC-TSYMSG-01339         TO DP020-MSG-NUMBER     27120000
271300             MOVE -1                      TO AVDUEDTL             27130000
271400             MOVE DP015-REVERSE           TO AVDUEDTH             27140000
271500             MOVE DP015-RED               TO AVDUEDTC             27150000
271600             SET DP020-MSG-FATAL                                  27160000
271700                 PS-ERROR                 TO TRUE                 27170000
271800         WHEN OTHER                                               27180000
271900             SET DP013-LOGIC-ABEND TO TRUE                        27190000
272000             SET DP013-NO-ROLLBACK TO TRUE                        27200000
272100             MOVE '3030-VALIDATE-VENDOR-DUE-DATE'                 27210099
272200                                   TO DP013-PARAGRAPH             27220000
272300             MOVE 'ERROR CALLING DATE ROUTINE'                    27230099
272400                                   TO DP013-MESSAGE-TEXT(1)       27240000
272500             MOVE DPG54-ERROR-MESSAGE                             27250000
272600                                   TO DP013-MESSAGE-TEXT(2)       27260000
272700             PERFORM DP013-0000-PROCESS-ABEND                     27270000
272800     END-EVALUATE.                                                27280000
272900                                                                  27290000
280000***************************************************************** 28000099
280000* CHECK TO SEE IF THE SHORT FORMAT WAS ENTERED THEN MOVE IT       28001099
280100* TO THE FORMAT DESCRIPTION.                                      28010089
280000***************************************************************** 28011099
280200 3045-DEFAULT-TICKET-FORMAT.                                      28020040
280400     PERFORM                                                      28040040
280500         WITH TEST AFTER                                          28050040
280600         VARYING PV-RETRY-COUNTER                                 28060040
280700         FROM 1 BY 1                                              28070040
280800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28080040
280900                   OR (SQLCODE = ZERO)                            28090040
281000                   OR (SQLCODE = -811)                            28100055
281100                   OR (SQLCODE = +100))                           28110040
281200                                                                  28120040
281300         EXEC SQL                                                 28130040
281500             SELECT   TKT_FMT_ID                                  28150099
281600                    , TKT_FMT_DESC                                28160040
281800             INTO    :TKTFMT-TKT-FMT-ID                           28180099
281900                   , :TKTFMT-TKT-FMT-DESC                         28190040
282100             FROM    TTKTFMT                                      28210099
282300             WHERE  (TKT_FMT_ID   = :DK-TICKET-TYPE               28230099
282300                OR   TKT_FMT_DESC = :DK-TICKET-TYPE)              28240099
282500         END-EXEC                                                 28250040
282600                                                                  28260040
282700         EVALUATE TRUE                                            28270040
282800             WHEN SQLCODE = ZERO                                  28280040
282900             WHEN SQLCODE = -811                                  28290040
283000                 MOVE TKTFMT-TKT-FMT-DESC TO DK-TICKET-TYPE       28300089
283100                   ASC-TICKET-TYPE  (ASC-BLK-SUB ASC-ITEM-SUB)    28310060
283200                   ASC-DEFAULT-TICKET-TYPE                        28320040
283200                 SET PS-VALID-TICK-TYPE TO TRUE                   28321099
283300             WHEN SQLCODE = +100                                  28330040
283400                 CONTINUE                                         28340099
283500             WHEN SQLCODE = -904                                  28350040
283600             WHEN SQLCODE = -913                                  28360040
283700                 CONTINUE                                         28370040
283900             WHEN SQLWARN0 NOT = SPACES                           28390040
284000             WHEN SQLCODE < ZERO                                  28400040
284100             WHEN SQLCODE > ZERO                                  28410040
284200                 MOVE '3045-DEFAULT-TICKET-FORMAT'                28420040
284300                                   TO DP013-PARAGRAPH             28430040
284400                 MOVE 'SELECT TICKET TYPE FROM TTKTFMT'           28440099
284500                                   TO DP013-MESSAGE-TEXT (1)      28450040
284600                 MOVE DK-TICKET-TYPE                              28460040
284700                                   TO DP013-MESSAGE-TEXT (2)      28470040
284800                 MOVE SQLCA        TO DP013-SQLCA                 28480040
284900                 MOVE 'TKTFMT  '   TO DP013-DB2-TABLE-NAME (1)    28490040
285000                 SET DP013-DB2-ABEND                              28500040
285100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28510040
285200                 PERFORM DP013-0000-PROCESS-ABEND                 28520040
285300         END-EVALUATE                                             28530040
285400     END-PERFORM.                                                 28540040
285500                                                                  28550040
285600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28560040
285700         MOVE '3045-DEFAULT-TICKET-FORMAT' TO DP013-PARAGRAPH     28570099
285800         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING TICKET TYPE '   28580040
285900                                   TO DP013-MESSAGE-TEXT (1)      28590040
286000         MOVE SQLCA                TO DP013-SQLCA                 28600040
286100         MOVE 'TTKTFMT'           TO DP013-DB2-TABLE-NAME (1)     28610099
286200         SET DP013-DB2-ABEND                                      28620040
286300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   28630099
286500         PERFORM DP013-0000-PROCESS-ABEND                         28650040
286600     END-IF.                                                      28660040
286700                                                                  28670000
286800*----------------------------------------------------------------*28680040
286900*    SELECT THE TICKET FORMAT WHICH WILL BE USED BY THE DC TO    *28690040
287000*    PRINT THIS TICKET TYPE                                      *28700040
287100*----------------------------------------------------------------*28710040
287300 3050-VALIDATE-TICKET-FORMAT.                                     28730040
287500     PERFORM                                                      28750040
287600         WITH TEST AFTER                                          28760040
287700         VARYING PV-RETRY-COUNTER                                 28770040
287800         FROM 1 BY 1                                              28780040
287900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28790040
288000                   OR (SQLCODE = ZERO)                            28800040
288100                   OR (SQLCODE = -811)                            28810055
288200                   OR (SQLCODE = +100))                           28820040
288300                                                                  28830040
288400         EXEC SQL                                                 28840040
288600             SELECT   TKT_FMT_ID                                  28860099
288800             INTO    :TKTFMT-TKT-FMT-ID                           28880099
289000             FROM    TTKTFMT                                      28900099
289200             WHERE   TKT_FMT_DESC = :DK-TICKET-TYPE               28920099
289400               AND   TYP_CDE      = 'I'                           28940099
289600         END-EXEC                                                 28960098
289700                                                                  28970098
289800         EVALUATE TRUE                                            28980098
289900             WHEN SQLCODE = ZERO                                  28990098
290000             WHEN SQLCODE = -811                                  29000098
290100                 SET PS-VALID-TICK-FMT  TO TRUE                   29010098
290300             WHEN SQLCODE = +100                                  29030098
290400                 SET PS-NOT-A-VALID-TICK-FMT TO TRUE              29040099
290600             WHEN SQLCODE = -904                                  29060098
290700             WHEN SQLCODE = -913                                  29070098
290800                 CONTINUE                                         29080098
291000             WHEN SQLWARN0 NOT = SPACES                           29100098
291100             WHEN SQLCODE < ZERO                                  29110098
291200             WHEN SQLCODE > ZERO                                  29120098
291300                 MOVE '3050-VALIDATE-TICKET-FORMAT'               29130098
291400                                   TO DP013-PARAGRAPH             29140098
291500                 MOVE 'SELECT TICKET TYPE FROM TTKTFMT'           29150099
291600                                   TO DP013-MESSAGE-TEXT (1)      29160098
291700                 MOVE DK-TICKET-TYPE                              29170098
291800                                   TO DP013-MESSAGE-TEXT (2)      29180098
291900                 MOVE SQLCA        TO DP013-SQLCA                 29190098
292000                 MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)    29200098
292100                 SET DP013-DB2-ABEND                              29210098
292200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29220098
292300                 PERFORM DP013-0000-PROCESS-ABEND                 29230098
292400         END-EVALUATE                                             29240098
292500     END-PERFORM.                                                 29250098
292600                                                                  29260098
292700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29270098
292800         MOVE '3050-VALIDATE-TICKET-FORM' TO DP013-PARAGRAPH      29280098
292900         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING TICKET TYPE '   29290098
293000                                   TO DP013-MESSAGE-TEXT (1)      29300098
293100         MOVE SQLCA                TO DP013-SQLCA                 29310098
293200         MOVE 'TTKTFMT '           TO DP013-DB2-TABLE-NAME (1)    29320098
293300         SET DP013-DB2-ABEND                                      29330098
293400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   29340099
293600         PERFORM DP013-0000-PROCESS-ABEND                         29360098
293700     END-IF.                                                      29370098
293800                                                                  29380098
293900*----------------------------------------------------------------*29390098
294000*    SELECT THE BULK TICKET INDICATOR FROM THE VENDOR AGREEMENT  *29400098
294100*    TABLE                                                       *29410098
294200*----------------------------------------------------------------*29420098
294300 3060-CHECK-BULK-IND.                                             29430098
294500     PERFORM                                                      29450098
294600         WITH TEST AFTER                                          29460098
294700         VARYING PV-RETRY-COUNTER                                 29470098
294800         FROM 1 BY 1                                              29480098
294900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29490098
295000                   OR (SQLCODE = ZERO))                           29500098
295100                                                                  29510098
295200         EXEC SQL                                                 29520098
295400             SELECT BULK_STK_TKT_IND                              29540099
295600             INTO  :VNDAGR-BULK-STK-TKT-IND                       29560099
295800             FROM  TVNDAGR                                        29580099
296000             WHERE     ENT_ID = :DK-ENT-ID                        29600099
296100               AND   DEPT_NBR = :DK-DEPT-NBR                      29610098
296200               AND   AGRMT_TYP_ID = :PC-SERVICE-AGRMT-CDE         29620098
296300               AND   TYP_CDE      = :PC-PRETICKET-TYP-CDE         29630098
296400               AND   EFFECTIVE_DATE <= CURRENT DATE               29640098
296500               AND   EXPIRATION_DATE > CURRENT DATE               29650098
296600         END-EXEC                                                 29660098
296700                                                                  29670098
296800         EVALUATE TRUE                                            29680098
296900             WHEN SQLCODE = ZERO                                  29690098
297000             WHEN SQLCODE = +100                                  29700098
297100                 IF SQLCODE = +100                                29710098
297200                 OR VNDAGR-BULK-STK-TKT-IND NOT = 'Y'             29720098
297300                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          29730099
297500                     MOVE PC-TSYMSG-01331    TO DP020-MSG-NUMBER  29750098
297600                     MOVE -1                 TO AREQTYPL          29760098
297700                     MOVE DP015-REVERSE      TO AREQTYPH          29770098
297800                     MOVE DP015-RED          TO AREQTYPC          29780098
297900                     SET DP020-MSG-FATAL     TO TRUE              29790098
298000                 END-IF                                           29800098
298100                                                                  29810098
298200             WHEN SQLCODE = -904                                  29820098
298300             WHEN SQLCODE = -913                                  29830098
298400                 CONTINUE                                         29840098
298600             WHEN SQLWARN0 NOT = SPACES                           29860098
298700             WHEN SQLCODE < ZERO                                  29870098
298800             WHEN SQLCODE > ZERO                                  29880098
298900                 MOVE '3060-CHECK-BULK-IND' TO DP013-PARAGRAPH    29890099
299100                 MOVE 'SELECT THE PRETICKET LEAD TIME'            29910098
299200                                   TO DP013-MESSAGE-TEXT (1)      29920098
299300                 MOVE  DK-ENT-ID   TO PV-DISPLAY-COMP             29930098
299400                 MOVE  PV-DISPLAY-COMP TO DP013-MESSAGE-TEXT (2)  29940099
299600                 MOVE  DK-DEPT-NBR TO PV-DISPLAY-COMP             29960098
299700                 MOVE  PV-DISPLAY-COMP TO DP013-MESSAGE-TEXT (3)  29970099
299900                 MOVE SQLCA        TO DP013-SQLCA                 29990098
300000                 MOVE 'TPOAGMT '   TO DP013-DB2-TABLE-NAME (1)    30000098
300100                 SET DP013-DB2-ABEND                              30010098
300200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           30020098
300300                 PERFORM DP013-0000-PROCESS-ABEND                 30030098
300400         END-EVALUATE                                             30040098
300500     END-PERFORM.                                                 30050098
300600                                                                  30060099
300700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30070098
300800         MOVE '3060-CHECK-BULK-IND' TO DP013-PARAGRAPH            30080099
301000         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING BULK INDICATOR' 30100098
301100                                   TO DP013-MESSAGE-TEXT (1)      30110098
301200         MOVE SQLCA                TO DP013-SQLCA                 30120098
301300         MOVE 'TPOAGMT '           TO DP013-DB2-TABLE-NAME (1)    30130098
301400         SET DP013-DB2-ABEND                                      30140098
301500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   30150099
301700         PERFORM DP013-0000-PROCESS-ABEND                         30170098
301800     END-IF.                                                      30180098
301900                                                                  30190098
302200*----------------------------------------------------------------*30220098
302300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *30230098
302400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*30240098
302500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *30250098
302600*                                                                *30260098
302700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *30270098
302800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *30280098
302900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *30290098
303000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *30300098
303100*----------------------------------------------------------------*30310098
303300 3100-SET-SUBSCRIPTS.                                             30330098
303500     COMPUTE ASC-ITEM-SUB =                                       30350098
303600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        30360098
303700                                                                  30370098
303800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         30380098
303900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            30390098
304000                                                                  30400098
304100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               30410098
304200     ELSE                                                         30420098
304300         MOVE +1                     TO ASC-BLK-SUB               30430098
304400     END-IF.                                                      30440098
304800                                                                  30441099
304500******************************************************************30450098
304600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **30460098
304700******************************************************************30470098
304900 3200-RESET-ATTRIBUTES.                                           30490098
305100     IF ASC-DELETE-FORMAT-IND                                     30510098
305200        OR ASC-ADD-COMPLETE                                       30520099
305300         MOVE DP015-ASK-NOR-OFF     TO PV-TEMP-ATTRIBUTE          30530098
305400         MOVE DP015-BLUE            TO PV-TEMP-COLOR              30540098
305500         MOVE DP015-HL-OFF          TO PV-TEMP-HILIGHT            30550098
305600     ELSE                                                         30560098
305700         MOVE DP015-UNP-ALP-NOR-OFF TO PV-TEMP-ATTRIBUTE          30570098
305800         MOVE DP015-GREEN           TO PV-TEMP-COLOR              30580098
305900         MOVE DP015-UNDERLINE       TO PV-TEMP-HILIGHT            30590098
306000     END-IF.                                                      30600098
306100                                                                  30610098
306200     MOVE PV-TEMP-ATTRIBUTE        TO ASTRTITA                    30620098
306300                                      AREQTYPA                    30630098
306400                                      AVDUEDTA                    30640098
306500                                      ADTTYPA                     30650098
306600                                      ADTPLCA                     30660098
306700                                      ADOPBLKA                    30670098
306800                                      ADTKQTYA.                   30680098
306900     MOVE PV-TEMP-COLOR            TO ASTRTITC                    30690098
307000                                      AREQTYPC                    30700098
307100                                      AVDUEDTC                    30710098
307200                                      ADTPLCC                     30720098
307300                                      ADTTYPC                     30730098
307400                                      ADOPBLKC                    30740098
307500                                      ADTKQTYC.                   30750098
307600     MOVE PV-TEMP-HILIGHT          TO ASTRTITH                    30760098
307700                                      AREQTYPH                    30770098
307800                                      AVDUEDTH                    30780098
307900                                      ADTPLCH                     30790098
308000                                      ADTTYPH                     30800098
308100                                      ADOPBLKH                    30810098
308200                                      ADTKQTYH.                   30820098
308400     MOVE DP015-HL-OFF             TO AADDR1H.                    30840098
308500     MOVE DP015-BLUE               TO AADDR1C.                    30850098
308600                                                                  30860099
308700     PERFORM                                                      30870098
308800         VARYING PV-SUB                                           30880098
308900         FROM 1 BY 1                                              30890098
309000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        30900098
309100         IF MR-SKU-NBR (PV-SUB) = SPACES                          30910098
309200             CONTINUE                                             30920098
309300         ELSE                                                     30930098
309400             MOVE PV-TEMP-ATTRIBUTE                               30940098
309500                              TO MR-SELECTA (PV-SUB)              30950098
309600                                 MR-TICKET-TYPEA (PV-SUB)         30960098
309700                                 MR-TICKET-PLACEA (PV-SUB)        30973099
309800                                 MR-OPTION-BLOCKA (PV-SUB)        30980098
309900                                 MR-QUANTITYA (PV-SUB)            30990098
310000             MOVE PV-TEMP-COLOR                                   31000098
310100                              TO MR-SELECTC (PV-SUB)              31010098
310200                                 MR-TICKET-TYPEC (PV-SUB)         31020098
310300                                 MR-TICKET-PLACEC (PV-SUB)        31030098
310400                                 MR-QUANTITYC (PV-SUB)            31040098
310500                                 MR-OPTION-BLOCKC (PV-SUB)        31050098
310600             MOVE PV-TEMP-HILIGHT                                 31060098
310700                              TO MR-SELECTH (PV-SUB)              31070098
310800                                 MR-TICKET-TYPEH (PV-SUB)         31080098
310900                                 MR-TICKET-PLACEH (PV-SUB)        31090098
311000                                 MR-QUANTITYH (PV-SUB)            31100098
311100                                 MR-OPTION-BLOCKH (PV-SUB)        31110098
311200         END-IF                                                   31120098
311300     END-PERFORM.                                                 31130098
311300                                                                  31131099
311400******************************************************************31140098
311500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **31150098
311600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **31160098
311700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **31170098
311800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **31180098
311900******************************************************************31190098
312000 3300-EDIT-SELECTIONS.                                            31200098
312100     EVALUATE TRUE                                                31210098
312200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     31220098
312300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         31230098
312400                 CONTINUE                                         31240098
312500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         31250098
312600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        31260098
312700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   31270098
312800                 MOVE ASC-TEMP-SELECTED-SW                        31280098
312900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  31290098
313000                                TO ASC-SELECTED-SW                31300098
313100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  31310098
313200             END-IF                                               31320098
313300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     31330098
313400                 = SPACE                                          31340098
313500             EVALUATE TRUE                                        31350098
313600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       31360098
313700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS31370098
313800                     MOVE SPACE TO ASC-SELECTED-SW                31380098
313900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  31390098
314000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        31400098
314100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    31410098
314200                     MOVE SPACE TO ASC-SELECTED-SW                31420098
314300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  31430098
314400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          31440098
314500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      31450098
314600                     MOVE SPACE TO ASC-SELECTED-SW                31460098
314700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  31470098
314800             END-EVALUATE                                         31480098
314900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           31490098
315000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            31500098
315100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    31510098
315200             END-IF                                               31520098
315300             PERFORM 3310-EDIT-RANGE                              31530098
315400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             31540098
315500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            31550098
315600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    31560098
315700             END-IF                                               31570098
315800             PERFORM 3310-EDIT-RANGE                              31580098
315900         WHEN OTHER                                               31590098
316000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           31600098
316100             SET DP020-MSG-FATAL    TO TRUE                       31610098
316200             MOVE -1                TO MR-SELECTL (PV-SUB)        31620098
316300             SET DP030-SET-CURSOR-APPL-1                          31630098
316400                                    TO TRUE                       31640098
316500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        31650098
316600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        31660098
316700             SET PS-ERROR TO TRUE                                 31670098
316800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            31680098
316900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     31690098
317000                 MOVE SPACE         TO ASC-SELECTED-SW            31700098
317100                                        (ASC-BLK-SUB ASC-ITEM-SUB)31710098
317200             END-IF                                               31720098
317400     END-EVALUATE.                                                31740098
317500                                                                  31750098
317600     IF ASC-RQST-QUANTITY (ASC-BLK-SUB ASC-ITEM-SUB) = SPACE      31760098
317700         MOVE ASC-PO-QUANTITY (ASC-BLK-SUB ASC-ITEM-SUB)          31770098
317800           TO ASC-RQST-QUANTITY (ASC-BLK-SUB ASC-ITEM-SUB)        31780098
317900     ELSE                                                         31790098
318000         MOVE ASC-RQST-QUANTITY (ASC-BLK-SUB ASC-ITEM-SUB)        31800098
318100                                   TO DP010I-UNEDITED-FIELD       31810098
318200         MOVE +8                   TO DP010I-MAXIMUM-DIGITS       31820098
318300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     31830098
318400         SET DP010I-NEGATIVE-NOT-ALLOWED                          31840098
318500                                   TO TRUE                        31850098
318600                                                                  31860098
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         31871099
263627              USING DP010I-NUMERIC-EDIT-AREA                      31872099
318800                                                                  31880098
318900         EVALUATE TRUE                                            31890098
319000         WHEN DP010I-NO-ERROR-DETECTED                            31900098
319100             MOVE DP010I-NUMERIC-FIELD                            31910098
319200             TO  ASC-RQST-QUANTITY-N (ASC-BLK-SUB ASC-ITEM-SUB)   31920098
319300             IF  ASC-RQST-QUANTITY-N (ASC-BLK-SUB ASC-ITEM-SUB)   31930098
319400                 > 0                                              31940098
319500             AND ASC-RQST-QUANTITY-N (ASC-BLK-SUB ASC-ITEM-SUB)   31950098
319600                 < 9999999                                        31960098
319700                 CONTINUE                                         31970098
319800             ELSE                                                 31980098
319900                  MOVE PC-TSYMSG-01467   TO DP020-MSG-NUMBER      31990098
320000                  SET DP020-MSG-FATAL    TO TRUE                  32000098
320100                  MOVE -1                TO MR-QUANTITYL (PV-SUB) 32010098
320200                  SET DP030-SET-CURSOR-APPL-1                     32020098
320300                                         TO TRUE                  32030098
320400                  MOVE DP015-RED         TO MR-QUANTITYC (PV-SUB) 32040098
320500                  MOVE DP015-REVERSE     TO MR-QUANTITYH (PV-SUB) 32050098
320600                  SET PS-ERROR TO TRUE                            32060098
320700             END-IF                                               32070098
320800         WHEN DP010I-NEG-NOT-ALLOWED                              32080098
320900         WHEN DP010I-MAX-DIGITS-EXCEEDED                          32090098
321000              MOVE PC-TSYMSG-01467   TO DP020-MSG-NUMBER          32100098
321100              SET DP020-MSG-FATAL    TO TRUE                      32110098
321200              MOVE -1                TO MR-QUANTITYL (PV-SUB)     32120098
321300              SET DP030-SET-CURSOR-APPL-1                         32130098
321400                                     TO TRUE                      32140098
321500              MOVE DP015-RED         TO MR-QUANTITYC (PV-SUB)     32150098
321600              MOVE DP015-REVERSE     TO MR-QUANTITYH (PV-SUB)     32160098
321700              SET PS-ERROR TO TRUE                                32170098
321800         WHEN OTHER                                               32180098
321900              MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER          32190098
322000              SET DP020-MSG-FATAL    TO TRUE                      32200098
322100              MOVE -1                TO MR-QUANTITYL (PV-SUB)     32210098
322200              SET DP030-SET-CURSOR-APPL-1                         32220098
322300                                     TO TRUE                      32230098
322400              MOVE DP015-RED         TO MR-QUANTITYC (PV-SUB)     32240098
322500              MOVE DP015-REVERSE     TO MR-QUANTITYH (PV-SUB)     32250098
322600              SET PS-ERROR TO TRUE                                32260098
322700         END-EVALUATE                                             32270098
322800     END-IF.                                                      32280098
322900                                                                  32290098
323000*    VALIDATE THE OPTION BLOCK FIELD OF THE LIST SECTION          32300098
323100     IF ASC-LNE-ON-RQST (ASC-BLK-SUB ASC-ITEM-SUB)                32310098
323200         MOVE ASC-OPTION-BLOCK (ASC-BLK-SUB ASC-ITEM-SUB)         32320098
323300              TO PV-OPTION-BLOCK                                  32330098
323400         IF PV-VALID-OPTION-BLOCK                                 32340098
323500         OR PV-OPTION-BLOCK = SPACES                              32350098
323600             IF PV-OPTION-BLOCK = 'N/A'                           32360098
323700                 MOVE SPACES TO ASC-OPTION-BLOCK                  32370098
323800                                (ASC-BLK-SUB ASC-ITEM-SUB)        32380098
323900             END-IF                                               32390098
324000         ELSE                                                     32400098
324100             MOVE PC-TSYMSG-01357 TO DP020-MSG-NUMBER             32410099
324300             SET DP020-MSG-FATAL TO TRUE                          32430099
324500             MOVE -1         TO MR-OPTION-BLOCKL (PV-SUB)         32450098
324600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  32460099
324800             MOVE DP015-RED  TO MR-OPTION-BLOCKC (PV-SUB)         32480098
324900             MOVE DP015-REVERSE TO MR-OPTION-BLOCKH (PV-SUB)      32490099
325100             SET PS-ERROR    TO TRUE                              32510098
325200         END-IF                                                   32520098
325300     END-IF.                                                      32530098
325400                                                                  32540098
325500*    IF A TICKET PLACEMENT FIELD IN THE LIST SECTION OF THE SCREEN32550098
325600*    HAS BEEN CHANGED, VALIDATE THAT THE VALUE IS GOOD.  RESET    32560098
325700*    ASC-TPLACE-MOD ONLY AFTER A VALID VALUE IS ENTERED.          32570098
325800     IF ASC-LNE-ON-RQST (ASC-BLK-SUB ASC-ITEM-SUB)                32580098
325900         IF ASC-TICKET-PLACE (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES  32590098
326000             IF ASC-DEFAULT-TICKET-PLACE > SPACES                 32600098
326100             OR DP020-FK-DISPN-GO (DP020-SRC-AID)                 32610098
326200                 CONTINUE                                         32620098
326300             ELSE                                                 32630098
326400                 MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER         32640099
326600                 SET DP020-MSG-FATAL TO TRUE                      32660099
326800                 MOVE -1         TO MR-TICKET-PLACEL (PV-SUB)     32680098
326900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              32690099
327100                 MOVE DP015-RED  TO MR-TICKET-PLACEC (PV-SUB)     32710098
327200                 MOVE DP015-REVERSE TO MR-TICKET-PLACEH (PV-SUB)  32720099
327400                 SET PS-ERROR    TO TRUE                          32740098
327500             END-IF                                               32750098
327600         ELSE                                                     32760098
327700            IF ASC-TPLACE-MOD (ASC-BLK-SUB ASC-ITEM-SUB)          32770098
327800            OR PS-REPOSITION                                      32780098
327900               MOVE ASC-TICKET-PLACE (ASC-BLK-SUB ASC-ITEM-SUB)   32790098
328000                    TO DK-TICKET-PLACEMENT                        32800098
328100               PERFORM 3010-VALIDATE-TICKET-PLACE                 32810098
328200               IF PS-VALID-TICK-PLACE                             32820098
328300                  SET ASC-NO-TPLACE-MOD                           32830098
328400                      (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE          32840099
328600               ELSE                                               32860098
328700                  IF DP020-FK-DISPN-GO (DP020-SRC-AID)            32870098
328800                     CONTINUE                                     32880098
328900                  ELSE                                            32890098
329000                     MOVE PC-TSYMSG-01347 TO DP020-MSG-NUMBER     32900099
329200                     SET DP020-MSG-FATAL TO TRUE                  32920099
329400                     MOVE -1         TO MR-TICKET-PLACEL (PV-SUB) 32940098
329500                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          32950099
329700                     MOVE DP015-RED  TO MR-TICKET-PLACEC (PV-SUB) 32970098
329800                     MOVE DP015-REVERSE                           32980098
329900                                     TO MR-TICKET-PLACEH (PV-SUB) 32990098
330000                     SET PS-ERROR    TO TRUE                      33000098
330100                  END-IF                                          33010099
330100               END-IF                                             33011099
330200            END-IF                                                33020099
330300         END-IF                                                   33030098
330400     END-IF.                                                      33040098
330500                                                                  33050098
330600*  IF A TICKET TYPE FIELDS IN THE LIST SECTION OF THE SCREEN HAVE 33060099
330700*  BEEN CHANGED, VALIDATE THAT THE VALUE IS GOOD.  RESET          33070099
330800*  ASC-TTYPE-MOD ONLY AFTER A VALID VALUE IS ENTERED.             33080099
330900     IF ASC-LNE-ON-RQST (ASC-BLK-SUB ASC-ITEM-SUB)                33090098
331000        IF ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES    33100099
331100           PERFORM 4320-GET-DEFAULT-TICKET-TYPE                   33110099
331200           IF ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) = SPACE  33121099
331300              IF ASC-DEFAULT-TICKET-TYPE  > SPACES                33130099
331400              OR DP020-FK-DISPN-GO (DP020-SRC-AID)                33140099
331500                 CONTINUE                                         33150099
331600              ELSE                                                33160099
331700                 MOVE PC-TSYMSG-01343 TO DP020-MSG-NUMBER         33170099
331800                 SET DP020-MSG-FATAL  TO TRUE                     33180099
331900                 MOVE -1              TO MR-TICKET-TYPEL (PV-SUB) 33190099
332000                 MOVE ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)  33200099
332100                                      TO MR-TICKET-TYPE  (PV-SUB) 33210099
332200                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              33220099
332400                 MOVE DP015-RED       TO MR-TICKET-TYPEC (PV-SUB) 33240099
332500                 MOVE DP015-REVERSE   TO MR-TICKET-TYPEH (PV-SUB) 33250099
332600                 SET PS-ERROR     TO TRUE                         33260099
332700              END-IF                                              33270099
332800           END-IF                                                 33280099
332900        ELSE                                                      33290099
333000           IF ASC-TTYPE-MOD (ASC-BLK-SUB ASC-ITEM-SUB)            33300098
333100           OR PS-REPOSITION                                       33310098
333200              MOVE ASC-TICKET-TYPE  (ASC-BLK-SUB ASC-ITEM-SUB)    33320098
333300                    TO DK-TICKET-TYPE                             33330098
333400              PERFORM 3045-DEFAULT-TICKET-FORMAT                  33340098
333500              MOVE SPACES TO ASC-DEFAULT-TICKET-TYPE              33350098
333700              IF PS-VALID-TICK-TYPE                               33370098
333800                 SET ASC-NO-TTYPE-MOD                             33380098
333900                     (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE           33390099
334000                                                                  33400099
334100* IF THE NEW VALUE IS A VALID TICKET TYPE, CHECK THE FORMAT CODE. 33410098
334200* IF THERE IS A FORMAT, THAT MEANS THE TICKET OFFICE CAN PRINT    33420098
334300* TICKETS.  IF THERE ISN'T THAT MEANS THE TICKET OFFICE CAN'T     33430098
334400* PRINT THE TICKETS, AND THE LINE CAN'T BE INCLUDED IN THE REQUEST33440098
334500                 PERFORM 3050-VALIDATE-TICKET-FORMAT              33450098
334600                 IF PS-VALID-TICK-FMT                             33460098
334700                    SET ASC-TTYPE-PRINT-YES                       33470098
334800                        (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE        33480099
335000                 ELSE                                             33500098
335100                    SET ASC-TTYPE-PRINT-NO                        33510098
335200                         (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE       33520099
335400                 END-IF                                           33540098
335500              ELSE                                                33550098
335500************  GETTING INVALID TKT TYPE IN 3300-PARA #1            33551099
335600                 MOVE PC-TSYMSG-01343 TO DP020-MSG-NUMBER         33560099
335800                 SET DP020-MSG-FATAL TO TRUE                      33580099
336000                 MOVE -1            TO MR-TICKET-TYPEL (PV-SUB)   33600098
336100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              33610099
336300                 MOVE DP015-RED     TO MR-TICKET-TYPEC (PV-SUB)   33630098
336400                 MOVE DP015-REVERSE TO MR-TICKET-TYPEH (PV-SUB)   33640098
336500                 SET PS-ERROR       TO TRUE                       33650098
336600              END-IF                                              33660098
336700           END-IF                                                 33670098
336800        END-IF                                                    33680098
336900                                                                  33690098
337000        IF ASC-TTYPE-PRINT-YES (ASC-BLK-SUB ASC-ITEM-SUB)         33700098
337100           CONTINUE                                               33710098
337200        ELSE                                                      33720098
335500************  GETTING INVALID TKT TYPE IN 3300-PARA #2            33721099
337300           MOVE -1            TO MR-TICKET-TYPEL (PV-SUB)         33730098
337400           MOVE ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)        33740098
337500                              TO MR-TICKET-TYPE  (PV-SUB)         33750098
337600           MOVE DP015-RED     TO MR-TICKET-TYPEC (PV-SUB)         33760098
337700           MOVE DP015-REVERSE TO MR-TICKET-TYPEH (PV-SUB)         33770098
337800           MOVE PC-TSYMSG-01343 TO DP020-MSG-NUMBER               33780099
338000           SET DP020-MSG-FATAL                                    33800099
338100               PS-ERROR                                           33810098
338200               DP030-SET-CURSOR-APPL-1 TO TRUE                    33820099
338400        END-IF                                                    33840098
338500     END-IF.                                                      33850098
338600                                                                  33860098
338700     SUBTRACT +1             FROM PV-ITEM-IN-USE                  33870098
338800                                  ASC-ITEM-SUB.                   33880098
338900     IF  ASC-ITEM-SUB < 1                                         33890098
339000         SUBTRACT +1 FROM ASC-BLK-SUB                             33900098
339100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                33910098
339200     END-IF.                                                      33920098
338600                                                                  33921099
339300******************************************************************33930098
339400** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **33940098
339500** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **33950098
339600** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**33960098
339700** THE ENDING.                                                  **33970098
339800******************************************************************33980098
339900 3310-EDIT-RANGE.                                                 33990098
340000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                34000098
340100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   34010098
340200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)34020098
340300                                   TO ASC-SELECTED-SW             34030098
340400                                        (ASC-BLK-SUB ASC-ITEM-SUB)34040098
340500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 34050098
340600         ELSE                                                     34060098
340700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     34070098
340800                 CONTINUE                                         34080098
340900             ELSE                                                 34090098
341000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        34100098
341100                 MOVE PC-TSYMSG-00054 TO DP020-MSG-NUMBER         34110099
341300                 SET DP020-MSG-FATAL TO TRUE                      34130099
341500                 MOVE -1           TO MR-SELECTL (PV-SUB)         34150098
341600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              34160099
341800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         34180098
341900                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      34190099
342100                 SET PS-ERROR      TO TRUE                        34210098
342200             END-IF                                               34220098
342300         END-IF                                                   34230098
342400     ELSE                                                         34240098
342500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     34250098
342600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 34260098
342700                                   TO ASC-SELECTED-SW             34270098
342800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   34280098
342900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   34290098
343000         ELSE                                                     34300098
343100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       34310098
343200                 CONTINUE                                         34320098
343300             ELSE                                                 34330098
343400*                -- ONLY ONE END-OF-RANGE ALLOWED --              34340098
343500                 MOVE PC-TSYMSG-00055 TO DP020-MSG-NUMBER         34350099
343700                 SET DP020-MSG-FATAL TO TRUE                      34370099
343900                 MOVE -1           TO MR-SELECTL (PV-SUB)         34390098
344000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              34400099
344200                 SET PS-ERROR      TO TRUE                        34420098
344300             END-IF                                               34430098
344400         END-IF                                                   34440098
344500     END-IF.                                                      34450098
344600                                                                  34460099
344700******************************************************************34470098
344800** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **34480098
344900** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **34490098
345000******************************************************************34500098
345100 3400-CHECK-RANGE-SEQUENCE.                                       34510098
345200     IF ASC-START-OF-SELECTED-RANGE > ZERO                        34520099
345300       AND ASC-END-OF-SELECTED-RANGE > ZERO                       34530099
345400       AND ASC-START-OF-SELECTED-RANGE > ASC-END-OF-SELECTED-RANGE34540099
345600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                34560098
345700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 34570098
345800         SET DP020-MSG-FATAL TO TRUE                              34580098
345900         SET PS-ERROR TO TRUE                                     34590098
346000         PERFORM 3410-POSITION-AT-ERROR                           34600098
346100     END-IF.                                                      34610098
344600                                                                  34611099
346200******************************************************************34620098
346300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **34630098
346400** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **34640098
346500** SHOULD BE POSITIONED ON A RANGE ERROR.                       **34650098
346600******************************************************************34660098
346700 3410-POSITION-AT-ERROR.                                          34670098
346800     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         34680099
347000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 34700098
347100                    - PV-TOP-ITEM + 1.                            34710098
347200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      34720098
347300         CONTINUE                                                 34730098
347400     ELSE                                                         34740098
347500         MOVE -1                   TO MR-SELECTL (PV-SUB)         34750098
347600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         34760098
347700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         34770098
347800     END-IF.                                                      34780098
347900                                                                  34790099
348000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   34800098
348100                    - PV-TOP-ITEM + 1.                            34810098
348200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      34820098
348300         CONTINUE                                                 34830098
348400     ELSE                                                         34840098
348500         MOVE -1                   TO MR-SELECTL (PV-SUB)         34850098
348600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         34860098
348700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         34870098
348800     END-IF.                                                      34880098
348900                                                                  34890099
349000*----------------------------------------------------------------*34900098
349100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *34910098
349200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *34920098
349300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *34930098
349400*----------------------------------------------------------------*34940098
349600 3500-MARK-RANGE-AS-SELECTED.                                     34960098
349700     MOVE +1                       TO  ASC-BLK-SUB.               34970098
349800     PERFORM 3510-MARK-SELECTED-INDS                              34980098
349900         VARYING ASC-ITEM-SUB                                     34990098
350000         FROM 1 BY 1                                              35000098
350100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 35010098
350200                                                                  35020098
350300     ADD +1                        TO ASC-BLK-SUB.                35030098
350400     PERFORM 3510-MARK-SELECTED-INDS                              35040098
350500         VARYING ASC-ITEM-SUB                                     35050098
350600         FROM 1 BY 1                                              35060098
350700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 35070098
350800                                                                  35080098
350900     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO  PV-LIST-ITEM-NUMBER.      35090099
351100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            35110098
351200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         35120098
351300               PC-ITEMS-PER-PANEL).                               35130098
351400                                                                  35140098
351500     MOVE ASC-START-OF-SELECTED-RANGE                             35150098
351600                                   TO PV-START-OF-SELECTED-RANGE. 35160098
351700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            35170098
351800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  35180098
351900               PC-ITEMS-PER-PANEL).                               35190098
352000                                                                  35200098
352100     MOVE ASC-END-OF-SELECTED-RANGE                               35210098
352200                                   TO  PV-END-OF-SELECTED-RANGE.  35220098
352300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             35230098
352400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    35240098
352500               PC-ITEMS-PER-PANEL).                               35250098
352600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             35260098
352700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             35270098
352800                                                                  35280098
352900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    35290098
353000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        35300098
353100         MOVE +1                   TO ASC-BLK-SUB                 35310098
353200         PERFORM 5100-WRITE-TEMP-STORAGE                          35320098
353300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         35330098
353400             PV-FIRST-BLOCK-IN-ARRAY - 1                          35340098
353500                                                                  35350098
353600         PERFORM                                                  35360098
353700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      35370098
353800                   PV-PREV-BLOCK-IN-ARRAY                         35380098
353900             MOVE PV-FIRST-BLOCK-IN-RANGE                         35390098
354000                                   TO PV-BLOCK-NUMBER             35400098
354100             PERFORM 4410-READ-TEMP-STORAGE                       35410098
354200             PERFORM 3510-MARK-SELECTED-INDS                      35420098
354300                 VARYING ASC-ITEM-SUB                             35430098
354400                 FROM 1 BY 1                                      35440098
354500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          35450098
354600             PERFORM 5100-WRITE-TEMP-STORAGE                      35460098
354700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     35470098
354800         END-PERFORM                                              35480098
354900                                                                  35490098
355000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         35500098
355100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     35510098
355200         PERFORM                                                  35520098
355300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       35530098
355400                   PV-LAST-BLOCK-IN-RANGE                         35540098
355500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          35550098
355600                                   TO PV-BLOCK-NUMBER             35560098
355700             PERFORM 4410-READ-TEMP-STORAGE                       35570098
355800             PERFORM 3510-MARK-SELECTED-INDS                      35580098
355900                 VARYING ASC-ITEM-SUB                             35590098
356000                 FROM 1 BY 1                                      35600098
356100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          35610098
356200             PERFORM 5100-WRITE-TEMP-STORAGE                      35620098
356300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      35630098
356400         END-PERFORM                                              35640098
356500                                                                  35650098
356600         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          35660099
356700                                                                  35670099
356800         PERFORM 4410-READ-TEMP-STORAGE                           35680098
356900     END-IF.                                                      35690098
357000                                                                  35700098
357100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 35710098
357200                                      ASC-END-OF-SELECTED-RANGE.  35720098
357300                                                                  35730098
357500*----------------------------------------------------------------*35750098
357600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *35760098
357700*----------------------------------------------------------------*35770098
357900 3510-MARK-SELECTED-INDS.                                         35790098
358100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         35810098
358200                                ASC-ITEM-SUB) >                   35820098
358300                                     ASC-START-OF-SELECTED-RANGE) 35830099
358400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         35840098
358500                                ASC-ITEM-SUB) =                   35850098
358600                                     ASC-START-OF-SELECTED-RANGE) 35860099
358700                                                                  35870098
358800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     35880099
359000                                      ASC-END-OF-SELECTED-RANGE)  35900099
359100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     35910099
359300                                      ASC-END-OF-SELECTED-RANGE)  35930099
359500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          35950098
359600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   35960098
359700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   35970098
359800                               TO TRUE                            35980098
359900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE      35990099
360100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    36010098
360200             END-IF                                               36020098
360300         END-IF                                                   36030098
360400     END-IF.                                                      36040098
360500                                                                  36050098
360700*----------------------------------------------------------------*36070098
360800*  IF THE FIELDS ON THE SCREEN HAVE PASSED ALL THE EDITS, CHECK  *36080098
360900*  THE TICKET TYPE, PLACEMENT, QTY AND OPTION BLOCK FOR EACH LINE*36090098
361000*  THAT IS IN THE QUEUE BUT NOT ON THE SCREEN.                    36100098
361100*----------------------------------------------------------------*36110098
361300 3600-EDIT-TS-QUEUE.                                              36130098
361500     MOVE +1                       TO ASC-BLK-SUB.                36150098
361600                                                                  36160098
361700     PERFORM 3610-EDIT-BLOCK                                      36170098
361800         VARYING ASC-ITEM-SUB                                     36180098
361900         FROM 1 BY 1                                              36190098
362000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  36200098
362100            OR PS-ERROR.                                          36210098
362200                                                                  36220098
362300     IF PS-NO-ERROR                                               36230098
362400         PERFORM 5100-WRITE-TEMP-STORAGE                          36240098
362500     END-IF.                                                      36250098
362600                                                                  36260098
362700     ADD +1                        TO ASC-BLK-SUB.                36270098
362800                                                                  36280098
362900     PERFORM 3610-EDIT-BLOCK                                      36290098
363000         VARYING ASC-ITEM-SUB                                     36300098
363100         FROM 1 BY 1                                              36310098
363200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  36320098
363300            OR PS-ERROR.                                          36330098
363400                                                                  36340098
363500     IF PS-NO-ERROR                                               36350098
363600         PERFORM 5100-WRITE-TEMP-STORAGE                          36360098
363700     END-IF.                                                      36370098
363800                                                                  36380098
363900     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       36390099
364100                                                                  36410098
364200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            36420098
364300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    36430098
364400                                                                  36440098
364500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     36450098
364600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    36460098
364700                                                                  36470098
364800         MOVE +1                   TO ASC-BLK-SUB                 36480098
364900                                      PV-BLOCK-NUMBER             36490098
365000                                                                  36500098
365100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         36510098
365200             PV-FIRST-BLOCK-IN-ARRAY - 1                          36520098
365300                                                                  36530098
365400         PERFORM                                                  36540098
365500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       36550098
365600                OR PS-ERROR                                       36560098
365800             PERFORM 4410-READ-TEMP-STORAGE                       36580098
366000             PERFORM 3610-EDIT-BLOCK                              36600098
366100                 VARYING ASC-ITEM-SUB                             36610098
366200                 FROM 1 BY 1                                      36620098
366300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          36630098
366400                    OR PS-ERROR                                   36640098
366600             PERFORM 5100-WRITE-TEMP-STORAGE                      36660098
366800             ADD +1                TO PV-BLOCK-NUMBER             36680098
367000         END-PERFORM                                              36700098
367100                                                                  36710098
367200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         36720098
367300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     36730098
367400                                                                  36740098
367500         PERFORM                                                  36750098
367600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       36760098
367700                   ASC-HIGHEST-BLOCK-WRITTEN                      36770098
367800                OR PS-ERROR                                       36780098
368000             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       36800099
368300             PERFORM 4410-READ-TEMP-STORAGE                       36830098
368500             PERFORM 3610-EDIT-BLOCK                              36850098
368600                 VARYING ASC-ITEM-SUB                             36860098
368700                 FROM 1 BY 1                                      36870098
368800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          36880098
368900                    OR PS-ERROR                                   36890098
369100             PERFORM 5100-WRITE-TEMP-STORAGE                      36910098
369300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      36930098
369500         END-PERFORM                                              36950098
369600                                                                  36960098
369700         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          36970099
369900                                                                  36990098
370000         PERFORM 4410-READ-TEMP-STORAGE                           37000098
370100     END-IF.                                                      37010098
370200                                                                  37020098
370300* IF THERE WAS AN ERROR SOMEWHERE IN THE QUEUE, MOVE THE ITEM     37030098
370400* NUMBER TO THE ASC FIELD, AND MOVE THE FIELDS IN ERROR TO THE    37040098
370500* THE SCREEN - DO A COMPLETE LIST EDIT TO CATCH ALL THE ERRORS.   37050098
370600     IF PS-ERROR                                                  37060098
370700         MOVE PV-ERROR-ITEM-NUMBER TO ASC-ITEM-AT-TOP-OF-PANEL    37070098
370800                                      PV-TOP-ITEM                 37080098
370900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     37090098
371000                                                                  37100098
371100         MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB                      37110098
371200         COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                   37120098
371300             ASC-ITEMS-DISPLAYED - 1                              37130098
371400         SET PS-REPOSITION         TO TRUE                        37140098
371500         PERFORM 3100-SET-SUBSCRIPTS                              37150098
371600         PERFORM 3300-EDIT-SELECTIONS                             37160098
371700             VARYING PV-SUB                                       37170098
371800             FROM PV-SUB BY -1                                    37180098
371900             UNTIL PV-SUB < +1                                    37190098
372000         SET PS-NOT-REPOSITION     TO TRUE                        37200098
372100     ELSE                                                         37210098
372200         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             37220099
372400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     37240098
372500     END-IF.                                                      37250098
372700                                                                  37270098
372800 3610-EDIT-BLOCK.                                                 37280098
372900     IF ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) > 0       37290098
373000       IF ASC-LNE-ON-RQST (ASC-BLK-SUB ASC-ITEM-SUB)              37300098
373100         IF ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES   37310099
373300            SET PS-ERROR               TO TRUE                    37330098
373400         ELSE                                                     37340098
373500             MOVE ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)      37350098
373600                  TO DK-TICKET-TYPE                               37360098
373700             PERFORM 3045-DEFAULT-TICKET-FORMAT                   37370098
373700             MOVE SPACES TO ASC-DEFAULT-TICKET-TYPE               37380099
373900             IF PS-NOT-A-VALID-TICK-TYPE                          37390098
374000                 SET PS-ERROR                TO TRUE              37400098
374100             ELSE                                                 37410098
374200                 PERFORM 3050-VALIDATE-TICKET-FORMAT              37420098
374300                 IF PS-VALID-TICK-FMT                             37430098
374400                     CONTINUE                                     37440098
374500                 ELSE                                             37450098
374600                     SET PS-ERROR            TO TRUE              37460098
374700                 END-IF                                           37470098
374800             END-IF                                               37480098
374900         END-IF                                                   37490098
375000                                                                  37500098
375100         IF PS-NO-ERROR                                           37510098
375200             IF ASC-TICKET-PLACE (ASC-BLK-SUB ASC-ITEM-SUB)       37520098
375300                = SPACES                                          37530098
375400                 SET PS-ERROR              TO TRUE                37540098
375500             ELSE                                                 37550098
375600                 MOVE ASC-TICKET-PLACE (ASC-BLK-SUB ASC-ITEM-SUB) 37560098
375700                      TO DK-TICKET-PLACEMENT                      37570098
375800                 PERFORM 3010-VALIDATE-TICKET-PLACE               37580098
375900                 IF PS-NOT-A-VALID-TICK-PLACE                     37590098
376000                     SET PS-ERROR          TO TRUE                37600098
376100                 END-IF                                           37610098
376200             END-IF                                               37620098
376300         END-IF                                                   37630098
376400                                                                  37640098
376500         IF PS-ERROR                                              37650098
376600             MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) 37660098
376700                  TO PV-ERROR-ITEM-NUMBER                         37670098
376800         END-IF                                                   37680098
376900       END-IF                                                     37690098
377000     END-IF.                                                      37700098
377100                                                                  37710098
377300*----------------------------------------------------------------*37730098
377400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *37740098
377500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *37750098
377600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *37760098
377700*    DISPLAY THE PANEL TO USER.                                  *37770098
377800*----------------------------------------------------------------*37780098
378000 4000-BUILD-INITIAL-PANEL.                                        37800098
378200     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             37820098
378300                                ASC-BLOCK-ENTRIES (2).            37830098
378400     MOVE +1                 TO ASC-BLK-SUB.                      37840098
378500     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            37850099
378800     MOVE +0                 TO ASC-ITEM-SUB                      37880098
378900                                ASC-NUMBER-OF-ITEMS-READ          37890098
379000                                ASC-NUMBER-OF-SELECTED-ITEMS      37900098
379100                                ASC-REQUEST-LINE-COUNT            37910098
379200                                ASC-HIGHEST-BLOCK-WRITTEN         37920098
379300                                ASC-START-OF-SELECTED-RANGE       37930098
379400                                ASC-END-OF-SELECTED-RANGE         37940098
379500                                ASC-ITEM-AT-TOP-OF-PANEL.         37950098
379700     PERFORM 4050-GET-CURRENT-DATE.                               37970098
379900     PERFORM 4060-GET-TYPE-CODE.                                  37990098
380000                                                                  38000098
380100* GET THE PO DATES FOR THE VENDOR DUE DATE, PRINT DUE DATE AND    38010098
380200* THE CANCEL DATE                                                 38020098
380300     PERFORM 4100-GET-CONTROL-DATES                               38030098
380400                                                                  38040098
380500* IF THIS IS AN ADD, DEFAULT ALL THE FIELDS ACCORDINGLY...IF THIS 38050098
380600* IS AN UPDATE OR A DELETE, FETCH ALL SCREEN INFO FROM THE        38060098
380700* PRETICKET REQUEST TABLES                                        38070098
380800     IF ASC-UPDATE-REG                                            38080098
380900     OR ASC-UPDATE-RESUB                                          38090098
381000         PERFORM 4130-GET-REQUEST-INFO                            38100098
381100     ELSE                                                         38110098
381200         MOVE 'P'              TO ASC-REQ-TYP-CDE                 38120098
381300         MOVE 'PRETICKET '     TO ASC-REQ-TYP-CDE-DESC            38130098
381400         MOVE ASC-CURRENT-DATE TO ASC-REQUEST-DATE                38140098
381700         IF  ASC-RESUB-REQ                                        38170098
381800             SET ASC-REQ-STAT-HOLD TO TRUE                        38180098
381900         ELSE                                                     38190098
382000             IF ASC-ADD-NEW-REQ                                   38200098
382100                 SET ASC-REQ-STAT-ACTIVE TO TRUE                  38210098
382200             END-IF                                               38220098
382300         END-IF                                                   38230098
382400     END-IF.                                                      38240098
382500                                                                  38250098
382600     PERFORM 4140-GET-VENDOR-NAME.                                38260098
382700                                                                  38270098
382800     IF ASC-PO-REQ-NBR = 0                                        38280098
382900         SET ASC-REASON-CODES-DONT-EXIST   TO TRUE                38290098
383000     ELSE                                                         38300098
383100         PERFORM 4150-CHECK-FOR-REASON-CODES                      38310098
383200     END-IF.                                                      38320098
383300                                                                  38330098
383400* LOAD ALL PRETICKET ADDRESSES INTO A QUEUE TO ALLOW USER SELECTIO38340098
383500     PERFORM 4200-LOAD-ADDRESS-QUEUE.                             38350098
383700     PERFORM 4010-OPEN-CURSOR.                                    38370098
383900     PERFORM 4300-READ-ITEMS-FROM-DB.                             38390098
384100     PERFORM 4020-CLOSE-CURSOR.                                   38410098
384200                                                                  38420098
384300     MOVE +1                   TO  PV-TOP-ITEM.                   38430098
384400                                                                  38440098
384500     EVALUATE TRUE                                                38450098
384600     WHEN PS-IMPORT-ERROR                                         38460098
384700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    38470098
384800         SET DP020-MSG-FATAL   TO  TRUE                           38480098
384900         MOVE PC-TSYMSG-01470  TO  DP020-MSG-NUMBER               38490098
385000     WHEN ASC-NUMBER-OF-ITEMS-READ = ZERO                         38500098
385100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    38510098
385200         SET DP020-MSG-FATAL   TO  TRUE                           38520098
385300         MOVE PC-TSYMSG-01360  TO  DP020-MSG-NUMBER               38530098
385400     WHEN OTHER                                                   38540098
385500         MOVE -1               TO ADTTYPL                         38550098
385600         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      38560099
385800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     38580098
385900     END-EVALUATE.                                                38590098
386000                                                                  38600099
386100*----------------------------------------------------------------*38610098
386200* OPEN THE CURSOR                                                *38620098
386300*----------------------------------------------------------------*38630098
386400 4010-OPEN-CURSOR.                                                38640098
386600     PERFORM                                                      38660098
386700         WITH TEST AFTER                                          38670098
386800         VARYING PV-RETRY-COUNTER                                 38680098
386900         FROM 1 BY 1                                              38690098
387000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               38700098
387100                   OR (SQLCODE = ZERO))                           38710098
387300                                                                  38730098
387400         EXEC SQL                                                 38740098
387500             OPEN PO_PRETICK_CURSOR                               38750098
387600         END-EXEC                                                 38760098
387700                                                                  38770098
387800         EVALUATE TRUE                                            38780098
387900             WHEN SQLCODE = ZERO                                  38790098
388000             WHEN SQLCODE = -904                                  38800098
388100             WHEN SQLCODE = -913                                  38810098
388200                 CONTINUE                                         38820098
388300             WHEN SQLWARN0 NOT = SPACES                           38830098
388400             WHEN SQLCODE < ZERO                                  38840098
388500             WHEN SQLCODE > ZERO                                  38850098
388600                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       38860099
388800                 MOVE 'OPEN DETAIL CURSOR'                        38880098
388900                                   TO DP013-MESSAGE-TEXT (1)      38890098
389000                 MOVE SQLCA        TO DP013-SQLCA                 38900098
389100                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)    38910098
389200                 MOVE 'XLT_SKU '   TO DP013-DB2-TABLE-NAME (2)    38920099
389200                 MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (3)  38921099
389300                 SET DP013-DB2-ABEND                              38930098
389400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           38940098
389500                 PERFORM DP013-0000-PROCESS-ABEND                 38950098
389600         END-EVALUATE                                             38960098
389700     END-PERFORM.                                                 38970098
389800                                                                  38980099
389900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        38990098
390000         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             39000098
390100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   39010098
390200                                   TO DP013-MESSAGE-TEXT (1)      39020098
390300         MOVE SQLCA                TO DP013-SQLCA                 39030098
390400         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    39040098
398600         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (2)    39040199
398600         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (3)    39040299
389200         MOVE 'XLT_SKU '           TO DP013-DB2-TABLE-NAME (4)    39041099
389200         MOVE 'XLT_VND_STYL'       TO DP013-DB2-TABLE-NAME (5)    39042099
390600         SET DP013-DB2-ABEND                                      39060098
390700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   39070099
390900         PERFORM DP013-0000-PROCESS-ABEND                         39090098
391000     END-IF.                                                      39100098
389800                                                                  39101099
391100*----------------------------------------------------------------*39110098
391200* OPEN THE ADDRESS_CURSOR                                        *39120098
391300*----------------------------------------------------------------*39130098
391400 4011-OPEN-ADDR-CURSOR.                                           39140098
391600     PERFORM                                                      39160098
391700         WITH TEST AFTER                                          39170098
391800         VARYING PV-RETRY-COUNTER                                 39180098
391900         FROM 1 BY 1                                              39190098
392000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               39200098
392100                   OR (SQLCODE = ZERO))                           39210098
392200                                                                  39220098
392300         EXEC SQL                                                 39230098
392400             OPEN ADDRESS_CURSOR                                  39240098
392500         END-EXEC                                                 39250098
392600                                                                  39260098
392700         EVALUATE TRUE                                            39270098
392800             WHEN SQLCODE = ZERO                                  39280098
392900                  SET PS-NOT-END-OF-ADDR-CURSOR TO TRUE           39290098
393100             WHEN SQLCODE = -904                                  39310098
393200             WHEN SQLCODE = -913                                  39320098
393300                 CONTINUE                                         39330098
393500             WHEN SQLWARN0 NOT = SPACES                           39350098
393600             WHEN SQLCODE < ZERO                                  39360098
393700             WHEN SQLCODE > ZERO                                  39370098
393800                 MOVE '4011-OPEN-ADDR-CURSOR' TO DP013-PARAGRAPH  39380099
394000                 MOVE 'OPEN ADDRESS_CURSOR'                       39400098
394100                                   TO DP013-MESSAGE-TEXT (1)      39410098
394200                 MOVE SQLCA        TO DP013-SQLCA                 39420098
394300                 MOVE 'TBUSLOC '   TO DP013-DB2-TABLE-NAME (1)    39430098
394400                 SET DP013-DB2-ABEND                              39440098
394500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           39450098
394600                 PERFORM DP013-0000-PROCESS-ABEND                 39460098
394700         END-EVALUATE                                             39470098
394800     END-PERFORM.                                                 39480098
394900                                                                  39490099
395000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        39500098
395100         MOVE '4011-OPEN-ADDR-CURSOR' TO DP013-PARAGRAPH          39510099
395300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   39530098
395400                                   TO DP013-MESSAGE-TEXT (1)      39540098
395500         MOVE SQLCA                TO DP013-SQLCA                 39550098
395600         MOVE 'TBUSLOC '           TO DP013-DB2-TABLE-NAME (1)    39560098
395700         SET DP013-DB2-ABEND                                      39570098
395800             DP013-XCTL-DISPLAY-RESTART TO TRUE                   39580099
396000         PERFORM DP013-0000-PROCESS-ABEND                         39600098
396100     END-IF.                                                      39610098
396200                                                                  39620098
396400*----------------------------------------------------------------*39640098
396500* CLOSE THE PO_ITEM_CURSOR.                                      *39650098
396600*----------------------------------------------------------------*39660098
396800 4020-CLOSE-CURSOR.                                               39680098
397000     EXEC SQL                                                     39700098
397100         CLOSE PO_PRETICK_CURSOR                                  39710098
397200     END-EXEC                                                     39720098
397300                                                                  39730099
397400     EVALUATE TRUE                                                39740098
397500         WHEN SQLCODE = ZERO                                      39750098
397600             CONTINUE                                             39760098
397700         WHEN SQLWARN0 NOT = SPACES                               39770098
397800         WHEN SQLCODE < ZERO                                      39780098
397900         WHEN SQLCODE > ZERO                                      39790098
398000             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          39800099
398200             MOVE 'CLOSE PO_PRETICK_CURSOR'                       39820099
398300                               TO DP013-MESSAGE-TEXT (1)          39830098
398400             MOVE SQLCA        TO DP013-SQLCA                     39840098
398500             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)        39850098
398600             MOVE 'XLT_SKU '   TO DP013-DB2-TABLE-NAME (2)        39860099
398600             MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (3)        39861099
398600             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (4)        39862099
398600             MOVE 'XLT_VND_STYL' TO DP013-DB2-TABLE-NAME (5)      39863099
398700             SET DP013-DB2-ABEND                                  39870098
398800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               39880098
398900             PERFORM DP013-0000-PROCESS-ABEND                     39890098
399000     END-EVALUATE.                                                39900098
399100                                                                  39910098
399200*----------------------------------------------------------------*39920098
399300* CLOSE THE ADDRESS_CURSOR                                       *39930098
399400*----------------------------------------------------------------*39940098
399600 4021-CLOSE-ADDR-CURSOR.                                          39960098
399800     EXEC SQL                                                     39980098
399900         CLOSE ADDRESS_CURSOR                                     39990098
400000     END-EXEC                                                     40000098
400100                                                                  40010099
400200     EVALUATE TRUE                                                40020098
400300         WHEN SQLCODE = ZERO                                      40030098
400400             CONTINUE                                             40040098
400500         WHEN SQLWARN0 NOT = SPACES                               40050098
400600         WHEN SQLCODE < ZERO                                      40060098
400700         WHEN SQLCODE > ZERO                                      40070098
400800             MOVE '4021-CLOSE-ADDR-CURSOR' TO DP013-PARAGRAPH     40080099
401000             MOVE 'CLOSE ADDRESS_CURSOR'                          40100098
401100                               TO DP013-MESSAGE-TEXT (1)          40110098
401200             MOVE SQLCA        TO DP013-SQLCA                     40120098
401300             MOVE 'TBUSLOC '   TO DP013-DB2-TABLE-NAME (1)        40130098
401400             SET DP013-DB2-ABEND                                  40140098
401500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               40150098
401600             PERFORM DP013-0000-PROCESS-ABEND                     40160098
401700     END-EVALUATE.                                                40170098
401800                                                                  40180098
401900*----------------------------------------------------------------*40190098
402000* SET THE CURRENT DATE                                           *40200098
402100*----------------------------------------------------------------*40210098
402200 4050-GET-CURRENT-DATE.                                           40220098
402400     EXEC SQL                                                     40240098
402500         SET :ASC-CURRENT-DATE = CURRENT DATE                     40250098
402600     END-EXEC.                                                    40260098
402700                                                                  40270098
402800     EVALUATE TRUE                                                40280098
402900         WHEN SQLCODE = ZERO                                      40290098
403000             CONTINUE                                             40300098
403100         WHEN SQLWARN0 NOT = SPACES                               40310098
403200         WHEN SQLCODE < ZERO                                      40320098
403300         WHEN SQLCODE > ZERO                                      40330098
403400             MOVE '4050-GET-CURRENT-DATE' TO DP013-PARAGRAPH      40340099
403600             MOVE 'SET WS TO CURRENT DATE'                        40360098
403700                               TO DP013-MESSAGE-TEXT (1)          40370098
403800             MOVE SQLCA        TO DP013-SQLCA                     40380098
403900             MOVE '**NONE**'   TO DP013-DB2-TABLE-NAME (1)        40390098
404000             SET DP013-DB2-ABEND                                  40400098
404100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               40410098
404200             PERFORM DP013-0000-PROCESS-ABEND                     40420098
404300     END-EVALUATE.                                                40430098
404400                                                                  40440098
404500*----------------------------------------------------------------*40450098
404600* GET THE STATUS CODE OF THE PURCHSE ORDER                       *40460098
404700*----------------------------------------------------------------*40470098
404800 4060-GET-TYPE-CODE.                                              40480098
405000     EXEC SQL                                                     40500098
405100         SELECT PO_TYP_CDE                                        40510098
405200         INTO   :PURCHS-PO-TYP-CDE                                40520098
405300         FROM   TPURCHS                                           40530098
405400         WHERE  PO_NBR = :DK-PO-NUMBER                            40540098
405500           AND  VER_STATUS_CDE = 'A'                              40550098
405600     END-EXEC.                                                    40560098
405700                                                                  40570098
405800     EVALUATE TRUE                                                40580098
405900         WHEN SQLCODE = ZERO                                      40590098
406000             MOVE PURCHS-PO-TYP-CDE TO ASC-PO-TYPE-CDE            40600098
406100         WHEN SQLWARN0 NOT = SPACES                               40610098
406200         WHEN SQLCODE < ZERO                                      40620098
406300         WHEN SQLCODE > ZERO                                      40630098
406400             MOVE '4060-GET-TYPE-CODE.' TO DP013-PARAGRAPH        40640099
406600             MOVE 'GET PO TYPE CODE'                              40660098
406700                               TO DP013-MESSAGE-TEXT (1)          40670098
406800             MOVE DK-PO-NUMBER TO DP013-MESSAGE-TEXT (1)          40680098
406900             MOVE SQLCA        TO DP013-SQLCA                     40690098
407000             MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)         40700098
407100             SET DP013-DB2-ABEND                                  40710098
407200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               40720098
407300             PERFORM DP013-0000-PROCESS-ABEND                     40730098
407400     END-EVALUATE.                                                40740098
407500                                                                  40750098
407800*----------------------------------------------------------------*40780098
407900*    CALCULATE THE VENDOR DUE DUE ACCORDING TO THE SHIP-BY-DATE  *40790098
408000*    THE LEAD TIME.                                              *40800098
408100*    FIRST SELECT THE LEAD TIME (DEFAULT 5 DAYS), THEN SELECT    *40810098
408200*    THE "DONT SHIP BEFORE DATE" MINUS THE LEAD TIME - THAT IS   *40820098
408300*    THE VENDOR DUE DATE.                                        *40830098
408400*----------------------------------------------------------------*40840098
408500 4100-GET-CONTROL-DATES.                                          40850098
408600     MOVE ASC-ENT-ID      TO  DK-ENT-ID.                          40860098
408700     MOVE ASC-DEPT-NBR    TO  DK-DEPT-NBR.                        40870098
408800     MOVE ASC-PO-NUMBER   TO  DK-PO-NUMBER.                       40880098
408900     PERFORM 4110-GET-LEAD-TIME.                                  40890098
409000     PERFORM 4120-GET-PO-DATES.                                   40900098
409100                                                                  40910098
409200     MOVE PV-VENDOR-CAN-DATE   TO ASC-VENDOR-CAN-DATE.            40920098
409300     MOVE PV-VENDOR-DUE-DATE   TO ASC-VENDOR-DFLT-DUE-DATE        40930098
409400                                  ASC-VENDOR-DUE-DATE.            40940098
409500                                                                  40950098
409600* VALIDATE THE DUE DATE, AND CALCULATE THE PRINT DUE DATE         40960098
409700     PERFORM 3030-VALIDATE-VENDOR-DUE-DATE.                       40970098
409500                                                                  40971099
409800*----------------------------------------------------------------*40980098
409900*    SELECT THE PRETICKET LEAD TIME FROM THE PO AGREEMENT TABLE  *40990098
410000*    TABLES (DEFAULTS TO 5 DAYS IF NOT THERE)                    *41000098
410100*----------------------------------------------------------------*41010098
410200 4110-GET-LEAD-TIME.                                              41020098
410400     PERFORM                                                      41040098
410500         WITH TEST AFTER                                          41050098
410600         VARYING PV-RETRY-COUNTER                                 41060098
410700         FROM 1 BY 1                                              41070098
410800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               41080098
410900                   OR (SQLCODE = +100)                            41090098
411000                   OR (SQLCODE = ZERO))                           41100098
411100                                                                  41110098
411200         EXEC SQL                                                 41120098
411300             SELECT LEADTIME_DAYS_QTY                             41130099
411500             INTO   :POAGMT-LEADTIME-DAYS-QTY                     41150099
411700             FROM TPOAGMT                                         41170099
412000             WHERE   PO_NBR = :DK-PO-NUMBER                       41200099
412100               AND   AGRMT_TYP_ID = :PC-SERVICE-AGRMT-CDE         41210098
412200               AND   TYP_CDE      = :PC-PRETICKET-TYP-CDE         41220098
412300               AND   VER_STATUS_CDE = 'A'                         41230098
412400         END-EXEC                                                 41240098
412500                                                                  41250098
412600         EVALUATE TRUE                                            41260098
412700             WHEN SQLCODE = ZERO                                  41270098
412800                 IF POAGMT-LEADTIME-DAYS-QTY = 0                  41280098
412900                     MOVE +5 TO POAGMT-LEADTIME-DAYS-QTY          41290098
413000                 END-IF                                           41300098
413200             WHEN SQLCODE = +100                                  41320098
413300                 MOVE +5     TO POAGMT-LEADTIME-DAYS-QTY          41330098
413500             WHEN SQLCODE = -904                                  41350098
413600             WHEN SQLCODE = -913                                  41360098
413700                 CONTINUE                                         41370098
413900             WHEN SQLWARN0 NOT = SPACES                           41390098
414000             WHEN SQLCODE < ZERO                                  41400098
414100             WHEN SQLCODE > ZERO                                  41410098
414200                 MOVE '4110-GET-LEAD-TIME'  TO DP013-PARAGRAPH    41420099
414400                 MOVE 'SELECT THE PRETICKET LEAD TIME'            41440098
414500                                   TO DP013-MESSAGE-TEXT (1)      41450098
414600                 MOVE  DK-PO-NUMBER                               41460098
414700                                   TO DP013-MESSAGE-TEXT (2)      41470098
414800                 MOVE SQLCA        TO DP013-SQLCA                 41480098
414900                 MOVE 'TPOAGMT '   TO DP013-DB2-TABLE-NAME (1)    41490098
415000                 SET DP013-DB2-ABEND                              41500098
415100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           41510098
415200                 PERFORM DP013-0000-PROCESS-ABEND                 41520098
415300         END-EVALUATE                                             41530098
415400     END-PERFORM.                                                 41540098
415500                                                                  41550099
415600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        41560098
415700         MOVE '4110-GET-LEAD-TIME' TO DP013-PARAGRAPH             41570098
415800         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING VND LEAD TIME'  41580098
415900                                   TO DP013-MESSAGE-TEXT (1)      41590098
416000         MOVE SQLCA                TO DP013-SQLCA                 41600098
416100         MOVE 'TPOAGMT '           TO DP013-DB2-TABLE-NAME (1)    41610098
416200         SET DP013-DB2-ABEND                                      41620098
416300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   41630099
416500         PERFORM DP013-0000-PROCESS-ABEND                         41650098
416600     END-IF.                                                      41660098
416700                                                                  41670098
416900*----------------------------------------------------------------*41690098
417000*  IF THE PO IS AN IMPORT, GET THE XFACTORY START AND END DATES  *41700098
417100*  FOR THE VENDOR DUE DATE, AND CANCEL DATES.  IF IT IS A REGUAL *41710098
417200*  PO, USE THE DO NOT SHIP BEFORE DATE AND THE CANCEL IF NOT     *41720098
417300*  SHIPPED BY DATES.                                             *41730098
417400*----------------------------------------------------------------*41740098
417500 4120-GET-PO-DATES.                                               41750098
417700*    IF THIS IS AN IMPORT ORDER, USE THE FACTORY DATES TO FILL    41770098
417800*    IN THE DUE DATE AND CANCEL DATE                              41780098
417900     IF ASC-IMPORT-PO                                             41790098
418000       PERFORM                                                    41800099
418100         WITH TEST AFTER                                          41810098
418200         VARYING PV-RETRY-COUNTER                                 41820098
418300         FROM 1 BY 1                                              41830098
418400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               41840098
418500                   OR (SQLCODE = -183)                            41850098
418600                   OR (SQLCODE = ZERO))                           41860098
418700                                                                  41870098
418800         EXEC SQL                                                 41880098
419000         SELECT (STRT_FCTRY_DTE - :POAGMT-LEADTIME-DAYS-QTY DAYS) 41900099
419100              , LAST_FCTRY_DTE                                    41910098
419200              ,(LAST_FCTRY_DTE - :POAGMT-LEADTIME-DAYS-QTY DAYS)  41920098
419400         INTO       :PV-VENDOR-DUE-DATE                           41940099
419500                  , :PV-VENDOR-CAN-DATE-DEFAULT                   41950098
419600                  , :PV-VENDOR-CAN-DATE                           41960098
419800         FROM       TPLNSHP                                       41980099
420000         WHERE  PO_NBR =  :DK-PO-NUMBER                           42000099
420100           AND  VER_STATUS_CDE = 'A'                              42010099
420200         END-EXEC                                                 42020098
420300                                                                  42030098
420400         EVALUATE TRUE                                            42040098
420500             WHEN SQLCODE = -183                                  42050098
420600                 SET PS-IMPORT-ERROR    TO TRUE                   42060098
420700             WHEN SQLCODE = ZERO                                  42070098
420800                 IF PV-VENDOR-DUE-DATE < ASC-CURRENT-DATE         42080098
420900                    MOVE ASC-CURRENT-DATE                         42090098
421000                                    TO PV-VENDOR-DUE-DATE         42100098
421100                 END-IF                                           42110098
421200                 IF PV-VENDOR-CAN-DATE  < ASC-CURRENT-DATE        42120098
421300                    MOVE PV-VENDOR-CAN-DATE-DEFAULT               42130098
421400                                       TO PV-VENDOR-CAN-DATE      42140098
421500                 END-IF                                           42150098
421700             WHEN SQLCODE = -904                                  42170098
421800             WHEN SQLCODE = -913                                  42180098
421900                 CONTINUE                                         42190098
422100             WHEN SQLWARN0 NOT = SPACES                           42210098
422200             WHEN SQLCODE < ZERO                                  42220098
422300             WHEN SQLCODE > ZERO                                  42230098
422400                 MOVE '4120-GET-PO-SHIP-DATE' TO DP013-PARAGRAPH  42240099
422600                 MOVE 'SELECT THE PO SHIP DATE FROM TPLNSHP'      42260098
422700                                   TO DP013-MESSAGE-TEXT (1)      42270098
422800                 MOVE DK-PO-NUMBER TO DP013-MESSAGE-TEXT (2)      42280098
422900                 MOVE SQLCA        TO DP013-SQLCA                 42290098
423000                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    42300098
423100                 SET DP013-DB2-ABEND                              42310098
423200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           42320098
423300                 PERFORM DP013-0000-PROCESS-ABEND                 42330098
423400         END-EVALUATE                                             42340098
423500         END-PERFORM                                              42350098
423600                                                                  42360099
423700         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    42370098
423800             MOVE '4120-GET-PO-SHIP-DATE' TO DP013-PARAGRAPH      42380099
424000             MOVE 'MAXIMUM RETRIES EXCE SELECTING PO SHIP DATE'   42400098
424100                                   TO DP013-MESSAGE-TEXT (1)      42410098
424200             MOVE SQLCA            TO DP013-SQLCA                 42420098
424300             MOVE 'TPLNSHP '       TO DP013-DB2-TABLE-NAME (1)    42430098
424400             SET DP013-DB2-ABEND                                  42440098
424500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               42450099
424700             PERFORM DP013-0000-PROCESS-ABEND                     42470098
424800         END-IF                                                   42480098
424900                                                                  42490098
425000*    IF THIS IS NOT AN IMPORT ORDER, USE THE REGULAR START AND    42500098
425100*    END DATES.                                                   42510098
425200     ELSE                                                         42520098
425300         PERFORM                                                  42530098
425400         WITH TEST AFTER                                          42540098
425500         VARYING PV-RETRY-COUNTER                                 42550098
425600         FROM 1 BY 1                                              42560098
425700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               42570098
425800                   OR (SQLCODE = ZERO))                           42580098
425900                                                                  42590098
426000         EXEC SQL                                                 42600098
426100         SELECT                                                   42610098
426200            (DONT_SHIP_BEF_DTE - :POAGMT-LEADTIME-DAYS-QTY DAYS)  42620098
426300           , CAN_IFNOT_SHIP_DTE                                   42630098
426400           ,(CAN_IFNOT_SHIP_DTE -:POAGMT-LEADTIME-DAYS-QTY DAYS)  42640098
426500          INTO                                                    42650098
426600                    :PV-VENDOR-DUE-DATE                           42660098
426700                  , :PV-VENDOR-CAN-DATE-DEFAULT                   42670098
426800                  , :PV-VENDOR-CAN-DATE                           42680098
427000             FROM   TPLNSHP                                       42700099
427200             WHERE  PO_NBR =  :DK-PO-NUMBER                       42720099
427300               AND  VER_STATUS_CDE = 'A'                          42730098
427400         END-EXEC                                                 42740098
427500                                                                  42750098
427600         EVALUATE TRUE                                            42760098
427700             WHEN SQLCODE = ZERO                                  42770098
427800                 IF PV-VENDOR-DUE-DATE < ASC-CURRENT-DATE         42780098
427900                    MOVE ASC-CURRENT-DATE TO PV-VENDOR-DUE-DATE   42790099
428100                 END-IF                                           42810098
428200                 IF PV-VENDOR-CAN-DATE  < ASC-CURRENT-DATE        42820098
428300                    MOVE PV-VENDOR-CAN-DATE-DEFAULT               42830098
428400                                       TO PV-VENDOR-CAN-DATE      42840098
428500                 END-IF                                           42850098
428800             WHEN SQLCODE = -904                                  42880098
428900             WHEN SQLCODE = -913                                  42890098
429000                 CONTINUE                                         42900098
429200             WHEN SQLWARN0 NOT = SPACES                           42920098
429300             WHEN SQLCODE < ZERO                                  42930098
429400             WHEN SQLCODE > ZERO                                  42940098
429500                 MOVE '4120-GET-PO-SHIP-DATE'                     42950098
429600                                   TO DP013-PARAGRAPH             42960098
429700                 MOVE 'SELECT THE PO SHIP DATE FROM TPLNSHP'      42970098
429800                                   TO DP013-MESSAGE-TEXT (1)      42980098
429900                 MOVE DK-PO-NUMBER TO DP013-MESSAGE-TEXT (2)      42990098
430000                 MOVE SQLCA        TO DP013-SQLCA                 43000098
430100                 MOVE 'TPLNSHP '   TO DP013-DB2-TABLE-NAME (1)    43010098
430200                 SET DP013-DB2-ABEND                              43020098
430300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           43030098
430400                 PERFORM DP013-0000-PROCESS-ABEND                 43040098
430500         END-EVALUATE                                             43050098
430600         END-PERFORM                                              43060098
430700                                                                  43070099
430800         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    43080098
430900             MOVE '4120-GET-PO-SHIP-DATE' TO DP013-PARAGRAPH      43090099
431100             MOVE 'MAXIMUM RETRIES EXCE SELECTING PO SHIP DATE'   43110098
431200                                   TO DP013-MESSAGE-TEXT (1)      43120098
431300             MOVE SQLCA            TO DP013-SQLCA                 43130098
431400             MOVE 'TPLNSHP '       TO DP013-DB2-TABLE-NAME (1)    43140098
431500             SET DP013-DB2-ABEND                                  43150098
431600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               43160099
431800             PERFORM DP013-0000-PROCESS-ABEND                     43180098
431900         END-IF                                                   43190098
432000     END-IF.                                                      43200098
432500                                                                  43201099
432100*----------------------------------------------------------------*43210098
432200*    SELECT THE PRETICKET REQUEST INFORMATION FROM THE PRETICKET *43220098
432300*    HEADER TABLE                                                *43230098
432400*----------------------------------------------------------------*43240098
432600 4130-GET-REQUEST-INFO.                                           43260098
432800     PERFORM                                                      43280098
432900         WITH TEST AFTER                                          43290098
433000         VARYING PV-RETRY-COUNTER                                 43300098
433100         FROM 1 BY 1                                              43310098
433200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               43320098
433300                   OR (SQLCODE = ZERO))                           43330098
433400                                                                  43340098
433500         EXEC SQL                                                 43350098
433600             SELECT                                               43360098
433700                   A.ADDR_SEQ_NBR                                 43370098
433800                 , A.REQ_TYP_CDE                                  43380098
433900                 , A.REQ_STAT_CDE                                 43390098
434000                 , A.REQ_CREN_DTE                                 43400098
434100                 , A.VND_DUE_DTE                                  43410098
434200                 , A.PRT_BY_DTE                                   43420098
434300             INTO                                                 43430098
434400                   :PTKREQ-ADDR-SEQ-NBR                           43440098
434500                 , :PTKREQ-REQ-TYP-CDE                            43450098
434600                 , :PTKREQ-REQ-STAT-CDE                           43460098
434700                 , :PTKREQ-REQ-CREN-DTE                           43470098
434800                 , :PTKREQ-VND-DUE-DTE                            43480098
434900                 , :PTKREQ-PRT-BY-DTE                             43490098
435100             FROM  TPTKREQ A                                      43510099
435300             WHERE PO_REQ_NBR = :DK-PO-REQ-NBR                    43530099
435400         END-EXEC                                                 43540098
435500                                                                  43550098
435600         EVALUATE TRUE                                            43560098
435700             WHEN SQLCODE = ZERO                                  43570098
435800                 MOVE PTKREQ-ADDR-SEQ-NBR   TO ASC-ADDR-SEQ-NBR   43580098
435900                 MOVE PTKREQ-REQ-TYP-CDE    TO ASC-REQ-TYP-CDE    43590098
436000                 EVALUATE ASC-REQ-TYP-CDE                         43600098
436100                   WHEN 'P'                                       43610099
436200                     MOVE 'PRETICKET '  TO ASC-REQ-TYP-CDE-DESC   43620098
436300                   WHEN 'L'                                       43630099
436400                     MOVE 'LOCKER STK'  TO ASC-REQ-TYP-CDE-DESC   43640098
436500                 END-EVALUATE                                     43650098
436600                 MOVE PTKREQ-REQ-STAT-CDE                         43660098
436700                                        TO ASC-REQ-STAT-CDE       43670098
436800                 MOVE PTKREQ-REQ-CREN-DTE                         43680098
436900                                        TO ASC-REQUEST-DATE       43690098
437000                 MOVE PTKREQ-VND-DUE-DTE                          43700098
437100                                        TO ASC-VENDOR-DUE-DATE    43710098
437200                 MOVE PTKREQ-PRT-BY-DTE TO ASC-PRINT-DUE-DATE     43720098
437400             WHEN SQLCODE = -904                                  43740098
437500             WHEN SQLCODE = -913                                  43750098
437600                 CONTINUE                                         43760098
437800             WHEN SQLWARN0 NOT = SPACES                           43780098
437900             WHEN SQLCODE < ZERO                                  43790098
438000             WHEN SQLCODE > ZERO                                  43800098
438100                 MOVE '4130-GET-REQUEST-INFO' TO DP013-PARAGRAPH  43810099
438300                 MOVE 'SELECT THE PRETICKET REQUEST INFORMATION'  43830098
438400                                   TO DP013-MESSAGE-TEXT (1)      43840098
438500                 MOVE DK-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)     43850099
438700                 MOVE SQLCA        TO DP013-SQLCA                 43870098
438800                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    43880098
438900                 SET DP013-DB2-ABEND                              43890098
439000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           43900098
439100                 PERFORM DP013-0000-PROCESS-ABEND                 43910098
439200         END-EVALUATE                                             43920098
439300     END-PERFORM.                                                 43930098
439400                                                                  43940099
439500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        43950098
439600         MOVE '4130-GET-REQUEST-INFO' TO DP013-PARAGRAPH          43960099
439800         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING REQUEST INFO'   43980098
439900                                   TO DP013-MESSAGE-TEXT (1)      43990098
440000         MOVE SQLCA                TO DP013-SQLCA                 44000098
440100         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    44010098
440200         SET DP013-DB2-ABEND                                      44020098
440300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   44030099
440500         PERFORM DP013-0000-PROCESS-ABEND                         44050098
440600     END-IF.                                                      44060098
439400                                                                  44061099
440700*----------------------------------------------------------------*44070098
440800*    SELECT THE VENDOR NAME FROM THE TBUSLOC TABLE               *44080098
440900*----------------------------------------------------------------*44090098
441000 4140-GET-VENDOR-NAME.                                            44100098
441200     PERFORM                                                      44120098
441300         WITH TEST AFTER                                          44130098
441400         VARYING PV-RETRY-COUNTER                                 44140098
441500         FROM 1 BY 1                                              44150098
441600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               44160098
441700                   OR (SQLCODE = ZERO))                           44170098
441800                                                                  44180098
441900         EXEC SQL                                                 44190098
442000             SELECT ENT_NAME_DESC                                 44200099
442200             INTO :ENTNME-ENT-NAME-DESC                           44220099
442400             FROM TENTNME                                         44240099
442700             WHERE   ENT_ID = :ASC-ENT-ID                         44270099
442800               AND   TYPE_CDE = '01'                              44280098
442900         END-EXEC                                                 44290098
443000                                                                  44300098
443100         EVALUATE TRUE                                            44310098
443200             WHEN SQLCODE = ZERO                                  44320098
443300                 MOVE ENTNME-ENT-NAME-DESC TO ASC-VND-NAME        44330098
443500             WHEN SQLCODE = -904                                  44350098
443600             WHEN SQLCODE = -913                                  44360098
443700                 CONTINUE                                         44370098
443900             WHEN SQLWARN0 NOT = SPACES                           44390098
444000             WHEN SQLCODE < ZERO                                  44400098
444100             WHEN SQLCODE > ZERO                                  44410098
444200                 MOVE '4140-GET-VENDOR-NAME' TO DP013-PARAGRAPH   44420099
444400                 MOVE 'SELECT THE VENDOR NAME FROM'               44440098
444500                                   TO DP013-MESSAGE-TEXT (1)      44450098
444600                 MOVE  DK-ENT-ID   TO DP013-MESSAGE-TEXT (2)      44460098
444700                 MOVE SQLCA        TO DP013-SQLCA                 44470098
444800                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    44480098
444900                 SET DP013-DB2-ABEND                              44490098
445000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           44500098
445100                 PERFORM DP013-0000-PROCESS-ABEND                 44510098
445200         END-EVALUATE                                             44520098
445300     END-PERFORM.                                                 44530098
445400                                                                  44540099
445500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        44550098
445600         MOVE '4140-GET-VENDOR-NAME' TO DP013-PARAGRAPH           44560099
445800         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING VND NAME'       44580098
445900                                   TO DP013-MESSAGE-TEXT (1)      44590098
446000         MOVE SQLCA                TO DP013-SQLCA                 44600098
446100         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    44610098
446200         SET DP013-DB2-ABEND                                      44620098
446300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   44630099
446500         PERFORM DP013-0000-PROCESS-ABEND                         44650098
446600     END-IF.                                                      44660098
446700                                                                  44670098
446800*----------------------------------------------------------------*44680098
446900*    CHECK FOR REASON CODES ON   THE TPTKRSN TABLE               *44690099
447000*----------------------------------------------------------------*44700098
447100 4150-CHECK-FOR-REASON-CODES.                                     44710098
447300     PERFORM                                                      44730098
447400         WITH TEST AFTER                                          44740098
447500         VARYING PV-RETRY-COUNTER                                 44750098
447600         FROM 1 BY 1                                              44760098
447700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               44770098
447800                   OR (SQLCODE = ZERO))                           44780098
447900                                                                  44790098
448000         EXEC SQL                                                 44800098
448200             SELECT  COUNT (DISTINCT REQ_RSN_CDE)                 44820099
448400             INTO  :PV-REASON-COUNT                               44840099
448600             FROM  TPTKRSN                                        44860099
448800             WHERE PO_REQ_NBR = :ASC-PO-REQ-NBR                   44880099
448900         END-EXEC                                                 44890098
449000                                                                  44900098
449100         EVALUATE TRUE                                            44910098
449200             WHEN SQLCODE = ZERO                                  44920098
449300                 IF PV-REASON-COUNT > 0                           44930098
449400                     SET ASC-REASON-CODES-EXIST      TO TRUE      44940098
449500                 ELSE                                             44950098
449600                     SET ASC-REASON-CODES-DONT-EXIST TO TRUE      44960098
449700                 END-IF                                           44970098
449900             WHEN SQLCODE = -904                                  44990098
450000             WHEN SQLCODE = -913                                  45000098
450100                 CONTINUE                                         45010098
450300             WHEN SQLWARN0 NOT = SPACES                           45030098
450400             WHEN SQLCODE < ZERO                                  45040098
450500             WHEN SQLCODE > ZERO                                  45050098
450600                 MOVE '4150-CHECK-FOR-REASON-CODES'               45060098
450700                                   TO DP013-PARAGRAPH             45070098
450800                 MOVE 'SELECT THE REASON CODE TABLE'              45080098
450900                                   TO DP013-MESSAGE-TEXT (1)      45090098
451000                 MOVE ASC-PO-REQ-NBR                              45100098
451100                                   TO DP013-MESSAGE-TEXT (2)      45110098
451200                 MOVE SQLCA        TO DP013-SQLCA                 45120098
451300                 MOVE 'TPTKRSN '   TO DP013-DB2-TABLE-NAME (1)    45130098
451400                 SET DP013-DB2-ABEND                              45140098
451500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           45150098
451600                 PERFORM DP013-0000-PROCESS-ABEND                 45160098
451700         END-EVALUATE                                             45170098
451800     END-PERFORM.                                                 45180098
451900                                                                  45190099
452000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        45200098
452100         MOVE '4150-CHECK-FOR-REASON-CODES' TO DP013-PARAGRAPH    45210099
452300         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING REASONS'        45230098
452400                                   TO DP013-MESSAGE-TEXT (1)      45240098
452500         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      45250098
452600         MOVE SQLCA                TO DP013-SQLCA                 45260098
452700         MOVE 'TPTKRSN '           TO DP013-DB2-TABLE-NAME (1)    45270098
452800         SET DP013-DB2-ABEND                                      45280098
452900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   45290099
453100         PERFORM DP013-0000-PROCESS-ABEND                         45310098
453200     END-IF.                                                      45320098
453300                                                                  45330098
453400*----------------------------------------------------------------*45340098
453500*    READ THE PRETICKET ADDRESSES FROM DB2 AND MOVE THEM INTO    *45350098
453600*    AN ARRAY AND WRITE THEM TO A TEMPORARY STORAGE QUEUE.       *45360098
453700*----------------------------------------------------------------*45370098
453900 4200-LOAD-ADDRESS-QUEUE.                                         45390098
454100     PERFORM 4220-DELETE-ADDR-QUEUE.                              45410098
454300     INITIALIZE VL007-ADDRESS-RECORD                              45430098
454400                ASC-ADDRESS-COUNT.                                45440098
454600     PERFORM 4011-OPEN-ADDR-CURSOR.                               45460098
454700     PERFORM 4210-FETCH-ADDR-CURSOR.                              45470098
454800                                                                  45480098
454900     IF PS-END-OF-ADDR-CURSOR                                     45490098
455000         SET ASC-ADDR-DOESNT-EXIST TO TRUE                        45500098
455100         MOVE 'NO PRETICKET ADDRESS WAS FOUND ON THE VENDOR FILE' 45510098
455200              TO ASC-ADDR-LINE (1)                                45520098
455300     ELSE                                                         45530098
455400         SET ASC-ADDR-EXISTS       TO TRUE                        45540098
455500     END-IF.                                                      45550098
455600                                                                  45560098
455700     PERFORM UNTIL PS-END-OF-ADDR-CURSOR                          45570098
455702         IF BUSLOC-CNTRY-CDE NOT = 'US '                          45570299
455703           PERFORM 4215-RETRIEVE-ST-PRV-CNTY-NAME                 45570399
455704         END-IF                                                   45570499
455900         MOVE BUSLOC-SEQ-NBR       TO VL007-SEQ-NBR               45590098
456000         MOVE BUSLOC-ADDRESS-LINE1-DESC                           45600098
456100                                   TO VL007-ADDRESS-LINE1-DESC    45610098
456200         MOVE BUSLOC-ADDRESS-LINE2-DESC                           45620098
456300                                   TO VL007-ADDRESS-LINE2-DESC    45630098
456400         MOVE BUSLOC-ADDRESS-LINE3-DESC                           45640098
456500                                   TO VL007-ADDRESS-LINE3-DESC    45650098
456600         MOVE BUSLOC-ADDRESS-LINE4-DESC                           45660098
456700                                   TO VL007-ADDRESS-LINE4-DESC    45670098
456800         MOVE BUSLOC-ATTENTION-TO-TXT                             45680098
456900                                   TO VL007-ATTENTION-TO-TXT      45690098
457000         MOVE BUSLOC-CITY-NAME     TO VL007-CITY-NAME             45700098
457010         MOVE SPACES               TO VL007-STATE-CDE             45710099
457020                                      VL007-PROVINCE-NM           45710199
457030         IF BUSLOC-CNTRY-CDE = 'US '                              45710299
457040            MOVE SPACES TO PV-STATE-PROV                          45710399
457050                           PV-COUNTRY                             45710499
457103            MOVE BUSLOC-ST-PROV-CDE   TO VL007-STATE-CDE          45710599
457104         ELSE                                                     45710699
457105            MOVE PV-STATE-PROV        TO VL007-PROVINCE-NM        45710799
457106         END-IF                                                   45710899
457108         MOVE PV-COUNTRY           TO VL007-COUNTRY-NM            45710999
457200         MOVE BUSLOC-ZIP-CDE       TO VL007-ZIP-CDE               45720098
457500         MOVE ENTREP-FIRST-NAME    TO VL007-FIRST-NAME            45750098
457600         MOVE ENTREP-LAST-NAME     TO VL007-LAST-NAME             45760098
457700                                                                  45770098
457800         PERFORM 4230-WRITE-ADDR-QUEUE                            45780098
457900                                                                  45790098
458000* IF THE CURRENT ADDRESS IS ALREADY ATTACHED TO THE REQUEST, MOVE 45800098
458100* TO THE COMMAREA                                                 45810098
458200         IF BUSLOC-SEQ-NBR = ASC-ADDR-SEQ-NBR                     45820098
458300             PERFORM 4250-MOVE-ADDR-TO-COMMAREA                   45830098
458400             MOVE ASC-ADDRESS-COUNT TO ASC-CURRENT-ADDR-ITEM      45840098
458500         END-IF                                                   45850098
458700         PERFORM 4210-FETCH-ADDR-CURSOR                           45870098
458900     END-PERFORM.                                                 45890098
459000                                                                  45900098
459100     PERFORM 4021-CLOSE-ADDR-CURSOR.                              45910098
459200                                                                  45920098
459300* IF THERE IS NO ADDRESS ATTACHED TO THE REQUEST, DISPLAY THE FIRS45930098
459400* ONE TO THE SCREEN.                                              45940098
459500     IF ASC-ADDR-SEQ-NBR = 0                                      45950098
459600     AND ASC-ADDR-EXISTS                                          45960098
459700         MOVE +1 TO ASC-CURRENT-ADDR-ITEM                         45970098
459900         PERFORM 4240-READ-ADDR-QUEUE                             45990098
460100         PERFORM 4250-MOVE-ADDR-TO-COMMAREA                       46010098
460200     END-IF.                                                      46020098
460300                                                                  46030098
460600*----------------------------------------------------------------*46060098
460700*    FETCH THE PRETCKET ADDRESS CURSOR                           *46070098
460800*----------------------------------------------------------------*46080098
461000 4210-FETCH-ADDR-CURSOR.                                          46100098
461100     EXEC SQL                                                     46110098
461200          FETCH ADDRESS_CURSOR                                    46120098
461300          INTO                                                    46130098
461400                :BUSLOC-SEQ-NBR                                   46140098
461500               ,:BUSLOC-ADDRESS-LINE1-DESC                        46150098
461600               ,:BUSLOC-ADDRESS-LINE2-DESC                        46160098
461700               ,:BUSLOC-ADDRESS-LINE3-DESC                        46170098
461800               ,:BUSLOC-ADDRESS-LINE4-DESC                        46180098
461900               ,:BUSLOC-ATTENTION-TO-TXT                          46190098
462000               ,:BUSLOC-CITY-NAME                                 46200098
462110               ,:BUSLOC-ST-PROV-CDE                               46211099
462200               ,:BUSLOC-ZIP-CDE                                   46220098
462210               ,:BUSLOC-CNTRY-CDE                                 46221099
462500               ,:ENTREP-FIRST-NAME                                46250098
462600               ,:ENTREP-LAST-NAME                                 46260098
462700     END-EXEC                                                     46270098
462900                                                                  46290098
463000     EVALUATE TRUE                                                46300098
463100         WHEN SQLCODE = ZERO                                      46310098
463101              CONTINUE                                            46311099
463200         WHEN SQLCODE = +100                                      46320098
463300              SET PS-END-OF-ADDR-CURSOR TO TRUE                   46330099
463400         WHEN SQLWARN0 NOT = SPACE                                46340098
463500         WHEN SQLCODE NOT = ZERO                                  46350098
463600              MOVE '4210-FETCH-ADDR-CURSOR' TO DP013-PARAGRAPH    46360099
463800              MOVE 'FETCH ADDRESS_CURSOR'                         46380098
463900                               TO DP013-MESSAGE-TEXT (1)          46390098
464000              MOVE DK-ENT-ID   TO DP013-MESSAGE-TEXT (2)          46400098
464100              MOVE SQLCA       TO DP013-SQLCA                     46410098
464200              SET DP013-DB2-ABEND TO TRUE                         46420099
464400              PERFORM DP013-0000-PROCESS-ABEND                    46440098
464500     END-EVALUATE.                                                46450098
465000                                                                  46500098
465001*----------------------------------------------------------------*46500199
465002*    RETRIEVE COUNTRY AND STATE NAME                             *46500299
465003*----------------------------------------------------------------*46500399
465004 4215-RETRIEVE-ST-PRV-CNTY-NAME.                                  46500499
465006     MOVE SPACES                 TO PV-STATE-PROV                 46500699
465007                                    PV-COUNTRY.                   46500799
465008     MOVE BUSLOC-ST-PROV-CDE     TO DP410-STATE-CODE.             46500899
465009     MOVE BUSLOC-CNTRY-CDE       TO DP410-COUNTRY-CODE.           46500999
465010                                                                  46501099
465013     CALL PC-DPKUT410 USING DFHEIBLK                              46501399
465014                            PV-DPKUT410-COMMAREA                  46501499
465015                            DP410-ST-PROV-CNTRY-ROUTINE.          46501599
465016                                                                  46501699
465017     EVALUATE TRUE                                                46501799
465019         WHEN  DP410-DB2-ERROR                                    46501999
465020             MOVE '4215-RETRIEVE-ST-PRV-CNTY-NAME'                46502099
465021                                      TO DP013-PARAGRAPH          46502199
465022             DISPLAY 'STATE/PROV = ' DP410-STATE-CODE             46502299
465023             DISPLAY 'COUNTRY = ' DP410-COUNTRY-CODE              46502399
465024             MOVE 'PS_COUNTRY'        TO DP013-DB2-TABLE-NAME (1) 46502499
465025             MOVE 'PS_STATE'          TO DP013-DB2-TABLE-NAME (2) 46502599
465026             SET DP013-DB2-ABEND   TO TRUE                        46502699
465027             SET DP013-NO-ROLLBACK TO TRUE                        46502799
465028             MOVE SQLCA            TO DP013-SQLCA                 46502899
465029             PERFORM DP013-0000-PROCESS-ABEND                     46502999
465031         WHEN  DP410-DEADLOCK-BYPASS-ROUTINE                      46503199
465032             MOVE DP410-STATE-CODE TO PV-STATE-PROV               46503299
465033             MOVE DP410-COUNTRY-CODE TO PV-COUNTRY                46503399
465035         WHEN  OTHER                                              46503599
465036             MOVE DP410-STATE-NAME TO PV-STATE-PROV               46503699
465037             MOVE DP410-COUNTRY-NAME TO PV-COUNTRY                46503799
465038     END-EVALUATE.                                                46503899
465100                                                                  46510098
465200*----------------------------------------------------------------*46520098
465300*    DELETE THE PRETICKET ADDRESS TEMP STORAGE QUEUE.            *46530098
465400*----------------------------------------------------------------*46540098
465500 4220-DELETE-ADDR-QUEUE.                                          46550098
465700     EXEC CICS                                                    46570098
465800         DELETEQ TS                                               46580098
465900             QUEUE (ASC-ADDR-QUEUE-NAME)                          46590098
466000             RESP  (PV-CICS-RESP)                                 46600098
466100     END-EXEC.                                                    46610098
466200                                                                  46620099
466300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      46630098
466400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         46640098
466500         CONTINUE                                                 46650098
466600     ELSE                                                         46660098
466700         SET DP013-CICS-ABEND TO TRUE                             46670098
466800         SET DP013-NO-ROLLBACK TO TRUE                            46680098
466900         MOVE '4220-DELETE-ADDR-QUEUE' TO DP013-PARAGRAPH         46690099
467100         MOVE 'ERROR TRYING TO DELETE ADDRESS TS QUEUE'           46710098
467200                        TO DP013-MESSAGE-TEXT (1)                 46720098
467300         PERFORM DP013-0000-PROCESS-ABEND                         46730098
467400     END-IF.                                                      46740098
467500                                                                  46750098
467600*----------------------------------------------------------------*46760098
467700*    WRITE THE ADDRESS RECORD TEMP STORAGE QUEUE.                *46770098
467800*----------------------------------------------------------------*46780098
468000 4230-WRITE-ADDR-QUEUE.                                           46800098
468200     EXEC CICS                                                    46820098
468300          WRITEQ TS                                               46830098
468400              QUEUE (ASC-ADDR-QUEUE-NAME)                         46840098
468500              FROM  (VL007-ADDRESS-RECORD)                        46850098
468600              ITEM  (ASC-ADDRESS-COUNT)                           46860098
468700              RESP  (PV-CICS-RESP)                                46870098
468800     END-EXEC.                                                    46880098
468900                                                                  46890098
469000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          46900098
469100         CONTINUE                                                 46910098
469200     ELSE                                                         46920098
469300         SET DP013-CICS-ABEND      TO TRUE                        46930098
469400         SET DP013-NO-ROLLBACK     TO TRUE                        46940098
469500         MOVE '4230-WRITE-ADDR-QUEUE'                             46950098
469600                                   TO DP013-PARAGRAPH             46960098
469700         MOVE 'ATTEMPTING TO WRITE ADDRESS RECORD QUEUE'          46970098
469800                                   TO DP013-MESSAGE-TEXT(1)       46980098
469900         PERFORM DP013-0000-PROCESS-ABEND                         46990098
470000     END-IF.                                                      47000098
468900                                                                  47001099
470100*----------------------------------------------------------------*47010098
470200*    READ A RECORD FROM THE ADDRESS QUEUE                        *47020098
470300*----------------------------------------------------------------*47030098
470500 4240-READ-ADDR-QUEUE.                                            47050098
470700     IF ASC-ADDR-DOESNT-EXIST                                     47070098
470800*        PRETICKET ADDRESS DOESN'T EXIST MESSAGE                  47080098
470900         MOVE PC-TSYMSG-01337      TO DP020-MSG-NUMBER            47090098
471000         SET DP020-MSG-INFORMATIONAL TO TRUE                      47100098
471100     ELSE                                                         47110098
471200         EXEC CICS                                                47120098
471300              READQ TS                                            47130098
471400                  QUEUE (ASC-ADDR-QUEUE-NAME)                     47140098
471500                  INTO  (VL007-ADDRESS-RECORD)                    47150098
471600                  ITEM  (ASC-CURRENT-ADDR-ITEM)                   47160098
471700                  RESP  (PV-CICS-RESP)                            47170098
471800         END-EXEC                                                 47180098
471900*                                                                 47190098
472000         IF  PV-CICS-RESP = DFHRESP (NORMAL)                      47200098
472100             CONTINUE                                             47210098
472200         ELSE                                                     47220098
472300             SET DP013-CICS-ABEND      TO  TRUE                   47230098
472400             SET DP013-NO-ROLLBACK     TO  TRUE                   47240098
472500             MOVE '4240-READ-ADDR-QUEUE' TO DP013-PARAGRAPH       47250099
472700             MOVE 'ATTEMPTING TO READ THE ADDRESS QUEUE'          47270098
472800                                       TO  DP013-MESSAGE-TEXT(1)  47280098
472900             PERFORM DP013-0000-PROCESS-ABEND                     47290098
473000         END-IF                                                   47300098
473100       END-IF.                                                    47310098
473200*----------------------------------------------------------------*47320098
473300*    THIS PARAGRAPH WILL MOVE AN ADDRESS FROM THE ADDRESS QUEUE  *47330098
473400*    INTO THE COMMAREA ADDRESS FIELDS                            *47340098
473500*----------------------------------------------------------------*47350098
473700 4250-MOVE-ADDR-TO-COMMAREA.                                      47370098
473900     INITIALIZE ASC-ADDR-LINE-TABLE.                              47390098
474000     SET ASC-ADDR-IDX TO +1.                                      47400098
474200     MOVE VL007-SEQ-NBR       TO ASC-ADDR-SEQ-NBR.                47420098
474300     MOVE VL007-COUNTRY-NM    TO ASC-ADDR-COUNTRY.                47430098
474400                                                                  47440098
474500**  ATTENTION-TO-TXT  ********************************************47450098
474600     IF VL007-ATTENTION-TO-TXT = SPACES                           47460098
474700         CONTINUE                                                 47470098
474800     ELSE                                                         47480098
474900         MOVE VL007-ATTENTION-TO-TXT                              47490098
475000              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     47500098
475100         SET ASC-ADDR-IDX UP BY +1                                47510098
475200     END-IF.                                                      47520098
475300                                                                  47530098
475400**  REP NAME *****************************************************47540098
475500     IF  VL007-FIRST-NAME = SPACES                                47550098
475600     AND VL007-LAST-NAME = SPACES                                 47560098
475700         CONTINUE                                                 47570098
475800     ELSE                                                         47580098
475900          STRING                                                  47590098
476000              VL007-FIRST-NAME DELIMITED BY '  '                  47600098
476100              ' '              DELIMITED BY SIZE                  47610098
476200              VL007-LAST-NAME  DELIMITED BY '  '                  47620098
476300          INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                        47630098
476400         SET ASC-ADDR-IDX UP BY +1                                47640098
476500     END-IF.                                                      47650098
476600                                                                  47660098
476700** ADDRESS LINE 1 ************************************************47670098
476800     IF VL007-ADDRESS-LINE1-DESC = SPACES                         47680098
476900         CONTINUE                                                 47690098
477000     ELSE                                                         47700098
477100         MOVE VL007-ADDRESS-LINE1-DESC                            47710098
477200              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     47720098
477300         SET ASC-ADDR-IDX UP BY +1                                47730098
477400     END-IF.                                                      47740098
477500                                                                  47750098
477600** ADDRESS LINE 2 ************************************************47760098
477700     IF VL007-ADDRESS-LINE2-DESC = SPACES                         47770098
477800         CONTINUE                                                 47780098
477900     ELSE                                                         47790098
478000         MOVE VL007-ADDRESS-LINE2-DESC                            47800098
478100              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     47810098
478200         SET ASC-ADDR-IDX UP BY +1                                47820098
478300     END-IF.                                                      47830098
478400                                                                  47840098
478500** ADDRESS LINE 3 ************************************************47850098
478600     IF VL007-ADDRESS-LINE3-DESC = SPACES                         47860098
478700         CONTINUE                                                 47870098
478800     ELSE                                                         47880098
478900         MOVE VL007-ADDRESS-LINE3-DESC                            47890098
479000              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     47900098
479100         SET ASC-ADDR-IDX UP BY +1                                47910098
479200     END-IF.                                                      47920098
479300                                                                  47930098
479400** ADDRESS LINE 4 ************************************************47940098
479500     IF VL007-ADDRESS-LINE4-DESC = SPACES                         47950098
479600         CONTINUE                                                 47960098
479700     ELSE                                                         47970098
479800         MOVE VL007-ADDRESS-LINE4-DESC                            47980098
479900              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     47990098
480000         SET ASC-ADDR-IDX UP BY +1                                48000098
480100     END-IF.                                                      48010098
480200                                                                  48020098
480300** CITY STATE ZIP PROVINCE COUNTRY *******************************48030098
480400     STRING                                                       48040098
480500         VL007-CITY-NAME DELIMITED BY '  '                        48050098
480600         ' ' DELIMITED BY SIZE                                    48060098
480700         VL007-STATE-CDE DELIMITED BY SIZE                        48070098
480800         ' ' DELIMITED BY SIZE                                    48080098
480900         VL007-PROVINCE-NM DELIMITED BY '  '                      48090098
481000         ' ' DELIMITED BY SIZE                                    48100098
481100         VL007-ZIP-CDE   DELIMITED BY '  '                        48110098
481200         ' ' DELIMITED BY SIZE                                    48120098
481300         VL007-COUNTRY-NM DELIMITED BY '  '                       48130098
481400     INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                             48140098
481500     ON OVERFLOW                                                  48150098
481600         MOVE SPACES TO ASC-ADDR-LINE(ASC-ADDR-IDX)               48160098
481700         STRING                                                   48170098
481800             VL007-CITY-NAME DELIMITED BY '  '                    48180098
481900             ' ' DELIMITED BY SIZE                                48190098
482000             VL007-STATE-CDE DELIMITED BY SIZE                    48200098
482100             ' ' DELIMITED BY SIZE                                48210098
482200             VL007-ZIP-CDE   DELIMITED BY '  '                    48220098
482300         INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                         48230098
482400                                                                  48240098
482500         SET ASC-ADDR-IDX UP BY +1                                48250098
482600                                                                  48260098
482700         STRING                                                   48270098
482800             VL007-PROVINCE-NM DELIMITED BY '  '                  48280098
482900             ' ' DELIMITED BY SIZE                                48290098
483000             VL007-COUNTRY-NM DELIMITED BY '  '                   48300098
483100         INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                         48310098
483200     END-STRING.                                                  48320098
483300                                                                  48330099
483400     IF  VL007-ADDRESS-LINE1-DESC = SPACES                        48340098
483500        AND VL007-ADDRESS-LINE2-DESC = SPACES                     48350099
483600        AND VL007-ADDRESS-LINE3-DESC = SPACES                     48360099
483700        AND VL007-ADDRESS-LINE4-DESC = SPACES                     48370099
483800         SET ASC-ADDR-INVALID TO TRUE                             48380098
483900     ELSE                                                         48390098
484000         SET ASC-ADDR-EXISTS  TO TRUE                             48400098
484100     END-IF.                                                      48410098
484200                                                                  48420099
484300*----------------------------------------------------------------*48430098
484400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *48440098
484500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *48450098
484600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *48460098
484700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *48470098
484800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *48480098
484900*                                                                *48490098
485000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *48500098
485100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *48510098
485200*    UPON INITIALIZATION.                                        *48520098
485300*----------------------------------------------------------------*48530098
485500 4300-READ-ITEMS-FROM-DB.                                         48550098
485700     PERFORM                                                      48570098
485800         VARYING PV-READ-COUNT                                    48580098
485900         FROM 1 BY 1                                              48590098
486000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    48600098
486100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         48610098
486200                                                                  48620098
486300         PERFORM 4310-FETCH                                       48630098
486400                                                                  48640098
486500         IF  ASC-ITEMS-LEFT-ON-DB                                 48650098
486600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                48660098
486700                 ADD +1            TO ASC-ITEM-SUB                48670098
486800             ELSE                                                 48680098
486900                 ADD +1            TO ASC-BLK-SUB                 48690098
487000                 MOVE +1           TO ASC-ITEM-SUB                48700098
487200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         48720098
487300                     MOVE +1       TO ASC-BLK-SUB                 48730098
487400                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           48740099
487600                     PERFORM 5100-WRITE-TEMP-STORAGE              48760098
487700                     MOVE ASC-BLOCK-ENTRIES                       48770098
487800                               (PC-MAX-BLOCKS-IN-ARRAY)           48780098
487900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 48790098
488000                     ADD +1        TO ASC-BLK-SUB                 48800098
488100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   48810098
488200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      48820098
488300                                   TO TRUE                        48830098
488400                 END-IF                                           48840098
488500             END-IF                                               48850098
488600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    48860098
488700             MOVE ASC-NUMBER-OF-ITEMS-READ                        48870098
488800                                   TO ASC-LIST-ITEM-NUMBER        48880098
488900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  48890098
489000             SET ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            48900098
489100                 ASC-TEMP-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       48910098
489200                                   TO TRUE                        48920098
489300             MOVE PURITM-PO-LNE-NBR                               48930098
489400                                       TO ASC-PO-LINE-NBR         48940099
489500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 48950098
489600             MOVE PURITM-APP-PO-LNE-NBR                           48960098
489700                               TO  ASC-APP-PO-LINE-NBR            48970098
489800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 48980098
489900                                                                  48990098
490300             MOVE XLT00004-MAJ-CL-NBR                             49030099
490400                               TO  ASC-MAJ-CLASS                  49040099
490500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49050098
490300             MOVE XLT00004-SUB-CL-NBR                             49051099
490400                               TO  ASC-SUB-CLASS                  49052099
490500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49053099
490300             MOVE XLT00003-SKU-NBR                                49060099
490400                               TO  ASC-SKU-NBR                    49070099
490500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49080099
490800             MOVE XLT00003-SKU-DESC TO  ASC-SKU-DESC              49091099
490900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49092099
491300             MOVE PV-LNE-RQST-IND                                 49093099
491400                               TO  ASC-LNE-RQST-IND               49094099
491500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49095099
491600                                   ASC-DB2-LNE-RQST-IND           49096099
491700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49097099
491800             IF ASC-LNE-ON-RQST (ASC-BLK-SUB ASC-ITEM-SUB)        49180098
491900                 MOVE PTKLNE-TKT-DESC                             49191099
492000                               TO  DK-TICKET-TYPE                 49200098
492100                                   ASC-TICKET-TYPE                49210098
492200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49220098
492300                 ADD +1        TO ASC-REQUEST-LINE-COUNT          49230098
492400* CHECK TO SEE IF THERE IS A MATCHING TICKET FORMAT.              49240098
492500                 PERFORM 3050-VALIDATE-TICKET-FORMAT              49250098
492600                 IF PS-VALID-TICK-FMT                             49260098
492700                     SET ASC-TTYPE-PRINT-YES                      49270098
492800                         (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE       49280098
492900                 ELSE                                             49290098
493000                     SET ASC-TTYPE-PRINT-NO                       49300098
493100                         (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE       49310098
493200                 END-IF                                           49320098
493300             ELSE                                                 49330098
493400                 PERFORM 4320-GET-DEFAULT-TICKET-TYPE             49340098
493500             END-IF                                               49350098
493600                                                                  49360098
493700* IF THE LINE IS NOT INCLUDED ON THE REQUEST, AND IT IS AN UPDATE,49370098
493800* IT IS TRULY NOT ON THE REQUEST (USER MUST HAVE DELETED).        49380098
493900             IF  ASC-LNE-OFF-RQST (ASC-BLK-SUB ASC-ITEM-SUB)      49390098
494000                 IF (ASC-UPDATE-REG OR ASC-UPDATE-RESUB)          49400098
494100                     CONTINUE                                     49410098
494200                 ELSE                                             49420098
494300* IF IT IS AN ADD, CHANGE TO AUTOMATICALLY INCLUDE THE LINE ON THE49430098
494400* REQUEST IF THE DEFAULT TICKET TYPE HAS A VALID TICKET FORMAT    49440098
494500                     SET ASC-LNE-ON-RQST                          49450098
494600                         (ASC-BLK-SUB ASC-ITEM-SUB)               49460098
494700                                   TO  TRUE                       49470098
494800                     ADD +1 TO ASC-REQUEST-LINE-COUNT             49480098
494900                 END-IF                                           49490098
495000             END-IF                                               49500098
495100                                                                  49510098
495200             MOVE PTKLNE-TKT-PLCMNT-CDE                           49520098
495300                               TO  ASC-TICKET-PLACE               49530098
495400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49540098
495800             MOVE PURITM-UNT-QTY                                  49580098
495900                               TO  ASC-PO-QUANTITY-N              49590098
496000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49600098
496100             MOVE PTKLNE-TKT-QTY                                  49610098
496200                               TO  ASC-RQST-QUANTITY-N            49620098
496300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49630098
495500             MOVE PTKLNE-OPT-BLCK-CDE                             49630499
495600                               TO  ASC-OPTION-BLOCK               49630599
495700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49630699
491000             MOVE XLT00004-STKR-NBR                               49634099
491100                               TO  ASC-STICKER-NBR                49635099
491200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 49636099
496400         END-IF                                                   49640098
496500     END-PERFORM.                                                 49650098
496600                                                                  49660098
496700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          49670098
496800         MOVE +1               TO ASC-BLK-SUB                     49680098
496900         PERFORM 5100-WRITE-TEMP-STORAGE                          49690098
497000         ADD +1                TO ASC-BLK-SUB                     49700098
497100         PERFORM 5100-WRITE-TEMP-STORAGE                          49710098
497200                                                                  49720098
497300         MOVE 1                TO ASC-BLK-SUB                     49730098
497400                                  PV-BLOCK-NUMBER                 49740098
497500         PERFORM 4410-READ-TEMP-STORAGE                           49750098
497600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             49760098
497700             MOVE 2            TO ASC-BLK-SUB                     49770098
497800                                  PV-BLOCK-NUMBER                 49780098
497900             PERFORM 4410-READ-TEMP-STORAGE                       49790098
498000         END-IF                                                   49800098
498100     END-IF.                                                      49810098
498200                                                                  49820098
498400*----------------------------------------------------------------*49840098
498500*    FETCH THE MESSAGE CURSOR.                                   *49850098
498600*----------------------------------------------------------------*49860098
498800 4310-FETCH.                                                      49880098
499000     EXEC SQL                                                     49900098
499100          FETCH PO_PRETICK_CURSOR                                 49910098
499200          INTO  :PURITM-PO-LNE-NBR                                49920098
499300              , :PURITM-APP-PO-LNE-NBR                            49930098
499400              , :XLT00004-DEPT-NBR                                49940099
499500              , :XLT00004-MAJ-CL-NBR                              49950099
499500              , :XLT00004-SUB-CL-NBR                              49951099
499600              , :XLT00003-SKU-NBR                                 49960099
499700              , :XLT00003-SKU-DESC                                49970099
499800              , :PTKLNE-TKT-DESC                                  49980098
499900              , :XLT00004-STKR-NBR                                49990099
500000              , :PTKLNE-OPT-BLCK-CDE                              50000098
500100              , :PTKLNE-TKT-PLCMNT-CDE                            50010098
500200              , :PURITM-UNT-QTY                                   50020098
500300              , :PTKLNE-TKT-QTY                                   50030098
500400              , :PV-LNE-RQST-IND                                  50040098
500400              , :XLT00004-TKT-TYP-DESC                            50041099
500500     END-EXEC                                                     50050098
500600                                                                  50060098
500700     EVALUATE TRUE                                                50070098
500800         WHEN SQLCODE = ZERO                                      50080098
500900         WHEN SQLCODE = +100                                      50090098
501000              CONTINUE                                            50100098
501100         WHEN SQLWARN0 NOT = SPACE                                50110098
501200         WHEN SQLCODE NOT = ZERO                                  50120098
501300              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         50130099
501500              MOVE 'FETCH PO_ITEM_CURSOR'                         50150098
501600                               TO DP013-MESSAGE-TEXT (1)          50160098
501700              MOVE SQLCA       TO DP013-SQLCA                     50170098
501800              SET DP013-DB2-ABEND TO TRUE                         50180099
502000              PERFORM DP013-0000-PROCESS-ABEND                    50200098
502100     END-EVALUATE.                                                50210098
502200                                                                  50220098
502300     IF  SQLCODE EQUAL +100                                       50230098
502400         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      50240099
502600     END-IF.                                                      50260098
502700                                                                  50270098
502800*----------------------------------------------------------------*50280098
502900*    GET THE DEFAULT TICKET TYPE.                                 50290099
522300* CHECK FOR A MATCHING TICKET                                     50300099
522400* FORMAT AND SET THE TICKET TYPE PRINT SWITCH ACCORDINGLY         50310099
503200*----------------------------------------------------------------*50320098
503400 4320-GET-DEFAULT-TICKET-TYPE.                                    50340099
522500     MOVE XLT00004-TKT-TYP-DESC TO DK-TICKET-TYPE                 52250099
522700                                   ASC-TICKET-TYPE                52270099
522800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 52280099
522900     PERFORM 3050-VALIDATE-TICKET-FORMAT                          52290099
523000     IF PS-VALID-TICK-FMT                                         52300099
523100         SET ASC-TTYPE-PRINT-YES (ASC-BLK-SUB ASC-ITEM-SUB)       52310099
523200             TO TRUE                                              52320099
523300     ELSE                                                         52330099
523400         SET ASC-TTYPE-PRINT-NO  (ASC-BLK-SUB ASC-ITEM-SUB)       52340099
523500             TO TRUE                                              52350099
523600     END-IF.                                                      52360099
523800                                                                  52380098
524000*----------------------------------------------------------------*52400098
524100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *52410098
524200*----------------------------------------------------------------*52420098
524400 4400-MOVE-COMMAREA-TO-SCREEN.                                    52440098
524500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             52450098
524600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          52460098
524700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          52470098
524800             MOVE +1    TO ASC-BLK-SUB                            52480098
524900             PERFORM 5100-WRITE-TEMP-STORAGE                      52490098
525000             ADD +1     TO ASC-BLK-SUB                            52500098
525100             PERFORM 5100-WRITE-TEMP-STORAGE                      52510098
525200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             52520098
525300                 GIVING PV-BLOCK-NUMBER                           52530098
525400                 REMAINDER PV-REMAINDER                           52540098
525500             IF  PV-REMAINDER > ZERO                              52550098
525600                 ADD +1 TO PV-BLOCK-NUMBER                        52560098
525700             END-IF                                               52570098
525800             MOVE +1    TO ASC-BLK-SUB                            52580098
525900             PERFORM 4410-READ-TEMP-STORAGE                       52590098
526000             ADD +1     TO ASC-BLK-SUB                            52600098
526100                           PV-BLOCK-NUMBER                        52610098
526200             PERFORM 4410-READ-TEMP-STORAGE                       52620098
526300     END-IF.                                                      52630098
526400     MOVE +1            TO ASC-BLK-SUB.                           52640098
526500     COMPUTE ASC-ITEM-SUB =                                       52650098
526600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              52660098
526700         + PC-ITEMS-PER-PANEL).                                   52670098
526800*                                                                 52680098
526900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        52690098
527000         ADD +1         TO ASC-BLK-SUB                            52700098
527100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            52710098
527200     END-IF.                                                      52720098
527300*                                                                 52730098
527400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           52740098
527500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                52750098
527600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        52760098
527700     PERFORM 4420-FORMAT-LIST-LINES                               52770098
527800         VARYING PV-SUB                                           52780098
527900         FROM PC-ITEMS-PER-PANEL BY -1                            52790098
528000         UNTIL PV-SUB < +1.                                       52800098
528100     SET PS-NO-RESET-LINES         TO TRUE.                       52810098
528200*                                                                 52820098
528300     COMPUTE ASC-ITEMS-DISPLAYED =                                52830098
528400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          52840098
528500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    52850098
528600                                      ASTRTITO.                   52860098
528700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    52870098
528800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    52880098
529100     MOVE ASC-PO-NUMBER            TO APONBRO.                    52910098
529100     MOVE ASC-SKU-DEPT             TO ADEPTO.                     52911099
529200     MOVE ASC-REQ-TYP-CDE          TO AREQTYPO.                   52920098
529300     MOVE ASC-REQ-TYP-CDE-DESC     TO AREQDSCO.                   52930098
529400                                                                  52940098
529500     MOVE ASC-REQUEST-DATE         TO PV-DATE-ISO                 52950098
205500     MOVE PV-DATE-CC-ISO           TO PV-DATE-CC-USA              52961099
205500     MOVE PV-DATE-YY-ISO           TO PV-DATE-YY-USA              52962099
205500     MOVE PV-DATE-MM-ISO           TO PV-DATE-MM-USA              52963099
205500     MOVE PV-DATE-DD-ISO           TO PV-DATE-DD-USA              52964099
529700     MOVE PV-DATE-USA              TO ARQSTDTO.                   52970098
529800                                                                  52980098
529900     MOVE ASC-VENDOR-DUE-DATE      TO PV-DATE-ISO                 52990098
205500     MOVE PV-DATE-CC-ISO           TO PV-DATE-CC-USA              53001099
205500     MOVE PV-DATE-YY-ISO           TO PV-DATE-YY-USA              53002099
205500     MOVE PV-DATE-MM-ISO           TO PV-DATE-MM-USA              53003099
205500     MOVE PV-DATE-DD-ISO           TO PV-DATE-DD-USA              53004099
530100     MOVE PV-DATE-USA              TO AVDUEDTO.                   53010098
530200                                                                  53020098
530300     MOVE ASC-PRINT-DUE-DATE       TO PV-DATE-ISO                 53030098
205500     MOVE PV-DATE-CC-ISO           TO PV-DATE-CC-USA              53041099
205500     MOVE PV-DATE-YY-ISO           TO PV-DATE-YY-USA              53042099
205500     MOVE PV-DATE-MM-ISO           TO PV-DATE-MM-USA              53043099
205500     MOVE PV-DATE-DD-ISO           TO PV-DATE-DD-USA              53044099
530500     MOVE PV-DATE-USA              TO APDUEDTO.                   53050098
530600                                                                  53060098
530700     MOVE ASC-DEFAULT-TICKET-TYPE  TO ADTTYPO.                    53070098
530800     MOVE ASC-DEFAULT-TICKET-PLACE TO ADTPLCO.                    53080098
530900     MOVE ASC-DEFAULT-OPTION-BLOCK TO ADOPBLKO.                   53090098
531000     MOVE ASC-DEFAULT-QUANTITY     TO ADTKQTYO.                   53100098
531100     MOVE ASC-VND-NAME             TO AVNDNMEO.                   53110098
531200     MOVE ASC-ADDR-LINE (1)        TO AADDR1O.                    53120098
531300     MOVE ASC-ADDR-LINE (2)        TO AADDR2O.                    53130098
531400     MOVE ASC-ADDR-LINE (3)        TO AADDR3O.                    53140098
531500     MOVE ASC-ADDR-LINE (4)        TO AADDR4O.                    53150098
531600     MOVE ASC-ADDR-LINE (5)        TO AADDR5O.                    53160098
531700     MOVE ASC-ADDR-LINE (6)        TO AADDR6O.                    53170098
531800     MOVE ASC-ADDR-LINE (7)        TO AADDR7O.                    53180098
531900     MOVE ASC-ADDR-LINE (8)        TO AADDR8O.                    53190098
532000*                                                                 53200098
532100     IF  DP020-MSG-NUMBER-X = SPACE                               53210098
532200       IF PS-DISPLAY-RUSH                                         53220098
532300          MOVE PC-TSYMSG-01341 TO DP020-MSG-NUMBER                53230098
532400          SET DP020-MSG-WARNING            TO TRUE                53240098
532500       ELSE                                                       53250098
532600          IF  ASC-ITEM-AT-BOT-OF-PANEL                            53260098
532700              < ASC-NUMBER-OF-ITEMS-READ                          53270098
532800*                --- MORE ITEMS TO DISPLAY ----                   53280098
532900              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER           53290098
533000              SET DP020-MSG-INFORMATIONAL TO TRUE                 53300098
533100          END-IF                                                  53310098
533200       END-IF                                                     53320098
533300     END-IF.                                                      53330098
533700                                                                  53331099
533400*----------------------------------------------------------------*53340098
533500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *53350098
533600*----------------------------------------------------------------*53360098
533800 4410-READ-TEMP-STORAGE.                                          53380098
534000     EXEC CICS                                                    53400098
534100         READQ TS                                                 53410098
534200             QUEUE (ASC-LIST-QUEUE-NAME)                          53420098
534300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               53430098
534400             ITEM  (PV-BLOCK-NUMBER)                              53440098
534500             RESP  (PV-CICS-RESP)                                 53450098
534600     END-EXEC.                                                    53460098
534700                                                                  53470098
534800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       53480098
534900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     53490098
535000         CONTINUE                                                 53500098
535100     ELSE                                                         53510098
535200         SET DP013-CICS-ABEND     TO TRUE                         53520098
535300         SET DP013-NO-ROLLBACK    TO TRUE                         53530098
535400         MOVE '4410-READ-TEMP-STORAGE'                            53540098
535500                                  TO DP013-PARAGRAPH              53550098
535600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      53560098
535700                                  TO DP013-MESSAGE-TEXT(1)        53570098
535800         PERFORM DP013-0000-PROCESS-ABEND                         53580098
535900     END-IF.                                                      53590098
536000                                                                  53600098
536100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             53610098
536200*                                                                 53620098
536300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         53630098
536400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               53640098
536500     END-IF.                                                      53650098
536600                                                                  53660099
536700*----------------------------------------------------------------*53670098
536800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *53680098
536900*----------------------------------------------------------------*53690098
537100 4420-FORMAT-LIST-LINES.                                          53710098
537300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      53730098
537400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                53740098
537500         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA (PV-SUB)            53750099
537600                                   MR-TICKET-TYPEA (PV-SUB)       53760099
537700                                   MR-TICKET-PLACEA (PV-SUB)      53770099
537800                                   MR-OPTION-BLOCKA (PV-SUB)      53780099
537900                                   MR-QUANTITYA (PV-SUB)          53790099
538000         MOVE DP015-HL-OFF      TO MR-SELECTH (PV-SUB)            53800099
538100                                   MR-TICKET-TYPEH (PV-SUB)       53810099
538200                                   MR-TICKET-PLACEH (PV-SUB)      53820099
538300                                   MR-OPTION-BLOCKH (PV-SUB)      53830099
538400                                   MR-QUANTITYH (PV-SUB)          53840099
538500         MOVE SPACE             TO MR-SELECTI (PV-SUB)            53850099
538600                                   MR-LNE-RQST-IND (PV-SUB)       53860099
538700                                   MR-PO-LINE-NBR (PV-SUB)        53870099
538700                                   MR-MAJ-CLASS (PV-SUB)          53880099
538700                                   MR-SUB-CLASS (PV-SUB)          53890099
538700                                   MR-SKU-NBR (PV-SUB)            53900099
538700                                   MR-SKU-DESC (PV-SUB)           53901099
539100                                   MR-TICKET-TYPE (PV-SUB)        53910099
539200                                   MR-TICKET-PLACE (PV-SUB)       53920099
539300                                   MR-OPTION-BLOCK (PV-SUB)       53930099
539300                                   MR-STICKER-NBR (PV-SUB)        53933099
539400                                   MR-QUANTITY (PV-SUB)           53940099
539500     ELSE                                                         53950098
539600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      53960098
539700                                                   > SPACE        53970098
539800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 53980098
539900                                 TO MR-SELECTI (PV-SUB)           53990098
540000         ELSE                                                     54000098
540100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      54010098
540200                                 TO MR-SELECTI (PV-SUB)           54020098
540300         END-IF                                                   54030098
540400*                                                                 54040098
540500         IF  DP030-SET-CURSOR-TRAILER                             54050098
540600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)54060098
540700                 > SPACE)                                         54070098
540800               OR (PV-SUB = 1))                                   54080098
540900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               54090098
541000                MOVE -1          TO MR-SELECTL (PV-SUB)           54100098
541100             END-IF                                               54110098
541200         END-IF                                                   54120098
541300*                                                                 54130098
541400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           54140098
541500         OR  PS-RESET-LINES                                       54150098
541600             MOVE ASC-PO-LINE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      54160098
541700                            TO PV-PO-LINE-NBR                     54170098
541800             MOVE PV-PO-LINE-NBR                                  54180098
541900                            TO MR-PO-LINE-NBR (PV-SUB)            54190098
542000             MOVE ASC-LNE-RQST-IND (ASC-BLK-SUB ASC-ITEM-SUB)     54200098
542100                            TO MR-LNE-RQST-IND (PV-SUB)           54210098
542500             MOVE ASC-MAJ-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)        54250099
542600                            TO MR-MAJ-CLASS (PV-SUB)              54260099
542700             MOVE ASC-SUB-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)        54270099
542800                            TO MR-SUB-CLASS (PV-SUB)              54280099
542900             MOVE ASC-SKU-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          54307099
543000                            TO MR-SKU-NBR (PV-SUB)                54308099
543100             MOVE ASC-SKU-DESC (ASC-BLK-SUB ASC-ITEM-SUB)         54310098
543200                            TO MR-SKU-DESC (PV-SUB)               54320098
543500             MOVE ASC-TICKET-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)      54350098
543600                            TO MR-TICKET-TYPE (PV-SUB)            54360098
543700             MOVE ASC-LNE-RQST-IND (ASC-BLK-SUB ASC-ITEM-SUB)     54370098
543800                            TO MR-LNE-RQST-IND (PV-SUB)           54380098
544300             MOVE ASC-RQST-QUANTITY-N (ASC-BLK-SUB ASC-ITEM-SUB)  54430098
544400                            TO PV-DISPLAY-QTY                     54440098
544500             MOVE PV-DISPLAY-QTY                                  54450098
544600                            TO MR-QUANTITY (PV-SUB)               54460098
543900             MOVE ASC-TICKET-PLACE (ASC-BLK-SUB ASC-ITEM-SUB)     54460199
544000                            TO MR-TICKET-PLACE (PV-SUB)           54460299
544100             MOVE ASC-OPTION-BLOCK (ASC-BLK-SUB ASC-ITEM-SUB)     54462199
544200                            TO MR-OPTION-BLOCK (PV-SUB)           54462299
543300             MOVE ASC-STICKER-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      54465099
543400                            TO MR-STICKER-NBR (PV-SUB)            54466099
544700         END-IF                                                   54470098
544800     END-IF.                                                      54480098
544900     SUBTRACT +1 FROM ASC-ITEM-SUB                                54490098
545000     IF  ASC-ITEM-SUB < + 1                                       54500098
545100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  54510098
545200         MOVE +1                 TO ASC-BLK-SUB                   54520098
545300     END-IF.                                                      54530098
545400******************************************************************54540098
545500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **54550098
545600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **54560098
545700** ISSUE A WARNING.                                             **54570098
545800******************************************************************54580098
545900 4430-CHECK-FOR-BEGIN-AND-END.                                    54590098
546000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       54600098
546100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     54610098
546200*            -- NO END-OF-RANGE SPECFIED ---                      54620098
546300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            54630098
546400             SET DP020-MSG-WARNING TO TRUE                        54640098
546500             PERFORM 4431-POSITION-AT-WARNING                     54650098
546600         END-IF                                                   54660098
546700     ELSE                                                         54670098
546800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     54680098
546900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                54690098
547000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            54700098
547100             SET DP020-MSG-WARNING TO TRUE                        54710098
547200             PERFORM 4431-POSITION-AT-WARNING                     54720098
547300         END-IF                                                   54730098
547400     END-IF.                                                      54740098
547500******************************************************************54750098
547600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **54760098
547700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **54770098
547800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **54780098
547900** POSITION THE CURSOR THERE.                                   **54790098
548000******************************************************************54800098
548100 4431-POSITION-AT-WARNING.                                        54810098
548200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 54820098
548300                    - PV-TOP-ITEM + 1.                            54830098
548400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      54840098
548500         CONTINUE                                                 54850098
548600     ELSE                                                         54860098
548700         SET DP030-SET-CURSOR-APPL-1                              54870098
548800                                   TO TRUE                        54880098
548900         MOVE -1                   TO MR-SELECTL (PV-SUB)         54890098
549000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         54900098
549100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         54910098
549200     END-IF.                                                      54920098
549300*                                                                 54930098
549400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   54940098
549500                    - PV-TOP-ITEM + 1.                            54950098
549600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      54960098
549700         CONTINUE                                                 54970098
549800     ELSE                                                         54980098
549900         SET DP030-SET-CURSOR-APPL-1                              54990098
550000                                   TO TRUE                        55000098
550100         MOVE -1                   TO MR-SELECTL (PV-SUB)         55010098
550200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         55020098
550300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         55030098
550400     END-IF.                                                      55040098
550500                                                                  55050099
550600*----------------------------------------------------------------*55060098
550700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *55070098
550800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *55080098
550900* FOR THE SELECTED ITEMS QUEUE.                                  *55090098
551000*                                                                *55100098
551100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *55110098
551200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *55120098
551300* THE ARRAY IS FULL.                                             *55130098
551400*----------------------------------------------------------------*55140098
551600 5000-PREPARE-SEL-QUEUE.                                          55160098
551800     MOVE +1                   TO  ASC-BLK-SUB.                   55180098
551900     PERFORM 5100-WRITE-TEMP-STORAGE.                             55190098
552000     ADD +1                    TO  ASC-BLK-SUB.                   55200098
552100     PERFORM 5100-WRITE-TEMP-STORAGE.                             55210098
552300     MOVE ASC-SEL-QUEUE-NAME-OUT                                  55230098
552400                               TO  VL005-SEL-QUEUE-NAME.          55240098
552500     PERFORM 6010-DELETE-SEL-QUEUE.                               55250098
552700     SET ASC-UPDATE-TSQ        TO  TRUE.                          55270098
552900     SET VL006-IDX             TO  1.                             55290098
553000     MOVE ZERO                 TO VL005-NUMBER-OF-TS-ITEMS.       55300098
553100     INITIALIZE VL006-SELECTED-ITEM-ARRAY.                        55310098
553300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           55330098
553400             VARYING PV-ITEM                                      55340098
553500             FROM 1 BY 1                                          55350098
553600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     55360098
553700                                                                  55370098
553800     IF  VL006-IDX > 1                                            55380098
553900         PERFORM 5205-WRITE-SEL-QUEUE                             55390098
554000         ADD +1                TO VL005-NUMBER-OF-TS-ITEMS        55400098
554100     END-IF.                                                      55410098
554200                                                                  55420099
554300*----------------------------------------------------------------*55430098
554400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *55440098
554500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *55450098
554600*----------------------------------------------------------------*55460098
554800 5100-WRITE-TEMP-STORAGE.                                         55480098
554900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     55490098
555000                                   TO PV-LIST-ITEM-NUMBER.        55500098
555100     COMPUTE PV-BLOCK-NUMBER =                                    55510098
555200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    55520098
555300                                                                  55530098
555400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             55540098
555500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             55550098
555600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      55560098
555700             PERFORM 5105-REWRITE-ASC-LISTQ                       55570098
555800         END-IF                                                   55580098
555900     ELSE                                                         55590098
556000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       55600098
556100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            55610098
556200         PERFORM 5110-WRITE-ASC-LISTQ                             55620098
556300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   55630098
556400     END-IF.                                                      55640098
556500                                                                  55650098
556600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             55660098
556500                                                                  55661099
556700******************************************************************55670098
556800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **55680098
556900** SPECIFIC COMMAREA.                                           **55690098
557000******************************************************************55700098
557100 5105-REWRITE-ASC-LISTQ.                                          55710098
557200     EXEC CICS                                                    55720098
557300         WRITEQ TS                                                55730098
557400             QUEUE (ASC-LIST-QUEUE-NAME)                          55740098
557500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               55750098
557600             ITEM  (PV-BLOCK-NUMBER)                              55760098
557700             REWRITE                                              55770098
557800             RESP  (PV-CICS-RESP)                                 55780098
557900     END-EXEC.                                                    55790098
558000                                                                  55800098
558100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           55810098
558200         CONTINUE                                                 55820098
558300     ELSE                                                         55830098
558400         SET DP013-CICS-ABEND            TO TRUE                  55840098
558500         SET DP013-NO-ROLLBACK           TO TRUE                  55850098
558600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       55860098
558700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     55870098
558800                                         TO DP013-MESSAGE-TEXT(1) 55880098
558900         PERFORM DP013-0000-PROCESS-ABEND                         55890098
559000     END-IF.                                                      55900098
559100                                                                  55910098
559200******************************************************************55920098
559300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **55930098
559400** SPECIFIC COMMAREA.                                           **55940098
559500******************************************************************55950098
559600 5110-WRITE-ASC-LISTQ.                                            55960098
559700     EXEC CICS                                                    55970098
559800         WRITEQ TS                                                55980098
559900             QUEUE (ASC-LIST-QUEUE-NAME)                          55990098
560000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               56000098
560100             ITEM  (PV-BLOCK-NUMBER)                              56010098
560200             RESP  (PV-CICS-RESP)                                 56020098
560300     END-EXEC.                                                    56030098
560400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      56040098
560500         SET DP013-CICS-ABEND      TO TRUE                        56050098
560600         SET DP013-NO-ROLLBACK     TO TRUE                        56060098
560700         MOVE '5110-WRITE-ASC-LISTQ'                              56070098
560800                                   TO DP013-PARAGRAPH             56080098
560900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           56090098
561000                                   TO DP013-MESSAGE-TEXT(1)       56100098
561100         PERFORM DP013-0000-PROCESS-ABEND                         56110098
561200     END-IF.                                                      56120098
561300                                                                  56130099
561400*----------------------------------------------------------------*56140098
561500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *56150098
561600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *56160098
561700*----------------------------------------------------------------*56170098
561900 5200-FILL-SEL-QUEUE-RECORD.                                      56190098
562100     PERFORM 6112-READ-LIST-QUEUE.                                56210098
562300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       56230098
562400         PERFORM                                                  56240098
562500         VARYING LQW-IDX                                          56250098
562600         FROM 1 BY 1                                              56260098
562700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            56270098
562800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          56280098
562900                                                                  56290098
563000             IF  LQW-SELECT (LQW-IDX)                             56300098
563100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              56310098
563200                                   TO VL006-ITEM (VL006-IDX)      56320098
563300                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    56330098
563400                                   TO VL006-PO-LINE-NBR           56340098
563500                                        (VL006-IDX)               56350098
563600                 MOVE SPACE        TO VL006-ACTION-SW (VL006-IDX) 56360098
563700                 SET VL006-IDX UP BY 1                            56370098
563800                 IF  VL006-IDX > VL006-MAX-ITEMS                  56380098
563900                     PERFORM 5205-WRITE-SEL-QUEUE                 56390098
564000                     ADD +1        TO VL005-NUMBER-OF-TS-ITEMS    56400098
564100                     INITIALIZE VL006-SELECTED-ITEM-ARRAY         56410098
564200                     SET VL006-IDX TO  1                          56420098
564300                 END-IF                                           56430098
564400             END-IF                                               56440098
564500         END-PERFORM                                              56450098
564600     END-IF.                                                      56460098
564700                                                                  56470098
564800*----------------------------------------------------------------*56480098
564900*    WRITE A RECORD TO THE SELECTION QUEUE THAT IS BEING PASSED  *56490098
565000*    FROM THIS PROGRAM.                                          *56500098
565100*----------------------------------------------------------------*56510098
565300 5205-WRITE-SEL-QUEUE.                                            56530098
565600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO VL006-SELECTED-ITEMS.   56560099
565800                                                                  56580098
565900     EXEC CICS                                                    56590098
566000          WRITEQ TS                                               56600098
566100              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      56610098
566200              FROM  (VL006-LINE-SEL-REC)                          56620098
566300              ITEM  (PV-SEL-QUEUE-ITEM)                           56630098
566400              RESP  (PV-CICS-RESP)                                56640098
566500     END-EXEC.                                                    56650098
566600                                                                  56660098
566700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          56670098
566800         CONTINUE                                                 56680098
566900     ELSE                                                         56690098
567000         SET DP013-CICS-ABEND      TO TRUE                        56700098
567100         SET DP013-NO-ROLLBACK     TO TRUE                        56710098
567200         MOVE '5205-WRITE-SEL-QUEUE-OUT'                          56720098
567300                                   TO DP013-PARAGRAPH             56730098
567400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          56740098
567500                                   TO DP013-MESSAGE-TEXT(1)       56750098
567600         PERFORM DP013-0000-PROCESS-ABEND                         56760098
567700     END-IF.                                                      56770098
567800                                                                  56780099
567900*----------------------------------------------------------------*56790098
568000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE THAT WAS PASSED*56800098
568100*    OUT OF THE PROGRAM                                          *56810098
568200*----------------------------------------------------------------*56820098
568300 6010-DELETE-SEL-QUEUE.                                           56830098
568500     EXEC CICS                                                    56850098
568600         DELETEQ TS                                               56860098
568700             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       56870098
568800             RESP  (PV-CICS-RESP)                                 56880098
568900     END-EXEC.                                                    56890098
569000*                                                                 56900098
569100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      56910098
569200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         56920098
569300         CONTINUE                                                 56930098
569400     ELSE                                                         56940098
569500         SET DP013-CICS-ABEND TO TRUE                             56950098
569600         SET DP013-NO-ROLLBACK TO TRUE                            56960098
569700         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          56970099
569900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         56990098
570000                        TO DP013-MESSAGE-TEXT (1)                 57000098
570100         PERFORM DP013-0000-PROCESS-ABEND                         57010098
570200     END-IF.                                                      57020098
570300                                                                  57030098
570500*----------------------------------------------------------------*57050098
570600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *57060098
570700*----------------------------------------------------------------*57070098
570900 6111-WRITE-LIST-QUEUE.                                           57090098
571100     EXEC CICS                                                    57110098
571200         WRITEQ TS                                                57120098
571300             QUEUE (ASC-LIST-QUEUE-NAME)                          57130098
571400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     57140098
571500             ITEM  (PV-ITEM)                                      57150098
571600             REWRITE                                              57160098
571700             RESP  (PV-CICS-RESP)                                 57170098
571800     END-EXEC.                                                    57180098
571900*                                                                 57190098
572000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          57200098
572100         CONTINUE                                                 57210098
572200     ELSE                                                         57220098
572300         SET DP013-CICS-ABEND  TO  TRUE                           57230098
572400         SET DP013-NO-ROLLBACK TO  TRUE                           57240098
572500         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         57250099
572700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  57270098
572800                               TO  DP013-MESSAGE-TEXT(1)          57280098
572900         PERFORM DP013-0000-PROCESS-ABEND                         57290098
573000     END-IF.                                                      57300098
573100                                                                  57310098
573300*----------------------------------------------------------------*57330098
573400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*57340098
573500*----------------------------------------------------------------*57350098
573700 6112-READ-LIST-QUEUE.                                            57370098
573900     EXEC CICS                                                    57390098
574000         READQ TS                                                 57400098
574100             QUEUE (ASC-LIST-QUEUE-NAME)                          57410098
574200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     57420098
574300             ITEM  (PV-ITEM)                                      57430098
574400             RESP  (PV-CICS-RESP)                                 57440098
574500     END-EXEC.                                                    57450098
574600*                                                                 57460098
574700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          57470098
574800         CONTINUE                                                 57480098
574900     ELSE                                                         57490098
575000         SET DP013-CICS-ABEND        TO TRUE                      57500098
575100         SET DP013-NO-ROLLBACK       TO TRUE                      57510098
575200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           57520098
575300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    57530098
575400                                     TO DP013-MESSAGE-TEXT(1)     57540098
575500         PERFORM DP013-0000-PROCESS-ABEND                         57550098
575600     END-IF.                                                      57560098
575700                                                                  57570098
575800*----------------------------------------------------------------*57580098
575900*    ADD THE HEADER AND DETAIL LINES FOR THIS REQUEST            *57590098
576000*----------------------------------------------------------------*57600098
576100 7000-ADD-REQUEST.                                                57610098
576200      PERFORM 3600-EDIT-TS-QUEUE                                  57620098
576300      IF PS-ERROR                                                 57630098
576400          CONTINUE                                                57640098
576500      ELSE                                                        57650098
576600          PERFORM 7001-ACTUAL-ADD-REQUEST                         57660098
576700          IF ASC-UPDATE-FORMAT-IND                                57670098
576800              IF ASC-RESUB-REQ                                    57680098
576900                  SET ASC-UPDATE-RESUB   TO TRUE                  57690098
577000              ELSE                                                57700098
577100                  SET ASC-UPDATE-REG     TO TRUE                  57710098
577200              END-IF                                              57720098
577300          ELSE                                                    57730098
577400              SET ASC-ADD-COMPLETE   TO TRUE                      57740098
577500          END-IF                                                  57750098
577700          PERFORM 2170-REFRESH-COMMAREA                           57770098
577800      END-IF.                                                     57780098
577900                                                                  57790098
578000*----------------------------------------------------------------*57800098
578100*    ADD THE HEADER AND DETAIL LINES FOR THIS REQUEST            *57810098
578200*----------------------------------------------------------------*57820098
578300 7001-ACTUAL-ADD-REQUEST.                                         57830098
578400     PERFORM 7010-INSERT-REQUEST-HEADER.                          57840098
578600     PERFORM 7020-INSERT-DETAIL-ITEMS                             57860098
578700             VARYING PV-ITEM                                      57870098
578800             FROM 1 BY 1                                          57880098
578900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     57890098
579000                                                                  57900098
579100     IF ASC-RESUB-REASON-COMPLETE                                 57910098
579200         PERFORM 7040-DELETE-RESUBMIT-REASONS                     57920098
579300         PERFORM 7050-INSERT-RESUBMIT-REASONS                     57930098
579400     END-IF.                                                      57940098
579500                                                                  57950098
579600     EVALUATE TRUE                                                57960098
579700         WHEN ASC-REQ-STAT-RUSH                                   57970098
579800             MOVE PC-TSYMSG-01367      TO DP020-MSG-NUMBER        57980098
579900             MOVE 'RUSH'               TO DP020-MSG-TEXT          57990098
580000             SET DP020-MSG-WARNING     TO TRUE                    58000098
580200         WHEN ASC-REQ-STAT-HOLD                                   58020098
580300             MOVE PC-TSYMSG-01367      TO DP020-MSG-NUMBER        58030098
580400             MOVE 'HOLD'               TO DP020-MSG-TEXT          58040098
580500             SET DP020-MSG-WARNING     TO TRUE                    58050098
580700         WHEN OTHER                                               58070098
580800             MOVE PC-TSYMSG-01134      TO DP020-MSG-NUMBER        58080098
580900             SET DP020-MSG-INFORMATIONAL TO TRUE                  58090098
581000     END-EVALUATE.                                                58100098
581100                                                                  58110098
581300*----------------------------------------------------------------*58130098
581400*  INSERT A PRETICKET REQUEST HEADER RECORD TO DB2 TABLE TPTKREQ *58140098
581500*----------------------------------------------------------------*58150098
581600 7010-INSERT-REQUEST-HEADER.                                      58160098
581800     PERFORM                                                      58180098
581900         WITH TEST AFTER                                          58190098
582000         VARYING PV-RETRY-COUNTER                                 58200098
582100         FROM 1 BY 1                                              58210098
582200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               58220098
582300             OR (SQLCODE = +0))                                   58230098
582400                                                                  58240098
582500         EXEC SQL                                                 58250098
582600             SET :PV-TIMESTAMP = CURRENT TIMESTAMP                58260098
582700         END-EXEC                                                 58270098
582800                                                                  58280098
582900         IF SQLCODE = +0                                          58290098
583000             CONTINUE                                             58300098
583100         ELSE                                                     58310098
583200             MOVE '7010-INSERT-HEADER-RECORD'                     58320098
583300                               TO DP013-PARAGRAPH                 58330098
583400             MOVE 'SET TIMESTAMP FOR RND KEY GENERATION'          58340098
583500                               TO DP013-MESSAGE-TEXT (1)          58350098
583600             MOVE SQLCA        TO DP013-SQLCA                     58360098
583700             SET DP013-DB2-ABEND                                  58370098
583800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               58380098
583900             PERFORM DP013-0000-PROCESS-ABEND                     58390098
584000         END-IF                                                   58400098
584100                                                                  58410098
584200         MOVE PV-TIMESTAMP   TO PV-TIMESTAMP-SPLIT                58420098
584300         MOVE PV-MINUTE      TO PV-RND-MINUTE                     58430098
584400         MOVE PV-SECOND      TO PV-RND-SECOND                     58440098
584500         MOVE PV-NANOSEC-1-3 TO PV-RND-NANOSEC-1-3                58450098
584600         MOVE PV-NANOSEC-4-6 TO PV-RND-NANOSEC-4-6                58460098
584700                                                                  58470098
584800         MOVE PV-RANDOM-KEY  TO ASC-PO-REQ-NBR                    58480098
584900         MOVE 99             TO ASC-PRTY-STAT-CDE                 58490098
585000                                                                  58500098
585100         EXEC SQL                                                 58510098
585200              INSERT INTO TPTKREQ                                 58520098
585300                     ( PO_REQ_NBR                                 58530098
585400                      ,PO_NBR                                     58540098
585500                      ,DEPT_NBR                                   58550098
585600                      ,ENT_ID                                     58560098
585700                      ,ADDR_SEQ_NBR                               58570098
585800                      ,PRTY_STAT_CDE                              58580098
585900                      ,REQ_TYP_CDE                                58590098
586000                      ,REQ_CREN_DTE                               58600098
586100                      ,RQSTR_ID                                   58610098
586200                      ,REQ_STAT_CDE                               58620098
586300                      ,VND_DUE_DTE                                58630098
586400                      ,PRT_BY_DTE                                 58640098
586500                      ,ACTL_PRT_DTE                               58650098
586600                      ,PRT_RQSTR_ID                               58660098
586700                      ,PRT_TM                                     58670098
586800                      ,CMNT_ID                                    58680098
586900                     )                                            58690098
587000              VALUES (                                            58700098
587100                      :ASC-PO-REQ-NBR                             58710098
587200                     ,:ASC-PO-NUMBER                              58720098
587300                     ,:ASC-DEPT-NBR                               58730098
587400                     ,:ASC-ENT-ID                                 58740098
587500                     ,:ASC-ADDR-SEQ-NBR                           58750098
587600                     ,:ASC-PRTY-STAT-CDE                          58760098
587700                     ,:ASC-REQ-TYP-CDE                            58770098
587800                     ,:ASC-REQUEST-DATE                           58780098
587900                     ,:DP020-USERID                               58790098
588000                     ,:ASC-REQ-STAT-CDE                           58800098
588100                     ,:ASC-VENDOR-DUE-DATE                        58810098
588200                     ,:ASC-PRINT-DUE-DATE                         58820098
588300                     ,'0001-01-01'                                58830098
588400                     ,' '                                         58840098
588500                     ,'01.01.01'                                  58850098
588600                     , 0                                          58860098
588700                     )                                            58870098
588800         END-EXEC                                                 58880098
588900                                                                  58890098
589000         EVALUATE TRUE                                            58900098
589100             WHEN SQLCODE = +0                                    58910098
589200             WHEN SQLCODE = -803                                  58920098
589300                 CONTINUE                                         58930098
589400                                                                  58940098
589500             WHEN SQLWARN0 NOT = SPACE                            58950098
589600             WHEN SQLCODE < +0                                    58960098
589700             WHEN SQLCODE > +0                                    58970098
589800                 MOVE '7010-INSERT-HEADER' TO DP013-PARAGRAPH     58980099
590000                 MOVE 'INSERT TO PRETICKET REQUEST HEADER TABLE'  59000098
590100                                      TO DP013-MESSAGE-TEXT (1)   59010099
590200                 MOVE ASC-PO-REQ-NBR  TO PV-DISPLAY-COMP          59020099
590400                 MOVE PV-DISPLAY-COMP TO DP013-MESSAGE-TEXT (2)   59040099
590600                 MOVE ASC-PO-NUMBER   TO PV-DISPLAY-COMP          59060099
590800                 MOVE PV-DISPLAY-COMP TO DP013-MESSAGE-TEXT (3)   59080099
591000                 MOVE SQLCA           TO DP013-SQLCA              59100099
591100                 MOVE 'TPTKREQ '      TO DP013-DB2-TABLE-NAME (1) 59110099
591200                 SET DP013-DB2-ABEND                              59120098
591300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           59130098
591400                 PERFORM DP013-0000-PROCESS-ABEND                 59140098
591600         END-EVALUATE                                             59160098
591700     END-PERFORM.                                                 59170098
591800                                                                  59180098
592000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        59200098
592100         MOVE '7010-INSERT-HEADER' TO DP013-PARAGRAPH             59210098
592200         MOVE 'MAXIMUM RETRIES EXCEEDED INSERTING TO HEADER TABLE'59220098
592300                                   TO DP013-MESSAGE-TEXT (1)      59230098
592400         MOVE ASC-PO-REQ-NBR       TO PV-DISPLAY-COMP             59240098
592500         MOVE PV-DISPLAY-COMP      TO DP013-MESSAGE-TEXT (2)      59250098
592600         MOVE ASC-PO-NUMBER        TO PV-DISPLAY-COMP             59260098
592700         MOVE PV-DISPLAY-COMP      TO DP013-MESSAGE-TEXT (3)      59270098
592800         MOVE SQLCA                TO DP013-SQLCA                 59280098
592900         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    59290098
593000         SET DP013-DB2-ABEND                                      59300098
593100             DP013-XCTL-DISPLAY-RESTART                           59310098
593200                                   TO TRUE                        59320098
593300         PERFORM DP013-0000-PROCESS-ABEND                         59330098
593400     END-IF.                                                      59340098
593700                                                                  59370098
593800*----------------------------------------------------------------*59380098
593900*  SCROLL THROUGH ALL THE DETAIL ITEMS.  IF THE LINE IS INCLUDED *59390098
594000*  ON THE REQUEST INSERT THE DATA TO DB2.                         59400098
594100*----------------------------------------------------------------*59410098
594300 7020-INSERT-DETAIL-ITEMS.                                        59430098
594500     PERFORM 6112-READ-LIST-QUEUE.                                59450098
594700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       59470098
594800         PERFORM                                                  59480098
594900         VARYING LQW-IDX                                          59490098
595000         FROM 1 BY 1                                              59500098
595100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            59510098
595200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          59520098
595300                                                                  59530098
595400             IF  LQW-LNE-ON-RQST (LQW-IDX)                        59540098
595500                 MOVE LQW-OPTION-BLOCK (LQW-IDX)                  59550098
595600                      TO PTKLNE-OPT-BLCK-CDE                      59560098
595700                 MOVE LQW-TICKET-PLACE (LQW-IDX)                  59570098
595800                      TO PTKLNE-TKT-PLCMNT-CDE                    59580098
595900                 MOVE LQW-TICKET-TYPE (LQW-IDX)                   59590098
596000                      TO PTKLNE-TKT-DESC                          59600098
596100                 MOVE LQW-RQST-QUANTITY (LQW-IDX)                 59610098
596200                      TO PTKLNE-TKT-QTY                           59620098
596300                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    59630098
596400                      TO PTKLNE-PO-LNE-NBR                        59640098
596500                 SET LQW-DB2-LNE-ON-RQST (LQW-IDX) TO TRUE        59650099
596700                 PERFORM 7030-INSERT-REQUEST-LINE                 59670098
596800             END-IF                                               59680098
596900         END-PERFORM                                              59690098
597100         PERFORM 6111-WRITE-LIST-QUEUE                            59710098
597300     END-IF.                                                      59730098
597400                                                                  59740098
597600*----------------------------------------------------------------*59760098
597700*  INSERT A PRETICKET REQUEST LINE RECORD TO DB2 TABLE TPTKLNE   *59770098
597800*----------------------------------------------------------------*59780098
597900 7030-INSERT-REQUEST-LINE.                                        59790098
598100     PERFORM                                                      59810098
598200         WITH TEST AFTER                                          59820098
598300         VARYING PV-RETRY-COUNTER                                 59830098
598400         FROM 1 BY 1                                              59840098
598500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               59850098
598600             OR (SQLCODE = +0))                                   59860098
598700                                                                  59870098
598800         EXEC SQL                                                 59880098
598900              INSERT INTO TPTKLNE                                 59890098
599000                     ( PO_REQ_NBR                                 59900098
599100                      ,PO_LNE_NBR                                 59910098
599200                      ,TKT_DESC                                   59920098
599300                      ,OPT_BLCK_CDE                               59930098
599400                      ,TKT_PLCMNT_CDE                             59940098
599500                      ,TKT_QTY                                    59950098
599600                     )                                            59960098
599700              VALUES (                                            59970098
599800                      :ASC-PO-REQ-NBR                             59980098
599900                     ,:PTKLNE-PO-LNE-NBR                          59990098
600000                     ,:PTKLNE-TKT-DESC                            60000098
600100                     ,:PTKLNE-OPT-BLCK-CDE                        60010098
600200                     ,:PTKLNE-TKT-PLCMNT-CDE                      60020098
600300                     ,:PTKLNE-TKT-QTY                             60030098
600400                     )                                            60040098
600500         END-EXEC                                                 60050098
600600                                                                  60060098
600700         EVALUATE TRUE                                            60070098
600800             WHEN SQLCODE = +0                                    60080098
600900                 CONTINUE                                         60090098
601100             WHEN SQLWARN0 NOT = SPACE                            60110098
601200             WHEN SQLCODE < +0                                    60120098
601300             WHEN SQLCODE > +0                                    60130098
601400                 MOVE '7030-INSERT-REQUEST-LINE'                  60140098
601500                                        TO DP013-PARAGRAPH        60150099
601600                 MOVE 'INSERT TO PRETICKET REQUEST LINE TABLE'    60160098
601700                                        TO DP013-MESSAGE-TEXT (1) 60170099
601800                 MOVE ASC-PO-REQ-NBR    TO PV-DISPLAY-COMP        60180099
602000                 MOVE PV-DISPLAY-COMP   TO DP013-MESSAGE-TEXT (2) 60200099
602200                 MOVE PTKLNE-PO-LNE-NBR TO PV-DISPLAY-COMP        60220099
602400                 MOVE PV-DISPLAY-COMP   TO DP013-MESSAGE-TEXT (3) 60240099
602600                 MOVE SQLCA        TO DP013-SQLCA                 60260098
602700                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (1)    60270098
602800                 SET DP013-DB2-ABEND                              60280098
602900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           60290098
603000                 PERFORM DP013-0000-PROCESS-ABEND                 60300098
603200         END-EVALUATE                                             60320098
603300     END-PERFORM.                                                 60330098
603400                                                                  60340098
603600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        60360098
603700         MOVE '7030-INSERT-REQUEST-LINE' TO DP013-PARAGRAPH       60370099
603900         MOVE 'MAXIMUM RETRIES EXCEEDED INSERTING TO DETAIL TABLE'60390098
604000                                   TO DP013-MESSAGE-TEXT (1)      60400098
604100         MOVE ASC-PO-REQ-NBR       TO PV-DISPLAY-COMP             60410098
604200         MOVE PV-DISPLAY-COMP      TO DP013-MESSAGE-TEXT (2)      60420098
604300         MOVE PTKLNE-PO-LNE-NBR    TO PV-DISPLAY-COMP             60430098
604400         MOVE PV-DISPLAY-COMP      TO DP013-MESSAGE-TEXT (3)      60440098
604500         MOVE SQLCA                TO DP013-SQLCA                 60450098
604600         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (1)    60460098
604700         SET DP013-DB2-ABEND                                      60470098
604800             DP013-XCTL-DISPLAY-RESTART TO TRUE                   60480099
605000         PERFORM DP013-0000-PROCESS-ABEND                         60500098
605100     END-IF.                                                      60510098
605200                                                                  60520098
605300*----------------------------------------------------------------*60530098
605400*  DELETE RESUBMIT REASON CODES                                  *60540098
605500*----------------------------------------------------------------*60550098
605600 7040-DELETE-RESUBMIT-REASONS.                                    60560098
605800     PERFORM                                                      60580098
605900         WITH TEST AFTER                                          60590098
606000         VARYING PV-RETRY-COUNTER                                 60600098
606100         FROM 1 BY 1                                              60610098
606200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               60620098
606300             OR (SQLCODE = +0)                                    60630098
606400             OR (SQLCODE = +100))                                 60640098
606500                                                                  60650098
606600         EXEC SQL                                                 60660098
606700              DELETE FROM TPTKRSN                                 60670098
606800              WHERE PO_REQ_NBR = :ASC-PO-REQ-NBR                  60680098
606900         END-EXEC                                                 60690098
607000                                                                  60700098
607100         EVALUATE TRUE                                            60710098
607200             WHEN SQLCODE = +0                                    60720098
607300             WHEN SQLCODE = +100                                  60730098
607400                 CONTINUE                                         60740098
607600             WHEN SQLWARN0 NOT = SPACE                            60760098
607700             WHEN SQLCODE < +0                                    60770098
607800             WHEN SQLCODE > +0                                    60780098
607900                 MOVE '7040-DELETE-RESUBMIT-REASON'               60790098
608000                                      TO DP013-PARAGRAPH          60800099
608100                 MOVE 'DELETE FROM THE REQUEST REASON TABLE'      60810098
608200                                      TO DP013-MESSAGE-TEXT (1)   60820099
608300                 MOVE ASC-PO-REQ-NBR  TO PV-DISPLAY-COMP          60830099
608500                 MOVE PV-DISPLAY-COMP TO DP013-MESSAGE-TEXT (2)   60850099
608700                 MOVE SQLCA           TO DP013-SQLCA              60870099
608800                 MOVE 'TPTKRSN '      TO DP013-DB2-TABLE-NAME (1) 60880099
608900                 SET DP013-DB2-ABEND                              60890098
609000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           60900098
609100                 PERFORM DP013-0000-PROCESS-ABEND                 60910098
609300         END-EVALUATE                                             60930098
609400     END-PERFORM.                                                 60940098
609500                                                                  60950098
609700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        60970098
609800         MOVE '7040-DELETE-RESUBMIT-REASONS'                      60980098
609900                                   TO DP013-PARAGRAPH             60990098
610000         MOVE 'MAXIMUM RETRIES EXCEEDED DELETEING FROM REASON TBL'61000098
610100                                   TO DP013-MESSAGE-TEXT (1)      61010098
610200         MOVE ASC-PO-REQ-NBR       TO PV-DISPLAY-COMP             61020098
610300         MOVE PV-DISPLAY-COMP      TO DP013-MESSAGE-TEXT (2)      61030098
610400         MOVE PTKLNE-PO-LNE-NBR    TO PV-DISPLAY-COMP             61040098
610500         MOVE PV-DISPLAY-COMP      TO DP013-MESSAGE-TEXT (3)      61050098
610600         MOVE SQLCA                TO DP013-SQLCA                 61060098
610700         MOVE 'TPTKRSN '           TO DP013-DB2-TABLE-NAME (1)    61070098
610800         SET DP013-DB2-ABEND                                      61080098
610900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   61090099
611100         PERFORM DP013-0000-PROCESS-ABEND                         61110098
611200     END-IF.                                                      61120098
611300                                                                  61130098
611400*----------------------------------------------------------------*61140098
611500*  INSERT A PRETICKET REQUEST LINE RECORD TO DB2 TABLE TPTKLNE   *61150098
611600*----------------------------------------------------------------*61160098
611700 7050-INSERT-RESUBMIT-REASONS.                                    61170098
612000     PERFORM                                                      61200098
612100         VARYING PV-RSN-QUEUE-ITEM                                61210099
612200         FROM 1 BY 1                                              61220099
612300         UNTIL PV-RSN-QUEUE-ITEM GREATER                          61230099
612300                                 ASC-NUMBER-OF-RSN-TS-ITEMS       61231099
612400         PERFORM 7060-READ-RSN-QUEUE                              61240098
612600         PERFORM                                                  61260098
612700              VARYING PV-RSN-ITEM                                 61270099
612800              FROM 1 BY 1                                         61280099
612900              UNTIL PV-RSN-ITEM GREATER VL008-MAX-ITEMS           61290099
613000                  OR VL008-ITEM (PV-RSN-ITEM) = +0                61300099
613100                                                                  61310098
613200              MOVE VL008-REQ-RSN-CDE (PV-RSN-ITEM)                61320099
613300                  TO PTKRSN-REQ-RSN-CDE                           61330098
613400             PERFORM 7070-INSERT-REASON-ROW                       61340098
613600         END-PERFORM                                              61360098
613700     END-PERFORM.                                                 61370098
613800                                                                  61380098
613900     SET ASC-REASON-CODES-EXIST TO TRUE.                          61390098
614000                                                                  61400098
614100*----------------------------------------------------------------*61410098
614200* READ AN ITEM FROM THE REASON TEMP STORAGE QUEUE                *61420098
614300*----------------------------------------------------------------*61430098
614500 7060-READ-RSN-QUEUE.                                             61450098
614700     EXEC CICS                                                    61470098
614800         READQ TS                                                 61480098
614900             QUEUE (ASC-RSN-QUEUE-NAME)                           61490098
615000             INTO  (VL008-REASON-SEL-REC)                         61500098
615100             ITEM  (PV-RSN-QUEUE-ITEM)                            61510098
615200             RESP  (PV-CICS-RESP)                                 61520098
615300     END-EXEC.                                                    61530098
615400                                                                  61540098
615500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       61550098
615600         CONTINUE                                                 61560098
615700     ELSE                                                         61570098
615800         SET DP013-LOGIC-ABEND                                    61580098
615900             DP013-NO-ROLLBACK     TO TRUE                        61590098
616000         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            61600099
616200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   61620098
616300                                   TO DP013-MESSAGE-TEXT (1)      61630098
616400         PERFORM DP013-0000-PROCESS-ABEND                         61640098
616500     END-IF.                                                      61650098
617000                                                                  61651099
616600*----------------------------------------------------------------*61660098
616700*  INSERT A PRETICKET REQUEST LINE RECORD TO DB2 TABLE TPTKLNE   *61670098
616800*----------------------------------------------------------------*61680098
616900 7070-INSERT-REASON-ROW.                                          61690098
617100     PERFORM                                                      61710098
617200         WITH TEST AFTER                                          61720098
617300         VARYING PV-RETRY-COUNTER                                 61730098
617400         FROM 1 BY 1                                              61740098
617500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               61750098
617600             OR (SQLCODE = +0))                                   61760098
617700                                                                  61770098
617800         EXEC SQL                                                 61780098
617900              INSERT INTO TPTKRSN                                 61790098
618000                     ( PO_REQ_NBR                                 61800098
618100                      ,REQ_RSN_CDE                                61810098
618200                     )                                            61820098
618300              VALUES (                                            61830098
618400                      :ASC-PO-REQ-NBR                             61840098
618500                     ,:PTKRSN-REQ-RSN-CDE                         61850098
618600                     )                                            61860098
618700         END-EXEC                                                 61870098
618800                                                                  61880098
618900         EVALUATE TRUE                                            61890098
619000             WHEN SQLCODE = +0                                    61900098
619100                 CONTINUE                                         61910098
619300             WHEN SQLWARN0 NOT = SPACE                            61930098
619400             WHEN SQLCODE < +0                                    61940098
619500             WHEN SQLCODE > +0                                    61950098
619600                 MOVE '7060-INSERT-REQSON-ROW'                    61960098
619700                                         TO DP013-PARAGRAPH       61970099
619800                 MOVE 'INSERT TO REQUEST REASON ASSOCIATE TABLE'  61980098
619900                                         TO DP013-MESSAGE-TEXT (1)61990099
620000                 MOVE ASC-PO-REQ-NBR     TO PV-DISPLAY-COMP       62000099
620200                 MOVE PV-DISPLAY-COMP    TO DP013-MESSAGE-TEXT (2)62020099
620400                 MOVE PTKRSN-REQ-RSN-CDE TO DP013-MESSAGE-TEXT (3)62040099
620600                 MOVE SQLCA              TO DP013-SQLCA           62060099
620700                 MOVE 'TPTKRSN '       TO DP013-DB2-TABLE-NAME (1)62070099
620800                 SET DP013-DB2-ABEND                              62080098
620900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           62090098
621000                 PERFORM DP013-0000-PROCESS-ABEND                 62100098
621200         END-EVALUATE                                             62120098
621300     END-PERFORM.                                                 62130098
621400                                                                  62140098
621600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        62160098
621700         MOVE '7060-INSERT-REASON-ROW' TO DP013-PARAGRAPH         62170099
621900         MOVE 'INSERT TO REQUEST REASON ASSOCIATE TABLE'          62190098
622000                                   TO DP013-MESSAGE-TEXT (1)      62200098
622100         MOVE ASC-PO-REQ-NBR       TO PV-DISPLAY-COMP             62210098
622200         MOVE PV-DISPLAY-COMP      TO DP013-MESSAGE-TEXT (2)      62220098
622300         MOVE PTKRSN-REQ-RSN-CDE   TO DP013-MESSAGE-TEXT (3)      62230098
622400         MOVE SQLCA                TO DP013-SQLCA                 62240098
622500         MOVE 'TPTKRSN '           TO DP013-DB2-TABLE-NAME (1)    62250098
622600         SET DP013-DB2-ABEND                                      62260098
622700             DP013-XCTL-DISPLAY-RESTART                           62270098
622800                                   TO TRUE                        62280098
622900         PERFORM DP013-0000-PROCESS-ABEND                         62290098
623000     END-IF.                                                      62300098
623200                                                                  62320098
623300*----------------------------------------------------------------*62330098
623400*    FIRST CHECK THE TEMP STORAGE QUEUE FOR ANY ERRORS, THEN     *62340098
623500*    UPDATE THE HEADER AND DETAIL LINES FOR THIS REQUEST        *462350098
623600*----------------------------------------------------------------*62360098
623700 7100-UPDATE-REQUEST.                                             62370098
623800      PERFORM 3600-EDIT-TS-QUEUE                                  62380098
623900      IF PS-ERROR                                                 62390098
624000          CONTINUE                                                62400098
624100      ELSE                                                        62410098
624200          PERFORM 7101-ACTUAL-UPDATE-REQUEST                      62420098
624300          PERFORM 2170-REFRESH-COMMAREA                           62430098
624400      END-IF.                                                     62440098
624500                                                                  62450098
624600*----------------------------------------------------------------*62460098
624700 7101-ACTUAL-UPDATE-REQUEST.                                      62470098
624800     PERFORM 7110-UPDATE-REQUEST-HEADER.                          62480098
624900                                                                  62490098
625000     PERFORM 7120-UPDATE-DETAIL-ITEMS                             62500098
625100             VARYING PV-ITEM                                      62510098
625200             FROM 1 BY 1                                          62520098
625300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     62530098
625400                                                                  62540098
625500*    IF THE REASON CODES WERE CHANGED IN THIS SESSION, RE-INSERT  62550098
625600*    THEM                                                         62560098
625700     IF ASC-NUMBER-OF-RSN-CODES > 0                               62570098
625800         PERFORM 7040-DELETE-RESUBMIT-REASONS                     62580098
625900         PERFORM 7050-INSERT-RESUBMIT-REASONS                     62590098
626000     END-IF.                                                      62600098
626100                                                                  62610098
626200     IF  ASC-USE-SELECTION-QUEUE                                  62620098
626300         PERFORM 7101-UPDATE-SELECTION-QUEUE                      62630098
626400     END-IF.                                                      62640098
626500     EVALUATE TRUE                                                62650098
626600         WHEN ASC-REQ-STAT-RUSH                                   62660099
626700             MOVE PC-TSYMSG-01342  TO DP020-MSG-NUMBER            62670099
626800             MOVE 'RUSH'           TO DP020-MSG-TEXT              62680099
626900         WHEN ASC-REQ-STAT-HOLD                                   62690099
627000             MOVE PC-TSYMSG-01342  TO DP020-MSG-NUMBER            62700099
627100             MOVE 'HOLD'           TO DP020-MSG-TEXT              62710099
627200         WHEN OTHER                                               62720099
627300             MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER            62730099
627400             SET DP020-MSG-INFORMATIONAL TO TRUE                  62740099
627500     END-EVALUATE.                                                62750098
627600     SET DP020-MSG-INFORMATIONAL TO TRUE.                         62760098
627700                                                                  62770098
627800*----------------------------------------------------------------*62780098
627900* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *62790098
628000* OBJECT WAS UDPATED.                                            *62800098
628100*----------------------------------------------------------------*62810098
628200 7101-UPDATE-SELECTION-QUEUE.                                     62820098
628300     PERFORM 9100-READ-SEL-QUEUE-IN.                              62830098
628400     SET VL006-UPD (ASC-SEL-SUB) TO TRUE.                         62840098
628500     PERFORM 9200-REWRITE-SEL-QUEUE.                              62850098
628600                                                                  62860098
628700*----------------------------------------------------------------*62870098
628800*  UPDATE A PRETICKET REQUEST HEADER RECORD TO DB2 TABLE TPTKREQ *62880098
628900*----------------------------------------------------------------*62890098
629100 7110-UPDATE-REQUEST-HEADER.                                      62910098
629300     PERFORM                                                      62930098
629400         WITH TEST AFTER                                          62940098
629500         VARYING PV-RETRY-COUNTER                                 62950098
629600         FROM 1 BY 1                                              62960098
629700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               62970098
629800             OR (SQLCODE = +0))                                   62980098
629900                                                                  62990098
630000         EXEC SQL                                                 63000098
630100              UPDATE TPTKREQ                                      63010098
630200              SET ADDR_SEQ_NBR    = :ASC-ADDR-SEQ-NBR             63020098
630300                , REQ_TYP_CDE     = :ASC-REQ-TYP-CDE              63030098
630400                , REQ_STAT_CDE    = :ASC-REQ-STAT-CDE             63040098
630500                , VND_DUE_DTE     = :ASC-VENDOR-DUE-DATE          63050098
630600                , PRT_BY_DTE      = :ASC-PRINT-DUE-DATE           63060098
630700              WHERE                                               63070098
630800                  PO_REQ_NBR      = :ASC-PO-REQ-NBR               63080098
630900         END-EXEC                                                 63090098
631000                                                                  63100098
631100         EVALUATE TRUE                                            63110098
631200             WHEN SQLCODE = +0                                    63120098
631300                 CONTINUE                                         63130098
631400                                                                  63140098
631500             WHEN SQLWARN0 NOT = SPACE                            63150098
631600             WHEN SQLCODE < +0                                    63160098
631700             WHEN SQLCODE > +0                                    63170098
631800                 MOVE '7110-UPDATE-HEADER' TO DP013-PARAGRAPH     63180099
632000                 MOVE 'UPDATE PRETICKET REQUEST HEADER TABLE'     63200098
632100                                     TO DP013-MESSAGE-TEXT (1)    63210099
632200                 MOVE ASC-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)    63220099
632400                 MOVE SQLCA          TO DP013-SQLCA               63240099
632500                 MOVE 'TPTKREQ '     TO DP013-DB2-TABLE-NAME (1)  63250099
632600                 SET DP013-DB2-ABEND                              63260098
632700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           63270098
632800                 PERFORM DP013-0000-PROCESS-ABEND                 63280098
633000         END-EVALUATE                                             63300098
633100     END-PERFORM.                                                 63310098
633300                                                                  63330098
633400*----------------------------------------------------------------*63340098
633500*  UPDATE A PRETICKET REQUEST HEADER RECORD TO DB2 TABLE TPTKREQ *63350098
633600*----------------------------------------------------------------*63360098
633800 7115-UPDATE-REQUEST-HDR-STAT.                                    63380098
634000     PERFORM                                                      63400098
634100         WITH TEST AFTER                                          63410098
634200         VARYING PV-RETRY-COUNTER                                 63420098
634300         FROM 1 BY 1                                              63430098
634400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               63440098
634500             OR (SQLCODE = +0))                                   63450098
634600                                                                  63460098
634700         EXEC SQL                                                 63470098
634800              UPDATE TPTKREQ                                      63480098
634900              SET REQ_STAT_CDE    = :ASC-REQ-STAT-CDE             63490098
635000              WHERE                                               63500098
635100                  PO_REQ_NBR      = :ASC-PO-REQ-NBR               63510098
635200         END-EXEC                                                 63520098
635300                                                                  63530098
635400         EVALUATE TRUE                                            63540098
635500             WHEN SQLCODE = +0                                    63550098
635600                 CONTINUE                                         63560098
635800             WHEN SQLWARN0 NOT = SPACE                            63580098
635900             WHEN SQLCODE < +0                                    63590098
636000             WHEN SQLCODE > +0                                    63600098
636100                 MOVE '7115-UPDATE-HDR-STAT' TO DP013-PARAGRAPH   63610099
636300                 MOVE 'UPDATE PRETICKET REQUEST HEADER TABLE'     63630098
636400                                   TO DP013-MESSAGE-TEXT (1)      63640098
636500                 MOVE ASC-PO-REQ-NBR                              63650098
636600                                   TO DP013-MESSAGE-TEXT (2)      63660098
636700                 MOVE SQLCA        TO DP013-SQLCA                 63670098
636800                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    63680098
636900                 SET DP013-DB2-ABEND                              63690098
637000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           63700098
637100                 PERFORM DP013-0000-PROCESS-ABEND                 63710098
637300         END-EVALUATE                                             63730098
637400     END-PERFORM.                                                 63740098
637500                                                                  63750098
637700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        63770098
637800         MOVE '7115-UPDATE-HDR-STAT' TO DP013-PARAGRAPH           63780098
637900         MOVE 'MAXIMUM RETRIES EXCEEDED UPDATE HEADER TABLE'      63790098
638000                                   TO DP013-MESSAGE-TEXT (1)      63800098
638100         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      63810098
638200         MOVE SQLCA                TO DP013-SQLCA                 63820098
638300         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    63830098
638400         SET DP013-DB2-ABEND                                      63840098
638500             DP013-XCTL-DISPLAY-RESTART                           63850098
638600                                   TO TRUE                        63860098
638700         PERFORM DP013-0000-PROCESS-ABEND                         63870098
638800     END-IF.                                                      63880098
638900                                                                  63890098
639100*----------------------------------------------------------------*63910098
639200*  SCROLL THROUGH ALL THE DETAIL ITEMS.  FOR ALL LINES THAT HAVE *63920098
639300*  BEEN UPDATED, CHECK FOR INCLUSION ON THE REQUEST, AND THEN    *63930098
639400*  UPDATE, INSERT OR DELETE THE LINE ACCORDINGLY.                *63940098
639500*----------------------------------------------------------------*63950098
639700 7120-UPDATE-DETAIL-ITEMS.                                        63970098
639900     PERFORM 6112-READ-LIST-QUEUE.                                63990098
640000                                                                  64000098
640100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       64010098
640200         PERFORM                                                  64020098
640300         VARYING LQW-IDX                                          64030098
640400         FROM 1 BY 1                                              64040098
640500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            64050098
640600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          64060098
640700                                                                  64070098
640800             IF  LQW-LNE-UPDATE (LQW-IDX)                         64080098
640900               EVALUATE TRUE                                      64090098
641000* WHEN THE LINE IS OFF THE REQUEST ON THE SCREEN AND IN DB2,      64100098
641100* NO DB2 PROCESSING NEEDS TO TAKE PLACE                           64110098
641200                 WHEN LQW-LNE-OFF-RQST (LQW-IDX)                  64120098
641300                 AND  LQW-DB2-LNE-OFF-RQST (LQW-IDX)              64130098
641400                     SET LQW-NO-LNE-UPDATE (LQW-IDX) TO TRUE      64140098
641500                                                                  64150098
641600* WHEN THE LINE IS ON THE REQUEST ON THE SCREEN, AND IS ALREADY   64160098
641700* ON THE REQUEST IN DB2, THE LINE NEEDS TO BE UPDATED ON DB2      64170098
641800                 WHEN LQW-LNE-ON-RQST (LQW-IDX)                   64180098
641900                 AND  LQW-DB2-LNE-ON-RQST (LQW-IDX)               64190098
642000                     MOVE LQW-OPTION-BLOCK (LQW-IDX)              64200098
642100                          TO PTKLNE-OPT-BLCK-CDE                  64210098
642200                     MOVE LQW-TICKET-PLACE (LQW-IDX)              64220098
642300                          TO PTKLNE-TKT-PLCMNT-CDE                64230098
642400                     MOVE LQW-TICKET-TYPE (LQW-IDX)               64240098
642500                          TO PTKLNE-TKT-DESC                      64250098
642600                     MOVE LQW-RQST-QUANTITY (LQW-IDX)             64260098
642700                          TO PTKLNE-TKT-QTY                       64270098
642800                     MOVE LQW-PO-LNE-NBR (LQW-IDX)                64280098
642900                          TO DK-PO-LNE-NBR                        64290098
643000                     PERFORM 7130-UPDATE-REQUEST-LINE             64300098
643100                     SET LQW-NO-LNE-UPDATE (LQW-IDX) TO TRUE      64310098
643200                                                                  64320098
643300* WHEN THE LINE IS ON THE REQUEST ON THE SCREE, BUT NOT ON THE    64330098
643400* REQUEST IN DB2, THE DETAIL LINE NEEDS TO BE INSERTED TO DB2     64340098
643500                 WHEN LQW-LNE-ON-RQST (LQW-IDX)                   64350098
643600                 AND  LQW-DB2-LNE-OFF-RQST (LQW-IDX)              64360098
643700                     MOVE LQW-OPTION-BLOCK (LQW-IDX)              64370098
643800                          TO PTKLNE-OPT-BLCK-CDE                  64380098
643900                     MOVE LQW-TICKET-PLACE (LQW-IDX)              64390098
644000                          TO PTKLNE-TKT-PLCMNT-CDE                64400098
644100                     MOVE LQW-TICKET-TYPE (LQW-IDX)               64410098
644200                          TO PTKLNE-TKT-DESC                      64420098
644300                     MOVE LQW-RQST-QUANTITY (LQW-IDX)             64430098
644400                          TO PTKLNE-TKT-QTY                       64440098
644500                     MOVE LQW-PO-LNE-NBR (LQW-IDX)                64450098
644600                          TO PTKLNE-PO-LNE-NBR                    64460098
644700                     MOVE ASC-PO-REQ-NBR                          64470098
644800                          TO PTKREQ-PO-REQ-NBR                    64480098
644900                     PERFORM 7030-INSERT-REQUEST-LINE             64490098
645000                     SET LQW-DB2-LNE-ON-RQST (LQW-IDX)            64500098
645100                         LQW-NO-LNE-UPDATE (LQW-IDX) TO TRUE      64510098
645200                                                                  64520098
645300* WHEN THE LINE IS OFF THE REQUEST ON THE SCREEN, BUT IS STILL ON 64530098
645400* THE REQUEST IN DB2, THE ROW NEEDS TO BE DELETE FROM DB2         64540098
645500                 WHEN LQW-LNE-OFF-RQST (LQW-IDX)                  64550098
645600                 AND  LQW-DB2-LNE-ON-RQST (LQW-IDX)               64560098
645700                     MOVE LQW-PO-LNE-NBR (LQW-IDX)                64570098
645800                          TO DK-PO-LNE-NBR                        64580098
645900                     PERFORM 7221-DELETE-ONE-REQUEST-LINE         64590098
646000                     SET LQW-DB2-LNE-OFF-RQST (LQW-IDX)           64600098
646100                         LQW-NO-LNE-UPDATE (LQW-IDX) TO TRUE      64610098
646200               END-EVALUATE                                       64620098
646300             END-IF                                               64630098
646400         END-PERFORM                                              64640098
646600         PERFORM 6111-WRITE-LIST-QUEUE                            64660098
646700     END-IF.                                                      64670098
646800                                                                  64680098
647100*----------------------------------------------------------------*64710098
647200*  UPDATE PRETICKET REQUEST LINE RECORD DB2 TABLE TPTKLNE   *     64720098
647300*----------------------------------------------------------------*64730098
647500 7130-UPDATE-REQUEST-LINE.                                        64750098
647700     PERFORM                                                      64770098
647800         WITH TEST AFTER                                          64780098
647900         VARYING PV-RETRY-COUNTER                                 64790098
648000         FROM 1 BY 1                                              64800098
648100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               64810098
648200             OR (SQLCODE = +0))                                   64820098
648300                                                                  64830098
648400         EXEC SQL                                                 64840098
648500         UPDATE TPTKLNE                                           64850098
648600             SET OPT_BLCK_CDE   = :PTKLNE-OPT-BLCK-CDE            64860098
648700               , TKT_PLCMNT_CDE = :PTKLNE-TKT-PLCMNT-CDE          64870098
648800               , TKT_DESC       = :PTKLNE-TKT-DESC                64880098
648900               , TKT_QTY        = :PTKLNE-TKT-QTY                 64890098
649000             WHERE                                                64900098
649100                 PO_REQ_NBR     = :ASC-PO-REQ-NBR                 64910098
649200             AND PO_LNE_NBR     = :DK-PO-LNE-NBR                  64920098
649300         END-EXEC                                                 64930098
649400                                                                  64940098
649500         EVALUATE TRUE                                            64950098
649600             WHEN SQLCODE = +0                                    64960098
649700                 CONTINUE                                         64970098
649800                                                                  64980098
649900             WHEN SQLWARN0 NOT = SPACE                            64990098
650000             WHEN SQLCODE < +0                                    65000098
650100             WHEN SQLCODE > +0                                    65010098
650200                 MOVE '7130-UPDATE-REQUEST-LINE'                  65020098
650300                                   TO DP013-PARAGRAPH             65030098
650400                 MOVE 'UPDATE PRETICKET REQUEST LINE TABLE'       65040098
650500                                   TO DP013-MESSAGE-TEXT (1)      65050098
650600                 MOVE ASC-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)    65060099
650800                 MOVE DK-PO-LNE-NBR TO DP013-MESSAGE-TEXT (3)     65080099
651000                 MOVE SQLCA        TO DP013-SQLCA                 65100098
651100                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (1)    65110098
651200                 SET DP013-DB2-ABEND                              65120098
651300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           65130098
651400                 PERFORM DP013-0000-PROCESS-ABEND                 65140098
651500                                                                  65150098
651600         END-EVALUATE                                             65160098
651700     END-PERFORM.                                                 65170098
651800                                                                  65180098
652000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        65200098
652100         MOVE '7130-UPDATE-REQUEST-LINE'                          65210098
652200                                   TO DP013-PARAGRAPH             65220098
652300         MOVE 'MAXIMUM RETRIES EXCEEDED UPDATING TO DETAIL TABLE' 65230098
652400                                   TO DP013-MESSAGE-TEXT (1)      65240098
652500         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      65250098
652600         MOVE DK-PO-LNE-NBR        TO DP013-MESSAGE-TEXT (3)      65260098
652700         MOVE SQLCA                TO DP013-SQLCA                 65270098
652800         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (1)    65280098
652900         SET DP013-DB2-ABEND                                      65290098
653000             DP013-XCTL-DISPLAY-RESTART                           65300098
653100                                   TO TRUE                        65310098
653200         PERFORM DP013-0000-PROCESS-ABEND                         65320098
653300     END-IF.                                                      65330098
653400                                                                  65340098
653500*----------------------------------------------------------------*65350098
653600*  DELETE THE HEADER, DETAIL, AND ALL TABLES ASSOCIATED TO THE   *65360098
653700*  PRETICKET REQUEST TABLES.                                     *65370098
653800*----------------------------------------------------------------*65380098
654000 7200-DELETE-REQUEST.                                             65400098
654200     PERFORM 7220-DELETE-ALL-REQUEST-LINES.                       65420099
654300                                                                  65430098
654400     IF  ASC-USE-SELECTION-QUEUE                                  65440098
654500         PERFORM 7201-DELETE-SELECTION-QUEUE                      65450098
654600     END-IF.                                                      65460098
654700                                                                  65470098
654800     PERFORM 7230-DELETE-REQUEST-COMMENTS.                        65480099
654900     PERFORM 7240-DELETE-REQUEST-REASONS.                         65490099
655100     PERFORM 7210-DELETE-REQUEST-HEADER.                          65510099
655300     MOVE PC-TSYMSG-00115      TO DP020-MSG-NUMBER.               65530098
655400     SET DP020-MSG-INFORMATIONAL TO TRUE.                         65540098
655500                                                                  65550098
655600*----------------------------------------------------------------*65560098
655700* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *65570098
655800* OBJECT WAS DELETED.                                            *65580098
655900*----------------------------------------------------------------*65590098
656000 7201-DELETE-SELECTION-QUEUE.                                     65600098
656100     PERFORM 9100-READ-SEL-QUEUE-IN                               65610098
656200     SET VL006-DEL (ASC-SEL-SUB) TO TRUE.                         65620098
656300     PERFORM 9200-REWRITE-SEL-QUEUE.                              65630098
656400                                                                  65640098
656600*----------------------------------------------------------------*65660098
656700*  DELETE A PRETICKET REQUEST HEADER RECORD FROM TPTKREQ         *65670098
656800*----------------------------------------------------------------*65680098
657000 7210-DELETE-REQUEST-HEADER.                                      65700098
657200     PERFORM                                                      65720098
657300         WITH TEST AFTER                                          65730098
657400         VARYING PV-RETRY-COUNTER                                 65740098
657500         FROM 1 BY 1                                              65750098
657600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               65760098
657700             OR (SQLCODE = +0)                                    65770098
657800             OR (SQLCODE = +100))                                 65780098
657900                                                                  65790098
658000         EXEC SQL                                                 65800098
658100              DELETE FROM TPTKREQ                                 65810098
658200              WHERE                                               65820098
658300                  PO_REQ_NBR      = :ASC-PO-REQ-NBR               65830098
658400         END-EXEC                                                 65840098
658500                                                                  65850098
658600         EVALUATE TRUE                                            65860098
658700             WHEN SQLCODE = +0                                    65870098
658800             WHEN SQLCODE = +100                                  65880098
658900                 CONTINUE                                         65890098
659100             WHEN SQLWARN0 NOT = SPACE                            65910098
659200             WHEN SQLCODE < +0                                    65920098
659300             WHEN SQLCODE > +0                                    65930098
659400                 MOVE '7210-DELETE-HEADER' TO DP013-PARAGRAPH     65940099
659600                 MOVE 'DELETE PRETICKET REQUEST HEADER TABLE'     65960098
659700                                   TO DP013-MESSAGE-TEXT (1)      65970098
659800                 MOVE ASC-PO-REQ-NBR  TO DP013-MESSAGE-TEXT (2)   65980099
660000                 MOVE SQLCA        TO DP013-SQLCA                 66000098
660100                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    66010098
660200                 SET DP013-DB2-ABEND                              66020098
660300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           66030098
660400                 PERFORM DP013-0000-PROCESS-ABEND                 66040098
660600         END-EVALUATE                                             66060098
660700     END-PERFORM.                                                 66070098
660800                                                                  66080098
661000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        66100098
661100         MOVE '7210-DELETE-HEADER' TO DP013-PARAGRAPH             66110098
661200         MOVE 'MAXIMUM RETRIES EXCEEDED DELETE HEADER TABLE'      66120098
661300                                   TO DP013-MESSAGE-TEXT (1)      66130098
661400         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      66140098
661500         MOVE SQLCA                TO DP013-SQLCA                 66150098
661600         MOVE 'TPTKREQ '           TO DP013-DB2-TABLE-NAME (1)    66160098
661700         SET DP013-DB2-ABEND                                      66170098
661800             DP013-XCTL-DISPLAY-RESTART TO TRUE                   66180099
662000         PERFORM DP013-0000-PROCESS-ABEND                         66200098
662100     END-IF.                                                      66210098
662200                                                                  66220098
662400*----------------------------------------------------------------*66240098
662500*  DELETE PRETICKET REQUEST LINE RECORD DB2 TABLE TPTKLNE   *     66250098
662600*----------------------------------------------------------------*66260098
662800 7220-DELETE-ALL-REQUEST-LINES.                                   66280098
663000     PERFORM                                                      66300098
663100         WITH TEST AFTER                                          66310098
663200         VARYING PV-RETRY-COUNTER                                 66320098
663300         FROM 1 BY 1                                              66330098
663400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               66340098
663500             OR (SQLCODE = +0))                                   66350098
663600             OR (SQLCODE = +100)                                  66360098
663700                                                                  66370098
663800         EXEC SQL                                                 66380098
663900              DELETE FROM TPTKLNE                                 66390098
664000                  WHERE                                           66400098
664100                      PO_REQ_NBR     = :ASC-PO-REQ-NBR            66410098
664200         END-EXEC                                                 66420098
664300                                                                  66430098
664400         EVALUATE TRUE                                            66440098
664500             WHEN SQLCODE = +0                                    66450098
664600             WHEN SQLCODE = +100                                  66460098
664700                 CONTINUE                                         66470098
664900             WHEN SQLWARN0 NOT = SPACE                            66490098
665000             WHEN SQLCODE < +0                                    66500098
665100             WHEN SQLCODE > +0                                    66510098
665200                 MOVE '7220-DELETE-ALL-REQUEST-LINES'             66520098
665300                                   TO DP013-PARAGRAPH             66530098
665400                 MOVE 'DELETE PRETICKET REQUEST LINE TABLE'       66540098
665500                                   TO DP013-MESSAGE-TEXT (1)      66550098
665600                 MOVE ASC-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)    66560099
665800                 MOVE SQLCA        TO DP013-SQLCA                 66580098
665900                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (1)    66590098
666000                 SET DP013-DB2-ABEND                              66600098
666100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           66610098
666200                 PERFORM DP013-0000-PROCESS-ABEND                 66620098
666400         END-EVALUATE                                             66640098
666500     END-PERFORM.                                                 66650098
666600                                                                  66660098
666800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        66680098
666900         MOVE '7220-DELETE-ALL-REQUEST-LINES' TO DP013-PARAGRAPH  66690099
667100         MOVE 'MAXIMUM RETRIES EXCEEDED DELETING DETAIL TABLE'    66710098
667200                                   TO DP013-MESSAGE-TEXT (1)      66720098
667300         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      66730098
667400         MOVE SQLCA                TO DP013-SQLCA                 66740098
667500         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (1)    66750098
667600         SET DP013-DB2-ABEND                                      66760098
667700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   66770099
667900         PERFORM DP013-0000-PROCESS-ABEND                         66790098
668000     END-IF.                                                      66800098
668200                                                                  66820098
668300 7221-DELETE-ONE-REQUEST-LINE.                                    66830098
668500     PERFORM                                                      66850098
668600         WITH TEST AFTER                                          66860098
668700         VARYING PV-RETRY-COUNTER                                 66870098
668800         FROM 1 BY 1                                              66880098
668900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               66890098
669000             OR (SQLCODE = +0))                                   66900098
669100                                                                  66910098
669200         EXEC SQL                                                 66920098
669300              DELETE FROM TPTKLNE                                 66930098
669400                  WHERE                                           66940098
669500                      PO_REQ_NBR     = :ASC-PO-REQ-NBR            66950098
669600                  AND PO_LNE_NBR     = :DK-PO-LNE-NBR             66960098
669700         END-EXEC                                                 66970098
669800                                                                  66980098
669900         EVALUATE TRUE                                            66990098
670000             WHEN SQLCODE = +0                                    67000098
670100                 CONTINUE                                         67010098
670300             WHEN SQLWARN0 NOT = SPACE                            67030098
670400             WHEN SQLCODE < +0                                    67040098
670500             WHEN SQLCODE > +0                                    67050098
670600                 MOVE '7221-DELETE-ONE-REQUEST-LINE'              67060098
670700                                   TO DP013-PARAGRAPH             67070098
670800                 MOVE 'DELETE PRETICKET REQUEST LINE TABLE'       67080098
670900                                   TO DP013-MESSAGE-TEXT (1)      67090098
671000                 MOVE ASC-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)    67100099
671200                 MOVE SQLCA        TO DP013-SQLCA                 67120098
671300                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (1)    67130098
671400                 SET DP013-DB2-ABEND                              67140098
671500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           67150098
671600                 PERFORM DP013-0000-PROCESS-ABEND                 67160098
671700                                                                  67170098
671800         END-EVALUATE                                             67180098
671900     END-PERFORM.                                                 67190098
672000                                                                  67200098
672200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        67220098
672300         MOVE '7221-DELETE-ONE-REQUEST-LINE'                      67230098
672400                                   TO DP013-PARAGRAPH             67240098
672500         MOVE 'MAXIMUM RETRIES EXCEEDED DELETING DETAIL TABLE'    67250098
672600                                   TO DP013-MESSAGE-TEXT (1)      67260098
672700         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      67270098
672800         MOVE SQLCA                TO DP013-SQLCA                 67280098
672900         MOVE 'TPTKLNE '           TO DP013-DB2-TABLE-NAME (1)    67290098
673000         SET DP013-DB2-ABEND                                      67300098
673100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   67310099
673300         PERFORM DP013-0000-PROCESS-ABEND                         67330098
673400     END-IF.                                                      67340098
673500                                                                  67350098
673600*----------------------------------------------------------------*67360098
673700*  DELETE THE COMMENTS ASSOCIATED TO A REQUEST (TPTKCMT)         *67370098
673800*----------------------------------------------------------------*67380098
673900 7230-DELETE-REQUEST-COMMENTS.                                    67390098
674200* FIRST SELECT THE REQUEST COMMENT ID                             67420098
674300     PERFORM                                                      67430098
674400         WITH TEST AFTER                                          67440098
674500         VARYING PV-RETRY-COUNTER                                 67450098
674600         FROM 1 BY 1                                              67460098
674700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               67470098
674800             OR (SQLCODE = +0))                                   67480098
674900                                                                  67490098
675000         EXEC SQL                                                 67500098
675100              SELECT CMNT_ID                                      67510098
675200              INTO   :PV-REQUEST-CMNT-ID                          67520098
675300              FROM   TPTKREQ                                      67530098
675400              WHERE                                               67540098
675500                  PO_REQ_NBR      = :ASC-PO-REQ-NBR               67550098
675600         END-EXEC                                                 67560098
675700                                                                  67570098
675800         EVALUATE TRUE                                            67580098
675900             WHEN SQLCODE = +0                                    67590098
676000                 CONTINUE                                         67600098
676100                                                                  67610098
676200             WHEN SQLWARN0 NOT = SPACE                            67620098
676300             WHEN SQLCODE < +0                                    67630098
676400             WHEN SQLCODE > +0                                    67640098
676500                 MOVE '7230-DELETE-REQUEST-COMMENTS'              67650098
676600                                   TO DP013-PARAGRAPH             67660098
676700                 MOVE 'SELECT REQUEST COMMENT ID'                 67670098
676800                                   TO DP013-MESSAGE-TEXT (1)      67680098
676900                 MOVE ASC-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)    67690099
677100                 MOVE SQLCA        TO DP013-SQLCA                 67710098
677200                 MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)    67720098
677300                 SET DP013-DB2-ABEND                              67730098
677400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           67740098
677500                 PERFORM DP013-0000-PROCESS-ABEND                 67750098
677600                                                                  67760098
677700         END-EVALUATE                                             67770098
677800     END-PERFORM.                                                 67780098
677900                                                                  67790098
678100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        67810098
678200         MOVE '7230-DELETE-REQUEST-COMMENTS' TO DP013-PARAGRAPH   67820099
678400         MOVE 'MAXIMUM RETRIES SELECT THE REQUEST CMNT ID'        67840098
678500                                   TO DP013-MESSAGE-TEXT (1)      67850098
678600         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      67860099
678800         MOVE SQLCA                TO DP013-SQLCA                 67880098
678900         MOVE 'TPTKCMT '           TO DP013-DB2-TABLE-NAME (1)    67890098
679000         SET DP013-DB2-ABEND                                      67900098
679100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   67910099
679300         PERFORM DP013-0000-PROCESS-ABEND                         67930098
679400     END-IF.                                                      67940098
679700                                                                  67970098
679800* FINALLY, DELETE ALL THE COMMENTS ASSOCIATED TO THE REQUEST      67980098
679900     IF PV-REQUEST-CMNT-ID > 0                                    67990098
680000     OR PV-SHIPT-CMNT-ID   > 0                                    68000098
680100         PERFORM                                                  68010098
680200             WITH TEST AFTER                                      68020098
680300             VARYING PV-RETRY-COUNTER                             68030098
680400             FROM 1 BY 1                                          68040098
680500             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           68050098
680600                 OR (SQLCODE = +0)                                68060098
680700                 OR (SQLCODE = +100))                             68070098
680800                                                                  68080098
680900             EXEC SQL                                             68090098
681000                  DELETE FROM TPTKCMT                             68100098
681100                  WHERE                                           68110098
681200                      CMNT_ID  IN (:PV-REQUEST-CMNT-ID            68120098
681300                                  ,:PV-SHIPT-CMNT-ID )            68130098
681400             END-EXEC                                             68140098
681500                                                                  68150098
681600             EVALUATE TRUE                                        68160098
681700                 WHEN SQLCODE = +0                                68170098
681800                 WHEN SQLCODE = +100                              68180098
681900                     CONTINUE                                     68190098
682000                                                                  68200098
682100                 WHEN SQLWARN0 NOT = SPACE                        68210098
682200                 WHEN SQLCODE < +0                                68220098
682300                 WHEN SQLCODE > +0                                68230098
682400                     MOVE '7230-DELETE-REQUEST-COMMENTS'          68240098
682500                                     TO DP013-PARAGRAPH           68250098
682600                     MOVE 'DELETE PRETICKET REQUEST COMMENT TABLE'68260098
682700                                     TO DP013-MESSAGE-TEXT (1)    68270098
682800                     MOVE PV-REQUEST-CMNT-ID                      68280098
682900                                     TO DP013-MESSAGE-TEXT (2)    68290098
683000                     MOVE PV-SHIPT-CMNT-ID                        68300098
683100                                     TO DP013-MESSAGE-TEXT (3)    68310098
683200                     MOVE SQLCA      TO DP013-SQLCA               68320098
683300                     MOVE 'TPTKCMT ' TO DP013-DB2-TABLE-NAME (1)  68330098
683400                     SET DP013-DB2-ABEND                          68340098
683500                         DP013-XCTL-DISPLAY-RESTART TO TRUE       68350098
683600                     PERFORM DP013-0000-PROCESS-ABEND             68360098
683800             END-EVALUATE                                         68380098
683900         END-PERFORM                                              68390098
684000     END-IF.                                                      68400098
684200                                                                  68420098
684300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        68430098
684400         MOVE '7230-DELETE-REQUEST-COMMENTS'                      68440098
684500                                   TO DP013-PARAGRAPH             68450098
684600         MOVE 'MAXIMUM RETRIES EXCEEDED DELETE COMMENT TABLE'     68460098
684700                                   TO DP013-MESSAGE-TEXT (1)      68470098
684800         MOVE PV-REQUEST-CMNT-ID   TO DP013-MESSAGE-TEXT (2)      68480098
684900         MOVE PV-SHIPT-CMNT-ID     TO DP013-MESSAGE-TEXT (3)      68490098
685000         MOVE SQLCA                TO DP013-SQLCA                 68500098
685100         MOVE 'TPTKCMT '           TO DP013-DB2-TABLE-NAME (1)    68510098
685200         SET DP013-DB2-ABEND                                      68520098
685300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   68530099
685500         PERFORM DP013-0000-PROCESS-ABEND                         68550098
685600     END-IF.                                                      68560098
685700                                                                  68570098
685900*----------------------------------------------------------------*68590098
686000*  DELETE THE REASONS ASSOCIATED TO A REQUEST (TPTKRSN)         * 68600098
686100*----------------------------------------------------------------*68610098
686200 7240-DELETE-REQUEST-REASONS.                                     68620098
686400     PERFORM                                                      68640098
686500         WITH TEST AFTER                                          68650098
686600         VARYING PV-RETRY-COUNTER                                 68660098
686700         FROM 1 BY 1                                              68670098
686800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               68680098
686900             OR (SQLCODE = +0)                                    68690098
687000             OR (SQLCODE = +100))                                 68700098
687100                                                                  68710098
687200         EXEC SQL                                                 68720098
687300              DELETE FROM TPTKRSN                                 68730098
687400              WHERE                                               68740098
687500                  PO_REQ_NBR      = :ASC-PO-REQ-NBR               68750098
687600         END-EXEC                                                 68760098
687700                                                                  68770098
687800         EVALUATE TRUE                                            68780098
687900             WHEN SQLCODE = +0                                    68790098
688000             WHEN SQLCODE = +100                                  68800098
688100                 CONTINUE                                         68810098
688200                                                                  68820098
688300             WHEN SQLWARN0 NOT = SPACE                            68830098
688400             WHEN SQLCODE < +0                                    68840098
688500             WHEN SQLCODE > +0                                    68850098
688600                 MOVE '7240-DELETE-REQUEST-REASONS'               68860098
688700                                   TO DP013-PARAGRAPH             68870098
688800                 MOVE 'DELETE PRETICKET REQUEST REASON TABLE'     68880098
688900                                   TO DP013-MESSAGE-TEXT (1)      68890098
689000                 MOVE ASC-PO-REQ-NBR TO DP013-MESSAGE-TEXT (2)    68900099
689200                 MOVE SQLCA        TO DP013-SQLCA                 68920098
689300                 MOVE 'TPTKRSN '   TO DP013-DB2-TABLE-NAME (1)    68930098
689400                 SET DP013-DB2-ABEND                              68940098
689500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           68950098
689600                 PERFORM DP013-0000-PROCESS-ABEND                 68960098
689700                                                                  68970098
689800         END-EVALUATE                                             68980098
689900     END-PERFORM.                                                 68990098
690000                                                                  69000098
690200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        69020098
690300         MOVE '7230-DELETE-REQUEST-REASONS'                       69030098
690400                                   TO DP013-PARAGRAPH             69040098
690500         MOVE 'MAXIMUM RETRIES EXCEEDED DELETE REASON TABLE'      69050098
690600                                   TO DP013-MESSAGE-TEXT (1)      69060098
690700         MOVE ASC-PO-REQ-NBR       TO DP013-MESSAGE-TEXT (2)      69070098
690800         MOVE SQLCA                TO DP013-SQLCA                 69080098
690900         MOVE 'TPTKRSN '           TO DP013-DB2-TABLE-NAME (1)    69090098
691000         SET DP013-DB2-ABEND                                      69100098
691100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   69110099
691300         PERFORM DP013-0000-PROCESS-ABEND                         69130098
691400     END-IF.                                                      69140098
691500                                                                  69150098
691800*----------------------------------------------------------------*69180098
691900* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *69190098
692000*----------------------------------------------------------------*69200098
692200 9100-READ-SEL-QUEUE-IN.                                          69220098
692300     EXEC CICS                                                    69230098
692400         READQ TS                                                 69240098
692500             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        69250098
692600             INTO  (VL006-LINE-SEL-REC)                           69260098
692700             ITEM  (ASC-SEL-ITEM)                                 69270098
692800             RESP  (PV-CICS-RESP)                                 69280098
692900     END-EXEC.                                                    69290098
693000                                                                  69300098
693100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       69310098
693200         CONTINUE                                                 69320098
693300     ELSE                                                         69330098
693400         SET DP013-LOGIC-ABEND                                    69340098
693500             DP013-NO-ROLLBACK     TO TRUE                        69350098
693600         MOVE '9100-READ-SEL-QUEUE'  TO DP013-PARAGRAPH           69360099
693800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   69380098
693900                                   TO DP013-MESSAGE-TEXT (1)      69390098
694000         PERFORM DP013-0000-PROCESS-ABEND                         69400098
694100     END-IF.                                                      69410098
694200*----------------------------------------------------------------*69420098
694300* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *69430098
694400*----------------------------------------------------------------*69440098
694500 9200-REWRITE-SEL-QUEUE.                                          69450098
694600     EXEC CICS                                                    69460098
694700          WRITEQ TS                                               69470098
694800              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      69480098
694900              FROM   (VL006-LINE-SEL-REC)                         69490098
695000              ITEM   (ASC-SEL-ITEM)                               69500098
695100              RESP   (PV-CICS-RESP)                               69510098
695200              REWRITE                                             69520098
695300     END-EXEC.                                                    69530098
695400                                                                  69540098
695500     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   69550098
695600         SET DP013-CICS-ABEND                                     69560098
695700             DP013-NO-ROLLBACK     TO TRUE                        69570098
695800         MOVE '9200-REWRITE-SEL-QUEUE'                            69580098
695900                                   TO DP013-PARAGRAPH             69590098
696000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   69600098
696100                                   TO DP013-MESSAGE-TEXT (1)      69610098
696200         PERFORM DP013-0000-PROCESS-ABEND                         69620098
696300     END-IF.                                                      69630098
696400                                                                  69640098
696600*----------------------------------------------------------------*69660098
696700*    ABEND PROCESSOR MODULE                                      *69670098
696800*----------------------------------------------------------------*69680098
697000     COPY DPPD013.                                                69700099
