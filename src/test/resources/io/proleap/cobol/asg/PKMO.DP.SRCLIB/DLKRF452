000100 TITLE 'LABOR SYSTEM - ASSOCIATE ASSIGNMENT DISPLAY'.                     
000200 IDENTIFICATION DIVISION.                                                 
000300                                                                          
000400 PROGRAM-ID.             DLKRF452.                                        
000500 AUTHOR.                 DENNIS STEFFEN.                                  
000600 INSTALLATION.           KOHLS.                                           
000700 DATE-WRITTEN.           DECEMBER 2003.                                   
000800 DATE-COMPILED.                                                           
000900 ENVIRONMENT DIVISION.                                                    
001000 DATA DIVISION.                                                           
001100                                                                          
001200 WORKING-STORAGE SECTION.                                                 
001300*                                                                         
001400 01  PC-PROGRAM-CONSTANTS.                                                
001500     05  PC-TRANID                    PIC X(04) VALUE 'D452'.             
001600     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'DLKRF452'.         
001700                                                                          
001800* ERROR MESSAGES                                                 *        
001900     05  PC-UNRECOGNIZED-PF-KEY-MSG PIC X(19) VALUE                       
002000                                           'UNRECOGNIZED PF KEY'.         
002100     05  PC-ENTER-THROUGH-MENU-MSG  PIC X(19) VALUE                       
002200                                           'ENTER THROUGH MENU '.         
002300     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE                       
002400                                           'TRANS NOT AVAILABLE'.         
002500     05  PC-WRONG-FACILITY          PIC X(19) VALUE                       
002600                                           'WRG FCLTY - F2 CONF'.         
002700                                                                          
002800 01  PS-PROGRAM-SWITCHES.                                                 
002900     05  PS-LOGON-USER-SW             PIC X(01)   VALUE 'Y'.              
003000         88  PS-LOGON-USER-YES                    VALUE 'Y'.              
003100         88  PS-LOGON-USER-NO                     VALUE 'N'.              
003200     05  PS-ERROR-SW                  PIC  X(01)  VALUE 'N'.              
003300         88  PS-ERRORS-YES                        VALUE 'Y'.              
003400         88  PS-ERRORS-NO                         VALUE 'N'.              
003500     05  PS-VALID-INPUT-SW            PIC  X(01)  VALUE 'N'.              
003600         88  PS-VALID-INPUT                       VALUE 'Y'.              
003700         88  PS-INVALID-INPUT                     VALUE 'N'.              
003800/                                                                         
003900*----------------------------------------------------------------*        
004000*  PROGRAM VARIABLES                                             *        
004100*----------------------------------------------------------------*        
004200 01  PV-PROGRAM-VARIABLES.                                                
004300                                                                          
004400     05  PV-UNSTRING-COUNT            PIC S9(03) COMP-3.                  
004500     05  PV-POINTER                   PIC S9(03) COMP-3.                  
004600     05  PV-TALLY                     PIC S9(03) COMP-3.                  
004700     05  PV-TOT-QTY                   PIC S9(7) COMP-3.                   
004800     05  PV-TEAM-COUNT                PIC S9(4) COMP.                     
004900                                                                          
005000     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0                
005100                                                     COMP SYNC.           
005200     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.            
005300     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS             
005400                                                     COMP SYNC.           
005500     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.            
005600     05  PV-USERID                    PIC X(08) VALUE SPACES.             
005700     05  PV-TMST                      PIC X(26) VALUE SPACES.             
005800                                                                          
005900 01  PV-LOG-MSG.                                                          
006000     05  FILLER                       PIC X(12) VALUE                     
006100         ' D452 ERROR '.                                                  
006200     05  FILLER                       PIC X(06) VALUE                     
006300         'USER= '.                                                        
006400     05  PV-LOG-USER-ID               PIC X(08) VALUE SPACES.             
006500     05  FILLER                       PIC X(10) VALUE                     
006600         ' SQLCODE= '.                                                    
006700     05  PV-SQLCODE                   PIC -9(03).                         
006800     05  FILLER                       PIC X(06) VALUE                     
006900         ' ERR= '.                                                        
007000     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.               
007100/                                                                         
007200* COMMAREA FOR DLKRF SCREENS                                              
007300     COPY DLWS010.                                                        
007400* FULL SCREEN MESSAGES                                                    
007500     COPY DLWS012.                                                        
007600/                                                                         
007700* COMMAREA FOR DLKUT001                                                   
007800     COPY DLWS003.                                                        
007900/                                                                         
008000* COMMAREA FOR SUKRF501                                                   
008100 01  CA-SUWS001-COMMAREA.                                                 
008200     COPY SUWS001.                                                        
008300/                                                                         
008400*  MAP LAYOUT                                                             
008500     COPY DLKM452.                                                        
008600/                                                                         
008700* HELP SCREEN COMMAREA                                                    
008800     COPY PCWS192.                                                        
008900* HELP SCREEN WORK AREA                                                   
009000     COPY PCWS188.                                                        
009100/                                                                         
009200*  NUMERIC EDITS                                                          
009300     COPY DPWS010I.                                                       
009400*  KOHL'S STANDARD ATTRIBUTES                                             
009500     COPY DPWS015.                                                        
009600                                                                          
009700*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                              
009800     COPY DFHAID.                                                         
009900                                                                          
010000*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.                       
010100     COPY DPWS013.                                                        
010200/                                                                         
010300*    DLT_TEM_ASGMT                                                        
010400     EXEC SQL                                                             
010500         INCLUDE DLT00003                                                 
010600     END-EXEC.                                                            
010700                                                                          
010800     EXEC SQL                                                             
010900         INCLUDE SQLCA                                                    
011000     END-EXEC.                                                            
011100                                                                          
011200 LINKAGE SECTION.                                                         
011300 01  DFHCOMMAREA.                                                         
011400     05  FILLER                         OCCURS  1 TO 4072 TIMES           
011500                                      DEPENDING ON EIBCALEN.              
011600         10  FILLER                   PIC X.                              
011700/                                                                         
011800 PROCEDURE DIVISION.                                                      
011900 0000-PROGRAM-MAINLINE.                                                   
012000                                                                          
012100     INITIALIZE DL010-COMMAREA                                            
012200     MOVE DFHCOMMAREA                 TO DL010-COMMAREA                   
012300                                                                          
012400     EVALUATE TRUE                                                        
012500         WHEN EIBCALEN = ZERO                                             
012600             MOVE PC-ENTER-THROUGH-MENU-MSG                               
012700                                      TO PV-MESSAGE-AREA                  
012800             PERFORM 8110-RETURN                                          
012900                                                                          
013000         WHEN EIBTRNID = 'Z278'                                           
013100*            RETURN FROM HELP SCREEN                                      
013200             MOVE DFHCOMMAREA         TO PC192-COMMAREA                   
013300             MOVE PC192-HOST-SAVE-AREA                                    
013400                                      TO DL010-COMMAREA                   
013500             SET DL010-PROCESS-SCREEN TO TRUE                             
013600             MOVE PC192-HOST-SAVE-MAP TO DL452AO                          
013700             PERFORM 8000-SEND-MAP                                        
013800             PERFORM 8100-RETURN-TRANID                                   
013900                                                                          
014000         WHEN DL010-INITIALIZE-SCREEN                                     
014100         WHEN EIBAID = DFHCLEAR                                           
014200             SET DL010-PROCESS-SCREEN TO TRUE                             
014300             PERFORM 1000-INITIALIZE                                      
014400             PERFORM 8000-SEND-MAP                                        
014500             PERFORM 8100-RETURN-TRANID                                   
014600                                                                          
014700         WHEN EIBAID = DFHPF3                                             
014800*            SUKRF501 TRAILER START                                       
014900             MOVE DL010-MENU-PROGRAM  TO PV-TRANSFER-PROGRAM              
015000             IF DL010-MENU-PROGRAM  = 'SUKRF501'                          
015100                 PERFORM 8200-XCTL                                        
015200             ELSE                                                         
015300                 PERFORM 8201-XCTL-DL                                     
015400             END-IF                                                       
015500                                                                          
015600         WHEN EIBAID = DFHPF5 AND DL010-ENABLE-FKEYS-YES                  
015700             IF DL010-SELECTION = 3                                       
015800                 PERFORM 8020-RECEIVE-MAP                                 
015900                 PERFORM 2100-EDIT-INPUT                                  
016000                 MOVE PV-USERID       TO DL010-KEYED-USERID               
016100*               TRANSFER TO ADD SCREEN                                    
016200                 MOVE PC-CURRENT-PROGRAM-NAME                             
016300                                      TO DL010-LAST-PROGRAM               
016400                                         DL010-ROOT-PROGRAM               
016500                 MOVE 'DLKRF450'      TO PV-TRANSFER-PROGRAM              
016600                                         DL010-NEXT-PROGRAM               
016700                 PERFORM 8201-XCTL-DL                                     
016800             ELSE                                                         
016900*                ONLY VALID FOR OPTION 3 (TEAM ASGMT)                     
017000                 PERFORM 8020-RECEIVE-MAP                                 
017100                 MOVE PC-UNRECOGNIZED-PF-KEY-MSG                          
017200                                      TO ALINE7O                          
017300                 PERFORM 8000-SEND-MAP                                    
017400                 PERFORM 8100-RETURN-TRANID                               
017500             END-IF                                                       
017600                                                                          
017700         WHEN EIBAID = DFHENTER                                           
017800             PERFORM 2000-PROCESS-SCREEN-FIELDS                           
017900             IF PS-ERRORS-NO                                              
018000                 PERFORM 8010-SEND-DATA-ONLY                              
018100                 PERFORM 8100-RETURN-TRANID                               
018200             ELSE                                                         
018300                 PERFORM 8010-SEND-DATA-ONLY                              
018400                 PERFORM 8100-RETURN-TRANID                               
018500             END-IF                                                       
018600                                                                          
018700         WHEN EIBAID = DFHPF1                                             
018800             PERFORM 8020-RECEIVE-MAP                                     
018900             MOVE DL452AO             TO PC192-HOST-SAVE-MAP              
019000             PERFORM 1200-HELP-SCREEN                                     
019100                                                                          
019200         WHEN EIBAID = DFHPF6 AND DL010-ENABLE-FKEYS-YES                  
019300*            LIST ASSOCIATES                                              
019400             MOVE PC-CURRENT-PROGRAM-NAME TO DL010-LAST-PROGRAM           
019500             MOVE 'DLKRF451'          TO PV-TRANSFER-PROGRAM              
019600                                         DL010-NEXT-PROGRAM               
019700             PERFORM 8201-XCTL-DL                                         
019800         WHEN OTHER                                                       
019900             PERFORM 8020-RECEIVE-MAP                                     
020000             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                              
020100                                      TO ALINE7O                          
020200             PERFORM 8000-SEND-MAP                                        
020300             PERFORM 8100-RETURN-TRANID                                   
020400     END-EVALUATE.                                                        
020500                                                                          
020600     GOBACK.                                                              
020700                                                                          
020800 1000-INITIALIZE.                                                         
020900                                                                          
021000     EXEC SQL                                                             
021100         SET :PV-TMST = CURRENT TIMESTAMP                                 
021200     END-EXEC                                                             
021300                                                                          
021400     MOVE PC-TRANID                   TO DL010-TRAN-ID                    
021500     MOVE SPACES                      TO ALINE5O                          
021600                                         ALINE6O                          
021700                                         ALINE8O                          
021800*                                        AAREAO                           
021900                                         ALINE7O                          
022000     MOVE ZEROES                      TO ATMCNTO                          
022100     MOVE DL010-OPER-UNT-ID           TO ADCO.                            
022200                                                                          
022300     MOVE DL010-KEYED-USERID          TO PV-USERID                        
022400                                         PV-LOG-USER-ID                   
022500     PERFORM 8600-CALL-DLKUT001                                           
022600     IF DL003-SUCCESSFUL                                                  
022700         IF PS-ERRORS-NO                                                  
022800             PERFORM 2200-BUILD-SCREEN                                    
022900         END-IF                                                           
023000         PERFORM 1500-DETERMINE-FKEYS                                     
023100     END-IF.                                                              
023200                                                                          
023300                                                                          
023400 1200-HELP-SCREEN.                                                        
023500     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM              
023600     MOVE 'DLKRF452'                  TO PC192-PROGRAM-NAME               
023700     COPY PCPD188.                                                        
023800     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.              
023900     MOVE DL010-COMMAREA              TO PC192-HOST-SAVE-AREA             
024000     PERFORM 8220-XCTL-TO-HELP.                                           
024100                                                                          
024200 1500-DETERMINE-FKEYS.                                                    
024300                                                                          
           IF DL010-ASSGMT-FOUND-YES                                            
               PERFORM 1510-DETERMINE-F5-F6                                     
           ELSE                                                                 
               SET DL010-ENABLE-FKEYS-NO  TO TRUE                               
               MOVE '      F3-END       ' TO ALINE8O                            
           END-IF.                                                              
                                                                                
       1510-DETERMINE-F5-F6.                                                    
024400     IF PS-LOGON-USER-YES                                                 
024500*        THIS IS WHO IS SIGNED ON TO THE GUN                              
024600*        IF DL010-ASSGMT-FOUND-YES                                        
024700             SET DL010-ENABLE-FKEYS-YES TO TRUE                           
024800             EVALUATE DL010-SELECTION                                     
024900                 WHEN 2                                                   
025000                     MOVE SPACES                TO ALINE7O                
025100                     MOVE '      F6-LST       ' TO ALINE8O                
025200                 WHEN 3                                                   
025300                     MOVE SPACES                TO ALINE7O                
025400                     MOVE 'F5-ADD       F6-LST' TO ALINE8O                
025500             END-EVALUATE                                                 
025600*        ELSE                                                             
025700*            SET DL010-ENABLE-FKEYS-NO  TO TRUE                           
025800*            MOVE '      F3-END       ' TO ALINE8O                        
025900*        END-IF                                                           
026000                                                                          
026100     ELSE                                                                 
026200*        THIS USER WAS MANUALLY KEYED INTO THE GUN                        
026300         SET DL010-ENABLE-FKEYS-YES TO TRUE                               
026400         EVALUATE DL010-SELECTION                                         
026500             WHEN 2                                                       
026600                 MOVE SPACES                TO ALINE7O                    
026700                 MOVE '      F6-LST       ' TO ALINE8O                    
026800             WHEN 3                                                       
026900                 MOVE SPACES                TO ALINE7O                    
027000                 MOVE 'F5-ADD       F6-LST' TO ALINE8O                    
027100         END-EVALUATE                                                     
027200     END-IF.                                                              
027300/                                                                         
027400 2000-PROCESS-SCREEN-FIELDS.                                              
027500                                                                          
027600     PERFORM 8020-RECEIVE-MAP                                             
027700     PERFORM 2100-EDIT-INPUT.                                             
027800                                                                          
027900     IF PS-VALID-INPUT                                                    
028000         MOVE PV-USERID               TO AUSERO                           
028100         PERFORM 8600-CALL-DLKUT001                                       
028200         IF DL003-SUCCESSFUL                                              
028300             IF PS-ERRORS-NO                                              
028400                 PERFORM 2200-BUILD-SCREEN                                
028500             END-IF                                                       
028600             PERFORM 1500-DETERMINE-FKEYS                                 
028700             PERFORM 8010-SEND-DATA-ONLY                                  
028800             PERFORM 8100-RETURN-TRANID                                   
028900         END-IF                                                           
029000     ELSE                                                                 
029100         PERFORM 8010-SEND-DATA-ONLY                                      
029200         PERFORM 8100-RETURN-TRANID                                       
029300     END-IF.                                                              
029400                                                                          
029500 2100-EDIT-INPUT.                                                         
029600                                                                          
029700     MOVE SPACES                      TO ALINE5O                          
029800                                         PV-USERID                        
029900     SET PS-VALID-INPUT               TO TRUE                             
030000                                                                          
030100     IF AUSERL > ZERO                                                     
030200         MOVE AUSERI                  TO PV-USERID                        
030300     ELSE                                                                 
030400         MOVE SPACES                  TO PV-USERID                        
030500         SET PS-INVALID-INPUT         TO TRUE                             
030600     END-IF.                                                              
030700     IF PS-VALID-INPUT                                                    
030800         IF PV-USERID = DL010-USERID                                      
030900             SET PS-LOGON-USER-YES    TO TRUE                             
031000         ELSE                                                             
031100             SET PS-LOGON-USER-NO     TO TRUE                             
031200         END-IF                                                           
031300     END-IF.                                                              
031400                                                                          
031500 2200-BUILD-SCREEN.                                                       
031600     MOVE DL003-KEY-USER-ID           TO AUSERO                           
031700     IF DL010-ASSGMT-FOUND-YES                                            
031800         MOVE DL003-ASGMT-DC-NBR      TO ADCO                             
031900         MOVE DL003-ASGMT-ACTV-USR-QTY TO                                 
032000                                         DL010-ASGMT-ACTV-USR-QTY         
032100         MOVE DL003-ASGMT-WK-TYP-DESC TO ALINE5O                          
032200                                         DL010-WRK-TYP-DESC               
032300         MOVE DL003-ASGMT-WK-AREA-DESC TO ALINE6O                         
032400                                          DL010-WRK-AREA-DESC             
032500         STRING 'JN: ' DL003-ASGMT-JOIN-DTE-RF                            
032600                   ' '                                                    
032700                   DL003-ASGMT-JOIN-TME (1:5)                             
032800         DELIMITED BY SIZE          INTO ALINE7O                          
032900         MOVE DL003-ASGMT-START-DTE   TO DL010-ASGMT-STRT-DTE             
033000         MOVE DL003-ASGMT-NBR-TXT     TO DL010-ASGMT-NBR-TXT              
033100         MOVE DL003-ASGMT-NBR-SEQ-NBR TO DL010-ASGMT-NBR-SEQ-NBR          
033200         PERFORM 7000-COUNT-UP-TEAM                                       
033300         MOVE PV-TEAM-COUNT           TO ATMCNTO                          
033400     ELSE                                                                 
033500         MOVE DL010-OPER-UNT-ID       TO ADCO                             
033600         MOVE '  NO ACTIVE ASSGMT '   TO ALINE5O                          
033700         MOVE 'FOUND FOR ASSOCIATE'   TO ALINE6O                          
033800         MOVE '      F3-END       '   TO ALINE8O                          
033900     END-IF.                                                              
034000/                                                                         
034100 7000-COUNT-UP-TEAM.                                                      
034200     EXEC SQL                                                             
034300         SELECT COUNT(*)                                                  
034400         INTO :PV-TEAM-COUNT                                              
034500         FROM                                                             
034600             DLT_TEM_ASGMT                                                
034700         WHERE                                                            
034800             ASGMT_STRT_DTE     = :DL010-ASGMT-STRT-DTE                   
034900             AND                                                          
035000             ASGMT_NBR_TXT      = :DL010-ASGMT-NBR-TXT                    
035100             AND                                                          
035200             ASGMT_NBR_SEQ_NBR  = :DL010-ASGMT-NBR-SEQ-NBR                
035300             AND                                                          
035400             LVE_TMST           IS NULL                                   
035500     END-EXEC.                                                            
035600                                                                          
035700     EVALUATE TRUE                                                        
035800         WHEN SQLCODE = ZERO                                              
035900         WHEN SQLCODE = +100                                              
036000             CONTINUE                                                     
036100         WHEN SQLCODE = -904                                              
036200         WHEN SQLCODE = -913                                              
036300         WHEN SQLCODE = -911                                              
036400             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID                   
036500             MOVE SQLCODE             TO PV-SQLCODE                       
036600             MOVE 3                   TO PV-ERROR-NBR                     
036700                                         DL010-ERROR-NBR                  
036800             PERFORM 9903-WRITE-CICS-LOG                                  
036900             PERFORM 9000-SOFT-ABORT                                      
037000             PERFORM 8210-XCTL-ERROR-SCREEN                               
037100         WHEN SQLWARN0 NOT = SPACES                                       
037200         WHEN SQLCODE NOT EQUAL ZERO                                      
037300             MOVE 4                   TO PV-ERROR-NBR                     
037400                                         DL010-ERROR-NBR                  
037500             PERFORM 9903-WRITE-CICS-LOG                                  
037600             MOVE '7000-COUNT-UP-TEAM'                                    
037700                                      TO DL010-PARAGRAPH                  
037800             MOVE 'DLKRF452 - OPEN NAME CURSOR'                           
037900                                      TO DL010-MESSAGE-TEXT(1)            
038000             MOVE SQLCA               TO DL010-SQLCA                      
038100             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)          
038200             SET DL010-ABEND          TO TRUE                             
038300             MOVE 3                   TO DL010-PGM-MSG-NBR                
038400             PERFORM 8210-XCTL-ERROR-SCREEN                               
038500                                                                          
038600     END-EVALUATE.                                                        
038700                                                                          
038800/                                                                         
038900 8000-SEND-MAP.                                                           
039000                                                                          
039100     MOVE -1                          TO AUSERL                           
039200     EXEC CICS                                                            
039300         SEND MAP       ('DL452A')                                        
039400              MAPSET    ('DLKM452')                                       
039500              ERASE                                                       
039600              RESP      (PV-CICS-RESPONSE)                                
039700     END-EXEC.                                                            
039800                                                                          
039900     EVALUATE TRUE                                                        
040000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
040100             CONTINUE                                                     
040200         WHEN OTHER                                                       
040300             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH                  
040400             MOVE 'DLKRF452 - UNABLE TO SEND MAP'                         
040500                                      TO DP013-MESSAGE-TEXT (1)           
040600             SET DP013-CICS-ABEND                                         
040700                 DP013-ROLLBACK       TO TRUE                             
040800             PERFORM 9999-WRITE-DP013-MESSAGE                             
040900     END-EVALUATE.                                                        
041000                                                                          
041100 8010-SEND-DATA-ONLY.                                                     
041200                                                                          
041300     MOVE -1                          TO AUSERL                           
041400     EXEC CICS                                                            
041500         SEND MAP       ('DL452A')                                        
041600              MAPSET    ('DLKM452')                                       
041700              CURSOR                                                      
041800              DATAONLY                                                    
041900              RESP      (PV-CICS-RESPONSE)                                
042000     END-EXEC.                                                            
042100                                                                          
042200     EVALUATE TRUE                                                        
042300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
042400             CONTINUE                                                     
042500         WHEN OTHER                                                       
042600             MOVE '8010-SEND-DATA-ONLY'                                   
042700                                      TO DP013-PARAGRAPH                  
042800             MOVE 'DLKRF452 - UNABLE TO SEND DATA'                        
042900                                      TO DP013-MESSAGE-TEXT (1)           
043000             SET DP013-CICS-ABEND                                         
043100                 DP013-ROLLBACK       TO TRUE                             
043200             PERFORM 9999-WRITE-DP013-MESSAGE                             
043300     END-EVALUATE.                                                        
043400                                                                          
043500 8020-RECEIVE-MAP.                                                        
043600                                                                          
043700     EXEC CICS                                                            
043800         RECEIVE MAP    ('DL452A')                                        
043900                 MAPSET ('DLKM452')                                       
044000                 RESP   (PV-CICS-RESPONSE)                                
044100     END-EXEC.                                                            
044200                                                                          
044300     EVALUATE TRUE                                                        
044400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
044500             CONTINUE                                                     
044600         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                        
044700             CONTINUE                                                     
044800         WHEN OTHER                                                       
044900            MOVE '8020-RECEIVE-MAP'      TO DP013-PARAGRAPH               
045000            MOVE 'DLKRF452 - UNABLE TO RECEIVE MAP'                       
045100                                         TO DP013-MESSAGE-TEXT (1)        
045200            SET DP013-LOGIC-ABEND        TO TRUE                          
045300            SET DP013-ROLLBACK           TO TRUE                          
045400            PERFORM 9999-WRITE-DP013-MESSAGE                              
045500     END-EVALUATE.                                                        
045600                                                                          
045700 8100-RETURN-TRANID.                                                      
045800                                                                          
045900     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH               
046000     EXEC CICS                                                            
046100         RETURN TRANSID  (PC-TRANID)                                      
046200                COMMAREA (DL010-COMMAREA)                                 
046300                LENGTH   (PV-COMMAREA-LENGTH)                             
046400                RESP     (PV-CICS-RESPONSE)                               
046500     END-EXEC.                                                            
046600                                                                          
046700     EVALUATE TRUE                                                        
046800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
046900             CONTINUE                                                     
047000         WHEN OTHER                                                       
047100             MOVE '8100-RETURN-TRANIND' TO DP013-PARAGRAPH                
047200             MOVE 'DLKRF452 - UNABLE TO RETURN TO TRANID'                 
047300                 TO DP013-MESSAGE-TEXT (1)                                
047400             SET DP013-CICS-ABEND       TO TRUE                           
047500             SET DP013-ROLLBACK         TO TRUE                           
047600             PERFORM 9999-WRITE-DP013-MESSAGE                             
047700     END-EVALUATE.                                                        
047800                                                                          
047900 8110-RETURN.                                                             
048000                                                                          
048100     EXEC CICS                                                            
048200         SEND FROM (PV-MESSAGE-AREA)                                      
048300              LENGTH (19)                                                 
048400              ERASE                                                       
048500     END-EXEC.                                                            
048600                                                                          
048700     EXEC CICS                                                            
048800         RETURN                                                           
048900     END-EXEC.                                                            
049000                                                                          
049100 8200-XCTL.                                                               
049200                                                                          
049300     MOVE DL010-HOST-SAVE-AREA        TO CA-SUWS001-COMMAREA              
049400     SET SU001-INITIALIZE-SCREEN      TO TRUE                             
049500     MOVE PC-CURRENT-PROGRAM-NAME TO SU001-LAST-PROGRAM.                  
049600     MOVE LENGTH OF CA-SUWS001-COMMAREA                                   
049700                                   TO PV-COMMAREA-LENGTH                  
049800     EXEC CICS                                                            
049900         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                            
050000               COMMAREA  (CA-SUWS001-COMMAREA)                            
050100               LENGTH    (PV-COMMAREA-LENGTH)                             
050200               RESP      (PV-CICS-RESPONSE)                               
050300     END-EXEC                                                             
050400                                                                          
050500     EVALUATE TRUE                                                        
050600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
050700             CONTINUE                                                     
050800         WHEN OTHER                                                       
050900             MOVE '8200-XCTL'         TO DP013-PARAGRAPH                  
051000             MOVE 'DLKRF452 - UNABLE TO XCTL TO PROGRAM: '                
051100                                      TO DP013-MESSAGE-TEXT (1)           
051200             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)           
051300             SET DP013-CICS-ABEND                                         
051400                 DP013-ROLLBACK       TO TRUE                             
051500             PERFORM 9999-WRITE-DP013-MESSAGE                             
051600             MOVE PC-TRANS-UNAVAILABLE-MSG                                
051700                                      TO ALINE5O                          
051800             SET DL010-PROCESS-SCREEN TO TRUE                             
051900*            MOVE DL010-MENU-PROGRAM  TO DL010-LAST-PROGRAM               
052000             PERFORM 8000-SEND-MAP                                        
052100             PERFORM 8100-RETURN-TRANID                                   
052200     END-EVALUATE.                                                        
052300                                                                          
052400 8201-XCTL-DL.                                                            
052500     SET DL010-INITIALIZE-SCREEN      TO TRUE.                            
052600     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM               
052700*                                        DL010-MENU-PROGRAM               
052800     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH               
052900                                                                          
053000     EXEC CICS                                                            
053100         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                            
053200               COMMAREA  (DL010-COMMAREA)                                 
053300               LENGTH    (PV-COMMAREA-LENGTH)                             
053400               RESP      (PV-CICS-RESPONSE)                               
053500     END-EXEC.                                                            
053600                                                                          
053700     EVALUATE TRUE                                                        
053800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
053900             CONTINUE                                                     
054000         WHEN OTHER                                                       
054100             MOVE '8201-XCTL-DL'      TO DP013-PARAGRAPH                  
054200             MOVE 'DLKRF452 - UNABLE TO XCTL TO PROGRAM: '                
054300                                      TO DP013-MESSAGE-TEXT (1)           
054400             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)           
054500             SET DP013-CICS-ABEND                                         
054600                 DP013-ROLLBACK       TO TRUE                             
054700             PERFORM 9999-WRITE-DP013-MESSAGE                             
054800             MOVE PC-TRANS-UNAVAILABLE-MSG                                
054900                                      TO ALINE5O                          
055000             SET DL010-PROCESS-SCREEN TO TRUE                             
055100*            MOVE DL010-MENU-PROGRAM  TO DL010-LAST-PROGRAM               
055200             PERFORM 8000-SEND-MAP                                        
055300             PERFORM 8100-RETURN-TRANID                                   
055400     END-EVALUATE.                                                        
055500                                                                          
055600                                                                          
055700 8210-XCTL-ERROR-SCREEN.                                                  
055800                                                                          
055900     IF NOT DL010-ABEND                                                   
056000         SET DL010-INITIALIZE-SCREEN  TO TRUE                             
056100     END-IF                                                               
056200                                                                          
056300     MOVE DFHEIBLK                    TO DL010-DFHEIBLK.                  
056400     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM.              
056500     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH               
056600     MOVE 'DLKRF456'                  TO PV-TRANSFER-PROGRAM              
056700     IF DL010-PGM-MSG-NBR = ZERO                                          
056800*        UNDEFINED ERROR                                                  
056900         MOVE 1                       TO DL010-PGM-MSG-NBR                
057000     END-IF                                                               
057100*                                                                         
057200     EXEC CICS                                                            
057300         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                            
057400               COMMAREA  (DL010-COMMAREA)                                 
057500               LENGTH    (PV-COMMAREA-LENGTH)                             
057600               RESP      (PV-CICS-RESPONSE)                               
057700     END-EXEC.                                                            
057800                                                                          
057900     EVALUATE TRUE                                                        
058000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
058100             CONTINUE                                                     
058200         WHEN OTHER                                                       
058300             MOVE '8210-XCTL-ERROR-SCREEN'                                
058400                                      TO DP013-PARAGRAPH                  
058500             MOVE 'DLKRF452 - UNABLE TO XCTL TO PROGRAM: '                
058600                                      TO DP013-MESSAGE-TEXT (1)           
058700             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)           
058800             SET DP013-CICS-ABEND                                         
058900                 DP013-ROLLBACK       TO TRUE                             
059000             PERFORM 9999-WRITE-DP013-MESSAGE                             
059100             MOVE PC-TRANS-UNAVAILABLE-MSG                                
059200                                      TO ALINE8O                          
059300             SET DL010-PROCESS-SCREEN TO TRUE                             
059400             PERFORM 8000-SEND-MAP                                        
059500             PERFORM 8100-RETURN-TRANID                                   
059600     END-EVALUATE.                                                        
059700/                                                                         
059800*                                                                         
059900 8220-XCTL-TO-HELP.                                                       
060000                                                                          
060100     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH               
060200                                                                          
060300     EXEC CICS                                                            
060400         XCTL                                                             
060500             PROGRAM   (PV-TRANSFER-PROGRAM)                              
060600             COMMAREA  (PC192-COMMAREA)                                   
060700             LENGTH    (PV-COMMAREA-LENGTH)                               
060800             RESP      (PV-CICS-RESPONSE)                                 
060900     END-EXEC.                                                            
061000                                                                          
061100     EVALUATE TRUE                                                        
061200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
061300              CONTINUE                                                    
061400         WHEN OTHER                                                       
061500             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH                  
061600             MOVE 'DLKRF452 - UNABLE TO XCTL TO PROGRAM: '                
061700                                      TO DP013-MESSAGE-TEXT (1)           
061800             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)           
061900             SET DP013-CICS-ABEND                                         
062000                 DP013-ROLLBACK       TO TRUE                             
062100             PERFORM 9999-WRITE-DP013-MESSAGE                             
062200             MOVE PC-TRANS-UNAVAILABLE-MSG                                
062300                                      TO ALINE5O                          
062400             SET DL010-PROCESS-SCREEN TO TRUE                             
062500             PERFORM 8000-SEND-MAP                                        
062600             PERFORM 8100-RETURN-TRANID                                   
062700     END-EVALUATE.                                                        
062800/                                                                         
062900 8600-CALL-DLKUT001.                                                      
063000                                                                          
063100     INITIALIZE DL003-ASGMT-COMMAREA                                      
063200     SET DL003-BY-USER-KEY            TO TRUE                             
063300     MOVE PV-USERID                   TO DL003-KEY-USER-ID                
063400                                         DL010-KEYED-USERID               
063500     MOVE 'DLKRF452'                  TO DL003-ORIG-CALLING-PGM-NM        
063600                                                                          
063700     CALL DL003-USER-PGM USING DFHEIBLK                                   
063800                               DL003-COMMAREA                             
063900                               DL003-ASGMT-COMMAREA                       
064000                                                                          
064100     EVALUATE TRUE                                                        
064200         WHEN DL003-SUCCESSFUL                                            
064300             EVALUATE TRUE                                                
064400                 WHEN DL003-ASGMT-FOUND                                   
064500                     SET DL010-ASSGMT-FOUND-YES                           
064600                                      TO TRUE                             
064700                 WHEN DL003-ASGMT-NOT-FOUND                               
064800                     SET DL010-ASSGMT-FOUND-NO                            
064900                                      TO TRUE                             
065000                     MOVE DL003-KEY-USER-ID                               
065100                                      TO AUSERO                           
065200*                    MOVE 'NO ACTIVE ASSGMT'                              
065300*                                     TO ALINE5O                          
065400*                    MOVE 'FOUND FOR ASSOCIATE'                           
065500*                                     TO ALINE6O                          
065600*                    MOVE 'F3-END'    TO ALINE8O                          
065700*                    SET PS-ERRORS-YES                                    
065800*                                     TO TRUE                             
065900                 WHEN DL003-ASGMT-MULT-FOUND                              
066000                     SET DL010-ASSGMT-FOUND-MULT                          
066100                                      TO TRUE                             
066200                     MOVE DL003-KEY-USER-ID                               
066300                                      TO DL010-KEYED-USERID               
066400                     MOVE 4           TO DL010-PGM-MSG-NBR                
066500                     MOVE SQLCODE     TO DL010-SQLCODE                    
066600                     PERFORM 8210-XCTL-ERROR-SCREEN                       
066700             END-EVALUATE                                                 
066800         WHEN DL003-SQL-CONTENTION                                        
066900             SET DL010-ASSGMT-FOUND-NO                                    
067000                                      TO TRUE                             
067100             MOVE DL003-ASGMT-SQLCODE TO PV-SQLCODE                       
067200             MOVE 1                   TO PV-ERROR-NBR                     
067300             MOVE DL003-ASGMT-SQLCODE TO PV-SQLCODE                       
067400             PERFORM 9903-WRITE-CICS-LOG                                  
067500             MOVE 2                   TO DL010-PGM-MSG-NBR                
067600                                         DL010-ERROR-NBR                  
067700             MOVE DL003-ASGMT-SQLCODE TO DL010-SQLCODE                    
067800             MOVE DL003-SQLCA         TO DL010-SQLCA                      
067900             MOVE 'D452'              TO DL010-TRAN-ID                    
068000             PERFORM 9000-SOFT-ABORT                                      
068100             PERFORM 8210-XCTL-ERROR-SCREEN                               
068200         WHEN DL003-SQL-ERROR                                             
068300             MOVE DL003-ASGMT-SQLCODE TO PV-SQLCODE                       
068400             MOVE 2                   TO PV-ERROR-NBR                     
068500                                         DL010-ERROR-NBR                  
068600             MOVE DL003-ASGMT-SQLCODE TO PV-SQLCODE                       
068700             PERFORM 9903-WRITE-CICS-LOG                                  
068800             MOVE 3                   TO DL010-PGM-MSG-NBR                
068900             MOVE SQLCODE             TO DL010-SQLCODE                    
069000             MOVE SQLCA               TO DL010-SQLCA                      
069100             PERFORM 8210-XCTL-ERROR-SCREEN                               
069200         WHEN DL003-CALLED-MODULE-FAILURE                                 
069300             MOVE DL003-ASGMT-SQLCODE TO PV-SQLCODE                       
069400             MOVE 3                   TO PV-ERROR-NBR                     
069500                                         DL010-ERROR-NBR                  
069600             PERFORM 9903-WRITE-CICS-LOG                                  
069700             MOVE DL003-ORIG-CALLING-PGM-NM                               
069800                                  TO DL010-ORIG-CALLING-PGM-NM            
069900             MOVE DL003-SQL-ERROR-PARA                                    
070000                                  TO DL010-SQL-ERROR-PARA                 
070100             MOVE DL003-CALL-MOD-FAIL-NM                                  
070200                                  TO DL010-CALL-MOD-FAIL-NM               
070300             MOVE DL003-CALL-MOD-FAIL-ERR-CDE                             
070400                                  TO DL010-CALL-MOD-FAIL-ERR-CDE          
070500*            MOVE DL003-SQLCA     TO SQLCA                                
070600             MOVE DL003-ASGMT-SQLCODE TO DL010-SQLCODE                    
070700             MOVE DL003-SQLCA         TO DL010-SQLCA                      
070800             MOVE 5               TO DL010-PGM-MSG-NBR                    
070900             PERFORM 8210-XCTL-ERROR-SCREEN                               
071000         WHEN DL003-INVALID-ACCESS                                        
071100             MOVE DL003-ASGMT-SQLCODE TO PV-SQLCODE                       
071200             MOVE 4                   TO PV-ERROR-NBR                     
071300                                         DL010-ERROR-NBR                  
071400             PERFORM 9903-WRITE-CICS-LOG                                  
071500             MOVE DL003-SQLCA         TO SQLCA                            
071600             MOVE '8600-LINK-DLKUT001' TO DP013-PARAGRAPH                 
071700             MOVE 'DLKRF452 - INVALID ACCESS ERROR: '                     
071800                                      TO DP013-MESSAGE-TEXT (1)           
071900             MOVE 'DLKUT001'          TO DP013-MESSAGE-TEXT (2)           
072000             SET DP013-CICS-ABEND                                         
072100                 DP013-ROLLBACK       TO TRUE                             
072200             PERFORM 9999-WRITE-DP013-MESSAGE                             
072300             MOVE PC-TRANS-UNAVAILABLE-MSG                                
072400                                      TO ALINE5O                          
072500             SET DL010-PROCESS-SCREEN TO TRUE                             
072600             PERFORM 8000-SEND-MAP                                        
072700             PERFORM 8100-RETURN-TRANID                                   
072800         WHEN OTHER                                                       
072900             MOVE DL003-ASGMT-SQLCODE TO PV-SQLCODE                       
073000             MOVE 5                   TO PV-ERROR-NBR                     
073100                                         DL010-ERROR-NBR                  
073200             PERFORM 9903-WRITE-CICS-LOG                                  
073300             MOVE 1                   TO DL010-PGM-MSG-NBR                
073400             MOVE DL003-ASGMT-SQLCODE TO DL010-SQLCODE                    
073500             MOVE DL003-SQLCA         TO DL010-SQLCA                      
073600             PERFORM 8210-XCTL-ERROR-SCREEN                               
073700     END-EVALUATE.                                                        
073800/                                                                         
073900 9000-SOFT-ABORT.                                                         
074000                                                                          
074100     EXEC CICS                                                            
074200         SYNCPOINT ROLLBACK                                               
074300     END-EXEC.                                                            
074400                                                                          
074500 9903-WRITE-CICS-LOG.                                                     
074600                                                                          
074700     EXEC CICS                                                            
074800         WRITEQ TD                                                        
074900             QUEUE  ('CSSL')                                              
075000             FROM   (PV-LOG-MSG)                                          
075100             RESP   (PV-CICS-RESPONSE)                                    
075200     END-EXEC.                                                            
075300                                                                          
075400 9999-WRITE-DP013-MESSAGE.                                                
075500                                                                          
075600     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.                   
075700     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.                  
075800     INITIALIZE DP013-SRC-TASK-NUMBER                                     
075900                DP013-STACK.                                              
076000     SET DP013-LINK-RETURN            TO TRUE.                            
076100                                                                          
076200     EXEC CICS                                                            
076300         LINK                                                             
076400             PROGRAM   (DP013-NAME)                                       
076500             COMMAREA  (DP013-PARAMETERS)                                 
076600             LENGTH    (DP013-LENGTH)                                     
076700     END-EXEC.                                                            
076800                                                                          
076900*----------------------------------------------------------------*        
077000*    ABEND PROCESSOR MODULE                                      *        
077100*----------------------------------------------------------------*        
077200                                                                          
077300*    COPY DPPD014.                                                        
077400                                                                          
