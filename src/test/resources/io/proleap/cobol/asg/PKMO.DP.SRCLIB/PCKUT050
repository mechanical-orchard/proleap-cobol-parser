000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'CHECK FOR INVENTORY STORES'.                              00020000
000300                                                                  00030000
000400 PROGRAM-ID.             PCKUT050.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060000
000700 DATE-WRITTEN            JULY 2005.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000 ENVIRONMENT DIVISION.                                            00100000
001100 CONFIGURATION SECTION.                                           00110000
001200                                                                  00120000
001300 SOURCE-COMPUTER.        IBM-3090.                                00130000
001400 OBJECT-COMPUTER.        IBM-3090.                                00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600 FILE-CONTROL.                                                    00160000
004600                                                                  00170006
004300     SELECT STORE-NBR-OUTPUT-FILE                                 00171006
004400         ASSIGN TO OUT01.                                         00172006
004600                                                                  00173006
001800 DATA DIVISION.                                                   00180000
001900 FILE SECTION.                                                    00190000
002000                                                                  00200000
005700 FD  STORE-NBR-OUTPUT-FILE                                        00201006
005800     RECORDING MODE IS F                                          00202006
005900     LABEL RECORDS ARE STANDARD                                   00203006
006000     BLOCK CONTAINS 0 RECORDS.                                    00204006
006100                                                                  00205006
006200 01  STORE-NBR-OUTPUT-RECORD        PIC X(80).                    00206006
006300                                                                  00207006
002100 WORKING-STORAGE SECTION.                                         00210000
002200                                                                  00220000
002300 01  PV-SYSIN-CARD.                                               00230000
002400     05  PV-SYSIN-DTE                 PIC X(10).                  00240000
002500     05  FILLER                       PIC X(70).                  00250000
002600                                                                  00260000
002700 01  PS-SWITCHES.                                                 00270000
006231     05  PS-END-CSR-SW                PIC X(01) VALUE 'N'.        00280006
006232         88  PS-END-CSR-YES                     VALUE 'Y'.        00290006
006233         88  PS-END-CSR-NO                      VALUE 'N'.        00300006
006231     05  PS-FIRST-RECORD-SW           PIC X(01) VALUE 'Y'.        00301007
006232         88  PS-FIRST-RECORD-YES                VALUE 'Y'.        00302006
006233         88  PS-FIRST-RECORD-NO                 VALUE 'N'.        00303006
003100     05  PS-INVENTORY-SW              PIC X(01) VALUE 'N'.        00310000
003200         88  PS-INVENTORY-YES                   VALUE 'Y'.        00320000
003300         88  PS-INVENTORY-NO                    VALUE 'N'.        00330000
003400                                                                  00340000
003500                                                                  00350000
003600 01  PC-CONSTANTS.                                                00360000
003700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00370000
003800                                                   'PCKUT050'.    00380000
003900     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00390000
004000                                                   'ILBOABN0'.    00400000
004100                                                                  00410000
004200 01  PV-MISC-STUFF.                                               00420000
004300     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    00430000
004400     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     00440000
004500     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      00450000
004600     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       00460000
004700                                                   COMP SYNC.     00470000
004800     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            00480000
006500     05  PV-STORE-RECS-READ           PIC 9(03) VALUE ZERO.       00481006
006500     05  PV-STORE-RECS-WRITTEN        PIC 9(03) VALUE ZERO.       00481106
006500     05  PV-STORE-NBR-N               PIC 9(04) VALUE ZERO.       00482006
006500     05  PV-STORE-NBR-ZZZ9            PIC ZZZ9.                   00483006
004900     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.     00490000
005000     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.     00500000
005100                                                                  00510000
013800***************************************************************** 00511006
013800*    OUTPUT FILE RECORD                                           00512006
013800***************************************************************** 00513006
008000 01  OUT-OUTPUT-FILE-RECORD.                                      00514006
013700     05  FILLER                       PIC X(17) VALUE SPACES.     00515006
013700     05  OUT-STORE-NBR                PIC X(05) VALUE SPACES.     00516006
013700     05  FILLER                       PIC X(58) VALUE SPACES.     00517006
014800                                                                  00518006
005200 01  ABEND-CODE                       PIC S9(04)     VALUE +0     00520000
005300                                                     COMP SYNC.   00530000
005400     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00540000
005500     88  ABEND-4002-READ-ERROR                       VALUE +4002. 00550000
005600     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00560000
005700     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00570000
005800     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00580000
005900     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00590000
006000     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00600000
006100     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 00610000
006200     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 00620000
006300     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00630000
006400                                                                  00640000
006500     COPY DPWS004.                                                00650000
006600                                                                  00660000
006700*    XLT_MDSE_INV_PARM                                            00670000
006800     EXEC SQL                                                     00680000
006900         INCLUDE XLT00025                                         00690000
007000     END-EXEC.                                                    00700000
007100                                                                  00710000
007200*    XLT_LOC                                                      00720000
007300     EXEC SQL                                                     00730000
007400         INCLUDE XLT00010                                         00740000
007500     END-EXEC.                                                    00750000
007600                                                                  00760000
007700     EXEC SQL                                                     00770000
007800         INCLUDE SQLCA                                            00780000
007900     END-EXEC.                                                    00790000
008000                                                                  00800000
008001     COPY SQLCA2.                                                 00800104
008002                                                                  00800202
008010     EXEC SQL                                                     00801002
008020         DECLARE INV-LOC-CSR CURSOR FOR                           00802002
008030         SELECT                                                   00803004
008040              P.LOC_NBR                                           00804004
008060         FROM                                                     00806002
008070              XLT_MDSE_INV_PARM P                                 00807004
008080            , XLT_LOC           L                                 00808004
008090         WHERE                                                    00809002
008091              PLND_INV_DTE       = :PV-SYSIN-DTE                  00809104
008092          AND P.LOC_NBR          = L.LOC_NBR                      00809204
008093          AND P.ACTV_IND         = 'Y'                            00809304
008094          AND P.LOC_INV_STAT_CDE = 'IN'                           00809404
008095          AND L.LOC_TYP_CDE      = 'DS'                           00809504
008100          AND                                                     00810002
008101            (                                                     00810102
008102             (SCHD_PHY_CNT_CDE   = 'PI'                           00810204
008104              AND SCN_INV_IND    = 'Y')                           00810404
008106          OR                                                      00810604
008108             (L.E_BUS_IND        = 'Y'                            00810804
008109              AND L.LOC_TYP_CDE  = 'DS')                          00810904
008110            )                                                     00811004
008111         ORDER BY                                                 00811104
008112              LOC_NBR                                             00811204
008113     END-EXEC.                                                    00811302
008200/                                                                 00820000
008300 PROCEDURE DIVISION.                                              00830000
008400                                                                  00840000
008500     PERFORM 1000-INITIALIZE.                                     00850006
008600                                                                  00860000
010410     PERFORM 7000-OPEN-CSR.                                       00861006
008600                                                                  00861106
010420     PERFORM 7010-FETCH-CSR.                                      00862006
008600                                                                  00862106
010430     PERFORM 2000-PROCESS-STORE-RECS                              00863006
               UNTIL PS-END-CSR-YES.                                    00863106
008600                                                                  00863206
010492     PERFORM 7020-CLOSE-CSR                                       00869206
010600                                                                  00869306
010700     IF PS-INVENTORY-NO                                           00869406
010800         MOVE 1                       TO RETURN-CODE              00869506
010900         DISPLAY '**** NO STORES DOING INVENTORY TODAY ****'      00869606
011000     ELSE                                                         00869706
011100         DISPLAY '**** STORES ARE DOING INVENTORY TODAY ****'     00869806
011200     END-IF.                                                      00869906
024200                                                                  00870006
024100     PERFORM 3000-TERMINATE.                                      00870106
024200                                                                  00870206
008700     GOBACK.                                                      00871000
008800/                                                                 00880000
008900 1000-INITIALIZE.                                                 00890006
009000     MOVE '1000-INITIALIZE'               TO PV-ABEND-PARAGRAPH.  00900006
009200                                                                  00920000
020200     OPEN OUTPUT STORE-NBR-OUTPUT-FILE.                           00921006
009200                                                                  00922006
009300     ACCEPT PV-SYSIN-CARD FROM SYSIN                              00930000
009400     IF PV-SYSIN-CARD = LOW-VALUES OR SPACES                      00940000
009500         DISPLAY ALL '!'                                          00950000
009600         DISPLAY ' DATE CARD IS MISSING - JOB GO BOOM'            00960000
009700         DISPLAY SPACES                                           00970000
009800         PERFORM 9200-CROAK                                       00980000
009900     ELSE                                                         00990000
010000         DISPLAY 'PCKUT050 - DATE IS ' PV-SYSIN-DTE               01000000
010100     END-IF.                                                      01010006
010200                                                                  01020000
011300/                                                                 01130000
008900 2000-PROCESS-STORE-RECS.                                         01140006
017220                                                                  01141006
017230     MOVE '2000-PROCESS-STORE-RECS'   TO PV-ABEND-PARAGRAPH.      01142006
017220                                                                  01146106
015500     INITIALIZE OUT-OUTPUT-FILE-RECORD.                           01146206
032500     MOVE XLT00025-LOC-NBR            TO PV-STORE-NBR-N.          01146306
                                                                        01146406
080100     IF  PS-FIRST-RECORD-YES                                      01146506
080100         SET PS-FIRST-RECORD-NO                                   01146606
080100             PS-INVENTORY-YES         TO TRUE                     01146706
080100         MOVE PV-STORE-NBR-N          TO PV-STORE-NBR-ZZZ9        01146806
080100         STRING ' '                    DELIMITED BY SIZE          01146906
080100                PV-STORE-NBR-ZZZ9      DELIMITED BY SIZE          01147006
080100                                    INTO OUT-STORE-NBR            01147106
080100     ELSE                                                         01147206
080100         MOVE PV-STORE-NBR-N          TO PV-STORE-NBR-ZZZ9        01147306
080100         STRING ','                    DELIMITED BY SIZE          01147406
080100                PV-STORE-NBR-ZZZ9      DELIMITED BY SIZE          01147506
080100                                    INTO OUT-STORE-NBR            01147606
080100     END-IF.                                                      01147706
032600                                                                  01147806
032700     PERFORM 8000-WRITE-STORE-OUTPUT.                             01147906
010480                                                                  01148006
010490     PERFORM 7010-FETCH-CSR.                                      01149006
011300/                                                                 01150006
032000******************************************************************01160006
032100*  CLOSE FILES AND DISPLAY TOTALS OF RECORDS PROCESSED           *01170006
032200******************************************************************01180006
032300 3000-TERMINATE.                                                  01190006
032400                                                                  01200006
020200     CLOSE STORE-NBR-OUTPUT-FILE.                                 01220006
032400                                                                  01230006
032400     IF  PS-INVENTORY-YES                                         01250006
032400         DISPLAY '**'                                             01250106
032400         DISPLAY '** STORE RECORDS READ...: '                     01251006
                       PV-STORE-RECS-READ                               01252006
032400         DISPLAY '** STORE RECORDS WRITTEN: '                     01260006
                       PV-STORE-RECS-WRITTEN                            01260106
032400     END-IF.                                                      01261006
032400                                                                  01270006
011300/                                                                 01271006
017210 7000-OPEN-CSR.                                                   01721003
017220                                                                  01722003
017230     MOVE '7000-OPEN-CSR'             TO PV-ABEND-PARAGRAPH.      01723003
017240                                                                  01724003
017250     EXEC SQL                                                     01725003
017260         OPEN INV-LOC-CSR                                         01726003
017270     END-EXEC                                                     01727003
017280                                                                  01728003
017290     EVALUATE TRUE                                                01729003
017291         WHEN SQLCODE = ZERO                                      01729103
017292                 CONTINUE                                         01729203
017293         WHEN SQLCODE = -904                                      01729303
017294         WHEN SQLCODE = -911                                      01729403
017295         WHEN SQLCODE = -913                                      01729503
017296             PERFORM 9900-SQL-ERROR                               01729603
017297                                                                  01729703
017298         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  01729803
017299             DISPLAY '**************************************'     01729903
017300             DISPLAY 'WARNING ISSUED '                            01730003
017301             DISPLAY 'OPEN CURSOR                           '     01730103
017302             DISPLAY '**************************************'     01730203
017303             PERFORM 9800-SQL-WARNING                             01730303
017304                                                                  01730403
017305         WHEN SQLCODE < ZERO                                      01730503
017306             DISPLAY '**************************************'     01730603
017307             DISPLAY 'ERROR ISSUED ON                       '     01730703
017308             DISPLAY 'OPEN CURSOR                           '     01730803
017309             DISPLAY '**************************************'     01730903
017310             PERFORM 9900-SQL-ERROR                               01731003
017311                                                                  01731103
017312     END-EVALUATE.                                                01731203
017313                                                                  01731303
017314 7010-FETCH-CSR.                                                  01731403
017315                                                                  01731503
017316     MOVE '7010-FETCH-CSR'          TO PV-ABEND-PARAGRAPH.        01731603
017317                                                                  01731703
017318     EXEC SQL                                                     01731803
017319         FETCH INV-LOC-CSR                                        01731903
017320         INTO                                                     01732003
017321             :XLT00025-LOC-NBR                                    01732103
017323     END-EXEC                                                     01732303
017324                                                                  01732403
017325     EVALUATE TRUE                                                01732503
017326         WHEN SQLCODE = ZERO                                      01732603
017327             ADD 1                    TO PV-STORE-RECS-READ       01732706
017328         WHEN SQLCODE = +100                                      01732803
017329             SET PS-END-CSR-YES       TO TRUE                     01732903
017330         WHEN SQLCODE = -904                                      01733003
017331         WHEN SQLCODE = -911                                      01733103
017332         WHEN SQLCODE = -913                                      01733203
017333             PERFORM 9900-SQL-ERROR                               01733303
017334                                                                  01733403
017335         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  01733503
017336             DISPLAY '**************************************'     01733603
017337             DISPLAY 'WARNING ISSUED '                            01733703
017338             DISPLAY 'FETCH CURSOR                          '     01733803
017339             DISPLAY 'XLT_MDSE_INV_PARM                     '     01733903
017340             DISPLAY '**************************************'     01734003
017341             PERFORM 9800-SQL-WARNING                             01734103
017342                                                                  01734203
017343         WHEN SQLCODE < ZERO                                      01734303
017344             DISPLAY '**************************************'     01734403
017345             DISPLAY 'ERROR ISSUED ON                       '     01734503
017346             DISPLAY 'FETCH CURSOR                          '     01734603
017347             DISPLAY 'XLT_MDSE_INV_PARM                     '     01734703
017348             DISPLAY '**************************************'     01734803
017349             PERFORM 9900-SQL-ERROR                               01734903
017350                                                                  01735003
017351     END-EVALUATE.                                                01735103
017352                                                                  01735203
017353 7020-CLOSE-CSR.                                                  01735303
017354                                                                  01735403
017355     MOVE '7020-CLOSE-CSR'          TO PV-ABEND-PARAGRAPH.        01735503
017356                                                                  01735603
017357     EXEC SQL                                                     01735703
017358         CLOSE INV-LOC-CSR                                        01735803
017359     END-EXEC                                                     01735903
017360                                                                  01736003
017361     EVALUATE TRUE                                                01736103
017362         WHEN SQLCODE = ZERO                                      01736203
017363                 CONTINUE                                         01736303
017364         WHEN SQLCODE = -904                                      01736403
017365         WHEN SQLCODE = -911                                      01736503
017366         WHEN SQLCODE = -913                                      01736603
017367             PERFORM 9900-SQL-ERROR                               01736703
017368                                                                  01736803
017369         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  01736903
017370             DISPLAY '**************************************'     01737003
017371             DISPLAY 'WARNING ISSUED '                            01737103
017372             DISPLAY 'CLOSE CURSOR                          '     01737203
017373             DISPLAY '**************************************'     01737303
017374             PERFORM 9800-SQL-WARNING                             01737403
017375                                                                  01737503
017376         WHEN SQLCODE < ZERO                                      01737603
017377             DISPLAY '**************************************'     01737703
017378             DISPLAY 'ERROR ISSUED ON                       '     01737803
017379             DISPLAY 'CLOSE CURSOR                          '     01737903
017380             DISPLAY '**************************************'     01738003
017381             PERFORM 9900-SQL-ERROR                               01738103
017382                                                                  01738203
017383     END-EVALUATE.                                                01738303
002800                                                                  01738406
051200***************************************************************** 01738506
051200*  WRITE A RECORD TO THE STORE NUMBER OUTPUT FILE                 01738606
051200***************************************************************** 01738706
050800 8000-WRITE-STORE-OUTPUT.                                         01738806
002800                                                                  01739206
050900     WRITE STORE-NBR-OUTPUT-RECORD                                01739306
               FROM OUT-OUTPUT-FILE-RECORD.                             01739406
051000                                                                  01739506
051100     ADD 1                TO PV-STORE-RECS-WRITTEN.               01739606
002800                                                                  01739706
017390 9100-SQL-ABEND.                                                  01739800
017400******************************************************************01740000
017500*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    01750000
017600*  ERROR OR WARNING CODE OCCURS.                                  01760000
017700******************************************************************01770000
020200     CLOSE STORE-NBR-OUTPUT-FILE.                                 01771006
032400                                                                  01772006
017800     DISPLAY '9100-SQL-ABEND'.                                    01780000
017900     DISPLAY '** ABEND     **'.                                   01790000
018000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01800000
018100     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             01810000
018200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     01820000
018300     DISPLAY '**              ** = '                              01830000
018400     MOVE SQLCODE TO PV-SQL-CODE.                                 01840000
018500     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    01850000
018600     MOVE +4013 TO PV-ABEND-CODE.                                 01860000
018700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         01870000
018800                                                                  01880000
018900 9200-CROAK.                                                      01890000
019000******************************************************************01900000
019100*  PERFORMS THE ABEND FOR THE PROGRAM                             01910000
019200******************************************************************01920000
020200     CLOSE STORE-NBR-OUTPUT-FILE.                                 01921006
032400                                                                  01922006
019300     DISPLAY '9200-CROAK'.                                        01930000
019400     DISPLAY '** ABEND     **'.                                   01940000
019500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01950000
019600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             01960000
019700     DISPLAY '**              ** = '                              01970000
019800     MOVE +4013 TO PV-ABEND-CODE.                                 01980000
019900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         01990000
020000                                                                  02000000
020100******************************************************************02010000
020200*  THIS MODULE PERFORMS THE SQL WARNING.                         *02020000
020300******************************************************************02030000
020400                                                                  02040000
020500 9800-SQL-WARNING.                                                02050000
020600                                                                  02060000
020200     CLOSE STORE-NBR-OUTPUT-FILE.                                 02061006
032400                                                                  02062006
020700     MOVE SQLCODE               TO SQLCODE2.                      02070000
020800     MOVE SQLERRD(3)            TO SQLERRD3.                      02080000
020900     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02090000
021000     DISPLAY '** PROGRAM        ** = PCKUT050'.                   02100000
021100     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        02110000
021200     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02120000
021300     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02130000
021400                                                                  02140000
021500     COPY DPPD004.                                                02150000
021600     SET ABEND-4013-DB2-ERROR   TO TRUE                           02160000
021700     CALL 'ILBOABN0' USING ABEND-CODE.                            02170000
021800/                                                                 02180000
021900******************************************************************02190000
022000* THIS MODULE PERFORMS THE SQL ERROR.                            *02200000
022100******************************************************************02210000
022200                                                                  02220000
022300 9900-SQL-ERROR.                                                  02230000
022400                                                                  02240000
020200     CLOSE STORE-NBR-OUTPUT-FILE.                                 02241006
032400                                                                  02242006
022500     MOVE SQLCODE               TO SQLCODE2.                      02250000
022600     MOVE SQLERRD(3)            TO SQLERRD3.                      02260000
022700     DISPLAY '** ABEND **       ** = SQLERROR'.                   02270000
022800     DISPLAY '** PROGRAM        ** = PCKUT050'.                   02280000
022900     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        02290000
023000     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION         02300000
023100     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1       02310000
023200     DISPLAY SPACES                                               02320000
023300                                                                  02330000
023400     COPY DPPD004.                                                02340000
023500     SET ABEND-4013-DB2-ERROR   TO TRUE                           02350000
023600     CALL 'ILBOABN0' USING ABEND-CODE.                            02360000
