000100*-----------------------*                                         00010032
000200 IDENTIFICATION DIVISION.                                         00020032
000300*-----------------------*                                         00030032
000400 PROGRAM-ID.    APKCS321.                                         00040032
000500 AUTHOR.        PAM VOLK                                          00050032
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060032
000700 DATE-WRITTEN.  11-12-96.                                         00070032
000800 DATE-COMPILED.                                                   00080032
000900                                                                  00090032
001000*----------------------------------------------------------------*00100032
001100*    A321 - ACCOUNTS PAYABLE ALLOWANCE/CHARGE INQUIRY            *00110032
001200*                                                                *00120032
001300*    CICS ARCHITECTUURE W/SQL                                    *00130032
001400*    THIS PROGRAM WAS REWRITTEN TO ALLOW SCROLLING.              *00140032
001500*----------------------------------------------------------------*00150032
001600*  CHANGE LOG                                                    *00160032
001700*  ----------                                                    *00170032
001800*   5/27/97  CALC INVOICE AMOUNT SUBTRACTS ALLOWANCES THAT ARE   *00180032
001900*            AMOUNTS, BUT NOT %'S. A NEW COLUMN WAS ADDED TO THE *00190032
002000*            TINVOIC TBL TO HOLD NET AMOUNT. IF THAT AMT IS ZERO *00200032
002100*            AND THE STATUS ISN'T 'OB', WE USE THE CALC AMOUNT.  *00210032
002200*             BY: CHRIS KUNSTMANN                WR4164          *00220032
002300*                                                                *00230032
002400*   8/25/97  ADDED TEXTENT TBL FOR THE REMIT TO VENDOR NAME.     *00240032
002500*            CHANGES IN 1150- & 4001- PARAGRAPH. MADE AMT FIELD  *00250032
002600*            9(8)V99, USED TO BE 9(4)V99.                        *00260032
002700*             BY: CHRIS KUNSTMANN                WR4164          *00270032
002800*                                                                *00280032
002900*   9/20/01  ADDED A NEW LITERAL DESCRIPTION OF THE INVOICE      *00290032
003000*            STATUS.  THE LITERAL IS 'PR' AND THE DESCRIPTION IS *00300032
003100*            'PENDING RVW'.  MODIFIED PARA 4400-.                *00310032
003200*             BY: MIKE BESKE                     WR: 20530       *00320032
003300*                                                                *00330034
003400*   5/22/02  RECOMPILED TO PICK UP NEW DCLGENS FOR TINVOIC,      *00340034
003500*            TMDINVC AND TEXINVC AS PART OF THE ARK PO PHASE ONE *00350034
003600*            PROJECT.                                            *00360034
003700*             BY: MIKE BESKE                     WR: 23500       *00370034
003800*                                                                *00380034
003900*   6/17/02  ELIMINATED TABLE TPAYREQ.  MODIFIED SQL ACCESSING   *00390039
004000*            TINVOIC TO USE ITS NEW INDEX, PO_NBR/INVC_ID.       *00400039
004100*            PARAGRAPH AFFECTED WAS 1150-GET-INVOICE.            *00410039
004200*             BY: NANCY EILBES                   WR: 23500       *00420039
004300*                                                                *00430039
004400*  08/24/02  ARK PO PROJECT PHASE 2.  REPLACED PAYT_REQ_SEQ_NBR  *00440044
004500*            IN TALCHRG-CSR WHERE CONDITION WITH PO_NBR AND      *00450040
004600*            INVC_ID.                                            *00460040
004700*       BY:  KEVIN CATLIN                   WR #: 23500          *00470042
004800*                                                                *00480040
004900*  11/04/02  COLBY DATING PROJECT.  ADDED THE NEW STATUS DESC FOR*00490046
005000*            'PJ'.                                               *00500045
005100*       BY:  MIKE BESKE                     WR #: 23750          *00510045
005101*                                                                *00510151
005110*  03/11/07  MBDC PROJECT. RECOMPILE                             *00511048
005130*       BY:  GREG WISIALOWSKI               WR #: 21578          *00513047
005200*                                                                *00520045
005210*  07/20/16  THE LENGTH OF THE PO NUMBER IN MAP APKM321 WAS SET  *00521052
005211*            TO 7, INSTEAD OF 9. THE PO NUMBER WAS GETTING       *00521150
005212*            TRUNCATED ON THE SCREEN BECAUSE OF THIS, SO THE MAP *00521250
005213*            WAS CHANGED AND THE PROGRAM WAS RECOMPILED FOR THE  *00521350
005214*            SAME.                                               *00521450
005220*       BY:  SRINATH(COGNIZANT)             WR #: CHG0146972     *00522050
005221*                                                                *00522153
005230*  09/01/2021 GERMAN BANDA                  WR/IR #: CHG0261053  *00523055
005240*            - CHANGE CALL OF 'DPKUT100' TO                      *00524053
005250*              CALL DP010I-NUMERIC-EDIT-ROUTINE                  *00525053
005260*              MAKING THE CALL DYNAMIC VS STATIC                 *00526053
005270*                                                                *00527053
005280* 10/21/2022 BOB MCASEY                      WR/IR #: CHG0      * 00528057
005290*            - CICS ARCHITECTURE CHANGES                        * 00529058
005291*              ADD DPWS930 AND CHANGED THE CALL                 * 00529158
005292*              TO THE CICS API TO DP930-CICS-ARCH-API           * 00529258
005293*                                                               * 00529358
005300*----------------------------------------------------------------*00530032
005400                                                                  00540032
005500 ENVIRONMENT DIVISION.                                            00550032
005600                                                                  00560032
005700 DATA DIVISION.                                                   00570032
005800                                                                  00580032
005900 WORKING-STORAGE SECTION.                                         00590032
006000                                                                  00600032
006100 01  PC-PROGRAM-CONSTANTS.                                        00610032
006200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00620032
006300                                                    'AP321A  '.   00630032
006400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00640032
006500                                                    'APKM321 '.   00650032
006600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00660032
006700                                                    'APKCS321'.   00670032
006800     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 1.      00680032
006900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00690032
007000                                                    COMP SYNC.    00700032
007100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00710032
007200                                                    COMP SYNC.    00720032
007300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00730032
007400                                                    +1000025      00740032
007500                                                    COMP-3.       00750032
007600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00760032
007700                                                    COMP SYNC.    00770032
007800                                                                  00780032
007900 01  PC-TSYMSG-NUMBERS.                                           00790032
008000     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00800032
008100     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00810032
008200     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00820032
008300     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00830032
008400     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00840032
008500     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00850032
008600     05  PC-TSYMSG-00852                PIC 9(5)    VALUE 00852.  00860032
008700     05  PC-TSYMSG-00855                PIC 9(5)    VALUE 00855.  00870032
008800                                                                  00880032
008900 01  PS-PROGRAM-SUBSCRIPTS.                                       00890032
009000     05  PS-SUB                         PIC S9(04)   VALUE +0     00900032
009100                                                     COMP SYNC.   00910032
009200                                                                  00920032
009300 01  PS-PROGRAM-SWITCHES.                                         00930032
009400     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00940032
009500         88  PS-NO-ERROR                             VALUE 'Y'.   00950032
009600         88  PS-ERROR                                VALUE 'N'.   00960032
009700     EJECT                                                        00970032
009800 01  PV-PROGRAM-VARIABLES.                                        00980032
009900     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     00990032
010000                                                     COMP SYNC.   01000032
010100     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01010032
010200                                                     COMP-3.      01020032
010300     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01030032
010400                                                     COMP-3.      01040032
010500     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01050032
010600                                                     COMP-3.      01060032
010700     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01070032
010800                                                     COMP SYNC.   01080032
010900     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01090032
011000                                                     COMP SYNC.   01100032
011100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01110032
011200                                                     COMP SYNC.   01120032
011300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01130032
011400                                                     COMP SYNC.   01140032
011500     05  PV-PO-NBR-LOW            PIC S9(09)  VALUE +0            01150032
011600                                              COMP SYNC.          01160032
011700     05  PV-PO-NBR-HIGH           PIC S9(09)  VALUE +0            01170032
011800                                              COMP SYNC.          01180032
011900     05  PV-CHRG-AMT              PIC  9(08)V99.                  01190032
012000     05  PV-AMT-DIS               PIC ZZZZZZZ9.99.                01200032
012100     05  PV-PCT-DIS               PIC Z9.99.                      01210032
012200     05  PV-8V99                  PIC Z(8).99.                    01220032
012300     05  PV-8V99-X REDEFINES                                      01230032
012400         PV-8V99                  PIC X(11).                      01240032
012500                                                                  01250032
012600                                                                  01260032
012700 EJECT                                                            01270032
012800*---------------------------------------------------------------* 01280032
012900*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 01290032
013000*---------------------------------------------------------------* 01300032
013100                                                                  01310032
013200     COPY DPWS030.                                                01320032
013210     COPY DPWS930.                                                01321058
013300 EJECT                                                            01330032
013400*---------------------------------------------------------------* 01340032
013500*    STANDARD COMMAREA.                                         * 01350032
013600*---------------------------------------------------------------* 01360032
013700                                                                  01370032
013800     COPY DPWS020.                                                01380032
013900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01390032
014000                                                                  01400032
014100*---------------------------------------------------------------* 01410032
014200*    INTER-APPLICATION COMMAREA.                                * 01420032
014300*---------------------------------------------------------------* 01430032
014400                                                                  01440032
014500         10  INTER-APPL-COMM-AREA       PIC X(200).               01450032
014600     COPY APWS300.                                                01460032
014700*---------------------------------------------------------------* 01470032
014800*    SPECIFIC COMMMAREA FOR APKCS321.                           * 01480032
014900*---------------------------------------------------------------* 01490032
015000         10  ASC-SPECIFIC-COMMAREA.                               01500032
015100             15  ASC-SAVE-PO-NBR           PIC S9(09) COMP.       01510032
015200             15  ASC-SAVE-INVC-ID          PIC  X(22).            01520032
015300             15  ASC-SAVE-ENTR-MTHD-CDE    PIC  X(02).            01530032
015400             15  ASC-SAVE-INVC-STATUS      PIC  X(02).            01540032
015500             15  ASC-SAVE-NET-INVC-AMT     PIC S9(11)V99 COMP-3.  01550032
015600             15  ASC-SAVE-GRO-COST-AMT     PIC S9(11)V99 COMP-3.  01560032
015700             15  ASC-SAVE-CALC-INVC-AMT    PIC S9(11)V99 COMP-3.  01570032
015800             15  ASC-TOT-CHARGES           PIC S9(11)V99 COMP-3.  01580032
015900             15  ASC-TOT-ALLOWS            PIC S9(11)V99 COMP-3.  01590032
016000             15  ASC-TOT-ALLOWS-AMT        PIC S9(11)V99 COMP-3.  01600032
016100             15  ASC-ENT-NAME              PIC  X(10).            01610032
016200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01620032
016300                 20  ASC-ITEM-ARRAY.                              01630032
016400                                                                  01640032
016500                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        01650032
016600                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   01660032
016700                                                     COMP-3.      01670032
016800                         30  ASC-AC-IND        PIC  X(01).        01680032
016900                         30  ASC-AC-CDE        PIC  X(03).        01690032
017000                         30  ASC-AC-PCT        PIC  X(05).        01700032
017100                         30  ASC-AC-PCT-N      PIC  9(02)V99.     01710032
017200                         30  ASC-AC-AMT        PIC  X(11).        01720032
017300                         30  ASC-AC-AMT-N      PIC  9(08)V99.     01730032
017400                         30  ASC-SS-CDE        PIC  X(10).        01740032
017500                         30  ASC-AC-SEQ-NBR    PIC S9(04) COMP.   01750032
017600                                                                  01760032
017700             15  ASC-BLK-SUB                         PIC S9(04)   01770032
017800                                                         COMP     01780032
017900                                                         SYNC.    01790032
018000             15  ASC-ITEM-SUB                        PIC S9(04)   01800032
018100                                                         COMP     01810032
018200                                                         SYNC.    01820032
018300             15  ASC-SEL-SUB                         PIC S9(04)   01830032
018400                                                         COMP.    01840032
018500             15  ASC-SEL-ITEM                        PIC S9(04)   01850032
018600                                                         COMP.    01860032
018700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   01870032
018800                                                         COMP-3.  01880032
018900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   01890032
019000                                                         COMP-3.  01900032
019100             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   01910032
019200                                                         COMP-3.  01920032
019300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   01930032
019400                                                         COMP-3.  01940032
019500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   01950032
019600                                                         COMP-3.  01960032
019700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   01970032
019800                                                         COMP-3.  01980032
019900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   01990032
020000                                                         COMP     02000032
020100                                                         SYNC.    02010032
020200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02020032
020300                                                         COMP-3.  02030032
020400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02040032
020500                                                         COMP-3.  02050032
020600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02060032
020700                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 02070032
020800                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 02080032
020900             15  ASC-DTL-QUEUE-NAME.                              02090032
021000                 20  ASC-DTL-TERM-ID                 PIC  X(04).  02100032
021100                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)   02110032
021200                                                         COMP-3.  02120032
021300                 20  ASC-DTL-SEQ                     PIC  9(01).  02130032
021400                                                                  02140032
021500             15  ASC-START-ITEM-REQUEST.                          02150032
021600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  02160032
021700                                                                  02170032
021800     EJECT                                                        02180032
021900*---------------------------------------------------------------* 02190032
022000*    ABEND PROCESSING COPYBOOK.                                 * 02200032
022100*---------------------------------------------------------------* 02210032
022200                                                                  02220032
022300     COPY DPWS013.                                                02230032
022400                                                                  02240032
022500     EJECT                                                        02250032
022600*---------------------------------------------------------------* 02260032
022700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02270032
022800*---------------------------------------------------------------* 02280032
022900                                                                  02290032
023000     COPY DPWS015.                                                02300032
023100                                                                  02310032
023200*---------------------------------------------------------------* 02320032
023300*    FUNCTION KEYS COPYBOOK.                                    * 02330032
023400*---------------------------------------------------------------* 02340032
023500                                                                  02350032
023600     COPY DPWS016.                                                02360032
023700                                                                  02370032
023800*---------------------------------------------------------------* 02380032
023900*    NUMERIC EDIT LAYOUT.                                       * 02390032
024000*---------------------------------------------------------------* 02400032
024100                                                                  02410032
024200     COPY DPWS010I.                                               02420032
024300                                                                  02430032
024400*---------------------------------------------------------------* 02440032
024500*    MAP LAYOUT                                                 * 02450032
024600*---------------------------------------------------------------* 02460032
024700                                                                  02470032
024800     COPY APKM321.                                                02480038
024900                                                                  02490032
025000 01  MR-OCCURS-LAYOUT          REDEFINES  AP321AO.                02500032
025100     05  FILLER                PIC X(194).                        02510048
025200     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02520032
025300         10  MR-AC-INDL                 PIC S9(04) COMP.          02530032
025400         10  MR-AC-INDA                 PIC  X(01).               02540032
025500         10  MR-AC-INDC                 PIC  X(01).               02550032
025600         10  MR-AC-INDH                 PIC  X(01).               02560032
025700         10  MR-AC-IND                  PIC  X(01).               02570032
025800                                                                  02580032
025900         10  MR-AC-CDEL                 PIC S9(04) COMP.          02590032
026000         10  MR-AC-CDEA                 PIC  X(01).               02600032
026100         10  MR-AC-CDEC                 PIC  X(01).               02610032
026200         10  MR-AC-CDEH                 PIC  X(01).               02620032
026300         10  MR-AC-CDE                  PIC  X(03).               02630032
026400                                                                  02640032
026500         10  MR-AC-PCTL                 PIC S9(04) COMP.          02650032
026600         10  MR-AC-PCTA                 PIC  X(01).               02660032
026700         10  MR-AC-PCTC                 PIC  X(01).               02670032
026800         10  MR-AC-PCTH                 PIC  X(01).               02680032
026900         10  MR-AC-PCT                  PIC  X(05).               02690032
027000                                                                  02700032
027100         10  MR-AC-AMTL                 PIC S9(04) COMP.          02710032
027200         10  MR-AC-AMTA                 PIC  X(01).               02720032
027300         10  MR-AC-AMTC                 PIC  X(01).               02730032
027400         10  MR-AC-AMTH                 PIC  X(01).               02740032
027500         10  MR-AC-AMT                  PIC  X(11).               02750032
027600                                                                  02760032
027700         10  MR-SS-CDEL                 PIC S9(04) COMP.          02770032
027800         10  MR-SS-CDEA                 PIC  X(01).               02780032
027900         10  MR-SS-CDEC                 PIC  X(01).               02790032
028000         10  MR-SS-CDEH                 PIC  X(01).               02800032
028100         10  MR-SS-CDE                  PIC  X(10).               02810032
028200                                                                  02820032
028300 EJECT                                                            02830032
028400*---------------------------------------------------------------* 02840032
028500*    DCLGEN AREA                                                * 02850032
028600*---------------------------------------------------------------* 02860032
028700*    DB2 AREA FOR TPURCHS (PURCHASE ORDER)                        02870032
028800                                                                  02880032
028900     EXEC SQL                                                     02890032
029000          INCLUDE TPURCHS                                         02900032
029100     END-EXEC.                                                    02910032
029200                                                                  02920032
029300*    DB2 AREA FOR TENTNME (ENTERPRISE NAME)                       02930032
029400                                                                  02940032
029500     EXEC SQL                                                     02950032
029600          INCLUDE TENTNME                                         02960032
029700     END-EXEC.                                                    02970032
029800                                                                  02980032
029900*    DB2 AREA FOR TEXTENT (ENTERPRISE ENTITY)                     02990032
030000                                                                  03000032
030100     EXEC SQL                                                     03010032
030200          INCLUDE TEXTENT                                         03020032
030300     END-EXEC.                                                    03030032
030400                                                                  03040032
030500*    DB2 AREA FOR TINVOIC (INVOICE)                               03050032
030600                                                                  03060032
030700     EXEC SQL                                                     03070032
030800          INCLUDE TINVOIC                                         03080032
030900     END-EXEC.                                                    03090032
031000                                                                  03100032
031100*    DB2 AREA FOR TALCHRG (ALLOWANCE CHARGE)                      03110032
031200                                                                  03120032
031300     EXEC SQL                                                     03130032
031400          INCLUDE TALCHRG                                         03140032
031500     END-EXEC.                                                    03150032
031600                                                                  03160032
031700*    DB2 AREA FOR TAPCNTL (AP CONTROL)                            03170032
031800                                                                  03180032
031900     EXEC SQL                                                     03190032
032000          INCLUDE TAPCNTL                                         03200032
032100     END-EXEC.                                                    03210032
032200                                                                  03220032
032300*---------------------------------------------------------------* 03230032
032400*    DB2 AREA FOR COMMUNICATIONS                                * 03240032
032500*---------------------------------------------------------------* 03250032
032600     EXEC SQL                                                     03260032
032700          INCLUDE SQLCA                                           03270032
032800     END-EXEC.                                                    03280032
032900                                                                  03290032
033000*---------------------------------------------------------------* 03300032
033100*    CURSOR AREA                                                * 03310032
033200*---------------------------------------------------------------* 03320032
033300                                                                  03330032
033400*    DB2 CURSOR DEFINE TALCHRG-CSR                                03340032
033500                                                                  03350032
033600     EXEC SQL                                                     03360032
033700          DECLARE AC-CSR CURSOR FOR                               03370032
033800          SELECT ALW_CHRG_SEQ_NBR                                 03380032
033900                ,ALW_CHRG_TYP_CDE                                 03390032
034000                ,ALW_CHRG_CDE                                     03400032
034100                ,ALW_CHRG_SER_CDE                                 03410032
034200                ,ALW_CHRG_PCT                                     03420032
034300                ,ALW_CHRG_AMT                                     03430032
034400          FROM   TALCHRG                                          03440032
034500          WHERE PO_NBR  = :ASC-SAVE-PO-NBR                        03450040
034600            AND INVC_ID = :ASC-SAVE-INVC-ID                       03460041
034700          ORDER BY ALW_CHRG_SEQ_NBR                               03470032
034800     END-EXEC.                                                    03480032
034900                                                                  03490032
035000 EJECT                                                            03500032
035100 LINKAGE SECTION.                                                 03510032
035200                                                                  03520032
035300 01  DFHCOMMAREA.                                                 03530032
035400     05  FILLER                         OCCURS  1 TO 4072 TIMES   03540032
035500                                        DEPENDING ON EIBCALEN.    03550032
035600         10  FILLER                     PIC X.                    03560032
035700                                                                  03570032
035800 EJECT                                                            03580032
035900 PROCEDURE DIVISION.                                              03590032
036000                                                                  03600032
036100 0000-MAIN-MODULE.                                                03610032
036200                                                                  03620032
036300     INITIALIZE DP030-CICS-API-FIELDS.                            03630032
036400     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        03640032
036500     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           03650032
036600     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          03660032
036700     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        03670032
036800     MOVE LENGTH OF AP321AI       TO DP030-MAP-LENGTH (1).        03680032
036900     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      03690032
037000     PERFORM 0001-CALL-CICS-ARCH-API.                             03700032
037100                                                                  03710032
037200     PERFORM 1000-CONTROL-PROCESSING.                             03720032
037300                                                                  03730032
037400     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      03740032
037500     PERFORM 0001-CALL-CICS-ARCH-API.                             03750032
037600                                                                  03760032
037700*----------------------------------------------------------------*03770032
037800*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *03780032
037900*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *03790032
038000*----------------------------------------------------------------*03800032
038100                                                                  03810032
038200 0001-CALL-CICS-ARCH-API.                                         03820032
038300                                                                  03830032
038400*    CALL 'DPKCS030' USING DFHEIBLK                               03840058
038410     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03841058
038500                                    DFHCOMMAREA                   03850057
038600                                    DP030-CICS-API-FIELDS         03860057
038700                                    DP020-STANDARD-COMMAREA       03870057
038800                                    AP321AI.                      03880057
038900                                                                  03890032
039000     IF  DP030-RC-CALL-SUCCESSFUL                                 03900032
039100         CONTINUE                                                 03910032
039200     ELSE                                                         03920032
039300         SET DP013-NO-ROLLBACK TO TRUE                            03930032
039400         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   03940032
039500         SET DP013-CICS-ABEND TO TRUE                             03950032
039600         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        03960032
039700*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03970057
039800*             'T LINE'         TO DP013-MESSAGE-TEXT (2)          03980057
039810         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03981058
039820-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03982058
039900         MOVE DP030-RETURN-CODE                                   03990032
040000                               TO DP013-MESSAGE-TEXT (3)          04000032
040100         PERFORM DP013-0000-PROCESS-ABEND                         04010032
040200     END-IF.                                                      04020032
040300                                                                  04030032
040400*----------------------------------------------------------------*04040032
040500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04050032
040600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04060032
040700*                                                                *04070032
040800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04080032
040900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04090032
041000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04100032
041100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04110032
041200*----------------------------------------------------------------*04120032
041300                                                                  04130032
041400 1000-CONTROL-PROCESSING.                                         04140032
041500                                                                  04150032
041600     EVALUATE TRUE                                                04160032
041700         WHEN DP020-NEXT-ACT-INITIAL                              04170032
041800             MOVE EIBTRMID          TO ASC-DTL-TERM-ID            04180032
041900             MOVE DP020-SRC-TASK-NUMBER                           04190032
042000                                    TO ASC-DTL-TASK-NUMBER        04200032
042100             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                04210032
042200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04220032
042300                                                                  04230032
042400             IF PS-NO-ERROR                                       04240032
042500                 PERFORM 2050-DELETE-DETAIL-QUEUE                 04250032
042600                 PERFORM 4000-BUILD-INITIAL-PANEL                 04260032
042700             END-IF                                               04270032
042800                                                                  04280032
042900         WHEN DP020-NEXT-ACT-READ-MAP                             04290032
043000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04300032
043100                               TO PV-TOP-ITEM                     04310032
043200             PERFORM 2000-PROCESS-PANEL                           04320032
043300                                                                  04330032
043400         WHEN DP020-NEXT-ACT-RETURN                               04340032
043500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04350032
043600                               TO PV-TOP-ITEM                     04360032
043700             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        04370032
043800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04380032
043900                                                                  04390032
044000         WHEN OTHER                                               04400032
044100             SET DP013-LOGIC-ABEND TO TRUE                        04410032
044200             SET DP013-NO-ROLLBACK TO TRUE                        04420032
044300             MOVE '1000-CONTROL-PROCESSING'                       04430032
044400                               TO  DP013-PARAGRAPH                04440032
044500             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04450032
044600                                   TO DP013-MESSAGE-TEXT(1)       04460032
044700             MOVE DP020-NEXT-APPL-ACTIVITY                        04470032
044800                                   TO DP013-MESSAGE-TEXT(2)       04480032
044900             PERFORM DP013-0000-PROCESS-ABEND                     04490032
045000     END-EVALUATE.                                                04500032
045100                                                                  04510032
045200 EJECT                                                            04520032
045300*----------------------------------------------------------------*04530032
045400*  DETERMINE THE KEY OF THE OBJECT TO BE USED BASED ON THE      **04540032
045500*  INTER-APPLICATION DATA.                                      **04550032
045600*----------------------------------------------------------------*04560032
045700                                                                  04570032
045800 1100-PROCESS-INTER-APPL-COMM.                                    04580032
045900                                                                  04590032
046000     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04600032
046100     MOVE SPACE                TO ASC-START-ITEM-REQUEST.         04610032
046200     MOVE AP300-INVC-ID            TO ASC-SAVE-INVC-ID.           04620032
046300     IF  AP300-PO-NBR > ZERO                                      04630032
046400         MOVE AP300-PO-NBR         TO PV-PO-NBR-LOW               04640032
046500                                      PV-PO-NBR-HIGH              04650032
046600     ELSE                                                         04660032
046700         MOVE 0                    TO PV-PO-NBR-LOW               04670032
046800         MOVE +999999999           TO PV-PO-NBR-HIGH              04680032
046900     END-IF.                                                      04690032
047000     PERFORM 1150-GET-INVOICE.                                    04700032
047100     IF SQLCODE = +0                                              04710032
047200         MOVE INVOIC-STATUS-CDE    TO ASC-SAVE-INVC-STATUS        04720032
047300         MOVE INVOIC-INVC-NET-COST-AMT                            04730032
047400                                   TO ASC-SAVE-NET-INVC-AMT       04740032
047500         MOVE INVOIC-GRO-COST-AMT  TO ASC-SAVE-GRO-COST-AMT       04750032
047600         MOVE INVOIC-PO-NBR        TO ASC-SAVE-PO-NBR             04760037
047700         MOVE SPACES               TO ASC-ENT-NAME                04770032
047800     ELSE                                                         04780032
047900         IF SQLCODE = -811                                        04790032
048000*            --  MULTIPLE INVOICES --                             04800032
048100             MOVE PC-TSYMSG-00852  TO DP020-MSG-NUMBER            04810032
048200             SET DP020-MSG-FATAL                                  04820032
048300                 DP020-NEXT-ACT-APPL-ERROR TO TRUE                04830032
048400         ELSE                                                     04840032
048500*            --  INVOICE NOT FOUND --                             04850032
048600             MOVE PC-TSYMSG-00855  TO DP020-MSG-NUMBER            04860032
048700             SET DP020-MSG-FATAL                                  04870032
048800                 DP020-NEXT-ACT-APPL-ERROR TO TRUE                04880032
048900         END-IF                                                   04890032
049000     END-IF.                                                      04900032
049100                                                                  04910032
049200                                                                  04920032
049300*----------------------------------------------------------------*04930032
049400* VALIDATE THAT THE INVOICE EXISTS                               *04940032
049500*----------------------------------------------------------------*04950032
049600 1150-GET-INVOICE.                                                04960032
049700                                                                  04970032
049800     EXEC SQL                                                     04980032
049900         SELECT PO_NBR                                            04990036
050000               ,RMIT_VND_ID                                       05000036
050100               ,STATUS_CDE                                        05010036
050200               ,ENTR_MTHD_CDE                                     05020036
050300               ,GRO_COST_AMT                                      05030036
050400               ,INVC_NET_COST_AMT                                 05040036
050500         INTO   :INVOIC-PO-NBR                                    05050036
050600               ,:INVOIC-RMIT-VND-ID                               05060036
050700               ,:INVOIC-STATUS-CDE                                05070032
050800               ,:INVOIC-ENTR-MTHD-CDE                             05080032
050900               ,:INVOIC-GRO-COST-AMT                              05090032
051000               ,:INVOIC-INVC-NET-COST-AMT                         05100032
051100         FROM   TINVOIC                                           05110036
051200         WHERE  INVC_ID = :ASC-SAVE-INVC-ID                       05120036
051300           AND  PO_NBR BETWEEN :PV-PO-NBR-LOW                     05130036
051400                           AND :PV-PO-NBR-HIGH                    05140036
051500     END-EXEC                                                     05150032
051600                                                                  05160032
051700     EVALUATE TRUE                                                05170032
051800         WHEN SQLCODE = ZERO                                      05180032
051900         WHEN SQLCODE = -811                                      05190032
052000         WHEN SQLCODE = +100                                      05200032
052100             CONTINUE                                             05210032
052200         WHEN SQLWARN0 NOT = SPACES                               05220032
052300         WHEN SQLCODE < ZERO                                      05230032
052400         WHEN SQLCODE > ZERO                                      05240032
052500             MOVE '1150-GET-INVOICE'                              05250032
052600                               TO DP013-PARAGRAPH                 05260032
052700             MOVE 'SELECT INVOICE'                                05270032
052800                               TO DP013-MESSAGE-TEXT (1)          05280032
052900             MOVE SQLCA        TO DP013-SQLCA                     05290032
053000             MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)        05300032
053100             MOVE SPACES       TO DP013-DB2-TABLE-NAME (2)        05310036
053200             SET DP013-DB2-ABEND                                  05320032
053300                 DP013-XCTL-DISPLAY-RESTART                       05330032
053400                               TO TRUE                            05340032
053500             PERFORM DP013-0000-PROCESS-ABEND                     05350032
053600     END-EVALUATE.                                                05360032
053700                                                                  05370032
053800                                                                  05380032
053900*----------------------------------------------------------------*05390032
054000*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *05400032
054100*    ON WHAT FUNCTION KEY WAS SELECTED.                          *05410032
054200*----------------------------------------------------------------*05420032
054300                                                                  05430032
054400 2000-PROCESS-PANEL.                                              05440032
054500                                                                  05450032
054600     EVALUATE TRUE                                                05460032
054700         WHEN DP020-SRC-AID = DP016-CLEAR                         05470032
054800             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05480032
054900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05490032
055000             PERFORM 3200-RESET-ATTRIBUTES                        05500032
055100                                                                  05510032
055200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05520032
055300             PERFORM 2050-DELETE-DETAIL-QUEUE                     05530032
055400             PERFORM 4000-BUILD-INITIAL-PANEL                     05540032
055500             PERFORM 3200-RESET-ATTRIBUTES                        05550032
055600                                                                  05560032
055700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05570032
055800             MOVE +1 TO PV-TOP-ITEM                               05580032
055900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05590032
056000             PERFORM 3200-RESET-ATTRIBUTES                        05600032
056100                                                                  05610032
056200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05620032
056300             PERFORM 2110-BROWSE-BACKWARD                         05630032
056400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05640032
056500             PERFORM 3200-RESET-ATTRIBUTES                        05650032
056600                                                                  05660032
056700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05670032
056800             PERFORM 2120-BROWSE-FORWARD                          05680032
056900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05690032
057000             PERFORM 3200-RESET-ATTRIBUTES                        05700032
057100                                                                  05710032
057200         WHEN DP020-SRC-AID = DP016-ENTER                         05720032
057300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05730032
057400             IF  PS-ERROR                                         05740032
057500                 CONTINUE                                         05750032
057600             ELSE                                                 05760032
057700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05770032
057800                 PERFORM 3200-RESET-ATTRIBUTES                    05780032
057900             END-IF                                               05790032
058000                                                                  05800032
058100         WHEN OTHER                                               05810032
058200             SET DP013-NO-ROLLBACK TO TRUE                        05820032
058300             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               05830032
058400             SET DP013-CICS-ABEND TO TRUE                         05840032
058500             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    05850032
058600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05860032
058700                                   TO DP013-MESSAGE-TEXT (1)      05870032
058800             PERFORM DP013-0000-PROCESS-ABEND                     05880032
058900                                                                  05890032
059000     END-EVALUATE.                                                05900032
059100 EJECT                                                            05910032
059200*----------------------------------------------------------------*05920032
059300*    DELETE THE TEMPORARY STORAGE QUEUE.                         *05930032
059400*----------------------------------------------------------------*05940032
059500                                                                  05950032
059600 2050-DELETE-DETAIL-QUEUE.                                        05960032
059700                                                                  05970032
059800     EXEC CICS                                                    05980032
059900         DELETEQ TS                                               05990032
060000             QUEUE (ASC-DTL-QUEUE-NAME)                           06000032
060100             RESP  (PV-CICS-RESP)                                 06010032
060200     END-EXEC.                                                    06020032
060300                                                                  06030032
060400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06040032
060500        (PV-CICS-RESP = DFHRESP(QIDERR))                          06050032
060600         CONTINUE                                                 06060032
060700     ELSE                                                         06070032
060800         SET DP013-CICS-ABEND TO TRUE                             06080032
060900         SET DP013-NO-ROLLBACK TO TRUE                            06090032
061000                                                                  06100032
061100         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       06110032
061200         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  06120032
061300                        TO DP013-MESSAGE-TEXT (1)                 06130032
061400         PERFORM DP013-0000-PROCESS-ABEND                         06140032
061500     END-IF.                                                      06150032
061600                                                                  06160032
061700     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        06170032
061800 EJECT                                                            06180032
061900*----------------------------------------------------------------*06190032
062000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06200032
062100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06210032
062200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06220032
062300*    MESSAGE.                                                    *06230032
062400*----------------------------------------------------------------*06240032
062500                                                                  06250032
062600 2110-BROWSE-BACKWARD.                                            06260032
062700                                                                  06270032
062800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06280032
062900         GIVING PV-TOP-ITEM.                                      06290032
063000                                                                  06300032
063100     IF  PV-TOP-ITEM < +1                                         06310032
063200         MOVE +1              TO PV-TOP-ITEM                      06320032
063300*        -- TOP OF LIST --                                        06330032
063400         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 06340032
063500         SET DP020-MSG-INFORMATIONAL TO TRUE                      06350032
063600     END-IF.                                                      06360032
063700                                                                  06370032
063800 EJECT                                                            06380032
063900                                                                  06390032
064000*----------------------------------------------------------------*06400032
064100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06410032
064200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06420032
064300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06430032
064400*----------------------------------------------------------------*06440032
064500                                                                  06450032
064600 2120-BROWSE-FORWARD.                                             06460032
064700                                                                  06470032
064800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06480032
064900         GIVING PV-TOP-ITEM.                                      06490032
065000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06500032
065100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06510032
065200                                   TO PV-TOP-ITEM                 06520032
065300*        -- BOTTOM OF LIST --                                     06530032
065400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06540032
065500         SET DP020-MSG-INFORMATIONAL                              06550032
065600                                   TO TRUE                        06560032
065700     ELSE                                                         06570032
065800         COMPUTE PV-BOTTOM-ITEM =                                 06580032
065900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06590032
066000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06600032
066100*            -- BOTTOM OF LIST --                                 06610032
066200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06620032
066300             SET DP020-MSG-INFORMATIONAL                          06630032
066400                                   TO TRUE                        06640032
066500         END-IF                                                   06650032
066600     END-IF.                                                      06660032
066700 EJECT                                                            06670032
066800*----------------------------------------------------------------*06680032
066900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06690032
067000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06700032
067100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06710032
067200*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *06720032
067300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06730032
067400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06740032
067500*----------------------------------------------------------------*06750032
067600                                                                  06760032
067700 2130-CHECK-FOR-JUMP-BROWSE.                                      06770032
067800                                                                  06780032
067900     IF ASTRTITL > ZERO                                           06790032
068000         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      06800032
068100     ELSE                                                         06810032
068200         IF ASTRTITF = DP015-ERASE-EOF                            06820032
068300             INITIALIZE ASC-START-ITEM-REQUEST                    06830032
068400         END-IF                                                   06840032
068500     END-IF.                                                      06850032
068600                                                                  06860032
068700     SET PS-NO-ERROR               TO TRUE.                       06870032
068800     IF (ASC-START-ITEM-REQUEST = SPACE)                          06880032
068900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06890032
069000                                   TO PV-TOP-ITEM                 06900032
069100     ELSE                                                         06910032
069200         MOVE ASC-START-ITEM-REQUEST                              06920032
069300                                   TO DP010I-UNEDITED-FIELD       06930032
069400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06940032
069500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06950032
069600         SET DP010I-NEGATIVE-NOT-ALLOWED                          06960032
069700                                   TO TRUE                        06970032
069810         CALL DP010I-NUMERIC-EDIT-ROUTINE USING                   06981053
069820                               DP010I-NUMERIC-EDIT-AREA           06982053
069900                                                                  06990032
070000         IF  NOT DP010I-ERROR-DETECTED                            07000032
070100             MOVE DP010I-NUMERIC-FIELD                            07010032
070200                                   TO  ASC-START-ITEM-REQUEST-N   07020032
070300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07030032
070400                 IF  ASC-START-ITEM-REQUEST-N >                   07040032
070500                                          ASC-NUMBER-OF-ITEMS-READ07050032
070600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07060032
070700                     COMPUTE PV-TOP-ITEM =                        07070032
070800                             ASC-NUMBER-OF-ITEMS-READ             07080032
070900                             - PC-ITEMS-PER-PANEL + 1             07090032
071000                     IF  PV-TOP-ITEM < +1                         07100032
071100                         MOVE +1   TO PV-TOP-ITEM                 07110032
071200                         MOVE PC-TSYMSG-00070                     07120032
071300                                   TO DP020-MSG-NUMBER            07130032
071400                         SET DP020-MSG-INFORMATIONAL              07140032
071500                                   TO TRUE                        07150032
071600                     END-IF                                       07160032
071700                 ELSE                                             07170032
071800                     MOVE ASC-START-ITEM-REQUEST-N                07180032
071900                                   TO PV-TOP-ITEM                 07190032
072000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07200032
072100                     COMPUTE PV-BOTTOM-ITEM =                     07210032
072200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07220032
072300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07230032
072400*                        -- BOTTOM OF LIST --                     07240032
072500                         MOVE PC-TSYMSG-00070                     07250032
072600                                   TO DP020-MSG-NUMBER            07260032
072700                         SET DP020-MSG-INFORMATIONAL              07270032
072800                                   TO TRUE                        07280032
072900                     END-IF                                       07290032
073000                 END-IF                                           07300032
073100             ELSE                                                 07310032
073200*                --- VALUE OUT OF RANGE ----                      07320032
073300                 MOVE PC-TSYMSG-00101                             07330032
073400                                   TO DP020-MSG-NUMBER            07340032
073500                 MOVE -1           TO ASTRTITL                    07350032
073600                 SET DP030-SET-CURSOR-APPL-1                      07360032
073700                                   TO TRUE                        07370032
073800                 MOVE DP015-REVERSE                               07380032
073900                                   TO ASTRTITH                    07390032
074000                 MOVE DP015-RED    TO ASTRTITC                    07400032
074100                 MOVE DP015-UNP-NUM-BRT-MDT                       07410032
074200                                   TO ASTRTITA                    07420032
074300                 SET DP020-MSG-FATAL                              07430032
074400                                   TO TRUE                        07440032
074500                 SET PS-ERROR      TO TRUE                        07450032
074600             END-IF                                               07460032
074700                                                                  07470032
074800         ELSE                                                     07480032
074900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07490032
075000             MOVE -1               TO ASTRTITL                    07500032
075100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07510032
075200             MOVE DP015-REVERSE    TO ASTRTITH                    07520032
075300             MOVE DP015-RED        TO ASTRTITC                    07530032
075400             MOVE DP015-UNP-NUM-BRT-MDT                           07540032
075500                                   TO ASTRTITA                    07550032
075600             SET DP020-MSG-FATAL   TO TRUE                        07560032
075700             SET PS-ERROR          TO TRUE                        07570032
075800         END-IF                                                   07580032
075900     END-IF.                                                      07590032
076000 EJECT                                                            07600032
076100                                                                  07610032
076200*----------------------------------------------------------------*07620032
076300*    RESET ATTRIBUTES.                                           *07630032
076400*----------------------------------------------------------------*07640032
076500                                                                  07650032
076600 3200-RESET-ATTRIBUTES.                                           07660032
076700                                                                  07670032
076800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   07680032
076900     MOVE DP015-GREEN              TO ASTRTITC.                   07690032
077000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   07700032
077100     MOVE -1                       TO ASTRTITL.                   07710032
077200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07720032
077300                                                                  07730032
077400 EJECT                                                            07740032
077500                                                                  07750032
077600*----------------------------------------------------------------*07760032
077700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *07770032
077800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *07780032
077900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *07790032
078000*    DISPLAY THE PANEL TO USER.                                  *07800032
078100*----------------------------------------------------------------*07810032
078200                                                                  07820032
078300 4000-BUILD-INITIAL-PANEL.                                        07830032
078400                                                                  07840032
078500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            07850032
078600                                 ASC-BLOCK-ENTRIES (2).           07860032
078700     MOVE +1                 TO  ASC-BLK-SUB.                     07870032
078800     SET ASC-ITEMS-LEFT-ON-DB                                     07880032
078900                             TO  TRUE.                            07890032
079000                                                                  07900032
079100     MOVE +0                 TO  ASC-ITEM-SUB                     07910032
079200                                 ASC-NUMBER-OF-ITEMS-READ         07920032
079300                                 ASC-NUMBER-OF-SELECTED-ITEMS     07930032
079400                                 ASC-HIGHEST-BLOCK-WRITTEN        07940032
079500                                 ASC-START-OF-SELECTED-RANGE      07950032
079600                                 ASC-END-OF-SELECTED-RANGE        07960032
079700                                 ASC-ITEM-AT-TOP-OF-PANEL.        07970032
079800                                                                  07980032
079900     IF ASC-ENT-NAME = SPACES                                     07990032
080000         PERFORM 4001-GET-VEND-INFO                               08000032
080100     END-IF                                                       08010032
080200     MOVE +0                       TO ASC-TOT-ALLOWS              08020032
080300                                      ASC-TOT-ALLOWS-AMT          08030032
080400                                      ASC-TOT-CHARGES.            08040032
080500                                                                  08050032
080600                                                                  08060032
080700     PERFORM 4010-OPEN-CURSOR.                                    08070032
080800                                                                  08080032
080900     PERFORM 4300-READ-ITEMS-FROM-DB.                             08090032
081000                                                                  08100032
081100     PERFORM 4020-CLOSE-CURSOR.                                   08110032
081200                                                                  08120032
081300* CHANGED CALC TO SUBTRACT ANY ALLOWANCES THAT ARE ENTERED AS     08130032
081400* AMOUNT. THESE SHOULD BE SUBTRACTED ON THE INVOICE.              08140032
081500*                                                                 08150032
081600     COMPUTE ASC-SAVE-CALC-INVC-AMT = ASC-SAVE-GRO-COST-AMT +     08160032
081700                      ASC-TOT-CHARGES - ASC-TOT-ALLOWS-AMT.       08170032
081800*                                     ASC-TOT-CHARGES.            08180032
081900* ADDED TO HANDLE TINVOIC NET AMOUNT OF ZERO                      08190032
082000     IF ASC-SAVE-INVC-STATUS NOT = 'OB'                           08200032
082100       AND ASC-SAVE-NET-INVC-AMT = 0                              08210032
082200         MOVE ASC-SAVE-CALC-INVC-AMT                              08220032
082300                                 TO ASC-SAVE-NET-INVC-AMT         08230032
082400     END-IF.                                                      08240032
082500                                                                  08250032
082600     MOVE +1                 TO  PV-TOP-ITEM.                     08260032
082700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          08270032
082800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    08280032
082900         SET DP020-MSG-FATAL   TO  TRUE                           08290032
083000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               08300032
083100     ELSE                                                         08310032
083200         MOVE -1             TO ASTRTITL                          08320032
083300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08330032
083400         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08340032
083500     END-IF.                                                      08350032
083600                                                                  08360032
083700 EJECT                                                            08370032
083800*----------------------------------------------------------------*08380032
083900* SELECT VEND NAME                                               *08390032
084000*----------------------------------------------------------------*08400032
084100 4001-GET-VEND-INFO.                                              08410032
084200                                                                  08420032
084300     EXEC SQL                                                     08430032
084400         SELECT B.ENT_NAME_DESC                                   08440032
084500         INTO   :ENTNME-ENT-NAME-DESC                             08450032
084600         FROM   TEXTENT A,                                        08460032
084700                TENTNME B                                         08470032
084800         WHERE  A.DUN_NBR = :INVOIC-RMIT-VND-ID                   08480037
084900           AND  A.ENT_ID = B.ENT_ID                               08490032
085000           AND  B.TYPE_CDE = '01'                                 08500032
085100     END-EXEC.                                                    08510032
085200                                                                  08520032
085300     EVALUATE TRUE                                                08530032
085400         WHEN SQLCODE = ZERO                                      08540032
085500             MOVE ENTNME-ENT-NAME-DESC                            08550032
085600                                 TO ASC-ENT-NAME                  08560032
085700         WHEN SQLCODE = +100                                      08570032
085800             MOVE 'NOT FOUND'    TO ASC-ENT-NAME                  08580032
085900         WHEN SQLWARN0 NOT = SPACES                               08590032
086000         WHEN SQLCODE < ZERO                                      08600032
086100         WHEN SQLCODE > ZERO                                      08610032
086200             MOVE '4001-GET-VEND-INFO    '                        08620032
086300                               TO DP013-PARAGRAPH                 08630032
086400             MOVE 'SELECT VEND NAME       '                       08640032
086500                               TO DP013-MESSAGE-TEXT (1)          08650032
086600             MOVE SQLCA        TO DP013-SQLCA                     08660032
086700             MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)        08670032
086800             MOVE 'TENTNME'    TO DP013-DB2-TABLE-NAME (2)        08680032
086900             SET DP013-DB2-ABEND                                  08690032
087000                 DP013-XCTL-DISPLAY-RESTART                       08700032
087100                               TO TRUE                            08710032
087200             PERFORM DP013-0000-PROCESS-ABEND                     08720032
087300     END-EVALUATE.                                                08730032
087400 EJECT                                                            08740032
087500*----------------------------------------------------------------*08750032
087600* OPEN THE CURSOR.                                               *08760032
087700*----------------------------------------------------------------*08770032
087800                                                                  08780032
087900 4010-OPEN-CURSOR.                                                08790032
088000     EXEC SQL                                                     08800032
088100          OPEN AC-CSR                                             08810032
088200     END-EXEC.                                                    08820032
088300                                                                  08830032
088400     EVALUATE TRUE                                                08840032
088500         WHEN SQLCODE = ZERO                                      08850032
088600                 CONTINUE                                         08860032
088700         WHEN SQLWARN0 NOT = SPACES                               08870032
088800         WHEN SQLCODE < ZERO                                      08880032
088900         WHEN SQLCODE > ZERO                                      08890032
089000             MOVE '4100-OPEN-AC-CSR'                              08900032
089100                               TO DP013-PARAGRAPH                 08910032
089200             MOVE 'OPEN AC CURSOR - '                             08920032
089300                               TO DP013-MESSAGE-TEXT (1)          08930032
089400             MOVE SQLCA        TO DP013-SQLCA                     08940032
089500             MOVE 'TALCHRG '   TO DP013-DB2-TABLE-NAME (1)        08950032
089600             SET DP013-DB2-ABEND                                  08960032
089700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               08970032
089800             PERFORM DP013-0000-PROCESS-ABEND                     08980032
089900     END-EVALUATE.                                                08990032
090000                                                                  09000032
090100                                                                  09010032
090200 EJECT                                                            09020032
090300*----------------------------------------------------------------*09030032
090400* CLOSE THE CURSOR.                                              *09040032
090500*----------------------------------------------------------------*09050032
090600                                                                  09060032
090700 4020-CLOSE-CURSOR.                                               09070032
090800                                                                  09080032
090900     EXEC SQL                                                     09090032
091000         CLOSE AC-CSR                                             09100032
091100     END-EXEC                                                     09110032
091200                                                                  09120032
091300     EVALUATE TRUE                                                09130032
091400         WHEN SQLCODE = ZERO                                      09140032
091500             CONTINUE                                             09150032
091600         WHEN SQLWARN0 NOT = SPACES                               09160032
091700         WHEN SQLCODE < ZERO                                      09170032
091800         WHEN SQLCODE > ZERO                                      09180032
091900             MOVE '4020-CLOSE-CURSOR'                             09190032
092000                                   TO DP013-PARAGRAPH             09200032
092100             MOVE 'CLOSE AC CURSOR '                              09210032
092200                                   TO DP013-MESSAGE-TEXT (1)      09220032
092300             MOVE SQLCA            TO DP013-SQLCA                 09230032
092400             MOVE 'TALCHRG '       TO DP013-DB2-TABLE-NAME (1)    09240032
092500             SET DP013-DB2-ABEND                                  09250032
092600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09260032
092700             PERFORM DP013-0000-PROCESS-ABEND                     09270032
092800     END-EVALUATE.                                                09280032
092900                                                                  09290032
093000                                                                  09300032
093100 EJECT                                                            09310032
093200*----------------------------------------------------------------*09320032
093300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *09330032
093400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *09340032
093500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *09350032
093600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *09360032
093700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *09370032
093800*                                                                *09380032
093900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *09390032
094000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *09400032
094100*    UPON INITIALIZATION.                                        *09410032
094200*----------------------------------------------------------------*09420032
094300                                                                  09430032
094400 4300-READ-ITEMS-FROM-DB.                                         09440032
094500                                                                  09450032
094600     PERFORM                                                      09460032
094700         VARYING PV-READ-COUNT                                    09470032
094800         FROM 1 BY 1                                              09480032
094900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    09490032
095000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         09500032
095100                                                                  09510032
095200         PERFORM 4310-FETCH                                       09520032
095300                                                                  09530032
095400         IF  ASC-ITEMS-LEFT-ON-DB                                 09540032
095500             PERFORM 4320-GET-SUB                                 09550032
095600             MOVE ALCHRG-ALW-CHRG-SEQ-NBR                         09560032
095700                     TO ASC-AC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB) 09570032
095800             MOVE ALCHRG-ALW-CHRG-TYP-CDE                         09580032
095900                     TO ASC-AC-IND (ASC-BLK-SUB ASC-ITEM-SUB)     09590032
096000              MOVE ALCHRG-ALW-CHRG-CDE                            09600032
096100                     TO ASC-AC-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     09610032
096200              MOVE ALCHRG-ALW-CHRG-SER-CDE                        09620032
096300                     TO ASC-SS-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     09630032
096400              COMPUTE ASC-AC-PCT-N (ASC-BLK-SUB ASC-ITEM-SUB)     09640032
096500                                 = ALCHRG-ALW-CHRG-PCT * 100      09650032
096600              MOVE ASC-AC-PCT-N (ASC-BLK-SUB ASC-ITEM-SUB)        09660032
096700                                   TO PV-PCT-DIS                  09670032
096800*-->          -- BECAUSE THE ALCHRG AMT AND PCT FIELDS ARE        09680032
096900*-->          -- MUTUALLY EXCLUSIVE, THE FOLLOWING ADDITION TO    09690032
097000*-->          -- ASC-TOT-CHARGES IS O.K.  (NO DOUBLE-ADDING HERE) 09700032
097100              IF ALCHRG-ALW-CHRG-TYP-CDE = 'C'                    09710032
097200                  ADD ALCHRG-ALW-CHRG-AMT TO ASC-TOT-CHARGES      09720032
097300                  COMPUTE ASC-TOT-CHARGES =                       09730032
097400                    (((ASC-AC-PCT-N (ASC-BLK-SUB ASC-ITEM-SUB) *  09740032
097500                           ASC-SAVE-GRO-COST-AMT) * .01) +        09750032
097600                           ASC-TOT-CHARGES)                       09760032
097700              ELSE                                                09770032
097800* ACCUMULATE THE ALLOWANCES THAT ARE ENTERED AS AN AMOUNT. THESE  09780032
097900* WILL BE SUBTRACTED FROM THE MDSE COST TO GET THE NET INVC AMT.  09790032
098000****  DON'T ACCUMULATE THE PERCENTAGES.                           09800032
098100                  ADD ALCHRG-ALW-CHRG-AMT                         09810032
098200                                 TO ASC-TOT-ALLOWS                09820032
098300                                    ASC-TOT-ALLOWS-AMT            09830032
098400                  COMPUTE ASC-TOT-ALLOWS =                        09840032
098500                    (((ASC-AC-PCT-N (ASC-BLK-SUB ASC-ITEM-SUB) *  09850032
098600                           ASC-SAVE-GRO-COST-AMT) * .01) +        09860032
098700                           ASC-TOT-ALLOWS)                        09870032
098800              END-IF                                              09880032
098900              MOVE PV-PCT-DIS                                     09890032
099000                  TO ASC-AC-PCT (ASC-BLK-SUB ASC-ITEM-SUB)        09900032
099100              MOVE ALCHRG-ALW-CHRG-AMT                            09910032
099200                  TO ASC-AC-AMT-N (ASC-BLK-SUB ASC-ITEM-SUB)      09920032
099300                     PV-AMT-DIS                                   09930032
099400              MOVE PV-AMT-DIS                                     09940032
099500                  TO ASC-AC-AMT (ASC-BLK-SUB ASC-ITEM-SUB)        09950032
099600         END-IF                                                   09960032
099700     END-PERFORM.                                                 09970032
099800                                                                  09980032
099900     MOVE +1                       TO  ASC-BLK-SUB.               09990032
100000     PERFORM 5100-WRITE-TEMP-STORAGE.                             10000032
100100     ADD +1                        TO  ASC-BLK-SUB.               10010032
100200     PERFORM 5100-WRITE-TEMP-STORAGE.                             10020032
100300                                                                  10030032
100400     MOVE 1                        TO  ASC-BLK-SUB                10040032
100500                                       PV-BLOCK-NUMBER.           10050032
100600     PERFORM 4410-READ-TEMP-STORAGE.                              10060032
100700     IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                 10070032
100800         MOVE 2                    TO  ASC-BLK-SUB                10080032
100900                                       PV-BLOCK-NUMBER            10090032
101000         PERFORM 4410-READ-TEMP-STORAGE                           10100032
101100     END-IF.                                                      10110032
101200 EJECT                                                            10120032
101300*----------------------------------------------------------------*10130032
101400*    FETCH THE ALLOWANCE/CHARGE CURSOR                           *10140032
101500*----------------------------------------------------------------*10150032
101600                                                                  10160032
101700 4310-FETCH.                                                      10170032
101800                                                                  10180032
101900     EXEC SQL                                                     10190032
102000          FETCH AC-CSR                                            10200032
102100          INTO  :ALCHRG-ALW-CHRG-SEQ-NBR                          10210032
102200               ,:ALCHRG-ALW-CHRG-TYP-CDE                          10220032
102300               ,:ALCHRG-ALW-CHRG-CDE                              10230032
102400               ,:ALCHRG-ALW-CHRG-SER-CDE                          10240032
102500               ,:ALCHRG-ALW-CHRG-PCT                              10250032
102600               ,:ALCHRG-ALW-CHRG-AMT                              10260032
102700     END-EXEC.                                                    10270032
102800                                                                  10280032
102900     EVALUATE TRUE                                                10290032
103000         WHEN SQLCODE = ZERO                                      10300032
103100              CONTINUE                                            10310032
103200         WHEN SQLCODE = +100                                      10320032
103300              SET ASC-NO-ITEMS-LEFT-ON-DB  TO  TRUE               10330032
103400         WHEN SQLWARN0 NOT EQUAL SPACE                            10340032
103500         WHEN SQLCODE NOT EQUAL ZERO                              10350032
103600              MOVE '4310-FETCH-CURSOR'                            10360032
103700                           TO  DP013-PARAGRAPH                    10370032
103800              MOVE 'FETCH ALLW/CH CURSOR'                         10380032
103900                           TO  DP013-MESSAGE-TEXT (1)             10390032
104000              MOVE SQLCA   TO  DP013-SQLCA                        10400032
104100              SET DP013-DB2-ABEND                                 10410032
104200                           TO  TRUE                               10420032
104300              PERFORM DP013-0000-PROCESS-ABEND                    10430032
104400     END-EVALUATE.                                                10440032
104500                                                                  10450032
104600                                                                  10460032
104700 EJECT                                                            10470032
104800*----------------------------------------------------------------*10480032
104900*    GET THE CORRECT SUBSCRIPTS FOR PLACING THE TEXT LINE.       *10490032
105000*----------------------------------------------------------------*10500032
105100                                                                  10510032
105200 4320-GET-SUB.                                                    10520032
105300                                                                  10530032
105400     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        10540032
105500         ADD +1            TO  ASC-ITEM-SUB                       10550032
105600     ELSE                                                         10560032
105700         ADD +1            TO  ASC-BLK-SUB                        10570032
105800         MOVE +1           TO  ASC-ITEM-SUB                       10580032
105900                                                                  10590032
106000         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 10600032
106100             MOVE +1       TO  ASC-BLK-SUB                        10610032
106200             PERFORM 5100-WRITE-TEMP-STORAGE                      10620032
106300             MOVE ASC-BLOCK-ENTRIES                               10630032
106400                       (PC-MAX-BLOCKS-IN-ARRAY)                   10640032
106500             TO   ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                  10650032
106600             ADD +1        TO  ASC-BLK-SUB                        10660032
106700             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           10670032
106800         END-IF                                                   10680032
106900     END-IF.                                                      10690032
107000                                                                  10700032
107100     ADD +1            TO ASC-NUMBER-OF-ITEMS-READ.               10710032
107200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER        10720032
107300                                      (ASC-BLK-SUB                10730032
107400                                       ASC-ITEM-SUB).             10740032
107500                                                                  10750032
107600*----------------------------------------------------------------*10760032
107700*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *10770032
107800*----------------------------------------------------------------*10780032
107900                                                                  10790032
108000 4400-MOVE-COMMAREA-TO-SCREEN.                                    10800032
108100                                                                  10810032
108200     MOVE ASC-SAVE-PO-NBR          TO APONUMO.                    10820032
108300     MOVE ASC-SAVE-INVC-ID         TO AINVNBRO.                   10830032
108400     MOVE ASC-ENT-NAME             TO AVENDNMO.                   10840032
108500                                                                  10850032
108600     MOVE ASC-SAVE-GRO-COST-AMT    TO PV-8V99.                    10860032
108700     MOVE PV-8V99-X                TO ATOTCSTO.                   10870032
108800     MOVE ASC-SAVE-NET-INVC-AMT    TO PV-8V99.                    10880032
108900     MOVE PV-8V99-X                TO ATOTINVO.                   10890032
109000                                                                  10900032
109100     MOVE ASC-SAVE-CALC-INVC-AMT   TO PV-8V99.                    10910032
109200     MOVE PV-8V99-X                TO ACLCINVO.                   10920032
109300                                                                  10930032
109400     MOVE DP015-BLUE               TO ASTATUSC.                   10940032
109500     EVALUATE ASC-SAVE-INVC-STATUS                                10950032
109600         WHEN 'EN'                                                10960032
109700             MOVE 'ENTERED    '    TO ASTATUSO                    10970032
109800         WHEN 'RC'                                                10980032
109900             MOVE 'RECONCILE  '    TO ASTATUSO                    10990032
110000         WHEN 'RL'                                                11000032
110100             MOVE 'RELEASED   '    TO ASTATUSO                    11010032
110200         WHEN 'OP'                                                11020032
110300             MOVE 'OPEN TO PAY'    TO ASTATUSO                    11030032
110400         WHEN 'PD'                                                11040032
110500             MOVE 'PAID       '    TO ASTATUSO                    11050032
110600         WHEN 'PJ'                                                11060045
110700             MOVE 'PENDNG JRNL'    TO ASTATUSO                    11070045
110800         WHEN 'DE'                                                11080032
110900             MOVE 'DELETED    '    TO ASTATUSO                    11090032
111000         WHEN 'PR'                                                11100032
111100             MOVE 'PENDING RVW'    TO ASTATUSO                    11110032
111200             MOVE DP015-YELLOW     TO ASTATUSC                    11120032
111300         WHEN 'OB'                                                11130032
111400             MOVE 'OUT OF BAL '    TO ASTATUSO                    11140032
111500             MOVE DP015-YELLOW     TO ASTATUSC                    11150032
111600         WHEN 'BM'                                                11160032
111700             MOVE DP015-YELLOW     TO ASTATUSC                    11170032
111800             MOVE 'BATCH MATCH'    TO ASTATUSO                    11180032
111900     END-EVALUATE.                                                11190032
112000                                                                  11200032
112100     MOVE ASC-TOT-CHARGES          TO PV-8V99.                    11210032
112200     MOVE PV-8V99-X                TO ATOTCHGO.                   11220032
112300                                                                  11230032
112400     MOVE ASC-TOT-ALLOWS           TO PV-8V99.                    11240032
112500     MOVE PV-8V99-X                TO ATOTALWO.                   11250032
112600                                                                  11260032
112700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             11270032
112800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          11280032
112900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          11290032
113000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             11300032
113100                 GIVING PV-BLOCK-NUMBER                           11310032
113200                 REMAINDER PV-REMAINDER                           11320032
113300             IF  PV-REMAINDER > ZERO                              11330032
113400                 ADD +1 TO PV-BLOCK-NUMBER                        11340032
113500             END-IF                                               11350032
113600             MOVE +1    TO ASC-BLK-SUB                            11360032
113700             PERFORM 4410-READ-TEMP-STORAGE                       11370032
113800             ADD +1     TO ASC-BLK-SUB                            11380032
113900                           PV-BLOCK-NUMBER                        11390032
114000             PERFORM 4410-READ-TEMP-STORAGE                       11400032
114100     END-IF.                                                      11410032
114200     MOVE +1                       TO ASC-BLK-SUB.                11420032
114300     COMPUTE ASC-ITEM-SUB =                                       11430032
114400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              11440032
114500         + PC-ITEMS-PER-PANEL).                                   11450032
114600                                                                  11460032
114700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11470032
114800         ADD +1   TO ASC-BLK-SUB                                  11480032
114900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11490032
115000     END-IF.                                                      11500032
115100                                                                  11510032
115200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           11520032
115300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                11530032
115400     PERFORM 4420-FORMAT-LIST-LINES                               11540032
115500         VARYING PS-SUB                                           11550032
115600         FROM PC-ITEMS-PER-PANEL BY -1                            11560032
115700         UNTIL PS-SUB < +1.                                       11570032
115800                                                                  11580032
115900     COMPUTE ASC-ITEMS-DISPLAYED =                                11590032
116000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          11600032
116100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    11610032
116200                                      ASTRTITO.                   11620032
116300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    11630032
116400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    11640032
116500                                                                  11650032
116600     IF  DP020-MSG-NUMBER-X = SPACE                               11660032
116700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  11670032
116800*            --- MORE ITEMS TO DISPLAY ----                       11680032
116900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            11690032
117000             SET DP020-MSG-INFORMATIONAL TO TRUE                  11700032
117100         END-IF                                                   11710032
117200     END-IF.                                                      11720032
117300                                                                  11730032
117400*----------------------------------------------------------------*11740032
117500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *11750032
117600*----------------------------------------------------------------*11760032
117700                                                                  11770032
117800 4410-READ-TEMP-STORAGE.                                          11780032
117900                                                                  11790032
118000     EXEC CICS                                                    11800032
118100         READQ TS                                                 11810032
118200             QUEUE (ASC-DTL-QUEUE-NAME)                           11820032
118300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               11830032
118400             ITEM  (PV-BLOCK-NUMBER)                              11840032
118500             RESP  (PV-CICS-RESP)                                 11850032
118600     END-EXEC.                                                    11860032
118700                                                                  11870032
118800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       11880032
118900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     11890032
119000         CONTINUE                                                 11900032
119100     ELSE                                                         11910032
119200         SET DP013-CICS-ABEND TO  TRUE                            11920032
119300         SET DP013-NO-ROLLBACK TO  TRUE                           11930032
119400         MOVE '4410-READ-TEMP-STORAGE'                            11940032
119500                               TO  DP013-PARAGRAPH                11950032
119600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      11960032
119700                               TO  DP013-MESSAGE-TEXT(1)          11970032
119800         PERFORM DP013-0000-PROCESS-ABEND                         11980032
119900     END-IF.                                                      11990032
120000                                                                  12000032
120100*    SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             12010032
120200                                                                  12020032
120300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         12030032
120400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               12040032
120500     END-IF.                                                      12050032
120600 EJECT                                                            12060032
120700*----------------------------------------------------------------*12070032
120800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *12080032
120900*----------------------------------------------------------------*12090032
121000                                                                  12100032
121100 4420-FORMAT-LIST-LINES.                                          12110032
121200                                                                  12120032
121300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      12130032
121400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                12140032
121500         MOVE SPACE              TO MR-AC-IND(PS-SUB)             12150032
121600                                    MR-AC-CDE(PS-SUB)             12160032
121700                                    MR-AC-PCT(PS-SUB)             12170032
121800                                    MR-AC-AMT(PS-SUB)             12180032
121900                                    MR-SS-CDE(PS-SUB)             12190032
122000     ELSE                                                         12200032
122100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           12210032
122200             MOVE ASC-AC-IND(ASC-BLK-SUB ASC-ITEM-SUB)            12220032
122300                                 TO MR-AC-IND(PS-SUB)             12230032
122400             MOVE ASC-AC-CDE(ASC-BLK-SUB ASC-ITEM-SUB)            12240032
122500                                 TO MR-AC-CDE(PS-SUB)             12250032
122600             MOVE ASC-AC-PCT(ASC-BLK-SUB ASC-ITEM-SUB)            12260032
122700                                 TO MR-AC-PCT(PS-SUB)             12270032
122800             MOVE ASC-AC-AMT(ASC-BLK-SUB ASC-ITEM-SUB)            12280032
122900                                 TO MR-AC-AMT(PS-SUB)             12290032
123000             MOVE ASC-SS-CDE(ASC-BLK-SUB ASC-ITEM-SUB)            12300032
123100                                 TO MR-SS-CDE(PS-SUB)             12310032
123200         END-IF                                                   12320032
123300     END-IF.                                                      12330032
123400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12340032
123500     IF  ASC-ITEM-SUB < + 1                                       12350032
123600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  12360032
123700         MOVE +1                 TO ASC-BLK-SUB                   12370032
123800     END-IF.                                                      12380032
123900                                                                  12390032
124000*----------------------------------------------------------------*12400032
124100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *12410032
124200*----------------------------------------------------------------*12420032
124300                                                                  12430032
124400 5100-WRITE-TEMP-STORAGE.                                         12440032
124500                                                                  12450032
124600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     12460032
124700                               TO  PV-LIST-ITEM-NUMBER.           12470032
124800     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           12480032
124900         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           12490032
125000                                                                  12500032
125100     EXEC CICS                                                    12510032
125200         WRITEQ TS                                                12520032
125300             QUEUE (ASC-DTL-QUEUE-NAME)                           12530032
125400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12540032
125500             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     12550032
125600             RESP  (PV-CICS-RESP)                                 12560032
125700     END-EXEC.                                                    12570032
125800                                                                  12580032
125900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      12590032
126000         SET DP013-CICS-ABEND                                     12600032
126100                       TO  TRUE                                   12610032
126200         SET DP013-NO-ROLLBACK                                    12620032
126300                       TO  TRUE                                   12630032
126400         MOVE '5100-WRITE-TEMP-STORAGE'                           12640032
126500                       TO  DP013-PARAGRAPH                        12650032
126600         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       12660032
126700                       TO  DP013-MESSAGE-TEXT(1)                  12670032
126800         PERFORM DP013-0000-PROCESS-ABEND                         12680032
126900     END-IF.                                                      12690032
127000     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.             12700032
127100                                                                  12710032
127200 EJECT                                                            12720032
127300*----------------------------------------------------------------*12730032
127400*    ABEND PROCESSOR MODULE                                      *12740032
127500*----------------------------------------------------------------*12750032
127600                                                                  12760032
127700     COPY DPPD013.                                                12770032
