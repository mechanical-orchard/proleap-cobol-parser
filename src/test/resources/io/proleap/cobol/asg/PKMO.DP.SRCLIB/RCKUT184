000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    RCKUT184.                                         00050000
000600 AUTHOR.        DENISE HAHN                                       00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   SEPT, 2021.                                       00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM WILL READ IN THE SORTED FILE OF MIXED SKU CASES    00120000
001300* RECEIVED TODAY - AND GET ADDITIONAL INFORMATION TO BE ABLE      00130000
001400* TO GENERATE SUMMARY RECORD                                      00140000
001410* SUMMARY IS BY:  DC - VENDOR - DEPT                              00141000
001420* SUMMARY IS A COUNT OF CARTONS                                   00142000
001450*                                                                 00145000
001495******************************************************************00149500
001496                                                                  00149600
001497******************************************************************00149700
001498 ENVIRONMENT DIVISION.                                            00149800
001499******************************************************************00149900
001500                                                                  00150000
001600 CONFIGURATION SECTION.                                           00160000
001700                                                                  00170000
001800 SOURCE-COMPUTER.        IBM-3090.                                00180000
001900 OBJECT-COMPUTER.        IBM-3090.                                00190000
002000                                                                  00200000
002100 INPUT-OUTPUT SECTION.                                            00210000
002200                                                                  00220000
002300 FILE-CONTROL.                                                    00230000
002400                                                                  00240000
002500     SELECT INPUT-FILE                                            00250000
002600        ASSIGN TO INP01.                                          00260000
002700                                                                  00270000
002800     SELECT  ASN-MIXSKU-SUM-FILE                                  00280001
002900        ASSIGN TO OUT01.                                          00290000
002910                                                                  00291000
002940                                                                  00294000
002950                                                                  00295000
002960******************************************************************00296000
002970 DATA DIVISION.                                                   00297000
002980******************************************************************00298000
002990                                                                  00299000
003000 FILE SECTION.                                                    00300000
003100                                                                  00310000
003200                                                                  00320000
003300 FD  INPUT-FILE                                                   00330000
003400     LABEL RECORDS ARE STANDARD                                   00340000
003500     RECORDING MODE IS F                                          00350000
003600     BLOCK CONTAINS 0 RECORDS                                     00360000
003700     RECORD CONTAINS 1100 CHARACTERS.                             00370001
003800                                                                  00380000
003900 01  ASN-INPUT-RECORD            PIC  X(1100).                    00390001
004000                                                                  00400000
004100                                                                  00410000
004200 FD  ASN-MIXSKU-SUM-FILE                                          00420001
004300     LABEL RECORDS ARE STANDARD                                   00430000
004400     RECORDING MODE IS F                                          00440000
004500     BLOCK CONTAINS 0 RECORDS                                     00450000
004600     RECORD CONTAINS 150 CHARACTERS.                              00460001
004610                                                                  00461000
004620 01  ASN-MIXSKU-SUM-RECORD       PIC  X(150).                     00462001
004630                                                                  00463000
004703                                                                  00470300
004704******************************************************************00470400
004705 WORKING-STORAGE SECTION.                                         00470500
004706******************************************************************00470600
004707*-----------------------------------------------------------------00470700
004708*                                                                 00470800
004709*-----------------------------------------------------------------00470900
004710 01  ABEND-CODE                     PIC S9(04) VALUE +0           00471000
004720                                               COMP SYNC.         00472000
004730                                                                  00473000
004740*-----------------------------------------------------------------00474000
004750* PROGRAM CONSTANTS                                               00475000
004760*-----------------------------------------------------------------00476000
004770 01  PC-PROGRAM-CONSTANTS.                                        00477000
004780     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08) VALUE              00478000
004790         'RCKUT184'.                                              00479000
004791     05  PC-01                      PIC  X(02)  VALUE '01'.       00479103
004800                                                                  00480000
004900*-----------------------------------------------------------------00490000
005000* PROGRAM SWITCHES                                                00500000
005100*-----------------------------------------------------------------00510000
005200 01  PS-PROGRAM-SWITCHES.                                         00520000
005300     05  PS-END-OF-FILE-SW          PIC  X(01) VALUE 'N'.         00530000
005400         88  PS-END-OF-FILE                    VALUE 'Y'.         00540000
005500         88  PS-END-OF-FILE-NO                 VALUE 'N'.         00550000
005600     05  PS-ERROR-SW                PIC  X(01) VALUE 'N'.         00560000
005700         88  PS-ERROR                          VALUE 'Y'.         00570000
005800         88  PS-ERROR-NO                       VALUE 'N'.         00580000
005900     05  PS-RETAIL-DC-SW            PIC  X(01) VALUE 'N'.         00590000
006000         88  PS-RETAIL-DC                      VALUE 'Y'.         00600000
006100         88  PS-RETAIL-DC-NO                   VALUE 'N'.         00610000
006200     05  PS-PO-BULK-SW              PIC  X(01) VALUE 'N'.         00620000
006300         88  PS-PO-BULK                        VALUE 'Y'.         00630000
006400         88  PS-PO-BULK-NO                     VALUE 'N'.         00640000
006500                                                                  00650000
006600*-----------------------------------------------------------------00660000
006700* PROGRAM VARIABLES                                               00670000
006800*-----------------------------------------------------------------00680000
006900                                                                  00690000
007000 01  PV-PROGRAM-VARIABLES.                                        00700000
007700     05  PV-READ-COUNT              PIC  9(09)  VALUE ZEROS.      00770003
007710     05  PV-OUTPUT-COUNT            PIC  9(09)  VALUE ZEROS.      00771003
007800     05  PV-SSCC-SKU-COUNT          PIC S9(09)  COMP.             00780003
007900     05  PV-SSCC-UNT-QTY            PIC S9(09)  COMP.             00790003
009413     05  PV-NULL                    PIC S9(04) VALUE +0 COMP.     00941306
VIGNUL                                                                  00941406
009414     05  PV-DISP-COUNT              PIC  ZZZ,ZZZ,ZZ9              00941500
009415                                                VALUE ZEROS.      00941600
009416     05  PV-DISP-SQLCODE            PIC  -999   VALUE ZEROS.      00941700
009417     05  PV-DISP-LOC                PIC  ZZZ9   VALUE ZEROS.      00941800
009418                                                                  00941900
009419     05  PV-PREV-PO                 PIC  9(09)  VALUE ZEROES.     00942001
009420     05  PV-DEPT-NBR                PIC  9(03)  VALUE ZEROES.     00942104
009421     05  PV-ENT-ID                  PIC  9(09)  VALUE ZEROES.     00942204
009430     05  PV-ENT-NME                 PIC  X(50)  VALUE SPACES.     00943001
009490                                                                  00949000
009500     05  PV-PARAGRAPH-NAME          PIC  X(30) VALUE SPACES.      00950000
009600     05  PV-DB2-OPERATION-ATTEMPTED PIC  X(30) VALUE SPACES.      00960000
009700                                                                  00970000
009800*-----------------------------------------------------------------00980000
009900*  INPUT RECORD LAYOUT                                            00990001
010000*-----------------------------------------------------------------01000000
010100     COPY RCRD109.                                                01010001
010200                                                                  01020000
010300*-----------------------------------------------------------------01030000
010400*  OUT01 RECORD LAYOUT                                            01040000
010500*-----------------------------------------------------------------01050000
010600     COPY RCRD110.                                                01060001
010700                                                                  01070000
010800*-----------------------------------------------------------------01080000
010900*  DB2 FORMATTED MESSAGE AREA                                     01090000
011000*-----------------------------------------------------------------01100000
011100     COPY DPWS004.                                                01110000
011200                                                                  01120000
011300*-----------------------------------------------------------------01130000
011400*  XLT_LOC                                                        01140000
011500*-----------------------------------------------------------------01150000
011600     EXEC SQL                                                     01160000
011700          INCLUDE XLT00010                                        01170000
011800     END-EXEC.                                                    01180000
011900                                                                  01190000
012000*-----------------------------------------------------------------01200000
012100*  TPURCHS                                                        01210000
012200*-----------------------------------------------------------------01220000
012300     EXEC SQL                                                     01230000
012400          INCLUDE TPURCHS                                         01240000
012500     END-EXEC.                                                    01250000
012600                                                                  01260000
012601*-----------------------------------------------------------------01260101
012602*  TENTNME                                                        01260201
012603*-----------------------------------------------------------------01260301
012604     EXEC SQL                                                     01260401
012605          INCLUDE TENTNME                                         01260501
012606     END-EXEC.                                                    01260601
012607                                                                  01260701
012610*-----------------------------------------------------------------01261001
012620*  TSHUUPC                                                        01262003
012630*-----------------------------------------------------------------01263001
012640     EXEC SQL                                                     01264001
012650          INCLUDE TSHUUPC                                         01265003
012660     END-EXEC.                                                    01266001
012670                                                                  01267001
012680*-----------------------------------------------------------------01268002
012690*  XLT_SKU                                                        01269002
012691*-----------------------------------------------------------------01269102
012692     EXEC SQL                                                     01269202
012693          INCLUDE XLT00003                                        01269302
012694     END-EXEC.                                                    01269402
012695                                                                  01269502
012696*-----------------------------------------------------------------01269602
012697*  XLT_UPC                                                        01269702
012698*-----------------------------------------------------------------01269802
012699     EXEC SQL                                                     01269902
012700          INCLUDE XLT00006                                        01270002
012701     END-EXEC.                                                    01270102
012702                                                                  01270202
012710*-----------------------------------------------------------------01271000
012800*  COMMUNICATIONS AREA FOR DB2                                    01280000
012900*-----------------------------------------------------------------01290000
013000     EXEC SQL                                                     01300000
013100          INCLUDE SQLCA                                           01310000
013200     END-EXEC.                                                    01320000
013300                                                                  01330000
013400                                                                  01340000
013500******************************************************************01350000
013600 PROCEDURE DIVISION.                                              01360000
013700******************************************************************01370000
013800                                                                  01380000
013900                                                                  01390000
014000*-----------------------------------------------------------------01400000
014100* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01410000
014200*      PROGRAM.                                                   01420000
014300*-----------------------------------------------------------------01430000
014400 0000-PROGRAM-MAINLINE.                                           01440000
014500                                                                  01450000
014600     DISPLAY ' '.                                                 01460000
014700     DISPLAY ' RCKUT184 - START'                                  01470000
014800                                                                  01480000
015900     SET PS-END-OF-FILE-NO TO TRUE.                               01590000
016000                                                                  01600000
016100     OPEN INPUT  INPUT-FILE                                       01610000
016200          OUTPUT ASN-MIXSKU-SUM-FILE.                             01620001
016400                                                                  01640000
016500     PERFORM 8000-READ-INPUT.                                     01650000
016600                                                                  01660000
016700     IF PS-END-OF-FILE                                            01670000
016800        DISPLAY '*                                            *'  01680000
016900        DISPLAY '* NO DC BULK MIX-SKU - EMPTY FILE            *'  01690001
017000        DISPLAY '*                                            *'  01700000
017100     ELSE                                                         01710000
018100         PERFORM 2000-PROCESS-FILE                                01810000
018200             UNTIL PS-END-OF-FILE                                 01820000
018300                OR PS-ERROR                                       01830000
018400     END-IF.                                                      01840000
018500                                                                  01850000
018600     CLOSE INPUT-FILE                                             01860000
018700           ASN-MIXSKU-SUM-FILE.                                   01870001
018900                                                                  01890000
019000     DISPLAY ' '                                                  01900000
019100     MOVE PV-READ-COUNT                  TO  PV-DISP-COUNT        01910000
019200     DISPLAY ' RECORDS READ:           '     PV-DISP-COUNT        01920000
019300     DISPLAY ' '                                                  01930000
019400                                                                  01940000
021700     MOVE PV-OUTPUT-COUNT                TO PV-DISP-COUNT         02170004
021800     DISPLAY ' OUTPUT COUNT:           '    PV-DISP-COUNT         02180001
021900     DISPLAY ' '                                                  02190000
024300                                                                  02430000
024400     DISPLAY ' RCKUT184 - END'.                                   02440000
024500     DISPLAY ' '.                                                 02450000
024600                                                                  02460000
024700     STOP RUN.                                                    02470000
024800                                                                  02480000
024900                                                                  02490000
025000*-----------------------------------------------------------------02500000
025100*  PROCESS ASN INPUT FILE                                         02510000
025200*-----------------------------------------------------------------02520000
025300 2000-PROCESS-FILE.                                               02530000
025400                                                                  02540000
025500*                                                                 02550000
025600* CHECK IF SAME PO - DO NOT NEED TO GET THE DEPT/VENDOR INFOR     02560001
025700*                                                                 02570000
026500     IF  RC109-PO-NBR          =  PV-PREV-PO                      02650001
026600         CONTINUE                                                 02660001
026800     ELSE                                                         02680001
026900         PERFORM 3000-GET-PO-VNDR-INFO                            02690001
029600     END-IF.                                                      02960000
029601                                                                  02960101
029610     MOVE  RC109-PO-NBR  TO  PV-PREV-PO.                          02961001
029700                                                                  02970000
029701     PERFORM 3100-SKU-UNIT-QTYS.                                  02970101
029702                                                                  02970201
029703     MOVE SPACES             TO  RC110-DCBULK-MIXSKU-SUM-REC.     02970301
029704     MOVE RC109-DIST-CNTR    TO  RC110-DIST-CNTR                  02970401
029705     MOVE PV-DEPT-NBR        TO  RC110-DEPT-NBR                   02970501
029706     MOVE PV-ENT-ID          TO  RC110-ENT-ID                     02970601
029707     MOVE PV-ENT-NME         TO  RC110-ENT-NME                    02970701
029709     MOVE PV-SSCC-SKU-COUNT  TO  RC110-SKU-CNT                    02970901
029710     MOVE 1                  TO  RC110-SSCC-COUNT                 02971001
029711     MOVE PV-SSCC-UNT-QTY    TO  RC110-UNIT-CNT                   02971101
029712                                                                  02971201
029713     PERFORM 8100-WRITE-OUTPUT.                                   02971301
029714                                                                  02971401
029800     PERFORM 8000-READ-INPUT.                                     02980000
029900                                                                  02990000
030000                                                                  03000000
030100*-----------------------------------------------------------------03010000
030200*  GET THE DEPT FOR THE PO AND THE VENDOR ENT-ID & NAME           03020001
030300*-----------------------------------------------------------------03030000
030400 3000-GET-PO-VNDR-INFO.                                           03040001
030500                                                                  03050000
030510     MOVE RC109-PO-NBR  TO  PURCHS-PO-NBR.                        03051001
030600                                                                  03060001
030900     EXEC SQL                                                     03090000
031000         SELECT A.DEPT_NBR                                        03100001
031001              , A.ENT_ID                                          03100101
031010              , ENT_NAME_DESC                                     03101001
031100           INTO :PURCHS-DEPT-NBR                                  03110001
031110              , :PURCHS-ENT-ID                                    03111001
031120              , :ENTNME-ENT-NAME-DESC                             03112001
031200           FROM TPURCHS A,                                        03120001
031300                TENTNME B                                         03130001
031400          WHERE A.PO_NBR         =  :PURCHS-PO-NBR                03140001
031500            AND A.VER_STATUS_CDE =  'A'                           03150001
031600            AND A.ENT_ID         =   B.ENT_ID                     03160001
031610            AND B.TYPE_CDE       =  :PC-01                        03161001
031700            WITH  UR                                              03170000
031800     END-EXEC.                                                    03180000
031900                                                                  03190000
032000     EVALUATE TRUE                                                03200000
032100         WHEN SQLCODE = +0                                        03210000
032110              MOVE PURCHS-DEPT-NBR      TO  PV-DEPT-NBR           03211001
032120              MOVE PURCHS-ENT-ID        TO  PV-ENT-ID             03212001
032130              MOVE ENTNME-ENT-NAME-DESC TO  PV-ENT-NME            03213001
032600                                                                  03260000
033300         WHEN SQLWARN0 NOT = SPACES                               03330000
033400         WHEN SQLCODE < +0                                        03340000
033500         WHEN SQLCODE > +0                                        03350000
033700             DISPLAY ' '                                          03370000
033800             DISPLAY 'SQL ERROR - PO: ' RC109-PO-NBR              03380001
033900                                                                  03390000
034000             MOVE SQLCODE          TO  PV-DISP-SQLCODE            03400000
034200             SET PS-ERROR          TO  TRUE                       03420000
034300             DISPLAY '******************************************' 03430000
034400             DISPLAY '*ABEND                                   *' 03440000
034500             DISPLAY '*PROGRAM   = RCKUT184                    *' 03450000
034600             DISPLAY '*DB2 OPER  = SELECT ON TPURCHS TENTMNE   *' 03460001
034700             DISPLAY '*PARAGRAPH = 3000-GET-PO-VNDR-INFO       *' 03470001
034800             DISPLAY '*SQLCODE = ' PV-DISP-SQLCODE                03480000
034900             DISPLAY '*PO-NBR  = ' RC109-PO-NBR                   03490001
035000             DISPLAY '******************************************' 03500000
035100             PERFORM 9100-SQL-ABEND                               03510000
035101     END-EVALUATE.                                                03510100
035102                                                                  03510200
035103                                                                  03510300
035104*-----------------------------------------------------------------03510401
035105*  GET SKU COUNT AND UNITS FROM SSCC                              03510501
035106*-----------------------------------------------------------------03510601
035107 3100-SKU-UNIT-QTYS.                                              03510701
035108                                                                  03510801
035109     MOVE RC109-CARTON-NBR TO SHUUPC-SHIPT-UNT-ID.                03510903
035110     MOVE ZEROES           TO PV-SSCC-SKU-COUNT                   03511002
035111                              PV-SSCC-UNT-QTY.                    03511102
035112                                                                  03511201
035120     EXEC SQL                                                     03512001
035130         SELECT COUNT(DISTINCT C.SKU_NBR)                         03513002
035140              , SUM(A.SHPD_QTY)                                   03514002
035160           INTO :PV-SSCC-SKU-COUNT                                03516002
035170              , :PV-SSCC-UNT-QTY:PV-NULL                          03517005
035190           FROM TSHUUPC A                                         03519002
035200              , XLT_UPC B                                         03520002
035210              , XLT_SKU C                                         03521002
035300          WHERE A.SHIPT_UNT_ID   =  :SHUUPC-SHIPT-UNT-ID          03530004
035400            AND A.UPC_NBR        =  B.UPC_NBR                     03540002
035500            AND B.INTR_UPC_ID    =  C.INTR_UPC_ID                 03550002
035511            WITH  UR                                              03551101
035512     END-EXEC.                                                    03551201
035513                                                                  03551301
035514     EVALUATE TRUE                                                03551401
035515         WHEN SQLCODE = +0                                        03551501
 VIG             IF PV-NULL < 0                                         03551607
 VIG                 MOVE ZEROS  TO  PV-SSCC-UNT-QTY                    03551707
 VIG             END-IF                                                 03551807
035516              CONTINUE                                            03551902
035519                                                                  03552001
035520         WHEN SQLWARN0 NOT = SPACES                               03552101
035521         WHEN SQLCODE < +0                                        03552201
035522         WHEN SQLCODE > +0                                        03552301
035523             DISPLAY ' '                                          03552401
035524             DISPLAY 'SQL ERROR - PO: ' RC109-PO-NBR              03552501
035525                                                                  03552601
035526             MOVE SQLCODE          TO  PV-DISP-SQLCODE            03552701
035527             SET PS-ERROR          TO  TRUE                       03552801
035528             DISPLAY '******************************************' 03552901
035529             DISPLAY '*ABEND                                   *' 03553001
035530             DISPLAY '*PROGRAM   = RCKUT184                    *' 03553101
035531             DISPLAY '*DB2 OPER  = SELECT TSHUUPC-XLT_UPC/SKU  *' 03553202
035532             DISPLAY '*PARAGRAPH = 3100-SKU-UNIT-QTYS          *' 03553302
035533             DISPLAY '*SQLCODE = ' PV-DISP-SQLCODE                03553401
035534             DISPLAY '*PO-NBR  = ' RC109-PO-NBR                   03553501
035535             DISPLAY '******************************************' 03553601
035536             PERFORM 9100-SQL-ABEND                               03553701
035537     END-EVALUATE.                                                03553801
035538                                                                  03553901
035539                                                                  03554001
035760*----------------------------------------------------------------*03576000
035770* READ INPUT ASN FILE                                            *03577000
035780*----------------------------------------------------------------*03578000
035790 8000-READ-INPUT.                                                 03579000
035800                                                                  03580000
035900     READ  INPUT-FILE                                             03590000
036000           INTO  RC109-ASN-TRANSCRIPTION-RECORD                   03600002
036100           AT END                                                 03610000
036200                 SET PS-END-OF-FILE  TO  TRUE                     03620000
036300           NOT AT END                                             03630000
036400                 ADD 1  TO  PV-READ-COUNT                         03640000
037400     END-READ.                                                    03740000
037500                                                                  03750000
037600*----------------------------------------------------------------*03760000
037700* OUTPUT FILE - SSCC WITH SKU COUNT & UNIT QTY SUM               *03770002
037800*----------------------------------------------------------------*03780000
037900 8100-WRITE-OUTPUT.                                               03790004
038000                                                                  03800000
039300     WRITE ASN-MIXSKU-SUM-RECORD                                  03930002
039400           FROM  RC110-DCBULK-MIXSKU-SUM-REC.                     03940002
039500                                                                  03950000
039600     ADD  1  TO  PV-OUTPUT-COUNT.                                 03960004
039700                                                                  03970000
039800                                                                  03980000
041000*-----------------------------------------------------------------04100000
041100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04110000
041200*  ERROR OR WARNING CODE OCCURS.                                  04120000
041300*-----------------------------------------------------------------04130000
041400 9100-SQL-ABEND.                                                  04140000
041500                                                                  04150000
041600     DISPLAY '9100-SQL-ABEND'.                                    04160000
041700     DISPLAY '** ABEND     **'.                                   04170000
041800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04180000
041900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04190000
042000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04200000
042100                                                                  04210000
042200******************************************************************04220000
042300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04230000
042400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04240000
042500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04250000
042600* FORMAT.                                                         04260000
042700******************************************************************04270000
042800     COPY DPPD004.                                                04280000
042900                                                                  04290000
043000     MOVE +4013                  TO ABEND-CODE.                   04300000
043100     CALL 'ILBOABN0' USING ABEND-CODE.                            04310000
043200                                                                  04320000
