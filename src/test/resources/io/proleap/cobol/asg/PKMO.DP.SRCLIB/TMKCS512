000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TMKCS512.                                         00040099
000500 AUTHOR.        VIRGENE LENNEMAN.                                 00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  03-10-98.                                         00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    E512 - PO NOTIFICATION/TROUBLE LIST PROGRAM - BUYING OFFICE* 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM WILL PRODUCE A LIST OF NOTIFICATION AND       * 00130099
001400*    TROUBLE RECORDS FOR EITHER A SINGLE PO OR MULTIPLE PO'S.   * 00140099
001500*                                                               * 00150099
001600*    THE APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR       * 00160099
001700*    SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.      * 00170099
001800*                                                               * 00180099
001900*    THE DP030-OVERRIDE-APPL-ERROR SWITCH IS SET TO TRUE WHEN   * 00190099
002000*    ENTERING THE PROGRAM IN ORDER TO GIVE CONTROL BACK TO THE  * 00200099
002100*    LIST WHEN A NEXT-ACT-APPL-ERROR IS SENT BACK FROM THE      * 00210099
002200*    UPDATE.  THE DP030-RC-APPL-ERROR IS CHECKED TO DETERMINE   * 00220099
002300*    IF A NEXT-ACT-APPL-ERROR IS BEING RETURNED TO THE LIST.    * 00230099
002400*                                                               * 00240099
002500*---------------------------------------------------------------* 00250099
002510* CHANGE HISTORY:                                               * 00251099
002511*    CHANGES                                                    * 00251199
002512*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              * 00251299
002513*     DATE:    11/06/2014                                       * 00251399
002514*                                                               * 00251499
002515*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO# * 00251599
002516*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/11/2014    * 00251699
002517***************************************************************** 00251799
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00251999
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00252099
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00252199
002517***************************************************************** 00252299
CICS  * CHANGED 11/09/2022    BY JIM HUNTER      WR: CHG0278008         00252399
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00252499
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00252599
CICS  *-----------------------------------------------------------------00252699
002518 EJECT                                                            00252799
002519 ENVIRONMENT DIVISION.                                            00252899
002520                                                                  00252999
002530 DATA DIVISION.                                                   00253099
002540                                                                  00254099
002550 WORKING-STORAGE SECTION.                                         00255099
002560                                                                  00256099
002570*----------------------------------------------------------------*00257099
002580*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *00258099
002590*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *00259099
002600*----------------------------------------------------------------*00260099
002700                                                                  00270099
002800     COPY RCWS013.                                                00280099
002900/                                                                 00290099
003000     COPY PCWS016.                                                00300099
003100/                                                                 00310099
003200     COPY DSWS002.                                                00320099
003300                                                                  00330099
003400 01  DK-DB2-KEYS.                                                 00340099
003500     05  DK-RESP-AREA-1                 PIC  X(01).               00350099
003600     05  DK-RESP-AREA-2                 PIC  X(01).               00360099
003700     05  DK-RESP-AREA-3                 PIC  X(01).               00370099
003800     05  DK-REC-SEQ-NBR                 PIC S9(09)  COMP.         00380099
003900     05  DK-REC-SEQ-NBR-LOW             PIC S9(09)  COMP.         00390099
004000     05  DK-REC-SEQ-NBR-HIGH            PIC S9(09)  COMP.         00400099
004100     05  DK-PO-NBR                      PIC S9(09)  COMP.         00410099
004200     05  DK-PO-NBR-LOW                  PIC S9(09)  COMP.         00420099
004300     05  DK-PO-NBR-HIGH                 PIC S9(09)  COMP.         00430099
004400     05  DK-DEPT-LOW                    PIC  X(03).               00440099
004500     05  DK-DEPT-HIGH                   PIC  X(03).               00450099
004510     05  DK-DEPT-NBR                    PIC  X(03).               00451099
004600     05  DK-TRBL-RSN-LOW                PIC S9(04)  COMP.         00460099
004700     05  DK-TRBL-RSN-HIGH               PIC S9(04)  COMP.         00470099
004800     05  DK-BUYER-NBR                   PIC  X(03).               00480099
004900     05  DK-BUYER-NBR-N                 REDEFINES                 00490099
005000         DK-BUYER-NBR                   PIC  9(03).               00500099
005100     05  DK-VENDOR-NAME                 PIC  X(30).               00510099
005200     05  DK-ENT-ID                      PIC S9(09)  COMP.         00520099
005300     05  DK-NOTIF-STAT-1                PIC  X(01).               00530099
005400     05  DK-NOTIF-STAT-2                PIC  X(01).               00540099
005500     05  DK-NOTIF-STAT-3                PIC  X(01).               00550099
005600     05  DK-NOTIF-STAT-4                PIC  X(01).               00560099
005700     05  DK-LOW-REC-TMST                PIC  X(26)  VALUE SPACES. 00570099
005800     05  DK-HIGH-REC-TMST               PIC  X(26)  VALUE SPACES. 00580099
005900     05  DK-TRBL-LVL-1                  PIC  X(01).               00590099
006000     05  DK-TRBL-LVL-2                  PIC  X(01).               00600099
006100     05  DK-TRBL-LVL-3                  PIC  X(01).               00610099
006200     05  DK-TRBL-LVL-4                  PIC  X(01).               00620099
006300     05  DK-TRBL-LVL-5                  PIC  X(01).               00630099
006400     05  DK-LOW-TRB-TMST                PIC  X(26)  VALUE SPACES. 00640099
006500     05  FILLER REDEFINES DK-LOW-TRB-TMST.                        00650099
006600         10  DK-LOW-TRBL-DATE           PIC  X(10).               00660099
006700         10  DK-LOW-TRBL-TIME           PIC  X(16).               00670099
006800     05  DK-HIGH-TRB-TMST               PIC  X(26)  VALUE SPACES. 00680099
006900     05  FILLER REDEFINES DK-HIGH-TRB-TMST.                       00690099
007000         10  DK-HIGH-TRBL-DATE          PIC  X(10).               00700099
007100         10  DK-HIGH-TRBL-TIME          PIC  X(16).               00710099
007200                                                                  00720099
007300 01  PC-PROGRAM-CONSTANTS.                                        00730099
007400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00740099
007500                                                    'TM512A  '.   00750099
007600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00760099
007700                                                    'TMKM512 '.   00770099
007800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00780099
007900                                                    'TMKCS512'.   00790099
008000     05  PC-TMKCS520                    PIC  X(08)  VALUE         00800099
008100                                                    'TMKCS520'.   00810099
008200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00820099
008300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00830099
008400     05  PC-ENTERED-USING-IND           PIC  X(01).               00840099
008500         88  PC-CRIT-SPEC-FORMAT              VALUE '1'.          00850099
008600         88  PC-ENTERED-USING-PO-PO011        VALUE '2'.          00860099
008700         88  PC-ENTERED-USING-PO-PO017        VALUE '3'.          00870099
008800         88  PC-ENTERED-USING-PO-PO013        VALUE '4'.          00880099
008900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00890099
009000                                                    COMP SYNC.    00900099
009100     05  PC-ITEMS-PER-PANEL-COMP3       PIC S9(09)  VALUE +13     00910099
009200                                                    COMP-3.       00920099
009300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00930099
009400                                                    COMP SYNC.    00940099
009500     05  PC-MAX-TABLE-ENTRIES           PIC S9(04)  VALUE +20     00950099
009600                                                    COMP SYNC.    00960099
009700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00970099
009800                                                    +1000000      00980099
009900                                                    COMP-3.       00990099
010000     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01000099
010100                                                    COMP SYNC.    01010099
010200     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01020099
010300                                                    COMP-3.       01030099
010400     05  PC-000000000                   PIC S9(09)  VALUE         01040099
010500                                                    +000000000    01050099
010600                                                    COMP.         01060099
010700     05  PC-999999999                   PIC S9(09)  VALUE         01070099
010800                                                    +999999999    01080099
010900                                                    COMP.         01090099
011000     05  PC-ACTIVE-STATUS               PIC  X(01)  VALUE 'A'.    01100099
011100     05  PC-NEW-TROUBLE                 PIC  X(01)  VALUE 'N'.    01110099
011200     05  PC-IN-PROCESS-TROUBLE          PIC  X(01)  VALUE 'I'.    01120099
011300     05  PC-RESOLVED-TROUBLE            PIC  X(01)  VALUE 'R'.    01130099
011400     05  PC-ACKNOWLEDGED-TROUBLE        PIC  X(01)  VALUE 'A'.    01140099
011500     05  PC-BUY-ANALYST-DC-SW           PIC  X(01)  VALUE 'D'.    01150099
011600     05  PC-BUYER                       PIC  X(01)  VALUE 'B'.    01160099
011700     05  PC-ANALYST                     PIC  X(01)  VALUE 'A'.    01170099
011800     05  PC-BUYER-ANALYST-DC            PIC  X(01)  VALUE 'D'.    01180099
011900     05  PC-SLASH                       PIC  X(01)  VALUE '/'.    01190099
012000     05  PC-SPACE                       PIC  X(01)  VALUE ' '.    01200099
012100     05  PC-TYPE-CODE-LONG-NAME         PIC  X(02)  VALUE '01'.   01210099
012200     05  PC-TYPE-CODE-SHORT-NAME        PIC  X(02)  VALUE '04'.   01220099
012300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  01230099
012400     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  01240099
012500     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  01250099
012600     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  01260099
012700     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    01270099
012800     05  PC-DUMMY-DB2-DATE-LOW          PIC  X(26)  VALUE         01280099
012900         '0001-01-01-00.00.00.000000'.                            01290099
013000     05  PC-DUMMY-DB2-DATE-HIGH         PIC  X(26)  VALUE         01300099
013100         '9999-09-09-09.09.09.999999'.                            01310099
013200     05  PC-DUMMY-DB2-DATE              PIC  X(26)  VALUE         01320099
013300         '9999-09-09-09.09.09.999999'.                            01330099
013400     05  PC-DUMMY-DATE                  PIC  X(10)  VALUE         01340099
013500                                        '9999-09-09'.             01350099
013600     05  PC-DUMMY-TIME-HIGH             PIC  X(16)  VALUE         01360099
013700                                        '-23.59.59.999999'.       01370099
013800     05  PC-IN-PROCESS-MSG              PIC  X(32)  VALUE         01380099
013900         'IN THE PROCESS OF BEING RESOLVED'.                      01390099
014000                                                                  01400099
014100     05  PC-TSYMSG-NUMBERS.                                       01410099
014200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01420099
014300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01430099
014400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01440099
014500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01450099
014600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01460099
014700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01470099
014800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01480099
014900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01490099
015000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01500099
015100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01510099
015200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01520099
015300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01530099
015400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01540099
015500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01550099
015600                                                                  01560099
015700         10  PC-TSYMSG-00938            PIC  9(05)  VALUE 00938.  01570099
015800*        TROUBLE/NOTIF HAS ALREADY BEEN RESOLVED                  01580099
015900                                                                  01590099
016000         10  PC-TSYMSG-00986            PIC  9(05)  VALUE 00986.  01600099
016100*        NOTIF/TROUBLE LIST-BY-LINE SCREEN MUST BE USED           01610099
016200                                                                  01620099
016300         10  PC-TSYMSG-00994            PIC  9(05)  VALUE 00994.  01630099
016400*        TABLE LIMITS EXCEEDED, RESULTS COULD BE INACCURATE,      01640099
016500*        CONTACT HELP DESK                                        01650099
016600                                                                  01660099
016700         10  PC-TSYMSG-01025            PIC  9(05)  VALUE 01025.  01670099
016800*        TROUBLE RESOLUTION NOT REQUIRED                          01680099
016900                                                                  01690099
017000         10  PC-TSYMSG-01029            PIC  9(05)  VALUE 01029.  01700099
017100*        DEPARTMENT, BUYER, OR PO NBR REQUIRED FOR LIST           01710099
017200                                                                  01720099
017300         10  PC-TSYMSG-01031            PIC  9(05)  VALUE 01031.  01730099
017400*        TROUBLE MUST BE RESOLVED MANUALLY                        01740099
017500                                                                  01750099
017600         10  PC-TSYMSG-01032            PIC  9(05)  VALUE 01032.  01760099
017700*        RECORD IS ALREADY IN PROCESS                             01770099
017800                                                                  01780099
017900         10  PC-TSYMSG-01033            PIC  9(05)  VALUE 01033.  01790099
018000*        RECORD IS RESOLVED - IN-PROCESS REQUEST INVALID          01800099
018100                                                                  01810099
018200         10  PC-TSYMSG-01034            PIC  9(05)  VALUE 01034.  01820099
018300*        SOME UNRESOLVED TROUBLE STILL EXISTS                     01830099
018400                                                                  01840099
018500         10  PC-TSYMSG-01036            PIC  9(05)  VALUE 01036.  01850099
018600*        NOTIFICATION/TROUBLE IS ACKNOWLEDGED - CAN NOT RESOLVE   01860099
018700                                                                  01870099
018800         10  PC-TSYMSG-01037            PIC  9(05)  VALUE 01037.  01880099
018900*        RECORD IS NOT RESOLVED - CANNOT ACKNOWLEDGE              01890099
019000                                                                  01900099
019100         10  PC-TSYMSG-01038            PIC  9(05)  VALUE 01038.  01910099
019200*        NOTIFICATION/TROUBLE NOT FOUND                           01920099
019300                                                                  01930099
019400         10  PC-TSYMSG-01089            PIC  9(05)  VALUE 01089.  01940099
019500*        NOTIFICATION/TROUBLE NOT AVAILABLE                       01950099
019600*                                                                 01960099
019700 01  PS-PROGRAM-SWITCHES.                                         01970099
019800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01980099
019900         88  PS-NO-ERROR                            VALUE 'Y'.    01990099
020000         88  PS-ERROR                               VALUE 'N'.    02000099
020100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02010099
020200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02020099
020300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02030099
020400     05  PS-PO-NBR-ENTERED-SW           PIC  X(01)  VALUE 'N'.    02040099
020500         88  PS-PO-NBR-ENTERED                      VALUE 'Y'.    02050099
020600         88  PS-PO-NBR-NOT-ENTERED                  VALUE 'N'.    02060099
020700     05  PS-TRBL-RSN-LOADED-SW          PIC  X(01)  VALUE 'N'.    02070099
020800         88  PS-TRBL-RSN-LOADED                     VALUE 'Y'.    02080099
020900         88  PS-TRBL-RSN-NOT-LOADED                 VALUE 'N'.    02090099
021000     05  PS-DISPLAY-LINE-SW             PIC  X(01)  VALUE 'Y'.    02100099
021100         88  PS-DISPLAY-TROUBLE-LINE                VALUE 'Y'.    02110099
021200         88  PS-DO-NOT-DISPLAY-TROUBLE-LINE         VALUE 'N'.    02120099
021300     05  PS-PROCESS-LINE-SW             PIC  X(01)  VALUE 'Y'.    02130099
021400         88  PS-PROCESS-TROUBLE-LINE                VALUE 'Y'.    02140099
021500         88  PS-DO-NOT-PROCESS-LINE                 VALUE 'N'.    02150099
021600     05  PS-RESOLVE-REQUEST-SW          PIC  X(01)  VALUE 'N'.    02160099
021700         88  PS-RESOLVE-REQUEST                     VALUE 'Y'.    02170099
021800         88  PS-NOT-A-RESOLVE-REQUEST               VALUE 'N'.    02180099
021900     05  PS-IN-PROC-REQUEST-SW          PIC  X(01)  VALUE 'N'.    02190099
022000         88  PS-IN-PROC-REQUEST                     VALUE 'Y'.    02200099
022100     05  PS-FIRST-TIME-SW               PIC  X(01)  VALUE 'Y'.    02210099
022200         88  PS-FIRST-TIME                          VALUE 'Y'.    02220099
022300         88  PS-NOT-FIRST-TIME                      VALUE 'N'.    02230099
022400     05  PS-ITEMS-LEFT-SW               PIC  X(01)  VALUE 'Y'.    02240099
022500         88  PS-TRBL-NOTIF-ITEMS-LEFT               VALUE 'Y'.    02250099
022600         88  PS-NO-TRBL-NOTIF-ITEMS-LEFT            VALUE 'N'.    02260099
022700     05  PS-TRBL-DTL-EXISTS-SW          PIC  X(01)  VALUE 'N'.    02270099
022800         88  PS-TRBL-DTL-EXISTS                     VALUE 'Y'.    02280099
022900         88  PS-NO-TRBL-DTL-EXISTS                  VALUE 'N'.    02290099
023000     05  PS-USE-CSR-SW                  PIC  X(01)  VALUE ' '.    02300099
023100         88  PS-USE-BYR-CSR                         VALUE 'B'.    02310099
023200         88  PS-USE-DEPT-CSR                        VALUE 'D'.    02320099
023300         88  PS-USE-PORCVR-CSR                      VALUE 'P'.    02330099
023400*                                                                 02340099
023500 01  PV-PROGRAM-VARIABLES.                                        02350099
023600     05  PV-SUB                         PIC S9(04)  VALUE +0      02360099
023700                                                    COMP SYNC.    02370099
023800     05  PV-SUB-COMP3                   PIC S9(09)  VALUE +0      02380099
023900                                                    COMP-3.       02390099
024000     05  PV-ASC-ITEM-SUB-COMP3          PIC S9(09)  VALUE +0      02400099
024100                                                    COMP-3.       02410099
024200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02420099
024300                                                    COMP SYNC.    02430099
024400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02440099
024500                                                    COMP-3.       02450099
024600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02460099
024700                                                    COMP-3.       02470099
024800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02480099
024900                                                    COMP-3.       02490099
025000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02500099
025100                                                    COMP-3.       02510099
025200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02520099
025300                                                    COMP-3.       02530099
025400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02540099
025500                                                    COMP-3.       02550099
025600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02560099
025700                                                    COMP SYNC.    02570099
025800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02580099
025900                                                    COMP SYNC.    02590099
026000     05  PV-COMMAREA-LENGTH             PIC S9(04)  VALUE +0      02600099
026100                                                    COMP SYNC.    02610099
026200     05  PV-ITEM                        PIC S9(04)  VALUE +0      02620099
026300                                                    COMP SYNC.    02630099
026400     05  PV-ITEM-COMP3                  PIC S9(09)  VALUE +0      02640099
026500                                                    COMP-3.       02650099
026600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02660099
026700                                                    COMP SYNC.    02670099
026800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02680099
026900                                                    COMP SYNC.    02690099
027000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02700099
027100                                                    COMP SYNC.    02710099
027200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02720099
027300                                                    COMP SYNC.    02730099
027400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02740099
027500                                                    COMP SYNC.    02750099
027600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02760099
027700                                                    COMP SYNC.    02770099
027800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02780099
027900                                                    COMP SYNC.    02790099
028000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02800099
028100                                                    COMP SYNC.    02810099
028200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02820099
028300                                                    COMP SYNC.    02830099
028400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02840099
028500                                                    COMP SYNC.    02850099
028600     05  PV-TRBL-RSN-SUB                PIC S9(04)  VALUE +0      02860099
028700                                                    COMP SYNC.    02870099
028800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02880099
028900                                                    COMP SYNC.    02890099
029000     05  PV-PREV-REC-SEQ-NBR            PIC S9(09)  VALUE +0      02900099
029100                                                    COMP SYNC.    02910099
029200     05  PV-UNRESOLVED-TROUBLE-COUNT    PIC S9(09)  VALUE +0      02920099
029300                                                    COMP-3.       02930099
029400     05  PV-PREV-PO-NBR                 PIC S9(09)  VALUE +0      02940099
029500                                                    COMP SYNC.    02950099
029600     05  PV-PREV-DEPT-NBR               PIC  X(03)  VALUE SPACES. 02960099
029700     05  PV-UNPACK-OPER-UNT-ID          PIC  9(04)  VALUE ZEROS.  02970099
029800     05  PV-MAX-RESP-DATE               PIC  X(26)  VALUE SPACES. 02980099
029900*PS 10/11/2014 CHANGE STARTS                                      02990099
030000     05  PV-ERROR-PO-NBR                PIC  9(08)  VALUE ZEROS.  03000099
030100*PS 10/11/2014 CHANGE ENDS                                        03010099
030200     05  PV-ERROR-REC-SEQ-NBR           PIC  9(04)  VALUE ZEROS.  03020099
030300     05  PV-ERROR-PO-LNE-NBR            PIC  9(04)  VALUE ZEROS.  03030099
030400     05  PV-ERROR-PACK-ID               PIC  9(04)  VALUE ZEROS.  03040099
030500     05  PV-ERROR-NOTIF-NBR             PIC  9(09)  VALUE ZEROS.  03050099
030600     05  PV-ERROR-TRBL-RSN-CDE          PIC  9(04)  VALUE ZEROS.  03060099
030700     05  PV-TIMESTAMP                   PIC  X(26)  VALUE SPACES. 03070099
030800     05  PV-TIMESTAMP-R                 REDEFINES                 03080099
030900         PV-TIMESTAMP.                                            03090099
031000         10  PV-TIMESTAMP-YEAR          PIC  9(04).               03100099
031100         10  FILLER                     PIC  X(01).               03110099
031200         10  PV-TIMESTAMP-MONTH         PIC  9(02).               03120099
031300         10  FILLER                     PIC  X(01).               03130099
031400         10  PV-TIMESTAMP-DAY           PIC  9(02).               03140099
031500         10  FILLER                     PIC  X(01).               03150099
031600         10  PV-TIMESTAMP-HOUR          PIC  9(02).               03160099
031700         10  FILLER                     PIC  X(01).               03170099
031800         10  PV-TIMESTAMP-MINUTE        PIC  9(02).               03180099
031900         10  FILLER                     PIC  X(01).               03190099
032000         10  PV-TIMESTAMP-SECONDS       PIC  9(02).               03200099
032100         10  FILLER                     PIC  X(01).               03210099
032200         10  PV-TIMESTAMP-MILLISECONDS  PIC  9(06).               03220099
032300     05  PV-LOC-5-NM.                                             03230099
032400         10  PV-DC                      PIC  X(02).               03240099
032500         10  FILLER                     PIC  X(01).               03250099
032510         10  PV-DC-NME                  PIC  X(02).               03251099
032520     05  PV-LOC-4-CHAR-NM.                                        03252099
032530         10  PV-DC-NME-4                PIC  X(02).               03253099
032540         10  PV-DC-4                    PIC  X(02).               03254099
032550     05  PV-STORE-X.                                              03255099
032560         10  PV-STORE-N                 PIC  9(04).               03256099
032570*                                                                 03257099
032580 01  TR-TROUBLE-REASON-TABLE.                                     03258099
032590     05  TR-TROUBLE-REASON-ENTRY        OCCURS 20 TIMES           03259099
032600                                        INDEXED BY TR-TRBL-IDX.   03260099
032700         10  TR-TROUBLE-REASON          PIC  X(04)  VALUE SPACES. 03270099
032800         10  TR-TROUBLE-REASON-N        REDEFINES                 03280099
032900             TR-TROUBLE-REASON          PIC  9(04).               03290099
033000/                                                                 03300099
033100*                                                                 03310099
033200******************************************************************03320099
033300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03330099
033400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03340099
033500**  APPLICATION-SPECIFIC COMMAREA.                              **03350099
033600******************************************************************03360099
033700 01  LQW-LIST-QUEUE-WORK-AREA.                                    03370099
033800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03380099
033900     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           03390099
034000                                        INDEXED BY LQW-IDX.       03400099
034100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03410099
034200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03420099
034300         10  LQW-SELECTED-SW            PIC  X(01).               03430099
034400             88  LQW-SELECT                         VALUE 'S'.    03440099
034500             88  LQW-DESELECT                       VALUE ' '.    03450099
034600         10  LQW-ACTION                 PIC  X(03).               03460099
034700             88  LQW-ERROR                          VALUE 'ERR'.  03470099
034800             88  LQW-INQUIRE                        VALUE 'INQ'.  03480099
034900             88  LQW-UPDATE                         VALUE 'UPD'.  03490099
035000         10  LQW-NOTIF-NBR              PIC S9(09)  COMP.         03500099
035100         10  LQW-OPER-UNT-ID            PIC S9(04)  COMP.         03510099
035200         10  LQW-FCLTY-ID               PIC S9(04)  COMP.         03520099
035300         10  LQW-DEPT                   PIC  9(03).               03530099
035400*PS 10/11/2014 STARTS                                             03540099
035500         10  LQW-PO-NBR                 PIC  9(08).               03550099
035600*PS 10/11/2014 ENDS                                               03560099
035700         10  LQW-RCVR-SEQ-NBR           PIC  9(04).               03570099
035800         10  LQW-PO-LNE-NBR             PIC  9(04).               03580099
035900         10  LQW-PREPK-ID               PIC  9(04).               03590099
036000         10  LQW-ENT-ID                 PIC S9(09)  COMP.         03600099
036100         10  LQW-VENDOR-SHORT-NME       PIC  X(10).               03610099
036200         10  LQW-FCLTY-SHORT-NME        PIC  X(04).               03620099
036300         10  LQW-TROUBLE-REASON-CDE     PIC S9(04)  COMP.         03630099
036400         10  LQW-TROUBLE-REASON-DESC    PIC  X(10).               03640099
036500         10  LQW-TROUBLE-RESP-RES-IND   PIC  X(01).               03650099
036600             88  LQW-RESOLVE-NOT-REQUIRED           VALUE ' '.    03660099
036700             88  LQW-RESOLVE-TRBL-AUTO              VALUE 'A'.    03670099
036800             88  LQW-RESOLVE-TRBL-MANUAL            VALUE 'M'.    03680099
036900             88  LQW-RESOLVE-TRBL-BOTH-AUTO-MAN     VALUE 'B'.    03690099
037000         10  LQW-TROUBLE-REASON-LVL     PIC  X(01).               03700099
037100             88  LQW-TROUBLE-PO-LEVEL               VALUE 'P'.    03710099
037200             88  LQW-TROUBLE-PACK-LEVEL             VALUE 'M'.    03720099
037300             88  LQW-TROUBLE-LINE-LEVEL             VALUE ' '     03730099
037400                                                          'L'     03740099
037500                                                          'S'     03750099
037600                                                          'X'.    03760099
037700         10  LQW-ARRIVAL-DATE-TIME      PIC  X(08).               03770099
037800         10  LQW-NOTIFICATION-DATE-TIME PIC  X(08).               03780099
037900         10  LQW-RESPONSE-DATE-TIME     PIC  X(08).               03790099
038000         10  LQW-TRBL-DTL-EXISTS-SW     PIC  X(01).               03800099
038100         10  LQW-TRBL-RESOLVED-SW       PIC  X(01).               03810099
038200             88  LQW-TRBL-RESOLVED                  VALUE 'Y'.    03820099
038300                                                                  03830099
038400                                                                  03840099
038500*---------------------------------------------------------------* 03850099
038600*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 03860099
038700*---------------------------------------------------------------* 03870099
038800                                                                  03880099
038900     COPY TMWS002.                                                03890099
039000                                                                  03900099
039100*---------------------------------------------------------------* 03910099
039200*  RECORD LAYOUT FOR THE PO INQUIRY AND UPDATE SELECTION TEMP   * 03920099
039300*  STORAGE QUEUE                                                * 03930099
039400*---------------------------------------------------------------* 03940099
039500                                                                  03950099
039600     COPY POWS012.                                                03960099
039700                                                                  03970099
039800                                                                  03980099
039900*---------------------------------------------------------------* 03990099
040000*    MAP LAYOUT                                                 * 04000099
040100*---------------------------------------------------------------* 04010099
040200                                                                  04020099
040300     COPY TMKM512.                                                04030099
040400*                                                                 04040099
040500 01  MR-OCCURS-LAYOUT                   REDEFINES  TM512AO.       04050099
040600     05  FILLER                         PIC X(42).                04060099
040700     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          04070099
040800         10  MR-SELECTL                 PIC S9(04) COMP.          04080099
040900         10  MR-SELECTA                 PIC  X(01).               04090099
041000         10  MR-SELECTC                 PIC  X(01).               04100099
041100         10  MR-SELECTH                 PIC  X(01).               04110099
041200         10  MR-SELECTI                 PIC  X(01).               04120099
041300                                                                  04130099
041400         10  MR-ACTIONL                 PIC S9(04) COMP.          04140099
041500         10  MR-ACTIONA                 PIC  X(01).               04150099
041600         10  MR-ACTIONC                 PIC  X(01).               04160099
041700         10  MR-ACTIONH                 PIC  X(01).               04170099
041800         10  MR-ACTION                  PIC  X(03).               04180099
041900                                                                  04190099
042000         10  MR-DEPTL                   PIC S9(04) COMP.          04200099
042100         10  MR-DEPTA                   PIC  X(01).               04210099
042200         10  MR-DEPTC                   PIC  X(01).               04220099
042300         10  MR-DEPTH                   PIC  X(01).               04230099
042400         10  MR-DEPT.                                             04240099
042500             15  MR-DEPT-N              PIC  9(03).               04250099
042600                                                                  04260099
042700         10  MR-PO-NBRL                 PIC S9(04) COMP.          04270099
042800         10  MR-PO-NBRA                 PIC  X(01).               04280099
042900         10  MR-PO-NBRC                 PIC  X(01).               04290099
043000         10  MR-PO-NBRH                 PIC  X(01).               04300099
043100*PS 10/11/2014 CHANGE STARTS                                      04310099
043200         10  MR-PO-NBR.                                           04320099
043300             15  MR-PO-NBR-N            PIC  Z(08).               04330099
043310*PS 10/11/2014 CHANGE ENDS                                        04331099
043320                                                                  04332099
043330         10  MR-RCVR-SEQ-NBRL           PIC S9(04) COMP.          04333099
043340         10  MR-RCVR-SEQ-NBRA           PIC  X(01).               04334099
043350         10  MR-RCVR-SEQ-NBRC           PIC  X(01).               04335099
043360         10  MR-RCVR-SEQ-NBRH           PIC  X(01).               04336099
043370         10  MR-RCVR-SEQ-NBR.                                     04337099
043380             15  MR-RCVR-SEQ-NBR-N      PIC  9(04).               04338099
043390                                                                  04339099
043400         10  MR-VENDOR-NMEL             PIC S9(04) COMP.          04340099
043500         10  MR-VENDOR-NMEA             PIC  X(01).               04350099
043600         10  MR-VENDOR-NMEC             PIC  X(01).               04360099
043700         10  MR-VENDOR-NMEH             PIC  X(01).               04370099
043800         10  MR-VENDOR-NME              PIC  X(10).               04380099
043900                                                                  04390099
044000         10  MR-LOCATION-SHORT-NMEL     PIC S9(04) COMP.          04400099
044100         10  MR-LOCATION-SHORT-NMEA     PIC  X(01).               04410099
044200         10  MR-LOCATION-SHORT-NMEC     PIC  X(01).               04420099
044300         10  MR-LOCATION-SHORT-NMEH     PIC  X(01).               04430099
044400         10  MR-LOCATION-SHORT-NME      PIC  X(04).               04440099
044500                                                                  04450099
044600         10  MR-TROUBLE-REASONL         PIC S9(04) COMP.          04460099
044700         10  MR-TROUBLE-REASONA         PIC  X(01).               04470099
044800         10  MR-TROUBLE-REASONC         PIC  X(01).               04480099
044900         10  MR-TROUBLE-REASONH         PIC  X(01).               04490099
045000         10  MR-TROUBLE-REASON          PIC  X(10).               04500099
045100                                                                  04510099
045200         10  MR-ARRIVAL-DATE-TIMEL      PIC S9(04) COMP.          04520099
045300         10  MR-ARRIVAL-DATE-TIMEA      PIC  X(01).               04530099
045400         10  MR-ARRIVAL-DATE-TIMEC      PIC  X(01).               04540099
045500         10  MR-ARRIVAL-DATE-TIMEH      PIC  X(01).               04550099
045600         10  MR-ARRIVAL-DATE-TIME       PIC  X(08).               04560099
045700                                                                  04570099
045800         10  MR-NOTIFICATION-DATE-TIMEL PIC S9(04) COMP.          04580099
045900         10  MR-NOTIFICATION-DATE-TIMEA PIC  X(01).               04590099
046000         10  MR-NOTIFICATION-DATE-TIMEC PIC  X(01).               04600099
046100         10  MR-NOTIFICATION-DATE-TIMEH PIC  X(01).               04610099
046200         10  MR-NOTIFICATION-DATE-TIME  PIC  X(08).               04620099
046300                                                                  04630099
046400         10  MR-RESPONSE-DATE-TIMEL     PIC S9(04) COMP.          04640099
046500         10  MR-RESPONSE-DATE-TIMEA     PIC  X(01).               04650099
046600         10  MR-RESPONSE-DATE-TIMEC     PIC  X(01).               04660099
046700         10  MR-RESPONSE-DATE-TIMEH     PIC  X(01).               04670099
046800         10  MR-RESPONSE-DATE-TIME      PIC  X(08).               04680099
046900                                                                  04690099
047000     EJECT                                                        04700099
047100*---------------------------------------------------------------* 04710099
047200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04720099
047300*---------------------------------------------------------------* 04730099
047400                                                                  04740099
047500     COPY DPWS015.                                                04750099
047600                                                                  04760099
047700*---------------------------------------------------------------* 04770099
047800*    FUNCTION KEYS COPYBOOK.                                    * 04780099
047900*---------------------------------------------------------------* 04790099
048000                                                                  04800099
048100     COPY DPWS016.                                                04810099
048200                                                                  04820099
048300*---------------------------------------------------------------* 04830099
048400*    NUMERIC EDIT LAYOUT.                                       * 04840099
048500*---------------------------------------------------------------* 04850099
048600                                                                  04860099
048700     COPY DPWS010I.                                               04870099
048800 EJECT                                                            04880099
048900*---------------------------------------------------------------* 04890099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04900099
049100*---------------------------------------------------------------* 04910099
049200                                                                  04920099
049300     COPY DPWS030.                                                04930099
CICS       COPY DPWS930.                                                04931099
049400 EJECT                                                            04940099
049500*---------------------------------------------------------------* 04950099
049600*    PARAMETERS FOR CALLING THE TROUBLE CENTRAL PROCESSING      * 04960099
049700*    MODULE (TMKCS520).                                         * 04970099
049800*---------------------------------------------------------------* 04980099
049900                                                                  04990099
050000     COPY TMWS500.                                                05000099
050100 EJECT                                                            05010099
050200*---------------------------------------------------------------* 05020099
050300*    PARAMETERS FOR CALLING THE LOGISTICS DOMAIN LOCATION       * 05030099
050400*    MODULE (XLKUT071).                                         * 05040099
050500*---------------------------------------------------------------* 05050099
050600                                                                  05060099
050700     COPY XLWS071.                                                05070099
050800 EJECT                                                            05080099
050900*---------------------------------------------------------------* 05090099
051000*    STANDARD COMMAREA.                                         * 05100099
051100*---------------------------------------------------------------* 05110099
051200                                                                  05120099
051300     COPY DPWS020.                                                05130099
051400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05140099
051500                                                                  05150099
051600*---------------------------------------------------------------* 05160099
051700* INTER-APPLICATION COMMAREA.                                   * 05170099
051800*   TMWS004 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 05180099
051900*             SPEC SCREEN FOR THE BUYING OFFICE                 * 05190099
052000*---------------------------------------------------------------* 05200099
052100                                                                  05210099
052200         10  INTER-APPL-COMM-AREA       PIC X(200).               05220099
052300     COPY TMWS004.                                                05230099
052400     COPY POWS011.                                                05240099
052500     COPY POWS017.                                                05250099
052600     COPY POWS013.                                                05260099
052700                                                                  05270099
052800*---------------------------------------------------------------* 05280099
052900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05290099
053000*---------------------------------------------------------------* 05300099
053100         10  ASC-SPECIFIC-COMMAREA.                               05310099
053200             15  ASC-LOCAL-GO-DESTINATION            PIC X(01).   05320099
053300                 88  ASC-STAYING-WITHIN-TROUBLE      VALUE ' '.   05330099
053400                 88  ASC-GOING-TO-PO                 VALUE '1'.   05340099
053500                 88  ASC-RETURNING-FROM-PO           VALUE '1'.   05350099
053600             15  ASC-KEY-FIELDS.                                  05360099
053700                 20  ASC-RESPONSIBILITY-AREA-SW      PIC X(01).   05370099
053800                     88  ASC-RA-BUYER-SW             VALUE 'B'.   05380099
053900                     88  ASC-RA-ANALYST-SW           VALUE 'A'.   05390099
054000                     88  ASC-RA-BUY-ANALYST-SW       VALUE 'Y'.   05400099
054100                     88  ASC-RA-BUY-ANALYST-DC-SW    VALUE 'D'.   05410099
054200                 15  ASC-RESPONSIBILITY-AREA.                     05420099
054300                     20  ASC-RA-BUYER               PIC X(01).    05430099
054400                     20  ASC-RA-ANALYST             PIC X(01).    05440099
054500                     20  ASC-RA-BUYER-ANALYST       PIC X(01).    05450099
054600                     20  ASC-RA-BUYER-ANALYST-DC    PIC X(01).    05460099
054700                 20  ASC-KEY-PO-NBR                  PIC 9(08).   05470099
054800                 20  ASC-DEPT                        PIC X(03).   05480099
054900                 20  ASC-BUYER                       PIC 9(02).   05490099
055000                 20  ASC-KEY-ENT-ID                  PIC 9(09).   05500099
055100                 20  ASC-KEY-PACK-LVL-IND            PIC X(01).   05510099
055200                 20  ASC-KEY-PACK-FR-DT              PIC X(10).   05520099
055300                 20  ASC-KEY-PACK-TO-DT              PIC X(10).   05530099
055400                 20  ASC-NOTIF-STAT                  PIC X(01).   05540099
055500                     88  ASC-ALL-NOTIF-STATS         VALUE ' '.   05550099
055600                     88  ASC-UNRSLVD-STAT-ONLY       VALUE 'U'.   05560099
055700                 20  ASC-RCVR-STATUS-SW              PIC X(01).   05570099
055800                     88  ASC-RCVR-STAT-ARR-ENR       VALUE 'B'.   05580099
055900                     88  ASC-RCVR-STAT-ARRIVED       VALUE 'A'.   05590099
056000                     88  ASC-RCVR-STAT-ENROUTE       VALUE 'E'.   05600099
056100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                05610099
056200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  05620099
056300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   05630099
056400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   05640099
056500                 20  ASC-ITEM-ARRAY.                              05650099
056600                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        05660099
056700                         30  ASC-LIST-ITEM-NUMBER                 05670099
056800                                                     PIC S9(09)   05680099
056900                                                     COMP-3.      05690099
057000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05700099
057100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05710099
057200                             88  ASC-TEMP-SELECT     VALUE 'S'.   05720099
057300                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05730099
057400                             88  ASC-TEMP-END        VALUE 'E'.   05740099
057500                         30  ASC-SELECTED-SW         PIC  X(01).  05750099
057600                             88  ASC-NO-SELECT       VALUE ' '.   05760099
057700                             88  ASC-SELECT          VALUE 'S'.   05770099
057800                             88  ASC-BEGIN           VALUE 'B'.   05780099
057900                             88  ASC-END             VALUE 'E'.   05790099
058000                         30  ASC-ACTION              PIC  X(03).  05800099
058100                         30  ASC-NOTIF-NBR           PIC S9(09)   05810099
058200                                                          COMP.   05820099
058300                         30  ASC-OPER-UNT-ID         PIC S9(04)   05830099
058400                                                          COMP.   05840099
058500                         30  ASC-FCLTY-ID            PIC S9(04)   05850099
058600                                                          COMP.   05860099
058700                         30  ASC-DEPT-NBR            PIC  9(03).  05870099
058800*PS 10/11/2014 STARTS                                             05880099
058900                         30  ASC-PO-NBR-N            PIC  9(08).  05890099
058910*PS 10/11/2014 ENDS                                               05891099
058920                         30  ASC-RCVR-SEQ-NBR-N      PIC  9(04).  05892099
058930                         30  ASC-PO-LNE-NBR-N        PIC  9(04).  05893099
058940                         30  ASC-PREPK-ID-N          PIC  9(04).  05894099
058950                         30  ASC-ENT-ID              PIC S9(09)   05895099
058960                                                          COMP.   05896099
058970                         30  ASC-VENDOR-SHORT-NME    PIC  X(10).  05897099
058980                         30  ASC-FCLTY-NME           PIC  X(04).  05898099
058990                         30  ASC-TROUBLE-REASON-CDE  PIC S9(04)   05899099
059000                                                          COMP.   05900099
059100                         30  ASC-TROUBLE-REASON-DESC PIC  X(10).  05910099
059200                         30  ASC-TROUBLE-RESP-RES-IND             05920099
059300                                                     PIC  X(01).  05930099
059400                         30  ASC-TROUBLE-REASON-LVL  PIC  X(01).  05940099
059500                         30  ASC-ARRIVAL-DATE-TIME   PIC  X(08).  05950099
059600                         30  ASC-NOTIFICATION-DATE-TIME           05960099
059700                                                     PIC  X(08).  05970099
059800                         30  ASC-RESPONSE-DATE-TIME  PIC  X(08).  05980099
059900                         30  ASC-TRBL-DTL-EXISTS-SW  PIC  X(01).  05990099
060000                             88  ASC-TRBL-DTL-EXISTS VALUE 'Y'.   06000099
060100                             88  ASC-NO-TRBL-DTL-EXISTS           06010099
060200                                                     VALUE 'N'.   06020099
060300                         30  ASC-TRBL-RESOLVED-SW    PIC  X(01).  06030099
060400                             88  ASC-TRBL-RESOLVED   VALUE 'Y'.   06040099
060500                             88  ASC-TRBL-NOT-RESOLVED            06050099
060600                                                     VALUE 'N'.   06060099
060700             15  ASC-BLK-SUB                         PIC S9(04)   06070099
060800                                                          COMP    06080099
060900                                                          SYNC.   06090099
061000             15  ASC-SEL-SUB                         PIC S9(04)   06100099
061100                                                         COMP.    06110099
061200             15  ASC-SEL-ITEM                        PIC S9(04)   06120099
061300                                                         COMP.    06130099
061400             15  ASC-ITEM-SUB                        PIC S9(04)   06140099
061500                                                          COMP    06150099
061600                                                          SYNC.   06160099
061700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   06170099
061800                                                          COMP-3. 06180099
061900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   06190099
062000                                                          COMP-3. 06200099
062100             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   06210099
062200                                                          COMP-3. 06220099
062300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   06230099
062400                                                          COMP-3. 06240099
062500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   06250099
062600                                                          COMP-3. 06260099
062700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   06270099
062800                                                          COMP-3. 06280099
062900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   06290099
063000                                                          COMP    06300099
063100                                                          SYNC.   06310099
063200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   06320099
063300                                                          COMP-3. 06330099
063400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   06340099
063500                                                          COMP-3. 06350099
063600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  06360099
063700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   06370099
063800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   06380099
063900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  06390099
064000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   06400099
064100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   06410099
064200             15  ASC-LIST-QUEUE-NAME.                             06420099
064300                 20  ASC-LIST-TERM-ID                PIC  X(04).  06430099
064400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   06440099
064500                                                          COMP-3. 06450099
064600                 20  ASC-LIST-SEQ                    PIC  9(01).  06460099
064700             15  ASC-SEL-QUEUE-OUT.                               06470099
064800                 20  ASC-SEL-TERM-ID                 PIC  X(04).  06480099
064900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   06490099
065000                                                          COMP-3. 06500099
065100                 20  ASC-SEL-SEQ                     PIC  9(01).  06510099
065200             15  ASC-SEL-QUEUE-IN                    PIC  X(08).  06520099
065300             15  ASC-START-ITEM-REQUEST.                          06530099
065400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  06540099
065500             15  ASC-KEY-REC-SEQ-NBR           PIC S9(09) COMP.   06550099
065600             15  ASC-USE-SELECTION-QUEUE-IND         PIC X(01).   06560099
065700                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   06570099
065800             15  ASC-SOURCE-PROG-IND                 PIC X(01).   06580099
065900                 88  ASC-FROM-RC015                  VALUE '1'.   06590099
066000                 88  ASC-FROM-PC000                  VALUE '2'.   06600099
066100                 88  ASC-FROM-DS604                  VALUE '3'.   06610099
066200             15  ASC-ENTERED-USING-IND         PIC  X(01).        06620099
066300                 88  ASC-CRIT-SPEC-FORMAT            VALUE '1'.   06630099
066400                 88  ASC-ENTERED-USING-PO-PO011      VALUE '2'.   06640099
066500                 88  ASC-ENTERED-USING-PO-PO017      VALUE '3'.   06650099
066600                 88  ASC-ENTERED-USING-PO-PO013      VALUE '4'.   06660099
066700                                                                  06670099
066800*---------------------------------------------------------------* 06680099
066900*    ABEND PROCESSING COPYBOOK.                                 * 06690099
067000*---------------------------------------------------------------* 06700099
067100                                                                  06710099
067200     COPY DPWS013.                                                06720099
067300                                                                  06730099
067400*---------------------------------------------------------------* 06740099
067500*    DB2 AREA FOR TTRBNTF - TROUBLE NOTIFICATION                * 06750099
067600*---------------------------------------------------------------* 06760099
067700     EXEC SQL                                                     06770099
067800          INCLUDE TTRBNTF                                         06780099
067900     END-EXEC.                                                    06790099
068000*---------------------------------------------------------------* 06800099
068100*    DB2 AREA FOR TTRBRSN - TROUBLE REASON                      * 06810099
068200*---------------------------------------------------------------* 06820099
068300     EXEC SQL                                                     06830099
068400          INCLUDE TTRBRSN                                         06840099
068500     END-EXEC.                                                    06850099
068600*---------------------------------------------------------------* 06860099
068700*    DB2 AREA FOR TRECEIV - RECEIVER                            * 06870099
068800*---------------------------------------------------------------* 06880099
068900     EXEC SQL                                                     06890099
069000          INCLUDE TRECEIV                                         06900099
069100     END-EXEC.                                                    06910099
069200*---------------------------------------------------------------* 06920099
069300*    DB2 AREA FOR TENTNME - ENTITY NAME                         * 06930099
069400*---------------------------------------------------------------* 06940099
069500     EXEC SQL                                                     06950099
069600          INCLUDE TENTNME                                         06960099
069700     END-EXEC.                                                    06970099
069800*---------------------------------------------------------------* 06980099
069900*    DB2 AREA FOR TPURCHS - PURCHASE ORDER HEADER TABLE         * 06990099
070000*---------------------------------------------------------------* 07000099
070100     EXEC SQL                                                     07010099
070200          INCLUDE TPURCHS                                         07020099
070300     END-EXEC.                                                    07030099
070400*---------------------------------------------------------------* 07040099
070500*    DB2 AREA FOR TMDSEAR - MERCHANDISE AREA TABLE              * 07050099
070600*---------------------------------------------------------------* 07060099
070700     EXEC SQL                                                     07070099
070800          INCLUDE TMDSEAR                                         07080099
070900     END-EXEC.                                                    07090099
071000*---------------------------------------------------------------* 07100099
071100*    DB2 AREA FOR TSHPTPO - SHIPPED PO TABLE                    * 07110099
071200*---------------------------------------------------------------* 07120099
071300     EXEC SQL                                                     07130099
071400          INCLUDE TSHPTPO                                         07140099
071500     END-EXEC.                                                    07150099
071600*---------------------------------------------------------------* 07160099
071700*    DB2 AREA FOR TSHIPMT - SHIPMENT TABLE                      * 07170099
071800*---------------------------------------------------------------* 07180099
071900     EXEC SQL                                                     07190099
072000          INCLUDE TSHIPMT                                         07200099
072100     END-EXEC.                                                    07210099
072200*---------------------------------------------------------------* 07220099
072300*    DB2 AREA FOR COMMUNICATIONS                                * 07230099
072400*---------------------------------------------------------------* 07240099
072500     EXEC SQL                                                     07250099
072600          INCLUDE SQLCA                                           07260099
072700     END-EXEC.                                                    07270099
072800                                                                  07280099
072900*---------------------------------------------------------------* 07290099
073000*    TROUBLE PO LIST CURSOR FOR A SPECIFIED DEPARTMENT          * 07300099
073100*    ALL FILTERS ARE APPLIED HERE TO MINIMIZE THE SIZE OF       * 07310099
073200*    THE CURSOR.  THIS IS A DRIVER FOR TRBL-NTF-BY-PO-CSR       * 07320099
073300*---------------------------------------------------------------* 07330099
073400                                                                  07340099
073500     EXEC SQL                                                     07350099
073600          DECLARE TRBL-LIST-BY-DEPT CURSOR                        07360099
073700          FOR SELECT                                              07370099
073800                A.PO_NBR                                          07380099
073900              , MIN(A.NOTIF_TMST)                                 07390099
074000              , MIN(C.REC_TMST)                                   07400099
074100          FROM                                                    07410099
074200                TTRBNTF A                                         07420099
074300              , TTRBRSN B                                         07430099
074400              , TRECEIV C                                         07440099
074500         WHERE                                                    07450099
074600                A.DEPT_NBR            = :DK-DEPT-NBR              07460099
074800            AND A.RESOLVED_IND      IN (:DK-NOTIF-STAT-1          07480099
074900                                      , :DK-NOTIF-STAT-2)         07490099
075400            AND A.PO_NBR              =  C.ORD_NBR                07540099
075500            AND A.REC_SEQ_NBR         =  C.REC_SEQ_NBR            07550099
075600            AND A.OPER_UNT_ID         =  C.OPER_UNT_ID            07560099
075700            AND A.FCLTY_ID            =  C.FCLTY_ID               07570099
075800            AND A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE           07580099
075900            AND C.REC_TMST      BETWEEN :DK-LOW-REC-TMST          07590099
076000                                    AND :DK-HIGH-REC-TMST         07600099
076100         GROUP BY                                                 07610099
076200               A.PO_NBR                                           07620099
076300         ORDER BY                                                 07630099
076400               3                                                  07640099
076500             , 2                                                  07650099
076600     END-EXEC.                                                    07660099
076700                                                                  07670099
076800*---------------------------------------------------------------* 07680099
076900*    TROUBLE PO LIST CURSOR FOR A SPECIFIED BUYER               * 07690099
077000*    ALL FILTERS ARE APPLIED HERE TO MINIMIZE THE SIZE OF       * 07700099
077100*    THE CURSOR.  THIS IS A DRIVER FOR TRBL-NTF-BY-PO-CSR       * 07710099
077200*---------------------------------------------------------------* 07720099
077300                                                                  07730099
077400     EXEC SQL                                                     07740099
077500          DECLARE TRBL-LIST-BY-BYR CURSOR                         07750099
077600          FOR SELECT                                              07760099
077700                A.PO_NBR                                          07770099
077800              , MIN(A.NOTIF_TMST)                                 07780099
077900              , MIN(D.REC_TMST)                                   07790099
078000          FROM                                                    07800099
078100                TTRBNTF A                                         07810099
078200              , TMDSEAR B                                         07820099
078300              , TTRBRSN C                                         07830099
078400              , TRECEIV D                                         07840099
078800         WHERE  A.PO_NBR              =  D.ORD_NBR                07880099
078900            AND A.REC_SEQ_NBR         =  D.REC_SEQ_NBR            07890099
079000            AND A.OPER_UNT_ID         =  D.OPER_UNT_ID            07900099
079100            AND A.FCLTY_ID            =  D.FCLTY_ID               07910099
079200            AND A.RESOLVED_IND      IN (:DK-NOTIF-STAT-1          07920099
079300                                      , :DK-NOTIF-STAT-2)         07930099
079800            AND A.TRBL_RSN_CDE        =  C.TRBL_RSN_CDE           07980099
079900            AND A.DEPT_NBR            =  B.DEPT_NBR               07990099
080000            AND B.BYR_NBR             = :DK-BUYER-NBR             08000099
080100            AND B.MDSELV_CDE          =  'DPT'                    08010099
080200            AND B.OPERCO_NBR          =  '03'                     08020099
080300            AND B.STRT_DTE           <=  CURRENT DATE             08030099
080400            AND B.END_DTE            >=  CURRENT DATE             08040099
080500            AND D.REC_TMST      BETWEEN :DK-LOW-REC-TMST          08050099
080600                                    AND :DK-HIGH-REC-TMST         08060099
080700         GROUP BY                                                 08070099
080800               A.PO_NBR                                           08080099
080900         ORDER BY                                                 08090099
081000               3                                                  08100099
081100             , 2                                                  08110099
081200     END-EXEC.                                                    08120099
081300                                                                  08130099
081400                                                                  08140099
081500****************************************************************  08150099
081600*  THIS CURSOR IS USED WHEN ONLY THE PO NBR IS KNOWN OR THE       08160099
081700*  PO NUMBER AND THE REC. SEQ. NBR IS KNOWN                       08170099
081800****************************************************************  08180099
081900     EXEC SQL                                                     08190099
082000          DECLARE PO-RCVR-CSR CURSOR                              08200099
082100          FOR SELECT                                              08210099
082200                A.PO_NBR                                          08220099
082300              , MIN(A.NOTIF_TMST)                                 08230099
082400              , MIN(C.REC_TMST)                                   08240099
082500          FROM                                                    08250099
082600                TTRBNTF A                                         08260099
082700              , TTRBRSN B                                         08270099
082800              , TRECEIV C                                         08280099
082900         WHERE                                                    08290099
083000                A.PO_NBR              = :DK-PO-NBR                08300099
083100            AND A.PO_NBR              =  C.ORD_NBR                08310099
083200            AND A.REC_SEQ_NBR   BETWEEN :DK-REC-SEQ-NBR-LOW       08320099
083300                                    AND :DK-REC-SEQ-NBR-HIGH      08330099
083400            AND A.REC_SEQ_NBR         =  C.REC_SEQ_NBR            08340099
083500            AND A.OPER_UNT_ID         =  C.OPER_UNT_ID            08350099
083600            AND A.FCLTY_ID            =  C.FCLTY_ID               08360099
083700            AND A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE           08370099
083800            AND A.RESOLVED_IND      IN (:DK-NOTIF-STAT-1          08380099
083900                                      , :DK-NOTIF-STAT-2          08390099
084000                                      , :DK-NOTIF-STAT-3          08400099
084100                                      , :DK-NOTIF-STAT-4)         08410099
084200            AND C.REC_TMST      BETWEEN :DK-LOW-REC-TMST          08420099
084300                                    AND :DK-HIGH-REC-TMST         08430099
084400         GROUP BY                                                 08440099
084500               A.PO_NBR                                           08450099
084600         ORDER BY                                                 08460099
084700               3                                                  08470099
084800             , 2                                                  08480099
084900     END-EXEC.                                                    08490099
085000                                                                  08500099
085100*---------------------------------------------------------------* 08510099
085200*    USED AS THE SECOND CURSOR FOR THE DEPARTMENT OR BUYER      * 08520099
085300*    TROUBLE NOTIFICATION BY PO LIST CURSOR                     * 08530099
085400*    THIS CURSOR IS OPENED, FETCHED FROM, THEN CLOSED FOR       * 08540099
085500*    EVERY ROW IN EITHER THE DEPARTMENT OR BUYER CURSORS        * 08550099
085600*---------------------------------------------------------------* 08560099
085700                                                                  08570099
085800     EXEC SQL                                                     08580099
085900          DECLARE TRBL-NTF-BY-PO-CSR CURSOR                       08590099
086000          FOR SELECT                                              08600099
086100                A.NOTIF_NBR                                       08610099
086200              , A.OPER_UNT_ID                                     08620099
086300              , A.FCLTY_ID                                        08630099
086400              , A.DEPT_NBR                                        08640099
086500              , A.ENT_ID                                          08650099
086600              , A.PO_NBR                                          08660099
086700              , A.PO_LNE_NBR                                      08670099
086800              , A.PREPK_ID                                        08680099
086900              , A.REC_SEQ_NBR                                     08690099
087000              , A.TRBL_RSN_CDE                                    08700099
087100              , A.NOTIF_TMST                                      08710099
087200              , A.RESOLVED_IND                                    08720099
087300              , A.RESOLVED_TMST                                   08730099
087400              , B.TRBL_SHT_DESC                                   08740099
087500              , B.RESP_RES_IND                                    08750099
087600              , B.TRBL_LVL_IND                                    08760099
087700              , B.RSLV_RSPNT_CDE                                  08770099
087800              , C.REC_TMST                                        08780099
087900          FROM                                                    08790099
088000                TTRBNTF A                                         08800099
088100              , TTRBRSN B                                         08810099
088200              , TRECEIV C                                         08820099
088300          WHERE                                                   08830099
088400                A.DEPT_NBR      BETWEEN :DK-DEPT-LOW              08840099
088500                                    AND :DK-DEPT-HIGH             08850099
088600            AND A.PO_NBR              = :DK-PO-NBR                08860099
088700            AND A.PO_NBR              =  C.ORD_NBR                08870099
088800            AND A.REC_SEQ_NBR         =  C.REC_SEQ_NBR            08880099
088900            AND A.OPER_UNT_ID         =  C.OPER_UNT_ID            08890099
089000            AND A.FCLTY_ID            =  C.FCLTY_ID               08900099
089100            AND A.TRBL_RSN_CDE  BETWEEN :DK-TRBL-RSN-LOW          08910099
089200                                    AND :DK-TRBL-RSN-HIGH         08920099
089300            AND A.RESOLVED_IND      IN (:DK-NOTIF-STAT-1          08930099
089400                                      , :DK-NOTIF-STAT-2          08940099
089500                                      , :DK-NOTIF-STAT-3          08950099
089600                                      , :DK-NOTIF-STAT-4)         08960099
089700            AND A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE           08970099
089800            AND C.REC_TMST      BETWEEN :DK-LOW-REC-TMST          08980099
089900                                    AND :DK-HIGH-REC-TMST         08990099
090000            AND A.NOTIF_TMST    BETWEEN :DK-LOW-TRB-TMST          09000099
090100                                    AND :DK-HIGH-TRB-TMST         09010099
090200          ORDER BY                                                09020099
090300                C.REC_TMST                                        09030099
090400              , A.NOTIF_TMST                                      09040099
090500     END-EXEC.                                                    09050099
090600                                                                  09060099
090700                                                                  09070099
090800**************************************************************    09080099
090900*    USED AS THE SECOND CURSOR FOR THE PO-RCVR-CURSOR             09090099
091000**************************************************************    09100099
091100     EXEC SQL                                                     09110099
091200          DECLARE PO-RCVR-BY-PO-CSR CURSOR                        09120099
091300          FOR SELECT                                              09130099
091400                A.NOTIF_NBR                                       09140099
091500              , A.OPER_UNT_ID                                     09150099
091600              , A.FCLTY_ID                                        09160099
091700              , A.DEPT_NBR                                        09170099
091800              , A.ENT_ID                                          09180099
091900              , A.PO_NBR                                          09190099
092000              , A.PO_LNE_NBR                                      09200099
092100              , A.PREPK_ID                                        09210099
092200              , A.REC_SEQ_NBR                                     09220099
092300              , A.TRBL_RSN_CDE                                    09230099
092400              , A.NOTIF_TMST                                      09240099
092500              , A.RESOLVED_IND                                    09250099
092600              , A.RESOLVED_TMST                                   09260099
092700              , B.TRBL_SHT_DESC                                   09270099
092800              , B.RESP_RES_IND                                    09280099
092900              , B.TRBL_LVL_IND                                    09290099
093000              , B.RSLV_RSPNT_CDE                                  09300099
093100              , C.REC_TMST                                        09310099
093200          FROM                                                    09320099
093300                TTRBNTF A                                         09330099
093400              , TTRBRSN B                                         09340099
093500              , TRECEIV C                                         09350099
093600          WHERE                                                   09360099
093700                A.PO_NBR              = :DK-PO-NBR                09370099
093800            AND A.PO_NBR              =  C.ORD_NBR                09380099
093900            AND A.REC_SEQ_NBR   BETWEEN :DK-REC-SEQ-NBR-LOW       09390099
094000                                    AND :DK-REC-SEQ-NBR-HIGH      09400099
094100            AND A.REC_SEQ_NBR         =  C.REC_SEQ_NBR            09410099
094200            AND A.OPER_UNT_ID         =  C.OPER_UNT_ID            09420099
094300            AND A.FCLTY_ID            =  C.FCLTY_ID               09430099
094400            AND A.TRBL_RSN_CDE BETWEEN  :DK-TRBL-RSN-LOW          09440099
094500                                   AND  :DK-TRBL-RSN-HIGH         09450099
094600            AND A.RESOLVED_IND      IN (:DK-NOTIF-STAT-1          09460099
094700                                      , :DK-NOTIF-STAT-2          09470099
094800                                      , :DK-NOTIF-STAT-3          09480099
094900                                      , :DK-NOTIF-STAT-4)         09490099
095000            AND A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE           09500099
095100            AND C.REC_TMST      BETWEEN :DK-LOW-REC-TMST          09510099
095200                                    AND :DK-HIGH-REC-TMST         09520099
095300            AND A.NOTIF_TMST    BETWEEN :DK-LOW-TRB-TMST          09530099
095400                                    AND :DK-HIGH-TRB-TMST         09540099
095500          ORDER BY                                                09550099
095600                C.REC_TMST                                        09560099
095700              , A.NOTIF_TMST                                      09570099
095800     END-EXEC.                                                    09580099
095900                                                                  09590099
096000                                                                  09600099
096100 LINKAGE SECTION.                                                 09610099
096200                                                                  09620099
096300 01  DFHCOMMAREA.                                                 09630099
096400     05  FILLER                         OCCURS  1 TO 4072 TIMES   09640099
096500                                        DEPENDING ON EIBCALEN.    09650099
096600         10  FILLER                     PIC X.                    09660099
096700                                                                  09670099
096800                                                                  09680099
096900 PROCEDURE DIVISION.                                              09690099
097000******************************************************************09700099
097100**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **09710099
097200**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **09720099
097300**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **09730099
097400******************************************************************09740099
097500 0000-MAIN-MODULE.                                                09750099
097600     INITIALIZE DP030-CICS-API-FIELDS.                            09760099
097700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       09770099
097800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          09780099
097900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         09790099
098000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       09800099
098100     MOVE LENGTH OF TM512AI        TO DP030-MAP-LENGTH (1).       09810099
098200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     09820099
098300     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       09830099
098400*                                                                 09840099
098500     PERFORM 0001-CALL-CICS-ARCH-API.                             09850099
098600     PERFORM 1000-CONTROL-PROCESSING                              09860099
098700*                                                                 09870099
098800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     09880099
098900     PERFORM 0001-CALL-CICS-ARCH-API.                             09890099
099000                                                                  09900099
099100******************************************************************09910099
099200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **09920099
099300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **09930099
099400******************************************************************09940099
099500 0001-CALL-CICS-ARCH-API.                                         09950099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      09960099
099700                                    DFHCOMMAREA                   09970099
099800                                    DP030-CICS-API-FIELDS         09980099
099900                                    DP020-STANDARD-COMMAREA       09990099
100000                                    TM512AI.                      10000099
100100*                                                                 10010099
100200     IF DP030-RC-CALL-SUCCESSFUL OR DP030-RC-APPL-ERROR           10020099
100300         CONTINUE                                                 10030099
100400     ELSE                                                         10040099
100500         SET DP013-NO-ROLLBACK                                    10050099
100600             DP013-XCTL-DISPLAY-RESTART                           10060099
100700             DP013-CICS-ABEND      TO TRUE                        10070099
100800         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        10080099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O10081099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      10082099
101100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      10110099
101200         PERFORM DP013-0000-PROCESS-ABEND                         10120099
101300     END-IF.                                                      10130099
101400                                                                  10140099
101500*----------------------------------------------------------------*10150099
101600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *10160099
101700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *10170099
101800*                                                                *10180099
101900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *10190099
102000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *10200099
102100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *10210099
102200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *10220099
102300*----------------------------------------------------------------*10230099
102400 1000-CONTROL-PROCESSING.                                         10240099
102500                                                                  10250099
102600     EVALUATE TRUE                                                10260099
102700         WHEN DP030-RC-APPL-ERROR                                 10270099
102800             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         10280099
102900             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                10290099
103000             IF ASC-RETURNING-FROM-PO                             10300099
103100                 PERFORM 2140-DESELECT-ALL-ITEMS                  10310099
103200             ELSE                                                 10320099
103300                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             10330099
103400             END-IF                                               10340099
103500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10350099
103600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10360099
103700                                                                  10370099
103800         WHEN DP020-NEXT-ACT-INITIAL                              10380099
103900             INITIALIZE ASC-SPECIFIC-COMMAREA                     10390099
104000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            10400099
104100                                      ASC-SEL-TERM-ID             10410099
104200             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   10420099
104300                                           ASC-SEL-TASK-NUMBER    10430099
104400             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               10440099
104500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 10450099
104600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 10460099
104700                                                                  10470099
104800             IF  PS-COMMAREA-NOT-VALID                            10480099
104900                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            10490099
105000             ELSE                                                 10500099
105100                 PERFORM 4000-BUILD-INITIAL-PANEL                 10510099
105200             END-IF                                               10520099
105300                                                                  10530099
105400         WHEN DP020-NEXT-ACT-READ-MAP                             10540099
105500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         10550099
105600             PERFORM 2000-PROCESS-PANEL                           10560099
105700                                                                  10570099
105800         WHEN DP020-NEXT-ACT-RETURN                               10580099
105900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         10590099
106000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10600099
106100             IF ASC-RETURNING-FROM-PO                             10610099
106200                 PERFORM 2140-DESELECT-ALL-ITEMS                  10620099
106300             ELSE                                                 10630099
106400                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             10640099
106500             END-IF                                               10650099
106600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10660099
106700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10670099
106800                                                                  10680099
106900         WHEN OTHER                                               10690099
107000             SET DP013-LOGIC-ABEND TO TRUE                        10700099
107100             SET DP013-NO-ROLLBACK TO TRUE                        10710099
107200             MOVE '1000-CONTROL-PROCESSING'                       10720099
107300                                   TO DP013-PARAGRAPH             10730099
107400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    10740099
107500                                   TO DP013-MESSAGE-TEXT(1)       10750099
107600             PERFORM DP013-0000-PROCESS-ABEND                     10760099
107700     END-EVALUATE.                                                10770099
107800                                                                  10780099
107900                                                                  10790099
108000*----------------------------------------------------------------*10800099
108100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *10810099
108200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *10820099
108300*----------------------------------------------------------------*10830099
108400 1100-PROCESS-INTER-APPL-COMM.                                    10840099
108500     SET PS-COMMAREA-VALID         TO TRUE.                       10850099
108600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     10860099
108700                                                                  10870099
108800     MOVE DP020-INT-APPL-FORMAT-IND TO PC-ENTERED-USING-IND       10880099
108900                                       ASC-ENTERED-USING-IND.     10890099
109000     EVALUATE TRUE                                                10900099
109100**** COMING FROM THE CRIT SPEC SCREEN  *************************  10910099
109200         WHEN PC-CRIT-SPEC-FORMAT                                 10920099
109300**           THIS PROGRAM ASSUMES THAT INTER-APPL FIELDS ARE      10930099
109400**           PROPERLY INITIALIZED...                              10940099
109500             IF  TM004-DEPT = SPACES   AND                        10950099
109600                 TM004-BUYER-NBR = SPACES  AND                    10960099
109700                 TM004-PO-NBR = SPACES                            10970099
109800                 MOVE PC-TSYMSG-01029  TO DP020-MSG-NUMBER        10980099
109900                 SET PS-ERROR                                     10990099
110000                     PS-COMMAREA-NOT-VALID                        11000099
110100                     DP020-MSG-FATAL   TO TRUE                    11010099
110200             END-IF                                               11020099
110300                                                                  11030099
110400             IF  PS-NO-ERROR                                      11040099
110500                 MOVE TM004-RESPONSIBILITY-AREA-SW                11050099
110600                                    TO ASC-RESPONSIBILITY-AREA-SW 11060099
110700                 MOVE TM004-RA-BUYER       TO ASC-RA-BUYER        11070099
110800                 MOVE TM004-RA-ANALYST     TO ASC-RA-ANALYST      11080099
110900                 MOVE TM004-RA-BUYER-ANALYST-DC                   11090099
111000                                    TO ASC-RA-BUYER-ANALYST-DC    11100099
111100                 MOVE TM004-PO-NBR-N       TO ASC-KEY-PO-NBR      11110099
111200                 MOVE TM004-RCVR-SEQ-NBR-N TO ASC-KEY-REC-SEQ-NBR 11120099
111300                 MOVE TM004-DEPT           TO ASC-DEPT            11130099
111400                 MOVE TM004-BUYER-NBR      TO ASC-BUYER           11140099
111500                 MOVE TM004-NOTIF-STATUS   TO ASC-NOTIF-STAT      11150099
111600                 MOVE TM004-RCVR-STATUS-SW TO ASC-RCVR-STATUS-SW  11160099
111700                 MOVE TM004-PACK-TRBL-IND  TO ASC-KEY-PACK-LVL-IND11170099
111800                 MOVE TM004-PACK-FR-DT     TO ASC-KEY-PACK-FR-DT  11180099
111900                 MOVE TM004-PACK-TO-DT     TO ASC-KEY-PACK-TO-DT  11190099
112000             END-IF                                               11200099
112100         WHEN PC-ENTERED-USING-PO-PO013                           11210099
112310**** USED WHEN COMING FROM THE PO ITEM INQUIRY SCREEN  ****       11231099
112320**** WHICH IS PROGRAM POKCS035                         ****       11232099
112400             MOVE PO013-PO-NBR             TO ASC-KEY-PO-NBR      11240099
112410             MOVE PC-BUY-ANALYST-DC-SW                            11241099
112420                                    TO ASC-RESPONSIBILITY-AREA-SW 11242099
112430             MOVE PC-BUYER          TO ASC-RA-BUYER               11243099
112440             MOVE PC-ANALYST        TO ASC-RA-ANALYST             11244099
112450             MOVE PC-BUYER-ANALYST-DC TO ASC-RA-BUYER-ANALYST-DC  11245099
112460             SET ASC-ALL-NOTIF-STATS                              11246099
112470                 ASC-RCVR-STAT-ARR-ENR     TO TRUE                11247099
112500         WHEN PC-ENTERED-USING-PO-PO017                           11250099
112600**** USED WHEN COMING FROM THE PO INQUIRY SCREEN       ****       11260099
112601**** AND THE PO TRANSPORTATION TRACKING INQUIRY SCREEN ****       11260199
112610**** WHICH IS PROGRAMS POKCS031 AND POKCS070           ****       11261099
112700             MOVE PO017-PO-NBR             TO ASC-KEY-PO-NBR      11270099
112800             MOVE PO017-DEPT-NBR           TO ASC-DEPT            11280099
112900             MOVE PC-BUY-ANALYST-DC-SW                            11290099
113000                                    TO ASC-RESPONSIBILITY-AREA-SW 11300099
113100             MOVE PC-BUYER          TO ASC-RA-BUYER               11310099
113200             MOVE PC-ANALYST        TO ASC-RA-ANALYST             11320099
113300             MOVE PC-BUYER-ANALYST-DC TO ASC-RA-BUYER-ANALYST-DC  11330099
113400             SET ASC-ALL-NOTIF-STATS                              11340099
113500                 ASC-RCVR-STAT-ARR-ENR     TO TRUE                11350099
113600     END-EVALUATE.                                                11360099
113700                                                                  11370099
113800                                                                  11380099
113900*----------------------------------------------------------------*11390099
114000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *11400099
114100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *11410099
114200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *11420099
114300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *11430099
114400* FUNCTION KEYS CAN GET THIS FAR.                                *11440099
114500*----------------------------------------------------------------*11450099
114600 2000-PROCESS-PANEL.                                              11460099
114700     EVALUATE TRUE                                                11470099
114800         WHEN DP020-SRC-AID = DP016-CLEAR                         11480099
114900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11490099
115000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11500099
115100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11510099
115200                                                                  11520099
115300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11530099
115400             PERFORM 2050-DELETE-LIST-QUEUE                       11540099
115500             PERFORM 4000-BUILD-INITIAL-PANEL                     11550099
115600                                                                  11560099
115700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    11570099
115800             PERFORM 2140-DESELECT-ALL-ITEMS                      11580099
115900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11590099
116000                                                                  11600099
116100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  11610099
116200             PERFORM 2150-SELECT-ALL-ITEMS                        11620099
116300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11630099
116400                                                                  11640099
116500         WHEN OTHER                                               11650099
116600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11660099
116700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11670099
116800             IF  PS-NO-ERROR                                      11680099
116900                 SET DP030-CONTINUE-GO TO TRUE                    11690099
117000                 PERFORM 2100-CHECK-FUNCTION-KEY                  11700099
117100             ELSE                                                 11710099
117200                 SET DP030-OVERRIDE-GO TO TRUE                    11720099
117300             END-IF                                               11730099
117400     END-EVALUATE.                                                11740099
117500                                                                  11750099
117600                                                                  11760099
117700*----------------------------------------------------------------*11770099
117800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *11780099
117900*----------------------------------------------------------------*11790099
118000 2050-DELETE-LIST-QUEUE.                                          11800099
118100     EXEC CICS                                                    11810099
118200         DELETEQ TS                                               11820099
118300             QUEUE (ASC-LIST-QUEUE-NAME)                          11830099
118400             RESP  (PV-CICS-RESP)                                 11840099
118500     END-EXEC.                                                    11850099
118600                                                                  11860099
118700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       11870099
118800        (PV-CICS-RESP = DFHRESP(QIDERR))                          11880099
118900         CONTINUE                                                 11890099
119000     ELSE                                                         11900099
119100         SET DP013-CICS-ABEND      TO TRUE                        11910099
119200         SET DP013-NO-ROLLBACK     TO TRUE                        11920099
119300         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         11930099
119400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    11940099
119500                                   TO DP013-MESSAGE-TEXT (1)      11950099
119600         PERFORM DP013-0000-PROCESS-ABEND                         11960099
119700     END-IF.                                                      11970099
119800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  11980099
119900                                                                  11990099
120000                                                                  12000099
120100*----------------------------------------------------------------*12010099
120200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*12020099
120300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *12030099
120400* CICS ARCHITECTURE API.                                         *12040099
120500*----------------------------------------------------------------*12050099
120600 2100-CHECK-FUNCTION-KEY.                                         12060099
120700     EVALUATE TRUE                                                12070099
120800         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               12080099
120900*             --- RESPOND/RESOLVE FUNCTION KEY ---                12090099
121000         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               12100099
121100*             --- LINE ITM FUNCTION KEY ---                       12110099
121200         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               12120099
121300*             --- DETAILS FUNCTION KEY ---                        12130099
121400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              12140099
121500                 INITIALIZE TM004-INTER-APPL-COMMAREA             12150099
121600                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                12160099
121700                         TO TM004-NUMBER-OF-SELECTED-ITEMS        12170099
121800                 PERFORM 5000-PREPARE-SEL-QUEUE                   12180099
121900             ELSE                                                 12190099
122000                 SET DP030-OVERRIDE-GO TO TRUE                    12200099
122100                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         12210099
122200                 SET DP020-MSG-WARNING TO TRUE                    12220099
122300             END-IF                                               12230099
122400                                                                  12240099
122500         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               12250099
122600*             --- IN-PROCESS FUNCTION KEY ---                     12260099
122700             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              12270099
122800                 INITIALIZE TM500-FIELDS                          12280099
122900                 SET TM500-IN-PROCESS                             12290099
123000                     TM500-ADD-DETAILS                            12300099
123100                     PS-IN-PROC-REQUEST TO TRUE                   12310099
123200                 MOVE DP020-USERID TO TM500-NOTIF-UID             12320099
123300                                      TM500-CRE-UID               12330099
123400                 MOVE PC-IN-PROCESS-MSG TO TM500-FREEFORM-TEXT    12340099
123500                                                                  12350099
123600                 PERFORM 5050-PREPARE-TO-PROCESS-TRBL             12360099
123700                                                                  12370099
123800                 IF  NOT PS-ERROR                                 12380099
123900                     MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER     12390099
124000                     SET DP020-MSG-INFORMATIONAL TO TRUE          12400099
124100                     MOVE ASC-ITEM-AT-TOP-OF-PANEL TO  PV-TOP-ITEM12410099
124200                     MOVE ZERO     TO  ASC-ITEM-AT-TOP-OF-PANEL   12420099
124300                                                                  12430099
124400                     DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL     12440099
124500                         GIVING PV-BLOCK-NUMBER                   12450099
124600                         REMAINDER PV-REMAINDER                   12460099
124700                     IF  PV-REMAINDER > ZERO                      12470099
124800                         ADD +1 TO PV-BLOCK-NUMBER                12480099
124900                     END-IF                                       12490099
125000                                                                  12500099
125100                     MOVE +1    TO ASC-BLK-SUB                    12510099
125200                     PERFORM 4410-READ-TEMP-STORAGE               12520099
125300                     ADD +1     TO ASC-BLK-SUB                    12530099
125400                                   PV-BLOCK-NUMBER                12540099
125500                     PERFORM 4410-READ-TEMP-STORAGE               12550099
125600                 ELSE                                             12560099
125700                     MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM 12570099
125800                     MOVE ZERO     TO  ASC-ITEM-AT-TOP-OF-PANEL   12580099
125900                     MOVE +1       TO  ASC-BLK-SUB                12590099
126000                     PERFORM 4410-READ-TEMP-STORAGE               12600099
126100                     ADD +1        TO  ASC-BLK-SUB                12610099
126200                                       PV-BLOCK-NUMBER            12620099
126300                     PERFORM 4410-READ-TEMP-STORAGE               12630099
126400                 END-IF                                           12640099
126500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12650099
126600             ELSE                                                 12660099
126700                 SET DP030-OVERRIDE-GO TO TRUE                    12670099
126800                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         12680099
126900                 SET DP020-MSG-WARNING TO TRUE                    12690099
127000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12700099
127100             END-IF                                               12710099
127200                                                                  12720099
127300         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               12730099
127400*             --- RESOLVE FUCTION KEY ---                         12740099
127500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              12750099
127600                 INITIALIZE TM500-FIELDS                          12760099
127700                 SET TM500-RESOLVE-AUTO                           12770099
127800                     TM500-NO-DETAILS                             12780099
127900                     PS-RESOLVE-REQUEST TO TRUE                   12790099
128000                 MOVE PC-CURRENT-PROGRAM-NAME TO TM500-NOTIF-UID  12800099
128100                 MOVE DP020-USERID TO TM500-RESOLVED-UID          12810099
128200                                                                  12820099
128300                 PERFORM 5050-PREPARE-TO-PROCESS-TRBL             12830099
128400                                                                  12840099
128500                 IF  NOT PS-ERROR                                 12850099
128600                     IF  TM500-DUPLICATE-TROUBLE                  12860099
128700                         CONTINUE                                 12870099
128800                     ELSE                                         12880099
128900                         MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER 12890099
129000                     END-IF                                       12900099
129100                     SET DP020-MSG-INFORMATIONAL TO TRUE          12910099
129200                     MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM 12920099
129300                     MOVE ZERO     TO  ASC-ITEM-AT-TOP-OF-PANEL   12930099
129400                                                                  12940099
129500                     DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL     12950099
129600                         GIVING PV-BLOCK-NUMBER                   12960099
129700                         REMAINDER PV-REMAINDER                   12970099
129800                     IF  PV-REMAINDER > ZERO                      12980099
129900                         ADD +1 TO PV-BLOCK-NUMBER                12990099
130000                     END-IF                                       13000099
130100                                                                  13010099
130200                     MOVE +1    TO ASC-BLK-SUB                    13020099
130300                     PERFORM 4410-READ-TEMP-STORAGE               13030099
130400                     ADD +1     TO ASC-BLK-SUB                    13040099
130500                                   PV-BLOCK-NUMBER                13050099
130600                     PERFORM 4410-READ-TEMP-STORAGE               13060099
130700                 ELSE                                             13070099
130800                     MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM 13080099
130900                     MOVE ZERO     TO  ASC-ITEM-AT-TOP-OF-PANEL   13090099
131000                     MOVE +1       TO  ASC-BLK-SUB                13100099
131100                     PERFORM 4410-READ-TEMP-STORAGE               13110099
131200                     ADD +1        TO  ASC-BLK-SUB                13120099
131300                                       PV-BLOCK-NUMBER            13130099
131400                     PERFORM 4410-READ-TEMP-STORAGE               13140099
131500                 END-IF                                           13150099
131600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13160099
131700             ELSE                                                 13170099
131800                 SET DP030-OVERRIDE-GO TO TRUE                    13180099
131900                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         13190099
132000                 SET DP020-MSG-WARNING TO TRUE                    13200099
132100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13210099
132200             END-IF                                               13220099
132300                                                                  13230099
132400         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)               13240099
132500*             ---     PO INQUIRY  KEY ---                         13250099
132600         WHEN DP020-FK-LOCAL-FUNC-07(DP020-SRC-AID)               13260099
132700*             ---      PO UPDATE  KEY ---                         13270099
132800             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               13280099
132900                 INITIALIZE PO013-INTER-APPL-COMMAREA             13290099
133000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                13300099
133100                         TO PO013-NUMBER-OF-SELECTED-ITEMS        13310099
133200                 PERFORM 5025-PREPARE-SEL-QUEUE-FOR-PO            13320099
133300                 IF PS-ERROR                                      13330099
133400                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                13340099
133500                         TO PV-TOP-ITEM                           13350099
133600                     MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL        13360099
133700                     MOVE +1 TO ASC-BLK-SUB                       13370099
133800                     PERFORM 4410-READ-TEMP-STORAGE               13380099
133900                     ADD +1 TO  ASC-BLK-SUB                       13390099
134000                                PV-BLOCK-NUMBER                   13400099
134100                     PERFORM 4410-READ-TEMP-STORAGE               13410099
134200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13420099
134300                     SET DP030-OVERRIDE-GO                        13430099
134400                         DP020-MSG-WARNING TO TRUE                13440099
134500                 END-IF                                           13450099
134600             ELSE                                                 13460099
134700                 SET DP030-OVERRIDE-GO TO TRUE                    13470099
134800                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         13480099
134900                 SET DP020-MSG-WARNING TO TRUE                    13490099
135000             END-IF                                               13500099
135100                                                                  13510099
135200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  13520099
135300             MOVE +1               TO PV-TOP-ITEM                 13530099
135400             PERFORM 3200-RESET-ATTRIBUTES                        13540099
135500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13550099
135600                                                                  13560099
135700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   13570099
135800             PERFORM 2110-BROWSE-BACKWARD                         13580099
135900             PERFORM 3200-RESET-ATTRIBUTES                        13590099
136000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13600099
136100                                                                  13610099
136200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   13620099
136300             PERFORM 2120-BROWSE-FORWARD                          13630099
136400             PERFORM 3200-RESET-ATTRIBUTES                        13640099
136500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13650099
136600                                                                  13660099
136700         WHEN DP020-SRC-AID = DP016-ENTER                         13670099
136800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   13680099
136900             IF  PS-ERROR                                         13690099
137000                 CONTINUE                                         13700099
137100             ELSE                                                 13710099
137200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13720099
137300             END-IF                                               13730099
137400                                                                  13740099
137500         WHEN OTHER                                               13750099
137600             SET DP013-NO-ROLLBACK                                13760099
137700                 DP013-XCTL-DISPLAY-RESTART                       13770099
137800                 DP013-CICS-ABEND  TO TRUE                        13780099
137900             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    13790099
138000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      13800099
138100                                   TO DP013-MESSAGE-TEXT (1)      13810099
138200             PERFORM DP013-0000-PROCESS-ABEND                     13820099
138300     END-EVALUATE.                                                13830099
138400                                                                  13840099
138500                                                                  13850099
138600*----------------------------------------------------------------*13860099
138700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *13870099
138800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *13880099
138900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *13890099
139000*    MESSAGE.                                                    *13900099
139100*----------------------------------------------------------------*13910099
139200 2110-BROWSE-BACKWARD.                                            13920099
139300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    13930099
139400         GIVING PV-TOP-ITEM.                                      13940099
139500                                                                  13950099
139600     IF  ((PV-TOP-ITEM < +1)                                      13960099
139700       OR (PV-TOP-ITEM = +1))                                     13970099
139800         MOVE +1                   TO PV-TOP-ITEM                 13980099
139900*        -- TOP OF LIST --                                        13990099
140000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            14000099
140100         SET DP020-MSG-INFORMATIONAL TO TRUE                      14010099
140200     END-IF.                                                      14020099
140300                                                                  14030099
140400                                                                  14040099
140500*----------------------------------------------------------------*14050099
140600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *14060099
140700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *14070099
140800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *14080099
140900*----------------------------------------------------------------*14090099
141000 2120-BROWSE-FORWARD.                                             14100099
141100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              14110099
141200         GIVING PV-TOP-ITEM.                                      14120099
141300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   14130099
141400         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             14140099
141500*        -- BOTTOM OF LIST --                                     14150099
141600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14160099
141700         SET DP020-MSG-INFORMATIONAL TO TRUE                      14170099
141800     ELSE                                                         14180099
141900         COMPUTE PV-BOTTOM-ITEM =                                 14190099
142000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 14200099
142100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            14210099
142200*            -- BOTTOM OF LIST --                                 14220099
142300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14230099
142400             SET DP020-MSG-INFORMATIONAL TO TRUE                  14240099
142500         END-IF                                                   14250099
142600     END-IF.                                                      14260099
142700                                                                  14270099
142800                                                                  14280099
142900*----------------------------------------------------------------*14290099
143000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *14300099
143100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *14310099
143200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *14320099
143300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *14330099
143400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *14340099
143500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *14350099
143600*----------------------------------------------------------------*14360099
143700 2130-CHECK-FOR-JUMP-BROWSE.                                      14370099
143800     SET PS-NO-ERROR               TO TRUE.                       14380099
143900     IF (ASC-START-ITEM-REQUEST = SPACE)                          14390099
144000         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             14400099
144100     ELSE                                                         14410099
144200         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     14420099
144300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       14430099
144400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     14440099
144500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  14450099
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14461099
263627              USING DP010I-NUMERIC-EDIT-AREA                      14462099
144700                                                                  14470099
144800         IF  NOT DP010I-ERROR-DETECTED                            14480099
144900             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N14490099
145000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  14500099
145100                 IF  ASC-START-ITEM-REQUEST-N >                   14510099
145200                                          ASC-NUMBER-OF-ITEMS-READ14520099
145300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         14530099
145400                     COMPUTE PV-TOP-ITEM =                        14540099
145500                             ASC-NUMBER-OF-ITEMS-READ             14550099
145600                             - PC-ITEMS-PER-PANEL + 1             14560099
145700                     IF  PV-TOP-ITEM < +1                         14570099
145800                         MOVE +1   TO PV-TOP-ITEM                 14580099
145900                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 14590099
146000                         SET DP020-MSG-INFORMATIONAL TO TRUE      14600099
146100                     END-IF                                       14610099
146200                 ELSE                                             14620099
146300                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 14630099
146400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      14640099
146500                     COMPUTE PV-BOTTOM-ITEM =                     14650099
146600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     14660099
146700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ14670099
146800*                        -- BOTTOM OF LIST --                     14680099
146900                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 14690099
147000                         SET DP020-MSG-INFORMATIONAL TO TRUE      14700099
147100                     END-IF                                       14710099
147200                 END-IF                                           14720099
147300             ELSE                                                 14730099
147400*                --- VALUE OUT OF RANGE ----                      14740099
147500                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         14750099
147600                 MOVE -1           TO ASTRTITL                    14760099
147700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              14770099
147800                 MOVE DP015-REVERSE TO ASTRTITH                   14780099
147900                 MOVE DP015-RED    TO ASTRTITC                    14790099
148000                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           14800099
148100                 SET DP020-MSG-FATAL TO TRUE                      14810099
148200                 SET PS-ERROR      TO TRUE                        14820099
148300             END-IF                                               14830099
148400         ELSE                                                     14840099
148500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14850099
148600             MOVE -1               TO ASTRTITL                    14860099
148700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14870099
148800             MOVE DP015-REVERSE    TO ASTRTITH                    14880099
148900             MOVE DP015-RED        TO ASTRTITC                    14890099
149000             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               14900099
149100             SET DP020-MSG-FATAL   TO TRUE                        14910099
149200             SET PS-ERROR          TO TRUE                        14920099
149300         END-IF                                                   14930099
149400     END-IF.                                                      14940099
149500                                                                  14950099
149600                                                                  14960099
149700*----------------------------------------------------------------*14970099
149800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14980099
149900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14990099
150000*----------------------------------------------------------------*15000099
150100 2140-DESELECT-ALL-ITEMS.                                         15010099
150200     MOVE +1                       TO ASC-BLK-SUB.                15020099
150300                                                                  15030099
150400     PERFORM 2141-CLEAR-SELECTED-INDS                             15040099
150500         VARYING ASC-ITEM-SUB                                     15050099
150600         FROM 1 BY 1                                              15060099
150700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15070099
150800                                                                  15080099
150900     ADD +1                        TO ASC-BLK-SUB.                15090099
151000                                                                  15100099
151100     PERFORM 2141-CLEAR-SELECTED-INDS                             15110099
151200         VARYING ASC-ITEM-SUB                                     15120099
151300         FROM 1 BY 1                                              15130099
151400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15140099
151500                                                                  15150099
151600     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       15160099
151700                                                                  15170099
151800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15180099
151900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15190099
152000                                                                  15200099
152100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15210099
152200        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      15220099
152300         MOVE +1                   TO ASC-BLK-SUB                 15230099
152400                                                                  15240099
152500         PERFORM 5100-WRITE-TEMP-STORAGE                          15250099
152600                                                                  15260099
152700         MOVE +1                   TO PV-BLOCK-NUMBER             15270099
152800                                                                  15280099
152900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15290099
153000             PV-FIRST-BLOCK-IN-ARRAY - 1                          15300099
153100                                                                  15310099
153200         PERFORM                                                  15320099
153300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15330099
153400                                                                  15340099
153500             PERFORM 4410-READ-TEMP-STORAGE                       15350099
153600             PERFORM 2141-CLEAR-SELECTED-INDS                     15360099
153700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 15370099
153800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15380099
153900             PERFORM 5100-WRITE-TEMP-STORAGE                      15390099
154000             ADD +1                TO PV-BLOCK-NUMBER             15400099
154100         END-PERFORM                                              15410099
154200                                                                  15420099
154300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15430099
154400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15440099
154500                                                                  15450099
154600         PERFORM                                                  15460099
154700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15470099
154800                   ASC-HIGHEST-BLOCK-WRITTEN                      15480099
154900             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       15490099
155000             PERFORM 4410-READ-TEMP-STORAGE                       15500099
155100             PERFORM 2141-CLEAR-SELECTED-INDS                     15510099
155200                 VARYING ASC-ITEM-SUB                             15520099
155300                 FROM 1 BY 1                                      15530099
155400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15540099
155500             PERFORM 5100-WRITE-TEMP-STORAGE                      15550099
155600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15560099
155700         END-PERFORM                                              15570099
155800                                                                  15580099
155900         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          15590099
156000                                                                  15600099
156100         PERFORM 4410-READ-TEMP-STORAGE                           15610099
156200     END-IF.                                                      15620099
156300                                                                  15630099
156400     MOVE +0           TO ASC-NUMBER-OF-SELECTED-ITEMS.           15640099
156500     MOVE +0           TO ASC-START-OF-SELECTED-RANGE.            15650099
156600     MOVE +0           TO ASC-END-OF-SELECTED-RANGE.              15660099
156700                                                                  15670099
156800                                                                  15680099
156900*----------------------------------------------------------------*15690099
157000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15700099
157100*----------------------------------------------------------------*15710099
157200 2141-CLEAR-SELECTED-INDS.                                        15720099
157300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15730099
157400             NOT EQUAL ZERO                                       15740099
157500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15750099
157600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15760099
157700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15770099
157800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          15780099
157900         END-IF                                                   15790099
158000     END-IF.                                                      15800099
158100                                                                  15810099
158200                                                                  15820099
158300*----------------------------------------------------------------*15830099
158400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15840099
158500*  FOR ALL ITEMS.                                                *15850099
158600*----------------------------------------------------------------*15860099
158700 2150-SELECT-ALL-ITEMS.                                           15870099
158800     MOVE +1                       TO ASC-BLK-SUB.                15880099
158900                                                                  15890099
159000     PERFORM 2151-SET-SELECTED-INDS                               15900099
159100         VARYING ASC-ITEM-SUB                                     15910099
159200         FROM 1 BY 1                                              15920099
159300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15930099
159400                                                                  15940099
159500     ADD +1                        TO ASC-BLK-SUB.                15950099
159600                                                                  15960099
159700     PERFORM 2151-SET-SELECTED-INDS                               15970099
159800         VARYING ASC-ITEM-SUB                                     15980099
159900         FROM 1 BY 1                                              15990099
160000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16000099
160100                                                                  16010099
160200     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       16020099
160300                                                                  16030099
160400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16040099
160500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16050099
160600                                                                  16060099
160700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16070099
160800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    16080099
160900         MOVE +1                   TO ASC-BLK-SUB                 16090099
161000                                                                  16100099
161100         PERFORM 5100-WRITE-TEMP-STORAGE                          16110099
161200                                                                  16120099
161300         MOVE +1                   TO PV-BLOCK-NUMBER             16130099
161400                                                                  16140099
161500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16150099
161600             PV-FIRST-BLOCK-IN-ARRAY - 1                          16160099
161700                                                                  16170099
161800         PERFORM                                                  16180099
161900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       16190099
162000             PERFORM 4410-READ-TEMP-STORAGE                       16200099
162100             PERFORM 2151-SET-SELECTED-INDS                       16210099
162200                 VARYING ASC-ITEM-SUB                             16220099
162300                 FROM 1 BY 1                                      16230099
162400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16240099
162500             PERFORM 5100-WRITE-TEMP-STORAGE                      16250099
162600             ADD +1                TO PV-BLOCK-NUMBER             16260099
162700         END-PERFORM                                              16270099
162800                                                                  16280099
162900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16290099
163000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16300099
163100                                                                  16310099
163200         PERFORM                                                  16320099
163300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16330099
163400                   ASC-HIGHEST-BLOCK-WRITTEN                      16340099
163500             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       16350099
163600             PERFORM 4410-READ-TEMP-STORAGE                       16360099
163700             PERFORM 2151-SET-SELECTED-INDS                       16370099
163800                 VARYING ASC-ITEM-SUB                             16380099
163900                 FROM 1 BY 1                                      16390099
164000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16400099
164100             PERFORM 5100-WRITE-TEMP-STORAGE                      16410099
164200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16420099
164300         END-PERFORM                                              16430099
164400                                                                  16440099
164500         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          16450099
164600                                                                  16460099
164700         PERFORM 4410-READ-TEMP-STORAGE                           16470099
164800     END-IF.                                                      16480099
164900                                                                  16490099
165000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16500099
165100                       ASC-NUMBER-OF-SELECTED-ITEMS.              16510099
165200                                                                  16520099
165300                                                                  16530099
165400*----------------------------------------------------------------*16540099
165500*    MARK EACH ITEM AS BEING SELECTED.                           *16550099
165600*----------------------------------------------------------------*16560099
165700 2151-SET-SELECTED-INDS.                                          16570099
165800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16580099
165900             NOT EQUAL ZERO                                       16590099
166000         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16600099
166100             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16610099
166200                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16620099
166300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          16630099
166400         END-IF                                                   16640099
166500     END-IF.                                                      16650099
166600                                                                  16660099
166700                                                                  16670099
166800******************************************************************16680099
166900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **16690099
167000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **16700099
167100******************************************************************16710099
167200 2200-MOVE-SCREEN-TO-COMMAREA.                                    16720099
167300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16730099
167400     MOVE +1                       TO PV-SUB.                     16740099
167500                                                                  16750099
167600     PERFORM 3100-SET-SUBSCRIPTS.                                 16760099
167700     IF  ASTRTITL > ZERO                                          16770099
167800         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          16780099
167900     ELSE                                                         16790099
168000         IF  ASTRTITF = DP015-ERASE-EOF                           16800099
168100             INITIALIZE ASC-START-ITEM-REQUEST                    16810099
168200         END-IF                                                   16820099
168300     END-IF.                                                      16830099
168400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          16840099
168500         VARYING PV-SUB                                           16850099
168600         FROM 1 BY 1                                              16860099
168700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      16870099
168800                                                                  16880099
168900                                                                  16890099
169000******************************************************************16900099
169100** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**16910099
169200******************************************************************16920099
169300 2210-MOVE-LINES-TO-COMMAREA.                                     16930099
169400     IF  MR-SELECTL (PV-SUB) > ZERO                               16940099
169500         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             16950099
169600         MOVE MR-SELECTI (PV-SUB) TO ASC-TEMP-SELECTED-SW         16960099
169700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16970099
169800     ELSE                                                         16980099
169900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                16990099
170000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     17000099
170100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        17010099
170200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17020099
170300         END-IF                                                   17030099
170400     END-IF.                                                      17040099
170500     ADD +1                        TO ASC-ITEM-SUB.               17050099
170600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17060099
170700         ADD +1                    TO ASC-BLK-SUB                 17070099
170800         MOVE +1                   TO ASC-ITEM-SUB                17080099
170900     END-IF.                                                      17090099
171000                                                                  17100099
171100                                                                  17110099
171200******************************************************************17120099
171300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **17130099
171400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **17140099
171500******************************************************************17150099
171600 3000-EDIT-DATA-IN-COMMAREA.                                      17160099
171700     SET PS-NO-ERROR               TO TRUE.                       17170099
171800     PERFORM 3200-RESET-ATTRIBUTES.                               17180099
171900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     17190099
172000**                                                                17200099
172100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              17210099
172200* EDITTING IS DONE FROM THE BOTTOM UP.                            17220099
172300**                                                                17230099
172400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       17240099
172500         ASC-ITEMS-DISPLAYED - 1.                                 17250099
172600     PERFORM 3100-SET-SUBSCRIPTS.                                 17260099
172700     PERFORM 3300-EDIT-SELECTIONS                                 17270099
172800         VARYING PV-SUB                                           17280099
172900         FROM PV-SUB BY -1                                        17290099
173000         UNTIL PV-SUB < +1                                        17300099
173100                                                                  17310099
173200     IF  PS-NO-ERROR                                              17320099
173300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        17330099
173400     END-IF.                                                      17340099
173500                                                                  17350099
173600     IF  ((PS-NO-ERROR)                                           17360099
173700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   17370099
173800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    17380099
173900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  17390099
174000     END-IF.                                                      17400099
174100                                                                  17410099
174200                                                                  17420099
174300*----------------------------------------------------------------*17430099
174400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17440099
174500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17450099
174600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17460099
174700*                                                                *17470099
174800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17480099
174900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17490099
175000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17500099
175100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17510099
175200*----------------------------------------------------------------*17520099
175300 3100-SET-SUBSCRIPTS.                                             17530099
175400     COMPUTE PV-ASC-ITEM-SUB-COMP3 =                              17540099
175500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17550099
175600     MOVE PV-ASC-ITEM-SUB-COMP3 TO ASC-ITEM-SUB                   17560099
175700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17570099
175800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17580099
175900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               17590099
176000     ELSE                                                         17600099
176100         MOVE +1                     TO ASC-BLK-SUB               17610099
176200     END-IF.                                                      17620099
176300                                                                  17630099
176400                                                                  17640099
176500******************************************************************17650099
176600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **17660099
176700******************************************************************17670099
176800 3200-RESET-ATTRIBUTES.                                           17680099
176900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   17690099
177000     MOVE DP015-GREEN              TO ASTRTITC.                   17700099
177100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   17710099
177200                                                                  17720099
177300     PERFORM                                                      17730099
177400         VARYING PV-SUB                                           17740099
177500          FROM 1 BY 1                                             17750099
177600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        17760099
177700         MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)        17770099
177800         MOVE DP015-GREEN           TO MR-SELECTC (PV-SUB)        17780099
177900         MOVE DP015-UNDERLINE       TO MR-SELECTH (PV-SUB)        17790099
178000     END-PERFORM.                                                 17800099
178100                                                                  17810099
178200                                                                  17820099
178300******************************************************************17830099
178400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **17840099
178500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **17850099
178600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **17860099
178700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **17870099
178800******************************************************************17880099
178900 3300-EDIT-SELECTIONS.                                            17890099
179000     EVALUATE TRUE                                                17900099
179100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17910099
179200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         17920099
179300                 CONTINUE                                         17930099
179400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17940099
179500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17950099
179600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   17960099
179700                 MOVE ASC-TEMP-SELECTED-SW                        17970099
179800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17980099
179900                   TO ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)  17990099
180000             END-IF                                               18000099
180100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18010099
180200                 = SPACE                                          18020099
180300             EVALUATE TRUE                                        18030099
180400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       18040099
180500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS18050099
180600                     MOVE SPACE TO ASC-SELECTED-SW                18060099
180700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18070099
180800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        18080099
180900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    18090099
181000                     MOVE SPACE TO ASC-SELECTED-SW                18100099
181100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18110099
181200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18120099
181300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      18130099
181400                     MOVE SPACE TO ASC-SELECTED-SW                18140099
181500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18150099
181600             END-EVALUATE                                         18160099
181700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18170099
181800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18180099
181900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18190099
182000             END-IF                                               18200099
182100             PERFORM 3310-EDIT-RANGE                              18210099
182200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18220099
182300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18230099
182400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18240099
182500             END-IF                                               18250099
182600             PERFORM 3310-EDIT-RANGE                              18260099
182700         WHEN OTHER                                               18270099
182800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18280099
182900             SET DP020-MSG-FATAL    TO TRUE                       18290099
183000             MOVE -1                TO MR-SELECTL (PV-SUB)        18300099
183100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  18310099
183200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        18320099
183300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        18330099
183400             SET PS-ERROR TO TRUE                                 18340099
183500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18350099
183600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18360099
183700                 MOVE SPACE         TO ASC-SELECTED-SW            18370099
183800                                        (ASC-BLK-SUB ASC-ITEM-SUB)18380099
183900             END-IF                                               18390099
184000     END-EVALUATE.                                                18400099
184100                                                                  18410099
184200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 18420099
184300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18430099
184400     IF  ASC-ITEM-SUB < 1                                         18440099
184500         SUBTRACT +1 FROM ASC-BLK-SUB                             18450099
184600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18460099
184700     END-IF.                                                      18470099
184800                                                                  18480099
184900                                                                  18490099
185000******************************************************************18500099
185100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **18510099
185200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **18520099
185300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**18530099
185400** THE ENDING.                                                  **18540099
185500******************************************************************18550099
185600 3310-EDIT-RANGE.                                                 18560099
185700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                18570099
185800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   18580099
185900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)18590099
186000                                   TO ASC-SELECTED-SW             18600099
186100                                        (ASC-BLK-SUB ASC-ITEM-SUB)18610099
186200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 18620099
186300         ELSE                                                     18630099
186400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     18640099
186500                 CONTINUE                                         18650099
186600             ELSE                                                 18660099
186700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        18670099
186800                 MOVE PC-TSYMSG-00054 TO DP020-MSG-NUMBER         18680099
186900                 SET DP020-MSG-FATAL TO TRUE                      18690099
187000                 MOVE -1           TO MR-SELECTL (PV-SUB)         18700099
187100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              18710099
187200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         18720099
187300                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      18730099
187400                 SET PS-ERROR      TO TRUE                        18740099
187500             END-IF                                               18750099
187600         END-IF                                                   18760099
187700     ELSE                                                         18770099
187800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18780099
187900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18790099
188000                  TO ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)   18800099
188100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18810099
188200         ELSE                                                     18820099
188300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18830099
188400                 CONTINUE                                         18840099
188500             ELSE                                                 18850099
188600*                -- ONLY ONE END-OF-RANGE ALLOWED --              18860099
188700                 MOVE PC-TSYMSG-00055 TO DP020-MSG-NUMBER         18870099
188800                 SET DP020-MSG-FATAL TO TRUE                      18880099
188900                 MOVE -1           TO MR-SELECTL (PV-SUB)         18890099
189000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              18900099
189100                 SET PS-ERROR      TO TRUE                        18910099
189200             END-IF                                               18920099
189300         END-IF                                                   18930099
189400     END-IF.                                                      18940099
189500                                                                  18950099
189600                                                                  18960099
189700******************************************************************18970099
189800** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **18980099
189900** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **18990099
190000******************************************************************19000099
190100 3400-CHECK-RANGE-SEQUENCE.                                       19010099
190200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19020099
190300       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      19030099
190400       AND  ASC-START-OF-SELECTED-RANGE >                         19040099
190500                                         ASC-END-OF-SELECTED-RANGE19050099
190600*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                19060099
190700         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 19070099
190800         SET DP020-MSG-FATAL TO TRUE                              19080099
190900         SET PS-ERROR TO TRUE                                     19090099
191000         PERFORM 3410-POSITION-AT-ERROR                           19100099
191100     END-IF.                                                      19110099
191200                                                                  19120099
191300                                                                  19130099
191400******************************************************************19140099
191500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **19150099
191600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **19160099
191700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **19170099
191800******************************************************************19180099
191900 3410-POSITION-AT-ERROR.                                          19190099
192000     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         19200099
192100     COMPUTE PV-SUB-COMP3 = ASC-START-OF-SELECTED-RANGE           19210099
192200                    - PV-TOP-ITEM + 1.                            19220099
192300     MOVE PV-SUB-COMP3 TO PV-SUB.                                 19230099
192400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19240099
192500         CONTINUE                                                 19250099
192600     ELSE                                                         19260099
192700         MOVE -1                   TO MR-SELECTL (PV-SUB)         19270099
192800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19280099
192900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19290099
193000     END-IF.                                                      19300099
193100                                                                  19310099
193200     COMPUTE PV-SUB-COMP3 = ASC-END-OF-SELECTED-RANGE             19320099
193300                    - PV-TOP-ITEM + 1.                            19330099
193400     MOVE PV-SUB-COMP3 TO PV-SUB.                                 19340099
193500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19350099
193600         CONTINUE                                                 19360099
193700     ELSE                                                         19370099
193800         MOVE -1                   TO MR-SELECTL (PV-SUB)         19380099
193900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19390099
194000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19400099
194100     END-IF.                                                      19410099
194200                                                                  19420099
194300                                                                  19430099
194400*----------------------------------------------------------------*19440099
194500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *19450099
194600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *19460099
194700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *19470099
194800*----------------------------------------------------------------*19480099
194900 3500-MARK-RANGE-AS-SELECTED.                                     19490099
195000     MOVE +1                       TO  ASC-BLK-SUB.               19500099
195100     PERFORM 3510-MARK-SELECTED-INDS                              19510099
195200         VARYING ASC-ITEM-SUB                                     19520099
195300         FROM 1 BY 1                                              19530099
195400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19540099
195500                                                                  19550099
195600     ADD +1                        TO ASC-BLK-SUB.                19560099
195700     PERFORM 3510-MARK-SELECTED-INDS                              19570099
195800         VARYING ASC-ITEM-SUB                                     19580099
195900         FROM 1 BY 1                                              19590099
196000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19600099
196100                                                                  19610099
196200     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       19620099
196300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19630099
196400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19640099
196500               PC-ITEMS-PER-PANEL).                               19650099
196600                                                                  19660099
196700     MOVE ASC-START-OF-SELECTED-RANGE                             19670099
196800                                   TO PV-START-OF-SELECTED-RANGE. 19680099
196900     COMPUTE PV-FIRST-BLOCK-IN-RANGE = 1 +                        19690099
197000          ((PV-START-OF-SELECTED-RANGE - 1) / PC-ITEMS-PER-PANEL).19700099
197100                                                                  19710099
197200     MOVE ASC-END-OF-SELECTED-RANGE TO  PV-END-OF-SELECTED-RANGE. 19720099
197300     COMPUTE PV-LAST-BLOCK-IN-RANGE = 1 +                         19730099
197400         ((PV-END-OF-SELECTED-RANGE - 1) / PC-ITEMS-PER-PANEL).   19740099
197500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19750099
197600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19760099
197700                                                                  19770099
197800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19780099
197900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19790099
198000         MOVE +1                   TO ASC-BLK-SUB                 19800099
198100         PERFORM 5100-WRITE-TEMP-STORAGE                          19810099
198200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19820099
198300             PV-FIRST-BLOCK-IN-ARRAY - 1                          19830099
198400                                                                  19840099
198500         PERFORM                                                  19850099
198600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19860099
198700                   PV-PREV-BLOCK-IN-ARRAY                         19870099
198800             MOVE PV-FIRST-BLOCK-IN-RANGE TO PV-BLOCK-NUMBER      19880099
198900             PERFORM 4410-READ-TEMP-STORAGE                       19890099
199000             PERFORM 3510-MARK-SELECTED-INDS                      19900099
199100                 VARYING ASC-ITEM-SUB                             19910099
199200                 FROM 1 BY 1                                      19920099
199300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19930099
199400             PERFORM 5100-WRITE-TEMP-STORAGE                      19940099
199500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     19950099
199600         END-PERFORM                                              19960099
199700                                                                  19970099
199800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19980099
199900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19990099
200000         PERFORM                                                  20000099
200100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20010099
200200                   PV-LAST-BLOCK-IN-RANGE                         20020099
200300             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       20030099
200400             PERFORM 4410-READ-TEMP-STORAGE                       20040099
200500             PERFORM 3510-MARK-SELECTED-INDS                      20050099
200600                 VARYING ASC-ITEM-SUB                             20060099
200700                 FROM 1 BY 1                                      20070099
200800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20080099
200900             PERFORM 5100-WRITE-TEMP-STORAGE                      20090099
201000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20100099
201100         END-PERFORM                                              20110099
201200                                                                  20120099
201300         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          20130099
201400         PERFORM 4410-READ-TEMP-STORAGE                           20140099
201500     END-IF.                                                      20150099
201600                                                                  20160099
201700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 20170099
201800                                      ASC-END-OF-SELECTED-RANGE.  20180099
201900                                                                  20190099
202000                                                                  20200099
202100*----------------------------------------------------------------*20210099
202200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *20220099
202300*----------------------------------------------------------------*20230099
202400 3510-MARK-SELECTED-INDS.                                         20240099
202500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         20250099
202600         ASC-START-OF-SELECTED-RANGE)                             20260099
202700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         20270099
202800         ASC-START-OF-SELECTED-RANGE)                             20280099
202900                                                                  20290099
203000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     20300099
203100             ASC-END-OF-SELECTED-RANGE)                           20310099
203200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     20320099
203300             ASC-END-OF-SELECTED-RANGE)                           20330099
203400                                                                  20340099
203500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20350099
203600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20360099
203700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20370099
203800                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE      20380099
203900                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    20390099
204000             END-IF                                               20400099
204100         END-IF                                                   20410099
204200     END-IF.                                                      20420099
204300                                                                  20430099
204400                                                                  20440099
204500*----------------------------------------------------------------*20450099
204600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20460099
204700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20470099
204800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20480099
204900*    DISPLAY THE PANEL TO USER.                                  *20490099
205000*----------------------------------------------------------------*20500099
205100 4000-BUILD-INITIAL-PANEL.                                        20510099
205200     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             20520099
205300                                ASC-BLOCK-ENTRIES (2).            20530099
205400     MOVE +1                 TO ASC-BLK-SUB.                      20540099
205500     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            20550099
205600                                                                  20560099
205700     MOVE +0                 TO ASC-ITEM-SUB                      20570099
205800                                ASC-NUMBER-OF-ITEMS-READ          20580099
205900                                ASC-NUMBER-OF-SELECTED-ITEMS      20590099
206000                                ASC-HIGHEST-BLOCK-WRITTEN         20600099
206100                                ASC-START-OF-SELECTED-RANGE       20610099
206200                                ASC-END-OF-SELECTED-RANGE         20620099
206300                                ASC-ITEM-AT-TOP-OF-PANEL.         20630099
206400     PERFORM 4100-PREPARE-CURSOR.                                 20640099
206500                                                                  20650099
206600     EVALUATE TRUE                                                20660099
206700         WHEN PS-USE-DEPT-CSR                                     20670099
206800             PERFORM 4010-OPEN-TRBL-LIST-CSR-DEPT                 20680099
206900             IF SQLCODE           = -913                          20690099
207000                 PERFORM 9910-SQL-913-RETURN                      20700099
207100             END-IF                                               20710099
207200         WHEN PS-USE-PORCVR-CSR                                   20720099
207300             PERFORM 4016-OPEN-PO-RCVR-CSR                        20730099
207400             IF SQLCODE           = -913                          20740099
207500                 PERFORM 9900-SQL-913-RETURN                      20750099
207600             END-IF                                               20760099
207700         WHEN OTHER                                               20770099
207800             PERFORM 4015-OPEN-TRBL-LIST-CSR-BYR                  20780099
207900             IF SQLCODE           = -913                          20790099
208000                 PERFORM 9910-SQL-913-RETURN                      20800099
208100             END-IF                                               20810099
208200     END-EVALUATE.                                                20820099
208300                                                                  20830099
208400     PERFORM 4200-READ-PO-TROUBLE-ITEMS.                          20840099
208500                                                                  20850099
208600     EVALUATE TRUE                                                20860099
208700         WHEN PS-USE-DEPT-CSR                                     20870099
208800             PERFORM 4020-CLOSE-TRBL-LIST-CSR-DEPT                20880099
208900         WHEN PS-USE-PORCVR-CSR                                   20890099
209000             PERFORM 4026-CLOSE-PO-RCVR-CSR                       20900099
209100         WHEN OTHER                                               20910099
209200             PERFORM 4025-CLOSE-TRBL-LIST-CSR-BYR                 20920099
209300     END-EVALUATE.                                                20930099
209400                                                                  20940099
209500     MOVE +1                   TO  PV-TOP-ITEM.                   20950099
209600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20960099
209700         SET DP020-NEXT-ACT-APPL-ERROR                            20970099
209800             DP020-MSG-FATAL   TO  TRUE                           20980099
209900         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               20990099
210000     ELSE                                                         21000099
210100         IF  PS-ERROR                                             21010099
210200             NEXT SENTENCE                                        21020099
210300         ELSE                                                     21030099
210400             MOVE -1           TO MR-SELECTL (1)                  21040099
210500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  21050099
210600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 21060099
210700         END-IF                                                   21070099
210800     END-IF.                                                      21080099
210900                                                                  21090099
211000                                                                  21100099
211100*----------------------------------------------------------------*21110099
211200* OPEN THE PO TROUBLE LIST CURSOR FOR THE SPECIFIED DEPARTMENT   *21120099
211300*----------------------------------------------------------------*21130099
211400 4010-OPEN-TRBL-LIST-CSR-DEPT.                                    21140099
211500     PERFORM                                                      21150099
211600         WITH TEST AFTER                                          21160099
211700         VARYING PV-RETRY-COUNTER                                 21170099
211800         FROM 1 BY 1                                              21180099
211900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21190099
212000                   OR (SQLCODE = ZERO))                           21200099
212100         EXEC SQL                                                 21210099
212200              OPEN TRBL-LIST-BY-DEPT                              21220099
212300         END-EXEC                                                 21230099
212400                                                                  21240099
212500         EVALUATE TRUE                                            21250099
212600             WHEN SQLCODE = ZERO                                  21260099
212700             WHEN SQLCODE = -904                                  21270099
212800             WHEN SQLCODE = -913                                  21280099
212900                 CONTINUE                                         21290099
213000             WHEN SQLWARN0 NOT = SPACES                           21300099
213100             WHEN SQLCODE < ZERO                                  21310099
213200             WHEN SQLCODE > ZERO                                  21320099
213300                 MOVE '4010-OPEN-TRBL-LIST-CSR-DEPT'              21330099
213400                                   TO DP013-PARAGRAPH             21340099
213500                 MOVE 'OPEN TROUBLE PO LIST CURSOR     '          21350099
213600                                   TO DP013-MESSAGE-TEXT (1)      21360099
213700                 MOVE SQLCA    TO DP013-SQLCA                     21370099
213800                 MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)      21380099
213900                 MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)      21390099
214000                 SET DP013-DB2-ABEND                              21400099
214100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21410099
214200                 PERFORM DP013-0000-PROCESS-ABEND                 21420099
214300         END-EVALUATE                                             21430099
214400     END-PERFORM.                                                 21440099
214500                                                                  21450099
214600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21460099
214700         IF SQLCODE = -913                                        21470099
214800             PERFORM 9910-SQL-913-RETURN                          21480099
214900         ELSE                                                     21490099
215000             MOVE '4010-OPEN-TRBL-LIST-CSR-DEPT'                  21500099
215100                                   TO DP013-PARAGRAPH             21510099
215200             MOVE                                                 21520099
215300                'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR' 21530099
215400                                   TO DP013-MESSAGE-TEXT (1)      21540099
215500             MOVE SQLCA            TO DP013-SQLCA                 21550099
215600             MOVE 'TTRBNTF '       TO DP013-DB2-TABLE-NAME (1)    21560099
215700             MOVE 'TTRBRSN '       TO DP013-DB2-TABLE-NAME (2)    21570099
215800             MOVE 'TRECEIV '       TO DP013-DB2-TABLE-NAME (3)    21580099
215900             SET DP013-DB2-ABEND                                  21590099
216000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21600099
216100             PERFORM DP013-0000-PROCESS-ABEND                     21610099
216200         END-IF                                                   21620099
216300     END-IF.                                                      21630099
216400                                                                  21640099
216500                                                                  21650099
216600*----------------------------------------------------------------*21660099
216700* OPEN THE PO TROUBLE LIST CURSOR FOR THE SPECIFIED BUYER        *21670099
216800*----------------------------------------------------------------*21680099
216900 4015-OPEN-TRBL-LIST-CSR-BYR.                                     21690099
217000     PERFORM                                                      21700099
217100         WITH TEST AFTER                                          21710099
217200         VARYING PV-RETRY-COUNTER                                 21720099
217300         FROM 1 BY 1                                              21730099
217400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21740099
217500                   OR (SQLCODE = ZERO))                           21750099
217600                                                                  21760099
217700         EXEC SQL                                                 21770099
217800              OPEN TRBL-LIST-BY-BYR                               21780099
217900         END-EXEC                                                 21790099
218000                                                                  21800099
218100         EVALUATE TRUE                                            21810099
218200             WHEN SQLCODE = ZERO                                  21820099
218300             WHEN SQLCODE = -904                                  21830099
218400             WHEN SQLCODE = -913                                  21840099
218500                 CONTINUE                                         21850099
218600             WHEN SQLWARN0 NOT = SPACES                           21860099
218700             WHEN SQLCODE < ZERO                                  21870099
218800             WHEN SQLCODE > ZERO                                  21880099
218900                 MOVE '4015-OPEN-TRBL-LIST-CSR-BYR'               21890099
219000                                   TO DP013-PARAGRAPH             21900099
219100                 MOVE 'OPEN TROUBLE PO LIST CURSOR     '          21910099
219200                                   TO DP013-MESSAGE-TEXT (1)      21920099
219300                 MOVE SQLCA    TO DP013-SQLCA                     21930099
219400                 MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)      21940099
219500                 MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (2)      21950099
219600                 MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (3)      21960099
219700                 MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (4)      21970099
219800                 SET DP013-DB2-ABEND                              21980099
219900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21990099
220000                 PERFORM DP013-0000-PROCESS-ABEND                 22000099
220100         END-EVALUATE                                             22010099
220200     END-PERFORM.                                                 22020099
220300                                                                  22030099
220400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22040099
220500         IF SQLCODE = -913                                        22050099
220600             PERFORM 9910-SQL-913-RETURN                          22060099
220700         ELSE                                                     22070099
220800             MOVE '4015-OPEN-TRBL-LIST-CSR-BYR'                   22080099
220900                                            TO DP013-PARAGRAPH    22090099
221000             MOVE                                                 22100099
221100                'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR' 22110099
221200                                   TO DP013-MESSAGE-TEXT (1)      22120099
221300             MOVE SQLCA            TO DP013-SQLCA                 22130099
221400             MOVE 'TTRBNTF '       TO DP013-DB2-TABLE-NAME (1)    22140099
221500             MOVE 'TMDSEAR '       TO DP013-DB2-TABLE-NAME (2)    22150099
221600             MOVE 'TTRBRSN '       TO DP013-DB2-TABLE-NAME (3)    22160099
221700             MOVE 'TRECEIV '       TO DP013-DB2-TABLE-NAME (4)    22170099
221800             SET DP013-DB2-ABEND                                  22180099
221900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22190099
222000             PERFORM DP013-0000-PROCESS-ABEND                     22200099
222100         END-IF                                                   22210099
222200     END-IF.                                                      22220099
222300                                                                  22230099
222400                                                                  22240099
222500*----------------------------------------------------------------*22250099
222600* OPEN THE PO-RCVR CURSOR FOR THE SPECIFIED PO/RCVR              *22260099
222700*----------------------------------------------------------------*22270099
222800 4016-OPEN-PO-RCVR-CSR.                                           22280099
222900     PERFORM                                                      22290099
223000         WITH TEST AFTER                                          22300099
223100         VARYING PV-RETRY-COUNTER                                 22310099
223200         FROM 1 BY 1                                              22320099
223300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22330099
223400                   OR (SQLCODE = ZERO))                           22340099
223500                                                                  22350099
223600         EXEC SQL                                                 22360099
223700              OPEN PO-RCVR-CSR                                    22370099
223800         END-EXEC                                                 22380099
223900                                                                  22390099
224000         EVALUATE TRUE                                            22400099
224100             WHEN SQLCODE = ZERO                                  22410099
224200             WHEN SQLCODE = -904                                  22420099
224300             WHEN SQLCODE = -913                                  22430099
224400                 CONTINUE                                         22440099
224500             WHEN SQLWARN0 NOT = SPACES                           22450099
224600             WHEN SQLCODE < ZERO                                  22460099
224700             WHEN SQLCODE > ZERO                                  22470099
224800                 MOVE '4016-OPEN-PO-RCVR-CSR'                     22480099
224900                                   TO DP013-PARAGRAPH             22490099
225000                 MOVE 'OPEN TROUBLE PO LIST CURSOR     '          22500099
225100                                   TO DP013-MESSAGE-TEXT (1)      22510099
225200                 MOVE SQLCA    TO DP013-SQLCA                     22520099
225300                 MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)      22530099
225400                 MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)      22540099
225500                 MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (3)      22550099
225600                 SET DP013-DB2-ABEND                              22560099
225700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22570099
225800                 PERFORM DP013-0000-PROCESS-ABEND                 22580099
225900         END-EVALUATE                                             22590099
226000     END-PERFORM.                                                 22600099
226100                                                                  22610099
226200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22620099
226300         IF SQLCODE = -913                                        22630099
226400             PERFORM 9910-SQL-913-RETURN                          22640099
226500         ELSE                                                     22650099
226600             MOVE '4016-OPEN-PO-RCVR-CSR' TO DP013-PARAGRAPH      22660099
226700             MOVE                                                 22670099
226800                'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR' 22680099
226900                                    TO DP013-MESSAGE-TEXT (1)     22690099
227000             MOVE SQLCA             TO DP013-SQLCA                22700099
227100             MOVE 'TTRBNTF '        TO DP013-DB2-TABLE-NAME (1)   22710099
227200             MOVE 'TTRBRSN '        TO DP013-DB2-TABLE-NAME (2)   22720099
227300             MOVE 'TRECEIV '        TO DP013-DB2-TABLE-NAME (3)   22730099
227400             SET DP013-DB2-ABEND                                  22740099
227500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22750099
227600             PERFORM DP013-0000-PROCESS-ABEND                     22760099
227700         END-IF                                                   22770099
227800     END-IF.                                                      22780099
227900                                                                  22790099
228000                                                                  22800099
228100*----------------------------------------------------------------*22810099
228200* CLOSE THE PO TROUBLE LIST CURSOR FOR THE SPECIFIED DEPARTMENT  *22820099
228300*----------------------------------------------------------------*22830099
228400 4020-CLOSE-TRBL-LIST-CSR-DEPT.                                   22840099
228500     EXEC SQL                                                     22850099
228600         CLOSE TRBL-LIST-BY-DEPT                                  22860099
228700     END-EXEC                                                     22870099
228800                                                                  22880099
228900     EVALUATE TRUE                                                22890099
229000         WHEN SQLCODE = ZERO                                      22900099
229100             CONTINUE                                             22910099
229200         WHEN SQLWARN0 NOT = SPACES                               22920099
229300         WHEN SQLCODE < ZERO                                      22930099
229400         WHEN SQLCODE > ZERO                                      22940099
229500             MOVE '4020-CLOSE-TRBL-LIST-CSR-DEPT'                 22950099
229600                               TO DP013-PARAGRAPH                 22960099
229700             MOVE 'CLOSE SYSTEM TROUBLE NOTIFICATION CURSOR'      22970099
229800                               TO DP013-MESSAGE-TEXT (1)          22980099
229900             MOVE SQLCA        TO DP013-SQLCA                     22990099
230000             MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)          23000099
230100             MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)          23010099
230200             SET DP013-DB2-ABEND                                  23020099
230300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23030099
230400             PERFORM DP013-0000-PROCESS-ABEND                     23040099
230500     END-EVALUATE.                                                23050099
230600                                                                  23060099
230700                                                                  23070099
230800*----------------------------------------------------------------*23080099
230900* CLOSE THE PO TROUBLE LIST CURSOR FOR THE SPECIFIED BUYER       *23090099
231000*----------------------------------------------------------------*23100099
231100 4025-CLOSE-TRBL-LIST-CSR-BYR.                                    23110099
231200     EXEC SQL                                                     23120099
231300         CLOSE TRBL-LIST-BY-BYR                                   23130099
231400     END-EXEC                                                     23140099
231500                                                                  23150099
231600     EVALUATE TRUE                                                23160099
231700         WHEN SQLCODE = ZERO                                      23170099
231800             CONTINUE                                             23180099
231900         WHEN SQLWARN0 NOT = SPACES                               23190099
232000         WHEN SQLCODE < ZERO                                      23200099
232100         WHEN SQLCODE > ZERO                                      23210099
232200             MOVE '4025-CLOSE-TRBL-LIST-CSR-BYR'                  23220099
232300                               TO DP013-PARAGRAPH                 23230099
232400             MOVE 'CLOSE SYSTEM TROUBLE NOTIFICATION CURSOR'      23240099
232500                               TO DP013-MESSAGE-TEXT (1)          23250099
232600             MOVE SQLCA        TO DP013-SQLCA                     23260099
232700             MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)          23270099
232800             MOVE 'TMDSEAR '       TO DP013-DB2-TABLE-NAME (2)    23280099
232900             MOVE 'TTRBRSN '       TO DP013-DB2-TABLE-NAME (3)    23290099
233000             SET DP013-DB2-ABEND                                  23300099
233100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23310099
233200             PERFORM DP013-0000-PROCESS-ABEND                     23320099
233300     END-EVALUATE.                                                23330099
233400                                                                  23340099
233500                                                                  23350099
233600*----------------------------------------------------------------*23360099
233700* CLOSE THE PO RCVR CURSOR FOR THE SPECIFIED PO/RCVR             *23370099
233800*----------------------------------------------------------------*23380099
233900 4026-CLOSE-PO-RCVR-CSR.                                          23390099
234000     EXEC SQL                                                     23400099
234100         CLOSE PO-RCVR-CSR                                        23410099
234200     END-EXEC                                                     23420099
234300                                                                  23430099
234400     EVALUATE TRUE                                                23440099
234500         WHEN SQLCODE = ZERO                                      23450099
234600             CONTINUE                                             23460099
234700         WHEN SQLWARN0 NOT = SPACES                               23470099
234800         WHEN SQLCODE < ZERO                                      23480099
234900         WHEN SQLCODE > ZERO                                      23490099
235000             MOVE '4026-CLOSE-PO-RCVR-CSR'                        23500099
235100                               TO DP013-PARAGRAPH                 23510099
235200             MOVE 'CLOSE SYSTEM TROUBLE NOTIFICATION CURSOR'      23520099
235300                               TO DP013-MESSAGE-TEXT (1)          23530099
235400             MOVE SQLCA        TO DP013-SQLCA                     23540099
235500             MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)          23550099
235600             MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)          23560099
235700             SET DP013-DB2-ABEND                                  23570099
235800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23580099
235900             PERFORM DP013-0000-PROCESS-ABEND                     23590099
236000     END-EVALUATE.                                                23600099
236100                                                                  23610099
236200                                                                  23620099
236300*----------------------------------------------------------------*23630099
236400*    SET UP THE HOST VARIABLES.                                  *23640099
236500*----------------------------------------------------------------*23650099
236600 4100-PREPARE-CURSOR.                                             23660099
236700     MOVE '000'             TO DK-DEPT-LOW                        23670099
236710                               DK-DEPT-NBR.                       23671099
236800     MOVE '999'             TO DK-DEPT-HIGH.                      23680099
236900     INITIALIZE                DK-PO-NBR                          23690099
237000                               DK-PO-NBR-LOW.                     23700099
237100     MOVE +999999999        TO DK-PO-NBR-HIGH.                    23710099
237200     MOVE +0                TO DK-TRBL-RSN-LOW.                   23720099
237300     MOVE +999              TO DK-TRBL-RSN-HIGH.                  23730099
237400     MOVE SPACES            TO DK-NOTIF-STAT-1                    23740099
237500                               DK-NOTIF-STAT-2                    23750099
237600                               DK-NOTIF-STAT-3                    23760099
237700                               DK-NOTIF-STAT-4                    23770099
237800                               DK-RESP-AREA-1                     23780099
237900                               DK-RESP-AREA-2                     23790099
238000                               DK-RESP-AREA-3.                    23800099
238100     MOVE PC-DUMMY-DB2-DATE-LOW  TO DK-LOW-REC-TMST               23810099
238200                                    DK-LOW-TRB-TMST.              23820099
238300     MOVE PC-DUMMY-DB2-DATE-HIGH TO DK-HIGH-REC-TMST              23830099
238400                                    DK-HIGH-TRB-TMST.             23840099
238500                                                                  23850099
238600     MOVE 'M' TO DK-TRBL-LVL-1.                                   23860099
238700     MOVE 'P' TO DK-TRBL-LVL-2.                                   23870099
238800     MOVE 'X' TO DK-TRBL-LVL-3.                                   23880099
238900     MOVE 'L' TO DK-TRBL-LVL-4.                                   23890099
239000     MOVE 'S' TO DK-TRBL-LVL-5.                                   23900099
239100                                                                  23910099
239200     IF ASC-CRIT-SPEC-FORMAT                                      23920099
239300         IF ASC-KEY-PACK-LVL-IND = 'Y'                            23930099
239400             MOVE SPACES TO DK-TRBL-LVL-2                         23940099
239500                            DK-TRBL-LVL-3                         23950099
239600                            DK-TRBL-LVL-4                         23960099
239700                            DK-TRBL-LVL-5                         23970099
239800         END-IF                                                   23980099
239900         IF ASC-KEY-PACK-FR-DT > SPACES                           23990099
240000             MOVE ASC-KEY-PACK-FR-DT TO DK-LOW-TRBL-DATE          24000099
240100         END-IF                                                   24010099
240200         IF ASC-KEY-PACK-TO-DT > SPACES                           24020099
240300             MOVE ASC-KEY-PACK-TO-DT TO DK-HIGH-TRBL-DATE         24030099
240400             MOVE PC-DUMMY-TIME-HIGH TO DK-HIGH-TRBL-TIME         24040099
240500         END-IF                                                   24050099
240600     END-IF.                                                      24060099
240700                                                                  24070099
240800     SET PS-PO-NBR-NOT-ENTERED TO TRUE.                           24080099
240900                                                                  24090099
241000     EVALUATE TRUE                                                24100099
241100         WHEN ASC-RA-BUYER-SW                                     24110099
241200             MOVE ASC-RA-BUYER TO DK-RESP-AREA-1                  24120099
241300         WHEN ASC-RA-ANALYST-SW                                   24130099
241400             MOVE ASC-RA-ANALYST TO DK-RESP-AREA-1                24140099
241500         WHEN ASC-RA-BUY-ANALYST-SW                               24150099
241600             MOVE ASC-RA-BUYER TO DK-RESP-AREA-1                  24160099
241700             MOVE ASC-RA-ANALYST TO DK-RESP-AREA-2                24170099
241800         WHEN ASC-RA-BUY-ANALYST-DC-SW                            24180099
241900             MOVE ASC-RA-BUYER TO DK-RESP-AREA-1                  24190099
242000             MOVE ASC-RA-ANALYST TO DK-RESP-AREA-2                24200099
242100             MOVE ASC-RA-BUYER-ANALYST-DC TO DK-RESP-AREA-3       24210099
242200     END-EVALUATE.                                                24220099
242300                                                                  24230099
242400     IF  ASC-KEY-PO-NBR > ZERO                                    24240099
242500         MOVE ASC-KEY-PO-NBR TO DK-PO-NBR                         24250099
242600                                DK-PO-NBR-LOW                     24260099
242700                                DK-PO-NBR-HIGH                    24270099
242800         SET PS-PO-NBR-ENTERED TO TRUE                            24280099
242900         SET PS-USE-PORCVR-CSR TO TRUE                            24290099
243000     END-IF.                                                      24300099
243100                                                                  24310099
243200     IF (ASC-DEPT > SPACES)  AND                                  24320099
243300        (PS-PO-NBR-NOT-ENTERED)                                   24330099
243400         MOVE ASC-DEPT      TO DK-DEPT-LOW                        24340099
243500                               DK-DEPT-HIGH                       24350099
243510                               DK-DEPT-NBR                        24351099
243600     SET PS-USE-DEPT-CSR    TO TRUE                               24360099
243700     END-IF.                                                      24370099
243800                                                                  24380099
243900     IF (ASC-BUYER > ZEROS)  AND                                  24390099
244000        (PS-PO-NBR-NOT-ENTERED)                                   24400099
244100         MOVE ASC-BUYER     TO DK-BUYER-NBR-N                     24410099
244200         SET PS-USE-BYR-CSR TO TRUE                               24420099
244300     END-IF.                                                      24430099
244400                                                                  24440099
244500     IF  ASC-ALL-NOTIF-STATS                                      24450099
244600         MOVE PC-NEW-TROUBLE TO DK-NOTIF-STAT-1                   24460099
244700         MOVE PC-IN-PROCESS-TROUBLE TO DK-NOTIF-STAT-2            24470099
244800         MOVE PC-RESOLVED-TROUBLE TO DK-NOTIF-STAT-3              24480099
244900         MOVE PC-ACKNOWLEDGED-TROUBLE TO DK-NOTIF-STAT-4          24490099
245000     ELSE                                                         24500099
245100         IF  ASC-UNRSLVD-STAT-ONLY                                24510099
245200             MOVE PC-NEW-TROUBLE TO DK-NOTIF-STAT-1               24520099
245300             MOVE PC-IN-PROCESS-TROUBLE TO DK-NOTIF-STAT-2        24530099
245400         END-IF                                                   24540099
245500     END-IF.                                                      24550099
245600                                                                  24560099
245700     IF  ASC-KEY-REC-SEQ-NBR >  ZEROS                             24570099
245800         MOVE ASC-KEY-REC-SEQ-NBR TO DK-REC-SEQ-NBR               24580099
245900                                     DK-REC-SEQ-NBR-LOW           24590099
246000                                     DK-REC-SEQ-NBR-HIGH          24600099
246100     ELSE                                                         24610099
246200         MOVE PC-000000000        TO DK-REC-SEQ-NBR               24620099
246300                                     DK-REC-SEQ-NBR-LOW           24630099
246400         MOVE PC-999999999        TO DK-REC-SEQ-NBR-HIGH          24640099
246500     END-IF.                                                      24650099
246600                                                                  24660099
246700     EVALUATE TRUE                                                24670099
246800         WHEN ASC-RCVR-STAT-ARR-ENR                               24680099
246900             MOVE PC-DUMMY-DB2-DATE-LOW  TO DK-LOW-REC-TMST       24690099
247000             MOVE PC-DUMMY-DB2-DATE-HIGH TO DK-HIGH-REC-TMST      24700099
247100         WHEN ASC-RCVR-STAT-ARRIVED                               24710099
247200             MOVE PC-DUMMY-DB2-DATE-LOW  TO DK-LOW-REC-TMST       24720099
247300             EXEC SQL                                             24730099
247400                 SET :DK-HIGH-REC-TMST = CURRENT TIMESTAMP        24740099
247500             END-EXEC                                             24750099
247600         WHEN ASC-RCVR-STAT-ENROUTE                               24760099
247700             MOVE PC-DUMMY-DB2-DATE-HIGH TO DK-LOW-REC-TMST       24770099
247800                                            DK-HIGH-REC-TMST      24780099
247900     END-EVALUATE.                                                24790099
248000                                                                  24800099
248100                                                                  24810099
248200*----------------------------------------------------------------*24820099
248300*    THIS IS THE FIRST CURSOR USED IN THIS PROCESSING            *24830099
248400*    READ FIRST TROUBLE RECORD FOR A SPECIFIC PO.  THE           *24840099
248500*    INFORMATION FOUND IN THIS READ WILL BE USED BY THE SECOND   *24850099
248600*    CURSOR TO RETRIEVE ALL OTHER TROUBLE NOTIFICATION RECORDS   *24860099
248700*    FOR THIS PO.                                                *24870099
248800*----------------------------------------------------------------*24880099
248900 4200-READ-PO-TROUBLE-ITEMS.                                      24890099
249000     PERFORM                                                      24900099
249100         VARYING PV-READ-COUNT                                    24910099
249200         FROM 1 BY 1                                              24920099
249300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    24930099
249400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         24940099
249500                                                                  24950099
249600**** THIS IS THE FIRST CURSOR USED IN THIS PROCESSING            *24960099
249700         EVALUATE TRUE                                            24970099
249800             WHEN PS-USE-DEPT-CSR                                 24980099
249900                 PERFORM 4210-FETCH-PO-TROUBLE-DEPT               24990099
250000             WHEN PS-USE-PORCVR-CSR                               25000099
250100                 PERFORM 4216-FETCH-PO-RCVR-CSR                   25010099
250200             WHEN OTHER                                           25020099
250300                 PERFORM 4215-FETCH-PO-TROUBLE-BYR                25030099
250400         END-EVALUATE                                             25040099
250500                                                                  25050099
250600         IF  ASC-ITEMS-LEFT-ON-DB                                 25060099
250700             PERFORM 4220-OPEN-TROUBLE-NOTIF-CSR                  25070099
250800             SET PS-TRBL-NOTIF-ITEMS-LEFT TO TRUE                 25080099
250900             INITIALIZE PV-PREV-REC-SEQ-NBR                       25090099
251000             PERFORM 4300-READ-TROUBLE-NOTIF-FOR-PO               25100099
251100             PERFORM 4230-CLOSE-TROUBLE-NOTIF-CSR                 25110099
251200         END-IF                                                   25120099
251300     END-PERFORM.                                                 25130099
251400                                                                  25140099
251500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          25150099
251600         MOVE +1               TO ASC-BLK-SUB                     25160099
251700         PERFORM 5100-WRITE-TEMP-STORAGE                          25170099
251800         ADD +1                TO ASC-BLK-SUB                     25180099
251900         PERFORM 5100-WRITE-TEMP-STORAGE                          25190099
252000                                                                  25200099
252100         MOVE 1                TO ASC-BLK-SUB                     25210099
252200                                  PV-BLOCK-NUMBER                 25220099
252300         PERFORM 4410-READ-TEMP-STORAGE                           25230099
252400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             25240099
252500             MOVE 2            TO ASC-BLK-SUB                     25250099
252600                                  PV-BLOCK-NUMBER                 25260099
252700             PERFORM 4410-READ-TEMP-STORAGE                       25270099
252800         END-IF                                                   25280099
252900     END-IF.                                                      25290099
253000                                                                  25300099
253100                                                                  25310099
253200*----------------------------------------------------------------*25320099
253300*    FETCH ALL OF THE PO'S WITH TROUBLE NOTIFICATION RECORDS     *25330099
253400*    THAT MEET THE SPECIFIED CRITERIA.  THIS CURSOR IS USED WHEN *25340099
253500*    A DEPARTMENT NUMBER IS SPECIFIED.                           *25350099
253600*----------------------------------------------------------------*25360099
253700 4210-FETCH-PO-TROUBLE-DEPT.                                      25370099
253800     EXEC SQL                                                     25380099
253900          FETCH TRBL-LIST-BY-DEPT                                 25390099
254000           INTO                                                   25400099
254100                :TRBNTF-PO-NBR                                    25410099
254200              , :TRBNTF-NOTIF-TMST                                25420099
254300              , :RECEIV-REC-TMST                                  25430099
254400     END-EXEC.                                                    25440099
254500                                                                  25450099
254600     EVALUATE TRUE                                                25460099
254700         WHEN SQLCODE = ZERO                                      25470099
254800              MOVE TRBNTF-PO-NBR      TO DK-PO-NBR                25480099
254900         WHEN SQLCODE = +100                                      25490099
255000              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 25500099
255100         WHEN SQLWARN0 NOT = SPACE                                25510099
255200         WHEN SQLCODE NOT = ZERO                                  25520099
255300              MOVE '4210-FETCH-PO-TROUBLE-DEPT'                   25530099
255400                               TO DP013-PARAGRAPH                 25540099
255500              MOVE 'FETCH TROUBLE NOTIFICATION CURSOR'            25550099
255600                               TO DP013-MESSAGE-TEXT (1)          25560099
255700              MOVE SQLCA       TO DP013-SQLCA                     25570099
255800              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        25580099
255900              SET DP013-DB2-ABEND TO TRUE                         25590099
256000              PERFORM DP013-0000-PROCESS-ABEND                    25600099
256100     END-EVALUATE.                                                25610099
256200                                                                  25620099
256300                                                                  25630099
256400*----------------------------------------------------------------*25640099
256500*    FETCH ALL OF THE PO'S WITH TROUBLE NOTIFICATION RECORDS     *25650099
256600*    THAT MEET THE SPECIFIED CRITERIA.  THIS CURSOR IS USED WHEN *25660099
256700*    A BUYER NUMBER IS SPECIFIED.                                *25670099
256800*----------------------------------------------------------------*25680099
256900 4215-FETCH-PO-TROUBLE-BYR.                                       25690099
257000     EXEC SQL                                                     25700099
257100          FETCH TRBL-LIST-BY-BYR                                  25710099
257200           INTO                                                   25720099
257300                :TRBNTF-PO-NBR                                    25730099
257400              , :TRBNTF-NOTIF-TMST                                25740099
257500              , :RECEIV-REC-TMST                                  25750099
257600     END-EXEC.                                                    25760099
257700                                                                  25770099
257800     EVALUATE TRUE                                                25780099
257900         WHEN SQLCODE = ZERO                                      25790099
258000              MOVE TRBNTF-PO-NBR      TO DK-PO-NBR                25800099
258100         WHEN SQLCODE = +100                                      25810099
258200              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 25820099
258300         WHEN SQLWARN0 NOT = SPACE                                25830099
258400         WHEN SQLCODE NOT = ZERO                                  25840099
258500              MOVE '4215-FETCH-PO-TROUBLE-BYR'                    25850099
258600                               TO DP013-PARAGRAPH                 25860099
258700              MOVE 'FETCH TROUBLE NOTIFICATION CURSOR'            25870099
258800                               TO DP013-MESSAGE-TEXT (1)          25880099
258900              MOVE SQLCA       TO DP013-SQLCA                     25890099
259000              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        25900099
259100              MOVE 'TMDSEAR '  TO DP013-DB2-TABLE-NAME (2)        25910099
259200              MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (3)        25920099
259300              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (4)        25930099
259400              SET DP013-DB2-ABEND TO TRUE                         25940099
259500              PERFORM DP013-0000-PROCESS-ABEND                    25950099
259600     END-EVALUATE.                                                25960099
259700                                                                  25970099
259800                                                                  25980099
259900*----------------------------------------------------------------*25990099
260000*    FETCH ALL OF THE PO'S WITH TROUBLE NOTIFICATION RECORDS     *26000099
260100*    THAT MEET THE SPECIFIED CRITERIA.  THIS CURSOR IS USED WHEN *26010099
260200*    A PO NUMBER OR PO NBR AND RCVR SEQ. NBR ARE ENTERED         *26020099
260300*----------------------------------------------------------------*26030099
260400 4216-FETCH-PO-RCVR-CSR.                                          26040099
260500     EXEC SQL                                                     26050099
260600          FETCH PO-RCVR-CSR                                       26060099
260700           INTO                                                   26070099
260800                :TRBNTF-PO-NBR                                    26080099
260900              , :TRBNTF-NOTIF-TMST                                26090099
261000              , :RECEIV-REC-TMST                                  26100099
261100     END-EXEC.                                                    26110099
261200                                                                  26120099
261300     EVALUATE TRUE                                                26130099
261400         WHEN SQLCODE = ZERO                                      26140099
261500              MOVE TRBNTF-PO-NBR      TO DK-PO-NBR                26150099
261600         WHEN SQLCODE = +100                                      26160099
261700              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 26170099
261800         WHEN SQLWARN0 NOT = SPACE                                26180099
261900         WHEN SQLCODE NOT = ZERO                                  26190099
262000              MOVE '4216-FETCH-PO-RCVR-CSR'                       26200099
262100                               TO DP013-PARAGRAPH                 26210099
262200              MOVE 'FETCH TROUBLE NOTIFICATION CURSOR'            26220099
262300                               TO DP013-MESSAGE-TEXT (1)          26230099
262400              MOVE SQLCA       TO DP013-SQLCA                     26240099
262500              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        26250099
262600              SET DP013-DB2-ABEND TO TRUE                         26260099
262700              PERFORM DP013-0000-PROCESS-ABEND                    26270099
262800     END-EVALUATE.                                                26280099
262900                                                                  26290099
263000                                                                  26300099
263100*----------------------------------------------------------------*26310099
263200* OPEN THE TROUBLE NOTIFICATION CURSOR                           *26320099
263300*----------------------------------------------------------------*26330099
263400 4220-OPEN-TROUBLE-NOTIF-CSR.                                     26340099
263500     PERFORM                                                      26350099
263600         WITH TEST AFTER                                          26360099
263700         VARYING PV-RETRY-COUNTER                                 26370099
263800         FROM 1 BY 1                                              26380099
263900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26390099
264000                   OR (SQLCODE = ZERO))                           26400099
264100         IF PS-USE-PORCVR-CSR                                     26410099
264200             EXEC SQL                                             26420099
264300                  OPEN PO-RCVR-BY-PO-CSR                          26430099
264400             END-EXEC                                             26440099
264500         ELSE                                                     26450099
264600             EXEC SQL                                             26460099
264700                  OPEN TRBL-NTF-BY-PO-CSR                         26470099
264800             END-EXEC                                             26480099
264900         END-IF                                                   26490099
265000                                                                  26500099
265100         EVALUATE TRUE                                            26510099
265200             WHEN SQLCODE = ZERO                                  26520099
265300             WHEN SQLCODE = -904                                  26530099
265400                 CONTINUE                                         26540099
265500             WHEN SQLCODE = -913                                  26550099
265600                 CONTINUE                                         26560099
265700             WHEN SQLWARN0 NOT = SPACES                           26570099
265800             WHEN SQLCODE < ZERO                                  26580099
265900             WHEN SQLCODE > ZERO                                  26590099
266000                 MOVE '4220-OPEN-TROUBLE-NOTIF-CSR'               26600099
266100                                   TO DP013-PARAGRAPH             26610099
266200                 MOVE 'OPEN TROUBLE NOTIF BY PO CURSOR '          26620099
266300                                   TO DP013-MESSAGE-TEXT (1)      26630099
266400                 MOVE SQLCA        TO DP013-SQLCA                 26640099
266500                 MOVE 'TTRBNTF '   TO DP013-DB2-TABLE-NAME (1)    26650099
266600                 MOVE 'TTRBRSN '   TO DP013-DB2-TABLE-NAME (2)    26660099
266700                 SET DP013-DB2-ABEND                              26670099
266800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26680099
266900                 PERFORM DP013-0000-PROCESS-ABEND                 26690099
267000         END-EVALUATE                                             26700099
267100     END-PERFORM.                                                 26710099
267200                                                                  26720099
267300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26730099
267400         IF SQLCODE = -913                                        26740099
267500             PERFORM 9910-SQL-913-RETURN                          26750099
267600         ELSE                                                     26760099
267700             MOVE '4220-OPEN-TROUBLE-NOTIF-CSR'                   26770099
267800                                      TO DP013-PARAGRAPH          26780099
267900             MOVE                                                 26790099
268000                'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR' 26800099
268100                                      TO DP013-MESSAGE-TEXT (1)   26810099
268200             MOVE SQLCA               TO DP013-SQLCA              26820099
268300             MOVE 'TTRBNTF '          TO DP013-DB2-TABLE-NAME (1) 26830099
268400             MOVE 'TTRBRSN '          TO DP013-DB2-TABLE-NAME (2) 26840099
268500             SET DP013-DB2-ABEND                                  26850099
268600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               26860099
268700             PERFORM DP013-0000-PROCESS-ABEND                     26870099
268800         END-IF                                                   26880099
268900     END-IF.                                                      26890099
269000                                                                  26900099
269100                                                                  26910099
269200*----------------------------------------------------------------*26920099
269300* CLOSE THE TROUBLE NOTIFICATION CURSOR                          *26930099
269400*----------------------------------------------------------------*26940099
269500 4230-CLOSE-TROUBLE-NOTIF-CSR.                                    26950099
269600     IF PS-USE-PORCVR-CSR                                         26960099
269700         EXEC SQL                                                 26970099
269800             CLOSE PO-RCVR-BY-PO-CSR                              26980099
269900         END-EXEC                                                 26990099
270000     ELSE                                                         27000099
270100         EXEC SQL                                                 27010099
270200             CLOSE TRBL-NTF-BY-PO-CSR                             27020099
270300         END-EXEC                                                 27030099
270400     END-IF                                                       27040099
270500                                                                  27050099
270600     EVALUATE TRUE                                                27060099
270700         WHEN SQLCODE = ZERO                                      27070099
270800             CONTINUE                                             27080099
270900         WHEN SQLWARN0 NOT = SPACES                               27090099
271000         WHEN SQLCODE < ZERO                                      27100099
271100         WHEN SQLCODE > ZERO                                      27110099
271200             MOVE '4230-CLOSE-TROUBLE-NOTIF-CSR'                  27120099
271300                               TO DP013-PARAGRAPH                 27130099
271400             MOVE 'CLOSE SYSTEM TROUBLE NOTIFICATION CURSOR'      27140099
271500                               TO DP013-MESSAGE-TEXT (1)          27150099
271600             MOVE SQLCA        TO DP013-SQLCA                     27160099
271700             MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)          27170099
271800             MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)          27180099
271900             SET DP013-DB2-ABEND                                  27190099
272000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27200099
272100             PERFORM DP013-0000-PROCESS-ABEND                     27210099
272200     END-EVALUATE.                                                27220099
272300                                                                  27230099
272400                                                                  27240099
272500*----------------------------------------------------------------*27250099
272600*    READ THE NOTIFICATION RECORDS FOR A SPECIFIC PO AND MOVE    *27260099
272700*    THEM INTO THE BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS    *27270099
272800*    BECOME FULL, WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE,  *27280099
272900*    MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND       *27290099
273000*    INITIALIZE THE 2ND BLOCK MAKING IT AVAILABLE TO BE USED.    *27300099
273100*                                                                *27310099
273200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *27320099
273300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *27330099
273400*    UPON INITIALIZATION.                                        *27340099
273500*----------------------------------------------------------------*27350099
273600 4300-READ-TROUBLE-NOTIF-FOR-PO.                                  27360099
273700     PERFORM                                                      27370099
273800         VARYING PV-READ-COUNT                                    27380099
273900         FROM 1 BY 1                                              27390099
274000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    27400099
274100            OR (PS-NO-TRBL-NOTIF-ITEMS-LEFT)                      27410099
274200            OR (PS-ERROR))                                        27420099
274300                                                                  27430099
274400**** THIS IS THE SECOND CURSOR USED IN THIS PROCESSING           *27440099
274500         PERFORM 4310-FETCH-TROUBLE-NOTIF-ITEM                    27450099
274600                                                                  27460099
274700         IF  TRBNTF-REC-SEQ-NBR NOT = PV-PREV-REC-SEQ-NBR         27470099
274800             MOVE TRBNTF-REC-SEQ-NBR TO PV-PREV-REC-SEQ-NBR       27480099
274900             INITIALIZE PV-TRBL-RSN-SUB                           27490099
275000                        TR-TROUBLE-REASON-TABLE                   27500099
275100         END-IF                                                   27510099
275200                                                                  27520099
275300         IF PS-PROCESS-TROUBLE-LINE                               27530099
275400           SET TR-TRBL-IDX TO +1                                  27540099
275500                                                                  27550099
275600           SEARCH TR-TROUBLE-REASON-ENTRY                         27560099
275700           VARYING TR-TRBL-IDX                                    27570099
275800             AT END                                               27580099
275900                 SET PS-DISPLAY-TROUBLE-LINE TO TRUE              27590099
276000             WHEN TR-TROUBLE-REASON-N (TR-TRBL-IDX) =             27600099
276100                                              TRBNTF-TRBL-RSN-CDE 27610099
276200                 SET PS-DO-NOT-DISPLAY-TROUBLE-LINE TO TRUE       27620099
276300           END-SEARCH                                             27630099
276400         ELSE                                                     27640099
276500                 SET PS-DO-NOT-DISPLAY-TROUBLE-LINE TO TRUE       27650099
276600         END-IF                                                   27660099
276700                                                                  27670099
276800         IF  PS-DISPLAY-TROUBLE-LINE                              27680099
276900             SET PS-TRBL-RSN-NOT-LOADED   TO TRUE                 27690099
277000             PERFORM VARYING TR-TRBL-IDX                          27700099
277100               FROM 1 BY 1                                        27710099
277200                 UNTIL (TR-TRBL-IDX > PC-MAX-TABLE-ENTRIES) OR    27720099
277300                       (PS-TRBL-RSN-LOADED)                       27730099
277400                 IF  TR-TROUBLE-REASON (TR-TRBL-IDX) = SPACES     27740099
277500                     MOVE TRBNTF-TRBL-RSN-CDE                     27750099
277600                                          TO TR-TROUBLE-REASON-N  27760099
277700                                             (TR-TRBL-IDX)        27770099
277800                     SET PS-TRBL-RSN-LOADED TO TRUE               27780099
277900                 END-IF                                           27790099
278000             END-PERFORM                                          27800099
278100         END-IF                                                   27810099
278200                                                                  27820099
278300         IF  TR-TRBL-IDX > PC-MAX-TABLE-ENTRIES                   27830099
278400             MOVE PC-TSYMSG-00994         TO DP020-MSG-NUMBER     27840099
278500             SET PS-DO-NOT-DISPLAY-TROUBLE-LINE                   27850099
278600                 DP020-NEXT-ACT-APPL-ERROR                        27860099
278700                 DP020-MSG-FATAL                                  27870099
278800                 PS-ERROR                 TO  TRUE                27880099
278900         END-IF                                                   27890099
279000                                                                  27900099
279100         IF (PS-TRBL-NOTIF-ITEMS-LEFT) AND                        27910099
279200            (PS-DISPLAY-TROUBLE-LINE)                             27920099
279300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                27930099
279400                 ADD +1            TO ASC-ITEM-SUB                27940099
279500             ELSE                                                 27950099
279600                 ADD +1            TO ASC-BLK-SUB                 27960099
279700                 MOVE +1           TO ASC-ITEM-SUB                27970099
279800                                                                  27980099
279900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         27990099
280000                     MOVE +1       TO ASC-BLK-SUB                 28000099
280100                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           28010099
280200                     PERFORM 5100-WRITE-TEMP-STORAGE              28020099
280300                     MOVE ASC-BLOCK-ENTRIES                       28030099
280400                               (PC-MAX-BLOCKS-IN-ARRAY)           28040099
280500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 28050099
280600                     ADD +1        TO ASC-BLK-SUB                 28060099
280700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   28070099
280800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      28080099
280900                                   TO TRUE                        28090099
281000                 END-IF                                           28100099
281100             END-IF                                               28110099
281200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    28120099
281300             MOVE ASC-NUMBER-OF-ITEMS-READ                        28130099
281400                                   TO ASC-LIST-ITEM-NUMBER        28140099
281500                                        (ASC-BLK-SUB ASC-ITEM-SUB)28150099
281600             MOVE TRBNTF-NOTIF-NBR TO ASC-NOTIF-NBR               28160099
281700                                        (ASC-BLK-SUB ASC-ITEM-SUB)28170099
281800             MOVE TRBNTF-OPER-UNT-ID TO ASC-OPER-UNT-ID           28180099
281900                                        (ASC-BLK-SUB ASC-ITEM-SUB)28190099
282000             MOVE TRBNTF-FCLTY-ID  TO ASC-FCLTY-ID                28200099
282100                                        (ASC-BLK-SUB ASC-ITEM-SUB)28210099
282200             MOVE TRBNTF-DEPT-NBR  TO ASC-DEPT-NBR                28220099
282300                                        (ASC-BLK-SUB ASC-ITEM-SUB)28230099
282400             MOVE TRBNTF-PO-NBR    TO ASC-PO-NBR-N                28240099
282500                                        (ASC-BLK-SUB ASC-ITEM-SUB)28250099
282600             MOVE TRBNTF-REC-SEQ-NBR TO ASC-RCVR-SEQ-NBR-N        28260099
282700                                        (ASC-BLK-SUB ASC-ITEM-SUB)28270099
282800             MOVE TRBNTF-PO-LNE-NBR TO ASC-PO-LNE-NBR-N           28280099
282900                                        (ASC-BLK-SUB ASC-ITEM-SUB)28290099
283000             MOVE TRBNTF-PREPK-ID   TO ASC-PREPK-ID-N             28300099
283100                                        (ASC-BLK-SUB ASC-ITEM-SUB)28310099
283200                                                                  28320099
283300             PERFORM 4320-FETCH-VENDOR-SHORT-NAME                 28330099
283400                                                                  28340099
283500             MOVE ENTNME-ENT-NAME-DESC TO ASC-VENDOR-SHORT-NME    28350099
283600                                        (ASC-BLK-SUB ASC-ITEM-SUB)28360099
283700             MOVE TRBNTF-ENT-ID    TO ASC-ENT-ID                  28370099
283800                                        (ASC-BLK-SUB ASC-ITEM-SUB)28380099
283900                                                                  28390099
284000             PERFORM 4330-FETCH-LOCATION-SHT-NAME                 28400099
284100                                                                  28410099
284200             MOVE PV-LOC-4-CHAR-NM    TO ASC-FCLTY-NME            28420099
284300                                        (ASC-BLK-SUB ASC-ITEM-SUB)28430099
284400             MOVE TRBNTF-TRBL-RSN-CDE TO ASC-TROUBLE-REASON-CDE   28440099
284500                                        (ASC-BLK-SUB ASC-ITEM-SUB)28450099
284600             MOVE TRBRSN-TRBL-SHT-DESC TO ASC-TROUBLE-REASON-DESC 28460099
284700                                        (ASC-BLK-SUB ASC-ITEM-SUB)28470099
284800             MOVE TRBRSN-RESP-RES-IND TO ASC-TROUBLE-RESP-RES-IND 28480099
284900                                        (ASC-BLK-SUB ASC-ITEM-SUB)28490099
285000             MOVE TRBRSN-TRBL-LVL-IND TO ASC-TROUBLE-REASON-LVL   28500099
285100                                        (ASC-BLK-SUB ASC-ITEM-SUB)28510099
285200                                                                  28520099
285300             IF  RECEIV-REC-TMST = PC-DUMMY-DB2-DATE              28530099
285400                 MOVE 'ENROUTE'    TO ASC-ARRIVAL-DATE-TIME       28540099
285500                                        (ASC-BLK-SUB ASC-ITEM-SUB)28550099
285600             ELSE                                                 28560099
285700                 MOVE RECEIV-REC-TMST TO PV-TIMESTAMP             28570099
285800                 STRING PV-TIMESTAMP-MONTH  DELIMITED BY SIZE     28580099
285900                        PC-SLASH            DELIMITED BY SIZE     28590099
286000                        PV-TIMESTAMP-DAY    DELIMITED BY SIZE     28600099
286100                        PC-SPACE            DELIMITED BY SIZE     28610099
286200                        PV-TIMESTAMP-HOUR   DELIMITED BY SIZE     28620099
286300                                 INTO ASC-ARRIVAL-DATE-TIME       28630099
286400                                        (ASC-BLK-SUB ASC-ITEM-SUB)28640099
286500             END-IF                                               28650099
286600             MOVE TRBNTF-NOTIF-TMST TO PV-TIMESTAMP               28660099
286700             STRING PV-TIMESTAMP-MONTH  DELIMITED BY SIZE         28670099
286800                    PC-SLASH            DELIMITED BY SIZE         28680099
286900                    PV-TIMESTAMP-DAY    DELIMITED BY SIZE         28690099
287000                    PC-SPACE            DELIMITED BY SIZE         28700099
287100                    PV-TIMESTAMP-HOUR   DELIMITED BY SIZE         28710099
287200                                 INTO ASC-NOTIFICATION-DATE-TIME  28720099
287300                                        (ASC-BLK-SUB ASC-ITEM-SUB)28730099
287400                                                                  28740099
287500             PERFORM 4350-FETCH-TROUBLE-DETAIL                    28750099
287600                                                                  28760099
287700             IF  PS-TRBL-DTL-EXISTS                               28770099
287800                 SET ASC-TRBL-DTL-EXISTS                          28780099
287900                        (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE        28790099
288000             ELSE                                                 28800099
288100                 SET ASC-NO-TRBL-DTL-EXISTS                       28810099
288200                        (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE        28820099
288300             END-IF                                               28830099
288400                                                                  28840099
288500             IF  TRBNTF-RESOLVED-IND = PC-NEW-TROUBLE OR          28850099
288600                                       PC-IN-PROCESS-TROUBLE      28860099
288700                 SET ASC-TRBL-NOT-RESOLVED                        28870099
288800                        (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE        28880099
288900             ELSE                                                 28890099
289000                 INITIALIZE PV-UNRESOLVED-TROUBLE-COUNT           28900099
289100                 PERFORM 4370-COUNT-UNRESOLVED-TROUBLE            28910099
289200                 IF  PV-UNRESOLVED-TROUBLE-COUNT = 0              28920099
289300                     SET ASC-TRBL-RESOLVED                        28930099
289400                        (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE        28940099
289500                 ELSE                                             28950099
289600                     SET ASC-TRBL-NOT-RESOLVED                    28960099
289700                        (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE        28970099
289800                 END-IF                                           28980099
289900             END-IF                                               28990099
290000             IF  PV-TIMESTAMP = PC-DUMMY-DB2-DATE                 29000099
290100                 MOVE SPACES       TO ASC-RESPONSE-DATE-TIME      29010099
290200                                        (ASC-BLK-SUB ASC-ITEM-SUB)29020099
290300             ELSE                                                 29030099
290400                 STRING PV-TIMESTAMP-MONTH  DELIMITED BY SIZE     29040099
290500                        PC-SLASH            DELIMITED BY SIZE     29050099
290600                        PV-TIMESTAMP-DAY    DELIMITED BY SIZE     29060099
290700                        PC-SPACE            DELIMITED BY SIZE     29070099
290800                        PV-TIMESTAMP-HOUR   DELIMITED BY SIZE     29080099
290900                                 INTO ASC-RESPONSE-DATE-TIME      29090099
291000                                        (ASC-BLK-SUB ASC-ITEM-SUB)29100099
291100             END-IF                                               29110099
291200         END-IF                                                   29120099
291300     END-PERFORM.                                                 29130099
291400                                                                  29140099
291500                                                                  29150099
291600*----------------------------------------------------------------*29160099
291700*    FETCH ALL OF THE NOTIFICATION RECORDS FOR A SPECIFIC PO.    *29170099
291800*----------------------------------------------------------------*29180099
291900 4310-FETCH-TROUBLE-NOTIF-ITEM.                                   29190099
292000     IF PS-USE-PORCVR-CSR                                         29200099
292100         EXEC SQL                                                 29210099
292200              FETCH PO-RCVR-BY-PO-CSR                             29220099
292300              INTO :TRBNTF-NOTIF-NBR                              29230099
292400                  , :TRBNTF-OPER-UNT-ID                           29240099
292500                  , :TRBNTF-FCLTY-ID                              29250099
292600                  , :TRBNTF-DEPT-NBR                              29260099
292700                  , :TRBNTF-ENT-ID                                29270099
292800                  , :TRBNTF-PO-NBR                                29280099
292900                  , :TRBNTF-PO-LNE-NBR                            29290099
293000                  , :TRBNTF-PREPK-ID                              29300099
293100                  , :TRBNTF-REC-SEQ-NBR                           29310099
293200                  , :TRBNTF-TRBL-RSN-CDE                          29320099
293300                  , :TRBNTF-NOTIF-TMST                            29330099
293400                  , :TRBNTF-RESOLVED-IND                          29340099
293500                  , :TRBNTF-RESOLVED-TMST                         29350099
293600                  , :TRBRSN-TRBL-SHT-DESC                         29360099
293700                  , :TRBRSN-RESP-RES-IND                          29370099
293800                  , :TRBRSN-TRBL-LVL-IND                          29380099
293900                  , :TRBRSN-RSLV-RSPNT-CDE                        29390099
294000                  , :RECEIV-REC-TMST                              29400099
294100         END-EXEC                                                 29410099
294200     ELSE                                                         29420099
294300         EXEC SQL                                                 29430099
294400              FETCH TRBL-NTF-BY-PO-CSR                            29440099
294500              INTO :TRBNTF-NOTIF-NBR                              29450099
294600                  , :TRBNTF-OPER-UNT-ID                           29460099
294700                  , :TRBNTF-FCLTY-ID                              29470099
294800                  , :TRBNTF-DEPT-NBR                              29480099
294900                  , :TRBNTF-ENT-ID                                29490099
295000                  , :TRBNTF-PO-NBR                                29500099
295100                  , :TRBNTF-PO-LNE-NBR                            29510099
295200                  , :TRBNTF-PREPK-ID                              29520099
295300                  , :TRBNTF-REC-SEQ-NBR                           29530099
295400                  , :TRBNTF-TRBL-RSN-CDE                          29540099
295500                  , :TRBNTF-NOTIF-TMST                            29550099
295600                  , :TRBNTF-RESOLVED-IND                          29560099
295700                  , :TRBNTF-RESOLVED-TMST                         29570099
295800                  , :TRBRSN-TRBL-SHT-DESC                         29580099
295900                  , :TRBRSN-RESP-RES-IND                          29590099
296000                  , :TRBRSN-TRBL-LVL-IND                          29600099
296100                  , :TRBRSN-RSLV-RSPNT-CDE                        29610099
296200                  , :RECEIV-REC-TMST                              29620099
296300         END-EXEC                                                 29630099
296400     END-IF.                                                      29640099
296500                                                                  29650099
296600     EVALUATE TRUE                                                29660099
296700         WHEN SQLCODE = ZERO                                      29670099
296800              IF TRBRSN-RSLV-RSPNT-CDE = DK-RESP-AREA-1           29680099
296900                                      OR DK-RESP-AREA-2           29690099
297000                                      OR DK-RESP-AREA-3           29700099
297100                 IF TRBRSN-TRBL-LVL-IND = DK-TRBL-LVL-1           29710099
297200                                       OR DK-TRBL-LVL-2           29720099
297300                                       OR DK-TRBL-LVL-3           29730099
297400                                       OR DK-TRBL-LVL-4           29740099
297500                                       OR DK-TRBL-LVL-5           29750099
297600                    SET PS-PROCESS-TROUBLE-LINE TO TRUE           29760099
297700                 ELSE                                             29770099
297800                    SET PS-DO-NOT-PROCESS-LINE TO TRUE            29780099
297900                 END-IF                                           29790099
298000              ELSE                                                29800099
298100                 SET PS-DO-NOT-PROCESS-LINE TO TRUE               29810099
298200              END-IF                                              29820099
298300         WHEN SQLCODE = +100                                      29830099
298400              SET PS-NO-TRBL-NOTIF-ITEMS-LEFT TO TRUE             29840099
298500         WHEN SQLWARN0 NOT = SPACE                                29850099
298600         WHEN SQLCODE NOT = ZERO                                  29860099
298700              MOVE '4310-FETCH-TROUBLE-NOTIF-ITEM'                29870099
298800                               TO DP013-PARAGRAPH                 29880099
298900              MOVE 'FETCH TROUBLE NOTIFICATION CURSOR'            29890099
299000                               TO DP013-MESSAGE-TEXT (1)          29900099
299100              MOVE SQLCA       TO DP013-SQLCA                     29910099
299200              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        29920099
299300              MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (2)        29930099
299400              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (3)        29940099
299500              SET DP013-DB2-ABEND TO TRUE                         29950099
299600              PERFORM DP013-0000-PROCESS-ABEND                    29960099
299700     END-EVALUATE.                                                29970099
299800                                                                  29980099
299900                                                                  29990099
300000*----------------------------------------------------------------*30000099
300100*    RETRIEVE VENDOR SHORT NAME FROM THE ENTITY NAME TABLE FOR   *30010099
300200*    THIS NOTIFICATION RECORD.                                   *30020099
300300*----------------------------------------------------------------*30030099
300400 4320-FETCH-VENDOR-SHORT-NAME.                                    30040099
300500     PERFORM                                                      30050099
300600         WITH TEST AFTER                                          30060099
300700         VARYING PV-RETRY-COUNTER                                 30070099
300800         FROM 1 BY 1                                              30080099
300900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               30090099
301000                   OR (SQLCODE = ZERO OR +100))                   30100099
301100                                                                  30110099
301200         EXEC SQL                                                 30120099
301300              SELECT ENT_NAME_DESC                                30130099
301400                INTO :ENTNME-ENT-NAME-DESC                        30140099
301500                FROM TENTNME                                      30150099
301600               WHERE ENT_ID  = :TRBNTF-ENT-ID                     30160099
301700                 AND TYPE_CDE = :PC-TYPE-CODE-SHORT-NAME          30170099
301800         END-EXEC                                                 30180099
301900                                                                  30190099
302000         EVALUATE TRUE                                            30200099
302100             WHEN SQLCODE = ZERO                                  30210099
302200             WHEN SQLCODE = -904                                  30220099
302300             WHEN SQLCODE = -913                                  30230099
302400                  CONTINUE                                        30240099
302500             WHEN SQLCODE = +100                                  30250099
302600                  MOVE SPACES    TO ENTNME-ENT-NAME-DESC          30260099
302700             WHEN SQLWARN0 NOT = SPACE                            30270099
302800             WHEN SQLCODE NOT = ZERO                              30280099
302900                 MOVE '4320-FETCH-VENDOR-SHORT-NAME'              30290099
303000                                         TO DP013-PARAGRAPH       30300099
303100                 MOVE 'FETCH VENDOR SHORT NAME INFORMATION'       30310099
303200                                         TO DP013-MESSAGE-TEXT (1)30320099
303300                 MOVE TRBNTF-PO-NBR      TO PV-ERROR-PO-NBR       30330099
303400                 MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR  30340099
303500                 MOVE TRBNTF-PO-LNE-NBR  TO PV-ERROR-PO-LNE-NBR   30350099
303600                 MOVE TRBNTF-PREPK-ID    TO PV-ERROR-PACK-ID      30360099
303700                 MOVE TRBNTF-NOTIF-NBR   TO PV-ERROR-NOTIF-NBR    30370099
303800                 STRING ' RCVR: '             DELIMITED BY SIZE   30380099
303900                     PV-ERROR-PO-NBR          DELIMITED BY SIZE   30390099
304000                     '-'                      DELIMITED BY SIZE   30400099
304100                     PV-ERROR-REC-SEQ-NBR     DELIMITED BY SIZE   30410099
304200                     ' PO LINE NBR: '         DELIMITED BY SIZE   30420099
304300                     PV-ERROR-PO-LNE-NBR      DELIMITED BY SIZE   30430099
304400                     ' PACK-ID: '             DELIMITED BY SIZE   30440099
304500                     PV-ERROR-PACK-ID         DELIMITED BY SIZE   30450099
304600                     ' NOTIFICATION NBR: '    DELIMITED BY SIZE   30460099
304700                     PV-ERROR-NOTIF-NBR       DELIMITED BY SIZE   30470099
304800                             INTO DP013-MESSAGE-TEXT (2)          30480099
304900              MOVE SQLCA       TO DP013-SQLCA                     30490099
305000              MOVE 'TENTNME '  TO DP013-DB2-TABLE-NAME (1)        30500099
305100              SET DP013-DB2-ABEND TO TRUE                         30510099
305200              PERFORM DP013-0000-PROCESS-ABEND                    30520099
305300         END-EVALUATE                                             30530099
305400     END-PERFORM.                                                 30540099
305500                                                                  30550099
305600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30560099
305700         MOVE '4320-FETCH-VENDOR-SHORT-NAME'                      30570099
305800                                   TO DP013-PARAGRAPH             30580099
305900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     30590099
306000                                   TO DP013-MESSAGE-TEXT (1)      30600099
306100         MOVE SQLCA                TO DP013-SQLCA                 30610099
306200         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    30620099
306300         SET DP013-DB2-ABEND                                      30630099
306400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   30640099
306500         PERFORM DP013-0000-PROCESS-ABEND                         30650099
306600     END-IF.                                                      30660099
306700                                                                  30670099
306800                                                                  30680099
306900*----------------------------------------------------------------*30690099
307000*    RETRIEVE THE SHORT LOCATION NAME FROM XLT_LOC WHICH IS 5    *30700099
307100*    CHARACTERS.  THE NAME WILL NEED TO MANIPULATED FOR EXAMPLE  *30710099
307200*    DC-MF TO MFDC IN ORDER TO FIT ON THE SCREEN                 *30720099
307300*    MODULE XLKUT071 IS USED                                     *30730099
307400*----------------------------------------------------------------*30740099
307500 4330-FETCH-LOCATION-SHT-NAME.                                    30750099
307600     INITIALIZE XL071-COMMAREA-REC.                               30760099
307700                                                                  30770099
307800     MOVE TRBNTF-OPER-UNT-ID    TO PV-UNPACK-OPER-UNT-ID.         30780099
307900     MOVE PV-UNPACK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.         30790099
308000                                                                  30800099
308100     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    30810099
308200                                      XL071-COMMAREA              30820099
308300                                      XL071-COMMAREA-REC.         30830099
308400                                                                  30840099
308500     EVALUATE TRUE                                                30850099
308600         WHEN XL071-NO-ERRORS                                     30860099
308700             IF XL071-LOC-TYP-CDE = 'DC'                          30870099
308800                 MOVE XL071-LOC-5-ABBR-NM TO PV-LOC-5-NM          30880099
308900                 MOVE PV-DC               TO PV-DC-4              30890099
309000                 MOVE PV-DC-NME           TO PV-DC-NME-4          30900099
309100             ELSE                                                 30910099
309200                 MOVE XL071-LOCATION-NUMBER                       30920099
309300                                          TO PV-STORE-N           30930099
309400                 MOVE SPACE               TO PV-LOC-4-CHAR-NM     30940099
309500                 MOVE PV-STORE-X          TO PV-LOC-4-CHAR-NM     30950099
309600             END-IF                                               30960099
309700         WHEN XL071-LOC-NOT-FOUND                                 30970099
309800         WHEN XL071-SQLCODE-N = -904                              30980099
309900         WHEN XL071-SQLCODE-N = -913                              30990099
310000             MOVE SPACES      TO XL071-LOC-5-ABBR-NM              31000099
310100                                 PV-DC-NME-4                      31010099
310200         WHEN XL071-BAD-DB2-RETURN                                31020099
310300             MOVE '4330-FETCH-LOCATION-SHT-NAME'                  31030099
310400                                     TO DP013-PARAGRAPH           31040099
310500             MOVE 'FETCH LOCATION SHORT NAME'                     31050099
310600                                     TO DP013-MESSAGE-TEXT (1)    31060099
310700             MOVE TRBNTF-PO-NBR      TO PV-ERROR-PO-NBR           31070099
310800             MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR      31080099
310900             MOVE TRBNTF-PO-LNE-NBR  TO PV-ERROR-PO-LNE-NBR       31090099
311000             MOVE TRBNTF-PREPK-ID    TO PV-ERROR-PACK-ID          31100099
311100             MOVE TRBNTF-NOTIF-NBR   TO PV-ERROR-NOTIF-NBR        31110099
311200          STRING ' RCVR: '                    DELIMITED BY SIZE   31120099
311300                 PV-ERROR-PO-NBR              DELIMITED BY SIZE   31130099
311400                 '-'                          DELIMITED BY SIZE   31140099
311500                 PV-ERROR-REC-SEQ-NBR         DELIMITED BY SIZE   31150099
311600                 ' PO LINE NBR: '             DELIMITED BY SIZE   31160099
311700                 PV-ERROR-PO-LNE-NBR          DELIMITED BY SIZE   31170099
311800                 ' PACK-ID: '                 DELIMITED BY SIZE   31180099
311900                 PV-ERROR-PACK-ID             DELIMITED BY SIZE   31190099
312000                 ' NOTIFICATION NBR: '        DELIMITED BY SIZE   31200099
312100                 PV-ERROR-NOTIF-NBR           DELIMITED BY SIZE   31210099
312200                         INTO DP013-MESSAGE-TEXT (2)              31220099
312300             MOVE XL071-SQLCA       TO DP013-SQLCA                31230099
312400             MOVE XL071-DB2-TABLE   TO DP013-DB2-TABLE-NAME (1)   31240099
312500             SET DP013-DB2-ABEND    TO TRUE                       31250099
312600             PERFORM DP013-0000-PROCESS-ABEND                     31260099
312700     END-EVALUATE.                                                31270099
312800                                                                  31280099
312900                                                                  31290099
313000*----------------------------------------------------------------*31300099
313100*    RETRIEVE THE TROUBLE DETAIL ROW FOR A SPECIFIC TROUBLE      *31310099
313200*    NOTIFICATION RECORD, LOOKING FOR THE ROW WITH THE MOST      *31320099
313300*    CURRENT TIMESTAMP.                                          *31330099
313400*----------------------------------------------------------------*31340099
313500 4350-FETCH-TROUBLE-DETAIL.                                       31350099
313600     INITIALIZE PV-MAX-RESP-DATE.                                 31360099
313700     PERFORM 4360-FETCH-MAX-DATE-TRBL-NOTIF                       31370099
313800                                                                  31380099
313900     IF  PV-MAX-RESP-DATE > SPACES                                31390099
314000         MOVE PV-MAX-RESP-DATE       TO PV-TIMESTAMP              31400099
314100         SET PS-TRBL-DTL-EXISTS      TO TRUE                      31410099
314200     ELSE                                                         31420099
314300         MOVE PC-DUMMY-DB2-DATE      TO PV-TIMESTAMP              31430099
314400         SET PS-NO-TRBL-DTL-EXISTS   TO TRUE                      31440099
314500     END-IF.                                                      31450099
314600                                                                  31460099
314700                                                                  31470099
314800*----------------------------------------------------------------*31480099
314900*  RETRIEVE THE DATE OF THE MOST CURRENT TROUBLE DETAIL RECORD   *31490099
315000*----------------------------------------------------------------*31500099
315100 4360-FETCH-MAX-DATE-TRBL-NOTIF.                                  31510099
315200     PERFORM                                                      31520099
315300         WITH TEST AFTER                                          31530099
315400         VARYING PV-RETRY-COUNTER                                 31540099
315500         FROM 1 BY 1                                              31550099
315600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31560099
315700                   OR (SQLCODE = ZERO OR +100 OR -305))           31570099
315800                                                                  31580099
315900         EXEC SQL                                                 31590099
316000              SELECT MAX(LAST_DTL_CRE_TMST)                       31600099
316100                INTO :PV-MAX-RESP-DATE                            31610099
316200                FROM TTRBNTF                                      31620099
316300               WHERE OPER_UNT_ID = :TRBNTF-OPER-UNT-ID            31630099
316400                 AND FCLTY_ID  = :TRBNTF-FCLTY-ID                 31640099
316500                 AND PO_NBR    = :TRBNTF-PO-NBR                   31650099
316600                 AND REC_SEQ_NBR = :TRBNTF-REC-SEQ-NBR            31660099
316700                 AND TRBL_RSN_CDE = :TRBNTF-TRBL-RSN-CDE          31670099
316800                 AND LAST_DTL_CRE_TMST                            31680099
316900                          NOT IN ('9999-09-09-09.09.09.999999'    31690099
317000                                , '0001-01-01-00.00.00.000000')   31700099
317100         END-EXEC                                                 31710099
317200                                                                  31720099
317300         EVALUATE TRUE                                            31730099
317400             WHEN SQLCODE = ZERO                                  31740099
317500             WHEN SQLCODE = +100                                  31750099
317600             WHEN SQLCODE = -305                                  31760099
317700             WHEN SQLCODE = -904                                  31770099
317800             WHEN SQLCODE = -913                                  31780099
317900                  CONTINUE                                        31790099
318000             WHEN SQLWARN0 NOT = SPACE                            31800099
318100             WHEN SQLCODE NOT = ZERO                              31810099
318200                  MOVE '4360-FETCH-MAX-DATE-TRBL-NOTIF'           31820099
318300                                   TO DP013-PARAGRAPH             31830099
318400                  MOVE 'FETCH MOST CURRENT TROUBLE DETAIL DATE'   31840099
318500                                   TO DP013-MESSAGE-TEXT (1)      31850099
318600                  MOVE TRBNTF-PO-NBR TO PV-ERROR-PO-NBR           31860099
318700                  MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR 31870099
318800                  MOVE TRBNTF-PO-LNE-NBR TO PV-ERROR-PO-LNE-NBR   31880099
318900                  MOVE TRBNTF-PREPK-ID   TO PV-ERROR-PACK-ID      31890099
319000                  MOVE TRBNTF-NOTIF-NBR TO PV-ERROR-NOTIF-NBR     31900099
319100                  STRING ' RCVR: '            DELIMITED BY SIZE   31910099
319200                     PV-ERROR-PO-NBR          DELIMITED BY SIZE   31920099
319300                     '-'                      DELIMITED BY SIZE   31930099
319400                     PV-ERROR-REC-SEQ-NBR     DELIMITED BY SIZE   31940099
319500                     ' PO LINE NBR: '         DELIMITED BY SIZE   31950099
319600                     PV-ERROR-PO-LNE-NBR      DELIMITED BY SIZE   31960099
319700                     ' PACK ID: '             DELIMITED BY SIZE   31970099
319800                     PV-ERROR-PACK-ID         DELIMITED BY SIZE   31980099
319900                     ' NOTIFICATION NBR: '    DELIMITED BY SIZE   31990099
320000                     PV-ERROR-NOTIF-NBR       DELIMITED BY SIZE   32000099
320100                                 INTO DP013-MESSAGE-TEXT (2)      32010099
320200                  MOVE SQLCA       TO DP013-SQLCA                 32020099
320300                  MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)    32030099
320400                  SET DP013-DB2-ABEND TO TRUE                     32040099
320500                  PERFORM DP013-0000-PROCESS-ABEND                32050099
320600         END-EVALUATE                                             32060099
320700     END-PERFORM.                                                 32070099
320800                                                                  32080099
320900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        32090099
321000         IF SQLCODE = -913                                        32100099
321100             PERFORM 9910-SQL-913-RETURN                          32110099
321200         ELSE                                                     32120099
321300             MOVE '4360-FETCH-MAX-DATE-TRBL-NOTIF'                32130099
321400                                     TO DP013-PARAGRAPH           32140099
321500             MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT' 32150099
321600                                     TO DP013-MESSAGE-TEXT (1)    32160099
321700             MOVE SQLCA              TO DP013-SQLCA               32170099
321800             MOVE 'TTRBNTF '         TO DP013-DB2-TABLE-NAME (1)  32180099
321900             SET DP013-DB2-ABEND                                  32190099
322000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32200099
322100             PERFORM DP013-0000-PROCESS-ABEND                     32210099
322200         END-IF                                                   32220099
322300     END-IF.                                                      32230099
322400                                                                  32240099
322500                                                                  32250099
322600*----------------------------------------------------------------*32260099
322700*    COUNT THE NUMBER OF UNRESOLVED TROUBLE NOTIFICATION RECORDS *32270099
322800*    FOR A SPECIFIC PO, RCVR SEQ, AND TROUBLE REASON.            *32280099
322900*----------------------------------------------------------------*32290099
323000 4370-COUNT-UNRESOLVED-TROUBLE.                                   32300099
323100     PERFORM                                                      32310099
323200         WITH TEST AFTER                                          32320099
323300         VARYING PV-RETRY-COUNTER                                 32330099
323400         FROM 1 BY 1                                              32340099
323500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               32350099
323600                   OR (SQLCODE = ZERO OR +100))                   32360099
323700                                                                  32370099
323800         EXEC SQL                                                 32380099
323900              SELECT COUNT(*)                                     32390099
324000                INTO :PV-UNRESOLVED-TROUBLE-COUNT                 32400099
324100                FROM TTRBNTF                                      32410099
324200               WHERE OPER_UNT_ID = :TRBNTF-OPER-UNT-ID            32420099
324300                 AND FCLTY_ID    = :TRBNTF-FCLTY-ID               32430099
324400                 AND PO_NBR      = :TRBNTF-PO-NBR                 32440099
324500                 AND REC_SEQ_NBR = :TRBNTF-REC-SEQ-NBR            32450099
324600                 AND TRBL_RSN_CDE = :TRBNTF-TRBL-RSN-CDE          32460099
324700                 AND RESOLVED_TMST = :PC-DUMMY-DB2-DATE           32470099
324800         END-EXEC                                                 32480099
324900                                                                  32490099
325000         EVALUATE TRUE                                            32500099
325100             WHEN SQLCODE = ZERO                                  32510099
325200             WHEN SQLCODE = +100                                  32520099
325300             WHEN SQLCODE = -904                                  32530099
325400             WHEN SQLCODE = -913                                  32540099
325500                  CONTINUE                                        32550099
325600             WHEN SQLWARN0 NOT = SPACE                            32560099
325700             WHEN SQLCODE NOT = ZERO                              32570099
325800                  MOVE '4370-COUNT-UNRESOLVED-TROUBLE'            32580099
325900                                   TO DP013-PARAGRAPH             32590099
326000                  MOVE 'COUNTING UNRESOLVED TROUBLE FOR:'         32600099
326100                                   TO DP013-MESSAGE-TEXT (1)      32610099
326200                  MOVE TRBNTF-PO-NBR TO  PV-ERROR-PO-NBR          32620099
326300                  MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR 32630099
326400                  MOVE TRBNTF-TRBL-RSN-CDE                        32640099
326500                                   TO PV-ERROR-TRBL-RSN-CDE       32650099
326600                  STRING ' RCVR: '            DELIMITED BY SIZE   32660099
326700                     PV-ERROR-PO-NBR          DELIMITED BY SIZE   32670099
326800                     '-'                      DELIMITED BY SIZE   32680099
326900                     PV-ERROR-REC-SEQ-NBR     DELIMITED BY SIZE   32690099
327000                     ' TROUBLE REASON: '      DELIMITED BY SIZE   32700099
327100                     PV-ERROR-TRBL-RSN-CDE    DELIMITED BY SIZE   32710099
327200                             INTO DP013-MESSAGE-TEXT (2)          32720099
327300                  MOVE SQLCA   TO DP013-SQLCA                     32730099
327400                  MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)     32740099
327500                  SET DP013-DB2-ABEND TO TRUE                     32750099
327600                  PERFORM DP013-0000-PROCESS-ABEND                32760099
327700         END-EVALUATE                                             32770099
327800     END-PERFORM.                                                 32780099
327900                                                                  32790099
328000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        32800099
328100         IF SQLCODE = -913                                        32810099
328200             PERFORM 9910-SQL-913-RETURN                          32820099
328300         ELSE                                                     32830099
328400             MOVE '4370-COUNT-UNRESOLVED-TROUBLE'                 32840099
328500                                     TO DP013-PARAGRAPH           32850099
328600             MOVE                                                 32860099
328700                 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'  32870099
328800                                     TO DP013-MESSAGE-TEXT (1)    32880099
328900             MOVE SQLCA              TO DP013-SQLCA               32890099
329000             MOVE 'TTRBNTF '         TO DP013-DB2-TABLE-NAME (1)  32900099
329100             SET DP013-DB2-ABEND                                  32910099
329200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32920099
329300             PERFORM DP013-0000-PROCESS-ABEND                     32930099
329400         END-IF                                                   32940099
329500     END-IF.                                                      32950099
329600                                                                  32960099
329700                                                                  32970099
329800*----------------------------------------------------------------*32980099
329900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *32990099
330000*----------------------------------------------------------------*33000099
330100 4400-MOVE-COMMAREA-TO-SCREEN.                                    33010099
330200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             33020099
330300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          33030099
330400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          33040099
330500             MOVE +1    TO ASC-BLK-SUB                            33050099
330600             PERFORM 5100-WRITE-TEMP-STORAGE                      33060099
330700             ADD +1     TO ASC-BLK-SUB                            33070099
330800             PERFORM 5100-WRITE-TEMP-STORAGE                      33080099
330900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             33090099
331000                 GIVING PV-BLOCK-NUMBER                           33100099
331100                 REMAINDER PV-REMAINDER                           33110099
331200             IF  PV-REMAINDER > ZERO                              33120099
331300                 ADD +1 TO PV-BLOCK-NUMBER                        33130099
331400             END-IF                                               33140099
331500             MOVE +1    TO ASC-BLK-SUB                            33150099
331600             PERFORM 4410-READ-TEMP-STORAGE                       33160099
331700             ADD +1     TO ASC-BLK-SUB                            33170099
331800                           PV-BLOCK-NUMBER                        33180099
331900             PERFORM 4410-READ-TEMP-STORAGE                       33190099
332000     END-IF.                                                      33200099
332100     MOVE +1            TO ASC-BLK-SUB.                           33210099
332200     COMPUTE PV-ASC-ITEM-SUB-COMP3 =                              33220099
332300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              33230099
332400         + PC-ITEMS-PER-PANEL-COMP3).                             33240099
332500     MOVE  PV-ASC-ITEM-SUB-COMP3 TO ASC-ITEM-SUB.                 33250099
332600     MOVE  PC-ITEMS-PER-PANEL-COMP3 TO PC-ITEMS-PER-PANEL.        33260099
332700                                                                  33270099
332800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        33280099
332900         ADD +1         TO ASC-BLK-SUB                            33290099
333000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            33300099
333100     END-IF.                                                      33310099
333200                                                                  33320099
333300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           33330099
333400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                33340099
333500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        33350099
333600     PERFORM 4420-FORMAT-LIST-LINES                               33360099
333700         VARYING PV-SUB                                           33370099
333800         FROM PC-ITEMS-PER-PANEL BY -1                            33380099
333900         UNTIL PV-SUB < +1.                                       33390099
334000                                                                  33400099
334100     COMPUTE ASC-ITEMS-DISPLAYED =                                33410099
334200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          33420099
334300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    33430099
334400                                      ASTRTITO.                   33440099
334500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    33450099
334600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    33460099
334700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO ASELITO.                33470099
334800                                                                  33480099
334900     IF  DP020-MSG-NUMBER-X = SPACE                               33490099
335000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  33500099
335100*            --- MORE ITEMS TO DISPLAY ----                       33510099
335200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            33520099
335300             SET DP020-MSG-INFORMATIONAL TO TRUE                  33530099
335400         END-IF                                                   33540099
335500     END-IF.                                                      33550099
335600                                                                  33560099
335700                                                                  33570099
335800*----------------------------------------------------------------*33580099
335900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *33590099
336000*----------------------------------------------------------------*33600099
336100 4410-READ-TEMP-STORAGE.                                          33610099
336200     EXEC CICS                                                    33620099
336300         READQ TS                                                 33630099
336400             QUEUE (ASC-LIST-QUEUE-NAME)                          33640099
336500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               33650099
336600             ITEM  (PV-BLOCK-NUMBER)                              33660099
336700             RESP  (PV-CICS-RESP)                                 33670099
336800     END-EXEC.                                                    33680099
336900                                                                  33690099
337000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       33700099
337100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     33710099
337200         CONTINUE                                                 33720099
337300     ELSE                                                         33730099
337400         SET DP013-CICS-ABEND     TO TRUE                         33740099
337500         SET DP013-NO-ROLLBACK    TO TRUE                         33750099
337600         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         33760099
337700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      33770099
337800                                  TO DP013-MESSAGE-TEXT(1)        33780099
337900         PERFORM DP013-0000-PROCESS-ABEND                         33790099
338000     END-IF.                                                      33800099
338100                                                                  33810099
338200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             33820099
338300                                                                  33830099
338400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         33840099
338500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               33850099
338600     END-IF.                                                      33860099
338700                                                                  33870099
338800                                                                  33880099
338900*----------------------------------------------------------------*33890099
339000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *33900099
339100*----------------------------------------------------------------*33910099
339200 4420-FORMAT-LIST-LINES.                                          33920099
339300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      33930099
339400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                33940099
339500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           33950099
339600         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           33960099
339700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           33970099
339800                                    MR-ACTION (PV-SUB)            33980099
339900                                    MR-DEPT (PV-SUB)              33990099
340000                                    MR-PO-NBR (PV-SUB)            34000099
340100                                    MR-RCVR-SEQ-NBR (PV-SUB)      34010099
340200                                    MR-VENDOR-NME (PV-SUB)        34020099
340300                                    MR-LOCATION-SHORT-NME (PV-SUB)34030099
340400                                    MR-TROUBLE-REASON (PV-SUB)    34040099
340500                                    MR-ARRIVAL-DATE-TIME (PV-SUB) 34050099
340600                                    MR-NOTIFICATION-DATE-TIME     34060099
340700                                                          (PV-SUB)34070099
340800                                    MR-RESPONSE-DATE-TIME (PV-SUB)34080099
340900     ELSE                                                         34090099
341000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      34100099
341100                                                   > SPACE        34110099
341200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 34120099
341300                                 TO MR-SELECTI (PV-SUB)           34130099
341400         ELSE                                                     34140099
341500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      34150099
341600                                 TO MR-SELECTI (PV-SUB)           34160099
341700         END-IF                                                   34170099
341800                                                                  34180099
341900         IF  DP030-SET-CURSOR-TRAILER                             34190099
342000             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)34200099
342100                 > SPACE)                                         34210099
342200               OR (PV-SUB = 1))                                   34220099
342300                SET DP030-SET-CURSOR-APPL-1 TO TRUE               34230099
342400                MOVE -1          TO MR-SELECTL (PV-SUB)           34240099
342500             END-IF                                               34250099
342600         END-IF                                                   34260099
342700                                                                  34270099
342800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           34280099
342900             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           34290099
343000                                 TO MR-ACTION (PV-SUB)            34300099
343100             MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         34310099
343200                                 TO MR-DEPT-N (PV-SUB)            34320099
343300             MOVE ASC-PO-NBR-N (ASC-BLK-SUB ASC-ITEM-SUB)         34330099
343400                                 TO MR-PO-NBR-N (PV-SUB)          34340099
343500             MOVE ASC-RCVR-SEQ-NBR-N (ASC-BLK-SUB ASC-ITEM-SUB)   34350099
343600                                 TO MR-RCVR-SEQ-NBR-N (PV-SUB)    34360099
343700             MOVE ASC-VENDOR-SHORT-NME (ASC-BLK-SUB ASC-ITEM-SUB) 34370099
343800                                 TO MR-VENDOR-NME (PV-SUB)        34380099
343900             MOVE ASC-FCLTY-NME (ASC-BLK-SUB ASC-ITEM-SUB)        34390099
344000                                 TO MR-LOCATION-SHORT-NME (PV-SUB)34400099
344100             MOVE ASC-TROUBLE-REASON-DESC                         34410099
344200                                        (ASC-BLK-SUB ASC-ITEM-SUB)34420099
344300                                 TO MR-TROUBLE-REASON (PV-SUB)    34430099
344400                                                                  34440099
344500             IF  ASC-TRBL-DTL-EXISTS (ASC-BLK-SUB ASC-ITEM-SUB)   34450099
344600                 MOVE DP015-YELLOW TO MR-TROUBLE-REASONC (PV-SUB) 34460099
344700             ELSE                                                 34470099
344800                 MOVE DP015-BLUE TO MR-TROUBLE-REASONC (PV-SUB)   34480099
344900             END-IF                                               34490099
345000                                                                  34500099
345100             MOVE ASC-ARRIVAL-DATE-TIME (ASC-BLK-SUB ASC-ITEM-SUB)34510099
345200                                 TO MR-ARRIVAL-DATE-TIME (PV-SUB) 34520099
345300             MOVE ASC-NOTIFICATION-DATE-TIME                      34530099
345400                                        (ASC-BLK-SUB ASC-ITEM-SUB)34540099
345500                            TO MR-NOTIFICATION-DATE-TIME (PV-SUB) 34550099
345600             MOVE ASC-RESPONSE-DATE-TIME                          34560099
345700                                        (ASC-BLK-SUB ASC-ITEM-SUB)34570099
345800                                 TO MR-RESPONSE-DATE-TIME (PV-SUB)34580099
345900                                                                  34590099
346000             IF  ASC-TRBL-RESOLVED (ASC-BLK-SUB ASC-ITEM-SUB)     34600099
346100                 MOVE DP015-YELLOW TO MR-RESPONSE-DATE-TIMEC      34610099
346200                                                          (PV-SUB)34620099
346300             ELSE                                                 34630099
346400                 MOVE DP015-BLUE TO MR-RESPONSE-DATE-TIMEC(PV-SUB)34640099
346500             END-IF                                               34650099
346600         END-IF                                                   34660099
346700     END-IF.                                                      34670099
346800     SUBTRACT +1 FROM ASC-ITEM-SUB                                34680099
346900     IF  ASC-ITEM-SUB < + 1                                       34690099
347000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  34700099
347100         MOVE +1                 TO ASC-BLK-SUB                   34710099
347200     END-IF.                                                      34720099
347300                                                                  34730099
347400                                                                  34740099
347500******************************************************************34750099
347600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **34760099
347700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **34770099
347800** ISSUE A WARNING.                                             **34780099
347900******************************************************************34790099
348000 4430-CHECK-FOR-BEGIN-AND-END.                                    34800099
348100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       34810099
348200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     34820099
348300*            -- NO END-OF-RANGE SPECFIED ---                      34830099
348400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            34840099
348500             SET DP020-MSG-WARNING TO TRUE                        34850099
348600             PERFORM 4431-POSITION-AT-WARNING                     34860099
348700         END-IF                                                   34870099
348800     ELSE                                                         34880099
348900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     34890099
349000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                34900099
349100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            34910099
349200             SET DP020-MSG-WARNING TO TRUE                        34920099
349300             PERFORM 4431-POSITION-AT-WARNING                     34930099
349400         END-IF                                                   34940099
349500     END-IF.                                                      34950099
349600                                                                  34960099
349700                                                                  34970099
349800******************************************************************34980099
349900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **34990099
350000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **35000099
350100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **35010099
350200** POSITION THE CURSOR THERE.                                   **35020099
350300******************************************************************35030099
350400 4431-POSITION-AT-WARNING.                                        35040099
350500     COMPUTE PV-SUB-COMP3 = ASC-START-OF-SELECTED-RANGE           35050099
350600                    - PV-TOP-ITEM + 1.                            35060099
350700     MOVE PV-SUB-COMP3 TO PV-SUB.                                 35070099
350800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      35080099
350900         CONTINUE                                                 35090099
351000     ELSE                                                         35100099
351100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      35110099
351200         MOVE -1                   TO MR-SELECTL (PV-SUB)         35120099
351300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         35130099
351400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         35140099
351500     END-IF.                                                      35150099
351600                                                                  35160099
351700     COMPUTE PV-SUB-COMP3 = ASC-END-OF-SELECTED-RANGE             35170099
351800                    - PV-TOP-ITEM + 1.                            35180099
351900     MOVE PV-SUB-COMP3 TO PV-SUB.                                 35190099
352000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      35200099
352100         CONTINUE                                                 35210099
352200     ELSE                                                         35220099
352300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      35230099
352400         MOVE -1                   TO MR-SELECTL (PV-SUB)         35240099
352500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         35250099
352600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         35260099
352700     END-IF.                                                      35270099
352800                                                                  35280099
352900                                                                  35290099
353000*----------------------------------------------------------------*35300099
353100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *35310099
353200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *35320099
353300* FOR THE SELECTED ITEMS QUEUE.                                  *35330099
353400*                                                                *35340099
353500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *35350099
353600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *35360099
353700* THE ARRAY IS FULL.                                             *35370099
353800*----------------------------------------------------------------*35380099
353900 5000-PREPARE-SEL-QUEUE.                                          35390099
354000     MOVE +1                   TO  ASC-BLK-SUB.                   35400099
354100     PERFORM 5100-WRITE-TEMP-STORAGE.                             35410099
354200     ADD +1                    TO  ASC-BLK-SUB.                   35420099
354300     PERFORM 5100-WRITE-TEMP-STORAGE.                             35430099
354400                                                                  35440099
354500     MOVE ASC-SEL-QUEUE-OUT    TO  TM004-SEL-QUEUE-NAME.          35450099
354600     PERFORM 6010-DELETE-SEL-QUEUE.                               35460099
354700                                                                  35470099
354800     SET ASC-UPDATE-TSQ        TO  TRUE.                          35480099
354900                                                                  35490099
355000     SET TM002-IDX             TO  1.                             35500099
355100     MOVE ZERO                 TO TM004-NUMBER-OF-TS-ITEMS.       35510099
355200     INITIALIZE TM002-SELECTED-ITEM-ARRAY.                        35520099
355300                                                                  35530099
355400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           35540099
355500             VARYING PV-ITEM                                      35550099
355600             FROM 1 BY 1                                          35560099
355700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     35570099
355800                                                                  35580099
355900     IF  TM002-IDX > 1                                            35590099
356000         PERFORM 5205-WRITE-SEL-QUEUE                             35600099
356100         ADD +1                TO TM004-NUMBER-OF-TS-ITEMS        35610099
356200     END-IF.                                                      35620099
356300                                                                  35630099
356400                                                                  35640099
356500*----------------------------------------------------------------*35650099
356600* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *35660099
356700* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *35670099
356800* FOR THE SELECTED ITEMS QUEUE.                                  *35680099
356900*                                                                *35690099
357000* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *35700099
357100* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *35710099
357200* THE ARRAY IS FULL.                                             *35720099
357300*----------------------------------------------------------------*35730099
357400 5025-PREPARE-SEL-QUEUE-FOR-PO.                                   35740099
357500     MOVE +1                   TO  ASC-BLK-SUB.                   35750099
357600     PERFORM 5100-WRITE-TEMP-STORAGE.                             35760099
357700     ADD +1                    TO  ASC-BLK-SUB.                   35770099
357800     PERFORM 5100-WRITE-TEMP-STORAGE.                             35780099
357900                                                                  35790099
358000     MOVE ASC-SEL-QUEUE-OUT    TO  PO013-SEL-QUEUE-NAME.          35800099
358100     PERFORM 6010-DELETE-SEL-QUEUE.                               35810099
358200                                                                  35820099
358300     SET ASC-UPDATE-TSQ        TO  TRUE.                          35830099
358400                                                                  35840099
358500     SET PO012-IDX             TO  1.                             35850099
358600     MOVE ZERO                 TO PO013-NUMBER-OF-TS-ITEMS.       35860099
358700     INITIALIZE PO012-SELECTED-ITEM-ARRAY.                        35870099
358800                                                                  35880099
358900     PERFORM 5250-FILL-SEL-QUEUE-REC-FOR-PO                       35890099
359000             VARYING PV-ITEM                                      35900099
359100             FROM 1 BY 1                                          35910099
359200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     35920099
359300                                                                  35930099
359400     IF  PO012-IDX > 1 AND PS-NO-ERROR                            35940099
359500         PERFORM 5265-WRITE-PO-SEL-QUEUE                          35950099
359600         ADD +1                TO PO013-NUMBER-OF-TS-ITEMS        35960099
359700     END-IF.                                                      35970099
359800                                                                  35980099
359900*----------------------------------------------------------------*35990099
360000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE TO BE PROCESSED  *36000099
360100* BY THE TROUBLE CENTRAL PROCESSING ROUTINE (TMKCS520).  MOVE    *36010099
360200* ALL SELECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE     *36020099
360300* LAYOUT FOR THE SELECTED ITEMS QUEUE.                           *36030099
360400*----------------------------------------------------------------*36040099
360500 5050-PREPARE-TO-PROCESS-TRBL.                                    36050099
360600     MOVE +1                   TO  ASC-BLK-SUB.                   36060099
360700     PERFORM 5100-WRITE-TEMP-STORAGE.                             36070099
360800     ADD +1                    TO  ASC-BLK-SUB.                   36080099
360900     PERFORM 5100-WRITE-TEMP-STORAGE.                             36090099
361000                                                                  36100099
361100     PERFORM 5300-PROCESS-TROUBLE-UPDATE                          36110099
361200             VARYING PV-ITEM                                      36120099
361300             FROM 1 BY 1                                          36130099
361400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN      36140099
361500             OR PS-ERROR.                                         36150099
361600                                                                  36160099
361700                                                                  36170099
361800*----------------------------------------------------------------*36180099
361900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *36190099
362000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *36200099
362100*----------------------------------------------------------------*36210099
362200 5100-WRITE-TEMP-STORAGE.                                         36220099
362300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     36230099
362400                                   TO PV-LIST-ITEM-NUMBER.        36240099
362500     COMPUTE PV-BLOCK-NUMBER =                                    36250099
362600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    36260099
362700                                                                  36270099
362800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             36280099
362900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             36290099
363000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      36300099
363100             PERFORM 5105-REWRITE-ASC-LISTQ                       36310099
363200         END-IF                                                   36320099
363300     ELSE                                                         36330099
363400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       36340099
363500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            36350099
363600         PERFORM 5110-WRITE-ASC-LISTQ                             36360099
363700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   36370099
363800     END-IF.                                                      36380099
363900                                                                  36390099
364000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             36400099
364100                                                                  36410099
364200                                                                  36420099
364300******************************************************************36430099
364400** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **36440099
364500** SPECIFIC COMMAREA.                                           **36450099
364600******************************************************************36460099
364700 5105-REWRITE-ASC-LISTQ.                                          36470099
364800     EXEC CICS                                                    36480099
364900         WRITEQ TS                                                36490099
365000             QUEUE (ASC-LIST-QUEUE-NAME)                          36500099
365100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               36510099
365200             ITEM  (PV-BLOCK-NUMBER)                              36520099
365300             REWRITE                                              36530099
365400             RESP  (PV-CICS-RESP)                                 36540099
365500     END-EXEC.                                                    36550099
365600                                                                  36560099
365700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           36570099
365800         CONTINUE                                                 36580099
365900     ELSE                                                         36590099
366000         SET DP013-CICS-ABEND            TO TRUE                  36600099
366100         SET DP013-NO-ROLLBACK           TO TRUE                  36610099
366200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       36620099
366300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     36630099
366400                                         TO DP013-MESSAGE-TEXT(1) 36640099
366500         PERFORM DP013-0000-PROCESS-ABEND                         36650099
366600     END-IF.                                                      36660099
366700                                                                  36670099
366800                                                                  36680099
366900******************************************************************36690099
367000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **36700099
367100** SPECIFIC COMMAREA.                                           **36710099
367200******************************************************************36720099
367300 5110-WRITE-ASC-LISTQ.                                            36730099
367400     EXEC CICS                                                    36740099
367500         WRITEQ TS                                                36750099
367600             QUEUE (ASC-LIST-QUEUE-NAME)                          36760099
367700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               36770099
367800             ITEM  (PV-BLOCK-NUMBER)                              36780099
367900             RESP  (PV-CICS-RESP)                                 36790099
368000     END-EXEC.                                                    36800099
368100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      36810099
368200         SET DP013-CICS-ABEND      TO TRUE                        36820099
368300         SET DP013-NO-ROLLBACK     TO TRUE                        36830099
368400         MOVE '5110-WRITE-ASC-LISTQ'                              36840099
368500                                   TO DP013-PARAGRAPH             36850099
368600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           36860099
368700                                   TO DP013-MESSAGE-TEXT(1)       36870099
368800         PERFORM DP013-0000-PROCESS-ABEND                         36880099
368900     END-IF.                                                      36890099
369000                                                                  36900099
369100                                                                  36910099
369200*----------------------------------------------------------------*36920099
369300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *36930099
369400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *36940099
369500*----------------------------------------------------------------*36950099
369600 5200-FILL-SEL-QUEUE-RECORD.                                      36960099
369700     PERFORM 6112-READ-LIST-QUEUE.                                36970099
369800                                                                  36980099
369900     SET ASC-STAYING-WITHIN-TROUBLE TO TRUE                       36990099
370000                                                                  37000099
370100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37010099
370200         PERFORM                                                  37020099
370300         VARYING LQW-IDX                                          37030099
370400         FROM 1 BY 1                                              37040099
370500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            37050099
370600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          37060099
370700                                                                  37070099
370800             IF  LQW-SELECT (LQW-IDX)                             37080099
370900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              37090099
371000                                 TO TM002-ITEM (TM002-IDX)        37100099
371100                 MOVE LQW-NOTIF-NBR (LQW-IDX)                     37110099
371200                                 TO TM002-NOTIF-NBR (TM002-IDX)   37120099
371300                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   37130099
371400                                 TO TM002-OPER-UNT-ID (TM002-IDX) 37140099
371500                 MOVE LQW-FCLTY-ID (LQW-IDX)                      37150099
371600                                 TO TM002-FCLTY-ID (TM002-IDX)    37160099
371700                 MOVE LQW-PO-NBR (LQW-IDX)                        37170099
371800                                 TO TM002-PO-NBR (TM002-IDX)      37180099
371900                 MOVE LQW-RCVR-SEQ-NBR (LQW-IDX)                  37190099
372000                                 TO TM002-RCVR-SEQ (TM002-IDX)    37200099
372100                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    37210099
372200                                 TO TM002-PO-LNE-NBR (TM002-IDX)  37220099
372300                 MOVE LQW-PREPK-ID (LQW-IDX)                      37230099
372400                                 TO TM002-PREPK-ID (TM002-IDX)    37240099
372500                 MOVE LQW-TROUBLE-REASON-CDE (LQW-IDX)            37250099
372600                                 TO TM002-TRBL-RSN-CDE (TM002-IDX)37260099
372700                 MOVE LQW-TROUBLE-REASON-LVL (LQW-IDX)            37270099
372800                                 TO TM002-TRBL-LVL-IND (TM002-IDX)37280099
372900                 MOVE SPACE        TO  TM002-ACTION-SW (TM002-IDX)37290099
373000                 SET TM002-IDX UP BY 1                            37300099
373100                 IF  TM002-IDX > TM002-MAX-ITEMS                  37310099
373200                     PERFORM 5205-WRITE-SEL-QUEUE                 37320099
373300                     ADD +1        TO TM004-NUMBER-OF-TS-ITEMS    37330099
373400                     INITIALIZE TM002-SELECTED-ITEM-ARRAY         37340099
373500                     SET TM002-IDX TO  1                          37350099
373600                 END-IF                                           37360099
373700             END-IF                                               37370099
373800         END-PERFORM                                              37380099
373900     END-IF.                                                      37390099
374000                                                                  37400099
374100                                                                  37410099
374200*----------------------------------------------------------------*37420099
374300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *37430099
374400*----------------------------------------------------------------*37440099
374500 5205-WRITE-SEL-QUEUE.                                            37450099
374600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO TM002-SELECTED-ITEMS.   37460099
374700                                                                  37470099
374800     EXEC CICS                                                    37480099
374900          WRITEQ TS                                               37490099
375000              QUEUE (ASC-SEL-QUEUE-OUT)                           37500099
375100              FROM  (TM002-MESSAGE-SEL-REC)                       37510099
375200              ITEM  (ASC-SEL-ITEM)                                37520099
375300              RESP  (PV-CICS-RESP)                                37530099
375400     END-EXEC.                                                    37540099
375500                                                                  37550099
375600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37560099
375700         CONTINUE                                                 37570099
375800     ELSE                                                         37580099
375900         SET DP013-CICS-ABEND      TO TRUE                        37590099
376000         SET DP013-NO-ROLLBACK     TO TRUE                        37600099
376100         MOVE '5205-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           37610099
376200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          37620099
376300                                   TO DP013-MESSAGE-TEXT(1)       37630099
376400         PERFORM DP013-0000-PROCESS-ABEND                         37640099
376500     END-IF.                                                      37650099
376600                                                                  37660099
376700                                                                  37670099
376800*----------------------------------------------------------------*37680099
376900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *37690099
377000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *37700099
377100*----------------------------------------------------------------*37710099
377200 5250-FILL-SEL-QUEUE-REC-FOR-PO.                                  37720099
377300     PERFORM 6112-READ-LIST-QUEUE.                                37730099
377400                                                                  37740099
377500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       37750099
377600         PERFORM                                                  37760099
377700         VARYING LQW-IDX                                          37770099
377800         FROM 1 BY 1                                              37780099
377900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            37790099
378000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          37800099
378100           OR  PS-ERROR                                           37810099
378200                                                                  37820099
378300             IF  PS-FIRST-TIME                                    37830099
378400                 SET PS-NOT-FIRST-TIME                            37840099
378500                                TO  TRUE                          37850099
378600                 MOVE LQW-PO-NBR (LQW-IDX)                        37860099
378700                                TO  PV-PREV-PO-NBR                37870099
378800                 MOVE LQW-DEPT   (LQW-IDX)                        37880099
378900                                TO  PV-PREV-DEPT-NBR              37890099
379000             END-IF                                               37900099
379100                                                                  37910099
379200             IF  LQW-SELECT (LQW-IDX)                             37920099
379300                 SET ASC-GOING-TO-PO   TO TRUE                    37930099
379400                 PERFORM 5255-FETCH-TPURCHS-INFO                  37940099
379500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              37950099
379600                                   TO  PO012-ITEM(PO012-IDX)      37960099
379700                 MOVE PURCHS-DEPT-NBR                             37970099
379800                                   TO  PO013-DEPT-NBR             37980099
379900                 MOVE PURCHS-STATUS-CDE                           37990099
380000                                   TO  PO012-STATUS (PO012-IDX)   38000099
380100                 MOVE PURCHS-PO-TYP-CDE                           38010099
380200                                   TO  PO012-PO-TYPE (PO012-IDX)  38020099
380300                 PERFORM 5260-FETCH-VENDOR-LONG-NAME              38030099
380400                 IF  SQLCODE = +100                               38040099
380500                     MOVE SPACES   TO  PO012-VENDOR-NAME          38050099
380600                                                    (PO012-IDX)   38060099
380700                 ELSE                                             38070099
380800                     MOVE ENTNME-ENT-NAME-DESC                    38080099
380900                                   TO  PO012-VENDOR-NAME          38090099
381000                                                    (PO012-IDX)   38100099
381100                 END-IF                                           38110099
381200                 MOVE LQW-ENT-ID (LQW-IDX)                        38120099
381300                                   TO  PO013-ENT-ID               38130099
381400                 MOVE LQW-PO-NBR (LQW-IDX)                        38140099
381500                                   TO  PO012-PO-NBR (PO012-IDX)   38150099
381600                                       PO013-PO-NBR               38160099
381700                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    38170099
381800                                   TO  PO012-PO-LNE-NBR           38180099
381900                                                    (PO012-IDX)   38190099
382000                 MOVE SPACE        TO  PO012-ACTION-SW (PO012-IDX)38200099
382100                 SET PO012-IDX UP BY 1                            38210099
382200                 IF  PO012-IDX > PO012-MAX-ITEMS                  38220099
382300                     PERFORM 5265-WRITE-PO-SEL-QUEUE              38230099
382400                     ADD +1        TO PO013-NUMBER-OF-TS-ITEMS    38240099
382500                     INITIALIZE PO012-SELECTED-ITEM-ARRAY         38250099
382600                     SET PO012-IDX TO  1                          38260099
382700                 END-IF                                           38270099
382800             END-IF                                               38280099
382900         END-PERFORM                                              38290099
383000     END-IF.                                                      38300099
383100                                                                  38310099
383200                                                                  38320099
383300*----------------------------------------------------------------*38330099
383400*    RETRIEVE THE PURCHASE ORDER HEADER INFORMATION FOR THE      *38340099
383500*    PO ASSOCIATED WITH THE TROUBLE NOTIFICATION RECORD.         *38350099
383600*----------------------------------------------------------------*38360099
383700 5255-FETCH-TPURCHS-INFO.                                         38370099
383800     MOVE LQW-PO-NBR (LQW-IDX)  TO TRBNTF-PO-NBR.                 38380099
383900                                                                  38390099
384000     PERFORM                                                      38400099
384100         WITH TEST AFTER                                          38410099
384200         VARYING PV-RETRY-COUNTER                                 38420099
384300         FROM 1 BY 1                                              38430099
384400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               38440099
384500                   OR (SQLCODE = ZERO OR +100))                   38450099
384600                                                                  38460099
384700         EXEC SQL                                                 38470099
384800              SELECT PO_TYP_CDE                                   38480099
384900                     ,DIR_STR_IND                                 38490099
385000                     ,STATUS_CDE                                  38500099
385100                     ,DEPT_NBR                                    38510099
385200                INTO :PURCHS-PO-TYP-CDE                           38520099
385300                     ,:PURCHS-DIR-STR-IND                         38530099
385400                     ,:PURCHS-STATUS-CDE                          38540099
385500                     ,:PURCHS-DEPT-NBR                            38550099
385600                FROM TPURCHS                                      38560099
385700               WHERE PO_NBR       = :TRBNTF-PO-NBR                38570099
385800                 AND VER_STATUS_CDE = :PC-ACTIVE-STATUS           38580099
385900         END-EXEC                                                 38590099
386000                                                                  38600099
386100         EVALUATE TRUE                                            38610099
386200             WHEN SQLCODE = ZERO                                  38620099
386300             WHEN SQLCODE = -904                                  38630099
386400             WHEN SQLCODE = -913                                  38640099
386500                  CONTINUE                                        38650099
386600             WHEN SQLCODE = +100                                  38660099
386700                  MOVE SPACES  TO PURCHS-PO-TYP-CDE               38670099
386800                                      PURCHS-DIR-STR-IND          38680099
386900                                      PURCHS-STATUS-CDE           38690099
387000                                      PURCHS-DEPT-NBR             38700099
387100             WHEN SQLWARN0 NOT = SPACE                            38710099
387200             WHEN SQLCODE NOT = ZERO                              38720099
387300                  MOVE '5255-FETCH-TPURCHS-INFO'                  38730099
387400                                   TO DP013-PARAGRAPH             38740099
387500                  MOVE 'FETCH PURCHASE ORDER INFORMATION'         38750099
387600                                   TO DP013-MESSAGE-TEXT (1)      38760099
387700                  MOVE 'FOR THE FOLLOWING PO:           '         38770099
387800                                   TO DP013-MESSAGE-TEXT (2)      38780099
387900                  MOVE TRBNTF-PO-NBR TO DP013-MESSAGE-TEXT (3)    38790099
388000                  MOVE SQLCA   TO DP013-SQLCA                     38800099
388100                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     38810099
388200                  SET DP013-DB2-ABEND TO TRUE                     38820099
388300                  PERFORM DP013-0000-PROCESS-ABEND                38830099
388400         END-EVALUATE                                             38840099
388500     END-PERFORM.                                                 38850099
388600                                                                  38860099
388700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        38870099
388800         MOVE '5255-FETCH-TPURCHS-INFO' TO DP013-PARAGRAPH        38880099
388900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     38890099
389000                                   TO DP013-MESSAGE-TEXT (1)      38900099
389100         MOVE SQLCA                TO DP013-SQLCA                 38910099
389200         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    38920099
389300         SET DP013-DB2-ABEND                                      38930099
389400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   38940099
389500         PERFORM DP013-0000-PROCESS-ABEND                         38950099
389600     END-IF.                                                      38960099
389700                                                                  38970099
389800                                                                  38980099
389900*----------------------------------------------------------------*38990099
390000*    RETRIEVE THE FULL VENDOR NAME THAT IS ASSOCIATED WITH THE   *39000099
390100*    TROUBLE NOTIFICATION RECORD.  THIS INFORMATION WILL BE USED *39010099
390200*    WHEN PERFORMING EITHER A PO INQUIRY LOOKUP OR PO UPDATE FOR *39020099
390300*    THIS SPECIFIC TROUBLE NOTIFICATION RECORD.                  *39030099
390400*----------------------------------------------------------------*39040099
390500 5260-FETCH-VENDOR-LONG-NAME.                                     39050099
390600     MOVE LQW-ENT-ID(LQW-IDX)   TO DK-ENT-ID                      39060099
390700                                                                  39070099
390800     PERFORM                                                      39080099
390900         WITH TEST AFTER                                          39090099
391000         VARYING PV-RETRY-COUNTER                                 39100099
391100         FROM 1 BY 1                                              39110099
391200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               39120099
391300                   OR (SQLCODE = ZERO OR +100))                   39130099
391400*                                                                 39140099
391500         EXEC SQL                                                 39150099
391600              SELECT ENT_NAME_DESC                                39160099
391700                INTO :ENTNME-ENT-NAME-DESC                        39170099
391800                FROM TENTNME                                      39180099
391900               WHERE ENT_ID       = :DK-ENT-ID                    39190099
392000                 AND TYPE_CDE     = :PC-TYPE-CODE-LONG-NAME       39200099
392100         END-EXEC                                                 39210099
392200                                                                  39220099
392300         EVALUATE TRUE                                            39230099
392400             WHEN SQLCODE = ZERO                                  39240099
392500             WHEN SQLCODE = +100                                  39250099
392600             WHEN SQLCODE = -904                                  39260099
392700             WHEN SQLCODE = -913                                  39270099
392800                  CONTINUE                                        39280099
392900             WHEN SQLWARN0 NOT = SPACE                            39290099
393000             WHEN SQLCODE NOT = ZERO                              39300099
393100                  MOVE '5260-FETCH-VENDOR-LONG-NAME'              39310099
393200                                   TO DP013-PARAGRAPH             39320099
393300                  MOVE 'FETCH VENDOR LONG NAME          '         39330099
393400                                   TO DP013-MESSAGE-TEXT (1)      39340099
393500                  MOVE 'FOR THE FOLLOWING PO:           '         39350099
393600                                   TO DP013-MESSAGE-TEXT (2)      39360099
393700                  MOVE TRBNTF-PO-NBR                              39370099
393800                                   TO DP013-MESSAGE-TEXT (3)      39380099
393900                  MOVE SQLCA   TO DP013-SQLCA                     39390099
394000                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     39400099
394100                  SET DP013-DB2-ABEND TO TRUE                     39410099
394200                  PERFORM DP013-0000-PROCESS-ABEND                39420099
394300         END-EVALUATE                                             39430099
394400     END-PERFORM.                                                 39440099
394500                                                                  39450099
394600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        39460099
394700         MOVE '5260-FETCH-VENDOR-LONG-NAME' TO DP013-PARAGRAPH    39470099
394800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     39480099
394900                                   TO DP013-MESSAGE-TEXT (1)      39490099
395000         MOVE SQLCA                TO DP013-SQLCA                 39500099
395100         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    39510099
395200         SET DP013-DB2-ABEND                                      39520099
395300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   39530099
395400         PERFORM DP013-0000-PROCESS-ABEND                         39540099
395500     END-IF.                                                      39550099
395600                                                                  39560099
395700                                                                  39570099
395800*----------------------------------------------------------------*39580099
395900*    WRITE THE SELECTED PO ITEMS TEMP STORAGE QUEUE.             *39590099
396000*----------------------------------------------------------------*39600099
396100 5265-WRITE-PO-SEL-QUEUE.                                         39610099
396200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO PO012-SELECTED-ITEMS.   39620099
396300                                                                  39630099
396400     EXEC CICS                                                    39640099
396500          WRITEQ TS                                               39650099
396600              QUEUE (ASC-SEL-QUEUE-OUT)                           39660099
396700              FROM  (PO012-PO-SELECT-RECORD)                      39670099
396800              ITEM  (ASC-SEL-ITEM)                                39680099
396900              RESP  (PV-CICS-RESP)                                39690099
397000     END-EXEC.                                                    39700099
397100                                                                  39710099
397200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39720099
397300         CONTINUE                                                 39730099
397400     ELSE                                                         39740099
397500         SET DP013-CICS-ABEND      TO TRUE                        39750099
397600         SET DP013-NO-ROLLBACK     TO TRUE                        39760099
397700         MOVE '5265-WRITE-SEL-QUEUE'  TO DP013-PARAGRAPH          39770099
397800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          39780099
397900                                   TO DP013-MESSAGE-TEXT(1)       39790099
398000         PERFORM DP013-0000-PROCESS-ABEND                         39800099
398100     END-IF.                                                      39810099
398200                                                                  39820099
398300                                                                  39830099
398400*----------------------------------------------------------------*39840099
398500*    CALL THE TROUBLE CENTRAL PROCESSING ROUTINE (TMKCS520) TO   *39850099
398600*    PERFORM EITHER A RESPOND, RESOLVE, OR ACKNOWLEDGE FOR THE   *39860099
398700*    SELECTED NOTIFICATION RECORDS.  THIS PARAGRAPH IS PERFORMED *39870099
398800*    UNTIL ALL NOTIFICATION RECORDS ARE PROCESSED OR AN ERROR    *39880099
398900*    IS ENCOUNTERED.                                             *39890099
399000*----------------------------------------------------------------*39900099
399100 5300-PROCESS-TROUBLE-UPDATE.                                     39910099
399200     PERFORM 6112-READ-LIST-QUEUE.                                39920099
399300                                                                  39930099
399400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       39940099
399500         PERFORM                                                  39950099
399600         VARYING LQW-IDX                                          39960099
399700         FROM 1 BY 1                                              39970099
399800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            39980099
399900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          39990099
400000           OR  PS-ERROR                                           40000099
400100                                                                  40010099
400200             IF  LQW-SELECT (LQW-IDX)                             40020099
400300                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   40030099
400400                                TO  TM500-OPER-UNT-ID             40040099
400500                 MOVE LQW-FCLTY-ID (LQW-IDX) TO TM500-FCLTY-ID    40050099
400600                 MOVE LQW-PO-NBR (LQW-IDX) TO TM500-PO-NBR        40060099
400700                                              DK-PO-NBR           40070099
400800                 MOVE LQW-RCVR-SEQ-NBR (LQW-IDX)                  40080099
400900                                TO  TM500-REC-SEQ-NBR             40090099
401000                                    DK-REC-SEQ-NBR                40100099
401100                 MOVE LQW-TROUBLE-REASON-CDE (LQW-IDX)            40110099
401200                                TO  TM500-TRBL-RSN-CDE            40120099
401300                 MOVE LQW-TROUBLE-REASON-LVL (LQW-IDX)            40130099
401400                                TO  TM500-LEVEL-IND               40140099
401500                 MOVE PC-DUMMY-DATE TO TM500-VEND-SHIP-DTE        40150099
401600                                                                  40160099
401700                 IF  TM500-REC-SEQ-NBR = 0                        40170099
401800                     CONTINUE                                     40180099
401900                 ELSE                                             40190099
402000                     PERFORM 5350-FETCH-VEND-SHIP-DTE             40200099
402100                     MOVE SHIPMT-VEND-SHIP-DTE                    40210099
402200                                TO  TM500-VEND-SHIP-DTE           40220099
402300                 END-IF                                           40230099
402400                                                                  40240099
402500                 IF  PS-RESOLVE-REQUEST                           40250099
402600                     PERFORM 5301-RESOLVE-SETUP-EDITS             40260099
402700                 ELSE                                             40270099
402800                     IF TM500-PO-LEVEL                            40280099
402900                       OR TM500-PACK-LEVEL                        40290099
403000                         CONTINUE                                 40300099
403100                     ELSE                                         40310099
403200                         SET TM500-LINE-LEVEL TO TRUE             40320099
403300                     END-IF                                       40330099
403400                 END-IF                                           40340099
403500                                                                  40350099
403600                 IF  PS-NO-ERROR                                  40360099
403700                     PERFORM 5400-PROCESS-TRBL-REQUEST            40370099
403800                 END-IF                                           40380099
403900                                                                  40390099
404000                 IF  PS-NO-ERROR                                  40400099
404100                     IF  TM500-DUPLICATE-TROUBLE                  40410099
404200                         SET LQW-DESELECT (LQW-IDX)               40420099
404300                             LQW-INQUIRE  (LQW-IDX) TO TRUE       40430099
404400                         MOVE PC-TSYMSG-01034 TO DP020-MSG-NUMBER 40440099
404500                         MOVE SPACE                               40450099
404600                                TO  LQW-TEMP-SELECTED-SW (LQW-IDX)40460099
404700                         SUBTRACT 1                               40470099
404800                                FROM ASC-NUMBER-OF-SELECTED-ITEMS 40480099
404900                     ELSE                                         40490099
405000                         SET LQW-DESELECT (LQW-IDX)               40500099
405100                             LQW-UPDATE   (LQW-IDX) TO TRUE       40510099
405200                         MOVE SPACE                               40520099
405300                                TO  LQW-TEMP-SELECTED-SW (LQW-IDX)40530099
405400                         SUBTRACT 1                               40540099
405500                                FROM ASC-NUMBER-OF-SELECTED-ITEMS 40550099
405600                     END-IF                                       40560099
405700                 ELSE                                             40570099
405800                     SET LQW-ERROR (LQW-IDX) TO TRUE              40580099
405900                     EXEC CICS                                    40590099
406000                         SYNCPOINT ROLLBACK                       40600099
406100                     END-EXEC                                     40610099
406200                 END-IF                                           40620099
406300             END-IF                                               40630099
406400         END-PERFORM                                              40640099
406500     END-IF.                                                      40650099
406600                                                                  40660099
406700     MOVE PV-ITEM                TO  PV-SAVE-ITEM.                40670099
406800     PERFORM 6111-WRITE-LIST-QUEUE.                               40680099
406900                                                                  40690099
407000                                                                  40700099
407100 5301-RESOLVE-SETUP-EDITS.                                        40710099
407200     IF (LQW-TRBL-RESOLVED (LQW-IDX))                             40720099
407300         OR  (PS-IN-PROC-REQUEST AND LQW-TRBL-RESOLVED (LQW-IDX)) 40730099
407400         MOVE PC-TSYMSG-00938   TO DP020-MSG-NUMBER               40740099
407500         SET PS-ERROR           TO  TRUE                          40750099
407600     END-IF                                                       40760099
407700                                                                  40770099
407800     IF PS-NO-ERROR                                               40780099
407900     EVALUATE TRUE                                                40790099
408000         WHEN (LQW-RESOLVE-TRBL-AUTO (LQW-IDX)) OR                40800099
408100              (LQW-RESOLVE-TRBL-BOTH-AUTO-MAN (LQW-IDX))          40810099
408200              CONTINUE                                            40820099
408300         WHEN LQW-RESOLVE-TRBL-MANUAL (LQW-IDX)                   40830099
408400             MOVE PC-TSYMSG-01031 TO DP020-MSG-NUMBER             40840099
408500             SET PS-ERROR       TO  TRUE                          40850099
408600         WHEN OTHER                                               40860099
408700             MOVE PC-TSYMSG-01025 TO DP020-MSG-NUMBER             40870099
408800             SET PS-ERROR       TO  TRUE                          40880099
408900     END-EVALUATE                                                 40890099
409000     END-IF.                                                      40900099
409100                                                                  40910099
409200     IF PS-NO-ERROR                                               40920099
409300     IF TM500-PO-LEVEL                                            40930099
409400       OR TM500-PACK-LEVEL                                        40940099
409500       OR TM500-LINE-LEVEL                                        40950099
409600         CONTINUE                                                 40960099
409700     ELSE                                                         40970099
409800         MOVE PC-TSYMSG-00986 TO DP020-MSG-NUMBER                 40980099
409900         SET PS-ERROR       TO  TRUE                              40990099
410000     END-IF.                                                      41000099
410100                                                                  41010099
410200                                                                  41020099
410300*----------------------------------------------------------------*41030099
410400*    RETRIEVE THE VENDOR SHIP DATE ASSOCIATED WITH THE TROUBLE   *41040099
410500*    NOTIFICATION RECORD.                                        *41050099
410600*----------------------------------------------------------------*41060099
410700 5350-FETCH-VEND-SHIP-DTE.                                        41070099
410800     INITIALIZE DCLTSHIPMT.                                       41080099
410900                                                                  41090099
411000     PERFORM                                                      41100099
411100         WITH TEST AFTER                                          41110099
411200         VARYING PV-RETRY-COUNTER                                 41120099
411300         FROM 1 BY 1                                              41130099
411400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               41140099
411500                   OR (SQLCODE = ZERO OR +100))                   41150099
411600                                                                  41160099
411700         EXEC SQL                                                 41170099
411800              SELECT VEND_SHIP_DTE                                41180099
411900                INTO :SHIPMT-VEND-SHIP-DTE                        41190099
412000                FROM TSHPTPO A                                    41200099
412100                    , TSHIPMT B                                   41210099
412200               WHERE A.PO_NBR         = :DK-PO-NBR                41220099
412300                 AND A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR           41230099
412400                 AND A.SHIPT_ID       = B.SHIPT_ID                41240099
412500                 AND A.PRIM_SHIPT_IND = :PC-Y                     41250099
412600         END-EXEC                                                 41260099
412700                                                                  41270099
412800         EVALUATE TRUE                                            41280099
412900             WHEN SQLCODE = ZERO                                  41290099
413000             WHEN SQLCODE = -904                                  41300099
413100             WHEN SQLCODE = -913                                  41310099
413200                  CONTINUE                                        41320099
413300             WHEN SQLCODE = +100                                  41330099
413400                  MOVE PC-DUMMY-DATE TO SHIPMT-VEND-SHIP-DTE      41340099
413500             WHEN SQLWARN0 NOT = SPACE                            41350099
413600             WHEN SQLCODE NOT = ZERO                              41360099
413700                  MOVE '5350-FETCH-VEND-SHIP-DTE'                 41370099
413800                                   TO DP013-PARAGRAPH             41380099
413900                  MOVE 'FETCH VENDOR SHIP DATE'                   41390099
414000                                   TO DP013-MESSAGE-TEXT (1)      41400099
414100                  MOVE 'FOR THE FOLLOWING PO-RCVR SEQ:  '         41410099
414200                                   TO DP013-MESSAGE-TEXT (2)      41420099
414300                  MOVE DK-PO-NBR TO PV-ERROR-PO-NBR               41430099
414400                  MOVE DK-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR     41440099
414500                  STRING PV-ERROR-PO-NBR      DELIMITED BY SIZE   41450099
414600                         '-'                  DELIMITED BY SIZE   41460099
414700                         PV-ERROR-REC-SEQ-NBR DELIMITED BY SIZE   41470099
414800                                 INTO DP013-MESSAGE-TEXT (3)      41480099
414900                  MOVE SQLCA   TO DP013-SQLCA                     41490099
415000                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     41500099
415100                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (2)     41510099
415200                  SET DP013-DB2-ABEND TO TRUE                     41520099
415300                  PERFORM DP013-0000-PROCESS-ABEND                41530099
415400         END-EVALUATE                                             41540099
415500     END-PERFORM.                                                 41550099
415600                                                                  41560099
415700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        41570099
415800         MOVE '5350-FETCH-VEND-SHIP-DTE' TO DP013-PARAGRAPH       41580099
415900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     41590099
416000                                   TO DP013-MESSAGE-TEXT (1)      41600099
416100         MOVE SQLCA                TO DP013-SQLCA                 41610099
416200              MOVE 'TSHPTPO '  TO DP013-DB2-TABLE-NAME (1)        41620099
416300              MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (2)        41630099
416400         SET DP013-DB2-ABEND                                      41640099
416500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   41650099
416600         PERFORM DP013-0000-PROCESS-ABEND                         41660099
416700     END-IF.                                                      41670099
416800                                                                  41680099
416900                                                                  41690099
417000******************************************************************41700099
417100** CALL THE TROUBLE ROUTINE TO PROCESS THE TROUBLE NOTIFICATION **41710099
417200** RECORD.                                                      **41720099
417300******************************************************************41730099
417400 5400-PROCESS-TRBL-REQUEST.                                       41740099
417500     MOVE LENGTH OF TM500-FIELDS      TO PV-COMMAREA-LENGTH       41750099
417600     SET TM500-FROM-LIST-SCREEN       TO TRUE.                    41760099
417700                                                                  41770099
417800     EXEC CICS                                                    41780099
417900          LINK PROGRAM  (PC-TMKCS520)                             41790099
418000               COMMAREA (TM500-FIELDS)                            41800099
418100               LENGTH   (PV-COMMAREA-LENGTH)                      41810099
418200               RESP     (PV-CICS-RESP)                            41820099
418300     END-EXEC.                                                    41830099
418400                                                                  41840099
418500     EVALUATE TRUE                                                41850099
418600         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     41860099
418700              CONTINUE                                            41870099
418800         WHEN OTHER                                               41880099
418900              MOVE '5400-PROCESS-TRBL-REQUEST' TO DP013-PARAGRAPH 41890099
419000                                                                  41900099
419100              MOVE 'CANNOT LINK TO TMKCS520'                      41910099
419200                                         TO DP013-MESSAGE-TEXT (1)41920099
419300              SET DP013-CICS-ABEND       TO TRUE                  41930099
419400              SET DP013-NO-ROLLBACK      TO TRUE                  41940099
419500              SET PS-ERROR               TO TRUE                  41950099
419600              PERFORM DP013-0000-PROCESS-ABEND                    41960099
419700     END-EVALUATE.                                                41970099
419800                                                                  41980099
419900     EVALUATE TRUE                                                41990099
420000         WHEN TM500-CALL-SUCCESSFUL                               42000099
420100         WHEN TM500-DUPLICATE-TROUBLE                             42010099
420200         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        42020099
420300         WHEN TM500-TPURCHS-SELECT-NOT-FND                        42030099
420400         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       42040099
420500              CONTINUE                                            42050099
420600         WHEN TM500-RECORD-IN-PROCESS                             42060099
420700              MOVE PC-TSYMSG-01032 TO DP020-MSG-NUMBER            42070099
420800              SET PS-ERROR      TO  TRUE                          42080099
420900         WHEN TM500-RECORD-RESOLVED                               42090099
421000              MOVE PC-TSYMSG-01033 TO DP020-MSG-NUMBER            42100099
421100              SET PS-ERROR      TO  TRUE                          42110099
421200         WHEN TM500-RECORD-ACKNOWLEDGED                           42120099
421300              MOVE PC-TSYMSG-01036 TO DP020-MSG-NUMBER            42130099
421400              SET PS-ERROR      TO  TRUE                          42140099
421500         WHEN TM500-RECORD-NOT-RESOLVED                           42150099
421600              MOVE PC-TSYMSG-01037 TO DP020-MSG-NUMBER            42160099
421700              SET PS-ERROR      TO  TRUE                          42170099
421800         WHEN TM500-IN-PROC-UPDATE-NOT-FND                        42180099
421900              MOVE PC-TSYMSG-00938 TO DP020-MSG-NUMBER            42190099
422000              SET PS-ERROR      TO  TRUE                          42200099
422100         WHEN TM500-RESPOND-UPDATE-NOT-FND                        42210099
422200              MOVE PC-TSYMSG-01038 TO DP020-MSG-NUMBER            42220099
422300              SET PS-ERROR      TO  TRUE                          42230099
422400         WHEN TM500-ACKNWLG-UPDATE-NOT-FND                        42240099
422500              MOVE PC-TSYMSG-01038 TO DP020-MSG-NUMBER            42250099
422600              SET PS-ERROR      TO  TRUE                          42260099
422700         WHEN OTHER                                               42270099
422800              STRING 'NNNNN-E-'             DELIMITED BY SIZE     42280099
422900                     TM500-RETURN-MSG       DELIMITED BY SIZE     42290099
423000                     '-'                    DELIMITED BY SIZE     42300099
423100                     TM500-RETURN-CODE      DELIMITED BY SIZE     42310099
423200                     ' SQLCODE='            DELIMITED BY SIZE     42320099
423300                     TM500-SQLCODE          DELIMITED BY SIZE     42330099
423400                              INTO  DP020-MSG-MESSAGE             42340099
423500              SET PS-ERROR      TO  TRUE                          42350099
423600     END-EVALUATE.                                                42360099
423700                                                                  42370099
423800                                                                  42380099
423900******************************************************************42390099
424000** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **42400099
424100** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **42410099
424200** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **42420099
424300** THE USER.                                                    **42430099
424400******************************************************************42440099
424500 6000-REFRESH-PANEL-FROM-TEMP.                                    42450099
424600     IF  ASC-UPDATE-TSQ                                           42460099
424700         SET ASC-NO-TSQ-UPDATE TO TRUE                            42470099
424800         MOVE ZERO                 TO PV-SAVE-ITEM                42480099
424900                                      ASC-SEL-ITEM                42490099
425000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        42500099
425100                                   TO PV-HOLD-SELECTED-ITEMS      42510099
425200         MOVE +1                   TO PV-ITEMS-PROCESSED          42520099
425300         PERFORM 6100-UPDATE-TSQ                                  42530099
425400             UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS    42540099
425500         PERFORM 6010-DELETE-SEL-QUEUE                            42550099
425600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         42560099
425700                    ASC-BLOCK-ENTRIES (2)                         42570099
425800                                                                  42580099
425900         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 42590099
426000                GIVING PV-BLOCK-NUMBER                            42600099
426100                REMAINDER PV-REMAINDER                            42610099
426200                                                                  42620099
426300         IF  PV-REMAINDER > ZERO                                  42630099
426400             ADD +1                TO PV-BLOCK-NUMBER             42640099
426500         END-IF                                                   42650099
426600                                                                  42660099
426700         MOVE +1                   TO ASC-BLK-SUB                 42670099
426800         PERFORM 4410-READ-TEMP-STORAGE                           42680099
426900         ADD +1                    TO ASC-BLK-SUB                 42690099
427000                                      PV-BLOCK-NUMBER             42700099
427100         PERFORM 4410-READ-TEMP-STORAGE                           42710099
427200     END-IF.                                                      42720099
427300                                                                  42730099
427400                                                                  42740099
427500*----------------------------------------------------------------*42750099
427600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *42760099
427700*----------------------------------------------------------------*42770099
427800 6010-DELETE-SEL-QUEUE.                                           42780099
427900     EXEC CICS                                                    42790099
428000         DELETEQ TS                                               42800099
428100             QUEUE (ASC-SEL-QUEUE-OUT)                            42810099
428200             RESP  (PV-CICS-RESP)                                 42820099
428300     END-EXEC.                                                    42830099
428400                                                                  42840099
428500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      42850099
428600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         42860099
428700         CONTINUE                                                 42870099
428800     ELSE                                                         42880099
428900         SET DP013-CICS-ABEND TO TRUE                             42890099
429000         SET DP013-NO-ROLLBACK TO TRUE                            42900099
429100         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          42910099
429200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         42920099
429300                        TO DP013-MESSAGE-TEXT (1)                 42930099
429400         PERFORM DP013-0000-PROCESS-ABEND                         42940099
429500     END-IF.                                                      42950099
429600                                                                  42960099
429700                                                                  42970099
429800*----------------------------------------------------------------*42980099
429900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *42990099
430000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *43000099
430100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *43010099
430200*    THE TEMP QUEUE.                                             *43020099
430300*----------------------------------------------------------------*43030099
430400 6100-UPDATE-TSQ.                                                 43040099
430500     ADD 1                     TO  ASC-SEL-ITEM.                  43050099
430600     PERFORM 6105-READ-SEL-QUEUE.                                 43060099
430700     PERFORM                                                      43070099
430800         VARYING TM002-IDX                                        43080099
430900         FROM 1 BY 1                                              43090099
431000         UNTIL ((PV-ITEMS-PROCESSED >                             43100099
431100                              PV-HOLD-SELECTED-ITEMS)             43110099
431200         OR (TM002-IDX GREATER THAN TM002-MAX-ITEMS))             43120099
431300         IF  TM002-ACTION-SW (TM002-IDX) > SPACE                  43130099
431400             PERFORM 6110-PROCESS-ITEMS                           43140099
431500         END-IF                                                   43150099
431600         ADD +1                TO PV-ITEMS-PROCESSED              43160099
431700     END-PERFORM.                                                 43170099
431800     PERFORM 6111-WRITE-LIST-QUEUE.                               43180099
431900                                                                  43190099
432000                                                                  43200099
432100*----------------------------------------------------------------*43210099
432200*    READ THE LIST QUEUE RECORD.                                 *43220099
432300*----------------------------------------------------------------*43230099
432400 6105-READ-SEL-QUEUE.                                             43240099
432500     EXEC CICS                                                    43250099
432600          READQ TS                                                43260099
432700              QUEUE (ASC-SEL-QUEUE-OUT)                           43270099
432800              INTO  (TM002-MESSAGE-SEL-REC)                       43280099
432900              ITEM  (ASC-SEL-ITEM)                                43290099
433000              RESP  (PV-CICS-RESP)                                43300099
433100     END-EXEC.                                                    43310099
433200                                                                  43320099
433300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          43330099
433400         CONTINUE                                                 43340099
433500     ELSE                                                         43350099
433600         SET DP013-CICS-ABEND      TO  TRUE                       43360099
433700         SET DP013-NO-ROLLBACK     TO  TRUE                       43370099
433800         MOVE '6105-READ-SEL-QUEUE' TO DP013-PARAGRAPH            43380099
433900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           43390099
434000                                   TO  DP013-MESSAGE-TEXT(1)      43400099
434100         PERFORM DP013-0000-PROCESS-ABEND                         43410099
434200     END-IF.                                                      43420099
434300                                                                  43430099
434400                                                                  43440099
434500*----------------------------------------------------------------*43450099
434600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*43460099
434700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*43470099
434800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *43480099
434900*----------------------------------------------------------------*43490099
435000 6110-PROCESS-ITEMS.                                              43500099
435100     COMPUTE PV-ITEM-COMP3 = 1 + ((TM002-ITEM (TM002-IDX) - 1)    43510099
435200                     / PC-ITEMS-PER-PANEL-COMP3).                 43520099
435300     MOVE PV-ITEM-COMP3 TO PV-ITEM.                               43530099
435400                                                                  43540099
435500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           43550099
435600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          43560099
435700             PERFORM 6111-WRITE-LIST-QUEUE                        43570099
435800         END-IF                                                   43580099
435900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    43590099
436000                                                                  43600099
436100         PERFORM 6112-READ-LIST-QUEUE                             43610099
436200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               43620099
436300             CONTINUE                                             43630099
436400         END-IF                                                   43640099
436500     END-IF.                                                      43650099
436600                                                                  43660099
436700     COMPUTE PV-SUB-COMP3 = (TM002-ITEM (TM002-IDX)               43670099
436800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              43680099
436900     MOVE PV-SUB-COMP3 TO PV-SUB.                                 43690099
437000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         43700099
437100     MOVE LQW-SELECTED-SW (PV-SUB)                                43710099
437200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  43720099
437300     EVALUATE TRUE                                                43730099
437400         WHEN TM002-INQ (TM002-IDX)                               43740099
437500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             43750099
437600         WHEN TM002-UPD (TM002-IDX)                               43760099
437700              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             43770099
437800         WHEN TM002-DEL (TM002-IDX)                               43780099
437900              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             43790099
438000         WHEN TM002-ERR (TM002-IDX)                               43800099
438100              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             43810099
438200     END-EVALUATE.                                                43820099
438300                                                                  43830099
438400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                43840099
438500                                                                  43850099
438600                                                                  43860099
438700*----------------------------------------------------------------*43870099
438800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *43880099
438900*----------------------------------------------------------------*43890099
439000 6111-WRITE-LIST-QUEUE.                                           43900099
439100     EXEC CICS                                                    43910099
439200         WRITEQ TS                                                43920099
439300             QUEUE (ASC-LIST-QUEUE-NAME)                          43930099
439400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     43940099
439500             ITEM  (PV-SAVE-ITEM)                                 43950099
439600             REWRITE                                              43960099
439700             RESP  (PV-CICS-RESP)                                 43970099
439800     END-EXEC.                                                    43980099
439900                                                                  43990099
440000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          44000099
440100         CONTINUE                                                 44010099
440200     ELSE                                                         44020099
440300         SET DP013-CICS-ABEND  TO  TRUE                           44030099
440400         SET DP013-NO-ROLLBACK TO  TRUE                           44040099
440500         MOVE '6111-WRITE-LIST-QUEUE'                             44050099
440600                               TO  DP013-PARAGRAPH                44060099
440700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  44070099
440800                               TO  DP013-MESSAGE-TEXT(1)          44080099
440900         PERFORM DP013-0000-PROCESS-ABEND                         44090099
441000     END-IF.                                                      44100099
441100                                                                  44110099
441200                                                                  44120099
441300*----------------------------------------------------------------*44130099
441400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*44140099
441500*----------------------------------------------------------------*44150099
441600 6112-READ-LIST-QUEUE.                                            44160099
441700     EXEC CICS                                                    44170099
441800         READQ TS                                                 44180099
441900             QUEUE (ASC-LIST-QUEUE-NAME)                          44190099
442000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     44200099
442100             ITEM  (PV-ITEM)                                      44210099
442200             RESP  (PV-CICS-RESP)                                 44220099
442300     END-EXEC.                                                    44230099
442400                                                                  44240099
442500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          44250099
442600         CONTINUE                                                 44260099
442700     ELSE                                                         44270099
442800         SET DP013-CICS-ABEND        TO TRUE                      44280099
442900         SET DP013-NO-ROLLBACK       TO TRUE                      44290099
443000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           44300099
443100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    44310099
443200                                     TO DP013-MESSAGE-TEXT(1)     44320099
443300         PERFORM DP013-0000-PROCESS-ABEND                         44330099
443400     END-IF.                                                      44340099
443500                                                                  44350099
443600                                                                  44360099
443700*----------------------------------------------------------------*44370099
443800*    READ THE ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE      *44380099
443900*----------------------------------------------------------------*44390099
444000 9100-READ-SEL-QUEUE.                                             44400099
444100     EXEC CICS                                                    44410099
444200         READQ TS                                                 44420099
444300             QUEUE (ASC-SEL-QUEUE-IN)                             44430099
444400             INTO  (RC013-DC-SELECT-RECORD)                       44440099
444500             ITEM  (ASC-SEL-ITEM)                                 44450099
444600             RESP  (PV-CICS-RESP)                                 44460099
444700     END-EXEC.                                                    44470099
444800                                                                  44480099
444900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       44490099
445000         CONTINUE                                                 44500099
445100     ELSE                                                         44510099
445200         SET DP013-LOGIC-ABEND                                    44520099
445300             DP013-NO-ROLLBACK     TO TRUE                        44530099
445400         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            44540099
445500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   44550099
445600                                   TO DP013-MESSAGE-TEXT (1)      44560099
445700         PERFORM DP013-0000-PROCESS-ABEND                         44570099
445800     END-IF.                                                      44580099
445900                                                                  44590099
446000                                                                  44600099
446100*----------------------------------------------------------------*44610099
446200*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *44620099
446300*----------------------------------------------------------------*44630099
446400 9200-REWRITE-SEL-QUEUE.                                          44640099
446500     EXEC CICS                                                    44650099
446600          WRITEQ TS                                               44660099
446700              QUEUE  (ASC-SEL-QUEUE-IN)                           44670099
446800              FROM   (RC013-DC-SELECT-RECORD)                     44680099
446900              ITEM  (ASC-SEL-ITEM)                                44690099
447000              RESP   (PV-CICS-RESP)                               44700099
447100              REWRITE                                             44710099
447200     END-EXEC.                                                    44720099
447300                                                                  44730099
447400     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   44740099
447500         SET DP013-CICS-ABEND                                     44750099
447600             DP013-NO-ROLLBACK     TO TRUE                        44760099
447700         MOVE '9200-REWRITE-SEL-QUEUE' TO DP013-PARAGRAPH         44770099
447800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   44780099
447900                                   TO DP013-MESSAGE-TEXT (1)      44790099
448000         PERFORM DP013-0000-PROCESS-ABEND                         44800099
448100     END-IF.                                                      44810099
448200                                                                  44820099
448300                                                                  44830099
448400*----------------------------------------------------------------*44840099
448500*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *44850099
448600*----------------------------------------------------------------*44860099
448700 9900-SQL-913-RETURN.                                             44870099
448800     PERFORM 9100-READ-SEL-QUEUE.                                 44880099
448900     MOVE SPACE TO RC013-ACTION-SW (ASC-SEL-ITEM)                 44890099
449000     PERFORM 9200-REWRITE-SEL-QUEUE.                              44900099
449100     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       44910099
449200     SET DP020-MSG-FATAL           TO  TRUE.                      44920099
449300     MOVE PC-TSYMSG-01089          TO  DP020-MSG-NUMBER.          44930099
449400     MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1).         44940099
449500     PERFORM 0001-CALL-CICS-ARCH-API.                             44950099
449600                                                                  44960099
449700 9910-SQL-913-RETURN.                                             44970099
449800     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       44980099
449900     SET DP020-MSG-FATAL           TO  TRUE.                      44990099
450000     MOVE PC-TSYMSG-01089          TO  DP020-MSG-NUMBER.          45000099
450100     MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1).         45010099
450200     PERFORM 0001-CALL-CICS-ARCH-API.                             45020099
450300                                                                  45030099
450400                                                                  45040099
450500*----------------------------------------------------------------*45050099
450600*    ABEND PROCESSOR MODULE                                      *45060099
450700*----------------------------------------------------------------*45070099
450800     COPY DPPD013.                                                45080099
