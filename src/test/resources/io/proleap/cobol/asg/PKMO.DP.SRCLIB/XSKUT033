000100*----------------------------------------------------------       00000327
000200 IDENTIFICATION DIVISION.                                         00000427
000300*----------------------------------------------------------       00000527
000400 PROGRAM-ID.    XSKUT033.                                         00000627
000500 AUTHOR.        JOSEPH MENYAH.                                    00000727
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00000827
000700                                                                  00000927
000800*----------------------------------------------------------       00001027
000900*            PRICING STORE GROUP EXTRACT                          00002027
001000*----------------------------------------------------------       00003027
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00004027
001020* EXTRACT FOR THE PRICING BUSINESS EVENT.                         00005027
001124*                                                                 00006027
001125*----------------------------------------------------------       00007027
001126* HISTORY LOG:                                                    00008027
001127*                                                                 00009027
001128*----------------------------------------------------------       00010027
001129* DATE:     08/13/2010                                            00020045
001130* WR/IR#:   WR38172                                               00030045
001131* PROGRAMMER: CHERI PARMLEY                                       00040045
001140* DESCRIPTION: INCLUDE IN EACH CURSOR CHECKING IF 'RBO'           00050045
001150*  IF SO EXCLUDE FROM EXTRACT. JOIN WITH XST_MDSE_LNE_SELN        00060045
001150*  ALSO REMOVE EXTRACT CURSOR NOT BEING USED                      00061045
001160*----------------------------------------------------------       00070027
001170 ENVIRONMENT DIVISION.                                            00080027
001180*----------------------------------------------------------       00090027
001190 CONFIGURATION SECTION.                                           00100027
001200 SOURCE-COMPUTER. IBM-3090.                                       00110027
001300 OBJECT-COMPUTER. IBM-3090.                                       00120027
001400                                                                  00130027
001500 INPUT-OUTPUT SECTION.                                            00140027
001600                                                                  00150027
001700 FILE-CONTROL.                                                    00160027
001800                                                                  00170027
004900     SELECT DATE-RANGE-FILE                                       00180027
005000         ASSIGN TO INP01.                                         00190027
                                                                        00191027
004900     SELECT TMST-FILE                                             00192027
005000         ASSIGN TO INP02.                                         00193027
                                                                        00194027
004900     SELECT EXTRACT-FILE                                          00195027
005000         ASSIGN TO OUT01.                                         00196027
001900*----------------------------------------------------------       00197027
002000 DATA DIVISION.                                                   00198027
002100*----------------------------------------------------------       00199027
002200 FILE SECTION.                                                    00200027
002300                                                                  00210027
008000 FD  EXTRACT-FILE                                                 00220027
008100     RECORDING MODE IS F                                          00230027
008200     LABEL RECORDS ARE OMITTED                                    00240027
008300     RECORD CONTAINS 250 CHARACTERS                               00250027
008400     DATA RECORD IS EXTRACT-RECORD.                               00260027
008500 01  EXTRACT-RECORD        PIC X(250).                            00270027
008600                                                                  00280027
005800 FD  DATE-RANGE-FILE                                              00290027
005900     RECORDING MODE IS F                                          00300027
006000     LABEL RECORDS ARE OMITTED                                    00310027
006100     RECORD CONTAINS 80 CHARACTERS                                00320027
006200     BLOCK CONTAINS 0 RECORDS.                                    00330027
       01  DATE-RANGE-LINE             PIC  X(80).                      00340027
006500                                                                  00350027
005800 FD  TMST-FILE                                                    00360027
005900     RECORDING MODE IS F                                          00370027
006000     LABEL RECORDS ARE OMITTED                                    00380027
006100     RECORD CONTAINS 80 CHARACTERS                                00390027
006200     BLOCK CONTAINS 0 RECORDS.                                    00400027
       01  TMST-LINE                        PIC  X(80).                 00410027
006500                                                                  00420027
002500*---------------------------------------------------------        00430027
002600                                                                  00440027
002700 WORKING-STORAGE SECTION.                                         00450027
002800*---------------------------------------------------------        00460027
003500* PC- PROGRAM CONSTANTS                                           00470027
003600*----------------------------------------------------------       00480027
003700 01  PC-PROGRAM-CONSTANTS.                                        00490027
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT033'. 00500027
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00510027
004000                                                                  00520027
004100*----------------------------------------------------------       00530027
004200* PS- PROGRAM SWITCHES                                            00540027
004300*----------------------------------------------------------       00550027
004400 01  PS-PROGRAM-SWITCHES.                                         00560027
004500     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE SPACE.     00570027
004600         88  PS-EOF-EXTRACT                      VALUE 'Y'.       00580027
004600         88  PS-NOT-EOF-EXTRACT                  VALUE 'N'.       00590027
           05  PS-DATE-RANGE-FILE-SW        PIC  X(01)  VALUE 'N'.      00591027
               88  PS-DATE-RANGE-FILE-END               VALUE 'Y'.      00592027
               88  PS-DATE-RANGE-FILE-START             VALUE 'N'.      00593027
           05  PS-TMST-FILE-SW              PIC  X(01)  VALUE 'N'.      00594027
               88  PS-TMST-FILE-END                     VALUE 'Y'.      00595027
               88  PS-TMST-FILE-START                   VALUE 'N'.      00596027
004800                                                                  00597027
004500     05  PS-EOF-STOREGP-SW            PIC X(01)  VALUE SPACE.     00598027
004600         88  PS-EOF-STOREGP                      VALUE 'Y'.       00599027
004600         88  PS-NOT-EOF-STOREGP                  VALUE 'N'.       00600027
004800                                                                  00601027
004500     05  PS-EOF-ADHOC-SW              PIC X(01)  VALUE SPACE.     00602027
004600         88  PS-EOF-ADHOC                        VALUE 'Y'.       00603027
004600         88  PS-NOT-EOF-ADHOC                    VALUE 'N'.       00604027
004800                                                                  00604127
004900*----------------------------------------------------------       00604227
005000* PV- PROGRAM VARIABLES                                           00604327
005100*----------------------------------------------------------       00604427
       01  CC-DATE-RANGE-FILE.                                          00604527
           05  CC-START-DATE                PIC X(10).                  00604627
           05  FILLER                       PIC X(01).                  00604727
           05  CC-END-DATE                  PIC X(10).                  00604827
                                                                        00604927
       01  CC-TMST-FILE.                                                00605027
           05  CC-LAST-UPD-TMST             PIC X(19).                  00606027
                                                                        00606129
       01  CC-LAST-UPD-DATE.                                            00606228
           05  CC-LAST-UPD-DT               PIC X(10).                  00606328
           05  CC-LAST-UPD-TM               PIC X(09).                  00606429
                                                                        00607027
005200 01 PV-PROGRAM-VARIABLES.                                         00608027
006000    05  PV-RECORD-COUNT               PIC 9(10) VALUE ZEROS.      00609027
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00610027
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00620027
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00630027
005700    05  PV-LAST-UPD-TMST              PIC X(26)  VALUE SPACES.    00631027
005710    05  PV-AD-EVNT-ID                 PIC S9(09) VALUE +0.        00632027
                                                                        00633027
007100    05  PV-STRT-PARM.                                             00634027
007200        10  PV-STRT-DTE-CC            PIC X(02).                  00635027
007200        10  PV-STRT-DTE-YY            PIC X(02).                  00636027
007400        10  PV-STRT-DTE-MM            PIC X(02).                  00637027
007600        10  PV-STRT-DTE-DD            PIC X(02).                  00638027
007400        10  FILLER                    PIC X.                      00639027
007400        10  PV-DECREMENT              PIC X(02).                  00640027
007400        10  FILLER                    PIC X(69).                  00650027
007700                                                                  00660027
007100    05  PV-EVNT-STRT-DTE              PIC X(10).                  00670027
                                                                        00680027
008500                                                                  00690027
008600    05  PV-EVNT-END-DTE-TM.                                       00700027
008700        10  PV-EVNT-END-DTE.                                      00710027
008800            15  PV-EVNT-DTE-TM2-CCYY      PIC X(04).              00720027
008900            15  FILLER                    PIC X(01).              00730027
009000            15  PV-EVNT-DTE-TM2-MM        PIC X(02).              00740027
009100            15  FILLER                    PIC X(01).              00750027
009200            15  PV-EVNT-DTE-TM2-DD        PIC X(02).              00760027
009300        10  PV-EVNT-END-TM                PIC X(16).              00770027
                                                                        00770127
          05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.    00770227
                                                                        00770327
          05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.    00770427
                                                                        00770527
004310    05  PV-NULLS-INDICATORS.                                      00770627
004321        10  PV-PRIC-VER-IND           PIC S9(4) VALUE +0 COMP.    00770727
004321        10  PV-STR-GP-TYP-CDE-IND     PIC S9(4) VALUE +0 COMP.    00770827
004322        10  PV-STR-GP-ID-IND          PIC S9(4) VALUE +0 COMP.    00770927
004323        10  PV-PRNT-GP-TYP-CDE-IND    PIC S9(4) VALUE +0 COMP.    00771027
004323        10  PV-PRNT-STR-GP-CDE-IND    PIC S9(4) VALUE +0 COMP.    00772027
004323        10  PV-PRNT-STR-GP-ID-IND     PIC S9(4) VALUE +0 COMP.    00773027
004324        10  PV-PRNT-ADHC-GP-ID-IND    PIC S9(4) VALUE +0 COMP.    00774027
004324        10  PV-ESL-TOPR-TYP-IND       PIC S9(4) VALUE +0 COMP.    00774137
                                                                        00775027
       01 PV-TOTAL-RECORD.                                              00776027
          05 PV-BUSINESS-EVNT-ID              PIC 9(03) VALUE ZERO.     00777027
          05 PV-ACTION-CDE                    PIC X(01) VALUE 'T'.      00778027
          05 PV-TOTAL-NBR-OF-RECS             PIC 9(11) VALUE ZERO.     00779027
009400                                                                  00780027
004600*----------------------------------------------------------       00790027
004700* STORE GOUP EVENT RECORD LAYOUT                                  00800027
004800*----------------------------------------------------------       00810027
004900     COPY XSRD022.                                                00820027
005000                                                                  00830027
006800*---------------------------------------------                    00840027
006900*  DB2 TABLE XST00026(XST_PROMO) - PROMOTION TABLE                00850027
007000*---------------------------------------------                    00860027
007100     EXEC SQL                                                     00870027
007200          INCLUDE XST00026                                        00880027
007300     END-EXEC.                                                    00890027
007400                                                                  00900027
007500*---------------------------------------------                    00910027
007600*  DB2 TABLE XST00028(XST_MDSE_LNE_SELN) -                        00920027
007700*---------------------------------------------                    00930027
007800     EXEC SQL                                                     00940027
007900          INCLUDE XST00028                                        00950027
008000     END-EXEC.                                                    00960027
008100                                                                  00970027
008200*-------------------------------------------------------          00971027
008300*  DB2 TABLE XST00029(XST_PROMO_STR_GP) STORE GROUP               00972027
008400*-------------------------------------------------------          00973027
008500     EXEC SQL                                                     00974027
008600          INCLUDE XST00029                                        00975027
008700     END-EXEC.                                                    00976027
008800                                                                  00977027
008200*---------------------------------------------------------        00977127
008300*  DB2 TABLE XST00031(XST_PROMO_ADHC_RLT)ADHOC STORE GROUP        00977227
008400*---------------------------------------------------------        00977327
008500     EXEC SQL                                                     00977427
008600          INCLUDE XST00031                                        00977527
008700     END-EXEC.                                                    00977627
008800                                                                  00977727
011400*----------------------------------------------------------       00977827
011500* DATE ROUTINE COPY MEMBERS                                       00977927
011600*----------------------------------------------------------       00978027
011700     COPY DPWS500.                                                00979027
011800                                                                  00980027
011900*----------------------------------------------------------       00981027
012000* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00982027
012100*----------------------------------------------------------       00983027
012200     COPY DPWS004.                                                00984027
012300                                                                  00985027
030160*---------------------------------------------                    00986027
030170*  DB2 COMMUNICATION AREA.                                        00987027
030180*---------------------------------------------                    00988027
030190     EXEC SQL                                                     00989027
030191          INCLUDE SQLCA                                           00990027
030192     END-EXEC.                                                    01000027
030193                                                                  01010027
023000     COPY SQLCA2.                                                 01020027
030310                                                                  01164027
030194*---------------------------------------------                    01165027
023300*   STOREGP  CURSOR  DB2 SELECT                                   01166027
030194*---------------------------------------------                    01167027
023400     EXEC SQL                                                     01168027
023500       DECLARE STOREGP CURSOR FOR                                 01169027
              SELECT A.PROMO_INTFC_ID,                                  01170045
                     A.MDSE_LNE_ID,                                     01180045
                     A.STR_GP_TYP_CDE,                                  01190045
                     A.STR_GP_ID,                                       01200045
                     A.PROMO_PRIC_VER_ID,                               01210045
                     A.STR_SELN_HIER_CDE,                               01220045
                     A.STAT_CDE,                                        01230045
                     A.PRNT_GP_TYP_CDE,                                 01240045
                     A.PRNT_STR_GP_CDE,                                 01250045
                     A.PRNT_STR_GP_ID,                                  01251045
                     A.PRNT_ADHC_GP_ID,                                 01252045
                     A.PROMO_STRT_TMST,                                 01253045
                     A.PROMO_END_TMST,                                  01254045
                     A.ACTL_STRT_TMST,                                  01255045
                     A.ACTL_END_TMST,                                   01256045
                     A.ESL_TOPR_TYP_CDE,                                01256145
                     A.LAST_UPD_TMST,                                   01257045
                     A.SOR_LAST_UPD_TMST,                               01258045
                     A.LAST_ACTN_CDE                                    01259051
024100        FROM XST_PROMO_STR_GP A,                                  01260045
024100             XST_MDSE_LNE_SELN B                                  01261050
              WHERE A.PROMO_INTFC_ID = B.PROMO_INTFC_ID                 01261247
                AND A.MDSE_LNE_ID    = B.MDSE_LNE_ID                    01261347
                AND  DATE(A.PROMO_END_TMST)                             01262045
                          >= :CC-START-DATE                             01263030
              AND    DATE(A.PROMO_STRT_TMST)                            01264045
                          <= :CC-END-DATE                               01265033
              AND A.SOR_LAST_UPD_TMST <=                                01266045
                     :CC-LAST-UPD-TMST                                  01267043
              AND B.PRICG_TYP_CDE <> 'RBO'                              01268050
               WITH UR                                                  01290027
024400     END-EXEC.                                                    01300027
030310                                                                  01310027
030194*---------------------------------------------                    01311027
023300*   ADHOC CURSOR  DB2 SELECT                                      01312027
030194*---------------------------------------------                    01313027
023400     EXEC SQL                                                     01314027
023500       DECLARE ADHOC CURSOR FOR                                   01315027
              SELECT A.PROMO_INTFC_ID,                                  01316045
                     A.MDSE_LNE_ID,                                     01317045
                     A.ADHC_STR_GP_ID,                                  01318045
                     A.PROMO_PRIC_VER_ID,                               01318145
                     A.STR_SELN_HIER_CDE,                               01318245
                     A.STAT_CDE,                                        01318345
                     A.PROMO_STRT_TMST,                                 01319045
                     A.PROMO_END_TMST,                                  01319145
                     A.ACTL_STRT_TMST,                                  01319245
                     A.ACTL_END_TMST,                                   01319345
                     A.ESL_TOPR_TYP_CDE,                                01319445
                     A.SOR_LAST_UPD_TMST                                01319651
024100        FROM XST_PROMO_ADHC_RLT A,                                01319947
                   XST_MDSE_LNE_SELN B                                  01320050
              WHERE A.PROMO_INTFC_ID = B.PROMO_INTFC_ID                 01320247
                AND A.MDSE_LNE_ID    = B.MDSE_LNE_ID                    01320347
                AND  DATE(A.PROMO_END_TMST)                             01320547
                          >= :CC-START-DATE                             01320647
              AND    DATE(A.PROMO_STRT_TMST)                            01320747
                          <= :CC-END-DATE                               01320847
              AND A.SOR_LAST_UPD_TMST <=                                01320947
                     :CC-LAST-UPD-TMST                                  01321047
              AND B.PRICG_TYP_CDE <> 'RBO'                              01321150
               WITH UR                                                  01321347
024400     END-EXEC.                                                    01321447
030310                                                                  01321547
031400*----------------------------------------------------------       01321647
031500 PROCEDURE DIVISION.                                              01321747
032100*----------------------------------------------------------       01321847
032200 0000-MAINLINE.                                                   01321947
032300                                                                  01322047
032400     PERFORM 1000-INITIALIZATION.                                 01322147
032500                                                                  01322247
032600     PERFORM 2000-EXTRACT-DATA                                    01322347
004600             UNTIL PS-EOF-STOREGP AND                             01322447
004600                   PS-EOF-ADHOC.                                  01322547
035000                                                                  01322730
035100     PERFORM 9990-WRITE-RECORD-CNT.                               01322830
                                                                        01322930
035100     PERFORM 9999-WRAPUP.                                         01323030
035200                                                                  01323130
035500     GOBACK.                                                      01323230
035700                                                                  01323330
035701*0000-EXIT.                                                       01323430
035702 EJECT.                                                           01323530
035703                                                                  01323630
035800*----------------------------------------------------------       01323730
035900* 1000-INITIALIZATION.                                            01323827
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01324027
036100*     UPDATE OR INSERT A RECORD.                                  01325027
036200*----------------------------------------------------------       01326027
036300 1000-INITIALIZATION.                                             01327027
                                                                        01328027
           SET PS-NOT-EOF-STOREGP  TO TRUE.                             01330027
           SET PS-NOT-EOF-ADHOC    TO TRUE.                             01340027
                                                                        01350027
026600     OPEN INPUT DATE-RANGE-FILE                                   01360027
026600                TMST-FILE                                         01370027
026600          OUTPUT EXTRACT-FILE.                                    01380027
                                                                        01390027
051100     PERFORM 2010-COMPUTE-STRT-DTE                                01400027
051200        THRU 2010-EXIT.                                           01410027
038000                                                                  01420027
038000                                                                  01450027
                                                                        01460027
036410     INITIALIZE DCLXST00026.                                      01470027
036410     INITIALIZE DCLXST00028.                                      01480027
036410     INITIALIZE DCLXST00029.                                      01490027
036410     INITIALIZE DCLXST00031.                                      01500027
036515                                                                  01510027
037240*1100-EXIT.                                                       01520027
037250 EJECT.                                                           01530027
037251                                                                  01540027
037260*----------------------------------------------------------       01550027
037300* 2000-EXTRACT-DATA.                                              01560027
037400*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01570027
037500*     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      01580027
037600*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          01590027
037700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01600027
037800*----------------------------------------------------------       01610027
037900 2000-EXTRACT-DATA.                                               01620027
                                                                        01630027
           SET PS-NOT-EOF-STOREGP TO TRUE.                              01680034
                                                                        01690027
051100     PERFORM 4010-OPEN-STOREGP-CSR                                01700033
051200        THRU 4010-EXIT.                                           01710034
                                                                        01720027
056000     IF SQLCODE = 0                                               01730033
051100         PERFORM 2110-FETCH-STOREGP                               01740033
051200            THRU 2110-EXIT                                        01750033
032700            UNTIL PS-EOF-STOREGP                                  01760033
                                                                        01770027
051100         PERFORM 4100-CLOSE-STOREGP-CSR                           01780033
051200            THRU 4100-EXIT                                        01790033
           END-IF.                                                      01800033
                                                                        01810027
           SET PS-NOT-EOF-ADHOC TO TRUE.                                01820034
                                                                        01830027
051100     PERFORM 4020-OPEN-ADHOC-CSR                                  01840033
051200        THRU 4020-EXIT.                                           01850034
                                                                        01860027
056000     IF SQLCODE = 0                                               01870033
051100         PERFORM 2120-FETCH-ADHOC                                 01880033
051200            THRU 2120-EXIT                                        01890033
032700            UNTIL PS-EOF-ADHOC                                    01900033
                                                                        01910027
051100         PERFORM 4110-CLOSE-ADHOC-CSR                             01920033
051200            THRU 4110-EXIT                                        01930033
           END-IF.                                                      01931033
                                                                        01932027
038000                                                                  01934027
038110*2000-EXIT.                                                       01934127
038200 EJECT.                                                           01934227
030000 2010-COMPUTE-STRT-DTE.                                           01934327
           READ DATE-RANGE-FILE INTO CC-DATE-RANGE-FILE                 01934427
              AT END                                                    01934527
                 SET PS-DATE-RANGE-FILE-END TO TRUE                     01934627
           END-READ.                                                    01934727
                                                                        01934827
           IF PS-DATE-RANGE-FILE-END                                    01934927
               MOVE 'NO DATE RANGE FILE TO PROCESS'                     01935027
                                                 TO PV-OPERATION-MSG-1  01936027
               PERFORM Z910-ABEND                                       01938027
           ELSE                                                         01939027
               DISPLAY 'CC-START-DATE = ' CC-START-DATE                 01939127
               DISPLAY 'CC-END-DATE   = ' CC-END-DATE                   01939227
           END-IF.                                                      01939327
                                                                        01939427
           READ TMST-FILE INTO CC-TMST-FILE                             01939527
              AT END                                                    01939627
                 SET PS-TMST-FILE-END TO TRUE                           01939727
           END-READ.                                                    01939827
                                                                        01939927
           IF PS-TMST-FILE-END                                          01940027
               MOVE 'NO TMST FILE TO PROCESS'                           01941027
                                                 TO PV-OPERATION-MSG-1  01942027
               PERFORM Z910-ABEND                                       01944027
           ELSE                                                         01945027
               MOVE CC-LAST-UPD-TMST TO  CC-LAST-UPD-DATE               01946028
               DISPLAY 'CC-LAST-UPD-TMST = ' CC-LAST-UPD-TMST           01946128
           END-IF.                                                      01947027
030100                                                                  01948027
 35100                                                                  01949027
038110 2010-EXIT.                                                       01949127
           EXIT.                                                        01949227
038200 EJECT.                                                           01949327
038300*------------------------------------------------------           02180027
038400* 2110-FETCH-STOREGP                                              02190027
038500*     EXTRACTS THE STORE GROUP EVENT RECORD.                      02200027
038600*------------------------------------------------------           02210027
038210                                                                  02220027
054400 2110-FETCH-STOREGP.                                              02230027
054500                                                                  02240027
054600     EXEC SQL                                                     02250027
054700         FETCH STOREGP                                            02260027
                 INTO :XST00029-PROMO-INTFC-ID,                         02270027
                      :XST00029-MDSE-LNE-ID,                            02280027
                      :XST00029-STR-GP-TYP-CDE:PV-STR-GP-TYP-CDE-IND,   02290027
                      :XST00029-STR-GP-ID:PV-STR-GP-ID-IND,             02300027
                      :XST00029-PROMO-PRIC-VER-ID:PV-PRIC-VER-IND,      02310027
                      :XST00029-STR-SELN-HIER-CDE,                      02320027
                      :XST00029-STAT-CDE,                               02330027
                      :XST00029-PRNT-GP-TYP-CDE:PV-PRNT-GP-TYP-CDE-IND, 02340027
                      :XST00029-PRNT-STR-GP-CDE:PV-PRNT-STR-GP-CDE-IND, 02350027
                      :XST00029-PRNT-STR-GP-ID:PV-PRNT-STR-GP-ID-IND,   02360027
                      :XST00029-PRNT-ADHC-GP-ID:PV-PRNT-ADHC-GP-ID-IND, 02370027
                      :XST00029-PROMO-STRT-TMST,                        02380027
                      :XST00029-PROMO-END-TMST,                         02390027
                      :XST00029-ACTL-STRT-TMST,                         02400027
                      :XST00029-ACTL-END-TMST,                          02410027
                      :XST00029-ESL-TOPR-TYP-CDE:PV-ESL-TOPR-TYP-IND,   02411037
                      :XST00029-LAST-UPD-TMST,                          02420027
                      :XST00029-SOR-LAST-UPD-TMST                       02430050
055300     END-EXEC.                                                    02440027
055400                                                                  02450027
055500     IF SQLCODE < 0                                               02460027
055600         DISPLAY 'FETCH FAILED FOR CURSOR STOREGP'                02470027
055700         PERFORM U9980-SQL-ERROR                                  02480027
055800            THRU U9980-EXIT.                                      02490027
055900                                                                  02500027
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100)                  02510027
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_PROMO_STR_GP'       02520027
056300         PERFORM U9990-SQL-WARNING                                02530027
056400            THRU U9990-EXIT.                                      02540027
056500                                                                  02550027
056600     IF SQLCODE = +100                                            02560027
056700         MOVE 'Y' TO PS-EOF-STOREGP-SW                            02561027
           END-IF.                                                      02562027
                                                                        02563027
055500     IF SQLCODE = 0                                               02564027
051100         PERFORM 2200-FORMAT-STOREGP-FILE                         02565027
051200            THRU 2200-EXIT                                        02566027
                                                                        02567027
051100         PERFORM 3000-WRITE-EXTRACT-RECORD                        02568027
051200            THRU 3000-EXIT                                        02569027
           END-IF.                                                      02569127
056900 2110-EXIT.                                                       02569227
057000     EXIT.                                                        02569327
038300*------------------------------------------------------           02569427
038400* 2120-FETCH-ADHOC                                                02569527
038500*     EXTRACTS THE STORE GROUP EVENT RECORD.                      02569627
038600*------------------------------------------------------           02569727
054400 2120-FETCH-ADHOC.                                                02569827
054500                                                                  02569927
054600     EXEC SQL                                                     02570027
054700         FETCH ADHOC                                              02571027
                   INTO :XST00031-PROMO-INTFC-ID,                       02572227
                        :XST00031-MDSE-LNE-ID,                          02572327
                        :XST00031-ADHC-STR-GP-ID,                       02572427
                        :XST00031-PROMO-PRIC-VER-ID:PV-PRIC-VER-IND,    02572530
                        :XST00031-STR-SELN-HIER-CDE,                    02572730
                        :XST00031-STAT-CDE,                             02572830
                        :XST00031-PROMO-STRT-TMST,                      02572930
                        :XST00031-PROMO-END-TMST,                       02573030
                        :XST00031-ACTL-STRT-TMST,                       02573230
                        :XST00031-ACTL-END-TMST,                        02573330
                        :XST00031-ESL-TOPR-TYP-CDE:PV-ESL-TOPR-TYP-IND, 02573437
                        :XST00031-SOR-LAST-UPD-TMST                     02573650
055300     END-EXEC.                                                    02573947
055400                                                                  02574047
055500     IF SQLCODE < 0                                               02574147
055600         DISPLAY 'FETCH FAILED FOR CURSOR ADHOC'                  02574247
055700         PERFORM U9980-SQL-ERROR                                  02574347
055800            THRU U9980-EXIT.                                      02574447
055900                                                                  02574547
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02574647
056100           SQLWARN0 = 'W'                                         02574747
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_PROMO_ADHC_RLT'     02574847
056300         PERFORM U9990-SQL-WARNING                                02574947
056400            THRU U9990-EXIT.                                      02575047
056500                                                                  02575147
056600     IF SQLCODE = +100                                            02575247
056700         MOVE 'Y' TO PS-EOF-ADHOC-SW                              02575347
           END-IF.                                                      02575447
                                                                        02575547
055500     IF SQLCODE = 0                                               02575647
051100         PERFORM 2210-FORMAT-ADHOC-FILE                           02575747
051200            THRU 2210-EXIT                                        02575847
                                                                        02575947
051100         PERFORM 3000-WRITE-EXTRACT-RECORD                        02576047
051200            THRU 3000-EXIT                                        02576147
           END-IF.                                                      02576247
056900 2120-EXIT.                                                       02576347
057000     EXIT.                                                        02576447
038300*------------------------------------------------------           02576547
038400* 2200-FORMAT-STOREGP-FILE                                        02576647
038500*     FORMATS THE PROMO STORE GROUP COPY BOOK.                    02576747
038600*------------------------------------------------------           02576847
038700 2200-FORMAT-STOREGP-FILE.                                        02576947
      *    INITIALIZE XS022-PRICING-STR-GP-RECORD.                      02577047
           MOVE XST00029-PROMO-INTFC-ID    TO XS022-PROMO-INTFC-ID.     02577147
           MOVE XST00029-MDSE-LNE-ID       TO XS022-MDSE-LNE-ID.        02577247
           MOVE XST00029-STR-GP-TYP-CDE    TO XS022-STR-GP-TYP-CDE.     02577347
           MOVE XST00029-STR-GP-ID         TO XS022-STR-GP-ID.          02577447
           MOVE XST00029-STR-SELN-HIER-CDE TO                           02577547
                XS022-STR-SELN-HIER-LVL-CDE.                            02577647
           IF PV-PRIC-VER-IND EQUAL -1                                  02577747
            INITIALIZE  XS022-PROMO-PRIC-VER-ID                         02577847
           ELSE                                                         02577947
            MOVE XST00029-PROMO-PRIC-VER-ID TO XS022-PROMO-PRIC-VER-ID  02578047
           END-IF.                                                      02578147
           MOVE XST00029-STAT-CDE          TO XS022-STAT-CDE.           02578247
           IF PV-PRNT-GP-TYP-CDE-IND EQUAL -1                           02578347
            INITIALIZE XS022-PRNT-OV-STR-SELN-CDE                       02578447
           ELSE                                                         02578547
            MOVE XST00029-PRNT-GP-TYP-CDE TO XS022-PRNT-OV-STR-SELN-CDE 02578647
           END-IF.                                                      02578747
           IF PV-PRNT-STR-GP-CDE-IND EQUAL -1                           02578847
            INITIALIZE XS022-PRNT-OV-STR-GP-CDE                         02578947
           ELSE                                                         02579047
            MOVE XST00029-PRNT-STR-GP-CDE TO XS022-PRNT-OV-STR-GP-CDE   02579147
           END-IF.                                                      02579247
           IF PV-PRNT-STR-GP-ID-IND EQUAL -1                            02579347
            INITIALIZE XS022-PRNT-OV-STR-GP-ID                          02579447
           ELSE                                                         02579547
            MOVE XST00029-PRNT-STR-GP-ID  TO XS022-PRNT-OV-STR-GP-ID    02579647
           END-IF.                                                      02579747
           IF PV-PRNT-ADHC-GP-ID-IND EQUAL -1                           02579847
            INITIALIZE XS022-PRNT-ADHC-STR-GP-ID                        02579947
           ELSE                                                         02580047
            MOVE XST00029-PRNT-ADHC-GP-ID TO XS022-PRNT-ADHC-STR-GP-ID  02580147
           END-IF.                                                      02580247
           IF PV-ESL-TOPR-TYP-IND EQUAL -1                              02580347
            INITIALIZE XS022-ESL-TOPR-TYP-CDE                           02580447
           ELSE                                                         02580547
            MOVE XST00029-ESL-TOPR-TYP-CDE TO XS022-ESL-TOPR-TYP-CDE    02580647
           END-IF.                                                      02580747
           MOVE XST00029-PROMO-STRT-TMST   TO XS022-STRT-TMST.          02580847
           MOVE XST00029-PROMO-END-TMST    TO XS022-END-TMST.           02580947
           MOVE XST00029-ACTL-STRT-TMST    TO XS022-ACT-STRT-TMST.      02581047
           MOVE XST00029-ACTL-END-TMST     TO XS022-ACT-END-TMST.       02581147
           MOVE XST00029-SOR-LAST-UPD-TMST TO XS022-LAST-UPD-TMST.      02581247
           MOVE 120                        TO XS022-BUSINESS-EVNT-ID.   02581347
           MOVE 'U'                        TO XS022-ACTION-CDE.         02581447
                                                                        02581747
056900 2200-EXIT.                                                       02581847
           EXIT.                                                        02581947
043600 EJECT.                                                           02582047
038300*------------------------------------------------------           02582147
038400* 2210-FORMAT-ADHOC-FILE                                          02582247
038500*     FORMATS THE PROMO STORE GROUP COPY BOOK.                    02582347
038600*------------------------------------------------------           02582447
038700 2210-FORMAT-ADHOC-FILE.                                          02582547
           INITIALIZE XS022-PRICING-STR-GP-RECORD.                      02582647
           MOVE XST00031-PROMO-INTFC-ID    TO XS022-PROMO-INTFC-ID.     02582747
           MOVE XST00031-MDSE-LNE-ID       TO XS022-MDSE-LNE-ID.        02582847
           MOVE XST00031-ADHC-STR-GP-ID    TO XS022-ADHC-STR-GP-ID.     02582947
           MOVE XST00031-STR-SELN-HIER-CDE TO                           02583047
                XS022-STR-SELN-HIER-LVL-CDE                             02583147
           IF PV-PRIC-VER-IND EQUAL -1                                  02583247
            INITIALIZE  XS022-PROMO-PRIC-VER-ID                         02583347
           ELSE                                                         02583447
            MOVE XST00031-PROMO-PRIC-VER-ID TO XS022-PROMO-PRIC-VER-ID  02583547
           END-IF.                                                      02583647
           IF PV-ESL-TOPR-TYP-IND EQUAL -1                              02583747
            INITIALIZE XS022-ESL-TOPR-TYP-CDE                           02583847
           ELSE                                                         02583947
            MOVE XST00031-ESL-TOPR-TYP-CDE TO XS022-ESL-TOPR-TYP-CDE    02584047
           END-IF.                                                      02584147
           MOVE XST00031-STAT-CDE          TO XS022-STAT-CDE.           02584247
           MOVE XST00031-PROMO-STRT-TMST   TO XS022-STRT-TMST.          02584347
           MOVE XST00031-PROMO-END-TMST    TO XS022-END-TMST.           02584447
           MOVE XST00031-ACTL-STRT-TMST    TO XS022-ACT-STRT-TMST.      02584547
           MOVE XST00031-ACTL-END-TMST     TO XS022-ACT-END-TMST.       02584647
           MOVE XST00031-SOR-LAST-UPD-TMST TO XS022-LAST-UPD-TMST.      02584747
           MOVE 120                        TO XS022-BUSINESS-EVNT-ID.   02584847
           MOVE 'U'                        TO XS022-ACTION-CDE.         02584947
                                                                        02585247
056900 2210-EXIT.                                                       02585347
           EXIT.                                                        02585447
043600 EJECT.                                                           02585547
043700*------------------------------------------------------           02585647
043800* 3000-WRITE-EXTRACT-RECORD                                       02585747
043900*     WRITE EXTRACT FILE.                                         02585847
044000*------------------------------------------------------           02585947
044100 3000-WRITE-EXTRACT-RECORD.                                       02586047
           ADD 1 TO PV-RECORD-COUNT.                                    02586147
062300     WRITE EXTRACT-RECORD FROM XS022-PRICING-STR-GP-RECORD.       02586247
           INITIALIZE XS022-PRICING-STR-GP-RECORD.                      02586347
                                                                        02586447
047710 3000-EXIT.                                                       02586547
           EXIT.                                                        02586647
047800 EJECT.                                                           02586747
047810                                                                  02586847
056020                                                                  02591027
043700*------------------------------------------------------           02591127
043800* 4010-OPEN-STOREGP-CSR.                                          02591227
044000*------------------------------------------------------           02591327
044100 4010-OPEN-STOREGP-CSR.                                           02591427
072200     EXEC SQL                                                     02591527
072300         OPEN STOREGP                                             02591627
072400     END-EXEC.                                                    02591734
                                                                        02591827
055500     IF SQLCODE < 0                                               02591927
055600        DISPLAY 'OPEN FAILED FOR CURSOR STOREGP'                  02592027
055700         PERFORM U9980-SQL-ERROR                                  02592127
055800            THRU U9980-EXIT                                       02592227
           END-IF.                                                      02592327
055900                                                                  02592427
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02592527
056100           SQLWARN0 = 'W'                                         02592627
056200         DISPLAY 'OPEN WARNING FOR CURSOR STOREGP'                02592727
056300         PERFORM U9990-SQL-WARNING                                02592827
056400            THRU U9990-EXIT                                       02592927
           END-IF.                                                      02593027
                                                                        02593127
047710 4010-EXIT.                                                       02593227
           EXIT.                                                        02593327
056020                                                                  02593427
043700*------------------------------------------------------           02593527
043800* 4020-OPEN-ADHOC-CSR.                                            02593627
044000*------------------------------------------------------           02593727
044100 4020-OPEN-ADHOC-CSR.                                             02593827
                                                                        02593927
072200     EXEC SQL                                                     02594027
072300         OPEN ADHOC                                               02594127
072400     END-EXEC                                                     02594227
                                                                        02594327
055500     IF SQLCODE < 0                                               02594427
055600        DISPLAY 'OPEN FAILED FOR CURSOR ADHOC'                    02594527
055700         PERFORM U9980-SQL-ERROR                                  02594627
055800            THRU U9980-EXIT                                       02594727
           END-IF.                                                      02594827
055900                                                                  02594927
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02595027
056100           SQLWARN0 = 'W'                                         02595127
056200         DISPLAY 'OPEN WARNING FOR CURSOR STOREGP'                02595227
056300         PERFORM U9990-SQL-WARNING                                02595327
056400            THRU U9990-EXIT                                       02595427
           END-IF.                                                      02595527
                                                                        02595627
047710 4020-EXIT.                                                       02595727
           EXIT.                                                        02595827
056020                                                                  02595927
043700*------------------------------------------------------           02596027
043800* 4100-CLOSE-STOREGP-CSR.                                         02596127
043900*     CLOSE STORE GROUP CURSOR.                                   02596227
044000*------------------------------------------------------           02596327
044100 4100-CLOSE-STOREGP-CSR.                                          02596427
072200     EXEC SQL                                                     02596527
072300         CLOSE STOREGP                                            02596627
072400     END-EXEC                                                     02596727
                                                                        02596827
055500     IF SQLCODE < 0                                               02596927
055600        DISPLAY 'CLOSE FAILED FOR CURSOR STOREGP'                 02597027
055700         PERFORM U9980-SQL-ERROR                                  02597127
055800            THRU U9980-EXIT                                       02597227
           END-IF.                                                      02597327
055900                                                                  02597427
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02597527
056100           SQLWARN0 = 'W'                                         02597627
056200         DISPLAY 'CLOSE WARNING FOR CURSOR STOREGP'               02597727
056300         PERFORM U9990-SQL-WARNING                                02597827
056400            THRU U9990-EXIT                                       02597927
           END-IF.                                                      02598027
                                                                        02598127
047710 4100-EXIT.                                                       02598227
           EXIT.                                                        02598327
056020                                                                  02598427
043700*------------------------------------------------------           02598527
043800* 4110-CLOSE-ADHOC-CSR.                                           02598627
043900*     CLOSE ADHOC CURSOR.                                         02598727
044000*------------------------------------------------------           02598827
044100 4110-CLOSE-ADHOC-CSR.                                            02598927
072200     EXEC SQL                                                     02599027
072300         CLOSE ADHOC                                              02599127
072400     END-EXEC                                                     02599227
                                                                        02599327
055500     IF SQLCODE < 0                                               02599427
055600        DISPLAY 'CLOSE FAILED FOR CURSOR ADHOC'                   02599527
055700         PERFORM U9980-SQL-ERROR                                  02599627
055800            THRU U9980-EXIT                                       02599727
           END-IF.                                                      02599827
055900                                                                  02599927
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02600027
056100           SQLWARN0 = 'W'                                         02600127
056200         DISPLAY 'CLOSE WARNING FOR CURSOR ADHOC'                 02600227
056300         PERFORM U9990-SQL-WARNING                                02600327
056400            THRU U9990-EXIT                                       02600427
           END-IF.                                                      02600527
                                                                        02600627
047710 4110-EXIT.                                                       02600727
           EXIT.                                                        02600827
056020                                                                  02600927
059800*----------------------------------------------------------       02601027
073900 U9980-SQL-ERROR.                                                 02601127
059800*----------------------------------------------------------       02601227
074000                                                                  02601327
074100     MOVE SQLCODE    TO SQLCODE2.                                 02601427
074200     MOVE SQLERRD(3) TO SQLERRD3.                                 02601527
074300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02601627
074400     DISPLAY '** PROGRAM        ** = XSKUT033'.                   02601727
074500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02601827
074600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02601927
074700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02602027
074800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02602127
074900                                                                  02602227
075000     MOVE 4013 TO ABEND-CODE.                                     02602327
075100     CALL 'ILBOABN0' USING ABEND-CODE.                            02602427
075200                                                                  02602527
075300 U9980-EXIT.                                                      02602627
075400     EXIT.                                                        02602727
                                                                        02602827
059800*----------------------------------------------------------       02602927
075600 U9990-SQL-WARNING.                                               02603027
059800*----------------------------------------------------------       02603127
216300     MOVE SQLCODE    TO SQLCODE2.                                 02603227
216400     MOVE SQLERRD(3) TO SQLERRD3.                                 02603327
216500     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02603427
216600     DISPLAY '** PROGRAM        ** = PSKRP044'.                   02603527
216700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02603627
216800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02603727
216900     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  02603827
217000     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  02603927
217100     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  02604027
217200     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  02605027
217300     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  02606027
217400     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  02607027
217500     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  02608027
217600     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  02609027
077200                                                                  02610027
077300     MOVE 4013 TO ABEND-CODE.                                     02620027
077400     CALL 'ILBOABN0' USING ABEND-CODE.                            02630027
077500                                                                  02640027
077600 U9990-EXIT.                                                      02650027
077700     EXIT.                                                        02660027
                                                                        02670027
060100 9990-WRITE-RECORD-CNT.                                           02680027
           INITIALIZE XS022-PRICING-STR-GP-RECORD.                      02690027
           MOVE 120 TO PV-BUSINESS-EVNT-ID.                             02700027
           MOVE PV-RECORD-COUNT TO PV-TOTAL-NBR-OF-RECS.                02710027
           MOVE 'T' TO PV-ACTION-CDE.                                   02720027
062300     WRITE EXTRACT-RECORD FROM PV-TOTAL-RECORD.                   02730027
060710*9990-EXIT.                                                       02740027
                                                                        02750027
059800*----------------------------------------------------------       02760027
059900* 9999-WRAPUP.                                                    02770027
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           02780027
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           02790027
059930*     PROGRAM.                                                    02800027
060000*----------------------------------------------------------       02810027
*                                                                       02820027
060100 9999-WRAPUP.                                                     02830027
           CLOSE DATE-RANGE-FILE                                        02840027
                 TMST-FILE                                              02850027
                 EXTRACT-FILE.                                          02860027
060500                                                                  02920027
060710*9999-EXIT.                                                       02930027
060800 EJECT.                                                           02940027
060900                                                                  02950027
      ******************************************************************02960027
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *02970027
      ******************************************************************02980027
       Z910-ABEND.                                                      02990027
           DISPLAY '** ABEND           **'.                             03010027
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         03040027
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       03050027
                                                                        03060027
           CALL 'ILBOABN0' USING ABEND-CODE.                            03070027
