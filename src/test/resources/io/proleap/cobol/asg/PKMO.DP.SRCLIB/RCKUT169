000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              RCKUT169.                               00020000
000300 AUTHOR.                  DENISE HAHN.                            00030000
000400 DATE-WRITTEN.            MAY 2020.                               00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM READ IN AN INPUT FILE.                            *00080000
000900* THE 1ST RECORD IS "A" - CONTAINS SEASONAL SET YEAR & NAME      *00090000
000910* ONLY 1 'A' RECORD PER FILE                                     *00091000
000911* PROGRAM WILL VALIDATE THAT THE SET EXISTS ON "TSEASET". IF     *00091100
000912* IT DOES NOT, THEN  IT WILL ERROR OUT.                          *00091200
000913* ALL REMAINING ROWS ARE "B" - AND CONTAIN PO'S TO BE UPDATE TO  *00091300
000914* THAT SEASONAL SET.                                             *00091400
000915*   A RECORD:  AYYYY NNNNN     YYYY=SET YEAR NNNNN=SET NAME      *00091504
000916*   B RECORD:  BPPPPPPPPP      999999999 = 9 DIGIT PO NUMBER     *00091604
000917* ERROR PO'S WILL BE DISPLAYED:                                  *00091700
000918*      - VER_STAT_CDE ON TPURCHS <> 'A'                          *00091800
000919*      - PO ALREADY PART OF A DIFFERENT SEASONAL SET             *00091900
000920* PO'S NOT IN ERROR WILL BE WRITTEN TO OUTPUT FILE TO BE UPDATED *00092000
000921* BY RCKUP068.                                                   *00092100
000922******************************************************************00092200
000923 ENVIRONMENT DIVISION.                                            00092300
000924 CONFIGURATION SECTION.                                           00092400
000925                                                                  00092500
000926 INPUT-OUTPUT SECTION.                                            00092600
000927 FILE-CONTROL.                                                    00092700
000928                                                                  00092800
000929     SELECT INPUT-FILE                                            00092900
000930        ASSIGN TO INP01.                                          00093000
000931                                                                  00093100
000932     SELECT  OUTPUT-FILE                                          00093200
000933        ASSIGN TO OUT01.                                          00093300
000934                                                                  00093400
000935 DATA DIVISION.                                                   00093500
000940 FILE SECTION.                                                    00094000
000950                                                                  00095000
000960 FD  INPUT-FILE                                                   00096000
000970     RECORDING MODE IS F                                          00097000
000980     LABEL RECORDS ARE STANDARD                                   00098000
000990     RECORD CONTAINS 80 CHARACTERS                                00099006
001000     DATA RECORD IS INPUT-RECORD.                                 00100000
001100                                                                  00110000
001200 01  INPUT-RECORD                PIC X(80).                       00120006
001300                                                                  00130000
001400                                                                  00140000
001500 FD  OUTPUT-FILE                                                  00150000
001600     RECORDING MODE IS F                                          00160000
001700     LABEL RECORDS ARE STANDARD                                   00170000
001800     RECORD CONTAINS 80 CHARACTERS                                00180006
001900     DATA RECORD IS OUTPUT-RECORD.                                00190002
002000                                                                  00200000
002010 01  OUTPUT-RECORD               PIC X(80).                       00201006
002020                                                                  00202000
002030                                                                  00203000
002040 WORKING-STORAGE SECTION.                                         00204000
002050                                                                  00205000
002060                                                                  00206000
002070 01  PROGRAM-SWITCHES.                                            00207000
002080     05  PS-EOF-INPUT-SW             PIC  X(01)  VALUE 'N'.       00208000
002090         88  PS-EOF-INPUT                        VALUE 'Y'.       00209000
002100         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00210000
002200     05  PS-ERROR-SW                 PIC  X(01)  VALUE 'N'.       00220000
002300         88  PS-ERROR                            VALUE 'Y'.       00230000
002400         88  PS-ERROR-NO                         VALUE 'N'.       00240000
002800                                                                  00280000
003010                                                                  00301002
003020 01  PV-ABEND-FIELDS.                                             00302002
003030     05  PV-ABEND-PROGRAM            PIC X(8)   VALUE 'RCKUT169'. 00303002
003100     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00310000
003200                                                 COMP SYNC.       00320000
003300     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00330000
003400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00340000
003500     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00350000
003600     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00360000
003700     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00370000
003800     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00380000
003900     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00390000
004000     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00400000
004100     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00410000
004200     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00420000
004300                                                                  00430000
004400                                                                  00440000
004500*01  DK-DB2-KEYS.                                                 00450000
004600*    05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00460000
004610                                                                  00461000
004700 01  PROGRAM-VARIABLES.                                           00470000
004800     05  PV-INPUT-COUNT              PIC  9(09).                  00480000
004810     05  PV-ERROR-COUNT              PIC  9(09).                  00481000
004820     05  PV-OUTPUT-COUNT             PIC  9(09).                  00482000
004821     05  PV-DISP-COUNT               PIC ZZZ,ZZZ,ZZ9 VALUE ZEROS. 00482102
004822     05  PV-DISP-SQLCODE             PIC -999        VALUE ZEROS. 00482202
004830                                                                  00483000
005620 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00562000
005630     88 ABEND-4013                         VALUE +4013.           00563000
005640                                                                  00564000
005650***************************************************************** 00565000
005660*  INPUT FILE                                                   * 00566000
005661*   A RECORD:  AYYYY NNNNN     YYYY=SET YEAR NNNNN=SET NAME     * 00566104
005662*   B RECORD:  BPPPPPPPPP      999999999 = 9 DIGIT PO NUMBER    * 00566204
005670***************************************************************** 00567000
005679 01  INPUT-RECORD-LAYOUT.                                         00567900
005680     05 IR-RECORD-TYPE               PIC   X(01) VALUE SPACES.    00568000
005681        88 IR-SET-INFO                           VALUE 'A'.       00568100
005682        88 IR-PO-INFO                            VALUE 'B'.       00568200
005683     05 IR-RECORD                    PIC   X(79) VALUE SPACES.    00568306
005684     05 IR-SET-RECORD REDEFINES IR-RECORD.                        00568400
005685        10 IR-SEASET-YEAR            PIC   X(04).                 00568502
005686        10 FILLER                    PIC   X(01).                 00568602
005687        10 IR-SEASET-CODE            PIC   X(05).                 00568702
005688        10 FILLER                    PIC   X(69).                 00568806
005689     05 IR-PO-RECORD REDEFINES IR-RECORD.                         00568900
005690        10 IR-PO-NBR                 PIC   9(09).                 00569002
005720        10 FILLER                    PIC   X(70).                 00572006
005732                                                                  00573200
005930***************************************************************** 00593000
005940*    SQL ABEND ROUTINE WORKING STORAGE                          * 00594000
005950***************************************************************** 00595000
005960     COPY DPWS004.                                                00596000
005970                                                                  00597000
005980     EXEC SQL                                                     00598000
005990        INCLUDE TSEASET                                           00599000
006000     END-EXEC.                                                    00600000
006100                                                                  00610000
006200     EXEC SQL                                                     00620000
006300        INCLUDE TPURCHS                                           00630000
006400     END-EXEC.                                                    00640000
006500                                                                  00650000
006600***************************************************************** 00660000
010238*   DB2 SQL COMMUNICATION AREA                                    01023800
010239***************************************************************** 01023900
010240     EXEC SQL                                                     01024000
010241          INCLUDE SQLCA                                           01024100
010250     END-EXEC.                                                    01025000
010260                                                                  01026000
010270                                                                  01027000
010280******************************************************************01028000
010290 PROCEDURE DIVISION.                                              01029000
010300******************************************************************01030000
010400* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01040000
010500*      PROGRAM.                                                   01050000
010600******************************************************************01060000
010700 0000-PROGRAM-MAINLINE.                                           01070000
010800                                                                  01080000
010900     OPEN INPUT  INPUT-FILE                                       01090000
011000          OUTPUT OUTPUT-FILE.                                     01100000
011100                                                                  01110000
011101     SET PS-EOF-INPUT-NO                                          01110100
011102         PS-ERROR-NO      TO  TRUE                                01110200
011103                                                                  01110300
011110     PERFORM 1000-INITIALIZE.                                     01111000
011120                                                                  01112000
011130     IF  PS-ERROR-NO                                              01113000
011140         PERFORM 7000-READ-INPUT                                  01114000
011150     END-IF.                                                      01115000
011160                                                                  01116000
011170     IF  PS-ERROR-NO                                              01117000
011500         PERFORM 2000-PROCESS-INPUT                               01150000
011600           UNTIL PS-EOF-INPUT                                     01160000
011620     END-IF.                                                      01162000
011700                                                                  01170000
011710     DISPLAY ' '.                                                 01171008
011800     MOVE PV-INPUT-COUNT    TO  PV-DISP-COUNT.                    01180008
011810     DISPLAY ' INPUT COUNT: '   PV-DISP-COUNT.                    01181008
011900     MOVE PV-ERROR-COUNT    TO  PV-DISP-COUNT.                    01190008
011910     DISPLAY ' ERROR COUNT: '   PV-DISP-COUNT.                    01191008
012000     MOVE PV-OUTPUT-COUNT   TO  PV-DISP-COUNT.                    01200008
012100     DISPLAY ' OUTPUT COUNT:'   PV-DISP-COUNT.                    01210008
012200     DISPLAY ' '.                                                 01220009
012600                                                                  01260000
012700     CLOSE INPUT-FILE                                             01270000
012800           OUTPUT-FILE.                                           01280000
012900                                                                  01290000
013000     STOP RUN.                                                    01300000
013100                                                                  01310000
013101***********************************************************       01310100
013102*                                                         *       01310200
013103***********************************************************       01310300
013110 1000-INITIALIZE.                                                 01311000
013120                                                                  01312000
013122     PERFORM 7000-READ-INPUT.                                     01312200
013123                                                                  01312300
013124     IF  PS-EOF-INPUT                                             01312400
013125         SET PS-ERROR       TO  TRUE                              01312502
013126         DISPLAY 'NO INPUT FILE'                                  01312600
013127         ADD  1  TO  PV-ERROR-COUNT                               01312700
013128     ELSE                                                         01312800
013129         IF  IR-SET-INFO                                          01312900
013130             PERFORM 4000-VALIDATE-SET                            01313000
013131         ELSE                                                     01313100
013132             SET PS-ERROR       TO  TRUE                          01313202
013133             DISPLAY 'INVALID RECORD TYPE A:'                     01313300
013134                     INPUT-RECORD                                 01313400
013135             ADD  1  TO  PV-ERROR-COUNT                           01313500
013140         END-IF                                                   01314000
013141     END-IF.                                                      01314100
013142                                                                  01314200
013160                                                                  01316000
013200***********************************************************       01320000
013300*                                                         *       01330000
013400***********************************************************       01340000
013500 2000-PROCESS-INPUT.                                              01350000
013600                                                                  01360000
013610     IF  IR-PO-INFO                                               01361000
013620         PERFORM 4010-PO-NBR                                      01362000
013630     ELSE                                                         01363000
013640         SET PS-ERROR       TO  TRUE                              01364002
013650         DISPLAY 'INVALID RECORD TYPE B:'                         01365000
013660                 INPUT-RECORD                                     01366000
013670         ADD  1  TO  PV-ERROR-COUNT                               01367000
013680     END-IF.                                                      01368000
013690                                                                  01369000
013700     PERFORM 7000-READ-INPUT.                                     01370000
015200                                                                  01520000
015300                                                                  01530000
020801***********************************************************       02080100
020802*                                                         *       02080200
020803***********************************************************       02080300
020810 4000-VALIDATE-SET.                                               02081000
020811     MOVE IR-SEASET-YEAR  TO  SEASET-SEASET-YR.                   02081100
020813     MOVE IR-SEASET-CODE  TO  SEASET-SEASET-SHRT-NM.              02081300
020814                                                                  02081400
020815     EXEC SQL                                                     02081500
020816        SELECT SEASET_TYP_CDE                                     02081600
020817             , SEASET_NM                                          02081700
020818             , SEASET_STAT_CDE                                    02081800
020820          INTO :SEASET-SEASET-TYP-CDE                             02082000
020821             , :SEASET-SEASET-NM                                  02082100
020822             , :SEASET-SEASET-STAT-CDE                            02082200
020830          FROM TSEASET                                            02083000
020831         WHERE SEASET_YR       = :SEASET-SEASET-YR                02083100
020832           AND SEASET_SHRT_NM  = :SEASET-SEASET-SHRT-NM           02083200
020833     END-EXEC.                                                    02083300
020834                                                                  02083400
020835     EVALUATE TRUE                                                02083500
020836         WHEN SQLCODE = ZERO                                      02083600
020837              DISPLAY ' RCKUT169'                                 02083707
020838              DISPLAY ' '                                         02083807
020839              DISPLAY ' VALID SEASONAL SET:'                      02083907
020840                        SEASET-SEASET-YR      '-'                 02084007
020841                        SEASET-SEASET-SHRT-NM                     02084107
020842              DISPLAY ' TYPE:' SEASET-SEASET-TYP-CDE              02084207
020843              DISPLAY ' NAME:' SEASET-SEASET-NM                   02084307
020844              DISPLAY ' STAT:' SEASET-SEASET-STAT-CDE             02084407
020845              DISPLAY ' '                                         02084507
020846              PERFORM 8000-WRITE-OUTPUT                           02084607
020847                                                                  02084707
020848         WHEN SQLCODE = +100                                      02084800
020849              DISPLAY ' RCKUT169'                                 02084907
020850              DISPLAY ' '                                         02085007
020851              DISPLAY ' INVALID SEASONAL SET:'                    02085107
020852                        SEASET-SEASET-YR      '-'                 02085207
020853                        SEASET-SEASET-SHRT-NM                     02085307
020854              DISPLAY ' '                                         02085407
020855              SET PS-ERROR TO TRUE                                02085500
020856         WHEN OTHER                                               02085600
020857              MOVE SQLCODE  TO PV-DISP-SQLCODE                    02085700
020858              DISPLAY ' RCKUT169'                                 02085807
020859              DISPLAY ' '                                         02085907
020860              DISPLAY ' SQL-ERROR:'                               02086007
020861                        SEASET-SEASET-YR      '-'                 02086107
020862                        SEASET-SEASET-SHRT-NM                     02086207
020863              DISPLAY ' SQLCODE:' PV-DISP-SQLCODE                 02086307
020864              DISPLAY ' '                                         02086407
020865              SET PS-ERROR TO TRUE                                02086500
020866              MOVE '4000-VALIDATE-SET'  TO PV-ABEND-PARAGRAPH     02086600
020867              MOVE 'SELECT TSEASET'     TO PV-ABEND-OPERATION     02086700
020868              PERFORM 9900-DB2-ABEND                              02086800
020869     END-EVALUATE.                                                02086900
020870                                                                  02087000
020871                                                                  02087100
020872***********************************************************       02087200
020873*                                                         *       02087300
020874***********************************************************       02087400
020875 4010-PO-NBR.                                                     02087500
020876                                                                  02087600
020877     MOVE  IR-PO-NBR   TO  PURCHS-PO-NBR.                         02087700
020878                                                                  02087800
020879     EXEC SQL                                                     02087900
020881        SELECT SEASET_YR                                          02088100
020882             , SEASET_SHRT_NM                                     02088200
020884          INTO :PURCHS-SEASET-YR                                  02088400
020885             , :PURCHS-SEASET-SHRT-NM                             02088500
020886          FROM TPURCHS                                            02088600
020887         WHERE PO_NBR          = :PURCHS-PO-NBR                   02088700
020888           AND VER_STATUS_CDE  = 'A'                              02088801
020889     END-EXEC.                                                    02088900
020890                                                                  02089000
020891     EVALUATE TRUE                                                02089100
020892         WHEN SQLCODE = ZERO                                      02089200
020893              IF  PURCHS-SEASET-YR      > SPACES  OR              02089300
020894                  PURCHS-SEASET-SHRT-NM > SPACES                  02089400
020895                  DISPLAY ' ALREADY HAS SET INFO: '               02089507
020896                            IR-PO-NBR  ':'                        02089607
020897                            PURCHS-SEASET-YR  ' - '               02089707
020898                            PURCHS-SEASET-SHRT-NM                 02089807
020899                  DISPLAY ' '                                     02089907
020900                  ADD  +1 TO PV-ERROR-COUNT                       02090002
020901              ELSE                                                02090100
020902                  PERFORM 8000-WRITE-OUTPUT                       02090200
020903              END-IF                                              02090300
020904                                                                  02090400
020905         WHEN SQLCODE = +100                                      02090500
020906              DISPLAY ' INVALID PO NUMBER:        '               02090607
020907                        IR-RECORD                                 02090707
020908              DISPLAY ' '                                         02090807
020909              ADD  +1  TO  PV-ERROR-COUNT                         02090902
020910         WHEN OTHER                                               02091000
020911              MOVE SQLCODE  TO PV-DISP-SQLCODE                    02091100
020912              DISPLAY ' SQL-ERROR:                '               02091207
020913                        IR-RECORD                                 02091307
020914              DISPLAY ' SQLCODE:' PV-DISP-SQLCODE                 02091407
020915              DISPLAY ' '                                         02091507
020916              SET PS-ERROR TO TRUE                                02091600
020917              MOVE '4010-PO-NBR'        TO PV-ABEND-PARAGRAPH     02091701
020918              MOVE 'SELECT TPURCHS'     TO PV-ABEND-OPERATION     02091800
020919              PERFORM 9900-DB2-ABEND                              02091900
020920     END-EVALUATE.                                                02092000
020921                                                                  02092100
020922                                                                  02092200
020923***********************************************************       02092300
020924*                                                         *       02092400
020925***********************************************************       02092500
020926 7000-READ-INPUT.                                                 02092600
020927                                                                  02092702
020928     READ  INPUT-FILE                                             02092802
020929           INTO INPUT-RECORD-LAYOUT                               02092900
020930                AT END                                            02093000
020931                       SET PS-EOF-INPUT TO TRUE                   02093103
020932                NOT AT END                                        02093200
020933                       ADD +1  TO  PV-INPUT-COUNT.                02093302
020934                                                                  02093400
020935                                                                  02093500
020940***********************************************************       02094000
021000*                                                         *       02100000
021100***********************************************************       02110000
021200 8000-WRITE-OUTPUT.                                               02120000
021300                                                                  02130000
021310     WRITE OUTPUT-RECORD                                          02131002
021320           FROM INPUT-RECORD-LAYOUT.                              02132000
021360     ADD +1  TO  PV-OUTPUT-COUNT.                                 02136002
021370                                                                  02137002
021380                                                                  02138002
028489***********************************************************       02848900
028490*                                                         *       02849000
028500***********************************************************       02850000
028510 9900-DB2-ABEND.                                                  02851000
028520                                                                  02852000
028530     MOVE SQLCODE TO PV-SQLCODE.                                  02853000
028540     DISPLAY '*** DB2 ERROR '.                                    02854000
028550     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02855000
028560     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02856000
028570     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02857000
028580     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02858000
028590     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02859000
028600     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02860000
028700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02870000
028800                                                                  02880000
028900     COPY DPPD004.                                                02890000
029000                                                                  02900000
029100     IF SQLCODE NOT = -911                                        02910000
029200         EXEC SQL                                                 02920000
029300              ROLLBACK                                            02930000
029400         END-EXEC                                                 02940000
029500     END-IF.                                                      02950000
029510                                                                  02951000
029520     MOVE +4013                  TO PV-ABEND-CODE.                02952000
029530     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02953000
029540                                                                  02954000
