000120 IDENTIFICATION DIVISION.                                         00020001
000140 PROGRAM-ID.      WSKUT014.                                       00030001
000150 AUTHOR.          JEAN KURKOWSKI.                                 00040001
000160 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050001
000170 DATE-WRITTEN.    07-25-2007.                                     00060001
000180                                                                  00070001
000190***************************************************************** 00080001
000191*           COPY PIX ERROR QUEUE TO FILE                          00090001
000192***************************************************************** 00100001
000193*                         PIXFRWDERR                              00110001
000194*                       PROGRAM  LOGIC                            00120001
000195*                       --------------                            00130001
000196*  MAIN                                                           00140001
000197*  ----                                                           00150001
000198*                                                                 00160001
000199*   OPEN THE MESSAGE OUTPUT SEQUENTIAL FILE.                      00170001
000200*                                                                 00180001
000200*   GET THE QUEUE INFORMATION FROM THE CONSUMER QUEUE VIEW        00181025
000201*   CONNECT TO THE QUEUE MANAGER.                                 00190001
000202*   IF CONNECTION FAILED THEN                                     00200001
000203*            CALL 9000-DISPLAY-ERROR-MESSAGE AND EXIT             00210001
000204*                                                                 00220001
000205*   OPEN THE SPECIFIED MESSAGE QUEUE (MQOPEN).                    00230001
000206*   IF OPEN FAILED THEN                                           00240001
000207*            DISCONNECT FROM QUEUE MANAGER                        00250001
000208*            CALL 9000-DISPLAY-ERROR-MESSAGE AND EXIT             00260001
000209*   ENDIF.                                                        00270001
000210*                                                                 00280001
000212*   GET MESSAGES FROM QUEUE (MQGET)                               00300025
000213*   IF GET FAILED                                                 00310025
000214*            CALL 9000-DISPLAY-ERROR-MESSAGE                      00320025
000215*   ENDIF.                                                        00330025
000216*                                                                 00340001
000217*   WRITE MESSAGE TO OUTPUT SEQUENTIAL FILE.                      00350025
000218*                                                                 00360001
000219*   CLOSE THE MESSAGE QUEUE.                                      00370001
000220*   IF CLOSE FAILED THEN                                          00380001
000221*            CALL 9000-DISPLAY-ERROR-MESSAGE.                     00390001
000222*                                                                 00400001
000223*   DISCONNECT FROM THE QUEUE MANAGER.                            00410001
000224*   IF DISCONNECT FAILED THEN                                     00420001
000225*            CALL 9000-DISPLAY-ERROR-MESSAGE.                     00430001
000226*                                                                 00440001
000227*   CLOSE THE MESSAGE OUTPUT FILE.                                00450001
000228*                                                                 00460001
000228*   DISPLAY COUNTS.                                               00461025
000229*   EXIT PROGRAM.                                                 00470001
000230*                                                                 00480001
000231***************************************************************** 00490001
000233 ENVIRONMENT DIVISION.                                            00500001
000235                                                                  00510001
000236 CONFIGURATION SECTION.                                           00520001
000237                                                                  00530001
000238 SOURCE-COMPUTER.       IBM-3090.                                 00540001
000239 OBJECT-COMPUTER.       IBM-3090.                                 00550001
000240                                                                  00560001
000241 INPUT-OUTPUT SECTION.                                            00570001
000242                                                                  00580001
000243 FILE-CONTROL.                                                    00590001
000248     SELECT ERR-EXTRACT                                           00600001
000249            ASSIGN TO OUT01.                                      00610001
000250                                                                  00620001
000252 DATA DIVISION.                                                   00630001
000254 FILE SECTION.                                                    00640001
000255                                                                  00650001
000268 FD  ERR-EXTRACT                                                  00660001
000269     RECORDING MODE F                                             00670001
000270     BLOCK CONTAINS 0 RECORDS                                     00680001
000271     LABEL RECORDS ARE OMITTED.                                   00690001
000272 01  ERR-EXTRACT-RECORD               PIC X(1055).                00700010
000273                                                                  00710001
000275 WORKING-STORAGE SECTION.                                         00720001
000277                                                                  00730001
000284******************************************************************00740001
000285*  COMMUNICATIONS AREA FOR DB2                                    00750001
000286******************************************************************00760001
000287     EXEC SQL                                                     00770001
000288          INCLUDE SQLCA                                           00780001
000289     END-EXEC.                                                    00790001
000290                                                                  00800001
000291     COPY SQLCA2.                                                 00810001
000292                                                                  00820001
000293******************************************************************00830001
000294*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                     00840001
000295******************************************************************00850001
000296     COPY DPWS004.                                                00860001
000292                                                                  00861001
000297******************************************************************00870001
000298*  DB2 VIEW DECLARATION -                                         00880001
000299*      (WSV_CNSMR_QUE)  MQ INFO                                   00890001
000300******************************************************************00900001
000301     EXEC SQL                                                     00910001
000302          INCLUDE WSV00006                                        00920001
000303     END-EXEC.                                                    00930001
000304                                                                  00940001
000306     COPY WSRD014.                                                00960001
000306     COPY WSRD027.                                                00961010
000307                                                                  00970001
000319 01  WS-MQCONN               PIC X(8)  VALUE 'CSQBCONN'.          01090001
000320 01  WS-MQOPEN               PIC X(8)  VALUE 'CSQBOPEN'.          01100001
000321 01  WS-MQGET                PIC X(8)  VALUE 'CSQBGET'.           01110001
000322 01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQBCLOS'.          01120001
000323 01  WS-MQDISC               PIC X(8)  VALUE 'CSQBDISC'.          01130001
000324 01  WS-MQCMIT               PIC X(8)  VALUE 'CSQBCOMM'.          01140001
000325 01  WS-MQBACK               PIC X(8)  VALUE 'CSQBBACK'.          01150001
000326                                                                  01160001
000336*   PARAMETER VARIABLES                                           01260001
000337                                                                  01270001
000338 01  QM-NAME               PIC X(48).                             01280001
000339 01  QNAME                 PIC X(48).                             01290001
000340 01  PADCHAR               PIC X(1) VALUE '*'.                    01300001
000341 01  MSGBUFFER             pic X(5000) VALUE SPACES.              01310020
000343 01  MSGLENGTH             PIC S9(9) BINARY.                      01330001
000344 01  DATA-LENGTH           PIC S9(9) BINARY.                      01340001
000345 01  MQCHECK               PIC X(8) VALUE 'MQR2C'.                01350001
000346 01  MQ-REASON-TEXT        PIC X(30) VALUE SPACES.                01360001
000347 01  HOLD-REASON           PIC S9(9) BINARY.                      01370001
000348 01  HOLD-COMPLETION-CODE  PIC S9(9) BINARY.                      01380001
000349                                                                  01390001
000350*    API FIELDS                                                   01400001
000351                                                                  01410001
000352 01  HCONN                   PIC S9(9) BINARY VALUE 0.            01420001
000353 01  GQ-HANDLE               PIC S9(9) BINARY VALUE 0.            01430001
000354 01  OPEN-OPTIONS            PIC S9(9) BINARY.                    01440001
000355 01  COMPLETION-CODE         PIC S9(9) BINARY.                    01450001
000356 01  REASON                  PIC S9(9) BINARY.                    01460001
000357 01  CON-REASON              PIC S9(9) BINARY.                    01470001
000358                                                                  01480001
000359 01  PV-ABEND-VARIABLES.                                          01490001
000360     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.01500001
000361     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01510001
000362     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01520001
000363     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01530001
000364     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01540001
000365     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01550001
000366     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01560001
000367     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01570001
000368     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 01580001
000369     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 01590001
000370     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01600001
000371     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 01610001
000372     88  ABEND-4020-MQ-ERROR                         VALUE +4020. 01620001
000373     88  ABEND-4444-FORCED-ABEND                     VALUE +4444. 01630001
000375                                                                  01650001
000376 01  PE-MQ-ABEND-VARIABLES.                                       01660001
000377     10  PE-MQ-QMANAGER           PIC X(05) VALUE SPACES.         01670001
000378     10  PE-MQ-QNAME              PIC X(30) VALUE SPACES.         01680001
000379     10  PE-MQ-COMPLETION-CODE    PIC 9(04) VALUE ZEROS.          01690001
000380     10  PE-MQ-REASON-CODE        PIC 9(04) VALUE ZEROS.          01700001
000381                                                                  01710001
000382                                                                  01720001
000383*   API CONTROL BLOCKS                                            01730001
000384                                                                  01740001
000385 01  MQM-OBJECT-DESCRIPTOR.                                       01750001
000386     COPY CMQODV.                                                 01760001
000387 01  MQM-MESSAGE-DESCRIPTOR.                                      01770001
000388     COPY CMQMDV.                                                 01780001
000389 01  MQM-GET-MESSAGE-OPTIONS.                                     01790001
000390     COPY CMQGMOV.                                                01800001
000391                                                                  01810001
000392*    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01820001
000393*    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01830001
000394                                                                  01840001
000395 01  MQM-CONSTANTS.                                               01850001
000396     COPY CMQV.                                                   01860001
000397                                                                  01870001
000408                                                                  01980001
000395 01  PC-PROGRAM-CONSTANTS.                                        02011026
000413     05  PC-FIFTY-STARS            PIC X(50)  VALUE ALL '*'.      02020026
000311     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'WSKUT014'.   02021026
000414                                                                  02030001
000395 01  PA-PROGRAM-ACCUMULATORS.                                     02061026
000413     05  PA-ERROR-CNT              PIC 9(09)  VALUE ZERO.         02070026
000329     05  PA-NUMRECS                PIC 9(9)   VALUE ZEROS.        02071026
000330     05  PA-NUMGETS                PIC S9(9)  BINARY VALUE 0.     02072026
000331     05  PA-NUMPUTS                PIC 9(9)   VALUE ZEROS.        02073026
000332     05  PA-NUMCMTS                PIC 9(9)   VALUE ZEROS.        02074026
000414                                                                  02080024
000395 01  PV-PROGRAM-VARIABLES.                                        02084026
000312     05  PV-ERROR-MESSAGE          PIC X(48)  VALUE SPACES.       02110026
000334     05  PV-PARAGRAPH              PIC X(48)  VALUE SPACES.       02120026
000315                                                                  02130025
000425                                                                  02140001
000426* ------------------------------------------------------------- * 02150001
000427 PROCEDURE DIVISION.                                              02160001
000428* ------------------------------------------------------------- * 02170001
000429 0000-MAIN.                                                       02180001
000430                                                                  02190001
000465* -------------------------------------------------------------   02200001
000466*  OPEN OUTPUT MESSAGE SEQUENTIAL FILE                            02210001
000467* -------------------------------------------------------------   02220001
000468                                                                  02230001
000469     OPEN OUTPUT ERR-EXTRACT.                                     02240001
000470                                                                  02250001
000471     INITIALIZE ERR-EXTRACT-RECORD.                               02260001
000472                                                                  02270001
000473     PERFORM 7000-GET-MQ-INFO.                                    02280001
000474                                                                  02290001
000475* -------------------------------------------------------------   02300001
000476*  CONNECT TO THE QUEUE MANAGER                                   02310001
000477* -------------------------------------------------------------   02320001
000478     MOVE WSV00006-QUE-MGR-TEXT TO QM-NAME.                       02330022
000479     CALL WS-MQCONN USING QM-NAME                                 02340001
000480                         HCONN                                    02350001
000481                         COMPLETION-CODE                          02360001
000482                         REASON.                                  02370001
000483                                                                  02380001
000484* -------------------------------------------------------------   02390001
000485*    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE AND EXIT.    02400002
000487* -------------------------------------------------------------   02420001
000488                                                                  02430001
000489     MOVE REASON              TO CON-REASON.                      02440002
000490     IF (COMPLETION-CODE NOT = MQCC-OK)                           02450002
000491        MOVE 'MQCONN'         TO PV-ERROR-MESSAGE                 02460025
000492        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        02470001
000493        GO TO 4000-END-PROGRAM                                    02480001
000494     END-IF.                                                      02490001
000495     DISPLAY 'MQCONN SUCCESSFUL TO ', QM-NAME.                    02500001
000499                                                                  02501001
000496* -------------------------------------------------------------   02510001
000497*    OPEN THE QUEUE FOR INPUT                                     02520001
000498* -------------------------------------------------------------   02530001
000499                                                                  02540001
000500     COMPUTE OPEN-OPTIONS = MQOO-INPUT-SHARED +                   02550001
000501                            MQOO-FAIL-IF-QUIESCING.               02560001
000502     MOVE WSV00006-QUE-NM-TEXT TO MQOD-OBJECTNAME.                02570022
000503     MOVE QM-NAME              TO MQOD-OBJECTQMGRNAME.            02580022
000504                                                                  02590001
000505     CALL WS-MQOPEN USING HCONN                                   02600001
000506                         MQM-OBJECT-DESCRIPTOR                    02610001
000507                         OPEN-OPTIONS                             02620001
000508                         GQ-HANDLE                                02630001
000509                         COMPLETION-CODE                          02640001
000510                         REASON.                                  02650001
000499                                                                  02651001
000512* -------------------------------------------------------------   02660001
000513*    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    02670001
000514*    AND EXIT.                                                    02680001
000515* -------------------------------------------------------------   02690001
000517     IF (COMPLETION-CODE NOT = MQCC-OK)                           02700002
000518        MOVE 'MQOPEN'   TO PV-ERROR-MESSAGE                       02710025
000519        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        02720001
000520        GO TO 3000-DISCONNECT-QMGR                                02730001
000521     END-IF.                                                      02740001
000522     DISPLAY 'MQOPEN SUCCESSFUL'.                                 02750001
000523                                                                  02760001
000524     PERFORM 2000-MQGET-MSG.                                      02770001
000525                                                                  02780001
000526* -------------------------------------------------------------   02790001
000527*    CLOSE THE QUEUE                                              02800001
000528* -------------------------------------------------------------   02810001
000529                                                                  02820001
000530     CALL WS-MQCLOSE USING HCONN                                  02830001
000531                          GQ-HANDLE                               02840001
000532                          MQCO-NONE                               02850001
000533                          COMPLETION-CODE                         02860001
000534                          REASON.                                 02870001
000535     IF (COMPLETION-CODE NOT = MQCC-OK)                           02880002
000536        MOVE 'MQCLOSE'        TO PV-ERROR-MESSAGE                 02890025
000537        PERFORM 9000-DISPLAY-ERROR-MESSAGE                        02900001
000538     ELSE                                                         02910001
000539        DISPLAY 'MQCLOSE SUCCESSFUL'                              02920001
000540     END-IF.                                                      02930001
000541                                                                  02940001
000542     PERFORM 3000-DISCONNECT-QMGR.                                02950001
000543     GO TO 4000-END-PROGRAM.                                      02960001
000544                                                                  02970001
000545* -------------------------------------------------------------   02980001
000546* GET MESSAGES FROM THE QUEUE                                     02990001
000547* -------------------------------------------------------------   03000001
000548 2000-MQGET-MSG.                                                  03010001
000549                                                                  03020001
000550     PERFORM                                                      03030001
000551       UNTIL (COMPLETION-CODE IS EQUAL TO MQCC-FAILED)            03040001
000552         MOVE MQMI-NONE       TO MQMD-MSGID                       03050001
000553         MOVE MQCI-NONE       TO MQMD-CORRELID                    03060001
000553         MOVE MQFMT-STRING    TO MQMD-FORMAT                      03061020
000554         MOVE +1055           TO MSGLENGTH                        03070021
000555         COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +               03080001
000556                                  MQGMO-WAIT                      03090001
000557                                                                  03100001
000558         CALL WS-MQGET USING HCONN                                03110001
000559                            GQ-HANDLE                             03120001
000560                            MQM-MESSAGE-DESCRIPTOR                03130001
000561                            MQM-GET-MESSAGE-OPTIONS               03140001
000562                            MSGLENGTH                             03150001
000563                            MSGBUFFER                             03160001
000564                            DATA-LENGTH                           03170001
000565                            COMPLETION-CODE                       03180001
000566                            REASON                                03190001
000567                                                                  03200001
000567         EVALUATE TRUE                                            03201009
000567            WHEN COMPLETION-CODE = MQRC-NO-MSG-AVAILABLE          03202009
000567                CONTINUE                                          03203009
000570                                                                  03204009
000568*            IF GET FAILED THEN DISPLAY ERROR MESSAGE             03210009
000569*            AND BREAK OUT OF LOOP                                03220009
000567            WHEN COMPLETION-CODE NOT = MQCC-OK                    03231009
000572                MOVE 'MQGET'      TO PV-ERROR-MESSAGE             03250025
000573                PERFORM 9000-DISPLAY-ERROR-MESSAGE                03260009
000542                PERFORM 3000-DISCONNECT-QMGR                      03261009
000543                GO TO 4000-END-PROGRAM                            03262009
000570                                                                  03263009
000574            WHEN OTHER                                            03270009
000575                ADD 1 TO PA-NUMRECS                               03280024
000576                IF PA-NUMRECS > 1000                              03290024
000577                    PERFORM 3600-MQ-COMMIT                        03300001
000578                    MOVE ZERO TO PA-NUMRECS                       03310024
000579                END-IF                                            03320001
000580                ADD 1 TO PA-NUMGETS                               03330024
000581                PERFORM 8000-WRITE-EXTRACT-RECORD                 03340009
000582         END-EVALUATE                                             03350009
000583     END-PERFORM.                                                 03360001
000586                                                                  03370001
000587* ------------------------------------------------------------- * 03380001
000588* CLOSE AND DISCONNECT FROM THE MQ QUEUE MANAGER                  03390001
000589* ------------------------------------------------------------- * 03400001
000590 3000-DISCONNECT-QMGR.                                            03410001
000591                                                                  03420001
000592*    DISCONNECT FROM THE QUEUE MANAGER                            03430001
000593                                                                  03440001
000594     IF CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED         03450001
000595        CALL WS-MQDISC USING HCONN                                03460001
000596                            COMPLETION-CODE                       03470001
000597                            REASON                                03480001
000598        IF (COMPLETION-CODE NOT = MQCC-OK)                        03490002
000599           MOVE 'MQDISC'      TO PV-ERROR-MESSAGE                 03500025
000600           PERFORM 9000-DISPLAY-ERROR-MESSAGE                     03510001
000601        ELSE                                                      03520001
000602           DISPLAY 'MQDISC SUCCESSFUL'                            03530001
000603        END-IF                                                    03540001
000604     END-IF.                                                      03550001
000605                                                                  03560001
000606*    CLOSE THE MESSAGE EXTRACT OUTPUT FILE.                       03570001
000607                                                                  03580001
000608     CLOSE ERR-EXTRACT.                                           03590001
000609                                                                  03600001
000611******************************************************************03610001
000612*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        03620001
000613******************************************************************03630001
000614 3600-MQ-COMMIT.                                                  03640001
000615                                                                  03650001
000616     CALL WS-MQCMIT USING HCONN                                   03660001
000617                          COMPLETION-CODE                         03670001
000618                          REASON.                                 03680001
000619                                                                  03690001
000620     IF (COMPLETION-CODE NOT = MQCC-OK)                           03700001
000621         CALL MQCHECK USING REASON                                03710001
000622                               MQ-REASON-TEXT                     03720001
000623        MOVE '3600-COMMIT-MQ' TO PV-PARAGRAPH                     03730001
000624        MOVE 'MQCMIT ERROR'   TO PV-ERROR-MESSAGE                 03740025
000625        MOVE COMPLETION-CODE  TO HOLD-COMPLETION-CODE             03750001
000626        MOVE REASON           TO HOLD-REASON                      03760001
000627        PERFORM 3700-BACK-OUT-MQ                                  03770001
000628        MOVE HOLD-COMPLETION-CODE                                 03780001
000628                              TO COMPLETION-CODE                  03781001
000629                                 PE-MQ-COMPLETION-CODE            03790001
000630        MOVE HOLD-REASON      TO REASON                           03800001
000631                                 PE-MQ-REASON-CODE                03810001
000632        PERFORM 9200-MQ-ABEND                                     03820001
000633     ELSE                                                         03830001
000634        ADD +1                TO PA-NUMCMTS                       03840024
000635     END-IF.                                                      03850001
000636                                                                  03860001
000637******************************************************************03870001
000638* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       03880001
000639******************************************************************03890001
000640 3700-BACK-OUT-MQ.                                                03900001
000641                                                                  03910001
000642     CALL WS-MQBACK USING HCONN                                   03920001
000643                          COMPLETION-CODE                         03930001
000644                          REASON.                                 03940001
000645                                                                  03950001
000646     IF (COMPLETION-CODE NOT = MQCC-OK)                           03960002
000647         CALL MQCHECK USING REASON                                03970001
000648                            MQ-REASON-TEXT                        03980001
000649        MOVE '3700-BACK-OUT-MQ'  TO PV-PARAGRAPH                  03990001
000650        MOVE 'MQBACK ERROR'      TO PV-ERROR-MESSAGE              04000025
000651        PERFORM 9200-MQ-ABEND                                     04010001
000652     END-IF.                                                      04020001
000653******************************************************************04030001
000654                                                                  04040001
000655* ------------------------------------------------------------- * 04050001
000656* END THE PROGRAM                                                 04060001
000657* ------------------------------------------------------------- * 04070001
000658 4000-END-PROGRAM.                                                04080001
000659                                                                  04090001
000660*    DISPLAY THE NUMBER OF MESSAGES SUCCESSFULLY PUT              04100001
000661*    TO THE QUEUE                                                 04110001
000662                                                                  04120001
000663     DISPLAY PA-NUMGETS, ' MESSAGES READ FROM QUEUE'.             04130024
000664     DISPLAY PA-NUMPUTS, ' ERR MSGS PUT TO DISK    '.             04140024
000665     DISPLAY PA-NUMCMTS, ' NO. OF COMMITS TAKEN    '.             04150024
000666                                                                  04160001
000667     IF PA-ERROR-CNT > 0                                          04170024
000668        MOVE 4095             TO RETURN-CODE                      04180024
000669     END-IF.                                                      04190024
000670                                                                  04200001
000671     STOP RUN.                                                    04210001
000672                                                                  04220001
000673******************************************************************04230001
000674* GETS MQ INFO FROM WSV_CNSMR_QUE                                 04240001
000675******************************************************************04250001
000676 7000-GET-MQ-INFO.                                                04260001
000677                                                                  04270001
000683     EXEC SQL                                                     04330001
000684        SELECT QUE_MGR,                                           04340001
000685               QUE_NM                                             04350001
000686         INTO :WSV00006-QUE-MGR                                   04360001
000687             ,:WSV00006-QUE-NM                                    04370001
000688         FROM WSV_CNSMR_QUE                                       04380001
000689        WHERE APPL_FUNC_DESC  = 'PIXLEGACYQ'                      04390001
000690          AND INTGRTN_TYP_CDE = 'PIXFRWDERR'                      04400001
000691     END-EXEC.                                                    04410001
000692                                                                  04420001
000693     EVALUATE TRUE                                                04430001
000694         WHEN SQLCODE = 0                                         04440001
000694             DISPLAY 'WSV00006-QUE-MGR=' WSV00006-QUE-MGR-TEXT    04440122
000694             DISPLAY 'WSV00006-QUE-NM=' WSV00006-QUE-NM-TEXT      04440222
000694         WHEN SQLCODE = +100                                      04441001
000696             DISPLAY PC-CURRENT-PROGRAM-NAME                      04460004
000697                    ' - Q INFO MISSING FOR PIXLEGACYQ/PIXFRWDERR' 04470001
000698             MOVE 'Q INFO MISSING FOR PIXLEGACYQ/PIXFRWDERR'      04480004
000699                                     TO PV-ERROR-MESSAGE          04490001
000700             PERFORM 9200-MQ-ABEND                                04500004
000727                                                                  04770001
000728         WHEN OTHER                                               04780001
000729             MOVE SQLCODE TO SQLCODE2                             04790001
000730             DISPLAY '******************************************' 04800001
000731             DISPLAY '* ABEND                                   ' 04810001
000732             DISPLAY '* PROGRAM = WSKUT014                      ' 04820001
000733             DISPLAY '* PARAGRAPH = 7000-GET-MQ-INFO'             04830001
000734             DISPLAY '* GETTING RESTART WORKING STORAGE INFO    ' 04840001
000735             DISPLAY '** SQLCODE   = ' SQLCODE2                   04850001
000736             DISPLAY '******************************************' 04860001
000737             PERFORM 9100-SQL-ABEND                               04870001
000738     END-EVALUATE.                                                04880001
000740                                                                  04900001
000752* ------------------------------------------------------------- * 05020001
000753* WRITE THE ERROR MESSAGE QUEUE TO A SEQUENTIAL FILE.             05030001
000754* ------------------------------------------------------------- * 05040001
000755 8000-WRITE-EXTRACT-RECORD.                                       05050001
000756* ------------------------------------------------------------- * 05060001
000757*                                                                 05070001
000758     INITIALIZE ERR-EXTRACT-RECORD.                               05080001
000759     MOVE MSGBUFFER             TO WS027-RECEIPT-PIX-ERROR-REC.   05090010
000760     WRITE ERR-EXTRACT-RECORD FROM WS027-RECEIPT-PIX-ERROR-REC.   05100010
000761     ADD +1 TO PA-NUMPUTS.                                        05110024
000761                                                                  05110124
000761     IF WS027-CASE-SHPMT-ERR                                      05110224
000761         CONTINUE                                                 05110324
000761     ELSE                                                         05110424
000761         ADD +1 TO PA-ERROR-CNT                                   05110524
000761     END-IF.                                                      05110624
000757*                                                                 05111001
000757*                                                                 05112001
000763* ------------------------------------------------------------- * 05120001
000764* DISPLAY THE VALUES OF A FAILED MQ API COMMAND                   05130001
000765* ------------------------------------------------------------- * 05140001
000766 9000-DISPLAY-ERROR-MESSAGE.                                      05150001
000769     DISPLAY '************************************************'.  05160001
000770     DISPLAY '* ', PV-ERROR-MESSAGE.                              05170025
000771     DISPLAY '* COMPLETION CODE : ', COMPLETION-CODE.             05180001
000772     DISPLAY '* REASON CODE     : ', REASON.                      05190001
000773     DISPLAY '************************************************'.  05200001
000774*                                                                 05210001
000774*                                                                 05211001
000777******************************************************************05220001
000778* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      05230001
000779* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 05240001
000780******************************************************************05250001
000781 9100-SQL-ABEND.                                                  05260001
000782                                                                  05270001
000783* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05280001
000784* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05290001
000785* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05300001
000786* FORMAT                                                          05310001
000787     COPY DPPD004.                                                05320001
000788                                                                  05330001
000789     MOVE +4013               TO PV-ABEND-CODE.                   05340023
000790     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05350001
000791                                                                  05360001
000792****************************************************************  05370001
000793** PERFORM MQ-SERIES ABEND PROCESSING                             05380001
000794****************************************************************  05390001
000795 9200-MQ-ABEND.                                                   05400001
000796                                                                  05410001
000797     DISPLAY '**** ABEND *************************************'.  05420001
000798     DISPLAY '** MQSERIES ERROR **'.                              05430001
000799     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          05440001
000800     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    05450001
000801     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     05460001
000802     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 05470025
000803     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            05480001
000804     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                05490001
000805     DISPLAY '** RSN TEXT:   ', MQ-REASON-TEXT.                   05500001
000806                                                                  05510001
000807     MOVE +4013               TO PV-ABEND-CODE.                   05520001
000808     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05530001
000809                                                                  05540001
000810******************************************************************05550001
000811*                       END OF PROGRAM                            05560001
000900******************************************************************05570001
