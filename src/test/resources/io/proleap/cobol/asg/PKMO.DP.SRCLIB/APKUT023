000100 IDENTIFICATION DIVISION.                                         00010024
000200 PROGRAM-ID.     APKUT023.                                        00020024
000300 AUTHOR.         M WILKINSON.                                     00030024
000400*DATE-WRITTEN.   APRIL 23, 1996.                                  00040024
000500*DATE-COMPILED.                                                   00050024
000600*************************************************************     00060024
000700*    COBOL 2  WITH SQL                                      *     00070024
000800*                                                           *     00080024
000900*    DETERMINE DUE DATE FOR NON-MATCHES                     *     00090024
001000*                                                           *     00100024
001100*************************************************************     00110024
001200*                                                           *     00120024
001300*    TAPCNTL - ACCOUNTS PAYABLE CONTROL TABLE               *     00130024
001310*    TAPVNDS - ACCOUNTS PAYABLE VENDOR SPECIFICATIONS TABLE *     00131041
001400*                                                           *     00140024
001500* INPUT:                                                    *     00150024
001600* 1.  UNUSED INVOICES FOR BATCH MATCH FROM APKUT022         *     00160024
001700* 2.  UNUSED RECEIVING FOR BATCH MATCH FROM APKUT022        *     00170024
001800*                                                           *     00180024
001900* OUTPUT                                                    *     00190024
002000* 1.  UPDATED INVOICES WITH DUE DATES                       *     00200024
002100*                                                           *     00210024
002200*************************************************************     00220024
002300* CHANGE LOG:                                               *     00230024
002400*                                                           *     00240024
002500* 04/23/94    INITIAL VERSION.                              *     00250024
002600* 09/13/96    ENHANCED FOR VENDOR CONTROL FLEXIBILITY       *     00260024
002700*            -ADDED TAPVNDS                                 *     00270024
002800*            -ADDED WS VENDOR CONTROL SWITCH AND PREV-PO    *     00280024
002900*            -ADDED CONDITIONAL TESTING IN B100- TO PERFORM *     00290024
003000*             THE NEW R300- PARAGRAPH                       *     00300024
003100*            -DELETED THE STATEMENTS FROM H100- THAT POP-   *     00310024
003200*             ULATED THE CONTROL DAY FIELDS FROM TAPCNTL.   *     00320024
003300*            -ADDED R300 PARAGRAPH CHECK VENDOR CONTROLS    *     00330024
003400*            -DELETE RETRY LOGIC FOR TAPCNTL                *     00340024
003500*          CHANGED BY: PAM VOLK         WR#4074             *     00350024
003600*                                                           *     00360024
003700* 01/16/98    RECOMPILED DUE TO ADDITIONAL FIELD IN COPYBOOK*     00370024
003800*             APRD060.                                      *     00380024
003900*             BY:  MARK BURNSIDE        WR# 4164                  00390024
004000*                                                           *     00400024
004100* 06/11/98    Y2K. EXPAND JULIAN DATES TO INCLUDE CENTURY.  *     00410024
004200*   MADE BY:  CAROLYN GIFFORD                    WR# 6041   *     00420024
004300*                                                           *     00430024
004400* 08/24/99    REMOVE ALL JULIAN DATES.  APPD051 EXPANDED TO *     00440024
004500*             INCLUDE CENTURY.                              *     00450024
004600*   MADE BY:  L SCHALLHORN                       WR# 6041   *     00460024
004700*                                                           *     00470024
004800* 12/08/1999 JILL JUEL                   WR/IR #: WR6041    *     00480024
004900*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO    *     00490024
005000*              CONFORM WITH Y2K STANDARDS BY ADDING         *     00500024
005100*              DPG54-WARNING-ERROR.                         *     00510024
005200*                                                           *     00520024
005300* 05/16/2000 NANCY EILBES                WR/IR #: WR20704   *     00530024
005400*            CORRECTED A PROBLEM IN B400 WHERE THE DATE     *     00540024
005500*            COMPARISON WAS USING A DATE THAT WAS NEVER     *     00550024
005600*            POPULATED AND ANOTHER IN THE WRONG FORMAT.     *     00560024
005700*                                                           *     00570024
005800* 02/16/05  RECOMPILED DUE TO CHANGE TO COPYBOOK APRD021.   *     00580024
005900*           BY:  NANCY EILBES                    WR# 28327  *     00590024
006000*                                                           *     00600024
006100* DATE 10/02/2006                                           *     00610025
006200* CHANGE MADE: CHANGED THE CALCULATION FOR PAYMENT DUE DATE *     00620024
006300* (RECON DATE) BY ADDING THE EXTENDED DAY QUANTITY TO THE   *     00630024
006400* RECON CUTOFF QUANTITY BEFORE CALCULATING THE CUTOFF DATE. *     00640024
006500* MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR28705         *     00650024
006600*                                                           *     00660026
006700* DATE  03/11/2007                                          ***** 00670027
006800*     CHANGE MADE: MATCH BY DC PROJECT FOR PAYMENT DUE DATE     * 00680026
006900*     CHANGED ALL REFERENCES OF AP060-STR-NBR TO AP060-MTCH-LOC-* 00690026
007000*     NBR.  THIS WILL INSURE THAT THE FILE BUMP MATCH WILL STAY * 00700026
007100*     IN SYNC WITH THE ADDITION OF THE DC LEVEL MATCH.          * 00710026
007200*     MADE BY: MIKE BESKE              WR/IR #: WR21578         * 00720026
007210*                                                               * 00721032
007220* DATE  10/24/2007                                              * 00722045
007230*     CHANGE MADE: MATCH BY DC PROJECT PHASE II                 * 00723032
007232*     MODIFIED DUE DATE CALCULATION FOR EXACT MATCH.  THE       * 00723243
007234*     RECON CUTOFF DAY QUANTY WILL NOW BE USED FROM THE TAPVNDS * 00723442
007235*     TABLE IF A RECORD EXISTS AND HAS A VALUE > 0.  IF NOT     * 00723542
007236*     THEN IT WILL BE USED FROM THE TAPCNTL TABLE.              * 00723642
007270*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR32804         * 00727032
007280*                                                               * 00728046
007290* DATE  11/05/2007                                              * 00729049
007291*     CHANGE MADE: MATCH BY DC PROJECT PHASE II                 * 00729146
007292*     THE DUE DATE CALCULATION IS MODIFIED TO USE BOTH THE      * 00729246
007293*     FLOAT DAY QTY AND RECON CUTOFF DAY QUANTITY FROM TAPVNDS  * 00729346
007294*     IF A RECORD EXISTS OTHERWISE BOTH FROM TAPCNTL.           * 00729446
007295*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: INC000000143550 * 00729549
007280*                                                               * 00729650
007290* DATE  05/11/2021                                              * 00729761
007291*     CHANGE MADE: ADD SEPHORA LOGIC                            * 00729850
007295*     MADE BY: JEAN KURK               CHG0256545               * 00730261
007300***************************************************************** 00731026
007400                                                                  00740026
007500 ENVIRONMENT DIVISION.                                            00750026
007600                                                                  00760026
007700 INPUT-OUTPUT SECTION.                                            00770024
007800                                                                  00780024
007900 FILE-CONTROL.                                                    00790024
008000                                                                  00800024
008100     SELECT INVOICES-FILE ASSIGN         TO UT-S-INP01.           00810024
008200                                                                  00820024
008300     SELECT RECEIPTS-FILE ASSIGN         TO UT-S-INP02.           00830024
008400                                                                  00840024
008500      SELECT UPD-INVOICE-FILE ASSIGN     TO OUT01.                00850024
008600                                                                  00860024
008700 DATA DIVISION.                                                   00870024
008800                                                                  00880024
008900 FILE SECTION.                                                    00890024
009000                                                                  00900024
009100 FD  INVOICES-FILE                                                00910024
009200         LABEL RECORDS  ARE STANDARD                              00920024
009300         RECORDING MODE IS  F                                     00930024
009400         DATA RECORD    IS  INVOICE-RECORD.                       00940024
009500                                                                  00950024
009600 01  INVOICE-RECORD                PIC X(175).                    00960024
009700                                                                  00970024
009800 FD  RECEIPTS-FILE                                                00980024
009900         LABEL RECORDS  ARE STANDARD                              00990024
010000         RECORDING MODE IS  F                                     01000024
010100         DATA RECORD    IS  RECEIPT-RECORD.                       01010024
010200                                                                  01020024
010300 01  RECEIPT-RECORD                PIC X(090).                    01030024
010400                                                                  01040024
010500 FD  UPD-INVOICE-FILE                                             01050024
010600     RECORDING MODE IS F                                          01060024
010700     LABEL RECORDS ARE STANDARD                                   01070024
010800     BLOCK CONTAINS 0 RECORDS                                     01080024
010900     DATA RECORD IS UPD-INVOICE-RECORD.                           01090024
011000                                                                  01100024
011100 01  UPD-INVOICE-RECORD          PIC X(175).                      01110024
011200                                                                  01120024
011300/                                                                 01130024
011400 WORKING-STORAGE SECTION.                                         01140024
011500                                                                  01150024
011600 01  FILLER                        PIC X(25) VALUE                01160024
011700                             'WS FOR APKUT023 BEGINS==>'.         01170024
011800                                                                  01180024
011900 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01190024
012000                                             VALUE ZEROS.         01200024
012100     88 AP-EMPTY-FILE              VALUE +4005.                   01210024
012200     88 AP-DB2-ERROR               VALUE +4013.                   01220024
012300                                                                  01230024
012400 01  PROGRAM-CONSTANTS.                                           01240024
012500     05  PC-9S                     PIC 9(09) VALUE 999999999.     01250024
012600     05  PC-9S-COMP3               PIC S9(09)V99 COMP-3 VALUE     01260024
012700                                               +999999999.99.     01270024
012800                                                                  01280024
012900                                                                  01290024
013000                                                                  01300024
013100 01  PV-DATE                       PIC X(10) VALUE SPACES.        01310024
013200 01  PV-DATE-CCYY-MM-DD REDEFINES PV-DATE.                        01320024
013300     05 PV-DATE-CC                 PIC 9(02).                     01330024
013400     05 PV-DATE-YY                 PIC 9(02).                     01340024
013500     05 FILLER                     PIC X(01).                     01350024
013600     05 PV-DATE-MM                 PIC 9(02).                     01360024
013700     05 FILLER                     PIC X(01).                     01370024
013800     05 PV-DATE-DD                 PIC 9(02).                     01380024
013900 01  PV-DATE-INVOICE-INCR          PIC X(10) VALUE ZEROS.         01390024
014000 01  PV-DATE-RECEIPT-INCR          PIC X(10) VALUE ZEROS.         01400024
014100 01  PV-COMP-RECPT-INCR            PIC X(10) VALUE ZEROS.         01410024
014200                                                                  01420024
014300 01  PV-SAVE-RECEIPT-DATE.                                        01430024
014400     05  PV-SAVE-RECEIPT-DTE-YYYY  PIC X(04) VALUE SPACES.        01440024
014500     05  FILLER                    PIC X(01) VALUE SPACES.        01450024
014600     05  PV-SAVE-RECEIPT-DTE-MM    PIC X(02) VALUE SPACES.        01460024
014700     05  FILLER                    PIC X(01) VALUE SPACES.        01470024
014800     05  PV-SAVE-RECEIPT-DTE-DD    PIC X(02) VALUE SPACES.        01480024
014900                                                                  01490024
015100 01  PV-FLOAT-DAY-QTY-9            PIC 9(05) VALUE ZEROS.         01510024
015200 01  PV-EXC-FLOAT-DAY-QTY-9        PIC 9(05) VALUE ZEROS.         01520024
015300 01  PV-RCVG-VARN-DAY-QTY-9        PIC 9(05) VALUE ZEROS.         01530024
015400 01  PV-CALC-NEW-CTOFF-DAY-QTY     PIC 9(04) COMP.                01540024
015410 01  PV-RECN-CTOFF-DAY-QTY-9       PIC 9(05) VALUE ZEROS.         01541033
015500                                                                  01550024
015600 01  PV-PREV-ENT-ID                PIC S9(9) COMP                 01560024
015700                                             VALUE ZEROS.         01570024
015800 01  PV-SAVE-PO-NBR                PIC 9(09) VALUE ZEROS.         01580024
015900 01  PV-SAVE-STR-NBR               PIC 9(04) VALUE ZEROS.         01590024
016000                                                                  01600024
016100 01  PV-ABEND-FILEDS.                                             01610024
016200     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT023'. 01620024
016300     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     01630024
016400     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01640024
016500     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01650024
016600     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01660024
016700     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01670024
016800     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     01680024
016900                                                                  01690024
017000 01  PV-WORK-AREA.                                                01700024
017100     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKUT023'.  01710024
017200                                                                  01720024
017300*                                                                 01730024
017400 01  PV-PROGRAM-COUNTERS.                                         01740024
017500     05  PV-INVOICE-IN-REC-CNT   PIC 9(9)  VALUE ZEROS.           01750024
017600     05  PV-RECEIPT-IN-REC-CNT   PIC 9(9)  VALUE ZEROS.           01760024
017700     05  PV-UPD-INVOICE-REC-CNT  PIC 9(9)  VALUE ZEROS.           01770024
017800                                                                  01780024
017900 01  PV-SWITCHES.                                                 01790024
018000     05  END-OF-INVOICE-SW       PIC X(01) VALUE 'N'.             01800024
018100         88  END-OF-INVOICE                VALUE 'Y'.             01810024
018200                                                                  01820024
018300     05  END-OF-RECEIPT-SW       PIC X(01) VALUE 'N'.             01830024
018400         88  END-OF-RECEIPT                VALUE 'Y'.             01840024
018500                                                                  01850024
018600     05  END-OF-RECVR-PROC-SW    PIC X(01) VALUE 'N'.             01860024
018700         88  END-OF-RECVR-PROC             VALUE 'Y'.             01870024
018800         88  NOT-END-OF-RECVR-PROC         VALUE 'N'.             01880024
018900                                                                  01890024
019000     05  FIRST-RECV-DATE-SW      PIC X(01) VALUE 'N'.             01900024
019100         88  FIRST-RECEIVE-DATE            VALUE 'Y'.             01910024
019200         88  NOT-FIRST-RECEIVE-DATE        VALUE 'N'.             01920024
019300                                                                  01930024
019400     05  VENDOR-CONTROL-SW       PIC X(01) VALUE 'N'.             01940047
019500         88  VENDOR-CONTROLS               VALUE 'Y'.             01950047
019600         88  NO-VENDOR-CONTROLS            VALUE 'N'.             01960047
019740                                                                  01974028
019800     05  PS-TYPE-OF-DATE-PROCESS PIC X(01) VALUE ' '.             01980024
019900         88  PROCESS-INVC-FLOAT            VALUE '1'.             01990024
020000         88  PROCESS-COMPARE-DATES         VALUE '2'.             02000024
020100         88  PROCESS-EXCEPTION             VALUE '3'.             02010024
020200                                                                  02020024
020300 01  FILLER                      PIC X(35)  VALUE                 02030024
020400     'BEGINNING OF AP060 INPUT FILE    **'.                       02040024
020500     COPY APRD060.                                                02050024
020600                                                                  02060024
020700 01  FILLER                      PIC X(35)  VALUE                 02070024
020800     'BEGINNING OF AP021 INPUT FILE    **'.                       02080024
020900     COPY APRD021.                                                02090024
021000                                                                  02100024
021100     COPY DPWS004.                                                02110024
021200                                                                  02120024
021300     COPY APWS051.                                                02130024
021400                                                                  02140024
021500*----------------------------------------------------------------*02150024
021600*  WORKING STORAGE AREA FOR DPKUT500, DATE MANIPULATION ROUTINE  *02160024
021700*----------------------------------------------------------------*02170024
021800     COPY DPWS500.                                                02180024
021900 01  FILLER                      PIC X(35)  VALUE                 02190024
022000     'END OF AP WORK RECORD AREA       **'.                       02200024
022100                                                                  02210024
022200******************************************************************02220024
022300*  COMMUNICATIONS AREA2 FOR DB2                                   02230024
022400******************************************************************02240024
022500     COPY SQLCA2.                                                 02250024
022600                                                                  02260024
022700     EXEC SQL                                                     02270024
022800          INCLUDE SQLCA                                           02280024
022900     END-EXEC.                                                    02290024
023000                                                                  02300024
023100     EXEC SQL                                                     02310024
023200          INCLUDE TAPCNTL                                         02320024
023300     END-EXEC.                                                    02330024
023400                                                                  02340024
023500     EXEC SQL                                                     02350024
023600          INCLUDE TAPVNDS                                         02360024
023700     END-EXEC.                                                    02370024
023800                                                                  02380024
023900 01  FILLER                        PIC X(25) VALUE                02390024
024000          '<====PV FOR APKUT023 ENDS'.                            02400024
024100                                                                  02410024
024200*LINKAGE SECTION.                                                 02420024
024300                                                                  02430024
024400                                                                  02440024
024500 PROCEDURE DIVISION.                                              02450024
024600                                                                  02460024
024700 A100-MAINLINE.                                                   02470024
024800                                                                  02480024
024900     PERFORM H100-HOUSEKEEPING.                                   02490024
025000                                                                  02500024
025100     PERFORM B100-PROCESSING                                      02510024
025200        UNTIL END-OF-INVOICE.                                     02520024
025300                                                                  02530024
025400     PERFORM Z900-END-OF-JOB.                                     02540024
025500                                                                  02550024
025600     GOBACK.                                                      02560024
025700        EJECT                                                     02570024
025800                                                                  02580024
025900 B100-PROCESSING.                                                 02590024
026000*                                                                 02600024
026100***************************************************************** 02610024
026200*     BEFORE PROCESSING EACH PO CHECK FOR VENDOR CONTROL, THEN    02620024
026300*     PROCESS SELECTED RECEIVING TO DETERMINE WHICH DATE          02630024
026400*     ROUTINE TO SELECT                                           02640024
026500*     AFTER THE RECEIVING DATE IS DETERMINED - PROCESS EACH       02650024
026600*     INVOICE INDIVIDUALLY TO DETERMINE DATES TO USE              02660024
026700***************************************************************** 02670024
026800*                                                                 02680024
026900**** IF THE CURRENT ENT ID EQUALS THE PREV ENT ID THEN THERE      02690024
027000**** IS NO NEED TO CHECK VENDOR CONTROLS AGAIN.  IF IT IS A       02700024
027100**** DIFFERENT ENT ID THEN CHECK FOR VENDOR CONTROLS.             02710024
027200*                                                                 02720024
027300     IF AP060-ENT-ID         = PV-PREV-ENT-ID                     02730024
027400        CONTINUE                                                  02740024
027500     ELSE                                                         02750024
027600        SET NO-VENDOR-CONTROLS      TO TRUE                       02760047
027700        PERFORM R300-CHECK-VENDOR-CONTROLS                        02770047
027800        MOVE AP060-ENT-ID  TO  PV-PREV-ENT-ID                     02780024
027900     END-IF.                                                      02790024
028000                                                                  02800024
028100**** IF THERE ARE VENDOR CONTROLS SET UP THEN USE THEM            02810024
028200**** OTHERWISE USE THE DEFAULT VENDOR CONTROLS.                   02820024
028300****                                                              02830024
028400     IF VENDOR-CONTROLS                                           02840047
028500*        MOVE APVNDS-PAYT-FLOAT-DAY-QTY TO PV-FLOAT-DAY-QTY-9     02850050
028600         MOVE APVNDS-EXC-FLT-DAY-QTY    TO PV-EXC-FLOAT-DAY-QTY-9 02860024
028700         MOVE APVNDS-RCVG-VARN-DAY-QTY  TO PV-RCVG-VARN-DAY-QTY-9 02870024
028710*        MOVE APVNDS-RECN-CTOFF-DAY-QTY TO PV-RECN-CTOFF-DAY-QTY-902871050
032700                                                                  02872050
032700         IF AP060-SEPHORA-VND-YES                                 02872150
032700         AND AP060-SEPHORA-DPT-NO                                 02873050
032700            MOVE ZERO                   TO PV-FLOAT-DAY-QTY-9     02874051
032710            MOVE 9                      TO PV-RECN-CTOFF-DAY-QTY-902875051
032710         ELSE                                                     02876050
032700            MOVE APVNDS-PAYT-FLOAT-DAY-QTY                        02877050
032700                                        TO PV-FLOAT-DAY-QTY-9     02878051
032710            MOVE APVNDS-RECN-CTOFF-DAY-QTY                        02879050
032720                                        TO PV-RECN-CTOFF-DAY-QTY-902879151
032710         END-IF                                                   02879250
028800     ELSE                                                         02880024
028900         MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO PV-FLOAT-DAY-QTY-9     02890024
029000         MOVE APCNTL-EXC-FLT-DAY-QTY    TO PV-EXC-FLOAT-DAY-QTY-9 02900024
029100         MOVE APCNTL-RCVG-VARN-DAY-QTY  TO PV-RCVG-VARN-DAY-QTY-9 02910024
029110         MOVE APCNTL-RECN-CTOFF-DAY-QTY TO PV-RECN-CTOFF-DAY-QTY-902911047
029200     END-IF.                                                      02920024
029400                                                                  02940024
029500     IF AP060-PO-NBR         = AP021-PO-NBR             AND       02950024
029600        AP060-MTCH-LOC-NBR   = AP021-STR-NBR                      02960026
029700        SET NOT-END-OF-RECVR-PROC  TO TRUE                        02970024
029800        SET FIRST-RECEIVE-DATE     TO TRUE                        02980024
029900        SET PROCESS-COMPARE-DATES  TO TRUE                        02990024
030000        MOVE AP021-PO-NBR          TO PV-SAVE-PO-NBR              03000024
030100        MOVE AP021-STR-NBR         TO PV-SAVE-STR-NBR             03010024
030200*  IF THE FIRST RECEIVE RECORD IS A NON-INVOICED RECEIPT,         03020024
030300*  USE THE INVOICE PLUS FLOAT DAYS TO CALCULATE THE DUE DATE      03030024
030400        IF AP021-TYP-NIR                                          03040024
030500           SET PROCESS-INVC-FLOAT  TO TRUE                        03050024
030600           PERFORM R200-READ-AP021                                03060024
030700              UNTIL END-OF-RECEIPT          OR                    03070024
030800                   (AP021-PO-NBR  NOT = PV-SAVE-PO-NBR) OR        03080024
030900                   (AP021-PO-NBR      = PV-SAVE-PO-NBR AND        03090024
031000                    AP021-STR-NBR NOT = PV-SAVE-STR-NBR)          03100024
031100        ELSE                                                      03110024
031200           PERFORM B200-PROCESS-RECEIVE-DATES                     03120024
031300              UNTIL END-OF-RECEIPT          OR                    03130024
031400                    END-OF-RECVR-PROC                             03140024
031500        END-IF                                                    03150024
031600        EVALUATE TRUE                                             03160024
031700           WHEN  PROCESS-COMPARE-DATES                            03170024
031800                 PERFORM C100-PROCESS-COMPARE-DATES               03180024
031900                    UNTIL END-OF-INVOICE     OR                   03190024
032000                      (AP060-PO-NBR       NOT = PV-SAVE-PO-NBR) OR03200026
032100                      (AP060-PO-NBR           = PV-SAVE-PO-NBR AND03210026
032200                       AP060-MTCH-LOC-NBR NOT = PV-SAVE-STR-NBR)  03220026
032300           WHEN  PROCESS-EXCEPTION                                03230024
032400                 PERFORM C200-PROCESS-EXCEPTION                   03240024
032500                    UNTIL END-OF-INVOICE     OR                   03250024
032600                      (AP060-PO-NBR       NOT = PV-SAVE-PO-NBR) OR03260026
032700                      (AP060-PO-NBR           = PV-SAVE-PO-NBR AND03270026
032800                       AP060-MTCH-LOC-NBR NOT = PV-SAVE-STR-NBR)  03280026
032900           WHEN  PROCESS-INVC-FLOAT                               03290024
033000                 PERFORM C300-PROCESS-INVC-FLOAT                  03300024
033100                    UNTIL END-OF-INVOICE     OR                   03310024
033200                     (AP060-PO-NBR       NOT = PV-SAVE-PO-NBR) OR 03320026
033300                     (AP060-PO-NBR           = PV-SAVE-PO-NBR AND 03330026
033400                      AP060-MTCH-LOC-NBR NOT = PV-SAVE-STR-NBR)   03340026
033500        END-EVALUATE                                              03350024
033600     ELSE                                                         03360024
033700        IF AP060-PO-NBR      = AP021-PO-NBR                       03370024
033800           IF AP060-MTCH-LOC-NBR > AP021-STR-NBR                  03380026
033900              PERFORM R200-READ-AP021                             03390024
034000                 UNTIL END-OF-RECEIPT     OR                      03400024
034100                       (AP060-PO-NBR   NOT = AP021-PO-NBR) OR     03410024
034200                       (AP060-PO-NBR       = AP021-PO-NBR AND     03420024
034300                        AP060-MTCH-LOC-NBR <= AP021-STR-NBR)      03430026
034400           ELSE                                                   03440024
034500              PERFORM C300-PROCESS-INVC-FLOAT                     03450024
034600                 UNTIL END-OF-INVOICE     OR                      03460024
034700                      (AP060-PO-NBR   NOT = AP021-PO-NBR)  OR     03470024
034800                      (AP060-PO-NBR       = AP021-PO-NBR  AND     03480024
034900                       AP060-MTCH-LOC-NBR >= AP021-STR-NBR)       03490026
035000           END-IF                                                 03500024
035100        ELSE                                                      03510024
035200           IF AP060-PO-NBR > AP021-PO-NBR                         03520024
035300              PERFORM R200-READ-AP021                             03530024
035400                 UNTIL END-OF-RECEIPT     OR                      03540024
035500                       (AP060-PO-NBR     <= AP021-PO-NBR)         03550024
035600           ELSE                                                   03560024
035700              PERFORM C300-PROCESS-INVC-FLOAT                     03570024
035800                 UNTIL END-OF-INVOICE     OR                      03580024
035900                      (AP060-PO-NBR   >  PV-SAVE-PO-NBR)          03590024
036000                                                                  03600024
036100              MOVE AP060-PO-NBR    TO  PV-SAVE-PO-NBR             03610024
036200           END-IF                                                 03620024
036300        END-IF                                                    03630024
036400     END-IF.                                                      03640024
036500                                                                  03650024
036600 B200-PROCESS-RECEIVE-DATES.                                      03660024
036700*  READ THE RECEIVING FILE,                                       03670024
036800*   WHEN A NON-INVOICED RECEIPT RECORD IS FOUND, WE ARE PROCESSING03680024
036900*   A COMPARISON RECORD AND WE ARE DONE HERE                      03690024
037000*   WHEN A NEW PO-STORE RECEIPT RECORD IS FOUND, WE ARE PROCESSING03700024
037100*   A COMPARISON RECORD AND WE ARE DONE HERE                      03710024
037200*   WHEN OTHER, CHECK TO SEE IF THE CURRENT RECEIVE DATE IS MORE  03720024
037300*   THAN THE SAVED REC DATE PLUS APCNTL-RCV-SPAN-DAYS             03730024
037400*       IF THE RECEIVING DATE IS WITHIN THE SAVED REC DATE PLUS   03740024
037500*       APCNTL-RCV-SPAN-DAYS, CHECK NEXT RECORD                   03750024
037600*       IF THE RECEIVING DATE IS OUTSIDE THE SAVED REC DATE PLUS  03760024
037700*       APCNTL-RCV-SPAN-DAYS - WE ARE PROCESSING AN EXCEPTION AND 03770024
037800*       WE ARE DONE HERE                                          03780024
037900                                                                  03790024
038000     MOVE AP021-REC-DATE            TO PV-SAVE-RECEIPT-DATE.      03800024
038100                                                                  03810024
038200* THE FIRST RECEIVED DATE WILL BE KEPT TO BE THE COMPARISON DATE  03820024
038300* FOR THIS PO/STR COMBINATION.  THIS DATE MAY BE USED TO CALCULATE03830024
038400* PAYMENT DUE DATE.                                               03840024
038500     IF FIRST-RECEIVE-DATE                                        03850024
038600        PERFORM B400-CONVERT-RECV-TO-INCR                         03860024
038700        MOVE PV-DATE-RECEIPT-INCR   TO PV-COMP-RECPT-INCR         03870024
038800        SET  NOT-FIRST-RECEIVE-DATE TO TRUE                       03880024
038900     ELSE                                                         03890024
039000* THE COMP DATE FOR THIS COMPARISON MUST BE                       03900024
039100* RECEIVED DATE PLUS APCNTL-RCV-SPAN-DAYS                         03910024
039200        IF PV-SAVE-RECEIPT-DATE  >     PV-COMP-RECPT-INCR         03920024
039300           SET END-OF-RECVR-PROC    TO TRUE                       03930024
039400           SET PROCESS-EXCEPTION    TO TRUE                       03940024
039500        END-IF                                                    03950024
039600     END-IF.                                                      03960024
039700                                                                  03970024
039800     PERFORM R200-READ-AP021.                                     03980024
039900                                                                  03990024
040000     IF END-OF-RECEIPT                   OR                       04000024
040100       (AP021-PO-NBR  = PV-SAVE-PO-NBR  AND                       04010024
040200        AP021-STR-NBR = PV-SAVE-STR-NBR AND                       04020024
040300        NOT AP021-TYP-NIR)                                        04030024
040400        CONTINUE                                                  04040024
040500     ELSE                                                         04050024
040600        SET END-OF-RECVR-PROC        TO TRUE                      04060024
040700     END-IF.                                                      04070024
040800                                                                  04080024
040900 B400-CONVERT-RECV-TO-INCR.                                       04090024
041000                                                                  04100024
041100                                                                  04110024
041200     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04120024
041300                                                                  04130024
041400     SET DPG51-ACTUAL-CALENDAR-ONLY                               04140024
041500         DPG51-INCREMENT-DATE                                     04150024
041600         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      04160024
041700     MOVE SPACES                    TO DPG52-LK-DATE-INPUT.       04170024
041800     MOVE AP021-REC-DATE            TO DPG52-LK-DATE-INPUT.       04180024
041900     MOVE PV-RCVG-VARN-DAY-QTY-9    TO DPG51-INCR-DECR-DAYS-9.    04190024
042000                                                                  04200024
042100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04210024
042200         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04220024
042300                                                                  04230024
042400     IF (DPG54-WARNING-ERROR OR                                   04240024
042500         DPG54-SEVERE-ERROR)                                      04250024
042600        CONTINUE                                                  04260024
042700     ELSE                                                         04270024
042800        MOVE DPG55-DB2-ISO-DATE-FMT TO    PV-DATE-RECEIPT-INCR    04280024
042900     END-IF.                                                      04290024
043000                                                                  04300024
043100 B500-CONVERT-INVC-TO-FLOAT.                                      04310024
043200                                                                  04320024
043300**** USE THE FLOAT DAYS TO INCREASE DATE                          04330024
043400                                                                  04340024
043500     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04350024
043600                                                                  04360024
043700     SET DPG51-ACTUAL-CALENDAR-ONLY                               04370024
043800         DPG51-INCREMENT-DATE                                     04380024
043900         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      04390024
044000     MOVE SPACES                    TO DPG52-LK-DATE-INPUT.       04400024
044100     MOVE AP060-INVOICE-DATE        TO DPG52-LK-DATE-INPUT.       04410024
044200     MOVE PV-FLOAT-DAY-QTY-9        TO DPG51-INCR-DECR-DAYS-9.    04420024
044300                                                                  04430024
044400     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04440024
044500         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04450024
044600                                                                  04460024
044700     IF (DPG54-WARNING-ERROR OR                                   04470024
044800         DPG54-SEVERE-ERROR)                                      04480024
044900       CONTINUE                                                   04490024
045000     ELSE                                                         04500024
045100       MOVE DPG55-DB2-ISO-DATE-FMT  TO PV-DATE-INVOICE-INCR       04510024
045200     END-IF.                                                      04520024
045300                                                                  04530024
045400 C100-PROCESS-COMPARE-DATES.                                      04540024
045500                                                                  04550024
045600* DATE USED AS INPUT TO THE APPD051 DUE DATE CALCULATION MUST     04560024
045700* BE DATE WITHOUT FLOAT DAYS ADDED - FLOAT DAYS ARE ADDED IN      04570024
045800* THE EXECUTION OF APPD051....                                    04580024
045900* THE RECEIVED DATE TO BE USED FOR THE COMPARISON IS THE MOST     04590024
046000* CURRENT RECEIVED DATE                                           04600024
046100* THE INVOICE DATE TO BE USED FOR THE COMPARISON IS THE DATE      04610024
046200* PLUS THE PV-PAYT-FLOAT-DAY-QTY-9 (VENDOR OR DEFAULT DAYS)       04620024
046300* WHEN USING THE RECEIVE DATE FOR THE CALCULATION; BE SURE TO     04630024
046400* ZERO OUT THE FLOAT DAYS...                                      04640024
046500     PERFORM B500-CONVERT-INVC-TO-FLOAT.                          04650024
046600     IF PV-SAVE-RECEIPT-DATE           > PV-DATE-INVOICE-INCR     04660024
046700        MOVE PV-SAVE-RECEIPT-DATE     TO APPD051-INVOICE-DATE     04670024
046800        MOVE ZEROS                    TO APPD051-FLOAT-DAYS       04680024
046900        SET AP060-SRC-RECEIVER        TO TRUE                     04690024
047000     ELSE                                                         04700024
047100        MOVE AP060-INVOICE-DATE       TO APPD051-INVOICE-DATE     04710024
047200        MOVE PV-FLOAT-DAY-QTY-9       TO APPD051-FLOAT-DAYS       04720024
047300        SET AP060-SRC-INVOICE         TO TRUE.                    04730024
047400                                                                  04740024
047500     MOVE AP060-EOM-INDICATOR         TO APPD051-EOM-IND.         04750024
047600     MOVE AP060-TERMS-DUE-DAY-QTY     TO APPD051-DISCOUNT-DAYS.   04760024
047700     MOVE AP060-TERMS-EXT-DAY-QTY     TO APPD051-EXTENDED-DAYS.   04770024
047800                                                                  04780024
047900     PERFORM C400-DUE-DATE-ROUTINES.                              04790024
048000                                                                  04800024
048100     PERFORM W100-WRITE-UPD-INVOICE.                              04810024
048200                                                                  04820024
048300     PERFORM R100-READ-AP060.                                     04830024
048400                                                                  04840024
048500 C200-PROCESS-EXCEPTION.                                          04850024
048600                                                                  04860024
048700     MOVE AP060-INVOICE-DATE          TO APPD051-INVOICE-DATE     04870024
048800     MOVE PV-EXC-FLOAT-DAY-QTY-9      TO APPD051-FLOAT-DAYS.      04880024
048900     SET AP060-SRC-EXCEPTION          TO TRUE.                    04890024
049000                                                                  04900024
049100     MOVE AP060-EOM-INDICATOR         TO APPD051-EOM-IND.         04910024
049200     MOVE AP060-TERMS-DUE-DAY-QTY     TO APPD051-DISCOUNT-DAYS.   04920024
049300     MOVE AP060-TERMS-EXT-DAY-QTY     TO APPD051-EXTENDED-DAYS.   04930024
049400                                                                  04940024
049500     PERFORM C400-DUE-DATE-ROUTINES.                              04950024
049600                                                                  04960024
049700     PERFORM W100-WRITE-UPD-INVOICE.                              04970024
049800                                                                  04980024
049900     PERFORM R100-READ-AP060.                                     04990024
050000                                                                  05000024
050100 C300-PROCESS-INVC-FLOAT.                                         05010024
050200                                                                  05020024
050300     MOVE AP060-INVOICE-DATE          TO APPD051-INVOICE-DATE.    05030024
050400     MOVE PV-FLOAT-DAY-QTY-9          TO APPD051-FLOAT-DAYS.      05040024
050500     SET AP060-SRC-INVOICE            TO TRUE.                    05050024
050600                                                                  05060024
050700     MOVE AP060-EOM-INDICATOR         TO APPD051-EOM-IND.         05070024
050800     MOVE AP060-TERMS-DUE-DAY-QTY     TO APPD051-DISCOUNT-DAYS.   05080024
050900     MOVE AP060-TERMS-EXT-DAY-QTY     TO APPD051-EXTENDED-DAYS.   05090024
051000                                                                  05100024
051100     PERFORM C400-DUE-DATE-ROUTINES.                              05110024
051200                                                                  05120024
051300     PERFORM W100-WRITE-UPD-INVOICE.                              05130024
051400                                                                  05140024
051500     PERFORM R100-READ-AP060.                                     05150024
051600                                                                  05160024
051700 C400-DUE-DATE-ROUTINES.                                          05170024
051800                                                                  05180024
051900*  THIS RETURNS THE CALCULATED DUE DATE                           05190024
052000     PERFORM C500-CALC-DUE-DATE.                                  05200024
052100                                                                  05210024
052200*  DATE SHOULD BE SAVED AS YYYYMMDD                               05220024
052300     PERFORM C550-MOVE-DUE-DATE.                                  05230024
052400                                                                  05240024
052500*  THIS RETURNS THE CALCULATED CUTOFF DATE                        05250024
052600*  WHICH IS BASED ON THE CALULATED DUE DATE                       05260024
052700     PERFORM C600-CALC-CUTOFF-DATE.                               05270024
052800                                                                  05280024
052900*  DATE SHOULD BE SAVED AS YYYYMMDD                               05290024
053000     PERFORM C650-MOVE-CUTOFF-DATE.                               05300024
053100                                                                  05310024
053200 C500-CALC-DUE-DATE.                                              05320024
053300                                                                  05330024
053400     PERFORM CALC-PAYMENT-DUE-DATE.                               05340024
053500     COPY APPD051.                                                05350024
053600                                                                  05360024
053700 C550-MOVE-DUE-DATE.                                              05370024
053800                                                                  05380024
053900     MOVE APPD051-RET-DTE-MM          TO AP060-DUE-DATE(5:2).     05390024
054000     MOVE APPD051-RET-DTE-DD          TO AP060-DUE-DATE(7:2).     05400024
054100     MOVE APPD051-RET-DTE-YY          TO AP060-DUE-DATE(3:2).     05410024
054200     MOVE APPD051-RET-DTE-CC          TO AP060-DUE-DATE(1:2).     05420024
054300     MOVE APPD051-RETURN-DATE-CCYY-MM-DD TO PV-DATE.              05430024
054400                                                                  05440024
054500 C600-CALC-CUTOFF-DATE.                                           05450024
054600                                                                  05460024
054700     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05470024
054800                                                                  05480024
054900     SET DPG51-FISCAL-454-CALENDAR                                05490024
055000         DPG51-DECREMENT-DATE                                     05500024
055100         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05510024
055200                                                                  05520024
055230     COMPUTE PV-CALC-NEW-CTOFF-DAY-QTY =                          05523047
055240              PV-RECN-CTOFF-DAY-QTY-9 + AP060-TERMS-EXT-DAY-QTY.  05524047
055600                                                                  05560024
055700     MOVE PV-CALC-NEW-CTOFF-DAY-QTY TO DPG51-INCR-DECR-DAYS-9.    05570024
055800     MOVE PV-DATE                   TO DPG52-LK-DATE-INPUT.       05580024
055900                                                                  05590024
056000     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05600024
056100         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               05610024
056200                                                                  05620024
056300     IF (DPG54-WARNING-ERROR OR                                   05630024
056400         DPG54-SEVERE-ERROR)                                      05640024
056500         CONTINUE                                                 05650024
056600     ELSE                                                         05660024
056700         MOVE DPG55-DB2-ISO-DATE-FMT  TO                          05670024
056800               APPD051-RETURN-DATE-CCYY-MM-DD                     05680024
056900     END-IF.                                                      05690024
057000                                                                  05700024
057100 C650-MOVE-CUTOFF-DATE.                                           05710024
057200                                                                  05720024
057300     MOVE APPD051-RET-DTE-MM          TO AP060-CUTOFF-DATE(5:2).  05730024
057400     MOVE APPD051-RET-DTE-DD          TO AP060-CUTOFF-DATE(7:2).  05740024
057500     MOVE APPD051-RET-DTE-YY          TO AP060-CUTOFF-DATE(3:2).  05750024
057600     MOVE APPD051-RET-DTE-CC          TO AP060-CUTOFF-DATE(1:2).  05760024
057700                                                                  05770024
057800 H100-HOUSEKEEPING.                                               05780024
057900*                                                                 05790024
058000***************************************************************** 05800024
058100*    OPEN FILES                                                   05810024
058200***************************************************************** 05820024
058300*                                                                 05830024
058400     OPEN  INPUT   INVOICES-FILE                                  05840024
058500                   RECEIPTS-FILE                                  05850024
058600          OUTPUT   UPD-INVOICE-FILE.                              05860024
058700                                                                  05870024
058800     INITIALIZE    DCLTAPCNTL.                                    05880024
058900     INITIALIZE    DCLTAPVNDS.                                    05890024
059200                                                                  05920024
059300     EXEC SQL                                                     05930024
059400         SELECT                                                   05940024
059500             RECN_CTOFF_DAY_QTY                                   05950024
059600            ,PAYT_FLOAT_DAY_QTY                                   05960024
059700            ,EXC_FLT_DAY_QTY                                      05970024
059800            ,RCVG_VARN_DAY_QTY                                    05980024
059900            ,BTCH_PRC_DTE                                         05990024
060000         INTO                                                     06000024
060100             :APCNTL-RECN-CTOFF-DAY-QTY                           06010024
060200            ,:APCNTL-PAYT-FLOAT-DAY-QTY                           06020024
060300            ,:APCNTL-EXC-FLT-DAY-QTY                              06030024
060400            ,:APCNTL-RCVG-VARN-DAY-QTY                            06040024
060500            ,:APCNTL-BTCH-PRC-DTE                                 06050024
060600         FROM TAPCNTL                                             06060024
060700     END-EXEC.                                                    06070024
060800                                                                  06080024
060900     EVALUATE TRUE                                                06090024
061000         WHEN SQLCODE = ZERO                                      06100024
061100              CONTINUE                                            06110024
061200         WHEN SQLCODE NOT = ZERO                                  06120024
061300           MOVE 'H100- '              TO PV-ABEND-PARAGRAPH       06130024
061400           MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION       06140024
061500           MOVE 'TAPCNTL'             TO PV-ABEND-STRUCTURE-1     06150024
061600           MOVE SPACES                TO PV-ABEND-STRUCTURE-2     06160024
061700           PERFORM Z999-SQL-ERROR                                 06170024
061800     END-EVALUATE.                                                06180024
062100                                                                  06210024
062200     PERFORM R100-READ-AP060.                                     06220024
062300     PERFORM R200-READ-AP021.                                     06230024
062400                                                                  06240024
062500 R100-READ-AP060.                                                 06250024
062600*                                                                 06260024
062700***************************************************************** 06270024
062800*     READ THE SELECTED INVOICE FILE                              06280024
062900***************************************************************** 06290024
063000*                                                                 06300024
063100     IF NOT END-OF-INVOICE                                        06310024
063200        READ INVOICES-FILE INTO AP060-INVOICE-EXTRACT             06320024
063300          AT END  MOVE PC-9S         TO AP060-PO-NBR              06330024
063400                                        AP060-MTCH-LOC-NBR        06340026
063500                  MOVE PC-9S-COMP3   TO AP060-GROSS-COST-AMT      06350024
063600                  SET END-OF-INVOICE TO TRUE.                     06360024
063700                                                                  06370024
063800     IF NOT END-OF-INVOICE                                        06380024
063900        ADD 1 TO PV-INVOICE-IN-REC-CNT.                           06390024
064000                                                                  06400024
064100 R200-READ-AP021.                                                 06410024
064200*                                                                 06420024
064300***************************************************************** 06430024
064400*     READ THE RECEIVING FILE                                     06440024
064500***************************************************************** 06450024
064600*                                                                 06460024
064700     IF NOT END-OF-RECEIPT                                        06470024
064800        READ RECEIPTS-FILE INTO AP021-RECORD                      06480024
064900          AT END  MOVE PC-9S         TO AP021-PO-NBR              06490024
065000                                        AP021-STR-NBR             06500024
065100                  MOVE PC-9S-COMP3   TO AP021-REC-TOT-COST-AMT    06510024
065200                  SET END-OF-RECEIPT TO TRUE.                     06520024
065300                                                                  06530024
065400     IF NOT END-OF-RECEIPT                                        06540024
065500        ADD 1 TO PV-RECEIPT-IN-REC-CNT.                           06550024
065600                                                                  06560024
065700                                                                  06570024
065800 R300-CHECK-VENDOR-CONTROLS.                                      06580047
065900***************************************************************** 06590024
066000*     CHECK IF THIS VENDOR HAS CONTROLS DEFINED                   06600024
066100***************************************************************** 06610024
066200                                                                  06620024
066300     EXEC SQL                                                     06630024
066400         SELECT                                                   06640024
066500             PAYT_FLOAT_DAY_QTY                                   06650024
066600            ,EXC_FLT_DAY_QTY                                      06660024
066700            ,RCVG_VARN_DAY_QTY                                    06670024
066710            ,RECN_CTOFF_DAY_QTY                                   06671047
066800         INTO                                                     06680024
066900             :APVNDS-PAYT-FLOAT-DAY-QTY                           06690024
067000            ,:APVNDS-EXC-FLT-DAY-QTY                              06700024
067100            ,:APVNDS-RCVG-VARN-DAY-QTY                            06710024
067110            ,:APVNDS-RECN-CTOFF-DAY-QTY                           06711047
067200         FROM TAPVNDS AV                                          06720024
067300         WHERE AV.ENT_ID          = :AP060-ENT-ID                 06730024
067400           AND AV.VND_FLT_DAY_IND = 'V'                           06740024
067500     END-EXEC.                                                    06750024
067600                                                                  06760024
067700     EVALUATE TRUE                                                06770024
067800         WHEN SQLCODE = ZEROS                                     06780024
067900              SET VENDOR-CONTROLS         TO TRUE                 06790047
068000         WHEN SQLCODE = +100                                      06800024
068100              SET NO-VENDOR-CONTROLS      TO TRUE                 06810047
068200          WHEN OTHER                                              06820024
068300               MOVE 'R300- '              TO PV-ABEND-PARAGRAPH   06830024
068400               MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION   06840024
068500               MOVE 'TAPVNDS'             TO PV-ABEND-STRUCTURE-1 06850024
068600               MOVE SPACES                TO PV-ABEND-STRUCTURE-2 06860024
068700               PERFORM Z999-SQL-ERROR                             06870024
068800      END-EVALUATE.                                               06880024
069020                                                                  06902024
069100 W100-WRITE-UPD-INVOICE.                                          06910024
069200                                                                  06920024
069300*  DETERMINE IF THE PAYMENT DUE SWITCH SHOULD BE Y OR N           06930024
069400*  PROCESS YEAR GREATER THAN CUTOFF YEAR   OR                     06940024
069500     IF (APCNTL-BTCH-PRC-DTE(1:4)  > AP060-CUTOFF-DATE(1:4)) OR   06950024
069600                                                                  06960024
069700*  PROCESS YEAR SAME, PROCESS MONTH GREATER THAN CUTOFF MONTH OR  06970024
069800        (APCNTL-BTCH-PRC-DTE(1:4)  = AP060-CUTOFF-DATE(1:4) AND   06980024
069900         APCNTL-BTCH-PRC-DTE(6:2)  > AP060-CUTOFF-DATE(5:2)) OR   06990024
070000                                                                  07000024
070100*  PROCESS YEAR AND MONTH SAME, PROCESS DAY GREATER THAN OR EQUAL 07010024
070200*  TO THE CUTOFF DAY                                              07020024
070300        (APCNTL-BTCH-PRC-DTE(1:4)  = AP060-CUTOFF-DATE(1:4) AND   07030024
070400         APCNTL-BTCH-PRC-DTE(6:2)  = AP060-CUTOFF-DATE(5:2) AND   07040024
070500         APCNTL-BTCH-PRC-DTE(9:2) >= AP060-CUTOFF-DATE(7:2))      07050024
070600         SET AP060-PAYMENT-DUE TO TRUE                            07060024
070700     ELSE                                                         07070024
070800         SET AP060-PAYMENT-NOT-DUE TO TRUE.                       07080024
070900                                                                  07090024
071000     WRITE UPD-INVOICE-RECORD FROM AP060-INVOICE-EXTRACT.         07100024
071100     ADD 1 TO PV-UPD-INVOICE-REC-CNT.                             07110024
071200                                                                  07120024
071300 Z900-END-OF-JOB.                                                 07130024
071400*                                                                 07140024
071500***************************************************************** 07150034
071600*     CLOSE ALL FILES, REPORT ON NECESSARY TOTALS                 07160024
071700***************************************************************** 07170024
071800*                                                                 07180024
071900     DISPLAY '************************************************'.  07190024
072000     DISPLAY 'TOTAL INVOICES RECORDS READ    = '                  07200024
072100              PV-INVOICE-IN-REC-CNT                               07210024
072200     DISPLAY '************************************************'.  07220024
072300     DISPLAY 'TOTAL RECEIPTS RECORDS READ    = '                  07230024
072400              PV-RECEIPT-IN-REC-CNT                               07240024
072500     DISPLAY '************************************************'.  07250024
072600     DISPLAY 'TOTAL UPDATED INVOICE RECORDS  = '                  07260024
072700              PV-UPD-INVOICE-REC-CNT                              07270024
072800     DISPLAY '************************************************'.  07280024
072900                                                                  07290024
073000     CLOSE INVOICES-FILE                                          07300024
073100           RECEIPTS-FILE                                          07310024
073200           UPD-INVOICE-FILE.                                      07320024
073300                                                                  07330024
073400     IF   END-OF-INVOICE                                          07340024
073500          DISPLAY ' PROGRAM APKUT023 ENDS NORMALLY '              07350024
073600     ELSE                                                         07360024
073700          DISPLAY ' PROGRAM APKUT023 ENDS ABNORMALLY '            07370024
073800     END-IF.                                                      07380024
073900                                                                  07390024
074000 Z999-SQL-ERROR.                                                  07400024
074100*                                                                 07410024
074200***************************************************************** 07420024
074300*     PROCESS DB2 ABENDS                                          07430024
074400***************************************************************** 07440024
074500*                                                                 07450024
074600                                                                  07460024
074700     DISPLAY '*** DB2 ERROR '.                                    07470024
074800     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                 07480024
074900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 07490024
075000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               07500024
075100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               07510024
075200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             07520024
075300     IF PV-ABEND-STRUCTURE-2 > SPACES                             07530024
075400         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         07540024
075500                                                                  07550024
075600     COPY DPPD004.                                                07560024
075700     MOVE +4013                    TO ABEND-CODE.                 07570024
075800                                                                  07580024
075900     CALL 'ILBOABN0' USING ABEND-CODE.                            07590024
076000                                                                  07600024
