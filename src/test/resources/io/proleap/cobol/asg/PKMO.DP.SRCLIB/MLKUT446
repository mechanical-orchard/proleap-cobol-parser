000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.              MLKUT446.                               00030000
000400 AUTHOR.                  RONNA BUTZ.                             00040000
000500 INSTALLATION.            KOHLS DEPARTMENT STORES.                00050000
000600 DATE-WRITTEN.            08/16/99.                               00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*         WEEKLY ON ORDER INFORMATION FOR MERCHANDISE LEGDER      00100000
001100*                                                                 00110000
001200* THIS PROGRAM CREATES A WEEKLY EXTRACT OF PO ON ORDER            00120000
001300* INFORMATION.  THIS DATA CREATED IN THIS PROGRAM WILL BE USED    00130000
001400* TO UPDATE THE WEEKLY DEPARTMENT AND WEEKLY SUBCLASS TABLES.     00140000
001500*                                                                 00150000
001600* THE EXTRACTED DATA FROM THE INPUT FILE IS SPECIFICALLY          00160000
001700* FOR THE CURRENT FISCAL WEEK.                                    00170000
001800*                                                                 00180000
001900* INPUT FILES                                                     00190000
002000*   INP01 - CONTROL CARD FILE                                     00200000
002100*                                                                 00210000
002200*      A CONTROL CARD MAY BE USED TO OVERRIDE THE USE OF THE MAX  00220000
002300*      POSTING DATE. IF A CONTROL CARD IS USED, DATA WILL BE      00230000
002300*      EXTRACTED FROM THE BEGINNING OF THE FISCAL MONTH (INTO     00240000
002400*      WHICH THE CONTROL CARD DATE FALLS) THROUGH THE END OF THE  00250000
002500*      FISCAL MONTH.                                              00260000
002600*                                                                 00270000
002700*   INP02 - PO ON-ORDER EXTRACT FILE                              00280000
002800*                                                                 00290000
002900*      THIS FILE CONTAINS DATA ON-ORDER DATA FROM THECURRENT DATE 00300000
003000*      FORWARD.  THE DATA IN THIS FILE CONTAINS PAST DUE DATA.    00310000
003100*      THE IN DC DATE VALUE IS USED TO DETERMINE IF THE ORDER IS  00320000
003200*      PAST DUE.                                                  00330000
003300*                                                                 00340000
003400* OUTPUT FILES                                                    00350000
003500*                                                                 00360000
003600*   OUT01 - PO-ONORDER-EXTRACT-WK-FILE                            00370000
003700*                                                                 00380000
003800*      THIS FILE CONTAINS DATA FROM INP02 THAT HAS AN IN DC DATE  00390000
003900*      THAT FALLS WITHIN THE PROCESSING FISCAL MONTH.  RECORDS    00400000
004000*      THAT HAVE AN IN DC DATE THAT IS LESS THAN THE CURRENT      00410000
004100*      MONTH ARE CONSIDERED PAST DUE.                             00420000
004200*                                                                 00430000
004300*                                                                 00440000
004400*    WR/PITS#     DATE        DESCRIPTION                         00450000
004500*    --------   --------     ---------------------------------    00460000
004600*    WR10422    09/25/99     ADDED OUTPUT FILE TO HOLD FISCAL     00470000
004700*                            MONTH END DATE                       00480000
004800*                                                                 00490000
004900*               02/09/00     THE INPUT FILE IS NOW SORTED BY      00500000
005000*                            ITEM NUMBER AND IN DC DATE, SO ONLY  00510000
005100*                            GET THE FSCL MONTH END DATE OF THE   00520000
005200*                            IN DC DATE WHEN THE IN DC DATE       00530000
005300*                            CHANGES.                             00540000
005400*    WR20932    06/06/00     INCREASED ON-ORDER FILE TO 104 BYTES 00550000
005500*                                                                 00560000
005600* 12/17/01  RLB  NON-INTELLIGENT SKU                              00570000
005700*                TSK WILL BE GOING AWAY.  USE TSKXREF TO GET THE  00580000
005800*                DEPT AND CLASS FOR THE ITEM.                     00590000
005900*                                                                 00600000
006000*    WR21731    06/02/2003   RECOMPILE FOR ON-ORDER FILE CHANGES  00610000
006100*                            FOR NON-INTELLIGENT SKU  (LEE YANG)  00620000
006200*                                                                 00630000
006300*    WR26603    03/10/2004   CHANGE LRECL FROM 32 OT 50 FOR OUTPUT00640000
006400*                            1 TO REFLECT MLRD132 CHANGES.  ADDED 00650000
006500*                            WITH UR TO ALL SELECTS.              00660000
      *                                                                 00670000
006300*    WR21764    08/15/2004   MOVE ENT-ID FROM PORD018 TO          00680000
006400*                            MLRD132.  PASS FSCL-WK-NBR AND       00690000
006500*                            FSCL-WK-END-DTE TO MLRD132.  EXPAND  00700000
      *                            OUT01 TO 80 BYTES.  (ERIN SEARL)     00710000
      *    WR26006    05/23/2004   REMOVE STORE NUMBER CONVERSION       00720000
      *                            CODE.  RONNA                         00730000
MLCHGS*    W28582     10/27/2006   ADDED CALL TO PRICING MODULE TO GET  00740000
MLCHGS*                            DATALESS KEY.  ADDED ERROR FILE      00750000
MLCHGS*                            TO CONTAIN INPUT DATA IF BRAND       00760000
MLCHGS*                            VENDOR RELATIONSHIP IS NOT FOUND.    00770000
MLCHGS*                            T.WILLIAMS         LEGEND: MLCHGS    00780000
RONNAM*    W28582     02/19/2007   CHANGED NAME OF COPY BOOK FROM       00790000
RONNAM*                            MLKER01 TO MLRD446                   00800000
W28582*    W28582     03/05/2007   IF DBV RELATIONSHIP IS NOT FOUND,    00810000
W28582*                            DO NOT ABEND. WRITE TO ERROR FILE AND00820000
W28582*                            DISPLAY MESSAGE.                     00830000
MLCHGD*    W28582     03/31/2007   REPLACE CURRENT DATE WITH MLCNTL     00840000
MLCHGD*                            FSCL_WK_END_DTE AND USE XREF.DEPT    00850000
MLCHGD*                            INSTEAD OF PO018-DEPT-NBR            00860000
MLCHGD*                            S.JACKSON          LEGEND: MLCHGD    00870000
B28582*    B28582     04/18/2007   ADD DEPT / CLASS BYPASS LOGIC        00871000
B28582*                            SIMILAR TO MLK140/INK408             00872000
B28582*                            B.GRAHAM           LEGEND: B28582    00873000
J28582*    W28582     04/27/2007   IF DBV RELATIONSHIP IS NOT FOUND,    00874000
J28582*                            MOVE THE DKEY RETURNED FROM THE      00875000
J28582*                            PRICING MODULE TO THE OUTPUT FILE.   00876000
J28582*                            J.SELWITSCHKA      LEGEND: J28582    00877000
X28582* W28582  08-08-2007 R.JANSSEN   WKLY VND LVL DETAIL LEDGER       00877101
006600******************************************************************00878000
006700                                                                  00879000
006800                                                                  00880000
006900                                                                  00890000
007000 ENVIRONMENT DIVISION.                                            00900000
007100                                                                  00910000
007200                                                                  00920000
007300 CONFIGURATION SECTION.                                           00930000
007400                                                                  00940000
007500 SOURCE-COMPUTER. IBM-3090.                                       00950000
007600 OBJECT-COMPUTER. IBM-3090.                                       00960000
007700                                                                  00970000
007800                                                                  00980000
007900 INPUT-OUTPUT SECTION.                                            00990000
008000                                                                  01000000
008100 FILE-CONTROL.                                                    01010000
008200                                                                  01020000
008300     SELECT CONTROL-CARD-FILE                                     01030000
008400         ASSIGN TO INP01.                                         01040000
008500                                                                  01050000
008600     SELECT PO-ONORDER-EXTRACT-FILE                               01060000
008700         ASSIGN TO INP02.                                         01070000
B28582                                                                  01080000
B28582     SELECT  SKIP-CLASS-FILE                                      01090000
B28582         ASSIGN TO INP03.                                         01091000
B28582                                                                  01092000
008900     SELECT PO-ONORDER-EXTRACT-WK-FILE                            01093000
009000         ASSIGN TO OUT01.                                         01094000
009100                                                                  01095000
009200     SELECT LEDGER-EXTRACT-DATE-FILE                              01096000
009300         ASSIGN TO OUT02.                                         01097000
                                                                        01098000
MLCHGS     SELECT MLK446-ERROR-FILE                                     01099000
MLCHGS         ASSIGN TO OUT03.                                         01100000
B28582                                                                  01110000
B28582     SELECT BLOCKED-DEPT-CLASS-FILE                               01120000
B28582         ASSIGN TO OUT04.                                         01130000
                                                                        01140000
009400                                                                  01150000
009500 DATA DIVISION.                                                   01160000
009600                                                                  01170000
009700                                                                  01180000
009800 FILE SECTION.                                                    01190000
009900                                                                  01200000
010000 FD  CONTROL-CARD-FILE                                            01210000
010100     RECORDING MODE IS F                                          01220000
010200     LABEL RECORDS ARE STANDARD                                   01230000
010300     BLOCK CONTAINS 0 RECORDS.                                    01240000
010400                                                                  01250000
010500 01  CONTROL-CARD-RECORD              PIC X(80).                  01260000
010600                                                                  01270000
010700 FD  PO-ONORDER-EXTRACT-FILE                                      01280000
010800     RECORDING MODE IS F                                          01290000
010900     LABEL RECORDS ARE STANDARD                                   01300000
011000     BLOCK CONTAINS 0 RECORDS.                                    01310000
011100                                                                  01320000
011200 01  PO-ONORDER-EXTRACT-RECORD        PIC X(104).                 01330000
B28582                                                                  01340000
B28582 FD  SKIP-CLASS-FILE                                              01350000
B28582     RECORDING  MODE IS F                                         01360000
B28582     LABEL RECORDS ARE STANDARD                                   01370000
B28582     BLOCK CONTAINS 0 RECORDS.                                    01371000
B28582 01  SKIP-CLASS-REC                   PIC X(80).                  01372000
011300                                                                  01373000
011400 FD  PO-ONORDER-EXTRACT-WK-FILE                                   01374000
011500     RECORDING MODE IS F                                          01375000
011600     LABEL RECORDS ARE STANDARD                                   01376000
011700     BLOCK CONTAINS 0 RECORDS.                                    01377000
011800                                                                  01378000
011900 01  PO-ONORDER-EXTRACT-WK-RECORD     PIC X(80).                  01379000
012000                                                                  01380000
012100 FD  LEDGER-EXTRACT-DATE-FILE                                     01390000
012200     RECORDING MODE IS F                                          01400000
012300     LABEL RECORDS ARE STANDARD                                   01410000
012400     BLOCK CONTAINS 0 RECORDS.                                    01420000
012500                                                                  01430000
012600 01  LEDGER-EXTRACT-DATE-RECORD       PIC X(80).                  01440000
                                                                        01450000
MLCHGS FD  MLK446-ERROR-FILE                                            01460000
MLCHGS     LABEL RECORDS ARE STANDARD                                   01470000
MLCHGS     RECORDING MODE IS F                                          01480000
MLCHGS     BLOCK CONTAINS 0 RECORDS                                     01490000
MLCHGS     RECORD CONTAINS 104 CHARACTERS                               01500000
MLCHGS     DATA RECORD IS MLK446-ERROR-WK-RECORD.                       01510000
MLCHGS                                                                  01520000
MLCHGS 01  MLK446-ERROR-WK-RECORD           PIC X(104).                 01530000
B28582                                                                  01540000
B28582 FD  BLOCKED-DEPT-CLASS-FILE                                      01550000
B28582     LABEL RECORDS ARE STANDARD                                   01560000
B28582     RECORDING MODE IS F                                          01570000
B28582     BLOCK CONTAINS 0 RECORDS.                                    01580000
B28582 01  BLOCKED-DEPT-CLASS-REC          PIC X(80).                   01590000
012700                                                                  01600000
012800 WORKING-STORAGE SECTION.                                         01610000
012900                                                                  01620000
013000****************************************************************  01630000
013100* RECORD LAYOUT FOR INPUT FILE - PO ON-ORDER FILE                 01640000
013200****************************************************************  01650000
013300                                                                  01660000
013400     COPY PORD018.                                                01670000
013500                                                                  01680000
013600****************************************************************  01690000
013700* RECORD LAYOUT FOR OUTPUT LOAD FILE - WEEKLY PO ORDER FILE       01700000
013800****************************************************************  01710000
013900                                                                  01720000
014000     COPY MLRD132.                                                01730000
014100                                                                  01740000
014200****************************************************************  01750000
014300* RECORD LAYOUT FOR OUTPUT DATE FILE - FISCAL MONTH END DATE      01760000
014400****************************************************************  01770000
014500                                                                  01780000
014600     COPY MLRD135.                                                01790000
                                                                        01800000
MLCHGS****************************************************************  01810000
MLCHGS* RECORD LAYOUT FOR ERROR FILE                                    01820000
MLCHGS****************************************************************  01830000
MLCHGS                                                                  01840000
RONNAM     COPY MLRD446.                                                01850000
014700                                                                  01860000
MLCHGS***************************************************************** 01870000
MLCHGS*    DECLARATIONS FOR COMMON PRICING MODULE INPD400             * 01880000
MLCHGS***************************************************************** 01890000
MLCHGS                                                                  01900000
MLCHGS     COPY INWS400.                                                01910000
                                                                        01920000
014800****************************************************************  01930000
014900*  ERROR MESSAGE AREA FOR DB2                                     01940000
015000****************************************************************  01950000
015100                                                                  01960000
015200     COPY DPWS004.                                                01970000
015300                                                                  01980000
015400 01  CC-CONTROL-CARD.                                             01990000
015500     05  CC-EXTRACT-DTE               PIC X(10).                  02000000
015600     05  FILLER                       PIC X(70).                  02010000
015700                                                                  02020000
015800 01  PC-PROGRAM-CONSTANTS.                                        02030000
015900     05  PC-Y                         PIC X(01)  VALUE 'Y'.       02040000
016000                                                                  02050000
016100 01  PS-PROGRAM-SWITCHES.                                         02060000
016200     05  PS-END-OF-CONTROL-CARDS-SW   PIC X      VALUE 'N'.       02070000
016300         88  PS-END-OF-CONTROL-CARDS             VALUE 'Y'.       02080000
016400     05  PS-END-OF-ONORDER-FILE-SW    PIC X      VALUE 'N'.       02090000
016500         88  PS-END-OF-ONORDER-FILE              VALUE 'Y'.       02100000
016600     05  PS-DATE-FOUND-SW             PIC X      VALUE 'N'.       02110000
016700         88  PS-DATE-FOUND                       VALUE 'Y'.       02120000
016800         88  PS-DATE-NOT-FOUND                   VALUE 'N'.       02130000
016900     05  PS-ITEM-FOUND-SW             PIC X      VALUE 'N'.       02140000
017000         88  PS-ITEM-FOUND                       VALUE 'Y'.       02150000
017100         88  PS-ITEM-NOT-FOUND                   VALUE 'N'.       02160000
017200     05  PS-DATES-FOUND-SW            PIC X      VALUE 'N'.       02170000
017300         88  PS-DATES-FOUND                      VALUE 'Y'.       02180000
017400         88  PS-DATES-NOT-FOUND                  VALUE 'N'.       02190000
B28582     05  END-OF-SKIP-CLASS-IND        PIC X      VALUE 'N'.       02200000
B28582         88  END-OF-SKIP-CLASS                   VALUE 'Y'.       02201000
B28582     05  PS-DEPT-CLASS-BLOCKED-SW     PIC X      VALUE 'N'.       02202000
B28582         88  PS-DEPT-CLASS-BLOCKED-NO            VALUE 'N'.       02203000
B28582         88  PS-DEPT-CLASS-BLOCKED-YES           VALUE 'Y'.       02204000
017500                                                                  02205000
017600 01  PV-PROGRAM-VARIABLES.                                        02206000
017800     05  PV-SAVE-ONORD-ITEM-NBR       PIC S9(15)V COMP-3          02207000
017900                                                 VALUE ZERO.      02208000
MLCHGS     05  PV-SAVE-DEPT-NBR             PIC X(03)  VALUE SPACES.    02209000
MLCHGS     05  PV-SAVE-ENT-ID               PIC S9(9)   COMP            02210000
MLCHGS                                                 VALUE ZEROS.     02220000
MLCHGS     05  PV-HOLD-ML-LWST-ID           PIC S9(9)   COMP            02230000
MLCHGS                                                 VALUE ZEROS.     02240000
018000     05  PV-SAVE-IN-DC-DATE           PIC X(10)  VALUE SPACE.     02250000
018100     05  PV-EXT-RTL-AMT               PIC S9(9)V99 COMP-3.        02260000
018200     05  PV-EXT-CST-AMT               PIC S9(9)V99 COMP-3.        02270000
018300     05  PV-DB2-OPER-ATTEMPTED        PIC X(30).                  02280000
018400     05  PV-PARAGRAPH-NAME            PIC X(30).                  02290000
018500     05  PV-READ-CNT                  PIC S9(15) COMP-3           02300000
018600                                                 VALUE ZERO.      02310000
018700     05  PV-ERROR-CNT                 PIC S9(15) COMP-3           02320000
018800                                                 VALUE ZERO.      02330000
018900     05  PV-WRITE-CNT                 PIC S9(15) COMP-3           02340000
019000                                                 VALUE ZERO.      02350000
019100     05  PV-DROP-CNT                  PIC S9(15) COMP-3           02360000
019200                                                 VALUE ZERO.      02370000
019100     05  PV-DEPT-CLASS-BLOCKED-CNT    PIC S9(15) COMP-3           02380000
019200                                                 VALUE ZERO.      02390000
019300     05  PV-FSCL-YR-NBR               PIC X(04)  VALUE SPACE.     02400000
019400     05  PV-FSCL-WK-NBR               PIC X(04)  VALUE SPACE.     02410000
019500     05  PV-FSCL-WK-BEG-DTE           PIC X(10)  VALUE SPACES.    02420000
019500     05  PV-FSCL-WK-END-DTE           PIC X(10)  VALUE SPACES.    02430000
019600     05  PV-FSCL-MN-BEG-DTE           PIC X(10)  VALUE SPACES.    02440000
019700     05  PV-FSCL-MN-END-DTE           PIC X(10)  VALUE SPACES.    02450000
019800     05  PV-SKXREF-DEPT-C             PIC X(03)  VALUE SPACES.    02460000
019900     05  PV-SKXREF-SUBCLASS-C         PIC X(02)  VALUE SPACES.    02470000
MLCHGS     05  PV-CURRENT-DATE              PIC X(10)  VALUE SPACES.    02480000
MLCHGS     05  PV-DEPT-NBR                  PIC 9(03)  VALUE ZEROES.    02490000
B28582     05  PV-PO-NBR                    PIC 9(09)  VALUE ZEROES.    02500000
020000                                                                  02510000
020100 01  SS-SUBSCRIPTS.                                               02520000
020200     05  SS-FSCL-MN                   PIC S9(04) COMP SYNC        02530000
020300                                                 VALUE ZERO.      02540000
020400 01  ABEND-CODE                       PIC S9(04) COMP             02550000
020500                                                 VALUE ZERO.      02560000
B28582     88  ABEND-4003                          VALUE +4003.         02570000
B28582                                                                  02580000
B28582 01  PT-PROGRAM-TABLE-AREA.                                       02581000
B28582     05  PT-SKIP-CLASS.                                           02582000
B28582         10  PT-SKIP-CLASS-INDX      PIC S9(04)      VALUE ZEROS  02583000
B28582                         COMP-3.                                  02584000
B28582         10  PT-SKIP-CLASS-COUNT     PIC S9(04)      VALUE ZEROS  02585000
B28582                         COMP-3.                                  02586000
B28582         10  PT-SKIP-CLASS-MAX       PIC S9(04)      VALUE +999   02587000
B28582                         COMP-3.                                  02588000
B28582         10  PT-SKIP-CLASS-TBL OCCURS 999 TIMES.                  02589000
B28582             15  PT-SKIP-DEPT-CLASS  PIC X(05)       VALUE SPACES.02589100
B28582             15  FILLER REDEFINES PT-SKIP-DEPT-CLASS.             02589200
B28582                 20  PT-SKIP-DEPT    PIC 9(03).                   02589300
B28582                 20  PT-SKIP-DEPT-X REDEFINES PT-SKIP-DEPT        02589400
B28582                                     PIC X(03).                   02589500
B28582                 20  PT-SKIP-CLASS   PIC 9(02).                   02589600
B28582                 20  PT-SKIP-CLASS-X REDEFINES PT-SKIP-CLASS      02589700
B28582                                     PIC X(02).                   02589800
B28582                                                                  02589900
B28582                                                                  02590000
B28582 01  SK-SKIP-CLASS-RECORD.                                        02590100
B28582     05  SK-SKIP-DEPT-CLASS          PIC X(05)       VALUE SPACES.02590200
B28582     05  FILLER                      PIC X(75)       VALUE SPACES.02590300
B28582                                                                  02590400
B28582***************************************************************** 02590500
B28582*  BLOCKED/REJECTED DEPT/CLASS RECORD LAYOUT                      02590600
B28582***************************************************************** 02590700
B28582     COPY MLRD123.                                                02590800
B28582                                                                  02590900
020660****************************************************************  02591000
020700* MERCHANDISE LEDGER CONTROL TABLE                                02592000
020800****************************************************************  02593000
020900                                                                  02594000
MLCHGS     EXEC SQL                                                     02595000
MLCHGS         INCLUDE TMLCNTL                                          02596000
MLCHGS     END-EXEC.                                                    02597000
021300                                                                  02598000
021400****************************************************************  02599000
021500* DATE ATTRIBUTE TABLE                                            02600000
021600****************************************************************  02610000
021700                                                                  02620000
021800     EXEC SQL                                                     02630000
021900         INCLUDE TDTATTR                                          02640000
022000     END-EXEC.                                                    02650000
                                                                        02660000
023000****************************************************************  02670000
023100*  COMMUNICATION AREAS FOR DB2                                    02680000
023200****************************************************************  02690000
023300                                                                  02700000
023400     EXEC SQL                                                     02710000
023500         INCLUDE SQLCA                                            02720000
023600     END-EXEC.                                                    02730000
023700                                                                  02740000
023800                                                                  02750000
023900 LINKAGE SECTION.                                                 02760000
024000                                                                  02770000
024100                                                                  02780000
024200 PROCEDURE DIVISION.                                              02790000
024300                                                                  02800000
024400                                                                  02810000
024500 1000-MAIN-MODULE.                                                02820000
024600                                                                  02830000
024700     OPEN INPUT  CONTROL-CARD-FILE                                02840000
024800                 PO-ONORDER-EXTRACT-FILE                          02850000
B28582                 SKIP-CLASS-FILE                                  02860000
024900          OUTPUT PO-ONORDER-EXTRACT-WK-FILE                       02870000
025000                 LEDGER-EXTRACT-DATE-FILE                         02880000
B28582                 MLK446-ERROR-FILE                                02890000
B28582                 BLOCKED-DEPT-CLASS-FILE.                         02900000
025100                                                                  02910000
025200     PERFORM 1100-SET-EXTRACT-DTE.                                02920000
025300                                                                  02930000
B28582     PERFORM 1400-LOAD-SKIP-CLASS.                                02940000
B28582                                                                  02950000
025400     PERFORM 7200-READ-ONORDER-FILE.                              02960000
025500                                                                  02970000
025600     PERFORM 2000-EXTRACT-WEEK-DATA                               02980000
025700         UNTIL PS-END-OF-ONORDER-FILE.                            02990000
025800                                                                  03000000
025900     SUBTRACT 1 FROM PV-READ-CNT.                                 03010000
026000     DISPLAY  'INP02 RECORDS READ       ' PV-READ-CNT.            03020000
026100     DISPLAY  'OUT01 RECORDS WRITTEN    ' PV-WRITE-CNT.           03030000
026200     DISPLAY  'INP02 RECORDS ERRORED AND WRITTEN TO SYSOUT '      03040000
026300                                          PV-ERROR-CNT.           03050000
026400     DISPLAY  'RECORDS DROPPED          ' PV-DROP-CNT.            03060000
026500                                                                  03070000
026400     DISPLAY  'RECORDS DEPT/CLASS BLOCKED  '                      03080000
026500                                   PV-DEPT-CLASS-BLOCKED-CNT.     03090000
026600     CLOSE CONTROL-CARD-FILE                                      03100000
026700           PO-ONORDER-EXTRACT-FILE                                03110000
B28582           SKIP-CLASS-FILE                                        03120000
026800           PO-ONORDER-EXTRACT-WK-FILE                             03130000
026900           LEDGER-EXTRACT-DATE-FILE                               03140000
B28582           MLK446-ERROR-FILE                                      03150000
B28582           BLOCKED-DEPT-CLASS-FILE.                               03160000
027000                                                                  03170000
027100     STOP RUN.                                                    03180000
027200                                                                  03190000
027300                                                                  03200000
027400 1100-SET-EXTRACT-DTE.                                            03210000
027500                                                                  03220000
027600     PERFORM 7000-READ-CONTROL-CARD-FILE.                         03230000
027700                                                                  03240000
027800     IF PS-END-OF-CONTROL-CARDS                                   03250000
027900     OR CC-EXTRACT-DTE = SPACE                                    03260000
028000         PERFORM 1300-USE-ML-CNTL-DTES                            03270000
028100     ELSE                                                         03280000
028200         DISPLAY '** INPUT CONTROL CARD: ' CC-CONTROL-CARD        03290000
028300         PERFORM 1200-USE-CONTROL-CARD-DTE                        03300000
028400     END-IF.                                                      03310000
028500                                                                  03320000
028600     DISPLAY '** SELECTED EXTRACT DATE: ' DTATTR-FSCL-MN-END-DTE. 03330000
028700     MOVE DTATTR-FSCL-MN-END-DTE  TO ML135-EXTRACT-DTE.           03340000
028900                                                                  03350000
029000     PERFORM  7100-WRITE-LEDGER-EXTRACT-DATE.                     03360000
029100                                                                  03370000
029200                                                                  03380000
029300 1200-USE-CONTROL-CARD-DTE.                                       03390000
029400                                                                  03400000
029500     DISPLAY '** USING CONTROL CARD DATE FOR EXTRACT DATE.'       03410000
029600                                                                  03420000
029700     MOVE CC-EXTRACT-DTE              TO DTATTR-KY-DTE.           03430000
029800                                                                  03440000
029900     PERFORM 8050-GET-DATE-ATTRIBUTES.                            03450000
030000                                                                  03460000
030100     IF  PS-DATES-FOUND                                           03470000
030200     AND DTATTR-KY-DTE = DTATTR-FSCL-WK-END-DTE                   03480000
030300         MOVE DTATTR-FSCL-YR-NBR      TO PV-FSCL-YR-NBR           03490000
030400         MOVE DTATTR-FSCL-MN-BEG-DTE  TO PV-FSCL-MN-BEG-DTE       03500000
030500         MOVE DTATTR-FSCL-MN-END-DTE  TO PV-FSCL-MN-END-DTE       03510000
030510         MOVE DTATTR-FSCL-WK-BEG-DTE  TO PV-FSCL-WK-BEG-DTE       03520000
030520         MOVE DTATTR-FSCL-WK-END-DTE  TO PV-FSCL-WK-END-DTE       03530000
030600     ELSE                                                         03540000
030700         DISPLAY '** ABEND **'                                    03550000
030800         DISPLAY '** PROGRAM MLKUT446 **'                         03560000
030900         DISPLAY '** PARAGRAPH 1200-USE-CONTROL-CARD-DTE'         03570000
031000         DISPLAY '** CONTROL CARD DATE NOT A VALID FISCAL'        03580000
031100         DISPLAY '** WEEK-END DATE. '                             03590000
031200         MOVE +4003 TO ABEND-CODE                                 03600000
031300         PERFORM 9999-ABEND                                       03610000
031400     END-IF.                                                      03620000
031500                                                                  03630000
031600                                                                  03640000
031700 1300-USE-ML-CNTL-DTES.                                           03650000
031800                                                                  03660000
031900     PERFORM 8000-GET-ML-CNTL-DTES.                               03670000
032000                                                                  03680000
032100     DISPLAY                                                      03690000
032200         '** OPEN FISCAL WEEK DATE: ' MLCNTL-OPN-FSCL-WK-DTE      03700000
032300     DISPLAY                                                      03710000
032400         '** MAX POSTING WEEK DATE: ' MLCNTL-MXPSTG-FSCL-WK-DTE.  03720000
032500                                                                  03730000
032600     MOVE MLCNTL-MXPSTG-FSCL-WK-DTE   TO DTATTR-KY-DTE.           03740000
032700                                                                  03750000
032800     PERFORM 8050-GET-DATE-ATTRIBUTES.                            03760000
032900                                                                  03770000
033000     IF PS-DATES-NOT-FOUND                                        03780000
033100         DISPLAY '** ABEND **'                                    03790000
033200         DISPLAY '** PROGRAM MLKUT446 **'                         03800000
033300         DISPLAY '** PARAGRAPH 1200-USE-ML-CNTL-DTE'              03810000
033400         DISPLAY '** MAX POSTING DATE IS NOT A VALID DATE.'       03820000
033500         MOVE +4008 TO ABEND-CODE                                 03830000
033600         PERFORM 9999-ABEND                                       03840000
033700     END-IF.                                                      03850000
033800                                                                  03860000
033900     MOVE DTATTR-FSCL-YR-NBR          TO PV-FSCL-YR-NBR.          03870000
034000     MOVE DTATTR-FSCL-MN-BEG-DTE      TO PV-FSCL-MN-BEG-DTE       03880000
034100     MOVE DTATTR-FSCL-MN-END-DTE      TO PV-FSCL-MN-END-DTE       03890000
034200     MOVE MLCNTL-OPN-FSCL-WK-DTE      TO DTATTR-KY-DTE.           03900000
034300                                                                  03910000
034400     PERFORM 8050-GET-DATE-ATTRIBUTES.                            03920000
034500                                                                  03930000
034600     IF PS-DATES-NOT-FOUND                                        03940000
034700         DISPLAY '** ABEND **'                                    03950000
034800         DISPLAY '** PROGRAM MLKUT446 **'                         03960000
034900         DISPLAY '** PARAGRAPH 1200-USE-ML-CNTL-DTE'              03970000
035000         DISPLAY '** OPEN FISCAL WEEK DATE IS NOT A VALID DATE.'  03980000
035100         MOVE +4008 TO ABEND-CODE                                 03990000
035200         PERFORM 9999-ABEND                                       04000000
035300     END-IF.                                                      04010000
035400                                                                  04020000
035500     IF DTATTR-FSCL-YR-NBR NOT = PV-FSCL-YR-NBR                   04030000
035600         DISPLAY '** USING OPEN FISCAL MONTH FOR EXTRACT DATE.'   04040000
035700         MOVE DTATTR-FSCL-MN-BEG-DTE  TO PV-FSCL-MN-BEG-DTE       04050000
035800         MOVE DTATTR-FSCL-MN-END-DTE  TO PV-FSCL-MN-END-DTE       04060000
035900     ELSE                                                         04070000
036000         DISPLAY '** USING MAX POSTING MONTH FOR EXTRACT DATE.'   04080000
036100     END-IF.                                                      04090000
036200                                                                  04100000
B28582                                                                  04101000
B28582 1400-LOAD-SKIP-CLASS.                                            04102000
B28582                                                                  04103000
B28582     MOVE ZEROS           TO PT-SKIP-CLASS-INDX.                  04104000
B28582     PERFORM 1475-READ-SKIP-CLASS.                                04105000
B28582     PERFORM                                                      04106000
B28582         UNTIL END-OF-SKIP-CLASS                                  04107000
B28582             OR PT-SKIP-CLASS-INDX > PT-SKIP-CLASS-MAX            04108000
B28582         ADD +1                     TO PT-SKIP-CLASS-INDX         04109000
B28582         MOVE SK-SKIP-DEPT-CLASS                                  04109100
B28582             TO PT-SKIP-DEPT-CLASS(PT-SKIP-CLASS-INDX)            04109200
B28582         PERFORM 1475-READ-SKIP-CLASS                             04109300
B28582     END-PERFORM.                                                 04109400
B28582                                                                  04109500
B28582     IF PT-SKIP-CLASS-INDX > PT-SKIP-CLASS-MAX                    04109600
B28582         DISPLAY 'MORE THAN ' PT-SKIP-CLASS-MAX ' SKIP CLASS '    04109700
B28582         DISPLAY 'MUST EXPAND SKIP-CLASS TABLE  '                 04109800
B28582         SET ABEND-4003         TO TRUE                           04109900
B28582         PERFORM 9999-ABEND                                       04110000
B28582     ELSE                                                         04110100
B28582         MOVE PT-SKIP-CLASS-INDX    TO PT-SKIP-CLASS-COUNT        04110200
B28582     END-IF.                                                      04110300
B28582                                                                  04110400
B28582                                                                  04110500
B28582 1475-READ-SKIP-CLASS.                                            04110600
B28582                                                                  04110700
B28582     READ SKIP-CLASS-FILE      INTO SK-SKIP-CLASS-RECORD          04110800
B28582       AT END                                                     04110900
B28582         SET END-OF-SKIP-CLASS        TO TRUE.                    04111000
B28582                                                                  04111100
036300                                                                  04111200
036400 2000-EXTRACT-WEEK-DATA.                                          04111300
036500                                                                  04111400
036600******************************************************************04111500
036700*    PROCESS RECORDS THAT HAVE AN IN DC DATE THAT IS WITHIN THE   04111600
036800*    PROCESSING FISCAL MONTH                                      04111700
036900******************************************************************04111800
037000     IF PO018-ONORD-IN-DC-DATE >= PV-FSCL-MN-BEG-DTE AND          04111900
037100        PO018-ONORD-IN-DC-DATE <= PV-FSCL-MN-END-DTE              04112000
037200                                                                  04113000
037300         INITIALIZE ML132-ONORD-EXTRACT-WK-REC                    04114000
037400                                                                  04115000
037500         IF PV-SAVE-ONORD-ITEM-NBR NOT = PO018-ONORD-ITEM-NBR     04116000
037600             MOVE PO018-ONORD-ITEM-NBR TO SKXREF-ITM-NBR          04117000
037700             PERFORM 8200-SELECT-TSKXREF-DATA                     04118000
037800         END-IF                                                   04119000
037900         IF PS-ITEM-FOUND                                         04120000
038000             PERFORM 3000-MAP-AND-WRITE-REC                       04130000
038100         ELSE                                                     04140000
038200             PERFORM 7400-WRITE-ONORDER-ERROR                     04150000
038300         END-IF                                                   04160000
038400                                                                  04170000
038500         MOVE PO018-ONORD-ITEM-NBR     TO PV-SAVE-ONORD-ITEM-NBR  04180000
MLCHGD*        MOVE PO018-ONORD-DEPT-NBR     TO PV-SAVE-DEPT-NBR        04190000
MLCHGD         MOVE PV-SKXREF-DEPT-C         TO PV-SAVE-DEPT-NBR        04200000
038500         MOVE PO018-ONORD-ENT-ID       TO PV-SAVE-ENT-ID          04210000
038600     ELSE                                                         04220000
038700         ADD 1 TO PV-DROP-CNT                                     04230000
038800     END-IF.                                                      04240000
038900                                                                  04250000
039000     PERFORM 7200-READ-ONORDER-FILE.                              04260000
039100                                                                  04270000
039200                                                                  04280000
039300 3000-MAP-AND-WRITE-REC.                                          04290000
039400                                                                  04300000
039500     IF PO018-ONORD-IN-DC-DATE NOT = PV-SAVE-IN-DC-DATE           04310000
039600         MOVE PO018-ONORD-IN-DC-DATE TO DTATTR-KY-DTE             04320000
039700                                        PV-SAVE-IN-DC-DATE        04330000
039800         PERFORM 8100-GET-DATE-ATTRIBUTES                         04340000
039900     END-IF.                                                      04350000
040000                                                                  04360000
040100     MOVE DTATTR-FSCL-WK-END-DTE TO ML132-ONORD-FSCL-WK-END-DTE.  04370000
040200     MOVE DTATTR-FSCL-WK-NBR     TO ML132-ONORD-FSCL-WK-NBR.      04380000
040100     MOVE DTATTR-FSCL-MN-END-DTE TO ML132-ONORD-FSCL-MN-END-DTE.  04390000
040200     MOVE DTATTR-FSCL-MN-NBR     TO ML132-ONORD-FSCL-MN-NBR.      04400000
040300     MOVE PV-SKXREF-DEPT-C       TO ML132-ONORD-DEPT-NBR.         04410000
040400     MOVE PV-SKXREF-SUBCLASS-C   TO ML132-ONORD-SUB-CL-NBR.       04420000
040700     MOVE PO018-ONORD-STORE-NBR  TO ML132-ONORD-STR-NBR.          04430000
040800     MOVE PO018-ONORD-RTL-AMT    TO ML132-EXT-RTL-AMT.            04440000
040900     MOVE PO018-ONORD-COST-AMT   TO ML132-EXT-CST-AMT.            04450000
X28582     MOVE PO018-ONORD-ENT-ID     TO ML132-ONORD-ENT-ID.           04460001
                                                                        04470000
MLCHGS     IF PV-SAVE-ONORD-ITEM-NBR = PO018-ONORD-ITEM-NBR             04480000
MLCHGD*       AND PV-SAVE-DEPT-NBR   = PO018-ONORD-DEPT-NBR             04490000
MLCHGD        AND PV-SAVE-DEPT-NBR   = PV-SKXREF-DEPT-C                 04500000
MLCHGS        AND PV-SAVE-ENT-ID     = PO018-ONORD-ENT-ID               04510000
MLCHGS        MOVE PV-HOLD-ML-LWST-ID TO ML132-ONORD-ML-LWST-ID         04520000
MLCHGS     ELSE                                                         04530000
MLCHGS        PERFORM 8500-GET-ML-LWST-ID                               04540000
MLCHGS     END-IF.                                                      04550000
041200                                                                  04560000
B28582     PERFORM 7250-CHECK-FOR-BLOCKED.                              04570000
B28582                                                                  04580000
B28582     IF PS-DEPT-CLASS-BLOCKED-YES                                 04590000
B28582         PERFORM 7275-WRITE-BLOCKED                               04600000
B28582     ELSE                                                         04610000
B28582         PERFORM 7300-WRITE-ONORDER-EXTRACT.                      04620000
041400                                                                  04630000
041600 7000-READ-CONTROL-CARD-FILE.                                     04640000
041700                                                                  04650000
041800     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                  04660000
041900         AT END SET PS-END-OF-CONTROL-CARDS TO TRUE.              04670000
042000                                                                  04680000
042100                                                                  04690000
042200 7100-WRITE-LEDGER-EXTRACT-DATE.                                  04700000
042300                                                                  04710000
042400     WRITE LEDGER-EXTRACT-DATE-RECORD                             04720000
042500         FROM ML135-LEDGER-EXTRACT-DATE-REC.                      04730000
042600                                                                  04740000
042700                                                                  04750000
042800 7200-READ-ONORDER-FILE.                                          04760000
042900                                                                  04770000
043000     INITIALIZE PO018-ONORD-EXTRACT-RECORD.                       04780000
043100     READ PO-ONORDER-EXTRACT-FILE INTO PO018-ONORD-EXTRACT-RECORD 04790000
043200         AT END SET PS-END-OF-ONORDER-FILE  TO TRUE.              04800000
043300                                                                  04810000
043400     ADD 1 TO PV-READ-CNT.                                        04820000
B28582                                                                  04830000
B28582 7250-CHECK-FOR-BLOCKED.                                          04840000
B28582                                                                  04850000
B28582     SET PS-DEPT-CLASS-BLOCKED-NO TO TRUE.                        04860000
B28582     PERFORM                                                      04870000
B28582         VARYING PT-SKIP-CLASS-INDX FROM 1 BY 1                   04880000
B28582         UNTIL PT-SKIP-CLASS-INDX > PT-SKIP-CLASS-COUNT           04890000
B28582             OR PS-DEPT-CLASS-BLOCKED-YES                         04900000
B28582         IF PT-SKIP-DEPT-X(PT-SKIP-CLASS-INDX) =                  04910000
B28582                                     ML132-ONORD-DEPT-NBR         04920000
B28582             AND (PT-SKIP-CLASS-X(PT-SKIP-CLASS-INDX) = ZEROS OR  04921000
B28582                  PT-SKIP-CLASS-X(PT-SKIP-CLASS-INDX)             04922000
B28582                      = ML132-ONORD-SUB-CL-NBR)                   04922100
B28582             SET PS-DEPT-CLASS-BLOCKED-YES TO TRUE                04922200
B28582         END-IF                                                   04922300
B28582     END-PERFORM.                                                 04922400
B28582                                                                  04922500
B28582 7275-WRITE-BLOCKED.                                              04922600
B28582                                                                  04922700
B28582     MOVE PO018-ONORD-SKU            TO ML123-SKU.                04922800
B28582     SET ML123-PRCH-CDE              TO TRUE.                     04922900
B28582     MOVE PO018-ONORD-COST-AMT       TO ML123-CST-AMT.            04923000
B28582     MOVE PO018-ONORD-RTL-AMT        TO ML123-RTL-AMT.            04924000
B28582     MOVE PO018-ONORD-PO-NBR         TO PV-PO-NBR.                04925000
B28582     MOVE PV-PO-NBR                  TO ML123-PO-NBR.             04926000
B28582     MOVE SPACES                     TO ML123-COSA-IND            04927000
B28582                                        ML123-POS-IND.            04928000
B28582     MOVE ML132-ONORD-STR-NBR        TO ML123-STORE-NBR.          04929000
B28582     MOVE ML123-STORE-NBR(3:3)       TO ML123-BATCH-NBR.          04929100
B28582     MOVE ML132-ONORD-DEPT-NBR       TO ML123-DEPT-NBR.           04929200
B28582     MOVE ML132-ONORD-SUB-CL-NBR     TO ML123-CL-NBR.             04929300
B28582     MOVE ZEROS                      TO ML123-MAJ-CL-NBR.         04929400
B28582     MOVE ML132-ONORD-SUB-CL-NBR (1:1)                            04929500
B28582                                 TO ML123-MAJ-CL-NBR (3:1).       04929600
B28582                                                                  04929700
B28582     WRITE BLOCKED-DEPT-CLASS-REC FROM ML123-RECORD.              04929800
B28582                                                                  04929900
B28582     ADD +1 TO PV-DEPT-CLASS-BLOCKED-CNT.                         04930000
B28582                                                                  04931000
043500                                                                  04932000
043600                                                                  04933000
043700 7300-WRITE-ONORDER-EXTRACT.                                      04934000
043800                                                                  04935000
043900     WRITE PO-ONORDER-EXTRACT-WK-RECORD                           04936000
044000         FROM ML132-ONORD-EXTRACT-WK-REC.                         04937000
044100     ADD 1 TO PV-WRITE-CNT.                                       04938000
044200                                                                  04939000
044300                                                                  04940000
044400 7400-WRITE-ONORDER-ERROR.                                        04950000
044500                                                                  04960000
044600     DISPLAY PO018-ONORD-EXTRACT-RECORD.                          04970000
044700     ADD 1 TO PV-ERROR-CNT.                                       04980000
044800                                                                  04990000
044900                                                                  05000000
045000 8000-GET-ML-CNTL-DTES.                                           05010000
045100                                                                  05020000
045200     EXEC SQL                                                     05030000
045300          SELECT                                                  05040000
045400              OPN_FSCL_WK_DTE                                     05050000
045500             ,MXPSTG_FSCL_WK_DTE                                  05060000
045600          INTO                                                    05070000
045700              :MLCNTL-OPN-FSCL-WK-DTE                             05080000
045800             ,:MLCNTL-MXPSTG-FSCL-WK-DTE                          05090000
045900          FROM                                                    05100000
046000              TMLCNTL                                             05110000
046100          WITH UR                                                 05120000
046200     END-EXEC.                                                    05130000
046300                                                                  05140000
046400     EVALUATE TRUE                                                05150000
046500         WHEN SQLCODE = ZERO                                      05160000
046600             CONTINUE                                             05170000
046700         WHEN OTHER                                               05180000
046800             MOVE '8000-GET-ML-CNTL-DTES' TO PV-PARAGRAPH-NAME    05190000
046900             MOVE 'SELECT ROW FROM TMLCNTL'                       05200000
047000                                          TO PV-DB2-OPER-ATTEMPTED05210000
047100             PERFORM 9998-SQL-ABEND                               05220000
047200     END-EVALUATE.                                                05230000
047300                                                                  05240000
047400                                                                  05250000
047500 8050-GET-DATE-ATTRIBUTES.                                        05260000
047600                                                                  05270000
047700******************************************************************05280000
047800* GET THIS MONTHS BEGINNING AND ENDING DATES.                     05290000
047900*                                                                 05300000
048000******************************************************************05310000
048100                                                                  05320000
048200     EXEC SQL                                                     05330000
048300        SELECT                                                    05340000
048400            A.FSCL_YR_NBR                                         05350000
048500           ,A.FSCL_MN_BEG_DTE                                     05360000
048600           ,A.FSCL_MN_END_DTE                                     05370000
048700           ,A.FSCL_WK_END_DTE                                     05380000
048800        INTO                                                      05390000
048900            :DTATTR-FSCL-YR-NBR                                   05400000
049000           ,:DTATTR-FSCL-MN-BEG-DTE                               05410000
049100           ,:DTATTR-FSCL-MN-END-DTE                               05420000
049200           ,:DTATTR-FSCL-WK-END-DTE                               05430000
049300        FROM                                                      05440000
049400            TDTATTR A                                             05450000
049500        WHERE                                                     05460000
049600            A.KY_DTE             = :DTATTR-KY-DTE                 05470000
049700        WITH UR                                                   05480000
049800     END-EXEC.                                                    05490000
049900                                                                  05500000
050000     EVALUATE TRUE                                                05510000
050100         WHEN SQLCODE = ZERO                                      05520000
050200             SET PS-DATES-FOUND TO TRUE                           05530000
050300         WHEN SQLCODE = +100                                      05540000
050400             SET PS-DATES-NOT-FOUND TO TRUE                       05550000
050500         WHEN OTHER                                               05560000
050600             MOVE '8050-GET-DATE-ATTRIBUTES'                      05570000
050700                                          TO PV-PARAGRAPH-NAME    05580000
050800             MOVE 'SELECT ROW FROM TDTATTR'                       05590000
050900                                          TO PV-DB2-OPER-ATTEMPTED05600000
051000             PERFORM 9998-SQL-ABEND                               05610000
051100     END-EVALUATE.                                                05620000
051200                                                                  05630000
051300                                                                  05640000
051400 8100-GET-DATE-ATTRIBUTES.                                        05650000
051500                                                                  05660000
051600     EXEC SQL                                                     05670000
051700        SELECT                                                    05680000
051800            FSCL_MN_END_DTE                                       05690000
051900           ,FSCL_MN_NBR                                           05700000
051800           ,FSCL_WK_END_DTE                                       05710000
051900           ,FSCL_WK_NBR                                           05720000
052000        INTO                                                      05730000
052100            :DTATTR-FSCL-MN-END-DTE                               05740000
052200           ,:DTATTR-FSCL-MN-NBR                                   05750000
052100           ,:DTATTR-FSCL-WK-END-DTE                               05760000
052200           ,:DTATTR-FSCL-WK-NBR                                   05770000
052300        FROM TDTATTR                                              05780000
052400        WHERE                                                     05790000
052500            KY_DTE             = :DTATTR-KY-DTE                   05800000
052600        WITH UR                                                   05810000
052700     END-EXEC.                                                    05820000
052800                                                                  05830000
052900     EVALUATE TRUE                                                05840000
053000         WHEN SQLCODE = ZERO                                      05850000
053100             SET PS-DATE-FOUND TO TRUE                            05860000
053200         WHEN SQLCODE = +100                                      05870000
053300             SET PS-DATE-NOT-FOUND TO TRUE                        05880000
053400             CONTINUE                                             05890000
053500         WHEN OTHER                                               05900000
053600             MOVE '8100-GET-DATE-ATTRIBUTES'                      05910000
053700                                          TO PV-PARAGRAPH-NAME    05920000
053800             MOVE 'SELECT ROW FROM TDTATTR'                       05930000
053900                                          TO PV-DB2-OPER-ATTEMPTED05940000
054000             PERFORM 9998-SQL-ABEND                               05950000
054100     END-EVALUATE.                                                05960000
054200                                                                  05970000
054300                                                                  05980000
054400 8200-SELECT-TSKXREF-DATA.                                        05990000
054500                                                                  06000000
054600     EXEC SQL                                                     06010000
054700         SELECT SUBSTR(DIGITS(DEPT),2,3)                          06020000
054800               ,SUBSTR(DIGITS(SUBCLASS),3,2)                      06030000
054900         INTO  :PV-SKXREF-DEPT-C                                  06040000
055000              ,:PV-SKXREF-SUBCLASS-C                              06050000
055100         FROM TSKXREF                                             06060000
055200         WHERE ITM_NBR = :SKXREF-ITM-NBR                          06070000
055300        WITH UR                                                   06080000
055400     END-EXEC.                                                    06090000
055500                                                                  06100000
055600     EVALUATE TRUE                                                06110000
055700         WHEN SQLCODE = ZERO                                      06120000
055800             MOVE 'Y'   TO PS-ITEM-FOUND-SW                       06130000
055900         WHEN SQLCODE = +100                                      06140000
056000             MOVE 'N'   TO PS-ITEM-FOUND-SW                       06150000
056100         WHEN OTHER                                               06160000
056200             MOVE '8200-SELECT-TSKXREF-DATA'                      06170000
056300                                          TO PV-PARAGRAPH-NAME    06180000
056400             MOVE 'SELECT TSKXREF TABLE ' TO PV-DB2-OPER-ATTEMPTED06190000
056500             PERFORM 9998-SQL-ABEND                               06200000
056600     END-EVALUATE.                                                06210000
056700                                                                  06220000
MLCHGS******************************************************************06230000
MLCHGS* 8500-GET-ML-LWST-ID.                                            06240000
MLCHGS*                                                                 06250000
MLCHGS******************************************************************06260000
MLCHGS 8500-GET-ML-LWST-ID.                                             06270000
MLCHGS                                                                  06280000
MLCHGD*    PERFORM 8600-SELECT-CURR-DATE.                               06290000
MLCHGD*    MOVE PV-CURRENT-DATE          TO IN400-PV-EFF-DTE-IN.        06300000
MLCHGD     MOVE PV-FSCL-WK-END-DTE       TO IN400-PV-EFF-DTE-IN.        06310000
MLCHGS                                                                  06320000
MLCHGS     MOVE PO018-ONORD-ITEM-NBR     TO IN400-PV-ITM-NBR-IN-NUM.    06330000
                                                                        06340000
MLCHGS     IF PO018-ONORD-ENT-ID > 0                                    06350000
MLCHGS        MOVE PO018-ONORD-ENT-ID    TO IN400-PV-ENT-ID-IN-9        06360000
MLCHGS     END-IF                                                       06370000
                                                                        06380000
MLCHGS*    MOVE PO018-ONORD-DEPT-NBR     TO PV-DEPT-NBR.                06390000
MLCHGD     MOVE PV-SKXREF-DEPT-C         TO PV-DEPT-NBR.                06400000
MLCHGS     IF PV-DEPT-NBR > 0                                           06410000
MLCHGS        MOVE PV-DEPT-NBR TO IN400-PV-DEPT-IN-9                    06420000
MLCHGS     END-IF.                                                      06430000
                                                                        06440000
MLCHGS     MOVE 0000                     TO IN400-PV-LOC-IN-NUM.        06450000
MLCHGS     SET IN400-PV-ITEM-ATTRIB-LOOK TO TRUE.                       06460000
MLCHGS                                                                  06470000
MLCHGS     PERFORM IN400-LOOKUP-RETAIL.                                 06480000
                                                                        06490000
MLCHGS     IF IN400-PV-DBV-FOUND                                        06500000
MLCHGS        MOVE IN400-VND-ML-LO-MDSE-LVL-ID TO                       06510000
MLCHGS                                     ML132-ONORD-ML-LWST-ID       06520000
MLCHGS                                         PV-HOLD-ML-LWST-ID       06530000
                                                                        06540000
MLCHGS        IF IN400-ATT-LBL-SEQ-NBR-OUT = IN400-VND-LBL-SEQ-NBR      06550000
MLCHGS           CONTINUE                                               06560000
MLCHGS        ELSE                                                      06570000
MLCHGS           PERFORM 8700-WRITE-TO-ERROR-FILE                       06580000
MLCHGS           DISPLAY '********************************************' 06590000
MLCHGS           DISPLAY 'DEPARTMENT BRAND RELATIONSHIP DOES NOT EXIST' 06600000
MLCHGS           DISPLAY '********************************************' 06610000
MLCHGS           DISPLAY 'PO018-ONORD-ITEM-NBR: ' PO018-ONORD-ITEM-NBR  06620000
MLCHGS           DISPLAY 'PO018-ONORD-ENT-ID: ' PO018-ONORD-ENT-ID      06630000
MLCHGS           DISPLAY 'PO018-ONORD-DEPT-NBR: ' PO018-ONORD-DEPT-NBR  06640000
MLCHGS           DISPLAY 'ML132-ONORD-ML-LWST-ID: '                     06650000
MLCHGS                    ML132-ONORD-ML-LWST-ID                        06660000
MLCHGS           DISPLAY '********************************************' 06670000
MLCHGS        END-IF                                                    06680000
MLCHGS     ELSE                                                         06690000
J28582        MOVE IN400-VND-ML-LO-MDSE-LVL-ID TO                       06700000
J28582                                     ML132-ONORD-ML-LWST-ID       06710000
J28582                                         PV-HOLD-ML-LWST-ID       06720000
MLCHGS        IF IN400-PV-DBV-NOT-FOUND                                 06730000
W28582           PERFORM 8700-WRITE-TO-ERROR-FILE                       06740000
W28582           DISPLAY '********************************************' 06750000
W28582           DISPLAY 'DEPARTMENT BRAND RELATIONSHIP NOT FOUND'      06760000
W28582           DISPLAY '********************************************' 06770000
W28582           DISPLAY 'PO018-ONORD-ITEM-NBR: ' PO018-ONORD-ITEM-NBR  06780000
W28582           DISPLAY 'PO018-ONORD-ENT-ID: ' PO018-ONORD-ENT-ID      06790000
W28582           DISPLAY 'PO018-ONORD-DEPT-NBR: ' PO018-ONORD-DEPT-NBR  06800000
W28582           DISPLAY 'ML132-ONORD-ML-LWST-ID: '                     06810000
W28582                    ML132-ONORD-ML-LWST-ID                        06820000
W28582           DISPLAY '********************************************' 06830000
MLCHGS        END-IF                                                    06840000
MLCHGS     END-IF.                                                      06850000
                                                                        06860000
MLCHGS******************************************************************06870000
MLCHGS* 8600-SELECT-CURR-DATE.                                          06880000
MLCHGS*                                                                 06890000
MLCHGS******************************************************************06900000
MLCHGS 8600-SELECT-CURR-DATE.                                           06910000
MLCHGS                                                                  06920000
MLCHGS     EXEC SQL                                                     06930000
MLCHGS         SELECT CURRENT DATE                                      06940000
MLCHGS           INTO :PV-CURRENT-DATE                                  06950000
MLCHGS           FROM SYSIBM.SYSDUMMY1                                  06960000
MLCHGS     END-EXEC.                                                    06970000
MLCHGS                                                                  06980000
MLCHGS     EVALUATE TRUE                                                06990000
MLCHGS         WHEN SQLCODE = +0                                        07000000
MLCHGS             CONTINUE                                             07010000
MLCHGS         WHEN OTHER                                               07020000
MLCHGS             MOVE '8600-SELECT-CURR-DATE'                         07030000
MLCHGS                                        TO PV-PARAGRAPH-NAME      07040000
MLCHGS             MOVE 'SELECT CURRENT DATE' TO PV-DB2-OPER-ATTEMPTED  07050000
MLCHGS             PERFORM 9998-SQL-ABEND                               07060000
MLCHGS     END-EVALUATE.                                                07070000
MLCHGS                                                                  07080000
MLCHGS******************************************************************07090000
MLCHGS* 8700-WRITE-TO-ERROR-FILE                                        07100000
MLCHGS*                                                                 07110000
MLCHGS******************************************************************07120000
MLCHGS 8700-WRITE-TO-ERROR-FILE.                                        07130000
                                                                        07140000
MLCHGS     INITIALIZE MLK446-ERROR-RECORD.                              07150000
                                                                        07160000
MLCHGS     MOVE PO018-ONORD-EXTRACT-RECORD TO MLK446-ERROR-RECORD.      07170000
                                                                        07180000
MLCHGS     WRITE MLK446-ERROR-WK-RECORD                                 07190000
MLCHGS         FROM MLK446-ERROR-RECORD.                                07200000
                                                                        07210000
056800 9998-SQL-ABEND.                                                  07220000
056900                                                                  07230000
057000     MOVE +4013 TO ABEND-CODE.                                    07240000
057100     DISPLAY ' '.                                                 07250000
057200     DISPLAY '** ABEND **         ** = SQLERROR'.                 07260000
057300     DISPLAY '** PROGRAM          ** = MLKUT446'.                 07270000
057400     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       07280000
057500     DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   07290000
057600                                                                  07300000
057700*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07310000
057800*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07320000
057900     COPY DPPD004.                                                07330000
058000                                                                  07340000
058100     PERFORM 9999-ABEND.                                          07350000
058200                                                                  07360000
058300                                                                  07370000
058400 9999-ABEND.                                                      07380000
058500                                                                  07390000
058600     CALL 'ILBOABN0' USING ABEND-CODE.                            07400000
058300                                                                  07410000
MLCHGS***************************************************************** 07420000
MLCHGS*    CODE FOR COMMON PRICING MODULE INPD400                     * 07430000
MLCHGS***************************************************************** 07440000
MLCHGS                                                                  07450000
MLCHGS     COPY INPD400.                                                07460000
