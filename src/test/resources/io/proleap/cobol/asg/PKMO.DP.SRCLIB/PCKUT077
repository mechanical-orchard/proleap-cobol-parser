000100***************************************************************** 00010008
000200 IDENTIFICATION DIVISION.                                         00020009
000300***************************************************************** 00030009
000400 TITLE 'MONITOR TUPLDER TABLE FOR P2L TO LABOR INTERFACE'.        00040001
000500*                                                                 00050001
000600 PROGRAM-ID.    PCKUT077.                                         00060001
000700 AUTHOR.        JEAN KURKOWSKI.                                   00070001
000800 INSTALLATION.  KOHLS.                                            00080001
000900 DATE-WRITTEN   AUGUST 2007.                                      00090001
001000 DATE-COMPILED.                                                   00100001
001100                                                                  00110001
001200***************************************************************** 00120001
001300*    PROGRAM WILL PULL MESSAGES FROM THE TUPLDER TABLE USING    * 00130001
001400*    THE PREVIOUS RUN TIMESTAMP AND THE CURRENT TIMESTAMP.      * 00140001
001500*    IF MESSAGES ARE FOUND, THEY WILL BE WRITTEN TO A DATASET   * 00150001
001600*    AND THE RETURN CODE WILL BE SET TO 4095, SO THAT THE       * 00160001
001700*    FOLLOWING STEP WILL SEND OUT AN EMAIL.                     * 00170001
001800*                                                               * 00180001
001900***************************************************************** 00190001
002000 ENVIRONMENT DIVISION.                                            00200001
002100 INPUT-OUTPUT SECTION.                                            00210001
002200                                                                  00220001
002300 FILE-CONTROL.                                                    00230001
002400                                                                  00240001
002710     SELECT TIMESTAMP-FILE                                        00271024
002720         ASSIGN TO INP01.                                         00272025
002730                                                                  00273024
002800     SELECT ERROR-OUT-FILE                                        00280001
002900         ASSIGN TO OUT01.                                         00290001
003000                                                                  00300001
003400***************************************************************** 00340001
003500 DATA DIVISION.                                                   00350001
003600***************************************************************** 00360001
003700 FILE SECTION.                                                    00370001
003800                                                                  00380001
004510 FD  TIMESTAMP-FILE                                               00451024
004520     RECORDING MODE IS F                                          00452024
004530     BLOCK CONTAINS 0 RECORDS                                     00453024
004540     LABEL RECORDS ARE STANDARD.                                  00454024
004550                                                                  00455024
004560 01  TIMESTAMP-REC                PIC X(80).                      00456024
004570                                                                  00457024
004600 FD  ERROR-OUT-FILE                                               00460001
004700     RECORDING MODE IS F                                          00470001
004800     BLOCK CONTAINS 0 RECORDS                                     00480001
004900     LABEL RECORDS ARE STANDARD.                                  00490001
005000                                                                  00500001
005100 01  ERROR-OUT-RECORD             PIC X(80).                      00510001
005200                                                                  00520001
006000                                                                  00600001
006100***************************************************************** 00610001
006200 WORKING-STORAGE SECTION.                                         00620001
006300                                                                  00630001
006301 01  TIMESTAMP-REC-IN.                                            00630124
006302     05  FILLER                       PIC X(1)    VALUE SPACES.   00630224
006303     05  TR-FROM-TIMESTAMP            PIC X(26)   VALUE SPACES.   00630324
006304     05  FILLER                       PIC X(1)    VALUE SPACES.   00630424
006305     05  TR-TO-TIMESTAMP              PIC X(26)   VALUE SPACES.   00630524
006306     05  FILLER                       PIC X(26)   VALUE SPACES.   00630624
006310                                                                  00631024
006400 01  PS-PROGRAM-SWITCHES.                                         00640001
006500     05  PS-EOF-ERROR-CSR-SW          PIC X(01)  VALUE 'N'.       00650002
006600         88  PS-EOF-ERROR-CSR-YES                VALUE 'Y'.       00660002
006700         88  PS-EOF-ERROR-CSR-NO                 VALUE 'N'.       00670002
006800                                                                  00680001
006900 01  PC-PROGRAM-CONSTANTS.                                        00690001
007000     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PCKUT077'.00700001
007100                                                                  00710001
007200 01  PV-PROGRAM-VARIABLES.                                        00720001
007300     05  PV-REC-CNT                   PIC  9(09) VALUE  0.        00730001
007400     05  PV-BAD-TK-CNT                PIC  9(09) VALUE  0.        00740011
007500     05  PV-ERR-CNT                   PIC S9(09) COMP VALUE +0.   00750007
007600     05  PV-THIS-TIMESTAMP            PIC X(26) VALUE SPACES.     00760001
007700     05  PV-LAST-TIMESTAMP            PIC X(26) VALUE SPACES.     00770001
007800     05  PV-SQL-RETURN-CD             PIC -9(04).                 00780003
007900     05  PV-DISPLAY-ERR               PIC -9(04).                 00790003
008000     05  PV-PREV-UPLD-TRN-CDE         PIC X(01).                  00800012
008100     05  PV-CURR-UPLD-TRN-CDE         PIC X(01).                  00810012
008200                                                                  00820001
008300 01  PV-ABEND-FIELDS.                                             00830001
008400     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00840001
008500     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00850001
008600     05  PV-DB2-MESSAGE               PIC  X(50) VALUE SPACES.    00860002
008700     05  PV-ABEND-CODE                PIC S9(04) COMP SYNC        00870003
008800                                                 VALUE +0.        00880003
008900                                                                  00890001
009000 01  HEADING-OUT.                                                 00900001
009100     05  HEAD-REC                     PIC X(80)   VALUE SPACES.   00910001
009200 01  RECORD-OUT.                                                  00920001
009300     05  FILLER                       PIC X(1)    VALUE SPACES.   00930001
009400     05  REC-OPER                     PIC ZZZ9    VALUE ZEROES.   00940010
009500     05  FILLER                       PIC X(1)    VALUE SPACES.   00950010
009600     05  FILLER                       PIC X(08)   VALUE           00960010
009700         'ERR_CDE '.                                              00970010
009800     05  REC-ERR-CDE                  PIC 999.                    00980010
009900     05  FILLER                       PIC X(01)   VALUE SPACES.   00990010
010000     05  REC-CNT                      PIC ZZZ,ZZ9.                01000010
010100     05  FILLER                       PIC X(01)   VALUE SPACES.   01010010
010200     05  REC-MESSAGE                  PIC X(50).                  01020010
010300     05  FILLER                       PIC X(04)   VALUE SPACES.   01030010
010400                                                                  01040001
010500* * * COMMUNICATIONS AREA FOR DB2                                 01050001
010600     EXEC SQL                                                     01060001
010700          INCLUDE SQLCA                                           01070001
010800     END-EXEC.                                                    01080001
010900* * * TUPLDER TABLE - UPLOAD ERROR TABLE                          01090001
011000     EXEC SQL                                                     01100001
011100         INCLUDE TUPLDER                                          01110001
011200     END-EXEC.                                                    01120001
011300                                                                  01130001
011400**DECLARE THE ERROR-REC-CSR                                       01140001
011500     EXEC SQL                                                     01150001
011600          DECLARE ERROR-REC-CSR CURSOR FOR                        01160001
011700           SELECT   B.UPLD_TRN_CDE                                01170028
011800                   ,B.OPER_UNT_ID                                 01180028
011810                   ,B.ERR_CDE                                     01181028
011820                   ,COUNT(*)                                      01182028
011830             FROM   TUPLDER B                                     01183028
011840            WHERE (B.UPLD_TRN_CDE  IN ('D')        AND            01184028
011850                   NOT B.ERR_CDE = '113'           AND            01185031
011860                   B.PRC_TMST    > :TR-FROM-TIMESTAMP  AND        01186028
011870                   B.PRC_TMST   <= :TR-TO-TIMESTAMP               01187028
011880                  )                                               01188028
011890              OR                                                  01189028
011891                  (B.UPLD_TRN_CDE  IN ('D')        AND            01189128
011892                   B.ERR_CDE     = '113'       AND                01189228
011893                   SUBSTR(B.PKT_TXT,1,1) IN ('P')  AND            01189328
011894                   B.PRC_TMST    > :TR-FROM-TIMESTAMP  AND        01189428
011895                   B.PRC_TMST   <= :TR-TO-TIMESTAMP  AND          01189528
011896                   (UPPER(SUBSTR(B.PKT_TXT,89,8))) IN             01189628
011897                         (SELECT DISTINCT                         01189728
011898                                 UPPER(SUBSTR(A.PKT_TXT,89,8))    01189828
011899                            FROM TUPLDER A                        01189928
011900                           WHERE A.UPLD_TRN_CDE = 'D'             01190028
011901                             AND A.ERR_CDE      = '113'           01190128
011902                             AND SUBSTR(A.PKT_TXT,1,1) IN ('P')   01190228
011910                             AND A.PRC_TMST    <=                 01191028
011920                                 (TIMESTAMP(:TR-TO-TIMESTAMP)     01192028
011930                                 - 24 HOURS)                      01193028
012000                         )                                        01200028
012100                  )                                               01210028
012300           GROUP BY UPLD_TRN_CDE                                  01230028
012400                   ,OPER_UNT_ID                                   01240028
012500                   ,ERR_CDE                                       01250028
012600           ORDER BY UPLD_TRN_CDE                                  01260028
012700                   ,OPER_UNT_ID                                   01270028
012800                   ,ERR_CDE                                       01280028
012900            WITH UR                                               01290034
013100     END-EXEC.                                                    01310012
013200                                                                  01320012
013300     COPY DPWS004.                                                01330003
013400                                                                  01340003
013500                                                                  01350003
013600***************************************************************** 01360001
013700 PROCEDURE DIVISION.                                              01370001
013800***************************************************************** 01380001
013900                                                                  01390001
014010     OPEN INPUT  TIMESTAMP-FILE                                   01401025
014100          OUTPUT ERROR-OUT-FILE.                                  01410025
014300                                                                  01430001
014400     PERFORM 1000-GET-TIMESTAMP.                                  01440025
014600                                                                  01460001
014700     PERFORM 2000-OPEN-ERROR-CSR.                                 01470001
014710     IF  PS-EOF-ERROR-CSR-NO                                      01471032
014800         PERFORM 2010-FETCH-ERROR-CSR                             01480032
014900     END-IF                                                       01490032
015000     PERFORM 2020-CLOSE-ERROR-CSR.                                01500001
015100                                                                  01510001
015110     MOVE SPACES  TO  HEAD-REC.                                   01511021
015130     DISPLAY HEADING-OUT.                                         01513021
015131     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01513121
015140                                                                  01514021
015400     CLOSE TIMESTAMP-FILE                                         01540025
015500           ERROR-OUT-FILE.                                        01550025
015700                                                                  01570001
015800*    IF ANY ERRORS WERE FOUND, THEN SET THE RETURN-CODE, SO       01580001
015900*    THAT THE EMAIL WILL GET SENT OUT IN THE NEXT STEP            01590001
016000                                                                  01600001
016100     IF PV-REC-CNT > 0                                            01610001
016200         MOVE 4095 TO RETURN-CODE                                 01620001
016300     END-IF.                                                      01630001
016400                                                                  01640001
016500     GOBACK.                                                      01650001
016600                                                                  01660001
016700***************************************************************** 01670001
016800*  GET THE CURRENT TIMESTAMP                                      01680001
016900***************************************************************** 01690001
017000 1000-GET-TIMESTAMP.                                              01700025
017100                                                                  01710001
017110     READ TIMESTAMP-FILE                                          01711025
017120     INTO TIMESTAMP-REC-IN                                        01712025
017130            AT END                                                01713025
017140               MOVE 'MISSING TIMESTAMP FILE '                     01714025
017150                                TO PV-DB2-MESSAGE                 01715025
017160               MOVE '1000-GET-TIMESTAMP'                          01716025
017170                                TO PV-ABEND-PARAGRAPH             01717025
017180               MOVE 'INP01'     TO PV-ABEND-TABLE                 01718025
017190               PERFORM 9100-SQL-ABEND                             01719025
017191     END-READ.                                                    01719125
017192                                                                  01719225
017193                                                                  01719325
017200     MOVE '*****************************************'             01720025
017300                                        TO HEAD-REC.              01730025
017400     DISPLAY HEAD-REC.                                            01740025
017500     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01750025
017510                                                                  01751025
017520                                                                  01752025
017600     STRING  'FROM DATE - '     TR-FROM-TIMESTAMP                 01760025
018800             '    PCKUT077'                                       01880001
018900                  DELIMITED BY SIZE                               01890001
019000                                      INTO HEAD-REC.              01900001
019100     DISPLAY HEAD-REC.                                            01910001
019200     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01920001
019201                                                                  01920125
019202                                                                  01920225
019210     MOVE   SPACES                      TO HEAD-REC.              01921025
019230     DISPLAY HEAD-REC.                                            01923025
019240     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01924025
019250                                                                  01925025
019300                                                                  01930001
019310     STRING  'TO DATE   - '     TR-TO-TIMESTAMP                   01931025
019320             '    PCKUT077'                                       01932025
019330                  DELIMITED BY SIZE                               01933025
019340                                      INTO HEAD-REC.              01934025
019350     DISPLAY HEAD-REC.                                            01935025
019360     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01936025
019370                                                                  01937025
019380                                                                  01938025
019400     MOVE '*****************************************'             01940001
019500                                        TO HEAD-REC.              01950001
019600     DISPLAY HEAD-REC.                                            01960001
019700     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01970001
019800                                                                  01980001
019913                                                                  01991325
019914     MOVE SPACES                        TO HEAD-REC.              01991425
019915     DISPLAY HEAD-REC.                                            01991525
019916     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01991625
019917                                                                  01991725
019918                                                                  01991825
019919     MOVE 'TUPLDER - UPLDER ERROR FROM PACK-TO-LIGHT'             01991925
019920                                        TO HEAD-REC.              01992025
019921     DISPLAY HEAD-REC.                                            01992125
019922     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01992225
019923                                                                  01992325
019924                                                                  01992425
019925     MOVE SPACES                        TO HEAD-REC.              01992525
019926     DISPLAY HEAD-REC.                                            01992625
019927     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01992725
019928                                                                  01992825
019929                                                                  01992925
019930     MOVE '*****************************************'             01993025
019931                                        TO HEAD-REC.              01993125
019932     DISPLAY HEAD-REC.                                            01993225
019933     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01993325
019934                                                                  01993425
019935                                                                  01993525
019936     MOVE SPACES                        TO HEAD-REC.              01993625
019937     DISPLAY HEAD-REC.                                            01993725
019938     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01993825
019939                                                                  01993925
019940                                                                  01994025
026000***************************************************************** 02600001
026100*  OPEN THE ERROR REC CURSOR                                      02610001
026200***************************************************************** 02620001
026300 2000-OPEN-ERROR-CSR.                                             02630001
026400                                                                  02640001
026500     SET PS-EOF-ERROR-CSR-NO        TO TRUE.                      02650001
026600                                                                  02660001
026700     EXEC SQL                                                     02670001
026800          OPEN ERROR-REC-CSR                                      02680001
026900     END-EXEC.                                                    02690001
027000                                                                  02700001
027100     EVALUATE TRUE                                                02710001
027200         WHEN SQLCODE = ZERO                                      02720001
027210              CONTINUE                                            02721032
027220         WHEN SQLCODE = +100                                      02722032
027230              SET PS-EOF-ERROR-CSR-YES   TO TRUE                  02723032
027300         WHEN SQLCODE = -904                                      02730001
027400         WHEN SQLCODE = -913                                      02740001
027500         WHEN SQLCODE = -911                                      02750001
027601             MOVE SQLCODE               TO PV-SQL-RETURN-CD       02760132
027602             STRING 'SQL='                                        02760232
027603                  PV-SQL-RETURN-CD                                02760332
027604                  DELIMITED BY SIZE                               02760432
027605                            INTO PV-DB2-MESSAGE                   02760532
027606             MOVE '2000-OPEN-ERROR-CSR'                           02760632
027607                              TO PV-ABEND-PARAGRAPH               02760732
027608             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   02760832
027609             PERFORM 9100-SQL-ABEND                               02760932
027700         WHEN SQLWARN0 NOT = SPACES                               02770001
027800         WHEN SQLCODE NOT = ZERO                                  02780001
027900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       02790002
028000             STRING 'SQL='                                        02800002
028100                  PV-SQL-RETURN-CD                                02810001
028200                  DELIMITED BY SIZE                               02820001
028300                            INTO PV-DB2-MESSAGE                   02830002
028400             MOVE '2000-OPEN-ERROR-CSR'                           02840002
028500                              TO PV-ABEND-PARAGRAPH               02850002
028600             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   02860002
028700             PERFORM 9100-SQL-ABEND                               02870002
028800     END-EVALUATE.                                                02880001
028900                                                                  02890001
029000                                                                  02900001
029100***************************************************************** 02910001
029200*  FETCH THE ERROR REC CURSOR RECORDS                             02920001
029300***************************************************************** 02930001
029400 2010-FETCH-ERROR-CSR.                                            02940001
029500                                                                  02950001
029600     EXEC SQL                                                     02960001
029700          FETCH ERROR-REC-CSR                                     02970001
029800          INTO  :UPLDER-UPLD-TRN-CDE                              02980012
029900               ,:UPLDER-OPER-UNT-ID                               02990012
030000               ,:UPLDER-ERR-CDE                                   03000012
030100               ,:PV-ERR-CNT                                       03010012
030200     END-EXEC.                                                    03020012
030300                                                                  03030012
030400     EVALUATE TRUE                                                03040012
030500         WHEN SQLCODE = ZERO                                      03050012
030600              PERFORM 2100-WRITE-RECORD                           03060012
030700         WHEN SQLCODE = +100                                      03070012
030800              SET PS-EOF-ERROR-CSR-YES   TO TRUE                  03080012
030900         WHEN SQLCODE = -904                                      03090012
031000         WHEN SQLCODE = -913                                      03100012
031100         WHEN SQLCODE = -911                                      03110012
031200              CONTINUE                                            03120012
031300         WHEN SQLWARN0 NOT = SPACES                               03130001
031400         WHEN SQLCODE NOT = ZERO                                  03140001
031500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03150002
031600             STRING 'SQL='                                        03160002
031700                  PV-SQL-RETURN-CD                                03170002
031800                  DELIMITED BY SIZE                               03180002
031900                            INTO PV-DB2-MESSAGE                   03190002
032000             MOVE '2010-FETCH-ERROR-CSR'                          03200002
032100                              TO PV-ABEND-PARAGRAPH               03210002
032200             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03220002
032300             PERFORM 9100-SQL-ABEND                               03230002
032400     END-EVALUATE.                                                03240001
032500                                                                  03250001
032600                                                                  03260001
032700***************************************************************** 03270001
032800*  CLOSE THE ERROR REC CURSOR                                     03280001
032900***************************************************************** 03290001
033000 2020-CLOSE-ERROR-CSR.                                            03300001
033100                                                                  03310001
033200     EXEC SQL                                                     03320001
033300          CLOSE ERROR-REC-CSR                                     03330001
033400     END-EXEC.                                                    03340001
033500                                                                  03350001
033600     EVALUATE TRUE                                                03360001
033700         WHEN SQLCODE = ZERO                                      03370001
033800         WHEN SQLCODE = -904                                      03380001
033900         WHEN SQLCODE = -913                                      03390001
034000         WHEN SQLCODE = -911                                      03400001
034001             CONTINUE                                             03400121
034200         WHEN SQLWARN0 NOT = SPACES                               03420001
034300         WHEN SQLCODE NOT = ZERO                                  03430001
034400             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03440002
034500             STRING 'SQL='                                        03450002
034600                  PV-SQL-RETURN-CD                                03460002
034700                  DELIMITED BY SIZE                               03470002
034800                            INTO PV-DB2-MESSAGE                   03480002
034900             MOVE '2020-CLOSE-ERROR-CSR'                          03490002
035000                              TO PV-ABEND-PARAGRAPH               03500002
035100             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03510002
035200             PERFORM 9100-SQL-ABEND                               03520002
035300     END-EVALUATE.                                                03530001
035400                                                                  03540001
035500                                                                  03550001
035600***************************************************************** 03560001
035700*  WRITE A RMS RECORD TO THE ERROR FILE                           03570001
035800***************************************************************** 03580001
035900 2100-WRITE-RECORD.                                               03590001
036000     IF  UPLDER-UPLD-TRN-CDE  =  PV-PREV-UPLD-TRN-CDE             03600012
036100         CONTINUE                                                 03610012
036200     ELSE                                                         03620012
036300         IF  UPLDER-UPLD-TRN-CDE  =  'D'                          03630012
036400             MOVE 'ERRORS FOR P2L CALL TO LABOR MODULE - CODE D'  03640022
036500                                   TO HEAD-REC                    03650017
036600             DISPLAY HEADING-OUT                                  03660017
036700             WRITE ERROR-OUT-RECORD FROM HEADING-OUT              03670017
036800             MOVE UPLDER-UPLD-TRN-CDE TO  PV-PREV-UPLD-TRN-CDE    03680014
037700         END-IF                                                   03770012
037800     END-IF.                                                      03780012
037900                                                                  03790012
038000                                                                  03800001
038100     MOVE UPLDER-OPER-UNT-ID       TO REC-OPER.                   03810010
038200     MOVE UPLDER-ERR-CDE           TO REC-ERR-CDE.                03820010
038300     MOVE PV-ERR-CNT               TO REC-CNT.                    03830010
038400                                                                  03840012
038500     IF  UPLDER-UPLD-TRN-CDE  =  'D'                              03850012
038600       EVALUATE TRUE                                              03860012
038700         WHEN UPLDER-ERR-CDE = '100'                              03870010
038800             MOVE 'INVALID QUEUE MANAGER NAME               '     03880010
038900                                   TO REC-MESSAGE                 03890010
039000         WHEN UPLDER-ERR-CDE = '101'                              03900010
039100             MOVE 'INVALID MESSAGE TYPE                     '     03910010
039200                                   TO REC-MESSAGE                 03920010
039300         WHEN UPLDER-ERR-CDE = '102'                              03930010
039400             MOVE 'DATA ELEMENT EXCEPTION                   '     03940010
039500                                   TO REC-MESSAGE                 03950010
039600         WHEN UPLDER-ERR-CDE = '103'                              03960010
039700             MOVE 'NO LABOR MODULE TO CALL FOR MESSAGE TYPE '     03970010
039800                                   TO REC-MESSAGE                 03980010
039900         WHEN UPLDER-ERR-CDE = '104'                              03990010
040000             MOVE 'MQ OPEN ERROR                            '     04000010
040100                                   TO REC-MESSAGE                 04010010
040200         WHEN UPLDER-ERR-CDE = '105'                              04020010
040300             MOVE 'MQ GET MESSAGE ERROR                     '     04030010
040400                                   TO REC-MESSAGE                 04040010
040500         WHEN UPLDER-ERR-CDE = '106'                              04050010
040600             MOVE 'WSV_CNSMR_QUE SQL ERROR                  '     04060010
040700                                   TO REC-MESSAGE                 04070010
040800         WHEN UPLDER-ERR-CDE = '107'                              04080010
040900             MOVE 'MQ CONNECT ERROR                         '     04090010
041000                                   TO REC-MESSAGE                 04100010
041100         WHEN UPLDER-ERR-CDE = '108'                              04110010
041200             MOVE 'MESSAGE TRUNCATED ERROR                  '     04120010
041300                                   TO REC-MESSAGE                 04130010
041400         WHEN UPLDER-ERR-CDE = '109'                              04140010
041500             MOVE 'MQ CLOSE ERROR                           '     04150010
041600                                   TO REC-MESSAGE                 04160010
041700         WHEN UPLDER-ERR-CDE = '110'                              04170010
041800             MOVE 'MQ DISCONNECT ERROR                      '     04180010
041900                                   TO REC-MESSAGE                 04190010
042000         WHEN UPLDER-ERR-CDE = '111'                              04200010
042100             MOVE 'MQ COMMIT ERROR                          '     04210010
042200                                   TO REC-MESSAGE                 04220010
042300         WHEN UPLDER-ERR-CDE = '112'                              04230010
042400             MOVE 'UNSUCCESSFUL CALL TO LABOR MODULE        '     04240010
042500                                   TO REC-MESSAGE                 04250011
042600         WHEN UPLDER-ERR-CDE = '113'                              04260011
042700             MOVE 'INVALID USER ID                          '     04270011
042800                                   TO REC-MESSAGE                 04280010
042900                                                                  04290011
043000         WHEN UPLDER-ERR-CDE = '001'                              04300010
043100             MOVE 'ERROR (FROM COMMUNICATION AREA)          '     04310010
043200                                   TO REC-MESSAGE                 04320010
043300         WHEN UPLDER-ERR-CDE = '002'                              04330010
043400             MOVE 'SQL ERROR (FROM COMMUNICATION AREA)      '     04340010
043500                                   TO REC-MESSAGE                 04350010
043600         WHEN UPLDER-ERR-CDE = '003'                              04360010
043700             MOVE 'INVALID DATA (FROM COMMUNICATION AREA)   '     04370010
043800                                   TO REC-MESSAGE                 04380010
043900         WHEN OTHER                                               04390010
044000             STRING 'UNKNOWN DATA - ERROR CODE '                  04400010
044100                    UPLDER-ERR-CDE                                04410010
044200                    DELIMITED BY SIZE                             04420010
044300                                 INTO REC-MESSAGE                 04430010
044400       END-EVALUATE                                               04440012
045410     END-IF.                                                      04541019
045500                                                                  04550012
045600     DISPLAY RECORD-OUT.                                          04560012
045700     WRITE ERROR-OUT-RECORD FROM RECORD-OUT.                      04570001
045800                                                                  04580011
045810     ADD +1         TO PV-REC-CNT.                                04581029
045820                                                                  04582029
045900***  IF  UPLDER-UPLD-TRN-CDE  =  'D'                              04590029
046000***      EVALUATE TRUE                                            04600029
046100***          WHEN UPLDER-ERR-CDE = '113'                          04610029
046200***               ADD +1         TO PV-BAD-TK-CNT                 04620029
046300***          WHEN OTHER                                           04630029
046400***               ADD +1         TO PV-REC-CNT                    04640029
046500***      END-EVALUATE                                             04650029
047000***  END-IF.                                                      04700029
047100                                                                  04710001
047200                                                                  04720001
048200 9100-SQL-ABEND.                                                  04820002
048300******************************************************************04830002
048400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04840002
048500*  ERROR OR WARNING CODE OCCURS.                                  04850002
048600******************************************************************04860002
048700     DISPLAY '9100-SQL-ABEND'.                                    04870002
048800     DISPLAY '** ABEND     **'.                                   04880002
048900     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04890002
049000     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             04900002
049100     DISPLAY '** TABLE     ** = ' PV-ABEND-TABLE.                 04910002
049200     DISPLAY '** MESSAGE   ** = ' PV-DB2-MESSAGE.                 04920002
049300     COPY DPPD004.                                                04930002
049400                                                                  04940002
049500     MOVE +4013                  TO PV-ABEND-CODE.                04950003
049600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04960003
049700                                                                  04970002
