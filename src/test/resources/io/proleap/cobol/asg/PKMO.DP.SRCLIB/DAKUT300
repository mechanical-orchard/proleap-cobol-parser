000200 IDENTIFICATION DIVISION.                                         00010000
000400 PROGRAM-ID.           DAKUT300.                                  00020034
000500 AUTHOR.               BOB MCASEY.                                00030000
000600 INSTALLATION.         KOHLS DEPARTMENT STORES.                   00040000
000700 DATE-WRITTEN          05/18/2000.                                00050000
000800 DATE-COMPILED.                                                   00060000
000900                                                                  00070000
001000******************************************************************00080090
001100*   DAKUT300 - EXTRACT DEBIT ALLOWANCE DATA FROM ORACLE           00090089
001100*                                                                 00100089
001200*   THIS PROGRAM EXTRACTS ROWS FROM ORACLE TABLE TDAALW WHEN      00110089
001300*   THE STATUS CODE IS '40' (INDICATES THAT ALL APPROVALS HAVE    00120089
001300*   BEEN RECEIVED.                                                00130089
001700*                                                                 00140089
      *CHANGE HISTORY:                                                  00150089
      * PROJ   DATE       PGMR       DESCRIPTION                        00160089
      * ------ ---------- ---------- ---------------------------------- 00170089
001700*        03/09/01   AMY LAWSON ADDED LOGIC TO ONLY EXTRACT RECORDS00180089
001700*                              FOR THE CURRENT FISCAL MONTH.      00190089
001700*WR20419 04-10-2001            CHANGED THE STORE FOR INTERNAL     00200089
001700*                              LOADS (DA100-TYP-CDE-IL) FROM      00210089
001700*                              STORE 400 TO STORE 090             00220089
001700*WR20419 04-10-2001            CHANGED THE STORE FOR INTERNAL     00230089
001700*                              LOADS BACK TO 400 AND THE A/P TRAN 00240089
001700*                              CDE 69 FOR THIS TRANSACTION WILL   00250089
001700*                              HAVE ITS STORE SET TO 090 IN PGM   00260089
001700*                              DAKUP200.                          00270089
1000RM*                   R MCASEY   COMMENTED OUT ALL IN-DATE-FILE     00280089
1000RM*                              LOGIC BECAUSE THE APPROVAL WINDOW  00290089
1000RM*                              HAS DATE LOGIC IN IT.              00300089
22405 * 22405  05-31-2001 R JANSSEN  DAII - ASSET RECOVERY ENHANCEMENT  00310089
      *W26601  04-20-2004 S JACKSON  STORE NUMBER EXPANSION             00320099
      *W30328  02-22-2006 S JACKSON  10G GATEWAY UPGRADE. UPDATE DATE(S)00330099
W30021*W30021  05-04-2006 P KEBER    ADD AN OUTER JOIN ON TDANOTE IN THE00331099
W30021*                              TDAALW_INFO CURSOR FOR OFF INVOICE 00332099
W30021*                              DEBIT TYPES WITH NO DA NOTES.      00333099
8613F *8613F   07-17-2015 S BARTELT  RMS 9 REMEDIATION. CHANGED FROM    00334099
      *                              AUTO LOGON TO EXTERNAL SIGN ON     00335099
001000******************************************************************00340090
                                                                        00350089
007600 ENVIRONMENT DIVISION.                                            00360000
007800 CONFIGURATION SECTION.                                           00370000
008000 SOURCE-COMPUTER. IBM-3090.                                       00380000
008100 OBJECT-COMPUTER. IBM-3090.                                       00390000
008300 INPUT-OUTPUT SECTION.                                            00400000
008500 FILE-CONTROL.                                                    00410000
                                                                        00420089
           SELECT WKLY-DTE-FILE              ASSIGN TO INP01.           00430072
                                                                        00440090
8613F      SELECT ORACLE-LOGIN-FILE          ASSIGN TO ORALOGON.        00450099
22405                                                                   00460090
           SELECT OUT-DA-FILE                ASSIGN TO OUT01.           00470090
                                                                        00480090
010300 DATA DIVISION.                                                   00490000
010600 FILE SECTION.                                                    00500000
                                                                        00510090
       FD  WKLY-DTE-FILE                                                00520053
           LABEL RECORDS ARE STANDARD                                   00530053
           RECORDING MODE IS F                                          00540053
           BLOCK CONTAINS 0 RECORDS.                                    00550053
       01  WKLY-DTE-RECORD          PIC X(50).                          00560053
                                                                        00560199
8613F  FD  ORACLE-LOGIN-FILE                                            00561099
8613F      RECORDING MODE IS F                                          00562099
8613F      LABEL RECORDS ARE STANDARD                                   00563099
8613F      BLOCK CONTAINS 0 RECORDS                                     00564099
8613F      DATA RECORD IS ORACLE-LOGIN-REC.                             00565099
8613F  01  ORACLE-LOGIN-REC.                                            00566099
8613F      05  FILLER                  PIC X(80).                       00567099
                                                                        00570053
       FD  OUT-DA-FILE                                                  00750090
           LABEL RECORDS ARE STANDARD                                   00760090
           RECORDING MODE IS F                                          00770090
           BLOCK CONTAINS 0 RECORDS.                                    00780090
       01  OUT-DA-RECORD            PIC X(350).                         00790090
                                                                        00800090
      /*****************************************************************00810089
       WORKING-STORAGE SECTION.                                         00820089
      ******************************************************************00830089
017300 01  PC-PROGRAM-CONSTANTS.                                        00840000
019600*    05  PC-STR-400                   PIC X(03)  VALUE '400'.     00850099
W26601     05  PC-STR-400                   PIC X(05)  VALUE '00400'.   00860099
22405 *    05  PC-STR-811                   PIC X(03)  VALUE '811'.     00870099
W26601     05  PC-STR-811                   PIC X(05)  VALUE '00811'.   00880099
0401RM*    05  PC-STR-090                   PIC X(03)  VALUE '090'.     00890099
W26601     05  PC-STR-090                   PIC X(05)  VALUE '00090'.   00900099
019600     05  PC-AP-APPROVAL-STAT-CDE      PIC X(02)  VALUE '40'.      00910015
017400     05  PC-PROGRAM-NAME              PIC X(08)  VALUE            00920015
017500                                                 'DAKUT300'.      00930034
017900     05  PC-MESSAGES.                                             00940000
018000         10  PC-SQL-ABEND-MESSAGE     PIC X(23)  VALUE            00950015
018100         '** ABEND -> SQLERROR = '.                               00960000
018200         10  PC-PROGRAM-MESSAGE       PIC X(23)  VALUE            00970015
018300         '** PROGRAM        ** = '.                               00980000
018400         10  PC-PARAGRAPH-MESSAGE     PIC X(23)  VALUE            00990015
018500         '** PARAGRAPH-NAME ** = '.                               01000000
018600         10  PC-DB2-OPER-MESSAGE      PIC X(23)  VALUE            01010015
018700         '** DB2 OPERATION  ** = '.                               01020000
8613F      05  PC-AUTO-LOGON           PIC X(01)  VALUE '/'.            01021099
023000                                                                  01030000
023100  01 PV-PROGRAM-VARIABLES.                                        01040010
027800     05  PV-ABEND-PARAGRAPH           PIC X(40)      VALUE SPACE. 01050001
           05  PV-OPER-ATTEMPTED            PIC  X(50) VALUE SPACES.    01051099
           05  PV-TDANOTE.                                              01060007
               10  PV-TDANOTE-PT1           PIC X(50)      VALUE SPACES.01070007
               10  PV-TDANOTE-PT2           PIC X(50)      VALUE SPACES.01080007
               10  FILLER                   PIC X(1900)    VALUE SPACES.01090007
040700     05  PV-ABEND-CODE   COMP  SYNC   PIC S9(04)     VALUE +0000. 01100016
           05  PV-SQLCODE-DISPLAY           PIC  ++++9 VALUE ZERO.      01101099
           05  PV-RTL-AMT                   PIC S9(09)V99  VALUE +0.    01110016
           05  PV-PCTG                      PIC S9(04)V9999 VALUE +0.   01120043
8613F      05  PV-ORACLE-USERID-LEN            PIC S9(04) VALUE ZEROS.  01211099
8613F      05  PV-ORACLE-PASSWORD-LEN          PIC S9(04) VALUE ZEROS.  01212099
                                                                        01220090
       01  PV-FSCL-MN-NBR                   PIC 9(2).                   01230071
       01  PV-FSCL-YR-NBR                   PIC 9(4).                   01240071
036400                                                                  01250000
8613F  01  CC-ORACLE-CONNECTION.                                        01251099
8613F      05  CC-ORACLE-USERID                PIC X(40).               01252099
8613F          88 CC-AUTO-LOGON                           VALUE '/'.    01253099
8613F      05  CC-ORACLE-PASSWORD              PIC X(40).               01254099
                                                                        01255099
036500 01  PS-PROGRAM-SWITCHES.                                         01260000
036600     05  PS-DA-TRANS-LEFT-SW          PIC X(01)      VALUE 'Y'.   01270000
036700         88  PS-NO-MORE-DA-TRANS-LEFT                VALUE 'N'.   01280000
036800         88  PS-MORE-DA-TRANS-LEFT                   VALUE 'Y'.   01290000
22405      05  PS-INP02-DONE-SW             PIC X(01)      VALUE 'N'.   01300090
22405          88  INP02-PROCESS-COMPLETE                  VALUE 'Y'.   01310090
8613F      05  PS-ORACLE-LOGIN-EOF-SW          PIC  X     VALUE 'N'.    01311099
8613F          88  ORACLE-LOGIN-EOF                       VALUE 'Y'.    01312099
040600                                                                  01320000
036500 01  PS-PROGRAM-ACCUMUALTORS.                                     01330014
           05  PA-ROWS-FETCHED              PIC 9(07)    VALUE 0.       01340014
           05  PA-RECORDS-WRITTEN           PIC 9(07)    VALUE 0.       01350014
042200                                                                  01360000
00675  01  WS-MSG-TEXT                   PIC X(512).                    01370001
00676  01  WS-MAX-SIZE                   PIC S9(09) COMP                01380001
00677                                               VALUE 512.          01390001
00678  01  WS-MSG-LENGTH                 PIC S9(09) COMP.               01400001
054800                                                                  01410000
056600*----------------------------------------------------------------*01420000
056600*    ORACLE DECLARE SECTION                                       01430000
056600*----------------------------------------------------------------*01440000
00681      EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01450000
00682                                                                   01460000
00683  01  USERNAME                       PIC X(10)      VARYING.       01470007
00684  01  PASSWD                         PIC X(10)      VARYING.       01480007
00685  01  PC-ENT01-TYPE-CDE              PIC X(02)      VALUE '01'.    01490007
00686  01  PV-ORACLE-ID                   PIC X(1)       VALUE '/'.     01500007
       01  PV-ITMCLT-CLUSTR               PIC X(40)      VALUE SPACES.  01510007
                                                                        01520007
       01  PROG-VALUES.                                                 01530005
00717      05  PV-MAJ-CL-NULL             PIC S9(04)     COMP           01540005
00718                                                    VALUE ZERO.    01550005
00717      05  PV-SUB-CL-NULL             PIC S9(04)     COMP           01560005
00718                                                    VALUE ZERO.    01570005
00717      05  PV-CLLCTN-DAYS-NBR-NULL    PIC S9(04)     COMP           01580005
00718                                                  VALUE ZERO.      01590005
00717      05  PV-MKUP-PCT-NULL           PIC S9(04)     COMP           01600005
00718                                                    VALUE ZERO.    01610005
00717      05  PV-CENPPC-NBR-NULL         PIC S9(04)     COMP           01620005
00718                                                    VALUE ZERO.    01630005
00717      05  PV-PO-NBR-NULL             PIC S9(04)     COMP           01640005
00718                                                    VALUE ZERO.    01650005
00717      05  PV-DMM-APVL-BY-USR-NULL    PIC S9(04)     COMP           01660005
                                                         VALUE ZERO.    01670005
00717      05  PV-DMM-APVL-DTE-NULL       PIC S9(04)     COMP           01680005
00718                                                    VALUE ZERO.    01690005
00717      05  PV-AP-APVL-BY-USR-NULL     PIC S9(04)     COMP           01700005
00718                                                    VALUE ZERO.    01710005
00717      05  PV-AP-APVL-DTE-NULL        PIC S9(04)     COMP           01720005
00718                                                    VALUE ZERO.    01730005
00717      05  PV-LAST-UPD-BY-USR-NULL    PIC S9(04)     COMP           01740005
00718                                                    VALUE ZERO.    01750005
00717      05  PV-LAST-UPD-DTE-NULL       PIC S9(04)     COMP           01760005
00718                                                    VALUE ZERO.    01770005
TEMP       05  PV-DAALW-DA-LEN            PIC S9(04)     COMP           01780012
TEMP                                                     VALUE ZERO.    01790012
00717      05  PV-CPLT-DTE-NULL           PIC S9(04)     COMP           01800023
00718                                                    VALUE ZERO.    01810023
00717      05  PV-NOTE-TXT-NULL           PIC S9(04)     COMP           01811099
00718                                                    VALUE ZERO.    01812099
      ******************************************************************01820012
00756 * COBOL DECLARATION FOR TABLE TDAALW                              01830012
      ******************************************************************01840012
           EXEC SQL                                                     01850012
               INCLUDE TDAALW                                           01860012
           END-EXEC.                                                    01870005
      ******************************************************************01880007
      * COBOL DECLARATION FOR TABLE TDANOTE                             01890007
      ******************************************************************01900007
           EXEC SQL                                                     01910007
               INCLUDE TDANOTE                                          01920007
           END-EXEC.                                                    01930007
      *                                                                 01940004
           EXEC SQL END DECLARE SECTION END-EXEC.                       01950006
                                                                        01960006
      * ORA COMMUNICATION AREA                                          01970006
      *                                                                 01980006
        01       SQLCA.                                                 01990006
                 05  SQLCAID               PIC X(8).                    02000006
                 05  SQLCABC               PIC S9(9) COMPUTATIONAL.     02010006
                 05  SQLCODE               PIC S9(9) COMPUTATIONAL.     02020006
                 05  SQLERRM.                                           02030006
                     49 SQLERRML           PIC S9(4) COMPUTATIONAL.     02040006
                     49 SQLERRMC           PIC X(70).                   02050006
                 05  SQLERRP               PIC X(8).                    02060006
00963            05  SQLERRD OCCURS 6 TIMES                             02070000
00964                                      PIC S9(9) COMPUTATIONAL.     02080000
00965            05  SQLWARN.                                           02090000
00966                10 SQLWARN0           PIC X(1).                    02100000
00967                10 SQLWARN1           PIC X(1).                    02110000
00968                10 SQLWARN2           PIC X(1).                    02120000
00969                10 SQLWARN3           PIC X(1).                    02130000
00970                10 SQLWARN4           PIC X(1).                    02140000
00971                10 SQLWARN5           PIC X(1).                    02150000
00972                10 SQLWARN6           PIC X(1).                    02160000
00973                10 SQLWARN7           PIC X(1).                    02170000
00974            05  SQLEXT                PIC X(8).                    02180000
00976 *                                                                 02190000
038100* ORA COMMUNICATION AREA2                                         02200000
038200*                                                                 02210000
00977      COPY SQLCA2.                                                 02220000
00976 *                                                                 02230000
00976 *                                                                 02240009
038100* DARD100 COPYBOOK                                                02250017
038200*                                                                 02260009
22405      COPY DARD100.                                                02270090
00976 *                                                                 02280018
00977      COPY DARD104.                                                02290053
00976 *                                                                 02300053
00975  EJECT                                                            02310000
063000*----------------------------------------------------------------*02320000
063100 PROCEDURE DIVISION.                                              02330000
063200                                                                  02340000
063300*----------------------------------------------------------------*02350000
063400*    MAINLINE-LOGIC                                              *02360000
064000*----------------------------------------------------------------*02370000
064100                                                                  02380000
064200 0000-MAINLINE-LOGIC.                                             02390000
064300                                                                  02400000
064800     PERFORM 1000-INITIALIZATION.                                 02410000
064900                                                                  02420000
065000     PERFORM 1100-OPEN-TDAALW-CURSOR.                             02430000
065100                                                                  02440000
065400     PERFORM 2000-PROCESS-TDAALW                                  02450000
065500         UNTIL PS-NO-MORE-DA-TRANS-LEFT.                          02460000
065600                                                                  02470000
           PERFORM 9900-EOJ-LOGIC.                                      02480014
065800                                                                  02490000
066900     GOBACK.                                                      02500000
067000                                                                  02510090
067100/----------------------------------------------------------------*02520090
067200*    LOGON TO ORACLE, AND DECLARE THE ORACLE CURSORS.            *02530000
067600*----------------------------------------------------------------*02540000
067700 1000-INITIALIZATION.                                             02550000
                                                                        02560090
           OPEN OUTPUT  OUT-DA-FILE.                                    02570018
           OPEN INPUT   WKLY-DTE-FILE.                                  02580053
8613F      OPEN INPUT   ORACLE-LOGIN-FILE.                              02590099
067800                                                                  02600000
8613F      PERFORM 1001-CONNECT-TO-ORACLE.                              02600199
           PERFORM 9000-READ-WKLY-DTE-FILE.                             02610055
                                                                        02620036
           DISPLAY '**********************************'.                02630000
           DISPLAY '**------ BEGIN DAKUT300 ------**'.                  02640035
22405      DISPLAY '**********************************'.                02650090
   |       DISPLAY '*'.                                                 02660090
                                                                        03570010
W30328*    EXEC SQL                                                     03600099
W30328*     ALTER SESSION                                               03610099
W30328*           SET NLS_DATE_FORMAT = 'YYYY-MM-DD.HH24.MI.SS'         03620099
W30328*    END-EXEC.                                                    03630099
W30328*                                                                 03640099
      ***************************************************************** 03650010
      *    TDAALW/TDANOTE INFORMATION CURSOR -                          03660027
      *    ONLY EXTRACT ROWS THAT ARE WITHIN THE OPEN FISCAL WEEK AND   03670027
      *    HAVE A VENDOR TYPE NOTE AND ARE STATUS 40.                   03680027
      ***************************************************************** 03690010
                                                                        03700010
           EXEC SQL                                                     03710010
               DECLARE TDAALW_INFO CURSOR FOR                           03720010
                   SELECT A.DR_ALW_NBR                                  03730010
                        , DEPT_NBR                                      03740010
                        , MAJ_CL_NBR                                    03750010
                        , SUB_CL_NBR                                    03760010
                        , ENT_ID                                        03770010
                        , TYP_CDE                                       03780001
W30328*                 , EFF_DTE                                       03790099
W30328                  , TO_CHAR(EFF_DTE,'YYYY-MM-DD.HH24.MI.SS')      03800099
                        , STAT_CDE                                      03810001
                        , CLLCTN_MTHD_CDE                               03820001
                        , CLLCTN_DAYS_NBR                               03830001
                        , NET_CST_AMT                                   03840001
                        , MKUP_PCT                                      03850001
                        , CENPPC_NBR                                    03860001
                        , PO_NBR                                        03870001
                        , RSN_CDE                                       03880021
                        , UPPER(CRE_BY_USR_ID)                          03890029
W30328*                 , CRE_DTE                                       03900099
W30328                  , TO_CHAR(CRE_DTE,'YYYY-MM-DD.HH24.MI.SS')      03910099
                        , UPPER(DMM_UPD_BY_USR_ID)                      03920099
W30328*                 , DMM_UPD_DTE                                   03930099
W30328                  , TO_CHAR(DMM_UPD_DTE,'YYYY-MM-DD.HH24.MI.SS')  03940099
                        , UPPER(AP_UPD_BY_USR_ID)                       03950099
W30328*                 , AP_UPD_DTE                                    03960099
W30328                  , TO_CHAR(AP_UPD_DTE,'YYYY-MM-DD.HH24.MI.SS')   03970099
                        , UPPER(A.LAST_UPD_BY_USR_ID)                   03980099
W30328*                 , A.LAST_UPD_DTE                                03990099
W30328                , TO_CHAR(A.LAST_UPD_DTE,'YYYY-MM-DD.HH24.MI.SS') 04000099
W30328*                 , CPLT_DTE                                      04010099
W30328                  , TO_CHAR(CPLT_DTE,'YYYY-MM-DD.HH24.MI.SS')     04020099
                        , UPPER(NOTE_TXT)                               04030029
                   FROM TDAALW A                                        04040014
                      , TDANOTE N                                       04050014
22405              WHERE (STAT_CDE = '40'                               04060092
22405                AND TYP_CDE <> 'AR'                                04070092
W30021               AND N.DR_ALW_NBR (+) = A.DR_ALW_NBR                04080099
                     AND N.NOTE_TYP_CDE (+) = 'V'                       04090099
                     AND FSCL_MN_NBR                                    04100062
                              = :DAALW-FSCL-MN-NBR                      04110069
                     AND FSCL_YR_NBR                                    04120063
22405                         = :DAALW-FSCL-YR-NBR)                     04130092
  |               UNION                                                 04140092
  |                SELECT A.DR_ALW_NBR                                  04150092
  |                     , DEPT_NBR                                      04160092
  |                     , MAJ_CL_NBR                                    04170092
  |                     , SUB_CL_NBR                                    04180092
  |                     , ENT_ID                                        04190092
  |                     , TYP_CDE                                       04200092
W30328*                 , EFF_DTE                                       04210099
W30328                  , TO_CHAR(EFF_DTE,'YYYY-MM-DD.HH24.MI.SS')      04220099
  |                     , STAT_CDE                                      04230092
  |                     , CLLCTN_MTHD_CDE                               04240092
  |                     , CLLCTN_DAYS_NBR                               04250092
  |                     , NET_CST_AMT                                   04260092
  |                     , MKUP_PCT                                      04270092
  |                     , CENPPC_NBR                                    04280092
  |                     , PO_NBR                                        04290092
  |                     , RSN_CDE                                       04300092
  |                     , UPPER(CRE_BY_USR_ID)                          04310092
W30328*                 , CRE_DTE                                       04320099
W30328                  , TO_CHAR(CRE_DTE,'YYYY-MM-DD.HH24.MI.SS')      04330099
  |                     , UPPER(DMM_UPD_BY_USR_ID)                      04340092
W30328*                 , DMM_UPD_DTE                                   04350099
W30328                  , TO_CHAR(DMM_UPD_DTE,'YYYY-MM-DD.HH24.MI.SS')  04360099
  |                     , UPPER(AP_UPD_BY_USR_ID)                       04370092
W30328*                 , AP_UPD_DTE                                    04380099
W30328                  , TO_CHAR(AP_UPD_DTE,'YYYY-MM-DD.HH24.MI.SS')   04390099
  |                     , UPPER(A.LAST_UPD_BY_USR_ID)                   04400092
W30328*                 , A.LAST_UPD_DTE                                04410099
W30328                , TO_CHAR(A.LAST_UPD_DTE,'YYYY-MM-DD.HH24.MI.SS') 04420099
W30328*                 , CPLT_DTE                                      04430099
W30328                  , TO_CHAR(CPLT_DTE,'YYYY-MM-DD.HH24.MI.SS')     04440099
  |                     , UPPER(NOTE_TXT)                               04450092
  |                FROM TDAALW A                                        04460092
  |                   , TDANOTE N                                       04470092
  |                WHERE (STAT_CDE = '40'                               04480092
  |                  AND TYP_CDE = 'AR'                                 04490092
  |                  AND N.DR_ALW_NBR = A.DR_ALW_NBR                    04500092
  |                  AND N.NOTE_TYP_CDE = 'K'                           04510092
  |                  AND FSCL_MN_NBR                                    04520092
  |                           = :DAALW-FSCL-MN-NBR                      04530092
  |                  AND FSCL_YR_NBR                                    04540092
22405                         = :DAALW-FSCL-YR-NBR)                     04550092
           END-EXEC.                                                    04560014
8613F ******************************************************************04561099
8613F * LOGONS TO ORACLE.                                              *04562099
8613F ******************************************************************04563099
8613F *    - READ THE CONTROL CARD TO GET THE CREDENTIALS AND LOGON    *04564099
8613F *    - ORACLE                                                    *04565099
8613F *----------------------------------------------------------------*04566099
8613F  1001-CONNECT-TO-ORACLE.                                          04567099
8613F                                                                   04568099
8613F      MOVE '1001-CONNECT-TO-ORACLE'   TO PV-ABEND-PARAGRAPH.       04569099
8613F                                                                   04569199
8613F      READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             04569299
8613F         AT END                                                    04569399
8613F            SET ORACLE-LOGIN-EOF      TO TRUE.                     04569499
8613F                                                                   04569599
8613F      IF CC-AUTO-LOGON                                             04569699
8613F         DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'         04569799
8613F         EXEC SQL                                                  04569899
8613F              CONNECT :PC-AUTO-LOGON                               04569999
8613F         END-EXEC                                                  04570099
8613F      ELSE                                                         04570199
8613F         INITIALIZE PV-ORACLE-USERID-LEN                           04570299
8613F                    PV-ORACLE-PASSWORD-LEN                         04570399
8613F         INSPECT CC-ORACLE-USERID                                  04570499
8613F                 TALLYING PV-ORACLE-USERID-LEN                     04570599
8613F                 FOR CHARACTERS BEFORE INITIAL SPACE               04570699
8613F         INSPECT CC-ORACLE-PASSWORD                                04570799
8613F                 TALLYING PV-ORACLE-PASSWORD-LEN                   04570899
8613F                 FOR CHARACTERS BEFORE INITIAL SPACE               04570999
8613F         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO     04571099
8613F                 USERNAME-ARR                                      04571199
8613F         MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN              04571299
8613F         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     04571399
8613F                 PASSWD-ARR                                        04571499
8613F         MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                04571599
8613F         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     04571699
8613F              PASSWD-ARR                                           04571799
8613F         MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                04571899
8613F         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO     04571999
8613F              USERNAME-ARR                                         04572099
8613F         MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN              04572199
8613F         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     04572299
8613F              PASSWD-ARR                                           04572399
8613F         MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                04572499
8613F         DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '    04572599
8613F              USERNAME-ARR                                         04572699
8613F         EXEC SQL                                                  04572799
8613F              CONNECT :USERNAME IDENTIFIED BY :PASSWD              04572899
8613F         END-EXEC                                                  04572999
8613F         INITIALIZE CC-ORACLE-PASSWORD                             04573099
8613F                    PASSWD                                         04573199
8613F      END-IF.                                                      04573299
8613F                                                                   04573399
8613F      IF (SQLCODE NOT = 0)                                         04573499
8613F          DISPLAY PV-ABEND-PARAGRAPH                               04573599
8613F          PERFORM 9999-SQL-ERROR                                   04573699
8613F          PERFORM 9999-SQL-ERROR                                   04573999
8613F      END-IF.                                                      04574099
                                                                        04574199
                                                                        04575014
      /----------------------------------------------------------------*04580090
      *    OPEN-TDAALW-INFO-CURSOR                                     *04590014
      *----------------------------------------------------------------*04600014
       1100-OPEN-TDAALW-CURSOR.                                         04610014
                                                                        04620014
           MOVE '1100-OPEN-TDAALW-CURSOR' TO PV-ABEND-PARAGRAPH.        04630014
                                                                        04640014
           MOVE DA104-OPN-FSCL-MN-NBR TO PV-FSCL-MN-NBR.                04650070
           MOVE PV-FSCL-MN-NBR        TO DAALW-FSCL-MN-NBR.             04660070
                                                                        04670070
           MOVE DA104-OPN-FSCL-YR-NBR TO PV-FSCL-YR-NBR.                04680070
           MOVE PV-FSCL-YR-NBR        TO DAALW-FSCL-YR-NBR.             04690070
                                                                        04700069
           EXEC SQL                                                     04710014
               OPEN TDAALW_INFO                                         04720014
           END-EXEC.                                                    04730014
                                                                        04740014
           EVALUATE TRUE                                                04750014
             WHEN SQLCODE = ZEROS                                       04760014
               CONTINUE                                                 04770014
             WHEN SQLCODE = 1403                                        04780014
               SET PS-NO-MORE-DA-TRANS-LEFT TO TRUE                     04790014
               CONTINUE                                                 04800014
             WHEN OTHER                                                 04810014
               DISPLAY PV-ABEND-PARAGRAPH                               04820014
               PERFORM 9999-SQL-ERROR                                   04830014
           END-EVALUATE.                                                04840014
                                                                        04850014
       EJECT                                                            04860014
      *----------------------------------------------------------------*04870014
      *    FETCH-TDAALW-INFO-INFO                                      *04880014
      *      FETCH A ROW FROM THE CURSOR                               *04890014
      *----------------------------------------------------------------*04900014
       1200-FETCH-TDAALW-INFO.                                          04910014
                                                                        04920014
           MOVE '1200-FETCH-TDAALW-INFO' TO PV-ABEND-PARAGRAPH.         04930014
                                                                        04940014
           EXEC SQL                                                     04950002
               FETCH TDAALW_INFO                                        04960002
               INTO :DAALW-DR-ALW-NBR                                   04970005
                  , :DAALW-DEPT-NBR                                     04980005
                  , :DAALW-MAJ-CL-NBR         :PV-MAJ-CL-NULL           04990005
                  , :DAALW-SUB-CL-NBR         :PV-SUB-CL-NULL           05000005
                  , :DAALW-ENT-ID                                       05010005
                  , :DAALW-TYP-CDE                                      05020005
                  , :DAALW-EFF-DTE                                      05030005
                  , :DAALW-STAT-CDE                                     05040005
                  , :DAALW-CLLCTN-MTHD-CDE                              05050005
                  , :DAALW-CLLCTN-DAYS-NBR    :PV-CLLCTN-DAYS-NBR-NULL  05060005
                  , :DAALW-NET-CST-AMT                                  05070005
                  , :DAALW-MKUP-PCT           :PV-MKUP-PCT-NULL         05080005
                  , :DAALW-CENPPC-NBR         :PV-CENPPC-NBR-NULL       05090005
                  , :DAALW-PO-NBR             :PV-PO-NBR-NULL           05100005
                  , :DAALW-RSN-CDE                                      05110023
                  , :DAALW-CRE-BY-USR-ID                                05120023
                  , :DAALW-CRE-DTE                                      05130023
                  , :DAALW-DMM-UPD-BY-USR-ID  :PV-DMM-APVL-BY-USR-NULL  05140023
                  , :DAALW-DMM-UPD-DTE        :PV-DMM-APVL-DTE-NULL     05150023
                  , :DAALW-AP-UPD-BY-USR-ID   :PV-AP-APVL-BY-USR-NULL   05160023
                  , :DAALW-AP-UPD-DTE         :PV-AP-APVL-DTE-NULL      05170023
                  , :DAALW-LAST-UPD-BY-USR-ID :PV-LAST-UPD-BY-USR-NULL  05180023
                  , :DAALW-LAST-UPD-DTE       :PV-LAST-UPD-DTE-NULL     05190023
                  , :DAALW-CPLT-DTE           :PV-CPLT-DTE-NULL         05200023
W30021            , :DANOTE-NOTE-TXT          :PV-NOTE-TXT-NULL         05210099
           END-EXEC.                                                    05220014
                                                                        05230014
           EVALUATE TRUE                                                05240014
             WHEN SQLCODE = ZEROS                                       05250014
               ADD 1 TO PA-ROWS-FETCHED                                 05260014
             WHEN SQLCODE = 1403                                        05270014
               SET PS-NO-MORE-DA-TRANS-LEFT TO TRUE                     05280014
             WHEN OTHER                                                 05290014
               DISPLAY PV-ABEND-PARAGRAPH                               05300014
               PERFORM 9999-SQL-ERROR                                   05310014
           END-EVALUATE.                                                05320014
                                                                        05330014
       EJECT                                                            05340014
      *----------------------------------------------------------------*05350014
      *    CLOSE-TDAALW-CURSOR                                         *05360014
      *----------------------------------------------------------------*05370014
       1300-CLOSE-TDAALW-CURSOR.                                        05380014
                                                                        05390014
           MOVE '1300-CLOSE-TDAALW-INFO-CURSOR' TO PV-ABEND-PARAGRAPH.  05400014
                                                                        05410014
           EXEC SQL                                                     05420014
               CLOSE TDAALW_INFO                                        05430014
           END-EXEC.                                                    05440014
                                                                        05450014
           EVALUATE TRUE                                                05460014
             WHEN SQLCODE = ZEROS                                       05470014
               CONTINUE                                                 05480014
             WHEN OTHER                                                 05490014
               DISPLAY PV-ABEND-PARAGRAPH                               05500014
               PERFORM 9999-SQL-ERROR                                   05510014
           END-EVALUATE.                                                05520014
                                                                        05530014
       EJECT                                                            05540014
      *----------------------------------------------------------------*05550014
      *    2000-PROCESS-TDAALW                                         *05560014
      *      THIS IS PERFORMED ONLY VIA THE 0000-DAKUT300              *05570034
      *      PURPOSE: READ AND PROCESS THE TDAALW INFO CURSOR          *05580014
      *----------------------------------------------------------------*05590014
       2000-PROCESS-TDAALW.                                             05600014
                                                                        05610040
           INITIALIZE DCLTDAALW.                                        05620046
           PERFORM 1200-FETCH-TDAALW-INFO.                              05630014
                                                                        05631099
W30021     IF PV-NOTE-TXT-NULL = -1                                     05632099
W30021         MOVE SPACES TO DANOTE-NOTE-TXT                           05633099
W30021     ELSE                                                         05634099
               INSPECT DANOTE-NOTE-TXT REPLACING ALL '`' BY "'"         05640099
      *---     REPLACE ALL  (X'AD') WITH ( ANDç (X'BD') WITH )          05650099
               INSPECT DANOTE-NOTE-TXT REPLACING ALL X'AD' BY '('       05660099
               INSPECT DANOTE-NOTE-TXT REPLACING ALL X'BD' BY ')'       05670099
      *---     REPLACE ALL  'HARD RETURN' (X'15') WITH ' ' (HARD RETURN)05680099
               INSPECT DANOTE-NOTE-TXT REPLACING ALL X'15' BY ' '       05690099
      *---     REPLACE ALL  'CAROT'(X'B0') WITH ' '                     05700099
               INSPECT DANOTE-NOTE-TXT REPLACING ALL X'B0' BY ' '       05710099
      *---     REPLACE ALL  'NOT SIGN'(X'5F') WITH ' '                  05720099
               INSPECT DANOTE-NOTE-TXT REPLACING ALL X'5F' BY ' '       05730099
           END-IF.                                                      05731099
                                                                        05732099
           IF PS-MORE-DA-TRANS-LEFT                                     05740001
               PERFORM 2200-PREPARE-DATA                                05750005
               WRITE OUT-DA-RECORD FROM DARD100-RECORD                  05760017
               ADD 1 TO PA-RECORDS-WRITTEN                              05770014
           END-IF.                                                      05780001
           MOVE 0 TO PV-MAJ-CL-NULL                                     05790014
                     PV-SUB-CL-NULL                                     05800014
                     PV-CLLCTN-DAYS-NBR-NULL                            05810014
                     PV-MKUP-PCT-NULL                                   05820014
                     PV-CENPPC-NBR-NULL                                 05830014
                     PV-PO-NBR-NULL                                     05840014
                     PV-DMM-APVL-BY-USR-NULL                            05850014
                     PV-DMM-APVL-DTE-NULL                               05860014
                     PV-AP-APVL-BY-USR-NULL                             05870014
                     PV-AP-APVL-DTE-NULL                                05880014
                     PV-LAST-UPD-BY-USR-NULL                            05890014
                     PV-LAST-UPD-DTE-NULL                               05900023
                     PV-CPLT-DTE-NULL                                   05910099
                     PV-NOTE-TXT-NULL.                                  05911099
                                                                        05920014
       2200-PREPARE-DATA.                                               05930005
           IF DAALW-CLLCTN-DAYS-NBR NUMERIC                             05940005
               CONTINUE                                                 05950005
           ELSE                                                         05960005
               MOVE 0 TO DAALW-CLLCTN-DAYS-NBR                          05970005
           END-IF.                                                      05980005
           IF DAALW-MKUP-PCT NUMERIC                                    05990005
               CONTINUE                                                 06000005
           ELSE                                                         06010005
               MOVE 0 TO DAALW-MKUP-PCT                                 06020005
           END-IF.                                                      06030005
           IF DAALW-CENPPC-NBR NUMERIC                                  06040005
               CONTINUE                                                 06050005
           ELSE                                                         06060005
               MOVE 0 TO DAALW-CENPPC-NBR                               06070005
           END-IF.                                                      06080005
           IF DAALW-PO-NBR NUMERIC                                      06090005
               CONTINUE                                                 06100005
           ELSE                                                         06110005
               MOVE 0 TO DAALW-PO-NBR                                   06120036
           END-IF.                                                      06130005
                                                                        06140045
           INITIALIZE DARD100-RECORD.                                   06150045
           MOVE DCLTDAALW           TO DARD100-RECORD.                  06160036
           MOVE DANOTE-NOTE-TXT     TO PV-TDANOTE.                      06170036
           MOVE PV-TDANOTE-PT1      TO DA100-NOTE-LINE1.                06180036
           MOVE PV-TDANOTE-PT2      TO DA100-NOTE-LINE2.                06190036
      *-- ASSIGN STORE TO THE DEBIT ALLOWANCE                           06200092
22405      IF DA100-TYP-CDE-AR                                          06210092
22405        MOVE PC-STR-811    TO DA100-STR-NBR                        06220092
22405      ELSE                                                         06230092
             MOVE PC-STR-400      TO DA100-STR-NBR                      06240092
22405      END-IF.                                                      06250092
                                                                        06260041
W30021*-- CALCULATE RETAIL FOR MARKDOWN ALLOWANCE, ASSET RECOVERY,      06340099
  |   *-- AND MKDN ALW PROFIT ASST - CST/RTL                            06350099
  |        IF DA100-TYP-CDE-MA OR DA100-TYP-CDE-AR OR DA100-TYP-CDE-PR  06351099
  |            COMPUTE PV-PCTG = (1 - (DA100-MKUP-PCT / 100))           06360090
  |            COMPUTE DA100-RTL-AMT ROUNDED =                          06370090
  |                    DA100-NET-CST-AMT /                              06380090
  |                    PV-PCTG                                          06390090
W30021     ELSE                                                         06400099
               MOVE 0 TO DA100-RTL-AMT                                  06410042
           END-IF.                                                      06420041
                                                                        06430041
      *----------------------------------------------------------------*06440054
      *    READ WEEKLY DATE FILE                                        06450054
      *----------------------------------------------------------------*06460054
       9000-READ-WKLY-DTE-FILE.                                         06470054
                                                                        06480054
           READ WKLY-DTE-FILE INTO DARD104-RECORD.                      06490054
                                                                        06500041
      *----------------------------------------------------------------*06620014
      * 9000-READ-ORACLE-SRC-CTL.                                       06630090
      *----------------------------------------------------------------*06640014
       9900-EOJ-LOGIC.                                                  06650014
           PERFORM 1300-CLOSE-TDAALW-CURSOR.                            06660014
           CLOSE  OUT-DA-FILE.                                          06670073
           CLOSE  WKLY-DTE-FILE.                                        06680073
           DISPLAY 'ROWS FETCHED    ' PA-ROWS-FETCHED.                  06700018
           DISPLAY 'RECORDS WRITTEN ' PA-RECORDS-WRITTEN.               06710018
           DISPLAY '**------ END DAKUT300 ------**'.                    06720039
                                                                        06730014
       9999-SQL-ERROR.                                                  06740000
                                                                        06750000
           MOVE SQLCODE    TO SQLCODE2.                                 06760000
           MOVE SQLERRD(3) TO SQLERRD3.                                 06770000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   06780000
           DISPLAY '** PROGRAM        ** = DAKUT300'.                   06790034
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06800000
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06810000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   06820000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  06830000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                06840000
                                                                        06850000
           MOVE SPACES TO WS-MSG-TEXT.                                  06860000
      *    GET FULL TEXT OF ERROR MESSAGE                               06870000
                                                                        06880000
           CALL 'SQLGLM' USING WS-MSG-TEXT,                             06890000
                               WS-MAX-SIZE,                             06900000
                               WS-MSG-LENGTH.                           06910000
           DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               06920000
                                                                        06930000
           MOVE +4013 TO PV-ABEND-CODE.                                 06940000
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06950000
                                                                        06960000
      *    END OF SOURCE CODE FOR DAKUT300                            * 06980034
      *---------------------------------------------------------------* 06990014
