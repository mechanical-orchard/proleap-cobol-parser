000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    APKCS361.                                         00040099
000500 AUTHOR.        MARK BURNSIDE.                                    00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  08-12-98.                                         00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    A361 - ADJUSTMENT JOURNAL LIST SCREEN                      * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF ADJUSTMENT JOURNAL        * 00130099
001400*    ENTRIES.  IT WILL DISPLAY THE:                             * 00140099
001500*        DOCUMENT NUMBER                                        * 00150099
001600*        PURCHASE ORDER NUMBER                                  * 00160099
001700*        VENDOR                                                 * 00170099
001800*        TRANSACTION CODE                                       * 00180099
001900*        TRANSACTION TYPE                                       * 00190099
002000*        GROSS AMOUNT                                           * 00200099
002100*        ENTER DATE.                                            * 00210099
002200*    THE APPROPRIATE SCREEN (PROGRAM) IS INVOKED WHEN THE USER  * 00220099
002300*    SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.      * 00230099
002400*    THERE IS NO SELECTION REQUIRED TO ADD A NEW ADJUSTMENT     * 00240099
002500*    JOURNAL ENTRY.                                             * 00250099
002600*                                                               * 00260099
002700*---------------------------------------------------------------* 00270099
002800*                                                               * 00280099
002900*  APKCS361 KOHLS ADJUSTMENT JOURNAL LIST SCREEN     08/12/98   * 00290099
003000* CHANGES MADE BY:  MARK BURNSIDE                               * 00300099
003100*                                                               * 00310099
003200* CHANGES:                                                      * 00320099
003300*                                                               * 00330099
003400* MODIFIED MAP AND PROGRAM TO CHANGE THE AMOUNT FIELD ON THE    * 00340099
003500* ADJUSTMENT QUERY SCREEN FROM GROSS AMOUNT TO NET AMOUNT.      * 00350099
003600*                                                               * 00360099
003700* CHANGES MADE BY:  ROBIN BERNOSKI                   01/06/00   * 00370099
003800*                                                               * 00380099
003900* DATE 12/12/2000                                                 00390099
004000* CHANGE MADE:  CHANGED THE LEGTH OF BOTH THE                   * 00400099
004100* ASC-KEY-VENDOR-NUMBER AND LQW-VENDOR-NUMBER FROM TEN          * 00410099
004200* CHARACTERS TO NINE CHARACTERS TO IMPROVE THE EFFICIENCY OF    * 00420099
004300* SQL CALLS TO THE ADJUSTMENT JOURNAL DB2 TABLES.               * 00430099
004400* CHANGES MADE BY:  MARK BURNSIDE                WR/IR #: 21699 * 00440099
004500*                                                               * 00450099
004600* DATE  01/29/2007                                              * 00460099
004700*     CHANGE MADE: INCREASED THE NET AMOUNT DISPLAY BY 2 DIGITS * 00470099
004800*     TO FIX THE TRUNCATION OF IT.  THIS WAS ACCOMPLISHED BY    * 00480099
004900*     REMOVING 2 SPACES FROM THE VENDOR NAME DISPLAY.           * 00490099
005000*     MADE BY: MIKE BESKE              WR/IR #: P000977716      * 00500099
005100*                                                               * 00510099
005200* DATE  06/24/2019                                              * 00520099
005300*     CHANGE MADE: MAINFRAME REFACTORING TESTING SOMETIMES      * 00530099
005400*     RESULTS IN ABENDS WHEN THE NUMBER OF ROWS FETCHED EXCEEDS * 00540099
005500*     32,768 RECORDS BECAUSE PV-LIST-ITEM-NUMBER IS DEFINED AS  * 00550099
005600*     DEFINED AS S9(04) COMP.  CHANGE IT TO S9(09) COMP.        * 00560099
005700*     THIS RESULT WOULD BE THE RESULT OF USER ENTERING ONLY A   * 00570099
005800*     VENDOR OR DEPT NUMBER THAT INCLUDES A LARGE NUMBER OF     * 00580099
005900*     TABLE ENTRIES.                                            * 00590099
006000*     MADE BY: JIM HUNTER              WR/IR #: CHG0226268      * 00600099
006100*                                                               * 00610099
006200* DATE  07/01/2019                                              * 00620099
006300*     CHANGE MADE: THE PREVIOUS CHANGE HANDLED VOLUMES IN THE   * 00630099
006400*     TEST REGIONS OF OVER 87,000 ROWS, HOWEVER, IN PROD THERE  * 00640099
006500*     WERE CURSORS EXECUTED THAT TRIED TO RETURN OVER 5.5       * 00650099
006600*     MILLION ROWS WHICH STILL RESULTED IN ABENDS.              * 00660099
006700*     LIMITING ALL 13 CURSORS IN THE PROGRAM TO 50,000 ITEM     * 00670099
006800*     ROWS BY USING THE FETCH FIRST 50000 ROWS ONLY CLAUSE.     * 00680099
006900*     MADE BY: JIM HUNTER              WR/IR #: CHG0226562      * 00690099
007000*                                                               * 00700099
007010*---------------------------------------------------------------* 00701099
007020* DATE  09/01/2021                                                00702099
007030*            - CHANGE CALL OF  DPKUT100  TO                     * 00703099
007040*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00704099
007050*              MAKING THE CALL DYNAMIC VS STATIC                * 00705099
007060*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        00706099
007070*                                                                *00707099
007071* DATE  10/24/2022                                                00707199
007072*     CHANGE MADE: ADD COPYBOOK DPWS930                           00707299
007073*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API  * 00707399
007074*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864      * 00707499
007080*----------------------------------------------------------------*00708099
007100*---------------------------------------------------------------* 00710099
007200 EJECT                                                            00720099
007300 ENVIRONMENT DIVISION.                                            00730099
007400                                                                  00740099
007500 DATA DIVISION.                                                   00750099
007600                                                                  00760099
007700 WORKING-STORAGE SECTION.                                         00770099
007800                                                                  00780099
007900 01  DK-DB2-KEYS.                                                 00790099
008000     15  DK-VND-NBR                     PIC  X(09)  VALUE SPACE.  00800099
008100     15  DK-PO-NBR                      PIC  S9(09) VALUE ZERO    00810099
008200                                                    COMP.         00820099
008300     15  DK-ENT-NM                      PIC  X(30)  VALUE SPACE.  00830099
008400     15  DK-ENT-BYTE  REDEFINES DK-ENT-NM                         00840099
008500                      OCCURS 30 TIMES                             00850099
008600                                        PIC  X(01).               00860099
008700     15  DK-DOCUMENT-NUMBER-LOW         PIC  X(16)                00870099
008800                                              VALUE LOW-VALUES.   00880099
008900     15  DK-DOCUMENT-NUMBER-HIGH        PIC  X(16)                00890099
009000                                              VALUE HIGH-VALUES.  00900099
009100     15  DK-DEPARTMENT                  PIC  X(03)  VALUE SPACE.  00910099
009200     15  DK-ACCT-NO                     PIC  X(07)  VALUE SPACE.  00920099
009300     15  DK-TRAN-CDE-LOW                PIC  X(02)                00930099
009400                                              VALUE LOW-VALUES.   00940099
009500     15  DK-TRAN-CDE-HIGH               PIC  X(02)                00950099
009600                                              VALUE HIGH-VALUES.  00960099
009700     15  DK-TRAN-TYP-LOW                PIC  X(02)                00970099
009800                                              VALUE LOW-VALUES.   00980099
009900     15  DK-TRAN-TYP-HIGH               PIC  X(02)                00990099
010000                                              VALUE HIGH-VALUES.  01000099
010100     15  DK-START-DATE                  PIC  X(10)  VALUE SPACE.  01010099
010200     15  DK-END-DATE                    PIC  X(10)  VALUE SPACE.  01020099
010300                                                                  01030099
010400 01  PC-PROGRAM-CONSTANTS.                                        01040099
010500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01050099
010600                                                    'AP361A  '.   01060099
010700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01070099
010800                                                    'APKM361 '.   01080099
010900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01090099
011000                                                    'APKCS361'.   01100099
011100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01110099
011200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      01120099
011300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    01130099
011400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     01140099
011500                                                    COMP SYNC.    01150099
011600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01160099
011700                                                    COMP SYNC.    01170099
011800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01180099
011900                                                    +1000000      01190099
012000                                                    COMP-3.       01200099
012100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01210099
012200                                                    COMP SYNC.    01220099
012300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01230099
012400                                                    COMP-3.       01240099
012500     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    01250099
012600     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  01260099
012700     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  01270099
012800     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  01280099
012900     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  01290099
013000                                                                  01300099
013100     05  PC-TSYMSG-NUMBERS.                                       01310099
013200         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01320099
013300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01330099
013400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01340099
013500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01350099
013600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01360099
013700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01370099
013800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01380099
013900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01390099
014000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01400099
014100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01410099
014200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01420099
014300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01430099
014400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01440099
014500         10  PC-TSYMSG-00831            PIC  9(05)  VALUE 00831.  01450099
014600         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01460099
014700*                                                                 01470099
014800 01  PS-PROGRAM-SWITCHES.                                         01480099
014900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01490099
015000         88  PS-NO-ERROR                            VALUE 'Y'.    01500099
015100         88  PS-ERROR                               VALUE 'N'.    01510099
015200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01520099
015300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01530099
015400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01540099
015500     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01550099
015600         88  PS-DONE                                VALUE 'Y'.    01560099
015700         88  PS-NOT-DONE                            VALUE 'N'.    01570099
015800*                                                                 01580099
015900 01  PV-PROGRAM-VARIABLES.                                        01590099
016000     05  PV-SUB                         PIC S9(04)  VALUE +0      01600099
016100                                                    COMP SYNC.    01610099
016200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01620099
016300                                                    COMP SYNC.    01630099
016400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01640099
016500                                                    COMP-3.       01650099
016600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01660099
016700                                                    COMP-3.       01670099
016800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01680099
016900                                                    COMP-3.       01690099
017000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01700099
017100                                                    COMP-3.       01710099
017200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01720099
017300                                                    COMP-3.       01730099
017400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01740099
017500                                                    COMP-3.       01750099
017600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01760099
017700                                                    COMP-3.       01770099
017800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01780099
017900                                                    COMP SYNC.    01790099
018000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01800099
018100                                                    COMP SYNC.    01810099
018200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01820099
018300                                                    COMP SYNC.    01830099
018400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01840099
018500                                                    COMP SYNC.    01850099
018600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01860099
018700                                                    COMP SYNC.    01870099
018800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01880099
018900                                                    COMP SYNC.    01890099
019000*    05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01900099
019100     05  PV-LIST-ITEM-NUMBER            PIC S9(09)  VALUE +0      01910099
019200                                                    COMP SYNC.    01920099
019300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01930099
019400                                                    COMP SYNC.    01940099
019500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01950099
019600                                                    COMP SYNC.    01960099
019700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01970099
019800                                                    COMP SYNC.    01980099
019900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01990099
020000                                                    COMP SYNC.    02000099
020100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02010099
020200                                                    COMP SYNC.    02020099
020300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02030099
020400                                                    COMP SYNC.    02040099
020500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02050099
020600                                                    COMP SYNC.    02060099
020700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02070099
020800                                                    COMP SYNC.    02080099
020900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02090099
021000                                                    COMP SYNC.    02100099
021100******************************************************************02110099
021200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02120099
021300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02130099
021400**  APPLICATION-SPECIFIC COMMAREA.                              **02140099
021500******************************************************************02150099
021600 01  LQW-LIST-QUEUE-WORK-AREA.                                    02160099
021700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02170099
021800     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           02180099
021900                                        INDEXED BY LQW-IDX.       02190099
022000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02200099
022100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02210099
022200         10  LQW-SELECTED-SW            PIC  X(01).               02220099
022300             88  LQW-SELECT                         VALUE 'S'.    02230099
022400             88  LQW-DESELECT                       VALUE ' '.    02240099
022500         10  LQW-ACTION                 PIC  X(03).               02250099
022600         10  LQW-DOCUMENT-NO            PIC  X(16).               02260099
022700         10  LQW-PO-NBR                 PIC  S9(09) COMP.         02270099
022800         10  LQW-VENDOR-NUMBER          PIC  X(09).               02280099
022900         10  LQW-VENDOR-NAME            PIC  X(13).               02290099
023000         10  LQW-TRAN-CDE               PIC  X(02).               02300099
023100         10  LQW-TRAN-TYPE              PIC  X(02).               02310099
023200         10  LQW-NET-AMT                PIC  S9(09)V99            02320099
023300                                                 COMP-3.          02330099
023400         10  LQW-ENTER-DATE             PIC  X(08).               02340099
023500         10  LQW-DOC-DTE                PIC  X(10).               02350099
023600                                                                  02360099
023700     EJECT                                                        02370099
023800*---------------------------------------------------------------* 02380099
023900*  RECORD LAYOUT FOR THE ADJUSTMENT SELECTION TEMP STORAGE      * 02390099
024000*  QUEUE.                                                       * 02400099
024100*---------------------------------------------------------------* 02410099
024200                                                                  02420099
024300     COPY APWS362.                                                02430099
024400                                                                  02440099
024500     EJECT                                                        02450099
024600*---------------------------------------------------------------* 02460099
024700*    MAP LAYOUT                                                 * 02470099
024800*---------------------------------------------------------------* 02480099
024900                                                                  02490099
025000     COPY APKM361.                                                02500099
025100*                                                                 02510099
025200 01  MR-OCCURS-LAYOUT                   REDEFINES  AP361AO.       02520099
025300     05  FILLER                         PIC X(42).                02530099
025400     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02540099
025500         10  MR-SELECTL                 PIC S9(04) COMP.          02550099
025600         10  MR-SELECTA                 PIC  X(01).               02560099
025700         10  MR-SELECTC                 PIC  X(01).               02570099
025800         10  MR-SELECTH                 PIC  X(01).               02580099
025900         10  MR-SELECTI                 PIC  X(01).               02590099
026000                                                                  02600099
026100         10  MR-ACTIONL                 PIC S9(04) COMP.          02610099
026200         10  MR-ACTIONA                 PIC  X(01).               02620099
026300         10  MR-ACTIONC                 PIC  X(01).               02630099
026400         10  MR-ACTIONH                 PIC  X(01).               02640099
026500         10  MR-ACTION                  PIC  X(03).               02650099
026600                                                                  02660099
026700         10  MR-DOCUMENT-NOL            PIC S9(04) COMP.          02670099
026800         10  MR-DOCUMENT-NOA            PIC  X(01).               02680099
026900         10  MR-DOCUMENT-NOC            PIC  X(01).               02690099
027000         10  MR-DOCUMENT-NOH            PIC  X(01).               02700099
027100         10  MR-DOCUMENT-NO             PIC  X(16).               02710099
027200                                                                  02720099
027300         10  MR-PO-NUMBERL              PIC S9(04) COMP.          02730099
027400         10  MR-PO-NUMBERA              PIC  X(01).               02740099
027500         10  MR-PO-NUMBERC              PIC  X(01).               02750099
027600         10  MR-PO-NUMBERH              PIC  X(01).               02760099
027700         10  MR-PO-NUMBER               PIC  X(09).               02770099
027800         10  MR-PO-NUMBER-9 REDEFINES                             02780099
027900             MR-PO-NUMBER               PIC  ZZZZZZZZ9.           02790099
028000                                                                  02800099
028100         10  MR-VENDOR-TEXTL            PIC S9(04) COMP.          02810099
028200         10  MR-VENDOR-TEXTA            PIC  X(01).               02820099
028300         10  MR-VENDOR-TEXTC            PIC  X(01).               02830099
028400         10  MR-VENDOR-TEXTH            PIC  X(01).               02840099
028500         10  MR-VENDOR-TEXT             PIC  X(11).               02850099
028600                                                                  02860099
028700         10  MR-TRAN-CDEL               PIC S9(04) COMP.          02870099
028800         10  MR-TRAN-CDEA               PIC  X(01).               02880099
028900         10  MR-TRAN-CDEC               PIC  X(01).               02890099
029000         10  MR-TRAN-CDEH               PIC  X(01).               02900099
029100         10  MR-TRAN-CDE                PIC  X(02).               02910099
029200                                                                  02920099
029300         10  MR-TRAN-TYPEL              PIC S9(04) COMP.          02930099
029400         10  MR-TRAN-TYPEA              PIC  X(01).               02940099
029500         10  MR-TRAN-TYPEC              PIC  X(01).               02950099
029600         10  MR-TRAN-TYPEH              PIC  X(01).               02960099
029700         10  MR-TRAN-TYPE               PIC  X(02).               02970099
029800                                                                  02980099
029900         10  MR-NET-AMTL                PIC S9(04) COMP.          02990099
030000         10  MR-NET-AMTA                PIC  X(01).               03000099
030100         10  MR-NET-AMTC                PIC  X(01).               03010099
030200         10  MR-NET-AMTH                PIC  X(01).               03020099
030300         10  MR-NET-AMT-X.                                        03030099
030400             15  MR-NET-AMT-N           PIC ---,---,--9.99.       03040099
030500                                                                  03050099
030600         10  MR-ENT-DATEL               PIC S9(04) COMP.          03060099
030700         10  MR-ENT-DATEA               PIC  X(01).               03070099
030800         10  MR-ENT-DATEC               PIC  X(01).               03080099
030900         10  MR-ENT-DATEH               PIC  X(01).               03090099
031000         10  MR-ENT-DATE                PIC  X(08).               03100099
031100                                                                  03110099
031200     EJECT                                                        03120099
031300*---------------------------------------------------------------* 03130099
031400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03140099
031500*---------------------------------------------------------------* 03150099
031600                                                                  03160099
031700     COPY DPWS015.                                                03170099
031800                                                                  03180099
031900*---------------------------------------------------------------* 03190099
032000*    FUNCTION KEYS COPYBOOK.                                    * 03200099
032100*---------------------------------------------------------------* 03210099
032200                                                                  03220099
032300     COPY DPWS016.                                                03230099
032400                                                                  03240099
032500*---------------------------------------------------------------* 03250099
032600*    NUMERIC EDIT LAYOUT.                                       * 03260099
032700*---------------------------------------------------------------* 03270099
032800                                                                  03280099
032900     COPY DPWS010I.                                               03290099
033000 EJECT                                                            03300099
033100*---------------------------------------------------------------* 03310099
033200*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03320099
033300*---------------------------------------------------------------* 03330099
033400                                                                  03340099
033500     COPY DPWS030.                                                03350099
033510     COPY DPWS930.                                                03351099
033600 EJECT                                                            03360099
033700*---------------------------------------------------------------* 03370099
033800*    STANDARD COMMAREA.                                         * 03380099
033900*---------------------------------------------------------------* 03390099
034000                                                                  03400099
034100     COPY DPWS020.                                                03410099
034200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03420099
034300                                                                  03430099
034400*---------------------------------------------------------------* 03440099
034500* INTER-APPLICATION COMMAREA.                                   * 03450099
034600*   APWS360 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03460099
034700*             SPEC SCREEN.                                      * 03470099
034800*   APWS361 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03480099
034900*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03490099
035000*---------------------------------------------------------------* 03500099
035100                                                                  03510099
035200         10  INTER-APPL-COMM-AREA       PIC X(200).               03520099
035300     COPY APWS360.                                                03530099
035400     COPY APWS361.                                                03540099
035500*---------------------------------------------------------------* 03550099
035600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03560099
035700*---------------------------------------------------------------* 03570099
035800         10  ASC-SPECIFIC-COMMAREA.                               03580099
035900             15  ASC-LIST-KEYS.                                   03590099
036000                 20  ASC-KEY-VENDOR-NUMBER           PIC  X(09).  03600099
036100                 20  ASC-KEY-PO-NBR                  PIC S9(09)   03610099
036200                                                         COMP-3.  03620099
036300                 20  ASC-KEY-VENDOR-NAME             PIC  X(30).  03630099
036400                 20  ASC-KEY-DOCUMENT-NO-LOW         PIC  X(16).  03640099
036500                 20  ASC-KEY-DOCUMENT-NO-HIGH        PIC  X(16).  03650099
036600                 20  ASC-KEY-DEPARTMENT              PIC  X(03).  03660099
036700                 20  ASC-KEY-ACCT-NO                 PIC  X(07).  03670099
036800                 20  ASC-KEY-TRAN-CDE-LOW            PIC  X(02).  03680099
036900                 20  ASC-KEY-TRAN-CDE-HIGH           PIC  X(02).  03690099
037000                 20  ASC-KEY-TRAN-TYP-LOW            PIC  X(02).  03700099
037100                 20  ASC-KEY-TRAN-TYP-HIGH           PIC  X(02).  03710099
037200                 20  ASC-KEY-START-DATE              PIC  X(10).  03720099
037300                 20  ASC-KEY-END-DATE                PIC  X(10).  03730099
037400                 20  ASC-KEY-DOC-DTE                 PIC  X(10).  03740099
037500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03750099
037600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03760099
037700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03770099
037800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03780099
037900                                                                  03790099
038000                 20  ASC-ITEM-ARRAY.                              03800099
038100                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03810099
038200                         30  ASC-LIST-ITEM-NUMBER                 03820099
038300                                                     PIC S9(09)   03830099
038400                                                     COMP-3.      03840099
038500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03850099
038600                             88  ASC-VALID-SELECT    VALUE ' '    03860099
038700                                                           'S'    03870099
038800                                                           'B'    03880099
038900                                                           'E'.   03890099
039000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03900099
039100                             88  ASC-TEMP-SELECT     VALUE 'S'.   03910099
039200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03920099
039300                             88  ASC-TEMP-END        VALUE 'E'.   03930099
039400                         30  ASC-SELECTED-SW         PIC  X(01).  03940099
039500                             88  ASC-NO-SELECT       VALUE ' '.   03950099
039600                             88  ASC-SELECT          VALUE 'S'.   03960099
039700                             88  ASC-BEGIN           VALUE 'B'.   03970099
039800                             88  ASC-END             VALUE 'E'.   03980099
039900                         30  ASC-ACTION              PIC  X(03).  03990099
040000                         30  ASC-DOCUMENT-NO         PIC  X(16).  04000099
040100                         30  ASC-PO-NBR              PIC S9(09)   04010099
040200                                                          COMP.   04020099
040300                         30  ASC-VENDOR-NUMBER       PIC  X(09).  04030099
040400                         30  ASC-VENDOR-NAME         PIC  X(13).  04040099
040500                         30  ASC-TRAN-CDE            PIC  X(02).  04050099
040600                         30  ASC-TRAN-TYPE           PIC  X(02).  04060099
040700                         30  ASC-NET-AMT           PIC  S9(09)V99 04070099
040800                                                           COMP-3.04080099
040900                         30  ASC-ENTER-DATE          PIC  X(08).  04090099
041000                         30  ASC-DOC-DATE            PIC  X(10).  04100099
041100                                                                  04110099
041200             15  ASC-BLK-SUB                         PIC S9(04)   04120099
041300                                                          COMP    04130099
041400                                                          SYNC.   04140099
041500             15  ASC-ITEM-SUB                        PIC S9(04)   04150099
041600                                                          COMP    04160099
041700                                                          SYNC.   04170099
041800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04180099
041900                                                          COMP-3. 04190099
042000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04200099
042100                                                          COMP-3. 04210099
042200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04220099
042300                                                          COMP-3. 04230099
042400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04240099
042500                                                          COMP-3. 04250099
042600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04260099
042700                                                          COMP-3. 04270099
042800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04280099
042900                                                          COMP    04290099
043000                                                          SYNC.   04300099
043100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04310099
043200                                                          COMP-3. 04320099
043300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04330099
043400                                                          COMP-3. 04340099
043500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04350099
043600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04360099
043700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04370099
043800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04380099
043900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04390099
044000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04400099
044100             15  ASC-LIST-QUEUE-NAME.                             04410099
044200                 20  ASC-LIST-TERM-ID                PIC  X(04).  04420099
044300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04430099
044400                                                          COMP-3. 04440099
044500                 20  ASC-LIST-SEQ                    PIC  9(01).  04450099
044600             15  ASC-SEL-QUEUE-NAME.                              04460099
044700                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04470099
044800                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04480099
044900                                                          COMP-3. 04490099
045000                 20  ASC-SEL-SEQ                     PIC  9(01).  04500099
045100                                                                  04510099
045200             15  ASC-CURSOR-SW                       PIC  X(01).  04520099
045300                 88  ASC-NO-CURSOR                   VALUE 'Z'.   04530099
045400                 88  ASC-PO-NBR-CURSOR               VALUE 'P'.   04540099
045500                 88  ASC-PO-TRAN-CURSOR              VALUE 'Q'.   04550099
045600                 88  ASC-VEND-NO-TP-CURSOR           VALUE 'R'.   04560099
045700                 88  ASC-VEND-NO-DP-CURSOR           VALUE 'S'.   04570099
045800                 88  ASC-VEND-NO-AC-CURSOR           VALUE 'T'.   04580099
045900                 88  ASC-VENDOR-NBR-CURSOR           VALUE 'U'.   04590099
046000                 88  ASC-VEND-NM-TP-CURSOR           VALUE 'V'.   04600099
046100                 88  ASC-VEND-NM-DP-CURSOR           VALUE 'W'.   04610099
046200                 88  ASC-VEND-NM-AC-CURSOR           VALUE 'X'.   04620099
046300                 88  ASC-VENDOR-NAM-CURSOR           VALUE 'Y'.   04630099
046400                 88  ASC-ACCT-NO-CURSOR              VALUE 'A'.   04640099
046500                 88  ASC-DEPT-CURSOR                 VALUE 'B'.   04650099
046600                 88  ASC-DOC-NBR-CURSOR              VALUE 'C'.   04660099
046700             15  ASC-START-ITEM-REQUEST.                          04670099
046800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04680099
046900     EJECT                                                        04690099
047000*---------------------------------------------------------------* 04700099
047100*    ABEND PROCESSING COPYBOOK.                                 * 04710099
047200*---------------------------------------------------------------* 04720099
047300                                                                  04730099
047400     COPY DPWS013.                                                04740099
047500                                                                  04750099
047600 EJECT                                                            04760099
047700*---------------------------------------------------------------* 04770099
047800*    DB2 AREA FOR ADJUSTMENT JOURNAL HEADER                     * 04780099
047900*---------------------------------------------------------------* 04790099
048000     EXEC SQL                                                     04800099
048100          INCLUDE TADJRNL                                         04810099
048200     END-EXEC.                                                    04820099
048300*---------------------------------------------------------------* 04830099
048400*    DB2 AREA FOR TEXTENT TABLE                                 * 04840099
048500*---------------------------------------------------------------* 04850099
048600     EXEC SQL                                                     04860099
048700          INCLUDE TEXTENT                                         04870099
048800     END-EXEC.                                                    04880099
048900*---------------------------------------------------------------* 04890099
049000*    DB2 AREA FOR TTRNCDE                                       * 04900099
049100*---------------------------------------------------------------* 04910099
049200     EXEC SQL                                                     04920099
049300          INCLUDE TTRNCDE                                         04930099
049400     END-EXEC.                                                    04940099
049500*---------------------------------------------------------------* 04950099
049600*    DB2 AREA FOR TENTNME TABLE                                 * 04960099
049700*---------------------------------------------------------------* 04970099
049800     EXEC SQL                                                     04980099
049900          INCLUDE TENTNME                                         04990099
050000     END-EXEC.                                                    05000099
050100*---------------------------------------------------------------* 05010099
050200*    DB2 AREA FOR COMMUNICATIONS                                * 05020099
050300*---------------------------------------------------------------* 05030099
050400     EXEC SQL                                                     05040099
050500          INCLUDE SQLCA                                           05050099
050600     END-EXEC.                                                    05060099
050700                                                                  05070099
050800*---------------------------------------------------------------* 05080099
050900*    ADJUSTMENT JOURNAL CURSOR WHEN PURCHASE ORDER NUMBER IS    * 05090099
051000*    ENTERED.                                                   * 05100099
051100*---------------------------------------------------------------* 05110099
051200                                                                  05120099
051300     EXEC SQL                                                     05130099
051400          DECLARE PO-NBR-CSR CURSOR                               05140099
051500          FOR SELECT                                              05150099
051600                A.DOC_NBR                                         05160099
051700              , A.PO_NBR                                          05170099
051800              , A.VND_NBR                                         05180099
051900              , C.ENT_NAME_DESC                                   05190099
052000              , A.AP_TRN_CDE                                      05200099
052100              , D.PSTG_TYP_CDE                                    05210099
052200              , A.NET_COST_AMT                                    05220099
052300              , A.ENTR_TMST                                       05230099
052400              , A.DOC_DTE                                         05240099
052500          FROM                                                    05250099
052600                TADJRNL A                                         05260099
052700              , TEXTENT B                                         05270099
052800              , TENTNME C                                         05280099
052900              , TTRNCDE D                                         05290099
053000          WHERE                                                   05300099
053100*               A.VND_NBR      =  B.DUN_NBR                       05310099
053200                A.ENT_ID       =  B.ENT_ID                        05320099
053300          AND   A.PO_NBR       =  :DK-PO-NBR                      05330099
053400          AND   B.ENT_ID       =  C.ENT_ID                        05340099
053500          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    05350099
053600          AND   D.EFF_STRT_DTE <= CURRENT DATE                    05360099
053700          AND   D.EFF_END_DTE  >  CURRENT DATE                    05370099
053800          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         05380099
053900                              AND :DK-DOCUMENT-NUMBER-HIGH        05390099
054000          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             05400099
054100                                 AND :DK-TRAN-CDE-HIGH            05410099
054200          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           05420099
054300                                   AND :DK-TRAN-TYP-HIGH          05430099
054400          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               05440099
054500          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 05450099
054600          AND   C.TYPE_CDE      = '01'                            05460099
054700          ORDER BY                                                05470099
054800                A.DOC_NBR                                         05480099
054900          FETCH FIRST 50000 ROWS ONLY                             05490099
055000     END-EXEC.                                                    05500099
055100                                                                  05510099
055200*---------------------------------------------------------------* 05520099
055300*    ADJUSTMENT JOURNAL CURSOR WHEN PURCHASE ORDER NUMBER AND   * 05530099
055400*    TRANSACTION TYPE ARE ENTERED.                              * 05540099
055500*---------------------------------------------------------------* 05550099
055600                                                                  05560099
055700     EXEC SQL                                                     05570099
055800          DECLARE PO-TRAN-CSR CURSOR                              05580099
055900          FOR SELECT                                              05590099
056000                A.DOC_NBR                                         05600099
056100              , A.PO_NBR                                          05610099
056200              , A.VND_NBR                                         05620099
056300              , C.ENT_NAME_DESC                                   05630099
056400              , A.AP_TRN_CDE                                      05640099
056500              , D.PSTG_TYP_CDE                                    05650099
056600              , A.NET_COST_AMT                                    05660099
056700              , A.ENTR_TMST                                       05670099
056800              , A.DOC_DTE                                         05680099
056900          FROM                                                    05690099
057000                TADJRNL A                                         05700099
057100              , TEXTENT B                                         05710099
057200              , TENTNME C                                         05720099
057300              , TTRNCDE D                                         05730099
057400          WHERE                                                   05740099
057500*               A.VND_NBR      =  B.DUN_NBR                       05750099
057600                A.ENT_ID       =  B.ENT_ID                        05760099
057700          AND   A.PO_NBR       =  :DK-PO-NBR                      05770099
057800          AND   D.PSTG_TYP_CDE =  :DK-TRAN-TYP-LOW                05780099
057900          AND   B.ENT_ID       =  C.ENT_ID                        05790099
058000          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    05800099
058100          AND   D.EFF_STRT_DTE <= CURRENT DATE                    05810099
058200          AND   D.EFF_END_DTE  >  CURRENT DATE                    05820099
058300          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         05830099
058400                              AND :DK-DOCUMENT-NUMBER-HIGH        05840099
058500          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             05850099
058600                                 AND :DK-TRAN-CDE-HIGH            05860099
058700          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-CDE-LOW           05870099
058800                                   AND :DK-TRAN-CDE-HIGH          05880099
058900          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               05890099
059000          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 05900099
059100          AND   C.TYPE_CDE = '01'                                 05910099
059200          ORDER BY                                                05920099
059300                A.DOC_NBR                                         05930099
059400          FETCH FIRST 50000 ROWS ONLY                             05940099
059500     END-EXEC.                                                    05950099
059600                                                                  05960099
059700*---------------------------------------------------------------* 05970099
059800*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NUMBER AND THE       * 05980099
059900*    TRANSACTION TYPE ARE ENTERED.                              * 05990099
060000*---------------------------------------------------------------* 06000099
060100                                                                  06010099
060200     EXEC SQL                                                     06020099
060300          DECLARE VEND-NO-TP-CSR CURSOR                           06030099
060400          FOR SELECT                                              06040099
060500                A.DOC_NBR                                         06050099
060600              , A.PO_NBR                                          06060099
060700              , A.VND_NBR                                         06070099
060800              , C.ENT_NAME_DESC                                   06080099
060900              , A.AP_TRN_CDE                                      06090099
061000              , D.PSTG_TYP_CDE                                    06100099
061100              , A.NET_COST_AMT                                    06110099
061200              , A.ENTR_TMST                                       06120099
061300              , A.DOC_DTE                                         06130099
061400          FROM                                                    06140099
061500                TADJRNL A                                         06150099
061600              , TEXTENT B                                         06160099
061700              , TENTNME C                                         06170099
061800              , TTRNCDE D                                         06180099
061900          WHERE                                                   06190099
062000*               A.VND_NBR      =  B.DUN_NBR                       06200099
062100                A.ENT_ID       =  B.ENT_ID                        06210099
062200          AND   A.VND_NBR      =  :DK-VND-NBR                     06220099
062300          AND   D.PSTG_TYP_CDE =  :DK-TRAN-TYP-LOW                06230099
062400          AND   B.ENT_ID       =  C.ENT_ID                        06240099
062500          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    06250099
062600          AND   D.EFF_STRT_DTE <= CURRENT DATE                    06260099
062700          AND   D.EFF_END_DTE  >  CURRENT DATE                    06270099
062800          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         06280099
062900                              AND :DK-DOCUMENT-NUMBER-HIGH        06290099
063000          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             06300099
063100                                 AND :DK-TRAN-CDE-HIGH            06310099
063200          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               06320099
063300          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 06330099
063400          AND   C.TYPE_CDE = '01'                                 06340099
063500          ORDER BY                                                06350099
063600                A.DOC_NBR                                         06360099
063700          FETCH FIRST 50000 ROWS ONLY                             06370099
063800     END-EXEC.                                                    06380099
063900                                                                  06390099
064000*---------------------------------------------------------------* 06400099
064100*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NUMBER AND THE       * 06410099
064200*    DEPARTMENT ARE ENTERED.                                    * 06420099
064300*---------------------------------------------------------------* 06430099
064400                                                                  06440099
064500     EXEC SQL                                                     06450099
064600          DECLARE VEND-NO-DP-CSR CURSOR                           06460099
064700          FOR SELECT                                              06470099
064800                A.DOC_NBR                                         06480099
064900              , A.PO_NBR                                          06490099
065000              , A.VND_NBR                                         06500099
065100              , C.ENT_NAME_DESC                                   06510099
065200              , A.AP_TRN_CDE                                      06520099
065300              , D.PSTG_TYP_CDE                                    06530099
065400              , A.NET_COST_AMT                                    06540099
065500              , A.ENTR_TMST                                       06550099
065600              , A.DOC_DTE                                         06560099
065700          FROM                                                    06570099
065800                TADJRNL A                                         06580099
065900              , TEXTENT B                                         06590099
066000              , TENTNME C                                         06600099
066100              , TTRNCDE D                                         06610099
066200          WHERE                                                   06620099
066300*               A.VND_NBR      =  B.DUN_NBR                       06630099
066400                A.ENT_ID       =  B.ENT_ID                        06640099
066500          AND   A.VND_NBR      =  :DK-VND-NBR                     06650099
066600          AND   A.DEPT_NBR     =  :DK-DEPARTMENT                  06660099
066700          AND   B.ENT_ID       =  C.ENT_ID                        06670099
066800          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    06680099
066900          AND   D.EFF_STRT_DTE <= CURRENT DATE                    06690099
067000          AND   D.EFF_END_DTE  >  CURRENT DATE                    06700099
067100          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         06710099
067200                              AND :DK-DOCUMENT-NUMBER-HIGH        06720099
067300          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             06730099
067400                                 AND :DK-TRAN-CDE-HIGH            06740099
067500          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           06750099
067600                                   AND :DK-TRAN-TYP-HIGH          06760099
067700          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               06770099
067800          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 06780099
067900          AND   C.TYPE_CDE = '01'                                 06790099
068000          ORDER BY                                                06800099
068100                A.DOC_NBR                                         06810099
068200          FETCH FIRST 50000 ROWS ONLY                             06820099
068300     END-EXEC.                                                    06830099
068400                                                                  06840099
068500*---------------------------------------------------------------* 06850099
068600*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NUMBER AND ACCOUNT   * 06860099
068700*    NUMBER ARE ENTERED.                                        * 06870099
068800*---------------------------------------------------------------* 06880099
068900                                                                  06890099
069000     EXEC SQL                                                     06900099
069100          DECLARE VEND-NO-AC-CSR CURSOR                           06910099
069200          FOR SELECT                                              06920099
069300                A.DOC_NBR                                         06930099
069400              , A.PO_NBR                                          06940099
069500              , A.VND_NBR                                         06950099
069600              , C.ENT_NAME_DESC                                   06960099
069700              , A.AP_TRN_CDE                                      06970099
069800              , D.PSTG_TYP_CDE                                    06980099
069900              , A.NET_COST_AMT                                    06990099
070000              , A.ENTR_TMST                                       07000099
070100              , A.DOC_DTE                                         07010099
070200          FROM                                                    07020099
070300                TADJRNL A                                         07030099
070400              , TEXTENT B                                         07040099
070500              , TENTNME C                                         07050099
070600              , TTRNCDE D                                         07060099
070700          WHERE                                                   07070099
070800*               A.VND_NBR      =  B.DUN_NBR                       07080099
070900                A.ENT_ID       =  B.ENT_ID                        07090099
071000          AND   A.VND_NBR      =  :DK-VND-NBR                     07100099
071100          AND   A.GL_ACCT_NBR  =  :DK-ACCT-NO                     07110099
071200          AND   B.ENT_ID       =  C.ENT_ID                        07120099
071300          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    07130099
071400          AND   D.EFF_STRT_DTE <= CURRENT DATE                    07140099
071500          AND   D.EFF_END_DTE  >  CURRENT DATE                    07150099
071600          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         07160099
071700                              AND :DK-DOCUMENT-NUMBER-HIGH        07170099
071800          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             07180099
071900                                 AND :DK-TRAN-CDE-HIGH            07190099
072000          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           07200099
072100                                   AND :DK-TRAN-TYP-HIGH          07210099
072200          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               07220099
072300          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 07230099
072400          AND   C.TYPE_CDE = '01'                                 07240099
072500          ORDER BY                                                07250099
072600                A.DOC_NBR                                         07260099
072700          FETCH FIRST 50000 ROWS ONLY                             07270099
072800     END-EXEC.                                                    07280099
072900                                                                  07290099
073000*---------------------------------------------------------------* 07300099
073100*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NUMBER IS ENTERED.   * 07310099
073200*---------------------------------------------------------------* 07320099
073300                                                                  07330099
073400     EXEC SQL                                                     07340099
073500          DECLARE VENDOR-NBR-CSR CURSOR                           07350099
073600          FOR SELECT                                              07360099
073700                A.DOC_NBR                                         07370099
073800              , A.PO_NBR                                          07380099
073900              , A.VND_NBR                                         07390099
074000              , C.ENT_NAME_DESC                                   07400099
074100              , A.AP_TRN_CDE                                      07410099
074200              , D.PSTG_TYP_CDE                                    07420099
074300              , A.NET_COST_AMT                                    07430099
074400              , A.ENTR_TMST                                       07440099
074500              , A.DOC_DTE                                         07450099
074600          FROM                                                    07460099
074700                TADJRNL A                                         07470099
074800              , TEXTENT B                                         07480099
074900              , TENTNME C                                         07490099
075000              , TTRNCDE D                                         07500099
075100          WHERE                                                   07510099
075200*               A.VND_NBR      =  B.DUN_NBR                       07520099
075300                A.ENT_ID       =  B.ENT_ID                        07530099
075400          AND   A.VND_NBR      =  :DK-VND-NBR                     07540099
075500          AND   B.ENT_ID       =  C.ENT_ID                        07550099
075600          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    07560099
075700          AND   D.EFF_STRT_DTE <= CURRENT DATE                    07570099
075800          AND   D.EFF_END_DTE  >  CURRENT DATE                    07580099
075900          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         07590099
076000                              AND :DK-DOCUMENT-NUMBER-HIGH        07600099
076100          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             07610099
076200                                 AND :DK-TRAN-CDE-HIGH            07620099
076300          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           07630099
076400                                   AND :DK-TRAN-TYP-HIGH          07640099
076500          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               07650099
076600          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 07660099
076700          AND   C.TYPE_CDE =  '01'                                07670099
076800          ORDER BY                                                07680099
076900                A.DOC_NBR                                         07690099
077000          FETCH FIRST 50000 ROWS ONLY                             07700099
077100     END-EXEC.                                                    07710099
077200                                                                  07720099
077300*---------------------------------------------------------------* 07730099
077400*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NAME AND TRANSACTION * 07740099
077500*    TYPE ARE ENTERED.                                          * 07750099
077600*---------------------------------------------------------------* 07760099
077700                                                                  07770099
077800     EXEC SQL                                                     07780099
077900          DECLARE VEND-NM-DP-CSR CURSOR                           07790099
078000          FOR SELECT                                              07800099
078100                A.DOC_NBR                                         07810099
078200              , A.PO_NBR                                          07820099
078300              , A.VND_NBR                                         07830099
078400              , C.ENT_NAME_DESC                                   07840099
078500              , A.AP_TRN_CDE                                      07850099
078600              , D.PSTG_TYP_CDE                                    07860099
078700              , A.NET_COST_AMT                                    07870099
078800              , A.ENTR_TMST                                       07880099
078900              , A.DOC_DTE                                         07890099
079000          FROM                                                    07900099
079100                TADJRNL A                                         07910099
079200              , TEXTENT B                                         07920099
079300              , TENTNME C                                         07930099
079400              , TTRNCDE D                                         07940099
079500          WHERE                                                   07950099
079600*               A.VND_NBR      =  B.DUN_NBR                       07960099
079700                A.ENT_ID       =  B.ENT_ID                        07970099
079800          AND   C.ENT_NAME_DESC LIKE :DK-ENT-NM                   07980099
079900          AND   A.DEPT_NBR     =  :DK-DEPARTMENT                  07990099
080000          AND   B.ENT_ID       =  C.ENT_ID                        08000099
080100          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    08010099
080200          AND   D.EFF_STRT_DTE <= CURRENT DATE                    08020099
080300          AND   D.EFF_END_DTE  >  CURRENT DATE                    08030099
080400          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         08040099
080500                              AND :DK-DOCUMENT-NUMBER-HIGH        08050099
080600          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             08060099
080700                                 AND :DK-TRAN-CDE-HIGH            08070099
080800          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           08080099
080900                                   AND :DK-TRAN-TYP-HIGH          08090099
081000          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               08100099
081100          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 08110099
081200          AND   C.TYPE_CDE = '01'                                 08120099
081300          ORDER BY                                                08130099
081400                A.DOC_NBR                                         08140099
081500          FETCH FIRST 50000 ROWS ONLY                             08150099
081600     END-EXEC.                                                    08160099
081700                                                                  08170099
081800*---------------------------------------------------------------* 08180099
081900*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NAME AND DEPARTMENT  * 08190099
082000*    ARE ENTERED.                                               * 08200099
082100*---------------------------------------------------------------* 08210099
082200                                                                  08220099
082300     EXEC SQL                                                     08230099
082400          DECLARE VEND-NM-TP-CSR CURSOR                           08240099
082500          FOR SELECT                                              08250099
082600                A.DOC_NBR                                         08260099
082700              , A.PO_NBR                                          08270099
082800              , A.VND_NBR                                         08280099
082900              , C.ENT_NAME_DESC                                   08290099
083000              , A.AP_TRN_CDE                                      08300099
083100              , D.PSTG_TYP_CDE                                    08310099
083200              , A.NET_COST_AMT                                    08320099
083300              , A.ENTR_TMST                                       08330099
083400              , A.DOC_DTE                                         08340099
083500          FROM                                                    08350099
083600                TADJRNL A                                         08360099
083700              , TEXTENT B                                         08370099
083800              , TENTNME C                                         08380099
083900              , TTRNCDE D                                         08390099
084000          WHERE                                                   08400099
084100*               A.VND_NBR      =  B.DUN_NBR                       08410099
084200                A.ENT_ID       =  B.ENT_ID                        08420099
084300          AND   C.ENT_NAME_DESC LIKE :DK-ENT-NM                   08430099
084400          AND   D.PSTG_TYP_CDE =  :DK-TRAN-TYP-LOW                08440099
084500          AND   B.ENT_ID       =  C.ENT_ID                        08450099
084600          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    08460099
084700          AND   D.EFF_STRT_DTE <= CURRENT DATE                    08470099
084800          AND   D.EFF_END_DTE  >  CURRENT DATE                    08480099
084900          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         08490099
085000                              AND :DK-DOCUMENT-NUMBER-HIGH        08500099
085100          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             08510099
085200                                 AND :DK-TRAN-CDE-HIGH            08520099
085300          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               08530099
085400          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 08540099
085500          AND   C.TYPE_CDE = '01'                                 08550099
085600          ORDER BY                                                08560099
085700                A.DOC_NBR                                         08570099
085800          FETCH FIRST 50000 ROWS ONLY                             08580099
085900     END-EXEC.                                                    08590099
086000                                                                  08600099
086100*---------------------------------------------------------------* 08610099
086200*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NAME AND ACCOUNT     * 08620099
086300*    NUMBER ARE ENTERED.                                        * 08630099
086400*---------------------------------------------------------------* 08640099
086500                                                                  08650099
086600     EXEC SQL                                                     08660099
086700          DECLARE VEND-NM-AC-CSR CURSOR                           08670099
086800          FOR SELECT                                              08680099
086900                A.DOC_NBR                                         08690099
087000              , A.PO_NBR                                          08700099
087100              , A.VND_NBR                                         08710099
087200              , C.ENT_NAME_DESC                                   08720099
087300              , A.AP_TRN_CDE                                      08730099
087400              , D.PSTG_TYP_CDE                                    08740099
087500              , A.NET_COST_AMT                                    08750099
087600              , A.ENTR_TMST                                       08760099
087700              , A.DOC_DTE                                         08770099
087800          FROM                                                    08780099
087900                TADJRNL A                                         08790099
088000              , TEXTENT B                                         08800099
088100              , TENTNME C                                         08810099
088200              , TTRNCDE D                                         08820099
088300          WHERE                                                   08830099
088400*               A.VND_NBR      =  B.DUN_NBR                       08840099
088500                A.ENT_ID       =  B.ENT_ID                        08850099
088600          AND   C.ENT_NAME_DESC LIKE :DK-ENT-NM                   08860099
088700          AND   A.GL_ACCT_NBR  =  :DK-ACCT-NO                     08870099
088800          AND   B.ENT_ID       =  C.ENT_ID                        08880099
088900          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    08890099
089000          AND   D.EFF_STRT_DTE <= CURRENT DATE                    08900099
089100          AND   D.EFF_END_DTE  >  CURRENT DATE                    08910099
089200          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         08920099
089300                              AND :DK-DOCUMENT-NUMBER-HIGH        08930099
089400          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             08940099
089500                                 AND :DK-TRAN-CDE-HIGH            08950099
089600          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           08960099
089700                                   AND :DK-TRAN-TYP-HIGH          08970099
089800          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               08980099
089900          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 08990099
090000          AND   C.TYPE_CDE = '01'                                 09000099
090100          ORDER BY                                                09010099
090200                A.DOC_NBR                                         09020099
090300          FETCH FIRST 50000 ROWS ONLY                             09030099
090400     END-EXEC.                                                    09040099
090500                                                                  09050099
090600*---------------------------------------------------------------* 09060099
090700*    ADJUSTMENT JOURNAL CURSOR WHEN VENDOR NAME IS ENTERED.     * 09070099
090800*---------------------------------------------------------------* 09080099
090900                                                                  09090099
091000     EXEC SQL                                                     09100099
091100          DECLARE VEND-NAM-CSR CURSOR                             09110099
091200          FOR SELECT                                              09120099
091300                A.DOC_NBR                                         09130099
091400              , A.PO_NBR                                          09140099
091500              , A.VND_NBR                                         09150099
091600              , C.ENT_NAME_DESC                                   09160099
091700              , A.AP_TRN_CDE                                      09170099
091800              , D.PSTG_TYP_CDE                                    09180099
091900              , A.NET_COST_AMT                                    09190099
092000              , A.ENTR_TMST                                       09200099
092100              , A.DOC_DTE                                         09210099
092200          FROM                                                    09220099
092300                TADJRNL A                                         09230099
092400              , TEXTENT B                                         09240099
092500              , TENTNME C                                         09250099
092600              , TTRNCDE D                                         09260099
092700          WHERE                                                   09270099
092800*               A.VND_NBR      =  B.DUN_NBR                       09280099
092900                A.ENT_ID       =  B.ENT_ID                        09290099
093000          AND   C.ENT_NAME_DESC LIKE :DK-ENT-NM                   09300099
093100          AND   B.ENT_ID       =  C.ENT_ID                        09310099
093200          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    09320099
093300          AND   D.EFF_STRT_DTE <= CURRENT DATE                    09330099
093400          AND   D.EFF_END_DTE  >  CURRENT DATE                    09340099
093500          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         09350099
093600                              AND :DK-DOCUMENT-NUMBER-HIGH        09360099
093700          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             09370099
093800                                 AND :DK-TRAN-CDE-HIGH            09380099
093900          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           09390099
094000                                   AND :DK-TRAN-TYP-HIGH          09400099
094100          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               09410099
094200          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 09420099
094300          AND   C.TYPE_CDE = '01'                                 09430099
094400          ORDER BY                                                09440099
094500                A.DOC_NBR                                         09450099
094600          FETCH FIRST 50000 ROWS ONLY                             09460099
094700     END-EXEC.                                                    09470099
094800                                                                  09480099
094900*---------------------------------------------------------------* 09490099
095000*    ADJUSTMENT JOURNAL CURSOR WHEN ACCOUNT NUMBER ALONE IS     * 09500099
095100*    ENTERED.                                                   * 09510099
095200*---------------------------------------------------------------* 09520099
095300                                                                  09530099
095400     EXEC SQL                                                     09540099
095500          DECLARE ACCT-NO-CSR CURSOR                              09550099
095600          FOR SELECT                                              09560099
095700                A.DOC_NBR                                         09570099
095800              , A.PO_NBR                                          09580099
095900              , A.VND_NBR                                         09590099
096000              , C.ENT_NAME_DESC                                   09600099
096100              , A.AP_TRN_CDE                                      09610099
096200              , D.PSTG_TYP_CDE                                    09620099
096300              , A.NET_COST_AMT                                    09630099
096400              , A.ENTR_TMST                                       09640099
096500              , A.DOC_DTE                                         09650099
096600          FROM                                                    09660099
096700                TADJRNL A                                         09670099
096800              , TEXTENT B                                         09680099
096900              , TENTNME C                                         09690099
097000              , TTRNCDE D                                         09700099
097100          WHERE                                                   09710099
097200*               A.VND_NBR      =  B.DUN_NBR                       09720099
097300                A.ENT_ID       =  B.ENT_ID                        09730099
097400          AND   A.GL_ACCT_NBR  =  :DK-ACCT-NO                     09740099
097500          AND   B.ENT_ID       =  C.ENT_ID                        09750099
097600          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    09760099
097700          AND   D.EFF_STRT_DTE <= CURRENT DATE                    09770099
097800          AND   D.EFF_END_DTE  >  CURRENT DATE                    09780099
097900          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         09790099
098000                              AND :DK-DOCUMENT-NUMBER-HIGH        09800099
098100          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             09810099
098200                                 AND :DK-TRAN-CDE-HIGH            09820099
098300          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           09830099
098400                                   AND :DK-TRAN-TYP-HIGH          09840099
098500          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               09850099
098600          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 09860099
098700          AND   C.TYPE_CDE = '01'                                 09870099
098800          ORDER BY                                                09880099
098900                A.DOC_NBR                                         09890099
099000          FETCH FIRST 50000 ROWS ONLY                             09900099
099100     END-EXEC.                                                    09910099
099200                                                                  09920099
099300*---------------------------------------------------------------* 09930099
099400*    ADJUSTMENT JOURNAL CURSOR WHEN DEPARTMENT ALONE IS ENTERED.* 09940099
099500*---------------------------------------------------------------* 09950099
099600                                                                  09960099
099700     EXEC SQL                                                     09970099
099800          DECLARE DEPT-CSR CURSOR                                 09980099
099900          FOR SELECT                                              09990099
100000                A.DOC_NBR                                         10000099
100100              , A.PO_NBR                                          10010099
100200              , A.VND_NBR                                         10020099
100300              , C.ENT_NAME_DESC                                   10030099
100400              , A.AP_TRN_CDE                                      10040099
100500              , D.PSTG_TYP_CDE                                    10050099
100600              , A.NET_COST_AMT                                    10060099
100700              , A.ENTR_TMST                                       10070099
100800              , A.DOC_DTE                                         10080099
100900          FROM                                                    10090099
101000                TADJRNL A                                         10100099
101100              , TEXTENT B                                         10110099
101200              , TENTNME C                                         10120099
101300              , TTRNCDE D                                         10130099
101400          WHERE                                                   10140099
101500*               A.VND_NBR      =  B.DUN_NBR                       10150099
101600                A.ENT_ID       =  B.ENT_ID                        10160099
101700          AND   A.DEPT_NBR     =  :DK-DEPARTMENT                  10170099
101800          AND   B.ENT_ID       =  C.ENT_ID                        10180099
101900          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    10190099
102000          AND   D.EFF_STRT_DTE <= CURRENT DATE                    10200099
102100          AND   D.EFF_END_DTE  >  CURRENT DATE                    10210099
102200          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         10220099
102300                              AND :DK-DOCUMENT-NUMBER-HIGH        10230099
102400          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             10240099
102500                                 AND :DK-TRAN-CDE-HIGH            10250099
102600          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           10260099
102700                                   AND :DK-TRAN-TYP-HIGH          10270099
102800          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               10280099
102900          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 10290099
103000          AND   C.TYPE_CDE = '01'                                 10300099
103100          ORDER BY                                                10310099
103200                A.DOC_NBR                                         10320099
103300          FETCH FIRST 50000 ROWS ONLY                             10330099
103400     END-EXEC.                                                    10340099
103500                                                                  10350099
103600*---------------------------------------------------------------* 10360099
103700*    ADJUSTMENT JOURNAL CURSOR WHEN DOCUMENT NUMBER ALONE IS    * 10370099
103800*    ENTERED.                                                   * 10380099
103900*---------------------------------------------------------------* 10390099
104000                                                                  10400099
104100     EXEC SQL                                                     10410099
104200          DECLARE DOC-NBR-CSR CURSOR                              10420099
104300          FOR SELECT                                              10430099
104400                A.DOC_NBR                                         10440099
104500              , A.PO_NBR                                          10450099
104600              , A.VND_NBR                                         10460099
104700              , C.ENT_NAME_DESC                                   10470099
104800              , A.AP_TRN_CDE                                      10480099
104900              , D.PSTG_TYP_CDE                                    10490099
105000              , A.NET_COST_AMT                                    10500099
105100              , A.ENTR_TMST                                       10510099
105200              , A.DOC_DTE                                         10520099
105300          FROM                                                    10530099
105400                TADJRNL A                                         10540099
105500              , TEXTENT B                                         10550099
105600              , TENTNME C                                         10560099
105700              , TTRNCDE D                                         10570099
105800          WHERE                                                   10580099
105900*               A.VND_NBR      =  B.DUN_NBR                       10590099
106000                A.ENT_ID       =  B.ENT_ID                        10600099
106100          AND   B.ENT_ID       =  C.ENT_ID                        10610099
106200          AND   A.AP_TRN_CDE   =  D.AP_TRN_CDE                    10620099
106300          AND   D.EFF_STRT_DTE <= CURRENT DATE                    10630099
106400          AND   D.EFF_END_DTE  >  CURRENT DATE                    10640099
106500          AND   A.DOC_NBR BETWEEN :DK-DOCUMENT-NUMBER-LOW         10650099
106600                              AND :DK-DOCUMENT-NUMBER-HIGH        10660099
106700          AND   A.AP_TRN_CDE BETWEEN :DK-TRAN-CDE-LOW             10670099
106800                                 AND :DK-TRAN-CDE-HIGH            10680099
106900          AND   D.PSTG_TYP_CDE BETWEEN :DK-TRAN-TYP-LOW           10690099
107000                                   AND :DK-TRAN-TYP-HIGH          10700099
107100          AND   DATE(A.ENTR_TMST) >= :DK-START-DATE               10710099
107200          AND   DATE(A.ENTR_TMST) <= :DK-END-DATE                 10720099
107300          AND   C.TYPE_CDE = '01'                                 10730099
107400          ORDER BY                                                10740099
107500                A.DOC_NBR                                         10750099
107600          FETCH FIRST 50000 ROWS ONLY                             10760099
107700     END-EXEC.                                                    10770099
107800                                                                  10780099
107900 EJECT                                                            10790099
108000 LINKAGE SECTION.                                                 10800099
108100                                                                  10810099
108200 01  DFHCOMMAREA.                                                 10820099
108300     05  FILLER                         OCCURS  1 TO 4072 TIMES   10830099
108400                                        DEPENDING ON EIBCALEN.    10840099
108500         10  FILLER                     PIC X.                    10850099
108600                                                                  10860099
108700 EJECT                                                            10870099
108800 PROCEDURE DIVISION.                                              10880099
108900******************************************************************10890099
109000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **10900099
109100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **10910099
109200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **10920099
109300******************************************************************10930099
109400 0000-MAIN-MODULE.                                                10940099
109500     INITIALIZE DP030-CICS-API-FIELDS.                            10950099
109600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       10960099
109700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          10970099
109800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         10980099
109900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       10990099
110000     MOVE LENGTH OF AP361AI        TO DP030-MAP-LENGTH (1).       11000099
110100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     11010099
110200     PERFORM 0001-CALL-CICS-ARCH-API.                             11020099
110300                                                                  11030099
110400     PERFORM 1000-CONTROL-PROCESSING                              11040099
110500                                                                  11050099
110600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     11060099
110700     PERFORM 0001-CALL-CICS-ARCH-API.                             11070099
110800                                                                  11080099
110900******************************************************************11090099
111000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **11100099
111100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **11110099
111200******************************************************************11120099
111300 0001-CALL-CICS-ARCH-API.                                         11130099
111400     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     11140099
111500                                     DFHCOMMAREA                  11150099
111600                                     DP030-CICS-API-FIELDS        11160099
111700                                     DP020-STANDARD-COMMAREA      11170099
111800                                     AP361AI.                     11180099
111900                                                                  11190099
112000     IF  DP030-RC-CALL-SUCCESSFUL                                 11200099
112100         CONTINUE                                                 11210099
112200     ELSE                                                         11220099
112300         SET DP013-NO-ROLLBACK                                    11230099
112400             DP013-XCTL-DISPLAY-RESTART                           11240099
112500             DP013-CICS-ABEND      TO TRUE                        11250099
112600         MOVE '0001-CALL-CICS-ARCH-API'                           11260099
112700                                   TO DP013-PARAGRAPH             11270099
112800         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O11280099
112900-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      11290099
113000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      11300099
113100         PERFORM DP013-0000-PROCESS-ABEND                         11310099
113200     END-IF.                                                      11320099
113300*----------------------------------------------------------------*11330099
113400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *11340099
113500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *11350099
113600*                                                                *11360099
113700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *11370099
113800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *11380099
113900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *11390099
114000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *11400099
114100*----------------------------------------------------------------*11410099
114200                                                                  11420099
114300 1000-CONTROL-PROCESSING.                                         11430099
114400                                                                  11440099
114500     EVALUATE TRUE                                                11450099
114600         WHEN DP020-NEXT-ACT-INITIAL                              11460099
114700             INITIALIZE ASC-SPECIFIC-COMMAREA                     11470099
114800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            11480099
114900                                      ASC-SEL-TERM-ID             11490099
115000             MOVE DP020-SRC-TASK-NUMBER                           11500099
115100                                   TO ASC-LIST-TASK-NUMBER        11510099
115200                                      ASC-SEL-TASK-NUMBER         11520099
115300             MOVE PC-LIST-QUEUE-SEQ                               11530099
115400                                   TO ASC-LIST-SEQ                11540099
115500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 11550099
115600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 11560099
115700***-----$TEMPLATE NOTE$-------------------------------------------11570099
115800*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,11580099
115900*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  11590099
116000*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.11600099
116100***---------------------------------------------------------------11610099
116200             IF  PS-COMMAREA-NOT-VALID                            11620099
116300                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            11630099
116400             ELSE                                                 11640099
116500                 PERFORM 4000-BUILD-INITIAL-PANEL                 11650099
116600             END-IF                                               11660099
116700                                                                  11670099
116800         WHEN DP020-NEXT-ACT-READ-MAP                             11680099
116900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11690099
117000                                   TO PV-TOP-ITEM                 11700099
117100             PERFORM 2000-PROCESS-PANEL                           11710099
117200                                                                  11720099
117300         WHEN DP020-NEXT-ACT-RETURN                               11730099
117400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11740099
117500                                   TO PV-TOP-ITEM                 11750099
117600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11760099
117700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 11770099
117800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11780099
117900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11790099
118000                                                                  11800099
118100         WHEN OTHER                                               11810099
118200             SET DP013-LOGIC-ABEND TO TRUE                        11820099
118300             SET DP013-NO-ROLLBACK TO TRUE                        11830099
118400             MOVE '1000-CONTROL-PROCESSING'                       11840099
118500                                   TO DP013-PARAGRAPH             11850099
118600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    11860099
118700                                   TO DP013-MESSAGE-TEXT(1)       11870099
118800             PERFORM DP013-0000-PROCESS-ABEND                     11880099
118900     END-EVALUATE.                                                11890099
119000                                                                  11900099
119100 EJECT                                                            11910099
119200*----------------------------------------------------------------*11920099
119300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *11930099
119400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *11940099
119500*----------------------------------------------------------------*11950099
119600                                                                  11960099
119700 1100-PROCESS-INTER-APPL-COMM.                                    11970099
119800                                                                  11980099
119900     SET PS-COMMAREA-VALID         TO TRUE.                       11990099
120000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     12000099
120100                                                                  12010099
120200     IF AP361-VND-NBR = SPACES AND                                12020099
120300        AP361-PO-NUMB = ZERO AND                                  12030099
120400        AP361-ENT-DESC = SPACES AND                               12040099
120500        AP361-ACCT-NO = SPACES AND                                12050099
120600        AP361-DEPT = SPACES AND                                   12060099
120700        AP361-DOC-NO = SPACES                                     12070099
120800        MOVE PC-TSYMSG-00831 TO DP020-MSG-NUMBER                  12080099
120900        SET DP020-MSG-FATAL TO TRUE                               12090099
121000        SET PS-COMMAREA-NOT-VALID TO TRUE                         12100099
121100     END-IF.                                                      12110099
121200                                                                  12120099
121300     IF  PS-COMMAREA-VALID                                        12130099
121400         IF AP361-VND-NBR > SPACES                                12140099
121500            MOVE AP361-VND-NBR TO DK-VND-NBR                      12150099
121600         END-IF                                                   12160099
121700         MOVE AP361-VND-NBR        TO ASC-KEY-VENDOR-NUMBER       12170099
121800         IF AP361-PO-NUMB > ZERO                                  12180099
121900            MOVE AP361-PO-NUMB TO DK-PO-NBR                       12190099
122000         END-IF                                                   12200099
122100         MOVE AP361-PO-NUMB        TO ASC-KEY-PO-NBR              12210099
122200         MOVE AP361-ENT-DESC       TO ASC-KEY-VENDOR-NAME         12220099
122300                                      DK-ENT-NM                   12230099
122400         IF AP361-DOC-NO > SPACES                                 12240099
122500            MOVE AP361-DOC-NO      TO DK-DOCUMENT-NUMBER-LOW      12250099
122600                                      ASC-KEY-DOCUMENT-NO-LOW     12260099
122700                                      DK-DOCUMENT-NUMBER-HIGH     12270099
122800                                      ASC-KEY-DOCUMENT-NO-HIGH    12280099
122900         ELSE                                                     12290099
123000            MOVE LOW-VALUES        TO ASC-KEY-DOCUMENT-NO-LOW     12300099
123100            MOVE HIGH-VALUES       TO ASC-KEY-DOCUMENT-NO-HIGH    12310099
123200         END-IF                                                   12320099
123300                                                                  12330099
123400         IF AP361-DEPT > SPACES                                   12340099
123500            MOVE AP361-DEPT        TO DK-DEPARTMENT               12350099
123600         END-IF                                                   12360099
123700         MOVE AP361-DEPT           TO ASC-KEY-DEPARTMENT          12370099
123800         IF AP361-ACCT-NO > SPACES                                12380099
123900            MOVE AP361-ACCT-NO     TO DK-ACCT-NO                  12390099
124000         END-IF                                                   12400099
124100         MOVE AP361-ACCT-NO        TO ASC-KEY-ACCT-NO             12410099
124200         IF AP361-TRN-CDE > SPACES                                12420099
124300            MOVE AP361-TRN-CDE     TO DK-TRAN-CDE-LOW             12430099
124400                                      ASC-KEY-TRAN-CDE-LOW        12440099
124500                                      DK-TRAN-CDE-HIGH            12450099
124600                                      ASC-KEY-TRAN-CDE-HIGH       12460099
124700         ELSE                                                     12470099
124800            MOVE LOW-VALUES        TO ASC-KEY-TRAN-CDE-LOW        12480099
124900            MOVE HIGH-VALUES       TO ASC-KEY-TRAN-CDE-HIGH       12490099
125000         END-IF                                                   12500099
125100                                                                  12510099
125200         IF AP361-TRN-TYP > SPACES                                12520099
125300            MOVE AP361-TRN-TYP     TO DK-TRAN-TYP-LOW             12530099
125400                                      ASC-KEY-TRAN-TYP-LOW        12540099
125500                                      DK-TRAN-TYP-HIGH            12550099
125600                                      ASC-KEY-TRAN-TYP-HIGH       12560099
125700         ELSE                                                     12570099
125800            MOVE LOW-VALUES        TO ASC-KEY-TRAN-TYP-LOW        12580099
125900            MOVE HIGH-VALUES       TO ASC-KEY-TRAN-TYP-HIGH       12590099
126000         END-IF                                                   12600099
126100                                                                  12610099
126200         MOVE AP361-STRT-DATE      TO ASC-KEY-START-DATE          12620099
126300                                      DK-START-DATE               12630099
126400         MOVE AP361-END-DATE       TO ASC-KEY-END-DATE            12640099
126500                                      DK-END-DATE                 12650099
126600     END-IF.                                                      12660099
126700                                                                  12670099
126800 EJECT                                                            12680099
126900*----------------------------------------------------------------*12690099
127000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *12700099
127100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *12710099
127200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *12720099
127300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *12730099
127400* FUNCTION KEYS CAN GET THIS FAR.                                *12740099
127500*----------------------------------------------------------------*12750099
127600                                                                  12760099
127700 2000-PROCESS-PANEL.                                              12770099
127800     EVALUATE TRUE                                                12780099
127900         WHEN DP020-SRC-AID = DP016-CLEAR                         12790099
128000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    12800099
128100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   12810099
128200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12820099
128300                                                                  12830099
128400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    12840099
128500             MOVE ASC-KEY-VENDOR-NUMBER                           12850099
128600                                   TO DK-VND-NBR                  12860099
128700             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   12870099
128800             MOVE ASC-KEY-VENDOR-NAME                             12880099
128900                                   TO DK-ENT-NM                   12890099
129000             MOVE ASC-KEY-DOCUMENT-NO-LOW                         12900099
129100                                   TO DK-DOCUMENT-NUMBER-LOW      12910099
129200             MOVE ASC-KEY-DOCUMENT-NO-HIGH                        12920099
129300                                   TO DK-DOCUMENT-NUMBER-HIGH     12930099
129400             MOVE ASC-KEY-DEPARTMENT                              12940099
129500                                   TO DK-DEPARTMENT               12950099
129600             MOVE ASC-KEY-ACCT-NO                                 12960099
129700                                   TO DK-ACCT-NO                  12970099
129800             MOVE ASC-KEY-TRAN-CDE-LOW                            12980099
129900                                   TO DK-TRAN-CDE-LOW             12990099
130000             MOVE ASC-KEY-TRAN-CDE-HIGH                           13000099
130100                                   TO DK-TRAN-CDE-HIGH            13010099
130200             MOVE ASC-KEY-TRAN-TYP-LOW                            13020099
130300                                   TO DK-TRAN-TYP-LOW             13030099
130400             MOVE ASC-KEY-TRAN-TYP-HIGH                           13040099
130500                                   TO DK-TRAN-TYP-HIGH            13050099
130600             MOVE ASC-KEY-START-DATE                              13060099
130700                                   TO DK-START-DATE               13070099
130800             MOVE ASC-KEY-END-DATE TO DK-END-DATE                 13080099
130900                                                                  13090099
131000             PERFORM 2050-DELETE-LIST-QUEUE                       13100099
131100             PERFORM 4000-BUILD-INITIAL-PANEL                     13110099
131200                                                                  13120099
131300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    13130099
131400             PERFORM 2140-DESELECT-ALL-ITEMS                      13140099
131500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13150099
131600                                                                  13160099
131700         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  13170099
131800             PERFORM 2150-SELECT-ALL-ITEMS                        13180099
131900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13190099
132000                                                                  13200099
132100         WHEN OTHER                                               13210099
132200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13220099
132300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13230099
132400             IF  PS-NO-ERROR                                      13240099
132500                 SET DP030-CONTINUE-GO                            13250099
132600                                 TO TRUE                          13260099
132700                 PERFORM 2100-CHECK-FUNCTION-KEY                  13270099
132800             ELSE                                                 13280099
132900                 SET DP030-OVERRIDE-GO                            13290099
133000                                 TO TRUE                          13300099
133100             END-IF                                               13310099
133200     END-EVALUATE.                                                13320099
133300 EJECT                                                            13330099
133400*----------------------------------------------------------------*13340099
133500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *13350099
133600*----------------------------------------------------------------*13360099
133700 2050-DELETE-LIST-QUEUE.                                          13370099
133800                                                                  13380099
133900     EXEC CICS                                                    13390099
134000         DELETEQ TS                                               13400099
134100             QUEUE (ASC-LIST-QUEUE-NAME)                          13410099
134200             RESP  (PV-CICS-RESP)                                 13420099
134300     END-EXEC.                                                    13430099
134400                                                                  13440099
134500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       13450099
134600        (PV-CICS-RESP = DFHRESP(QIDERR))                          13460099
134700         CONTINUE                                                 13470099
134800     ELSE                                                         13480099
134900         SET DP013-CICS-ABEND      TO TRUE                        13490099
135000         SET DP013-NO-ROLLBACK     TO TRUE                        13500099
135100                                                                  13510099
135200         MOVE '2050-DELETE-LIST-QUEUE'                            13520099
135300                                   TO DP013-PARAGRAPH             13530099
135400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    13540099
135500                                   TO DP013-MESSAGE-TEXT (1)      13550099
135600         PERFORM DP013-0000-PROCESS-ABEND                         13560099
135700     END-IF.                                                      13570099
135800                                                                  13580099
135900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  13590099
136000 EJECT                                                            13600099
136100*----------------------------------------------------------------*13610099
136200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*13620099
136300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *13630099
136400* CICS ARCHITECTURE API.                                         *13640099
136500*----------------------------------------------------------------*13650099
136600 2100-CHECK-FUNCTION-KEY.                                         13660099
136700     EVALUATE TRUE                                                13670099
136800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              13680099
136900             INITIALIZE AP361-INTER-APPL-COMMAREA                 13690099
137000             MOVE ASC-KEY-VENDOR-NUMBER     TO AP361-VND-NBR      13700099
137100             MOVE ASC-KEY-VENDOR-NAME       TO AP361-ENT-DESC     13710099
137200             MOVE ASC-KEY-PO-NBR            TO AP361-PO-NUMB      13720099
137300* 08-04      MOVE ASC-KEY-TRAN-CDE-LOW      TO AP361-TRN-CDE      13730099
137400             MOVE SPACES                    TO AP361-TRN-CDE      13740099
137500                                                                  13750099
137600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              13760099
137700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              13770099
137800         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              13780099
137900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              13790099
138000                 INITIALIZE AP361-INTER-APPL-COMMAREA             13800099
138100                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                13810099
138200                                TO AP361-NUMBER-OF-SELECTED-ITEMS 13820099
138300                 PERFORM 5000-PREPARE-SEL-QUEUE                   13830099
138400                 MOVE ASC-KEY-VENDOR-NUMBER     TO AP361-VND-NBR  13840099
138500                 MOVE ASC-KEY-VENDOR-NAME       TO AP361-ENT-DESC 13850099
138600                 MOVE ASC-KEY-PO-NBR            TO AP361-PO-NUMB  13860099
138700                 MOVE ASC-KEY-DOCUMENT-NO-LOW   TO AP361-DOC-NO   13870099
138800                 MOVE ASC-KEY-TRAN-CDE-LOW      TO AP361-TRN-CDE  13880099
138900                 MOVE ASC-KEY-DOC-DTE           TO AP361-DOC-DATE 13890099
139000             ELSE                                                 13900099
139100                 SET DP030-OVERRIDE-GO                            13910099
139200                                   TO TRUE                        13920099
139300                 MOVE PC-TSYMSG-00057                             13930099
139400                                   TO DP020-MSG-NUMBER            13940099
139500                 SET DP020-MSG-WARNING                            13950099
139600                                   TO TRUE                        13960099
139700             END-IF                                               13970099
139800                                                                  13980099
139900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  13990099
140000             MOVE +1               TO PV-TOP-ITEM                 14000099
140100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14010099
140200                                                                  14020099
140300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   14030099
140400             PERFORM 2110-BROWSE-BACKWARD                         14040099
140500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14050099
140600                                                                  14060099
140700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   14070099
140800             PERFORM 2120-BROWSE-FORWARD                          14080099
140900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14090099
141000                                                                  14100099
141100         WHEN DP020-SRC-AID = DP016-ENTER                         14110099
141200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   14120099
141300             IF  PS-ERROR                                         14130099
141400                 CONTINUE                                         14140099
141500             ELSE                                                 14150099
141600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14160099
141700             END-IF                                               14170099
141800                                                                  14180099
141900         WHEN OTHER                                               14190099
142000             SET DP013-NO-ROLLBACK                                14200099
142100                 DP013-XCTL-DISPLAY-RESTART                       14210099
142200                 DP013-CICS-ABEND  TO TRUE                        14220099
142300             MOVE '2100-CHECK-FUNCTION-KEY'                       14230099
142400                                   TO DP013-PARAGRAPH             14240099
142500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      14250099
142600                                   TO DP013-MESSAGE-TEXT (1)      14260099
142700             PERFORM DP013-0000-PROCESS-ABEND                     14270099
142800     END-EVALUATE.                                                14280099
142900                                                                  14290099
143000*----------------------------------------------------------------*14300099
143100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *14310099
143200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *14320099
143300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *14330099
143400*    MESSAGE.                                                    *14340099
143500*----------------------------------------------------------------*14350099
143600                                                                  14360099
143700 2110-BROWSE-BACKWARD.                                            14370099
143800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    14380099
143900         GIVING PV-TOP-ITEM.                                      14390099
144000                                                                  14400099
144100     IF  ((PV-TOP-ITEM < +1)                                      14410099
144200       OR (PV-TOP-ITEM = +1))                                     14420099
144300         MOVE +1                   TO PV-TOP-ITEM                 14430099
144400*        -- TOP OF LIST --                                        14440099
144500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            14450099
144600         SET DP020-MSG-INFORMATIONAL TO TRUE                      14460099
144700     END-IF.                                                      14470099
144800                                                                  14480099
144900 EJECT                                                            14490099
145000*----------------------------------------------------------------*14500099
145100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *14510099
145200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *14520099
145300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *14530099
145400*----------------------------------------------------------------*14540099
145500                                                                  14550099
145600 2120-BROWSE-FORWARD.                                             14560099
145700                                                                  14570099
145800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              14580099
145900         GIVING PV-TOP-ITEM.                                      14590099
146000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   14600099
146100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14610099
146200                                   TO PV-TOP-ITEM                 14620099
146300*        -- BOTTOM OF LIST --                                     14630099
146400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14640099
146500         SET DP020-MSG-INFORMATIONAL                              14650099
146600                                   TO TRUE                        14660099
146700     ELSE                                                         14670099
146800         COMPUTE PV-BOTTOM-ITEM =                                 14680099
146900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 14690099
147000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            14700099
147100*            -- BOTTOM OF LIST --                                 14710099
147200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14720099
147300             SET DP020-MSG-INFORMATIONAL                          14730099
147400                                   TO TRUE                        14740099
147500         END-IF                                                   14750099
147600     END-IF.                                                      14760099
147700 EJECT                                                            14770099
147800*----------------------------------------------------------------*14780099
147900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *14790099
148000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *14800099
148100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *14810099
148200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *14820099
148300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *14830099
148400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *14840099
148500*----------------------------------------------------------------*14850099
148600                                                                  14860099
148700 2130-CHECK-FOR-JUMP-BROWSE.                                      14870099
148800     SET PS-NO-ERROR               TO TRUE.                       14880099
148900     IF (ASC-START-ITEM-REQUEST = SPACE)                          14890099
149000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14900099
149100                                   TO PV-TOP-ITEM                 14910099
149200     ELSE                                                         14920099
149300         MOVE ASC-START-ITEM-REQUEST                              14930099
149400                                   TO DP010I-UNEDITED-FIELD       14940099
149500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       14950099
149600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     14960099
149700         SET DP010I-NEGATIVE-NOT-ALLOWED                          14970099
149800                                   TO TRUE                        14980099
149920         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14992099
149930                         USING DP010I-NUMERIC-EDIT-AREA           14993099
150000                                                                  15000099
150100         IF  NOT DP010I-ERROR-DETECTED                            15010099
150200             MOVE DP010I-NUMERIC-FIELD                            15020099
150300                                   TO  ASC-START-ITEM-REQUEST-N   15030099
150400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  15040099
150500                 IF  ASC-START-ITEM-REQUEST-N >                   15050099
150600                                          ASC-NUMBER-OF-ITEMS-READ15060099
150700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         15070099
150800                     COMPUTE PV-TOP-ITEM =                        15080099
150900                             ASC-NUMBER-OF-ITEMS-READ             15090099
151000                             - PC-ITEMS-PER-PANEL + 1             15100099
151100                     IF  PV-TOP-ITEM < +1                         15110099
151200                         MOVE +1   TO PV-TOP-ITEM                 15120099
151300                         MOVE PC-TSYMSG-00070                     15130099
151400                                   TO DP020-MSG-NUMBER            15140099
151500                         SET DP020-MSG-INFORMATIONAL              15150099
151600                                   TO TRUE                        15160099
151700                     END-IF                                       15170099
151800                 ELSE                                             15180099
151900                     MOVE ASC-START-ITEM-REQUEST-N                15190099
152000                                   TO PV-TOP-ITEM                 15200099
152100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      15210099
152200                     COMPUTE PV-BOTTOM-ITEM =                     15220099
152300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     15230099
152400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ15240099
152500*                        -- BOTTOM OF LIST --                     15250099
152600                         MOVE PC-TSYMSG-00070                     15260099
152700                                   TO DP020-MSG-NUMBER            15270099
152800                         SET DP020-MSG-INFORMATIONAL              15280099
152900                                   TO TRUE                        15290099
153000                     END-IF                                       15300099
153100                 END-IF                                           15310099
153200             ELSE                                                 15320099
153300*                --- VALUE OUT OF RANGE ----                      15330099
153400                 MOVE PC-TSYMSG-00101                             15340099
153500                                   TO DP020-MSG-NUMBER            15350099
153600                 MOVE -1           TO ASTRTITL                    15360099
153700                 SET DP030-SET-CURSOR-APPL-1                      15370099
153800                                   TO TRUE                        15380099
153900                 MOVE DP015-REVERSE                               15390099
154000                                   TO ASTRTITH                    15400099
154100                 MOVE DP015-RED    TO ASTRTITC                    15410099
154200                 MOVE DP015-UNP-NUM-BRT-MDT                       15420099
154300                                   TO ASTRTITA                    15430099
154400                 SET DP020-MSG-FATAL                              15440099
154500                                   TO TRUE                        15450099
154600                 SET PS-ERROR      TO TRUE                        15460099
154700             END-IF                                               15470099
154800                                                                  15480099
154900         ELSE                                                     15490099
155000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            15500099
155100             MOVE -1               TO ASTRTITL                    15510099
155200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  15520099
155300             MOVE DP015-REVERSE    TO ASTRTITH                    15530099
155400             MOVE DP015-RED        TO ASTRTITC                    15540099
155500             MOVE DP015-UNP-NUM-BRT-MDT                           15550099
155600                                   TO ASTRTITA                    15560099
155700             SET DP020-MSG-FATAL   TO TRUE                        15570099
155800             SET PS-ERROR          TO TRUE                        15580099
155900         END-IF                                                   15590099
156000     END-IF.                                                      15600099
156100 EJECT                                                            15610099
156200*----------------------------------------------------------------*15620099
156300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *15630099
156400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *15640099
156500*----------------------------------------------------------------*15650099
156600 2140-DESELECT-ALL-ITEMS.                                         15660099
156700     MOVE +1                       TO ASC-BLK-SUB.                15670099
156800                                                                  15680099
156900     PERFORM 2141-CLEAR-SELECTED-INDS                             15690099
157000         VARYING ASC-ITEM-SUB                                     15700099
157100         FROM 1 BY 1                                              15710099
157200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15720099
157300                                                                  15730099
157400     ADD +1                        TO ASC-BLK-SUB.                15740099
157500                                                                  15750099
157600     PERFORM 2141-CLEAR-SELECTED-INDS                             15760099
157700         VARYING ASC-ITEM-SUB                                     15770099
157800         FROM 1 BY 1                                              15780099
157900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15790099
158000                                                                  15800099
158100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15810099
158200                                   TO PV-LIST-ITEM-NUMBER.        15820099
158300                                                                  15830099
158400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15840099
158500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15850099
158600                                                                  15860099
158700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15870099
158800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      15880099
158900         MOVE +1                   TO ASC-BLK-SUB                 15890099
159000                                                                  15900099
159100         PERFORM 5100-WRITE-TEMP-STORAGE                          15910099
159200                                                                  15920099
159300         MOVE +1                   TO PV-BLOCK-NUMBER             15930099
159400                                                                  15940099
159500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15950099
159600             PV-FIRST-BLOCK-IN-ARRAY - 1                          15960099
159700                                                                  15970099
159800         PERFORM                                                  15980099
159900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15990099
160000                                                                  16000099
160100             PERFORM 4410-READ-TEMP-STORAGE                       16010099
160200                                                                  16020099
160300             PERFORM 2141-CLEAR-SELECTED-INDS                     16030099
160400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 16040099
160500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16050099
160600                                                                  16060099
160700             PERFORM 5100-WRITE-TEMP-STORAGE                      16070099
160800                                                                  16080099
160900             ADD +1                TO PV-BLOCK-NUMBER             16090099
161000                                                                  16100099
161100         END-PERFORM                                              16110099
161200                                                                  16120099
161300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16130099
161400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16140099
161500                                                                  16150099
161600         PERFORM                                                  16160099
161700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16170099
161800                   ASC-HIGHEST-BLOCK-WRITTEN                      16180099
161900                                                                  16190099
162000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16200099
162100                                   TO PV-BLOCK-NUMBER             16210099
162200                                                                  16220099
162300             PERFORM 4410-READ-TEMP-STORAGE                       16230099
162400                                                                  16240099
162500             PERFORM 2141-CLEAR-SELECTED-INDS                     16250099
162600                 VARYING ASC-ITEM-SUB                             16260099
162700                 FROM 1 BY 1                                      16270099
162800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16280099
162900                                                                  16290099
163000             PERFORM 5100-WRITE-TEMP-STORAGE                      16300099
163100                                                                  16310099
163200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16320099
163300                                                                  16330099
163400         END-PERFORM                                              16340099
163500                                                                  16350099
163600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16360099
163700                                   TO PV-BLOCK-NUMBER             16370099
163800                                                                  16380099
163900         PERFORM 4410-READ-TEMP-STORAGE                           16390099
164000     END-IF.                                                      16400099
164100                                                                  16410099
164200                                                                  16420099
164300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 16430099
164400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.16440099
164500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  16450099
164600                                                                  16460099
164700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16470099
164800                                                                  16480099
164900 EJECT                                                            16490099
165000*----------------------------------------------------------------*16500099
165100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *16510099
165200*----------------------------------------------------------------*16520099
165300                                                                  16530099
165400 2141-CLEAR-SELECTED-INDS.                                        16540099
165500                                                                  16550099
165600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16560099
165700             NOT EQUAL ZERO                                       16570099
165800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16580099
165900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16590099
166000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    16600099
166100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16610099
166200                                   TO TRUE                        16620099
166300         END-IF                                                   16630099
166400     END-IF.                                                      16640099
166500                                                                  16650099
166600 EJECT                                                            16660099
166700*----------------------------------------------------------------*16670099
166800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *16680099
166900*  FOR ALL ITEMS.                                                *16690099
167000*----------------------------------------------------------------*16700099
167100                                                                  16710099
167200 2150-SELECT-ALL-ITEMS.                                           16720099
167300                                                                  16730099
167400     MOVE +1                       TO ASC-BLK-SUB.                16740099
167500                                                                  16750099
167600     PERFORM 2151-SET-SELECTED-INDS                               16760099
167700         VARYING ASC-ITEM-SUB                                     16770099
167800         FROM 1 BY 1                                              16780099
167900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16790099
168000                                                                  16800099
168100     ADD +1                        TO ASC-BLK-SUB.                16810099
168200                                                                  16820099
168300     PERFORM 2151-SET-SELECTED-INDS                               16830099
168400         VARYING ASC-ITEM-SUB                                     16840099
168500         FROM 1 BY 1                                              16850099
168600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16860099
168700                                                                  16870099
168800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16880099
168900                                   TO PV-LIST-ITEM-NUMBER.        16890099
169000                                                                  16900099
169100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16910099
169200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16920099
169300                                                                  16930099
169400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16940099
169500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    16950099
169600         MOVE +1                   TO ASC-BLK-SUB                 16960099
169700                                                                  16970099
169800         PERFORM 5100-WRITE-TEMP-STORAGE                          16980099
169900                                                                  16990099
170000         MOVE +1                   TO PV-BLOCK-NUMBER             17000099
170100                                                                  17010099
170200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17020099
170300             PV-FIRST-BLOCK-IN-ARRAY - 1                          17030099
170400                                                                  17040099
170500         PERFORM                                                  17050099
170600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       17060099
170700                                                                  17070099
170800             PERFORM 4410-READ-TEMP-STORAGE                       17080099
170900                                                                  17090099
171000             PERFORM 2151-SET-SELECTED-INDS                       17100099
171100                 VARYING ASC-ITEM-SUB                             17110099
171200                 FROM 1 BY 1                                      17120099
171300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17130099
171400                                                                  17140099
171500             PERFORM 5100-WRITE-TEMP-STORAGE                      17150099
171600                                                                  17160099
171700             ADD +1                TO PV-BLOCK-NUMBER             17170099
171800                                                                  17180099
171900         END-PERFORM                                              17190099
172000                                                                  17200099
172100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17210099
172200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17220099
172300                                                                  17230099
172400         PERFORM                                                  17240099
172500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17250099
172600                   ASC-HIGHEST-BLOCK-WRITTEN                      17260099
172700                                                                  17270099
172800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17280099
172900                                   TO PV-BLOCK-NUMBER             17290099
173000                                                                  17300099
173100             PERFORM 4410-READ-TEMP-STORAGE                       17310099
173200                                                                  17320099
173300             PERFORM 2151-SET-SELECTED-INDS                       17330099
173400                 VARYING ASC-ITEM-SUB                             17340099
173500                 FROM 1 BY 1                                      17350099
173600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17360099
173700                                                                  17370099
173800             PERFORM 5100-WRITE-TEMP-STORAGE                      17380099
173900                                                                  17390099
174000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17400099
174100                                                                  17410099
174200         END-PERFORM                                              17420099
174300                                                                  17430099
174400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17440099
174500                                   TO PV-BLOCK-NUMBER             17450099
174600                                                                  17460099
174700         PERFORM 4410-READ-TEMP-STORAGE                           17470099
174800     END-IF.                                                      17480099
174900                                                                  17490099
175000                                                                  17500099
175100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             17510099
175200                       ASC-NUMBER-OF-SELECTED-ITEMS.              17520099
175300                                                                  17530099
175400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        17540099
175500                                                                  17550099
175600 EJECT                                                            17560099
175700*----------------------------------------------------------------*17570099
175800*    MARK EACH ITEM AS BEING SELECTED.                           *17580099
175900*----------------------------------------------------------------*17590099
176000                                                                  17600099
176100 2151-SET-SELECTED-INDS.                                          17610099
176200                                                                  17620099
176300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           17630099
176400             NOT EQUAL ZERO                                       17640099
176500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             17650099
176600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             17660099
176700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        17670099
176800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  17680099
176900                               TO  TRUE                           17690099
177000         END-IF                                                   17700099
177100     END-IF.                                                      17710099
177200******************************************************************17720099
177300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **17730099
177400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **17740099
177500******************************************************************17750099
177600 2200-MOVE-SCREEN-TO-COMMAREA.                                    17760099
177700                                                                  17770099
177800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             17780099
177900     MOVE +1                       TO PV-SUB.                     17790099
178000                                                                  17800099
178100     PERFORM 3100-SET-SUBSCRIPTS.                                 17810099
178200     IF  ASTRTITL > ZERO                                          17820099
178300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          17830099
178400     ELSE                                                         17840099
178500         IF  ASTRTITF = DP015-ERASE-EOF                           17850099
178600             INITIALIZE ASC-START-ITEM-REQUEST                    17860099
178700         END-IF                                                   17870099
178800     END-IF.                                                      17880099
178900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          17890099
179000         VARYING PV-SUB                                           17900099
179100         FROM 1 BY 1                                              17910099
179200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      17920099
179300******************************************************************17930099
179400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**17940099
179500******************************************************************17950099
179600 2210-MOVE-LINES-TO-COMMAREA.                                     17960099
179700     IF  MR-SELECTL (PV-SUB) > ZERO                               17970099
179800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             17980099
179900         MOVE MR-SELECTI (PV-SUB)                                 17990099
180000                                   TO ASC-TEMP-SELECTED-SW        18000099
180100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      18010099
180200     ELSE                                                         18020099
180300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                18030099
180400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     18040099
180500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        18050099
180600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      18060099
180700         END-IF                                                   18070099
180800     END-IF.                                                      18080099
180900     ADD +1                        TO ASC-ITEM-SUB.               18090099
181000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18100099
181100         ADD +1                    TO ASC-BLK-SUB                 18110099
181200         MOVE +1                   TO ASC-ITEM-SUB                18120099
181300     END-IF.                                                      18130099
181400******************************************************************18140099
181500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **18150099
181600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **18160099
181700******************************************************************18170099
181800 3000-EDIT-DATA-IN-COMMAREA.                                      18180099
181900     SET PS-NO-ERROR               TO TRUE.                       18190099
182000     PERFORM 3200-RESET-ATTRIBUTES.                               18200099
182100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     18210099
182200**                                                                18220099
182300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              18230099
182400* EDITTING IS DONE FROM THE BOTTOM UP.                            18240099
182500**                                                                18250099
182600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       18260099
182700         ASC-ITEMS-DISPLAYED - 1.                                 18270099
182800     PERFORM 3100-SET-SUBSCRIPTS.                                 18280099
182900     PERFORM 3300-EDIT-SELECTIONS                                 18290099
183000         VARYING PV-SUB                                           18300099
183100         FROM PV-SUB BY -1                                        18310099
183200         UNTIL PV-SUB < +1                                        18320099
183300                                                                  18330099
183400     IF  PS-NO-ERROR                                              18340099
183500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        18350099
183600     END-IF.                                                      18360099
183700                                                                  18370099
183800     IF  ((PS-NO-ERROR)                                           18380099
183900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   18390099
184000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    18400099
184100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  18410099
184200     END-IF.                                                      18420099
184300 EJECT                                                            18430099
184400*----------------------------------------------------------------*18440099
184500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *18450099
184600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*18460099
184700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *18470099
184800*                                                                *18480099
184900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *18490099
185000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *18500099
185100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *18510099
185200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *18520099
185300*----------------------------------------------------------------*18530099
185400                                                                  18540099
185500 3100-SET-SUBSCRIPTS.                                             18550099
185600                                                                  18560099
185700     COMPUTE ASC-ITEM-SUB =                                       18570099
185800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        18580099
185900                                                                  18590099
186000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         18600099
186100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18610099
186200                                                                  18620099
186300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               18630099
186400     ELSE                                                         18640099
186500         MOVE +1                     TO ASC-BLK-SUB               18650099
186600     END-IF.                                                      18660099
186700******************************************************************18670099
186800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **18680099
186900******************************************************************18690099
187000                                                                  18700099
187100 3200-RESET-ATTRIBUTES.                                           18710099
187200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   18720099
187300     MOVE DP015-GREEN              TO ASTRTITC.                   18730099
187400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   18740099
187500                                                                  18750099
187600     PERFORM                                                      18760099
187700         VARYING PV-SUB                                           18770099
187800         FROM 1 BY 1                                              18780099
187900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        18790099
188000         MOVE DP015-UNP-ALP-NOR-OFF                               18800099
188100                                   TO MR-SELECTA (PV-SUB)         18810099
188200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         18820099
188300         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         18830099
188400     END-PERFORM.                                                 18840099
188500******************************************************************18850099
188600** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **18860099
188700** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **18870099
188800** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **18880099
188900** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **18890099
189000******************************************************************18900099
189100 3300-EDIT-SELECTIONS.                                            18910099
189200     EVALUATE TRUE                                                18920099
189300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18930099
189400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         18940099
189500                 CONTINUE                                         18950099
189600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         18960099
189700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        18970099
189800                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   18980099
189900                 MOVE ASC-TEMP-SELECTED-SW                        18990099
190000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19000099
190100                                TO ASC-SELECTED-SW                19010099
190200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19020099
190300             END-IF                                               19030099
190400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     19040099
190500                 = SPACE                                          19050099
190600             EVALUATE TRUE                                        19060099
190700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       19070099
190800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS19080099
190900                     MOVE SPACE TO ASC-SELECTED-SW                19090099
191000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19100099
191100                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        19110099
191200                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    19120099
191300                     MOVE SPACE TO ASC-SELECTED-SW                19130099
191400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19140099
191500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          19150099
191600                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      19160099
191700                     MOVE SPACE TO ASC-SELECTED-SW                19170099
191800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19180099
191900             END-EVALUATE                                         19190099
192000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           19200099
192100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19210099
192200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19220099
192300             END-IF                                               19230099
192400             PERFORM 3310-EDIT-RANGE                              19240099
192500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             19250099
192600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19260099
192700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19270099
192800             END-IF                                               19280099
192900             PERFORM 3310-EDIT-RANGE                              19290099
193000         WHEN OTHER                                               19300099
193100             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           19310099
193200             SET DP020-MSG-FATAL    TO TRUE                       19320099
193300             MOVE -1                TO MR-SELECTL (PV-SUB)        19330099
193400             SET DP030-SET-CURSOR-APPL-1                          19340099
193500                                    TO TRUE                       19350099
193600             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        19360099
193700             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        19370099
193800             SET PS-ERROR TO TRUE                                 19380099
193900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19390099
194000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     19400099
194100                 MOVE SPACE         TO ASC-SELECTED-SW            19410099
194200                                        (ASC-BLK-SUB ASC-ITEM-SUB)19420099
194300             END-IF                                               19430099
194400     END-EVALUATE.                                                19440099
194500                                                                  19450099
194600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 19460099
194700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19470099
194800     IF  ASC-ITEM-SUB < 1                                         19480099
194900         SUBTRACT +1 FROM ASC-BLK-SUB                             19490099
195000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                19500099
195100     END-IF.                                                      19510099
195200******************************************************************19520099
195300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **19530099
195400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **19540099
195500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**19550099
195600** THE ENDING.                                                  **19560099
195700******************************************************************19570099
195800 3310-EDIT-RANGE.                                                 19580099
195900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                19590099
196000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   19600099
196100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)19610099
196200                                   TO ASC-SELECTED-SW             19620099
196300                                        (ASC-BLK-SUB ASC-ITEM-SUB)19630099
196400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 19640099
196500         ELSE                                                     19650099
196600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     19660099
196700                 CONTINUE                                         19670099
196800             ELSE                                                 19680099
196900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        19690099
197000                 MOVE PC-TSYMSG-00054                             19700099
197100                                   TO DP020-MSG-NUMBER            19710099
197200                 SET DP020-MSG-FATAL                              19720099
197300                                   TO TRUE                        19730099
197400                 MOVE -1           TO MR-SELECTL (PV-SUB)         19740099
197500                 SET DP030-SET-CURSOR-APPL-1                      19750099
197600                                   TO TRUE                        19760099
197700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         19770099
197800                 MOVE DP015-UNDERLINE                             19780099
197900                                   TO MR-SELECTH (PV-SUB)         19790099
198000                 SET PS-ERROR      TO TRUE                        19800099
198100             END-IF                                               19810099
198200         END-IF                                                   19820099
198300     ELSE                                                         19830099
198400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19840099
198500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19850099
198600                                   TO ASC-SELECTED-SW             19860099
198700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19870099
198800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   19880099
198900         ELSE                                                     19890099
199000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       19900099
199100                 CONTINUE                                         19910099
199200             ELSE                                                 19920099
199300*                -- ONLY ONE END-OF-RANGE ALLOWED --              19930099
199400                 MOVE PC-TSYMSG-00055                             19940099
199500                                   TO DP020-MSG-NUMBER            19950099
199600                 SET DP020-MSG-FATAL                              19960099
199700                                   TO TRUE                        19970099
199800                 MOVE -1           TO MR-SELECTL (PV-SUB)         19980099
199900                 SET DP030-SET-CURSOR-APPL-1                      19990099
200000                                   TO TRUE                        20000099
200100                 SET PS-ERROR      TO TRUE                        20010099
200200             END-IF                                               20020099
200300         END-IF                                                   20030099
200400     END-IF.                                                      20040099
200500                                                                  20050099
200600******************************************************************20060099
200700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **20070099
200800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **20080099
200900******************************************************************20090099
201000 3400-CHECK-RANGE-SEQUENCE.                                       20100099
201100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20110099
201200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      20120099
201300       AND  ASC-START-OF-SELECTED-RANGE >                         20130099
201400                                         ASC-END-OF-SELECTED-RANGE20140099
201500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                20150099
201600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 20160099
201700         SET DP020-MSG-FATAL TO TRUE                              20170099
201800         SET PS-ERROR TO TRUE                                     20180099
201900         PERFORM 3410-POSITION-AT-ERROR                           20190099
202000     END-IF.                                                      20200099
202100******************************************************************20210099
202200** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **20220099
202300** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **20230099
202400** SHOULD BE POSITIONED ON A RANGE ERROR.                       **20240099
202500******************************************************************20250099
202600 3410-POSITION-AT-ERROR.                                          20260099
202700     SET DP030-SET-CURSOR-APPL-1                                  20270099
202800                                   TO TRUE.                       20280099
202900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20290099
203000                    - PV-TOP-ITEM + 1.                            20300099
203100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20310099
203200         CONTINUE                                                 20320099
203300     ELSE                                                         20330099
203400         MOVE -1                   TO MR-SELECTL (PV-SUB)         20340099
203500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20350099
203600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20360099
203700     END-IF.                                                      20370099
203800                                                                  20380099
203900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20390099
204000                    - PV-TOP-ITEM + 1.                            20400099
204100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20410099
204200         CONTINUE                                                 20420099
204300     ELSE                                                         20430099
204400         MOVE -1                   TO MR-SELECTL (PV-SUB)         20440099
204500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20450099
204600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20460099
204700     END-IF.                                                      20470099
204800 EJECT                                                            20480099
204900*----------------------------------------------------------------*20490099
205000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *20500099
205100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *20510099
205200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *20520099
205300*----------------------------------------------------------------*20530099
205400                                                                  20540099
205500 3500-MARK-RANGE-AS-SELECTED.                                     20550099
205600     MOVE +1                       TO  ASC-BLK-SUB.               20560099
205700     PERFORM 3510-MARK-SELECTED-INDS                              20570099
205800         VARYING ASC-ITEM-SUB                                     20580099
205900         FROM 1 BY 1                                              20590099
206000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20600099
206100                                                                  20610099
206200     ADD +1                        TO ASC-BLK-SUB.                20620099
206300     PERFORM 3510-MARK-SELECTED-INDS                              20630099
206400         VARYING ASC-ITEM-SUB                                     20640099
206500         FROM 1 BY 1                                              20650099
206600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20660099
206700                                                                  20670099
206800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               20680099
206900                                   TO  PV-LIST-ITEM-NUMBER.       20690099
207000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20700099
207100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         20710099
207200               PC-ITEMS-PER-PANEL).                               20720099
207300                                                                  20730099
207400     MOVE ASC-START-OF-SELECTED-RANGE                             20740099
207500                                   TO PV-START-OF-SELECTED-RANGE. 20750099
207600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            20760099
207700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  20770099
207800               PC-ITEMS-PER-PANEL).                               20780099
207900                                                                  20790099
208000     MOVE ASC-END-OF-SELECTED-RANGE                               20800099
208100                                   TO  PV-END-OF-SELECTED-RANGE.  20810099
208200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             20820099
208300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    20830099
208400               PC-ITEMS-PER-PANEL).                               20840099
208500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             20850099
208600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             20860099
208700                                                                  20870099
208800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    20880099
208900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        20890099
209000         MOVE +1                   TO ASC-BLK-SUB                 20900099
209100         PERFORM 5100-WRITE-TEMP-STORAGE                          20910099
209200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20920099
209300             PV-FIRST-BLOCK-IN-ARRAY - 1                          20930099
209400                                                                  20940099
209500         PERFORM                                                  20950099
209600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      20960099
209700                   PV-PREV-BLOCK-IN-ARRAY                         20970099
209800             MOVE PV-FIRST-BLOCK-IN-RANGE                         20980099
209900                                   TO PV-BLOCK-NUMBER             20990099
210000             PERFORM 4410-READ-TEMP-STORAGE                       21000099
210100             PERFORM 3510-MARK-SELECTED-INDS                      21010099
210200                 VARYING ASC-ITEM-SUB                             21020099
210300                 FROM 1 BY 1                                      21030099
210400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21040099
210500             PERFORM 5100-WRITE-TEMP-STORAGE                      21050099
210600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     21060099
210700         END-PERFORM                                              21070099
210800                                                                  21080099
210900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         21090099
211000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     21100099
211100         PERFORM                                                  21110099
211200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       21120099
211300                   PV-LAST-BLOCK-IN-RANGE                         21130099
211400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          21140099
211500                                   TO PV-BLOCK-NUMBER             21150099
211600             PERFORM 4410-READ-TEMP-STORAGE                       21160099
211700             PERFORM 3510-MARK-SELECTED-INDS                      21170099
211800                 VARYING ASC-ITEM-SUB                             21180099
211900                 FROM 1 BY 1                                      21190099
212000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          21200099
212100             PERFORM 5100-WRITE-TEMP-STORAGE                      21210099
212200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      21220099
212300         END-PERFORM                                              21230099
212400                                                                  21240099
212500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21250099
212600                                   TO PV-BLOCK-NUMBER             21260099
212700         PERFORM 4410-READ-TEMP-STORAGE                           21270099
212800     END-IF.                                                      21280099
212900                                                                  21290099
213000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 21300099
213100                                      ASC-END-OF-SELECTED-RANGE.  21310099
213200                                                                  21320099
213300 EJECT                                                            21330099
213400*----------------------------------------------------------------*21340099
213500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *21350099
213600*----------------------------------------------------------------*21360099
213700                                                                  21370099
213800 3510-MARK-SELECTED-INDS.                                         21380099
213900                                                                  21390099
214000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21400099
214100                                ASC-ITEM-SUB) >                   21410099
214200         ASC-START-OF-SELECTED-RANGE)                             21420099
214300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21430099
214400                                ASC-ITEM-SUB) =                   21440099
214500         ASC-START-OF-SELECTED-RANGE)                             21450099
214600                                                                  21460099
214700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21470099
214800                                    ASC-ITEM-SUB) <               21480099
214900             ASC-END-OF-SELECTED-RANGE)                           21490099
215000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21500099
215100                                    ASC-ITEM-SUB) =               21510099
215200             ASC-END-OF-SELECTED-RANGE)                           21520099
215300                                                                  21530099
215400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21540099
215500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   21550099
215600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   21560099
215700                               TO TRUE                            21570099
215800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              21580099
215900                               TO TRUE                            21590099
216000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    21600099
216100             END-IF                                               21610099
216200         END-IF                                                   21620099
216300     END-IF.                                                      21630099
216400                                                                  21640099
216500 EJECT                                                            21650099
216600*----------------------------------------------------------------*21660099
216700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *21670099
216800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *21680099
216900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *21690099
217000*    DISPLAY THE PANEL TO USER.                                  *21700099
217100*----------------------------------------------------------------*21710099
217200                                                                  21720099
217300 4000-BUILD-INITIAL-PANEL.                                        21730099
217400                                                                  21740099
217500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            21750099
217600                                 ASC-BLOCK-ENTRIES (2).           21760099
217700     MOVE +1                 TO ASC-BLK-SUB.                      21770099
217800     SET ASC-ITEMS-LEFT-ON-DB                                     21780099
217900                             TO TRUE.                             21790099
218000                                                                  21800099
218100     MOVE +0                 TO ASC-ITEM-SUB                      21810099
218200                                ASC-NUMBER-OF-ITEMS-READ          21820099
218300                                ASC-NUMBER-OF-SELECTED-ITEMS      21830099
218400                                ASC-HIGHEST-BLOCK-WRITTEN         21840099
218500                                ASC-START-OF-SELECTED-RANGE       21850099
218600                                ASC-END-OF-SELECTED-RANGE         21860099
218700                                ASC-ITEM-AT-TOP-OF-PANEL.         21870099
218800     PERFORM 4100-PREPARE-CURSOR                                  21880099
218900                                                                  21890099
219000     PERFORM 4010-OPEN-CURSOR.                                    21900099
219100                                                                  21910099
219200     PERFORM 4300-READ-ITEMS-FROM-DB.                             21920099
219300                                                                  21930099
219400     PERFORM 4020-CLOSE-CURSOR.                                   21940099
219500                                                                  21950099
219600     MOVE +1                   TO  PV-TOP-ITEM.                   21960099
219700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          21970099
219800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    21980099
219900         SET DP020-MSG-FATAL   TO  TRUE                           21990099
220000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               22000099
220100     ELSE                                                         22010099
220200         MOVE -1               TO MR-SELECTL (1)                  22020099
220300         SET DP030-SET-CURSOR-APPL-1                              22030099
220400                               TO TRUE                            22040099
220500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     22050099
220600     END-IF.                                                      22060099
220700 EJECT                                                            22070099
220800*----------------------------------------------------------------*22080099
220900* OPEN THE ADJUSTMENT CURSOR.                                    *22090099
221000*   IN THIS PARTICULAR APPLICATION ONE OF 13 DIFFERENT CURSORS   *22100099
221100*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *22110099
221200*   USER.                                                        *22120099
221300*----------------------------------------------------------------*22130099
221400                                                                  22140099
221500 4010-OPEN-CURSOR.                                                22150099
221600     PERFORM                                                      22160099
221700         WITH TEST AFTER                                          22170099
221800         VARYING PV-RETRY-COUNTER                                 22180099
221900         FROM 1 BY 1                                              22190099
222000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22200099
222100                   OR (SQLCODE = ZERO))                           22210099
222200         EVALUATE TRUE                                            22220099
222300             WHEN ASC-PO-NBR-CURSOR                               22230099
222400                 MOVE 'CURSOR:  PO-NBR-CSR'                       22240099
222500                                   TO DP013-MESSAGE-TEXT (2)      22250099
222600                 EXEC SQL                                         22260099
222700                      OPEN PO-NBR-CSR                             22270099
222800                 END-EXEC                                         22280099
222900                                                                  22290099
223000             WHEN ASC-PO-TRAN-CURSOR                              22300099
223100                 MOVE 'CURSOR:  PO-TRAN-CSR'                      22310099
223200                                   TO DP013-MESSAGE-TEXT (2)      22320099
223300                 EXEC SQL                                         22330099
223400                      OPEN PO-TRAN-CSR                            22340099
223500                 END-EXEC                                         22350099
223600                                                                  22360099
223700             WHEN ASC-VEND-NO-TP-CURSOR                           22370099
223800                 MOVE 'CURSOR:  VEND-NO-TP-CSR'                   22380099
223900                                   TO DP013-MESSAGE-TEXT (2)      22390099
224000                 EXEC SQL                                         22400099
224100                      OPEN VEND-NO-TP-CSR                         22410099
224200                 END-EXEC                                         22420099
224300                                                                  22430099
224400             WHEN ASC-VEND-NO-DP-CURSOR                           22440099
224500                 MOVE 'CURSOR:  VEND-NO-DP-CSR'                   22450099
224600                                   TO DP013-MESSAGE-TEXT (2)      22460099
224700                 EXEC SQL                                         22470099
224800                      OPEN VEND-NO-DP-CSR                         22480099
224900                 END-EXEC                                         22490099
225000                                                                  22500099
225100             WHEN ASC-VEND-NO-AC-CURSOR                           22510099
225200                 MOVE 'CURSOR:  VEND-NO-AC-CSR'                   22520099
225300                                   TO DP013-MESSAGE-TEXT (2)      22530099
225400                 EXEC SQL                                         22540099
225500                      OPEN VEND-NO-AC-CSR                         22550099
225600                 END-EXEC                                         22560099
225700                                                                  22570099
225800             WHEN ASC-VENDOR-NBR-CURSOR                           22580099
225900                 MOVE 'CURSOR:  VENDOR-NBR-CSR'                   22590099
226000                                   TO DP013-MESSAGE-TEXT (2)      22600099
226100                 EXEC SQL                                         22610099
226200                      OPEN VENDOR-NBR-CSR                         22620099
226300                 END-EXEC                                         22630099
226400                                                                  22640099
226500             WHEN ASC-VEND-NM-TP-CURSOR                           22650099
226600                 MOVE 'CURSOR:  VEND-NM-TP-CSR'                   22660099
226700                                   TO DP013-MESSAGE-TEXT (2)      22670099
226800                 EXEC SQL                                         22680099
226900                      OPEN VEND-NM-TP-CSR                         22690099
227000                 END-EXEC                                         22700099
227100                                                                  22710099
227200             WHEN ASC-VEND-NM-DP-CURSOR                           22720099
227300                 MOVE 'CURSOR:  VEND-NM-DP-CSR'                   22730099
227400                                   TO DP013-MESSAGE-TEXT (2)      22740099
227500                 EXEC SQL                                         22750099
227600                      OPEN VEND-NM-DP-CSR                         22760099
227700                 END-EXEC                                         22770099
227800                                                                  22780099
227900             WHEN ASC-VEND-NM-AC-CURSOR                           22790099
228000                 MOVE 'CURSOR:  VEND-NM-AC-CSR'                   22800099
228100                                   TO DP013-MESSAGE-TEXT (2)      22810099
228200                 EXEC SQL                                         22820099
228300                      OPEN VEND-NM-AC-CSR                         22830099
228400                 END-EXEC                                         22840099
228500                                                                  22850099
228600             WHEN ASC-VENDOR-NAM-CURSOR                           22860099
228700                 MOVE 'CURSOR:  VEND-NAM-CSR'                     22870099
228800                                   TO DP013-MESSAGE-TEXT (2)      22880099
228900                 EXEC SQL                                         22890099
229000                      OPEN VEND-NAM-CSR                           22900099
229100                 END-EXEC                                         22910099
229200                                                                  22920099
229300             WHEN ASC-ACCT-NO-CURSOR                              22930099
229400                 MOVE 'CURSOR:  ACCT-NO-CSR'                      22940099
229500                                   TO DP013-MESSAGE-TEXT (2)      22950099
229600                 EXEC SQL                                         22960099
229700                      OPEN ACCT-NO-CSR                            22970099
229800                 END-EXEC                                         22980099
229900                                                                  22990099
230000             WHEN ASC-DEPT-CURSOR                                 23000099
230100                 MOVE 'CURSOR:  DEPT-CSR'                         23010099
230200                                   TO DP013-MESSAGE-TEXT (2)      23020099
230300                 EXEC SQL                                         23030099
230400                      OPEN DEPT-CSR                               23040099
230500                 END-EXEC                                         23050099
230600                                                                  23060099
230700             WHEN ASC-DOC-NBR-CURSOR                              23070099
230800                 MOVE 'CURSOR:  DOC-NBR-CSR'                      23080099
230900                                   TO DP013-MESSAGE-TEXT (2)      23090099
231000                 EXEC SQL                                         23100099
231100                      OPEN DOC-NBR-CSR                            23110099
231200                 END-EXEC                                         23120099
231300         END-EVALUATE                                             23130099
231400                                                                  23140099
231500         EVALUATE TRUE                                            23150099
231600             WHEN SQLCODE = ZERO                                  23160099
231700             WHEN SQLCODE = -904                                  23170099
231800             WHEN SQLCODE = -913                                  23180099
231900                 CONTINUE                                         23190099
232000             WHEN SQLWARN0 NOT = SPACES                           23200099
232100             WHEN SQLCODE < ZERO                                  23210099
232200             WHEN SQLCODE > ZERO                                  23220099
232300                 MOVE '4010-OPEN-CURSOR'                          23230099
232400                                   TO DP013-PARAGRAPH             23240099
232500                 MOVE 'OPEN ADJUSTMENT CURSOR - '                 23250099
232600                                   TO DP013-MESSAGE-TEXT (1)      23260099
232700                 MOVE SQLCA        TO DP013-SQLCA                 23270099
232800                 MOVE 'TADJRNL '   TO DP013-DB2-TABLE-NAME (1)    23280099
232900                 SET DP013-DB2-ABEND                              23290099
233000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23300099
233100                 PERFORM DP013-0000-PROCESS-ABEND                 23310099
233200         END-EVALUATE                                             23320099
233300     END-PERFORM.                                                 23330099
233400                                                                  23340099
233500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23350099
233600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             23360099
233700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   23370099
233800                                   TO DP013-MESSAGE-TEXT (1)      23380099
233900         MOVE SQLCA                TO DP013-SQLCA                 23390099
234000         MOVE 'TADJRNL '           TO DP013-DB2-TABLE-NAME (1)    23400099
234100         SET DP013-DB2-ABEND                                      23410099
234200             DP013-XCTL-DISPLAY-RESTART                           23420099
234300                                   TO TRUE                        23430099
234400         PERFORM DP013-0000-PROCESS-ABEND                         23440099
234500     END-IF.                                                      23450099
234600                                                                  23460099
234700 EJECT                                                            23470099
234800*----------------------------------------------------------------*23480099
234900* CLOSE THE ADJUSTMENT CURSOR.                                   *23490099
235000*   IN THIS PARTICULAR APPLICATION ONE OF 13 DIFFERENT CURSORS   *23500099
235100*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *23510099
235200*   USER.                                                        *23520099
235300*----------------------------------------------------------------*23530099
235400                                                                  23540099
235500 4020-CLOSE-CURSOR.                                               23550099
235600     EVALUATE TRUE                                                23560099
235700         WHEN ASC-PO-NBR-CURSOR                                   23570099
235800             EXEC SQL                                             23580099
235900                 CLOSE PO-NBR-CSR                                 23590099
236000             END-EXEC                                             23600099
236100                                                                  23610099
236200         WHEN ASC-PO-TRAN-CURSOR                                  23620099
236300             EXEC SQL                                             23630099
236400                 CLOSE PO-TRAN-CSR                                23640099
236500             END-EXEC                                             23650099
236600                                                                  23660099
236700         WHEN ASC-VEND-NO-TP-CURSOR                               23670099
236800             EXEC SQL                                             23680099
236900                 CLOSE VEND-NO-TP-CSR                             23690099
237000             END-EXEC                                             23700099
237100                                                                  23710099
237200         WHEN ASC-VEND-NO-DP-CURSOR                               23720099
237300             EXEC SQL                                             23730099
237400                 CLOSE VEND-NO-DP-CSR                             23740099
237500             END-EXEC                                             23750099
237600                                                                  23760099
237700         WHEN ASC-VEND-NO-AC-CURSOR                               23770099
237800             EXEC SQL                                             23780099
237900                 CLOSE VEND-NO-AC-CSR                             23790099
238000             END-EXEC                                             23800099
238100                                                                  23810099
238200         WHEN ASC-VENDOR-NBR-CURSOR                               23820099
238300             EXEC SQL                                             23830099
238400                 CLOSE VENDOR-NBR-CSR                             23840099
238500             END-EXEC                                             23850099
238600                                                                  23860099
238700         WHEN ASC-VEND-NM-TP-CURSOR                               23870099
238800             EXEC SQL                                             23880099
238900                 CLOSE VEND-NM-TP-CSR                             23890099
239000             END-EXEC                                             23900099
239100                                                                  23910099
239200         WHEN ASC-VEND-NM-DP-CURSOR                               23920099
239300             EXEC SQL                                             23930099
239400                 CLOSE VEND-NM-DP-CSR                             23940099
239500             END-EXEC                                             23950099
239600                                                                  23960099
239700         WHEN ASC-VEND-NM-AC-CURSOR                               23970099
239800             EXEC SQL                                             23980099
239900                 CLOSE VEND-NM-AC-CSR                             23990099
240000             END-EXEC                                             24000099
240100                                                                  24010099
240200         WHEN ASC-VENDOR-NAM-CURSOR                               24020099
240300             EXEC SQL                                             24030099
240400                 CLOSE VEND-NAM-CSR                               24040099
240500             END-EXEC                                             24050099
240600                                                                  24060099
240700         WHEN ASC-ACCT-NO-CURSOR                                  24070099
240800             EXEC SQL                                             24080099
240900                 CLOSE ACCT-NO-CSR                                24090099
241000             END-EXEC                                             24100099
241100                                                                  24110099
241200         WHEN ASC-DEPT-CURSOR                                     24120099
241300             EXEC SQL                                             24130099
241400                 CLOSE DEPT-CSR                                   24140099
241500             END-EXEC                                             24150099
241600                                                                  24160099
241700         WHEN ASC-DOC-NBR-CURSOR                                  24170099
241800             EXEC SQL                                             24180099
241900                 CLOSE DOC-NBR-CSR                                24190099
242000             END-EXEC                                             24200099
242100     END-EVALUATE.                                                24210099
242200                                                                  24220099
242300     EVALUATE TRUE                                                24230099
242400         WHEN SQLCODE = ZERO                                      24240099
242500             CONTINUE                                             24250099
242600         WHEN SQLWARN0 NOT = SPACES                               24260099
242700         WHEN SQLCODE < ZERO                                      24270099
242800         WHEN SQLCODE > ZERO                                      24280099
242900             MOVE '4020-CLOSE-CURSOR'                             24290099
243000                               TO DP013-PARAGRAPH                 24300099
243100             MOVE 'CLOSE ADJUSTMENT CURSOR '                      24310099
243200                               TO DP013-MESSAGE-TEXT (1)          24320099
243300             MOVE SQLCA        TO DP013-SQLCA                     24330099
243400             MOVE 'TADJRNL '   TO DP013-DB2-TABLE-NAME (1)        24340099
243500             SET DP013-DB2-ABEND                                  24350099
243600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24360099
243700             PERFORM DP013-0000-PROCESS-ABEND                     24370099
243800     END-EVALUATE.                                                24380099
243900                                                                  24390099
244000 EJECT                                                            24400099
244100*----------------------------------------------------------------*24410099
244200*    SET UP THE HOST VARIABLES.                                  *24420099
244300*----------------------------------------------------------------*24430099
244400                                                                  24440099
244500 4100-PREPARE-CURSOR.                                             24450099
244600                                                                  24460099
244700     SET ASC-NO-CURSOR         TO TRUE.                           24470099
244800                                                                  24480099
244900     IF  DK-PO-NBR GREATER THAN ZERO AND                          24490099
245000         DK-TRAN-TYP-LOW EQUAL DK-TRAN-TYP-HIGH                   24500099
245100         SET ASC-PO-TRAN-CURSOR TO TRUE                           24510099
245200     ELSE                                                         24520099
245300         IF DK-PO-NBR GREATER THAN ZERO                           24530099
245400            SET ASC-PO-NBR-CURSOR TO TRUE                         24540099
245500         ELSE                                                     24550099
245600            IF DK-VND-NBR GREATER THAN SPACES AND                 24560099
245700               DK-TRAN-TYP-LOW EQUAL DK-TRAN-TYP-HIGH             24570099
245800               SET ASC-VEND-NO-TP-CURSOR TO TRUE                  24580099
245900            ELSE                                                  24590099
246000               IF DK-VND-NBR GREATER THAN SPACES AND              24600099
246100                  DK-DEPARTMENT GREATER THAN SPACES               24610099
246200                  SET ASC-VEND-NO-DP-CURSOR TO TRUE               24620099
246300               ELSE                                               24630099
246400                  IF DK-VND-NBR GREATER THAN SPACES AND           24640099
246500                     DK-ACCT-NO GREATER THAN SPACES               24650099
246600                     SET ASC-VEND-NO-AC-CURSOR TO TRUE            24660099
246700                  ELSE                                            24670099
246800                     IF DK-VND-NBR GREATER THAN SPACES            24680099
246900                        SET ASC-VENDOR-NBR-CURSOR TO TRUE         24690099
247000                     ELSE                                         24700099
247100                        IF DK-ENT-NM GREATER THAN SPACES AND      24710099
247200                           DK-TRAN-TYP-LOW EQUAL DK-TRAN-TYP-HIGH 24720099
247300                           SET ASC-VEND-NM-TP-CURSOR TO TRUE      24730099
247400                        ELSE                                      24740099
247500                           IF DK-ENT-NM GREATER THAN SPACES AND   24750099
247600                              DK-DEPARTMENT GREATER THAN SPACES   24760099
247700                              SET ASC-VEND-NM-DP-CURSOR TO TRUE   24770099
247800                           ELSE                                   24780099
247900                              IF DK-ENT-NM GREATER THAN SPACES AND24790099
248000                                 DK-ACCT-NO GREATER THAN SPACES   24800099
248100                                 SET ASC-VEND-NM-AC-CURSOR TO TRUE24810099
248200                              ELSE                                24820099
248300                                 IF DK-ENT-NM GREATER THAN SPACES 24830099
248400                                    SET ASC-VENDOR-NAM-CURSOR     24840099
248500                                                       TO TRUE    24850099
248600                                 ELSE                             24860099
248700                                    IF DK-ACCT-NO GREATER         24870099
248800                                                  THAN SPACES     24880099
248900                                       SET ASC-ACCT-NO-CURSOR TO  24890099
249000                                                           TRUE   24900099
249100                                    ELSE                          24910099
249200                                       IF DK-DEPARTMENT GREATER   24920099
249300                                                      THAN SPACES 24930099
249400                                          SET ASC-DEPT-CURSOR TO  24940099
249500                                                           TRUE   24950099
249600                                       ELSE                       24960099
249700                                       IF DK-DOCUMENT-NUMBER-LOW  24970099
249800                                          EQUAL                   24980099
249900                                          DK-DOCUMENT-NUMBER-HIGH 24990099
250000                                           SET ASC-DOC-NBR-CURSOR 25000099
250100                                               TO TRUE            25010099
250200                                       END-IF                     25020099
250300                                       END-IF                     25030099
250400                                    END-IF                        25040099
250500                                 END-IF                           25050099
250600                              END-IF                              25060099
250700                           END-IF                                 25070099
250800                        END-IF                                    25080099
250900                     END-IF                                       25090099
251000                  END-IF                                          25100099
251100               END-IF                                             25110099
251200            END-IF                                                25120099
251300         END-IF                                                   25130099
251400     END-IF.                                                      25140099
251500                                                                  25150099
251600     IF DK-ENT-NM GREATER THAN SPACES                             25160099
251700        PERFORM 4110-FORMAT-VENDOR-NAME                           25170099
251800     END-IF.                                                      25180099
251900                                                                  25190099
252000     IF ASC-NO-CURSOR                                             25200099
252100        MOVE ALL '%' TO DK-ENT-NM                                 25210099
252200        SET ASC-VENDOR-NAM-CURSOR TO TRUE                         25220099
252300     END-IF.                                                      25230099
252400                                                                  25240099
252500 EJECT                                                            25250099
252600******************************************************************25260099
252700* THIS PARAGRAPH WILL POSITION WILDCARD CHARACTERS INTO THE      *25270099
252800* ENTERED VENDOR NAME FOR CURSOR CRITERIA PURPOSES.              *25280099
252900******************************************************************25290099
253000 4110-FORMAT-VENDOR-NAME.                                         25300099
253100                                                                  25310099
253200     IF DK-ENT-BYTE (1) EQUAL '*'                                 25320099
253300        MOVE PC-PERCENT TO DK-ENT-BYTE (1)                        25330099
253400        INSPECT DK-ENT-NM                                         25340099
253500          REPLACING FIRST '*' BY PC-PERCENT                       25350099
253600     END-IF.                                                      25360099
253700                                                                  25370099
253800     SET PS-NOT-DONE TO TRUE.                                     25380099
253900     PERFORM VARYING PV-SUB                                       25390099
254000         FROM LENGTH OF DK-ENT-NM BY -1                           25400099
254100         UNTIL PV-SUB EQUAL 1                                     25410099
254200           OR PS-DONE                                             25420099
254300                                                                  25430099
254400         IF DK-ENT-BYTE (PV-SUB) = '*'                            25440099
254500            MOVE PC-PERCENT TO DK-ENT-BYTE (PV-SUB)               25450099
254600            SET PS-DONE TO TRUE                                   25460099
254700         END-IF                                                   25470099
254800                                                                  25480099
254900         IF DK-ENT-BYTE (PV-SUB) > SPACES                         25490099
255000            SET PS-DONE TO TRUE                                   25500099
255100         ELSE                                                     25510099
255200            MOVE PC-PERCENT TO DK-ENT-BYTE (PV-SUB)               25520099
255300         END-IF                                                   25530099
255400     END-PERFORM.                                                 25540099
255500                                                                  25550099
255600*----------------------------------------------------------------*25560099
255700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *25570099
255800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *25580099
255900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *25590099
256000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *25600099
256100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *25610099
256200*                                                                *25620099
256300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *25630099
256400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *25640099
256500*    UPON INITIALIZATION.                                        *25650099
256600*----------------------------------------------------------------*25660099
256700                                                                  25670099
256800 4300-READ-ITEMS-FROM-DB.                                         25680099
256900                                                                  25690099
257000     PERFORM                                                      25700099
257100         VARYING PV-READ-COUNT                                    25710099
257200         FROM 1 BY 1                                              25720099
257300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    25730099
257400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         25740099
257500                                                                  25750099
257600         PERFORM 4310-FETCH                                       25760099
257700                                                                  25770099
257800         IF  ASC-ITEMS-LEFT-ON-DB                                 25780099
257900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                25790099
258000                 ADD +1            TO ASC-ITEM-SUB                25800099
258100             ELSE                                                 25810099
258200                 ADD +1            TO ASC-BLK-SUB                 25820099
258300                 MOVE +1           TO ASC-ITEM-SUB                25830099
258400                                                                  25840099
258500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         25850099
258600                     MOVE +1       TO ASC-BLK-SUB                 25860099
258700                     SET ASC-BLOCK-MODIFIED (1)                   25870099
258800                                   TO TRUE                        25880099
258900                     PERFORM 5100-WRITE-TEMP-STORAGE              25890099
259000                     MOVE ASC-BLOCK-ENTRIES                       25900099
259100                               (PC-MAX-BLOCKS-IN-ARRAY)           25910099
259200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 25920099
259300                     ADD +1        TO ASC-BLK-SUB                 25930099
259400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   25940099
259500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      25950099
259600                                   TO TRUE                        25960099
259700                 END-IF                                           25970099
259800             END-IF                                               25980099
259900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    25990099
260000             MOVE ASC-NUMBER-OF-ITEMS-READ                        26000099
260100                                   TO ASC-LIST-ITEM-NUMBER        26010099
260200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26020099
260300             MOVE ADJRNL-DOC-NBR   TO ASC-DOCUMENT-NO             26030099
260400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26040099
260500             MOVE ADJRNL-PO-NBR                                   26050099
260600                               TO  ASC-PO-NBR                     26060099
260700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26070099
260800             MOVE ENTNME-ENT-NAME-DESC                            26080099
260900                               TO  ASC-VENDOR-NAME                26090099
261000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26100099
261100             MOVE ADJRNL-VND-NBR                                  26110099
261200                               TO ASC-VENDOR-NUMBER               26120099
261300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26130099
261400             MOVE ADJRNL-AP-TRN-CDE                               26140099
261500                               TO  ASC-TRAN-CDE                   26150099
261600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26160099
261700             MOVE TRNCDE-PSTG-TYP-CDE                             26170099
261800                               TO  ASC-TRAN-TYPE                  26180099
261900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26190099
262000             MOVE ADJRNL-NET-COST-AMT                             26200099
262100                               TO  ASC-NET-AMT                    26210099
262200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26220099
262300             STRING ADJRNL-ENTR-TMST(6:2)                         26230099
262400                   , '/'                                          26240099
262500                   , ADJRNL-ENTR-TMST(9:2)                        26250099
262600                   , '/'                                          26260099
262700                   , ADJRNL-ENTR-TMST(3:2)                        26270099
262800               DELIMITED BY SIZE                                  26280099
262900               INTO ASC-ENTER-DATE (ASC-BLK-SUB ASC-ITEM-SUB)     26290099
263000             END-STRING                                           26300099
263100               MOVE ADJRNL-DOC-DTE                                26310099
263200                               TO ASC-DOC-DATE                    26320099
263300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 26330099
263400         END-IF                                                   26340099
263500     END-PERFORM.                                                 26350099
263600                                                                  26360099
263700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          26370099
263800         MOVE +1               TO ASC-BLK-SUB                     26380099
263900         PERFORM 5100-WRITE-TEMP-STORAGE                          26390099
264000         ADD +1                TO ASC-BLK-SUB                     26400099
264100         PERFORM 5100-WRITE-TEMP-STORAGE                          26410099
264200                                                                  26420099
264300         MOVE 1                TO ASC-BLK-SUB                     26430099
264400                                  PV-BLOCK-NUMBER                 26440099
264500         PERFORM 4410-READ-TEMP-STORAGE                           26450099
264600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             26460099
264700             MOVE 2            TO ASC-BLK-SUB                     26470099
264800                                  PV-BLOCK-NUMBER                 26480099
264900             PERFORM 4410-READ-TEMP-STORAGE                       26490099
265000         END-IF                                                   26500099
265100     END-IF.                                                      26510099
265200 EJECT                                                            26520099
265300*----------------------------------------------------------------*26530099
265400*    FETCH THE ADJUSTMENT JOURNAL CURSOR.                        *26540099
265500*----------------------------------------------------------------*26550099
265600                                                                  26560099
265700 4310-FETCH.                                                      26570099
265800                                                                  26580099
265900     EVALUATE TRUE                                                26590099
266000         WHEN ASC-PO-NBR-CURSOR                                   26600099
266100              EXEC SQL                                            26610099
266200                   FETCH PO-NBR-CSR                               26620099
266300                   INTO  :ADJRNL-DOC-NBR                          26630099
266400                       , :ADJRNL-PO-NBR                           26640099
266500                       , :ADJRNL-VND-NBR                          26650099
266600                       , :ENTNME-ENT-NAME-DESC                    26660099
266700                       , :ADJRNL-AP-TRN-CDE                       26670099
266800                       , :TRNCDE-PSTG-TYP-CDE                     26680099
266900                       , :ADJRNL-NET-COST-AMT                     26690099
267000                       , :ADJRNL-ENTR-TMST                        26700099
267100                       , :ADJRNL-DOC-DTE                          26710099
267200              END-EXEC                                            26720099
267300                                                                  26730099
267400         WHEN ASC-PO-TRAN-CURSOR                                  26740099
267500              EXEC SQL                                            26750099
267600                   FETCH PO-TRAN-CSR                              26760099
267700                   INTO  :ADJRNL-DOC-NBR                          26770099
267800                       , :ADJRNL-PO-NBR                           26780099
267900                       , :ADJRNL-VND-NBR                          26790099
268000                       , :ENTNME-ENT-NAME-DESC                    26800099
268100                       , :ADJRNL-AP-TRN-CDE                       26810099
268200                       , :TRNCDE-PSTG-TYP-CDE                     26820099
268300                       , :ADJRNL-NET-COST-AMT                     26830099
268400                       , :ADJRNL-ENTR-TMST                        26840099
268500                       , :ADJRNL-DOC-DTE                          26850099
268600              END-EXEC                                            26860099
268700                                                                  26870099
268800         WHEN ASC-VEND-NO-TP-CURSOR                               26880099
268900              EXEC SQL                                            26890099
269000                   FETCH VEND-NO-TP-CSR                           26900099
269100                   INTO  :ADJRNL-DOC-NBR                          26910099
269200                       , :ADJRNL-PO-NBR                           26920099
269300                       , :ADJRNL-VND-NBR                          26930099
269400                       , :ENTNME-ENT-NAME-DESC                    26940099
269500                       , :ADJRNL-AP-TRN-CDE                       26950099
269600                       , :TRNCDE-PSTG-TYP-CDE                     26960099
269700                       , :ADJRNL-NET-COST-AMT                     26970099
269800                       , :ADJRNL-ENTR-TMST                        26980099
269900                       , :ADJRNL-DOC-DTE                          26990099
270000              END-EXEC                                            27000099
270100                                                                  27010099
270200         WHEN ASC-VEND-NO-DP-CURSOR                               27020099
270300              EXEC SQL                                            27030099
270400                   FETCH VEND-NO-DP-CSR                           27040099
270500                   INTO  :ADJRNL-DOC-NBR                          27050099
270600                       , :ADJRNL-PO-NBR                           27060099
270700                       , :ADJRNL-VND-NBR                          27070099
270800                       , :ENTNME-ENT-NAME-DESC                    27080099
270900                       , :ADJRNL-AP-TRN-CDE                       27090099
271000                       , :TRNCDE-PSTG-TYP-CDE                     27100099
271100                       , :ADJRNL-NET-COST-AMT                     27110099
271200                       , :ADJRNL-ENTR-TMST                        27120099
271300                       , :ADJRNL-DOC-DTE                          27130099
271400              END-EXEC                                            27140099
271500                                                                  27150099
271600         WHEN ASC-VEND-NO-AC-CURSOR                               27160099
271700              EXEC SQL                                            27170099
271800                   FETCH VEND-NO-AC-CSR                           27180099
271900                   INTO  :ADJRNL-DOC-NBR                          27190099
272000                       , :ADJRNL-PO-NBR                           27200099
272100                       , :ADJRNL-VND-NBR                          27210099
272200                       , :ENTNME-ENT-NAME-DESC                    27220099
272300                       , :ADJRNL-AP-TRN-CDE                       27230099
272400                       , :TRNCDE-PSTG-TYP-CDE                     27240099
272500                       , :ADJRNL-NET-COST-AMT                     27250099
272600                       , :ADJRNL-ENTR-TMST                        27260099
272700                       , :ADJRNL-DOC-DTE                          27270099
272800              END-EXEC                                            27280099
272900                                                                  27290099
273000         WHEN ASC-VENDOR-NBR-CURSOR                               27300099
273100              EXEC SQL                                            27310099
273200                   FETCH VENDOR-NBR-CSR                           27320099
273300                   INTO  :ADJRNL-DOC-NBR                          27330099
273400                       , :ADJRNL-PO-NBR                           27340099
273500                       , :ADJRNL-VND-NBR                          27350099
273600                       , :ENTNME-ENT-NAME-DESC                    27360099
273700                       , :ADJRNL-AP-TRN-CDE                       27370099
273800                       , :TRNCDE-PSTG-TYP-CDE                     27380099
273900                       , :ADJRNL-NET-COST-AMT                     27390099
274000                       , :ADJRNL-ENTR-TMST                        27400099
274100                       , :ADJRNL-DOC-DTE                          27410099
274200              END-EXEC                                            27420099
274300                                                                  27430099
274400         WHEN ASC-VEND-NM-DP-CURSOR                               27440099
274500              EXEC SQL                                            27450099
274600                   FETCH VEND-NM-DP-CSR                           27460099
274700                   INTO  :ADJRNL-DOC-NBR                          27470099
274800                       , :ADJRNL-PO-NBR                           27480099
274900                       , :ADJRNL-VND-NBR                          27490099
275000                       , :ENTNME-ENT-NAME-DESC                    27500099
275100                       , :ADJRNL-AP-TRN-CDE                       27510099
275200                       , :TRNCDE-PSTG-TYP-CDE                     27520099
275300                       , :ADJRNL-NET-COST-AMT                     27530099
275400                       , :ADJRNL-ENTR-TMST                        27540099
275500                       , :ADJRNL-DOC-DTE                          27550099
275600              END-EXEC                                            27560099
275700                                                                  27570099
275800         WHEN ASC-VEND-NM-TP-CURSOR                               27580099
275900              EXEC SQL                                            27590099
276000                   FETCH VEND-NM-TP-CSR                           27600099
276100                   INTO  :ADJRNL-DOC-NBR                          27610099
276200                       , :ADJRNL-PO-NBR                           27620099
276300                       , :ADJRNL-VND-NBR                          27630099
276400                       , :ENTNME-ENT-NAME-DESC                    27640099
276500                       , :ADJRNL-AP-TRN-CDE                       27650099
276600                       , :TRNCDE-PSTG-TYP-CDE                     27660099
276700                       , :ADJRNL-NET-COST-AMT                     27670099
276800                       , :ADJRNL-ENTR-TMST                        27680099
276900                       , :ADJRNL-DOC-DTE                          27690099
277000              END-EXEC                                            27700099
277100                                                                  27710099
277200         WHEN ASC-VEND-NM-AC-CURSOR                               27720099
277300              EXEC SQL                                            27730099
277400                   FETCH VEND-NM-AC-CSR                           27740099
277500                   INTO  :ADJRNL-DOC-NBR                          27750099
277600                       , :ADJRNL-PO-NBR                           27760099
277700                       , :ADJRNL-VND-NBR                          27770099
277800                       , :ENTNME-ENT-NAME-DESC                    27780099
277900                       , :ADJRNL-AP-TRN-CDE                       27790099
278000                       , :TRNCDE-PSTG-TYP-CDE                     27800099
278100                       , :ADJRNL-NET-COST-AMT                     27810099
278200                       , :ADJRNL-ENTR-TMST                        27820099
278300                       , :ADJRNL-DOC-DTE                          27830099
278400              END-EXEC                                            27840099
278500                                                                  27850099
278600         WHEN ASC-VENDOR-NAM-CURSOR                               27860099
278700              EXEC SQL                                            27870099
278800                   FETCH VEND-NAM-CSR                             27880099
278900                   INTO  :ADJRNL-DOC-NBR                          27890099
279000                       , :ADJRNL-PO-NBR                           27900099
279100                       , :ADJRNL-VND-NBR                          27910099
279200                       , :ENTNME-ENT-NAME-DESC                    27920099
279300                       , :ADJRNL-AP-TRN-CDE                       27930099
279400                       , :TRNCDE-PSTG-TYP-CDE                     27940099
279500                       , :ADJRNL-NET-COST-AMT                     27950099
279600                       , :ADJRNL-ENTR-TMST                        27960099
279700                       , :ADJRNL-DOC-DTE                          27970099
279800              END-EXEC                                            27980099
279900                                                                  27990099
280000         WHEN ASC-ACCT-NO-CURSOR                                  28000099
280100              EXEC SQL                                            28010099
280200                   FETCH ACCT-NO-CSR                              28020099
280300                   INTO  :ADJRNL-DOC-NBR                          28030099
280400                       , :ADJRNL-PO-NBR                           28040099
280500                       , :ADJRNL-VND-NBR                          28050099
280600                       , :ENTNME-ENT-NAME-DESC                    28060099
280700                       , :ADJRNL-AP-TRN-CDE                       28070099
280800                       , :TRNCDE-PSTG-TYP-CDE                     28080099
280900                       , :ADJRNL-NET-COST-AMT                     28090099
281000                       , :ADJRNL-ENTR-TMST                        28100099
281100                       , :ADJRNL-DOC-DTE                          28110099
281200              END-EXEC                                            28120099
281300                                                                  28130099
281400         WHEN ASC-DEPT-CURSOR                                     28140099
281500              EXEC SQL                                            28150099
281600                   FETCH DEPT-CSR                                 28160099
281700                   INTO  :ADJRNL-DOC-NBR                          28170099
281800                       , :ADJRNL-PO-NBR                           28180099
281900                       , :ADJRNL-VND-NBR                          28190099
282000                       , :ENTNME-ENT-NAME-DESC                    28200099
282100                       , :ADJRNL-AP-TRN-CDE                       28210099
282200                       , :TRNCDE-PSTG-TYP-CDE                     28220099
282300                       , :ADJRNL-NET-COST-AMT                     28230099
282400                       , :ADJRNL-ENTR-TMST                        28240099
282500                       , :ADJRNL-DOC-DTE                          28250099
282600              END-EXEC                                            28260099
282700                                                                  28270099
282800         WHEN ASC-DOC-NBR-CURSOR                                  28280099
282900              EXEC SQL                                            28290099
283000                   FETCH DOC-NBR-CSR                              28300099
283100                   INTO  :ADJRNL-DOC-NBR                          28310099
283200                       , :ADJRNL-PO-NBR                           28320099
283300                       , :ADJRNL-VND-NBR                          28330099
283400                       , :ENTNME-ENT-NAME-DESC                    28340099
283500                       , :ADJRNL-AP-TRN-CDE                       28350099
283600                       , :TRNCDE-PSTG-TYP-CDE                     28360099
283700                       , :ADJRNL-NET-COST-AMT                     28370099
283800                       , :ADJRNL-ENTR-TMST                        28380099
283900                       , :ADJRNL-DOC-DTE                          28390099
284000              END-EXEC                                            28400099
284100                                                                  28410099
284200     END-EVALUATE.                                                28420099
284300                                                                  28430099
284400     EVALUATE TRUE                                                28440099
284500         WHEN SQLCODE = ZERO                                      28450099
284600         WHEN SQLCODE = +100                                      28460099
284700              CONTINUE                                            28470099
284800         WHEN SQLWARN0 NOT = SPACE                                28480099
284900         WHEN SQLCODE NOT = ZERO                                  28490099
285000              MOVE '4310-FETCH-CURSOR'                            28500099
285100                               TO DP013-PARAGRAPH                 28510099
285200              MOVE 'FETCH ADJUSTMENT CURSOR'                      28520099
285300                               TO DP013-MESSAGE-TEXT (1)          28530099
285400              MOVE SQLCA       TO DP013-SQLCA                     28540099
285500              SET DP013-DB2-ABEND                                 28550099
285600                               TO TRUE                            28560099
285700              PERFORM DP013-0000-PROCESS-ABEND                    28570099
285800     END-EVALUATE.                                                28580099
285900                                                                  28590099
286000     IF  SQLCODE EQUAL +100                                       28600099
286100         SET ASC-NO-ITEMS-LEFT-ON-DB                              28610099
286200                                   TO TRUE                        28620099
286300     END-IF.                                                      28630099
286400                                                                  28640099
286500 EJECT                                                            28650099
286600*----------------------------------------------------------------*28660099
286700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *28670099
286800*----------------------------------------------------------------*28680099
286900                                                                  28690099
287000 4400-MOVE-COMMAREA-TO-SCREEN.                                    28700099
287100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             28710099
287200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          28720099
287300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          28730099
287400             MOVE +1    TO ASC-BLK-SUB                            28740099
287500             PERFORM 5100-WRITE-TEMP-STORAGE                      28750099
287600             ADD +1     TO ASC-BLK-SUB                            28760099
287700             PERFORM 5100-WRITE-TEMP-STORAGE                      28770099
287800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             28780099
287900                 GIVING PV-BLOCK-NUMBER                           28790099
288000                 REMAINDER PV-REMAINDER                           28800099
288100             IF  PV-REMAINDER > ZERO                              28810099
288200                 ADD +1 TO PV-BLOCK-NUMBER                        28820099
288300             END-IF                                               28830099
288400             MOVE +1    TO ASC-BLK-SUB                            28840099
288500             PERFORM 4410-READ-TEMP-STORAGE                       28850099
288600             ADD +1     TO ASC-BLK-SUB                            28860099
288700                           PV-BLOCK-NUMBER                        28870099
288800             PERFORM 4410-READ-TEMP-STORAGE                       28880099
288900     END-IF.                                                      28890099
289000     MOVE +1            TO ASC-BLK-SUB.                           28900099
289100     COMPUTE ASC-ITEM-SUB =                                       28910099
289200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28920099
289300         + PC-ITEMS-PER-PANEL).                                   28930099
289400                                                                  28940099
289500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        28950099
289600         ADD +1         TO ASC-BLK-SUB                            28960099
289700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28970099
289800     END-IF.                                                      28980099
289900                                                                  28990099
290000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           29000099
290100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                29010099
290200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        29020099
290300     PERFORM 4420-FORMAT-LIST-LINES                               29030099
290400         VARYING PV-SUB                                           29040099
290500         FROM PC-ITEMS-PER-PANEL BY -1                            29050099
290600         UNTIL PV-SUB < +1.                                       29060099
290700                                                                  29070099
290800     COMPUTE ASC-ITEMS-DISPLAYED =                                29080099
290900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          29090099
291000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    29100099
291100                                      ASTRTITO.                   29110099
291200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    29120099
291300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    29130099
291400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            29140099
291500                                   TO ASELITO.                    29150099
291600                                                                  29160099
291700     IF  DP020-MSG-NUMBER-X = SPACE                               29170099
291800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  29180099
291900*            --- MORE ITEMS TO DISPLAY ----                       29190099
292000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            29200099
292100             SET DP020-MSG-INFORMATIONAL TO TRUE                  29210099
292200         END-IF                                                   29220099
292300     END-IF.                                                      29230099
292400*----------------------------------------------------------------*29240099
292500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *29250099
292600*----------------------------------------------------------------*29260099
292700                                                                  29270099
292800 4410-READ-TEMP-STORAGE.                                          29280099
292900                                                                  29290099
293000     EXEC CICS                                                    29300099
293100         READQ TS                                                 29310099
293200             QUEUE (ASC-LIST-QUEUE-NAME)                          29320099
293300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29330099
293400             ITEM  (PV-BLOCK-NUMBER)                              29340099
293500             RESP  (PV-CICS-RESP)                                 29350099
293600     END-EXEC.                                                    29360099
293700                                                                  29370099
293800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       29380099
293900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     29390099
294000         CONTINUE                                                 29400099
294100     ELSE                                                         29410099
294200         SET DP013-CICS-ABEND     TO TRUE                         29420099
294300         SET DP013-NO-ROLLBACK    TO TRUE                         29430099
294400         MOVE '4410-READ-TEMP-STORAGE'                            29440099
294500                                  TO DP013-PARAGRAPH              29450099
294600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      29460099
294700                                  TO DP013-MESSAGE-TEXT(1)        29470099
294800         PERFORM DP013-0000-PROCESS-ABEND                         29480099
294900     END-IF.                                                      29490099
295000                                                                  29500099
295100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             29510099
295200                                                                  29520099
295300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         29530099
295400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               29540099
295500     END-IF.                                                      29550099
295600 EJECT                                                            29560099
295700*----------------------------------------------------------------*29570099
295800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *29580099
295900*----------------------------------------------------------------*29590099
296000                                                                  29600099
296100 4420-FORMAT-LIST-LINES.                                          29610099
296200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      29620099
296300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                29630099
296400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           29640099
296500         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           29650099
296600         MOVE SPACE              TO MR-SELECTI (PV-SUB)           29660099
296700                                    MR-ACTION (PV-SUB)            29670099
296800                                    MR-DOCUMENT-NO (PV-SUB)       29680099
296900                                    MR-PO-NUMBER (PV-SUB)         29690099
297000                                    MR-VENDOR-TEXT (PV-SUB)       29700099
297100                                    MR-TRAN-CDE (PV-SUB)          29710099
297200                                    MR-TRAN-TYPE (PV-SUB)         29720099
297300                                    MR-NET-AMT-X (PV-SUB)         29730099
297400                                    MR-ENT-DATE (PV-SUB)          29740099
297500     ELSE                                                         29750099
297600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29760099
297700                                                   > SPACE        29770099
297800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 29780099
297900                                 TO MR-SELECTI (PV-SUB)           29790099
298000         ELSE                                                     29800099
298100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29810099
298200                                 TO MR-SELECTI (PV-SUB)           29820099
298300         END-IF                                                   29830099
298400                                                                  29840099
298500         IF  DP030-SET-CURSOR-TRAILER                             29850099
298600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)29860099
298700                 > SPACE)                                         29870099
298800               OR (PV-SUB = 1))                                   29880099
298900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               29890099
299000                MOVE -1          TO MR-SELECTL (PV-SUB)           29900099
299100             END-IF                                               29910099
299200         END-IF                                                   29920099
299300                                                                  29930099
299400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           29940099
299500             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           29950099
299600                                 TO MR-ACTION (PV-SUB)            29960099
299700             MOVE ASC-DOCUMENT-NO (ASC-BLK-SUB ASC-ITEM-SUB)      29970099
299800                                 TO MR-DOCUMENT-NO (PV-SUB)       29980099
299900             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           29990099
300000                                 TO MR-PO-NUMBER-9 (PV-SUB)       30000099
300100             MOVE ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)      30010099
300200                                 TO MR-VENDOR-TEXT (PV-SUB)       30020099
300300             MOVE ASC-TRAN-CDE (ASC-BLK-SUB ASC-ITEM-SUB)         30030099
300400                                 TO MR-TRAN-CDE (PV-SUB)          30040099
300500             MOVE ASC-TRAN-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)        30050099
300600                                 TO MR-TRAN-TYPE (PV-SUB)         30060099
300700             MOVE ASC-NET-AMT   (ASC-BLK-SUB ASC-ITEM-SUB)        30070099
300800                                 TO MR-NET-AMT-N (PV-SUB)         30080099
300900             MOVE ASC-ENTER-DATE (ASC-BLK-SUB ASC-ITEM-SUB)       30090099
301000                                 TO MR-ENT-DATE (PV-SUB)          30100099
301100         END-IF                                                   30110099
301200     END-IF.                                                      30120099
301300     SUBTRACT +1 FROM ASC-ITEM-SUB                                30130099
301400     IF  ASC-ITEM-SUB < + 1                                       30140099
301500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  30150099
301600         MOVE +1                 TO ASC-BLK-SUB                   30160099
301700     END-IF.                                                      30170099
301800******************************************************************30180099
301900** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **30190099
302000** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **30200099
302100** ISSUE A WARNING.                                             **30210099
302200******************************************************************30220099
302300 4430-CHECK-FOR-BEGIN-AND-END.                                    30230099
302400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       30240099
302500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     30250099
302600*            -- NO END-OF-RANGE SPECFIED ---                      30260099
302700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            30270099
302800             SET DP020-MSG-WARNING TO TRUE                        30280099
302900             PERFORM 4431-POSITION-AT-WARNING                     30290099
303000         END-IF                                                   30300099
303100     ELSE                                                         30310099
303200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     30320099
303300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                30330099
303400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            30340099
303500             SET DP020-MSG-WARNING TO TRUE                        30350099
303600             PERFORM 4431-POSITION-AT-WARNING                     30360099
303700         END-IF                                                   30370099
303800     END-IF.                                                      30380099
303900******************************************************************30390099
304000** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **30400099
304100** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **30410099
304200** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **30420099
304300** POSITION THE CURSOR THERE.                                   **30430099
304400******************************************************************30440099
304500 4431-POSITION-AT-WARNING.                                        30450099
304600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 30460099
304700                    - PV-TOP-ITEM + 1.                            30470099
304800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30480099
304900         CONTINUE                                                 30490099
305000     ELSE                                                         30500099
305100         SET DP030-SET-CURSOR-APPL-1                              30510099
305200                                   TO TRUE                        30520099
305300         MOVE -1                   TO MR-SELECTL (PV-SUB)         30530099
305400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30540099
305500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30550099
305600     END-IF.                                                      30560099
305700                                                                  30570099
305800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   30580099
305900                    - PV-TOP-ITEM + 1.                            30590099
306000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30600099
306100         CONTINUE                                                 30610099
306200     ELSE                                                         30620099
306300         SET DP030-SET-CURSOR-APPL-1                              30630099
306400                                   TO TRUE                        30640099
306500         MOVE -1                   TO MR-SELECTL (PV-SUB)         30650099
306600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30660099
306700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30670099
306800     END-IF.                                                      30680099
306900 EJECT                                                            30690099
307000*----------------------------------------------------------------*30700099
307100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *30710099
307200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *30720099
307300* FOR THE SELECTED ITEMS QUEUE.                                  *30730099
307400*                                                                *30740099
307500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *30750099
307600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *30760099
307700* THE ARRAY IS FULL.                                             *30770099
307800*----------------------------------------------------------------*30780099
307900                                                                  30790099
308000 5000-PREPARE-SEL-QUEUE.                                          30800099
308100                                                                  30810099
308200     MOVE +1                   TO  ASC-BLK-SUB.                   30820099
308300     PERFORM 5100-WRITE-TEMP-STORAGE.                             30830099
308400     ADD +1                    TO  ASC-BLK-SUB.                   30840099
308500     PERFORM 5100-WRITE-TEMP-STORAGE.                             30850099
308600                                                                  30860099
308700     MOVE ASC-SEL-QUEUE-NAME   TO  AP361-SEL-QUEUE-NAME.          30870099
308800     PERFORM 6010-DELETE-SEL-QUEUE.                               30880099
308900                                                                  30890099
309000     SET ASC-UPDATE-TSQ        TO  TRUE.                          30900099
309100                                                                  30910099
309200     SET AP362-IDX             TO  1.                             30920099
309300     MOVE ZERO                 TO AP361-NUMBER-OF-TS-ITEMS.       30930099
309400     INITIALIZE AP362-SELECTED-ITEM-ARRAY.                        30940099
309500                                                                  30950099
309600     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           30960099
309700             VARYING PV-ITEM                                      30970099
309800             FROM 1 BY 1                                          30980099
309900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     30990099
310000                                                                  31000099
310100     IF  AP362-IDX > 1                                            31010099
310200         PERFORM 5205-WRITE-SEL-QUEUE                             31020099
310300         ADD +1                TO AP361-NUMBER-OF-TS-ITEMS        31030099
310400     END-IF.                                                      31040099
310500 EJECT                                                            31050099
310600*----------------------------------------------------------------*31060099
310700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *31070099
310800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *31080099
310900*----------------------------------------------------------------*31090099
311000                                                                  31100099
311100 5100-WRITE-TEMP-STORAGE.                                         31110099
311200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     31120099
311300                                   TO PV-LIST-ITEM-NUMBER.        31130099
311400     COMPUTE PV-BLOCK-NUMBER =                                    31140099
311500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    31150099
311600                                                                  31160099
311700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             31170099
311800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             31180099
311900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      31190099
312000             PERFORM 5105-REWRITE-ASC-LISTQ                       31200099
312100         END-IF                                                   31210099
312200     ELSE                                                         31220099
312300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       31230099
312400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            31240099
312500         PERFORM 5110-WRITE-ASC-LISTQ                             31250099
312600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   31260099
312700     END-IF.                                                      31270099
312800                                                                  31280099
312900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             31290099
313000******************************************************************31300099
313100** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **31310099
313200** SPECIFIC COMMAREA.                                           **31320099
313300******************************************************************31330099
313400 5105-REWRITE-ASC-LISTQ.                                          31340099
313500     EXEC CICS                                                    31350099
313600         WRITEQ TS                                                31360099
313700             QUEUE (ASC-LIST-QUEUE-NAME)                          31370099
313800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31380099
313900             ITEM  (PV-BLOCK-NUMBER)                              31390099
314000             REWRITE                                              31400099
314100             RESP  (PV-CICS-RESP)                                 31410099
314200     END-EXEC.                                                    31420099
314300                                                                  31430099
314400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           31440099
314500         CONTINUE                                                 31450099
314600     ELSE                                                         31460099
314700         SET DP013-CICS-ABEND            TO TRUE                  31470099
314800         SET DP013-NO-ROLLBACK           TO TRUE                  31480099
314900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       31490099
315000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     31500099
315100                                         TO DP013-MESSAGE-TEXT(1) 31510099
315200         PERFORM DP013-0000-PROCESS-ABEND                         31520099
315300     END-IF.                                                      31530099
315400                                                                  31540099
315500******************************************************************31550099
315600** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **31560099
315700** SPECIFIC COMMAREA.                                           **31570099
315800******************************************************************31580099
315900 5110-WRITE-ASC-LISTQ.                                            31590099
316000     EXEC CICS                                                    31600099
316100         WRITEQ TS                                                31610099
316200             QUEUE (ASC-LIST-QUEUE-NAME)                          31620099
316300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31630099
316400             ITEM  (PV-BLOCK-NUMBER)                              31640099
316500             RESP  (PV-CICS-RESP)                                 31650099
316600     END-EXEC.                                                    31660099
316700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      31670099
316800         SET DP013-CICS-ABEND      TO TRUE                        31680099
316900         SET DP013-NO-ROLLBACK     TO TRUE                        31690099
317000         MOVE '5110-WRITE-ASC-LISTQ'                              31700099
317100                                   TO DP013-PARAGRAPH             31710099
317200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           31720099
317300                                   TO DP013-MESSAGE-TEXT(1)       31730099
317400         PERFORM DP013-0000-PROCESS-ABEND                         31740099
317500     END-IF.                                                      31750099
317600 EJECT                                                            31760099
317700*----------------------------------------------------------------*31770099
317800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *31780099
317900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *31790099
318000*----------------------------------------------------------------*31800099
318100                                                                  31810099
318200 5200-FILL-SEL-QUEUE-RECORD.                                      31820099
318300                                                                  31830099
318400     PERFORM 6112-READ-LIST-QUEUE.                                31840099
318500                                                                  31850099
318600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       31860099
318700         PERFORM                                                  31870099
318800         VARYING LQW-IDX                                          31880099
318900         FROM 1 BY 1                                              31890099
319000         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            31900099
319100           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          31910099
319200                                                                  31920099
319300             IF  LQW-SELECT (LQW-IDX)                             31930099
319400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              31940099
319500                                   TO AP362-ITEM (AP362-IDX)      31950099
319600                 IF LQW-VENDOR-NUMBER (LQW-IDX) > SPACES          31960099
319700                    MOVE LQW-VENDOR-NUMBER (LQW-IDX)              31970099
319800                                      TO AP362-VND-NBR            31980099
319900                                           (AP362-IDX)            31990099
320000                                         ASC-KEY-VENDOR-NUMBER    32000099
320100                 END-IF                                           32010099
320200                 MOVE LQW-DOCUMENT-NO (LQW-IDX)                   32020099
320300                                   TO AP362-DOC-NO                32030099
320400                                        (AP362-IDX)               32040099
320500                                      ASC-KEY-DOCUMENT-NO-LOW     32050099
320600                 MOVE LQW-TRAN-CDE (LQW-IDX)                      32060099
320700                                    TO AP362-TRN-CDE              32070099
320800                                        (AP362-IDX)               32080099
320900                                       ASC-KEY-TRAN-CDE-LOW       32090099
321000                 MOVE LQW-DOC-DTE (LQW-IDX)                       32100099
321100                                   TO AP362-DOC-DTE               32110099
321200                                        (AP362-IDX)               32120099
321300                                       ASC-KEY-DOC-DTE            32130099
321400                 MOVE SPACE        TO AP362-ACTION-SW (AP362-IDX) 32140099
321500                 SET AP362-IDX UP BY 1                            32150099
321600                 IF  AP362-IDX > AP362-MAX-ITEMS                  32160099
321700                     PERFORM 5205-WRITE-SEL-QUEUE                 32170099
321800                     ADD +1        TO AP361-NUMBER-OF-TS-ITEMS    32180099
321900                     INITIALIZE AP362-SELECTED-ITEM-ARRAY         32190099
322000                     SET AP362-IDX TO  1                          32200099
322100                 END-IF                                           32210099
322200             END-IF                                               32220099
322300         END-PERFORM                                              32230099
322400     END-IF.                                                      32240099
322500                                                                  32250099
322600*----------------------------------------------------------------*32260099
322700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *32270099
322800*----------------------------------------------------------------*32280099
322900                                                                  32290099
323000 5205-WRITE-SEL-QUEUE.                                            32300099
323100                                                                  32310099
323200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            32320099
323300                                   TO AP362-SELECTED-ITEMS.       32330099
323400                                                                  32340099
323500     EXEC CICS                                                    32350099
323600          WRITEQ TS                                               32360099
323700              QUEUE (ASC-SEL-QUEUE-NAME)                          32370099
323800              FROM  (AP362-ADJUSTMENT-SEL-REC)                    32380099
323900              ITEM  (PV-SEL-QUEUE-ITEM)                           32390099
324000              RESP  (PV-CICS-RESP)                                32400099
324100     END-EXEC.                                                    32410099
324200                                                                  32420099
324300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32430099
324400         CONTINUE                                                 32440099
324500     ELSE                                                         32450099
324600         SET DP013-CICS-ABEND      TO TRUE                        32460099
324700         SET DP013-NO-ROLLBACK     TO TRUE                        32470099
324800         MOVE '5205-WRITE-SEL-QUEUE'                              32480099
324900                                   TO DP013-PARAGRAPH             32490099
325000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          32500099
325100                                   TO DP013-MESSAGE-TEXT(1)       32510099
325200         PERFORM DP013-0000-PROCESS-ABEND                         32520099
325300     END-IF.                                                      32530099
325400 EJECT                                                            32540099
325500******************************************************************32550099
325600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **32560099
325700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **32570099
325800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **32580099
325900** THE USER.                                                    **32590099
326000******************************************************************32600099
326100 6000-REFRESH-PANEL-FROM-TEMP.                                    32610099
326200     IF  ASC-UPDATE-TSQ AND                                       32620099
326300         ASC-NUMBER-OF-SELECTED-ITEMS > 0                         32630099
326400         SET ASC-NO-TSQ-UPDATE TO TRUE                            32640099
326500         MOVE ZERO                 TO PV-SAVE-ITEM                32650099
326600                                      PV-SEL-QUEUE-ITEM           32660099
326700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        32670099
326800                                   TO PV-HOLD-SELECTED-ITEMS      32680099
326900         PERFORM 6100-UPDATE-TSQ                                  32690099
327000             UNTIL PV-ITEMS-PROCESSED >                           32700099
327100                                     PV-HOLD-SELECTED-ITEMS       32710099
327200         PERFORM 6010-DELETE-SEL-QUEUE                            32720099
327300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         32730099
327400                    ASC-BLOCK-ENTRIES (2)                         32740099
327500     END-IF.                                                      32750099
327600                                                                  32760099
327700*----------------------------------------------------------------*32770099
327800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *32780099
327900*----------------------------------------------------------------*32790099
328000 6010-DELETE-SEL-QUEUE.                                           32800099
328100                                                                  32810099
328200     EXEC CICS                                                    32820099
328300         DELETEQ TS                                               32830099
328400             QUEUE (ASC-SEL-QUEUE-NAME)                           32840099
328500             RESP  (PV-CICS-RESP)                                 32850099
328600     END-EXEC.                                                    32860099
328700                                                                  32870099
328800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      32880099
328900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         32890099
329000         CONTINUE                                                 32900099
329100     ELSE                                                         32910099
329200         SET DP013-CICS-ABEND TO TRUE                             32920099
329300         SET DP013-NO-ROLLBACK TO TRUE                            32930099
329400         MOVE '6010-DELETE-SEL-QUEUE'                             32940099
329500                        TO DP013-PARAGRAPH                        32950099
329600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         32960099
329700                        TO DP013-MESSAGE-TEXT (1)                 32970099
329800         PERFORM DP013-0000-PROCESS-ABEND                         32980099
329900     END-IF.                                                      32990099
330000                                                                  33000099
330100*----------------------------------------------------------------*33010099
330200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *33020099
330300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *33030099
330400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *33040099
330500*    THE TEMP QUEUE.                                             *33050099
330600*----------------------------------------------------------------*33060099
330700                                                                  33070099
330800 6100-UPDATE-TSQ.                                                 33080099
330900                                                                  33090099
331000     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             33100099
331100     PERFORM 6105-READ-SEL-QUEUE.                                 33110099
331200     PERFORM                                                      33120099
331300         VARYING AP362-IDX                                        33130099
331400         FROM 1 BY 1                                              33140099
331500         UNTIL ((PV-ITEMS-PROCESSED >                             33150099
331600                              PV-HOLD-SELECTED-ITEMS)             33160099
331700         OR (AP362-IDX GREATER THAN AP362-MAX-ITEMS))             33170099
331800         IF  AP362-ACTION-SW (AP362-IDX) > SPACE                  33180099
331900             PERFORM 6110-PROCESS-ITEMS                           33190099
332000         END-IF                                                   33200099
332100         ADD +1                TO PV-ITEMS-PROCESSED              33210099
332200     END-PERFORM.                                                 33220099
332300     PERFORM 6111-WRITE-LIST-QUEUE.                               33230099
332400*----------------------------------------------------------------*33240099
332500*    READ THE LIST QUEUE RECORD.                                 *33250099
332600*----------------------------------------------------------------*33260099
332700                                                                  33270099
332800 6105-READ-SEL-QUEUE.                                             33280099
332900                                                                  33290099
333000     EXEC CICS                                                    33300099
333100          READQ TS                                                33310099
333200              QUEUE (ASC-SEL-QUEUE-NAME)                          33320099
333300              INTO  (AP362-ADJUSTMENT-SEL-REC)                    33330099
333400              ITEM  (PV-SEL-QUEUE-ITEM)                           33340099
333500              RESP  (PV-CICS-RESP)                                33350099
333600     END-EXEC.                                                    33360099
333700                                                                  33370099
333800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33380099
333900         CONTINUE                                                 33390099
334000     ELSE                                                         33400099
334100         SET DP013-CICS-ABEND      TO  TRUE                       33410099
334200         SET DP013-NO-ROLLBACK     TO  TRUE                       33420099
334300         MOVE '6105-READ-SEL-QUEUE'                               33430099
334400                                   TO  DP013-PARAGRAPH            33440099
334500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           33450099
334600                                   TO  DP013-MESSAGE-TEXT(1)      33460099
334700         PERFORM DP013-0000-PROCESS-ABEND                         33470099
334800     END-IF.                                                      33480099
334900 EJECT                                                            33490099
335000*----------------------------------------------------------------*33500099
335100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*33510099
335200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*33520099
335300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *33530099
335400*----------------------------------------------------------------*33540099
335500                                                                  33550099
335600 6110-PROCESS-ITEMS.                                              33560099
335700                                                                  33570099
335800     COMPUTE PV-ITEM = 1 + ((AP362-ITEM (AP362-IDX) - 1)          33580099
335900                     / PC-ITEMS-PER-PANEL).                       33590099
336000                                                                  33600099
336100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           33610099
336200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          33620099
336300             PERFORM 6111-WRITE-LIST-QUEUE                        33630099
336400         END-IF                                                   33640099
336500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    33650099
336600                                                                  33660099
336700         PERFORM 6112-READ-LIST-QUEUE                             33670099
336800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               33680099
336900             CONTINUE                                             33690099
337000         END-IF                                                   33700099
337100     END-IF.                                                      33710099
337200                                                                  33720099
337300     COMPUTE PV-SUB = (AP362-ITEM (AP362-IDX)                     33730099
337400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              33740099
337500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         33750099
337600     MOVE LQW-SELECTED-SW (PV-SUB)                                33760099
337700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  33770099
337800     EVALUATE TRUE                                                33780099
337900         WHEN AP362-INQ (AP362-IDX)                               33790099
338000              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             33800099
338100                                                                  33810099
338200         WHEN AP362-UPD (AP362-IDX)                               33820099
338300              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             33830099
338400                                                                  33840099
338500         WHEN AP362-DEL (AP362-IDX)                               33850099
338600              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             33860099
338700                                                                  33870099
338800         WHEN AP362-ERR (AP362-IDX)                               33880099
338900              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             33890099
339000     END-EVALUATE.                                                33900099
339100                                                                  33910099
339200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                33920099
339300                                                                  33930099
339400*----------------------------------------------------------------*33940099
339500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *33950099
339600*----------------------------------------------------------------*33960099
339700                                                                  33970099
339800 6111-WRITE-LIST-QUEUE.                                           33980099
339900                                                                  33990099
340000     EXEC CICS                                                    34000099
340100         WRITEQ TS                                                34010099
340200             QUEUE (ASC-LIST-QUEUE-NAME)                          34020099
340300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     34030099
340400             ITEM  (PV-SAVE-ITEM)                                 34040099
340500             REWRITE                                              34050099
340600             RESP  (PV-CICS-RESP)                                 34060099
340700     END-EXEC.                                                    34070099
340800                                                                  34080099
340900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34090099
341000         CONTINUE                                                 34100099
341100     ELSE                                                         34110099
341200         SET DP013-CICS-ABEND  TO  TRUE                           34120099
341300         SET DP013-NO-ROLLBACK TO  TRUE                           34130099
341400         MOVE '6111-WRITE-LIST-QUEUE'                             34140099
341500                               TO  DP013-PARAGRAPH                34150099
341600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  34160099
341700                               TO  DP013-MESSAGE-TEXT(1)          34170099
341800         PERFORM DP013-0000-PROCESS-ABEND                         34180099
341900     END-IF.                                                      34190099
342000                                                                  34200099
342100 EJECT                                                            34210099
342200*----------------------------------------------------------------*34220099
342300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*34230099
342400*----------------------------------------------------------------*34240099
342500                                                                  34250099
342600 6112-READ-LIST-QUEUE.                                            34260099
342700                                                                  34270099
342800     EXEC CICS                                                    34280099
342900         READQ TS                                                 34290099
343000             QUEUE (ASC-LIST-QUEUE-NAME)                          34300099
343100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     34310099
343200             ITEM  (PV-ITEM)                                      34320099
343300             RESP  (PV-CICS-RESP)                                 34330099
343400     END-EXEC.                                                    34340099
343500                                                                  34350099
343600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34360099
343700         CONTINUE                                                 34370099
343800     ELSE                                                         34380099
343900         SET DP013-CICS-ABEND        TO TRUE                      34390099
344000         SET DP013-NO-ROLLBACK       TO TRUE                      34400099
344100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           34410099
344200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    34420099
344300                                     TO DP013-MESSAGE-TEXT(1)     34430099
344400         PERFORM DP013-0000-PROCESS-ABEND                         34440099
344500     END-IF.                                                      34450099
344600                                                                  34460099
344700 EJECT                                                            34470099
344800*----------------------------------------------------------------*34480099
344900*    ABEND PROCESSOR MODULE                                      *34490099
345000*----------------------------------------------------------------*34500099
345100                                                                  34510099
345200     COPY DPPD013.                                                34520099
