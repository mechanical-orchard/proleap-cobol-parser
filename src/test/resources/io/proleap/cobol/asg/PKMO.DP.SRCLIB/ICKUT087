000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      ICKUT087.                                       00020000
000300 AUTHOR.          JEAN KURK.                                      00030000
000400 DATE-WRITTEN.    JANUARY 2024.                                   00040000
000500                                                                  00050000
000600*--------------------------------------------------------------*  00060000
000700*                                                              *  00070000
000800* DESCRIPTION:                                                 *  00080000
000900*      THIS PROGRAM WILL APPLY SALES & RETURN INFORMATION TO   *  00090000
001000*      APPROVED COMPLETED COUNTS FOR USA INVENTORY COUNTS.     *  00100000
001800*                                                              *  00110000
001800*      THIS PROGRAM WAS DERIVED FROM ICKUP161 - IT DOES THE    *  00120000
001800*      SELECTION CRITERIA AND CREATES AN OUTPUT FILE OF ALL    *  00130000
001800*      OF THE RECORDS TO BE UPDATED.  THE UPDATES ARE STILL    *  00140000
001800*      DONE IN ICKUP161                                        *  00150000
001800*                                                              *  00160000
001900* INPUTS:                                                      *  00170000
002000*      YES                                                     *  00180000
002300*                                                              *  00190000
002400* OUTPUTS:                                                     *  00200000
002500*      YES                                                     *  00210000
002600*                                                              *  00220000
002700*--------------------------------------------------------------*  00230000
002800*--------------------------------------------------------------*  00240000
002900* HISTORY LOG:                                                    00250000
003000*--------------------------------------------------------------*  00260000
111890*--------------------------------------------------------------*  00270000
111890* 02/20/2024   CHANGED BY:  JEAN KURK         CHG0301445          00280014
111890* DESCRIPTION: INITIAL VERSION                                    00290000
C32847*--------------------------------------------------------------*  00300000
004900 ENVIRONMENT DIVISION.                                            00310000
005000*--------------------------------------------------------------*  00320000
005100 CONFIGURATION SECTION.                                           00330000
005200 SOURCE-COMPUTER.        IBM-3090.                                00340000
005300 OBJECT-COMPUTER.        IBM-3090.                                00350000
005400                                                                  00360000
005500 INPUT-OUTPUT SECTION.                                            00370000
005600                                                                  00380000
005700 FILE-CONTROL.                                                    00390000
005800                                                                  00400000
005900     SELECT ICRD060-COUNTS-FILE                                   00410000
006000         ASSIGN TO INP01.                                         00420000
006100                                                                  00430000
005900     SELECT ICRD087-OUTPUT-FILE                                   00440001
006000         ASSIGN TO OUT01.                                         00450000
006100                                                                  00460000
006200******************************************************************00470000
006300 DATA DIVISION.                                                   00480000
006400******************************************************************00490000
006500                                                                  00500000
006600 FILE SECTION.                                                    00510000
006700                                                                  00520000
006800 FD  ICRD060-COUNTS-FILE                                          00530000
006900     RECORDING MODE IS F                                          00540000
007000     LABEL RECORDS ARE STANDARD                                   00550000
007100     BLOCK CONTAINS 0 RECORDS.                                    00560000
007200                                                                  00570000
007300 01  ICRD060-COUNTS-RECORD           PIC X(70).                   00580000
007400                                                                  00590000
006800 FD  ICRD087-OUTPUT-FILE                                          00600005
006900     RECORDING MODE IS F                                          00610001
007000     LABEL RECORDS ARE STANDARD                                   00620001
007100     BLOCK CONTAINS 0 RECORDS.                                    00630001
007101                                                                  00640002
007200 01  ICRD087-OUTPUT-REC              PIC  X(225).                 00650002
007400                                                                  00660001
009200 WORKING-STORAGE SECTION.                                         00670000
009300*--------------------------------------------------------------*  00680000
009400* PS - PROGRAM SWITCHES                                           00690000
009500*--------------------------------------------------------------*  00700000
009600 01  PS-PROGRAM-SWITCHES.                                         00710000
011200     05  PS-END-OF-FILE-SW           PIC  X(001).                 00720000
011300         88  PS-END-OF-FILE                       VALUE 'Y'.      00730000
011400         88  PS-END-OF-FILE-NO                    VALUE 'N'.      00740000
011500                                                                  00750000
011501     05  PS-SKU-CNTS-CSR-SW          PIC  X(001).                 00760000
011502         88  MORE-SKU-CNTS                        VALUE 'Y'.      00770000
011503         88  NO-MORE-SKU-CNTS                     VALUE 'N'.      00780000
011504                                                                  00790000
011509     05  PS-NEW-CNT-LOC-SW           PIC  X(001).                 00840000
011510         88  PS-NEW-CNT-LOC                       VALUE 'Y'.      00850000
011511         88  PS-NEW-CNT-LOC-NO                    VALUE 'N'.      00860000
011512                                                                  00870000
011517*    05  PS-CNT-STAT-CDE-SW          PIC  X(001).                 00920002
011518*        88  VALID-CNT-STAT-CDE                   VALUE 'Y'.      00930002
011519*        88  INVALID-CNT-STAT-CDE                 VALUE 'N'.      00940002
011520                                                                  00950000
C88463     05  PS-DUPLICATE-COUNT-SW       PIC  X(01)   VALUE 'N'.      00960000
C88463         88  DUPLICATE-COUNT                      VALUE 'Y'.      00970000
C88463         88  NO-DUPLICATE-COUNT                   VALUE 'N'.      00980000
C88463                                                                  00990000
C88463     05  PS-NULL-ICC-COUNT-SW        PIC  X(01)   VALUE 'N'.      01000000
C88463         88  NULL-ICC-COUNT                       VALUE 'Y'.      01010000
C88463         88  NOT-NULL-ICC-COUNT                   VALUE 'N'.      01020000
011600*--------------------------------------------------------------*  01030000
011700* PROGRAM CONSTANTS                                               01040000
011800*--------------------------------------------------------------*  01050000
011900 01  PC-PROGRAM-CONSTANTS.                                        01060000
012000     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'ICKUT087'.     01070009
012010     05  PC-JOB-NAME              PIC X(08) VALUE 'ICK082'.       01080000
012310     05  PC-7                     PIC 9(9)  VALUE 7.              01100000
012320     05  PC-COM                   PIC X(03) VALUE 'COM'.          01110000
012330     05  PC-AUT                   PIC X(03) VALUE 'AUT'.          01120000
012331     05  PC-APP                   PIC X(03) VALUE 'APP'.          01130000
012331     05  PC-REV                   PIC X(03) VALUE 'REV'.          01140004
012500     05  PC-NULL-VALUE            PIC S9(04) VALUE -1             01230000
012600                                             COMP SYNC.           01240000
012900                                                                  01270000
012901*--------------------------------------------------------------*  01280000
012902* PV- PROGRAM VARIABLES                                           01290000
012903*--------------------------------------------------------------*  01300000
012904 01  PV-PROGRAM-VARAIBLES.                                        01310000
012905     05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       01320000
013000     05  PD-DB2-OPERATION         PIC X(15)   VALUE SPACES.       01330000
013100                                                                  01340000
013200     05  PV-SQL-SUB               PIC S9(09)  VALUE 0  COMP.      01350000
013400     05  PV-ABEND-CODE            PIC 9999    VALUE 0  COMP.      01370000
C88463     05  PV-ADJ-QTY               PIC S9(09)  VALUE +0 COMP.      01380000
C88463     05  PV-ADJ-QTY-DISPLAY       PIC ---------9.                 01390000
013500     05  PV-CALC-DB2-DATE         PIC  X(10)  VALUE SPACES.       01400000
013600     05  PV-CALC-NBR-DAYS         PIC  9(05)  VALUE 0.            01410000
013700     05  PV-SUM-ONHAND            PIC S9(09)  VALUE +0 COMP.      01420000
013800     05  PV-SUM-SCANNED           PIC S9(09)  VALUE +0 COMP.      01430000
013900     05  PV-SUM-SLD-QTY           PIC S9(09)  VALUE +0 COMP.      01440000
014000     05  PV-SUM-RET-QTY           PIC S9(09)  VALUE +0 COMP.      01450000
014100     05  PV-XFER-IN-QTY           PIC S9(09)  VALUE +0 COMP.      01460000
014200     05  PV-XFER-OUT-QTY          PIC S9(09)  VALUE +0 COMP.      01470000
014200     05  PV-OUTPUT-CNT            PIC S9(09)  VALUE +0 COMP.      01480001
014300     05  PV-THRESHOLD             PIC S9(3)V9(2) VALUE +0 COMP-3. 01490000
014505     05  PV-EXEC-TMST             PIC X(26)   VALUE SPACES.       01560000
014506     05  PV-MAX-SKU-LAST-UPD-TMST PIC X(26)   VALUE SPACES.       01570000
015100     05  PV-TIMEZONE-TMST         PIC X(26)   VALUE SPACES.       01590000
015300     05  PV-COM-CNT-TMST.                                         01610000
015400         10  PV-COM-CNT-DTE       PIC X(10)   VALUE SPACES.       01620000
015500         10  FILLER               PIC X(01)   VALUE SPACES.       01630000
015600         10  PV-COM-CNT-TM        PIC X(08)   VALUE SPACES.       01640000
015700         10  FILLER               PIC X(01)   VALUE SPACES.       01650000
015800         10  PV-COM-CNT-MSEC      PIC X(06)   VALUE SPACES.       01660000
016000     05  PV-COM-CNT-TMST-HOLD     PIC X(26)   VALUE SPACES.       01680000
016100     05  PV-COMPARE-TMST-HOLD     PIC X(26)   VALUE SPACES.       01690000
016300     05  PV-COMPARE-TMST.                                         01710000
016400         10  PV-COMPARE-DTE       PIC X(10)   VALUE SPACES.       01720000
016500         10  FILLER               PIC X(01)   VALUE SPACES.       01730000
016600         10  PV-COMPARE-TM        PIC X(08)   VALUE '00.00.00'.   01740000
016700         10  FILLER               PIC X(01)   VALUE SPACES.       01750000
016800         10  PV-COMPARE-MSEC      PIC X(06)   VALUE '000000'.     01760000
017000     05  PV-HOLD-CNT-STUP-ID      PIC S9(09)  VALUE +0 COMP.      01780000
017100     05  PV-HOLD-LOC-NBR          PIC S9(04)  VALUE +0 COMP.      01790000
017200     05  PV-HOLD-CNT-STAT-CDE     PIC X(03)   VALUE SPACES.       01800000
017500     05  PV-TMST                  PIC X(26)   VALUE SPACES.       01830000
017600     05  PV-HOLD-TMST             PIC X(26)   VALUE SPACES.       01840000
017700                                                                  01850000
017800                                                                  01860000
017900 01  PV-NULL-VARIABLES.                                           01870000
018000     05  PV-INTRNST-QTY-NULL-IND    PIC S9(04) VALUE +0           01880000
018100                                               COMP SYNC.         01890000
018200     05  PV-ACPTD-TRUK-QTY-NULL-IND PIC S9(04) VALUE +0           01900000
018300                                               COMP SYNC.         01910000
018400     05  PV-RTL-SAL-QTY-NULL-IND    PIC S9(04) VALUE +0           01920000
018500                                               COMP SYNC.         01930000
018600     05  PV-RTL-RET-QTY-NULL-IND    PIC S9(04) VALUE +0           01940000
018700                                               COMP SYNC.         01950000
018800     05  PV-XFER-IN-QTY-NULL-IND    PIC S9(04) VALUE +0           01960000
018900                                               COMP SYNC.         01970000
019000     05  PV-XFER-OUT-QTY-NULL-IND   PIC S9(04) VALUE +0           01980000
019100                                               COMP SYNC.         01990000
019200     05  PV-SCND-UPC-NBR-NULL-IND   PIC S9(04) VALUE +0           02000000
019300                                               COMP SYNC.         02010000
019400     05  PV-SCND-UNT-QTY-NULL-IND   PIC S9(04) VALUE +0           02020000
019500                                               COMP SYNC.         02030000
019600     05  PV-CNT-GP-CDE-NULL-IND     PIC S9(04) VALUE +0           02040000
019700                                               COMP SYNC.         02050000
019800     05  PV-EXEC-TMST-NULL-IND      PIC S9(04) VALUE +0           02060000
019900                                               COMP SYNC.         02070000
020000     05  PV-EXEC-TMST-NULL-IND2     PIC S9(04) VALUE +0           02080000
020100                                               COMP SYNC.         02090000
020200     05  PV-MDSE-EXPRN-DTE-NULL-IND PIC S9(04) VALUE +0           02100000
020300                                               COMP SYNC.         02110000
020400     05  PV-SUM-SLD-QTY-NULL-IND    PIC S9(04) VALUE +0           02120000
020500                                               COMP SYNC.         02130000
020600     05  PV-SUM-RET-QTY-NULL-IND    PIC S9(04) VALUE +0           02140000
020700                                               COMP SYNC.         02150000
020800     05  PV-SUM-XFER-IN-NULL-IND    PIC S9(04) VALUE +0           02160000
020900                                               COMP SYNC.         02170000
021000     05  PV-SUM-XFER-OUT-NULL-IND   PIC S9(04) VALUE +0           02180000
021100                                               COMP SYNC.         02190000
023402*--------------------------------------------------------------*  02200000
023403* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02210000
023404*--------------------------------------------------------------*  02220000
023405     COPY DPWS004.                                                02230000
023406                                                                  02240000
023407*--------------------------------------------------------------*  02250000
023408* DATE ROUTINE COPY MEMBERS                                       02260000
023409*--------------------------------------------------------------*  02270000
023410     COPY DPWS500.                                                02280000
023411                                                                  02290000
023412*--------------------------------------------------------------*  02300000
023413* DB2 ABEND COPYBOOK                                              02310000
023414*--------------------------------------------------------------*  02320000
023415     COPY DPWS900.                                                02330000
023416                                                                  02340000
023417*--------------------------------------------------------------*  02350000
023418* DB2 MESSAGE AREA                                                02360000
023419*--------------------------------------------------------------*  02370000
023420     COPY SQLCA2.                                                 02380000
023421                                                                  02390000
023422*--------------------------------------------------------------*  02400000
023423* PROGRAM COUNTERS                                                02410000
023424*--------------------------------------------------------------*  02420000
023425 01  PV-PROGRAM-COUNTERS         COMP-3.                          02430000
023427     05  PV-INPUT-CNT             PIC 9(9) VALUE 0.               02450000
023428     05  PV-SELECT-SKU-CNT        PIC 9(9) VALUE 0.               02460000
023429     05  PV-WRITE-CNT-STAT        PIC 9(9) VALUE 0.               02470002
023430     05  PV-WRITE-CNT-SKU         PIC 9(9) VALUE 0.               02480002
023430     05  PV-WRITE-CNT-ODR         PIC 9(9) VALUE 0.               02481002
023442                                                                  02500000
023443*--------------------------------------------------------------*  02510000
023444* ERROR HANDLING                                                  02520000
023445*--------------------------------------------------------------*  02530000
023446 01  PV-MISC-ABEND-FIELDS.                                        02540000
023447     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          02550000
023448     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          02560000
023449     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          02570000
023450                                                                  02580000
023451 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    02590000
023452     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           02600000
023453     88  ABEND-4013-DB2-ERROR              VALUE +4013.           02610000
023454     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           02620000
023455     88  ABEND-4020-MQ-ERROR               VALUE +4020.           02630000
023456     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           02640000
023457     88  ABEND-4008                        VALUE +4008.           02650000
023458     88  ABEND-4005                        VALUE +4005.           02660000
023459                                                                  02670000
023460************************************************************      02680000
023470*    TIMEZONE CONVERSION ROUTINE COPYBOOK                         02690000
023480************************************************************      02700000
023490     COPY ICWS010.                                                02710000
023500                                                                  02720000
023600************************************************************      02730000
023700*    USA INVENTORY COUNTS APPROVED COMPLETED COUNTS               02740000
023800*    FILE LAYOUT.                                                 02750000
023900************************************************************      02760000
024000     COPY ICRD060.                                                02770000
024100                                                                  02780000
024200************************************************************      02790000
024300*    USA INVENTORY COUNTS UPDATED APPROVED COMPLETED COUNTS       02800000
024400*    FILE LAYOUT.                                                 02810000
024500************************************************************      02820000
024600     COPY ICRD061.                                                02830000
024601                                                                  02840000
024200************************************************************      02850001
024300*    USA INVENTORY COUNTS OUTPUT RECORD FOR UPDATES               02860001
024400*    FILE LAYOUT.                                                 02870001
024500************************************************************      02880001
024600     COPY ICRD087.                                                02890001
024601                                                                  02900001
024602*--------------------------------------------------------------*  02910000
024603* DB2 COMMUNICATIONS AREA                                         02920000
024604*--------------------------------------------------------------*  02930000
024605     EXEC SQL                                                     02940000
024606       INCLUDE SQLCA                                              02950000
024607     END-EXEC.                                                    02960000
024608                                                                  02970000
024609***************************************************************** 02980000
024610*  XST_LOC TABLE                                                  02990000
024620***************************************************************** 03000000
024630     EXEC SQL                                                     03010000
024640          INCLUDE XST00001                                        03020000
024650     END-EXEC.                                                    03030000
024660                                                                  03040000
024670***************************************************************** 03050000
024680*  XST_SKU                                                        03060000
024690***************************************************************** 03070000
024700     EXEC SQL                                                     03080000
024800          INCLUDE XST00010                                        03090000
024900     END-EXEC.                                                    03100000
025000                                                                  03110000
025010***************************************************************** 03120000
025020*  XST_UPC                                                        03130000
025030***************************************************************** 03140000
025040     EXEC SQL                                                     03150000
025050          INCLUDE XST00012                                        03160000
025060     END-EXEC.                                                    03170000
025070                                                                  03180000
025602*--------------------------------------------------------------*  03260000
025603* DB2 TABLE ICT00020 (ICT_LOC_CNT_STAT)                           03270000
025604*           IC - LOCATION COUNT STATUS TABLE                   *  03280000
025605*--------------------------------------------------------------*  03290000
025606     EXEC SQL                                                     03300000
025607       INCLUDE ICT00020                                           03310000
025608     END-EXEC.                                                    03320000
025609                                                                  03330000
025618*--------------------------------------------------------------*  03420000
025619* DB2 TABLE ICT00011 (ICT_SKU_LOC_CNT)                            03430000
025620*           IC - SKU LOCATION COUNT TABLE                         03440000
025621*--------------------------------------------------------------*  03450000
025622     EXEC SQL                                                     03460000
025623       INCLUDE ICT00011                                           03470000
025624     END-EXEC.                                                    03480000
025625                                                                  03490000
025626*--------------------------------------------------------------*  03500000
025627* DB2 TABLE TTFSTAT -- TF TRANSFER STATUS TABLE                   03510000
025628*--------------------------------------------------------------*  03520000
025629     EXEC SQL                                                     03530000
025630       INCLUDE TTFSTAT                                            03540000
025640     END-EXEC.                                                    03550000
025650                                                                  03560000
025651*--------------------------------------------------------------*  03570000
025652* DB2 TABLE TTFITEM -- TF TRANSFER ITEM TABLE                     03580000
025653*--------------------------------------------------------------*  03590000
025654     EXEC SQL                                                     03600000
025655       INCLUDE TTFITEM                                            03610000
025656     END-EXEC.                                                    03620000
025657                                                                  03630000
025658*--------------------------------------------------------------*  03640000
025659* DB2 TABLE TTFMSTR -- TF TRANSFER MASTER TABLE                   03650000
025660*--------------------------------------------------------------*  03660000
025661     EXEC SQL                                                     03670000
025662       INCLUDE TTFMSTR                                            03680000
025663     END-EXEC.                                                    03690000
025664                                                                  03700000
025665*--------------------------------------------------------------*  03710000
025670* DB2 TABLE TEPPART -- COSA PARTIONING TABLE                      03720000
025680*--------------------------------------------------------------*  03730000
025690     EXEC SQL                                                     03740000
025700       INCLUDE TEPPART                                            03750000
025800     END-EXEC.                                                    03760000
025900                                                                  03770000
026000*--------------------------------------------------------------*  03780000
026100* DB2 TABLE TEPTRN -- COSA TRANSACTION TABLE                      03790000
026200*--------------------------------------------------------------*  03800000
026300     EXEC SQL                                                     03810000
026400       INCLUDE TEPTRN                                             03820000
026500     END-EXEC.                                                    03830000
026600                                                                  03840000
026700*--------------------------------------------------------------*  03850000
026800* DB2 TABLE TEPITM -- COSA ITEM TABLE                             03860000
026900*--------------------------------------------------------------*  03870000
027000     EXEC SQL                                                     03880000
027100       INCLUDE TEPITM                                             03890000
027200     END-EXEC.                                                    03900000
027300                                                                  03910000
030000                                                                  04000000
039400 LINKAGE SECTION.                                                 04010000
039500                                                                  04020000
039600*--------------------------------------------------------------*  04030000
039700 PROCEDURE DIVISION.                                              04040000
039800*--------------------------------------------------------------*  04050000
039900 0000-MAINLINE.                                                   04060000
040000                                                                  04070000
040100     PERFORM 1000-INITIALIZATION.                                 04080000
040500                                                                  04090000
040600     PERFORM 2000-PROCESS-COUNTS                                  04100000
040700       UNTIL PS-END-OF-FILE.                                      04110000
040701                                                                  04120000
041100     PERFORM 9999-WRAPUP.                                         04130000
041200                                                                  04140000
041300     GOBACK.                                                      04150000
041400                                                                  04160000
041500*0000-EXIT.                                                       04170000
041600                                                                  04180000
041700*--------------------------------------------------------------*  04190000
041900*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04210000
042000*     FILES, READS CONTROL CARDS, AND PROCESSES ANY INPUT FILE    04220000
042100*     PARAMETERS IT MAY NEED.                                     04230000
042200*--------------------------------------------------------------*  04240000
042300 1000-INITIALIZATION.                                             04250000
042400     DISPLAY ' '.                                                 04260000
042500     DISPLAY '*********************************************'.     04270000
042600     DISPLAY '   START OF PROGRAM NAME: ' PC-PROGRAM-NAME.        04280000
042700     DISPLAY '*********************************************'.     04290000
042800     DISPLAY ' '.                                                 04300000
043100                                                                  04310000
043200     OPEN INPUT  ICRD060-COUNTS-FILE                              04320001
043200          OUTPUT ICRD087-OUTPUT-FILE.                             04330001
043300                                                                  04340000
045100     INITIALIZE PV-HOLD-CNT-STUP-ID                               04350000
045200                PV-HOLD-LOC-NBR                                   04360000
045300                PV-HOLD-CNT-STAT-CDE                              04370000
045400                PV-SUM-SLD-QTY                                    04380000
045500                PV-SUM-RET-QTY                                    04390000
045600                PV-XFER-IN-QTY                                    04400000
045700                PV-XFER-OUT-QTY.                                  04410000
045800                                                                  04420000
090800     SET MORE-SKU-CNTS TO TRUE.                                   04450000
090900     SET PS-END-OF-FILE-NO TO TRUE.                               04460000
091000     SET PS-NEW-CNT-LOC-NO TO TRUE.                               04470000
091001                                                                  04480000
091011     PERFORM 9000-TIMEZONE-CONVERSION-SETUP.                      04570000
091012                                                                  04580000
091013     PERFORM 2110-INITIAL-READ.                                   04590000
091014                                                                  04600000
091015                                                                  04610000
091018*--------------------------------------------------------------*  04620000
091020*  PROCESS COMPLETED COUNTS                                    *  04640000
091021*--------------------------------------------------------------*  04650000
091022 2000-PROCESS-COUNTS.                                             04660000
091023                                                                  04670000
091024     SET MORE-SKU-CNTS    TO TRUE.                                04680000
091025                                                                  04690000
091026     PERFORM 2800-PROCESS-SKU-CNTS                                04700000
091027         UNTIL PS-NEW-CNT-LOC OR                                  04710000
091028               PS-END-OF-FILE                                     04720000
091029                                                                  04730000
091030     IF PS-NEW-CNT-LOC                                            04740000
091080         PERFORM 4500-DETERMINE-TIMEZONE                          04780000
091090         PERFORM 5100-WRITE-PROCESSED-REC                         04790001
091100         SET PS-NEW-CNT-LOC-NO TO TRUE                            04800000
091200     END-IF.                                                      04810000
091201                                                                  04820000
091202*--------------------------------------------------------------*  04830000
091204*  READ THE INPUT FILE                                         *  04850000
091205*--------------------------------------------------------------*  04860000
091206 2100-READ-INPUT-FILE.                                            04870000
091207                                                                  04880000
091208     READ ICRD060-COUNTS-FILE                                     04890000
091209         INTO ICRD060-APRVD-COUNTS-RECORD                         04900000
091210         AT END                                                   04910000
091220           SET PS-END-OF-FILE TO TRUE.                            04920000
091230                                                                  04930000
091240     IF PS-END-OF-FILE                                            04940000
091250        DISPLAY '* NO MORE COUNTS TO PROCESS *'                   04950000
091260     ELSE                                                         04960000
091270         ADD +1 TO PV-INPUT-CNT                                   04970000
205700                                                                  04980000
091280         IF (ICRD060-CNT-STUP-ID NOT EQUAL PV-HOLD-CNT-STUP-ID)   04990000
091290             OR (ICRD060-LOC-NBR NOT EQUAL PV-HOLD-LOC-NBR)       05000000
091300             MOVE ICRD060-CNT-STUP-ID  TO PV-HOLD-CNT-STUP-ID     05010000
091400             MOVE ICRD060-LOC-NBR      TO PV-HOLD-LOC-NBR         05020000
091500             MOVE ICRD060-CNT-STAT-CDE TO PV-HOLD-CNT-STAT-CDE    05030000
091600             SET PS-NEW-CNT-LOC TO TRUE                           05040000
091700         ELSE                                                     05050000
091800             SET PS-NEW-CNT-LOC-NO TO TRUE                        05060000
091900         END-IF                                                   05070000
092000     END-IF.                                                      05080000
092001                                                                  05090000
092002*--------------------------------------------------------------*  05100000
092004*  READ THE INPUT FILE                                         *  05120000
092005*--------------------------------------------------------------*  05130000
092006 2110-INITIAL-READ.                                               05140000
092007                                                                  05150000
092008     READ ICRD060-COUNTS-FILE                                     05160000
092009         INTO ICRD060-APRVD-COUNTS-RECORD                         05170000
092010         AT END                                                   05180000
092020           SET PS-END-OF-FILE TO TRUE.                            05190000
092030                                                                  05200000
092040     IF PS-END-OF-FILE                                            05210000
092050        DISPLAY '* NO MORE COUNTS TO PROCESS *'                   05220000
092060     ELSE                                                         05230000
092070        ADD +1 TO PV-INPUT-CNT                                    05240000
092080        MOVE ICRD060-CNT-STUP-ID  TO PV-HOLD-CNT-STUP-ID          05250000
092090        MOVE ICRD060-LOC-NBR      TO PV-HOLD-LOC-NBR              05260000
092100        MOVE ICRD060-CNT-STAT-CDE TO PV-HOLD-CNT-STAT-CDE         05270000
092200        PERFORM 4500-DETERMINE-TIMEZONE                           05280000
092300        PERFORM 5100-WRITE-PROCESSED-REC                          05290001
092400        SET PS-NEW-CNT-LOC-NO TO TRUE                             05300000
092500     END-IF.                                                      05310000
092501                                                                  05320000
092502*--------------------------------------------------------------*  05330000
092504*  SELECT SKU                                                  *  05350000
092505*--------------------------------------------------------------*  05360000
092506 2200-SELECT-SKU.                                                 05370000
092507                                                                  05380000
092540                                                                  05440000
092550     EXEC SQL                                                     05450000
092560             SELECT C.LOC_NBR                                     05460000
092570                   ,C.SKU_NBR                                     05470000
092580                   ,C.CNT_STUP_ID                                 05480000
092590                   ,C.LAST_UPD_TMST                               05490000
092600                   ,C.CNT_SEQ_NBR                                 05500000
092700                   ,C.LAST_UPD_USR_ID                             05510000
092800                   ,C.LAST_ACTN_CDE                               05520000
092900                   ,C.UNT_RTL_AMT                                 05530000
093000                   ,C.LOC_EXPTED_UNT_QTY                          05540000
093100                   ,C.IN_TRNST_UNT_QTY                            05550000
093200                   ,C.ACPTD_TRUK_UNT_QTY                          05560000
093300                   ,C.RTL_SAL_UNT_QTY                             05570000
093400                   ,C.RTL_RET_UNT_QTY                             05580000
093500                   ,C.XFER_IN_UNT_QTY                             05590000
093600                   ,C.XFER_OUT_UNT_QTY                            05600000
CL3132                   ,T.SCND_UPC_NBR                                05610000
CL3132                   ,T.SCND_UNT_QTY                                05620000
093900                   ,C.CNT_GP_CDE                                  05630000
094000                   ,C.EXEC_TMST                                   05640000
094100                   ,C.MDSE_EXPRN_DTE                              05650000
C32847                   ,T.EXEC_TMST                                   05660000
094300               INTO :ICT00011-LOC-NBR                             05670000
094400                   ,:ICT00011-SKU-NBR                             05680000
094500                   ,:ICT00011-CNT-STUP-ID                         05690000
094600                   ,:PV-MAX-SKU-LAST-UPD-TMST                     05700000
094700                   ,:ICT00011-CNT-SEQ-NBR                         05710000
094800                   ,:ICT00011-LAST-UPD-USR-ID                     05720000
094900                   ,:ICT00011-LAST-ACTN-CDE                       05730000
095000                   ,:ICT00011-UNT-RTL-AMT                         05740000
095100                   ,:ICT00011-LOC-EXPTED-UNT-QTY                  05750000
095200          ,:ICT00011-IN-TRNST-UNT-QTY  :PV-INTRNST-QTY-NULL-IND   05760000
095300       ,:ICT00011-ACPTD-TRUK-UNT-QTY  :PV-ACPTD-TRUK-QTY-NULL-IND 05770000
095400          ,:ICT00011-RTL-SAL-UNT-QTY  :PV-RTL-SAL-QTY-NULL-IND    05780000
095500          ,:ICT00011-RTL-RET-UNT-QTY  :PV-RTL-RET-QTY-NULL-IND    05790000
095600          ,:ICT00011-XFER-IN-UNT-QTY  :PV-XFER-IN-QTY-NULL-IND    05800000
095700          ,:ICT00011-XFER-OUT-UNT-QTY :PV-XFER-OUT-QTY-NULL-IND   05810000
095800          ,:ICT00011-SCND-UPC-NBR  :PV-SCND-UPC-NBR-NULL-IND      05820000
095900          ,:ICT00011-SCND-UNT-QTY  :PV-SCND-UNT-QTY-NULL-IND      05830000
096000          ,:ICT00011-CNT-GP-CDE  :PV-CNT-GP-CDE-NULL-IND          05840000
096100          ,:ICT00011-EXEC-TMST  :PV-EXEC-TMST-NULL-IND            05850000
096200          ,:ICT00011-MDSE-EXPRN-DTE  :PV-MDSE-EXPRN-DTE-NULL-IND  05860000
096300          ,:PV-EXEC-TMST  :PV-EXEC-TMST-NULL-IND2                 05870000
096400               FROM ICT_SKU_LOC_CNT  C                            05880000
CL3132               LEFT OUTER JOIN                                    05890000
CL3132              ( SELECT D.LOC_NBR                                  05900000
CL3132                      ,D.SKU_NBR                                  05910000
CL3132                      ,D.CNT_STUP_ID                              05920000
CL3132                      ,D.CNT_SEQ_NBR                              05930000
CL3132                      ,D.SCND_UNT_QTY                             05940000
CL3132                      ,D.SCND_UPC_NBR                             05950000
C32847                      ,D.EXEC_TMST                                05960000
CL3132                  FROM ICT_SKU_LOC_CNT D                          05970000
CL3132                 WHERE D.LOC_NBR = :ICRD060-LOC-NBR               05980000
CL3132                   AND D.CNT_STUP_ID = :ICRD060-CNT-STUP-ID       05990000
CL3132                   AND D.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR       06000000
CL3132                   AND D.SKU_NBR =  :ICRD060-SKU-NBR              06010000
CL3132                   AND D.LAST_UPD_USR_ID <> 'SYSTEM'              06020000
CL3132                   AND D.LAST_UPD_TMST =                          06030000
CL3132                 (SELECT MAX(T2.LAST_UPD_TMST)                    06040000
CL3132                   FROM ICT_SKU_LOC_CNT   T2                      06050000
CL3132                  WHERE T2.CNT_STUP_ID = D.CNT_STUP_ID            06060000
CL3132                    AND T2.LOC_NBR = D.LOC_NBR                    06070000
CL3132                    AND T2.SKU_NBR = D.SKU_NBR                    06080000
CL3132                    AND T2.CNT_SEQ_NBR = D.CNT_SEQ_NBR            06090000
CL3132                    AND T2.LAST_UPD_USR_ID <> 'SYSTEM')           06100000
CL3132              ) T                                                 06110000
CL3132                  ON C.CNT_STUP_ID = T.CNT_STUP_ID AND            06120000
CL3132                     C.CNT_SEQ_NBR = T.CNT_SEQ_NBR AND            06130000
CL3132                     C.LOC_NBR     = T.LOC_NBR     AND            06140000
CL3132                     C.SKU_NBR     = T.SKU_NBR                    06150000
096500                   ,ICT_LOC_CNT_STAT A                            06160000
096600                                                                  06170000
096700               WHERE C.LOC_NBR = :ICRD060-LOC-NBR                 06180000
096800                 AND C.CNT_STUP_ID = :ICRD060-CNT-STUP-ID         06190000
096900                 AND C.SKU_NBR = :ICRD060-SKU-NBR                 06200000
097000                 AND C.LOC_NBR = A.LOC_NBR                        06210000
097100                 AND C.CNT_STUP_ID = A.CNT_STUP_ID                06220000
097200                 AND C.CNT_SEQ_NBR = A.CNT_SEQ_NBR                06230000
097300                 AND C.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR         06240000
097400                 AND A.CNT_STAT_CDE = :ICRD060-CNT-STAT-CDE       06250000
CL3132                 AND C.LAST_UPD_USR_ID = 'SYSTEM'                 06260000
097500                                                                  06270000
097600                 AND C.LAST_UPD_TMST  =                           06280000
097700                     (SELECT MAX(G.LAST_UPD_TMST)                 06290000
097800                        FROM ICT_SKU_LOC_CNT   G                  06300000
097900                       WHERE G.CNT_STUP_ID = C.CNT_STUP_ID        06310000
098000                         AND G.SKU_NBR = C.SKU_NBR                06320000
098100                         AND G.CNT_SEQ_NBR = C.CNT_SEQ_NBR        06330000
CL3132                         AND G.LAST_UPD_USR_ID = 'SYSTEM'         06340000
098200                         AND G.LOC_NBR = C.LOC_NBR)               06350000
098300                                                                  06360000
098400                 AND A.LAST_UPD_TMST  =                           06370000
098500                     (SELECT MAX(H.LAST_UPD_TMST)                 06380000
098600                        FROM ICT_LOC_CNT_STAT  H                  06390000
098700                       WHERE H.CNT_STUP_ID = A.CNT_STUP_ID        06400000
098800                         AND H.LOC_NBR = A.LOC_NBR                06410000
098900                         AND H.CNT_STAT_CDE = A.CNT_STAT_CDE      06420000
099000                         AND H.CNT_SEQ_NBR = A.CNT_SEQ_NBR)       06430000
099100                                                                  06440000
099200           ORDER BY C.LOC_NBR                                     06450000
099300                   ,C.SKU_NBR                                     06460000
099400                   ,C.CNT_STUP_ID                                 06470000
099500                                                                  06480000
099600     END-EXEC.                                                    06490002
099700                                                                  06500000
099800     MOVE SQLCODE TO PV-SQL-SUB.                                  06510002
099900     EVALUATE TRUE                                                06520000
100000         WHEN SQLCODE = ZERO                                      06530000
C32847         IF  PV-EXEC-TMST-NULL-IND2 = PC-NULL-VALUE               06540000
C32847             MOVE ICT00011-EXEC-TMST TO                           06550000
C32847                  PV-EXEC-TMST                                    06560000
C32847         END-IF                                                   06570000
100100             ADD +1 TO PV-SELECT-SKU-CNT                          06580000
100200             MOVE PV-EXEC-TMST(1:10)                              06590000
100300               TO PV-COM-CNT-DTE                                  06600000
100400             MOVE PV-EXEC-TMST(12:8)                              06610000
100500               TO PV-COM-CNT-TM                                   06620000
100600             MOVE PV-EXEC-TMST(21:6)                              06630000
100700               TO PV-COM-CNT-MSEC                                 06640000
100800             MOVE PV-EXEC-TMST                                    06650000
100900               TO PV-COMPARE-TMST,                                06660000
101000                  PV-COMPARE-TMST-HOLD,                           06670000
101100                  PV-COM-CNT-TMST-HOLD                            06680000
205700                                                                  06690000
101200         WHEN SQLCODE = -904                                      06700000
101300         WHEN SQLCODE = -911                                      06710000
101400         WHEN SQLCODE = -913                                      06720000
101500             CONTINUE                                             06730000
101600         WHEN SQLCODE = +100                                      06740000
101700             SET NO-MORE-SKU-CNTS TO TRUE                         06750000
101800         WHEN OTHER                                               06760000
101900              DISPLAY '*2200 BLOWING UP ON BAD SQL-'              06770000
102000                 '* SELECT KEY-',                                 06780000
102100                  ICRD060-SKU-NBR,                                06790000
102200                  ICRD060-LOC-NBR,                                06800000
102300                  ICRD060-CNT-STUP-ID,                            06810000
102400                 ' SQL CODE -', PV-SQL-SUB, '**'                  06820000
102500              MOVE '2200-SELECT-SKU'                              06830000
102600                  TO PV-PARAGRAPH-NAME                            06840000
102700             MOVE 'ERROR ON SELECT OF SKU NUMBER  '               06850000
102800                  TO PV-DB2-OPERATION                             06860000
102900             PERFORM 9900-SQL-ABEND                               06870000
103000     END-EVALUATE.                                                06880002
103200                                                                  06900000
104601                                                                  07050000
104602*--------------------------------------------------------------*  07060000
104604*  SELECT SKU FOR REVERSALS                                    *  07080000
104605*--------------------------------------------------------------*  07090000
104606 2250-SELECT-SKU-FOR-REV.                                         07100000
104607                                                                  07110000
104650     EXEC SQL                                                     07180000
104660             SELECT C.LOC_NBR                                     07190000
104670                   ,C.SKU_NBR                                     07200000
104680                   ,C.CNT_STUP_ID                                 07210000
104690                   ,C.CNT_SEQ_NBR                                 07220000
104700                   ,C.LAST_UPD_USR_ID                             07230000
104800                   ,C.LAST_ACTN_CDE                               07240000
104900                   ,C.UNT_RTL_AMT                                 07250000
105000                   ,C.LOC_EXPTED_UNT_QTY                          07260000
105100                   ,C.IN_TRNST_UNT_QTY                            07270000
105200                   ,C.ACPTD_TRUK_UNT_QTY                          07280000
105300                   ,C.RTL_SAL_UNT_QTY                             07290000
105400                   ,C.RTL_RET_UNT_QTY                             07300000
105500                   ,C.XFER_IN_UNT_QTY                             07310000
105600                   ,C.XFER_OUT_UNT_QTY                            07320000
CL3132                   ,T.SCND_UPC_NBR                                07330000
CL3132                   ,T.SCND_UNT_QTY                                07340000
105900                   ,C.CNT_GP_CDE                                  07350000
106000                   ,C.EXEC_TMST                                   07360000
106100                   ,C.MDSE_EXPRN_DTE                              07370000
106200               INTO :ICT00011-LOC-NBR                             07380000
106300                   ,:ICT00011-SKU-NBR                             07390000
106400                   ,:ICT00011-CNT-STUP-ID                         07400000
106500                   ,:ICT00011-CNT-SEQ-NBR                         07410000
106600                   ,:ICT00011-LAST-UPD-USR-ID                     07420000
106700                   ,:ICT00011-LAST-ACTN-CDE                       07430000
106800                   ,:ICT00011-UNT-RTL-AMT                         07440000
106900                   ,:ICT00011-LOC-EXPTED-UNT-QTY                  07450000
107000          ,:ICT00011-IN-TRNST-UNT-QTY  :PV-INTRNST-QTY-NULL-IND   07460000
107100       ,:ICT00011-ACPTD-TRUK-UNT-QTY  :PV-ACPTD-TRUK-QTY-NULL-IND 07470000
107200          ,:ICT00011-RTL-SAL-UNT-QTY  :PV-RTL-SAL-QTY-NULL-IND    07480000
107300          ,:ICT00011-RTL-RET-UNT-QTY  :PV-RTL-RET-QTY-NULL-IND    07490000
107400          ,:ICT00011-XFER-IN-UNT-QTY  :PV-XFER-IN-QTY-NULL-IND    07500000
107500          ,:ICT00011-XFER-OUT-UNT-QTY :PV-XFER-OUT-QTY-NULL-IND   07510000
107600          ,:ICT00011-SCND-UPC-NBR  :PV-SCND-UPC-NBR-NULL-IND      07520000
107700          ,:ICT00011-SCND-UNT-QTY  :PV-SCND-UNT-QTY-NULL-IND      07530000
107800          ,:ICT00011-CNT-GP-CDE  :PV-CNT-GP-CDE-NULL-IND          07540000
107900          ,:ICT00011-EXEC-TMST  :PV-EXEC-TMST-NULL-IND            07550000
108000          ,:ICT00011-MDSE-EXPRN-DTE  :PV-MDSE-EXPRN-DTE-NULL-IND  07560000
108100               FROM ICT_SKU_LOC_CNT  C                            07570000
CL3132               LEFT OUTER JOIN                                    07580000
CL3132              ( SELECT D.LOC_NBR                                  07590000
CL3132                      ,D.SKU_NBR                                  07600000
CL3132                      ,D.CNT_STUP_ID                              07610000
CL3132                      ,D.CNT_SEQ_NBR                              07620000
CL3132                      ,D.SCND_UNT_QTY                             07630000
CL3132                      ,D.SCND_UPC_NBR                             07640000
CL3132                  FROM ICT_SKU_LOC_CNT D                          07650000
CL3132                 WHERE D.LOC_NBR = :ICRD060-LOC-NBR               07660000
CL3132                   AND D.CNT_STUP_ID = :ICRD060-CNT-STUP-ID       07670000
CL3132                   AND D.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR       07680000
CL3132                   AND D.SKU_NBR =  :ICRD060-SKU-NBR              07690000
CL3132                   AND D.LAST_UPD_USR_ID <> 'SYSTEM'              07700000
CL3132                   AND D.LAST_UPD_TMST =                          07710000
CL3132                (SELECT MAX(T2.LAST_UPD_TMST)                     07720000
CL3132                   FROM ICT_SKU_LOC_CNT   T2                      07730000
CL3132                  WHERE T2.CNT_STUP_ID = D.CNT_STUP_ID            07740000
CL3132                    AND T2.LOC_NBR = D.LOC_NBR                    07750000
CL3132                    AND T2.SKU_NBR = D.SKU_NBR                    07760000
CL3132                    AND T2.CNT_SEQ_NBR = D.CNT_SEQ_NBR            07770000
CL3132                    AND T2.LAST_UPD_USR_ID <> 'SYSTEM')           07780000
CL3132              ) T                                                 07790000
CL3132                  ON C.CNT_STUP_ID = T.CNT_STUP_ID AND            07800000
CL3132                     C.CNT_SEQ_NBR = T.CNT_SEQ_NBR AND            07810000
CL3132                     C.LOC_NBR     = T.LOC_NBR     AND            07820000
CL3132                     C.SKU_NBR     = T.SKU_NBR                    07830000
108200                                                                  07840000
108300               WHERE C.LOC_NBR = :ICRD060-LOC-NBR                 07850000
108400                 AND C.CNT_STUP_ID = :ICRD060-CNT-STUP-ID         07860000
108500                 AND C.SKU_NBR = :ICRD060-SKU-NBR                 07870000
108600                 AND C.CNT_SEQ_NBR = :ICRD060-CNT-SEQ-NBR         07880000
CL3132                 AND C.LAST_UPD_USR_ID = 'SYSTEM'                 07890000
108700                                                                  07900000
108800                 AND C.LAST_UPD_TMST  =                           07910000
108900                     (SELECT MAX(G.LAST_UPD_TMST)                 07920000
109000                        FROM ICT_SKU_LOC_CNT   G                  07930000
109100                       WHERE G.CNT_STUP_ID = C.CNT_STUP_ID        07940000
109200                         AND G.SKU_NBR = C.SKU_NBR                07950000
109300                         AND G.CNT_SEQ_NBR = C.CNT_SEQ_NBR        07960000
CL3132                         AND G.LAST_UPD_USR_ID = 'SYSTEM'         07970000
109400                         AND G.LOC_NBR = C.LOC_NBR)               07980000
109500                                                                  07990000
109600     END-EXEC.                                                    08000002
109700                                                                  08010000
109800     MOVE SQLCODE TO PV-SQL-SUB                                   08020002
109900     EVALUATE TRUE                                                08030000
110000         WHEN SQLCODE = ZERO                                      08040000
110100             ADD +1 TO PV-SELECT-SKU-CNT                          08050000
110200         WHEN SQLCODE = -904                                      08060000
110300         WHEN SQLCODE = -911                                      08070000
110400         WHEN SQLCODE = -913                                      08080000
110500             CONTINUE                                             08090000
110600         WHEN SQLCODE = +100                                      08100000
110700             SET NO-MORE-SKU-CNTS TO TRUE                         08110000
110800         WHEN OTHER                                               08120000
110900              DISPLAY '*2250 BLOWING UP ON BAD SQL-'              08130000
111000                 '* SELECT KEY-',                                 08140000
111100                  ICRD060-SKU-NBR,                                08150000
111200                  ICRD060-LOC-NBR,                                08160000
111300                  ICRD060-CNT-STUP-ID,                            08170000
111400                  ICRD060-CNT-STAT-CDE,                           08180000
111500                 ' SQL CODE -', PV-SQL-SUB, '**'                  08190000
111600              MOVE '2250-SELECT-SKU-FOR-REV'                      08200000
111700                  TO PV-PARAGRAPH-NAME                            08210000
111800             MOVE 'ERROR ON SELECT OF SKU NUMBER  '               08220000
111900                  TO PV-DB2-OPERATION                             08230000
112000             PERFORM 9900-SQL-ABEND                               08240000
112100     END-EVALUATE.                                                08250002
112300                                                                  08270000
113801                                                                  08430000
113802*--------------------------------------------------------------*  08440000
113803* 2800-PROCESS-SKU-CNTS                                           08450000
113804*--------------------------------------------------------------*  08460000
113805 2800-PROCESS-SKU-CNTS.                                           08470000
113806                                                                  08480000
113809     EVALUATE ICRD060-CNT-STAT-CDE                                08510000
113810         WHEN PC-AUT                                              08520000
113820             PERFORM 2200-SELECT-SKU                              08530000
113830             PERFORM 4000-PROCESS-SALES                           08540000
113840             PERFORM 4010-PROCESS-RETURNS                         08550000
113850             PERFORM 4020-PROCESS-TRANS-IN                        08560000
113860             PERFORM 4030-PROCESS-TRANS-OUT                       08570000
113870             PERFORM 5125-FS-CHECK                                08580000
113880         WHEN PC-APP                                              08590000
113890             PERFORM 2200-SELECT-SKU                              08600000
113900             PERFORM 4000-PROCESS-SALES                           08610000
114000             PERFORM 4010-PROCESS-RETURNS                         08620000
114100             PERFORM 4020-PROCESS-TRANS-IN                        08630000
114200             PERFORM 4030-PROCESS-TRANS-OUT                       08640000
114300             PERFORM 5125-FS-CHECK                                08650000
114400         WHEN PC-REV                                              08660000
114500             PERFORM 4040-PROCESS-REVERSE-APRVLS                  08670000
115500         WHEN OTHER                                               08680000
115600*            SET INVALID-CNT-STAT-CDE TO TRUE                     08690002
115600             CONTINUE                                             08691002
115700     END-EVALUATE.                                                08700000
115900                                                                  08720000
116000     PERFORM 2100-READ-INPUT-FILE.                                08730000
116100                                                                  08740000
116100                                                                  08741002
116200******************************************************************08750000
116400* SUMS ALL SALES FOR A STORE/SKU PRIOR TO THE COMPLETED COUNTS   *08770000
116500* DATE.  (SEE ICCC018)                                           *08780000
116600******************************************************************08790000
116700 4000-PROCESS-SALES.                                              08800000
116800                                                                  08810000
116900     EXEC SQL                                                     08820000
117000           SELECT                                                 08830000
117100                 SUM (C.SLD_QTY)                                  08840000
117200             INTO                                                 08850000
117300                :PV-SUM-SLD-QTY  :PV-SUM-SLD-QTY-NULL-IND         08860000
117400             FROM TEPPART A                                       08870000
117500                 ,TEPTRN  B                                       08880000
117600                 ,TEPITM  C                                       08890000
117700                 ,XST_SKU D                                       08900000
117800            WHERE A.PARTN_NBR = B.PARTN_NBR                       08910000
117900              AND A.PARTN_NBR = C.PARTN_NBR                       08920000
118000              AND B.STR_NBR = :ICRD060-LOC-NBR                    08930000
118100              AND B.STR_NBR = C.STR_NBR                           08940000
118200              AND B.RGST_ID = C.RGST_ID                           08950000
118300              AND B.TRN_NBR = C.TRN_NBR                           08960000
118400              AND B.STRT_TM = C.STRT_TM                           08970000
118500              AND C.SKU_NBR = :ICRD060-SKU-NBR                    08980000
118600              AND C.SKU_NBR = D.SKU_NBR                           08990000
118700              AND B.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR         09000000
118800              AND A.SLS_DTE = :PV-COM-CNT-DTE                     09010000
118900              AND B.STRT_TM BETWEEN                               09020000
119000                        '00.00.00' AND :PV-COM-CNT-TM             09030000
119100              AND B.TRN_TYP_CDE                                   09040000
119200                    IN ('01','02','11','12','21','22','23')       09050000
119300              AND B.VOID_ABRT_CDE = 'N'                           09060000
119400              AND B.TRN_STAT_CDE IN ('V', 'Z', 'L')               09070000
119500              AND C.LIV_RSLU_CDE IN ('+', '-')                    09080000
119600              AND C.SAL_RET_CDE = 'S'                             09090000
119700              AND C.SKU_NBR > 0                                   09100000
119800              AND A.STR_GP_CDE = 'A'                              09110000
119900              AND A.DB_STRUC_CDE = 'O'                            09120000
120000              WITH UR                                             09130000
120100                                                                  09140000
120200     END-EXEC.                                                    09150002
120300                                                                  09160000
120400     EVALUATE TRUE                                                09170002
120500         WHEN SQLCODE = ZERO                                      09180002
120600             IF PV-SUM-SLD-QTY-NULL-IND = PC-NULL-VALUE           09190002
120700                 MOVE ZERO TO ICT00011-RTL-SAL-UNT-QTY            09200002
120900             ELSE                                                 09220002
121000                 MOVE PV-SUM-SLD-QTY TO ICT00011-RTL-SAL-UNT-QTY  09230002
121200             END-IF                                               09250002
121300                                                                  09260000
121400         WHEN SQLCODE = +100                                      09270002
121500             MOVE ZERO TO ICT00011-RTL-SAL-UNT-QTY                09280002
121700                                                                  09300000
121800         WHEN SQLWARN0 NOT EQUAL SPACE                            09310002
121900         WHEN SQLCODE NOT EQUAL ZERO                              09320002
122000             DISPLAY '**************************************'     09330002
122100             DISPLAY '** ABEND                            **'     09340002
122200             DISPLAY '** PARAGRAPH 4000 SUM SALES PROBLEM **'     09350002
122300             DISPLAY '*COUNT SETUP ID   = '                       09360002
122400                              ICRD060-CNT-STUP-ID                 09370000
122500             DISPLAY '*LOCATION NUMBER  = '                       09380002
122600                              ICRD060-LOC-NBR                     09390000
122700             DISPLAY '*SKU NUMBER       = '                       09400002
122800                              ICRD060-SKU-NBR                     09410000
122900             DISPLAY '*PV-COM-CNT-DTE   = '                       09420002
123000                              PV-COM-CNT-DTE                      09430000
123100             DISPLAY '*PV-COM-CNT-TM    = '                       09440002
123200                              PV-COM-CNT-TM                       09450000
123300             DISPLAY '**************************************'     09460002
123400             MOVE '4000-PROCESS-SALES' TO                         09470002
123500                      PV-PARAGRAPH-NAME                           09480000
123600             MOVE 'ERROR ON SELECT OF SUM SALES ' TO              09490002
123700                      PV-DB2-OPERATION                            09500000
123800             PERFORM 9900-SQL-ABEND                               09510002
124000     END-EVALUATE.                                                09530002
124100                                                                  09540000
124100                                                                  09541002
125300******************************************************************09550000
125500* SUMS ALL RETURNS FOR A STORE/SKU PRIOR TO THE COMPLETED COUNTS *09570000
125600* DATE.  (SEE ICCC018)                                           *09580000
125700******************************************************************09590000
125800 4010-PROCESS-RETURNS.                                            09600000
125900                                                                  09610000
126000     EXEC SQL                                                     09620000
126100           SELECT                                                 09630000
126200                 SUM (C.SLD_QTY)                                  09640000
126300             INTO                                                 09650000
126400                :PV-SUM-RET-QTY  :PV-SUM-RET-QTY-NULL-IND         09660000
126500             FROM TEPPART A                                       09670000
126600                 ,TEPTRN  B                                       09680000
126700                 ,TEPITM  C                                       09690000
126800                 ,XST_SKU D                                       09700000
126900            WHERE A.PARTN_NBR = B.PARTN_NBR                       09710000
127000              AND A.PARTN_NBR = C.PARTN_NBR                       09720000
127100              AND B.STR_NBR = :ICRD060-LOC-NBR                    09730000
127200              AND B.STR_NBR = C.STR_NBR                           09740000
127300              AND B.RGST_ID = C.RGST_ID                           09750000
127400              AND B.TRN_NBR = C.TRN_NBR                           09760000
127500              AND B.STRT_TM = C.STRT_TM                           09770000
127600              AND C.SKU_NBR = :ICRD060-SKU-NBR                    09780000
127700              AND C.SKU_NBR = D.SKU_NBR                           09790000
127800              AND B.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR         09800000
127900              AND A.SLS_DTE = :PV-COM-CNT-DTE                     09810000
128000              AND B.STRT_TM BETWEEN                               09820000
128100                        '00.00.00' AND :PV-COM-CNT-TM             09830000
128200              AND B.TRN_TYP_CDE                                   09840000
128210                    IN ('01','02','11','12','21','22','23')       09850000
128400              AND B.VOID_ABRT_CDE = 'N'                           09860000
128500              AND B.TRN_STAT_CDE IN ('V', 'Z', 'L')               09870000
128600              AND C.LIV_RSLU_CDE IN ('+', '-')                    09880000
128700              AND C.SAL_RET_CDE = 'R'                             09890000
128800              AND C.SKU_NBR > 0                                   09900000
128900              AND A.STR_GP_CDE = 'A'                              09910000
129000              AND A.DB_STRUC_CDE = 'O'                            09920000
129100              WITH UR                                             09930000
129300     END-EXEC.                                                    09950002
129400                                                                  09960000
129500     EVALUATE TRUE                                                09970002
129600         WHEN SQLCODE = ZERO                                      09980002
129700             IF PV-SUM-RET-QTY-NULL-IND = PC-NULL-VALUE           09990002
129800                 MOVE ZERO TO ICT00011-RTL-RET-UNT-QTY            10000002
130000             ELSE                                                 10020002
130100                 MOVE PV-SUM-RET-QTY TO ICT00011-RTL-RET-UNT-QTY  10030002
130300             END-IF                                               10050002
130400                                                                  10060000
130500         WHEN SQLCODE = +100                                      10070002
130600             MOVE ZERO TO ICT00011-RTL-RET-UNT-QTY                10080002
130900         WHEN SQLWARN0 NOT EQUAL SPACE                            10110002
131000         WHEN SQLCODE NOT EQUAL ZERO                              10120002
131100             DISPLAY '**************************************'     10130002
131200             DISPLAY '** ABEND                            **'     10140002
131300             DISPLAY '** PARAGRAPH 4010 SUM RETURN PROBLEM**'     10150002
131400             DISPLAY '*COUNT SETUP ID   = '                       10160002
131500                              ICRD060-CNT-STUP-ID                 10170000
131600             DISPLAY '*LOCATION NUMBER  = '                       10180002
131700                              ICRD060-LOC-NBR                     10190000
131800             DISPLAY '*SKU NUMBER       = '                       10200002
131900                              ICRD060-SKU-NBR                     10210000
132000             DISPLAY '**************************************'     10220002
132100             MOVE '4010-PROCESS-RETURNS' TO                       10230002
132200                      PV-PARAGRAPH-NAME                           10240000
132300             MOVE 'ERROR ON SELECT OF SUM RETURNS' TO             10250002
132400                      PV-DB2-OPERATION                            10260000
132500             PERFORM 9900-SQL-ABEND                               10270002
132700     END-EVALUATE.                                                10290002
132800                                                                  10300000
132800                                                                  10301002
133900******************************************************************10310000
134100*   PROCESS TRANSFERS IN FOR APPROVED COUNTS.                    *10330000
134200******************************************************************10340000
134300 4020-PROCESS-TRANS-IN.                                           10350000
134400                                                                  10360000
134500     EXEC SQL                                                     10370000
134600           SELECT                                                 10380000
134700                 SUM (B.XFER_QTY)                                 10390000
134800             INTO                                                 10400000
134900                :PV-XFER-IN-QTY  :PV-SUM-XFER-IN-NULL-IND         10410000
135000            FROM TTFMSTR       A                                  10420000
135100                ,TTFITEM       B                                  10430000
135200                ,XST_UPC       C                                  10440003
135300                ,XST_SKU       D                                  10450000
135400                ,TTFSTAT       F                                  10460000
135900           WHERE A.XFER_DKEY_ID   = B.XFER_DKEY_ID                10470000
136000             AND B.SCN_UPC_NBR    = C.UPC_NBR                     10480000
136100             AND C.INTR_UPC_ID    = D.INTR_UPC_ID                 10490000
136200             AND D.SKU_NBR        = :ICRD060-SKU-NBR              10500000
136300             AND A.TO_STR_NBR     = :ICRD060-LOC-NBR              10510000
136400             AND A.CMPT_XFER_END_TMST < :PV-COM-CNT-TMST-HOLD     10520000
136410             AND A.CMPT_XFER_END_TMST > :PV-COMPARE-TMST-HOLD     10530000
136420             AND F.XFER_STAT_CDE NOT IN ('PR','RC','RN','VD')     10540000
136421             AND A.XFER_DKEY_ID   = F.XFER_DKEY_ID                10550000
136430             AND F.XFER_STAT_TMST =                               10560000
136440                   (SELECT MAX(G.XFER_STAT_TMST)                  10570000
136450                      FROM TTFSTAT  G                             10580000
136460                     WHERE F.XFER_DKEY_ID = G.XFER_DKEY_ID)       10590000
137100             WITH UR                                              10600000
137300     END-EXEC.                                                    10620000
137400                                                                  10630000
137500     EVALUATE TRUE                                                10640002
137600         WHEN SQLCODE = ZERO                                      10650002
137700             IF PV-XFER-IN-QTY-NULL-IND = PC-NULL-VALUE           10660002
137800                 MOVE ZERO TO ICT00011-XFER-IN-UNT-QTY            10670002
138000             ELSE                                                 10690002
138100                 MOVE PV-XFER-IN-QTY TO ICT00011-XFER-IN-UNT-QTY  10700002
138300             END-IF                                               10720002
138400                                                                  10730000
138500         WHEN SQLCODE = +100                                      10740002
138600             MOVE ZERO TO ICT00011-XFER-IN-UNT-QTY                10750002
138900         WHEN SQLWARN0 NOT EQUAL SPACE                            10780002
139000         WHEN SQLCODE NOT EQUAL ZERO                              10790002
139100             DISPLAY '**************************************'     10800002
139200             DISPLAY '** ABEND                            **'     10810002
139300             DISPLAY '** PARA 4020 SUM TRANSFERS IN PROBLEM*'     10820002
139400             DISPLAY '*LOCATION NUMBER  = '                       10830002
139500                              ICRD060-LOC-NBR                     10840000
139600             DISPLAY '*SKU NUMBER       = '                       10850002
139700                              ICRD060-SKU-NBR                     10860000
139800             DISPLAY '**************************************'     10870002
139900             MOVE '4020-PROCESS-TRANS-IN' TO                      10880002
140000                      PV-PARAGRAPH-NAME                           10890000
140100             MOVE 'ERROR ON SELECT OF TRANS IN' TO                10900002
140200                      PV-DB2-OPERATION                            10910000
140300             PERFORM 9900-SQL-ABEND                               10920002
140500     END-EVALUATE.                                                10940002
140600                                                                  10950000
140600                                                                  10951002
141700******************************************************************10960000
141900*   PROCESS TRANSFERS OUT FOR APPROVED COUNTS.                   *10980000
142000******************************************************************10990000
142100 4030-PROCESS-TRANS-OUT.                                          11000000
142200                                                                  11010000
142300     EXEC SQL                                                     11020000
142400           SELECT                                                 11030000
142500                 SUM (B.XFER_QTY)                                 11040000
142600             INTO                                                 11050000
142700                :PV-XFER-OUT-QTY :PV-SUM-XFER-OUT-NULL-IND        11060000
142800            FROM TTFMSTR       A                                  11070000
142900                ,TTFITEM       B                                  11080000
143000                ,XST_UPC       C                                  11090000
143100                ,XST_SKU       D                                  11100000
143200                ,TTFSTAT       F                                  11110000
143700           WHERE A.XFER_DKEY_ID   = B.XFER_DKEY_ID                11120000
143800             AND B.SCN_UPC_NBR    = C.UPC_NBR                     11130000
143900             AND C.INTR_UPC_ID    = D.INTR_UPC_ID                 11140000
144000             AND D.SKU_NBR        = :ICRD060-SKU-NBR              11150000
144100             AND A.FR_STR_NBR     = :ICRD060-LOC-NBR              11160000
144110             AND A.CMPT_XFER_END_TMST < :PV-COM-CNT-TMST-HOLD     11170000
144120             AND A.CMPT_XFER_END_TMST > :PV-COMPARE-TMST-HOLD     11180000
144130             AND F.XFER_STAT_CDE NOT IN ('PR','RC','RN','VD')     11190000
144131             AND A.XFER_DKEY_ID   = F.XFER_DKEY_ID                11200000
144140             AND F.XFER_STAT_TMST =                               11210000
144150                   (SELECT MAX(G.XFER_STAT_TMST)                  11220000
144160                      FROM TTFSTAT  G                             11230000
144170                     WHERE F.XFER_DKEY_ID = G.XFER_DKEY_ID)       11240000
144800             WITH UR                                              11250000
144900                                                                  11260000
145000     END-EXEC.                                                    11270000
145100                                                                  11280000
145200     EVALUATE TRUE                                                11290002
145300         WHEN SQLCODE = ZERO                                      11300002
145400             IF PV-XFER-OUT-QTY-NULL-IND = PC-NULL-VALUE          11310002
145500                 MOVE ZERO TO ICT00011-XFER-OUT-UNT-QTY           11320002
145700             ELSE                                                 11340002
145800                 MOVE PV-XFER-OUT-QTY TO ICT00011-XFER-OUT-UNT-QTY11350002
146000             END-IF                                               11370002
146300         WHEN SQLCODE = +100                                      11400002
146400             MOVE ZERO TO ICT00011-XFER-OUT-UNT-QTY               11410002
146600                                                                  11430000
146700         WHEN SQLWARN0 NOT EQUAL SPACE                            11440002
146800         WHEN SQLCODE NOT EQUAL ZERO                              11450002
146900             DISPLAY '**************************************'     11460002
147000             DISPLAY '** ABEND                            **'     11470002
147100             DISPLAY '** PARA 4030 SUM TRANSFERS OUT PROBLEM*'    11480002
147200             DISPLAY '*LOCATION NUMBER  = '                       11490002
147300                              ICRD060-LOC-NBR                     11500000
147400             DISPLAY '*SKU NUMBER       = '                       11510002
147500                              ICRD060-SKU-NBR                     11520000
147600             DISPLAY '**************************************'     11530002
147700             MOVE '4030-PROCESS-TRANS-OUT' TO                     11540002
147800                      PV-PARAGRAPH-NAME                           11550000
147900             MOVE 'ERROR ON SELECT OF TRANS OUT' TO               11560002
148000                      PV-DB2-OPERATION                            11570000
148100             PERFORM 9900-SQL-ABEND                               11580002
148300     END-EVALUATE.                                                11600002
150000                                                                  11610002
150000                                                                  11611002
149500******************************************************************11620000
149700*   PROCESS INFORMATION FOR REVERSE APPROVALS.                   *11640000
149800******************************************************************11650000
149900 4040-PROCESS-REVERSE-APRVLS.                                     11660000
150000                                                                  11670000
150100     PERFORM 2250-SELECT-SKU-FOR-REV.                             11680000
C88463     SET NOT-NULL-ICC-COUNT   TO TRUE                             11690000
199390     PERFORM 5175-PREP-FS-OUTPUT-RECORD.                          11700000
220300                                                                  11710000
C88463*    IF AN RFID COUNT WASN'T ENTERED (SCANNED COUNT IS NULL)      11720000
C88463*    AND COUNT TYPE = 'ICC', DO NOT SEND AN UPDATE TO FASHION.    11730000
C88463*    IF AN RFID COUNT WAS ENTERED (SCANNED COUNT IS NOT NULL)     11740000
C88463*    OR THIS IS A USA COUNT (COUNT TYPE = 'USA') CHECK IF THE     11750000
C88463*    QTY IS BEING ADJUSTED.  A NULL USA COUNT REFLECTS A ZERO     11760000
C88463*    QTY.                                                         11770000
C88463*    CALC ADJ QTY - IF IT'S ZERO, THERE IS NO REASON TO           11780000
C88463*    WRITE TO THE WORK TABLE OR UPDATE FASHION SALES.             11790000
C88463*    (CHANGE IS FOR ICC ONLY - LEAVE USA WORKING LIKE IT WAS).    11800000
C88463     IF NULL-ICC-COUNT                                            11810000
C88463         MOVE ZEROES TO PV-ADJ-QTY                                11820000
C88463     ELSE                                                         11830000
C88463         COMPUTE PV-ADJ-QTY  =                                    11840000
C88463         ((ICRD061-SCANNED-UNT-QTY - ICRD061-START-ONHAND-QTY) +  11850000
C32847          (ICRD061-SALES-QTY - ICRD061-RETURNS-QTY)) * -1         11860000
C88463                                                                  11870000
C88463         IF PV-ADJ-QTY = ZERO AND ICRD060-CNT-TYP-CDE = 'ICC'     11880000
C88463             CONTINUE                                             11890000
C88463         ELSE                                                     11900000
C88463***          ALL USA REVERSALS WILL PASS THROUGH HERE.            11910000
C88463***          ONLY APPROVED ICC (RFID) REVERSALS CAUSING           11920000
C88463***          ADJUSTMENTS WILL PASS THROUGH HERE.                  11930000
199400             PERFORM 5300-WRITE-WORK-TABLE                        11940002
C88463         END-IF                                                   11950000
C88463     END-IF.                                                      11960000
199500                                                                  11970000
150400                                                                  11980000
150500*--------------------------------------------------------------*  11990000
168400*   DETERMINE THE TIMEZONE FOR THE STORE                       *  12010000
168500*--------------------------------------------------------------*  12020000
168600 4500-DETERMINE-TIMEZONE.                                         12030000
168700                                                                  12040000
168800     PERFORM 8500-SELECT-XST-LOC.                                 12050000
168900     MOVE XST00001-STD-TM-ZN-CDE TO                               12060000
168910          ICWS010-TZC-TZ-IN-TM-ZN-CDE.                            12070000
169000     MOVE XST00001-DST-IND       TO ICWS010-TZC-TZ-IND-ST-IND.    12080000
169100     PERFORM 9000-TIMEZONE-CONVERSION.                            12090000
169200     MOVE ICWS010-TZC-LOCATION-TMST TO ICT00020-LAST-UPD-TMST,    12100000
169300                                  ICT00011-LAST-UPD-TMST.         12110000
169302                                                                  12120000
169303                                                                  12130000
196700*--------------------------------------------------------------*  12140000
196900*   WRITE ROW FOR PROCESSED RECORD                             *  12160001
197000*--------------------------------------------------------------*  12170000
197100 5100-WRITE-PROCESSED-REC.                                        12180001
197200                                                                  12190000
197300     MOVE '5100-WRITE-PROCESSED-REC' TO PV-PARAGRAPH-NAME.        12200001
197400                                                                  12210000
198402     INITIALIZE ICRD087-DB-DETAIL-RECORD.                         12220001
198402     SET ICRD087-LOC-STAT           TO TRUE.                      12230001
199131     MOVE ICRD060-LOC-NBR           TO ICRD087-LOC-NBR.           12240001
199140     MOVE ICRD060-CNT-STUP-ID       TO ICRD087-CNT-STUP-ID.       12250001
199150     MOVE ICRD060-CNT-SEQ-NBR       TO ICRD087-CNT-SEQ-NBR.       12260001
199151     MOVE ICT00020-LAST-UPD-TMST    TO ICRD087-LAST-UPD-TMST.     12270001
199240                                                                  12280000
199240     PERFORM 6000-WRITE-OUTPUT.                                   12290001
023429     ADD 1                          TO PV-WRITE-CNT-STAT.         12291002
199240                                                                  12300001
199313                                                                  12310000
199314*--------------------------------------------------------------*  12320000
199316*   DETERMINE IF SKU/AMOUNTS SHOULD BE SENT TO FASHION SALES.  *  12340000
199317*--------------------------------------------------------------*  12350000
199318 5125-FS-CHECK.                                                   12360000
C88463*    DESCRIPTION: CHANGED FOR RFID PROJECT.                       12370000
199319                                                                  12380000
199320     MOVE '5125-FS-CHECK'                                         12390000
199330                     TO PV-PARAGRAPH-NAME.                        12400000
199340                                                                  12410000
199360     PERFORM 4500-DETERMINE-TIMEZONE.                             12430000
199370     MOVE PV-EXEC-TMST TO ICT00011-EXEC-TMST.                     12440000
199380     PERFORM 5150-WRITE-SKU-LOC-CNT.                              12450001
C88463     SET NOT-NULL-ICC-COUNT   TO TRUE                             12460000
199390     PERFORM 5175-PREP-FS-OUTPUT-RECORD.                          12470000
220300                                                                  12480000
C88463*    IF AN RFID COUNT WASN'T ENTERED (SCANNED COUNT IS NULL)      12490000
C88463*    AND COUNT TYPE = 'ICC', DO NOT SEND AN UPDATE TO FASHION.    12500000
C88463*    IF AN RFID COUNT WAS ENTERED (SCANNED COUNT IS NOT NULL)     12510000
C88463*    OR THIS IS A USA COUNT (COUNT TYPE = 'USA') CHECK IF THE     12520000
C88463*    QTY IS BEING ADJUSTED.  A NULL USA COUNT REFLECTS A ZERO     12530000
C88463*    QTY.                                                         12540000
C88463*    CALC ADJ QTY - IF IT'S ZERO, THERE IS NO REASON TO           12550000
C88463*    WRITE TO THE WORK TABLE OR UPDATE FASHION SALES.             12560000
C88463*    IF THE CALC ADJ QTY IS NOT ZERO, CHECK FOR DUPLICATE         12570000
C88463*    COUNTS, REGARDLESS OF COUNT TYPE (USA OR RFID).              12580000
C88463     IF NULL-ICC-COUNT                                            12590000
C88463         MOVE ZEROES TO PV-ADJ-QTY                                12600000
C88463     ELSE                                                         12610000
C88463         COMPUTE PV-ADJ-QTY  =                                    12620000
C88463         (ICRD061-SCANNED-UNT-QTY - ICRD061-START-ONHAND-QTY) +   12630000
C32847         (ICRD061-SALES-QTY - ICRD061-RETURNS-QTY)                12640000
C88463                                                                  12650000
C88463         IF PV-ADJ-QTY = ZERO                                     12660000
C88463            CONTINUE                                              12670000
C88463         ELSE                                                     12680000
C88463             SET NO-DUPLICATE-COUNT TO TRUE                       12690000
C88463             PERFORM 5160-CHECK-FOR-DUP-COUNT                     12700000
C88463             IF DUPLICATE-COUNT                                   12710000
C88463                 MOVE PV-ADJ-QTY TO PV-ADJ-QTY-DISPLAY            12720000
C88463                 DISPLAY 'SKIPPING DUP COUNT.'                    12730000
C88463                  ' STR: ' ICRD061-LOC-NBR                        12740000
C88463                  ' SKU: ' ICRD061-SKU-NBR                        12750000
C88463                  ' QTY: ' PV-ADJ-QTY-DISPLAY                     12760000
C88463                  ' STUP ID: ' ICRD061-CNT-STUP-ID                12770000
C88463                  ' CNT SEQ: ' ICRD061-CNT-SEQ-NBR                12780000
C88463                  ' ALREADY UPDATED BY '                          12790000
C88463                  ' STUP ID: ' ICT00011-CNT-STUP-ID               12800000
C88463                  ' CNT SEQ: ' ICT00011-CNT-SEQ-NBR               12810000
C88463             ELSE                                                 12820000
199400                 PERFORM 5300-WRITE-WORK-TABLE                    12830002
C88463             END-IF                                               12840000
C88463         END-IF                                                   12850000
C88463     END-IF.                                                      12860000
199500                                                                  12870000
220300                                                                  12880000
200600                                                                  12990000
200700*--------------------------------------------------------------*  13000000
200900*   DETERMINE IF SKU/AMOUNTS HAVE CHANGED FOR REVIEW TYPES.    *  13020000
201000*--------------------------------------------------------------*  13030000
201100 5130-REVIEW-CHECK.                                               13040000
201200                                                                  13050000
201300     MOVE '5130-REVIEW-CHECK'                                     13060000
201400                     TO PV-PARAGRAPH-NAME.                        13070000
201500                                                                  13080000
201600     PERFORM 4500-DETERMINE-TIMEZONE.                             13090000
201700     MOVE PV-EXEC-TMST TO ICT00011-EXEC-TMST.                     13100000
201800     PERFORM 5150-WRITE-SKU-LOC-CNT.                              13110001
201900                                                                  13120000
202800                                                                  13210000
202900*--------------------------------------------------------------*  13220000
203100*   WRITE ROW FOR SKU-LOC-CNT                                  *  13240001
203200*--------------------------------------------------------------*  13250000
203300 5150-WRITE-SKU-LOC-CNT.                                          13260001
203400                                                                  13270000
203500     MOVE '5150-WRITE-SKU-LOC-CNT'                                13280001
203600                     TO PV-PARAGRAPH-NAME.                        13290000
205700                                                                  13300000
198402     INITIALIZE ICRD087-DB-DETAIL-RECORD.                         13301001
198402     SET ICRD087-SKU-LOC              TO TRUE.                    13302001
199131     MOVE ICT00011-LOC-NBR            TO ICRD087-LOC-NBR.         13303001
199140     MOVE ICT00011-CNT-STUP-ID        TO ICRD087-CNT-STUP-ID.     13304001
199150     MOVE ICT00011-CNT-SEQ-NBR        TO ICRD087-CNT-SEQ-NBR.     13305001
199151     MOVE ICT00011-LAST-UPD-TMST      TO ICRD087-LAST-UPD-TMST.   13306001
209000     MOVE ICT00011-SKU-NBR            TO ICRD087-SKU-NBR.         13630001
209600     MOVE ICT00011-UNT-RTL-AMT        TO ICRD087-UNT-RTL-AMT.     13690001
209700     MOVE ICT00011-LOC-EXPTED-UNT-QTY TO ICRD087-LOC-EXP-UNT-QTY. 13700002
209800     MOVE ICT00011-IN-TRNST-UNT-QTY   TO ICRD087-IN-TRNST-UNT-QTY.13710002
209900     MOVE ICT00011-ACPTD-TRUK-UNT-QTY TO                          13720002
209900                                      ICRD087-ACPTD-TRUK-UNT-QTY. 13721002
210000     MOVE ICT00011-RTL-SAL-UNT-QTY    TO ICRD087-RTL-SAL-UNT-QTY. 13730002
210100     MOVE ICT00011-RTL-RET-UNT-QTY    TO ICRD087-RTL-RET-UNT-QTY. 13740002
210200     MOVE ICT00011-XFER-IN-UNT-QTY    TO ICRD087-XFER-IN-UNT-QTY. 13750002
210300     MOVE ICT00011-XFER-OUT-UNT-QTY   TO ICRD087-XFER-OUT-UNT-QTY.13760002
210400     IF PV-SCND-UPC-NBR-NULL-IND = PC-NULL-VALUE                  13770008
210400         MOVE 'Y'                     TO ICRD087-SCND-UPC-NBR-NULL13771008
210400         MOVE 0                       TO ICRD087-SCND-UPC-NBR     13772008
210400     ELSE                                                         13773008
210600         MOVE ICT00011-SCND-UPC-NBR   TO ICRD087-SCND-UPC-NBR     13773108
210400     END-IF.                                                      13773208
210400     IF PV-SCND-UNT-QTY-NULL-IND = PC-NULL-VALUE                  13774008
210400         MOVE 'Y'                     TO ICRD087-SCND-UNT-QTY-NULL13775008
210400         MOVE 0                       TO ICRD087-SCND-UNT-QTY     13776008
210400     ELSE                                                         13776108
210600         MOVE ICT00011-SCND-UNT-QTY   TO ICRD087-SCND-UNT-QTY     13776208
210400     END-IF.                                                      13777008
210400     IF PV-CNT-GP-CDE-NULL-IND   = PC-NULL-VALUE                  13778008
210400         MOVE 'Y'                     TO ICRD087-CNT-GP-CDE-NULL  13779008
210400         MOVE 0                       TO ICRD087-CNT-GP-CDE       13780008
210400     ELSE                                                         13781008
210600         MOVE ICT00011-CNT-GP-CDE     TO ICRD087-CNT-GP-CDE       13782008
210400     END-IF.                                                      13783008
210700     MOVE ICT00011-EXEC-TMST          TO ICRD087-EXEC-TMST.       13800002
210400     IF PV-MDSE-EXPRN-DTE-NULL-IND = PC-NULL-VALUE                13801008
210400         MOVE 'Y'                 TO ICRD087-MDSE-EXPRN-DTE-NULL  13802008
210400         MOVE 0                       TO ICRD087-MDSE-EXPRN-DTE   13803008
210400     ELSE                                                         13804008
210600         MOVE ICT00011-MDSE-EXPRN-DTE TO ICRD087-MDSE-EXPRN-DTE   13805008
210400     END-IF.                                                      13806008
210900                                                                  13810102
199240     PERFORM 6000-WRITE-OUTPUT.                                   13811001
023430     ADD 1                            TO PV-WRITE-CNT-SKU.        13812002
210900                                                                  13820000
217000                                                                  14430000
C88463*--------------------------------------------------------------*  14450000
C88463*   CHECK IF A COUNT FOR THE SAME STORE, SKU AND DATE HAS      *  14470000
C88463*   BEEN ENTERED.  IF IT HAS THEN THE COUNT BEING PROCESSED    *  14480000
C88463*   SHOULD NOT BE PASSED TO FASHION SALES.                     *  14490000
C88463*--------------------------------------------------------------*  14500000
C88463 5160-CHECK-FOR-DUP-COUNT.                                        14510000
C88463     MOVE '5160-CHECK-FOR-DUP-COUNT'                              14520000
C88463                     TO PV-PARAGRAPH-NAME.                        14530000
C88463* THIS GETS COMPLETED COUNTS FOR SAME DATE, STORE, SKU            14600000
C88463* IF A ROW IS FOUND, THIS IS A DUPLICATE COUNT                    14610000
C88463     EXEC SQL                                                     14620002
C88463                                                                  14630000
C88463           SELECT C.CNT_STUP_ID                                   14640000
C88463                , C.CNT_SEQ_NBR                                   14650000
C88463             INTO :ICT00011-CNT-STUP-ID                           14660000
C88463                , :ICT00011-CNT-SEQ-NBR                           14670000
C88463             FROM ICT_LOC_CNT_STAT A                              14680000
C88463                , ICT_SKU_LOC_CNT  C                              14690000
C88463            WHERE C.LOC_NBR             = :ICRD061-LOC-NBR        14700000
C88463              AND C.SKU_NBR             = :ICRD061-SKU-NBR        14710000
C88463              AND A.CNT_STAT_CDE        = 'COM'                   14720000
C88463              AND A.LOC_NBR             = C.LOC_NBR               14730000
C88463              AND A.CNT_STUP_ID         = C.CNT_STUP_ID           14740000
C88463              AND A.CNT_SEQ_NBR         = C.CNT_SEQ_NBR           14750000
C88463              AND (C.CNT_STUP_ID       <> :ICRD061-CNT-STUP-ID    14760000
C88463               OR  C.CNT_SEQ_NBR       <> :ICRD061-CNT-SEQ-NBR)   14770000
C88463              AND DATE(C.EXEC_TMST)     = :ICRD060-EXEC-DATE      14780000
C88463              AND  EXISTS                                         14790000
C88463                  (SELECT 1                                       14800000
C88463                     FROM ICT_LOC_CNT_STAT  I                     14810000
C88463                    WHERE I.CNT_STUP_ID  = A.CNT_STUP_ID          14820000
C88463                      AND I.CNT_SEQ_NBR  = A.CNT_SEQ_NBR          14830000
C88463                      AND I.LOC_NBR      = A.LOC_NBR              14840000
C88463                      AND I.CNT_STAT_CDE = 'PRC')                 14850000
C88463           FETCH FIRST 1 ROW ONLY                                 14860000
C88463             WITH UR                                              14870000
C88463                                                                  14880000
C88463     END-EXEC.                                                    14890002
C88463                                                                  14900000
C88463*-- CNT_STUP_ID AND CNT_SEQ_NBR <> CHECKS EXCLUDE COUNT           14910000
C88463*-- BEING PROCESSED                                               14920000
C88463*-- EXISTS GETS COMPLETED COUNTS FOR THE SAME DATE, STORE, SKU    14930000
C88463                                                                  14940000
C88463     MOVE SQLCODE TO PV-SQL-SUB.                                  14950002
C88463     EVALUATE TRUE                                                14960002
C88463           WHEN SQLCODE = ZERO                                    14970000
C88463               SET DUPLICATE-COUNT TO TRUE                        14980000
C88463           WHEN SQLCODE = +100                                    14990000
C88463               SET NO-DUPLICATE-COUNT TO TRUE                     15000000
C88463           WHEN SQLCODE = -904                                    15010000
C88463           WHEN SQLCODE = -911                                    15020000
C88463           WHEN SQLCODE = -913                                    15030000
C88463               CONTINUE                                           15040000
C88463           WHEN OTHER                                             15050000
C88463                DISPLAY '*ABENDING ON BAD SQL-'                   15060000
C88463                   '* SELECT KEY-',                               15070000
C88463                    ICRD061-LOC-NBR                               15080000
C88463                    ICRD061-SKU-NBR                               15090000
C88463                   ' SQL CODE -', PV-SQL-SUB, '**'                15100000
C88463                MOVE '5160-CHECK-FOR-DUP-COUNT'                   15110000
C88463                    TO PV-PARAGRAPH-NAME                          15120000
C88463               MOVE 'ERROR WHEN CHECKING FOR DUP COUNTS '         15130000
C88463                    TO PV-DB2-OPERATION                           15140000
C88463               PERFORM 9900-SQL-ABEND                             15150000
C88463     END-EVALUATE.                                                15160002
C88463                                                                  15320000
C88463                                                                  15330000
217190*--------------------------------------------------------------*  15340000
217300*   PREP OUTPUT RECORD FOR FASHION SALES                       *  15360000
217400*--------------------------------------------------------------*  15370000
217500 5175-PREP-FS-OUTPUT-RECORD.                                      15380000
217600                                                                  15390000
217700     INITIALIZE ICRD061-UPDATED-COUNTS-RECORD.                    15400000
217800                                                                  15410000
217900     MOVE ICRD060-CNT-STAT-CDE TO                                 15420000
218000                               ICRD061-CNT-STAT-CDE.              15430000
218100     MOVE ICRD060-LOC-NBR      TO                                 15440000
218200                               ICRD061-LOC-NBR.                   15450000
218300     MOVE ICRD060-CNT-STUP-ID  TO                                 15460000
218400                               ICRD061-CNT-STUP-ID.               15470000
218500     MOVE ICRD060-CNT-SEQ-NBR  TO                                 15480000
218600                               ICRD061-CNT-SEQ-NBR.               15490000
218700     MOVE ICT00011-LAST-UPD-TMST TO                               15500000
218800                               ICRD061-LAST-UPD-TMST.             15510000
218900     MOVE ICRD060-SKU-NBR      TO                                 15520000
219000                               ICRD061-SKU-NBR.                   15530000
219100     MOVE ICT00011-RTL-SAL-UNT-QTY TO                             15540000
219200                               ICRD061-SALES-QTY.                 15550000
C32847     MOVE ICT00011-RTL-RET-UNT-QTY TO                             15560000
C32847                               ICRD061-RETURNS-QTY.               15570000
219500     MOVE ICT00011-XFER-IN-UNT-QTY TO                             15580000
219600                               ICRD061-TRANS-IN-QTY.              15590000
219700     MOVE ICT00011-XFER-OUT-UNT-QTY TO                            15600000
219800                               ICRD061-TRANS-OUT-QTY.             15610000
219801     IF  PV-SCND-UNT-QTY-NULL-IND = PC-NULL-VALUE                 15620000
219810         MOVE +0 TO            ICRD061-SCANNED-UNT-QTY            15630000
C88463         IF ICRD060-CNT-TYP-CDE = 'ICC'                           15640000
C88463             SET NULL-ICC-COUNT TO TRUE                           15650000
C88463         END-IF                                                   15660000
219820     ELSE                                                         15670000
219900         MOVE ICT00011-SCND-UNT-QTY TO                            15680000
220000                               ICRD061-SCANNED-UNT-QTY.           15690000
220100     MOVE ICT00011-LOC-EXPTED-UNT-QTY TO                          15700000
220200                               ICRD061-START-ONHAND-QTY.          15710000
111890     MOVE ICRD060-CNT-TYP-CDE TO                                  15720000
111890                               ICRD061-CNT-TYP-CDE.               15730000
220600                                                                  15760000
220700*--------------------------------------------------------------*  15770000
220900*   WRITE OUTPUT RECORDS FOR IC WORK TABLE                     *  15790002
221000*--------------------------------------------------------------*  15800000
221100 5300-WRITE-WORK-TABLE.                                           15810002
221200                                                                  15820000
198402     INITIALIZE ICRD087-DB-DETAIL-RECORD.                         15821002
198402     SET ICRD087-CNT-ODR              TO TRUE.                    15822002
000500     MOVE ICRD061-UPDATED-COUNTS-RECORD                           15822405
000500                                      TO ICRD087-UPD-CNT-ODR.     15822505
210900                                                                  15830302
199240     PERFORM 6000-WRITE-OUTPUT.                                   15830402
023430     ADD 1                            TO PV-WRITE-CNT-ODR.        15830504
023430                                                                  16240002
225500                                                                  16250001
220700*--------------------------------------------------------------*  16251001
220900*   WRITE OUTPUT RECORD                                        *  16253001
221000*--------------------------------------------------------------*  16254001
221100 6000-WRITE-OUTPUT.                                               16255006
221200                                                                  16257001
059900     ADD +1 TO PV-OUTPUT-CNT.                                     16257101
059900     MOVE PV-OUTPUT-CNT         TO ICRD087-RECORD-COUNT.          16257201
059800     WRITE ICRD087-OUTPUT-REC   FROM ICRD087-DB-INSERT-RECORD.    16257301
221200                                                                  16258001
221200                                                                  16259001
254000*----------------------------------------------------------       16260000
254100*  SELECT FROM XST_LOC TO GET A STORE TIMEZONE.                   16270000
254200*----------------------------------------------------------       16280000
254300 8500-SELECT-XST-LOC.                                             16290000
254400     MOVE '8400-XST-LOC' TO  PV-PARAGRAPH-NAME.                   16300000
254500                                                                  16310000
254600     EXEC SQL                                                     16320000
254700       SELECT                                                     16330000
254800            STD_TM_ZN_CDE                                         16340000
254900           ,DST_IND                                               16350000
255000         INTO                                                     16360000
255100            :XST00001-STD-TM-ZN-CDE                               16370000
255200           ,:XST00001-DST-IND                                     16380000
255300         FROM  XST_LOC                                            16390000
255400        WHERE  LOC_NBR   = :ICRD060-LOC-NBR                       16400000
255700     END-EXEC.                                                    16410000
255800                                                                  16420000
255900     EVALUATE TRUE                                                16430000
256000        WHEN SQLCODE = 0                                          16440000
256100            CONTINUE                                              16450000
256200        WHEN OTHER                                                16460000
256300         DISPLAY '** ICKUT087 SELECT XST_LOC'                     16470009
256400                 ' HAD SQLCODE OF ' SQLCODE                       16480000
256500         PERFORM 9900-SQL-ABEND                                   16490000
256600     END-EVALUATE.                                                16500000
256700                                                                  16510000
256700                                                                  16511002
256800******************************************************************16520000
256900     COPY ICPD010.                                                16530000
257000******************************************************************16540000
257100                                                                  16550000
258533*--------------------------------------------------------------*  16560000
258535*     SQL ABEND ROUTINE.                                          16580000
258536*--------------------------------------------------------------*  16590000
258537 9900-SQL-ABEND.                                                  16600000
258538                                                                  16610000
258539     DISPLAY '** ABEND     **'.                                   16620000
258540     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                16630000
258541     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              16640000
258542     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               16650000
258543                                                                  16660000
258544     COPY DPPD004.                                                16670000
258545     SET ABEND-4013-DB2-ERROR TO TRUE.                            16680000
258546     CALL 'ILBOABN0' USING ABEND-CODE.                            16690000
258547                                                                  16700000
258549                                                                  16720000
258550*--------------------------------------------------------------*  16730000
258552*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      16750000
258553*     DATA COUNTS FROM THE PROGRAM.                               16760000
258554*--------------------------------------------------------------*  16770000
258555 9999-WRAPUP.                                                     16780000
258556                                                                  16790000
258561     CLOSE ICRD060-COUNTS-FILE                                    16830001
258561           ICRD087-OUTPUT-FILE.                                   16840001
258562                                                                  16850000
258566     DISPLAY '********************************************'.      16860000
258567     DISPLAY '**** SUMMARY OF PROGRAM ICKUT087         ***'.      16870009
258568     DISPLAY '********************************************'.      16880000
258580     DISPLAY 'TOTAL INPUT RECORDS READ    :' PV-INPUT-CNT.        16881010
258569     DISPLAY 'TOTAL LOC CNT STAT RECORDS  :' PV-WRITE-CNT-STAT.   16890004
258570     DISPLAY 'TOTAL SKU LOC CNT  RECORDS  :' PV-WRITE-CNT-SKU.    16900004
258570     DISPLAY 'TOTAL UPD CNT ODR  RECORDS  :' PV-WRITE-CNT-ODR.    16901004
258590     DISPLAY 'TOTAL SKUS SELECTED         :' PV-SELECT-SKU-CNT.   16920000
258603     DISPLAY '*********************************************'.     16940000
258604     DISPLAY '       END OF PROGRAM: ' PC-PROGRAM-NAME.           16950000
258605     DISPLAY '*********************************************'.     16960000
258606     DISPLAY ' '.                                                 16970000
258607                                                                  16980000
258609                                                                  16990000
