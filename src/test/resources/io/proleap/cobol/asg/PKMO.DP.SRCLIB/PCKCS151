000100*-----------------------*                                         00010007
000200 IDENTIFICATION DIVISION.                                         00020007
000300*-----------------------*                                         00030007
000400 PROGRAM-ID.    PCKCS151.                                         00040007
000500 AUTHOR.        BETH BILSKI.                                      00050007
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060007
000700 DATE-WRITTEN.  12-17-93.                                         00070007
000800 DATE-COMPILED.                                                   00080007
000900                                                                  00090007
001000*---------------------------------------------------------------* 00100007
001100*    E151 - WORK ORDER RECEIVER LIST PROGRAM                    * 00110007
001200*                                                               * 00120007
001300*    THIS PROGRAM GENERATES A LIST OF WORK ORDER RECEIVERS      * 00130007
001400*    WHICH MEET THE CRITERIA ENTERED IN E150 - WORK ORDER       * 00140007
001500*    CRITERIA SCREEN.                                           * 00150007
001600*                                                               * 00160007
001700*---------------------------------------------------------------* 00170007
001800* MAINTENANCE:                                                  * 00180007
001900* 6/16/94 - SUMMED PKSL-ITM-QTY FROM TRECITM FOR EXPECTED ITEM  * 00190007
002000*           QTY                                                 * 00200007
002100*           SUMMED VERIFY-ITM-QTY FROM TRECDIS FOR ACTUAL ITEM  * 00210007
002200*           QTY                                                 * 00220007
002300*           B.BILSKI     IR-106                                 * 00230007
002400* 8/09/95 - IF -913, 911, 904, PUT THE MESSAGES TO THE SCREEN   * 00240007
002500*           INSTEAD OF ABENDING THE TRASACTION.                 * 00250007
002600*           H.KIM        913-ABENDING-PROB.                     * 00260007
002700*---------------------------------------------------------------* 00270007
002800* DATE  11/04/2021                                                00280007
002900*            - CHANGE CALL OF 'DPKUT100' TO                     * 00290007
003000*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00300007
003100*              MAKING THE CALL DYNAMIC VS STATIC                * 00310007
003200*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00320007
003300*---------------------------------------------------------------- 00330007
003400* DATE  11/07/2022                                              * 00340007
003500*            - ADD COPYBOOK DPWS930                             * 00350007
003600*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00360007
003700*              DYNAMIC.                                         * 00370007
003800*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00380007
003900*-----------------------------------------------------------------00390007
004000*                                                               * 00400007
004100*---------------------------------------------------------------* 00410007
004200 EJECT                                                            00420007
004300 ENVIRONMENT DIVISION.                                            00430007
004400                                                                  00440007
004500 DATA DIVISION.                                                   00450007
004600                                                                  00460007
004700 WORKING-STORAGE SECTION.                                         00470007
004800 01  DK-DB2-KEYS.                                                 00480007
004900     05  DK-PO-NBR                      PIC S9(09) COMP.          00490007
005000     05  DK-UNT-ID-LOW                  PIC S9(04) COMP.          00500007
005100     05  DK-UNT-ID-HI                   PIC S9(04) COMP.          00510007
005200     05  DK-FCLTY-ID-LOW                PIC S9(04) COMP.          00520007
005300     05  DK-FCLTY-ID-HI                 PIC S9(04) COMP.          00530007
005400     05  DK-REC-SEQ-NBR-LOW             PIC S9(09) COMP.          00540007
005500     05  DK-REC-SEQ-NBR-HI              PIC S9(09) COMP.          00550007
005600     05  DK-LINE-NBR-LOW                PIC S9(04) COMP.          00560007
005700     05  DK-LINE-NBR-HI                 PIC S9(04) COMP.          00570007
005800                                                                  00580007
005900 01  PC-PROGRAM-CONSTANTS.                                        00590007
006000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00600007
006100                                                    'PC151A  '.   00610007
006200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00620007
006300                                                    'PCKM151 '.   00630007
006400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00640007
006500                                                    'PCKCS151'.   00650007
006600     05  PC-DPKCS030                    PIC  X(08)  VALUE         00660007
006700                                                    'DPKCS030'.   00670007
006800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00680007
006900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00690007
007000     05  PC-KEY-QUEUE-SEQ               PIC  9(01)  VALUE 4.      00700007
007100     05  PC-ONE                         PIC S9(04)  COMP VALUE +1.00710007
007200     05  PC-INTER-APPL-CODES.                                     00720007
007300         10 PC-INTER-APPL-PKSL-CRIT     PIC  X(01)  VALUE 'C'.    00730007
007400     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00740007
007500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00750007
007600                                                    COMP SYNC.    00760007
007700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00770007
007800                                                    COMP SYNC.    00780007
007900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00790007
008000                                                    +1000000      00800007
008100                                                    COMP-3.       00810007
008200     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00820007
008300                                                    COMP SYNC.    00830007
008400     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00840007
008500                                                    COMP-3.       00850007
008600     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00860007
008700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00870007
008800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00880007
008900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00890007
009000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00900007
009100     05  PC-I                           PIC  X(01)  VALUE 'I'.    00910007
009200     05  PC-N                           PIC  X(01)  VALUE 'N'.    00920007
009300*                                                                 00930007
009400     05  PC-TSYMSG-NUMBERS.                                       00940007
009500*  THE DATA ENTERED IS NOT A VALID VALUE FOR THE FIELD            00950007
009600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00960007
009700*  MUST BE NUMERIC                                                00970007
009800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00980007
009900*  NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED            00990007
010000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01000007
010100*  NO END OF RANGE WAS SPECIFIED                                  01010007
010200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01020007
010300*  END OF RANGE PRECEDES START OF RANGE                           01030007
010400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01040007
010500*  NO START OF RANGE HAS BEEN SPECIFIED                           01050007
010600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01060007
010700*  ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED             01070007
010800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01080007
010900*  ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED               01090007
011000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01100007
011100*  A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION                 01110007
011200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01120007
011300*  TOP OF LIST                                                    01130007
011400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01140007
011500*  BOTTOM OF LIST                                                 01150007
011600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01160007
011700*  VALUE MUST BE GREATER THAN ZERO AND LESS THAN 1,000,000        01170007
011800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01180007
011900*  MORE ITEMS TO DISPLAY                                          01190007
012000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01200007
012100*  MORE ITEMS TO DISPLAY                                          01210007
012200         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01220007
012300*  INVALID COMMAND WAS ENTERED                                    01230007
012400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01240007
012500*                                                                 01250007
012600 01  PS-PROGRAM-SWITCHES.                                         01260007
012700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01270007
012800         88  PS-NO-ERROR                            VALUE 'Y'.    01280007
012900         88  PS-ERROR                               VALUE 'N'.    01290007
013000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01300007
013100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01310007
013200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01320007
013300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01330007
013400         88  PS-DONE                                VALUE 'Y'.    01340007
013500         88  PS-NOT-DONE                            VALUE 'N'.    01350007
013600*                                                                 01360007
013700 01  PV-PROGRAM-VARIABLES.                                        01370007
013800     05  PV-KEY-FEEDBACK-AREA           PIC X(11)   VALUE SPACES. 01380007
013900     05  PV-SUB                         PIC S9(04)  VALUE +0      01390007
014000                                                    COMP SYNC.    01400007
014100     05  PV-PKSL-ITM-QTY                PIC S9(05)  VALUE +0      01410007
014200                                                    COMP.         01420007
014300     05  PV-AP-VERIFY-ITM-QTY           PIC S9(05)  VALUE +0      01430007
014400                                                    COMP.         01440007
014500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01450007
014600                                                    COMP SYNC.    01460007
014700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01470007
014800                                                    COMP-3.       01480007
014900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01490007
015000                                                    COMP-3.       01500007
015100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01510007
015200                                                    COMP-3.       01520007
015300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01530007
015400                                                    COMP-3.       01540007
015500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01550007
015600                                                    COMP-3.       01560007
015700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01570007
015800                                                    COMP-3.       01580007
015900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01590007
016000                                                    COMP-3.       01600007
016100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01610007
016200                                                    COMP SYNC.    01620007
016300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01630007
016400                                                    COMP SYNC.    01640007
016500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01650007
016600                                                    COMP SYNC.    01660007
016700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01670007
016800                                                    COMP SYNC.    01680007
016900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01690007
017000                                                    COMP SYNC.    01700007
017100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01710007
017200                                                    COMP SYNC.    01720007
017300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01730007
017400                                                    COMP SYNC.    01740007
017500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01750007
017600                                                    COMP SYNC.    01760007
017700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01770007
017800                                                    COMP SYNC.    01780007
017900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01790007
018000                                                    COMP SYNC.    01800007
018100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01810007
018200                                                    COMP SYNC.    01820007
018300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01830007
018400                                                    COMP SYNC.    01840007
018500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01850007
018600                                                    COMP SYNC.    01860007
018700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01870007
018800                                                    COMP SYNC.    01880007
018900     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01890007
019000                                                    COMP SYNC.    01900007
019100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01910007
019200                                                    COMP SYNC.    01920007
019300     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01930007
019400                                                    COMP-3.       01940007
019500     05  PV-CRE-TMST.                                             01950007
019600         10  FILLER                     PIC X(02).                01960007
019700         10  PV-CRE-YY                  PIC X(02).                01970007
019800         10  FILLER                     PIC X(01).                01980007
019900         10  PV-CRE-MM                  PIC X(02).                01990007
020000         10  FILLER                     PIC X(01).                02000007
020100         10  PV-CRE-DD                  PIC X(02).                02010007
020200         10  FILLER                     PIC X(16).                02020007
020300     05  PV-CREATE-DATE.                                          02030007
020400         10  PV-CREATE-MM               PIC X(02).                02040007
020500         10  FILLER                     PIC X(01) VALUE '/'.      02050007
020600         10  PV-CREATE-DD               PIC X(02).                02060007
020700         10  FILLER                     PIC X(01) VALUE '/'.      02070007
020800         10  PV-CREATE-YY               PIC X(02).                02080007
020900******************************************************************02090007
021000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02100007
021100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02110007
021200**  APPLICATION-SPECIFIC COMMAREA.                              **02120007
021300******************************************************************02130007
021400 01  LQW-LIST-QUEUE-WORK-AREA.                                    02140007
021500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02150007
021600     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           02160007
021700                                        INDEXED BY LQW-IDX.       02170007
021800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02180007
021900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02190007
022000         10  LQW-SELECTED-SW            PIC  X(01).               02200007
022100             88  LQW-SELECT                         VALUE 'S'.    02210007
022200             88  LQW-DESELECT                       VALUE ' '.    02220007
022300         10  LQW-OPR-ID                 PIC  ZZZZ.                02230007
022400         10  LQW-FACT                   PIC  ZZZ.                 02240007
022500         10  LQW-PO-NBR                 PIC  ZZZZZZZ9.            02250007
022600         10  LQW-REC-SEQ-NBR            PIC  9(03).               02260007
022700         10  LQW-CRE-DTE                PIC  X(08).               02270007
022800         10  LQW-CRE-UID                PIC  X(08).               02280007
022900         10  LQW-STATUS-CDE             PIC  X(03).               02290007
023000         10  LQW-EXPTED-CART-CNT        PIC  ZZZZ9.               02300007
023100         10  LQW-ACTL-CART-CNT          PIC  ZZZZ9.               02310007
023200         10  LQW-EXPTED-ITM-QTY         PIC  ZZZZ9.               02320007
023300         10  LQW-ACTL-ITM-QTY           PIC  ZZZZ9.               02330007
023400         10  LQW-TRBL-SW                PIC  X(01).               02340007
023500                                                                  02350007
023600                                                                  02360007
023700     EJECT                                                        02370007
023800*---------------------------------------------------------------* 02380007
023900*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 02390007
024000*---------------------------------------------------------------* 02400007
024100     COPY PCWS016.                                                02410007
024200     EJECT                                                        02420007
024300*---------------------------------------------------------------* 02430007
024400*    MAP LAYOUT                                                 * 02440007
024500*---------------------------------------------------------------* 02450007
024600                                                                  02460007
024700     COPY PCKM151.                                                02470007
024800*                                                                 02480007
024900 01  MR-OCCURS-LAYOUT                   REDEFINES  PC151AO.       02490007
025000     05  FILLER                         PIC X(60).                02500007
025100     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          02510007
025200         10  MR-SELECTL                 PIC S9(04) COMP.          02520007
025300         10  MR-SELECTA                 PIC  X(01).               02530007
025400         10  MR-SELECTC                 PIC  X(01).               02540007
025500         10  MR-SELECTH                 PIC  X(01).               02550007
025600         10  MR-SELECTI                 PIC  X(01).               02560007
025700                                                                  02570007
025800         10  MR-OPRIDL                  PIC S9(04) COMP.          02580007
025900         10  MR-OPRIDA                  PIC  X(01).               02590007
026000         10  MR-OPRIDC                  PIC  X(01).               02600007
026100         10  MR-OPRIDH                  PIC  X(01).               02610007
026200         10  MR-OPRID.                                            02620007
026300             15  MR-OPRID-N             PIC  ZZZZ.                02630007
026400                                                                  02640007
026500         10  MR-FACTL                   PIC S9(04) COMP.          02650007
026600         10  MR-FACTA                   PIC  X(01).               02660007
026700         10  MR-FACTC                   PIC  X(01).               02670007
026800         10  MR-FACTH                   PIC  X(01).               02680007
026900         10  MR-FACT.                                             02690007
027000             15  MR-FACT-N              PIC  ZZZ.                 02700007
027100                                                                  02710007
027200         10  MR-PONBRL                  PIC S9(04) COMP.          02720007
027300         10  MR-PONBRA                  PIC  X(01).               02730007
027400         10  MR-PONBRC                  PIC  X(01).               02740007
027500         10  MR-PONBRH                  PIC  X(01).               02750007
027600         10  MR-PONBR.                                            02760007
027700             15  MR-PONBR-N             PIC  ZZZZZZZ9.            02770007
027800                                                                  02780007
027900         10  MR-RSEQL                   PIC S9(04) COMP.          02790007
028000         10  MR-RSEQA                   PIC  X(01).               02800007
028100         10  MR-RSEQC                   PIC  X(01).               02810007
028200         10  MR-RSEQH                   PIC  X(01).               02820007
028300         10  MR-RSEQ                    PIC  X(03).               02830007
028400                                                                  02840007
028500         10  MR-STATUSL                 PIC S9(04) COMP.          02850007
028600         10  MR-STATUSA                 PIC  X(01).               02860007
028700         10  MR-STATUSC                 PIC  X(01).               02870007
028800         10  MR-STATUSH                 PIC  X(01).               02880007
028900         10  MR-STATUS                  PIC  X(02).               02890007
029000                                                                  02900007
029100         10  MR-EXP-CTN-QTYL            PIC S9(04) COMP.          02910007
029200         10  MR-EXP-CTN-QTYA            PIC  X(01).               02920007
029300         10  MR-EXP-CTN-QTYC            PIC  X(01).               02930007
029400         10  MR-EXP-CTN-QTYH            PIC  X(01).               02940007
029500         10  MR-EXP-CTN-QTY.                                      02950007
029600             15  MR-EXP-CTN-QTY-N       PIC  ZZZZ9.               02960007
029700                                                                  02970007
029800         10  MR-ACT-CTN-QTYL            PIC S9(04) COMP.          02980007
029900         10  MR-ACT-CTN-QTYA            PIC  X(01).               02990007
030000         10  MR-ACT-CTN-QTYC            PIC  X(01).               03000007
030100         10  MR-ACT-CTN-QTYH            PIC  X(01).               03010007
030200         10  MR-ACT-CTN-QTY.                                      03020007
030300             15  MR-ACT-CTN-QTY-N       PIC  ZZZZ9.               03030007
030400                                                                  03040007
030500         10  MR-EXP-ITM-QTYL            PIC S9(04) COMP.          03050007
030600         10  MR-EXP-ITM-QTYA            PIC  X(01).               03060007
030700         10  MR-EXP-ITM-QTYC            PIC  X(01).               03070007
030800         10  MR-EXP-ITM-QTYH            PIC  X(01).               03080007
030900         10  MR-EXP-ITM-QTY.                                      03090007
031000             15  MR-EXP-ITM-QTY-N       PIC  ZZZZ9.               03100007
031100                                                                  03110007
031200         10  MR-ACT-ITM-QTYL            PIC S9(04) COMP.          03120007
031300         10  MR-ACT-ITM-QTYA            PIC  X(01).               03130007
031400         10  MR-ACT-ITM-QTYC            PIC  X(01).               03140007
031500         10  MR-ACT-ITM-QTYH            PIC  X(01).               03150007
031600         10  MR-ACT-ITM-QTY.                                      03160007
031700             15  MR-ACT-ITM-QTY-N       PIC  ZZZZ9.               03170007
031800                                                                  03180007
031900         10  MR-CREATE-DATEL            PIC S9(04) COMP.          03190007
032000         10  MR-CREATE-DATEA            PIC  X(01).               03200007
032100         10  MR-CREATE-DATEC            PIC  X(01).               03210007
032200         10  MR-CREATE-DATE-H           PIC  X(01).               03220007
032300         10  MR-CREATE-DATE             PIC  X(08).               03230007
032400                                                                  03240007
032500         10  MR-USER-IDL                PIC S9(04) COMP.          03250007
032600         10  MR-USER-IDA                PIC  X(01).               03260007
032700         10  MR-USER-IDC                PIC  X(01).               03270007
032800         10  MR-USER-IDH                PIC  X(01).               03280007
032900         10  MR-USER-ID                 PIC  X(08).               03290007
033000     EJECT                                                        03300007
033100*---------------------------------------------------------------* 03310007
033200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03320007
033300*---------------------------------------------------------------* 03330007
033400                                                                  03340007
033500     COPY DPWS015.                                                03350007
033600                                                                  03360007
033700*---------------------------------------------------------------* 03370007
033800*    FUNCTION KEYS COPYBOOK.                                    * 03380007
033900*---------------------------------------------------------------* 03390007
034000                                                                  03400007
034100     COPY DPWS016.                                                03410007
034200                                                                  03420007
034300*---------------------------------------------------------------* 03430007
034400*    NUMERIC EDIT LAYOUT.                                       * 03440007
034500*---------------------------------------------------------------* 03450007
034600                                                                  03460007
034700     COPY DPWS010I.                                               03470007
034800 EJECT                                                            03480007
034900*---------------------------------------------------------------* 03490007
035000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 03500007
035100*---------------------------------------------------------------* 03510007
035200                                                                  03520007
035300     COPY DPWS030.                                                03530007
035400     COPY DPWS930.                                                03540007
035500 EJECT                                                            03550007
035600*---------------------------------------------------------------* 03560007
035700*    STANDARD COMMAREA.                                         * 03570007
035800*---------------------------------------------------------------* 03580007
035900                                                                  03590007
036000     COPY DPWS020.                                                03600007
036100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03610007
036200                                                                  03620007
036300*----------------------------------------------------------------*03630007
036400* INTER-APPLICATION COMMAREA.                                    *03640007
036500* RCWS012 - INTER APPLICATION COMMAREA FROM THE PACK SLIP UPDATE *03650007
036600*----------------------------------------------------------------*03660007
036700                                                                  03670007
036800         10  INTER-APPL-COMM-AREA       PIC X(200).               03680007
036900     COPY PCWS000.                                                03690007
037000     COPY RCWS012.                                                03700007
037100*---------------------------------------------------------------* 03710007
037200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03720007
037300*---------------------------------------------------------------* 03730007
037400         10  ASC-SPECIFIC-COMMAREA.                               03740007
037500             15  ASC-LIST-KEYS.                                   03750007
037600                 20  ASC-KEY-OPR-ID                  PIC ZZZ9.    03760007
037700                 20  ASC-KEY-FACT                    PIC ZZZ9.    03770007
037800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03780007
037900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03790007
038000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03800007
038100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03810007
038200                                                                  03820007
038300                 20  ASC-ITEM-ARRAY.                              03830007
038400                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03840007
038500                         30  ASC-LIST-ITEM-NUMBER                 03850007
038600                                                     PIC S9(09)   03860007
038700                                                     COMP-3.      03870007
038800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03880007
038900                             88  ASC-VALID-SELECT    VALUE ' '    03890007
039000                                                           'S'    03900007
039100                                                           'B'    03910007
039200                                                           'E'.   03920007
039300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03930007
039400                             88  ASC-TEMP-SELECT     VALUE 'S'.   03940007
039500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03950007
039600                             88  ASC-TEMP-END        VALUE 'E'.   03960007
039700                         30  ASC-SELECTED-SW         PIC  X(01).  03970007
039800                             88  ASC-NO-SELECT       VALUE ' '.   03980007
039900                             88  ASC-SELECT          VALUE 'S'.   03990007
040000                             88  ASC-BEGIN           VALUE 'B'.   04000007
040100                             88  ASC-END             VALUE 'E'.   04010007
040200                         30  ASC-OPR-ID              PIC  ZZZZ.   04020007
040300                         30  ASC-FACT                PIC  ZZZ.    04030007
040400                         30  ASC-PO-NBR            PIC  ZZZZZZZ9. 04040007
040500                         30  ASC-REC-SEQ-NBR         PIC  9(03).  04050007
040600                         30  ASC-CRE-DTE             PIC  X(08).  04060007
040700                         30  ASC-CRE-UID             PIC  X(08).  04070007
040800                         30  ASC-STATUS-CDE          PIC  X(03).  04080007
040900                         30  ASC-EXPTED-CART-CNT     PIC  ZZZZ9.  04090007
041000                         30  ASC-ACTL-CART-CNT       PIC  ZZZZ9.  04100007
041100                         30  ASC-EXPTED-ITM-QTY      PIC  ZZZZ9.  04110007
041200                         30  ASC-ACTL-ITM-QTY        PIC  ZZZZ9.  04120007
041300                         30  ASC-RCVR-TRBL-SW        PIC  X(01).  04130007
041400                             88  ASC-TRBL            VALUE 'Y'.   04140007
041500                                                                  04150007
041600             15  ASC-BLK-SUB                         PIC S9(04)   04160007
041700                                                          COMP    04170007
041800                                                          SYNC.   04180007
041900             15  ASC-ITEM-SUB                        PIC S9(04)   04190007
042000                                                          COMP    04200007
042100                                                          SYNC.   04210007
042200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04220007
042300                                                          COMP-3. 04230007
042400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04240007
042500                                                          COMP-3. 04250007
042600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04260007
042700                                                          COMP-3. 04270007
042800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04280007
042900                                                          COMP-3. 04290007
043000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04300007
043100                                                          COMP-3. 04310007
043200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04320007
043300                                                          COMP    04330007
043400                                                          SYNC.   04340007
043500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04350007
043600                                                          COMP-3. 04360007
043700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04370007
043800                                                          COMP-3. 04380007
043900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04390007
044000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04400007
044100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04410007
044200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04420007
044300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04430007
044400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04440007
044500             15  ASC-LIST-QUEUE-NAME.                             04450007
044600                 20  ASC-LIST-TERM-ID                PIC  X(04).  04460007
044700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04470007
044800                                                          COMP-3. 04480007
044900                 20  ASC-LIST-SEQ                    PIC  9(01).  04490007
045000             15  ASC-SEL-QUEUE-NAME.                              04500007
045100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04510007
045200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04520007
045300                                                          COMP-3. 04530007
045400                 20  ASC-SEL-SEQ                     PIC  9(01).  04540007
045500             15  ASC-KEY-QUEUE-NAME.                              04550007
045600                 20  ASC-KEY-TERM-ID                 PIC  X(04).  04560007
045700                 20  ASC-KEY-TASK-NUMBER             PIC S9(05)   04570007
045800                                                          COMP-3. 04580007
045900                 20  ASC-KEY-SEQ                     PIC  9(01).  04590007
046000                                                                  04600007
046100             15  ASC-START-ITEM-REQUEST.                          04610007
046200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04620007
046300     EJECT                                                        04630007
046400*---------------------------------------------------------------* 04640007
046500*    ABEND PROCESSING COPYBOOK.                                 * 04650007
046600*---------------------------------------------------------------* 04660007
046700                                                                  04670007
046800     COPY DPWS013.                                                04680007
046900                                                                  04690007
047000 EJECT                                                            04700007
047100*---------------------------------------------------------------* 04710007
047200*    DB2 AREA FOR TRECEIV                                       * 04720007
047300*---------------------------------------------------------------* 04730007
047400     EXEC SQL                                                     04740007
047500          INCLUDE TRECEIV                                         04750007
047600     END-EXEC.                                                    04760007
047700 EJECT                                                            04770007
047800*---------------------------------------------------------------* 04780007
047900*    DB2 AREA FOR TRECITM                                       * 04790007
048000*---------------------------------------------------------------* 04800007
048100     EXEC SQL                                                     04810007
048200          INCLUDE TRECITM                                         04820007
048300     END-EXEC.                                                    04830007
048400 EJECT                                                            04840007
048500*---------------------------------------------------------------* 04850007
048600*    DB2 AREA FOR TRECDIS                                       * 04860007
048700*---------------------------------------------------------------* 04870007
048800     EXEC SQL                                                     04880007
048900          INCLUDE TRECDIS                                         04890007
049000     END-EXEC.                                                    04900007
049100 EJECT                                                            04910007
049200/                                                                 04920007
049300*----------------------------------------------------------------*04930007
049400*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                04940007
049500*----------------------------------------------------------------*04950007
049600     EXEC SQL                                                     04960007
049700          INCLUDE TTRBNTF                                         04970007
049800     END-EXEC.                                                    04980007
049900                                                                  04990007
050000*---------------------------------------------------------------* 05000007
050100*    DB2 AREA FOR COMMUNICATIONS                                * 05010007
050200*---------------------------------------------------------------* 05020007
050300     EXEC SQL                                                     05030007
050400          INCLUDE SQLCA                                           05040007
050500     END-EXEC.                                                    05050007
050600                                                                  05060007
050700*---------------------------------------------------------------* 05070007
050800*    TRECEIV CURSOR                                             * 05080007
050900*---------------------------------------------------------------* 05090007
051000                                                                  05100007
051100     EXEC SQL                                                     05110007
051200          DECLARE TRECEIV_CURSOR CURSOR FOR                       05120007
051300              SELECT                                              05130007
051400                ORD_NBR                                           05140007
051500               ,REC_SEQ_NBR                                       05150007
051600               ,OPER_UNT_ID                                       05160007
051700               ,FCLTY_ID                                          05170007
051800               ,CRE_TMST                                          05180007
051900               ,CRE_UID                                           05190007
052000               ,STATUS_CDE                                        05200007
052100               ,EXPTED_CART_CNT                                   05210007
052200               ,ACTL_CART_CNT                                     05220007
052300               ,EXPTED_ITM_QTY                                    05230007
052400               ,ACTL_ITM_QTY                                      05240007
052500          FROM  TRECEIV                                           05250007
052600         WHERE ORD_NBR           = :DK-PO-NBR                     05260007
052700           AND OPER_UNT_ID BETWEEN :DK-UNT-ID-LOW                 05270007
052800                               AND :DK-UNT-ID-HI                  05280007
052900           AND FCLTY_ID    BETWEEN :DK-FCLTY-ID-LOW               05290007
053000                               AND :DK-FCLTY-ID-HI                05300007
053100           AND REC_SEQ_NBR BETWEEN :DK-REC-SEQ-NBR-LOW            05310007
053200                               AND :DK-REC-SEQ-NBR-HI             05320007
053300           AND VER_STATUS_CDE = 'A'                               05330007
053400          ORDER BY                                                05340007
053500                REC_SEQ_NBR                                       05350007
053600               ,STATUS_CDE                                        05360007
053700     END-EXEC.                                                    05370007
053800                                                                  05380007
053900 EJECT                                                            05390007
054000 LINKAGE SECTION.                                                 05400007
054100                                                                  05410007
054200 01  DFHCOMMAREA.                                                 05420007
054300     05  FILLER                         OCCURS  1 TO 4072 TIMES   05430007
054400                                        DEPENDING ON EIBCALEN.    05440007
054500         10  FILLER                     PIC X.                    05450007
054600                                                                  05460007
054700 EJECT                                                            05470007
054800 PROCEDURE DIVISION.                                              05480007
054900******************************************************************05490007
055000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05500007
055100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05510007
055200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05520007
055300******************************************************************05530007
055400 0000-MAIN-MODULE.                                                05540007
055500     INITIALIZE DP030-CICS-API-FIELDS.                            05550007
055600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05560007
055700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05570007
055800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05580007
055900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05590007
056000     MOVE LENGTH OF PC151AI        TO DP030-MAP-LENGTH (1).       05600007
056100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05610007
056200     PERFORM 0001-CALL-CICS-ARCH-API.                             05620007
056300*                                                                 05630007
056400     PERFORM 1000-CONTROL-PROCESSING                              05640007
056500*                                                                 05650007
056600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05660007
056700     PERFORM 0001-CALL-CICS-ARCH-API.                             05670007
056800                                                                  05680007
056900******************************************************************05690007
057000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05700007
057100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05710007
057200******************************************************************05720007
057300 0001-CALL-CICS-ARCH-API.                                         05730007
057400*    CALL PC-DPKCS030  USING DFHEIBLK                             05740007
057500     CALL DP930-CICS-ARCH-API                                     05750007
057600                     USING DFHEIBLK                               05760007
057700                           DFHCOMMAREA                            05770007
057800                           DP030-CICS-API-FIELDS                  05780007
057900                           DP020-STANDARD-COMMAREA                05790007
058000                           PC151AI.                               05800007
058100*                                                                 05810007
058200     IF  DP030-RC-CALL-SUCCESSFUL                                 05820007
058300         CONTINUE                                                 05830007
058400     ELSE                                                         05840007
058500         SET DP013-NO-ROLLBACK                                    05850007
058600             DP013-XCTL-DISPLAY-RESTART                           05860007
058700             DP013-CICS-ABEND      TO TRUE                        05870007
058800         MOVE '0001-CALL-CICS-ARCH-API'                           05880007
058900                                   TO DP013-PARAGRAPH             05890007
059000*       MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX 05900007
059100*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05910007
059200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05920007
059300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05930007
059400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05940007
059500         PERFORM DP013-0000-PROCESS-ABEND                         05950007
059600     END-IF.                                                      05960007
059700*----------------------------------------------------------------*05970007
059800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05980007
059900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05990007
060000*                                                                *06000007
060100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06010007
060200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06020007
060300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06030007
060400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06040007
060500*----------------------------------------------------------------*06050007
060600                                                                  06060007
060700 1000-CONTROL-PROCESSING.                                         06070007
060800                                                                  06080007
060900     EVALUATE TRUE                                                06090007
061000         WHEN DP020-NEXT-ACT-INITIAL                              06100007
061100*            INITIALIZE ASC-SPECIFIC-COMMAREA                     06110007
061200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06120007
061300                                      ASC-SEL-TERM-ID             06130007
061400                                      ASC-KEY-TERM-ID             06140007
061500             MOVE DP020-SRC-TASK-NUMBER                           06150007
061600                                   TO ASC-LIST-TASK-NUMBER        06160007
061700                                      ASC-SEL-TASK-NUMBER         06170007
061800                                      ASC-KEY-TASK-NUMBER         06180007
061900             MOVE PC-LIST-QUEUE-SEQ                               06190007
062000                                   TO ASC-LIST-SEQ                06200007
062100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06210007
062200             MOVE PC-KEY-QUEUE-SEQ TO ASC-KEY-SEQ                 06220007
062300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06230007
062400             IF  PS-COMMAREA-NOT-VALID                            06240007
062500*-->             INVALID P.O. PASSED TO PROGRAM                   06250007
062600*                MOVE PC-TSYMSG-99999                             06260007
062700                 MOVE PC-TSYMSG-00005                             06270007
062800                                   TO DP020-MSG-NUMBER            06280007
062900                 SET DP020-MSG-FATAL                              06290007
063000                                   TO TRUE                        06300007
063100                 SET DP020-NEXT-ACT-APPL-ERROR                    06310007
063200                                   TO TRUE                        06320007
063300             ELSE                                                 06330007
063400                 PERFORM 4000-BUILD-INITIAL-PANEL                 06340007
063500             END-IF                                               06350007
063600                                                                  06360007
063700         WHEN DP020-NEXT-ACT-READ-MAP                             06370007
063800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06380007
063900                                   TO PV-TOP-ITEM                 06390007
064000             PERFORM 2000-PROCESS-PANEL                           06400007
064100                                                                  06410007
064200         WHEN DP020-NEXT-ACT-RETURN                               06420007
064300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06430007
064400                                   TO PV-TOP-ITEM                 06440007
064500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06450007
064600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06460007
064700*            PERFORM 4130-READ-KEY-QUEUE                          06470007
064800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06480007
064900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06490007
065000                                                                  06500007
065100         WHEN OTHER                                               06510007
065200             SET DP013-LOGIC-ABEND TO TRUE                        06520007
065300             SET DP013-NO-ROLLBACK TO TRUE                        06530007
065400             MOVE '1000-CONTROL-PROCESSING'                       06540007
065500                                   TO DP013-PARAGRAPH             06550007
065600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06560007
065700                                   TO DP013-MESSAGE-TEXT(1)       06570007
065800             PERFORM DP013-0000-PROCESS-ABEND                     06580007
065900     END-EVALUATE.                                                06590007
066000                                                                  06600007
066100 EJECT                                                            06610007
066200*----------------------------------------------------------------*06620007
066300* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06630007
066400* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06640007
066500*----------------------------------------------------------------*06650007
066600                                                                  06660007
066700 1100-PROCESS-INTER-APPL-COMM.                                    06670007
066800                                                                  06680007
066900     SET PS-COMMAREA-VALID            TO TRUE.                    06690007
067000     MOVE SPACE                       TO ASC-START-ITEM-REQUEST.  06700007
067100                                                                  06710007
067200     EVALUATE DP020-INT-APPL-FORMAT-IND                           06720007
067300                                                                  06730007
067400         WHEN PC-INTER-APPL-PKSL-CRIT                             06740007
067500             IF  RC012-REC-SEQ-NBR = ZEROES                       06750007
067600                 MOVE '000000000'       TO DK-REC-SEQ-NBR-LOW     06760007
067700                 MOVE '999999999'       TO DK-REC-SEQ-NBR-HI      06770007
067800             ELSE                                                 06780007
067900                 MOVE RC012-REC-SEQ-NBR TO DK-REC-SEQ-NBR-LOW     06790007
068000                                           DK-REC-SEQ-NBR-HI      06800007
068100             END-IF                                               06810007
068200             MOVE RC012-PO-NBR          TO DK-PO-NBR              06820007
068300             MOVE RC012-OPER-UNT-ID     TO DK-UNT-ID-LOW          06830007
068400                                           DK-UNT-ID-HI           06840007
068500                                           ASC-KEY-OPR-ID         06850007
068600             MOVE RC012-FCLTY-ID        TO DK-FCLTY-ID-LOW        06860007
068700                                           DK-FCLTY-ID-HI         06870007
068800                                           ASC-KEY-FACT           06880007
068900                                                                  06890007
069000                                                                  06900007
069100         WHEN OTHER                                               06910007
069200             MOVE PC000-PO-NBR-N        TO DK-PO-NBR              06920007
069300                                                                  06930007
069400             IF  PC000-OPERATING-UNIT-ID EQUAL ZEROES             06940007
069500                 MOVE '0000'            TO DK-UNT-ID-LOW          06950007
069600                 MOVE '9999'            TO DK-UNT-ID-HI           06960007
069700             ELSE                                                 06970007
069800                 MOVE PC000-OPERATING-UNIT-ID                     06980007
069900                                        TO DK-UNT-ID-LOW          06990007
070000                                           DK-UNT-ID-HI           07000007
070100                                           ASC-KEY-OPR-ID         07010007
070200             END-IF                                               07020007
070300                                                                  07030007
070400             IF  PC000-FACILITY-ID EQUAL ZEROES                   07040007
070500                 MOVE '0000'            TO DK-FCLTY-ID-LOW        07050007
070600                 MOVE '9999'            TO DK-FCLTY-ID-HI         07060007
070700             ELSE                                                 07070007
070800                 MOVE PC000-FACILITY-ID TO DK-FCLTY-ID-LOW        07080007
070900                                           DK-FCLTY-ID-HI         07090007
071000                                           ASC-KEY-FACT           07100007
071100             END-IF                                               07110007
071200                                                                  07120007
071300             IF PC000-REC-SEQ-NBR-N EQUAL ZEROES                  07130007
071400                 MOVE '000000000'       TO DK-REC-SEQ-NBR-LOW     07140007
071500                 MOVE '999999999'       TO DK-REC-SEQ-NBR-HI      07150007
071600             ELSE                                                 07160007
071700                 MOVE PC000-REC-SEQ-NBR-N                         07170007
071800                                        TO DK-REC-SEQ-NBR-LOW     07180007
071900                                           DK-REC-SEQ-NBR-HI      07190007
072000             END-IF                                               07200007
072100     END-EVALUATE.                                                07210007
072200                                                                  07220007
072300*    IF PC000-PO-NBR-X   NOT NUMERIC                              07230007
072400*        SET  PS-COMMAREA-NOT-VALID TO TRUE                       07240007
072500*        MOVE SPACES     TO  PC000-PO-NBR-X.                      07250007
072600                                                                  07260007
072700                                                                  07270007
072800*    IF PC000-REC-SEQ-NBR-N EQUAL ZEROES                          07280007
072900*       CONTINUE                                                  07290007
073000*    ELSE                                                         07300007
073100*       MOVE ZEROES     TO  PC000-REC-SEQ-NBR-N                   07310007
073200*    END-IF.                                                      07320007
073300                                                                  07330007
073400                                                                  07340007
073500 EJECT                                                            07350007
073600*----------------------------------------------------------------*07360007
073700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07370007
073800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07380007
073900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07390007
074000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07400007
074100* FUNCTION KEYS CAN GET THIS FAR.                                *07410007
074200*----------------------------------------------------------------*07420007
074300                                                                  07430007
074400 2000-PROCESS-PANEL.                                              07440007
074500     EVALUATE TRUE                                                07450007
074600         WHEN DP020-SRC-AID = DP016-CLEAR                         07460007
074700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07470007
074800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07480007
074900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07490007
075000                                                                  07500007
075100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07510007
075200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07520007
075300             PERFORM 2050-DELETE-LIST-QUEUE                       07530007
075400             PERFORM 4000-BUILD-INITIAL-PANEL                     07540007
075500                                                                  07550007
075600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07560007
075700             PERFORM 2140-DESELECT-ALL-ITEMS                      07570007
075800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07580007
075900                                                                  07590007
076000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07600007
076100             PERFORM 2150-SELECT-ALL-ITEMS                        07610007
076200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07620007
076300                                                                  07630007
076400         WHEN OTHER                                               07640007
076500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07650007
076600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07660007
076700             IF  PS-NO-ERROR                                      07670007
076800                 SET DP030-CONTINUE-GO TO TRUE                    07680007
076900                 PERFORM 2100-CHECK-FUNCTION-KEY                  07690007
077000             ELSE                                                 07700007
077100                 SET DP030-OVERRIDE-GO TO TRUE                    07710007
077200             END-IF                                               07720007
077300     END-EVALUATE.                                                07730007
077400 EJECT                                                            07740007
077500*----------------------------------------------------------------*07750007
077600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07760007
077700*----------------------------------------------------------------*07770007
077800 2050-DELETE-LIST-QUEUE.                                          07780007
077900                                                                  07790007
078000     EXEC CICS                                                    07800007
078100         DELETEQ TS                                               07810007
078200             QUEUE (ASC-LIST-QUEUE-NAME)                          07820007
078300             RESP  (PV-CICS-RESP)                                 07830007
078400     END-EXEC.                                                    07840007
078500                                                                  07850007
078600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07860007
078700        (PV-CICS-RESP = DFHRESP(QIDERR))                          07870007
078800         CONTINUE                                                 07880007
078900     ELSE                                                         07890007
079000         SET DP013-CICS-ABEND      TO TRUE                        07900007
079100         SET DP013-NO-ROLLBACK     TO TRUE                        07910007
079200                                                                  07920007
079300         MOVE '2050-DELETE-LIST-QUEUE'                            07930007
079400                                   TO DP013-PARAGRAPH             07940007
079500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07950007
079600                                   TO DP013-MESSAGE-TEXT (1)      07960007
079700         PERFORM DP013-0000-PROCESS-ABEND                         07970007
079800     END-IF.                                                      07980007
079900                                                                  07990007
080000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08000007
080100 EJECT                                                            08010007
080200*----------------------------------------------------------------*08020007
080300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08030007
080400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08040007
080500* CICS ARCHITECTURE API.                                         *08050007
080600*----------------------------------------------------------------*08060007
080700 2100-CHECK-FUNCTION-KEY.                                         08070007
080800     EVALUATE TRUE                                                08080007
080900         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  08090007
081000             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08100007
081100                 INITIALIZE PC000-TS-SELECTION-DATA               08110007
081200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08120007
081300                                TO PC000-NUMBER-OF-SELECTED-ITEMS 08130007
081400                 PERFORM 5000-PREPARE-SEL-QUEUE                   08140007
081500             ELSE                                                 08150007
081600                 SET DP030-OVERRIDE-GO                            08160007
081700                                   TO TRUE                        08170007
081800                 MOVE PC-TSYMSG-00057                             08180007
081900                                   TO DP020-MSG-NUMBER            08190007
082000                 SET DP020-MSG-WARNING                            08200007
082100                                   TO TRUE                        08210007
082200             END-IF                                               08220007
082300                                                                  08230007
082400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08240007
082500             MOVE +1               TO PV-TOP-ITEM                 08250007
082600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08260007
082700                                                                  08270007
082800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08280007
082900             PERFORM 2110-BROWSE-BACKWARD                         08290007
083000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08300007
083100                                                                  08310007
083200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08320007
083300             PERFORM 2120-BROWSE-FORWARD                          08330007
083400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08340007
083500                                                                  08350007
083600         WHEN DP020-SRC-AID = DP016-ENTER                         08360007
083700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08370007
083800             IF  PS-ERROR                                         08380007
083900                 CONTINUE                                         08390007
084000             ELSE                                                 08400007
084100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08410007
084200             END-IF                                               08420007
084300                                                                  08430007
084400         WHEN OTHER                                               08440007
084500             SET DP013-NO-ROLLBACK                                08450007
084600                 DP013-XCTL-DISPLAY-RESTART                       08460007
084700                 DP013-CICS-ABEND  TO TRUE                        08470007
084800             MOVE '2100-CHECK-FUNCTION-KEY'                       08480007
084900                                   TO DP013-PARAGRAPH             08490007
085000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08500007
085100                                   TO DP013-MESSAGE-TEXT (1)      08510007
085200             PERFORM DP013-0000-PROCESS-ABEND                     08520007
085300     END-EVALUATE.                                                08530007
085400*                                                                 08540007
085500*----------------------------------------------------------------*08550007
085600*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08560007
085700*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08570007
085800*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08580007
085900*    MESSAGE.                                                    *08590007
086000*----------------------------------------------------------------*08600007
086100                                                                  08610007
086200 2110-BROWSE-BACKWARD.                                            08620007
086300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08630007
086400         GIVING PV-TOP-ITEM.                                      08640007
086500*                                                                 08650007
086600     IF  ((PV-TOP-ITEM < +1)                                      08660007
086700       OR (PV-TOP-ITEM = +1))                                     08670007
086800         MOVE +1                   TO PV-TOP-ITEM                 08680007
086900*        -- TOP OF LIST --                                        08690007
087000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08700007
087100         SET DP020-MSG-INFORMATIONAL TO TRUE                      08710007
087200     END-IF.                                                      08720007
087300                                                                  08730007
087400 EJECT                                                            08740007
087500*----------------------------------------------------------------*08750007
087600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08760007
087700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08770007
087800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08780007
087900*----------------------------------------------------------------*08790007
088000                                                                  08800007
088100 2120-BROWSE-FORWARD.                                             08810007
088200                                                                  08820007
088300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08830007
088400         GIVING PV-TOP-ITEM.                                      08840007
088500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08850007
088600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08860007
088700                                   TO PV-TOP-ITEM                 08870007
088800*        -- BOTTOM OF LIST --                                     08880007
088900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08890007
089000         SET DP020-MSG-INFORMATIONAL                              08900007
089100                                   TO TRUE                        08910007
089200     ELSE                                                         08920007
089300         COMPUTE PV-BOTTOM-ITEM =                                 08930007
089400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08940007
089500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08950007
089600*            -- BOTTOM OF LIST --                                 08960007
089700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08970007
089800             SET DP020-MSG-INFORMATIONAL                          08980007
089900                                   TO TRUE                        08990007
090000         END-IF                                                   09000007
090100     END-IF.                                                      09010007
090200 EJECT                                                            09020007
090300*----------------------------------------------------------------*09030007
090400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09040007
090500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09050007
090600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09060007
090700*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09070007
090800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09080007
090900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09090007
091000*----------------------------------------------------------------*09100007
091100                                                                  09110007
091200 2130-CHECK-FOR-JUMP-BROWSE.                                      09120007
091300     SET PS-NO-ERROR               TO TRUE.                       09130007
091400     IF (ASC-START-ITEM-REQUEST = SPACE)                          09140007
091500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09150007
091600                                   TO PV-TOP-ITEM                 09160007
091700     ELSE                                                         09170007
091800         MOVE ASC-START-ITEM-REQUEST                              09180007
091900                                   TO DP010I-UNEDITED-FIELD       09190007
092000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09200007
092100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09210007
092200         SET DP010I-NEGATIVE-NOT-ALLOWED                          09220007
092300                                   TO TRUE                        09230007
092400         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09240007
092500                         USING DP010I-NUMERIC-EDIT-AREA           09250007
092600                                                                  09260007
092700         IF  NOT DP010I-ERROR-DETECTED                            09270007
092800             MOVE DP010I-NUMERIC-FIELD                            09280007
092900                                   TO  ASC-START-ITEM-REQUEST-N   09290007
093000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09300007
093100                 IF  ASC-START-ITEM-REQUEST-N >                   09310007
093200                                          ASC-NUMBER-OF-ITEMS-READ09320007
093300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09330007
093400                     COMPUTE PV-TOP-ITEM =                        09340007
093500                             ASC-NUMBER-OF-ITEMS-READ             09350007
093600                             - PC-ITEMS-PER-PANEL + 1             09360007
093700                     IF  PV-TOP-ITEM < +1                         09370007
093800                         MOVE +1   TO PV-TOP-ITEM                 09380007
093900                         MOVE PC-TSYMSG-00070                     09390007
094000                                   TO DP020-MSG-NUMBER            09400007
094100                         SET DP020-MSG-INFORMATIONAL              09410007
094200                                   TO TRUE                        09420007
094300                     END-IF                                       09430007
094400                 ELSE                                             09440007
094500                     MOVE ASC-START-ITEM-REQUEST-N                09450007
094600                                   TO PV-TOP-ITEM                 09460007
094700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09470007
094800                     COMPUTE PV-BOTTOM-ITEM =                     09480007
094900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09490007
095000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09500007
095100*                        -- BOTTOM OF LIST --                     09510007
095200                         MOVE PC-TSYMSG-00070                     09520007
095300                                   TO DP020-MSG-NUMBER            09530007
095400                         SET DP020-MSG-INFORMATIONAL              09540007
095500                                   TO TRUE                        09550007
095600                     END-IF                                       09560007
095700                 END-IF                                           09570007
095800             ELSE                                                 09580007
095900*                --- VALUE OUT OF RANGE ----                      09590007
096000                 MOVE PC-TSYMSG-00101                             09600007
096100                                   TO DP020-MSG-NUMBER            09610007
096200                 MOVE -1           TO ASTRTITL                    09620007
096300                 SET DP030-SET-CURSOR-APPL-1                      09630007
096400                                   TO TRUE                        09640007
096500                 MOVE DP015-REVERSE                               09650007
096600                                   TO ASTRTITH                    09660007
096700                 MOVE DP015-RED    TO ASTRTITC                    09670007
096800                 MOVE DP015-UNP-NUM-BRT-MDT                       09680007
096900                                   TO ASTRTITA                    09690007
097000                 SET DP020-MSG-FATAL                              09700007
097100                                   TO TRUE                        09710007
097200                 SET PS-ERROR      TO TRUE                        09720007
097300             END-IF                                               09730007
097400                                                                  09740007
097500         ELSE                                                     09750007
097600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09760007
097700             MOVE -1               TO ASTRTITL                    09770007
097800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09780007
097900             MOVE DP015-REVERSE    TO ASTRTITH                    09790007
098000             MOVE DP015-RED        TO ASTRTITC                    09800007
098100             MOVE DP015-UNP-NUM-BRT-MDT                           09810007
098200                                   TO ASTRTITA                    09820007
098300             SET DP020-MSG-FATAL   TO TRUE                        09830007
098400             SET PS-ERROR          TO TRUE                        09840007
098500         END-IF                                                   09850007
098600     END-IF.                                                      09860007
098700 EJECT                                                            09870007
098800*----------------------------------------------------------------*09880007
098900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09890007
099000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09900007
099100*----------------------------------------------------------------*09910007
099200 2140-DESELECT-ALL-ITEMS.                                         09920007
099300     MOVE +1                       TO ASC-BLK-SUB.                09930007
099400                                                                  09940007
099500     PERFORM 2141-CLEAR-SELECTED-INDS                             09950007
099600         VARYING ASC-ITEM-SUB                                     09960007
099700         FROM 1 BY 1                                              09970007
099800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09980007
099900                                                                  09990007
100000     ADD +1                        TO ASC-BLK-SUB.                10000007
100100                                                                  10010007
100200     PERFORM 2141-CLEAR-SELECTED-INDS                             10020007
100300         VARYING ASC-ITEM-SUB                                     10030007
100400         FROM 1 BY 1                                              10040007
100500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10050007
100600                                                                  10060007
100700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10070007
100800                                   TO PV-LIST-ITEM-NUMBER.        10080007
100900                                                                  10090007
101000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10100007
101100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10110007
101200                                                                  10120007
101300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10130007
101400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10140007
101500         MOVE +1                   TO ASC-BLK-SUB                 10150007
101600                                                                  10160007
101700         PERFORM 5100-WRITE-TEMP-STORAGE                          10170007
101800                                                                  10180007
101900         MOVE +1                   TO PV-BLOCK-NUMBER             10190007
102000                                                                  10200007
102100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10210007
102200             PV-FIRST-BLOCK-IN-ARRAY - 1                          10220007
102300                                                                  10230007
102400         PERFORM                                                  10240007
102500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10250007
102600                                                                  10260007
102700             PERFORM 4410-READ-TEMP-STORAGE                       10270007
102800                                                                  10280007
102900             PERFORM 2141-CLEAR-SELECTED-INDS                     10290007
103000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10300007
103100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10310007
103200                                                                  10320007
103300             PERFORM 5100-WRITE-TEMP-STORAGE                      10330007
103400                                                                  10340007
103500             ADD +1                TO PV-BLOCK-NUMBER             10350007
103600                                                                  10360007
103700         END-PERFORM                                              10370007
103800                                                                  10380007
103900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10390007
104000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10400007
104100                                                                  10410007
104200         PERFORM                                                  10420007
104300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10430007
104400                   ASC-HIGHEST-BLOCK-WRITTEN                      10440007
104500                                                                  10450007
104600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10460007
104700                                   TO PV-BLOCK-NUMBER             10470007
104800                                                                  10480007
104900             PERFORM 4410-READ-TEMP-STORAGE                       10490007
105000                                                                  10500007
105100             PERFORM 2141-CLEAR-SELECTED-INDS                     10510007
105200                 VARYING ASC-ITEM-SUB                             10520007
105300                 FROM 1 BY 1                                      10530007
105400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10540007
105500                                                                  10550007
105600             PERFORM 5100-WRITE-TEMP-STORAGE                      10560007
105700                                                                  10570007
105800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10580007
105900                                                                  10590007
106000         END-PERFORM                                              10600007
106100                                                                  10610007
106200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10620007
106300                                   TO PV-BLOCK-NUMBER             10630007
106400                                                                  10640007
106500         PERFORM 4410-READ-TEMP-STORAGE                           10650007
106600     END-IF.                                                      10660007
106700                                                                  10670007
106800                                                                  10680007
106900     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 10690007
107000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10700007
107100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10710007
107200                                                                  10720007
107300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10730007
107400                                                                  10740007
107500 EJECT                                                            10750007
107600*----------------------------------------------------------------*10760007
107700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10770007
107800*----------------------------------------------------------------*10780007
107900                                                                  10790007
108000 2141-CLEAR-SELECTED-INDS.                                        10800007
108100                                                                  10810007
108200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10820007
108300             NOT EQUAL ZERO                                       10830007
108400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10840007
108500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10850007
108600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10860007
108700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10870007
108800                                   TO TRUE                        10880007
108900         END-IF                                                   10890007
109000     END-IF.                                                      10900007
109100                                                                  10910007
109200 EJECT                                                            10920007
109300*----------------------------------------------------------------*10930007
109400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10940007
109500*  FOR ALL ITEMS.                                                *10950007
109600*----------------------------------------------------------------*10960007
109700                                                                  10970007
109800 2150-SELECT-ALL-ITEMS.                                           10980007
109900                                                                  10990007
110000     MOVE +1                       TO ASC-BLK-SUB.                11000007
110100                                                                  11010007
110200     PERFORM 2151-SET-SELECTED-INDS                               11020007
110300         VARYING ASC-ITEM-SUB                                     11030007
110400         FROM 1 BY 1                                              11040007
110500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11050007
110600                                                                  11060007
110700     ADD +1                        TO ASC-BLK-SUB.                11070007
110800                                                                  11080007
110900     PERFORM 2151-SET-SELECTED-INDS                               11090007
111000         VARYING ASC-ITEM-SUB                                     11100007
111100         FROM 1 BY 1                                              11110007
111200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11120007
111300                                                                  11130007
111400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11140007
111500                                   TO PV-LIST-ITEM-NUMBER.        11150007
111600                                                                  11160007
111700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11170007
111800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11180007
111900                                                                  11190007
112000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11200007
112100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11210007
112200         MOVE +1                   TO ASC-BLK-SUB                 11220007
112300                                                                  11230007
112400         PERFORM 5100-WRITE-TEMP-STORAGE                          11240007
112500                                                                  11250007
112600         MOVE +1                   TO PV-BLOCK-NUMBER             11260007
112700                                                                  11270007
112800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11280007
112900             PV-FIRST-BLOCK-IN-ARRAY - 1                          11290007
113000                                                                  11300007
113100         PERFORM                                                  11310007
113200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11320007
113300                                                                  11330007
113400             PERFORM 4410-READ-TEMP-STORAGE                       11340007
113500                                                                  11350007
113600             PERFORM 2151-SET-SELECTED-INDS                       11360007
113700                 VARYING ASC-ITEM-SUB                             11370007
113800                 FROM 1 BY 1                                      11380007
113900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11390007
114000                                                                  11400007
114100             PERFORM 5100-WRITE-TEMP-STORAGE                      11410007
114200                                                                  11420007
114300             ADD +1                TO PV-BLOCK-NUMBER             11430007
114400                                                                  11440007
114500         END-PERFORM                                              11450007
114600                                                                  11460007
114700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11470007
114800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11480007
114900                                                                  11490007
115000         PERFORM                                                  11500007
115100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11510007
115200                   ASC-HIGHEST-BLOCK-WRITTEN                      11520007
115300                                                                  11530007
115400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11540007
115500                                   TO PV-BLOCK-NUMBER             11550007
115600                                                                  11560007
115700             PERFORM 4410-READ-TEMP-STORAGE                       11570007
115800                                                                  11580007
115900             PERFORM 2151-SET-SELECTED-INDS                       11590007
116000                 VARYING ASC-ITEM-SUB                             11600007
116100                 FROM 1 BY 1                                      11610007
116200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11620007
116300                                                                  11630007
116400             PERFORM 5100-WRITE-TEMP-STORAGE                      11640007
116500                                                                  11650007
116600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11660007
116700                                                                  11670007
116800         END-PERFORM                                              11680007
116900                                                                  11690007
117000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11700007
117100                                   TO PV-BLOCK-NUMBER             11710007
117200                                                                  11720007
117300         PERFORM 4410-READ-TEMP-STORAGE                           11730007
117400     END-IF.                                                      11740007
117500                                                                  11750007
117600                                                                  11760007
117700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11770007
117800                       ASC-NUMBER-OF-SELECTED-ITEMS.              11780007
117900                                                                  11790007
118000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11800007
118100                                                                  11810007
118200 EJECT                                                            11820007
118300*----------------------------------------------------------------*11830007
118400*    MARK EACH ITEM AS BEING SELECTED.                           *11840007
118500*----------------------------------------------------------------*11850007
118600                                                                  11860007
118700 2151-SET-SELECTED-INDS.                                          11870007
118800                                                                  11880007
118900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11890007
119000             NOT EQUAL ZERO                                       11900007
119100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11910007
119200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11920007
119300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11930007
119400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11940007
119500                               TO  TRUE                           11950007
119600         END-IF                                                   11960007
119700     END-IF.                                                      11970007
119800******************************************************************11980007
119900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11990007
120000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12000007
120100******************************************************************12010007
120200 2200-MOVE-SCREEN-TO-COMMAREA.                                    12020007
120300                                                                  12030007
120400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12040007
120500     MOVE +1                       TO PV-SUB.                     12050007
120600*                                                                 12060007
120700     PERFORM 3100-SET-SUBSCRIPTS.                                 12070007
120800     IF  ASTRTITL > ZERO                                          12080007
120900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12090007
121000     ELSE                                                         12100007
121100         IF  ASTRTITF = DP015-ERASE-EOF                           12110007
121200             INITIALIZE ASC-START-ITEM-REQUEST                    12120007
121300         END-IF                                                   12130007
121400     END-IF.                                                      12140007
121500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12150007
121600         VARYING PV-SUB                                           12160007
121700         FROM 1 BY 1                                              12170007
121800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12180007
121900******************************************************************12190007
122000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12200007
122100******************************************************************12210007
122200 2210-MOVE-LINES-TO-COMMAREA.                                     12220007
122300     IF  MR-SELECTL (PV-SUB) > ZERO                               12230007
122400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12240007
122500         MOVE MR-SELECTI (PV-SUB)                                 12250007
122600                                   TO ASC-TEMP-SELECTED-SW        12260007
122700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12270007
122800     ELSE                                                         12280007
122900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12290007
123000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12300007
123100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12310007
123200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12320007
123300         END-IF                                                   12330007
123400     END-IF.                                                      12340007
123500     ADD +1                        TO ASC-ITEM-SUB.               12350007
123600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12360007
123700         ADD +1                    TO ASC-BLK-SUB                 12370007
123800         MOVE +1                   TO ASC-ITEM-SUB                12380007
123900     END-IF.                                                      12390007
124000******************************************************************12400007
124100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12410007
124200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12420007
124300******************************************************************12430007
124400 3000-EDIT-DATA-IN-COMMAREA.                                      12440007
124500     SET PS-NO-ERROR               TO TRUE.                       12450007
124600     PERFORM 3200-RESET-ATTRIBUTES.                               12460007
124700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12470007
124800**                                                                12480007
124900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12490007
125000* EDITTING IS DONE FROM THE BOTTOM UP.                            12500007
125100**                                                                12510007
125200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12520007
125300         ASC-ITEMS-DISPLAYED - 1.                                 12530007
125400     PERFORM 3100-SET-SUBSCRIPTS.                                 12540007
125500     PERFORM 3300-EDIT-SELECTIONS                                 12550007
125600         VARYING PV-SUB                                           12560007
125700         FROM PV-SUB BY -1                                        12570007
125800         UNTIL PV-SUB < +1                                        12580007
125900*                                                                 12590007
126000     IF  PS-NO-ERROR                                              12600007
126100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12610007
126200     END-IF.                                                      12620007
126300*                                                                 12630007
126400     IF  ((PS-NO-ERROR)                                           12640007
126500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12650007
126600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12660007
126700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12670007
126800     END-IF.                                                      12680007
126900 EJECT                                                            12690007
127000*----------------------------------------------------------------*12700007
127100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12710007
127200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12720007
127300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12730007
127400*                                                                *12740007
127500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12750007
127600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12760007
127700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12770007
127800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12780007
127900*----------------------------------------------------------------*12790007
128000                                                                  12800007
128100 3100-SET-SUBSCRIPTS.                                             12810007
128200                                                                  12820007
128300     COMPUTE ASC-ITEM-SUB =                                       12830007
128400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12840007
128500                                                                  12850007
128600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12860007
128700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12870007
128800                                                                  12880007
128900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12890007
129000     ELSE                                                         12900007
129100         MOVE +1                     TO ASC-BLK-SUB               12910007
129200     END-IF.                                                      12920007
129300******************************************************************12930007
129400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12940007
129500******************************************************************12950007
129600                                                                  12960007
129700 3200-RESET-ATTRIBUTES.                                           12970007
129800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12980007
129900     MOVE DP015-GREEN              TO ASTRTITC.                   12990007
130000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13000007
130100*                                                                 13010007
130200     IF DP020-NEXT-ACT-RETURN                                     13020007
130300     OR DP020-NEXT-ACT-READ-MAP                                   13030007
130400        PERFORM                                                   13040007
130500            VARYING PV-SUB                                        13050007
130600            FROM 1 BY 1                                           13060007
130700            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    13070007
130800            MOVE DP015-UNP-ALP-NOR-OFF                            13080007
130900                                      TO MR-SELECTA (PV-SUB)      13090007
131000            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13100007
131100            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13110007
131200        END-PERFORM                                               13120007
131300     ELSE                                                         13130007
131400        PERFORM                                                   13140007
131500            VARYING PV-SUB                                        13150007
131600            FROM 1 BY 1                                           13160007
131700            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     13170007
131800            MOVE DP015-UNP-ALP-NOR-OFF                            13180007
131900                                      TO MR-SELECTA (PV-SUB)      13190007
132000            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13200007
132100            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13210007
132200        END-PERFORM                                               13220007
132300     END-IF.                                                      13230007
132400/                                                                 13240007
132500******************************************************************13250007
132600** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13260007
132700** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13270007
132800** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13280007
132900** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13290007
133000******************************************************************13300007
133100 3300-EDIT-SELECTIONS.                                            13310007
133200     EVALUATE TRUE                                                13320007
133300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13330007
133400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13340007
133500                 CONTINUE                                         13350007
133600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13360007
133700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13370007
133800                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13380007
133900                 MOVE ASC-TEMP-SELECTED-SW                        13390007
134000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13400007
134100                                TO ASC-SELECTED-SW                13410007
134200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13420007
134300             END-IF                                               13430007
134400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13440007
134500                 = SPACE                                          13450007
134600             EVALUATE TRUE                                        13460007
134700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13470007
134800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13480007
134900                     MOVE SPACE TO ASC-SELECTED-SW                13490007
135000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13500007
135100                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13510007
135200                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13520007
135300                     MOVE SPACE TO ASC-SELECTED-SW                13530007
135400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13540007
135500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13550007
135600                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13560007
135700                     MOVE SPACE TO ASC-SELECTED-SW                13570007
135800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13580007
135900             END-EVALUATE                                         13590007
136000         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13600007
136100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13610007
136200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13620007
136300             END-IF                                               13630007
136400             PERFORM 3310-EDIT-RANGE                              13640007
136500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13650007
136600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13660007
136700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13670007
136800             END-IF                                               13680007
136900             PERFORM 3310-EDIT-RANGE                              13690007
137000         WHEN OTHER                                               13700007
137100             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13710007
137200             SET DP020-MSG-FATAL    TO TRUE                       13720007
137300             MOVE -1                TO MR-SELECTL (PV-SUB)        13730007
137400             SET DP030-SET-CURSOR-APPL-1                          13740007
137500                                    TO TRUE                       13750007
137600             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13760007
137700             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13770007
137800             SET PS-ERROR TO TRUE                                 13780007
137900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13790007
138000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13800007
138100                 MOVE SPACE         TO ASC-SELECTED-SW            13810007
138200                                        (ASC-BLK-SUB ASC-ITEM-SUB)13820007
138300             END-IF                                               13830007
138400     END-EVALUATE.                                                13840007
138500                                                                  13850007
138600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13860007
138700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13870007
138800     IF  ASC-ITEM-SUB < 1                                         13880007
138900         SUBTRACT +1 FROM ASC-BLK-SUB                             13890007
139000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13900007
139100     END-IF.                                                      13910007
139200******************************************************************13920007
139300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13930007
139400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13940007
139500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13950007
139600** THE ENDING.                                                  **13960007
139700******************************************************************13970007
139800 3310-EDIT-RANGE.                                                 13980007
139900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13990007
140000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14000007
140100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14010007
140200                                   TO ASC-SELECTED-SW             14020007
140300                                        (ASC-BLK-SUB ASC-ITEM-SUB)14030007
140400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14040007
140500         ELSE                                                     14050007
140600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14060007
140700                 CONTINUE                                         14070007
140800             ELSE                                                 14080007
140900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14090007
141000                 MOVE PC-TSYMSG-00054                             14100007
141100                                   TO DP020-MSG-NUMBER            14110007
141200                 SET DP020-MSG-FATAL                              14120007
141300                                   TO TRUE                        14130007
141400                 MOVE -1           TO MR-SELECTL (PV-SUB)         14140007
141500                 SET DP030-SET-CURSOR-APPL-1                      14150007
141600                                   TO TRUE                        14160007
141700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14170007
141800                 MOVE DP015-UNDERLINE                             14180007
141900                                   TO MR-SELECTH (PV-SUB)         14190007
142000                 SET PS-ERROR      TO TRUE                        14200007
142100             END-IF                                               14210007
142200         END-IF                                                   14220007
142300     ELSE                                                         14230007
142400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14240007
142500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14250007
142600                                   TO ASC-SELECTED-SW             14260007
142700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14270007
142800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14280007
142900         ELSE                                                     14290007
143000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14300007
143100                 CONTINUE                                         14310007
143200             ELSE                                                 14320007
143300*                -- ONLY ONE END-OF-RANGE ALLOWED --              14330007
143400                 MOVE PC-TSYMSG-00055                             14340007
143500                                   TO DP020-MSG-NUMBER            14350007
143600                 SET DP020-MSG-FATAL                              14360007
143700                                   TO TRUE                        14370007
143800                 MOVE -1           TO MR-SELECTL (PV-SUB)         14380007
143900                 SET DP030-SET-CURSOR-APPL-1                      14390007
144000                                   TO TRUE                        14400007
144100                 SET PS-ERROR      TO TRUE                        14410007
144200             END-IF                                               14420007
144300         END-IF                                                   14430007
144400     END-IF.                                                      14440007
144500*                                                                 14450007
144600******************************************************************14460007
144700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14470007
144800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14480007
144900******************************************************************14490007
145000 3400-CHECK-RANGE-SEQUENCE.                                       14500007
145100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14510007
145200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14520007
145300       AND  ASC-START-OF-SELECTED-RANGE >                         14530007
145400                                         ASC-END-OF-SELECTED-RANGE14540007
145500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14550007
145600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14560007
145700         SET DP020-MSG-FATAL TO TRUE                              14570007
145800         SET PS-ERROR TO TRUE                                     14580007
145900         PERFORM 3410-POSITION-AT-ERROR                           14590007
146000     END-IF.                                                      14600007
146100******************************************************************14610007
146200** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14620007
146300** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14630007
146400** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14640007
146500******************************************************************14650007
146600 3410-POSITION-AT-ERROR.                                          14660007
146700     SET DP030-SET-CURSOR-APPL-1                                  14670007
146800                                   TO TRUE.                       14680007
146900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14690007
147000                    - PV-TOP-ITEM + 1.                            14700007
147100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14710007
147200         CONTINUE                                                 14720007
147300     ELSE                                                         14730007
147400         MOVE -1                   TO MR-SELECTL (PV-SUB)         14740007
147500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14750007
147600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14760007
147700     END-IF.                                                      14770007
147800*                                                                 14780007
147900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14790007
148000                    - PV-TOP-ITEM + 1.                            14800007
148100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14810007
148200         CONTINUE                                                 14820007
148300     ELSE                                                         14830007
148400         MOVE -1                   TO MR-SELECTL (PV-SUB)         14840007
148500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14850007
148600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14860007
148700     END-IF.                                                      14870007
148800 EJECT                                                            14880007
148900*----------------------------------------------------------------*14890007
149000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14900007
149100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14910007
149200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14920007
149300*----------------------------------------------------------------*14930007
149400                                                                  14940007
149500 3500-MARK-RANGE-AS-SELECTED.                                     14950007
149600     MOVE +1                       TO  ASC-BLK-SUB.               14960007
149700     PERFORM 3510-MARK-SELECTED-INDS                              14970007
149800         VARYING ASC-ITEM-SUB                                     14980007
149900         FROM 1 BY 1                                              14990007
150000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15000007
150100                                                                  15010007
150200     ADD +1                        TO ASC-BLK-SUB.                15020007
150300     PERFORM 3510-MARK-SELECTED-INDS                              15030007
150400         VARYING ASC-ITEM-SUB                                     15040007
150500         FROM 1 BY 1                                              15050007
150600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15060007
150700                                                                  15070007
150800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15080007
150900                                   TO  PV-LIST-ITEM-NUMBER.       15090007
151000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15100007
151100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15110007
151200               PC-ITEMS-PER-PANEL).                               15120007
151300                                                                  15130007
151400     MOVE ASC-START-OF-SELECTED-RANGE                             15140007
151500                                   TO PV-START-OF-SELECTED-RANGE. 15150007
151600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15160007
151700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15170007
151800               PC-ITEMS-PER-PANEL).                               15180007
151900                                                                  15190007
152000     MOVE ASC-END-OF-SELECTED-RANGE                               15200007
152100                                   TO  PV-END-OF-SELECTED-RANGE.  15210007
152200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15220007
152300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15230007
152400               PC-ITEMS-PER-PANEL).                               15240007
152500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15250007
152600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15260007
152700                                                                  15270007
152800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15280007
152900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15290007
153000         MOVE +1                   TO ASC-BLK-SUB                 15300007
153100         PERFORM 5100-WRITE-TEMP-STORAGE                          15310007
153200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15320007
153300             PV-FIRST-BLOCK-IN-ARRAY - 1                          15330007
153400                                                                  15340007
153500         PERFORM                                                  15350007
153600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15360007
153700                   PV-PREV-BLOCK-IN-ARRAY                         15370007
153800             MOVE PV-FIRST-BLOCK-IN-RANGE                         15380007
153900                                   TO PV-BLOCK-NUMBER             15390007
154000             PERFORM 4410-READ-TEMP-STORAGE                       15400007
154100             PERFORM 3510-MARK-SELECTED-INDS                      15410007
154200                 VARYING ASC-ITEM-SUB                             15420007
154300                 FROM 1 BY 1                                      15430007
154400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15440007
154500             PERFORM 5100-WRITE-TEMP-STORAGE                      15450007
154600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15460007
154700         END-PERFORM                                              15470007
154800                                                                  15480007
154900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15490007
155000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15500007
155100         PERFORM                                                  15510007
155200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15520007
155300                   PV-LAST-BLOCK-IN-RANGE                         15530007
155400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15540007
155500                                   TO PV-BLOCK-NUMBER             15550007
155600             PERFORM 4410-READ-TEMP-STORAGE                       15560007
155700             PERFORM 3510-MARK-SELECTED-INDS                      15570007
155800                 VARYING ASC-ITEM-SUB                             15580007
155900                 FROM 1 BY 1                                      15590007
156000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15600007
156100             PERFORM 5100-WRITE-TEMP-STORAGE                      15610007
156200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15620007
156300         END-PERFORM                                              15630007
156400                                                                  15640007
156500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15650007
156600                                   TO PV-BLOCK-NUMBER             15660007
156700         PERFORM 4410-READ-TEMP-STORAGE                           15670007
156800     END-IF.                                                      15680007
156900                                                                  15690007
157000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15700007
157100                                      ASC-END-OF-SELECTED-RANGE.  15710007
157200                                                                  15720007
157300 EJECT                                                            15730007
157400*----------------------------------------------------------------*15740007
157500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15750007
157600*----------------------------------------------------------------*15760007
157700                                                                  15770007
157800 3510-MARK-SELECTED-INDS.                                         15780007
157900                                                                  15790007
158000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15800007
158100                                ASC-ITEM-SUB) >                   15810007
158200         ASC-START-OF-SELECTED-RANGE)                             15820007
158300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15830007
158400                                ASC-ITEM-SUB) =                   15840007
158500         ASC-START-OF-SELECTED-RANGE)                             15850007
158600                                                                  15860007
158700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15870007
158800                                    ASC-ITEM-SUB) <               15880007
158900             ASC-END-OF-SELECTED-RANGE)                           15890007
159000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15900007
159100                                    ASC-ITEM-SUB) =               15910007
159200             ASC-END-OF-SELECTED-RANGE)                           15920007
159300                                                                  15930007
159400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15940007
159500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15950007
159600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15960007
159700                               TO TRUE                            15970007
159800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15980007
159900                               TO TRUE                            15990007
160000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16000007
160100             END-IF                                               16010007
160200         END-IF                                                   16020007
160300     END-IF.                                                      16030007
160400                                                                  16040007
160500 EJECT                                                            16050007
160600*----------------------------------------------------------------*16060007
160700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16070007
160800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16080007
160900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16090007
161000*    DISPLAY THE PANEL TO USER.                                  *16100007
161100*----------------------------------------------------------------*16110007
161200                                                                  16120007
161300 4000-BUILD-INITIAL-PANEL.                                        16130007
161400                                                                  16140007
161500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16150007
161600                                 ASC-BLOCK-ENTRIES (2).           16160007
161700     MOVE +1                 TO ASC-BLK-SUB.                      16170007
161800     SET ASC-ITEMS-LEFT-ON-DB                                     16180007
161900                             TO TRUE.                             16190007
162000                                                                  16200007
162100     MOVE +0                 TO ASC-ITEM-SUB                      16210007
162200                                ASC-NUMBER-OF-ITEMS-READ          16220007
162300                                ASC-NUMBER-OF-SELECTED-ITEMS      16230007
162400                                ASC-HIGHEST-BLOCK-WRITTEN         16240007
162500                                ASC-START-OF-SELECTED-RANGE       16250007
162600                                ASC-END-OF-SELECTED-RANGE         16260007
162700                                ASC-ITEM-AT-TOP-OF-PANEL.         16270007
162800                                                                  16280007
162900                                                                  16290007
163000*    IF PC000-REC-SEQ-NBR-X = SPACES                              16300007
163100*    IF PC000-REC-SEQ-NBR-N = ZEROES                              16310007
163200        PERFORM 4100-PREPARE-CURSOR                               16320007
163300        PERFORM 4010-OPEN-CURSOR                                  16330007
163400        PERFORM 4300-READ-ITEMS-FROM-DB                           16340007
163500        PERFORM 4020-CLOSE-CURSOR.                                16350007
163600*    ELSE                                                         16360007
163700*       PERFORM 4350-READ-ITEM-FROM-DB.                           16370007
163800                                                                  16380007
163900                                                                  16390007
164000     MOVE +1                   TO  PV-TOP-ITEM.                   16400007
164100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16410007
164200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16420007
164300         SET DP020-MSG-FATAL   TO  TRUE                           16430007
164400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               16440007
164500     ELSE                                                         16450007
164600         MOVE -1               TO MR-SELECTL (1)                  16460007
164700         SET DP030-SET-CURSOR-APPL-1                              16470007
164800                               TO TRUE                            16480007
164900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16490007
165000     END-IF.                                                      16500007
165100 EJECT                                                            16510007
165200 4010-OPEN-CURSOR.                                                16520007
165300                                                                  16530007
165400     EXEC SQL                                                     16540007
165500          OPEN TRECEIV_CURSOR                                     16550007
165600     END-EXEC                                                     16560007
165700                                                                  16570007
165800     EVALUATE TRUE                                                16580007
165900         WHEN SQLCODE = ZERO                                      16590007
166000              CONTINUE                                            16600007
166100         WHEN SQLCODE = -904                                      16610007
166200         WHEN SQLCODE = -911                                      16620007
166300         WHEN SQLCODE = -913                                      16630007
166400              PERFORM 9900-SOFT-ABORT                             16640007
166500         WHEN SQLWARN0 NOT EQUAL SPACE                            16650007
166600         WHEN SQLCODE NOT EQUAL ZERO                              16660007
166700              MOVE '4010-OPEN-CURSOR'                             16670007
166800                               TO DP013-PARAGRAPH                 16680007
166900              MOVE SQLCA       TO DP013-SQLCA                     16690007
167000              SET DP013-DB2-ABEND                                 16700007
167100                               TO TRUE                            16710007
167200              PERFORM DP013-0000-PROCESS-ABEND                    16720007
167300     END-EVALUATE.                                                16730007
167400                                                                  16740007
167500                                                                  16750007
167600 EJECT                                                            16760007
167700                                                                  16770007
167800*----------------------------------------------------------------*16780007
167900* CLOSE THE TMESSAGE CURSOR.                                     *16790007
168000*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *16800007
168100*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16810007
168200*   USER.                                                        *16820007
168300*----------------------------------------------------------------*16830007
168400                                                                  16840007
168500 4020-CLOSE-CURSOR.                                               16850007
168600                                                                  16860007
168700     EXEC SQL                                                     16870007
168800         CLOSE TRECEIV_CURSOR                                     16880007
168900     END-EXEC                                                     16890007
169000                                                                  16900007
169100     EVALUATE TRUE                                                16910007
169200         WHEN SQLCODE = ZERO                                      16920007
169300              CONTINUE                                            16930007
169400         WHEN SQLCODE = -904                                      16940007
169500         WHEN SQLCODE = -911                                      16950007
169600         WHEN SQLCODE = -913                                      16960007
169700              PERFORM 9900-SOFT-ABORT                             16970007
169800         WHEN SQLWARN0 NOT EQUAL SPACE                            16980007
169900         WHEN SQLCODE NOT EQUAL ZERO                              16990007
170000              MOVE '4020-CLOSE-CURSOR'                            17000007
170100                               TO DP013-PARAGRAPH                 17010007
170200              MOVE SQLCA       TO DP013-SQLCA                     17020007
170300              SET DP013-DB2-ABEND                                 17030007
170400                               TO TRUE                            17040007
170500              PERFORM DP013-0000-PROCESS-ABEND                    17050007
170600     END-EVALUATE.                                                17060007
170700                                                                  17070007
170800 EJECT                                                            17080007
170900*----------------------------------------------------------------*17090007
171000*    SET UP THE HOST VARIABLES.                                  *17100007
171100*----------------------------------------------------------------*17110007
171200                                                                  17120007
171300 4100-PREPARE-CURSOR.                                             17130007
171400                                                                  17140007
171500     IF DP020-FK-REFRESH(DP020-SRC-AID)                           17150007
171600         PERFORM 4130-READ-KEY-QUEUE                              17160007
171700     END-IF.                                                      17170007
171800                                                                  17180007
171900     PERFORM 4110-DELETE-KEY-QUEUE.                               17190007
172000                                                                  17200007
172100     PERFORM 4120-WRITE-KEY-QUEUE.                                17210007
172200                                                                  17220007
172300*----------------------------------------------------------------*17230007
172400*    DELETE THE KEY TEMP STORAGE QUEUE.                          *17240007
172500*----------------------------------------------------------------*17250007
172600 4110-DELETE-KEY-QUEUE.                                           17260007
172700                                                                  17270007
172800     EXEC CICS                                                    17280007
172900         DELETEQ TS                                               17290007
173000             QUEUE (ASC-KEY-QUEUE-NAME)                           17300007
173100             RESP  (PV-CICS-RESP)                                 17310007
173200     END-EXEC.                                                    17320007
173300*                                                                 17330007
173400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      17340007
173500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         17350007
173600         CONTINUE                                                 17360007
173700     ELSE                                                         17370007
173800         SET DP013-CICS-ABEND TO TRUE                             17380007
173900         SET DP013-NO-ROLLBACK TO TRUE                            17390007
174000         MOVE '4110-DELETE-KEY-QUEUE'                             17400007
174100                        TO DP013-PARAGRAPH                        17410007
174200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         17420007
174300                        TO DP013-MESSAGE-TEXT (1)                 17430007
174400         PERFORM DP013-0000-PROCESS-ABEND                         17440007
174500     END-IF.                                                      17450007
174600                                                                  17460007
174700******************************************************************17470007
174800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **17480007
174900** SPECIFIC COMMAREA.                                           **17490007
175000******************************************************************17500007
175100 4120-WRITE-KEY-QUEUE.                                            17510007
175200     EXEC CICS                                                    17520007
175300         WRITEQ TS                                                17530007
175400             QUEUE (ASC-KEY-QUEUE-NAME)                           17540007
175500             FROM  (PC000-KEY)                                    17550007
175600             ITEM  (PC-ONE)                                       17560007
175700             RESP  (PV-CICS-RESP)                                 17570007
175800     END-EXEC.                                                    17580007
175900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      17590007
176000         SET DP013-CICS-ABEND      TO TRUE                        17600007
176100         SET DP013-NO-ROLLBACK     TO TRUE                        17610007
176200         MOVE '4120-WRITE-KEY-LISTQ'                              17620007
176300                                   TO DP013-PARAGRAPH             17630007
176400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           17640007
176500                                   TO DP013-MESSAGE-TEXT(1)       17650007
176600         PERFORM DP013-0000-PROCESS-ABEND                         17660007
176700     END-IF.                                                      17670007
176800 EJECT                                                            17680007
176900                                                                  17690007
177000*----------------------------------------------------------------*17700007
177100*    IF REFRESHING, PUT THE CA-SKU-STORE KEY FIELD BACK TO THE   *17710007
177200*    WAY IT WAS WHEN THIS TRANSACTION WAS ORIGINALLY INVOKED.    *17720007
177300*----------------------------------------------------------------*17730007
177400                                                                  17740007
177500 4130-READ-KEY-QUEUE.                                             17750007
177600                                                                  17760007
177700     EXEC CICS                                                    17770007
177800         READQ TS                                                 17780007
177900             QUEUE (ASC-KEY-QUEUE-NAME)                           17790007
178000             INTO  (PC000-KEY)                                    17800007
178100             ITEM  (PC-ONE)                                       17810007
178200             RESP  (PV-CICS-RESP)                                 17820007
178300     END-EXEC.                                                    17830007
178400                                                                  17840007
178500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17850007
178600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17860007
178700         CONTINUE                                                 17870007
178800     ELSE                                                         17880007
178900         SET DP013-CICS-ABEND     TO TRUE                         17890007
179000         SET DP013-NO-ROLLBACK    TO TRUE                         17900007
179100         MOVE '4130-READ-KEY-QUEUE'                               17910007
179200                                  TO DP013-PARAGRAPH              17920007
179300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17930007
179400                                  TO DP013-MESSAGE-TEXT(1)        17940007
179500         PERFORM DP013-0000-PROCESS-ABEND                         17950007
179600     END-IF.                                                      17960007
179700                                                                  17970007
179800 EJECT                                                            17980007
179900*----------------------------------------------------------------*17990007
180000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18000007
180100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18010007
180200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18020007
180300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18030007
180400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18040007
180500*                                                                *18050007
180600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18060007
180700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18070007
180800*    UPON INITIALIZATION.                                        *18080007
180900*----------------------------------------------------------------*18090007
181000                                                                  18100007
181100 4300-READ-ITEMS-FROM-DB.                                         18110007
181200                                                                  18120007
181300     PERFORM                                                      18130007
181400         VARYING PV-READ-COUNT                                    18140007
181500         FROM 1 BY 1                                              18150007
181600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18160007
181700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18170007
181800                                                                  18180007
181900         PERFORM 4310-FETCH                                       18190007
182000                                                                  18200007
182100         IF  ASC-ITEMS-LEFT-ON-DB                                 18210007
182200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18220007
182300                 ADD +1            TO ASC-ITEM-SUB                18230007
182400             ELSE                                                 18240007
182500                 ADD +1            TO ASC-BLK-SUB                 18250007
182600                 MOVE +1           TO ASC-ITEM-SUB                18260007
182700                                                                  18270007
182800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18280007
182900                     MOVE +1       TO ASC-BLK-SUB                 18290007
183000                     SET ASC-BLOCK-MODIFIED (1)                   18300007
183100                                   TO TRUE                        18310007
183200                     PERFORM 5100-WRITE-TEMP-STORAGE              18320007
183300                     MOVE ASC-BLOCK-ENTRIES                       18330007
183400                               (PC-MAX-BLOCKS-IN-ARRAY)           18340007
183500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18350007
183600                     ADD +1        TO ASC-BLK-SUB                 18360007
183700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18370007
183800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18380007
183900                                   TO TRUE                        18390007
184000                 END-IF                                           18400007
184100             END-IF                                               18410007
184200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18420007
184300             MOVE ASC-NUMBER-OF-ITEMS-READ                        18430007
184400                                   TO ASC-LIST-ITEM-NUMBER        18440007
184500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18450007
184600             MOVE RECEIV-OPER-UNT-ID                              18460007
184700                                   TO ASC-OPR-ID                  18470007
184800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18480007
184900             MOVE RECEIV-FCLTY-ID                                 18490007
185000                                   TO ASC-FACT                    18500007
185100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18510007
185200             MOVE RECEIV-ORD-NBR                                  18520007
185300                                   TO ASC-PO-NBR                  18530007
185400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18540007
185500             MOVE RECEIV-REC-SEQ-NBR                              18550007
185600                                   TO ASC-REC-SEQ-NBR             18560007
185700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18570007
185800             IF RECEIV-STATUS-CDE = 'VE'                          18580007
185900                  CONTINUE                                        18590007
186000             ELSE                                                 18600007
186100                  PERFORM 4370-FIND-LINE-TROUBLE                  18610007
186200             END-IF                                               18620007
186300             IF PV-DB2-COUNT > ZERO                               18630007
186400                 SET ASC-TRBL          (ASC-BLK-SUB ASC-ITEM-SUB) 18640007
186500                                   TO TRUE                        18650007
186600             END-IF                                               18660007
186700*            MOVE RECEIV-CRE-DTE   TO PV-CRE-DTE                  18670007
186800             MOVE RECEIV-CRE-TMST  TO PV-CRE-TMST                 18680007
186900             MOVE PV-CRE-YY        TO PV-CREATE-YY                18690007
187000             MOVE PV-CRE-MM        TO PV-CREATE-MM                18700007
187100             MOVE PV-CRE-DD        TO PV-CREATE-DD                18710007
187200             MOVE PV-CREATE-DATE   TO ASC-CRE-DTE                 18720007
187300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18730007
187400             MOVE RECEIV-CRE-UID                                  18740007
187500                                   TO ASC-CRE-UID                 18750007
187600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18760007
187700             MOVE RECEIV-STATUS-CDE                               18770007
187800                                   TO ASC-STATUS-CDE              18780007
187900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18790007
188000             MOVE RECEIV-EXPTED-CART-CNT                          18800007
188100                                   TO ASC-EXPTED-CART-CNT         18810007
188200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18820007
188300             MOVE RECEIV-ACTL-CART-CNT                            18830007
188400                                   TO ASC-ACTL-CART-CNT           18840007
188500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18850007
188600             IF RECEIV-STATUS-CDE = 'VE'                          18860007
188700                PERFORM 4350-SUM-EXPTED-QTY                       18870007
188800                MOVE PV-PKSL-ITM-QTY TO ASC-EXPTED-ITM-QTY        18880007
188900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18890007
189000                PERFORM 4351-SUM-ACTUL-QTY                        18900007
189100                MOVE PV-AP-VERIFY-ITM-QTY                         18910007
189200                                   TO ASC-ACTL-ITM-QTY            18920007
189300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18930007
189400             ELSE                                                 18940007
189500                 MOVE RECEIV-EXPTED-ITM-QTY                       18950007
189600                                   TO ASC-EXPTED-ITM-QTY          18960007
189700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18970007
189800                 MOVE RECEIV-ACTL-ITM-QTY                         18980007
189900                                   TO ASC-ACTL-ITM-QTY            18990007
190000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19000007
190100             END-IF                                               19010007
190200         END-IF                                                   19020007
190300     END-PERFORM.                                                 19030007
190400                                                                  19040007
190500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19050007
190600         MOVE +1               TO ASC-BLK-SUB                     19060007
190700         PERFORM 5100-WRITE-TEMP-STORAGE                          19070007
190800         ADD +1                TO ASC-BLK-SUB                     19080007
190900         PERFORM 5100-WRITE-TEMP-STORAGE                          19090007
191000                                                                  19100007
191100         MOVE 1                TO ASC-BLK-SUB                     19110007
191200                                  PV-BLOCK-NUMBER                 19120007
191300         PERFORM 4410-READ-TEMP-STORAGE                           19130007
191400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19140007
191500             MOVE 2            TO ASC-BLK-SUB                     19150007
191600                                  PV-BLOCK-NUMBER                 19160007
191700             PERFORM 4410-READ-TEMP-STORAGE                       19170007
191800         END-IF                                                   19180007
191900     END-IF.                                                      19190007
192000 EJECT                                                            19200007
192100 4350-READ-ITEM-FROM-DB.                                          19210007
192200                                                                  19220007
192300     PERFORM                                                      19230007
192400         VARYING PV-READ-COUNT                                    19240007
192500         FROM 1 BY 1                                              19250007
192600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19260007
192700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19270007
192800                                                                  19280007
192900         PERFORM 4315-SELECT-TRECEIV                              19290007
193000                                                                  19300007
193100         IF  ASC-ITEMS-LEFT-ON-DB                                 19310007
193200             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  19320007
193300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19330007
193400                 ADD +1            TO ASC-ITEM-SUB                19340007
193500             ELSE                                                 19350007
193600                 ADD +1            TO ASC-BLK-SUB                 19360007
193700                 MOVE +1           TO ASC-ITEM-SUB                19370007
193800                                                                  19380007
193900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19390007
194000                     MOVE +1       TO ASC-BLK-SUB                 19400007
194100                     SET ASC-BLOCK-MODIFIED (1)                   19410007
194200                                   TO TRUE                        19420007
194300                     PERFORM 5100-WRITE-TEMP-STORAGE              19430007
194400                     MOVE ASC-BLOCK-ENTRIES                       19440007
194500                               (PC-MAX-BLOCKS-IN-ARRAY)           19450007
194600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19460007
194700                     ADD +1        TO ASC-BLK-SUB                 19470007
194800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19480007
194900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19490007
195000                                   TO TRUE                        19500007
195100                 END-IF                                           19510007
195200             END-IF                                               19520007
195300         ADD +1                TO ASC-NUMBER-OF-ITEMS-READ        19530007
195400         MOVE ASC-NUMBER-OF-ITEMS-READ                            19540007
195500                               TO ASC-LIST-ITEM-NUMBER            19550007
195600                                  (ASC-BLK-SUB ASC-ITEM-SUB)      19560007
195700         MOVE RECEIV-OPER-UNT-ID                                  19570007
195800                               TO ASC-OPR-ID                      19580007
195900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19590007
196000         MOVE RECEIV-FCLTY-ID                                     19600007
196100                               TO ASC-FACT                        19610007
196200                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19620007
196300         MOVE RECEIV-ORD-NBR                                      19630007
196400                               TO ASC-PO-NBR                      19640007
196500                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19650007
196600         MOVE RECEIV-REC-SEQ-NBR                                  19660007
196700                               TO ASC-REC-SEQ-NBR                 19670007
196800                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19680007
196900*        MOVE RECEIV-CRE-DTE   TO PV-CRE-DTE                      19690007
197000         MOVE RECEIV-CRE-TMST  TO PV-CRE-TMST                     19700007
197100         MOVE PV-CRE-YY        TO PV-CREATE-YY                    19710007
197200         MOVE PV-CRE-MM        TO PV-CREATE-MM                    19720007
197300         MOVE PV-CRE-DD        TO PV-CREATE-DD                    19730007
197400         MOVE PV-CREATE-DATE   TO ASC-CRE-DTE                     19740007
197500                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19750007
197600         MOVE RECEIV-CRE-UID                                      19760007
197700                               TO ASC-CRE-UID                     19770007
197800                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19780007
197900         MOVE RECEIV-STATUS-CDE                                   19790007
198000                               TO ASC-STATUS-CDE                  19800007
198100                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19810007
198200         MOVE RECEIV-EXPTED-CART-CNT                              19820007
198300                               TO ASC-EXPTED-CART-CNT             19830007
198400                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19840007
198500         MOVE RECEIV-ACTL-CART-CNT                                19850007
198600                               TO ASC-ACTL-CART-CNT               19860007
198700                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19870007
198800         MOVE RECEIV-EXPTED-ITM-QTY                               19880007
198900                               TO ASC-EXPTED-ITM-QTY              19890007
199000                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19900007
199100         MOVE RECEIV-ACTL-ITM-QTY                                 19910007
199200                               TO ASC-ACTL-ITM-QTY                19920007
199300                                   (ASC-BLK-SUB ASC-ITEM-SUB)     19930007
199400         END-IF                                                   19940007
199500     END-PERFORM.                                                 19950007
199600                                                                  19960007
199700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19970007
199800         MOVE +1               TO ASC-BLK-SUB                     19980007
199900         PERFORM 5100-WRITE-TEMP-STORAGE                          19990007
200000         ADD +1                TO ASC-BLK-SUB                     20000007
200100         PERFORM 5100-WRITE-TEMP-STORAGE                          20010007
200200                                                                  20020007
200300         MOVE 1                TO ASC-BLK-SUB                     20030007
200400                                  PV-BLOCK-NUMBER                 20040007
200500         PERFORM 4410-READ-TEMP-STORAGE                           20050007
200600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20060007
200700             MOVE 2            TO ASC-BLK-SUB                     20070007
200800                                  PV-BLOCK-NUMBER                 20080007
200900             PERFORM 4410-READ-TEMP-STORAGE                       20090007
201000         END-IF                                                   20100007
201100     END-IF.                                                      20110007
201200 EJECT                                                            20120007
201300*----------------------------------------------------------------*20130007
201400*    FETCH THE TRECEIV CURSOR.                                   *20140007
201500*----------------------------------------------------------------*20150007
201600                                                                  20160007
201700 4310-FETCH.                                                      20170007
201800                                                                  20180007
201900**   PERFORM                                                      20190007
202000**       WITH TEST AFTER                                          20200007
202100**       VARYING PV-SQL-SUB                                       20210007
202200**       FROM 1 BY 1                                              20220007
202300**       UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20230007
202400**          OR SQLCODE = ZERO                                     20240007
202500**          OR SQLCODE = +100                                     20250007
202600                                                                  20260007
202700                  EXEC SQL                                        20270007
202800                       FETCH TRECEIV_CURSOR                       20280007
202900                       INTO   :RECEIV-ORD-NBR                     20290007
203000                             ,:RECEIV-REC-SEQ-NBR                 20300007
203100                             ,:RECEIV-OPER-UNT-ID                 20310007
203200                             ,:RECEIV-FCLTY-ID                    20320007
203300                             ,:RECEIV-CRE-TMST                    20330007
203400                             ,:RECEIV-CRE-UID                     20340007
203500                             ,:RECEIV-STATUS-CDE                  20350007
203600                             ,:RECEIV-EXPTED-CART-CNT             20360007
203700                             ,:RECEIV-ACTL-CART-CNT               20370007
203800                             ,:RECEIV-EXPTED-ITM-QTY              20380007
203900                             ,:RECEIV-ACTL-ITM-QTY                20390007
204000                  END-EXEC                                        20400007
204100                                                                  20410007
204200                                                                  20420007
204300         EVALUATE TRUE                                            20430007
204400             WHEN SQLCODE = ZERO                                  20440007
204500             WHEN SQLCODE = +100                                  20450007
204600                  CONTINUE                                        20460007
204700             WHEN SQLCODE = -904                                  20470007
204800             WHEN SQLCODE = -911                                  20480007
204900             WHEN SQLCODE = -913                                  20490007
205000                  PERFORM 9900-SOFT-ABORT                         20500007
205100             WHEN SQLWARN0 NOT EQUAL SPACE                        20510007
205200             WHEN SQLCODE NOT EQUAL ZERO                          20520007
205300                  MOVE '4310-FETCH-CURSOR'                        20530007
205400                                   TO DP013-PARAGRAPH             20540007
205500                  MOVE 'FETCH TRECEIV CURSOR'                     20550007
205600                                   TO DP013-MESSAGE-TEXT (1)      20560007
205700                  MOVE SQLCA       TO DP013-SQLCA                 20570007
205800                  SET DP013-DB2-ABEND                             20580007
205900                                   TO TRUE                        20590007
206000                  PERFORM DP013-0000-PROCESS-ABEND                20600007
206100         END-EVALUATE.                                            20610007
206200**   END-PERFORM.                                                 20620007
206300                                                                  20630007
206400**   IF  PV-SQL-SUB > PC-MAX-RETRIES                              20640007
206500**       MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             20650007
206600**       MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             20660007
206700**                                 TO DP013-MESSAGE-TEXT (1)      20670007
206800**       MOVE SQLCA                TO DP013-SQLCA                 20680007
206900**       SET DP013-DB2-ABEND       TO TRUE                        20690007
207000**       PERFORM DP013-0000-PROCESS-ABEND                         20700007
207100**   END-IF.                                                      20710007
207200                                                                  20720007
207300     IF  SQLCODE EQUAL +100                                       20730007
207400         SET ASC-NO-ITEMS-LEFT-ON-DB                              20740007
207500                                   TO TRUE                        20750007
207600     END-IF.                                                      20760007
207700                                                                  20770007
207800                                                                  20780007
207900 EJECT                                                            20790007
208000*----------------------------------------------------------------*20800007
208100*    FETCH THE TRECEIV DATA BASE W/THE REC_SEQ_NBR AS PART       *20810007
208200*    OF THE KEY.                                                 *20820007
208300*----------------------------------------------------------------*20830007
208400                                                                  20840007
208500 4315-SELECT-TRECEIV.                                             20850007
208600                                                                  20860007
208700**   PERFORM                                                      20870007
208800**       WITH TEST AFTER                                          20880007
208900**       VARYING PV-SQL-SUB                                       20890007
209000**       FROM 1 BY 1                                              20900007
209100**       UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20910007
209200**          OR SQLCODE = ZERO                                     20920007
209300**          OR SQLCODE = +100                                     20930007
209400                                                                  20940007
209500                  EXEC SQL                                        20950007
209600                       SELECT ORD_NBR                             20960007
209700                             ,REC_SEQ_NBR                         20970007
209800                             ,CRE_TMST                            20980007
209900                             ,CRE_UID                             20990007
210000                             ,STATUS_CDE                          21000007
210100                             ,EXPTED_CART_CNT                     21010007
210200                             ,ACTL_CART_CNT                       21020007
210300                             ,EXPTED_ITM_QTY                      21030007
210400                             ,ACTL_ITM_QTY                        21040007
210500                       INTO   :RECEIV-ORD-NBR                     21050007
210600                             ,:RECEIV-REC-SEQ-NBR                 21060007
210700                             ,:RECEIV-CRE-TMST                    21070007
210800                             ,:RECEIV-CRE-UID                     21080007
210900                             ,:RECEIV-STATUS-CDE                  21090007
211000                             ,:RECEIV-EXPTED-CART-CNT             21100007
211100                             ,:RECEIV-ACTL-CART-CNT               21110007
211200                             ,:RECEIV-EXPTED-ITM-QTY              21120007
211300                             ,:RECEIV-ACTL-ITM-QTY                21130007
211400                                                                  21140007
211500                       FROM  TRECEIV                              21150007
211600                       WHERE ORD_NBR     = :PC000-PO-NBR-N        21160007
211700                         AND REC_SEQ_NBR = :PC000-REC-SEQ-NBR-N   21170007
211800                  END-EXEC                                        21180007
211900                                                                  21190007
212000                                                                  21200007
212100         EVALUATE TRUE                                            21210007
212200             WHEN SQLCODE = ZERO                                  21220007
212300             WHEN SQLCODE = +100                                  21230007
212400                  CONTINUE                                        21240007
212500             WHEN SQLCODE = -904                                  21250007
212600             WHEN SQLCODE = -911                                  21260007
212700             WHEN SQLCODE = -913                                  21270007
212800                  PERFORM 9900-SOFT-ABORT                         21280007
212900             WHEN SQLWARN0 NOT EQUAL SPACE                        21290007
213000             WHEN SQLCODE NOT EQUAL ZERO                          21300007
213100                  MOVE '4315-SELECT-TRECEIV'                      21310007
213200                                   TO DP013-PARAGRAPH             21320007
213300                  MOVE 'FETCH TRECEIV'                            21330007
213400                                   TO DP013-MESSAGE-TEXT (1)      21340007
213500                  MOVE SQLCA       TO DP013-SQLCA                 21350007
213600                  SET DP013-DB2-ABEND                             21360007
213700                                   TO TRUE                        21370007
213800                  PERFORM DP013-0000-PROCESS-ABEND                21380007
213900         END-EVALUATE.                                            21390007
214000**   END-PERFORM.                                                 21400007
214100                                                                  21410007
214200**   IF  PV-SQL-SUB > PC-MAX-RETRIES                              21420007
214300**       MOVE '4315-SELECT-TRECEIV' TO DP013-PARAGRAPH            21430007
214400**       MOVE 'MAX RETRIES EXCEEDED FOR FETCH TRECEIV'            21440007
214500**                                 TO DP013-MESSAGE-TEXT (1)      21450007
214600**       MOVE SQLCA                TO DP013-SQLCA                 21460007
214700**       SET DP013-DB2-ABEND       TO TRUE                        21470007
214800**       PERFORM DP013-0000-PROCESS-ABEND                         21480007
214900**   END-IF.                                                      21490007
215000                                                                  21500007
215100     IF  SQLCODE EQUAL +100                                       21510007
215200         SET ASC-NO-ITEMS-LEFT-ON-DB                              21520007
215300                                   TO TRUE                        21530007
215400     END-IF.                                                      21540007
215500                                                                  21550007
215600                                                                  21560007
215700 EJECT                                                            21570007
215800 4350-SUM-EXPTED-QTY.                                             21580007
215900                                                                  21590007
216000**   PERFORM                                                      21600007
216100**       WITH TEST AFTER                                          21610007
216200**       VARYING PV-RETRY-COUNTER                                 21620007
216300**       FROM 1 BY 1                                              21630007
216400**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21640007
216500**           OR (SQLCODE = +0)                                    21650007
216600**           OR (SQLCODE = +100)                                  21660007
216700**           OR (SQLCODE = -305))                                 21670007
216800                                                                  21680007
216900         EXEC SQL                                                 21690007
217000              SELECT SUM(PKSL_ITM_QTY)                            21700007
217100                INTO :PV-PKSL-ITM-QTY                             21710007
217200                FROM TRECITM                                      21720007
217300               WHERE ORD_NBR           = :DK-PO-NBR               21730007
217400                 AND REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR      21740007
217500                 AND OPER_UNT_ID       = :RECEIV-OPER-UNT-ID      21750007
217600                 AND FCLTY_ID          = :RECEIV-FCLTY-ID         21760007
217700*                AND REC_SEQ_NBR       = :DK-RCVR-SEQ-NBR         21770007
217800                 AND VER_STATUS_CDE    = 'A'                      21780007
217900         END-EXEC                                                 21790007
218000                                                                  21800007
218100         EVALUATE TRUE                                            21810007
218200             WHEN SQLCODE = ZERO                                  21820007
218300             WHEN SQLCODE = +100                                  21830007
218400*-->         A "-305" OCCURS WHEN DOING A DB2 BUILT-IN FUNCTION   21840007
218500*-->         (I.E. "SUM") AND A NOT-FOUND OCCURS.                 21850007
218600             WHEN SQLCODE = -305                                  21860007
218700                  CONTINUE                                        21870007
218800             WHEN SQLCODE = -904                                  21880007
218900             WHEN SQLCODE = -911                                  21890007
219000             WHEN SQLCODE = -913                                  21900007
219100                  PERFORM 9900-SOFT-ABORT                         21910007
219200             WHEN SQLWARN0 NOT EQUAL SPACE                        21920007
219300             WHEN SQLCODE NOT EQUAL ZERO                          21930007
219400                  MOVE '4350-SUM-EXPTED-QTY'                      21940007
219500                                   TO DP013-PARAGRAPH             21950007
219600                  MOVE 'SELECT TRECITM'                           21960007
219700                                   TO DP013-MESSAGE-TEXT (1)      21970007
219800                  MOVE SQLCA       TO DP013-SQLCA                 21980007
219900                  SET DP013-DB2-ABEND                             21990007
220000                                   TO TRUE                        22000007
220100                  PERFORM DP013-0000-PROCESS-ABEND                22010007
220200         END-EVALUATE.                                            22020007
220300**   END-PERFORM.                                                 22030007
220400                                                                  22040007
220500**   IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22050007
220600**       MOVE '4350-SUM-EXPTED-QTY'                               22060007
220700**                                 TO DP013-PARAGRAPH             22070007
220800**       MOVE 'MAX RETRIES EXCEEDED FOR SUM ON TRECDIS'           22080007
220900**                                 TO DP013-MESSAGE-TEXT (1)      22090007
221000**       MOVE SQLCA                TO DP013-SQLCA                 22100007
221100**       SET DP013-DB2-ABEND       TO TRUE                        22110007
221200**       PERFORM DP013-0000-PROCESS-ABEND                         22120007
221300**   END-IF.                                                      22130007
221400     EJECT                                                        22140007
221500                                                                  22150007
221600 4351-SUM-ACTUL-QTY.                                              22160007
221700                                                                  22170007
221800**   PERFORM                                                      22180007
221900**       WITH TEST AFTER                                          22190007
222000**       VARYING PV-RETRY-COUNTER                                 22200007
222100**       FROM 1 BY 1                                              22210007
222200**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22220007
222300**           OR (SQLCODE = +0)                                    22230007
222400**           OR (SQLCODE = +100)                                  22240007
222500**           OR (SQLCODE = -305))                                 22250007
222600                                                                  22260007
222700         EXEC SQL                                                 22270007
222800              SELECT SUM(AP_VERIFY_ITM_QTY)                       22280007
222900                INTO :PV-AP-VERIFY-ITM-QTY                        22290007
223000                FROM TRECDIS                                      22300007
223100               WHERE ORD_NBR           = :DK-PO-NBR               22310007
223200                 AND REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR      22320007
223400         END-EXEC                                                 22340007
223500                                                                  22350007
223600         EVALUATE TRUE                                            22360007
223700             WHEN SQLCODE = ZERO                                  22370007
223800             WHEN SQLCODE = +100                                  22380007
223900*-->         A "-305" OCCURS WHEN DOING A DB2 BUILT-IN FUNCTION   22390007
224000*-->         (I.E. "SUM") AND A NOT-FOUND OCCURS.                 22400007
224100             WHEN SQLCODE = -305                                  22410007
224200                  CONTINUE                                        22420007
224300             WHEN SQLCODE = -904                                  22430007
224400             WHEN SQLCODE = -911                                  22440007
224500             WHEN SQLCODE = -913                                  22450007
224600                  PERFORM 9900-SOFT-ABORT                         22460007
224700             WHEN SQLWARN0 NOT EQUAL SPACE                        22470007
224800             WHEN SQLCODE NOT EQUAL ZERO                          22480007
224900                  MOVE '4351-SUM-ACTUL-QTY'                       22490007
225000                                   TO DP013-PARAGRAPH             22500007
225100                  MOVE 'SELECT TRECDIS'                           22510007
225200                                   TO DP013-MESSAGE-TEXT (1)      22520007
225300                  MOVE SQLCA       TO DP013-SQLCA                 22530007
225400                  SET DP013-DB2-ABEND                             22540007
225500                                   TO TRUE                        22550007
225600                  PERFORM DP013-0000-PROCESS-ABEND                22560007
225700         END-EVALUATE.                                            22570007
225800**   END-PERFORM.                                                 22580007
225900                                                                  22590007
226000**   IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22600007
226100**       MOVE '4351-SUM-ACTUL-QTY'                                22610007
226200**                                 TO DP013-PARAGRAPH             22620007
226300**       MOVE 'MAX RETRIES EXCEEDED FOR SUM ON TRECDIS'           22630007
226400**                                 TO DP013-MESSAGE-TEXT (1)      22640007
226500**       MOVE SQLCA                TO DP013-SQLCA                 22650007
226600**       SET DP013-DB2-ABEND       TO TRUE                        22660007
226700**       PERFORM DP013-0000-PROCESS-ABEND                         22670007
226800**   END-IF.                                                      22680007
226900     EJECT                                                        22690007
227000 4370-FIND-LINE-TROUBLE.                                          22700007
227100     MOVE ZERO                    TO PV-DB2-COUNT                 22710007
227200                                                                  22720007
227300     EXEC SQL                                                     22730007
227400         SELECT COUNT(*)                                          22740007
227500         INTO :PV-DB2-COUNT                                       22750007
227600         FROM  TTRBNTF A                                          22760007
227700         WHERE A.PO_NBR           = :RECEIV-ORD-NBR               22770007
227800               AND A.REC_SEQ_NBR  = :RECEIV-REC-SEQ-NBR           22780007
227900               AND A.RESOLVED_IND IN (:PC-N, :PC-I)               22790007
228000     END-EXEC                                                     22800007
228100                                                                  22810007
228200     EVALUATE TRUE                                                22820007
228300         WHEN SQLCODE = ZERO                                      22830007
228400         WHEN SQLCODE = +100                                      22840007
228500             CONTINUE                                             22850007
228600         WHEN SQLCODE = -904                                      22860007
228700         WHEN SQLCODE = -911                                      22870007
228800         WHEN SQLCODE = -913                                      22880007
228900              PERFORM 9900-SOFT-ABORT                             22890007
229000                                                                  22900007
229100         WHEN SQLWARN0 NOT = SPACE                                22910007
229200         WHEN SQLCODE < ZERO                                      22920007
229300         WHEN SQLCODE > ZERO                                      22930007
229400             MOVE '4370-FIND-LINE-TROUBLE'                        22940007
229500                             TO DP013-PARAGRAPH                   22950007
229600             MOVE 'SELECT ON TTRBNTF/TTRBRSN'                     22960007
229700                             TO DP013-MESSAGE-TEXT (1)            22970007
229800             MOVE SQLCA      TO DP013-SQLCA                       22980007
229900             MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)          22990007
230000             MOVE 'TTRBRSN'  TO DP013-DB2-TABLE-NAME (2)          23000007
230100             SET DP013-DB2-ABEND                                  23010007
230200                             TO TRUE                              23020007
230300             SET DP013-XCTL-DISPLAY-RESTART                       23030007
230400                             TO TRUE                              23040007
230500             PERFORM DP013-0000-PROCESS-ABEND                     23050007
230600     END-EVALUATE.                                                23060007
230700*----------------------------------------------------------------*23070007
230800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23080007
230900*----------------------------------------------------------------*23090007
231000                                                                  23100007
231100 4400-MOVE-COMMAREA-TO-SCREEN.                                    23110007
231200                                                                  23120007
231300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23130007
231400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23140007
231500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23150007
231600             MOVE +1    TO ASC-BLK-SUB                            23160007
231700             PERFORM 5100-WRITE-TEMP-STORAGE                      23170007
231800             ADD +1     TO ASC-BLK-SUB                            23180007
231900             PERFORM 5100-WRITE-TEMP-STORAGE                      23190007
232000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23200007
232100                 GIVING PV-BLOCK-NUMBER                           23210007
232200                 REMAINDER PV-REMAINDER                           23220007
232300             IF  PV-REMAINDER > ZERO                              23230007
232400                 ADD +1 TO PV-BLOCK-NUMBER                        23240007
232500             END-IF                                               23250007
232600             MOVE +1    TO ASC-BLK-SUB                            23260007
232700             PERFORM 4410-READ-TEMP-STORAGE                       23270007
232800             ADD +1     TO ASC-BLK-SUB                            23280007
232900                           PV-BLOCK-NUMBER                        23290007
233000             PERFORM 4410-READ-TEMP-STORAGE                       23300007
233100     END-IF.                                                      23310007
233200     MOVE +1            TO ASC-BLK-SUB.                           23320007
233300     COMPUTE ASC-ITEM-SUB =                                       23330007
233400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23340007
233500         + PC-ITEMS-PER-PANEL).                                   23350007
233600*                                                                 23360007
233700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23370007
233800         ADD +1         TO ASC-BLK-SUB                            23380007
233900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23390007
234000     END-IF.                                                      23400007
234100*                                                                 23410007
234200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23420007
234300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23430007
234400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23440007
234500     PERFORM 4420-FORMAT-LIST-LINES                               23450007
234600         VARYING PV-SUB                                           23460007
234700         FROM PC-ITEMS-PER-PANEL BY -1                            23470007
234800         UNTIL PV-SUB < +1.                                       23480007
234900*                                                                 23490007
235000     COMPUTE ASC-ITEMS-DISPLAYED =                                23500007
235100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23510007
235200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23520007
235300                                      ASTRTITO.                   23530007
235400     MOVE ASC-KEY-OPR-ID           TO AOPUNTO.                    23540007
235500     MOVE ASC-KEY-FACT             TO AFACTYO.                    23550007
235600                                                                  23560007
235700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23570007
235800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23580007
235900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23590007
236000                                   TO ASELITO.                    23600007
236100*                                                                 23610007
236200     IF  DP020-MSG-NUMBER-X = SPACE                               23620007
236300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23630007
236400*            --- MORE ITEMS TO DISPLAY ----                       23640007
236500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23650007
236600             SET DP020-MSG-INFORMATIONAL TO TRUE                  23660007
236700         END-IF                                                   23670007
236800     END-IF.                                                      23680007
236900*----------------------------------------------------------------*23690007
237000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23700007
237100*----------------------------------------------------------------*23710007
237200                                                                  23720007
237300 4410-READ-TEMP-STORAGE.                                          23730007
237400                                                                  23740007
237500     EXEC CICS                                                    23750007
237600         READQ TS                                                 23760007
237700             QUEUE (ASC-LIST-QUEUE-NAME)                          23770007
237800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23780007
237900             ITEM  (PV-BLOCK-NUMBER)                              23790007
238000             RESP  (PV-CICS-RESP)                                 23800007
238100     END-EXEC.                                                    23810007
238200                                                                  23820007
238300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23830007
238400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23840007
238500         CONTINUE                                                 23850007
238600     ELSE                                                         23860007
238700         SET DP013-CICS-ABEND     TO TRUE                         23870007
238800         SET DP013-NO-ROLLBACK    TO TRUE                         23880007
238900         MOVE '4410-READ-TEMP-STORAGE'                            23890007
239000                                  TO DP013-PARAGRAPH              23900007
239100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23910007
239200                                  TO DP013-MESSAGE-TEXT(1)        23920007
239300         PERFORM DP013-0000-PROCESS-ABEND                         23930007
239400     END-IF.                                                      23940007
239500                                                                  23950007
239600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23960007
239700*                                                                 23970007
239800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23980007
239900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23990007
240000     END-IF.                                                      24000007
240100 EJECT                                                            24010007
240200*----------------------------------------------------------------*24020007
240300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *24030007
240400*----------------------------------------------------------------*24040007
240500                                                                  24050007
240600 4420-FORMAT-LIST-LINES.                                          24060007
240700     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      24070007
240800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                24080007
240900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      24090007
241000         MOVE SPACE              TO MR-SELECTI      (PV-SUB)      24100007
241100                                    MR-OPRID        (PV-SUB)      24110007
241200                                    MR-FACT         (PV-SUB)      24120007
241300                                    MR-PONBR        (PV-SUB)      24130007
241400                                    MR-RSEQ         (PV-SUB)      24140007
241500                                    MR-STATUS       (PV-SUB)      24150007
241600                                    MR-EXP-CTN-QTY  (PV-SUB)      24160007
241700                                    MR-ACT-CTN-QTY  (PV-SUB)      24170007
241800                                    MR-EXP-ITM-QTY  (PV-SUB)      24180007
241900                                    MR-ACT-ITM-QTY  (PV-SUB)      24190007
242000                                    MR-CREATE-DATE  (PV-SUB)      24200007
242100                                    MR-USER-ID      (PV-SUB)      24210007
242200     ELSE                                                         24220007
242300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24230007
242400                                                   > SPACE        24240007
242500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24250007
242600                                 TO MR-SELECTI (PV-SUB)           24260007
242700         ELSE                                                     24270007
242800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24280007
242900                                 TO MR-SELECTI (PV-SUB)           24290007
243000         END-IF                                                   24300007
243100*                                                                 24310007
243200         IF  DP030-SET-CURSOR-TRAILER                             24320007
243300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24330007
243400                 > SPACE)                                         24340007
243500               OR (PV-SUB = 1))                                   24350007
243600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24360007
243700                MOVE -1          TO MR-SELECTL (PV-SUB)           24370007
243800             END-IF                                               24380007
243900         END-IF                                                   24390007
244000*                                                                 24400007
244100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           24410007
244200             MOVE ASC-OPR-ID     (ASC-BLK-SUB ASC-ITEM-SUB)       24420007
244300                                 TO MR-OPRID (PV-SUB)             24430007
244400             MOVE ASC-FACT       (ASC-BLK-SUB ASC-ITEM-SUB)       24440007
244500                                 TO MR-FACT  (PV-SUB)             24450007
244600             MOVE ASC-PO-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)       24460007
244700                                 TO MR-PONBR (PV-SUB)             24470007
244800             MOVE ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      24480007
244900                                 TO MR-RSEQ     (PV-SUB)          24490007
245000             MOVE ASC-CRE-DTE   (ASC-BLK-SUB ASC-ITEM-SUB)        24500007
245100                                 TO MR-CREATE-DATE (PV-SUB)       24510007
245200             MOVE ASC-CRE-UID    (ASC-BLK-SUB ASC-ITEM-SUB)       24520007
245300                                 TO MR-USER-ID  (PV-SUB)          24530007
245400             MOVE ASC-STATUS-CDE (ASC-BLK-SUB ASC-ITEM-SUB)       24540007
245500                                 TO MR-STATUS      (PV-SUB)       24550007
245600             IF ASC-TRBL (ASC-BLK-SUB ASC-ITEM-SUB)               24560007
245700                 MOVE DP015-YELLOW TO MR-STATUSC (PV-SUB)         24570007
245800             END-IF                                               24580007
245900             MOVE ASC-EXPTED-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)  24590007
246000                                 TO MR-EXP-CTN-QTY (PV-SUB)       24600007
246100             MOVE ASC-ACTL-CART-CNT (ASC-BLK-SUB ASC-ITEM-SUB)    24610007
246200                                 TO MR-ACT-CTN-QTY  (PV-SUB)      24620007
246300             MOVE ASC-EXPTED-ITM-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)  24630007
246400                                 TO MR-EXP-ITM-QTY (PV-SUB)       24640007
246500             MOVE ASC-ACTL-ITM-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)    24650007
246600                                 TO MR-ACT-ITM-QTY (PV-SUB)       24660007
246700         END-IF                                                   24670007
246800     END-IF.                                                      24680007
246900     SUBTRACT +1 FROM ASC-ITEM-SUB                                24690007
247000     IF  ASC-ITEM-SUB < + 1                                       24700007
247100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24710007
247200         MOVE +1                 TO ASC-BLK-SUB                   24720007
247300     END-IF.                                                      24730007
247400******************************************************************24740007
247500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **24750007
247600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **24760007
247700** ISSUE A WARNING.                                             **24770007
247800******************************************************************24780007
247900 4430-CHECK-FOR-BEGIN-AND-END.                                    24790007
248000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24800007
248100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24810007
248200*            -- NO END-OF-RANGE SPECFIED ---                      24820007
248300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24830007
248400             SET DP020-MSG-WARNING TO TRUE                        24840007
248500             PERFORM 4431-POSITION-AT-WARNING                     24850007
248600         END-IF                                                   24860007
248700     ELSE                                                         24870007
248800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24880007
248900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24890007
249000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24900007
249100             SET DP020-MSG-WARNING TO TRUE                        24910007
249200             PERFORM 4431-POSITION-AT-WARNING                     24920007
249300         END-IF                                                   24930007
249400     END-IF.                                                      24940007
249500******************************************************************24950007
249600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **24960007
249700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **24970007
249800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **24980007
249900** POSITION THE CURSOR THERE.                                   **24990007
250000******************************************************************25000007
250100 4431-POSITION-AT-WARNING.                                        25010007
250200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25020007
250300                    - PV-TOP-ITEM + 1.                            25030007
250400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25040007
250500         CONTINUE                                                 25050007
250600     ELSE                                                         25060007
250700         SET DP030-SET-CURSOR-APPL-1                              25070007
250800                                   TO TRUE                        25080007
250900         MOVE -1                   TO MR-SELECTL (PV-SUB)         25090007
251000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25100007
251100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25110007
251200     END-IF.                                                      25120007
251300*                                                                 25130007
251400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25140007
251500                    - PV-TOP-ITEM + 1.                            25150007
251600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25160007
251700         CONTINUE                                                 25170007
251800     ELSE                                                         25180007
251900         SET DP030-SET-CURSOR-APPL-1                              25190007
252000                                   TO TRUE                        25200007
252100         MOVE -1                   TO MR-SELECTL (PV-SUB)         25210007
252200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25220007
252300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25230007
252400     END-IF.                                                      25240007
252500 EJECT                                                            25250007
252600*----------------------------------------------------------------*25260007
252700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25270007
252800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25280007
252900* FOR THE SELECTED ITEMS QUEUE.                                  *25290007
253000*                                                                *25300007
253100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25310007
253200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25320007
253300* THE ARRAY IS FULL.                                             *25330007
253400*----------------------------------------------------------------*25340007
253500                                                                  25350007
253600 5000-PREPARE-SEL-QUEUE.                                          25360007
253700                                                                  25370007
253800     MOVE +1                   TO  ASC-BLK-SUB.                   25380007
253900     PERFORM 5100-WRITE-TEMP-STORAGE.                             25390007
254000     ADD +1                    TO  ASC-BLK-SUB.                   25400007
254100     PERFORM 5100-WRITE-TEMP-STORAGE.                             25410007
254200                                                                  25420007
254300     MOVE ASC-SEL-QUEUE-NAME   TO PC000-SEL-QUEUE-NAME.           25430007
254400     PERFORM 6010-DELETE-SEL-QUEUE.                               25440007
254500                                                                  25450007
254600     SET ASC-UPDATE-TSQ        TO TRUE.                           25460007
254700                                                                  25470007
254800     MOVE ZERO                 TO PC000-NUMBER-OF-TS-ITEMS.       25480007
254900     INITIALIZE PC016-TS-SEL-REC.                                 25490007
255000                                                                  25500007
255100     SET PC016-IDX             TO 1.                              25510007
255200     MOVE 20                   TO PC016-MAX-ITEMS                 25520007
255300                                                                  25530007
255400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25540007
255500             VARYING PV-ITEM                                      25550007
255600             FROM 1 BY 1                                          25560007
255700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25570007
255800                                                                  25580007
255900     IF  PC016-IDX > 1                                            25590007
256000         PERFORM 5205-WRITE-SEL-QUEUE                             25600007
256100         ADD +1                TO PC000-NUMBER-OF-TS-ITEMS        25610007
256200     END-IF.                                                      25620007
256300 EJECT                                                            25630007
256400*----------------------------------------------------------------*25640007
256500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25650007
256600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25660007
256700*----------------------------------------------------------------*25670007
256800                                                                  25680007
256900 5100-WRITE-TEMP-STORAGE.                                         25690007
257000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25700007
257100                                   TO PV-LIST-ITEM-NUMBER.        25710007
257200     COMPUTE PV-BLOCK-NUMBER =                                    25720007
257300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25730007
257400                                                                  25740007
257500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25750007
257600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25760007
257700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25770007
257800             PERFORM 5105-REWRITE-ASC-LISTQ                       25780007
257900         END-IF                                                   25790007
258000     ELSE                                                         25800007
258100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25810007
258200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25820007
258300         PERFORM 5110-WRITE-ASC-LISTQ                             25830007
258400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25840007
258500     END-IF.                                                      25850007
258600                                                                  25860007
258700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25870007
258800******************************************************************25880007
258900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **25890007
259000** SPECIFIC COMMAREA.                                           **25900007
259100******************************************************************25910007
259200 5105-REWRITE-ASC-LISTQ.                                          25920007
259300     EXEC CICS                                                    25930007
259400         WRITEQ TS                                                25940007
259500             QUEUE (ASC-LIST-QUEUE-NAME)                          25950007
259600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25960007
259700             ITEM  (PV-BLOCK-NUMBER)                              25970007
259800             REWRITE                                              25980007
259900             RESP  (PV-CICS-RESP)                                 25990007
260000     END-EXEC.                                                    26000007
260100                                                                  26010007
260200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26020007
260300         CONTINUE                                                 26030007
260400     ELSE                                                         26040007
260500         SET DP013-CICS-ABEND            TO TRUE                  26050007
260600         SET DP013-NO-ROLLBACK           TO TRUE                  26060007
260700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       26070007
260800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26080007
260900                                         TO DP013-MESSAGE-TEXT(1) 26090007
261000         PERFORM DP013-0000-PROCESS-ABEND                         26100007
261100     END-IF.                                                      26110007
261200                                                                  26120007
261300******************************************************************26130007
261400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **26140007
261500** SPECIFIC COMMAREA.                                           **26150007
261600******************************************************************26160007
261700 5110-WRITE-ASC-LISTQ.                                            26170007
261800     EXEC CICS                                                    26180007
261900         WRITEQ TS                                                26190007
262000             QUEUE (ASC-LIST-QUEUE-NAME)                          26200007
262100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26210007
262200             ITEM  (PV-BLOCK-NUMBER)                              26220007
262300             RESP  (PV-CICS-RESP)                                 26230007
262400     END-EXEC.                                                    26240007
262500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26250007
262600         SET DP013-CICS-ABEND      TO TRUE                        26260007
262700         SET DP013-NO-ROLLBACK     TO TRUE                        26270007
262800         MOVE '5110-WRITE-ASC-LISTQ'                              26280007
262900                                   TO DP013-PARAGRAPH             26290007
263000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26300007
263100                                   TO DP013-MESSAGE-TEXT(1)       26310007
263200         PERFORM DP013-0000-PROCESS-ABEND                         26320007
263300     END-IF.                                                      26330007
263400 EJECT                                                            26340007
263500*----------------------------------------------------------------*26350007
263600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26360007
263700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26370007
263800*----------------------------------------------------------------*26380007
263900                                                                  26390007
264000 5200-FILL-SEL-QUEUE-RECORD.                                      26400007
264100                                                                  26410007
264200     PERFORM 6112-READ-LIST-QUEUE.                                26420007
264300                                                                  26430007
264400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26440007
264500         PERFORM                                                  26450007
264600         VARYING LQW-IDX                                          26460007
264700         FROM 1 BY 1                                              26470007
264800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26480007
264900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26490007
265000                                                                  26500007
265100             IF  LQW-SELECT (LQW-IDX)                             26510007
265200                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26520007
265300                                   TO PC016-ITEM (PC016-IDX)      26530007
265400                 MOVE LQW-PO-NBR   (LQW-IDX)                      26540007
265500                                   TO PC016-PO-NBR (PC016-IDX)    26550007
265600                 MOVE LQW-REC-SEQ-NBR    (LQW-IDX)                26560007
265700                                   TO PC016-REC-SEQ-NBR           26570007
265800                                        (PC016-IDX)               26580007
265900                 MOVE LQW-OPR-ID         (LQW-IDX)                26590007
266000                                   TO PC016-OPER-UNT-ID           26600007
266100                                        (PC016-IDX)               26610007
266200                 MOVE LQW-FACT           (LQW-IDX)                26620007
266300                                   TO PC016-FCLTY-ID              26630007
266400                                        (PC016-IDX)               26640007
266500                 SET PC016-IDX UP BY 1                            26650007
266600                 IF  PC016-IDX > PC016-MAX-ITEMS                  26660007
266700                     PERFORM 5205-WRITE-SEL-QUEUE                 26670007
266800                     ADD +1        TO PC000-NUMBER-OF-TS-ITEMS    26680007
266900                     INITIALIZE PC016-SELECTED-ITEM-ARRAY         26690007
267000                     SET PC016-IDX TO  1                          26700007
267100                 END-IF                                           26710007
267200             END-IF                                               26720007
267300         END-PERFORM                                              26730007
267400     END-IF.                                                      26740007
267500                                                                  26750007
267600*----------------------------------------------------------------*26760007
267700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26770007
267800*----------------------------------------------------------------*26780007
267900                                                                  26790007
268000 5205-WRITE-SEL-QUEUE.                                            26800007
268100                                                                  26810007
268200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26820007
268300                                   TO PC016-SELECTED-ITEMS.       26830007
268400                                                                  26840007
268500     EXEC CICS                                                    26850007
268600          WRITEQ TS                                               26860007
268700              QUEUE (ASC-SEL-QUEUE-NAME)                          26870007
268800              FROM  (PC016-TS-SEL-REC)                            26880007
268900              ITEM  (PV-SEL-QUEUE-ITEM)                           26890007
269000              RESP  (PV-CICS-RESP)                                26900007
269100     END-EXEC.                                                    26910007
269200                                                                  26920007
269300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26930007
269400         CONTINUE                                                 26940007
269500     ELSE                                                         26950007
269600         SET DP013-CICS-ABEND      TO TRUE                        26960007
269700         SET DP013-NO-ROLLBACK     TO TRUE                        26970007
269800         MOVE '5205-WRITE-SEL-QUEUE'                              26980007
269900                                   TO DP013-PARAGRAPH             26990007
270000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27000007
270100                                   TO DP013-MESSAGE-TEXT(1)       27010007
270200         PERFORM DP013-0000-PROCESS-ABEND                         27020007
270300     END-IF.                                                      27030007
270400 EJECT                                                            27040007
270500******************************************************************27050007
270600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **27060007
270700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **27070007
270800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **27080007
270900** THE USER.                                                    **27090007
271000******************************************************************27100007
271100 6000-REFRESH-PANEL-FROM-TEMP.                                    27110007
271200     IF  ASC-UPDATE-TSQ                                           27120007
271300         SET ASC-NO-TSQ-UPDATE TO TRUE                            27130007
271400         MOVE ZERO                 TO PV-SAVE-ITEM                27140007
271500                                      PV-SEL-QUEUE-ITEM           27150007
271600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        27160007
271700                                   TO PV-HOLD-SELECTED-ITEMS      27170007
271800         PERFORM 6100-UPDATE-TSQ                                  27180007
271900             UNTIL PV-ITEMS-PROCESSED >                           27190007
272000                                     ASC-NUMBER-OF-SELECTED-ITEMS 27200007
272100         PERFORM 6010-DELETE-SEL-QUEUE                            27210007
272200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27220007
272300                    ASC-BLOCK-ENTRIES (2)                         27230007
272400     END-IF.                                                      27240007
272500                                                                  27250007
272600*----------------------------------------------------------------*27260007
272700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27270007
272800*----------------------------------------------------------------*27280007
272900 6010-DELETE-SEL-QUEUE.                                           27290007
273000                                                                  27300007
273100     EXEC CICS                                                    27310007
273200         DELETEQ TS                                               27320007
273300             QUEUE (ASC-SEL-QUEUE-NAME)                           27330007
273400             RESP  (PV-CICS-RESP)                                 27340007
273500     END-EXEC.                                                    27350007
273600*                                                                 27360007
273700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27370007
273800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         27380007
273900         CONTINUE                                                 27390007
274000     ELSE                                                         27400007
274100         SET DP013-CICS-ABEND TO TRUE                             27410007
274200         SET DP013-NO-ROLLBACK TO TRUE                            27420007
274300         MOVE '6010-DELETE-SEL-QUEUE'                             27430007
274400                        TO DP013-PARAGRAPH                        27440007
274500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27450007
274600                        TO DP013-MESSAGE-TEXT (1)                 27460007
274700         PERFORM DP013-0000-PROCESS-ABEND                         27470007
274800     END-IF.                                                      27480007
274900                                                                  27490007
275000*----------------------------------------------------------------*27500007
275100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27510007
275200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27520007
275300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27530007
275400*    THE TEMP QUEUE.                                             *27540007
275500*----------------------------------------------------------------*27550007
275600                                                                  27560007
275700 6100-UPDATE-TSQ.                                                 27570007
275800                                                                  27580007
275900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27590007
276000     PERFORM 6105-READ-SEL-QUEUE.                                 27600007
276100     PERFORM                                                      27610007
276200         VARYING PC016-IDX                                        27620007
276300         FROM 1 BY 1                                              27630007
276400         UNTIL ((PV-ITEMS-PROCESSED >                             27640007
276500                              PV-HOLD-SELECTED-ITEMS)             27650007
276600         OR (PC016-IDX GREATER THAN PC016-MAX-ITEMS))             27660007
276700         IF  PC016-ACTION-SW (PC016-IDX) > SPACE                  27670007
276800             PERFORM 6110-PROCESS-ITEMS                           27680007
276900         END-IF                                                   27690007
277000         ADD +1                TO PV-ITEMS-PROCESSED              27700007
277100     END-PERFORM.                                                 27710007
277200     PERFORM 6111-WRITE-LIST-QUEUE.                               27720007
277300*----------------------------------------------------------------*27730007
277400*    READ THE LIST QUEUE RECORD.                                 *27740007
277500*----------------------------------------------------------------*27750007
277600                                                                  27760007
277700 6105-READ-SEL-QUEUE.                                             27770007
277800                                                                  27780007
277900     EXEC CICS                                                    27790007
278000          READQ TS                                                27800007
278100              QUEUE (ASC-SEL-QUEUE-NAME)                          27810007
278200              INTO  (PC016-TS-SEL-REC)                            27820007
278300              ITEM  (PV-SEL-QUEUE-ITEM)                           27830007
278400              RESP  (PV-CICS-RESP)                                27840007
278500     END-EXEC.                                                    27850007
278600*                                                                 27860007
278700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27870007
278800         CONTINUE                                                 27880007
278900     ELSE                                                         27890007
279000         SET DP013-CICS-ABEND      TO  TRUE                       27900007
279100         SET DP013-NO-ROLLBACK     TO  TRUE                       27910007
279200         MOVE '6105-READ-SEL-QUEUE'                               27920007
279300                                   TO  DP013-PARAGRAPH            27930007
279400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27940007
279500                                   TO  DP013-MESSAGE-TEXT(1)      27950007
279600         PERFORM DP013-0000-PROCESS-ABEND                         27960007
279700     END-IF.                                                      27970007
279800 EJECT                                                            27980007
279900*----------------------------------------------------------------*27990007
280000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*28000007
280100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*28010007
280200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *28020007
280300*----------------------------------------------------------------*28030007
280400                                                                  28040007
280500 6110-PROCESS-ITEMS.                                              28050007
280600                                                                  28060007
280700     COMPUTE PV-ITEM = 1 + ((PC016-ITEM (PC016-IDX) - 1)          28070007
280800                     / PC-ITEMS-PER-PANEL).                       28080007
280900                                                                  28090007
281000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           28100007
281100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          28110007
281200             PERFORM 6111-WRITE-LIST-QUEUE                        28120007
281300         END-IF                                                   28130007
281400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    28140007
281500                                                                  28150007
281600         PERFORM 6112-READ-LIST-QUEUE                             28160007
281700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               28170007
281800             CONTINUE                                             28180007
281900         END-IF                                                   28190007
282000     END-IF.                                                      28200007
282100                                                                  28210007
282200     COMPUTE PV-SUB = (PC016-ITEM (PC016-IDX)                     28220007
282300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28230007
282400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         28240007
282500     MOVE LQW-SELECTED-SW (PV-SUB)                                28250007
282600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  28260007
282700*    EVALUATE TRUE                                                28270007
282800*        WHEN PC016-INQ (PC016-IDX)                               28280007
282900*             MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             28290007
283000*                                                                 28300007
283100*        WHEN PC016-UPD (PC016-IDX)                               28310007
283200*             MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             28320007
283300*                                                                 28330007
283400*        WHEN PC016-DEL (PC016-IDX)                               28340007
283500*             MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             28350007
283600*                                                                 28360007
283700*        WHEN PC016-ERR (PC016-IDX)                               28370007
283800*             MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             28380007
283900*    END-EVALUATE.                                                28390007
284000                                                                  28400007
284100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28410007
284200                                                                  28420007
284300*----------------------------------------------------------------*28430007
284400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28440007
284500*----------------------------------------------------------------*28450007
284600                                                                  28460007
284700 6111-WRITE-LIST-QUEUE.                                           28470007
284800                                                                  28480007
284900     EXEC CICS                                                    28490007
285000         WRITEQ TS                                                28500007
285100             QUEUE (ASC-LIST-QUEUE-NAME)                          28510007
285200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28520007
285300             ITEM  (PV-SAVE-ITEM)                                 28530007
285400             REWRITE                                              28540007
285500             RESP  (PV-CICS-RESP)                                 28550007
285600     END-EXEC.                                                    28560007
285700*                                                                 28570007
285800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28580007
285900         CONTINUE                                                 28590007
286000     ELSE                                                         28600007
286100         SET DP013-CICS-ABEND  TO  TRUE                           28610007
286200         SET DP013-NO-ROLLBACK TO  TRUE                           28620007
286300         MOVE '6111-WRITE-LIST-QUEUE'                             28630007
286400                               TO  DP013-PARAGRAPH                28640007
286500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28650007
286600                               TO  DP013-MESSAGE-TEXT(1)          28660007
286700         PERFORM DP013-0000-PROCESS-ABEND                         28670007
286800     END-IF.                                                      28680007
286900                                                                  28690007
287000 EJECT                                                            28700007
287100*----------------------------------------------------------------*28710007
287200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28720007
287300*----------------------------------------------------------------*28730007
287400                                                                  28740007
287500 6112-READ-LIST-QUEUE.                                            28750007
287600                                                                  28760007
287700     EXEC CICS                                                    28770007
287800         READQ TS                                                 28780007
287900             QUEUE (ASC-LIST-QUEUE-NAME)                          28790007
288000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28800007
288100             ITEM  (PV-ITEM)                                      28810007
288200             RESP  (PV-CICS-RESP)                                 28820007
288300     END-EXEC.                                                    28830007
288400*                                                                 28840007
288500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28850007
288600         CONTINUE                                                 28860007
288700     ELSE                                                         28870007
288800         SET DP013-CICS-ABEND        TO TRUE                      28880007
288900         SET DP013-NO-ROLLBACK       TO TRUE                      28890007
289000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28900007
289100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28910007
289200                                     TO DP013-MESSAGE-TEXT(1)     28920007
289300         PERFORM DP013-0000-PROCESS-ABEND                         28930007
289400     END-IF.                                                      28940007
289500                                                                  28950007
289600 EJECT                                                            28960007
289700*----------------------------------------------------------------*28970007
289800*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *28980007
289900*    AND THE ERROR SWITCHES.                                     *28990007
290000*----------------------------------------------------------------*29000007
290100 9900-SOFT-ABORT.                                                 29010007
290200     SET PS-ERROR         TO TRUE.                                29020007
290300     SET DP020-MSG-FATAL  TO TRUE.                                29030007
290400     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    29040007
290500     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       29050007
290600     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          29060007
290700     PERFORM 0001-CALL-CICS-ARCH-API.                             29070007
290800                                                                  29080007
290900*----------------------------------------------------------------*29090007
291000*    ABEND PROCESSOR MODULE                                      *29100007
291100*----------------------------------------------------------------*29110007
291200                                                                  29120007
291300     COPY DPPD013.                                                29130007
