000100*************************                                         00010012
000200 IDENTIFICATION DIVISION.                                         00020012
000300*************************                                         00030012
000400 PROGRAM-ID.    MBKCS119.                                         00040012
000500 AUTHOR.        MIKE FURLICK.                                     00050012
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060012
000700 DATE-WRITTEN.  11-8-91.                                          00070012
000800 DATE-COMPILED.                                                   00080012
000900                                                                  00090012
001000***************************************************************** 00100012
001100*    R119 - APPLICATION SYSTEM AVAILABLE ADDITION                 00110012
001200*                                                                 00120012
001300*    THIS PROGRAM FIRST DISPLAYS A BLANK PANEL, ON WHICH THE      00130012
001400*    OPERATOR MUST ENTER THE EFFECTIVE START DATE, CREATE         00140012
001500*    APPLICATION SYSTEM AVAILABLE CODE, AND LIKE APPLICATION      00150012
001600*    SYSTEM AVAILABLE CODE.  NEXT, THESE FIELDS ARE PROTECTED     00160012
001700*    AND A LIST IS PRODUCED FROM WHICH THE OPERATOR MAY SELECT    00170012
001800*    LINE ITEMS TO BE ADDED UNDER THE CREATE APPLICATION          00180012
001900*    SYSTEM.  THE PF15 KEY IS USED TO BEGIN THE CREATE PROCESS.   00190012
002000*    FULL FUNCTIONAL LIST KEY USAGE IS ALSO PROVIDED.             00200012
002100*                                                                 00210012
002200***************************************************************** 00220012
002300*    06/18/98  DOUG DOUGLAS   STRATAGEM    WR#:6041               00230012
002400*              - UPDATE FOR Y2K                                   00240012
002500*              - REPLACE ++INCLUDES WITH COPY'S (STDS)            00250012
002600***************************************************************** 00260012
262978* CHANGED 10/22/2021    BY JIM HUNTER      WR: CHG0262978         00261013
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00262013
262978* MAKING THE CALL DYNAMIC VS STATIC.                              00263013
262978******************************************************************00264013
002700*                                                                 00270012
002800*                                                                 00280012
002900*                                                                 00290012
003000 ENVIRONMENT DIVISION.                                            00300012
003100*                                                                 00310012
003200*                                                                 00320012
003300*                                                                 00330012
003400 DATA DIVISION.                                                   00340012
003500*                                                                 00350012
003600*                                                                 00360012
003700 WORKING-STORAGE SECTION.                                         00370012
003800*                                                                 00380012
003900 01  PC-PROGRAM-CONSTANTS.                                        00390012
004000     05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.00400012
004100     05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072  00410012
004200                                                     COMP SYNC.   00420012
004300     05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE        00430012
004400     'MB119A  '.                                                  00440012
004500     05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE        00450012
004600     'MBKM119 '.                                                  00460012
004700     05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE        00470012
004800     'MBKCS119'.                                                  00480012
004900     05  PC-BEGINNING                   PIC X(01)    VALUE 'B'.   00490012
005000     05  PC-ENDING                      PIC X(01)    VALUE 'E'.   00500012
005100     05  PC-SELECTED                    PIC X(01)    VALUE 'S'.   00510012
005200     05  PC-ITEMS-PER-PANEL             PIC S9(04)   VALUE +11    00520012
005300                                                     COMP SYNC.   00530012
005400     05  PC-ITEMS-PER-BLOCK             PIC S9(04)   VALUE +15    00540012
005500                                                     COMP SYNC.   00550012
005600     05  PC-MAX-ITEMS-TO-BE-READ        PIC S9(04)   VALUE +100   00560012
005700                                                     COMP SYNC.   00570012
005800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)   VALUE +2     00580012
005900                                                     COMP SYNC.   00590012
006000     05  PC-MAX-APLSYS-CODES            PIC S9(03)   VALUE +200   00600012
006100                                                     COMP-3.      00610012
006200     05  PC-MAX-ITEMS                   PIC S9(09)   VALUE        00620012
006300                                                     +1000000     00630012
006400                                                     COMP-3.      00640012
006500     05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314  00650012
006600                                                     COMP SYNC.   00660012
006700     05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5     00670012
006800                                                     COMP SYNC.   00680012
006900     05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128   00690012
007000                                                     COMP SYNC.   00700012
007100     05  FILLER REDEFINES PC-ERASE-EOF-COMP.                      00710012
007200         10  FILLER                     PIC X(01).                00720012
007300         10  PC-ERASE-EOF               PIC X(01).                00730012
007400     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00740012
007500                                                     COMP-3.      00750012
007600     05  PC-NO-DISPLAY-DATE             PIC X(10)    VALUE        00760012
007700                                                     '9999-09-09'.00770012
007800     05  PC-COMPANY                     PIC X(2)     VALUE '03'.  00780012
007900*                                                                 00790012
008000 01  PC-TSYMSG-NUMBERS.                                           00800012
008100     05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.  00810012
008200     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00820012
008300     05  PC-TSYMSG-00009                PIC 9(5)    VALUE 00009.  00830012
008400     05  PC-TSYMSG-00025                PIC 9(5)    VALUE 00025.  00840012
008500     05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.  00850012
008600     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00860012
008700     05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.  00870012
008800     05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.  00880012
008900     05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.  00890012
009000     05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.  00900012
009100     05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.  00910012
009200     05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.  00920012
009300     05  PC-TSYMSG-00059                PIC 9(5)    VALUE 00059.  00930012
009400     05  PC-TSYMSG-00067                PIC 9(5)    VALUE 00067.  00940012
009500     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00950012
009600     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00960012
009700     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00970012
009800     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00980012
009900     05  PC-TSYMSG-00207                PIC 9(5)    VALUE 00207.  00990012
010000     05  PC-TSYMSG-99901                PIC 9(5)    VALUE 99901.  01000012
010100*                                                                 01010012
010200 01  PM-PROGRAM-MESSAGES.                                         01020012
010300     05  PM-PROGRAM-MESSAGE-9           PIC X(78)    VALUE        01030012
010400     'ERROR TRYING TO REWRITE  TEMP STORAGE QUEUE - RESP '.       01040012
010500     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-9.                   01050012
010600         10  FILLER                     PIC X(51).                01060012
010700         10  PM-RESP-9                  PIC Z(03)9-.              01070012
010800         10  FILLER                     PIC X(22).                01080012
010900     05  PM-PROGRAM-MESSAGE-10          PIC X(78)    VALUE        01090012
011000     'ERROR TRYING TO WRITE TO TEMP STORAGE QUEUE - RESP '.       01100012
011100     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-10.                  01110012
011200         10  FILLER                     PIC X(51).                01120012
011300         10  PM-RESP-10                 PIC Z(03)9-.              01130012
011400         10  FILLER                     PIC X(22).                01140012
011500     05  PM-PROGRAM-MESSAGE-11          PIC X(78)    VALUE        01150012
011600     'LOGIC ERROR IN TRYING TO WRITE TO TEMP STORAGE QUEUE - BLOCK01160012
011700-    '     '.                                                     01170012
011800     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-11.                  01180012
011900         10  FILLER                     PIC X(61).                01190012
012000         10  PM-BLOCK-NUMBER            PIC Z(03)9-.              01200012
012100         10  FILLER                     PIC X(12).                01210012
012200     05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE        01220012
012300     'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                01230012
012400     05  PM-PROGRAM-MESSAGE-23          PIC X(78)    VALUE        01240012
012500     'ERROR TRYING TO DELETE TEMP STORAGE QUEUE - RESP '.         01250012
012600     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-23.                  01260012
012700         10  FILLER                     PIC X(49).                01270012
012800         10  PM-RESP-23                 PIC Z(03)9-.              01280012
012900         10  FILLER                     PIC X(24).                01290012
013000     05  PM-PROGRAM-MESSAGE-24          PIC X(78)    VALUE        01300012
013100     'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE - RESP '.      01310012
013200     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-24.                  01320012
013300         10  FILLER                     PIC X(52).                01330012
013400         10  PM-RESP-24                 PIC Z(03)9-.              01340012
013500         10  FILLER                     PIC X(21).                01350012
013600     05  PM-PROGRAM-MESSAGE-28          PIC X(78)    VALUE        01360012
013700     'ERROR OCCURRED DURING TS QUEUE PROCESSING'.                 01370012
013800*                                                                 01380012
013900 01  PS-PROGRAM-SUBSCRIPTS.                                       01390012
014000     05  PS-SUB                         PIC S9(04)   VALUE +0     01400012
014100                                                     COMP SYNC.   01410012
014200     05  PS-AS-SUB1                     PIC S9(04)   VALUE +0     01420012
014300                                                     COMP SYNC.   01430012
014400     05  PS-AS-SUB2                     PIC S9(04)   VALUE +0     01440012
014500                                                     COMP SYNC.   01450012
014600     05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0     01460012
014700                                                     COMP-3.      01470012
014800                                                                  01480012
014900 01  PS-PROGRAM-SWITCHES.                                         01490012
015000     05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.   01500012
015100         88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.   01510012
015200         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.   01520012
015300         88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.   01530012
015400         88  PS-SEND-DATA-ONLY                       VALUE '4'.   01540012
015500         88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.   01550012
015600         88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.   01560012
015700     05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.   01570012
015800         88  PS-ERROR                                VALUE 'Y'.   01580012
015900         88  PS-NO-ERROR                             VALUE 'N'.   01590012
016000     05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.   01600012
016100         88  PS-INTER-APPL-VALID                     VALUE 'Y'.   01610012
016200         88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.   01620012
016300     05  PS-SAME-ITEMS-DISPLAYED-SW     PIC X(01)    VALUE 'N'.   01630012
016400         88  PS-SAME-ITEMS-DISPLAYED                 VALUE 'Y'.   01640012
016500         88  PS-DIFFERENT-ITEMS-DISPLAYED            VALUE 'N'.   01650012
016600     05  PS-CURSOR-POSITIONED-SW        PIC X(01)    VALUE 'N'.   01660012
016700         88  PS-CURSOR-POSITIONED                    VALUE 'Y'.   01670012
016800         88  PS-CURSOR-NOT-POSITIONED                VALUE 'N'.   01680012
016900     05  PS-VALID-SELECTIONS-SW         PIC X(01)    VALUE 'Y'.   01690012
017000         88  PS-VALID-SELECTIONS                     VALUE 'Y'.   01700012
017100         88  PS-INVALID-SELECTIONS                   VALUE 'N'.   01710012
017200     05  PS-VALID-BEG-ITEM-SW           PIC X(01)    VALUE 'N'.   01720012
017300         88  PS-VALID-BEG-ITEM                       VALUE 'Y'.   01730012
017400         88  PS-INVALID-BEG-ITEM                     VALUE 'N'.   01740012
017500     05  PS-TOP-ITEM-IN-ARRAY-SW        PIC X(01)    VALUE 'N'.   01750012
017600         88  PS-TOP-ITEM-IN-ARRAY                    VALUE 'Y'.   01760012
017700         88  PS-TOP-ITEM-NOT-IN-ARRAY                VALUE 'N'.   01770012
017800     05  PS-BOTTOM-ITEM-IN-ARRAY-SW     PIC X(01)    VALUE 'N'.   01780012
017900         88  PS-BOTTOM-ITEM-IN-ARRAY                 VALUE 'Y'.   01790012
018000         88  PS-BOTTOM-ITEM-NOT-IN-ARRAY             VALUE 'N'.   01800012
018100     05  PS-TOP-ITEM-IN-TEMP-SW         PIC X(01)    VALUE 'N'.   01810012
018200         88  PS-TOP-ITEM-IN-TEMP                     VALUE 'Y'.   01820012
018300         88  PS-TOP-ITEM-NOT-IN-TEMP                 VALUE 'N'.   01830012
018400     05  PS-BOTTOM-ITEM-IN-TEMP-SW      PIC X(01)    VALUE 'N'.   01840012
018500         88  PS-BOTTOM-ITEM-IN-TEMP                  VALUE 'Y'.   01850012
018600         88  PS-BOTTOM-ITEM-NOT-IN-TEMP              VALUE 'N'.   01860012
018700     05  PS-LAST-BLOCK-IN-ARRAY-SW      PIC X(01)    VALUE 'N'.   01870012
018800         88  PS-LAST-BLOCK-IN-ARRAY                  VALUE 'Y'.   01880012
018900         88  PS-LAST-BLOCK-NOT-IN-ARRAY              VALUE 'N'.   01890012
019000     05  PS-SELECTION-FOUND-SW          PIC X(01)    VALUE 'N'.   01900012
019100         88  PS-SELECTION-FOUND                      VALUE 'Y'.   01910012
019200         88  PS-NO-SELECTION-FOUND                   VALUE 'N'.   01920012
019300     05  PS-WARNING-SW                  PIC X(01)    VALUE 'N'.   01930012
019400         88  PS-WARNING                              VALUE 'Y'.   01940012
019500         88  PS-NO-WARNING                           VALUE 'N'.   01950012
019600     05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.   01960012
019700         88  PS-INFORMATIONAL                        VALUE 'Y'.   01970012
019800         88  PS-NOT-INFORMATIONAL                    VALUE 'N'.   01980012
019900     05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.   01990012
020000         88  PS-CONTINUE                             VALUE 'Y'.   02000012
020100         88  PS-DONT-PROCESS                         VALUE 'N'.   02010012
020200     05  PS-PROCESS-ITEM-SW             PIC X(01)    VALUE 'N'.   02020012
020300         88  PS-END-OF-ITEMS                         VALUE 'Y'.   02030012
020400         88  PS-NOT-END                              VALUE 'N'.   02040012
020500     05  PS-VALID-DATE-SW               PIC X(01)    VALUE 'N'.   02050012
020600         88  PS-VALID-DATE                           VALUE 'Y'.   02060012
020700         88  PS-INVALID-DATE                         VALUE 'N'.   02070012
020800     05  PS-APLAVL-READ-NEW-KEY-SW      PIC X(01)    VALUE 'N'.   02080012
020900         88  PS-USE-IT                               VALUE 'Y'.   02090012
021000         88  PS-ALREADY-EXISTS                       VALUE 'N'.   02100012
021100     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   02110012
021200         88  PS-COMMAREA-VALID                       VALUE 'Y'.   02120012
021300         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   02130012
021400     EJECT                                                        02140012
021500 01  PV-PROGRAM-VARIABLES.                                        02150012
021600     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     02160012
021700                                                     COMP SYNC.   02170012
021800     05  PV-HIGHEST-ITEM-TO-BE-READ     PIC S9(09)   VALUE +0     02180012
021900                                                     COMP-3.      02190012
022000     05  PV-ENDING-ITEM-ON-PANEL        PIC S9(09)   VALUE +0     02200012
022100                                                     COMP-3.      02210012
022200     05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0     02220012
022300                                                     COMP-3.      02230012
022400     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     02240012
022500                                                     COMP-3.      02250012
022600     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     02260012
022700                                                     COMP-3.      02270012
022800     05  PV-MAX-ITEMS-TO-BE-READ        PIC S9(09)   VALUE +0     02280012
022900                                                     COMP-3.      02290012
023000     05  PV-FIRST-ITEM-IN-ARRAY         PIC S9(09)   VALUE +0     02300012
023100                                                     COMP-3.      02310012
023200     05  PV-LAST-ITEM-IN-ARRAY          PIC S9(09)   VALUE +0     02320012
023300                                                     COMP-3.      02330012
023400     05  PV-LAST-ITEM-IN-TEMP           PIC S9(09)   VALUE +0     02340012
023500                                                     COMP-3.      02350012
023600     05  PV-BEGINNING-ITEM              PIC S9(09)   VALUE +0     02360012
023700                                                     COMP-3.      02370012
023800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)   VALUE +0     02380012
023900                                                     COMP-3.      02390012
024000     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     02400012
024100                                                     COMP SYNC.   02410012
024200     05  PV-RESP                        PIC S9(04)   VALUE +0     02420012
024300                                                     COMP SYNC.   02430012
024400     05  PV-ITEM                        PIC S9(04)   VALUE +0     02440012
024500                                                     COMP SYNC.   02450012
024600     05  PV-AS-ITEM                     PIC S9(04)   VALUE +0     02460012
024700                                                     COMP SYNC.   02470012
024800     05  PV-SAVE-ITEM                   PIC S9(04)   VALUE +0     02480012
024900                                                     COMP SYNC.   02490012
025000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     02500012
025100                                                     COMP SYNC.   02510012
025200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     02520012
025300                                                     COMP SYNC.   02530012
025400     05  PV-HOLD-ITEM-NUMBER            PIC S9(04)   VALUE +0     02540012
025500                                                     COMP SYNC.   02550012
025600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)   VALUE +0     02560012
025700                                                     COMP SYNC.   02570012
025800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0     02580012
025900                                                     COMP SYNC.   02590012
026000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0     02600012
026100                                                     COMP SYNC.   02610012
026200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)   VALUE +0     02620012
026300                                                     COMP SYNC.   02630012
026400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)   VALUE +0     02640012
026500                                                     COMP SYNC.   02650012
026600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)   VALUE +0     02660012
026700                                                     COMP SYNC.   02670012
026800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)   VALUE +0     02680012
026900                                                     COMP SYNC.   02690012
027000     05  PV-ITEMS-READ                  PIC S9(04)   VALUE +0     02700012
027100                                                     COMP SYNC.   02710012
027200     05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.02720012
027300     05  PV-SQL-SUB                     PIC S9(4)    COMP.        02730012
027400     05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.      02740012
027500     05  PV-BEGITMI.                                              02750012
027600         10  PV-BEGITMI-N               PIC 9(5).                 02760012
027700     05  PV-DISPLAY5                    PIC ZZZZ9.                02770012
027800     05  PV-BG-QUEUE-NAME.                                        02780012
027900         10  PV-BG-TERM-ID              PIC X(4).                 02790012
028000         10  PV-BG-TASK-NUMBER          PIC S9(7)    COMP-3.      02800012
028100     05  PV-DB2-WORK-DATE.                                        02810012
028200         10  PV-WD-CC                   PIC XX.                   02820012
028300         10  PV-WD-YY                   PIC XX.                   02830012
028400         10  FILLER                     PIC X.                    02840012
028500             88  PV-DASH1                            VALUE '-'.   02850012
028600         10  PV-WD-MM                   PIC XX.                   02860012
028700         10  FILLER                     PIC X.                    02870012
028800             88  PV-DASH2                            VALUE '-'.   02880012
028900         10  PV-WD-DD                   PIC XX.                   02890012
029000     05  PV-SCREEN-DATE.                                          02900012
029100         10  PV-SD-MM                   PIC XX.                   02910012
029200         10  FILLER                     PIC X        VALUE '/'.   02920012
029300         10  PV-SD-DD                   PIC XX.                   02930012
029400         10  FILLER                     PIC X        VALUE '/'.   02940012
029500         10  PV-SD-YY                   PIC XX.                   02950012
029600     05  PV-VALIDATE-DATE.                                        02960012
029700         10  PV-VD-CC                   PIC XX.                   02970012
029800         10  PV-VD-YY                   PIC XX.                   02980012
029900         10  PV-VD-MM                   PIC XX.                   02990012
030000         10  PV-VD-DD                   PIC XX.                   03000012
030100*                                                                 03010012
030200     05  PV-STORED-DATE.                                          03020012
030300         10  PV-STORED-CCYY             PIC 9999.                 03030012
030400     05  PV-STORED-DATE-X REDEFINES PV-STORED-DATE.               03040012
030500         10  PV-STORED-CC-X             PIC XX.                   03050012
030600         10  PV-STORED-YY-X             PIC XX.                   03060012
030700*                                                                 03070012
030800 EJECT                                                            03080012
030900***************************************************************** 03090012
031000*    STANDARD COMMAREA.                                           03100012
031100***************************************************************** 03110012
031200                                                                  03120012
031300     COPY DPWS020.                                                03130012
031400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03140012
031500                                                                  03150012
031600***************************************************************** 03160012
031700*    INTER-APPLICATION COMMAREA.                                  03170012
031800***************************************************************** 03180012
031900                                                                  03190012
032000         10  INTER-APPL-COMM-AREA       PIC X(200).               03200012
032100     COPY MBWS005.                                                03210012
032200***************************************************************** 03220012
032300*    SPECIFIC COMMMAREA FOR MBKCS120.                             03230012
032400***************************************************************** 03240012
032500         10  MB119-SPECIFIC-COMMAREA.                             03250012
032600             15  MB119-APPL-CURSOR-POSITION          PIC S9(04)   03260012
032700                                                     COMP.        03270012
032800             15  MB119-BLOCK-ENTRIES OCCURS 2 TIMES.              03280012
032900                 20  MB119-BLOCK-MODIFIED-SW         PIC X(01).   03290012
033000                     88  MB119-BLOCK-NOT-MODIFIED    VALUE 'N'.   03300012
033100                     88  MB119-BLOCK-MODIFIED        VALUE 'Y'.   03310012
033200                 20  MB119-ITEM-ARRAY.                            03320012
033300                     25  MB119-ITEM-ENTRIES OCCURS 15 TIMES.      03330012
033400                         30  MB119-LIST-ITEM-NUMBER               03340012
033500                                                     PIC S9(09)   03350012
033600                                                         COMP-3.  03360012
033700                         30  MB119-SELECTED-SW       PIC X(01).   03370012
033800                             88  MB119-NO-SELECT     VALUE ' '.   03380012
033900                             88  MB119-SELECT        VALUE 'S'.   03390012
034000                             88  MB119-BEGIN         VALUE 'B'.   03400012
034100                             88  MB119-END           VALUE 'E'.   03410012
034200                             88  MB119-ERROR         VALUE '*'.   03420012
034300                         30  MB119-ATTRIBUTE         PIC X.       03430012
034400                         30  MB119-HILIGHT           PIC X.       03440012
034500                         30  MB119-GMA               PIC XX.      03450012
034600                         30  MB119-DMA               PIC XX.      03460012
034700                         30  MB119-DEPT              PIC X(3).    03470012
034800                         30  MB119-MCLASS            PIC XX.      03480012
034900                         30  MB119-SCLASS            PIC X(3).    03490012
035000                         30  MB119-DESC              PIC X(25).   03500012
035100                         30  MB119-DB2-START         PIC X(10).   03510012
035200                         30  MB119-DB2-END           PIC X(10).   03520012
035300                         30  MB119-DKEY              PIC S9(15)   03530012
035400                                                         COMP-3.  03540012
035500*                                                                 03550012
035600             15  MB119-GMA-LIT                       PIC X(3).    03560012
035700                 88  MB119-GMA-LIT-ON                VALUE 'GMA'. 03570012
035800             15  MB119-DMA-LIT                       PIC X(3).    03580012
035900                 88  MB119-DMA-LIT-ON                VALUE 'DMA'. 03590012
036000             15  MB119-DPT-LIT                       PIC X(3).    03600012
036100                 88  MB119-DPT-LIT-ON                VALUE 'DPT'. 03610012
036200             15  MB119-MCL-LIT                       PIC X(3).    03620012
036300                 88  MB119-MCL-LIT-ON                VALUE 'MCL'. 03630012
036400             15  MB119-SCL-LIT                       PIC X(3).    03640012
036500                 88  MB119-SCL-LIT-ON                VALUE 'SCL'. 03650012
036600             15  MB119-END-DATE                      PIC X(10).   03660012
036700*                                                                 03670012
036800             15  MB119-SAVE-GMA-NBR                  PIC XX.      03680012
036900                 88  MB119-ALL-GMAS                  VALUE '* '   03690012
037000                                                           '**'   03700012
037100                                                           ' *'.  03710012
037200             15  MB119-SAVE-DMA-NBR                  PIC XX.      03720012
037300                 88  MB119-ALL-DMAS                  VALUE '* '   03730012
037400                                                           '**'   03740012
037500                                                           ' *'.  03750012
037600             15  MB119-SAVE-DEPT-NBR                 PIC X(3).    03760012
037700                 88  MB119-ALL-DEPTS                 VALUE '*  '  03770012
037800                                                           '** '  03780012
037900                                                           '***'  03790012
038000                                                           ' **'  03800012
038100                                                           '  *'. 03810012
038200             15  MB119-SAVE-MCLASS-NBR               PIC XX.      03820012
038300                 88  MB119-ALL-MCLASSES              VALUE '* '   03830012
038400                                                           '**'   03840012
038500                                                           ' *'.  03850012
038600             15  MB119-SAVE-SCLASS-NBR               PIC X(3).    03860012
038700                 88  MB119-ALL-SCLASSES              VALUE '*  '  03870012
038800                                                           '** '  03880012
038900                                                           '***'  03890012
039000                                                           ' **'  03900012
039100                                                           '  *'. 03910012
039200             15  MB119-COMPANY                       PIC XX.      03920012
039300             15  MB119-APPL-SYS-CDE                  PIC XX.      03930012
039400             15  MB119-APPL-SYS-DESC                 PIC X(20).   03940012
039500             15  MB119-NEW-APPL-SYS-CDE              PIC XX.      03950012
039600             15  MB119-NEW-APPL-SYS-DESC             PIC X(20).   03960012
039700             15  MB119-EFFECTIVE-START-DATE.                      03970012
039800                 20  MB119-ESD-CC                    PIC XX.      03980012
039900                 20  MB119-ESD-YY                    PIC XX.      03990012
040000                 20  MB119-ESD-MM                    PIC XX.      04000012
040100                 20  MB119-ESD-DD                    PIC XX.      04010012
040200             15  MB119-SAVE-SEQ-NBR                  PIC S9(15)   04020012
040300                                                         COMP-3.  04030012
040400*                                                                 04040012
040500             15  MB119-BLK-SUB                       PIC S9(04)   04050012
040600                                                         COMP     04060012
040700                                                         SYNC.    04070012
040800             15  MB119-ITEM-SUB                      PIC S9(04)   04080012
040900                                                         COMP     04090012
041000                                                         SYNC.    04100012
041100             15  MB119-NUMBER-OF-ITEMS-READ          PIC S9(09)   04110012
041200                                                         COMP-3.  04120012
041300             15  MB119-NUMBER-OF-SELECTED-ITEMS      PIC S9(09)   04130012
041400                                                         COMP-3.  04140012
041500             15  MB119-ITEM-AT-TOP-OF-PANEL          PIC S9(09)   04150012
041600                                                         COMP-3.  04160012
041700             15  MB119-ITEM-AT-BOT-OF-PANEL          PIC S9(09)   04170012
041800                                                         COMP-3.  04180012
041900             15  MB119-HIGHEST-BLOCK-WRITTEN         PIC S9(04)   04190012
042000                                                         COMP     04200012
042100                                                         SYNC.    04210012
042200             15  MB119-START-OF-SELECTED-RANGE       PIC S9(09)   04220012
042300                                                         COMP-3.  04230012
042400             15  MB119-END-OF-SELECTED-RANGE         PIC S9(09)   04240012
042500                                                         COMP-3.  04250012
042600             15  MB119-CURSOR-SW                     PIC X.       04260012
042700                 88  MB119-NO-CURSOR                   VALUE ' '. 04270012
042800                 88  MB119-MERCH-CURSOR                VALUE 'H'. 04280012
042900                 88  MB119-GMA-CURSOR                  VALUE 'G'. 04290012
043000                 88  MB119-DMA-CURSOR                  VALUE 'D'. 04300012
043100                 88  MB119-DEPT-CURSOR                 VALUE 'T'. 04310012
043200                 88  MB119-MCL-CURSOR                  VALUE 'M'. 04320012
043300                 88  MB119-SCL-CURSOR                  VALUE 'S'. 04330012
043400             15  MB119-PROCESS-SW                    PIC X.       04340012
043500                 88  MB119-FIRST-PASS                  VALUE 'Y'. 04350012
043600                 88  MB119-SECOND-PASS                 VALUE 'N'. 04360012
043700             15  MB119-ITEMS-LEFT-INDICATOR          PIC X.       04370012
043800                 88  MB119-ITEMS-LEFT-ON-DB            VALUE 'Y'. 04380012
043900                 88  MB119-NO-ITEMS-LEFT-ON-DB         VALUE 'N'. 04390012
044000             15  MB119-TEMP-QUEUE-UPDATE-SW          PIC X.       04400012
044100                 88  MB119-UPDATE-TSQ                  VALUE 'Y'. 04410012
044200                 88  MB119-DONT-UPDATE-TSQ             VALUE 'N'. 04420012
044300             15  MB119-TEMP-QUEUE-NAME.                           04430012
044400                 20  MB119-TERM-ID                   PIC X(4).    04440012
044500                 20  MB119-TASK-NUMBER               PIC S9(7)    04450012
044600                                                         COMP-3.  04460012
044700             15  MB119-LAST-APLSYS-CODE              PIC X(3).    04470012
044800             15  MB119-LIST-QUEUE-NAME               PIC X(8).    04480012
044900             15  MB119-SAVE-INTER-APPL-COMMAREA      PIC X(200).  04490012
045000*                                                                 04500012
045100     EJECT                                                        04510012
045200***************************************************************** 04520012
045300*    ABEND PROCESSING COPYBOOK.                                   04530012
045400***************************************************************** 04540012
045500                                                                  04550012
045600     COPY DPWS013.                                                04560012
045700                                                                  04570012
045800     EJECT                                                        04580012
045900***************************************************************** 04590012
046000*    DATE VALIDATION COPYBOOK.                                    04600012
046100***************************************************************** 04610012
046200                                                                  04620012
046300     COPY DPWS500.                                                04630012
046400                                                                  04640012
046500     EJECT                                                        04650012
046600***************************************************************** 04660012
046700*                                                                 04670012
046800***************************************************************** 04680012
046900                                                                  04690012
047000     COPY DPWS006.                                                04700012
047100                                                                  04710012
047200     EJECT                                                        04720012
047300***************************************************************** 04730012
047400*    ATTRIBUTE SETTINGS COPYBOOK.                                 04740012
047500***************************************************************** 04750012
047600                                                                  04760012
047700     COPY DPWS015.                                                04770012
047800                                                                  04780012
047900***************************************************************** 04790012
048000*    CURRENT DATE AND TIME COPYBOOK.                              04800012
048100***************************************************************** 04810012
048200                                                                  04820012
048300     COPY DPWS017.                                                04830012
048400                                                                  04840012
048500***************************************************************** 04850012
048600*    TOGGLE FUNCTION KEY LINES COPYBOOK.                          04860012
048700***************************************************************** 04870012
048800                                                                  04880012
048900     COPY DPWS009.                                                04890012
049000                                                                  04900012
049100***************************************************************** 04910012
049200*    FUNCTION KEYS COPYBOOK.                                      04920012
049300***************************************************************** 04930012
049400                                                                  04940012
049500     COPY DPWS016.                                                04950012
049600                                                                  04960012
049700***************************************************************** 04970012
049800*    DPKUT045 COPYBOOK.                                           04980012
049900***************************************************************** 04990012
050000                                                                  05000012
050100     COPY DPWS045.                                                05010012
050200                                                                  05020012
050300***************************************************************** 05030012
050400*    NUMERIC EDIT LAYOUT.                                         05040012
050500***************************************************************** 05050012
050600                                                                  05060012
050700     COPY DPWS010I.                                               05070012
050800                                                                  05080012
050900***************************************************************** 05090012
051000*    MESSAGE RECORD LAYOUT                                        05100012
051100***************************************************************** 05110012
051200                                                                  05120012
051300     COPY DPRD507I.                                               05130012
051400                                                                  05140012
051500***************************************************************** 05150012
051600*    STANDARD ATTENTION IDENTIFIER LIST                           05160012
051700***************************************************************** 05170012
051800                                                                  05180012
051900     COPY DFHAID.                                                 05190012
052000                                                                  05200012
052100***************************************************************** 05210012
052200*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST        05220012
052300***************************************************************** 05230012
052400                                                                  05240012
052500     COPY DFHBMSCA.                                               05250012
052600                                                                  05260012
052700***************************************************************** 05270012
052800*    MAP LAYOUT                                                   05280012
052900***************************************************************** 05290012
053000                                                                  05300012
053100     COPY MBKM119.                                                05310012
053200 01  MD-MAP-DATA-AREA  REDEFINES MB119AO PIC X(1800).             05320012
053300*                                                                 05330012
053400 01  MBKM119-OCCURS-LAYOUT  REDEFINES  MD-MAP-DATA-AREA.          05340012
053500     05  FILLER                PIC X(219).                        05350012
053600     05  MBKM119-SCROLL-AREA OCCURS 11 TIMES.                     05360012
053700         10  MBKM119-SELECTL   PIC S9(4) COMP.                    05370012
053800         10  MBKM119-SELECTA   PIC X.                             05380012
053900         10  MBKM119-SELECTC   PIC X.                             05390012
054000         10  MBKM119-SELECTH   PIC X.                             05400012
054100         10  MBKM119-SELECTI   PIC X.                             05410012
054200*                                                                 05420012
054300         10  FILLER            PIC X(5).                          05430012
054400         10  MBKM119-GMA       PIC XX.                            05440012
054500*                                                                 05450012
054600         10  FILLER            PIC X(5).                          05460012
054700         10  MBKM119-DMA       PIC XX.                            05470012
054800*                                                                 05480012
054900         10  FILLER            PIC X(5).                          05490012
055000         10  MBKM119-DEPT      PIC X(3).                          05500012
055100*                                                                 05510012
055200         10  FILLER            PIC X(5).                          05520012
055300         10  MBKM119-MCLASS    PIC XX.                            05530012
055400*                                                                 05540012
055500         10  FILLER            PIC X(5).                          05550012
055600         10  MBKM119-SCLASS    PIC X(3).                          05560012
055700*                                                                 05570012
055800         10  FILLER            PIC X(5).                          05580012
055900         10  MBKM119-DESC      PIC X(25).                         05590012
056000*                                                                 05600012
056100         10  FILLER            PIC X(5).                          05610012
056200         10  MBKM119-START     PIC X(8).                          05620012
056300*                                                                 05630012
056400         10  FILLER            PIC X(5).                          05640012
056500         10  MBKM119-END       PIC X(8).                          05650012
056600 EJECT                                                            05660012
056700*                                                                 05670012
056800*    DB2 AREA FOR TAPLSYS                                         05680012
056900*                                                                 05690012
057000     EXEC SQL                                                     05700012
057100          INCLUDE TAPLSYS                                         05710012
057200     END-EXEC.                                                    05720012
057300*                                                                 05730012
057400*    DB2 AREA FOR TAPLAVL                                         05740012
057500*                                                                 05750012
057600     EXEC SQL                                                     05760012
057700          INCLUDE TAPLAVL                                         05770012
057800     END-EXEC.                                                    05780012
057900*                                                                 05790012
058000*    DB2 AREA FOR TMDSEAR                                         05800012
058100*                                                                 05810012
058200     EXEC SQL                                                     05820012
058300          INCLUDE TMDSEAR                                         05830012
058400     END-EXEC.                                                    05840012
058500*                                                                 05850012
058600*    DB2 AREA FOR COMMUNICATIONS                                  05860012
058700*                                                                 05870012
058800     EXEC SQL                                                     05880012
058900          INCLUDE SQLCA                                           05890012
059000     END-EXEC.                                                    05900012
059100******************************                                    05910012
059200*    CURSOR DECLARE AREA.    *                                    05920012
059300******************************                                    05930012
059400*                                                                 05940012
059500*    DECLARE FOR THE MERCH-LIST                                   05950012
059600*                                                                 05960012
059700     EXEC SQL                                                     05970012
059800         DECLARE MERCH-LIST CURSOR FOR                            05980012
059900             SELECT                                               05990012
060000                     A.OPERCO_NBR                                 06000012
060100                   , A.GMA_NBR                                    06010012
060200                   , A.DMA_NBR                                    06020012
060300                   , A.DEPT_NBR                                   06030012
060400                   , A.MAJ_CL_NBR                                 06040012
060500                   , A.SUB_CL_NBR                                 06050012
060600                   , A.MDSELV_CDE                                 06060012
060700                   , A.STRT_DTE                                   06070012
060800                   , A.END_DTE                                    06080012
060900                   , A.MDSEAR_DESC                                06090012
061000                   , A.LIST_SEQ_NBR                               06100012
061100                   , A.MDSEAR_DKEY                                06110012
061200               FROM                                               06120012
061300                     TMDSEAR A                                    06130012
061400                   , TAPLAVL B                                    06140012
061500              WHERE                                               06150012
061600                     A.OPERCO_NBR    =  :PC-COMPANY               06160012
061700                AND  A.LIST_SEQ_NBR  >  :MB119-SAVE-SEQ-NBR       06170012
061800                AND  A.END_DTE       >  :MB119-END-DATE           06180012
061900                AND (A.MDSELV_CDE    =  :MB119-GMA-LIT  OR        06190012
062000                     A.MDSELV_CDE    =  :MB119-DMA-LIT  OR        06200012
062100                     A.MDSELV_CDE    =  :MB119-DPT-LIT  OR        06210012
062200                     A.MDSELV_CDE    =  :MB119-MCL-LIT  OR        06220012
062300                     A.MDSELV_CDE    =  :MB119-SCL-LIT)           06230012
062400                AND  A.MDSEAR_DKEY   =  B.MDSEAR_DKEY             06240012
062500                AND  B.OPERCO_NBR    =  :PC-COMPANY               06250012
062600                AND  B.APLSYS_CDE    =  :MB119-APPL-SYS-CDE       06260012
062700           ORDER BY                                               06270012
062800                     A.OPERCO_NBR                                 06280012
062900                   , A.GMA_NBR                                    06290012
063000                   , A.DMA_NBR                                    06300012
063100                   , A.DEPT_NBR                                   06310012
063200                   , A.MAJ_CL_NBR                                 06320012
063300                   , A.SUB_CL_NBR                                 06330012
063400     END-EXEC.                                                    06340012
063500                                                                  06350012
063600*                                                                 06360012
063700*    DECLARE FOR THE GMA-LIST                                     06370012
063800*                                                                 06380012
063900     EXEC SQL                                                     06390012
064000         DECLARE GMA-LIST CURSOR FOR                              06400012
064100             SELECT                                               06410012
064200                     A.OPERCO_NBR                                 06420012
064300                   , A.GMA_NBR                                    06430012
064400                   , A.DMA_NBR                                    06440012
064500                   , A.DEPT_NBR                                   06450012
064600                   , A.MAJ_CL_NBR                                 06460012
064700                   , A.SUB_CL_NBR                                 06470012
064800                   , A.MDSELV_CDE                                 06480012
064900                   , A.STRT_DTE                                   06490012
065000                   , A.END_DTE                                    06500012
065100                   , A.MDSEAR_DESC                                06510012
065200                   , A.LIST_SEQ_NBR                               06520012
065300                   , A.MDSEAR_DKEY                                06530012
065400               FROM                                               06540012
065500                     TMDSEAR A                                    06550012
065600                   , TAPLAVL B                                    06560012
065700              WHERE                                               06570012
065800                     A.OPERCO_NBR    =  :PC-COMPANY               06580012
065900                AND  A.GMA_NBR       =  :MB119-SAVE-GMA-NBR       06590012
066000                AND  A.END_DTE       >  :MB119-END-DATE           06600012
066100                AND  A.LIST_SEQ_NBR  >  :MB119-SAVE-SEQ-NBR       06610012
066200                AND (A.MDSELV_CDE    =  :MB119-GMA-LIT  OR        06620012
066300                     A.MDSELV_CDE    =  :MB119-DMA-LIT  OR        06630012
066400                     A.MDSELV_CDE    =  :MB119-DPT-LIT  OR        06640012
066500                     A.MDSELV_CDE    =  :MB119-MCL-LIT  OR        06650012
066600                     A.MDSELV_CDE    =  :MB119-SCL-LIT)           06660012
066700                AND  A.MDSEAR_DKEY   =  B.MDSEAR_DKEY             06670012
066800                AND  B.OPERCO_NBR    =  :PC-COMPANY               06680012
066900                AND  B.APLSYS_CDE    =  :MB119-APPL-SYS-CDE       06690012
067000           ORDER BY                                               06700012
067100                     A.OPERCO_NBR                                 06710012
067200                   , A.GMA_NBR                                    06720012
067300                   , A.DMA_NBR                                    06730012
067400                   , A.DEPT_NBR                                   06740012
067500                   , A.MAJ_CL_NBR                                 06750012
067600                   , A.SUB_CL_NBR                                 06760012
067700     END-EXEC.                                                    06770012
067800*                                                                 06780012
067900*    DECLARE FOR THE DMA-LIST                                     06790012
068000*                                                                 06800012
068100     EXEC SQL                                                     06810012
068200         DECLARE DMA-LIST CURSOR FOR                              06820012
068300             SELECT                                               06830012
068400                     A.OPERCO_NBR                                 06840012
068500                   , A.GMA_NBR                                    06850012
068600                   , A.DMA_NBR                                    06860012
068700                   , A.DEPT_NBR                                   06870012
068800                   , A.MAJ_CL_NBR                                 06880012
068900                   , A.SUB_CL_NBR                                 06890012
069000                   , A.MDSELV_CDE                                 06900012
069100                   , A.STRT_DTE                                   06910012
069200                   , A.END_DTE                                    06920012
069300                   , A.MDSEAR_DESC                                06930012
069400                   , A.LIST_SEQ_NBR                               06940012
069500                   , A.MDSEAR_DKEY                                06950012
069600               FROM                                               06960012
069700                     TMDSEAR A                                    06970012
069800                   , TAPLAVL B                                    06980012
069900              WHERE                                               06990012
070000                     A.OPERCO_NBR    =  :PC-COMPANY               07000012
070100                AND  A.DMA_NBR       =  :MB119-SAVE-DMA-NBR       07010012
070200                AND  A.END_DTE       >  :MB119-END-DATE           07020012
070300                AND  A.LIST_SEQ_NBR  >  :MB119-SAVE-SEQ-NBR       07030012
070400                AND (A.MDSELV_CDE    =  :MB119-DMA-LIT  OR        07040012
070500                     A.MDSELV_CDE    =  :MB119-DPT-LIT  OR        07050012
070600                     A.MDSELV_CDE    =  :MB119-MCL-LIT  OR        07060012
070700                     A.MDSELV_CDE    =  :MB119-SCL-LIT)           07070012
070800                AND  A.MDSEAR_DKEY   =  B.MDSEAR_DKEY             07080012
070900                AND  B.OPERCO_NBR    =  :PC-COMPANY               07090012
071000                AND  B.APLSYS_CDE    =  :MB119-APPL-SYS-CDE       07100012
071100           ORDER BY                                               07110012
071200                     A.OPERCO_NBR                                 07120012
071300                   , A.GMA_NBR                                    07130012
071400                   , A.DMA_NBR                                    07140012
071500                   , A.DEPT_NBR                                   07150012
071600                   , A.MAJ_CL_NBR                                 07160012
071700                   , A.SUB_CL_NBR                                 07170012
071800     END-EXEC.                                                    07180012
071900*                                                                 07190012
072000*    DECLARE FOR THE DEPT-LIST                                    07200012
072100*                                                                 07210012
072200     EXEC SQL                                                     07220012
072300         DECLARE DEPT-LIST CURSOR FOR                             07230012
072400             SELECT                                               07240012
072500                     A.OPERCO_NBR                                 07250012
072600                   , A.GMA_NBR                                    07260012
072700                   , A.DMA_NBR                                    07270012
072800                   , A.DEPT_NBR                                   07280012
072900                   , A.MAJ_CL_NBR                                 07290012
073000                   , A.SUB_CL_NBR                                 07300012
073100                   , A.MDSELV_CDE                                 07310012
073200                   , A.STRT_DTE                                   07320012
073300                   , A.END_DTE                                    07330012
073400                   , A.MDSEAR_DESC                                07340012
073500                   , A.LIST_SEQ_NBR                               07350012
073600                   , A.MDSEAR_DKEY                                07360012
073700               FROM                                               07370012
073800                     TMDSEAR A                                    07380012
073900                   , TAPLAVL B                                    07390012
074000              WHERE                                               07400012
074100                     A.OPERCO_NBR    =  :PC-COMPANY               07410012
074200                AND  A.DEPT_NBR      =  :MB119-SAVE-DEPT-NBR      07420012
074300                AND  A.END_DTE       >  :MB119-END-DATE           07430012
074400                AND  A.LIST_SEQ_NBR  >  :MB119-SAVE-SEQ-NBR       07440012
074500                AND (A.MDSELV_CDE    =  :MB119-DPT-LIT  OR        07450012
074600                     A.MDSELV_CDE    =  :MB119-MCL-LIT  OR        07460012
074700                     A.MDSELV_CDE    =  :MB119-SCL-LIT)           07470012
074800                AND  A.MDSEAR_DKEY   =  B.MDSEAR_DKEY             07480012
074900                AND  B.OPERCO_NBR    =  :PC-COMPANY               07490012
075000                AND  B.APLSYS_CDE    =  :MB119-APPL-SYS-CDE       07500012
075100           ORDER BY                                               07510012
075200                     A.OPERCO_NBR                                 07520012
075300                   , A.GMA_NBR                                    07530012
075400                   , A.DMA_NBR                                    07540012
075500                   , A.DEPT_NBR                                   07550012
075600                   , A.MAJ_CL_NBR                                 07560012
075700                   , A.SUB_CL_NBR                                 07570012
075800     END-EXEC.                                                    07580012
075900*                                                                 07590012
076000*    DECLARE FOR THE MCL-LIST                                     07600012
076100*                                                                 07610012
076200     EXEC SQL                                                     07620012
076300         DECLARE MCL-LIST CURSOR FOR                              07630012
076400             SELECT                                               07640012
076500                     A.OPERCO_NBR                                 07650012
076600                   , A.GMA_NBR                                    07660012
076700                   , A.DMA_NBR                                    07670012
076800                   , A.DEPT_NBR                                   07680012
076900                   , A.MAJ_CL_NBR                                 07690012
077000                   , A.SUB_CL_NBR                                 07700012
077100                   , A.MDSELV_CDE                                 07710012
077200                   , A.STRT_DTE                                   07720012
077300                   , A.END_DTE                                    07730012
077400                   , A.MDSEAR_DESC                                07740012
077500                   , A.LIST_SEQ_NBR                               07750012
077600                   , A.MDSEAR_DKEY                                07760012
077700               FROM                                               07770012
077800                     TMDSEAR A                                    07780012
077900                   , TAPLAVL B                                    07790012
078000              WHERE                                               07800012
078100                     A.OPERCO_NBR    =  :PC-COMPANY               07810012
078200               AND   A.DEPT_NBR      =  :MB119-SAVE-DEPT-NBR      07820012
078300               AND ((A.MAJ_CL_NBR    =  :MB119-SAVE-MCLASS-NBR    07830012
078400               AND  (A.MDSELV_CDE    =  :MB119-MCL-LIT            07840012
078500                OR   A.MDSELV_CDE    =  :MB119-SCL-LIT))          07850012
078600                OR  (A.MDSELV_CDE    =  :MB119-DPT-LIT))          07860012
078700               AND   A.END_DTE       >  :MB119-END-DATE           07870012
078800               AND   A.LIST_SEQ_NBR  >  :MB119-SAVE-SEQ-NBR       07880012
078900               AND   A.MDSEAR_DKEY   =  B.MDSEAR_DKEY             07890012
079000               AND   B.OPERCO_NBR    =  :PC-COMPANY               07900012
079100               AND   B.APLSYS_CDE    =  :MB119-APPL-SYS-CDE       07910012
079200           ORDER BY                                               07920012
079300                     A.OPERCO_NBR                                 07930012
079400                   , A.GMA_NBR                                    07940012
079500                   , A.DMA_NBR                                    07950012
079600                   , A.DEPT_NBR                                   07960012
079700                   , A.MAJ_CL_NBR                                 07970012
079800                   , A.SUB_CL_NBR                                 07980012
079900     END-EXEC.                                                    07990012
080000*                                                                 08000012
080100*    DECLARE FOR THE SCL-LIST                                     08010012
080200*                                                                 08020012
080300     EXEC SQL                                                     08030012
080400         DECLARE SCL-LIST CURSOR FOR                              08040012
080500             SELECT                                               08050012
080600                     A.OPERCO_NBR                                 08060012
080700                   , A.GMA_NBR                                    08070012
080800                   , A.DMA_NBR                                    08080012
080900                   , A.DEPT_NBR                                   08090012
081000                   , A.MAJ_CL_NBR                                 08100012
081100                   , A.SUB_CL_NBR                                 08110012
081200                   , A.MDSELV_CDE                                 08120012
081300                   , A.STRT_DTE                                   08130012
081400                   , A.END_DTE                                    08140012
081500                   , A.MDSEAR_DESC                                08150012
081600                   , A.LIST_SEQ_NBR                               08160012
081700                   , A.MDSEAR_DKEY                                08170012
081800               FROM                                               08180012
081900                     TMDSEAR A                                    08190012
082000                   , TAPLAVL B                                    08200012
082100              WHERE                                               08210012
082200                     A.OPERCO_NBR    =  :PC-COMPANY               08220012
082300                AND  A.MDSELV_CDE    =  :MB119-SCL-LIT            08230012
082400                AND  A.DEPT_NBR      =  :MB119-SAVE-DEPT-NBR      08240012
082500                AND  A.MAJ_CL_NBR    =  :MB119-SAVE-MCLASS-NBR    08250012
082600                AND  A.SUB_CL_NBR    =  :MB119-SAVE-SCLASS-NBR    08260012
082700                AND  A.LIST_SEQ_NBR  >  :MB119-SAVE-SEQ-NBR       08270012
082800                AND  A.END_DTE       >  :MB119-END-DATE           08280012
082900                AND  A.MDSEAR_DKEY   =  B.MDSEAR_DKEY             08290012
083000                AND  B.OPERCO_NBR    =  :PC-COMPANY               08300012
083100                AND  B.APLSYS_CDE    =  :MB119-APPL-SYS-CDE       08310012
083200           ORDER BY                                               08320012
083300                     A.OPERCO_NBR                                 08330012
083400                   , A.GMA_NBR                                    08340012
083500                   , A.DMA_NBR                                    08350012
083600                   , A.DEPT_NBR                                   08360012
083700                   , A.MAJ_CL_NBR                                 08370012
083800                   , A.SUB_CL_NBR                                 08380012
083900     END-EXEC.                                                    08390012
084000*                                                                 08400012
084100 EJECT                                                            08410012
084200 LINKAGE SECTION.                                                 08420012
084300                                                                  08430012
084400 01  DFHCOMMAREA.                                                 08440012
084500     05  FILLER                         OCCURS  1 TO 4072 TIMES   08450012
084600                                        DEPENDING ON EIBCALEN.    08460012
084700         10  FILLER                     PIC X.                    08470012
084800                                                                  08480012
084900*                                                                 08490012
085000*                                                                 08500012
085100*                                                                 08510012
085200 PROCEDURE DIVISION.                                              08520012
085300                                                                  08530012
085400                                                                  08540012
085500 A100-MAIN-MODULE.                                                08550012
085600                                                                  08560012
085700******************************************************************08570012
085800*    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.           08580012
085900******************************************************************08590012
086000                                                                  08600012
086100     PERFORM DP015-0000-CHECK-COMMAREA.                           08610012
086200                                                                  08620012
086300     IF DP020-SRC-RETURN-W-TRAN-ID                                08630012
086400         PERFORM B100-CONTROL-PROCESSING                          08640012
086500     END-IF.                                                      08650012
086600                                                                  08660012
086700     PERFORM DP003-0000-RETURN-TO-CICS.                           08670012
086800 EJECT                                                            08680012
086900******************************************************************08690012
087000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    08700012
087100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                    08710012
087200*                                                                 08720012
087300*    PERFORMED BY A100-MAIN-MODULE.                               08730012
087400******************************************************************08740012
087500*                                                                 08750012
087600 B100-CONTROL-PROCESSING.                                         08760012
087700*                                                                 08770012
087800     SET PS-CONTINUE           TO  TRUE.                          08780012
087900     MOVE LENGTH OF MB119-BLOCK-ENTRIES (1)                       08790012
088000                               TO  PC-BLOCK-LENGTH.               08800012
088100     EVALUATE TRUE                                                08810012
088200         WHEN DP020-NEXT-ACT-INITIAL                              08820012
088300             PERFORM C100-VALIDATE-COMMAREA                       08830012
088400             IF  PS-COMMAREA-NOT-VALID                            08840012
088500                 MOVE PC-TSYMSG-99901                             08850012
088600                               TO  DP020-MSG-NUMBER               08860012
088700                 SET DP020-MSG-FATAL                              08870012
088800                               TO  TRUE                           08880012
088900                 MOVE DP016-PF3                                   08890012
089000                               TO  DP020-SRC-AID                  08900012
089100                 PERFORM DP015-1000-START-NAVIGATOR               08910012
089200             ELSE                                                 08920012
089300                 INITIALIZE MB119-SPECIFIC-COMMAREA               08930012
089400                 SET PS-CONTINUE                                  08940012
089500                               TO  TRUE                           08950012
089600                 SET PS-SEND-MAP-N-DATA-FRSET                     08960012
089700                               TO  TRUE                           08970012
089800                 SET DP020-NEXT-ACT-READ-MAP                      08980012
089900                               TO  TRUE                           08990012
090000                 PERFORM C200-SAVE-INITIAL-INTERAPPL              09000012
090100                 PERFORM C500-SETUP-FIRST-DISPLAY                 09010012
090200                 PERFORM G100-DISPLAY-PANEL                       09020012
090300             END-IF                                               09030012
090400*                                                                 09040012
090500         WHEN DP020-NEXT-ACT-READ-MAP                             09050012
090600             PERFORM C300-PROCESS-PANEL                           09060012
090700*                                                                 09070012
090800         WHEN DP020-NEXT-ACT-RETURN                               09080012
090900             SET PS-SEND-MAP-N-DATA-FRSET                         09090012
091000                               TO  TRUE                           09100012
091100             IF  MB119-FIRST-PASS                                 09110012
091200                 PERFORM C500-SETUP-FIRST-DISPLAY                 09120012
091300                 PERFORM C400-REFRESH-PANEL-FROM-TEMP             09130012
091400                 PERFORM C600-FIRST-PASS-PROCESS                  09140012
091500             ELSE                                                 09150012
091600                 PERFORM C400-REFRESH-PANEL-FROM-TEMP             09160012
091700                 PERFORM G100-DISPLAY-PANEL                       09170012
091800             END-IF                                               09180012
091900*                                                                 09190012
092000         WHEN DP020-NEXT-ACT-ERROR                                09200012
092100             MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                 09210012
092200             IF DP020-NAV-MNEMONIC = SPACES                       09220012
092300                 MOVE SPACES   TO  ANAVCMDO                       09230012
092400                 MOVE DP015-UNDERLINE                             09240012
092500                               TO  ANAVCMDH                       09250012
092600                 MOVE DP015-GREEN                                 09260012
092700                               TO  ANAVCMDC                       09270012
092800             ELSE                                                 09280012
092900                 MOVE DP015-REVERSE                               09290012
093000                               TO  ANAVCMDH                       09300012
093100                 MOVE DP015-RED                                   09310012
093200                               TO  ANAVCMDC                       09320012
093300             END-IF                                               09330012
093400*                                                                 09340012
093500             PERFORM E100-EDIT-SELECTIONS                         09350012
093600             MOVE -1           TO  ANAVCMDL                       09360012
093700             MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE              09370012
093800                                                                  09380012
093900             SET DP020-MSG-FATAL                                  09390012
094000                               TO  TRUE                           09400012
094100             SET PS-SEND-DATA-ONLY-FRSET                          09410012
094200                               TO  TRUE                           09420012
094300             SET PS-SAME-ITEMS-DISPLAYED                          09430012
094400                               TO  TRUE                           09440012
094500             SET PS-CURSOR-POSITIONED                             09450012
094600                               TO  TRUE                           09460012
094700             PERFORM G100-DISPLAY-PANEL                           09470012
094800*                                                                 09480012
094900         WHEN OTHER                                               09490012
095000             SET DP013-LOGIC-ABEND TO TRUE                        09500012
095100             SET DP013-NO-ROLLBACK TO TRUE                        09510012
095200             MOVE 'B100-CONTROL-PROCESSING'                       09520012
095300                               TO  DP013-PARAGRAPH                09530012
095400             MOVE PM-PROGRAM-MESSAGE-12                           09540012
095500                               TO  DP013-MESSAGE-TEXT(1)          09550012
095600             PERFORM DP013-0000-PROCESS-ABEND                     09560012
095700     END-EVALUATE.                                                09570012
095800*                                                                 09580012
095900 EJECT                                                            09590012
096000******************************************************************09600012
096100*    ENSURE PROPRAM ENTERED PROPERLY.                             09610012
096200*                                                                 09620012
096300*    PERFORMED BY B100-CONTROL-PROCESSING.                        09630012
096400******************************************************************09640012
096500*                                                                 09650012
096600 C100-VALIDATE-COMMAREA.                                          09660012
096700*                                                                 09670012
096800     IF  DP020-MB-APPL-AVAIL-SELECT                               09680012
096900         SET PS-COMMAREA-VALID TO  TRUE                           09690012
097000     ELSE                                                         09700012
097100         SET PS-COMMAREA-NOT-VALID                                09710012
097200                               TO  TRUE                           09720012
097300     END-IF.                                                      09730012
097400*                                                                 09740012
097500 EJECT                                                            09750012
097600******************************************************************09760012
097700*    ENSURE PROPER DATA WAS PASSED.  SAVE IT AND SET THE CURSOR   09770012
097800*    SWITCH TO DETERMIND DB2 PROCESSING.                          09780012
097900*                                                                 09790012
098000*    PERFORMED BY B100-CONTROL-PROCESSING.                        09800012
098100******************************************************************09810012
098200*                                                                 09820012
098300 C200-SAVE-INITIAL-INTERAPPL.                                     09830012
098400*                                                                 09840012
098500     MOVE MB005-CO-NUMBER      TO  MB119-COMPANY.                 09850012
098600     MOVE MB005-GMA-NUMBER     TO  MB119-SAVE-GMA-NBR.            09860012
098700     MOVE MB005-DMA-NUMBER     TO  MB119-SAVE-DMA-NBR.            09870012
098800     MOVE MB005-DEPT-NUMBER    TO  MB119-SAVE-DEPT-NBR.           09880012
098900     MOVE MB005-MCLASS-NUMBER  TO  MB119-SAVE-MCLASS-NBR.         09890012
099000     MOVE MB005-SCLASS-NUMBER  TO  MB119-SAVE-SCLASS-NBR.         09900012
099100     MOVE MB005-APPL-SYS-CODE  TO  MB119-APPL-SYS-CDE             09910012
099200                                   APLSYS-CDE                     09920012
099300                                   ALIKESYO.                      09930012
099400     PERFORM X400-READ-APLSYS.                                    09940012
099500     MOVE APLSYS-DESC          TO  MB119-APPL-SYS-DESC            09950012
099600                                   ALIKEDEO.                      09960012
099700*                                                                 09970012
099800     SET MB119-NO-CURSOR       TO  TRUE.                          09980012
099900*                                                                 09990012
100000     IF  MB119-ALL-SCLASSES                                       10000012
100100         SET MB119-SCL-LIT-ON  TO  TRUE                           10010012
100200     ELSE                                                         10020012
100300         IF  MB119-SAVE-SCLASS-NBR LESS THAN ZERO                 10030012
100400             CONTINUE                                             10040012
100500         ELSE                                                     10050012
100600             SET MB119-SCL-LIT-ON                                 10060012
100700                               TO  TRUE                           10070012
100800             SET MB119-SCL-CURSOR                                 10080012
100900                               TO  TRUE                           10090012
101000         END-IF                                                   10100012
101100     END-IF.                                                      10110012
101200*                                                                 10120012
101300     IF  MB119-ALL-MCLASSES                                       10130012
101400         SET MB119-MCL-LIT-ON  TO  TRUE                           10140012
101500     ELSE                                                         10150012
101600         IF  MB119-SAVE-MCLASS-NBR LESS THAN ZERO                 10160012
101700             CONTINUE                                             10170012
101800         ELSE                                                     10180012
101900             SET MB119-MCL-LIT-ON                                 10190012
102000                               TO  TRUE                           10200012
102100             IF  MB119-NO-CURSOR                                  10210012
102200                 SET MB119-MCL-CURSOR                             10220012
102300                               TO  TRUE                           10230012
102400             END-IF                                               10240012
102500         END-IF                                                   10250012
102600     END-IF.                                                      10260012
102700*                                                                 10270012
102800     IF  MB119-ALL-DEPTS                                          10280012
102900         SET MB119-DPT-LIT-ON  TO  TRUE                           10290012
103000     ELSE                                                         10300012
103100         IF  MB119-SAVE-DEPT-NBR LESS THAN ZERO                   10310012
103200             CONTINUE                                             10320012
103300         ELSE                                                     10330012
103400             SET MB119-DPT-LIT-ON                                 10340012
103500                               TO  TRUE                           10350012
103600             IF  MB119-NO-CURSOR                                  10360012
103700                 SET MB119-DEPT-CURSOR                            10370012
103800                               TO  TRUE                           10380012
103900             END-IF                                               10390012
104000         END-IF                                                   10400012
104100     END-IF.                                                      10410012
104200*                                                                 10420012
104300     IF  MB119-ALL-DMAS                                           10430012
104400         SET MB119-DMA-LIT-ON  TO  TRUE                           10440012
104500     ELSE                                                         10450012
104600         IF  MB119-SAVE-DMA-NBR LESS THAN ZERO                    10460012
104700             CONTINUE                                             10470012
104800         ELSE                                                     10480012
104900             SET MB119-DMA-LIT-ON                                 10490012
105000                               TO  TRUE                           10500012
105100             IF  MB119-NO-CURSOR                                  10510012
105200                 SET MB119-DMA-CURSOR                             10520012
105300                               TO  TRUE                           10530012
105400             END-IF                                               10540012
105500         END-IF                                                   10550012
105600     END-IF.                                                      10560012
105700*                                                                 10570012
105800     SET MB119-GMA-LIT-ON      TO  TRUE.                          10580012
105900     IF  MB119-ALL-GMAS                                           10590012
106000         CONTINUE                                                 10600012
106100     ELSE                                                         10610012
106200         IF  MB119-NO-CURSOR                                      10620012
106300             SET MB119-GMA-CURSOR                                 10630012
106400                               TO  TRUE                           10640012
106500         END-IF                                                   10650012
106600     END-IF.                                                      10660012
106700*                                                                 10670012
106800     IF (MB119-ALL-GMAS                                           10680012
106900     AND MB119-ALL-DMAS                                           10690012
107000     AND MB119-ALL-DEPTS                                          10700012
107100     AND MB119-ALL-MCLASSES                                       10710012
107200     AND MB119-ALL-SCLASSES)                                      10720012
107300         SET MB119-MERCH-CURSOR                                   10730012
107400                               TO  TRUE                           10740012
107500     END-IF.                                                      10750012
107600*                                                                 10760012
107700     IF (MB119-ALL-GMAS                                           10770012
107800     AND MB119-ALL-DMAS                                           10780012
107900     AND MB119-ALL-DEPTS                                          10790012
108000     AND MB119-ALL-MCLASSES)                                      10800012
108100         IF  MB119-SAVE-SCLASS-NBR GREATER THAN ZERO              10810012
108200             CONTINUE                                             10820012
108300         ELSE                                                     10830012
108400             SET MB119-MERCH-CURSOR                               10840012
108500                               TO  TRUE                           10850012
108600         END-IF                                                   10860012
108700     END-IF.                                                      10870012
108800*                                                                 10880012
108900     IF (MB119-ALL-GMAS                                           10890012
109000     AND MB119-ALL-DMAS                                           10900012
109100     AND MB119-ALL-DEPTS)                                         10910012
109200         IF (MB119-SAVE-MCLASS-NBR GREATER THAN ZERO              10920012
109300         OR  MB119-SAVE-SCLASS-NBR GREATER THAN ZERO)             10930012
109400             CONTINUE                                             10940012
109500         ELSE                                                     10950012
109600             SET MB119-MERCH-CURSOR                               10960012
109700                               TO  TRUE                           10970012
109800         END-IF                                                   10980012
109900     END-IF.                                                      10990012
110000*                                                                 11000012
110100     IF (MB119-ALL-GMAS                                           11010012
110200     AND MB119-ALL-DMAS)                                          11020012
110300         IF (MB119-SAVE-DEPT-NBR GREATER THAN ZERO                11030012
110400         OR  MB119-SAVE-MCLASS-NBR GREATER THAN ZERO              11040012
110500         OR  MB119-SAVE-SCLASS-NBR GREATER THAN ZERO)             11050012
110600             CONTINUE                                             11060012
110700         ELSE                                                     11070012
110800             SET MB119-MERCH-CURSOR                               11080012
110900                               TO  TRUE                           11090012
111000         END-IF                                                   11100012
111100     END-IF.                                                      11110012
111200*                                                                 11120012
111300     IF  MB119-ALL-GMAS                                           11130012
111400         IF (MB119-SAVE-DMA-NBR GREATER THAN ZERO                 11140012
111500         OR  MB119-SAVE-DEPT-NBR GREATER THAN ZERO                11150012
111600         OR  MB119-SAVE-MCLASS-NBR GREATER THAN ZERO              11160012
111700         OR  MB119-SAVE-SCLASS-NBR GREATER THAN ZERO)             11170012
111800             CONTINUE                                             11180012
111900         ELSE                                                     11190012
112000             SET MB119-MERCH-CURSOR                               11200012
112100                               TO  TRUE                           11210012
112200         END-IF                                                   11220012
112300     END-IF.                                                      11230012
112400*                                                                 11240012
112500 EJECT                                                            11250012
112600******************************************************************11260012
112700*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED  11270012
112800*    ON WHAT FUNCTION KEY WAS SELECTED.                           11280012
112900*                                                                 11290012
113000*    PERFORMED BY B100-CONTROL-PROCESSING.                        11300012
113100******************************************************************11310012
113200*                                                                 11320012
113300 C300-PROCESS-PANEL.                                              11330012
113400*                                                                 11340012
113500     PERFORM DP007-0000-GET-PANEL.                                11350012
113600     SET PS-SEND-DATA-ONLY-FRSET                                  11360012
113700                               TO TRUE.                           11370012
113800     EVALUATE TRUE                                                11380012
113900*                                                                 11390012
114000         WHEN DP020-SRC-AID = DP016-CLEAR                         11400012
114100             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                 11410012
114200             MOVE MB119-ESD-MM TO  ASTRTMMO                       11420012
114300             MOVE MB119-ESD-DD TO  ASTRTDDO                       11430012
114400             MOVE MB119-ESD-YY TO  ASTRTYYO                       11440012
114500             MOVE MB119-NEW-APPL-SYS-CDE                          11450012
114600                               TO  AAPLSYSO                       11460012
114700             MOVE MB119-NEW-APPL-SYS-DESC                         11470012
114800                               TO  AAPLDESO                       11480012
114900             MOVE MB119-APPL-SYS-CDE                              11490012
115000                               TO  ALIKESYO                       11500012
115100             MOVE MB119-APPL-SYS-DESC                             11510012
115200                               TO  ALIKEDEO                       11520012
115300             MOVE PC-COMPANY   TO  AOPERCOO                       11530012
115400*                                                                 11540012
115500             SET PS-SAME-ITEMS-DISPLAYED                          11550012
115600                               TO  TRUE                           11560012
115700             IF  MB119-FIRST-PASS                                 11570012
115800                 PERFORM C500-SETUP-FIRST-DISPLAY                 11580012
115900                 PERFORM C600-FIRST-PASS-PROCESS                  11590012
116000             ELSE                                                 11600012
116100                 PERFORM E100-EDIT-SELECTIONS                     11610012
116200                 PERFORM G100-DISPLAY-PANEL                       11620012
116300             END-IF                                               11630012
116400*                                                                 11640012
116500         WHEN DP020-SRC-AID = DP016-PF5                           11650012
116600             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                 11660012
116700             MOVE MB119-APPL-SYS-CDE                              11670012
116800                               TO  ALIKESYO                       11680012
116900             MOVE MB119-APPL-SYS-DESC                             11690012
117000                               TO  ALIKEDEO                       11700012
117100             MOVE ZERO         TO MB119-SAVE-SEQ-NBR              11710012
117200             PERFORM Z050-DELETE-TEMP-STORAGE                     11720012
117300             PERFORM C500-SETUP-FIRST-DISPLAY                     11730012
117400             PERFORM G100-DISPLAY-PANEL                           11740012
117500*                                                                 11750012
117600         WHEN DP020-SRC-AID = DP016-PA2                           11760012
117700             PERFORM DP009-0000-LOAD-FK-LINES                     11770012
117800             PERFORM DP017-0000-GET-CURR-DATE-TIME                11780012
117900             SET PS-SEND-DATA-ONLY                                11790012
118000                               TO  TRUE                           11800012
118100             MOVE -1           TO  ANAVCMDL                       11810012
118200             PERFORM DP008-0000-WRITE-PANEL                       11820012
118300*                                                                 11830012
118400         WHEN DP020-FK-RETURN(DP020-SRC-AID)                      11840012
118500              PERFORM E300-NAVIGATE                               11850012
118600*                                                                 11860012
118700         WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                  11870012
118800              PERFORM E300-NAVIGATE                               11880012
118900*                                                                 11890012
119000         WHEN OTHER                                               11900012
119100             IF (DP020-NAV-MNEMONIC GREATER THAN SPACES           11910012
119200             AND DP020-SRC-AID EQUAL DP016-ENTER)                 11920012
119300                 PERFORM E300-NAVIGATE                            11930012
119400             ELSE                                                 11940012
119500                 IF  MB119-FIRST-PASS                             11950012
119600                     PERFORM C600-FIRST-PASS-PROCESS              11960012
119700                 ELSE                                             11970012
119800                     PERFORM D200-RECORD-SELECTIONS               11980012
119900                     IF  PS-VALID-SELECTIONS                      11990012
120000                         PERFORM D300-CHECK-FUNCTION-KEY          12000012
120100                     ELSE                                         12010012
120200                         SET PS-SAME-ITEMS-DISPLAYED TO TRUE      12020012
120300                         PERFORM G100-DISPLAY-PANEL               12030012
120400                     END-IF                                       12040012
120500                 END-IF                                           12050012
120600             END-IF                                               12060012
120700*                                                                 12070012
120800             IF (DP020-SRC-AID EQUAL DP016-ENTER                  12080012
120900             OR  DP020-SRC-AID EQUAL DP016-PF6                    12090012
121000             OR  DP020-SRC-AID EQUAL DP016-PF7                    12100012
121100             OR  DP020-SRC-AID EQUAL DP016-PF8                    12110012
121200             OR  DP020-SRC-AID EQUAL DP016-PF9                    12120012
121300             OR  DP020-SRC-AID EQUAL DP016-PF13                   12130012
121400             OR  DP020-SRC-AID EQUAL DP016-PF21)                  12140012
121500                 CONTINUE                                         12150012
121600             ELSE                                                 12160012
121700                 MOVE PC-TSYMSG-00045                             12170012
121800                               TO  DP020-MSG-NUMBER               12180012
121900                 SET DP020-MSG-FATAL                              12190012
122000                               TO  TRUE                           12200012
122100                 MOVE -1       TO  ANAVCMDL                       12210012
122200                 PERFORM G100-DISPLAY-PANEL                       12220012
122300             END-IF                                               12230012
122400     END-EVALUATE.                                                12240012
122500*                                                                 12250012
122600 EJECT                                                            12260012
122700******************************************************************12270012
122800*    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, 12280012
122900*    SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.       12290012
123000*    EDIT THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL  12300012
123100*    TO THE USER.  ALSO, RESTORE THE REQUESTED UPC AND SKU NBRS.  12310012
123200*                                                                 12320012
123300*    PERFORMED BY B100-CONTROL-PROCESSING.                        12330012
123400******************************************************************12340012
123500*                                                                 12350012
123600 C400-REFRESH-PANEL-FROM-TEMP.                                    12360012
123700*                                                                 12370012
123800     MOVE MB119-ESD-MM         TO  ASTRTMMO                       12380012
123900     MOVE MB119-ESD-DD         TO  ASTRTDDO                       12390012
124000     MOVE MB119-ESD-YY         TO  ASTRTYYO                       12400012
124100     MOVE MB119-NEW-APPL-SYS-CDE                                  12410012
124200                               TO  AAPLSYSO                       12420012
124300     MOVE MB119-NEW-APPL-SYS-DESC                                 12430012
124400                               TO  AAPLDESO                       12440012
124500     MOVE MB119-APPL-SYS-CDE   TO  ALIKESYO                       12450012
124600     MOVE MB119-APPL-SYS-DESC  TO  ALIKEDEO                       12460012
124700     MOVE PC-COMPANY   TO  AOPERCOO                               12470012
124800*                                                                 12480012
124900     PERFORM D400-REFRESH-BLOCK-ARRAY.                            12490012
125000     PERFORM E100-EDIT-SELECTIONS.                                12500012
125100*                                                                 12510012
125200     SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                    12520012
125300     MOVE MB119-LIST-QUEUE-NAME                                   12530012
125400                               TO  MB005-LIST-QUEUE-NAME.         12540012
125500*                                                                 12550012
125600 EJECT                                                            12560012
125700******************************************************************12570012
125800*    MAKE THE EFFECTIVE START DATE AND CREATE APPL SYS AVAIL      12580012
125900*    FIELDS UNPROTECTED.  SET THE PROCESS SWITCH TO FIRST PASS.   12590012
126000*                                                                 12600012
126100*    PERFORMED BY B100, C300                                      12610012
126200******************************************************************12620012
126300*                                                                 12630012
126400 C500-SETUP-FIRST-DISPLAY.                                        12640012
126500*                                                                 12650012
126600     MOVE DP015-GREEN          TO  ASTRTMMC                       12660012
126700                                   ASTRTDDC                       12670012
126800                                   ASTRTYYC                       12680012
126900                                   AAPLSYSC.                      12690012
127000     MOVE DP015-UNDERLINE      TO  ASTRTMMH                       12700012
127100                                   ASTRTDDH                       12710012
127200                                   ASTRTYYH                       12720012
127300                                   AAPLSYSH.                      12730012
127400     MOVE DP015-UNP-ALP-NOR-MDT TO AAPLSYSA.                      12740012
127500     MOVE DP015-UNP-NUM-NOR-MDT TO ASTRTMMA                       12750012
127600                                   ASTRTDDA                       12760012
127700                                   ASTRTYYA.                      12770012
127800                                                                  12780012
127900     IF  DP020-SRC-AID NOT EQUAL DP016-CLEAR                      12790012
128000         MOVE LOW-VALUES       TO  ASTRTMMO                       12800012
128100                                   ASTRTDDO                       12810012
128200                                   ASTRTYYO                       12820012
128300         MOVE SPACES           TO  AAPLSYSO                       12830012
128400         MOVE -1               TO  ASTRTMML                       12840012
128500     END-IF.                                                      12850012
128600                                                                  12860012
128700     SET MB119-FIRST-PASS      TO  TRUE.                          12870012
128800*                                                                 12880012
128900     MOVE 1                    TO  PS-SUB.                        12890012
129000     PERFORM PC-ITEMS-PER-PANEL TIMES                             12900012
129100         MOVE SPACES           TO  MBKM119-SELECTI (PS-SUB)       12910012
129200         ADD 1                 TO  PS-SUB                         12920012
129300     END-PERFORM.                                                 12930012
129400*                                                                 12940012
129500 EJECT                                                            12950012
129600******************************************************************12960012
129700*    VALIDATE THE EFFECTIVE START DATE AND THE APPLICATION SYSTEM 12970012
129800*    AVAILABLE CODE.                                              12980012
129900*                                                                 12990012
130000*    PERFORMED BY C300                                            13000012
130100******************************************************************13010012
130200*                                                                 13020012
130300 C600-FIRST-PASS-PROCESS.                                         13030012
130400*                                                                 13040012
130500*    FIRST, MOVE TO THE COMMAREA.                                 13050012
130600*                                                                 13060012
130700     IF (ASTRTMML GREATER THAN ZERO                               13070012
130800     OR  ASTRTMMA EQUAL PC-ERASE-EOF)                             13080012
130900         MOVE ASTRTMMI         TO  MB119-ESD-MM                   13090012
131000     END-IF.                                                      13100012
131100*                                                                 13110012
131200     IF (ASTRTDDL GREATER THAN ZERO                               13120012
131300     OR  ASTRTDDA EQUAL PC-ERASE-EOF)                             13130012
131400         MOVE ASTRTDDI         TO  MB119-ESD-DD                   13140012
131500     END-IF.                                                      13150012
131600*                                                                 13160012
131700     IF (ASTRTYYL GREATER THAN ZERO                               13170012
131800     OR  ASTRTYYA EQUAL PC-ERASE-EOF)                             13180012
131900         MOVE ASTRTYYI         TO  MB119-ESD-YY                   13190012
132000     END-IF.                                                      13200012
132100*                                                                 13210012
132200     IF (AAPLSYSL GREATER THAN ZERO                               13220012
132300     OR  AAPLSYSA EQUAL PC-ERASE-EOF)                             13230012
132400         MOVE AAPLSYSI         TO  MB119-NEW-APPL-SYS-CDE         13240012
132500     END-IF.                                                      13250012
132600*                                                                 13260012
132700*    NEXT, VALIDATE THE APPLICATION SYSTEM CODE.                  13270012
132800*                                                                 13280012
132900     MOVE MB119-NEW-APPL-SYS-CDE                                  13290012
133000                               TO  APLSYS-CDE.                    13300012
133100     PERFORM X400-READ-APLSYS.                                    13310012
133200     IF  SQLCODE EQUAL ZERO                                       13320012
133300         MOVE APLSYS-DESC      TO  MB119-NEW-APPL-SYS-DESC        13330012
133400                                   AAPLDESO                       13340012
133500         MOVE DP015-GREEN      TO  AAPLSYSC                       13350012
133600         MOVE DP015-UNDERLINE  TO  AAPLSYSH                       13360012
133700     ELSE                                                         13370012
133800         MOVE PC-TSYMSG-00148  TO  DP020-MSG-NUMBER               13380012
133900         SET DP020-MSG-FATAL   TO  TRUE                           13390012
134000         MOVE -1               TO  AAPLSYSL                       13400012
134100         MOVE DP015-RED        TO  AAPLSYSC                       13410012
134200         MOVE DP015-REVERSE    TO  AAPLSYSH                       13420012
134300     END-IF.                                                      13430012
134400*                                                                 13440012
134500*    NOW, VALIDATE THE DATE FIELD.                                13450012
134600*                                                                 13460012
134700     SET PS-VALID-DATE         TO  TRUE.                          13470012
134800     IF  MB119-ESD-MM NUMERIC                                     13480012
134900         MOVE DP015-GREEN      TO  ASTRTMMC                       13490012
135000         MOVE DP015-UNDERLINE  TO  ASTRTMMH                       13500012
135100     ELSE                                                         13510012
135200         MOVE DP015-RED        TO  ASTRTMMC                       13520012
135300         MOVE DP015-REVERSE    TO  ASTRTMMH                       13530012
135400         MOVE -1               TO  ASTRTMML                       13540012
135500         MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER               13550012
135600         SET PS-INVALID-DATE   TO  TRUE                           13560012
135700         SET DP020-MSG-FATAL   TO  TRUE.                          13570012
135800*                                                                 13580012
135900     IF  MB119-ESD-DD NUMERIC                                     13590012
136000         MOVE DP015-GREEN      TO  ASTRTDDC                       13600012
136100         MOVE DP015-UNDERLINE  TO  ASTRTDDH                       13610012
136200     ELSE                                                         13620012
136300         MOVE DP015-RED        TO  ASTRTDDC                       13630012
136400         MOVE DP015-REVERSE    TO  ASTRTDDH                       13640012
136500         MOVE -1               TO  ASTRTDDL                       13650012
136600         MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER               13660012
136700         SET PS-INVALID-DATE   TO  TRUE                           13670012
136800         SET DP020-MSG-FATAL   TO  TRUE.                          13680012
136900*                                                                 13690012
137000     IF  MB119-ESD-YY NUMERIC                                     13700012
137100         MOVE DP015-GREEN      TO  ASTRTYYC                       13710012
137200         MOVE DP015-UNDERLINE  TO  ASTRTYYH                       13720012
137300     ELSE                                                         13730012
137400         MOVE DP015-RED        TO  ASTRTYYC                       13740012
137500         MOVE DP015-REVERSE    TO  ASTRTYYH                       13750012
137600         MOVE -1               TO  ASTRTYYL                       13760012
137700         MOVE PC-TSYMSG-00008  TO  DP020-MSG-NUMBER               13770012
137800         SET PS-INVALID-DATE   TO  TRUE                           13780012
137900         SET DP020-MSG-FATAL   TO  TRUE.                          13790012
138000*                                                                 13800012
138100*    BEFORE VALIDATING REASONABILITY OF THE DATE,                 13810012
138200*    CALL DPKUT500 AND PICKUP THE CENTURY.                        13820012
138300*                                                                 13830012
           IF PS-VALID-DATE                                             13831012
138400         INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56      13832012
138500                                                                  13833012
138600         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   13834012
138700                                                                  13835012
138800         SET DPG52-LK-DTE-GREG  TO TRUE                           13836012
138900         MOVE MB119-ESD-YY TO  DPG52-GREG-DATE-YR-X,  PV-VD-YY    13837012
139000         MOVE MB119-ESD-MM TO  DPG52-GREG-DATE-MO-X,  PV-VD-MM    13838012
139100         MOVE MB119-ESD-DD TO  DPG52-GREG-DATE-DY-X,  PV-VD-DD    13839012
139200                                                                  13840012
139300         CALL  DP500-KOHLS-CALENDAR-ROUTINE                       13850012
139400             USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56       13860012
139500                                                                  13870012
139600         IF DPG54-NO-ERROR                                        13880012
139700             MOVE DPG55-DB2-ISO-DATE-FMT-YR TO PV-STORED-CCYY     13890012
139800             MOVE PV-STORED-CC-X TO MB119-ESD-CC, PV-VD-CC        13900012
139900         ELSE                                                     13910012
143200             MOVE DP015-RED        TO  ASTRTMMC                   13920012
143300                                       ASTRTDDC                   13930012
143400                                       ASTRTYYC                   13940012
143500             MOVE DP015-REVERSE    TO  ASTRTMMH                   13950012
143600                                       ASTRTDDH                   13960012
143700                                       ASTRTYYH                   13970012
143800             MOVE -1               TO  ASTRTMML                   13980012
140000             MOVE PC-TSYMSG-00009  TO  DP020-MSG-NUMBER           13990012
140100             SET PS-INVALID-DATE   TO  TRUE                       14000012
140200             SET DP020-MSG-FATAL   TO  TRUE                       14010012
140300         END-IF                                                   14020012
           END-IF.                                                      14030012
140400*                                                                 14040012
140500     IF  PS-VALID-DATE                                            14050012
140800         PERFORM DP017-0000-GET-CURR-DATE-TIME                    14060012
140900         IF PV-VALIDATE-DATE < DP017-CURRENT-DATE-YYYYMMDD        14070012
141000         OR PV-VALIDATE-DATE = DP017-CURRENT-DATE-YYYYMMDD        14080012
143200             MOVE DP015-RED        TO  ASTRTMMC                   14081012
143300                                       ASTRTDDC                   14082012
143400                                       ASTRTYYC                   14083012
143500             MOVE DP015-REVERSE    TO  ASTRTMMH                   14084012
143600                                       ASTRTDDH                   14085012
143700                                       ASTRTYYH                   14086012
143800             MOVE -1               TO  ASTRTMML                   14087012
141100             MOVE PC-TSYMSG-00067  TO  DP020-MSG-NUMBER           14088012
141300             SET PS-INVALID-DATE   TO  TRUE                       14089012
141500             SET DP020-MSG-FATAL   TO  TRUE                       14090012
141700         ELSE                                                     14100012
141800             ADD 1             TO  DP017-CURRENT-YMD-YYYY         14110012
141900             IF  PV-VALIDATE-DATE > DP017-CURRENT-DATE-YYYYMMDD   14120012
143200                 MOVE DP015-RED        TO  ASTRTMMC               14130012
143300                                           ASTRTDDC               14140012
143400                                           ASTRTYYC               14150012
143500                 MOVE DP015-REVERSE    TO  ASTRTMMH               14160012
143600                                           ASTRTDDH               14170012
143700                                           ASTRTYYH               14171012
143800                 MOVE -1               TO  ASTRTMML               14172012
142000                 MOVE PC-TSYMSG-00025  TO  DP020-MSG-NUMBER       14173012
142200                 SET PS-INVALID-DATE   TO  TRUE                   14174012
142400                 SET DP020-MSG-FATAL   TO  TRUE                   14175012
142600             END-IF                                               14176012
142700             SUBTRACT 1      FROM  DP017-CURRENT-YMD-YYYY         14177012
142800         END-IF                                                   14178012
142900     END-IF.                                                      14179012
143000*                                                                 14180012
144100     IF  DP020-MSG-FATAL                                          14190012
144200         PERFORM G100-DISPLAY-PANEL                               14200012
144300     ELSE                                                         14210012
144400         IF  DP020-SRC-AID EQUAL DP016-PF13                       14220012
144500             MOVE DP015-BLUE   TO  ASTRTMMC                       14230012
144600                                   ASTRTDDC                       14240012
144700                                   ASTRTYYC                       14250012
144800                                   AAPLSYSC                       14260012
144900             MOVE DP015-HL-OFF TO  ASTRTMMH                       14270012
145000                                   ASTRTDDH                       14280012
145100                                   ASTRTYYH                       14290012
145200                                   AAPLSYSH                       14300012
145300             MOVE DP015-ASK-NOR-OFF                               14310012
145400                               TO  ASTRTMMA                       14320012
145500                                   ASTRTDDA                       14330012
145600                                   ASTRTYYA                       14340012
145700                                   AAPLSYSA                       14350012
145800*                                                                 14360012
145900             SET MB119-SECOND-PASS                                14370012
146000                               TO  TRUE                           14380012
146100             MOVE MB119-ESD-DD TO  PV-WD-DD                       14390012
146200             MOVE MB119-ESD-MM TO  PV-WD-MM                       14400012
146300             MOVE MB119-ESD-YY TO  PV-WD-YY                       14410012
146400             MOVE MB119-ESD-CC TO  PV-WD-CC                       14420012
146500             SET PV-DASH1      TO  TRUE                           14430012
146600             SET PV-DASH2      TO  TRUE                           14440012
146700             MOVE PV-DB2-WORK-DATE TO  MB119-END-DATE             14450012
146800             PERFORM D100-SETUP-INIT-PANEL                        14460012
146900         ELSE                                                     14470012
147000             MOVE -1           TO  ASTRTMML                       14480012
147100             PERFORM G100-DISPLAY-PANEL                           14490012
147200         END-IF                                                   14500012
147300     END-IF.                                                      14510012
147400*                                                                 14520012
147500 EJECT                                                            14530012
147600*                                                                 14540012
147700******************************************************************14550012
147800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         14560012
147900*    INITIALIZE ALL COUNTERS AND FLAGS.                           14570012
148000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.   14580012
148100*    DISPLAY THE PANEL TO USER.                                   14590012
148200*                                                                 14600012
148300*    PERFORMED BY B100-CONTROL-PROCESSING.                        14610012
148400*    PERFORMED BY C300-PROCESS-PANEL.                             14620012
148500******************************************************************14630012
148600*                                                                 14640012
148700 D100-SETUP-INIT-PANEL.                                           14650012
148800*                                                                 14660012
148900     INITIALIZE                  MB119-BLOCK-ENTRIES (1).         14670012
149000     INITIALIZE                  MB119-BLOCK-ENTRIES (2).         14680012
149100     MOVE SPACES             TO  MB119-LIST-QUEUE-NAME.           14690012
149200     MOVE +1                 TO  MB119-BLK-SUB.                   14700012
149300     MOVE PC-ITEMS-PER-PANEL TO  PV-HIGHEST-ITEM-TO-BE-READ.      14710012
149400     SET MB119-ITEMS-LEFT-ON-DB                                   14720012
149500                             TO  TRUE.                            14730012
149600*                                                                 14740012
149700     MOVE +0                 TO  MB119-ITEM-SUB                   14750012
149800                                 MB119-NUMBER-OF-ITEMS-READ       14760012
149900                                 MB119-NUMBER-OF-SELECTED-ITEMS   14770012
150000                                 MB119-HIGHEST-BLOCK-WRITTEN      14780012
150100                                 MB119-START-OF-SELECTED-RANGE    14790012
150200                                 MB119-END-OF-SELECTED-RANGE.     14800012
150300*                                                                 14810012
150400     MOVE SPACES             TO  MB119-LAST-APLSYS-CODE.          14820012
150500     PERFORM L100-OPEN-CURSOR.                                    14830012
150600*                                                                 14840012
150700     PERFORM H100-READ-ITEMS-FROM-DB.                             14850012
150800     SET PS-DIFFERENT-ITEMS-DISPLAYED                             14860012
150900                             TO  TRUE.                            14870012
151000*                                                                 14880012
151100     MOVE +1                 TO  MB119-ITEM-AT-TOP-OF-PANEL.      14890012
151200*                                                                 14900012
151300     PERFORM G100-DISPLAY-PANEL.                                  14910012
151400*                                                                 14920012
151500 EJECT                                                            14930012
151600******************************************************************14940012
151700*    IF THE USER HIT THE DESELECT KEY, OR A KEY WHICH INVOLVES    14950012
151800*    LEAVING THIS TRANSACTION AND GOING TO ANOTHER, SET A FLAG    14960012
151900*    INDICATING THAT ALL SELECTIONS ARE VALID.  IF ANY OTHER KEY  14970012
152000*    IS HIT, MOVE THE SELECTIONS MADE TO THE COMMAREA, AND EDIT   14980012
152100*    THOSE SELECTIONS.                                            14990012
152200*                                                                 15000012
152300*    IF THE USER ENTERED SOMETHING IN THE COMMAND LINE OR HIT     15010012
152400*    AN INVALID FUNCTION KEY, DO NOT EDIT THE SELECTIONS.         15020012
152500*                                                                 15030012
152600*    PERFORMED BY C300-PROCESS-PANEL.                             15040012
152700******************************************************************15050012
152800*                                                                 15060012
152900 D200-RECORD-SELECTIONS.                                          15070012
153000*                                                                 15080012
153100     IF (DP020-FK-DESELECT(DP020-SRC-AID))   OR                   15090012
153200        (DP020-FK-SELECT-ALL(DP020-SRC-AID)) OR                   15100012
153300        (DP020-FK-GO-TO-TRAN(DP020-SRC-AID)) OR                   15110012
153400        (DP020-FK-RETURN(DP020-SRC-AID))                          15120012
153500         SET PS-VALID-SELECTIONS TO TRUE                          15130012
153600     ELSE                                                         15140012
153700*                                                                 15150012
153800         PERFORM E200-MOVE-SELECTS-TO-COMMAREA                    15160012
153900         IF (DP020-SRC-AID          = DP016-ENTER) AND            15170012
154000            (DP020-NAV-MNEMONIC NOT = SPACES)      AND            15180012
154100            (DP020-NAV-MNEMONIC NOT = LOW-VALUES)                 15190012
154200             SET PS-VALID-SELECTIONS TO TRUE                      15200012
154300         ELSE                                                     15210012
154400*                                                                 15220012
154500*            IF (DP020-FK-FIRST-PAGE(DP020-SRC-AID)) OR           15230012
154600*               (DP020-FK-PREV-PAGE(DP020-SRC-AID))  OR           15240012
154700*               (DP020-FK-NEXT-PAGE(DP020-SRC-AID))  OR           15250012
154800*               (DP020-FK-EDIT-GOTO(DP020-SRC-AID))  OR           15260012
154900*               (DP020-SRC-AID = DP016-ENTER)                     15270012
155000                 PERFORM E100-EDIT-SELECTIONS                     15280012
155100*            ELSE                                                 15290012
155200                 SET PS-VALID-SELECTIONS TO TRUE                  15300012
155300*            END-IF                                               15310012
155400         END-IF                                                   15320012
155500     END-IF.                                                      15330012
155600 EJECT                                                            15340012
155700******************************************************************15350012
155800*    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHICH FUNCTION    15360012
155900*    KEY HAD BEEN SELECTED BY THE USER.                           15370012
156000*                                                                 15380012
156100*    PERFORMED BY C300-PROCESS-PANEL.                             15390012
156200******************************************************************15400012
156300*                                                                 15410012
156400 D300-CHECK-FUNCTION-KEY.                                         15420012
156500*                                                                 15430012
156600     EVALUATE TRUE                                                15440012
156700*                                                                 15450012
156800         WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                  15460012
156900              PERFORM E300-NAVIGATE                               15470012
157000*                                                                 15480012
157100*    FOR THE ADD FUNCTION (PF13) NO SELECTED ITEMS REQUIRED.      15490012
157200*                                                                 15500012
157300         WHEN DP020-SRC-AID EQUAL DP016-PF13                      15510012
157400              IF  MB119-NUMBER-OF-SELECTED-ITEMS > ZERO           15520012
157500                  PERFORM X100-PROCESS-ADD                        15530012
157600              ELSE                                                15540012
157700                  MOVE PC-TSYMSG-00057                            15550012
157800                               TO  DP020-MSG-NUMBER               15560012
157900                  SET DP020-MSG-WARNING                           15570012
158000                               TO  TRUE                           15580012
158100              END-IF                                              15590012
158200              PERFORM G100-DISPLAY-PANEL                          15600012
158300*                                                                 15610012
158400         WHEN DP020-FK-RETURN(DP020-SRC-AID)                      15620012
158500              PERFORM E300-NAVIGATE                               15630012
158600*                                                                 15640012
158700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  15650012
158800              PERFORM E400-DISPLAY-TOP-OF-LIST                    15660012
158900*                                                                 15670012
159000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   15680012
159100              PERFORM E500-BROWSE-BACKWARD                        15690012
159200*                                                                 15700012
159300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   15710012
159400              PERFORM E600-BROWSE-FORWARD                         15720012
159500*                                                                 15730012
159600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    15740012
159700              PERFORM E700-DESELECT-ALL-ITEMS                     15750012
159800*                                                                 15760012
159900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  15770012
160000              PERFORM E900-SELECT-ALL-ITEMS                       15780012
160100*                                                                 15790012
160200         WHEN DP020-SRC-AID = DP016-ENTER                         15800012
160300             IF (DP020-NAV-MNEMONIC = LOW-VALUES) OR              15810012
160400                (DP020-NAV-MNEMONIC = SPACES)                     15820012
160500                 PERFORM E800-CHECK-FOR-JUMP-BROWSE               15830012
160600             ELSE                                                 15840012
160700                 PERFORM E300-NAVIGATE                            15850012
160800             END-IF                                               15860012
160900*                                                                 15870012
161000         WHEN OTHER                                               15880012
161100             MOVE PC-TSYMSG-00045                                 15890012
161200                               TO  DP020-MSG-NUMBER               15900012
161300             SET DP020-MSG-FATAL                                  15910012
161400                               TO  TRUE                           15920012
161500             PERFORM G100-DISPLAY-PANEL                           15930012
161600*                                                                 15940012
161700     END-EVALUATE.                                                15950012
161800 EJECT                                                            15960012
161900******************************************************************15970012
162000*    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, 15980012
162100*    READ TEMPORARY STORAGE FILLING IN BOTH BLOCKS IN THE ARRAY   15990012
162200*    WITH THE ITEMS THAT WERE AT THE TOP OF THE LIST WHEN WE      16000012
162300*    HAD LEFT PREVIOUSLY.                                         16010012
162400*                                                                 16020012
162500*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                   16030012
162600******************************************************************16040012
162700*                                                                 16050012
162800 D400-REFRESH-BLOCK-ARRAY.                                        16060012
162900*                                                                 16070012
163000     COMPUTE PV-TEMP-BLOCK-NUMBER =                               16080012
163100         1 + ((MB119-LIST-ITEM-NUMBER(1 1) - 1) /                 16090012
163200               PC-ITEMS-PER-BLOCK).                               16100012
163300                                                                  16110012
163400     MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                16120012
163500     MOVE +1                   TO MB119-BLK-SUB.                  16130012
163600                                                                  16140012
163700     PERFORM Z100-READ-TEMP-STORAGE.                              16150012
163800                                                                  16160012
163900     ADD +1 TO PV-BLOCK-NUMBER.                                   16170012
164000                                                                  16180012
164100     IF (PV-BLOCK-NUMBER < MB119-HIGHEST-BLOCK-WRITTEN) OR        16190012
164200        (PV-BLOCK-NUMBER = MB119-HIGHEST-BLOCK-WRITTEN)           16200012
164300         ADD +1 TO MB119-BLK-SUB                                  16210012
164400                                                                  16220012
164500         PERFORM Z100-READ-TEMP-STORAGE                           16230012
164600     END-IF.                                                      16240012
164700*                                                                 16250012
164800 EJECT                                                            16260012
164900******************************************************************16270012
165000*    EDIT EACH SELECTION ENTRY.  IF EACH ENTRY IS CONSIDERED      16280012
165100*    VALID, CHECK IF A BEGINNING AND ENDING ENTRY WAS ENTERED,    16290012
165200*    AND CHECK THE FOLLOWING.                                     16300012
165300*                                                                 16310012
165400*    1) IF THERE IS A BEGINNING RANGE, THERE MUST BE AN ENDING.   16320012
165500*    2) IF THERE IS A ENDING RANGE, THERE MUST BE AN BEGINNING.   16330012
165600*    3) BEGINNING RANGE MUST PRECEDE ENDING RANGE.                16340012
165700*                                                                 16350012
165800*    IF A VALID BEGINNING AND ENDING RANGE HAVE BEEN SELECTED,    16360012
165900*    MARK ALL ITEMS IN THAT RANGE AS BEING SELECTED.              16370012
166000*                                                                 16380012
166100*    PERFORMED BY B100-CONTROL-PROCESSING.                        16390012
166200*    PERFORMED BY C300-PROCESS-PANEL.                             16400012
166300*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                   16410012
166400*    PERFORMED BY D200-RECORD-SELECTIONS.                         16420012
166500******************************************************************16430012
166600*                                                                 16440012
166700 E100-EDIT-SELECTIONS.                                            16450012
166800*                                                                 16460012
166900     SET PS-VALID-SELECTIONS TO TRUE.                             16470012
167000                                                                  16480012
167100     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            16490012
167200         (MB119-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   16500012
167300     MOVE MB119-ITEM-AT-TOP-OF-PANEL                              16510012
167400                               TO  PV-ITEM-IN-USE.                16520012
167500     MOVE +1                   TO  PS-SUB.                        16530012
167600*                                                                 16540012
167700     PERFORM F100-EDIT                                            16550012
167800         UNTIL (PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL)         16560012
167900            OR (PV-ITEM-IN-USE > MB119-NUMBER-OF-ITEMS-READ).     16570012
168000*                                                                 16580012
168100     IF  PS-VALID-SELECTIONS                                      16590012
168200         IF  MB119-START-OF-SELECTED-RANGE GREATER ZERO           16600012
168300             IF  MB119-END-OF-SELECTED-RANGE GREATER              16610012
168400                 MB119-START-OF-SELECTED-RANGE                    16620012
168500                 PERFORM F200-MARK-RANGE-AS-SELECTED              16630012
168600             ELSE                                                 16640012
168700*                                                                 16650012
168800                 IF  MB119-END-OF-SELECTED-RANGE = +0             16660012
168900                     SET PS-CURSOR-POSITIONED                     16670012
169000                               TO  TRUE                           16680012
169100                     SET PS-WARNING                               16690012
169200                               TO  TRUE                           16700012
169300                     MOVE PC-TSYMSG-00051                         16710012
169400                               TO  DP020-MSG-NUMBER               16720012
169500                     IF  NOT DP020-NEXT-ACT-ERROR                 16730012
169600                         SET DP020-MSG-WARNING TO TRUE            16740012
169700                     END-IF                                       16750012
169800                 ELSE                                             16760012
169900*                                                                 16770012
170000                     SET PS-CURSOR-POSITIONED                     16780012
170100                               TO  TRUE                           16790012
170200                     SET PS-INVALID-SELECTIONS                    16800012
170300                               TO  TRUE                           16810012
170400                     SET DP020-MSG-FATAL                          16820012
170500                               TO  TRUE                           16830012
170600                     MOVE PC-TSYMSG-00052                         16840012
170700                               TO  DP020-MSG-NUMBER               16850012
170800                     IF  NOT DP020-NEXT-ACT-ERROR                 16860012
170900                         MOVE MB119-ITEM-AT-TOP-OF-PANEL          16870012
171000                               TO  PV-ITEM-IN-USE                 16880012
171100                         MOVE +1                                  16890012
171200                               TO  PS-SUB                         16900012
171300*                                                                 16910012
171400                         PERFORM                                  16920012
171500                             UNTIL (PV-ITEM-IN-USE >              16930012
171600                                    PV-ENDING-ITEM-ON-PANEL)      16940012
171700                                OR (PV-ITEM-IN-USE >              16950012
171800                                    MB119-NUMBER-OF-ITEMS-READ)   16960012
171900*                                                                 16970012
172000                             PERFORM K100-SET-SUBSCRIPTS          16980012
172100                             IF (MB119-BEGIN(MB119-BLK-SUB        16990012
172200                                             MB119-ITEM-SUB))     17000012
172300                             OR (MB119-END(MB119-BLK-SUB          17010012
172400                                           MB119-ITEM-SUB))       17020012
172500                                 MOVE -1                          17030012
172600                                    TO  MBKM119-SELECTL(PS-SUB)   17040012
172700                                 MOVE PV-ENDING-ITEM-ON-PANEL     17050012
172800                                    TO  PV-ITEM-IN-USE            17060012
172900                             END-IF                               17070012
173000                             ADD +1 TO  PS-SUB                    17080012
173100                             ADD +1 TO  PV-ITEM-IN-USE            17090012
173200                         END-PERFORM                              17100012
173300*                                                                 17110012
173400                     END-IF                                       17120012
173500                 END-IF                                           17130012
173600             END-IF                                               17140012
173700         ELSE                                                     17150012
173800*                                                                 17160012
173900             IF MB119-END-OF-SELECTED-RANGE > +0                  17170012
174000                 SET PS-CURSOR-POSITIONED TO TRUE                 17180012
174100                 SET PS-WARNING           TO TRUE                 17190012
174200                 MOVE PC-TSYMSG-00053                             17200012
174300                               TO  DP020-MSG-NUMBER               17210012
174400                 IF NOT DP020-NEXT-ACT-ERROR                      17220012
174500                     SET DP020-MSG-WARNING TO TRUE                17230012
174600                 END-IF                                           17240012
174700             END-IF                                               17250012
174800         END-IF                                                   17260012
174900     END-IF.                                                      17270012
175000*                                                                 17280012
175100     IF  DP020-MSG-SEVERITY-IND GREATER THAN SPACES               17290012
175200         SET PS-DONT-PROCESS   TO  TRUE                           17300012
175300     END-IF.                                                      17310012
175400*                                                                 17320012
175500 EJECT                                                            17330012
175600******************************************************************17340012
175700*    MOVE THE SELECTIONS MADE FROM THE CURRENT PAGE INTO          17350012
175800*    THE COMMAREA.                                                17360012
175900*                                                                 17370012
176000*    PERFORMED BY D200-RECORD-SELECTIONS.                         17380012
176100******************************************************************17390012
176200*                                                                 17400012
176300 E200-MOVE-SELECTS-TO-COMMAREA.                                   17410012
176400*                                                                 17420012
176500     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            17430012
176600         (MB119-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   17440012
176700                                                                  17450012
176800     MOVE +1                         TO PS-SUB.                   17460012
176900     MOVE MB119-ITEM-AT-TOP-OF-PANEL TO PV-ITEM-IN-USE.           17470012
177000                                                                  17480012
177100     PERFORM F300-CHECK-SELECTIONS                                17490012
177200         UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.          17500012
177300 EJECT                                                            17510012
177400******************************************************************17520012
177500*    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER     17530012
177600*    TRANSACTION, WRITE OUT THE LAST 2 BLOCKS FROM THE ARRAY TO   17540012
177700*    TEMPORARY STORAGE, SET UP THE INTER APPLICATION COMMAREA,    17550012
177800*    AND START THE NAVIGATOR.                                     17560012
177900*                                                                 17570012
178000*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        17580012
178100******************************************************************17590012
178200*                                                                 17600012
178300 E300-NAVIGATE.                                                   17610012
178400*                                                                 17620012
178500     MOVE +1 TO MB119-BLK-SUB.                                    17630012
178600     PERFORM Z150-WRITE-TEMP-STORAGE.                             17640012
178700*                                                                 17650012
178800     ADD +1 TO MB119-BLK-SUB.                                     17660012
178900     PERFORM Z150-WRITE-TEMP-STORAGE.                             17670012
179000*                                                                 17680012
179100     MOVE MB005-INTER-APPL-COMMAREA                               17690012
179200                               TO  MB119-SAVE-INTER-APPL-COMMAREA.17700012
179300     PERFORM DP015-1000-START-NAVIGATOR.                          17710012
179400 EJECT                                                            17720012
179500******************************************************************17730012
179600*    IF THE USER HITS THE 1ST PAGE KEY, COMPUTE THE TOP ITEM      17740012
179700*    NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM           17750012
179800*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS  17760012
179900*    TO BE READ.                                                  17770012
180000*                                                                 17780012
180100*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        17790012
180200******************************************************************17800012
180300*                                                                 17810012
180400 E400-DISPLAY-TOP-OF-LIST.                                        17820012
180500*                                                                 17830012
180600     IF  MB119-NUMBER-OF-ITEMS-READ > +0                          17840012
180700         MOVE +1 TO PV-TOP-ITEM                                   17850012
180800         PERFORM F500-BROWSE                                      17860012
180900     ELSE                                                         17870012
181000         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      17880012
181100         PERFORM G100-DISPLAY-PANEL                               17890012
181200     END-IF.                                                      17900012
181300 EJECT                                                            17910012
181400******************************************************************17920012
181500*    IF THE USER HITS THE PAGE BACKARD KEY, COMPUTE THE TOP       17930012
181600*    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM      17940012
181700*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS  17950012
181800*    TO BE READ.                                                  17960012
181900*                                                                 17970012
182000*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        17980012
182100******************************************************************17990012
182200*                                                                 18000012
182300 E500-BROWSE-BACKWARD.                                            18010012
182400*                                                                 18020012
182500     IF  MB119-NUMBER-OF-ITEMS-READ > +0                          18030012
182600         COMPUTE PV-TOP-ITEM =                                    18040012
182700             MB119-ITEM-AT-TOP-OF-PANEL - PC-ITEMS-PER-PANEL      18050012
182800         PERFORM F500-BROWSE                                      18060012
182900     ELSE                                                         18070012
183000         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      18080012
183100         PERFORM G100-DISPLAY-PANEL                               18090012
183200     END-IF.                                                      18100012
183300*                                                                 18110012
183400 EJECT                                                            18120012
183500******************************************************************18130012
183600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       18140012
183700*    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM      18150012
183800*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS  18160012
183900*    TO BE READ.                                                  18170012
184000*                                                                 18180012
184100*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        18190012
184200******************************************************************18200012
184300*                                                                 18210012
184400 E600-BROWSE-FORWARD.                                             18220012
184500*                                                                 18230012
184600     IF  MB119-NUMBER-OF-ITEMS-READ > +0                          18240012
184700         COMPUTE PV-TOP-ITEM =                                    18250012
184800             MB119-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL      18260012
184900         PERFORM F500-BROWSE                                      18270012
185000     ELSE                                                         18280012
185100         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      18290012
185200         PERFORM G100-DISPLAY-PANEL                               18300012
185300     END-IF.                                                      18310012
185400*                                                                 18320012
185500 EJECT                                                            18330012
185600******************************************************************18340012
185700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION       18350012
185800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.          18360012
185900*                                                                 18370012
186000*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        18380012
186100******************************************************************18390012
186200*                                                                 18400012
186300 E700-DESELECT-ALL-ITEMS.                                         18410012
186400*                                                                 18420012
186500     IF  MB119-NUMBER-OF-ITEMS-READ > +0                          18430012
186600         MOVE +1               TO  MB119-BLK-SUB                  18440012
186700                                                                  18450012
186800         PERFORM F600-CLEAR-SELECTED-INDS                         18460012
186900             VARYING MB119-ITEM-SUB FROM 1 BY 1                   18470012
187000             UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK            18480012
187100                                                                  18490012
187200         ADD +1                TO  MB119-BLK-SUB                  18500012
187300                                                                  18510012
187400         PERFORM F600-CLEAR-SELECTED-INDS                         18520012
187500             VARYING MB119-ITEM-SUB FROM 1 BY 1                   18530012
187600             UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK            18540012
187700                                                                  18550012
187800         MOVE MB119-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER  18560012
187900                                                                  18570012
188000         COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                        18580012
188100             1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK) 18590012
188200                                                                  18600012
188300         IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                 18610012
188400            (MB119-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)18620012
188500             MOVE +1 TO MB119-BLK-SUB                             18630012
188600                                                                  18640012
188700             PERFORM Z150-WRITE-TEMP-STORAGE                      18650012
188800                                                                  18660012
188900             MOVE +1 TO PV-BLOCK-NUMBER                           18670012
189000                                                                  18680012
189100             COMPUTE PV-PREV-BLOCK-IN-ARRAY =                     18690012
189200                 PV-FIRST-BLOCK-IN-ARRAY - 1                      18700012
189300                                                                  18710012
189400             PERFORM                                              18720012
189500                 UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY   18730012
189600                                                                  18740012
189700                 PERFORM Z100-READ-TEMP-STORAGE                   18750012
189800                                                                  18760012
189900                 PERFORM F600-CLEAR-SELECTED-INDS                 18770012
190000                     VARYING MB119-ITEM-SUB FROM 1 BY 1           18780012
190100                     UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK    18790012
190200                                                                  18800012
190300                 PERFORM Z150-WRITE-TEMP-STORAGE                  18810012
190400                                                                  18820012
190500                 ADD +1 TO PV-BLOCK-NUMBER                        18830012
190600                                                                  18840012
190700             END-PERFORM                                          18850012
190800                                                                  18860012
190900             COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                     18870012
191000                 PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY 18880012
191100                                                                  18890012
191200             PERFORM                                              18900012
191300                 UNTIL PV-NEXT-BLOCK-IN-ARRAY >                   18910012
191400                       MB119-HIGHEST-BLOCK-WRITTEN                18920012
191500                                                                  18930012
191600                 MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER   18940012
191700                                                                  18950012
191800                 PERFORM Z100-READ-TEMP-STORAGE                   18960012
191900                                                                  18970012
192000                 PERFORM F600-CLEAR-SELECTED-INDS                 18980012
192100                     VARYING MB119-ITEM-SUB FROM 1 BY 1           18990012
192200                     UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK    19000012
192300                                                                  19010012
192400                 PERFORM Z150-WRITE-TEMP-STORAGE                  19020012
192500                                                                  19030012
192600                 ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                 19040012
192700                                                                  19050012
192800             END-PERFORM                                          19060012
192900                                                                  19070012
193000             MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      19080012
193100                                                                  19090012
193200             PERFORM Z100-READ-TEMP-STORAGE                       19100012
193300         END-IF                                                   19110012
193400                                                                  19120012
193500     END-IF.                                                      19130012
193600                                                                  19140012
193700     MOVE +0 TO MB119-NUMBER-OF-SELECTED-ITEMS.                   19150012
193800     MOVE +0 TO MB119-START-OF-SELECTED-RANGE.                    19160012
193900     MOVE +0 TO MB119-END-OF-SELECTED-RANGE.                      19170012
194000                                                                  19180012
194100     SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                         19190012
194200                                                                  19200012
194300     PERFORM G100-DISPLAY-PANEL.                                  19210012
194400 EJECT                                                            19220012
194500******************************************************************19230012
194600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO     19240012
194700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.    19250012
194800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST   19260012
194900*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.       19270012
195000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT      19280012
195100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           19290012
195200*                                                                 19300012
195300*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        19310012
195400******************************************************************19320012
195500*                                                                 19330012
195600 E800-CHECK-FOR-JUMP-BROWSE.                                      19340012
195700*                                                                 19350012
195800     SET PS-VALID-BEG-ITEM TO TRUE.                               19360012
195900                                                                  19370012
196000     IF (ABEGITMA                   = PC-ERASE-EOF) OR            19380012
196100        (MB119-NUMBER-OF-ITEMS-READ = +0)                         19390012
196200         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      19400012
196300         PERFORM G100-DISPLAY-PANEL                               19410012
196400     ELSE                                                         19420012
196500*                                                                 19430012
196600         MOVE ABEGITMI         TO  DP010I-UNEDITED-FIELD          19440012
196700         MOVE PC-FIELD-LENGTH  TO  DP010I-MAXIMUM-DIGITS          19450012
196800         MOVE +0               TO  DP010I-MAXIMUM-DECIMALS        19460012
196900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  19470012
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         19481013
262978              USING DP010I-NUMERIC-EDIT-AREA                      19482013
197100*                                                                 19490012
197200         IF  NOT DP010I-ERROR-DETECTED                            19500012
197300             MOVE DP010I-NUMERIC-FIELD                            19510012
197400                               TO  PV-BEGITMI-N                   19520012
197500             MOVE PV-BEGITMI-N TO  PV-BEGINNING-ITEM              19530012
197600*                                                                 19540012
197700             IF (PV-BEGINNING-ITEM >  0)          AND             19550012
197800                (PV-BEGINNING-ITEM <  PC-MAX-ITEMS)               19560012
197900                 MOVE PV-BEGINNING-ITEM TO PV-TOP-ITEM            19570012
198000                                                                  19580012
198100                 COMPUTE PV-MAX-ITEMS-TO-BE-READ =                19590012
198200                     ((MB119-NUMBER-OF-ITEMS-READ +               19600012
198300                       PC-MAX-ITEMS-TO-BE-READ)   -               19610012
198400                       PC-ITEMS-PER-PANEL)        + 1             19620012
198500*                                                                 19630012
198600                 IF PV-TOP-ITEM > PV-MAX-ITEMS-TO-BE-READ         19640012
198700                     MOVE PV-MAX-ITEMS-TO-BE-READ                 19650012
198800                               TO  PV-TOP-ITEM                    19660012
198900                     MOVE -1   TO  ABEGITML                       19670012
199000*                                                                 19680012
199100                     IF MB119-NO-ITEMS-LEFT-ON-DB                 19690012
199200                         MOVE PC-TSYMSG-00070                     19700012
199300                               TO  DP020-MSG-NUMBER               19710012
199400                     ELSE                                         19720012
199500                         MOVE PC-TSYMSG-00207                     19730012
199600                               TO  DP020-MSG-NUMBER               19740012
199700                     END-IF                                       19750012
199800*                                                                 19760012
199900                     SET PS-CURSOR-POSITIONED                     19770012
200000                               TO  TRUE                           19780012
200100                     SET DP020-MSG-INFORMATIONAL                  19790012
200200                               TO  TRUE                           19800012
200300                 END-IF                                           19810012
200400                 PERFORM F500-BROWSE                              19820012
200500             ELSE                                                 19830012
200600                 MOVE PC-TSYMSG-00101                             19840012
200700                               TO  DP020-MSG-NUMBER               19850012
200800                 MOVE -1       TO  ABEGITML                       19860012
200900                 MOVE DP015-REVERSE                               19870012
201000                               TO  ABEGITMH                       19880012
201100                 MOVE DP015-RED                                   19890012
201200                               TO  ABEGITMC                       19900012
201300                 MOVE DP015-UNP-NUM-BRT-MDT                       19910012
201400                               TO  ABEGITMA                       19920012
201500                 SET PS-CURSOR-POSITIONED                         19930012
201600                               TO  TRUE                           19940012
201700                 SET DP020-MSG-FATAL                              19950012
201800                               TO  TRUE                           19960012
201900                 SET PS-INVALID-BEG-ITEM                          19970012
202000                               TO  TRUE                           19980012
202100             END-IF                                               19990012
202200*                                                                 20000012
202300         ELSE                                                     20010012
202400             MOVE PC-TSYMSG-00008                                 20020012
202500                               TO  DP020-MSG-NUMBER               20030012
202600             MOVE -1           TO  ABEGITML                       20040012
202700             MOVE DP015-REVERSE                                   20050012
202800                               TO  ABEGITMH                       20060012
202900             MOVE DP015-RED    TO  ABEGITMC                       20070012
203000             MOVE DP015-UNP-NUM-BRT-MDT                           20080012
203100                               TO  ABEGITMA                       20090012
203200             SET PS-CURSOR-POSITIONED                             20100012
203300                               TO  TRUE                           20110012
203400             SET DP020-MSG-FATAL                                  20120012
203500                               TO  TRUE                           20130012
203600             SET PS-INVALID-BEG-ITEM                              20140012
203700                               TO  TRUE                           20150012
203800         END-IF                                                   20160012
203900     END-IF.                                                      20170012
204000*                                                                 20180012
204100     IF  PS-INVALID-BEG-ITEM                                      20190012
204200         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      20200012
204300         PERFORM DP017-0000-GET-CURR-DATE-TIME                    20210012
204400         PERFORM I200-FORMAT-LIST-LINES                           20220012
204500         PERFORM I300-FORMAT-NR-SELECTED                          20230012
204600         PERFORM DP005-0000-FORMAT-MSG-LINES                      20240012
204700         PERFORM DP008-0000-WRITE-PANEL                           20250012
204800     END-IF.                                                      20260012
204900*                                                                 20270012
205000 EJECT                                                            20280012
205100******************************************************************20290012
205200*    IF THE USER HITS THE SELECT KEY, SET THE SELECTION SWITCH    20300012
205300*    FOR ALL ITEMS.                                               20310012
205400*                                                                 20320012
205500*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        20330012
205600******************************************************************20340012
205700*                                                                 20350012
205800 E900-SELECT-ALL-ITEMS.                                           20360012
205900*                                                                 20370012
206000     IF  MB119-NUMBER-OF-ITEMS-READ > +0                          20380012
206100         MOVE +1 TO MB119-BLK-SUB                                 20390012
206200                                                                  20400012
206300         PERFORM F700-SET-SELECTED-INDS                           20410012
206400             VARYING MB119-ITEM-SUB FROM 1 BY 1                   20420012
206500             UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK            20430012
206600                                                                  20440012
206700         ADD +1 TO MB119-BLK-SUB                                  20450012
206800                                                                  20460012
206900         PERFORM F700-SET-SELECTED-INDS                           20470012
207000             VARYING MB119-ITEM-SUB FROM 1 BY 1                   20480012
207100             UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK            20490012
207200                                                                  20500012
207300         MOVE MB119-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER  20510012
207400                                                                  20520012
207500         COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                        20530012
207600             1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK) 20540012
207700                                                                  20550012
207800         IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                 20560012
207900            (MB119-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)20570012
208000             MOVE +1 TO MB119-BLK-SUB                             20580012
208100                                                                  20590012
208200             PERFORM Z150-WRITE-TEMP-STORAGE                      20600012
208300                                                                  20610012
208400             MOVE +1 TO PV-BLOCK-NUMBER                           20620012
208500                                                                  20630012
208600             COMPUTE PV-PREV-BLOCK-IN-ARRAY =                     20640012
208700                 PV-FIRST-BLOCK-IN-ARRAY - 1                      20650012
208800                                                                  20660012
208900             PERFORM                                              20670012
209000                 UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY   20680012
209100                                                                  20690012
209200                 PERFORM Z100-READ-TEMP-STORAGE                   20700012
209300                                                                  20710012
209400                 PERFORM F700-SET-SELECTED-INDS                   20720012
209500                     VARYING MB119-ITEM-SUB FROM 1 BY 1           20730012
209600                     UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK    20740012
209700                                                                  20750012
209800                 PERFORM Z150-WRITE-TEMP-STORAGE                  20760012
209900                                                                  20770012
210000                 ADD +1 TO PV-BLOCK-NUMBER                        20780012
210100                                                                  20790012
210200             END-PERFORM                                          20800012
210300                                                                  20810012
210400             COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                     20820012
210500                 PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY 20830012
210600                                                                  20840012
210700             PERFORM                                              20850012
210800                 UNTIL PV-NEXT-BLOCK-IN-ARRAY >                   20860012
210900                       MB119-HIGHEST-BLOCK-WRITTEN                20870012
211000                                                                  20880012
211100                 MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER   20890012
211200                                                                  20900012
211300                 PERFORM Z100-READ-TEMP-STORAGE                   20910012
211400                                                                  20920012
211500                 PERFORM F700-SET-SELECTED-INDS                   20930012
211600                     VARYING MB119-ITEM-SUB FROM 1 BY 1           20940012
211700                     UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK    20950012
211800                                                                  20960012
211900                 PERFORM Z150-WRITE-TEMP-STORAGE                  20970012
212000                                                                  20980012
212100                 ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                 20990012
212200                                                                  21000012
212300             END-PERFORM                                          21010012
212400                                                                  21020012
212500             MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      21030012
212600                                                                  21040012
212700             PERFORM Z100-READ-TEMP-STORAGE                       21050012
212800         END-IF                                                   21060012
212900                                                                  21070012
213000     END-IF.                                                      21080012
213100                                                                  21090012
213200*    MOVE MB119-NUMBER-OF-ITEMS-READ TO                           21100012
213300*                      MB119-NUMBER-OF-SELECTED-ITEMS.            21110012
213400                                                                  21120012
213500     SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                         21130012
213600                                                                  21140012
213700     PERFORM G100-DISPLAY-PANEL.                                  21150012
213800*                                                                 21160012
213900 EJECT                                                            21170012
214000******************************************************************21180012
214100*    EDIT THE SELECTION ENTRIES.                                  21190012
214200*                                                                 21200012
214300*    1) VALID ENTRIES ARE 'S' 'B' OR 'E'.                         21210012
214400*    2) THERE CAN ONLY BE 1 BEGINNING AND 1 ENDING RANGE.         21220012
214500*                                                                 21230012
214600*    PERFORMED BY E100-EDIT-SELECTIONS.                           21240012
214700******************************************************************21250012
214800*                                                                 21260012
214900 F100-EDIT.                                                       21270012
215000*                                                                 21280012
215100     PERFORM K100-SET-SUBSCRIPTS.                                 21290012
215200                                                                  21300012
215300     IF NOT (MB119-NO-SELECT(MB119-BLK-SUB MB119-ITEM-SUB)) AND   21310012
215400        NOT (MB119-SELECT(MB119-BLK-SUB MB119-ITEM-SUB))          21320012
215500*                                                                 21330012
215600         IF  MB119-BEGIN(MB119-BLK-SUB MB119-ITEM-SUB)            21340012
215700             IF  MB119-START-OF-SELECTED-RANGE                    21350012
215800                 NOT EQUAL PV-ITEM-IN-USE                         21360012
215900*                                                                 21370012
216000                 IF  MB119-START-OF-SELECTED-RANGE = +0           21380012
216100                     MOVE PV-ITEM-IN-USE                          21390012
216200                               TO  MB119-START-OF-SELECTED-RANGE  21400012
216300                 ELSE                                             21410012
216400                     IF PS-VALID-SELECTIONS                       21420012
216500                         MOVE PC-TSYMSG-00054                     21430012
216600                               TO  DP020-MSG-NUMBER               21440012
216700                         IF  NOT DP020-NEXT-ACT-ERROR             21450012
216800                             MOVE -1                              21460012
216900                               TO  MBKM119-SELECTL(PS-SUB)        21470012
217000                         END-IF                                   21480012
217100                     END-IF                                       21490012
217200*                                                                 21500012
217300                     SET DP020-MSG-FATAL                          21510012
217400                               TO  TRUE                           21520012
217500                     SET PS-INVALID-SELECTIONS                    21530012
217600                               TO  TRUE                           21540012
217700                     SET PS-CURSOR-POSITIONED                     21550012
217800                               TO  TRUE                           21560012
217900                 END-IF                                           21570012
218000             END-IF                                               21580012
218100         ELSE                                                     21590012
218200*                                                                 21600012
218300             IF  MB119-END(MB119-BLK-SUB MB119-ITEM-SUB)          21610012
218400                 IF  MB119-END-OF-SELECTED-RANGE                  21620012
218500                     NOT EQUAL PV-ITEM-IN-USE                     21630012
218600*                                                                 21640012
218700                     IF MB119-END-OF-SELECTED-RANGE = +0          21650012
218800                         MOVE PV-ITEM-IN-USE                      21660012
218900                               TO  MB119-END-OF-SELECTED-RANGE    21670012
219000                     ELSE                                         21680012
219100*                                                                 21690012
219200                         IF  PS-VALID-SELECTIONS                  21700012
219300                             MOVE PC-TSYMSG-00055                 21710012
219400                               TO  DP020-MSG-NUMBER               21720012
219500                                                                  21730012
219600                             IF  NOT DP020-NEXT-ACT-ERROR         21740012
219700                                 MOVE -1                          21750012
219800                                    TO  MBKM119-SELECTL(PS-SUB)   21760012
219900                             END-IF                               21770012
220000                         END-IF                                   21780012
220100                         SET PS-INVALID-SELECTIONS                21790012
220200                                    TO  TRUE                      21800012
220300                         SET PS-CURSOR-POSITIONED                 21810012
220400                                    TO  TRUE                      21820012
220500                         SET DP020-MSG-FATAL                      21830012
220600                                    TO  TRUE                      21840012
220700                     END-IF                                       21850012
220800                 END-IF                                           21860012
220900             ELSE                                                 21870012
221000*                                                                 21880012
221100                 IF  PS-VALID-SELECTIONS                          21890012
221200                     MOVE PC-TSYMSG-00005                         21900012
221300                               TO  DP020-MSG-NUMBER               21910012
221400                     IF  NOT DP020-NEXT-ACT-ERROR                 21920012
221500                         MOVE -1                                  21930012
221600                               TO  MBKM119-SELECTL(PS-SUB)        21940012
221700                     END-IF                                       21950012
221800                 END-IF                                           21960012
221900                 SET PS-INVALID-SELECTIONS                        21970012
222000                               TO  TRUE                           21980012
222100                 SET PS-CURSOR-POSITIONED                         21990012
222200                               TO  TRUE                           22000012
222300                 SET DP020-MSG-FATAL                              22010012
222400                               TO  TRUE                           22020012
222500                 MOVE DP015-RED                                   22030012
222600                               TO  MBKM119-SELECTC(PS-SUB)        22040012
222700                 MOVE DP015-REVERSE                               22050012
222800                               TO  MBKM119-SELECTH(PS-SUB)        22060012
222900             END-IF                                               22070012
223000         END-IF                                                   22080012
223100     END-IF.                                                      22090012
223200                                                                  22100012
223300     ADD +1                    TO  PV-ITEM-IN-USE.                22110012
223400     ADD +1                    TO  PS-SUB.                        22120012
223500 EJECT                                                            22130012
223600******************************************************************22140012
223700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE     22150012
223800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS     22160012
223900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.              22170012
224000*                                                                 22180012
224100*    PERFORMED BY E100-EDIT-SELECTIONS.                           22190012
224200******************************************************************22200012
224300*                                                                 22210012
224400 F200-MARK-RANGE-AS-SELECTED.                                     22220012
224500*                                                                 22230012
224600     MOVE +1                   TO  MB119-BLK-SUB.                 22240012
224700     PERFORM G200-MARK-SELECTED-INDS                              22250012
224800         VARYING MB119-ITEM-SUB FROM 1 BY 1                       22260012
224900         UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK.               22270012
225000*                                                                 22280012
225100     ADD +1 TO MB119-BLK-SUB.                                     22290012
225200     PERFORM G200-MARK-SELECTED-INDS                              22300012
225300         VARYING MB119-ITEM-SUB FROM 1 BY 1                       22310012
225400         UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK.               22320012
225500*                                                                 22330012
225600     MOVE MB119-LIST-ITEM-NUMBER(1 1)                             22340012
225700                               TO  PV-LIST-ITEM-NUMBER.           22350012
225800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            22360012
225900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         22370012
226000               PC-ITEMS-PER-BLOCK).                               22380012
226100*                                                                 22390012
226200     MOVE MB119-START-OF-SELECTED-RANGE                           22400012
226300                               TO  PV-START-OF-SELECTED-RANGE.    22410012
226400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            22420012
226500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  22430012
226600               PC-ITEMS-PER-BLOCK).                               22440012
226700*                                                                 22450012
226800     MOVE MB119-END-OF-SELECTED-RANGE                             22460012
226900                               TO  PV-END-OF-SELECTED-RANGE.      22470012
227000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             22480012
227100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    22490012
227200               PC-ITEMS-PER-BLOCK).                               22500012
227300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             22510012
227400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             22520012
227500*                                                                 22530012
227600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    22540012
227700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        22550012
227800         MOVE +1               TO  MB119-BLK-SUB                  22560012
227900         PERFORM Z150-WRITE-TEMP-STORAGE                          22570012
228000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         22580012
228100             PV-FIRST-BLOCK-IN-ARRAY - 1                          22590012
228200*                                                                 22600012
228300         PERFORM                                                  22610012
228400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      22620012
228500                   PV-PREV-BLOCK-IN-ARRAY                         22630012
228600             MOVE PV-FIRST-BLOCK-IN-RANGE                         22640012
228700                               TO  PV-BLOCK-NUMBER                22650012
228800             PERFORM Z100-READ-TEMP-STORAGE                       22660012
228900             PERFORM G200-MARK-SELECTED-INDS                      22670012
229000                 VARYING MB119-ITEM-SUB FROM 1 BY 1               22680012
229100                 UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK        22690012
229200             PERFORM Z150-WRITE-TEMP-STORAGE                      22700012
229300             ADD +1            TO PV-FIRST-BLOCK-IN-RANGE         22710012
229400         END-PERFORM                                              22720012
229500*                                                                 22730012
229600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         22740012
229700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     22750012
229800         PERFORM                                                  22760012
229900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       22770012
230000                   PV-LAST-BLOCK-IN-RANGE                         22780012
230100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          22790012
230200                               TO  PV-BLOCK-NUMBER                22800012
230300             PERFORM Z100-READ-TEMP-STORAGE                       22810012
230400             PERFORM G200-MARK-SELECTED-INDS                      22820012
230500                 VARYING MB119-ITEM-SUB FROM 1 BY 1               22830012
230600                 UNTIL MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK        22840012
230700             PERFORM Z150-WRITE-TEMP-STORAGE                      22850012
230800             ADD +1            TO  PV-NEXT-BLOCK-IN-ARRAY         22860012
230900         END-PERFORM                                              22870012
231000*                                                                 22880012
231100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             22890012
231200                               TO  PV-BLOCK-NUMBER                22900012
231300         PERFORM Z100-READ-TEMP-STORAGE                           22910012
231400     END-IF.                                                      22920012
231500                                                                  22930012
231600     MOVE +0                   TO  MB119-START-OF-SELECTED-RANGE  22940012
231700                                   MB119-END-OF-SELECTED-RANGE.   22950012
231800 EJECT                                                            22960012
231900******************************************************************22970012
232000*    CHECK EACH ENTRY TO DETERMINE IF THE SELECTION CRITERIA IN   22980012
232100*    THE MAP DIFFERS FROM THAT IN THE ARRAY.  IF THEY DO DIFFER,  22990012
232200*    AND THE ARRAY ENTRY SHOWS THAT THE ITEM WAS PREVIOUSLY       23000012
232300*    SELECTED, SUBTRACT 1 FROM THE SELECTED COUNTER.  IF THEY DO  23010012
232400*    DIFFER, AND THE ARRAY ENTRY SHOWS THAT THIS ITEM WAS MARKED  23020012
232500*    AS EITHER THE BEGINNING OR ENDING SELECTION POINT, ZERO OUT  23030012
232600*    THE STARTING RANGE AND/OR ENDING RANGE.  IF THE ENTRY ON     23040012
232700*    THE MAP SHOWS THAT THIS ITEM WAS SELECTED, ADD 1 TO THE      23050012
232800*    SELECTED COUNTER.                                            23060012
232900*                                                                 23070012
233000*    PERFORMED BY E200-MOVE-SELECTS-TO-COMMAREA.                  23080012
233100******************************************************************23090012
233200*                                                                 23100012
233300 F300-CHECK-SELECTIONS.                                           23110012
233400*                                                                 23120012
233500     IF (PV-ITEM-IN-USE < MB119-NUMBER-OF-ITEMS-READ) OR          23130012
233600        (PV-ITEM-IN-USE = MB119-NUMBER-OF-ITEMS-READ)             23140012
233700         PERFORM K100-SET-SUBSCRIPTS                              23150012
233800*                                                                 23160012
233900         IF  MB119-SELECTED-SW(MB119-BLK-SUB MB119-ITEM-SUB)      23170012
234000             NOT EQUAL MBKM119-SELECTI(PS-SUB)                    23180012
234100             SET MB119-BLOCK-MODIFIED(MB119-BLK-SUB)              23190012
234200                               TO  TRUE                           23200012
234300             IF  MB119-SELECT(MB119-BLK-SUB MB119-ITEM-SUB)       23210012
234400                 SUBTRACT +1 FROM MB119-NUMBER-OF-SELECTED-ITEMS  23220012
234500             ELSE                                                 23230012
234600*                                                                 23240012
234700                 IF  MB119-BEGIN(MB119-BLK-SUB MB119-ITEM-SUB)    23250012
234800                     IF  MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB     23260012
234900                                               MB119-ITEM-SUB) =  23270012
235000                         MB119-START-OF-SELECTED-RANGE            23280012
235100                         MOVE +0                                  23290012
235200                               TO  MB119-START-OF-SELECTED-RANGE  23300012
235300                     END-IF                                       23310012
235400                 ELSE                                             23320012
235500*                                                                 23330012
235600                     IF  MB119-END(MB119-BLK-SUB MB119-ITEM-SUB)  23340012
235700                         IF  MB119-LIST-ITEM-NUMBER               23350012
235800                                 (MB119-BLK-SUB MB119-ITEM-SUB)   23360012
235900                         =  MB119-END-OF-SELECTED-RANGE           23370012
236000                             MOVE +0                              23380012
236100                               TO MB119-END-OF-SELECTED-RANGE     23390012
236200                         END-IF                                   23400012
236300                     END-IF                                       23410012
236400                 END-IF                                           23420012
236500             END-IF                                               23430012
236600*                                                                 23440012
236700             IF MBKM119-SELECTI(PS-SUB) = PC-SELECTED             23450012
236800                 ADD +1        TO MB119-NUMBER-OF-SELECTED-ITEMS  23460012
236900             END-IF                                               23470012
237000*                                                                 23480012
237100             IF (MBKM119-SELECTA(PS-SUB) = PC-ERASE-EOF) OR       23490012
237200                (MBKM119-SELECTI(PS-SUB) = SPACES)                23500012
237300                 MOVE SPACES   TO                                 23510012
237400                      MB119-SELECTED-SW(MB119-BLK-SUB             23520012
237500                                        MB119-ITEM-SUB)           23530012
237600             ELSE                                                 23540012
237700                 MOVE MBKM119-SELECTI(PS-SUB) TO                  23550012
237800                      MB119-SELECTED-SW(MB119-BLK-SUB             23560012
237900                                        MB119-ITEM-SUB)           23570012
238000             END-IF                                               23580012
238100         END-IF                                                   23590012
238200     END-IF.                                                      23600012
238300*                                                                 23610012
238400     ADD +1                    TO  PV-ITEM-IN-USE.                23620012
238500     ADD +1                    TO  PS-SUB.                        23630012
238600*                                                                 23640012
238700 EJECT                                                            23650012
238800******************************************************************23660012
238900*    CALCULATE THE NEW TOP AND BOTTOM ITEM NUMBERS BASED ON WHERE 23670012
239000*    THE USER SPECIFIED TO GO ON THE LIST AND DETERMINE WHERE     23680012
239100*    THESE ITEMS CAN BE FOUND (I.E. ARRAY, TEMPORARY STORAGE).    23690012
239200*                                                                 23700012
239300*    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                       23710012
239400*    PERFORMED BY E500-BROWSE-BACKWARD.                           23720012
239500*    PERFORMED BY E600-BROWSE-FORWARD.                            23730012
239600*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                     23740012
239700******************************************************************23750012
239800*                                                                 23760012
239900 F500-BROWSE.                                                     23770012
240000*                                                                 23780012
240100     IF  PV-TOP-ITEM < +1                                         23790012
240200         MOVE +1               TO  PV-TOP-ITEM                    23800012
240300         IF  PS-CURSOR-NOT-POSITIONED                             23810012
240400             MOVE PC-TSYMSG-00069                                 23820012
240500                               TO  DP020-MSG-NUMBER               23830012
240600             SET DP020-MSG-INFORMATIONAL                          23840012
240700                               TO  TRUE                           23850012
240800             SET PS-INFORMATIONAL                                 23860012
240900                               TO  TRUE                           23870012
241000             SET PS-CURSOR-POSITIONED                             23880012
241100                               TO  TRUE                           23890012
241200         END-IF                                                   23900012
241300     END-IF.                                                      23910012
241400*                                                                 23920012
241500     IF  MB119-NO-ITEMS-LEFT-ON-DB                                23930012
241600         IF  PV-TOP-ITEM > MB119-NUMBER-OF-ITEMS-READ             23940012
241700             IF  DP020-SRC-AID EQUAL DP016-ENTER                  23950012
241800                 MOVE MB119-NUMBER-OF-ITEMS-READ                  23960012
241900                               TO  PV-TOP-ITEM                    23970012
242000             ELSE                                                 23980012
242100                 MOVE MB119-ITEM-AT-TOP-OF-PANEL                  23990012
242200                               TO  PV-TOP-ITEM                    24000012
242300             END-IF                                               24010012
242400*                                                                 24020012
242500             IF  PS-CURSOR-NOT-POSITIONED                         24030012
242600                 MOVE -1       TO  ANAVCMDL                       24040012
242700                 SET DP020-MSG-INFORMATIONAL                      24050012
242800                               TO  TRUE                           24060012
242900                 SET PS-CURSOR-POSITIONED                         24070012
243000                               TO  TRUE                           24080012
243100                 MOVE PC-TSYMSG-00070                             24090012
243200                               TO  DP020-MSG-NUMBER               24100012
243300                 SET PS-INFORMATIONAL                             24110012
243400                               TO  TRUE                           24120012
243500             END-IF                                               24130012
243600         END-IF                                                   24140012
243700     END-IF.                                                      24150012
243800*                                                                 24160012
243900     COMPUTE PV-BOTTOM-ITEM =                                     24170012
244000         (PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1.                  24180012
244100                                                                  24190012
244200     IF  MB119-NO-ITEMS-LEFT-ON-DB                                24200012
244300         IF  PV-BOTTOM-ITEM > MB119-NUMBER-OF-ITEMS-READ          24210012
244400             MOVE MB119-NUMBER-OF-ITEMS-READ                      24220012
244500                               TO  PV-BOTTOM-ITEM                 24230012
244600             IF  PS-CURSOR-NOT-POSITIONED                         24240012
244700                 IF  PV-TOP-ITEM NOT = +1                         24250012
244800                     MOVE PC-TSYMSG-00070                         24260012
244900                               TO  DP020-MSG-NUMBER               24270012
245000                     SET PS-INFORMATIONAL                         24280012
245100                               TO  TRUE                           24290012
245200                     SET DP020-MSG-INFORMATIONAL                  24300012
245300                               TO  TRUE                           24310012
245400                     SET PS-CURSOR-POSITIONED                     24320012
245500                               TO  TRUE                           24330012
245600                 END-IF                                           24340012
245700             END-IF                                               24350012
245800         END-IF                                                   24360012
245900     END-IF.                                                      24370012
246000*                                                                 24380012
246100     PERFORM G300-DETERMINE-WHAT-IS-WHERE.                        24390012
246200                                                                  24400012
246300     IF  PS-TOP-ITEM-IN-ARRAY                                     24410012
246400         IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                          24420012
246500             IF  PS-BOTTOM-ITEM-IN-TEMP                           24430012
246600                 PERFORM G500-SCROLL-FORWARD                      24440012
246700             ELSE                                                 24450012
246800                 IF  PS-LAST-BLOCK-NOT-IN-ARRAY                   24460012
246900                     PERFORM G500-SCROLL-FORWARD                  24470012
247000                 END-IF                                           24480012
247100                 PERFORM G400-READ-ITEMS-INTO-ARRAY               24490012
247200             END-IF                                               24500012
247300         END-IF                                                   24510012
247400     ELSE                                                         24520012
247500*                                                                 24530012
247600         IF  PS-BOTTOM-ITEM-IN-ARRAY                              24540012
247700             PERFORM G600-SCROLL-BACKWARD                         24550012
247800         ELSE                                                     24560012
247900             IF  PS-TOP-ITEM-IN-TEMP                              24570012
248000                 PERFORM G700-GET-TOP-ITEMS-BLOCK                 24580012
248100                 PERFORM G300-DETERMINE-WHAT-IS-WHERE             24590012
248200                 IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                  24600012
248300                     PERFORM G400-READ-ITEMS-INTO-ARRAY           24610012
248400                 END-IF                                           24620012
248500             ELSE                                                 24630012
248600                 IF  PS-LAST-BLOCK-NOT-IN-ARRAY                   24640012
248700                     PERFORM G800-GET-LAST-BLOCK-IN-TEMP          24650012
248800                 END-IF                                           24660012
248900                 PERFORM G400-READ-ITEMS-INTO-ARRAY               24670012
249000             END-IF                                               24680012
249100         END-IF                                                   24690012
249200     END-IF.                                                      24700012
249300*                                                                 24710012
249400     IF  PV-TOP-ITEM = MB119-ITEM-AT-TOP-OF-PANEL                 24720012
249500         SET PS-SAME-ITEMS-DISPLAYED                              24730012
249600                               TO  TRUE                           24740012
249700     ELSE                                                         24750012
249800         SET PS-DIFFERENT-ITEMS-DISPLAYED                         24760012
249900                               TO  TRUE                           24770012
250000         MOVE PV-TOP-ITEM      TO  MB119-ITEM-AT-TOP-OF-PANEL     24780012
250100     END-IF.                                                      24790012
250200*                                                                 24800012
250300     PERFORM G100-DISPLAY-PANEL.                                  24810012
250400*                                                                 24820012
250500 EJECT                                                            24830012
250600******************************************************************24840012
250700*    MARK EACH ITEM AS BEING NOT SELECTED.                        24850012
250800*                                                                 24860012
250900*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                        24870012
251000******************************************************************24880012
251100*                                                                 24890012
251200 F600-CLEAR-SELECTED-INDS.                                        24900012
251300*                                                                 24910012
251400     IF  MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB MB119-ITEM-SUB)     24920012
251500             NOT EQUAL ZERO                                       24930012
251600         IF  NOT MB119-NO-SELECT(MB119-BLK-SUB MB119-ITEM-SUB)    24940012
251700             SET MB119-NO-SELECT(MB119-BLK-SUB MB119-ITEM-SUB)    24950012
251800                               TO  TRUE                           24960012
251900             SET MB119-BLOCK-MODIFIED(MB119-BLK-SUB)              24970012
252000                               TO  TRUE                           24980012
252100         END-IF                                                   24990012
252200     END-IF.                                                      25000012
252300*                                                                 25010012
252400 EJECT                                                            25020012
252500******************************************************************25030012
252600*    MARK EACH ITEM AS BEING SELECTED.                            25040012
252700*                                                                 25050012
252800*    PERFORMED BY E900-SELECT-ALL-ITEMS.                          25060012
252900******************************************************************25070012
253000*                                                                 25080012
253100 F700-SET-SELECTED-INDS.                                          25090012
253200*                                                                 25100012
253300     IF  MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB MB119-ITEM-SUB)     25110012
253400             NOT EQUAL ZERO                                       25120012
253500         IF  NOT MB119-SELECT(MB119-BLK-SUB MB119-ITEM-SUB)       25130012
253600             IF  MB119-ATTRIBUTE(MB119-BLK-SUB MB119-ITEM-SUB)    25140012
253700                 NOT EQUAL DP015-ASK-DRK-MDT                      25150012
253800                 ADD 1    TO      MB119-NUMBER-OF-SELECTED-ITEMS  25160012
253900                 SET MB119-SELECT(MB119-BLK-SUB MB119-ITEM-SUB)   25170012
254000                               TO  TRUE                           25180012
254100                 SET MB119-BLOCK-MODIFIED(MB119-BLK-SUB)          25190012
254200                               TO  TRUE                           25200012
254300         END-IF                                                   25210012
254400     END-IF.                                                      25220012
254500*                                                                 25230012
254600 EJECT                                                            25240012
254700******************************************************************25250012
254800*    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.       25260012
254900*                                                                 25270012
255000*    PERFORMED BY B100-CONTROL-PROCESSING.                        25280012
255100*    PERFORMED BY C300-PROCESS-PANEL.                             25290012
255200*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                   25300012
255300*    PERFORMED BY D100-SETUP-INIT-PANEL.                          25310012
255400*    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                       25320012
255500*    PERFORMED BY E500-BROWSE-BACKWARD.                           25330012
255600*    PERFORMED BY E600-BROWSE-FORWARD.                            25340012
255700*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                        25350012
255800*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                     25360012
255900*    PERFORMED BY F500-BROWSE.                                    25370012
256000******************************************************************25380012
256100*                                                                 25390012
256200 G100-DISPLAY-PANEL.                                              25400012
256300*                                                                 25410012
256400     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       25420012
256500     MOVE DP017-EDITED-TIME-HMS                                   25430012
256600                               TO  ATIMEO.                        25440012
256700                                                                  25450012
256800     IF PS-SEND-MAP-N-DATA-FRSET                                  25460012
256900         PERFORM DP002-0000-FORMAT-TITLE-LINES                    25470012
257000         PERFORM DP009-0000-LOAD-FK-LINES                         25480012
257100     END-IF.                                                      25490012
257200                                                                  25500012
257300     IF  MB119-SECOND-PASS                                        25510012
257400         PERFORM H200-FORMAT-PANEL-BODY                           25520012
257500     END-IF.                                                      25530012
257600     MOVE PC-COMPANY           TO  AOPERCOO.                      25540012
257700*                                                                 25550012
257800     PERFORM DP005-0000-FORMAT-MSG-LINES.                         25560012
257900                                                                  25570012
258000     PERFORM DP008-0000-WRITE-PANEL.                              25580012
258100 EJECT                                                            25590012
258200******************************************************************25600012
258300*    MARK EACH ITEM THAT FALLS WITHIN THE BEGINNING AND ENDING    25610012
258400*    RANGE AS BEING SELECTED.                                     25620012
258500*                                                                 25630012
258600*    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                    25640012
258700******************************************************************25650012
258800*                                                                 25660012
258900 G200-MARK-SELECTED-INDS.                                         25670012
259000*                                                                 25680012
259100     IF (MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB                     25690012
259200                                MB119-ITEM-SUB) >                 25700012
259300         MB119-START-OF-SELECTED-RANGE)                           25710012
259400     OR (MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB                     25720012
259500                                MB119-ITEM-SUB) =                 25730012
259600         MB119-START-OF-SELECTED-RANGE)                           25740012
259700*                                                                 25750012
259800         IF (MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB                 25760012
259900                                    MB119-ITEM-SUB) <             25770012
260000             MB119-END-OF-SELECTED-RANGE)                         25780012
260100         OR (MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB                 25790012
260200                                    MB119-ITEM-SUB) =             25800012
260300             MB119-END-OF-SELECTED-RANGE)                         25810012
260400*                                                                 25820012
260500             IF NOT MB119-SELECT(MB119-BLK-SUB MB119-ITEM-SUB)    25830012
260600                 SET MB119-SELECT(MB119-BLK-SUB                   25840012
260700                                  MB119-ITEM-SUB)                 25850012
260800                               TO  TRUE                           25860012
260900                 SET MB119-BLOCK-MODIFIED(MB119-BLK-SUB)          25870012
261000                               TO  TRUE                           25880012
261100                 ADD +1        TO MB119-NUMBER-OF-SELECTED-ITEMS  25890012
261200             END-IF                                               25900012
261300         END-IF                                                   25910012
261400     END-IF.                                                      25920012
261500 EJECT                                                            25930012
261600******************************************************************25940012
261700*    DETERMINE WHETHER THE TOP ITEM AND BOTTOM ITEM CAN BE FOUND  25950012
261800*    IN THE ARRAY, IN TEMPORARY STORAGE, OR NEITHER.              25960012
261900*                                                                 25970012
262000*    PERFORMED BY F500-BROWSE.                                    25980012
262100******************************************************************25990012
262200*                                                                 26000012
262300 G300-DETERMINE-WHAT-IS-WHERE.                                    26010012
262400*                                                                 26020012
262500     MOVE MB119-LIST-ITEM-NUMBER(1 1)                             26030012
262600                               TO  PV-FIRST-ITEM-IN-ARRAY.        26040012
262700     COMPUTE PV-LAST-ITEM-IN-ARRAY =                              26050012
262800         (PV-FIRST-ITEM-IN-ARRAY +                                26060012
262900         (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-BLOCK)) - 1.      26070012
263000     IF  PV-LAST-ITEM-IN-ARRAY > MB119-NUMBER-OF-ITEMS-READ       26080012
263100         MOVE MB119-NUMBER-OF-ITEMS-READ                          26090012
263200                               TO  PV-LAST-ITEM-IN-ARRAY          26100012
263300     END-IF.                                                      26110012
263400*                                                                 26120012
263500     COMPUTE PV-LAST-ITEM-IN-TEMP =                               26130012
263600         MB119-HIGHEST-BLOCK-WRITTEN * PC-ITEMS-PER-BLOCK.        26140012
263700     IF  PV-LAST-ITEM-IN-TEMP > MB119-NUMBER-OF-ITEMS-READ        26150012
263800         MOVE MB119-NUMBER-OF-ITEMS-READ                          26160012
263900                               TO  PV-LAST-ITEM-IN-TEMP           26170012
264000     END-IF.                                                      26180012
264100*                                                                 26190012
264200     IF (PV-TOP-ITEM > PV-FIRST-ITEM-IN-ARRAY)                    26200012
264300     OR (PV-TOP-ITEM = PV-FIRST-ITEM-IN-ARRAY)                    26210012
264400         IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-ARRAY)                 26220012
264500         OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-ARRAY)                 26230012
264600             SET PS-TOP-ITEM-IN-ARRAY                             26240012
264700                               TO  TRUE                           26250012
264800         ELSE                                                     26260012
264900             SET PS-TOP-ITEM-NOT-IN-ARRAY                         26270012
265000                               TO  TRUE                           26280012
265100         END-IF                                                   26290012
265200     ELSE                                                         26300012
265300         SET PS-TOP-ITEM-NOT-IN-ARRAY                             26310012
265400                               TO  TRUE                           26320012
265500     END-IF.                                                      26330012
265600*                                                                 26340012
265700     IF (PV-BOTTOM-ITEM > PV-FIRST-ITEM-IN-ARRAY)                 26350012
265800     OR (PV-BOTTOM-ITEM = PV-FIRST-ITEM-IN-ARRAY)                 26360012
265900         IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-ARRAY)              26370012
266000         OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-ARRAY)              26380012
266100             SET PS-BOTTOM-ITEM-IN-ARRAY                          26390012
266200                               TO  TRUE                           26400012
266300         ELSE                                                     26410012
266400             SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                      26420012
266500                               TO  TRUE                           26430012
266600         END-IF                                                   26440012
266700     ELSE                                                         26450012
266800         SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                          26460012
266900                               TO  TRUE                           26470012
267000     END-IF.                                                      26480012
267100*                                                                 26490012
267200     IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-TEMP)                      26500012
267300     OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-TEMP)                      26510012
267400         SET PS-TOP-ITEM-IN-TEMP                                  26520012
267500                               TO  TRUE                           26530012
267600     ELSE                                                         26540012
267700         SET PS-TOP-ITEM-NOT-IN-TEMP                              26550012
267800                               TO  TRUE                           26560012
267900     END-IF.                                                      26570012
268000*                                                                 26580012
268100     IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-TEMP)                   26590012
268200     OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-TEMP)                   26600012
268300         SET PS-BOTTOM-ITEM-IN-TEMP                               26610012
268400                               TO  TRUE                           26620012
268500     ELSE                                                         26630012
268600         SET PS-BOTTOM-ITEM-NOT-IN-TEMP                           26640012
268700                               TO  TRUE                           26650012
268800     END-IF.                                                      26660012
268900*                                                                 26670012
269000     IF PV-LAST-ITEM-IN-TEMP > PV-LAST-ITEM-IN-ARRAY              26680012
269100         SET PS-LAST-BLOCK-NOT-IN-ARRAY                           26690012
269200                               TO  TRUE                           26700012
269300     ELSE                                                         26710012
269400         SET PS-LAST-BLOCK-IN-ARRAY                               26720012
269500                               TO  TRUE                           26730012
269600     END-IF.                                                      26740012
269700*                                                                 26750012
269800 EJECT                                                            26760012
269900******************************************************************26770012
270000*    DETERMINE THE SPOT IN THE ARRAY WHERE THE LAST ITEM FROM     26780012
270100*    THE DATA BASE WAS ADDED SO WE KNOW WHERE TO ADD THE NEW      26790012
270200*    ITEMS.  USE THE SAVED UPC KEY TO START THE BROWSE.  H600     26800012
270300*    MUST BE PERFORMED TO POSITION TO THE FIRST UPC TO PROCESS.   26810012
270400*                                                                 26820012
270500*    PERFORMED BY F500-BROWSE.                                    26830012
270600******************************************************************26840012
270700*                                                                 26850012
270800 G400-READ-ITEMS-INTO-ARRAY.                                      26860012
270900*                                                                 26870012
271000     COMPUTE PS-ITEM-SUB =                                        26880012
271100         (MB119-NUMBER-OF-ITEMS-READ -                            26890012
271200          MB119-LIST-ITEM-NUMBER(1 1)) + 1.                       26900012
271300                                                                  26910012
271400     MOVE PS-ITEM-SUB TO MB119-ITEM-SUB.                          26920012
271500                                                                  26930012
271600     IF  MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK                      26940012
271700         SUBTRACT PC-ITEMS-PER-BLOCK                              26950012
271800                             FROM  MB119-ITEM-SUB                 26960012
271900         MOVE PC-MAX-BLOCKS-IN-ARRAY                              26970012
272000                               TO  MB119-BLK-SUB                  26980012
272100     ELSE                                                         26990012
272200         MOVE +1               TO  MB119-BLK-SUB                  27000012
272300     END-IF.                                                      27010012
272400*                                                                 27020012
272500     MOVE PV-BOTTOM-ITEM       TO  PV-HIGHEST-ITEM-TO-BE-READ.    27030012
272600*                                                                 27040012
272700     PERFORM L100-OPEN-CURSOR.                                    27050012
272800     PERFORM H100-READ-ITEMS-FROM-DB.                             27060012
272900     IF  PV-ITEMS-READ EQUAL ZERO                                 27070012
273000         MOVE MB119-ITEM-AT-TOP-OF-PANEL                          27080012
273100                               TO  PV-TOP-ITEM                    27090012
273200     END-IF.                                                      27100012
273300*                                                                 27110012
273400     IF  MB119-NO-ITEMS-LEFT-ON-DB                                27120012
273500         IF  PV-TOP-ITEM > MB119-NUMBER-OF-ITEMS-READ             27130012
273600             MOVE MB119-NUMBER-OF-ITEMS-READ                      27140012
273700                               TO  PV-TOP-ITEM                    27150012
273800         END-IF                                                   27160012
273900         MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER               27170012
274000         SET DP020-MSG-INFORMATIONAL                              27180012
274100                               TO  TRUE                           27190012
274200         SET PS-INFORMATIONAL                                     27200012
274300                               TO  TRUE                           27210012
274400     END-IF.                                                      27220012
274500*                                                                 27230012
274600 EJECT                                                            27240012
274700******************************************************************27250012
274800*    IF THE TOP ITEM WE NEED IS IN THE ARRAY, BUT THE BOTTOM      27260012
274900*    ITEM WE NEED IS IN TEMPORARY STORAGE OR HAS NOT BEEN READ    27270012
275000*    YET, WRITE OUT THE 1ST BLOCK IN THE ARRAY TO TEMPORARY       27280012
275100*    STORAGE.  MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK   27290012
275200*    AND READ THE BLOCK NEEDED INTO THE 2ND BLOCK OF THE ARRAY.   27300012
275300*    THE TOP ITEM WILL BE LOCATED IN THE 1ST BLOCK, AND THE       27310012
275400*    BOTTOM ITEM WILL EITHER BE LOCATED IN THE 2ND BLOCK OR       27320012
275500*    WILL BE PLACED IN THE 2ND BLOCK.                             27330012
275600*                                                                 27340012
275700*    PERFORMED BY F500-BROWSE.                                    27350012
275800******************************************************************27360012
275900*                                                                 27370012
276000 G500-SCROLL-FORWARD.                                             27380012
276100*                                                                 27390012
276200     MOVE +1                   TO  MB119-BLK-SUB.                 27400012
276300     SET MB119-BLOCK-MODIFIED (1)                                 27410012
276400                               TO  TRUE.                          27420012
276500     PERFORM Z150-WRITE-TEMP-STORAGE.                             27430012
276600*                                                                 27440012
276700     MOVE MB119-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) TO          27450012
276800          MB119-BLOCK-ENTRIES(MB119-BLK-SUB).                     27460012
276900*                                                                 27470012
277000     COMPUTE PV-TEMP-BLOCK-NUMBER =                               27480012
277100         1 + ((PV-BOTTOM-ITEM - 1) / PC-ITEMS-PER-BLOCK).         27490012
277200*                                                                 27500012
277300     MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.               27510012
277400     ADD +1                    TO  MB119-BLK-SUB.                 27520012
277500     PERFORM Z100-READ-TEMP-STORAGE.                              27530012
277600*                                                                 27540012
277700 EJECT                                                            27550012
277800******************************************************************27560012
277900*    IF TOP ITEM WE NEED IS NOT IN THE ARRAY, BUT THE BOTTOM      27570012
278000*    ITEM IS, WRITE BOTH BLOCKS TO TEMPORARY STORAGE.  MOVE       27580012
278100*    THE 1ST BLOCK IN THE ARRAY TO THE 2ND BLOCK OF THE ARRAY.    27590012
278200*    READ THE BLOCK THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK 27600012
278300*    OF THE ARRAY.                                                27610012
278400*                                                                 27620012
278500*    PERFORMED BY F500-BROWSE.                                    27630012
278600******************************************************************27640012
278700*                                                                 27650012
278800 G600-SCROLL-BACKWARD.                                            27660012
278900*                                                                 27670012
279000     MOVE +1                   TO  MB119-BLK-SUB.                 27680012
279100     SET MB119-BLOCK-MODIFIED (1)                                 27690012
279200                               TO  TRUE.                          27700012
279300     PERFORM Z150-WRITE-TEMP-STORAGE.                             27710012
279400*                                                                 27720012
279500     ADD +1 TO MB119-BLK-SUB.                                     27730012
279600     SET MB119-BLOCK-MODIFIED (2)                                 27740012
279700                               TO  TRUE.                          27750012
279800     PERFORM Z150-WRITE-TEMP-STORAGE.                             27760012
279900                                                                  27770012
280000     MOVE +1                   TO  MB119-BLK-SUB.                 27780012
280100     MOVE MB119-BLOCK-ENTRIES(MB119-BLK-SUB) TO                   27790012
280200          MB119-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY).            27800012
280300*                                                                 27810012
280400     COMPUTE PV-TEMP-BLOCK-NUMBER =                               27820012
280500         1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).            27830012
280600*                                                                 27840012
280700     MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                27850012
280800     PERFORM Z100-READ-TEMP-STORAGE.                              27860012
280900*                                                                 27870012
281000 EJECT                                                            27880012
281100******************************************************************27890012
281200*    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE      27900012
281300*    ARRAY, BUT THE TOP ITEM IS IN TEMPORARY STORAGE, WRITE BOTH  27910012
281400*    BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ THE BLOCK    27920012
281500*    THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK OF THE ARRAY.  27930012
281600*    IF THERE IS ANOTHER BLOCK IN TEMPORARY STORAGE FOLLOWING     27940012
281700*    THE ONE JUST READ, READ THAT ONE INTO THE 2ND BLOCK OF THE   27950012
281800*    ARRAY, OTHERWISE INITIALIZE THE 2ND BLOCK OF THE ARRAY.      27960012
281900*                                                                 27970012
282000*    PERFORMED BY F500-BROWSE.                                    27980012
282100******************************************************************27990012
282200*                                                                 28000012
282300 G700-GET-TOP-ITEMS-BLOCK.                                        28010012
282400*                                                                 28020012
282500     SET MB119-BLOCK-MODIFIED (1)                                 28030012
282600                               TO  TRUE.                          28040012
282700     MOVE +1                   TO  MB119-BLK-SUB.                 28050012
282800     PERFORM Z150-WRITE-TEMP-STORAGE.                             28060012
282900*                                                                 28070012
283000     SET MB119-BLOCK-MODIFIED (2)                                 28080012
283100                               TO  TRUE.                          28090012
283200     ADD +1                    TO  MB119-BLK-SUB.                 28100012
283300     PERFORM Z150-WRITE-TEMP-STORAGE.                             28110012
283400*                                                                 28120012
283500     COMPUTE PV-TEMP-BLOCK-NUMBER =                               28130012
283600         1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).            28140012
283700*                                                                 28150012
283800     MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.               28160012
283900     MOVE +1                   TO  MB119-BLK-SUB.                 28170012
284000*                                                                 28180012
284100     PERFORM Z100-READ-TEMP-STORAGE.                              28190012
284200                                                                  28200012
284300     ADD +1                    TO  PV-BLOCK-NUMBER.               28210012
284400     ADD +1                    TO  MB119-BLK-SUB.                 28220012
284500*                                                                 28230012
284600     IF (PV-BLOCK-NUMBER < MB119-HIGHEST-BLOCK-WRITTEN) OR        28240012
284700        (PV-BLOCK-NUMBER = MB119-HIGHEST-BLOCK-WRITTEN)           28250012
284800         PERFORM Z100-READ-TEMP-STORAGE                           28260012
284900     ELSE                                                         28270012
285000         PERFORM I100-INITIALIZE-BLOCK                            28280012
285100     END-IF.                                                      28290012
285200*                                                                 28300012
285300 EJECT                                                            28310012
285400******************************************************************28320012
285500*    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE      28330012
285600*    ARRAY AND BOTH ITEMS ARE NOT IN TEMPORARY STORAGE (THE       28340012
285700*    ITEMS HAVE NOT BEEN READ FROM THE DATA BASE YET), AND THE    28350012
285800*    LAST ITEM READ FROM THE DATA BASE IS IN TEMPORARY STORAGE,   28360012
285900*    WRITE BOTH BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ   28370012
286000*    THE HIGHEST BLOCK IN TEMPORARY STORAGE INTO THE 1ST BLOCK    28380012
286100*    OF THE ARRAY, AND INITIALIZE THE 2ND BLOCK IN THE ARRAY.     28390012
286200*    THE 2ND BLOCK WILL BE USED FOR THE NEW ITEMS TO BE READ.     28400012
286300*    THE 1ST BLOCK WILL NOW CONTAIN THE ITEMS THAT WERE LAST      28410012
286400*    READ FROM THE DATA BASE.                                     28420012
286500*                                                                 28430012
286600*    PERFORMED BY F500-BROWSE.                                    28440012
286700******************************************************************28450012
286800*                                                                 28460012
286900 G800-GET-LAST-BLOCK-IN-TEMP.                                     28470012
287000*                                                                 28480012
287100     SET MB119-BLOCK-MODIFIED (1)                                 28490012
287200                               TO  TRUE.                          28500012
287300     MOVE +1                   TO  MB119-BLK-SUB.                 28510012
287400     PERFORM Z150-WRITE-TEMP-STORAGE.                             28520012
287500     SET MB119-BLOCK-MODIFIED (2)                                 28530012
287600                               TO  TRUE.                          28540012
287700     ADD +1                    TO  MB119-BLK-SUB.                 28550012
287800     PERFORM Z150-WRITE-TEMP-STORAGE.                             28560012
287900*                                                                 28570012
288000     MOVE MB119-HIGHEST-BLOCK-WRITTEN                             28580012
288100                               TO  PV-BLOCK-NUMBER.               28590012
288200     MOVE +1                   TO  MB119-BLK-SUB.                 28600012
288300     PERFORM Z100-READ-TEMP-STORAGE.                              28610012
288400*                                                                 28620012
288500     ADD +1                    TO  MB119-BLK-SUB.                 28630012
288600     PERFORM I100-INITIALIZE-BLOCK.                               28640012
288700*                                                                 28650012
288800 EJECT                                                            28660012
288900******************************************************************28670012
289000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE     28680012
289100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,      28690012
289200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND   28700012
289300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE      28710012
289400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                    28720012
289500*                                                                 28730012
289600*    PERFORMED BY D100-SETUP-INIT-PANEL.                          28740012
289700*    PERFORMED BY G400-READ-ITEMS-INTO-ARRAY.                     28750012
289800******************************************************************28760012
289900*                                                                 28770012
290000 H100-READ-ITEMS-FROM-DB.                                         28780012
290100*                                                                 28790012
290200     PERFORM                                                      28800012
290300         UNTIL (MB119-NO-ITEMS-LEFT-ON-DB)   OR                   28810012
290400               (MB119-NUMBER-OF-ITEMS-READ =                      28820012
290500                PV-HIGHEST-ITEM-TO-BE-READ)                       28830012
290600*                                                                 28840012
290700         IF MB119-ITEM-SUB < PC-ITEMS-PER-BLOCK                   28850012
290800             ADD +1            TO  MB119-ITEM-SUB                 28860012
290900         ELSE                                                     28870012
291000             ADD +1            TO  MB119-BLK-SUB                  28880012
291100             MOVE +1           TO  MB119-ITEM-SUB                 28890012
291200*                                                                 28900012
291300             IF MB119-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY            28910012
291400                 MOVE +1       TO  MB119-BLK-SUB                  28920012
291500                 SET MB119-BLOCK-MODIFIED (1)                     28930012
291600                               TO  TRUE                           28940012
291700                 PERFORM Z150-WRITE-TEMP-STORAGE                  28950012
291800                 MOVE MB119-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) 28960012
291900                 TO   MB119-BLOCK-ENTRIES(MB119-BLK-SUB)          28970012
292000                 ADD +1        TO  MB119-BLK-SUB                  28980012
292100                 PERFORM I100-INITIALIZE-BLOCK                    28990012
292200             END-IF                                               29000012
292300         END-IF                                                   29010012
292400*                                                                 29020012
292500         PERFORM L200-FETCH                                       29030012
292600         IF  MB119-ITEMS-LEFT-ON-DB                               29040012
292700             PERFORM L300-CHECK-NEW-KEY                           29050012
292800             IF  PS-USE-IT                                        29060012
292900                 ADD 1         TO  MB119-NUMBER-OF-ITEMS-READ     29070012
293000                                   PV-ITEMS-READ                  29080012
293100                 MOVE MB119-NUMBER-OF-ITEMS-READ                  29090012
293200                               TO  MB119-LIST-ITEM-NUMBER         29100012
293300                                       (MB119-BLK-SUB             29110012
293400                                        MB119-ITEM-SUB)           29120012
293500*                                                                 29130012
293600                 MOVE MDSEAR-GMA-NBR                              29140012
293700                               TO  MB119-GMA                      29150012
293800                                       (MB119-BLK-SUB             29160012
293900                                        MB119-ITEM-SUB)           29170012
294000*                                                                 29180012
294100                 MOVE MDSEAR-DMA-NBR                              29190012
294200                               TO  MB119-DMA                      29200012
294300                                       (MB119-BLK-SUB             29210012
294400                                        MB119-ITEM-SUB)           29220012
294500*                                                                 29230012
294600                 MOVE MDSEAR-DEPT-NBR                             29240012
294700                               TO  MB119-DEPT                     29250012
294800                                       (MB119-BLK-SUB             29260012
294900                                        MB119-ITEM-SUB)           29270012
295000*                                                                 29280012
295100                 MOVE MDSEAR-MAJ-CL-NBR                           29290012
295200                               TO  MB119-MCLASS                   29300012
295300                                       (MB119-BLK-SUB             29310012
295400                                        MB119-ITEM-SUB)           29320012
295500*                                                                 29330012
295600                 MOVE MDSEAR-SUB-CL-NBR                           29340012
295700                               TO  MB119-SCLASS                   29350012
295800                                       (MB119-BLK-SUB             29360012
295900                                        MB119-ITEM-SUB)           29370012
296000*                                                                 29380012
296100                 MOVE MDSEAR-DESC  TO  MB119-DESC                 29390012
296200                                       (MB119-BLK-SUB             29400012
296300                                        MB119-ITEM-SUB)           29410012
296400*                                                                 29420012
296500                 MOVE MDSEAR-STRT-DTE                             29430012
296600                               TO  MB119-DB2-START                29440012
296700                                       (MB119-BLK-SUB             29450012
296800                                        MB119-ITEM-SUB)           29460012
296900*                                                                 29470012
297000                 MOVE MDSEAR-END-DTE                              29480012
297100                               TO  MB119-DB2-END                  29490012
297200                                       (MB119-BLK-SUB             29500012
297300                                        MB119-ITEM-SUB)           29510012
297400*                                                                 29520012
297500                 MOVE MDSEAR-DKEY                                 29530012
297600                               TO  MB119-DKEY                     29540012
297700                                       (MB119-BLK-SUB             29550012
297800                                        MB119-ITEM-SUB)           29560012
297900*                                                                 29570012
298000                 MOVE DP015-UNP-ALP-NOR-MDT                       29580012
298100                               TO  MB119-ATTRIBUTE                29590012
298200                                       (MB119-BLK-SUB             29600012
298300                                        MB119-ITEM-SUB)           29610012
298400                 MOVE DP015-UNDERLINE                             29620012
298500                               TO  MB119-HILIGHT                  29630012
298600                                       (MB119-BLK-SUB             29640012
298700                                        MB119-ITEM-SUB)           29650012
298800*                                                                 29660012
298900             ELSE                                                 29670012
299000                 SUBTRACT 1  FROM  MB119-ITEM-SUB                 29680012
299100             END-IF                                               29690012
299200         END-IF                                                   29700012
299300     END-PERFORM.                                                 29710012
299400*                                                                 29720012
299500     IF (PV-ITEMS-READ GREATER THAN ZERO                          29730012
299600     AND PS-USE-IT)                                               29740012
299700         MOVE MDSEAR-LIST-SEQ-NBR                                 29750012
299800                               TO  MB119-SAVE-SEQ-NBR             29760012
299900     END-IF.                                                      29770012
300000*                                                                 29780012
300100 EJECT                                                            29790012
300200*                                                                 29800012
300300******************************************************************29810012
300400*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.            29820012
300500*                                                                 29830012
300600*    PERFORMED BY G100-DISPLAY-PANEL.                             29840012
300700******************************************************************29850012
300800*                                                                 29860012
300900 H200-FORMAT-PANEL-BODY.                                          29870012
301000*                                                                 29880012
301100     PERFORM I700-FORMAT-FROM-TO-LINE.                            29890012
301200     PERFORM I200-FORMAT-LIST-LINES.                              29900012
301300     PERFORM I300-FORMAT-NR-SELECTED.                             29910012
301400                                                                  29920012
301500     IF NOT DP020-NEXT-ACT-ERROR                                  29930012
301600         PERFORM I800-SET-CURSOR-POSITION                         29940012
301700     END-IF.                                                      29950012
301800*                                                                 29960012
301900 EJECT                                                            29970012
302000******************************************************************29980012
302100*    INITIALIZE A BLOCK IN THE ARRAY.                             29990012
302200*                                                                 30000012
302300*    PERFORMED BY D100-SETUP-INIT-PANEL.                          30010012
302400*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                       30020012
302500*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                    30030012
302600*    PERFORMED BY H100-READ-ITEMS-FROM-DB.                        30040012
302700******************************************************************30050012
302800*                                                                 30060012
302900 I100-INITIALIZE-BLOCK.                                           30070012
303000*                                                                 30080012
303100     INITIALIZE  MB119-BLOCK-ENTRIES (MB119-BLK-SUB).             30090012
303200     SET MB119-BLOCK-NOT-MODIFIED(MB119-BLK-SUB) TO TRUE.         30100012
303300 EJECT                                                            30110012
303400******************************************************************30120012
303500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.     30130012
303600*                                                                 30140012
303700*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                     30150012
303800*    PERFORMED BY H200-FORMAT-PANEL-BODY.                         30160012
303900******************************************************************30170012
304000*                                                                 30180012
304100 I200-FORMAT-LIST-LINES.                                          30190012
304200*                                                                 30200012
304300     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            30210012
304400         (MB119-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   30220012
304500*                                                                 30230012
304600     MOVE MB119-ITEM-AT-TOP-OF-PANEL                              30240012
304700                               TO  PV-ITEM-IN-USE.                30250012
304800     MOVE +1                   TO  PS-SUB.                        30260012
304900*                                                                 30270012
305000     PERFORM J100-PROCESS-ITEMS                                   30280012
305100         UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.          30290012
305200*                                                                 30300012
305300 EJECT                                                            30310012
305400******************************************************************30320012
305500*    FORMAT THE FIELD WHICH WILL SHOW THE NUMBER OF ITEMS THAT    30330012
305600*    WERE SELECTED BY THE USER.                                   30340012
305700*                                                                 30350012
305800*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                     30360012
305900*    PERFORMED BY H200-FORMAT-PANEL-BODY.                         30370012
306000******************************************************************30380012
306100*                                                                 30390012
306200 I300-FORMAT-NR-SELECTED.                                         30400012
306300*                                                                 30410012
306400     MOVE MB119-NUMBER-OF-SELECTED-ITEMS                          30420012
306500                               TO  PV-DISPLAY5.                   30430012
306600     MOVE PV-DISPLAY5          TO  TOTSELO.                       30440012
306700 EJECT                                                            30450012
306800******************************************************************30460012
306900*    FORMAT THE LINE THAT WILL SHOW THE TOTAL NUMBER OF ITEMS WE  30470012
307000*    HAVE ON OUR LIST AND SHOW THE NUMBERS ASSOCIATED WITH THE    30480012
307100*    FIRST AND LAST ITEMS ON CURRENT PAGE.  THIS WILL HELP THE    30490012
307200*    USER DETERMINE HOW FAR THEY ARE INTO THE LIST.               30500012
307300*                                                                 30510012
307400*    PERFORMED BY H200-FORMAT-PANEL-BODY.                         30520012
307500******************************************************************30530012
307600*                                                                 30540012
307700 I700-FORMAT-FROM-TO-LINE.                                        30550012
307800*                                                                 30560012
307900     MOVE MB119-ITEM-AT-TOP-OF-PANEL                              30570012
308000                               TO  PV-DISPLAY5.                   30580012
308100     MOVE PV-DISPLAY5          TO  ABEGITMO.                      30590012
308200*                                                                 30600012
308300     MOVE DP015-GREEN          TO  ABEGITMC.                      30610012
308400     MOVE DP015-UNDERLINE      TO  ABEGITMH.                      30620012
308500     MOVE DP015-UNP-NUM-BRT-MDT                                   30630012
308600                               TO  ABEGITMA.                      30640012
308700*                                                                 30650012
308800     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            30660012
308900         (MB119-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   30670012
309000*                                                                 30680012
309100     IF PV-ENDING-ITEM-ON-PANEL < MB119-NUMBER-OF-ITEMS-READ      30690012
309200         MOVE PV-ENDING-ITEM-ON-PANEL                             30700012
309300                               TO  PV-DISPLAY5                    30710012
309400     ELSE                                                         30720012
309500         MOVE MB119-NUMBER-OF-ITEMS-READ                          30730012
309600                               TO  PV-DISPLAY5                    30740012
309700     END-IF.                                                      30750012
309800     MOVE PV-DISPLAY5          TO  ATOITMO.                       30760012
309900*                                                                 30770012
310000     MOVE MB119-NUMBER-OF-ITEMS-READ                              30780012
310100                               TO  PV-DISPLAY5.                   30790012
310200     MOVE PV-DISPLAY5          TO  ATOTITMO.                      30800012
310300*                                                                 30810012
310400 EJECT                                                            30820012
310500******************************************************************30830012
310600*    IF NO ITEMS WERE READ FROM THE DATA BASE, POINT THE CURSOR   30840012
310700*    TO THE COMMAND LINE, OTHERWISE POINT THE CURSOR TO ONE OF    30850012
310800*    THE SELECTION ENTRIES.                                       30860012
310900*                                                                 30870012
311000*    PERFORMED BY H200-FORMAT-PANEL-BODY.                         30880012
311100******************************************************************30890012
311200*                                                                 30900012
311300 I800-SET-CURSOR-POSITION.                                        30910012
311400*                                                                 30920012
311500     IF MB119-NUMBER-OF-ITEMS-READ = +0                           30930012
311600     AND DP020-MSG-NUMBER NOT NUMERIC                             30940012
311700         MOVE -1               TO  ANAVCMDL                       30950012
311800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               30960012
311900         SET DP020-MSG-WARNING TO  TRUE                           30970012
312000     ELSE                                                         30980012
312100*                                                                 30990012
312200         IF (PS-CURSOR-NOT-POSITIONED) OR                         31000012
312300            (PS-WARNING)               OR                         31010012
312400            (PS-INFORMATIONAL)                                    31020012
312500             PERFORM J200-FIND-LAST-SELECTION                     31030012
312600         END-IF                                                   31040012
312700     END-IF.                                                      31050012
312800*                                                                 31060012
312900 EJECT                                                            31070012
313000******************************************************************31080012
313100*    PROCESS EACH ITEM IN THE ARRAY AND MOVE IT TO THE MAP.       31090012
313200*    FILL THE MAP UNTIL WE HAVE REACHED THE MAXIMUM NUMBER OF     31100012
313300*    MAP ENTRIES.                                                 31110012
313400*                                                                 31120012
313500*    PERFORMED BY I200-FORMAT-LIST-LINES.                         31130012
313600******************************************************************31140012
313700*                                                                 31150012
313800 J100-PROCESS-ITEMS.                                              31160012
313900*                                                                 31170012
314000     IF (PV-ITEM-IN-USE < MB119-NUMBER-OF-ITEMS-READ) OR          31180012
314100        (PV-ITEM-IN-USE = MB119-NUMBER-OF-ITEMS-READ)             31190012
314200         PERFORM K100-SET-SUBSCRIPTS                              31200012
314300         MOVE DP015-UNP-ALP-BRT-MDT                               31210012
314400                               TO  MBKM119-SELECTA(PS-SUB)        31220012
314500*                                                                 31230012
314600         IF (MB119-SELECT(MB119-BLK-SUB MB119-ITEM-SUB))          31240012
314700         OR (MB119-NO-SELECT(MB119-BLK-SUB MB119-ITEM-SUB))       31250012
314800             MOVE DP015-UNDERLINE TO MBKM119-SELECTH(PS-SUB)      31260012
314900             MOVE DP015-GREEN     TO MBKM119-SELECTC(PS-SUB)      31270012
315000         ELSE                                                     31280012
315100*                                                                 31290012
315200             IF (MB119-BEGIN(MB119-BLK-SUB MB119-ITEM-SUB))       31300012
315300             OR (MB119-END(MB119-BLK-SUB MB119-ITEM-SUB))         31310012
315400                 MOVE DP015-UNDERLINE   TO MBKM119-SELECTH(PS-SUB)31320012
315500                 MOVE DP015-GREEN       TO MBKM119-SELECTC(PS-SUB)31330012
315600                 IF (DP020-MSG-NUMBER  =    PC-TSYMSG-00051       31340012
315700                                         OR PC-TSYMSG-00053       31350012
315800                    )                                             31360012
315900*                    UNPAIRED RANGE CHARACTER, SET WARNING        31370012
316000*                    ATTRIBUTES FOR RANGE CHARACTER:              31380012
316100                     MOVE DP015-REVERSE TO MBKM119-SELECTH(PS-SUB)31390012
316200                     MOVE DP015-YELLOW  TO MBKM119-SELECTC(PS-SUB)31400012
316300                 END-IF                                           31410012
316400*                                                                 31420012
316500                 IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00054      31430012
316600                     AND MB119-BEGIN( MB119-BLK-SUB               31440012
316700                                      MB119-ITEM-SUB   )          31450012
316800                    )                                             31460012
316900*                    TWO OR MORE START-OF-RANGE CHARACTERS, SET   31470012
317000*                    ATTRIBUTES FOR START-OF-RANGE CHARACTERS:    31480012
317100                     MOVE DP015-REVERSE TO MBKM119-SELECTH(PS-SUB)31490012
317200                     MOVE DP015-RED     TO MBKM119-SELECTC(PS-SUB)31500012
317300                 END-IF                                           31510012
317400*                                                                 31520012
317500                 IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00055      31530012
317600                     AND MB119-END( MB119-BLK-SUB                 31540012
317700                                    MB119-ITEM-SUB   )            31550012
317800                    )                                             31560012
317900*                    TWO OR MORE END-OF-RANGE CHARACTERS, SET     31570012
318000*                    ATTRIBUTES FOR END-OF-RANGE CHARACTERS:      31580012
318100                     MOVE DP015-REVERSE TO MBKM119-SELECTH(PS-SUB)31590012
318200                     MOVE DP015-RED     TO MBKM119-SELECTC(PS-SUB)31600012
318300                 END-IF                                           31610012
318400*                                                                 31620012
318500                 IF  DP020-MSG-NUMBER  =  PC-TSYMSG-00052         31630012
318600*                    END-OF-RANGE PRECEDES START OF RANGE, SET    31640012
318700*                    ATTRIBUTES OF RANGE CHARACTERS:              31650012
318800                     MOVE DP015-REVERSE TO MBKM119-SELECTH(PS-SUB)31660012
318900                     MOVE DP015-RED     TO MBKM119-SELECTC(PS-SUB)31670012
319000                 END-IF                                           31680012
319100             END-IF                                               31690012
319200                                                                  31700012
319300         END-IF                                                   31710012
319400                                                                  31720012
319500         MOVE MB119-SELECTED-SW(MB119-BLK-SUB MB119-ITEM-SUB)     31730012
319600                               TO  MBKM119-SELECTI(PS-SUB)        31740012
319700*                                                                 31750012
319800         MOVE MB119-ATTRIBUTE (MB119-BLK-SUB MB119-ITEM-SUB)      31760012
319900                               TO  MBKM119-SELECTA(PS-SUB)        31770012
320000         MOVE MB119-HILIGHT   (MB119-BLK-SUB MB119-ITEM-SUB)      31780012
320100                               TO  MBKM119-SELECTH(PS-SUB)        31790012
320200*                                                                 31800012
320300         IF (PS-SEND-MAP-N-DATA-FRSET)                            31810012
320400         OR (PS-DIFFERENT-ITEMS-DISPLAYED)                        31820012
320500*                                                                 31830012
320600             MOVE MB119-GMA       (MB119-BLK-SUB MB119-ITEM-SUB)  31840012
320700                               TO  MBKM119-GMA         (PS-SUB)   31850012
320800*                                                                 31860012
320900             MOVE MB119-DMA       (MB119-BLK-SUB MB119-ITEM-SUB)  31870012
321000                               TO  MBKM119-DMA         (PS-SUB)   31880012
321100*                                                                 31890012
321200             MOVE MB119-DEPT        (MB119-BLK-SUB MB119-ITEM-SUB)31900012
321300                               TO  MBKM119-DEPT        (PS-SUB)   31910012
321400*                                                                 31920012
321500             MOVE MB119-MCLASS    (MB119-BLK-SUB MB119-ITEM-SUB)  31930012
321600                               TO  MBKM119-MCLASS      (PS-SUB)   31940012
321700*                                                                 31950012
321800             MOVE MB119-SCLASS    (MB119-BLK-SUB MB119-ITEM-SUB)  31960012
321900                               TO  MBKM119-SCLASS      (PS-SUB)   31970012
322000*                                                                 31980012
322100             MOVE MB119-DESC      (MB119-BLK-SUB MB119-ITEM-SUB)  31990012
322200                               TO  MBKM119-DESC        (PS-SUB)   32000012
322300*                                                                 32010012
322400             MOVE MB119-DB2-START (MB119-BLK-SUB MB119-ITEM-SUB)  32020012
322500                               TO  PV-DB2-WORK-DATE               32030012
322600             MOVE PV-WD-YY     TO  PV-SD-YY                       32040012
322700             MOVE PV-WD-MM     TO  PV-SD-MM                       32050012
322800             MOVE PV-WD-DD     TO  PV-SD-DD                       32060012
322900             MOVE PV-SCREEN-DATE                                  32070012
323000                               TO  MBKM119-START       (PS-SUB)   32080012
323100*                                                                 32090012
323200             MOVE MB119-DB2-END   (MB119-BLK-SUB MB119-ITEM-SUB)  32100012
323300                               TO  PV-DB2-WORK-DATE               32110012
323400             IF  PV-DB2-WORK-DATE EQUAL PC-NO-DISPLAY-DATE        32120012
323500                 MOVE SPACES   TO  MBKM119-END         (PS-SUB)   32130012
323600             ELSE                                                 32140012
323700                 MOVE PV-WD-YY TO  PV-SD-YY                       32150012
323800                 MOVE PV-WD-MM TO  PV-SD-MM                       32160012
323900                 MOVE PV-WD-DD TO  PV-SD-DD                       32170012
324000                 MOVE PV-SCREEN-DATE                              32180012
324100                               TO  MBKM119-END         (PS-SUB)   32190012
324200             END-IF                                               32200012
324300*                                                                 32210012
324400         END-IF                                                   32220012
324500                                                                  32230012
324600     ELSE                                                         32240012
324700                                                                  32250012
324800         IF (PS-SEND-MAP-N-DATA-FRSET)     OR                     32260012
324900            (PS-DIFFERENT-ITEMS-DISPLAYED)                        32270012
325000             MOVE SPACES       TO  MBKM119-GMA         (PS-SUB)   32280012
325100                                   MBKM119-DMA         (PS-SUB)   32290012
325200                                   MBKM119-DEPT        (PS-SUB)   32300012
325300                                   MBKM119-MCLASS      (PS-SUB)   32310012
325400                                   MBKM119-SCLASS      (PS-SUB)   32320012
325500                                   MBKM119-DESC        (PS-SUB)   32330012
325600                                   MBKM119-START       (PS-SUB)   32340012
325700                                   MBKM119-END         (PS-SUB)   32350012
325800                                   MBKM119-SELECTI  (PS-SUB)      32360012
325900             MOVE DP015-ASK-DRK-MDT                               32370012
326000                               TO  MBKM119-SELECTA(PS-SUB)        32380012
326100         END-IF                                                   32390012
326200                                                                  32400012
326300     END-IF.                                                      32410012
326400                                                                  32420012
326500     ADD +1 TO PV-ITEM-IN-USE.                                    32430012
326600     ADD +1 TO PS-SUB.                                            32440012
326700 EJECT                                                            32450012
326800******************************************************************32460012
326900*    FIND THE LAST SELECTION ENTRY IN THE MAP THAT IS NOT         32470012
327000*    SPACES OR LOW VALUES AND POINT THE CURSOR TO THIS ENTRY.     32480012
327100*    IF ALL ENTRIES ARE SPACES OR LOW VALUES, POINT THE CURSOR    32490012
327200*    TO THE 1ST SELECTION ENTRY IN THE MAP.                       32500012
327300*                                                                 32510012
327400*    PERFORMED BY I800-SET-CURSOR-POSITION.                       32520012
327500******************************************************************32530012
327600*                                                                 32540012
327700 J200-FIND-LAST-SELECTION.                                        32550012
327800*                                                                 32560012
327900     MOVE PC-ITEMS-PER-PANEL TO PS-SUB.                           32570012
328000                                                                  32580012
328100     SET PS-NO-SELECTION-FOUND TO TRUE.                           32590012
328200                                                                  32600012
328300     PERFORM                                                      32610012
328400         UNTIL (PS-SUB = +1)                                      32620012
328500            OR (PS-SELECTION-FOUND)                               32630012
328600         IF  MBKM119-SELECTI(PS-SUB) GREATER THAN SPACES          32640012
328700             SET PS-SELECTION-FOUND                               32650012
328800                               TO  TRUE                           32660012
328900         ELSE                                                     32670012
329000             SUBTRACT +1     FROM  PS-SUB                         32680012
329100         END-IF                                                   32690012
329200     END-PERFORM.                                                 32700012
329300*                                                                 32710012
329400     IF  PS-NO-SELECTION-FOUND                                    32720012
329500         PERFORM                                                  32730012
329600             VARYING PS-SUB                                       32740012
329700             FROM 1 BY 1                                          32750012
329800             UNTIL PS-SUB EQUAL PC-ITEMS-PER-PANEL                32760012
329900              OR  (MBKM119-SELECTA(PS-SUB)                        32770012
330000                   NOT EQUAL DP015-ASK-DRK-MDT)                   32780012
330100         END-PERFORM                                              32790012
330200*                                                                 32800012
330300         IF (PS-SUB EQUAL PC-ITEMS-PER-PANEL                      32810012
330400         AND MBKM119-SELECTA(PS-SUB) EQUAL DP015-ASK-DRK-MDT)     32820012
330500             MOVE -1           TO  ANAVCMDL                       32830012
330600         ELSE                                                     32840012
330700             MOVE -1           TO  MBKM119-SELECTL(PS-SUB)        32850012
330800         END-IF                                                   32860012
330900     ELSE                                                         32870012
331000         MOVE -1               TO  MBKM119-SELECTL(PS-SUB)        32880012
331100     END-IF.                                                      32890012
331200*                                                                 32900012
331300 EJECT                                                            32910012
331400******************************************************************32920012
331500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  32930012
331600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL 32940012
331700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   32950012
331800*                                                                 32960012
331900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS    32970012
332000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT     32980012
332100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION   32990012
332200*    US IN THE 2ND BLOCK OF THE ARRAY.                            33000012
332300*                                                                 33010012
332400*    PERFORMED BY E100-EDIT-SELECTIONS.                           33020012
332500*    PERFORMED BY F100-EDIT.                                      33030012
332600*    PERFORMED BY F300-CHECK-SELECTIONS.                          33040012
332700*    PERFORMED BY J100-PROCESS-ITEMS.                             33050012
332800******************************************************************33060012
332900*                                                                 33070012
333000 K100-SET-SUBSCRIPTS.                                             33080012
333100*                                                                 33090012
333200     COMPUTE PS-ITEM-SUB =                                        33100012
333300         (PV-ITEM-IN-USE - MB119-LIST-ITEM-NUMBER(1 1)) + 1.      33110012
333400                                                                  33120012
333500     MOVE PS-ITEM-SUB TO MB119-ITEM-SUB.                          33130012
333600                                                                  33140012
333700     IF MB119-ITEM-SUB > PC-ITEMS-PER-BLOCK                       33150012
333800         SUBTRACT PC-ITEMS-PER-BLOCK FROM MB119-ITEM-SUB          33160012
333900                                                                  33170012
334000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO MB119-BLK-SUB             33180012
334100     ELSE                                                         33190012
334200         MOVE +1                     TO MB119-BLK-SUB             33200012
334300     END-IF.                                                      33210012
334400*                                                                 33220012
334500 EJECT                                                            33230012
334600******************************************************************33240012
334700*    DETERMINE WHICH CURSOR TO OPEN, AND OPEN IT.                 33250012
334800*                                                                 33260012
334900*    PERFORMED BY D100                                            33270012
335000******************************************************************33280012
335100*                                                                 33290012
335200 L100-OPEN-CURSOR.                                                33300012
335300*                                                                 33310012
335400     EVALUATE TRUE                                                33320012
335500         WHEN MB119-MERCH-CURSOR                                  33330012
335600             PERFORM L110-OPEN-MERCH-CURSOR                       33340012
335700*                                                                 33350012
335800         WHEN MB119-GMA-CURSOR                                    33360012
335900             PERFORM L120-OPEN-GMA-CURSOR                         33370012
336000*                                                                 33380012
336100         WHEN MB119-DMA-CURSOR                                    33390012
336200             PERFORM L130-OPEN-DMA-CURSOR                         33400012
336300*                                                                 33410012
336400         WHEN MB119-DEPT-CURSOR                                   33420012
336500             PERFORM L140-OPEN-DEPT-CURSOR                        33430012
336600*                                                                 33440012
336700         WHEN MB119-MCL-CURSOR                                    33450012
336800             PERFORM L150-OPEN-MCL-CURSOR                         33460012
336900*                                                                 33470012
337000         WHEN MB119-SCL-CURSOR                                    33480012
337100             PERFORM L160-OPEN-SCL-CURSOR                         33490012
337200*                                                                 33500012
337300     END-EVALUATE.                                                33510012
337400*                                                                 33520012
337500 EJECT                                                            33530012
337600******************************************************************33540012
337700*    OPEN THE MERCHANDISE CURSOR.                                 33550012
337800*                                                                 33560012
337900*    PERFORMED BY L100                                            33570012
338000******************************************************************33580012
338100*                                                                 33590012
338200 L110-OPEN-MERCH-CURSOR.                                          33600012
338300*                                                                 33610012
338400     PERFORM                                                      33620012
338500         WITH TEST AFTER                                          33630012
338600         VARYING PV-SQL-SUB                                       33640012
338700         FROM 1 BY 1                                              33650012
338800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             33660012
338900            OR SQLCODE = 0                                        33670012
339000            OR SQLCODE = +100                                     33680012
339100*                                                                 33690012
339200         EXEC SQL                                                 33700012
339300              OPEN MERCH-LIST                                     33710012
339400         END-EXEC                                                 33720012
339500*                                                                 33730012
339600         EVALUATE TRUE                                            33740012
339700             WHEN SQLCODE = -904                                  33750012
339800             WHEN SQLCODE = -913                                  33760012
339900             WHEN SQLCODE = ZERO                                  33770012
340000             WHEN SQLCODE = +100                                  33780012
340100                  CONTINUE                                        33790012
340200             WHEN SQLWARN0 NOT EQUAL SPACE                        33800012
340300             WHEN SQLCODE NOT EQUAL ZERO                          33810012
340400                  MOVE 'L110-OPEN-MERCH-CURSOR'                   33820012
340500                               TO  DP013-PARAGRAPH                33830012
340600                  MOVE 'OPEN MERCH-LIST CURSOR'                   33840012
340700                               TO  DP013-MESSAGE-TEXT (1)         33850012
340800                  MOVE SQLCA   TO  DP013-SQLCA                    33860012
340900                  SET DP013-DB2-ABEND                             33870012
341000                               TO  TRUE                           33880012
341100                  PERFORM DP013-0000-PROCESS-ABEND                33890012
341200         END-EVALUATE                                             33900012
341300     END-PERFORM.                                                 33910012
341400*                                                                 33920012
341500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   33930012
341600         MOVE 'L110-OPEN-MERCH-CURSOR'                            33940012
341700                               TO  DP013-PARAGRAPH                33950012
341800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              33960012
341900                               TO  DP013-MESSAGE-TEXT (1)         33970012
342000         MOVE SQLCA            TO  DP013-SQLCA                    33980012
342100         SET DP013-DB2-ABEND   TO  TRUE                           33990012
342200         PERFORM DP013-0000-PROCESS-ABEND                         34000012
342300     END-IF.                                                      34010012
342400*                                                                 34020012
342500 EJECT                                                            34030012
342600******************************************************************34040012
342700*    OPEN THE GMA CURSOR.                                         34050012
342800*                                                                 34060012
342900*    PERFORMED BY L100                                            34070012
343000******************************************************************34080012
343100*                                                                 34090012
343200 L120-OPEN-GMA-CURSOR.                                            34100012
343300*                                                                 34110012
343400     PERFORM                                                      34120012
343500         WITH TEST AFTER                                          34130012
343600         VARYING PV-SQL-SUB                                       34140012
343700         FROM 1 BY 1                                              34150012
343800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             34160012
343900            OR SQLCODE = 0                                        34170012
344000            OR SQLCODE = +100                                     34180012
344100*                                                                 34190012
344200         EXEC SQL                                                 34200012
344300              OPEN GMA-LIST                                       34210012
344400         END-EXEC                                                 34220012
344500*                                                                 34230012
344600         EVALUATE TRUE                                            34240012
344700             WHEN SQLCODE = -904                                  34250012
344800             WHEN SQLCODE = -913                                  34260012
344900             WHEN SQLCODE = ZERO                                  34270012
345000             WHEN SQLCODE = +100                                  34280012
345100                  CONTINUE                                        34290012
345200             WHEN SQLWARN0 NOT EQUAL SPACE                        34300012
345300             WHEN SQLCODE NOT EQUAL ZERO                          34310012
345400                  MOVE 'L120-OPEN-GMA-CURSOR'                     34320012
345500                               TO  DP013-PARAGRAPH                34330012
345600                  MOVE 'OPEN GMA-LIST CURSOR'                     34340012
345700                               TO  DP013-MESSAGE-TEXT (1)         34350012
345800                  MOVE SQLCA   TO  DP013-SQLCA                    34360012
345900                  SET DP013-DB2-ABEND                             34370012
346000                               TO  TRUE                           34380012
346100                  PERFORM DP013-0000-PROCESS-ABEND                34390012
346200         END-EVALUATE                                             34400012
346300     END-PERFORM.                                                 34410012
346400*                                                                 34420012
346500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   34430012
346600         MOVE 'L120-OPEN-GMA-CURSOR'                              34440012
346700                               TO  DP013-PARAGRAPH                34450012
346800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              34460012
346900                               TO  DP013-MESSAGE-TEXT (1)         34470012
347000         MOVE SQLCA            TO  DP013-SQLCA                    34480012
347100         SET DP013-DB2-ABEND   TO  TRUE                           34490012
347200         PERFORM DP013-0000-PROCESS-ABEND                         34500012
347300     END-IF.                                                      34510012
347400*                                                                 34520012
347500 EJECT                                                            34530012
347600******************************************************************34540012
347700*    OPEN THE DMA CURSOR.                                         34550012
347800*                                                                 34560012
347900*    PERFORMED BY L100                                            34570012
348000******************************************************************34580012
348100*                                                                 34590012
348200 L130-OPEN-DMA-CURSOR.                                            34600012
348300*                                                                 34610012
348400     PERFORM                                                      34620012
348500         WITH TEST AFTER                                          34630012
348600         VARYING PV-SQL-SUB                                       34640012
348700         FROM 1 BY 1                                              34650012
348800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             34660012
348900            OR SQLCODE = 0                                        34670012
349000            OR SQLCODE = +100                                     34680012
349100*                                                                 34690012
349200         EXEC SQL                                                 34700012
349300              OPEN DMA-LIST                                       34710012
349400         END-EXEC                                                 34720012
349500*                                                                 34730012
349600         EVALUATE TRUE                                            34740012
349700             WHEN SQLCODE = -904                                  34750012
349800             WHEN SQLCODE = -913                                  34760012
349900             WHEN SQLCODE = ZERO                                  34770012
350000             WHEN SQLCODE = +100                                  34780012
350100                  CONTINUE                                        34790012
350200             WHEN SQLWARN0 NOT EQUAL SPACE                        34800012
350300             WHEN SQLCODE NOT EQUAL ZERO                          34810012
350400                  MOVE 'L130-OPEN-DMA-CURSOR'                     34820012
350500                               TO  DP013-PARAGRAPH                34830012
350600                  MOVE 'OPEN DMA-LIST CURSOR'                     34840012
350700                               TO  DP013-MESSAGE-TEXT (1)         34850012
350800                  MOVE SQLCA   TO  DP013-SQLCA                    34860012
350900                  SET DP013-DB2-ABEND                             34870012
351000                               TO  TRUE                           34880012
351100                  PERFORM DP013-0000-PROCESS-ABEND                34890012
351200         END-EVALUATE                                             34900012
351300     END-PERFORM.                                                 34910012
351400*                                                                 34920012
351500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   34930012
351600         MOVE 'L130-OPEN-DMA-CURSOR'                              34940012
351700                               TO  DP013-PARAGRAPH                34950012
351800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              34960012
351900                               TO  DP013-MESSAGE-TEXT (1)         34970012
352000         MOVE SQLCA            TO  DP013-SQLCA                    34980012
352100         SET DP013-DB2-ABEND   TO  TRUE                           34990012
352200         PERFORM DP013-0000-PROCESS-ABEND                         35000012
352300     END-IF.                                                      35010012
352400*                                                                 35020012
352500 EJECT                                                            35030012
352600******************************************************************35040012
352700*    OPEN THE DEPT CURSOR.                                        35050012
352800*                                                                 35060012
352900*    PERFORMED BY L100                                            35070012
353000******************************************************************35080012
353100*                                                                 35090012
353200 L140-OPEN-DEPT-CURSOR.                                           35100012
353300*                                                                 35110012
353400     PERFORM                                                      35120012
353500         WITH TEST AFTER                                          35130012
353600         VARYING PV-SQL-SUB                                       35140012
353700         FROM 1 BY 1                                              35150012
353800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             35160012
353900            OR SQLCODE = 0                                        35170012
354000            OR SQLCODE = +100                                     35180012
354100*                                                                 35190012
354200         EXEC SQL                                                 35200012
354300              OPEN DEPT-LIST                                      35210012
354400         END-EXEC                                                 35220012
354500*                                                                 35230012
354600         EVALUATE TRUE                                            35240012
354700             WHEN SQLCODE = -904                                  35250012
354800             WHEN SQLCODE = -913                                  35260012
354900             WHEN SQLCODE = ZERO                                  35270012
355000             WHEN SQLCODE = +100                                  35280012
355100                  CONTINUE                                        35290012
355200             WHEN SQLWARN0 NOT EQUAL SPACE                        35300012
355300             WHEN SQLCODE NOT EQUAL ZERO                          35310012
355400                  MOVE 'L140-OPEN-DEPT-CURSOR'                    35320012
355500                               TO  DP013-PARAGRAPH                35330012
355600                  MOVE 'OPEN DEPT-LIST CURSOR'                    35340012
355700                               TO  DP013-MESSAGE-TEXT (1)         35350012
355800                  MOVE SQLCA   TO  DP013-SQLCA                    35360012
355900                  SET DP013-DB2-ABEND                             35370012
356000                               TO  TRUE                           35380012
356100                  PERFORM DP013-0000-PROCESS-ABEND                35390012
356200         END-EVALUATE                                             35400012
356300     END-PERFORM.                                                 35410012
356400*                                                                 35420012
356500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   35430012
356600         MOVE 'L140-OPEN-DEPT-CURSOR'                             35440012
356700                               TO  DP013-PARAGRAPH                35450012
356800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              35460012
356900                               TO  DP013-MESSAGE-TEXT (1)         35470012
357000         MOVE SQLCA            TO  DP013-SQLCA                    35480012
357100         SET DP013-DB2-ABEND   TO  TRUE                           35490012
357200         PERFORM DP013-0000-PROCESS-ABEND                         35500012
357300     END-IF.                                                      35510012
357400*                                                                 35520012
357500 EJECT                                                            35530012
357600******************************************************************35540012
357700*    OPEN THE MAJOR CLASS CURSOR.                                 35550012
357800*                                                                 35560012
357900*    PERFORMED BY L100                                            35570012
358000******************************************************************35580012
358100*                                                                 35590012
358200 L150-OPEN-MCL-CURSOR.                                            35600012
358300*                                                                 35610012
358400     PERFORM                                                      35620012
358500         WITH TEST AFTER                                          35630012
358600         VARYING PV-SQL-SUB                                       35640012
358700         FROM 1 BY 1                                              35650012
358800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             35660012
358900            OR SQLCODE = 0                                        35670012
359000            OR SQLCODE = +100                                     35680012
359100*                                                                 35690012
359200         EXEC SQL                                                 35700012
359300              OPEN MCL-LIST                                       35710012
359400         END-EXEC                                                 35720012
359500*                                                                 35730012
359600         EVALUATE TRUE                                            35740012
359700             WHEN SQLCODE = -904                                  35750012
359800             WHEN SQLCODE = -913                                  35760012
359900             WHEN SQLCODE = ZERO                                  35770012
360000             WHEN SQLCODE = +100                                  35780012
360100                  CONTINUE                                        35790012
360200             WHEN SQLWARN0 NOT EQUAL SPACE                        35800012
360300             WHEN SQLCODE NOT EQUAL ZERO                          35810012
360400                  MOVE 'L150-OPEN-MCL-CURSOR'                     35820012
360500                               TO  DP013-PARAGRAPH                35830012
360600                  MOVE 'OPEN MCL-LIST CURSOR'                     35840012
360700                               TO  DP013-MESSAGE-TEXT (1)         35850012
360800                  MOVE SQLCA   TO  DP013-SQLCA                    35860012
360900                  SET DP013-DB2-ABEND                             35870012
361000                               TO  TRUE                           35880012
361100                  PERFORM DP013-0000-PROCESS-ABEND                35890012
361200         END-EVALUATE                                             35900012
361300     END-PERFORM.                                                 35910012
361400*                                                                 35920012
361500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   35930012
361600         MOVE 'L150-OPEN-MCL-CURSOR'                              35940012
361700                               TO  DP013-PARAGRAPH                35950012
361800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              35960012
361900                               TO  DP013-MESSAGE-TEXT (1)         35970012
362000         MOVE SQLCA            TO  DP013-SQLCA                    35980012
362100         SET DP013-DB2-ABEND   TO  TRUE                           35990012
362200         PERFORM DP013-0000-PROCESS-ABEND                         36000012
362300     END-IF.                                                      36010012
362400*                                                                 36020012
362500 EJECT                                                            36030012
362600******************************************************************36040012
362700*    OPEN THE SUB CLASS CURSOR.                                   36050012
362800*                                                                 36060012
362900*    PERFORMED BY L100                                            36070012
363000******************************************************************36080012
363100*                                                                 36090012
363200 L160-OPEN-SCL-CURSOR.                                            36100012
363300*                                                                 36110012
363400     PERFORM                                                      36120012
363500         WITH TEST AFTER                                          36130012
363600         VARYING PV-SQL-SUB                                       36140012
363700         FROM 1 BY 1                                              36150012
363800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             36160012
363900            OR SQLCODE = 0                                        36170012
364000            OR SQLCODE = +100                                     36180012
364100*                                                                 36190012
364200         EXEC SQL                                                 36200012
364300              OPEN SCL-LIST                                       36210012
364400         END-EXEC                                                 36220012
364500*                                                                 36230012
364600         EVALUATE TRUE                                            36240012
364700             WHEN SQLCODE = -904                                  36250012
364800             WHEN SQLCODE = -913                                  36260012
364900             WHEN SQLCODE = ZERO                                  36270012
365000             WHEN SQLCODE = +100                                  36280012
365100                  CONTINUE                                        36290012
365200             WHEN SQLWARN0 NOT EQUAL SPACE                        36300012
365300             WHEN SQLCODE NOT EQUAL ZERO                          36310012
365400                  MOVE 'L160-OPEN-SCL-CURSOR'                     36320012
365500                               TO  DP013-PARAGRAPH                36330012
365600                  MOVE 'OPEN SCL-LIST CURSOR'                     36340012
365700                               TO  DP013-MESSAGE-TEXT (1)         36350012
365800                  MOVE SQLCA   TO  DP013-SQLCA                    36360012
365900                  SET DP013-DB2-ABEND                             36370012
366000                               TO  TRUE                           36380012
366100                  PERFORM DP013-0000-PROCESS-ABEND                36390012
366200         END-EVALUATE                                             36400012
366300     END-PERFORM.                                                 36410012
366400*                                                                 36420012
366500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   36430012
366600         MOVE 'L160-OPEN-SCL-CURSOR'                              36440012
366700                               TO  DP013-PARAGRAPH                36450012
366800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              36460012
366900                               TO  DP013-MESSAGE-TEXT (1)         36470012
367000         MOVE SQLCA            TO  DP013-SQLCA                    36480012
367100         SET DP013-DB2-ABEND   TO  TRUE                           36490012
367200         PERFORM DP013-0000-PROCESS-ABEND                         36500012
367300     END-IF.                                                      36510012
367400*                                                                 36520012
367500 EJECT                                                            36530012
367600******************************************************************36540012
367700*    DETERMINE WHICH CURSOR IS OPEN AND FETCH APPROPRIATELY.      36550012
367800*                                                                 36560012
367900*    PERFORMED BY H100                                            36570012
368000******************************************************************36580012
368100*                                                                 36590012
368200 L200-FETCH.                                                      36600012
368300*                                                                 36610012
368400     EVALUATE TRUE                                                36620012
368500         WHEN MB119-MERCH-CURSOR                                  36630012
368600             PERFORM L210-FETCH-MERCH-CURSOR                      36640012
368700*                                                                 36650012
368800         WHEN MB119-GMA-CURSOR                                    36660012
368900             PERFORM L220-FETCH-GMA-CURSOR                        36670012
369000*                                                                 36680012
369100         WHEN MB119-DMA-CURSOR                                    36690012
369200             PERFORM L230-FETCH-DMA-CURSOR                        36700012
369300*                                                                 36710012
369400         WHEN MB119-DEPT-CURSOR                                   36720012
369500             PERFORM L240-FETCH-DEPT-CURSOR                       36730012
369600*                                                                 36740012
369700         WHEN MB119-MCL-CURSOR                                    36750012
369800             PERFORM L250-FETCH-MCL-CURSOR                        36760012
369900*                                                                 36770012
370000         WHEN MB119-SCL-CURSOR                                    36780012
370100             PERFORM L260-FETCH-SCL-CURSOR                        36790012
370200     END-EVALUATE.                                                36800012
370300*                                                                 36810012
370400     EVALUATE TRUE                                                36820012
370500         WHEN MDSEAR-DMA-NBR EQUAL ZERO                           36830012
370600              MOVE SPACES      TO  MDSEAR-DMA-NBR                 36840012
370700                                   MDSEAR-DEPT-NBR                36850012
370800                                   MDSEAR-MAJ-CL-NBR              36860012
370900                                   MDSEAR-SUB-CL-NBR              36870012
371000*                                                                 36880012
371100         WHEN MDSEAR-DEPT-NBR EQUAL ZERO                          36890012
371200              MOVE SPACES      TO  MDSEAR-DEPT-NBR                36900012
371300                                   MDSEAR-MAJ-CL-NBR              36910012
371400                                   MDSEAR-SUB-CL-NBR              36920012
371500*                                                                 36930012
371600         WHEN MDSEAR-MAJ-CL-NBR EQUAL ZERO                        36940012
371700              MOVE SPACES      TO  MDSEAR-MAJ-CL-NBR              36950012
371800                                   MDSEAR-SUB-CL-NBR              36960012
371900*                                                                 36970012
372000         WHEN MDSEAR-SUB-CL-NBR EQUAL ZERO                        36980012
372100              MOVE SPACES      TO  MDSEAR-SUB-CL-NBR              36990012
372200     END-EVALUATE.                                                37000012
372300*                                                                 37010012
372400 EJECT                                                            37020012
372500******************************************************************37030012
372600*    FETCH FROM THE MERCH CURSOR.                                 37040012
372700*                                                                 37050012
372800*    PERFORMED BY L200                                            37060012
372900******************************************************************37070012
373000*                                                                 37080012
373100 L210-FETCH-MERCH-CURSOR.                                         37090012
373200*                                                                 37100012
373300     PERFORM                                                      37110012
373400         WITH TEST AFTER                                          37120012
373500         VARYING PV-SQL-SUB                                       37130012
373600         FROM 1 BY 1                                              37140012
373700         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             37150012
373800            OR SQLCODE = 0                                        37160012
373900            OR SQLCODE = +100                                     37170012
374000*                                                                 37180012
374100         EXEC SQL                                                 37190012
374200              FETCH MERCH-LIST                                    37200012
374300              INTO                                                37210012
374400                     :MDSEAR-OPERCO-NBR                           37220012
374500                   , :MDSEAR-GMA-NBR                              37230012
374600                   , :MDSEAR-DMA-NBR                              37240012
374700                   , :MDSEAR-DEPT-NBR                             37250012
374800                   , :MDSEAR-MAJ-CL-NBR                           37260012
374900                   , :MDSEAR-SUB-CL-NBR                           37270012
375000                   , :MDSEAR-MDSELV-CDE                           37280012
375100                   , :MDSEAR-STRT-DTE                             37290012
375200                   , :MDSEAR-END-DTE                              37300012
375300                   , :MDSEAR-DESC                                 37310012
375400                   , :MDSEAR-LIST-SEQ-NBR                         37320012
375500                   , :MDSEAR-DKEY                                 37330012
375600         END-EXEC                                                 37340012
375700*                                                                 37350012
375800         EVALUATE TRUE                                            37360012
375900             WHEN SQLCODE = -904                                  37370012
376000             WHEN SQLCODE = -913                                  37380012
376100             WHEN SQLCODE = ZERO                                  37390012
376200             WHEN SQLCODE = +100                                  37400012
376300                  CONTINUE                                        37410012
376400             WHEN SQLWARN0 NOT EQUAL SPACE                        37420012
376500             WHEN SQLCODE NOT EQUAL ZERO                          37430012
376600                  MOVE 'L210-FETCH-MERCH-CURSOR'                  37440012
376700                               TO  DP013-PARAGRAPH                37450012
376800                  MOVE 'FETCH MERCH-LIST CURSOR'                  37460012
376900                               TO  DP013-MESSAGE-TEXT (1)         37470012
377000                  MOVE SQLCA   TO  DP013-SQLCA                    37480012
377100                  SET DP013-DB2-ABEND                             37490012
377200                               TO  TRUE                           37500012
377300                  PERFORM DP013-0000-PROCESS-ABEND                37510012
377400         END-EVALUATE                                             37520012
377500     END-PERFORM.                                                 37530012
377600*                                                                 37540012
377700     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   37550012
377800         MOVE 'L210-FETCH-MERCH-CURSOR'                           37560012
377900                               TO  DP013-PARAGRAPH                37570012
378000         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             37580012
378100                               TO  DP013-MESSAGE-TEXT (1)         37590012
378200         MOVE SQLCA            TO  DP013-SQLCA                    37600012
378300         SET DP013-DB2-ABEND   TO  TRUE                           37610012
378400         PERFORM DP013-0000-PROCESS-ABEND                         37620012
378500     END-IF.                                                      37630012
378600*                                                                 37640012
378700     IF  SQLCODE EQUAL +100                                       37650012
378800         SET MB119-NO-ITEMS-LEFT-ON-DB                            37660012
378900                               TO  TRUE                           37670012
379000     END-IF.                                                      37680012
379100*                                                                 37690012
379200 EJECT                                                            37700012
379300******************************************************************37710012
379400*    FETCH FROM THE GMA CURSOR.                                   37720012
379500*                                                                 37730012
379600*    PERFORMED BY L200                                            37740012
379700******************************************************************37750012
379800*                                                                 37760012
379900 L220-FETCH-GMA-CURSOR.                                           37770012
380000*                                                                 37780012
380100     PERFORM                                                      37790012
380200         WITH TEST AFTER                                          37800012
380300         VARYING PV-SQL-SUB                                       37810012
380400         FROM 1 BY 1                                              37820012
380500         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             37830012
380600            OR SQLCODE = 0                                        37840012
380700            OR SQLCODE = +100                                     37850012
380800*                                                                 37860012
380900         EXEC SQL                                                 37870012
381000              FETCH GMA-LIST                                      37880012
381100              INTO                                                37890012
381200                     :MDSEAR-OPERCO-NBR                           37900012
381300                   , :MDSEAR-GMA-NBR                              37910012
381400                   , :MDSEAR-DMA-NBR                              37920012
381500                   , :MDSEAR-DEPT-NBR                             37930012
381600                   , :MDSEAR-MAJ-CL-NBR                           37940012
381700                   , :MDSEAR-SUB-CL-NBR                           37950012
381800                   , :MDSEAR-MDSELV-CDE                           37960012
381900                   , :MDSEAR-STRT-DTE                             37970012
382000                   , :MDSEAR-END-DTE                              37980012
382100                   , :MDSEAR-DESC                                 37990012
382200                   , :MDSEAR-LIST-SEQ-NBR                         38000012
382300                   , :MDSEAR-DKEY                                 38010012
382400         END-EXEC                                                 38020012
382500*                                                                 38030012
382600         EVALUATE TRUE                                            38040012
382700             WHEN SQLCODE = -904                                  38050012
382800             WHEN SQLCODE = -913                                  38060012
382900             WHEN SQLCODE = ZERO                                  38070012
383000             WHEN SQLCODE = +100                                  38080012
383100                  CONTINUE                                        38090012
383200             WHEN SQLWARN0 NOT EQUAL SPACE                        38100012
383300             WHEN SQLCODE NOT EQUAL ZERO                          38110012
383400                  MOVE 'L220-FETCH-GMA-CURSOR'                    38120012
383500                               TO  DP013-PARAGRAPH                38130012
383600                  MOVE 'FETCH GMA-LIST CURSOR'                    38140012
383700                               TO  DP013-MESSAGE-TEXT (1)         38150012
383800                  MOVE SQLCA   TO  DP013-SQLCA                    38160012
383900                  SET DP013-DB2-ABEND                             38170012
384000                               TO  TRUE                           38180012
384100                  PERFORM DP013-0000-PROCESS-ABEND                38190012
384200         END-EVALUATE                                             38200012
384300     END-PERFORM.                                                 38210012
384400*                                                                 38220012
384500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   38230012
384600         MOVE 'L220-FETCH-GMA-CURSOR'                             38240012
384700                               TO  DP013-PARAGRAPH                38250012
384800         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             38260012
384900                               TO  DP013-MESSAGE-TEXT (1)         38270012
385000         MOVE SQLCA            TO  DP013-SQLCA                    38280012
385100         SET DP013-DB2-ABEND   TO  TRUE                           38290012
385200         PERFORM DP013-0000-PROCESS-ABEND                         38300012
385300     END-IF.                                                      38310012
385400*                                                                 38320012
385500     IF  SQLCODE EQUAL +100                                       38330012
385600         SET MB119-NO-ITEMS-LEFT-ON-DB                            38340012
385700                               TO  TRUE                           38350012
385800     END-IF.                                                      38360012
385900*                                                                 38370012
386000 EJECT                                                            38380012
386100******************************************************************38390012
386200*    FETCH FROM THE DMA CURSOR.                                   38400012
386300*                                                                 38410012
386400*    PERFORMED BY L200                                            38420012
386500******************************************************************38430012
386600*                                                                 38440012
386700 L230-FETCH-DMA-CURSOR.                                           38450012
386800*                                                                 38460012
386900     PERFORM                                                      38470012
387000         WITH TEST AFTER                                          38480012
387100         VARYING PV-SQL-SUB                                       38490012
387200         FROM 1 BY 1                                              38500012
387300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             38510012
387400            OR SQLCODE = 0                                        38520012
387500            OR SQLCODE = +100                                     38530012
387600*                                                                 38540012
387700         EXEC SQL                                                 38550012
387800              FETCH DMA-LIST                                      38560012
387900              INTO                                                38570012
388000                     :MDSEAR-OPERCO-NBR                           38580012
388100                   , :MDSEAR-GMA-NBR                              38590012
388200                   , :MDSEAR-DMA-NBR                              38600012
388300                   , :MDSEAR-DEPT-NBR                             38610012
388400                   , :MDSEAR-MAJ-CL-NBR                           38620012
388500                   , :MDSEAR-SUB-CL-NBR                           38630012
388600                   , :MDSEAR-MDSELV-CDE                           38640012
388700                   , :MDSEAR-STRT-DTE                             38650012
388800                   , :MDSEAR-END-DTE                              38660012
388900                   , :MDSEAR-DESC                                 38670012
389000                   , :MDSEAR-LIST-SEQ-NBR                         38680012
389100                   , :MDSEAR-DKEY                                 38690012
389200         END-EXEC                                                 38700012
389300*                                                                 38710012
389400         EVALUATE TRUE                                            38720012
389500             WHEN SQLCODE = -904                                  38730012
389600             WHEN SQLCODE = -913                                  38740012
389700             WHEN SQLCODE = ZERO                                  38750012
389800             WHEN SQLCODE = +100                                  38760012
389900                  CONTINUE                                        38770012
390000             WHEN SQLWARN0 NOT EQUAL SPACE                        38780012
390100             WHEN SQLCODE NOT EQUAL ZERO                          38790012
390200                  MOVE 'L230-FETCH-DMA-CURSOR'                    38800012
390300                               TO  DP013-PARAGRAPH                38810012
390400                  MOVE 'FETCH DMA-LIST CURSOR'                    38820012
390500                               TO  DP013-MESSAGE-TEXT (1)         38830012
390600                  MOVE SQLCA   TO  DP013-SQLCA                    38840012
390700                  SET DP013-DB2-ABEND                             38850012
390800                               TO  TRUE                           38860012
390900                  PERFORM DP013-0000-PROCESS-ABEND                38870012
391000         END-EVALUATE                                             38880012
391100     END-PERFORM.                                                 38890012
391200*                                                                 38900012
391300     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   38910012
391400         MOVE 'L230-FETCH-DMA-CURSOR'                             38920012
391500                               TO  DP013-PARAGRAPH                38930012
391600         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             38940012
391700                               TO  DP013-MESSAGE-TEXT (1)         38950012
391800         MOVE SQLCA            TO  DP013-SQLCA                    38960012
391900         SET DP013-DB2-ABEND   TO  TRUE                           38970012
392000         PERFORM DP013-0000-PROCESS-ABEND                         38980012
392100     END-IF.                                                      38990012
392200*                                                                 39000012
392300     IF  SQLCODE EQUAL +100                                       39010012
392400         SET MB119-NO-ITEMS-LEFT-ON-DB                            39020012
392500                               TO  TRUE                           39030012
392600     END-IF.                                                      39040012
392700*                                                                 39050012
392800 EJECT                                                            39060012
392900******************************************************************39070012
393000*    FETCH FROM THE DEPT CURSOR.                                  39080012
393100*                                                                 39090012
393200*    PERFORMED BY L200                                            39100012
393300******************************************************************39110012
393400*                                                                 39120012
393500 L240-FETCH-DEPT-CURSOR.                                          39130012
393600*                                                                 39140012
393700     PERFORM                                                      39150012
393800         WITH TEST AFTER                                          39160012
393900         VARYING PV-SQL-SUB                                       39170012
394000         FROM 1 BY 1                                              39180012
394100         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             39190012
394200            OR SQLCODE = 0                                        39200012
394300            OR SQLCODE = +100                                     39210012
394400*                                                                 39220012
394500         EXEC SQL                                                 39230012
394600              FETCH DEPT-LIST                                     39240012
394700              INTO                                                39250012
394800                     :MDSEAR-OPERCO-NBR                           39260012
394900                   , :MDSEAR-GMA-NBR                              39270012
395000                   , :MDSEAR-DMA-NBR                              39280012
395100                   , :MDSEAR-DEPT-NBR                             39290012
395200                   , :MDSEAR-MAJ-CL-NBR                           39300012
395300                   , :MDSEAR-SUB-CL-NBR                           39310012
395400                   , :MDSEAR-MDSELV-CDE                           39320012
395500                   , :MDSEAR-STRT-DTE                             39330012
395600                   , :MDSEAR-END-DTE                              39340012
395700                   , :MDSEAR-DESC                                 39350012
395800                   , :MDSEAR-LIST-SEQ-NBR                         39360012
395900                   , :MDSEAR-DKEY                                 39370012
396000         END-EXEC                                                 39380012
396100*                                                                 39390012
396200         EVALUATE TRUE                                            39400012
396300             WHEN SQLCODE = -904                                  39410012
396400             WHEN SQLCODE = -913                                  39420012
396500             WHEN SQLCODE = ZERO                                  39430012
396600             WHEN SQLCODE = +100                                  39440012
396700                  CONTINUE                                        39450012
396800             WHEN SQLWARN0 NOT EQUAL SPACE                        39460012
396900             WHEN SQLCODE NOT EQUAL ZERO                          39470012
397000                  MOVE 'L240-FETCH-DEPT-CURSOR'                   39480012
397100                               TO  DP013-PARAGRAPH                39490012
397200                  MOVE 'FETCH DEPT-LIST CURSOR'                   39500012
397300                               TO  DP013-MESSAGE-TEXT (1)         39510012
397400                  MOVE SQLCA   TO  DP013-SQLCA                    39520012
397500                  SET DP013-DB2-ABEND                             39530012
397600                               TO  TRUE                           39540012
397700                  PERFORM DP013-0000-PROCESS-ABEND                39550012
397800         END-EVALUATE                                             39560012
397900     END-PERFORM.                                                 39570012
398000*                                                                 39580012
398100     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   39590012
398200         MOVE 'L240-FETCH-DEPT-CURSOR'                            39600012
398300                               TO  DP013-PARAGRAPH                39610012
398400         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             39620012
398500                               TO  DP013-MESSAGE-TEXT (1)         39630012
398600         MOVE SQLCA            TO  DP013-SQLCA                    39640012
398700         SET DP013-DB2-ABEND   TO  TRUE                           39650012
398800         PERFORM DP013-0000-PROCESS-ABEND                         39660012
398900     END-IF.                                                      39670012
399000*                                                                 39680012
399100     IF  SQLCODE EQUAL +100                                       39690012
399200         SET MB119-NO-ITEMS-LEFT-ON-DB                            39700012
399300                               TO  TRUE                           39710012
399400     END-IF.                                                      39720012
399500*                                                                 39730012
399600 EJECT                                                            39740012
399700******************************************************************39750012
399800*    FETCH FROM THE MAJOR CLASS CURSOR.                           39760012
399900*                                                                 39770012
400000*    PERFORMED BY L200                                            39780012
400100******************************************************************39790012
400200*                                                                 39800012
400300 L250-FETCH-MCL-CURSOR.                                           39810012
400400*                                                                 39820012
400500     PERFORM                                                      39830012
400600         WITH TEST AFTER                                          39840012
400700         VARYING PV-SQL-SUB                                       39850012
400800         FROM 1 BY 1                                              39860012
400900         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             39870012
401000            OR SQLCODE = 0                                        39880012
401100            OR SQLCODE = +100                                     39890012
401200*                                                                 39900012
401300         EXEC SQL                                                 39910012
401400              FETCH MCL-LIST                                      39920012
401500              INTO                                                39930012
401600                     :MDSEAR-OPERCO-NBR                           39940012
401700                   , :MDSEAR-GMA-NBR                              39950012
401800                   , :MDSEAR-DMA-NBR                              39960012
401900                   , :MDSEAR-DEPT-NBR                             39970012
402000                   , :MDSEAR-MAJ-CL-NBR                           39980012
402100                   , :MDSEAR-SUB-CL-NBR                           39990012
402200                   , :MDSEAR-MDSELV-CDE                           40000012
402300                   , :MDSEAR-STRT-DTE                             40010012
402400                   , :MDSEAR-END-DTE                              40020012
402500                   , :MDSEAR-DESC                                 40030012
402600                   , :MDSEAR-LIST-SEQ-NBR                         40040012
402700                   , :MDSEAR-DKEY                                 40050012
402800         END-EXEC                                                 40060012
402900*                                                                 40070012
403000         EVALUATE TRUE                                            40080012
403100             WHEN SQLCODE = -904                                  40090012
403200             WHEN SQLCODE = -913                                  40100012
403300             WHEN SQLCODE = ZERO                                  40110012
403400             WHEN SQLCODE = +100                                  40120012
403500                  CONTINUE                                        40130012
403600             WHEN SQLWARN0 NOT EQUAL SPACE                        40140012
403700             WHEN SQLCODE NOT EQUAL ZERO                          40150012
403800                  MOVE 'L250-FETCH-MCL-CURSOR'                    40160012
403900                               TO  DP013-PARAGRAPH                40170012
404000                  MOVE 'FETCH MCL-LIST CURSOR'                    40180012
404100                               TO  DP013-MESSAGE-TEXT (1)         40190012
404200                  MOVE SQLCA   TO  DP013-SQLCA                    40200012
404300                  SET DP013-DB2-ABEND                             40210012
404400                               TO  TRUE                           40220012
404500                  PERFORM DP013-0000-PROCESS-ABEND                40230012
404600         END-EVALUATE                                             40240012
404700     END-PERFORM.                                                 40250012
404800*                                                                 40260012
404900     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   40270012
405000         MOVE 'L250-FETCH-MCL-CURSOR'                             40280012
405100                               TO  DP013-PARAGRAPH                40290012
405200         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             40300012
405300                               TO  DP013-MESSAGE-TEXT (1)         40310012
405400         MOVE SQLCA            TO  DP013-SQLCA                    40320012
405500         SET DP013-DB2-ABEND   TO  TRUE                           40330012
405600         PERFORM DP013-0000-PROCESS-ABEND                         40340012
405700     END-IF.                                                      40350012
405800*                                                                 40360012
405900     IF  SQLCODE EQUAL +100                                       40370012
406000         SET MB119-NO-ITEMS-LEFT-ON-DB                            40380012
406100                               TO  TRUE                           40390012
406200     END-IF.                                                      40400012
406300*                                                                 40410012
406400 EJECT                                                            40420012
406500******************************************************************40430012
406600*    FETCH FROM THE SUB CLASS CURSOR.                             40440012
406700*                                                                 40450012
406800*    PERFORMED BY L200                                            40460012
406900******************************************************************40470012
407000*                                                                 40480012
407100 L260-FETCH-SCL-CURSOR.                                           40490012
407200*                                                                 40500012
407300     PERFORM                                                      40510012
407400         WITH TEST AFTER                                          40520012
407500         VARYING PV-SQL-SUB                                       40530012
407600         FROM 1 BY 1                                              40540012
407700         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             40550012
407800            OR SQLCODE = 0                                        40560012
407900            OR SQLCODE = +100                                     40570012
408000*                                                                 40580012
408100         EXEC SQL                                                 40590012
408200              FETCH SCL-LIST                                      40600012
408300              INTO                                                40610012
408400                     :MDSEAR-OPERCO-NBR                           40620012
408500                   , :MDSEAR-GMA-NBR                              40630012
408600                   , :MDSEAR-DMA-NBR                              40640012
408700                   , :MDSEAR-DEPT-NBR                             40650012
408800                   , :MDSEAR-MAJ-CL-NBR                           40660012
408900                   , :MDSEAR-SUB-CL-NBR                           40670012
409000                   , :MDSEAR-MDSELV-CDE                           40680012
409100                   , :MDSEAR-STRT-DTE                             40690012
409200                   , :MDSEAR-END-DTE                              40700012
409300                   , :MDSEAR-DESC                                 40710012
409400                   , :MDSEAR-LIST-SEQ-NBR                         40720012
409500                   , :MDSEAR-DKEY                                 40730012
409600         END-EXEC                                                 40740012
409700*                                                                 40750012
409800         EVALUATE TRUE                                            40760012
409900             WHEN SQLCODE = -904                                  40770012
410000             WHEN SQLCODE = -913                                  40780012
410100             WHEN SQLCODE = ZERO                                  40790012
410200             WHEN SQLCODE = +100                                  40800012
410300                  CONTINUE                                        40810012
410400             WHEN SQLWARN0 NOT EQUAL SPACE                        40820012
410500             WHEN SQLCODE NOT EQUAL ZERO                          40830012
410600                  MOVE 'L260-FETCH-SCL-CURSOR'                    40840012
410700                               TO  DP013-PARAGRAPH                40850012
410800                  MOVE 'FETCH SCL-LIST CURSOR'                    40860012
410900                               TO  DP013-MESSAGE-TEXT (1)         40870012
411000                  MOVE SQLCA   TO  DP013-SQLCA                    40880012
411100                  SET DP013-DB2-ABEND                             40890012
411200                               TO  TRUE                           40900012
411300                  PERFORM DP013-0000-PROCESS-ABEND                40910012
411400         END-EVALUATE                                             40920012
411500     END-PERFORM.                                                 40930012
411600*                                                                 40940012
411700     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   40950012
411800         MOVE 'L260-FETCH-SCL-CURSOR'                             40960012
411900                               TO  DP013-PARAGRAPH                40970012
412000         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             40980012
412100                               TO  DP013-MESSAGE-TEXT (1)         40990012
412200         MOVE SQLCA            TO  DP013-SQLCA                    41000012
412300         SET DP013-DB2-ABEND   TO  TRUE                           41010012
412400         PERFORM DP013-0000-PROCESS-ABEND                         41020012
412500     END-IF.                                                      41030012
412600*                                                                 41040012
412700     IF  SQLCODE EQUAL +100                                       41050012
412800         SET MB119-NO-ITEMS-LEFT-ON-DB                            41060012
412900                               TO  TRUE                           41070012
413000     END-IF.                                                      41080012
413100*                                                                 41090012
413200 EJECT                                                            41100012
413300*                                                                 41110012
413400******************************************************************41120012
413500*    READ THE APLAVL TABLE TO DETERMINE WHETHER THE ROW JUST      41130012
413600*    RETURNED (FROM ONE OF 6 CURSORS) ALREADY EXISTS FOR THE      41140012
413700*    NEW APLSYS CODE.                                             41150012
413800*                                                                 41160012
413900*    PERFORMED BY H100                                            41170012
414000******************************************************************41180012
414100*                                                                 41190012
414200 L300-CHECK-NEW-KEY.                                              41200012
414300*                                                                 41210012
414400     PERFORM                                                      41220012
414500         WITH TEST AFTER                                          41230012
414600         VARYING PV-SQL-SUB                                       41240012
414700         FROM 1 BY 1                                              41250012
414800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             41260012
414900            OR SQLCODE = 0                                        41270012
415000            OR SQLCODE = +100                                     41280012
415100*                                                                 41290012
415200         EXEC SQL                                                 41300012
415300              SELECT                                              41310012
415400                      APLSYS_CDE                                  41320012
415500                   ,  MDSEAR_DKEY                                 41330012
415600              INTO                                                41340012
415700                      :APLAVL-APLSYS-CDE                          41350012
415800                   ,  :APLAVL-MDSEAR-DKEY                         41360012
415900              FROM                                                41370012
416000                      TAPLAVL                                     41380012
416100              WHERE                                               41390012
416200                      APLSYS_CDE     =  :MB119-NEW-APPL-SYS-CDE   41400012
416300               AND    MDSEAR_DKEY    =  :MDSEAR-DKEY              41410012
416400         END-EXEC                                                 41420012
416500*                                                                 41430012
416600         EVALUATE TRUE                                            41440012
416700             WHEN SQLCODE = -904                                  41450012
416800             WHEN SQLCODE = -913                                  41460012
416900             WHEN SQLCODE = ZERO                                  41470012
417000             WHEN SQLCODE = +100                                  41480012
417100                  CONTINUE                                        41490012
417200             WHEN SQLWARN0 NOT EQUAL SPACE                        41500012
417300             WHEN SQLCODE NOT EQUAL ZERO                          41510012
417400                  MOVE 'L300-CHECK-NEW-KEY'                       41520012
417500                               TO  DP013-PARAGRAPH                41530012
417600                  MOVE 'READ APAVL WITH NEW KEY'                  41540012
417700                               TO  DP013-MESSAGE-TEXT (1)         41550012
417800                  MOVE SQLCA   TO  DP013-SQLCA                    41560012
417900                  SET DP013-DB2-ABEND                             41570012
418000                               TO  TRUE                           41580012
418100                  PERFORM DP013-0000-PROCESS-ABEND                41590012
418200         END-EVALUATE                                             41600012
418300     END-PERFORM.                                                 41610012
418400*                                                                 41620012
418500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   41630012
418600         MOVE 'L300-CHECK-NEW-KEY'                                41640012
418700                               TO  DP013-PARAGRAPH                41650012
418800         MOVE 'MAX RETRIES EXCEEDED FOR APLAVL READ'              41660012
418900                               TO  DP013-MESSAGE-TEXT (1)         41670012
419000         MOVE SQLCA            TO  DP013-SQLCA                    41680012
419100         SET DP013-DB2-ABEND   TO  TRUE                           41690012
419200         PERFORM DP013-0000-PROCESS-ABEND                         41700012
419300     END-IF.                                                      41710012
419400*                                                                 41720012
419500     IF  SQLCODE = +100                                           41730012
419600         SET PS-USE-IT         TO  TRUE                           41740012
419700     ELSE                                                         41750012
419800         SET PS-ALREADY-EXISTS TO  TRUE                           41760012
419900     END-IF.                                                      41770012
420000*                                                                 41780012
420100 EJECT                                                            41790012
420200******************************************************************41800012
420300*    THE USER HAS PRESSED THE PF13 KEY.  WRITE THE LAST BLOCKS    41810012
420400*    TO THE TSQ AND BEGIN THE RETRIEVAL, BLOCK BY BLOCK, OF THE   41820012
420500*    TSQ ITEMS TO BUILD THE TAPLAVL ROWS.  INSERT ONE ROW FOR     41830012
420600*    EACH "SELECTED" LINE ITEM.                                   41840012
420700*                                                                 41850012
420800*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                        41860012
420900******************************************************************41870012
421000*                                                                 41880012
421100 X100-PROCESS-ADD.                                                41890012
421200*                                                                 41900012
421300     MOVE +1                   TO  MB119-BLK-SUB.                 41910012
421400     PERFORM Z150-WRITE-TEMP-STORAGE.                             41920012
421500     ADD +1                    TO  MB119-BLK-SUB.                 41930012
421600     PERFORM Z150-WRITE-TEMP-STORAGE.                             41940012
421700     MOVE MB119-LIST-ITEM-NUMBER (1 1)                            41950012
421800                               TO  PV-HOLD-ITEM-NUMBER.           41960012
421900*                                                                 41970012
422000     MOVE MB119-ESD-MM         TO  PV-WD-MM.                      41980012
422100     MOVE MB119-ESD-DD         TO  PV-WD-DD.                      41990012
422200     MOVE MB119-ESD-YY         TO  PV-WD-YY.                      42000012
422300     MOVE MB119-ESD-CC         TO  PV-WD-CC.                      42010012
422400     SET PV-DASH1              TO  TRUE.                          42020012
422500     SET PV-DASH2              TO  TRUE.                          42030012
422600*                                                                 42040012
422700     MOVE PV-DB2-WORK-DATE     TO  APLAVL-MDSEAR-STRT-DTE.        42050012
422800*                                                                 42060012
422900     MOVE +1                   TO  MB119-BLK-SUB.                 42070012
423000     PERFORM X200-PROCESS-TS-QUEUE                                42080012
423100             VARYING PV-BLOCK-NUMBER                              42090012
423200             FROM 1 BY 1                                          42100012
423300             UNTIL PV-BLOCK-NUMBER > MB119-HIGHEST-BLOCK-WRITTEN. 42110012
423400*                                                                 42120012
423500     COMPUTE PV-BLOCK-NUMBER =                                    42130012
423600         1 + ((PV-HOLD-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).    42140012
423700     PERFORM Z100-READ-TEMP-STORAGE.                              42150012
423800*                                                                 42160012
423900     IF  DP020-MSG-WARNING                                        42170012
424000         CONTINUE                                                 42180012
424100     ELSE                                                         42190012
424200         MOVE PC-TSYMSG-00059  TO  DP020-MSG-NUMBER               42200012
424300         SET DP020-MSG-INFORMATIONAL                              42210012
424400                               TO  TRUE                           42220012
424500     END-IF.                                                      42230012
424600*                                                                 42240012
424700 EJECT                                                            42250012
424800******************************************************************42260012
424900*    READ THE TS QUEUE AND INSERT ROWS FOR EACH SELECTED ITEM.    42270012
425000*                                                                 42280012
425100*    PERFORMED BY X100                                            42290012
425200******************************************************************42300012
425300*                                                                 42310012
425400 X200-PROCESS-TS-QUEUE.                                           42320012
425500*                                                                 42330012
425600     PERFORM Z100-READ-TEMP-STORAGE.                              42340012
425700     PERFORM                                                      42350012
425800         VARYING MB119-ITEM-SUB                                   42360012
425900         FROM 1 BY 1                                              42370012
426000         UNTIL MB119-ITEM-SUB GREATER PC-ITEMS-PER-BLOCK          42380012
426100           OR  MB119-LIST-ITEM-NUMBER (1 MB119-ITEM-SUB)          42390012
426200               EQUAL ZERO                                         42400012
426300*                                                                 42410012
426400               IF  MB119-SELECT   (1 MB119-ITEM-SUB)              42420012
426500                   SET MB119-BLOCK-MODIFIED(1)                    42430012
426600                               TO  TRUE                           42440012
426700                   MOVE MB119-NEW-APPL-SYS-CDE                    42450012
426800                               TO  APLAVL-APLSYS-CDE              42460012
426900                   MOVE MB119-DKEY (1 MB119-ITEM-SUB)             42470012
427000                               TO  APLAVL-MDSEAR-DKEY             42480012
427100                   MOVE MB119-DB2-END   (1 MB119-ITEM-SUB)        42490012
427200                               TO  APLAVL-MDSEAR-END-DTE          42500012
427300                   MOVE MB119-COMPANY                             42510012
427400                               TO  APLAVL-OPERCO-NBR              42520012
427500                   PERFORM X300-INSERT-APLAVL                     42530012
427600                   SUBTRACT 1 FROM MB119-NUMBER-OF-SELECTED-ITEMS 42540012
427700                   SET MB119-NO-SELECT (1 MB119-ITEM-SUB)         42550012
427800                               TO  TRUE                           42560012
427900                   MOVE DP015-ASK-DRK-MDT                         42570012
428000                               TO  MB119-ATTRIBUTE                42580012
428100                                       (1 MB119-ITEM-SUB)         42590012
428200                   MOVE DP015-HL-OFF                              42600012
428300                               TO  MB119-HILIGHT                  42610012
428400                                       (1 MB119-ITEM-SUB)         42620012
428500               END-IF                                             42630012
428600*                                                                 42640012
428700     END-PERFORM.                                                 42650012
428800*                                                                 42660012
428900     IF  MB119-BLOCK-MODIFIED (1)                                 42670012
429000         PERFORM Z150-WRITE-TEMP-STORAGE                          42680012
429100         IF  MB119-LIST-ITEM-NUMBER (1 1) IS EQUAL TO             42690012
429200             MB119-LIST-ITEM-NUMBER (2 1)                         42700012
429300             MOVE MB119-BLOCK-ENTRIES (1)                         42710012
429400                               TO  MB119-BLOCK-ENTRIES (2)        42720012
429500         END-IF                                                   42730012
429600     END-IF.                                                      42740012
429700*                                                                 42750012
429800 EJECT                                                            42760012
429900******************************************************************42770012
430000*    INSERT A ROW IN THE APLAVL TABLE.                            42780012
430100*                                                                 42790012
430200*    PERFORMED BY X200                                            42800012
430300******************************************************************42810012
430400*                                                                 42820012
430500 X300-INSERT-APLAVL.                                              42830012
430600*                                                                 42840012
430700     PERFORM                                                      42850012
430800         WITH TEST AFTER                                          42860012
430900         VARYING PV-SQL-SUB                                       42870012
431000         FROM 1 BY 1                                              42880012
431100         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             42890012
431200            OR SQLCODE = 0                                        42900012
431300            OR SQLCODE = -803                                     42910012
431400*                                                                 42920012
431500         EXEC SQL                                                 42930012
431600              INSERT                                              42940012
431700              INTO TAPLAVL                                        42950012
431800                     (APLSYS_CDE                                  42960012
431900                   ,  MDSEAR_DKEY                                 42970012
432000                   ,  MDSEAR_STRT_DTE                             42980012
432100                   ,  MDSEAR_END_DTE                              42990012
432200                   ,  OPERCO_NBR)                                 43000012
432300              VALUES                                              43010012
432400                    (:APLAVL-APLSYS-CDE                           43020012
432500                   , :APLAVL-MDSEAR-DKEY                          43030012
432600                   , :APLAVL-MDSEAR-STRT-DTE                      43040012
432700                   , :APLAVL-MDSEAR-END-DTE                       43050012
432800                   , :APLAVL-OPERCO-NBR)                          43060012
432900         END-EXEC                                                 43070012
433000*                                                                 43080012
433100         EVALUATE TRUE                                            43090012
433200             WHEN SQLCODE = -904                                  43100012
433300             WHEN SQLCODE = -913                                  43110012
433400             WHEN SQLCODE = ZERO                                  43120012
433500             WHEN SQLCODE = -803                                  43130012
433600                  CONTINUE                                        43140012
433700             WHEN SQLWARN0 NOT EQUAL SPACE                        43150012
433800             WHEN SQLCODE NOT EQUAL ZERO                          43160012
433900                  MOVE 'X300-INSERT-APLAVL'                       43170012
434000                               TO  DP013-PARAGRAPH                43180012
434100                  MOVE 'INSERT ROW TO APLAVL'                     43190012
434200                               TO  DP013-MESSAGE-TEXT (1)         43200012
434300                  MOVE SQLCA   TO  DP013-SQLCA                    43210012
434400                  SET DP013-DB2-ABEND                             43220012
434500                               TO  TRUE                           43230012
434600                  PERFORM DP013-0000-PROCESS-ABEND                43240012
434700         END-EVALUATE                                             43250012
434800     END-PERFORM.                                                 43260012
434900*                                                                 43270012
435000     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   43280012
435100         MOVE 'X300-INSERT-APLAVL'                                43290012
435200                               TO  DP013-PARAGRAPH                43300012
435300         MOVE 'MAX RETRIES EXCEEDED FOR APLAVL INSERT'            43310012
435400                               TO  DP013-MESSAGE-TEXT (1)         43320012
435500         MOVE SQLCA            TO  DP013-SQLCA                    43330012
435600         SET DP013-DB2-ABEND   TO  TRUE                           43340012
435700         PERFORM DP013-0000-PROCESS-ABEND                         43350012
435800     END-IF.                                                      43360012
435900*                                                                 43370012
436000 EJECT                                                            43380012
436100******************************************************************43390012
436200*    VALIDATE THAT THE APLSYS CODE EXISTS; OBTAIN THE DESCRIPTION.43400012
436300*                                                                 43410012
436400*    PERFORMED BY C600                                            43420012
436500******************************************************************43430012
436600*                                                                 43440012
436700 X400-READ-APLSYS.                                                43450012
436800*                                                                 43460012
436900     MOVE 'NOT FOUND'          TO  APLSYS-DESC.                   43470012
437000     PERFORM                                                      43480012
437100         WITH TEST AFTER                                          43490012
437200         VARYING PV-SQL-SUB                                       43500012
437300         FROM 1 BY 1                                              43510012
437400         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             43520012
437500            OR SQLCODE = 0                                        43530012
437600            OR SQLCODE = +100                                     43540012
437700*                                                                 43550012
437800         EXEC SQL                                                 43560012
437900              SELECT                                              43570012
438000                      APLSYS_DESC                                 43580012
438100              INTO                                                43590012
438200                     :APLSYS-DESC                                 43600012
438300              FROM                                                43610012
438400                      TAPLSYS                                     43620012
438500              WHERE                                               43630012
438600                     OPERCO_NBR      =  :PC-COMPANY               43640012
438700               AND   APLSYS_CDE      =  :APLSYS-CDE               43650012
438800         END-EXEC                                                 43660012
438900*                                                                 43670012
439000         EVALUATE TRUE                                            43680012
439100             WHEN SQLCODE = -904                                  43690012
439200             WHEN SQLCODE = -913                                  43700012
439300             WHEN SQLCODE = ZERO                                  43710012
439400             WHEN SQLCODE = +100                                  43720012
439500                  CONTINUE                                        43730012
439600             WHEN SQLWARN0 NOT EQUAL SPACE                        43740012
439700             WHEN SQLCODE NOT EQUAL ZERO                          43750012
439800                  MOVE 'X400-READ-APLSYS'                         43760012
439900                               TO  DP013-PARAGRAPH                43770012
440000                  MOVE 'READ ROW FROM APLSYS'                     43780012
440100                               TO  DP013-MESSAGE-TEXT (1)         43790012
440200                  MOVE SQLCA   TO  DP013-SQLCA                    43800012
440300                  SET DP013-DB2-ABEND                             43810012
440400                               TO  TRUE                           43820012
440500                  PERFORM DP013-0000-PROCESS-ABEND                43830012
440600         END-EVALUATE                                             43840012
440700     END-PERFORM.                                                 43850012
440800*                                                                 43860012
440900     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   43870012
441000         MOVE 'X400-READ-APLSYS'                                  43880012
441100                               TO  DP013-PARAGRAPH                43890012
441200         MOVE 'MAX RETRIES EXCEEDED FOR APLSYS READ'              43900012
441300                               TO  DP013-MESSAGE-TEXT (1)         43910012
441400         MOVE SQLCA            TO  DP013-SQLCA                    43920012
441500         SET DP013-DB2-ABEND   TO  TRUE                           43930012
441600         PERFORM DP013-0000-PROCESS-ABEND                         43940012
441700     END-IF.                                                      43950012
441800*                                                                 43960012
441900 EJECT                                                            43970012
442000******************************************************************43980012
442100*    DELETE THE TEMPORARY STORAGE QUEUE.                          43990012
442200*                                                                 44000012
442300*    PERFORMED BY C300-PROCESS-PANEL.                             44010012
442400******************************************************************44020012
442500*                                                                 44030012
442600 Z050-DELETE-TEMP-STORAGE.                                        44040012
442700*                                                                 44050012
442800     EXEC CICS                                                    44060012
442900         DELETEQ TS                                               44070012
443000         QUEUE(MB119-TEMP-QUEUE-NAME)                             44080012
443100         RESP(PV-RESP)                                            44090012
443200     END-EXEC.                                                    44100012
443300                                                                  44110012
443400     IF (PV-RESP NOT = DFHRESP(NORMAL)) AND                       44120012
443500        (PV-RESP NOT = DFHRESP(QIDERR))                           44130012
443600         MOVE PV-RESP TO PM-RESP-23                               44140012
443700                                                                  44150012
443800         SET DP013-LOGIC-ABEND TO TRUE                            44160012
443900         SET DP013-NO-ROLLBACK TO TRUE                            44170012
444000                                                                  44180012
444100         MOVE 'Z050-DELETE-TEMP-STORAGE' TO DP013-PARAGRAPH       44190012
444200         MOVE PM-PROGRAM-MESSAGE-23      TO DP013-MESSAGE-TEXT(1) 44200012
444300                                                                  44210012
444400         PERFORM DP013-0000-PROCESS-ABEND                         44220012
444500     END-IF.                                                      44230012
444600                                                                  44240012
444700     MOVE +0 TO MB119-HIGHEST-BLOCK-WRITTEN.                      44250012
444800 EJECT                                                            44260012
444900******************************************************************44270012
445000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          44280012
445100*                                                                 44290012
445200*    PERFORMED BY D400-REFRESH-BLOCK-ARRAY.                       44300012
445300*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                        44310012
445400*    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                    44320012
445500*    PERFORMED BY G500-SCROLL-FORWARD.                            44330012
445600*    PERFORMED BY G600-SCROLL-BACKWARD.                           44340012
445700*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                       44350012
445800*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                    44360012
445900******************************************************************44370012
446000*                                                                 44380012
446100 Z100-READ-TEMP-STORAGE.                                          44390012
446200*                                                                 44400012
446300     EXEC CICS                                                    44410012
446400         READQ TS                                                 44420012
446500         QUEUE(MB119-TEMP-QUEUE-NAME)                             44430012
446600         INTO(MB119-BLOCK-ENTRIES(MB119-BLK-SUB))                 44440012
446700         LENGTH(PC-BLOCK-LENGTH)                                  44450012
446800         ITEM(PV-BLOCK-NUMBER)                                    44460012
446900         RESP(PV-RESP)                                            44470012
447000     END-EXEC.                                                    44480012
447100*                                                                 44490012
447200     IF PV-RESP NOT = DFHRESP(NORMAL)                             44500012
447300         MOVE PV-RESP          TO  PM-RESP-24                     44510012
447400         EXEC CICS                                                44520012
447500              DELETEQ TS                                          44530012
447600              QUEUE(MB119-TEMP-QUEUE-NAME)                        44540012
447700              RESP(PV-RESP)                                       44550012
447800         END-EXEC                                                 44560012
447900         SET DP013-LOGIC-ABEND TO  TRUE                           44570012
448000         SET DP013-NO-ROLLBACK TO  TRUE                           44580012
448100         MOVE 'Z100-READ-TEMP-STORAGE'                            44590012
448200                               TO  DP013-PARAGRAPH                44600012
448300         MOVE PM-PROGRAM-MESSAGE-24                               44610012
448400                               TO  DP013-MESSAGE-TEXT(1)          44620012
448500         PERFORM DP013-0000-PROCESS-ABEND                         44630012
448600     END-IF.                                                      44640012
448700                                                                  44650012
448800     SET MB119-BLOCK-NOT-MODIFIED(MB119-BLK-SUB) TO TRUE.         44660012
448900 EJECT                                                            44670012
449000******************************************************************44680012
449100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       44690012
449200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.     44700012
449300*                                                                 44710012
449400*    PERFORMED BY E300-NAVIGATE.                                  44720012
449500*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                        44730012
449600*    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                    44740012
449700*    PERFORMED BY G500-SCROLL-FORWARD.                            44750012
449800*    PERFORMED BY G600-SCROLL-BACKWARD.                           44760012
449900*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                       44770012
450000*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                    44780012
450100*    PERFORMED BY H100-READ-ITEMS-FROM-DB.                        44790012
450200******************************************************************44800012
450300*                                                                 44810012
450400 Z150-WRITE-TEMP-STORAGE.                                         44820012
450500*                                                                 44830012
450600     IF MB119-HIGHEST-BLOCK-WRITTEN = +0                          44840012
450700         MOVE EIBTASKN         TO  DP020-SRC-TASK-NUMBER          44850012
450800         MOVE EIBTASKN         TO  MB119-TASK-NUMBER              44860012
450900         MOVE EIBTRMID         TO  MB119-TERM-ID                  44870012
451000     END-IF.                                                      44880012
451100*                                                                 44890012
451200     MOVE MB119-LIST-ITEM-NUMBER(MB119-BLK-SUB 1)                 44900012
451300                               TO  PV-LIST-ITEM-NUMBER.           44910012
451400     COMPUTE PV-BLOCK-NUMBER =                                    44920012
451500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).    44930012
451600*                                                                 44940012
451700     IF (PV-BLOCK-NUMBER < MB119-HIGHEST-BLOCK-WRITTEN)           44950012
451800     OR (PV-BLOCK-NUMBER = MB119-HIGHEST-BLOCK-WRITTEN)           44960012
451900         IF  MB119-BLOCK-MODIFIED(MB119-BLK-SUB)                  44970012
452000             EXEC CICS                                            44980012
452100                 WRITEQ TS                                        44990012
452200                 QUEUE(MB119-TEMP-QUEUE-NAME)                     45000012
452300                 FROM(MB119-BLOCK-ENTRIES(MB119-BLK-SUB))         45010012
452400                 LENGTH(PC-BLOCK-LENGTH)                          45020012
452500                 ITEM(PV-BLOCK-NUMBER)                            45030012
452600                 REWRITE                                          45040012
452700                 RESP(PV-RESP)                                    45050012
452800             END-EXEC                                             45060012
452900*                                                                 45070012
453000             IF  PV-RESP NOT = DFHRESP(NORMAL)                    45080012
453100                 MOVE PV-RESP  TO  PM-RESP-9                      45090012
453200                 EXEC CICS                                        45100012
453300                     DELETEQ TS                                   45110012
453400                     QUEUE(MB119-TEMP-QUEUE-NAME)                 45120012
453500                     RESP(PV-RESP)                                45130012
453600                 END-EXEC                                         45140012
453700*                                                                 45150012
453800                 SET DP013-LOGIC-ABEND                            45160012
453900                               TO  TRUE                           45170012
454000                 SET DP013-NO-ROLLBACK                            45180012
454100                               TO  TRUE                           45190012
454200                 MOVE 'Z150-WRITE-TEMP-STORAGE'                   45200012
454300                               TO  DP013-PARAGRAPH                45210012
454400                 MOVE PM-PROGRAM-MESSAGE-9                        45220012
454500                               TO  DP013-MESSAGE-TEXT(1)          45230012
454600                 PERFORM DP013-0000-PROCESS-ABEND                 45240012
454700             END-IF                                               45250012
454800         END-IF                                                   45260012
454900     ELSE                                                         45270012
455000*                                                                 45280012
455100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       45290012
455200             MB119-HIGHEST-BLOCK-WRITTEN + 1                      45300012
455300         IF  PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN           45310012
455400             EXEC CICS                                            45320012
455500                 WRITEQ TS                                        45330012
455600                 QUEUE(MB119-TEMP-QUEUE-NAME)                     45340012
455700                 FROM(MB119-BLOCK-ENTRIES(MB119-BLK-SUB))         45350012
455800                 LENGTH(PC-BLOCK-LENGTH)                          45360012
455900                 ITEM(PV-BLOCK-NUMBER)                            45370012
456000                 RESP(PV-RESP)                                    45380012
456100             END-EXEC                                             45390012
456200*                                                                 45400012
456300             IF  PV-RESP NOT = DFHRESP(NORMAL)                    45410012
456400                 MOVE PV-RESP  TO  PM-RESP-10                     45420012
456500                 EXEC CICS                                        45430012
456600                     DELETEQ TS                                   45440012
456700                     QUEUE(MB119-TEMP-QUEUE-NAME)                 45450012
456800                     RESP(PV-RESP)                                45460012
456900                 END-EXEC                                         45470012
457000*                                                                 45480012
457100                 SET DP013-LOGIC-ABEND                            45490012
457200                               TO  TRUE                           45500012
457300                 SET DP013-NO-ROLLBACK                            45510012
457400                               TO  TRUE                           45520012
457500                 MOVE 'Z150-WRITE-TEMP-STORAGE'                   45530012
457600                               TO  DP013-PARAGRAPH                45540012
457700                 MOVE PM-PROGRAM-MESSAGE-10                       45550012
457800                               TO  DP013-MESSAGE-TEXT(1)          45560012
457900                 PERFORM DP013-0000-PROCESS-ABEND                 45570012
458000             END-IF                                               45580012
458100             ADD +1            TO  MB119-HIGHEST-BLOCK-WRITTEN    45590012
458200         ELSE                                                     45600012
458300             SET DP013-LOGIC-ABEND                                45610012
458400                               TO  TRUE                           45620012
458500             SET DP013-NO-ROLLBACK                                45630012
458600                               TO  TRUE                           45640012
458700             MOVE 'Z150-WRITE-TEMP-STORAGE'                       45650012
458800                               TO  DP013-PARAGRAPH                45660012
458900             MOVE PV-BLOCK-NUMBER                                 45670012
459000                               TO  PM-BLOCK-NUMBER                45680012
459100             MOVE PM-PROGRAM-MESSAGE-11                           45690012
459200                               TO  DP013-MESSAGE-TEXT(1)          45700012
459300             PERFORM DP013-0000-PROCESS-ABEND                     45710012
459400         END-IF                                                   45720012
459500     END-IF.                                                      45730012
459600                                                                  45740012
459700     SET MB119-BLOCK-NOT-MODIFIED(MB119-BLK-SUB) TO TRUE.         45750012
459800*                                                                 45760012
459900 EJECT                                                            45770012
460000******************************************************************45780012
460100*    FILL IN SCREEN HEADER MODULE                                 45790012
460200******************************************************************45800012
460300                                                                  45810012
460400     COPY DPPD002.                                                45820012
460500 EJECT                                                            45830012
460600******************************************************************45840012
460700*    RETURN TO CICS MODULE                                        45850012
460800******************************************************************45860012
460900                                                                  45870012
461000     COPY DPPD003.                                                45880012
461100 EJECT                                                            45890012
461200******************************************************************45900012
461300*    FORMAT MESSAGE LINES MODULE                                  45910012
461400******************************************************************45920012
461500                                                                  45930012
461600     COPY DPPD005.                                                45940012
461700 EJECT                                                            45950012
461800******************************************************************45960012
461900*    GET PANEL MODULE                                             45970012
462000******************************************************************45980012
462100                                                                  45990012
462200     COPY DPPD007.                                                46000012
462300 EJECT                                                            46010012
462400******************************************************************46020012
462500*    WRITE PANEL MODULE                                           46030012
462600******************************************************************46040012
462700                                                                  46050012
462800     COPY DPPD008.                                                46060012
462900 EJECT                                                            46070012
463000******************************************************************46080012
463100*    TOGGLE THE FUNCTION KEY LINE MODULE                          46090012
463200******************************************************************46100012
463300                                                                  46110012
463400     COPY DPPD009.                                                46120012
463500 EJECT                                                            46130012
463600******************************************************************46140012
463700*    ABEND PROCESSOR MODULE                                       46150012
463800******************************************************************46160012
463900                                                                  46170012
464000     COPY DPPD013.                                                46180012
464100 EJECT                                                            46190012
464200******************************************************************46200012
464300*    CHECK COMMUNICATION AREA MODULE                              46210012
464400******************************************************************46220012
464500                                                                  46230012
464600     COPY DPPD015.                                                46240012
464700 EJECT                                                            46250012
464800******************************************************************46260012
464900*    UPDATE TIME AND DATE MODULE                                  46270012
465000******************************************************************46280012
465100                                                                  46290012
465200     COPY DPPD017.                                                46300012
465300 EJECT                                                            46310012
