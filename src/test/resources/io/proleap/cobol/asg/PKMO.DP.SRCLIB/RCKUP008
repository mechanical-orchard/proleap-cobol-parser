000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.    RCKUP008.                                                 
000600 AUTHOR.        GERMAN BANDA.                                             
000700 INSTALLATION.  KOHLS.                                                    
000800 DATE-WRITTEN   JULY, 2003.                                               
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  THIS IS A CALLED PROGRAM USED TO FORMAT DATA AND AUTO CREATE           
001300*  VENDOR VIOLATIONS IN THE VCS SYSTEM.                                   
001400******************************************************************        
002500*----------------------------------------------------------------*        
002200* 2014-11-09 CHERI PARMLEY      CHG0094517                       *        
002300*            RE-COMPILE ONLY RCRD053 CHANGED AND VARIABLE NOT    *        
002300*            USED WITHIN THIS PROGRAM FOR PO#.                   *        
002500*----------------------------------------------------------------*        
001600******************************************************************        
001700 ENVIRONMENT DIVISION.                                                    
001800******************************************************************        
001900                                                                          
002000 CONFIGURATION SECTION.                                                   
002100                                                                          
002200 SOURCE-COMPUTER.        IBM-3090.                                        
002300 OBJECT-COMPUTER.        IBM-3090.                                        
002400                                                                          
003500******************************************************************        
003600 DATA DIVISION.                                                           
003700******************************************************************        
003800                                                                          
005700 WORKING-STORAGE SECTION.                                                 
005800*----------------------------------------------------------------*        
005900*  DB2 KEYS                                                      *        
006000*----------------------------------------------------------------*        
006100 01  DK-DB2-KEYS.                                                         
006200     05  DK-PO-NBR                       PIC  S9(9) COMP.                 
006210     05  DK-ERROR-CRTN-COUNT             PIC  S9(9) COMP.                 
006500     05  DK-SEQ-NBR                      PIC  S9(04)  COMP.               
006600     05  DK-ENT-ID                       PIC  S9(9) COMP.                 
006800     05  DK-VILN-GP-CDE                  PIC  X(03).                      
006900     05  DK-VILN-GP-SEQ-NBR              PIC  S9(4) COMP.                 
007200                                                                          
007400******************************************************************        
007500*  DB2 FORMATTED MESSAGE AREA                                             
007600******************************************************************        
007700     COPY DPWS004.                                                        
007800*                                                                         
007801******************************************************************        
007802*  LAYOUT FOR THE RANDOM NUMBER GENERATOR PROGRAM                         
007803******************************************************************        
007804     COPY DPWS902.                                                        
007805*                                                                         
007900******************************************************************        
008000*  ASN RECEIVER PACKSLIP EXTRACT ERROR FILE LAYOUT                        
008010******************************************************************        
008020     COPY RCRD053.                                                        
008030*                                                                         
011197******************************************************************        
011198*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PACKSLIP TABLE             
011199******************************************************************        
011200     EXEC SQL                                                             
011210          INCLUDE TPKSLIP                                                 
011211     END-EXEC.                                                            
011212                                                                          
011213******************************************************************        
011214*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR VIOLATION           
011215*  TABLE                                                                  
011216******************************************************************        
011217     EXEC SQL                                                             
011218          INCLUDE TVILN                                                   
011219     END-EXEC.                                                            
011220                                                                          
011221******************************************************************        
011222*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR VIOLATION           
011223*  BY LINE TABLE                                                          
011224******************************************************************        
011225     EXEC SQL                                                             
011226          INCLUDE TVILNLN                                                 
011227     END-EXEC.                                                            
011228                                                                          
011229******************************************************************        
011230*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR VIOLATION           
011231*  EVENT DOC TABLE                                                        
011232******************************************************************        
011233     EXEC SQL                                                             
011234          INCLUDE TEVDDOC                                                 
011235     END-EXEC.                                                            
011236******************************************************************        
011237*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR VIOLATION           
011238*  EVENT DOC TABLE                                                        
011239******************************************************************        
011240     EXEC SQL                                                             
011241          INCLUDE TVMNEVD                                                 
011242     END-EXEC.                                                            
011243                                                                          
011244******************************************************************        
011245*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR VIOLATION           
011246*  CODE TABLE                                                             
011247******************************************************************        
011248     EXEC SQL                                                             
011249          INCLUDE TVILNCD                                                 
011250     END-EXEC.                                                            
011251******************************************************************        
011252*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR VIOLATION           
011253*  CODE TABLE                                                             
011254******************************************************************        
011255     EXEC SQL                                                             
011256          INCLUDE TVVLCDX                                                 
011257     END-EXEC.                                                            
011258******************************************************************        
011259*  COBOL DECLARATION AND DCLGEN                                           
011261******************************************************************        
011262     EXEC SQL                                                             
011263          INCLUDE TVNDENT                                                 
011264     END-EXEC.                                                            
011265******************************************************************        
011266*  COBOL DECLARATION AND DCLGEN                                           
011267******************************************************************        
011268     EXEC SQL                                                             
011269          INCLUDE TVSCHD                                                  
011270     END-EXEC.                                                            
011271******************************************************************        
011272*  COBOL DECLARATION AND DCLGEN                                           
011273******************************************************************        
011274     EXEC SQL                                                             
011275          INCLUDE TVILNGP                                                 
011276     END-EXEC.                                                            
011277******************************************************************        
011278*  COBOL DECLARATION AND DCLGEN                                           
011279******************************************************************        
011280     EXEC SQL                                                             
011281          INCLUDE TINPKSU                                                 
011282     END-EXEC.                                                            
011283******************************************************************        
011284******************************************************************        
011285     EXEC SQL                                                             
011286          INCLUDE TSHUNLO                                                 
011287     END-EXEC.                                                            
011288******************************************************************        
011289     EXEC SQL                                                             
011290          INCLUDE TVGPCDE                                                 
011291     END-EXEC.                                                            
011292******************************************************************        
011293     EXEC SQL                                                             
011294          INCLUDE TVILSTA                                                 
011295     END-EXEC.                                                            
011296******************************************************************        
011297     EXEC SQL                                                             
011298          INCLUDE TVVLGPX                                                 
011299     END-EXEC.                                                            
011300******************************************************************        
011301******************************************************************        
011302     EXEC SQL                                                             
011303          INCLUDE TVNLVLX                                                 
011304     END-EXEC.                                                            
011305******************************************************************        
011306******************************************************************        
011307     EXEC SQL                                                             
011308          INCLUDE TVRQEVD                                                 
011309     END-EXEC.                                                            
011310******************************************************************        
011311     EXEC SQL                                                             
011312          INCLUDE TBGTMST                                                 
011313     END-EXEC.                                                            
011314******************************************************************        
011315* CURRENT AND FISCAL DATE TABLE                                           
011316******************************************************************        
011317     EXEC SQL                                                             
011318          INCLUDE TDTATTR                                                 
011319     END-EXEC.                                                            
011320******************************************************************        
011321*  COMMUNICATIONS AREA FOR DB2                                            
011322******************************************************************        
011323     EXEC SQL                                                             
011324          INCLUDE SQLCA                                                   
011325     END-EXEC.                                                            
011326*                                                                         
011327*****************************************************************         
011328*  PBS ERROR CARTON CURSOR                                                
011329*****************************************************************         
011330     EXEC SQL                                                             
011331       DECLARE PBS-ERR-CTN-CSR CURSOR FOR                                 
011332         SELECT DISTINCT(A.SHIPT_UNT_ID)                                  
011333          FROM    TINPKSU A                                               
011334                , TPKSLIP B                                               
011335                , TSHUNLO C                                               
011336          WHERE     A.PO_NBR        = :DK-PO-NBR                          
011337             AND    A.SEQ_NBR       = :DK-SEQ-NBR                         
011338             AND    A.PO_NBR        = B.PO_NBR                            
011339             AND    A.SEQ_NBR       = B.SEQ_NBR                           
011340             AND    A.SHIPT_UNT_ID  = C.SHIPT_UNT_ID                      
011341             AND    C.SCN_LOC_ID    = 'PBSA'                              
011342     END-EXEC                                                             
011343                                                                          
011344*****************************************************************         
011345*  CURSOR TO RETRIEVE EVIDENCE DOC ID                                     
011346*****************************************************************         
011347     EXEC SQL                                                             
011348       DECLARE EVDNCE-DOC-ID-CSR CURSOR FOR                               
011349         SELECT B.EVDN_DOC_ID                                             
011350          FROM  TVRQEVD A                                                 
011351              , TEVDDOC B                                                 
011352          WHERE A.VILN_GP_CDE     = :DK-VILN-GP-CDE                       
011353           AND  A.VILN_GP_SEQ_NBR = :DK-VILN-GP-SEQ-NBR                   
011354           AND  A.EVDN_DOC_ID     = B.EVDN_DOC_ID                         
011355           AND ((B.EFF_STRT_DTE <= CURRENT DATE                           
011356           AND B.EFF_END_DTE >= CURRENT DATE )                            
011357            OR ( B.EFF_STRT_DTE <= CURRENT DATE                           
011358           AND B.EFF_END_DTE IS NULL))                                    
011359     END-EXEC                                                             
011360                                                                          
011361                                                                          
011362 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
011370                                                   COMP SYNC.             
011400                                                                          
011500 01  PS-PROGRAM-SWITCHES.                                                 
011840     05  PS-VILN-NBR-EXISTS-IND      PIC  X(01)    VALUE 'N'.             
011850         88  PS-VILN-NBR-EXISTS                    VALUE 'N'.             
011860         88  PS-VILN-NBR-NOT-EXISTS                VALUE 'Y'.             
011891     05  PS-CREATE-EXCEPTION-TYP-SW  PIC  X(02)    VALUE 'AP'.            
011892         88  PS-CREATE-APP-TO-DEBIT                VALUE 'AP'.            
011893         88  PS-CREATE-APP-TO-WAIVE                VALUE 'WA'.            
011895         88  PS-CREATE-WAIVE-PENDING               VALUE 'WP'.            
011896         88  PS-CREATE-NOT-TO-BE-DEBITED           VALUE 'ND'.            
011897     05  PS-INPKSU-CSR-EOF-SW        PIC  X(01)    VALUE 'N'.             
011898         88  PS-INPKSU-CSR-EOF-NO                  VALUE 'N'.             
011899         88  PS-INPKSU-CSR-EOF-YES                 VALUE 'Y'.             
011900     05  PS-EVIDENCE-DOC-ID-SW       PIC  X(01)    VALUE 'N'.             
011901         88  PS-EVIDENCE-DOC-ID-EOF-NO             VALUE 'N'.             
011902         88  PS-EVIDENCE-DOC-ID-EOF-YES            VALUE 'Y'.             
011903     05  PS-VEND-EXCP-LEVEL-SW       PIC  X(03)    VALUE '   '.           
011904         88  PS-NO-VEND-EXCPT-FOUND                VALUE '   '.           
011905         88  PS-VVLCDX-VEND-EXCPT-FOUND            VALUE 'CDX'.           
011906         88  PS-VVLGPX-VEND-EXCPT-FOUND            VALUE 'GPX'.           
011910         88  PS-VNLVLX-VEND-EXCPT-FOUND            VALUE 'VLX'.           
011920     05  PS-LANDED-IMPORT-TYPE-SW    PIC  X(01)    VALUE 'N'.             
011930         88  PS-LANDED-IMPORT-TYPE-YES             VALUE 'Y'.             
011940         88  PS-LANDED-IMPORT-TYPE-NO              VALUE 'N'.             
012000                                                                          
012100 01  PC-PROGRAM-CONSTANTS.                                                
012400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE                  
012500         'RCKUP008'.                                                      
012510     05  PC-RAND-PGM                 PIC  X(08)    VALUE                  
012520         'DPKUT902'.                                                      
013040     05  PC-CARRIAGE-RETURN          PIC X(02)     VALUE X"0D25".         
013100                                                                          
013200 01  PV-PROGRAM-VARIABLES.                                                
013301     05  PV-DEPT-NBR                 PIC   9(4).                          
013303     05  PV-DEPT-NBR-R REDEFINES PV-DEPT-NBR.                             
013304         10 FILLER                   PIC  X(01).                          
013305         10 PV-DEPT-NBR-X            PIC  X(03).                          
013400     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.          
013410     05  PV-DB2-SQLCODE              PIC  X(05)    VALUE SPACES.          
013500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.          
014310     05  PV-READ-COUNTER             PIC S9(09)    VALUE ZERO             
014320                                                   COMP SYNC.             
014400     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.                     
014410     05  PV-DISP-VIOLATION           PIC 9(11).                           
014420     05  PV-DISP-PO                  PIC 9(08).                           
014430     05  PV-DISP-SEQ                 PIC 9(04).                           
014500                                                                          
014701     05  PV-CARTON-COUNT             PIC S9(09)    VALUE ZERO.            
014702                                                                          
014703     05  PV-CARTON-COUNT-2           PIC S9(09)    VALUE ZERO.            
014704     05  PV-STORE-CARTON-COUNT       PIC S9(09)    VALUE ZERO.            
014705                                                                          
014761     05  PV-VILN-CALCD-AMT               PIC S9(7)V9(2) COMP-3.           
014762     05  PV-BGT-ACTL-DR-AMT              PIC S9(7)V9(2) COMP-3.           
014763                                                                          
014773     05  PV-LOD-DAT-TXT-LEN              PIC S9(4)  COMP.                 
014774     05  PV-VILN-TXT-FORMAT.                                              
014775         10  FILLER                      PIC  X(06) VALUE                 
014776                                         'STORE:'.                        
014777         10  PV-VILN-TXT-STORE           PIC  9(04).                      
014778         10  FILLER                      PIC  X(04) VALUE SPACES.         
014779         10  FILLER                      PIC  X(13) VALUE                 
014780                                         'ASN UNIT QTY:'.                 
014781         10  PV-VILN-TXT-PKITEM-QTY      PIC  9(04).                      
014782         10  FILLER                      PIC  X(04) VALUE SPACES.         
014783         10  FILLER                      PIC  X(16) VALUE                 
014784                                         'CARTON UNIT QTY:'.              
014785         10  PV-VILN-TXT-CRTN-QTY        PIC  9(04).                      
014786         10  FILLER                      PIC  X(04) VALUE SPACES.         
014787         10  FILLER                      PIC  X(05) VALUE                 
014788                                         'LINE:'.                         
014789         10  PV-VILN-TXT-LINE            PIC  9(04).                      
014790         10  FILLER                      PIC  X(04) VALUE SPACES.         
014791         10  FILLER                      PIC  X(04) VALUE                 
014792                                         'UPC:'.                          
014793         10  PV-VILN-TXT-UPC             PIC  9(15).                      
014794         10  FILLER                      PIC X(02) VALUE X"0D25".         
014795         10  FILLER                      PIC X(02) VALUE X"0D25".         
014796         10  FILLER                      PIC  X(08) VALUE                 
014797                                         'CARTONS:'.                      
014800         10  FILLER                      PIC X(02) VALUE X"0D25".         
014810         10  PV-CARTON-DATA OCCURS 1 TO 15 TIMES                          
014820                              DEPENDING ON PV-CARTON-COUNT                
014830                              INDEXED BY CRTN-IDX.                        
014840             15  PV-VILN-SHIPT-UNT-ID      PIC 9(18).                     
014850             15  PV-CRTN-SPACE-RTRN        PIC X(02) VALUE SPACE.         
015310******************************************************************        
015320 LINKAGE SECTION.                                                         
015500******************************************************************        
015510     COPY RCRD068.                                                        
018500******************************************************************        
018510 PROCEDURE DIVISION USING RC068-VEND-VILN-CRE-RECORD.                     
018700******************************************************************        
018800                                                                          
018900 0000-PROGRAM-MAINLINE.                                                   
019000******************************************************************        
019100* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE             
019200*      PROGRAM.                                                           
019300******************************************************************        
019440     SET RC068-MOD-SUCCESSFUL                                             
019450         PS-CREATE-APP-TO-DEBIT TO TRUE.                                  
019460     MOVE SPACE TO PS-VEND-EXCP-LEVEL-SW                                  
019480                   PV-PARAGRAPH-NAME                                      
019490                   PV-DB2-SQLCODE                                         
019500                   PV-DB2-OPERATION-ATTEMPTED                             
019694                   PS-LANDED-IMPORT-TYPE-SW                               
019701     MOVE +0   TO  PV-READ-COUNTER                                        
019702                   PV-DEPT-NBR                                            
019703                   PV-DISPLAY-COUNT                                       
019704                   PV-CARTON-COUNT                                        
019705                   PV-CARTON-COUNT-2                                      
019706                   PV-STORE-CARTON-COUNT                                  
019707                   PV-VILN-CALCD-AMT                                      
019708                   PV-BGT-ACTL-DR-AMT                                     
019709                   PV-VILN-TXT-STORE                                      
019710                   PV-VILN-TXT-PKITEM-QTY                                 
019711                   PV-VILN-TXT-CRTN-QTY                                   
019720                   PV-VILN-TXT-LINE                                       
019730                   PV-VILN-TXT-UPC                                        
019750                   PV-LOD-DAT-TXT-LEN                                     
019752                   PV-DISP-PO                                             
019753                   PV-DISP-SEQ                                            
019754                   PV-DISP-VIOLATION.                                     
019760                                                                          
019800     PERFORM 2000-PROCESS-VRFD-PBS.                                       
019901                                                                          
019902     IF RC068-MOD-SUCCESSFUL                                              
019903        MOVE VILN-VILN-NBR   TO PV-DISP-VIOLATION                         
019905        DISPLAY 'PURCHASE ORDER NMBR   ' PV-DISP-PO                       
019907        DISPLAY 'VIOLATION NBR CREATED ' PV-DISP-VIOLATION                
019909     END-IF                                                               
020200     GOBACK.                                                              
022000                                                                          
022100******************************************************************        
025410 2000-PROCESS-VRFD-PBS.                                                   
025500******************************************************************        
025930        MOVE RC068-VILN-GROUP-CDE  TO    DK-VILN-GP-CDE                   
025940        MOVE RC068-GP-SEQ-NBR      TO    DK-VILN-GP-SEQ-NBR               
025941        MOVE RC068-PO-NUMBER       TO    DK-PO-NBR                        
025950                                         PV-DISP-PO                       
025960        MOVE RC068-PKSLIP-SEQ-NBR  TO    PV-DISP-SEQ                      
025970                                                                          
026105        PERFORM 2300-SELECT-VILN-DATA                                     
026106        IF RC068-MOD-SUCCESSFUL                                           
026108           IF RC068-PO-TYP-CDE   =  'LD' OR 'IM' OR 'IE' OR 'IF'          
181356                                 OR 'LE'                                  
026109              SET PS-LANDED-IMPORT-TYPE-YES TO TRUE                       
026110           ELSE                                                           
026111              SET PS-LANDED-IMPORT-TYPE-NO  TO TRUE                       
026112           END-IF                                                         
026113                                                                          
026114           PERFORM 2400-CHECK-FOR-EXCPTN-VND                              
026115        END-IF.                                                           
026116                                                                          
026117        IF RC068-MOD-SUCCESSFUL                                           
026120           PERFORM 3000-PROCESS-VENDOR-VILN                               
026130        END-IF.                                                           
026510************************************************************************  
026520* SELECT CURRENT VIOLATION DATA BASED ON THE VIOLATION GROUP AND          
026530* SEQUENCE NUMBER                                                         
026531************************************************************************  
026538 2300-SELECT-VILN-DATA.                                                   
026539                                                                          
026542     EXEC SQL                                                             
026543         SELECT DISTINCT                                                  
026544                C.BGT_AREA_CDE                                            
026545              , A.VILN_RPT_CDE                                            
026547              , A.VILN_CTG_CDE                                            
026548              , A.VILN_DR_IND                                             
026549              , C.VILN_SCHD_ID                                            
026550              , C.VND_NOTIF_CDE                                           
026551           INTO :VILNGP-BGT-AREA-CDE                                      
026552              , :VILNCD-VILN-RPT-CDE                                      
026553              , :VILNCD-VILN-CTG-CDE                                      
026554              , :VILNCD-VILN-DR-IND                                       
026555              , :VILNGP-VILN-SCHD-ID                                      
026556              , :VILNCD-VND-NOTIF-CDE                                     
026557           FROM TVILNCD A                                                 
026558              , TVGPCDE B                                                 
026559              , TVILNGP C                                                 
026560          WHERE A.VILN_GP_CDE      =  :RC068-VILN-GROUP-CDE               
026561            AND A.VILN_GP_SEQ_NBR  =  :RC068-GP-SEQ-NBR                   
026562            AND A.VILN_GP_CDE    = B.VILN_GP_CDE                          
026570            AND B.GP_MST_CDE     = C.GP_MST_CDE                           
026571            AND ((A.EFF_STRT_DTE <= :RC068-OCRNC-DTE                      
026572            AND A.EFF_END_DTE >= :RC068-OCRNC-DTE )                       
026573             OR ( A.EFF_STRT_DTE <= :RC068-OCRNC-DTE                      
026574            AND A.EFF_END_DTE IS NULL))                                   
026578     END-EXEC.                                                            
026579                                                                          
026580     EVALUATE TRUE                                                        
026581         WHEN SQLCODE = ZERO                                              
026582              CONTINUE                                                    
026583         WHEN SQLCODE = +100                                              
026584              SET RC068-MOD-NO-VILN-CREATE TO TRUE                        
026585         WHEN SQLWARN0 NOT = SPACES                                       
026586         WHEN SQLCODE < ZERO                                              
026587         WHEN SQLCODE > ZERO                                              
026588             MOVE SQLCODE TO PV-DB2-SQLCODE                               
026589                             RC068-DB2-SQLCODE                            
026590             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
026591             MOVE '2300-SELECT-VILN-DATA       '                          
026592                             TO PV-PARAGRAPH-NAME                         
026593             MOVE 'SELECT VIOLATION DATA '                                
026594                             TO PV-DB2-OPERATION-ATTEMPTED                
026595             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
026596                     PV-DISP-PO                                           
026597             DISPLAY 'SEQUENCE NUMBER IS    '                             
026598                    PV-DISP-SEQ                                           
026599             DISPLAY 'SQLCODE IS    '                                     
026600                     PV-DB2-SQLCODE                                       
026601             PERFORM 9100-SQL-ABEND                                       
026602     END-EVALUATE.                                                        
026603                                                                          
026604***********************************************************************   
026605* CHECK FOR EXCEPTION VENDORS *****************************************   
026606* IF NO EXCEPTION VENDOR IS FOUND CREATE THE VIOLATION AS APPROVE         
026607* TO DEBIT.                                                               
026608***********************************************************************   
026609 2400-CHECK-FOR-EXCPTN-VND.                                               
026610     MOVE RC068-ENT-ID         TO DK-ENT-ID                               
026611     EXEC SQL                                                             
026612         SELECT EXC_LVL_STAT_CDE                                          
026613           INTO :VNDENT-EXC-LVL-STAT-CDE                                  
026614           FROM TVNDENT A                                                 
026615          WHERE ENT_ID             =  :DK-ENT-ID                          
026616     END-EXEC.                                                            
026617                                                                          
026618     EVALUATE TRUE                                                        
026619         WHEN SQLCODE = ZERO                                              
026620              PERFORM 2420-CHECK-VENDOR-STATUS                            
026621         WHEN SQLCODE = +100                                              
026622               SET PS-CREATE-APP-TO-DEBIT  TO TRUE                        
026623         WHEN SQLWARN0 NOT = SPACES                                       
026624         WHEN SQLCODE < ZERO                                              
026625         WHEN SQLCODE > ZERO                                              
026626             MOVE SQLCODE TO PV-DB2-SQLCODE                               
026627                             RC068-DB2-SQLCODE                            
026628             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
026629             MOVE '2400-CHECK-FOR-EXCPTN-VND   '                          
026630                             TO PV-PARAGRAPH-NAME                         
026631             MOVE 'CHECK FOR EXCEPTION VENDOR'                            
026632                             TO PV-DB2-OPERATION-ATTEMPTED                
026633             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
026634                     PV-DISP-PO                                           
026635             DISPLAY 'SEQUENCE NUMBER IS    '                             
026636                    PV-DISP-SEQ                                           
026637             DISPLAY 'VENDOR ENT ID   IS    '                             
026638                     DK-ENT-ID                                            
026639             DISPLAY 'SQLCODE IS    '                                     
026640                     PV-DB2-SQLCODE                                       
026641             PERFORM 9100-SQL-ABEND                                       
026642     END-EVALUATE.                                                        
026643                                                                          
026644**********************************************************************    
026645* IF A VENDOR IS FOUND ON THE TVNDENT TABLE CHECK THE               **    
026646* VNDENT-EXC-LVL-STAT-CDE TO DETERMINE WHICH EXCEPTION TABLES TO    **    
026647* CHECK                                                                   
026648**********************************************************************    
026649 2420-CHECK-VENDOR-STATUS.                                                
026650      IF RC068-MOD-SUCCESSFUL                                             
026651         EVALUATE TRUE                                                    
026652            WHEN VNDENT-EXC-LVL-STAT-CDE = 'RC'                           
026653               PERFORM 2500-SELECT-TVVLCDX                                
026654               IF PS-VVLCDX-VEND-EXCPT-FOUND                              
026656                  IF PS-CREATE-APP-TO-WAIVE                               
026661                     COMPUTE VVLCDX-TO-DTE-VILN-QTY =                     
026662                                    VVLCDX-TO-DTE-VILN-QTY + 1            
026663                     PERFORM 2600-UPDATE-CDX-VILN-QTY                     
026665                  END-IF                                                  
026666               ELSE                                                       
026667                  PERFORM 2510-SELECT-TVVLGPX                             
026668                  IF PS-VVLGPX-VEND-EXCPT-FOUND                           
026669                     IF PS-CREATE-APP-TO-WAIVE                            
026672                        COMPUTE VVLGPX-TO-DTE-VILN-QTY =                  
026673                                       VVLGPX-TO-DTE-VILN-QTY + 1         
026674                        PERFORM 2610-UPDATE-GPX-VILN-QTY                  
026675                     END-IF                                               
026676                  ELSE                                                    
026678                    PERFORM 2520-SELECT-TVNLVLX                           
026679                    IF PS-CREATE-APP-TO-WAIVE                             
026683                       COMPUTE VNLVLX-TO-DTE-VILN-QTY =                   
026684                               VNLVLX-TO-DTE-VILN-QTY + 1                 
026685                       PERFORM 2620-UPDATE-VLX-VILN-QTY                   
026686                    END-IF                                                
026687                  END-IF                                                  
026688               END-IF                                                     
026689            WHEN VNDENT-EXC-LVL-STAT-CDE = 'GP'                           
026690              PERFORM 2510-SELECT-TVVLGPX                                 
026691              IF PS-VVLGPX-VEND-EXCPT-FOUND                               
026692                 IF PS-CREATE-APP-TO-WAIVE                                
026695                    COMPUTE VVLGPX-TO-DTE-VILN-QTY =                      
026696                                   VVLGPX-TO-DTE-VILN-QTY + 1             
026697                    PERFORM 2610-UPDATE-GPX-VILN-QTY                      
026698                 END-IF                                                   
026699              ELSE                                                        
026700                 PERFORM 2520-SELECT-TVNLVLX                              
026701                 IF PS-CREATE-APP-TO-WAIVE                                
026704                    COMPUTE VNLVLX-TO-DTE-VILN-QTY =                      
026705                                VNLVLX-TO-DTE-VILN-QTY + 1                
026706                    PERFORM 2620-UPDATE-VLX-VILN-QTY                      
026707                 END-IF                                                   
026708              END-IF                                                      
026709****'VN' VENDOR LEVEL EXCEPTION                                           
026710            WHEN  OTHER                                                   
026711              PERFORM 2520-SELECT-TVNLVLX                                 
026712              IF PS-CREATE-APP-TO-WAIVE                                   
026713                 COMPUTE VNLVLX-TO-DTE-VILN-QTY =                         
026714                                VNLVLX-TO-DTE-VILN-QTY + 1                
026715                 PERFORM 2620-UPDATE-VLX-VILN-QTY                         
026716              END-IF                                                      
026717         END-EVALUATE                                                     
026718      END-IF.                                                             
026719                                                                          
026720                                                                          
026721 2500-SELECT-TVVLCDX.                                                     
026722     MOVE RC068-ENT-ID    TO DK-ENT-ID                                    
026723     EXEC SQL                                                             
026724        SELECT ALWD_NBR_VILN_QTY                                          
026725            ,  TO_DTE_VILN_QTY                                            
026726            ,  EXC_REV_STAT_CDE                                           
026727        INTO :VVLCDX-ALWD-NBR-VILN-QTY                                    
026728           , :VVLCDX-TO-DTE-VILN-QTY                                      
026729           , :VVLCDX-EXC-REV-STAT-CDE                                     
026730        FROM   TVVLCDX                                                    
026731        WHERE  ENT_ID           = :DK-ENT-ID                              
026732         AND   VILN_GP_CDE      = :RC068-VILN-GROUP-CDE                   
026733         AND   VILN_GP_SEQ_NBR  = :RC068-GP-SEQ-NBR                       
026734         AND ((EFF_STRT_DTE <= :RC068-OCRNC-DTE                           
026735         AND   EFF_END_DTE >=  :RC068-OCRNC-DTE )                         
026736          OR ( EFF_STRT_DTE <= :RC068-OCRNC-DTE                           
026737         AND   EFF_END_DTE IS NULL))                                      
026738     END-EXEC.                                                            
026739                                                                          
026740     EVALUATE TRUE                                                        
026741         WHEN SQLCODE = ZERO                                              
026742           SET PS-VVLCDX-VEND-EXCPT-FOUND TO TRUE                         
026743           EVALUATE TRUE                                                  
026744              WHEN VVLCDX-EXC-REV-STAT-CDE  = 'FL'                        
026746                  IF PS-LANDED-IMPORT-TYPE-YES                            
026747                     SET PS-CREATE-NOT-TO-BE-DEBITED TO TRUE              
026748                  ELSE                                                    
026749                     SET PS-CREATE-WAIVE-PENDING TO TRUE                  
026750                  END-IF                                                  
026751              WHEN VVLCDX-EXC-REV-STAT-CDE  = 'AW'                        
026752                  IF PS-LANDED-IMPORT-TYPE-YES                            
026753                     SET PS-CREATE-NOT-TO-BE-DEBITED TO TRUE              
026754                  ELSE                                                    
026756                     SET PS-CREATE-APP-TO-WAIVE TO TRUE                   
026757                  END-IF                                                  
026758              WHEN VVLCDX-ALWD-NBR-VILN-QTY = 0                           
026759                  SET PS-CREATE-APP-TO-WAIVE TO TRUE                      
026760              WHEN OTHER                                                  
026761                  IF VVLCDX-TO-DTE-VILN-QTY >                             
026762                                 VVLCDX-ALWD-NBR-VILN-QTY                 
026763                     SET PS-CREATE-APP-TO-DEBIT TO TRUE                   
026764                  ELSE                                                    
026765                     SET PS-CREATE-APP-TO-WAIVE TO TRUE                   
026766                  END-IF                                                  
026767           END-EVALUATE                                                   
026768         WHEN SQLCODE = +100                                              
026769              MOVE SPACE TO PS-VEND-EXCP-LEVEL-SW                         
026770         WHEN SQLWARN0 NOT = SPACES                                       
026771         WHEN SQLCODE < ZERO                                              
026772         WHEN SQLCODE > ZERO                                              
026773             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
026774             MOVE SQLCODE   TO PV-DB2-SQLCODE                             
026775                               RC068-DB2-SQLCODE                          
026776             MOVE '2500-SELECT-TVVLCDX      '                             
026777                             TO PV-PARAGRAPH-NAME                         
026778             MOVE 'CHECK FOR EXCEPTION VENDOR'                            
026779                             TO PV-DB2-OPERATION-ATTEMPTED                
026780             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
026781                     PV-DISP-PO                                           
026782             DISPLAY 'SEQUENCE NUMBER IS    '                             
026783                    PV-DISP-SEQ                                           
026784             DISPLAY 'VENDOR ENT ID   IS    '                             
026785                     DK-ENT-ID                                            
026786             DISPLAY 'SQLCODE IS    '                                     
026787                     PV-DB2-SQLCODE                                       
026788             PERFORM 9100-SQL-ABEND                                       
026789     END-EVALUATE.                                                        
026790                                                                          
026791                                                                          
026792 2510-SELECT-TVVLGPX.                                                     
026793                                                                          
026794     MOVE RC068-ENT-ID    TO DK-ENT-ID                                    
026795     EXEC SQL                                                             
026796        SELECT ALWD_NBR_VILN_QTY                                          
026797            ,  TO_DTE_VILN_QTY                                            
026798            ,  EXC_REV_STAT_CDE                                           
026799        INTO :VVLGPX-ALWD-NBR-VILN-QTY                                    
026800           , :VVLGPX-TO-DTE-VILN-QTY                                      
026801           , :VVLGPX-EXC-REV-STAT-CDE                                     
026802        FROM   TVVLGPX                                                    
026803        WHERE  ENT_ID           = :DK-ENT-ID                              
026804         AND   GP_MST_CDE       = :RC068-VILN-GROUP-MST                   
026805         AND ((EFF_STRT_DTE <= :RC068-OCRNC-DTE                           
026806         AND   EFF_END_DTE >=  :RC068-OCRNC-DTE )                         
026807          OR ( EFF_STRT_DTE <= :RC068-OCRNC-DTE                           
026808         AND   EFF_END_DTE IS NULL))                                      
026809     END-EXEC.                                                            
026810                                                                          
026811     EVALUATE TRUE                                                        
026812         WHEN SQLCODE = ZERO                                              
026813           SET PS-VVLGPX-VEND-EXCPT-FOUND TO TRUE                         
026814           EVALUATE TRUE                                                  
026815             WHEN VVLGPX-EXC-REV-STAT-CDE = 'FL'                          
026817               IF PS-LANDED-IMPORT-TYPE-YES                               
026818                  SET PS-CREATE-NOT-TO-BE-DEBITED TO TRUE                 
026819               ELSE                                                       
026820                  SET PS-CREATE-WAIVE-PENDING TO TRUE                     
026821               END-IF                                                     
026822             WHEN VVLCDX-EXC-REV-STAT-CDE  = 'AW'                         
026823                 IF PS-LANDED-IMPORT-TYPE-YES                             
026824                    SET PS-CREATE-NOT-TO-BE-DEBITED TO TRUE               
026825                 ELSE                                                     
026826                    SET PS-CREATE-APP-TO-WAIVE TO TRUE                    
026827                 END-IF                                                   
026828             WHEN VVLGPX-ALWD-NBR-VILN-QTY = 0                            
026829               SET PS-CREATE-APP-TO-DEBIT TO TRUE                         
026830             WHEN OTHER                                                   
026831               IF VVLGPX-TO-DTE-VILN-QTY >                                
026832                                  VVLGPX-ALWD-NBR-VILN-QTY                
026833                  SET PS-CREATE-APP-TO-DEBIT TO TRUE                      
026834               ELSE                                                       
026835                  SET PS-CREATE-APP-TO-WAIVE TO TRUE                      
026836               END-IF                                                     
026837           END-EVALUATE                                                   
026838         WHEN SQLCODE = +100                                              
026839              MOVE SPACE TO PS-VEND-EXCP-LEVEL-SW                         
026840         WHEN SQLWARN0 NOT = SPACES                                       
026841         WHEN SQLCODE < ZERO                                              
026842         WHEN SQLCODE > ZERO                                              
026843             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
026844             MOVE SQLCODE  TO PV-DB2-SQLCODE                              
026845                              RC068-DB2-SQLCODE                           
026846             MOVE '2510-SELECT-TVVLGPX      '                             
026847                             TO PV-PARAGRAPH-NAME                         
026848             MOVE 'CHECK FOR EXCEPTION VENDOR'                            
026849                             TO PV-DB2-OPERATION-ATTEMPTED                
026850             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
026851                     PV-DISP-PO                                           
026852             DISPLAY 'SEQUENCE NUMBER IS    '                             
026853                    PV-DISP-SEQ                                           
026854             DISPLAY 'VENDOR ENT ID   IS    '                             
026855                     DK-ENT-ID                                            
026856             DISPLAY 'SQLCODE IS    '                                     
026857                     PV-DB2-SQLCODE                                       
026858             PERFORM 9100-SQL-ABEND                                       
026859     END-EVALUATE.                                                        
026860                                                                          
026861 2520-SELECT-TVNLVLX.                                                     
026862                                                                          
026863     MOVE RC068-ENT-ID    TO DK-ENT-ID                                    
026864     EXEC SQL                                                             
026865        SELECT ALWD_NBR_VILN_QTY                                          
026866            ,  TO_DTE_VILN_QTY                                            
026867            ,  EXC_REV_STAT_CDE                                           
026868        INTO :VNLVLX-ALWD-NBR-VILN-QTY                                    
026869           , :VNLVLX-TO-DTE-VILN-QTY                                      
026870           , :VNLVLX-EXC-REV-STAT-CDE                                     
026871        FROM   TVNLVLX                                                    
026872        WHERE  ENT_ID      =  :DK-ENT-ID                                  
026873         AND ((EFF_STRT_DTE <= :RC068-OCRNC-DTE                           
026874         AND   EFF_END_DTE >=  :RC068-OCRNC-DTE )                         
026875          OR ( EFF_STRT_DTE <= :RC068-OCRNC-DTE                           
026876         AND   EFF_END_DTE IS NULL))                                      
026877     END-EXEC.                                                            
026878                                                                          
026879     EVALUATE TRUE                                                        
026880         WHEN SQLCODE = ZERO                                              
026881           SET PS-VNLVLX-VEND-EXCPT-FOUND TO TRUE                         
026882           EVALUATE TRUE                                                  
026883              WHEN VNLVLX-EXC-REV-STAT-CDE = 'FL'                         
026885                 IF PS-LANDED-IMPORT-TYPE-YES                             
026886                    SET PS-CREATE-NOT-TO-BE-DEBITED TO TRUE               
026887                 ELSE                                                     
026888                    SET PS-CREATE-WAIVE-PENDING TO TRUE                   
026889                 END-IF                                                   
026890              WHEN VVLCDX-EXC-REV-STAT-CDE  = 'AW'                        
026891                  IF PS-LANDED-IMPORT-TYPE-YES                            
026892                     SET PS-CREATE-NOT-TO-BE-DEBITED TO TRUE              
026893                  ELSE                                                    
026894                     SET PS-CREATE-APP-TO-WAIVE TO TRUE                   
026895                  END-IF                                                  
026896              WHEN VNLVLX-ALWD-NBR-VILN-QTY = 0                           
026897                SET PS-CREATE-APP-TO-WAIVE TO TRUE                        
026898              WHEN OTHER                                                  
026899                 IF VNLVLX-TO-DTE-VILN-QTY                                
026900                                   > VNLVLX-ALWD-NBR-VILN-QTY             
026901                    SET PS-CREATE-APP-TO-DEBIT TO TRUE                    
026902                 ELSE                                                     
026903                    SET PS-CREATE-APP-TO-WAIVE TO TRUE                    
026904                 END-IF                                                   
026905           END-EVALUATE                                                   
026906         WHEN SQLCODE = +100                                              
026907             SET PS-CREATE-APP-TO-DEBIT TO TRUE                           
026908         WHEN SQLWARN0 NOT = SPACES                                       
026909         WHEN SQLCODE < ZERO                                              
026910         WHEN SQLCODE > ZERO                                              
026911             MOVE SQLCODE TO PV-DB2-SQLCODE                               
026912                             RC068-DB2-SQLCODE                            
026913             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
026914             MOVE '2520-SELECT-TVNLVLX      '                             
026915                             TO PV-PARAGRAPH-NAME                         
026916             MOVE 'CHECK FOR EXCEPTION VENDOR'                            
026917                             TO PV-DB2-OPERATION-ATTEMPTED                
026918             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
026919                     PV-DISP-PO                                           
026920             DISPLAY 'SEQUENCE NUMBER IS    '                             
026921                    PV-DISP-SEQ                                           
026922             DISPLAY 'VENDOR ENT ID   IS    '                             
026923                     DK-ENT-ID                                            
026924             DISPLAY 'SQLCODE IS    '                                     
026925                     PV-DB2-SQLCODE                                       
026926             PERFORM 9100-SQL-ABEND                                       
026927     END-EVALUATE.                                                        
026928                                                                          
026929                                                                          
026930 2600-UPDATE-CDX-VILN-QTY.                                                
026931     MOVE RC068-ENT-ID    TO DK-ENT-ID                                    
026932     EXEC SQL                                                             
026933          UPDATE TVVLCDX                                                  
026934             SET                                                          
026935                  TO_DTE_VILN_QTY  = :VVLCDX-TO-DTE-VILN-QTY              
026936           WHERE  ENT_ID           = :DK-ENT-ID                           
026937            AND   VILN_GP_CDE      = :RC068-VILN-GROUP-CDE                
026938            AND   VILN_GP_SEQ_NBR  = :RC068-GP-SEQ-NBR                    
026939     END-EXEC.                                                            
026940     EVALUATE TRUE                                                        
026941         WHEN SQLCODE = ZERO                                              
026942         WHEN SQLCODE = +100                                              
026943               CONTINUE                                                   
026944         WHEN SQLWARN0 NOT = SPACES                                       
026945         WHEN SQLCODE < ZERO                                              
026946         WHEN SQLCODE > ZERO                                              
026947             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
026948             MOVE SQLCODE TO PV-DB2-SQLCODE                               
026949                             RC068-DB2-SQLCODE                            
026950             MOVE '2600-UPDATE-CDX-VILN-QTY '                             
026951                             TO PV-PARAGRAPH-NAME                         
026952             MOVE 'UPDATE TO DATE VILN QTY'                               
026953                             TO PV-DB2-OPERATION-ATTEMPTED                
026954             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
026955                     PV-DISP-PO                                           
026956             DISPLAY 'SEQUENCE NUMBER IS    '                             
026957                    PV-DISP-SEQ                                           
026958             DISPLAY 'VENDOR ENT ID   IS    '                             
026959                     DK-ENT-ID                                            
026960             DISPLAY 'SQLCODE IS    '                                     
026961                     PV-DB2-SQLCODE                                       
026962             PERFORM 9100-SQL-ABEND                                       
026963     END-EVALUATE.                                                        
026964                                                                          
026965 2610-UPDATE-GPX-VILN-QTY.                                                
026966     MOVE RC068-ENT-ID    TO DK-ENT-ID                                    
026967     EXEC SQL                                                             
026968          UPDATE TVVLGPX                                                  
026969             SET                                                          
026970                  TO_DTE_VILN_QTY  = :VVLGPX-TO-DTE-VILN-QTY              
026971          WHERE  ENT_ID           = :DK-ENT-ID                            
026972            AND  GP_MST_CDE       = :RC068-VILN-GROUP-MST                 
026973     END-EXEC.                                                            
026974     EVALUATE TRUE                                                        
026975         WHEN SQLCODE = ZERO                                              
026976         WHEN SQLCODE = +100                                              
026977               CONTINUE                                                   
026978         WHEN SQLWARN0 NOT = SPACES                                       
026979         WHEN SQLCODE < ZERO                                              
026980         WHEN SQLCODE > ZERO                                              
026981             MOVE SQLCODE TO PV-DB2-SQLCODE                               
026982                             RC068-DB2-SQLCODE                            
026983             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
026984             MOVE '2610-UPDATE-GPX-VILN-QTY '                             
026985                             TO PV-PARAGRAPH-NAME                         
026986             MOVE 'UPDATE TO DATE VILN QTY'                               
026987                             TO PV-DB2-OPERATION-ATTEMPTED                
026988             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
026989                     PV-DISP-PO                                           
026990             DISPLAY 'SEQUENCE NUMBER IS    '                             
026991                    PV-DISP-SEQ                                           
026992             DISPLAY 'VENDOR ENT ID   IS    '                             
026993                     DK-ENT-ID                                            
026994             DISPLAY 'SQLCODE IS    '                                     
026995                     PV-DB2-SQLCODE                                       
026996             PERFORM 9100-SQL-ABEND                                       
026997     END-EVALUATE.                                                        
026998                                                                          
026999 2620-UPDATE-VLX-VILN-QTY.                                                
027000     MOVE RC068-ENT-ID    TO DK-ENT-ID                                    
027001     EXEC SQL                                                             
027002          UPDATE TVNLVLX                                                  
027003             SET                                                          
027004                  TO_DTE_VILN_QTY  = :VNLVLX-TO-DTE-VILN-QTY              
027005           WHERE  ENT_ID           = :DK-ENT-ID                           
027006     END-EXEC.                                                            
027007     EVALUATE TRUE                                                        
027008         WHEN SQLCODE = ZERO                                              
027009         WHEN SQLCODE = +100                                              
027010               CONTINUE                                                   
027011         WHEN SQLWARN0 NOT = SPACES                                       
027012         WHEN SQLCODE < ZERO                                              
027013         WHEN SQLCODE > ZERO                                              
027014             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027015                             RC068-DB2-SQLCODE                            
027016             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027017             MOVE '2620-UPDATE-VLX-VILN-QTY '                             
027018                             TO PV-PARAGRAPH-NAME                         
027019             MOVE 'UPDATE TO DATE VILN QTY'                               
027020                             TO PV-DB2-OPERATION-ATTEMPTED                
027021             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027022                     PV-DISP-PO                                           
027023             DISPLAY 'SEQUENCE NUMBER IS    '                             
027024                    PV-DISP-SEQ                                           
027025             DISPLAY 'VENDOR ENT ID   IS    '                             
027026                     DK-ENT-ID                                            
027027             DISPLAY 'SQLCODE IS    '                                     
027028                     PV-DB2-SQLCODE                                       
027029             PERFORM 9100-SQL-ABEND                                       
027030     END-EVALUATE.                                                        
027031                                                                          
027032 2690-SELECT-FISCAL-DATE.                                                 
027033                                                                          
027034     EXEC SQL                                                             
027035        SELECT FSCL_YR_NBR                                                
027036             , FSCL_MN_NBR                                                
027037         INTO  :DTATTR-FSCL-YR-NBR                                        
027038             , :DTATTR-FSCL-MN-NBR                                        
027039        FROM   TDTATTR                                                    
027040        WHERE  KY_DTE  = CURRENT DATE                                     
027041     END-EXEC.                                                            
027042                                                                          
027043     EVALUATE TRUE                                                        
027044         WHEN SQLCODE = ZERO                                              
027045         WHEN SQLCODE = +100                                              
027046               CONTINUE                                                   
027047         WHEN SQLWARN0 NOT = SPACES                                       
027048         WHEN SQLCODE < ZERO                                              
027049         WHEN SQLCODE > ZERO                                              
027050             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027051             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027052                             RC068-DB2-SQLCODE                            
027053             MOVE '2690-SELECT-FISCAL-DATE'                               
027054                             TO PV-PARAGRAPH-NAME                         
027055             MOVE 'SELECT TO DATE TABLE-TDTATTR'                          
027056                             TO PV-DB2-OPERATION-ATTEMPTED                
027057             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027058                     PV-DISP-PO                                           
027059             DISPLAY 'SEQUENCE NUMBER IS    '                             
027060                    PV-DISP-SEQ                                           
027061             DISPLAY 'VENDOR ENT ID   IS    '                             
027062                     DK-ENT-ID                                            
027063             DISPLAY 'SQLCODE IS    '                                     
027064                     PV-DB2-SQLCODE                                       
027065             PERFORM 9100-SQL-ABEND                                       
027066     END-EVALUATE.                                                        
027067                                                                          
027068 2700-UPDATE-TBGTMST.                                                     
027069     MOVE  PV-BGT-ACTL-DR-AMT   TO BGTMST-ACTL-DR-AMT.                    
027070     EXEC SQL                                                             
027071        UPDATE TBGTMST                                                    
027072           SET                                                            
027073              ACTL_DR_AMT   = (ACTL_DR_AMT + :BGTMST-ACTL-DR-AMT)         
027074            , LAST_UPD_BY_ID = :VILN-VILN-CRER-USR-ID                     
027075            , LAST_UPD_TMST  = CURRENT TIMESTAMP                          
027076         WHERE  BGT_YR       = :DTATTR-FSCL-YR-NBR                        
027077           AND  BGT_MN       = :DTATTR-FSCL-MN-NBR                        
027078           AND  BGT_AREA_CDE = :VILNGP-BGT-AREA-CDE                       
027079           AND  OPER_UNT_ID  = :VILN-OPER-UNT-ID                          
027080     END-EXEC.                                                            
027081     EVALUATE TRUE                                                        
027082         WHEN SQLCODE = ZERO                                              
027083         WHEN SQLCODE = +100                                              
027084               CONTINUE                                                   
027085         WHEN SQLWARN0 NOT = SPACES                                       
027086         WHEN SQLCODE < ZERO                                              
027087         WHEN SQLCODE > ZERO                                              
027088             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027089             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027090                             RC068-DB2-SQLCODE                            
027091             MOVE '2700-UPDATE-TBGTMST    '                               
027092                             TO PV-PARAGRAPH-NAME                         
027093             MOVE 'UPDATE TO BUDGET TABLE '                               
027094                             TO PV-DB2-OPERATION-ATTEMPTED                
027095             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027096                     PV-DISP-PO                                           
027097             DISPLAY 'SEQUENCE NUMBER IS    '                             
027098                    PV-DISP-SEQ                                           
027099             DISPLAY 'VENDOR ENT ID   IS    '                             
027100                     DK-ENT-ID                                            
027101             DISPLAY 'SQLCODE IS    '                                     
027102                     PV-DB2-SQLCODE                                       
027103             PERFORM 9100-SQL-ABEND                                       
027104     END-EVALUATE.                                                        
027105                                                                          
027106 3000-PROCESS-VENDOR-VILN.                                                
027107                                                                          
027108      IF PS-NO-VEND-EXCPT-FOUND AND PS-LANDED-IMPORT-TYPE-YES             
027109         SET PS-CREATE-NOT-TO-BE-DEBITED TO TRUE                          
027110      END-IF                                                              
027111                                                                          
027112      PERFORM 3100-GENERATE-VILN-NBR.                                     
027113                                                                          
027114      PERFORM 3195-LOAD-VILN-DATA.                                        
027115      PERFORM 3200-INSERT-VILN-NBR.                                       
027116      PERFORM 3300-INSERT-VILNLN.                                         
027117      PERFORM 3500-INSERT-VILSTA.                                         
027118      PERFORM 5000-PROCESS-EVDNCE-DOC-CSR.                                
027119                                                                          
027120      IF PS-CREATE-APP-TO-DEBIT                                           
027121         PERFORM 2690-SELECT-FISCAL-DATE                                  
027122         PERFORM 2700-UPDATE-TBGTMST                                      
027123      END-IF.                                                             
027124                                                                          
027125 3100-GENERATE-VILN-NBR.                                                  
027126                                                                          
027127     SET PS-VILN-NBR-EXISTS  TO TRUE.                                     
027128                                                                          
027129*    CONTINUE TO CREATE NEW NUMBERS UNTIL ONE IS FOUND THAT DOES          
027130*    NOT EXIST                                                            
027131     PERFORM UNTIL PS-VILN-NBR-NOT-EXISTS                                 
027132         PERFORM 3150-CREATE-RANDOM-NBR                                   
027133                                                                          
027134         MOVE DP902-RANDOM-NUMBER TO VILN-VILN-NBR                        
027135         PERFORM 3170-VALIDATE-VILN-NBR                                   
027136     END-PERFORM.                                                         
027137                                                                          
027138******************************************************************        
027139*  3150-CREATE-RANDOM-NBR                                        *        
027140*  THIS PARAGRAPH WILL RANDOMLY CREATE A VILN NUMBER             *        
027141******************************************************************        
027142 3150-CREATE-RANDOM-NBR.                                                  
027143                                                                          
027144     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                             
027145     CALL PC-RAND-PGM USING DP902-RANDNBR-ROUTINE-FIELDS.                 
027146                                                                          
027147     IF DP902-SUCCESSFUL                                                  
027148        CONTINUE                                                          
027149     ELSE                                                                 
027150        MOVE '3150-CREATE-RANDOM-NBR        '                             
027151                        TO PV-PARAGRAPH-NAME                              
027152        MOVE 'CREATE RANDON NUMBER  '                                     
027153                        TO PV-DB2-OPERATION-ATTEMPTED                     
027154        PERFORM 9100-SQL-ABEND                                            
027155     END-IF.                                                              
027156 3170-VALIDATE-VILN-NBR.                                                  
027157                                                                          
027158     EXEC SQL                                                             
027159         SELECT PO_NBR                                                    
027160          INTO  :RC068-PO-NUMBER                                          
027161          FROM  TVILN                                                     
027162          WHERE VILN_NBR           =  :VILN-VILN-NBR                      
027163     END-EXEC.                                                            
027164                                                                          
027165     EVALUATE TRUE                                                        
027166         WHEN SQLCODE = ZERO                                              
027167              SET PS-VILN-NBR-EXISTS TO TRUE                              
027168         WHEN SQLCODE = +100                                              
027169             SET PS-VILN-NBR-NOT-EXISTS TO TRUE                           
027170         WHEN SQLWARN0 NOT = SPACES                                       
027171         WHEN SQLCODE < ZERO                                              
027172         WHEN SQLCODE > ZERO                                              
027173             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027174                             RC068-DB2-SQLCODE                            
027175             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027176             MOVE '3170-VALIDATE-VILN-NBR        '                        
027177                             TO PV-PARAGRAPH-NAME                         
027178             MOVE 'VALIDATE VILN NUMBER  '                                
027179                             TO PV-DB2-OPERATION-ATTEMPTED                
027180             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027181                     PV-DISP-PO                                           
027182             DISPLAY 'SEQUENCE NUMBER IS    '                             
027183                    PV-DISP-SEQ                                           
027184             DISPLAY 'SQLCODE IS    '                                     
027185                     PV-DB2-SQLCODE                                       
027186             PERFORM 9100-SQL-ABEND                                       
027187     END-EVALUATE.                                                        
027188                                                                          
027189                                                                          
027190 3195-LOAD-VILN-DATA.                                                     
027191     MOVE VILN-VILN-NBR            TO VILNLN-VILN-NBR                     
027192                                      VMNEVD-VILN-NBR                     
027193                                      VILSTA-VILN-NBR                     
027194     MOVE VILNGP-BGT-AREA-CDE      TO VILN-BGT-AREA-CDE                   
027195     MOVE RC068-VILN-GROUP-CDE     TO VILN-VILN-GP-CDE                    
027196     MOVE RC068-GP-SEQ-NBR         TO VILN-VILN-GP-SEQ-NBR                
027197     MOVE RC068-VILN-RESP-ID       TO VILN-VILN-RSPNB-ID                  
027198     MOVE RC068-PO-NUMBER          TO VILN-PO-NBR                         
027199     MOVE RC068-REC-SEQ-NBR        TO VILN-REC-SEQ-NBR                    
027200     MOVE RC068-ENT-ID             TO VILN-ENT-ID                         
027201     MOVE RC068-DEPT-NBR           TO PV-DEPT-NBR                         
027202     MOVE PV-DEPT-NBR-X            TO VILN-DEPT-NBR                       
027203     MOVE RC068-OPER-UNT-ID        TO VILN-OPER-UNT-ID                    
027204     MOVE RC068-FCLTY-AREA-ID      TO VILN-FCLTY-AREA-ID                  
027205     MOVE RC068-PO-TYP-CDE         TO VILN-PO-TYP-CDE                     
027206     MOVE RC068-PACK-BY-STORE-IND  TO VILN-PK-BY-STR-IND                  
027207     MOVE VILNCD-VILN-RPT-CDE      TO VILN-VILN-RPT-CDE                   
027208     MOVE PS-CREATE-EXCEPTION-TYP-SW                                      
027209                                   TO VILN-VILN-CURR-STAT-CDE             
027210     MOVE RC068-OCRNC-DTE          TO VILN-VILN-OCRNC-DTE                 
027211     MOVE RC068-OCRNC-SHFT-CDE     TO VILN-OCRNC-SHFT-CDE                 
027212     MOVE PC-CURRENT-PROGRAM-NAME  TO VILN-VILN-CRER-USR-ID               
027213     MOVE VILNCD-VND-NOTIF-CDE     TO VILN-VND-NOTIF-CDE                  
027214     MOVE VILNCD-VILN-DR-IND       TO VILN-VILN-DR-IND                    
027215     MOVE RC068-DEST-STORE         TO PV-VILN-TXT-STORE.                  
027216     MOVE RC068-TSHUUPC-SHP-QTY    TO PV-VILN-TXT-CRTN-QTY.               
027217     MOVE RC068-TPKITEM-EXP-QTY    TO PV-VILN-TXT-PKITEM-QTY.             
027218     MOVE RC068-PKSL-LINE-NBR      TO PV-VILN-TXT-LINE.                   
027219     MOVE RC068-UPC-NBR            TO PV-VILN-TXT-UPC.                    
027220     MOVE RC068-RECEIV-DTE         TO VILN-RCPT-DTE.                      
027221     MOVE RC068-ERROR-CRTN-COUNT   TO PV-CARTON-COUNT.                    
027222     PERFORM 4400-CALCULATE-VILN-AMT.                                     
027223     MOVE VSCHD-VILN-PRCG-LVL-CDE  TO VILN-VILN-PRCG-LVL-CDE              
027224     COMPUTE PV-VILN-CALCD-AMT   =                                        
027225                  RC068-ERROR-CRTN-COUNT * VSCHD-VILN-RT-AMT              
027226     MOVE PV-VILN-CALCD-AMT   TO VILN-VILN-CALCD-AMT                      
027227     MOVE VSCHD-VILN-PRCG-FEE-AMT TO VILN-VILN-PRCG-CHRG-AMT              
027228                                                                          
027229     COMPUTE PV-BGT-ACTL-DR-AMT  =                                        
027230                     PV-VILN-CALCD-AMT + VSCHD-VILN-PRCG-FEE-AMT          
027231                                                                          
027232     MOVE RC068-PKSLIP-SEQ-NBR  TO DK-SEQ-NBR                             
027233     PERFORM 4000-PROCESS-PBS-ERR-CSR.                                    
027234                                                                          
027235     COMPUTE PV-LOD-DAT-TXT-LEN =                                         
027236                          (110 + (20 * PV-STORE-CARTON-COUNT)).           
027237     MOVE PV-LOD-DAT-TXT-LEN  TO VILN-CMNT-TXT-LEN.                       
027238                                                                          
027239                                                                          
027240     MOVE PV-VILN-TXT-FORMAT        TO VILN-CMNT-TXT-TEXT                 
027241                                                                          
027242     MOVE RC068-ERROR-CRTN-COUNT    TO VILNLN-VILN-LNE-ERR-QTY            
027243     MOVE RC068-VERFD-CRTN-COUNT    TO VILNLN-PO-LNE-VRFD-QTY             
027244                                                                          
027245     MOVE RC068-CDE-ID              TO VILSTA-CDE-ID                      
027246     MOVE PS-CREATE-EXCEPTION-TYP-SW TO VILSTA-CDVL-CDE.                  
027247                                                                          
027248                                                                          
027249 3200-INSERT-VILN-NBR.                                                    
027250     IF PS-CREATE-APP-TO-DEBIT                                            
027251        CONTINUE                                                          
027252     ELSE                                                                 
027253        MOVE ZEROES TO VILN-VILN-CALCD-AMT                                
027254                       VILN-VILN-PRCG-CHRG-AMT                            
027255     END-IF                                                               
027256                                                                          
027257     EXEC SQL                                                             
027258         INSERT INTO TVILN                                                
027259           ( VILN_NBR                                                     
027260            ,BGT_AREA_CDE                                                 
027261            ,VILN_GP_CDE                                                  
027262            ,VILN_GP_SEQ_NBR                                              
027263            ,VILN_RSPNB_ID                                                
027264            ,STMT_NBR                                                     
027265            ,PO_NBR                                                       
027266            ,REC_SEQ_NBR                                                  
027267            ,ENT_ID                                                       
027268            ,DEPT_NBR                                                     
027269            ,OPER_UNT_ID                                                  
027270            ,FCLTY_AREA_ID                                                
027271            ,PO_TYP_CDE                                                   
027272            ,PK_BY_STR_IND                                                
027273            ,VILN_RPT_CDE                                                 
027274            ,VILN_CURR_STAT_CDE                                           
027275            ,VILN_OCRNC_DTE                                               
027276            ,OCRNC_SHFT_CDE                                               
027277            ,VILN_CRE_TMST                                                
027278            ,VILN_CRER_USR_ID                                             
027279            ,VILN_CALCD_AMT                                               
027280            ,VILN_PRCG_CHRG_AMT                                           
027281            ,VND_NOTIF_CDE                                                
027282            ,VILN_DR_IND                                                  
027283            ,VILN_PRCG_LVL_CDE                                            
027284            ,CMNT_TXT                                                     
027285            ,RCPT_DTE                                                     
027286           )                                                              
027287         VALUES                                                           
027288            ( :VILN-VILN-NBR                                              
027289            , :VILN-BGT-AREA-CDE                                          
027290            , :VILN-VILN-GP-CDE                                           
027291            , :VILN-VILN-GP-SEQ-NBR                                       
027292            , :VILN-VILN-RSPNB-ID                                         
027293            ,  0                                                          
027294            , :VILN-PO-NBR                                                
027295            , :VILN-REC-SEQ-NBR                                           
027296            , :VILN-ENT-ID                                                
027297            , :VILN-DEPT-NBR                                              
027298            , :VILN-OPER-UNT-ID                                           
027299            , :VILN-FCLTY-AREA-ID                                         
027300            , :VILN-PO-TYP-CDE                                            
027301            , :VILN-PK-BY-STR-IND                                         
027302            , :VILN-VILN-RPT-CDE                                          
027303            , :VILN-VILN-CURR-STAT-CDE                                    
027304            , :VILN-VILN-OCRNC-DTE                                        
027305            , :VILN-OCRNC-SHFT-CDE                                        
027306            , CURRENT TIMESTAMP                                           
027307            , :VILN-VILN-CRER-USR-ID                                      
027308            , :VILN-VILN-CALCD-AMT                                        
027309            , :VILN-VILN-PRCG-CHRG-AMT                                    
027310            , :VILN-VND-NOTIF-CDE                                         
027311            , :VILN-VILN-DR-IND                                           
027312            , :VILN-VILN-PRCG-LVL-CDE                                     
027313            , :VILN-CMNT-TXT                                              
027314            , :VILN-RCPT-DTE                                              
027315              )                                                           
027316     END-EXEC                                                             
027317                                                                          
027318     EVALUATE TRUE                                                        
027319         WHEN SQLCODE = ZERO                                              
027320             CONTINUE                                                     
027321         WHEN SQLWARN0 NOT = SPACES                                       
027322         WHEN SQLCODE < ZERO                                              
027323         WHEN SQLCODE > ZERO                                              
027324             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027325                             RC068-DB2-SQLCODE                            
027326             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027327             MOVE '3200-INSERT-VILN-NBR     '                             
027328                             TO PV-PARAGRAPH-NAME                         
027329             MOVE 'INSERT TO VILN TABLE  '                                
027330                             TO PV-DB2-OPERATION-ATTEMPTED                
027331             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027332                     VILN-PO-NBR                                          
027333             DISPLAY 'REC SEQ NUMBER  IS    '                             
027334                     VILN-REC-SEQ-NBR                                     
027335             DISPLAY 'SQLCODE IS    '                                     
027336                     PV-DB2-SQLCODE                                       
027337             PERFORM 9100-SQL-ABEND                                       
027338     END-EVALUATE.                                                        
027339                                                                          
027340 3300-INSERT-VILNLN.                                                      
027341     MOVE SPACES                     TO VILNLN-VILN-ERR-TXT               
027342                                        VILNLN-VILN-CORR-TXT.             
027343                                                                          
027344     EXEC SQL                                                             
027345         INSERT INTO TVILNLN                                              
027346           ( VILN_NBR                                                     
027347            ,ORD_LNE_NBR                                                  
027348            ,VILN_ERR_TXT                                                 
027349            ,VILN_CORR_TXT                                                
027350            ,VILN_LNE_ERR_QTY                                             
027351            ,PO_LNE_VRFD_QTY                                              
027352           )                                                              
027353         VALUES                                                           
027354            ( :VILNLN-VILN-NBR                                            
027355            , 0                                                           
027356            , :VILNLN-VILN-ERR-TXT                                        
027357            , :VILNLN-VILN-CORR-TXT                                       
027358            , :VILNLN-VILN-LNE-ERR-QTY                                    
027359            , :VILNLN-PO-LNE-VRFD-QTY                                     
027360              )                                                           
027361     END-EXEC.                                                            
027362                                                                          
027363     EVALUATE TRUE                                                        
027364         WHEN SQLCODE = ZERO                                              
027365             CONTINUE                                                     
027366         WHEN SQLWARN0 NOT = SPACES                                       
027367         WHEN SQLCODE < ZERO                                              
027368         WHEN SQLCODE > ZERO                                              
027369             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027370             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027371                             RC068-DB2-SQLCODE                            
027372             MOVE '3300-INSERT-VILNLN      '                              
027373                             TO PV-PARAGRAPH-NAME                         
027374             MOVE 'INSERT TO VILNLN TABLE'                                
027375                             TO PV-DB2-OPERATION-ATTEMPTED                
027376             DISPLAY 'PURCHASE ORDER NUMBER IS '                          
027377                     VILN-PO-NBR                                          
027378             DISPLAY 'REC SEQ NUMBER  IS    '                             
027379                     VILN-REC-SEQ-NBR                                     
027380             DISPLAY 'SQLCODE IS    '                                     
027381                     PV-DB2-SQLCODE                                       
027382             PERFORM 9100-SQL-ABEND                                       
027383     END-EVALUATE.                                                        
027384                                                                          
027385 3400-INSERT-VMNEVD.                                                      
027386     MOVE ZEROES                     TO VMNEVD-ORD-LNE-NBR.               
027387     EXEC SQL                                                             
027388         INSERT INTO TVMNEVD                                              
027389           ( VILN_NBR                                                     
027390            ,ORD_LNE_NBR                                                  
027391            ,EVDN_DOC_ID                                                  
027392           )                                                              
027393         VALUES                                                           
027394            ( :VMNEVD-VILN-NBR                                            
027395            , :VMNEVD-ORD-LNE-NBR                                         
027396            , :VMNEVD-EVDN-DOC-ID                                         
027397              )                                                           
027398     END-EXEC.                                                            
027399                                                                          
027400     EVALUATE TRUE                                                        
027401         WHEN SQLCODE = ZERO                                              
027402             CONTINUE                                                     
027403         WHEN SQLWARN0 NOT = SPACES                                       
027404         WHEN SQLCODE < ZERO                                              
027405         WHEN SQLCODE > ZERO                                              
027406             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027407                             RC068-DB2-SQLCODE                            
027408             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027409             MOVE '3400-INSERT-VMNEVD      '                              
027410                             TO PV-PARAGRAPH-NAME                         
027411             MOVE 'INSERT TO VMNEVD TABLE'                                
027412                             TO PV-DB2-OPERATION-ATTEMPTED                
027413             DISPLAY 'PURCHASE ORDER NUMBER IS '                          
027414                     VILN-PO-NBR                                          
027415             DISPLAY 'REC SEQ NUMBER  IS    '                             
027416                     VILN-REC-SEQ-NBR                                     
027417             DISPLAY 'SQLCODE IS    '                                     
027418                     PV-DB2-SQLCODE                                       
027419             PERFORM 9100-SQL-ABEND                                       
027420     END-EVALUATE.                                                        
027421                                                                          
027422 3500-INSERT-VILSTA.                                                      
027423                                                                          
027424     EXEC SQL                                                             
027425         INSERT INTO TVILSTA                                              
027426           ( VILN_NBR                                                     
027427            ,CDE_ID                                                       
027428            ,CRE_TMST                                                     
027429            ,CDVL_CDE                                                     
027430            ,CRER_USR_ID                                                  
027431           )                                                              
027432         VALUES                                                           
027433            ( :VILSTA-VILN-NBR                                            
027434            , :VILSTA-CDE-ID                                              
027435            , CURRENT TIMESTAMP                                           
027436            , :VILSTA-CDVL-CDE                                            
027437            , :PC-CURRENT-PROGRAM-NAME                                    
027438              )                                                           
027439     END-EXEC.                                                            
027440                                                                          
027441     EVALUATE TRUE                                                        
027442         WHEN SQLCODE = ZERO                                              
027443             CONTINUE                                                     
027444         WHEN SQLWARN0 NOT = SPACES                                       
027445         WHEN SQLCODE < ZERO                                              
027446         WHEN SQLCODE > ZERO                                              
027447             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027448                             RC068-DB2-SQLCODE                            
027449             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027450             MOVE '3500-INSERT-VILSTA      '                              
027451                             TO PV-PARAGRAPH-NAME                         
027452             MOVE 'INSERT TO VILSTA TABLE'                                
027453                             TO PV-DB2-OPERATION-ATTEMPTED                
027454             DISPLAY 'PURCHASE ORDER NUMBER IS '                          
027455                     VILN-PO-NBR                                          
027456             DISPLAY 'REC SEQ NUMBER  IS    '                             
027457                     VILN-REC-SEQ-NBR                                     
027458             DISPLAY 'SQLCODE IS    '                                     
027459                     PV-DB2-SQLCODE                                       
027460             PERFORM 9100-SQL-ABEND                                       
027461     END-EVALUATE.                                                        
027462                                                                          
027463*****************************************************************         
027464 4000-PROCESS-PBS-ERR-CSR.                                                
027465*****************************************************************         
027466     MOVE '4000-PROCESS-PBS-ERR-CSR' TO PV-PARAGRAPH-NAME.                
027467     SET PS-INPKSU-CSR-EOF-NO TO TRUE                                     
027468     MOVE +0   TO PV-CARTON-COUNT-2                                       
027469                  PV-STORE-CARTON-COUNT.                                  
027470     PERFORM 4100-OPEN-PBS-ERR-CTN-CSR.                                   
027471     PERFORM 4200-FETCH-PBS-ERR-CTN-CSR                                   
027472                                                                          
027473       PERFORM VARYING CRTN-IDX FROM 1 BY 1                               
027474         UNTIL PS-INPKSU-CSR-EOF-YES OR                                   
027475               CRTN-IDX  > 15                                             
027476           MOVE  INPKSU-SHIPT-UNT-ID TO PV-VILN-SHIPT-UNT-ID              
027477                                                   (CRTN-IDX)             
027478           IF PV-CARTON-COUNT-2 < 5                                       
027479              MOVE SPACES TO PV-CRTN-SPACE-RTRN (CRTN-IDX)                
027480           ELSE                                                           
027481              MOVE PC-CARRIAGE-RETURN TO                                  
027482                             PV-CRTN-SPACE-RTRN (CRTN-IDX)                
027483              MOVE +0   TO PV-CARTON-COUNT-2                              
027484           END-IF                                                         
027485           PERFORM 4200-FETCH-PBS-ERR-CTN-CSR                             
027486       END-PERFORM                                                        
027487     PERFORM 4300-CLOSE-PBS-ERR-CTN-CSR.                                  
027488*****************************************************************         
027489*                                                                         
027490*****************************************************************         
027491 4100-OPEN-PBS-ERR-CTN-CSR.                                               
027492*****************************************************************         
027493     MOVE '4100-OPEN-PBS-ERR-CTN-CSR    ' TO PV-PARAGRAPH-NAME.           
027494                                                                          
027495     EXEC SQL                                                             
027496         OPEN PBS-ERR-CTN-CSR                                             
027497     END-EXEC                                                             
027498                                                                          
027499     EVALUATE TRUE                                                        
027500         WHEN SQLCODE = ZERO                                              
027501             CONTINUE                                                     
027502         WHEN OTHER                                                       
027503             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027504                             RC068-DB2-SQLCODE                            
027505             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027506             DISPLAY 'SQLCODE IS    '                                     
027507                     PV-DB2-SQLCODE                                       
027508             PERFORM 9100-SQL-ABEND                                       
027509       END-EVALUATE.                                                      
027510                                                                          
027511*****************************************************************         
027512 4200-FETCH-PBS-ERR-CTN-CSR.                                              
027513*****************************************************************         
027514     MOVE '4200-FETCH-PBS-ERR-CTN-CSR   ' TO PV-PARAGRAPH-NAME.           
027515                                                                          
027516     EXEC SQL                                                             
027517         FETCH PBS-ERR-CTN-CSR                                            
027518          INTO :INPKSU-SHIPT-UNT-ID                                       
027519     END-EXEC.                                                            
027520                                                                          
027521     EVALUATE TRUE                                                        
027522         WHEN SQLCODE = +0                                                
027523              ADD +1 TO PV-CARTON-COUNT-2                                 
027524                        PV-STORE-CARTON-COUNT                             
027525         WHEN SQLCODE = +100                                              
027526             SET PS-INPKSU-CSR-EOF-YES TO TRUE                            
027527                                                                          
027528         WHEN SQLWARN0 NOT = SPACE                                        
027529         WHEN SQLCODE  NOT = +0                                           
027530           MOVE SQLCODE TO PV-DB2-SQLCODE                                 
027531                             RC068-DB2-SQLCODE                            
027532           SET RC068-MOD-UNSUCCESSFUL TO TRUE                             
027533           MOVE '4200-FETCH-INPKSU-CSR' TO PV-PARAGRAPH-NAME              
027534           MOVE 'FETCH INPKSU CURSOR'                                     
027535                             TO PV-DB2-OPERATION-ATTEMPTED                
027536           DISPLAY 'SQLCODE IS    '                                       
027537                     PV-DB2-SQLCODE                                       
027538           PERFORM 9100-SQL-ABEND                                         
027539     END-EVALUATE.                                                        
027540                                                                          
027541*****************************************************************         
027542 4300-CLOSE-PBS-ERR-CTN-CSR.                                              
027543*****************************************************************         
027544     MOVE '4300-CLOSE-PBS-ERR-CTN-CSR   ' TO PV-PARAGRAPH-NAME.           
027545                                                                          
027546     EXEC SQL                                                             
027547         CLOSE PBS-ERR-CTN-CSR                                            
027548     END-EXEC                                                             
027549                                                                          
027550     EVALUATE TRUE                                                        
027551         WHEN SQLCODE = ZERO                                              
027552              CONTINUE                                                    
027553         WHEN SQLWARN0 NOT = SPACES                                       
027554         WHEN SQLCODE < ZERO                                              
027555         WHEN SQLCODE > ZERO                                              
027556             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027557                             RC068-DB2-SQLCODE                            
027558             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027559             MOVE '4300-CLOSE-PBS-ERR-CTN-CSR  '                          
027560                             TO PV-PARAGRAPH-NAME                         
027561             MOVE 'CLOSE PBS ERROR CSR   '                                
027562                             TO PV-DB2-OPERATION-ATTEMPTED                
027563             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027564                     PV-DISP-PO                                           
027565             DISPLAY 'SEQUENCE NUMBER IS    '                             
027566                    PV-DISP-SEQ                                           
027567             DISPLAY 'SQLCODE IS    '                                     
027568                     PV-DB2-SQLCODE                                       
027569             PERFORM 9100-SQL-ABEND                                       
027570     END-EVALUATE.                                                        
027571                                                                          
027572*****************************************************************         
027573 4400-CALCULATE-VILN-AMT.                                                 
027574*****************************************************************         
027575     MOVE RC068-ERROR-CRTN-COUNT     TO DK-ERROR-CRTN-COUNT               
027576                                                                          
027577     EXEC SQL                                                             
027578        SELECT VILN_RT_AMT                                                
027579            ,  VILN_PRCG_FEE_AMT                                          
027580            ,  VILN_PRCG_LVL_CDE                                          
027581        INTO   :VSCHD-VILN-RT-AMT                                         
027582            ,  :VSCHD-VILN-PRCG-FEE-AMT                                   
027583            ,  :VSCHD-VILN-PRCG-LVL-CDE                                   
027584        FROM   TVSCHD                                                     
027585        WHERE  VILN_SCHD_ID     = :VILNGP-VILN-SCHD-ID                    
027586         AND ((EFF_BEG_DTE  <= :RC068-OCRNC-DTE                           
027587         AND   EFF_END_DTE >=  :RC068-OCRNC-DTE )                         
027588          OR ( EFF_BEG_DTE  <= :RC068-OCRNC-DTE                           
027589         AND   EFF_END_DTE IS NULL))                                      
027590         AND  ( :DK-ERROR-CRTN-COUNT BETWEEN VILN_MIN_LMT_QTY             
027591                  AND  VILN_MAX_LMT_QTY )                                 
027592     END-EXEC.                                                            
027593                                                                          
027594     EVALUATE TRUE                                                        
027595         WHEN SQLCODE = ZERO                                              
027596              CONTINUE                                                    
027597         WHEN SQLCODE = +100                                              
027598              PERFORM 4410-CALCULATE-VILN-AMT-2                           
027599         WHEN SQLWARN0 NOT = SPACES                                       
027600         WHEN SQLCODE < ZERO                                              
027601         WHEN SQLCODE > ZERO                                              
027602             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027603                             RC068-DB2-SQLCODE                            
027604             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027605             MOVE '4400-CALCULATE-VILN-AMT     '                          
027606                             TO PV-PARAGRAPH-NAME                         
027607             MOVE 'SELECT TVSCHD CALC AMT'                                
027608                             TO PV-DB2-OPERATION-ATTEMPTED                
027609             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027610                     PV-DISP-PO                                           
027611             DISPLAY 'SEQUENCE NUMBER IS    '                             
027612                    PV-DISP-SEQ                                           
027613             DISPLAY 'SQLCODE IS    '                                     
027614                     PV-DB2-SQLCODE                                       
027615             PERFORM 9100-SQL-ABEND                                       
027616     END-EVALUATE.                                                        
027617                                                                          
027618*****************************************************************         
027619 4410-CALCULATE-VILN-AMT-2.                                               
027620*****************************************************************         
027621                                                                          
027622     EXEC SQL                                                             
027623        SELECT VILN_RT_AMT                                                
027624            ,  VILN_PRCG_FEE_AMT                                          
027625            ,  VILN_PRCG_LVL_CDE                                          
027626        INTO   :VSCHD-VILN-RT-AMT                                         
027627            ,  :VSCHD-VILN-PRCG-FEE-AMT                                   
027628            ,  :VSCHD-VILN-PRCG-LVL-CDE                                   
027629        FROM   TVSCHD                                                     
027630        WHERE  VILN_SCHD_ID     = :VILNGP-VILN-SCHD-ID                    
027631         AND   VILN_PRCG_FEE_AMT > 0                                      
027632         AND ((EFF_BEG_DTE  <= :RC068-OCRNC-DTE                           
027633         AND   EFF_END_DTE >=  :RC068-OCRNC-DTE )                         
027634          OR ( EFF_BEG_DTE  <= :RC068-OCRNC-DTE                           
027635         AND   EFF_END_DTE IS NULL))                                      
027636     END-EXEC.                                                            
027637                                                                          
027638     EVALUATE TRUE                                                        
027639         WHEN SQLCODE = ZERO                                              
027640              CONTINUE                                                    
027641         WHEN SQLWARN0 NOT = SPACES                                       
027642         WHEN SQLCODE < ZERO                                              
027643         WHEN SQLCODE > ZERO                                              
027644             MOVE SQLCODE TO PV-DB2-SQLCODE                               
027645                             RC068-DB2-SQLCODE                            
027646             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
027647             MOVE '4410-CALCULATE-VILN-AMT-2   '                          
027648                             TO PV-PARAGRAPH-NAME                         
027649             MOVE 'SELECT TVSCHD CALC AMT-2'                              
027650                             TO PV-DB2-OPERATION-ATTEMPTED                
027651             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
027652                     PV-DISP-PO                                           
027653             DISPLAY 'SEQUENCE NUMBER IS    '                             
027654                    PV-DISP-SEQ                                           
027655             DISPLAY 'SQLCODE IS    '                                     
027656                     PV-DB2-SQLCODE                                       
027657             PERFORM 9100-SQL-ABEND                                       
027658     END-EVALUATE.                                                        
027659                                                                          
027660*****************************************************************         
027661 5000-PROCESS-EVDNCE-DOC-CSR.                                             
027662*****************************************************************         
027663     MOVE '5000-PROCESS-EVDNCE-DOC-CSR' TO  PV-PARAGRAPH-NAME.            
027664     SET PS-EVIDENCE-DOC-ID-EOF-NO TO TRUE                                
027665     PERFORM 5100-OPEN-EVDNCE-DOC-CSR.                                    
027670     PERFORM 5200-FETCH-EVDNCE-DOC-CSR                                    
027700       UNTIL PS-EVIDENCE-DOC-ID-EOF-YES.                                  
027800     PERFORM 5300-CLOSE-EVDNCE-DOC-CSR.                                   
027900*****************************************************************         
028000*                                                                         
028100*****************************************************************         
028200 5100-OPEN-EVDNCE-DOC-CSR.                                                
028300*****************************************************************         
028400     MOVE '5100-OPEN-EVDNCE-DOC-CSR     ' TO PV-PARAGRAPH-NAME.           
028500                                                                          
028600     EXEC SQL                                                             
028700         OPEN EVDNCE-DOC-ID-CSR                                           
028800     END-EXEC                                                             
028900                                                                          
029000     EVALUATE TRUE                                                        
029100         WHEN SQLCODE = ZERO                                              
029200             CONTINUE                                                     
029300         WHEN OTHER                                                       
029301             MOVE SQLCODE TO PV-DB2-SQLCODE                               
029302                             RC068-DB2-SQLCODE                            
029310             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
029320             DISPLAY 'SQLCODE IS    '                                     
029330                     PV-DB2-SQLCODE                                       
029400             PERFORM 9100-SQL-ABEND                                       
029500       END-EVALUATE.                                                      
029600                                                                          
029700*****************************************************************         
029800 5200-FETCH-EVDNCE-DOC-CSR.                                               
029900*****************************************************************         
030000     MOVE '5200-FETCH-EVDNCE-DOC-CSR' TO PV-PARAGRAPH-NAME.               
030100                                                                          
030200     EXEC SQL                                                             
030300         FETCH EVDNCE-DOC-ID-CSR                                          
030400          INTO :VMNEVD-EVDN-DOC-ID                                        
030410     END-EXEC.                                                            
030600                                                                          
030700     EVALUATE TRUE                                                        
030800         WHEN SQLCODE = +0                                                
030810              PERFORM 3400-INSERT-VMNEVD                                  
031000         WHEN SQLCODE = +100                                              
031100             SET PS-EVIDENCE-DOC-ID-EOF-YES TO TRUE                       
031200                                                                          
031300         WHEN SQLWARN0 NOT = SPACE                                        
031400         WHEN SQLCODE  NOT = +0                                           
031401           MOVE SQLCODE TO PV-DB2-SQLCODE                                 
031402                           RC068-DB2-SQLCODE                              
031410           SET RC068-MOD-UNSUCCESSFUL TO TRUE                             
031500           MOVE '5200-FETCH-EVDNCE-DOC-CSR' TO  PV-PARAGRAPH-NAME         
031600           MOVE 'FETCH TEVDDOC CURSOR'                                    
031700                             TO PV-DB2-OPERATION-ATTEMPTED                
031710           DISPLAY 'SQLCODE IS    '                                       
031720                     PV-DB2-SQLCODE                                       
031800           PERFORM 9100-SQL-ABEND                                         
031900     END-EVALUATE.                                                        
032000                                                                          
032100*****************************************************************         
032200 5300-CLOSE-EVDNCE-DOC-CSR.                                               
032300*****************************************************************         
032400     MOVE '5300-CLOSE-EVDNCE-DOC-CSR    ' TO PV-PARAGRAPH-NAME.           
032500                                                                          
032600     EXEC SQL                                                             
032700         CLOSE EVDNCE-DOC-ID-CSR                                          
032800     END-EXEC                                                             
032900                                                                          
033000     EVALUATE TRUE                                                        
033100         WHEN SQLCODE = ZERO                                              
033200              CONTINUE                                                    
033300         WHEN SQLWARN0 NOT = SPACES                                       
033400         WHEN SQLCODE < ZERO                                              
033500         WHEN SQLCODE > ZERO                                              
033501             MOVE PV-DB2-SQLCODE TO SQLCODE                               
033502                                    RC068-DB2-SQLCODE                     
033510             SET RC068-MOD-UNSUCCESSFUL TO TRUE                           
033600             MOVE '5300-CLOSE-EVDNCE-DOC-CSR   '                          
033700                             TO PV-PARAGRAPH-NAME                         
033800             MOVE 'CLOSE PBS ERROR CSR   '                                
033900                             TO PV-DB2-OPERATION-ATTEMPTED                
034000             DISPLAY 'PURCHAS ORDER NUMBER IS '                           
034100                     PV-DISP-PO                                           
034200             DISPLAY 'SEQUENCE NUMBER IS    '                             
034300                    PV-DISP-SEQ                                           
034310             DISPLAY 'SQLCODE IS    '                                     
034320                     PV-DB2-SQLCODE                                       
034400             PERFORM 9100-SQL-ABEND                                       
034500     END-EVALUATE.                                                        
034600                                                                          
040300 9100-SQL-ABEND.                                                          
040400******************************************************************        
040500*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL            
040600*  ERROR OR WARNING CODE OCCURS.                                          
040700******************************************************************        
040800     DISPLAY '9100-SQL-ABEND'.                                            
040900     DISPLAY '** ABEND     **'.                                           
041000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
041100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
041200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
041210     DISPLAY '** SQLCODE   ** = ' PV-DB2-SQLCODE.                         
041300                                                                          
041400******************************************************************        
041500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
041600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
041700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
041800* FORMAT.                                                                 
041900******************************************************************        
042000     COPY DPPD004.                                                        
042100                                                                          
042200     MOVE +4013                  TO ABEND-CODE.                           
042300     CALL 'ILBOABN0' USING ABEND-CODE.                                    
