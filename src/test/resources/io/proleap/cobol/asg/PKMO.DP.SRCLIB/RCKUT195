000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.             RCKUT195.                                00040000
000500 AUTHOR.                 DENISE HAHN.                             00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060000
000700 DATE-WRITTEN.           MAY, 2022.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*                                                               * 00100000
001100*  THIS PROGRAM WILL USE A CURSOR TO DETERMINE IF THERE ARE ANY * 00110000
001200*  VERIFIED RECEIVER THAT HAVE LINE THAT ARE NOT VERIFIED.      * 00120000
001300*  IF THERE ARE, AND OUTPUT RECORD WILL BE CREATED WITH THE     * 00130000
001400*  RECEIVER INFORMATION.                                        * 00140000
001401*                                                               * 00140101
001402*  PARM:  VELNDY (180 DAYS) WILL BE USED TO CALCULATE THE       * 00140201
001403*  THE NUMBER OF DAYS TO LOOK BACK                              * 00140301
001404*                                                               * 00140401
001410*  THE OUTPUT FILE WILL BE USED IN THE NEXT STEP TO GENERATE    * 00141000
001420*  RCKRP096 REPORT IN RDS AND WILL GENERATE AN EMAIL ALERT      * 00142000
001430*  TO INVENTORY CONTROL.                                        * 00143000
001440*                                                               * 00144000
001482***************************************************************** 00148200
001483 ENVIRONMENT DIVISION.                                            00148300
001484***************************************************************** 00148400
001485 INPUT-OUTPUT SECTION.                                            00148500
001486                                                                  00148600
001487 FILE-CONTROL.                                                    00148700
001488                                                                  00148800
001489     SELECT ERROR-OUT-FILE                                        00148900
001490         ASSIGN TO OUT01.                                         00149000
001500                                                                  00150000
001600***************************************************************** 00160000
001700 DATA DIVISION.                                                   00170000
001800***************************************************************** 00180000
001900 FILE SECTION.                                                    00190000
002000                                                                  00200000
002100 FD  ERROR-OUT-FILE                                               00210000
002200     RECORDING MODE IS F                                          00220000
002300     BLOCK CONTAINS 0 RECORDS                                     00230000
002400     LABEL RECORDS ARE STANDARD.                                  00240000
002500                                                                  00250000
002600 01  ERROR-OUT-RECORD             PIC X(125).                     00260003
002700                                                                  00270000
002800***************************************************************** 00280000
002900 WORKING-STORAGE SECTION.                                         00290000
003000                                                                  00300000
003900 01  DK-DB2-KEYS.                                                 00390000
004000     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00400000
004100                                                   COMP SYNC.     00410000
004200                                                                  00420000
004300 01  PS-PROGRAM-SWITCHES.                                         00430000
004400     05  PS-EOF-ERROR-CSR-SW          PIC X(01)  VALUE 'N'.       00440000
004500         88  PS-EOF-ERROR-CSR-YES                VALUE 'Y'.       00450000
004600         88  PS-EOF-ERROR-CSR-NO                 VALUE 'N'.       00460000
004700     05  PS-FIRST-REC-SW              PIC X(01)  VALUE 'N'.       00470000
004800         88  PS-FIRST-REC                        VALUE 'Y'.       00480000
004900         88  PS-FIRST-REC-NO                     VALUE 'N'.       00490000
005000                                                                  00500000
005100 01  PC-PROGRAM-CONSTANTS.                                        00510000
005200     05  PC-PROGRAM-NAME            PIC  X(08) VALUE 'RCKUT195'.  00520001
005300                                                                  00530000
005400     05  PV-REC-CNT                 PIC  9(09) VALUE  0.          00540001
005500     05  PV-ERR-CNT                 PIC S9(09) COMP VALUE +0.     00550001
005600     05  PV-ABEND-PARAGRAPH         PIC  X(30).                   00560003
005610     05  PV-ABEND-TABLE             PIC  X(20).                   00561003
005620     05  PV-SQL-RETURN-CD           PIC -9(04).                   00562003
005700     05  PV-DISPLAY-ERR             PIC -9(04).                   00570001
005800                                                                  00580000
005900 01  PV-ABEND-FIELDS.                                             00590000
006000     05  PV-DAYS-BACK               PIC S9(09) COMP.              00600001
006010     05  PV-CURRENT-DATE            PIC  X(10) VALUE SPACES.      00601001
006100     05  PV-FROM-DATE               PIC  X(10) VALUE SPACES.      00610001
006101     05  PV-DEFAULT-DATE            PIC  X(10) VALUE '9999-09-09'.00610101
006110                                                                  00611001
006200     05  PV-DB2-MESSAGE             PIC  X(50) VALUE SPACES.      00620001
006300     05  PV-ABEND-CODE              PIC S9(04) COMP SYNC          00630001
006400                                               VALUE +0.          00640001
006500                                                                  00650000
006600 01  HEADING-OUT.                                                 00660000
006700     05  HEAD-REC                     PIC X(80)   VALUE SPACES.   00670000
006800                                                                  00680000
007000 01  RECORD-OUT.                                                  00700001
007100     05  FILLER                       PIC X(01)   VALUE SPACES.   00710001
007200     05  OUT-OPER                     PIC ZZZ9    VALUE ZEROES.   00720001
007300     05  FILLER                       PIC X(01)   VALUE '-'.      00730001
007400     05  OUT-PO                       PIC 9(09)   VALUE ZEROES.   00740001
007500     05  FILLER                       PIC X(01)   VALUE '-'.      00750001
007600     05  OUT-RCVR                     PIC 9(04)   VALUE ZEROES.   00760001
007700     05  FILLER                       PIC X(11)   VALUE           00770003
007800                                                  '   VE TMST:'.  00780003
007900     05  OUT-VE-TMST                  PIC 9(26)   VALUE ZEROES.   00790003
008000     05  FILLER                       PIC X(27)   VALUE SPACES.   00800001
008010                                                                  00801001
008011     05  OUT-ITEM-OPER                PIC 9(04)   VALUE ZEROES.   00801101
008012     05  FILLER                       PIC X(01)   VALUE '-'.      00801201
008013     05  OUT-ITEM-LINE                PIC 9(04)   VALUE ZEROES.   00801301
008015     05  FILLER                       PIC X(12)   VALUE           00801503
008016                                                  '   CRE TMST:'. 00801603
008017     05  OUT-LINE-TMST                PIC X(26)   VALUE ZEROES.   00801703
008018     05  FILLER                       PIC X(27)   VALUE SPACES.   00801801
008019                                                                  00801901
008030                                                                  00803001
008100     COPY RCRD124.                                                00810001
008200                                                                  00820000
008300                                                                  00830000
008400* * * TKRPRPM TABLE                                               00840001
008500     EXEC SQL                                                     00850000
008600         INCLUDE TKRPRPM                                          00860001
008700     END-EXEC.                                                    00870000
008810                                                                  00881001
008820* * * TRECEIV TABLE                                               00882001
008830     EXEC SQL                                                     00883001
008840         INCLUDE TRECEIV                                          00884001
008850     END-EXEC.                                                    00885001
008860                                                                  00886001
008900* * * TRECITM TABLE                                               00890000
009000     EXEC SQL                                                     00900000
009100         INCLUDE TRECITM                                          00910000
009200     END-EXEC.                                                    00920000
009300                                                                  00930000
009310* * * TPURCHS TABLE                                               00931001
009320     EXEC SQL                                                     00932001
009330         INCLUDE TPURCHS                                          00933001
009340     END-EXEC.                                                    00934001
009350                                                                  00935001
009360* * * TPURITM TABLE                                               00936001
009370     EXEC SQL                                                     00937001
009380         INCLUDE TPURITM                                          00938001
009390     END-EXEC.                                                    00939001
009391                                                                  00939101
009400* * * COMMUNICATIONS AREA FOR DB2                                 00940000
009500     EXEC SQL                                                     00950000
009600          INCLUDE SQLCA                                           00960000
009700     END-EXEC.                                                    00970000
009800                                                                  00980000
009900**DECLARE THE ERROR-REC-CSR                                       00990000
010000     EXEC SQL                                                     01000000
010100          DECLARE ERROR-REC-CSR CURSOR FOR                        01010000
010300           SELECT A.OPER_UNT_ID                                   01030001
010400                , A.ORD_NBR                                       01040000
010500                , A.REC_SEQ_NBR                                   01050000
010510                , A.STATUS_CDE                                    01051001
010520                , A.VERFYD_TMST                                   01052001
010530                , A.REC_TYP_CDE                                   01053001
010540                , A.PKGNG_CDE                                     01054001
010550                , A.PACK_BY_ST_IND                                01055001
010560                , B.OPER_UNT_ID                                   01056001
010590                , B.ORD_LNE_NBR                                   01059001
010591                , B.PREPK_ID                                      01059101
010592                , B.PREPK_DRV_LNE_CDE                             01059201
010593                , B.STATUS_CDE                                    01059301
010594                , B.CRE_TMST                                      01059401
010595                , C.PO_TYP_CDE                                    01059501
010596                , C.DEPT_NBR                                      01059601
010700             FROM TRECEIV A                                       01070000
010800                , TRECITM B                                       01080000
010900                , TPURCHS C                                       01090001
010910                , TPURITM D                                       01091003
011000            WHERE A.STATUS_CDE     IN ('VE')                      01100001
011100              AND A.VER_STATUS_CDE  = 'A'                         01110001
011200              AND A.ORD_NBR         =  B.ORD_NBR                  01120001
011300              AND A.REC_SEQ_NBR     =  B.REC_SEQ_NBR              01130001
011400              AND B.VER_STATUS_CDE  = 'A'                         01140001
011500              AND NOT A.STATUS_CDE  =  B.STATUS_CDE               01150001
011600              AND A.ORD_NBR         =  C.PO_NBR                   01160001
011700              AND C.VER_STATUS_CDE  = 'A'                         01170001
011800              AND C.PO_NBR          =  D.PO_NBR                   01180001
011900              AND D.VER_STATUS_CDE  = 'A'                         01190001
012000              AND B.ORD_LNE_NBR     =  D.APP_PO_LNE_NBR           01200001
012010              AND DATE(A.VERFYD_TMST) >= :PV-FROM-DATE            01201001
012020              AND DATE(A.VERFYD_TMST) <  :PV-DEFAULT-DATE         01202001
012100            ORDER BY A.OPER_UNT_ID                                01210000
012200                   , A.ORD_NBR                                    01220000
012300                   , A.REC_SEQ_NBR                                01230000
012400                   , B.ORD_LNE_NBR                                01240001
012600           WITH UR                                                01260000
012700     END-EXEC.                                                    01270000
012800                                                                  01280000
012900     COPY DPWS004.                                                01290000
013000                                                                  01300000
013100                                                                  01310000
013200***************************************************************** 01320000
013300 PROCEDURE DIVISION.                                              01330000
013400***************************************************************** 01340000
013500                                                                  01350000
013600     OPEN OUTPUT ERROR-OUT-FILE.                                  01360000
013700                                                                  01370000
013800     MOVE SPACES                        TO HEAD-REC.              01380000
013900     MOVE  'PROGRAM - RCKUT195'         TO HEAD-REC.              01390000
014000     DISPLAY HEAD-REC.                                            01400000
014100                                                                  01410000
014200     MOVE SPACES                        TO HEAD-REC.              01420000
014300     DISPLAY HEAD-REC.                                            01430000
014400                                                                  01440000
014410     PERFORM 3000-SELECT-DATE-RANGE.                              01441001
014600                                                                  01460000
014700     DISPLAY 'CURRENT DATE: '  PV-CURRENT-DATE.                   01470001
014710     DISPLAY 'DAYS BACK:    '  PV-DAYS-BACK.                      01471001
014720     DISPLAY 'FROM DATE:    '  PV-FROM-DATE.                      01472001
014730     DISPLAY ' '.                                                 01473001
014800                                                                  01480000
015100     MOVE '*****************************************'             01510000
015200                                        TO HEAD-REC.              01520000
015300     DISPLAY HEAD-REC.                                            01530001
015400                                                                  01540001
015500     MOVE SPACES                        TO HEAD-REC.              01550001
015600     DISPLAY HEAD-REC.                                            01560001
015700                                                                  01570001
016300     SET  PS-FIRST-REC                  TO TRUE.                  01630000
016400                                                                  01640000
016500     PERFORM 2000-OPEN-ERROR-CSR.                                 01650000
016600     PERFORM 2010-FETCH-ERROR-CSR                                 01660000
016700         UNTIL PS-EOF-ERROR-CSR-YES.                              01670000
016800     PERFORM 2020-CLOSE-ERROR-CSR.                                01680000
016900                                                                  01690000
017000     MOVE SPACES  TO  HEAD-REC.                                   01700000
017100     DISPLAY HEADING-OUT.                                         01710000
017300                                                                  01730000
017400     IF PV-REC-CNT > 0                                            01740000
017500         MOVE SPACES                TO HEAD-REC                   01750000
017600         MOVE '*****************************************'         01760000
017700                                    TO HEAD-REC                   01770000
017800         DISPLAY HEAD-REC                                         01780000
018000                                                                  01800000
018100         MOVE SPACES                TO HEAD-REC                   01810000
018200         DISPLAY HEAD-REC                                         01820000
018400                                                                  01840000
018500         MOVE SPACES                TO HEAD-REC                   01850000
018600         STRING  'VERIFIED RECEIVERS WITH LINES THAT ARE NOT '    01860002
018700                 'VERIFIED'            DELIMITED BY SIZE          01870001
018800                                  INTO HEAD-REC                   01880000
018900         DISPLAY HEAD-REC                                         01890000
019100                                                                  01910000
019200         MOVE SPACES                TO HEAD-REC                   01920000
019300         DISPLAY HEAD-REC                                         01930000
019500                                                                  01950000
019600         MOVE SPACES                TO HEAD-REC                   01960000
019700         STRING  'MORE INFORMATION CAN BE FOUND IN RDS REPORT'    01970001
019800                 ' RCK01205'              DELIMITED BY SIZE       01980001
019900                                  INTO HEAD-REC                   01990000
020000         DISPLAY HEAD-REC                                         02000000
020200                                                                  02020000
020967         MOVE SPACES                TO HEAD-REC                   02096700
020968         DISPLAY HEAD-REC                                         02096800
020970                                                                  02097000
020971         MOVE '*****************************************'         02097100
020972                                    TO HEAD-REC                   02097200
020973         DISPLAY HEAD-REC                                         02097300
020975                                                                  02097500
020976         MOVE SPACES                TO HEAD-REC                   02097600
020977         DISPLAY HEAD-REC                                         02097700
020979      END-IF.                                                     02097900
020980                                                                  02098000
020990     CLOSE ERROR-OUT-FILE.                                        02099000
021000                                                                  02100000
021100*    IF ANY ERRORS WERE FOUND, THEN SET THE RETURN-CODE, SO       02110000
021200*    THAT THE EMAIL WILL GET SENT OUT IN THE NEXT STEP            02120000
021300                                                                  02130000
021400     IF PV-REC-CNT > 0                                            02140000
021500         MOVE 4095 TO RETURN-CODE                                 02150000
021600     END-IF.                                                      02160000
021700                                                                  02170000
021800     GOBACK.                                                      02180000
021900                                                                  02190000
022000***************************************************************** 02200000
022100*  OPEN THE ERROR REC CURSOR                                      02210000
022200***************************************************************** 02220000
022300 2000-OPEN-ERROR-CSR.                                             02230000
022400                                                                  02240000
022500     SET PS-EOF-ERROR-CSR-NO        TO TRUE.                      02250000
022600                                                                  02260000
022700     EXEC SQL                                                     02270000
022800          OPEN ERROR-REC-CSR                                      02280000
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100     EVALUATE TRUE                                                02310000
023200         WHEN SQLCODE = ZERO                                      02320000
023300         WHEN SQLCODE = -904                                      02330000
023400         WHEN SQLCODE = -913                                      02340000
023500         WHEN SQLCODE = -911                                      02350000
023600              CONTINUE                                            02360000
023700         WHEN SQLWARN0 NOT = SPACES                               02370000
023800         WHEN SQLCODE NOT = ZERO                                  02380000
023900             MOVE SQLCODE               TO PV-SQL-RETURN-CD       02390000
024000             STRING 'SQL='                                        02400000
024100                  PV-SQL-RETURN-CD                                02410000
024200                  DELIMITED BY SIZE                               02420000
024300                            INTO PV-DB2-MESSAGE                   02430000
024400             MOVE '2000-OPEN-ERROR-CSR'                           02440000
024500                              TO PV-ABEND-PARAGRAPH               02450000
024600             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   02460000
024700             PERFORM 9100-SQL-ABEND                               02470000
024800     END-EVALUATE.                                                02480000
024900                                                                  02490000
025000                                                                  02500000
025100***************************************************************** 02510000
025200*  FETCH THE ERROR REC CURSOR RECORDS                             02520000
025300***************************************************************** 02530000
025400 2010-FETCH-ERROR-CSR.                                            02540000
025500                                                                  02550000
025600     MOVE SPACES                     TO RC124-PREPK-RCVR-VE-REC.  02560001
025700                                                                  02570000
025800     EXEC SQL                                                     02580000
025900          FETCH ERROR-REC-CSR                                     02590000
026310           INTO :RC124-OPER-UNT-ID                                02631001
026320              , :RC124-ORD-NBR                                    02632001
026330              , :RC124-REC-SEQ-NBR                                02633001
026340              , :RC124-RCVR-STATUS                                02634001
026360              , :RC124-VERFYD-TMST                                02636002
026370              , :RC124-RCVR-TYP-CDE                               02637002
026380              , :RC124-PKGNG-CDE                                  02638002
026390              , :RC124-PBS                                        02639002
026391              , :RC124-RECITM-OPER                                02639102
026392              , :RC124-RECITM-LINE                                02639202
026393              , :RC124-RECITM-PREPK-ID                            02639302
026394              , :RC124-PREPK-DRVR-LNE-CDE                         02639402
026395              , :RC124-LINE-STATUS                                02639502
026396              , :RC124-LINE-CRE-TMST                              02639602
026399              , :RC124-PO-TYP-CDE                                 02639902
026400              , :RC124-DEPT-NBR                                   02640002
026410     END-EXEC.                                                    02641002
026500                                                                  02650000
026600     EVALUATE TRUE                                                02660000
026700         WHEN SQLCODE = ZERO                                      02670000
026800              IF  PS-FIRST-REC                                    02680000
026900                  MOVE SPACES  TO HEAD-REC                        02690000
027000                  STRING 'THIS PROCESS HAS FOUND SOME VERIFIED'   02700000
027100                                            DELIMITED BY SIZE     02710000
027200                                      INTO HEAD-REC               02720000
027300                  DISPLAY HEAD-REC                                02730000
027500                                                                  02750000
027600                  MOVE SPACES  TO HEAD-REC                        02760000
027700                  STRING 'RECEIVERS THAT HAVE LINE THAT ARE'      02770001
027800                         ' NOT VERIFIED'    DELIMITED BY SIZE     02780001
027900                                      INTO HEAD-REC               02790000
028000                  DISPLAY HEAD-REC                                02800000
028200                                                                  02820000
029700                  MOVE SPACES  TO HEAD-REC                        02970000
029800                  DISPLAY HEAD-REC                                02980000
030000                                                                  03000000
031200                  SET PS-FIRST-REC-NO   TO TRUE                   03120000
031300              END-IF                                              03130000
031400                                                                  03140000
031500              PERFORM 2100-WRITE-RECORD                           03150000
031600         WHEN SQLCODE = +100                                      03160000
031700              SET PS-EOF-ERROR-CSR-YES   TO TRUE                  03170000
031800                                                                  03180000
031900                                                                  03190000
032000         WHEN SQLCODE = -904                                      03200000
032100         WHEN SQLCODE = -913                                      03210000
032200         WHEN SQLCODE = -911                                      03220000
032300              CONTINUE                                            03230000
032400         WHEN SQLWARN0 NOT = SPACES                               03240000
032500         WHEN SQLCODE NOT = ZERO                                  03250000
032600             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03260000
032700             STRING 'SQL='                                        03270000
032800                  PV-SQL-RETURN-CD                                03280000
032900                  DELIMITED BY SIZE                               03290000
033000                            INTO PV-DB2-MESSAGE                   03300000
033100             MOVE '2010-FETCH-ERROR-CSR'                          03310000
033200                              TO PV-ABEND-PARAGRAPH               03320000
033300             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03330000
033400             PERFORM 9100-SQL-ABEND                               03340000
033500     END-EVALUATE.                                                03350000
033600                                                                  03360000
033700                                                                  03370000
033800***************************************************************** 03380000
033900*  CLOSE THE ERROR REC CURSOR                                     03390000
034000***************************************************************** 03400000
034100 2020-CLOSE-ERROR-CSR.                                            03410000
034200                                                                  03420000
034300     EXEC SQL                                                     03430000
034400          CLOSE ERROR-REC-CSR                                     03440000
034500     END-EXEC.                                                    03450000
034600                                                                  03460000
034700     EVALUATE TRUE                                                03470000
034800         WHEN SQLCODE = ZERO                                      03480000
034900         WHEN SQLCODE = -904                                      03490000
035000         WHEN SQLCODE = -913                                      03500000
035100         WHEN SQLCODE = -911                                      03510000
035200             CONTINUE                                             03520000
035300         WHEN SQLWARN0 NOT = SPACES                               03530000
035400         WHEN SQLCODE NOT = ZERO                                  03540000
035500             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03550000
035600             STRING 'SQL='                                        03560000
035700                  PV-SQL-RETURN-CD                                03570000
035800                  DELIMITED BY SIZE                               03580000
035900                            INTO PV-DB2-MESSAGE                   03590000
036000             MOVE '2020-CLOSE-ERROR-CSR'                          03600000
036100                              TO PV-ABEND-PARAGRAPH               03610000
036200             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03620000
036300             PERFORM 9100-SQL-ABEND                               03630000
036400     END-EVALUATE.                                                03640000
036500                                                                  03650000
036600                                                                  03660000
036700***************************************************************** 03670000
036800*  WRITE A RECORD TO THE ERROR FILE                               03680000
036900***************************************************************** 03690000
037000 2100-WRITE-RECORD.                                               03700000
037010                                                                  03701001
037020     MOVE RC124-OPER-UNT-ID        TO OUT-OPER.                   03702001
037030     MOVE RC124-ORD-NBR            TO OUT-PO.                     03703001
037040     MOVE RC124-REC-SEQ-NBR        TO OUT-RCVR.                   03704001
037041     MOVE RC124-VERFYD-TMST        TO OUT-VE-TMST.                03704101
037050     MOVE RC124-RECITM-OPER        TO OUT-ITEM-OPER.              03705001
037051     MOVE RC124-RECITM-LINE        TO OUT-ITEM-LINE.              03705101
037052     MOVE RC124-LINE-CRE-TMST      TO OUT-LINE-TMST.              03705201
037060                                                                  03706001
037700     DISPLAY RECORD-OUT.                                          03770001
037810     WRITE ERROR-OUT-RECORD FROM RC124-PREPK-RCVR-VE-REC.         03781001
037900                                                                  03790000
038000     ADD +1                        TO PV-REC-CNT.                 03800000
038100                                                                  03810000
038200                                                                  03820000
038210***************************************************************** 03821001
038220*  SELECT DATE RANGE                                              03822001
038230***************************************************************** 03823001
038240 3000-SELECT-DATE-RANGE.                                          03824001
038250                                                                  03825001
038260     MOVE SPACES                     TO PV-FROM-DATE.             03826001
038270                                                                  03827001
038280     EXEC SQL                                                     03828001
038290          SELECT CURRENT DATE                                     03829001
038291               , FUNC_QTY                                         03829101
038292               , CURRENT DATE - FUNC_QTY DAYS                     03829201
038294            INTO :PV-CURRENT-DATE                                 03829401
038295               , :PV-DAYS-BACK                                    03829501
038296               , :PV-FROM-DATE                                    03829601
038297            FROM TKRPRPM                                          03829701
038298           WHERE LOC_ID            = 90                           03829801
038299             AND INTFC_SYS_CDE     = 'KHL'                        03829903
038300             AND SYS_PRC_FUNC_CDE  = 'VELNDY'                     03830003
038301             AND FUNC_PRC_STAT_CDE = 'AC'                         03830103
038302             AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP            03830203
038303             AND FUNC_END_TMST    >= CURRENT TIMESTAMP            03830303
038304     END-EXEC.                                                    03830401
038305                                                                  03830501
038306     EVALUATE TRUE                                                03830601
038307         WHEN SQLCODE = ZERO                                      03830701
038308              CONTINUE                                            03830801
038309                                                                  03830901
038364         WHEN SQLWARN0 NOT = SPACES                               03836401
038365         WHEN SQLCODE NOT = ZERO                                  03836501
038366             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03836601
038367             STRING 'SQL='                                        03836701
038368                  PV-SQL-RETURN-CD                                03836801
038369                  DELIMITED BY SIZE                               03836901
038370                            INTO PV-DB2-MESSAGE                   03837001
038371             MOVE '3000-SELECT-DATE-RANGE'                        03837101
038372                              TO PV-ABEND-PARAGRAPH               03837201
038373             MOVE 'TKRPRPM'   TO PV-ABEND-TABLE                   03837301
038374             PERFORM 9100-SQL-ABEND                               03837401
038375     END-EVALUATE.                                                03837501
038376                                                                  03837601
038377                                                                  03837701
038380******************************************************************03838001
038400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    03840000
038500*  ERROR OR WARNING CODE OCCURS.                                  03850000
038600******************************************************************03860000
038700 9100-SQL-ABEND.                                                  03870000
038800     DISPLAY '9100-SQL-ABEND'.                                    03880000
038900     DISPLAY '** ABEND     **'.                                   03890000
039000     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                03900000
039100     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             03910000
039200     DISPLAY '** TABLE     ** = ' PV-ABEND-TABLE.                 03920000
039300     DISPLAY '** MESSAGE   ** = ' PV-DB2-MESSAGE.                 03930000
039400     COPY DPPD004.                                                03940000
039500                                                                  03950000
039600     MOVE +4013                  TO PV-ABEND-CODE.                03960000
039700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03970000
039800                                                                  03980000
