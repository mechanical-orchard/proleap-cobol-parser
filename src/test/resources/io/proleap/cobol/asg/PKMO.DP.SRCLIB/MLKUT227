       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.    MLKUT227.                                         00030007
       AUTHOR.        JOHN SELWITSCHKA.                                 00040001
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
       DATE-WRITTEN.  08/05/2010.                                       00060001
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ******************************************************************00090000
      *           MLKUT227 - WRITE UNKNOWN REVERSAL AUDIT RECORDS      *00100007
      ******************************************************************00110000
      ******************************************************************00110100
      *    WR/PROJ      DATE        DESCRIPTION                        *00110202
      *    --------   --------     ---------------------------------   *00110300
      *    WR37965    08/05/10     INITIAL CREATION                    *00110402
      ******************************************************************00110500
                                                                        00110600
       ENVIRONMENT DIVISION.                                            00110700
                                                                        00110800
       CONFIGURATION SECTION.                                           00110900
       SOURCE-COMPUTER.        IBM-3090.                                00111000
       OBJECT-COMPUTER.        IBM-3090.                                00112000
       INPUT-OUTPUT SECTION.                                            00113000
       FILE-CONTROL.                                                    00114000
           SELECT UNKN-REVERSAL-FILE-IN                                 00115002
               ASSIGN TO INP01.                                         00116000
                                                                        00117000
           SELECT AUDIT-UNK-REV-FILE-OUT                                00118002
               ASSIGN TO OUT01.                                         00118100
                                                                        00118200
       DATA DIVISION.                                                   00118300
       FILE SECTION.                                                    00118400
                                                                        00118500
       FD  UNKN-REVERSAL-FILE-IN                                        00118602
           LABEL RECORDS ARE STANDARD                                   00118700
           RECORDING MODE IS F                                          00118800
           BLOCK CONTAINS 0 RECORDS.                                    00118900
       01  UNKN-REVERSAL-IN-REC         PIC X(450).                     00119005
                                                                        00120000
       FD  AUDIT-UNK-REV-FILE-OUT                                       00130002
           LABEL RECORDS ARE STANDARD                                   00140000
           RECORDING MODE IS F                                          00150000
           BLOCK CONTAINS 0 RECORDS.                                    00160000
       01  AUDIT-UNK-REV-OUT-REC        PIC X(200).                     00170002
      *                                                                 00180000
                                                                        00190000
       WORKING-STORAGE SECTION.                                         00200000
                                                                        00210000
       01  FILLER                      PIC X(28)   VALUE                00220000
                'BEGINNING OF WORKING STORAGE'.                         00230000
                                                                        00240000
       01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.00250000
                                                                        00260000
       01  PC-PROGRAM-CONSTANTS.                                        00270000
           05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'MLKUT227'.  00290007
      *                                                                 00300000
       01  PS-PROGRAM-SWITCHES.                                         00310000
           05  PS-EOF-UNKN-REV-FILE-SW      PIC X(01)     VALUE 'N'.    00320002
               88  PS-EOF-UNKN-REV-FILE                   VALUE 'Y'.    00330002
      *                                                                 00400000
       01  PROGRAM-VARIABLES.                                           00410000
           05  PV-SUB                    PIC 9(04)  VALUE ZEROES.       00420000
           05  PV-SKU-NBR                PIC 9(08)  VALUE ZEROES.       00441002
           05  PV-WORK-AMOUNT            PIC S9(11)V99 COMP-3 VALUE +0. 00441106
           05  PV-PARAGRAPH-NAME         PIC X(30)  VALUE SPACES.       00442002
           05  PV-OPERATION-ATTEMPTED    PIC X(50)  VALUE SPACES.       00443002
      *                                                                 00450000
       01  PA-PROGRAM-ACCUMULATORS.                                     00460000
           05  PA-RECORD-COUNTS.                                        00470000
               10  PA-INPUT-COUNT        PIC  9(09)  VALUE ZEROES.      00480000
               10  PA-OUTPUT-COUNT       PIC  9(09)  VALUE ZEROES.      00490000
               10  PA-UPDATE-COUNT       PIC  9(09)  VALUE ZEROES.      00500000
      *                                                                 00510000
      ******************************************************************00590000
      * MLRD254 - DETAILED MERCH LEDGER UPDATE TRANSACTIONS             00600002
      ******************************************************************00610000
           COPY MLRD254.                                                00620005
      *                                                                 00630000
      ******************************************************************00631002
      * MLRD090 - AUDIT DETAIL TRANSACTIONS                             00632002
      ******************************************************************00633002
           COPY MLRD090.                                                00634005
      *                                                                 00750000
      *-------------------*                                             00960000
       PROCEDURE DIVISION.                                              00970000
      *-------------------*                                             00980000
                                                                        00990000
       0000-MLKUT227.                                                   01000007
                                                                        01010000
           PERFORM 1000-INITIALIZATION.                                 01020000
      *                                                                 01030000
           PERFORM 2000-PROCESS-INPUT                                   01040000
                UNTIL PS-EOF-UNKN-REV-FILE.                             01050002
      *                                                                 01060000
           PERFORM 8000-EOJ-ROUTINE.                                    01070000
                                                                        01080000
           STOP RUN.                                                    01090000
                                                                        01100000
      ******************************************************************01110000
      * OPEN FILES, READ FIRST INPUT RECORD                             01120011
      ******************************************************************01130000
      *                                                                 01140000
       1000-INITIALIZATION.                                             01150000
      *                                                                 01160000
           OPEN INPUT UNKN-REVERSAL-FILE-IN.                            01170002
                                                                        01180000
           OPEN OUTPUT AUDIT-UNK-REV-FILE-OUT.                          01190002
                                                                        01200000
           PERFORM 3000-READ-UNKN-REV-FILE.                             01230002
      *                                                                 01240000
      ******************************************************************01570000
      * PROCESS THE INPUT AUDIT FILE                                    01580000
      ******************************************************************01590000
       2000-PROCESS-INPUT.                                              01600000
      *                                                                 01610000
           PERFORM 4000-POPULATE-AUDIT-DTL-REC.                         01640002
                                                                        01650000
           PERFORM 5000-WRITE-AUD-UNKN-REV-FILE.                        01651002
                                                                        01652002
           PERFORM 3000-READ-UNKN-REV-FILE.                             01660002
      *                                                                 01670000
      ******************************************************************01850000
      * READS THE CONDENSED FILE INTO THE AUDIT DETAIL RECORD LAYOUT    01860000
      ******************************************************************01870000
       3000-READ-UNKN-REV-FILE.                                         01880002
           READ UNKN-REVERSAL-FILE-IN INTO ML254-UPDATE-REC             01890002
              AT END                                                    01900000
                MOVE 'Y' TO PS-EOF-UNKN-REV-FILE-SW.                    01910002
                                                                        01920000
           IF NOT PS-EOF-UNKN-REV-FILE                                  01921002
                ADD 1                   TO PA-INPUT-COUNT               01930000
           END-IF.                                                      01931000
      *                                                                 01940000
      ******************************************************************01941002
      * POPULATE THE AUDIT DETAIL RECORD                                01942002
      ******************************************************************01943002
       4000-POPULATE-AUDIT-DTL-REC.                                     01944002
      *                                                                 01949302
           INITIALIZE ML090-AUDIT-REC                                   01950302
           MOVE ML254-FSCL-WK-END-DTE                                   01950402
             TO ML090-FSCL-WK-END-DTE                                   01950502
                ML090-PRCG-DTE                                          01950602
           MOVE ML254-DEPT-NBR                                          01950702
             TO ML090-DEPT-NBR                                          01950802
           MOVE ML254-MAJ-CL-NBR                                        01950902
             TO ML090-MAJ-CL-NBR                                        01951002
           MOVE ML254-SUB-CL-NBR                                        01951102
             TO ML090-SUB-CL-NBR                                        01951202
           MOVE ML254-LOC-NBR                                           01951302
             TO ML090-LOC-NBR                                           01951402
           MOVE ML254-ML-LWST-ID                                        01951502
             TO ML090-ML-LO-MDSE-LVL-ID                                 01951602
           MOVE ML254-ENT-ID                                            01951702
             TO ML090-ORIG-ENT-ID                                       01951802
           MOVE ML254-LBL-SEQ-NBR                                       01951902
             TO ML090-ORIG-LBL-SEQ-NBR                                  01952002
           MOVE ML254-SKU-NBR TO PV-SKU-NBR                             01952102
           IF PV-SKU-NBR = ZEROES OR                                    01952202
              PV-SKU-NBR = SPACES OR                                    01952302
              PV-SKU-NBR (6:3) = 000 OR                                 01952402
              PV-SKU-NBR (6:3) = 999                                    01952502
               MOVE 'Y'  TO ML090-DUMMY-SKU-IND                         01952602
           ELSE                                                         01952702
               MOVE 'N'  TO ML090-DUMMY-SKU-IND                         01952802
           END-IF                                                       01952902
           MOVE 'BVUNKN'                   TO ML090-FINCL-PRC-GP-CDE    01953102
           MOVE '9'                        TO ML090-SRC-SYS-ID          01953202
           MOVE '0'                        TO ML090-TRN-TYP-CDE(1:1)    01953302
           MOVE ML254-TRN-TYP-CDE          TO ML090-TRN-TYP-CDE(2:2)    01953402
           MOVE ML254-AP-TRANS-CDE         TO ML090-AP-TRN-CDE          01953508
           MOVE '02'                       TO ML090-DR-CR-CDE           01953612
           MOVE ML254-SLS-TYP-CDE          TO ML090-SLS-TYP-CDE         01953710
           IF ML254-PADJ-NET-COST-AMT NOT = ZERO OR                     01953810
              ML254-PADJ-GRO-COST-AMT NOT = ZERO OR                     01953910
              ML254-PADJ-RTL-AMT      NOT = ZERO                        01954010
               MOVE '15'                TO ML090-TRN-TYP-CDE(2:2)       01954110
           END-IF                                                       01954210
           MOVE ML254-PRCHG-RSN-CDE        TO ML090-PRCHG-RSN-CDE       01954402
           MOVE ML254-PRCHG-CTG-CDE        TO ML090-PRCHG-CTG-CDE       01954502
           MOVE ML254-ENT-ID               TO ML090-ENT-ID              01954602
           MOVE ML254-LBL-SEQ-NBR          TO ML090-LBL-SEQ-NBR         01954702
           MOVE ML254-PADJ-NET-COST-AMT    TO ML090-PADJ-NET-COST-AMT   01954817
           MOVE ML254-PADJ-GRO-COST-AMT    TO ML090-PADJ-GRO-COST-AMT   01954902
           MOVE ML254-PADJ-DISC-COST-AMT   TO ML090-PADJ-DISC-COST-AMT  01955002
           MOVE ML254-PADJ-RTL-AMT         TO ML090-PADJ-RTL-AMT        01955102
           COMPUTE PV-WORK-AMOUNT           = ML254-SLS-REG-RTL-AMT     01955206
                                            + ML254-SLS-PROMO-RTL-AMT   01955306
                                            + ML254-SLS-PROCLR-RTL-AMT  01955406
                                            + ML254-SLS-CLR-RTL-AMT     01955506
                                            + ML254-SLS-OTH-RTL-AMT     01955606
           MOVE PV-WORK-AMOUNT             TO ML090-SLS-RTL-AMT.        01955715
      *    IF ML254-MKDN-RTL-AMT NOT = ZERO                             01955913
      *        MOVE ML254-MKDN-RTL-AMT     TO ML090-PRCHG-RTL-AMT       01956013
      *    ELSE                                                         01956113
      *        MOVE ML254-MKUP-RTL-AMT     TO ML090-PRCHG-RTL-AMT       01956213
      *    END-IF.                                                      01957013
      *                                                                 01957502
      ******************************************************************01958000
      * WRITES THE CONDENSED FILE FROM THE AUDIT DETAIL RECORD LAYOUT   01960000
      ******************************************************************01970000
       5000-WRITE-AUD-UNKN-REV-FILE.                                    01980002
      *    WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC.            01990013
      *                                                                 02000013
      *    ADD 1                        TO PA-OUTPUT-COUNT.             02010013
W37965     IF ML254-SLS-REG-RTL-AMT     NOT = ZERO                      02010116
W37965         MOVE ML254-SLS-REG-RTL-AMT       TO ML090-SLS-RTL-AMT    02010216
W37965         MOVE 'R'                         TO ML090-SLS-TYP-CDE    02010316
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02010416
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02010516
W37965     END-IF.                                                      02010616
W37965     IF ML254-SLS-PROMO-RTL-AMT NOT = ZERO                        02010716
W37965         MOVE ML254-SLS-PROMO-RTL-AMT     TO ML090-SLS-RTL-AMT    02010816
W37965         MOVE 'P'                         TO ML090-SLS-TYP-CDE    02010916
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02011016
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02011116
W37965     END-IF.                                                      02011216
W37965     IF ML254-SLS-PROCLR-RTL-AMT NOT = ZERO                       02011316
W37965         MOVE ML254-SLS-PROCLR-RTL-AMT    TO ML090-SLS-RTL-AMT    02011416
W37965         MOVE 'G'                         TO ML090-SLS-TYP-CDE    02011516
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02011616
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02011716
W37965     END-IF.                                                      02011816
W37965     IF ML254-SLS-CLR-RTL-AMT NOT = ZERO                          02011916
W37965         MOVE ML254-SLS-CLR-RTL-AMT       TO ML090-SLS-RTL-AMT    02012016
W37965         MOVE 'C'                         TO ML090-SLS-TYP-CDE    02012116
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02012216
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02012316
W37965     END-IF.                                                      02012416
W37965     IF ML254-SLS-OTH-RTL-AMT NOT = ZERO                          02012516
W37965         MOVE ML254-SLS-OTH-RTL-AMT       TO ML090-SLS-RTL-AMT    02012616
W37965         MOVE 'N'                         TO ML090-SLS-TYP-CDE    02012716
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02012816
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02012916
W37965     END-IF.                                                      02013016
W37965     IF ML254-MKDN-RTL-AMT  NOT = ZERO                            02024513
W37965         MOVE ML254-MKDN-RTL-AMT          TO ML090-PRCHG-RTL-AMT  02024613
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02024913
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02025013
W37965     END-IF.                                                      02025113
W37965     IF ML254-MKUP-RTL-AMT  NOT = ZERO                            02025213
W37965         MOVE ML254-MKUP-RTL-AMT          TO ML090-PRCHG-RTL-AMT  02025313
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02025613
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02025713
W37965     END-IF.                                                      02025813
W37965     IF ML254-SLS-REG-RTL-AMT     = ZERO AND                      02025916
W37965        ML254-SLS-PROMO-RTL-AMT   = ZERO AND                      02026016
W37965        ML254-SLS-PROCLR-RTL-AMT  = ZERO AND                      02026116
W37965        ML254-SLS-CLR-RTL-AMT     = ZERO AND                      02026216
W37965        ML254-SLS-OTH-RTL-AMT     = ZERO AND                      02026316
W37965        ML254-MKDN-RTL-AMT        = ZERO AND                      02027313
W37965        ML254-MKUP-RTL-AMT        = ZERO                          02027413
W37965         WRITE AUDIT-UNK-REV-OUT-REC FROM ML090-AUDIT-REC         02027813
W37965         ADD 1                            TO PA-OUTPUT-COUNT      02027913
W37965     END-IF.                                                      02028013
      *                                                                 02029000
      ******************************************************************02030000
      *  RESET STATUS CODE, DISPLAY FINAL COUNTS , CLOSE INPUT FILE    *02040000
      ******************************************************************02050000
       8000-EOJ-ROUTINE.                                                02060000
                                                                        02070000
           DISPLAY SPACES.                                              02080000
           DISPLAY 'INPUT RECORDS READ       ', PA-INPUT-COUNT.         02090003
           DISPLAY 'OUTPUT RECORDS WRITTEN   ', PA-OUTPUT-COUNT.        02110003
           DISPLAY SPACES.                                              02120000
      *                                                                 02130000
           CLOSE UNKN-REVERSAL-FILE-IN                                  02140002
                 AUDIT-UNK-REV-FILE-OUT.                                02150002
      *                                                                 02160000
