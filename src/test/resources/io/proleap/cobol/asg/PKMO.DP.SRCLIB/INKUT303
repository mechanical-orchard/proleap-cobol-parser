       IDENTIFICATION DIVISION.                                         00010024
                                                                        00020024
       PROGRAM-ID.    INKUT303.                                         00030024
       AUTHOR.        SURENDAR BALAKRISHNAN.                            00040024
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050024
       DATE-WRITTEN.  12/01/2010.                                       00060024
       DATE-COMPILED.                                                   00070024
                                                                        00080024
      ******************************************************************00090024
      *           INKUT303 - THIS PROGRAM WILL CREATE A SUMMARY REPORT *00100024
      *                      FOR MASS ADD/DELETE PROCESS WHICH WILL    *00110024
      *                      BE SEND TO USER AS EMAIL MESSAGE          *00120024
      ******************************************************************00130024
      ******************************************************************00140024
      *    WR/PITS#     DATE        DESCRIPTION                        *00150024
      *    --------   --------     ---------------------------------   *00160024
      *    PKE2470    12/01/10     INITIAL CREATION                    *00170024
      ******************************************************************00180024
PE8627*    PKE8627    06/09/11     ENHANCING THE PROGRAM TO GET        *00190024
PE8627*                            EXTENDED RETAIL AMOUNT TO THE REPORT*00200024
PE8627*                            ALSO, ADDED A NEW OUTPUT FILE TO GET*00210024
PE8627*                            AREA NUMBER WHICH IS USED IN REPORT *00220024
PE8627*                            GENERATION FOR A PARTICULAR REQUEST *00230024
P12569*    PK12569    01/18/13     ADDED 15 AS ACCEPTABLE VALUE FOR     00240024
P12569*                            PV-RECORD-ID AS PART OF RTV          00250024
P12569*                            AUTOMATION.                          00260024
      ******************************************************************00270024
                                                                        00280024
       ENVIRONMENT DIVISION.                                            00290024
                                                                        00300024
       CONFIGURATION SECTION.                                           00310024
       SOURCE-COMPUTER.        IBM-3090.                                00320024
       OBJECT-COMPUTER.        IBM-3090.                                00330024
       INPUT-OUTPUT SECTION.                                            00340024
       FILE-CONTROL.                                                    00350024
           SELECT MASS-ADDDEL-HEADER                                    00360024
               ASSIGN TO INP01.                                         00370024
                                                                        00380024
           SELECT REPORT-FILE                                           00390024
               ASSIGN TO INP02.                                         00400024
                                                                        00410024
           SELECT INVALID-RECORDS-FILE                                  00420024
               ASSIGN TO INP03.                                         00430024
                                                                        00440024
           SELECT SUMMARY-REPORT                                        00450024
               ASSIGN TO OUT01.                                         00460024
                                                                        00470024
PE8627     SELECT AREA-OUTFILE                                          00480024
PE8627         ASSIGN TO OUT02.                                         00490024
                                                                        00500024
       DATA DIVISION.                                                   00510024
       FILE SECTION.                                                    00520024
                                                                        00530024
       FD  MASS-ADDDEL-HEADER                                           00540024
           LABEL RECORDS ARE STANDARD                                   00550024
           RECORDING MODE IS F                                          00560024
           BLOCK CONTAINS 0 RECORDS.                                    00570024
       01  MASS-ADDDEL-HEADER-REC       PIC X(80).                      00580024
                                                                        00590024
       FD  REPORT-FILE                                                  00600024
           LABEL RECORDS ARE STANDARD                                   00610024
           RECORDING MODE IS F                                          00620024
           BLOCK CONTAINS 0 RECORDS.                                    00630024
       01  REPORT-RECORD                PIC X(80).                      00640024
                                                                        00650024
       FD  INVALID-RECORDS-FILE                                         00660024
           LABEL RECORDS ARE STANDARD                                   00670024
           RECORDING MODE IS F                                          00680024
           BLOCK CONTAINS 0 RECORDS.                                    00690024
       01  INVALID-RECORD               PIC X(80).                      00700024
                                                                        00710024
       FD  SUMMARY-REPORT                                               00720024
           LABEL RECORDS ARE STANDARD                                   00730024
           RECORDING MODE IS F                                          00740024
           BLOCK CONTAINS 0 RECORDS.                                    00750024
PE8627 01  SUMMARY-REPORT-REC           PIC X(80).                      00760024
                                                                        00770024
PE8627 FD  AREA-OUTFILE                                                 00780024
PE8627     LABEL RECORDS ARE STANDARD                                   00790024
PE8627     RECORDING MODE IS F                                          00800024
PE8627     BLOCK CONTAINS 0 RECORDS.                                    00810024
PE8627 01  AREA-OUTFILE-REC             PIC X(80).                      00820024
                                                                        00830024
      *                                                                 00840024
                                                                        00850024
       WORKING-STORAGE SECTION.                                         00860024
                                                                        00870024
       01  FILLER                       PIC X(28)   VALUE               00880024
                'BEGINNING OF WORKING STORAGE'.                         00890024
                                                                        00900024
       01  PC-PROGRAM-CONSTANTS.                                        00910024
           05  PC-PROGRAM-NAME          PIC  X(08)  VALUE 'INKUT303'.   00920024
                                                                        00930024
       01  ABEND-CODE                   PIC S9(04)  VALUE ZERO          00940024
                                                    COMP SYNC.          00950024
           88  ABEND-4003-OTHER-ERROR               VALUE +4003.        00960024
           88  ABEND-4013-SQL-ERROR                 VALUE +4013.        00970024
                                                                        00980024
       01  PV-REPORT-LINE-HEADERS.                                      00990024
           05  PV-HDR-01.                                               01000024
               10 FILLER                PIC X(19)   VALUE SPACES.       01010024
               10 FILLER                PIC X(05)   VALUE 'MASS '.      01020024
               10 PV-PROCESS-NAME       PIC X(06)   VALUE SPACES.       01030024
               10 FILLER                PIC X(25)   VALUE               01040024
                                        ' PROCESS - SUMMARY REPORT'.    01050024
PE8627         10 FILLER                PIC X(25)   VALUE SPACES.       01060024
           05  PV-HDR-02.                                               01070024
               10 FILLER                PIC X(19)   VALUE SPACES.       01080024
               10 FILLER                PIC X(36)   VALUE               01090024
                '------------------------------------'.                 01100024
PE8627         10 FILLER                PIC X(25)   VALUE SPACES.       01110024
           05  PV-HDR-03.                                               01120024
               10 FILLER                PIC X(01)   VALUE SPACES.       01130024
               10 FILLER                PIC X(07)   VALUE               01140024
                                        'DATE : '.                      01150024
               10 PV-DATE-VALUE         PIC X(10)   VALUE SPACES.       01160024
               10 FILLER                PIC X(38)   VALUE SPACES.       01170024
               10 FILLER                PIC X(07)   VALUE               01180024
                                        'TIME : '.                      01190024
               10 PV-TIME-VALUE         PIC X(08)   VALUE SPACES.       01200024
PE8627         10 FILLER                PIC X(09)   VALUE SPACES.       01210024
           05  PV-HDR-04.                                               01220024
               10 FILLER                PIC X(01)   VALUE SPACES.       01230024
               10 FILLER                PIC X(08)   VALUE               01240024
                                        'SKU     '.                     01250024
               10 FILLER                PIC X(04)   VALUE SPACES.       01260024
               10 FILLER                PIC X(12)   VALUE               01270024
                                        'STORE NUMBER'.                 01280024
               10 FILLER                PIC X(04)   VALUE SPACES.       01290024
               10 FILLER                PIC X(08)   VALUE               01300024
                                        'QUANTITY'.                     01310024
PE8627         10 FILLER                PIC X(43)   VALUE SPACES.       01320024
           05  PV-HDR-05.                                               01330024
               10 FILLER                PIC X(01)   VALUE SPACES.       01340024
               10 FILLER                PIC X(08)   VALUE               01350024
                                        '--------'.                     01360024
               10 FILLER                PIC X(04)   VALUE SPACES.       01370024
               10 FILLER                PIC X(12)   VALUE               01380024
                                        '------------'.                 01390024
               10 FILLER                PIC X(04)   VALUE SPACES.       01400024
               10 FILLER                PIC X(08)   VALUE               01410024
                                        '--------'.                     01420024
PE8627         10 FILLER                PIC X(43)   VALUE SPACES.       01430024
           05  PV-HDR-06.                                               01440024
               10 FILLER                PIC X(01)   VALUE SPACES.       01450024
               10 FILLER                PIC X(36)   VALUE               01460024
                '-------------END OF LIST------------'.                 01470024
PE8627         10 FILLER                PIC X(43)   VALUE SPACES.       01480024
           05  PV-HDR-07.                                               01490024
               10 FILLER                PIC X(19)   VALUE SPACES.       01500024
               10 FILLER                PIC X(36)   VALUE               01510024
                '***********UNITS BALANCED***********'.                 01520024
PE8627         10 FILLER                PIC X(25)   VALUE SPACES.       01530024
           05  PV-HDR-08.                                               01540024
               10 FILLER                PIC X(19)   VALUE SPACES.       01550024
               10 FILLER                PIC X(36)   VALUE               01560024
                '*********UNITS NOT BALANCED*********'.                 01570024
PE8627         10 FILLER                PIC X(25)   VALUE SPACES.       01580024
           05  PV-HDR-09.                                               01590024
               10 FILLER                PIC X(01)   VALUE SPACES.       01600024
               10 FILLER                PIC X(36)   VALUE               01610024
                '------------------------------------'.                 01620024
PE8627         10 FILLER                PIC X(25)   VALUE SPACES.       01630024
           05  PV-HDR-10.                                               01640024
               10 FILLER                PIC X(19)   VALUE SPACES.       01650024
               10 FILLER                PIC X(38)   VALUE               01660024
                '****RECORDS WITH INVALID SKU FOUND****'.               01670024
PE8627         10 FILLER                PIC X(23)   VALUE SPACES.       01680024
           05  PV-REC-LINE.                                             01690024
               10 FILLER                PIC X(01)   VALUE SPACES.       01700024
               10 PV-INVALID-SKU        PIC X(08)   VALUE SPACES.       01710024
               10 FILLER                PIC X(04)   VALUE SPACES.       01720024
               10 PV-INVALID-STR-NBR    PIC X(04)   VALUE SPACES.       01730024
               10 FILLER                PIC X(11)   VALUE SPACES.       01740024
               10 PV-INVALID-QTY        PIC X(04)   VALUE SPACES.       01750024
PE8627         10 FILLER                PIC X(48)   VALUE SPACES.       01760024
PE8627     05  PV-BLANK-LINE            PIC X(80)   VALUE SPACES.       01770024
           05  PV-MSG-TEMPLATE-01.                                      01780024
               10 FILLER                PIC X(01)   VALUE SPACE.        01790024
               10 PV-MESSAGE-01         PIC X(56)   VALUE SPACES.       01800024
PE8627         10 PV-TEXT-01            PIC X(23)   VALUE SPACES.       01810024
           05  PV-MSG-TEMPLATE-02.                                      01820024
               10 FILLER                PIC X(01)   VALUE SPACE.        01830024
               10 PV-MESSAGE-02         PIC X(56)   VALUE SPACES.       01840024
               10 PV-DATA-02            PIC Z(9)9   VALUE ZEROES.       01850024
PE8627         10 FILLER                PIC X(13)   VALUE SPACES.       01860024
           05  PV-MSG-TEMPLATE-03.                                      01870024
               10 FILLER                PIC X(01)   VALUE SPACE.        01880024
               10 PV-MESSAGE-03         PIC X(56)   VALUE SPACES.       01890024
               10 PV-DATA-03            PIC Z(5)9(2).9(2).              01900024
PE8627         10 FILLER                PIC X(13)   VALUE SPACES.       01910024
PE8627     05  PV-MSG-TEMPLATE-04.                                      01920024
PE8627         10 FILLER                PIC X(01)   VALUE SPACE.        01930024
PE8627         10 PV-MESSAGE-04         PIC X(56)   VALUE SPACES.       01940024
PE8627         10 PV-DATA-04            PIC Z(10).9(2)                  01950024
PE8627                                              VALUE ZEROES.       01960024
PE8627         10 FILLER                PIC X(10)   VALUE SPACES.       01970024
                                                                        01980024
PE8627*  PV-FILE VARIABLE FOR OUT02 FILE  *                             01990024
PE8627                                                                  02000024
PE8627 01  PV-AREA-OUTFILE-REC.                                         02010024
PE8627     05  PV-AREA-NBR              PIC 9(09).                      02020024
PE8627     05  FILLER                   PIC X(71)   VALUE SPACES.       02030024
      *                                                                 02040024
       01  PC-REPORT-LINE-MESSAGES.                                     02050024
           05  PC-MSG-01                PIC X(56)   VALUE               02060024
             'ADJUSTMENT DESCRIPTION                                : '.02070024
           05  PC-MSG-02                PIC X(56)   VALUE               02080024
             'NUMBER OF INPUT RECORDS RECEIVED FOR ADJUSTMENTS      : '.02090024
           05  PC-MSG-03                PIC X(56)   VALUE               02100024
             'ERROR RECORDS (INVALID SKU/STORE)                     : '.02110024
           05  PC-MSG-04                PIC X(56)   VALUE               02120024
             'TOTAL NUMBER OF RECORDS IN ERROR (INVALID SKU/STORE)  : '.02130024
           05  PC-MSG-05                PIC X(56)   VALUE               02140024
             'TOTAL NUMBER OF RECORDS INSERTED INTO TABLE TADJADD   : '.02150024
           05  PC-MSG-06                PIC X(56)   VALUE               02160024
             'SUM OF UNITS RECEIVED IN INPUT                        : '.02170024
           05  PC-MSG-07                PIC X(56)   VALUE               02180024
             'SUM OF UNITS UPDATED IN TABLE TADJADD                 : '.02190024
           05  PC-MSG-08                PIC X(56)   VALUE               02200024
             'SUM OF UNITS RECEIVED WITH INVALID SKU OR STORE       : '.02210024
           05  PC-MSG-09                PIC X(56)   VALUE               02220024
             'AREA NUMBER USED FOR THIS ADJUSTMENT                  : '.02230024
           05  PC-MSG-10                PIC X(56)   VALUE               02240024
             '% OF UNIQUE AREA NUMBERS AVAILABLE FOR DELETE PROCESS : '.02250024
           05  PC-MSG-11                PIC X(56)   VALUE               02260024
             'TOTAL NUMBER OF RECORDS WRITTEN TO FASHION SALES FILE : '.02270024
           05  PC-MSG-12                PIC X(56)   VALUE               02280024
             '% OF UNIQUE AREA NUMBERS AVAILABLE FOR ADD PROCESS    : '.02290024
           05  PC-MSG-13                PIC X(56)   VALUE               02300024
             '*****RECORDS WITH INVALID SKU/STORE FOUND IN INPUT***** '.02310024
           05  PC-MSG-14                PIC X(56)   VALUE               02320024
             'LIST OF RECORDS DROPPED DUE TO INVALID SKU OR STORE   : '.02330024
PE8627     05  PC-MSG-15                PIC X(56)   VALUE               02340024
PE8627       'SUM OF EXT RETAIL AMOUNT UPDATED IN TADJADD TABLE     : '.02350024
      *                                                                 02360024
       01  PS-PROGRAM-SWITCHES.                                         02370024
           05  PS-END-OF-HEADER-SW      PIC X(01)   VALUE 'N'.          02380024
               88  PS-END-OF-HEADER                 VALUE 'Y'.          02390024
           05  PS-END-OF-ERROR-SW       PIC X(01)   VALUE 'N'.          02400024
               88  PS-END-OF-ERROR-RECS             VALUE 'Y'.          02410024
           05  PS-END-OF-RPT-SW         PIC X(01)   VALUE 'N'.          02420024
               88  PS-END-OF-RPT                    VALUE 'Y'.          02430024
           05  PS-INVALID-RECS-SW       PIC X(01)   VALUE 'N'.          02440024
               88  PS-NO-INVALID-RECS               VALUE 'Y'.          02450024
           05  PS-CNTL-DATE-FILE-SW     PIC X(01)   VALUE 'N'.          02460024
               88  PS-END-OF-CNTL-DTE-FILE          VALUE 'Y'.          02470024
      *                                                                 02480024
       01  PV-MASS-ADDDEL-HEADER.                                       02490024
           05  PV-RECORD-ID             PIC 9(02)   VALUE ZEROES.       02500024
P12569         88  PV-HEADER                        VALUE 15,10.        02510024
           05  FILLER                   PIC X(01)   VALUE SPACES.       02520024
           05  PV-PROCESS-TYPE          PIC X(01)   VALUE SPACES.       02530024
               88  PV-MASSADD                       VALUE 'A'.          02540024
               88  PV-MASSDEL                       VALUE 'D'.          02550024
           05  FILLER                   PIC X(01)   VALUE SPACES.       02560024
           05  PV-DESCRIPTION           PIC X(20)   VALUE SPACES.       02570024
           05  PV-EOD                   PIC X(01)   VALUE SPACES.       02580024
               88 PV-END-OF-DESCRIPTION             VALUE 'E'.          02590024
           05  FILLER                   PIC X(54)   VALUE SPACES.       02600024
      *                                                                 02610024
       01  PV-RPT-RECORD.                                               02620024
           05  PV-RPT-PROCESS-TYPE      PIC X(03)   VALUE SPACES.       02630024
               88  PV-RPT-MASSADD                   VALUE 'ADD'.        02640024
               88  PV-RPT-MASSDEL                   VALUE 'DEL'.        02650024
           05  PV-RPT-AREA-NBR          PIC S9(9)   COMP                02660024
                                                    VALUE ZEROES.       02670024
           05  PV-RPT-USED              PIC S9(9)   COMP                02680024
                                                    VALUE ZEROES.       02690024
           05  PV-RPT-AVAILABLE         PIC S9(9)   COMP                02700024
                                                    VALUE ZEROES.       02710024
           05  PV-RPT-AVAILABLE-PER     PIC S9(7)V9(2)                  02720024
                                                    COMP VALUE ZEROES.  02730024
           05  PV-RPT-TOTAL-INSERT      PIC S9(9)   COMP-3              02740024
                                                    VALUE ZEROES.       02750024
           05  PV-RPT-FASHION-WRITTEN   PIC S9(9)   COMP-3              02760024
                                                    VALUE ZEROES.       02770024
           05  FILLER                   PIC X(51)   VALUE SPACES.       02780024
      *                                                                 02790024
       01  PV-MASS-ADDDEL-TRAILER.                                      02800024
           05  PV-RECORD-ID-TR          PIC 9(02)   VALUE ZEROES.       02810024
               88  PV-TRAILER                       VALUE 99.           02820024
           05  FILLER                   PIC X(01)   VALUE SPACES.       02830024
           05  PV-INPUT-UNITS-SUM       PIC 9(09)   VALUE ZEROES.       02840024
           05  FILLER                   PIC X(01)   VALUE SPACES.       02850024
           05  PV-INPUT-REC-COUNT       PIC 9(09)   VALUE ZEROES.       02860024
           05  FILLER                   PIC X(58)   VALUE SPACES.       02870024
      *                                                                 02880024
       01  CC-INPUT-LAYOUT.                                             02890024
           05  CC-REC-NBR               PIC 9(02)   VALUE ZEROES.       02900024
           05  FILLER                   PIC X(01)   VALUE SPACES.       02910024
           05  CC-LOC-NBR               PIC 9(04)   VALUE ZEROES.       02920024
           05  FILLER                   PIC X(01)   VALUE SPACES.       02930024
           05  CC-SKU-NBR               PIC 9(08)   VALUE ZEROES.       02940024
           05  FILLER                   PIC X(01)   VALUE SPACES.       02950024
           05  CC-QTY                   PIC 9(04)   VALUE ZEROES.       02960024
           05  FILLER                   PIC X(62)   VALUE SPACES.       02970024
      *                                                                 02980024
       01  PROGRAM-VARIABLES.                                           02990024
           05  PV-PARAGRAPH-NAME        PIC X(30)   VALUE SPACES.       03000024
           05  PV-OPERATION-ATTEMPTED   PIC X(50)   VALUE SPACES.       03010024
           05  PV-CURRENT-TMST          PIC X(26)   VALUE SPACES.       03020024
           05  PV-FINAL-SUM-OF-UNITS    PIC 9(09)   VALUE ZEROES.       03030024
           05  PV-SUM-OF-QTY-INSERTED   PIC S9(10)  COMP-3              03040024
                                                    VALUE ZEROES.       03050024
PE8627     05  PV-EXRTL-OF-QTY-INSERTED PIC S9(10)V9(02) COMP-3         03060024
PE8627                                              VALUE ZEROES.       03070024
           05  PV-QTY-NULL-INDICATOR    PIC S9(04)  COMP                03080024
                                                    VALUE ZEROES.       03090024
           05  PV-TODAYS-TIME.                                          03100024
               10  PV-HOUR              PIC X(02)   VALUE SPACES.       03110024
               10  FILLER               PIC X(01)   VALUE ':'.          03120024
               10  PV-MIN               PIC X(02)   VALUE SPACES.       03130024
               10  FILLER               PIC X(01)   VALUE ':'.          03140024
               10  PV-SEC               PIC X(02)   VALUE SPACES.       03150024
           05  PV-TODAYS-DATE.                                          03160024
               10  PV-MONTH             PIC X(02)   VALUE SPACES.       03170024
               10  FILLER               PIC X(01)   VALUE '-'.          03180024
               10  PV-DAY               PIC X(02)   VALUE SPACES.       03190024
               10  FILLER               PIC X(01)   VALUE '-'.          03200024
               10  PV-YEAR              PIC X(04)   VALUE SPACES.       03210024
      *                                                                 03220024
       01  PA-PROGRAM-ACCUMULATORS.                                     03230024
           05  PA-RECORD-COUNTS.                                        03240024
               10  PA-ERROR-COUNT       PIC  9(09)  VALUE ZEROES.       03250024
               10  PA-SUM-OF-UNITS-ERROR                                03260024
                                        PIC  9(09)  VALUE ZEROES.       03270024
               10  PA-RPT-LINE-COUNT    PIC  9(09)  VALUE ZEROES.       03280024
      *                                                                 03290024
       01  PE-PROGRAM-ERROR-MESSAGES.                                   03300024
           05  PE-MSG-01                PIC X(50)   VALUE               03310024
                'ATTEMPT TO SELECT FROM TABLE TADJADD FAILED     '.     03320024
      *                                                                 03330024
      ******************************************************************03340024
      * DB2 TABLE DCLGEN - TADJADD                                      03350024
      ******************************************************************03360024
           EXEC SQL                                                     03370024
               INCLUDE TADJADD                                          03380024
           END-EXEC.                                                    03390024
      *                                                                 03400024
      ******************************************************************03410024
      * DB2 COMMUNICATION AREA.                                         03420024
      ******************************************************************03430024
           EXEC SQL                                                     03440024
               INCLUDE SQLCA                                            03450024
           END-EXEC.                                                    03460024
                                                                        03470024
      ******************************************************************03480024
      *  DB2 ERROR MESSAGES FORMAT AREA.                                03490024
      ******************************************************************03500024
           COPY DPWS004.                                                03510024
      *                                                                 03520024
                                                                        03530024
      *-------------------*                                             03540024
       PROCEDURE DIVISION.                                              03550024
      *-------------------*                                             03560024
                                                                        03570024
       0000-INKUT303.                                                   03580024
                                                                        03590024
           PERFORM 1000-INITIALIZATION.                                 03600024
      *                                                                 03610024
           PERFORM 2000-MAINLINE                                        03620024
      *                                                                 03630024
           PERFORM 8000-EOJ-ROUTINE.                                    03640024
                                                                        03650024
           STOP RUN.                                                    03660024
                                                                        03670024
      ******************************************************************03680024
      * OPEN INPUT FILES, INITIALIZE COUNTERS                           03690024
      ******************************************************************03700024
      *                                                                 03710024
       1000-INITIALIZATION.                                             03720024
      *                                                                 03730024
           OPEN INPUT  MASS-ADDDEL-HEADER                               03740024
                       REPORT-FILE                                      03750024
                       INVALID-RECORDS-FILE                             03760024
                OUTPUT SUMMARY-REPORT                                   03770024
PE8627                 AREA-OUTFILE.                                    03780024
                                                                        03790024
      *                                                                 03800024
           EXEC SQL                                                     03810024
              SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                  03820024
           END-EXEC.                                                    03830024
                                                                        03840024
           EVALUATE TRUE                                                03850024
              WHEN SQLCODE = 0                                          03860024
                 CONTINUE                                               03870024
              WHEN OTHER                                                03880024
                 DISPLAY 'ERROR GETTING CURRENT TIMESTAMP'              03890024
                 MOVE '1000-INITIALIZATION               '              03900024
                                            TO PV-PARAGRAPH-NAME        03910024
                 PERFORM 9999-SQL-ABEND                                 03920024
           END-EVALUATE.                                                03930024
      *                                                                 03940024
                                                                        03950024
      ******************************************************************03960024
      * PROCESS THE INPUTS AND FORMAT REPORT                            03970024
      ******************************************************************03980024
       2000-MAINLINE.                                                   03990024
      *                                                                 04000024
           PERFORM 5000-READ-ADDDEL-HEADER                              04010024
           IF PV-HEADER                                                 04020024
              IF PV-MASSADD                                             04030024
                 MOVE 'ADD   ' TO PV-PROCESS-NAME                       04040024
              ELSE                                                      04050024
                 MOVE 'DELETE' TO PV-PROCESS-NAME                       04060024
              END-IF                                                    04070024
           ELSE                                                         04080024
              DISPLAY 'NO HEADER FOUND                    '             04090024
              MOVE '2000-MAINLINE                 '                     04100024
                                   TO PV-PARAGRAPH-NAME                 04110024
              PERFORM 9999-OTHER-ABEND                                  04120024
           END-IF.                                                      04130024
      *                                                                 04140024
           PERFORM 5100-READ-ADDDEL-TRAILER                             04150024
           IF PV-TRAILER                                                04160024
              CONTINUE                                                  04170024
           ELSE                                                         04180024
              DISPLAY 'NO TRAILER FOUND              '                  04190024
              MOVE    '2000-MAINLINE                 '                  04200024
                                   TO PV-PARAGRAPH-NAME                 04210024
              PERFORM 9999-OTHER-ABEND                                  04220024
           END-IF.                                                      04230024
      *                                                                 04240024
           PERFORM 5200-READ-REPORT-IN.                                 04250024
      *                                                                 04260024
           PERFORM 5300-READ-INVALID-SKU.                               04270024
      *                                                                 04280024
           PERFORM 3000-FORMAT-SUMMARY-REPORT.                          04290024
      *                                                                 04300024
      ******************************************************************04310024
      * FORMAT AND WRITE SUMMARY REPORT                                 04320024
      ******************************************************************04330024
       3000-FORMAT-SUMMARY-REPORT.                                      04340024
      *HEADER LINES                                                     04350024
           MOVE PV-BLANK-LINE          TO SUMMARY-REPORT-REC            04360024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04370024
           MOVE PV-HDR-01              TO SUMMARY-REPORT-REC            04380024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04390024
           MOVE PV-HDR-02              TO SUMMARY-REPORT-REC            04400024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04410024
           MOVE PV-BLANK-LINE          TO SUMMARY-REPORT-REC            04420024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04430024
                                                                        04440024
      *DATE AND TIME                                                    04450024
           PERFORM 3100-FORMAT-DATE                                     04460024
           MOVE PV-TODAYS-DATE         TO PV-DATE-VALUE                 04470024
           MOVE PV-TODAYS-TIME         TO PV-TIME-VALUE                 04480024
           MOVE PV-HDR-03              TO SUMMARY-REPORT-REC            04490024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04500024
           MOVE PV-BLANK-LINE          TO SUMMARY-REPORT-REC            04510024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04520024
                                                                        04530024
      *ADJUSTMENT DISCRIPTION                                           04540024
           MOVE PC-MSG-01              TO PV-MESSAGE-01.                04550024
           MOVE PV-DESCRIPTION         TO PV-TEXT-01.                   04560024
           MOVE PV-MSG-TEMPLATE-01     TO SUMMARY-REPORT-REC            04570024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04580024
                                                                        04590024
      *NUMBER OF RECORDS RECEIVED FOR ADJUSTMENTS                       04600024
           MOVE PC-MSG-02              TO PV-MESSAGE-02.                04610024
           MOVE PV-INPUT-REC-COUNT     TO PV-DATA-02.                   04620024
           MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC            04630024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            04640024
                                                                        04650024
      *NUMBER OF RECORDS IN ERROR (INVALID SKU/STORE)                   04660024
           IF PS-NO-INVALID-RECS                                        04670024
              MOVE PC-MSG-03              TO PV-MESSAGE-01              04680024
              MOVE 'NONE'                 TO PV-TEXT-01                 04690024
              MOVE PV-MSG-TEMPLATE-01     TO SUMMARY-REPORT-REC         04700024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04710024
              MOVE PC-MSG-04              TO PV-MESSAGE-02              04720024
              MOVE PA-ERROR-COUNT         TO PV-DATA-02                 04730024
              MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC         04740024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04750024
           ELSE                                                         04760024
              MOVE PV-BLANK-LINE          TO SUMMARY-REPORT-REC         04770024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04780024
              MOVE PV-HDR-10              TO SUMMARY-REPORT-REC         04790024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04800024
      *                                                                 04810024
              MOVE PV-BLANK-LINE          TO SUMMARY-REPORT-REC         04820024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04830024
              MOVE PC-MSG-14              TO PV-MESSAGE-01              04840024
              MOVE SPACES                 TO PV-TEXT-01                 04850024
              MOVE PV-MSG-TEMPLATE-01     TO SUMMARY-REPORT-REC         04860024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04870024
      *                                                                 04880024
              MOVE PV-HDR-09              TO SUMMARY-REPORT-REC         04890024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04900024
              MOVE PV-HDR-04              TO SUMMARY-REPORT-REC         04910024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04920024
              MOVE PV-HDR-05              TO SUMMARY-REPORT-REC         04930024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04940024
              PERFORM 3200-FORMAT-REC                                   04950024
                     UNTIL PS-END-OF-ERROR-RECS                         04960024
              MOVE PV-HDR-06              TO SUMMARY-REPORT-REC         04970024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         04980024
              MOVE PV-BLANK-LINE          TO SUMMARY-REPORT-REC         04990024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         05000024
              MOVE PC-MSG-04              TO PV-MESSAGE-02              05010024
              MOVE PA-ERROR-COUNT         TO PV-DATA-02                 05020024
              MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC         05030024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         05040024
           END-IF                                                       05050024
                                                                        05060024
      *RECORD COUNTS                                                    05070024
           MOVE PC-MSG-05              TO PV-MESSAGE-02.                05080024
           MOVE PV-RPT-TOTAL-INSERT    TO PV-DATA-02.                   05090024
           MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC            05100024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            05110024
           MOVE PC-MSG-11              TO PV-MESSAGE-02.                05120024
           MOVE PV-RPT-FASHION-WRITTEN TO PV-DATA-02.                   05130024
           MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC            05140024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            05150024
                                                                        05160024
      *SUM OF UNITS COUNT                                               05170024
           MOVE PC-MSG-06              TO PV-MESSAGE-02.                05180024
           MOVE PV-INPUT-UNITS-SUM     TO PV-DATA-02.                   05190024
           MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC            05200024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            05210024
           MOVE  PV-RPT-AREA-NBR       TO ADJADD-AREA-NBR               05220024
PE8627     MOVE  PV-RPT-AREA-NBR       TO PV-AREA-NBR                   05230024
PE8627     MOVE  PV-AREA-OUTFILE-REC   TO  AREA-OUTFILE-REC             05240024
PE8627     PERFORM 6100-WRITE-AREA-OUTFILE                              05250024
           PERFORM 3300-GET-SUM-OF-UNITS-INSERTED                       05260024
           MOVE PC-MSG-07              TO PV-MESSAGE-02.                05270024
           MOVE PV-SUM-OF-QTY-INSERTED TO PV-DATA-02.                   05280024
           MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC            05290024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            05300024
           MOVE PC-MSG-08              TO PV-MESSAGE-02.                05310024
           MOVE PA-SUM-OF-UNITS-ERROR  TO PV-DATA-02.                   05320024
           MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC            05330024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            05340024
                                                                        05350024
PE8627*SUM OF EXTENDED RETAIL AMOUNT                                    05360024
PE8627     MOVE PC-MSG-15                TO PV-MESSAGE-04.              05370024
PE8627     MOVE PV-EXRTL-OF-QTY-INSERTED TO PV-DATA-04.                 05380024
PE8627     MOVE PV-MSG-TEMPLATE-04       TO SUMMARY-REPORT-REC          05390024
PE8627     PERFORM 6000-WRITE-SUMMARY-REPORT                            05400024
                                                                        05410024
      *AREA NUMBER STATISTICS                                           05420024
           MOVE PC-MSG-09              TO PV-MESSAGE-02.                05430024
           MOVE PV-RPT-AREA-NBR        TO PV-DATA-02.                   05440024
           MOVE PV-MSG-TEMPLATE-02     TO SUMMARY-REPORT-REC.           05450024
           PERFORM 6000-WRITE-SUMMARY-REPORT.                           05460024
           IF PV-MASSADD                                                05470024
              MOVE PC-MSG-12              TO PV-MESSAGE-03              05480024
           ELSE                                                         05490024
              MOVE PC-MSG-10              TO PV-MESSAGE-03              05500024
           END-IF.                                                      05510024
                                                                        05520024
           MOVE PV-RPT-AVAILABLE-PER   TO PV-DATA-03.                   05530024
           MOVE PV-MSG-TEMPLATE-03     TO SUMMARY-REPORT-REC.           05540024
           PERFORM 6000-WRITE-SUMMARY-REPORT.                           05550024
                                                                        05560024
      *REPORT CLOSING MESSAGE                                           05570024
           MOVE PV-BLANK-LINE          TO SUMMARY-REPORT-REC            05580024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            05590024
                                                                        05600024
           IF PV-MASSDEL                                                05610024
              COMPUTE PV-SUM-OF-QTY-INSERTED =                          05620024
                                    PV-SUM-OF-QTY-INSERTED * -1         05630024
           END-IF                                                       05640024
                                                                        05650024
           COMPUTE PV-FINAL-SUM-OF-UNITS =                              05660024
                      PV-SUM-OF-QTY-INSERTED + PA-SUM-OF-UNITS-ERROR    05670024
           IF PV-FINAL-SUM-OF-UNITS = PV-INPUT-UNITS-SUM                05680024
              MOVE PV-HDR-07              TO SUMMARY-REPORT-REC         05690024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         05700024
           ELSE                                                         05710024
              MOVE PV-HDR-08              TO SUMMARY-REPORT-REC         05720024
              PERFORM 6000-WRITE-SUMMARY-REPORT                         05730024
           END-IF.                                                      05740024
      *                                                                 05750024
      ******************************************************************05760024
      * FORMAT DATE AND TIME                                            05770024
      ******************************************************************05780024
       3100-FORMAT-DATE.                                                05790024
      *                                                                 05800024
           MOVE PV-CURRENT-TMST(6:2)     TO PV-MONTH.                   05810024
           MOVE PV-CURRENT-TMST(9:2)     TO PV-DAY.                     05820024
           MOVE PV-CURRENT-TMST(1:4)     TO PV-YEAR.                    05830024
           MOVE PV-CURRENT-TMST(12:2)    TO PV-HOUR.                    05840024
           MOVE PV-CURRENT-TMST(15:2)    TO PV-MIN.                     05850024
           MOVE PV-CURRENT-TMST(18:2)    TO PV-SEC.                     05860024
      *                                                                 05870024
      ******************************************************************05880024
      * FORMAT AND WRITE INVALID RECORD LINE                            05890024
      ******************************************************************05900024
      *                                                                 05910024
       3200-FORMAT-REC.                                                 05920024
      *                                                                 05930024
           MOVE CC-LOC-NBR             TO PV-INVALID-STR-NBR            05940024
           MOVE CC-SKU-NBR             TO PV-INVALID-SKU                05950024
           MOVE CC-QTY                 TO PV-INVALID-QTY                05960024
           ADD  CC-QTY                 TO PA-SUM-OF-UNITS-ERROR         05970024
           MOVE PV-REC-LINE            TO SUMMARY-REPORT-REC            05980024
           PERFORM 6000-WRITE-SUMMARY-REPORT                            05990024
           PERFORM 5300-READ-INVALID-SKU.                               06000024
      *                                                                 06010024
      ******************************************************************06020024
      * GET SUM OF UNITS INSERTED INTO TADJADD                          06030024
      ******************************************************************06040024
       3300-GET-SUM-OF-UNITS-INSERTED.                                  06050024
      *                                                                 06060024
                  EXEC SQL                                              06070024
PE8627              SELECT SUM(ADJ_QTY), SUM(ADJ_EXTD_AMT)              06080024
                     INTO :PV-SUM-OF-QTY-INSERTED :PV-QTY-NULL-INDICATOR06090024
PE8627                   ,:PV-EXRTL-OF-QTY-INSERTED                     06100024
                       FROM TADJADD                                     06110024
                      WHERE AREA_NBR = :ADJADD-AREA-NBR                 06120024
                  END-EXEC                                              06130024
      *                                                                 06140024
                  EVALUATE TRUE                                         06150024
                      WHEN SQLCODE = 0                                  06160024
                           CONTINUE                                     06170024
                      WHEN SQLCODE = 100                                06180024
                           DISPLAY 'AREA NUMBER NOT FOUND IN TADJADD'   06190024
                           DISPLAY 'AREA NUMBER:' PV-RPT-AREA-NBR       06200024
                      WHEN OTHER                                        06210024
                           MOVE PE-MSG-01 TO PV-OPERATION-ATTEMPTED     06220024
                           MOVE '3300-GET-SUM-OF-UNITS-INSERTED'        06230024
                                        TO PV-PARAGRAPH-NAME            06240024
                           PERFORM 9999-SQL-ABEND                       06250024
                  END-EVALUATE.                                         06260024
      ******************************************************************06270024
      * READS THE HEADER FOR MASS ADD/DELETE PROCESS                    06280024
      ******************************************************************06290024
       5000-READ-ADDDEL-HEADER.                                         06300024
           READ MASS-ADDDEL-HEADER INTO PV-MASS-ADDDEL-HEADER           06310024
              AT END                                                    06320024
                MOVE 'Y' TO PS-END-OF-HEADER-SW.                        06330024
                                                                        06340024
           IF PS-END-OF-HEADER                                          06350024
              DISPLAY 'NO HEADER FOUND               '                  06360024
              MOVE    '5000-READ-ADDDEL-HEADER       '                  06370024
                                   TO PV-PARAGRAPH-NAME                 06380024
              PERFORM 9999-OTHER-ABEND                                  06390024
           END-IF.                                                      06400024
      *                                                                 06410024
      ******************************************************************06420024
      * READS THE TRAILER FOR MASS ADD/DELETE PROCESS                   06430024
      ******************************************************************06440024
       5100-READ-ADDDEL-TRAILER.                                        06450024
           READ MASS-ADDDEL-HEADER INTO PV-MASS-ADDDEL-TRAILER          06460024
              AT END                                                    06470024
                MOVE 'Y' TO PS-END-OF-HEADER-SW.                        06480024
                                                                        06490024
           IF PS-END-OF-HEADER                                          06500024
              DISPLAY 'NO TRAILER FOUND                '                06510024
              MOVE    '5100-READ-ADDDEL-TRAILER    '                    06520024
                                   TO PV-PARAGRAPH-NAME                 06530024
              PERFORM 9999-OTHER-ABEND                                  06540024
           END-IF.                                                      06550024
      *                                                                 06560024
      ******************************************************************06570024
      * READS THE REPORT INFORMATION FILE                               06580024
      ******************************************************************06590024
       5200-READ-REPORT-IN.                                             06600024
           READ REPORT-FILE INTO PV-RPT-RECORD                          06610024
              AT END                                                    06620024
                MOVE 'Y' TO PS-END-OF-RPT-SW.                           06630024
                                                                        06640024
           IF PS-END-OF-RPT                                             06650024
              DISPLAY 'REPORT INFORMATION MISSING      '                06660024
              MOVE    '5200-READ-REPORT-IN          '                   06670024
                                   TO PV-PARAGRAPH-NAME                 06680024
              PERFORM 9999-OTHER-ABEND                                  06690024
           END-IF.                                                      06700024
      *                                                                 06710024
      ******************************************************************06720024
      * READS THE ERROR RECORDS (INVALID SKU) FILE                      06730024
      ******************************************************************06740024
       5300-READ-INVALID-SKU.                                           06750024
           READ INVALID-RECORDS-FILE INTO CC-INPUT-LAYOUT               06760024
              AT END                                                    06770024
                MOVE 'Y'             TO PS-END-OF-ERROR-SW.             06780024
      *                                                                 06790024
           IF PS-END-OF-ERROR-RECS                                      06800024
              MOVE 'Y'               TO PS-INVALID-RECS-SW              06810024
           ELSE                                                         06820024
              ADD +1                 TO PA-ERROR-COUNT                  06830024
           END-IF.                                                      06840024
      *                                                                 06850024
      ******************************************************************06860024
      * WRITE A LINE TO SUMMARY REPORT FILE                             06870024
      ******************************************************************06880024
       6000-WRITE-SUMMARY-REPORT.                                       06890024
                                                                        06900024
           WRITE SUMMARY-REPORT-REC.                                    06910024
           ADD  1                        TO PA-RPT-LINE-COUNT.          06920024
      *                                                                 06930024
      ******************************************************************06940024
PE8627* WRITE THE AREA NUMBER AREA OUTFILE                              06950024
PE8627******************************************************************06960024
PE8627 6100-WRITE-AREA-OUTFILE.                                         06970024
PE8627                                                                  06980024
PE8627     WRITE AREA-OUTFILE-REC.                                      06990024
      *                                                                 07000024
      ******************************************************************07010024
      *  DISPLAY FINAL COUNTS , CLOSE INPUT FILE                       *07020024
      ******************************************************************07030024
       8000-EOJ-ROUTINE.                                                07040024
      *                                                                 07050024
           DISPLAY SPACES.                                              07060024
           DISPLAY 'REPORT LINES WRITTEN   : ' PA-RPT-LINE-COUNT.       07070024
           DISPLAY SPACES.                                              07080024
      *                                                                 07090024
           CLOSE MASS-ADDDEL-HEADER                                     07100024
                 REPORT-FILE                                            07110024
                 INVALID-RECORDS-FILE                                   07120024
                 SUMMARY-REPORT                                         07130024
PE8627           AREA-OUTFILE.                                          07140024
      *                                                                 07150024
      *                                                                 07160024
      ******************************************************************07170024
      *  STANDARD DB2 ERROR ABEND ROUTINE                               07180024
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             07190024
      ******************************************************************07200024
       9999-SQL-ABEND.                                                  07210024
                                                                        07220024
           MOVE +4013                 TO ABEND-CODE.                    07230024
           DISPLAY '**  ABEND     **'.                                  07240024
           DISPLAY '**  PROGRAM   ** => ' PC-PROGRAM-NAME.              07250024
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            07260024
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-ATTEMPTED.       07270024
                                                                        07280024
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         07290024
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        07300024
                                                                        07310024
           COPY DPPD004.                                                07320024
           CALL 'ILBOABN0'  USING ABEND-CODE.                           07330024
      ******************************************************************07340024
      * DO THE NECESSARY PROCESSING TO ABEND FOR MISCELLANEOUS REASONS.*07350024
      ******************************************************************07360024
       9999-OTHER-ABEND.                                                07370024
           SET ABEND-4003-OTHER-ERROR TO TRUE.                          07380024
           DISPLAY '**  ABEND     **'.                                  07390024
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.              07400024
           DISPLAY '************************************************'.  07410024
           CALL 'ILBOABN0' USING ABEND-CODE.                            07420024
      ******************************************************************07430024
