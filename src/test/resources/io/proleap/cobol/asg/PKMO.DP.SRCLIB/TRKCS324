000100*----------------------------------------------------------------*05/02/95
000200 IDENTIFICATION DIVISION.                                         DPKCS036
000300*----------------------------------------------------------------*   LV002
000400 PROGRAM-ID.    TRKCS324.                                         DPKCS036
000500 AUTHOR.        ABRAHAM IVERSON                                   DPKCS036
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          DPKCS036
000700 DATE-WRITTEN.  07-29-04.                                         DPKCS036
000800 DATE-COMPILED.                                                   DPKCS036
000900                                                                  DPKCS036
001000*---------------------------------------------------------------* DPKCS036
001100*    Y324 - DECONSOLIDATOR CONTROL PANEL SUMMARY                * DPKCS036
001200*                                                               * DPKCS036
001300*    THIS PROGRAM GENERATES A SUMMARY LIST FOR THE              * DPKCS036
001400*    DECONSOLIDATOR CONTROL.                                    * DPKCS036
001700*                                                               * DPKCS036
001800*---------------------------------------------------------------* DPKCS036
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/17/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                  DPKCS036
002000 ENVIRONMENT DIVISION.                                            DPKCS036
002100                                                                  DPKCS036
002200 DATA DIVISION.                                                   DPKCS036
002300                                                                  DPKCS036
002400 WORKING-STORAGE SECTION.                                         DPKCS036
002500                                                                          
003000 01  PC-PROGRAM-CONSTANTS.                                        DPKCS036
003100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         DPKCS036
003200                                                    'TR324A  '.   DPKCS036
003300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         DPKCS036
003400                                                    'TRKM324 '.   DPKCS036
003500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         DPKCS036
003600                                                    'TRKCS324'.   DPKCS036
003700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      DPKCS036
003800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      DPKCS036
003900     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    DPKCS036
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     DPKCS036
004100                                                    COMP SYNC.    DPKCS036
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      DPKCS036
004300                                                    COMP SYNC.    DPKCS036
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         DPKCS036
004500                                                    +1000000      DPKCS036
004600                                                    COMP-3.       DPKCS036
004700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      DPKCS036
004800                                                    COMP SYNC.    DPKCS036
004900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       DPKCS036
005000                                                    COMP-3.       DPKCS036
005100     05  PC-INIT-DATE                   PIC  X(10)  VALUE         DPKCS036
005200                                                    '0001-01-01'. DPKCS036
005500     05  PC-ASTRK                       PIC  X(01)  VALUE '*'.            
005501     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    DPKCS036
005502     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  DPKCS036
005503     05  PC-DEFAULT                  PIC  X(08)  VALUE 'DEFAULT '.DPKCS036
005504     05  PC-WORKING                  PIC  X(08)  VALUE 'WORKING '.DPKCS036
005505     05  PC-ADJUSTED                 PIC  X(08)  VALUE 'ADJUSTED'.DPKCS036
005506                                                                  DPKCS036
005600     05  PC-TSYMSG-NUMBERS.                                       DPKCS036
005700         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  DPKCS036
005710         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  DPKCS036
005800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  DPKCS036
005810         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.  DPKCS036
005900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  DPKCS036
006000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  DPKCS036
006100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  DPKCS036
006200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  DPKCS036
006300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  DPKCS036
006400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  DPKCS036
006500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  DPKCS036
006600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  DPKCS036
006700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  DPKCS036
006800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  DPKCS036
006900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  DPKCS036
007000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  DPKCS036
007001         10  PC-TSYMSG-01061            PIC  9(05)  VALUE 01061.  DPKCS036
007002         10  PC-TSYMSG-03325            PIC  9(05)  VALUE 03325.  DPKCS036
007003         10  PC-TSYMSG-03326            PIC  9(05)  VALUE 03326.  DPKCS036
007100                                                                  DPKCS036
007200 01  PS-PROGRAM-SWITCHES.                                         DPKCS036
007300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    DPKCS036
007400         88  PS-NO-ERROR                            VALUE 'Y'.    DPKCS036
007500         88  PS-ERROR                               VALUE 'N'.    DPKCS036
007600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    DPKCS036
007700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    DPKCS036
007800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    DPKCS036
033700     05  PS-END-OF-SCAC-CUR-SW          PIC  X(01)  VALUE 'N'.            
033800         88  PS-END-OF-SCAC-CUR                     VALUE 'Y'.            
033801         88  PS-END-OF-SCAC-CUR-NO                  VALUE 'N'.            
033802     05  PS-END-OF-RULE-CUR-SW          PIC  X(01)  VALUE 'N'.            
033803         88  PS-END-OF-RULE-CUR                     VALUE 'Y'.            
033804         88  PS-END-OF-RULE-CUR-NO                  VALUE 'N'.            
033805     05  PS-END-OF-FINLUPD-CUR-SW       PIC  X(01)  VALUE 'N'.            
033806         88  PS-END-OF-FINLUPD-CUR                  VALUE 'Y'.            
033807         88  PS-END-OF-FINLUPD-CUR-NO               VALUE 'N'.            
033808     05  PS-DISPLAY-VIEW-SW             PIC  X(01)  VALUE 'Y'.            
033809         88  PS-DISPLAY-VIEW                        VALUE 'Y'.            
033810         88  PS-DISPLAY-VIEW-NO                     VALUE 'N'.            
033811                                                                  DPKCS036
033812 01  PV-PROGRAM-VARIABLES.                                        DPKCS036
033813     05  PV-SUB                         PIC S9(04)  VALUE +0      DPKCS036
033814                                                    COMP SYNC.    DPKCS036
033815     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      DPKCS036
033816                                                    COMP SYNC.    DPKCS036
033817     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      DPKCS036
033818                                                    COMP-3.       DPKCS036
033819     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      DPKCS036
033820                                                    COMP-3.       DPKCS036
033821     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      DPKCS036
033822                                                    COMP-3.       DPKCS036
033823     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      DPKCS036
033824                                                    COMP-3.       DPKCS036
033825     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      DPKCS036
033826                                                    COMP-3.       DPKCS036
033827     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      DPKCS036
033828                                                    COMP-3.       DPKCS036
033829     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      DPKCS036
033830                                                    COMP-3.       DPKCS036
033831     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      DPKCS036
033832                                                    COMP SYNC.    DPKCS036
033833     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      DPKCS036
033834                                                    COMP SYNC.    DPKCS036
033835     05  PV-ITEM                        PIC S9(04)  VALUE +0      DPKCS036
033836                                                    COMP SYNC.    DPKCS036
033837     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      DPKCS036
033838                                                    COMP SYNC.    DPKCS036
033839     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      DPKCS036
033840                                                    COMP SYNC.    DPKCS036
033841     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      DPKCS036
033842                                                    COMP SYNC.    DPKCS036
033843     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      DPKCS036
033844                                                    COMP SYNC.    DPKCS036
033845     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      DPKCS036
033846                                                    COMP SYNC.    DPKCS036
033847     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
033848                                                    COMP SYNC.    DPKCS036
033849     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
033850                                                    COMP SYNC.    DPKCS036
033851     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      DPKCS036
033852                                                    COMP SYNC.    DPKCS036
033853     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      DPKCS036
033854                                                    COMP SYNC.    DPKCS036
033855     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      DPKCS036
033856                                                    COMP SYNC.    DPKCS036
033857     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      DPKCS036
033858                                                    COMP SYNC.    DPKCS036
033859     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      DPKCS036
033860                                                    COMP SYNC.    DPKCS036
033861     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      DPKCS036
033862                                                    COMP SYNC.    DPKCS036
097977     05  PV-COUNTER                     PIC S9(04)  VALUE +0              
097978                                                    COMP SYNC.            
097979     05  PV-TRIM-SPACE                  PIC S9(04)  VALUE +0              
097980                                                    COMP SYNC.            
097981     05  PV-TABLE-STORE-COUNT           PIC S9(05)  VALUE ZERO            
097982                                                    COMP-3.               
097983     05  PV-CUR-RUL-TYP                 PIC X(08)   VALUE SPACES.         
097984     05  PV-PREV-RUL-TYP                PIC X(08)   VALUE SPACES.         
097985     05  PV-RUL-TYPE                    PIC X(08)   VALUE SPACES.         
097986     05  PV-PO-COUNT                    PIC S9(7)   COMP VALUE 0.         
097987     05  PV-CON-PO-COUNT                PIC S9(7)   COMP VALUE 0.         
097988     05  PV-COUNT-WKG-RULES             PIC S9(7)   COMP VALUE 0.         
097989     05  PV-CONTAINER-ID                PIC X(30)   VALUE SPACES.         
097990     05  PV-CONTAINER-SEQ               PIC X(30)   VALUE SPACES.         
097991     05  PV-CONTAINER-ETA               PIC X(30)   VALUE SPACES.         
097992     05  PV-SEQ-OR-ETA-VAL              PIC X(30)   VALUE SPACES.         
098000     05  PV-SEQ-OR-ETA                  PIC X(03).                        
098100         88  PV-SEQ                                 VALUE 'SEQ'.          
098200         88  PV-ETA                                 VALUE 'ETA'.          
098300     05  PV-DCNSL-SCAC                  PIC X(04)   VALUE SPACES.         
098400     05  PV-DEF-SCAC                    PIC X(04)   VALUE SPACES.         
098500     05  PV-ADJ-SCAC                    PIC X(04)   VALUE SPACES.         
098600     05  PV-WKG-SCAC                    PIC X(04)   VALUE SPACES.         
098700     05  PV-CNT-VESSEL                  PIC X(30)   VALUE SPACES.         
098701     05  PV-CNT-VOYAGE                  PIC X(30)   VALUE SPACES.         
098702     05  PV-RUL-ID                      PIC S9(9)   COMP VALUE +0.        
098703     05  PV-AUDIT-WKG-RULE              PIC S9(9)   COMP VALUE +0.        
098704     05  PV-AUDIT-ADJ-RULE              PIC S9(9)   COMP VALUE +0.        
098705     05  PV-INSERTED-RULE-ID            PIC S9(9)   COMP.                 
098706     05  PV-NULL-CBMT                   PIC S9(4)   COMP VALUE +0.        
098707     05  PV-NULL-CART                   PIC S9(4)   COMP VALUE +0.        
098708     05  PV-NULL-SEQ                    PIC S9(4)   COMP VALUE +0.        
098709     05  PV-NULL-ETA                    PIC S9(4)   COMP VALUE +0.        
098710     05  PV-DATE-BREAK.                                           DPKCS036
098711         10 FILLER                      PIC  X(02).               DPKCS036
098712         10 PV-DB-YY                    PIC  X(02).               DPKCS036
098713         10 FILLER                      PIC  X(01).               DPKCS036
098714         10 PV-DB-MM                    PIC  X(02).               DPKCS036
098715         10 FILLER                      PIC  X(01).               DPKCS036
098716         10 PV-DB-DD                    PIC  X(02).               DPKCS036
098717                                                                  DPKCS036
098718     05 PV-DATE-DISPLAY.                                          DPKCS036
098719         10 PV-DD-MM                    PIC  X(02).               DPKCS036
098720         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
098721         10 PV-DD-DD                    PIC  X(02).               DPKCS036
098722         10 FILLER                      PIC  X(01)  VALUE '/'.    DPKCS036
098723         10 PV-DD-YY                    PIC  X(02).               DPKCS036
098724                                                                          
098725     05 PV-DISPLAY-DATE.                                                  
098726         10 PV-MM                       PIC  X(02).                       
098727         10 FILLER                      PIC  X(01)  VALUE '/'.            
098728         10 PV-DD                       PIC  X(02).                       
098729         10 FILLER                      PIC  X(01)  VALUE '/'.            
098730         10 PV-YYYY                     PIC  X(04).                       
098737                                                                          
098738 01  DECNSL-SCAC-TABLE.                                                   
098739     05  DECNSL-SCAC-ROWS          OCCURS 3000 TIMES                      
098740                                      DEPENDING ON                        
098741                                      PV-TABLE-STORE-COUNT                
098742                                      ASCENDING KEY IS DECNSL-SCAC        
098743                                      INDEXED BY SCAC-IDX.                
098744         10  DECNSL-SCAC                     PIC  X(05).                  
098745         10  VIEW                            PIC  X(08).                  
098746         10  CNTR-CNT                        PIC  9(07).                  
098747         10  PO-CNT                          PIC  9(07).                  
098748         10  CART-CNT                        PIC  9(07).                  
098749         10  CBM-QTY                         PIC  9(04)V99.               
098750                                                                          
098751*---------------------------------------------------------------* DPKCS036
098752*    MAP LAYOUT                                                 * DPKCS036
098753*---------------------------------------------------------------* DPKCS036
098754                                                                  DPKCS036
098755     COPY TRKM324.                                                DPKCS036
098756                                                                  DPKCS036
098757 01  MR-OCCURS-LAYOUT                   REDEFINES  TR324AO.       DPKCS036
098758     05  FILLER                         PIC X(50).                DPKCS036
323900     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.                  
323901         10  MR-DECNSL-SCACL                PIC S9(04) COMP.      DPKCS036
323902         10  MR-DECNSL-SCACA                PIC  X(01).           DPKCS036
323903         10  MR-DECNSL-SCACC                PIC  X(01).           DPKCS036
323904         10  MR-DECNSL-SCACH                PIC  X(01).           DPKCS036
323905         10  MR-DECNSL-SCAC                 PIC  X(05).           DPKCS036
323906                                                                  DPKCS036
323907         10  MR-VIEWL                       PIC S9(04) COMP.      DPKCS036
323908         10  MR-VIEWA                       PIC  X(01).           DPKCS036
323909         10  MR-VIEWC                       PIC  X(01).           DPKCS036
323910         10  MR-VIEWH                       PIC  X(01).           DPKCS036
323911         10  MR-VIEW                        PIC  X(08).           DPKCS036
323912                                                                  DPKCS036
323913         10  MR-CNTR-CNTL                   PIC S9(04) COMP.      DPKCS036
323914         10  MR-CNTR-CNTA                   PIC  X(01).           DPKCS036
323915         10  MR-CNTR-CNTC                   PIC  X(01).           DPKCS036
323916         10  MR-CNTR-CNTH                   PIC  X(01).           DPKCS036
323917         10  MR-CNTR-CNT                    PIC  ZZZZZZ9.                 
323918         10  MR-CNTR-CNT-X REDEFINES MR-CNTR-CNT                          
323919                                            PIC  X(07).           DPKCS036
323920                                                                          
323921         10  MR-PO-CNTL                     PIC S9(04) COMP.      DPKCS036
323922         10  MR-PO-CNTA                     PIC  X(01).           DPKCS036
323923         10  MR-PO-CNTC                     PIC  X(01).           DPKCS036
323924         10  MR-PO-CNTH                     PIC  X(01).           DPKCS036
323925         10  MR-PO-CNT                      PIC  ZZZZZZ9.                 
323926         10  MR-PO-CNT-X REDEFINES MR-PO-CNT                              
323927                                            PIC  X(07).                   
323928                                                                  DPKCS036
323929         10  MR-CART-CNTL                   PIC S9(04) COMP.      DPKCS036
323930         10  MR-CART-CNTA                   PIC  X(01).           DPKCS036
323931         10  MR-CART-CNTC                   PIC  X(01).           DPKCS036
323932         10  MR-CART-CNTH                   PIC  X(01).           DPKCS036
323933         10  MR-CART-CNT                    PIC  ZZZZZZ9.                 
323934         10  MR-CART-CNT-X REDEFINES MR-CART-CNT                          
323935                                            PIC  X(07).                   
323936                                                                  DPKCS036
323937         10  MR-CBM-QTYL                    PIC S9(04) COMP.      DPKCS036
323938         10  MR-CBM-QTYA                    PIC  X(01).           DPKCS036
323939         10  MR-CBM-QTYC                    PIC  X(01).           DPKCS036
323940         10  MR-CBM-QTYH                    PIC  X(01).           DPKCS036
323941         10  MR-CBM-QTY                     PIC  ZZZ9.99.                 
323942         10  MR-CBM-QTY-X REDEFINES MR-CBM-QTY                            
323943                                            PIC  X(07).                   
323944                                                                  DPKCS036
323945 EJECT                                                            DPKCS036
323946*---------------------------------------------------------------* DPKCS036
323947*    ATTRIBUTE SETTINGS COPYBOOK.                               * DPKCS036
323948*---------------------------------------------------------------* DPKCS036
323949     COPY DPWS015.                                                DPKCS036
323950 EJECT                                                            DPKCS036
323951*---------------------------------------------------------------* DPKCS036
323952*    FUNCTION KEYS COPYBOOK.                                    * DPKCS036
323953*---------------------------------------------------------------* DPKCS036
323954     COPY DPWS016.                                                DPKCS036
323955 EJECT                                                            DPKCS036
323956*---------------------------------------------------------------* DPKCS036
323957*    SECURITY SUBROUTINE PARAMETERS.                            * DPKCS036
323958*---------------------------------------------------------------* DPKCS036
323959     COPY DPWS008.                                                DPKCS036
323960 EJECT                                                            DPKCS036
323961*---------------------------------------------------------------* DPKCS036
323962*    NUMERIC EDIT LAYOUT.                                       * DPKCS036
323963*---------------------------------------------------------------* DPKCS036
323964     COPY DPWS010I.                                               DPKCS036
323965 EJECT                                                            DPKCS036
323966*---------------------------------------------------------------* DPKCS036
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * DPKCS036
323968*---------------------------------------------------------------* DPKCS036
323969     COPY DPWS030.                                                DPKCS036
CICS       COPY DPWS930.                                                DPKCS036
323970 EJECT                                                            DPKCS036
323971*---------------------------------------------------------------* DPKCS036
323972*    STANDARD COMMAREA.                                         * DPKCS036
323973*---------------------------------------------------------------* DPKCS036
323974     COPY DPWS020.                                                DPKCS036
323975     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                DPKCS036
323976*---------------------------------------------------------------* DPKCS036
323977* INTER-APPLICATION COMMAREA.                                   * DPKCS036
323978*---------------------------------------------------------------* DPKCS036
323979         10  INTER-APPL-COMM-AREA       PIC X(200).               DPKCS036
323980     COPY TRWS320.                                                DPKCS036
323981 EJECT                                                            DPKCS036
323982*---------------------------------------------------------------* DPKCS036
323983*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * DPKCS036
323984*---------------------------------------------------------------* DPKCS036
323985         10  ASC-SPECIFIC-COMMAREA.                               DPKCS036
323986             15  ASC-LIST-KEYS.                                   DPKCS036
323987                 20  ASC-POE-CDE          PIC  X(03).             DPKCS036
323988                 20  ASC-WEEK-FROM-DTE    PIC  X(10).             DPKCS036
323989                 20  ASC-WEEK-TO-DTE      PIC  X(10).             DPKCS036
323990                 20  ASC-RUL-TYP          PIC  X(03).                     
323991                 20  ASC-TOT-CONT-COUNT   PIC  9(07).                     
323992                 20  ASC-TOT-PO-COUNT     PIC  9(07).                     
323993                 20  ASC-TOT-CART-COUNT   PIC  9(07).                     
323994                 20  ASC-TOT-CBMT-COUNT   PIC  9(04)V99.                  
323995                                                                  DPKCS036
323996             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                DPKCS036
323997                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  DPKCS036
323998                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   DPKCS036
323999                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   DPKCS036
324000                                                                  DPKCS036
324001                 20  ASC-ITEM-ARRAY.                              DPKCS036
324002                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        DPKCS036
324003                         30  ASC-LIST-ITEM-NUMBER                         
324004                                                    PIC S9(09)            
324005                                                     COMP-3.              
324006                         30  ASC-DECNSL-SCAC        PIC  X(05).   DPKCS036
324007                         30  ASC-VIEW               PIC  X(08).   DPKCS036
324008                         30  ASC-CNTR-CNT           PIC  9(07).           
324009                         30  ASC-PO-CNT             PIC  9(07).           
324010                         30  ASC-CART-CNT           PIC  9(07).           
324011                         30  ASC-CBM-QTY          PIC 9(04)V99.           
324012                                                                  DPKCS036
324013             15  ASC-BLK-SUB                        PIC S9(04)    DPKCS036
324014                                                          COMP    DPKCS036
324015                                                          SYNC.   DPKCS036
324016             15  ASC-ITEM-SUB                       PIC S9(04)    DPKCS036
324017                                                          COMP    DPKCS036
324018                                                          SYNC.   DPKCS036
324019             15  ASC-NUMBER-OF-ITEMS-READ           PIC S9(09)    DPKCS036
324020                                                          COMP-3. DPKCS036
324021             15  ASC-NUMBER-OF-SELECTED-ITEMS       PIC S9(09)    DPKCS036
324022                                                          COMP-3. DPKCS036
324023             15  ASC-ITEMS-DISPLAYED                PIC S9(03)    DPKCS036
324024                                                          COMP-3. DPKCS036
324025             15  ASC-ITEM-AT-TOP-OF-PANEL           PIC S9(09)    DPKCS036
324026                                                          COMP-3. DPKCS036
324027             15  ASC-ITEM-AT-BOT-OF-PANEL           PIC S9(09)    DPKCS036
324028                                                          COMP-3. DPKCS036
324029             15  ASC-HIGHEST-BLOCK-WRITTEN          PIC S9(04)    DPKCS036
324030                                                          COMP    DPKCS036
324031                                                          SYNC.   DPKCS036
324032             15  ASC-START-OF-SELECTED-RANGE        PIC S9(09)    DPKCS036
324033                                                          COMP-3. DPKCS036
324034             15  ASC-END-OF-SELECTED-RANGE          PIC S9(09)    DPKCS036
324035                                                          COMP-3. DPKCS036
324036             15  ASC-ITEMS-LEFT-INDICATOR           PIC  X(01).   DPKCS036
324037                 88  ASC-ITEMS-LEFT-ON-TABLE         VALUE 'Y'.   DPKCS036
324038                 88  ASC-NO-ITEMS-LEFT-ON-TABLE      VALUE 'N'.   DPKCS036
324039             15  ASC-TEMP-QUEUE-UPDATE-SW           PIC  X(01).   DPKCS036
324040                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   DPKCS036
324041                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   DPKCS036
324042             15  ASC-LIST-QUEUE-NAME.                             DPKCS036
324043                 20  ASC-LIST-TERM-ID               PIC  X(04).   DPKCS036
324044                 20  ASC-LIST-TASK-NUMBER           PIC S9(05)    DPKCS036
324045                                                          COMP-3. DPKCS036
324046                 20  ASC-LIST-SEQ                   PIC  9(01).   DPKCS036
324047             15  ASC-SEL-QUEUE-NAME.                              DPKCS036
324048                 20  ASC-SEL-TERM-ID                PIC  X(04).   DPKCS036
324049                 20  ASC-SEL-TASK-NUMBER            PIC S9(05)    DPKCS036
324050                                                          COMP-3. DPKCS036
324051                 20  ASC-SEL-SEQ                    PIC  9(01).   DPKCS036
324052                                                                  DPKCS036
324053             15  ASC-START-ITEM-REQUEST.                          DPKCS036
324054                 20  ASC-START-ITEM-REQUEST-N       PIC  9(05).   DPKCS036
324055                                                                          
324056             15  ASC-PERFORM-FINALIZE-SW     PIC X(01).                   
324057                 88  ASC-PERFORM-FINALIZE              VALUE 'Y'.         
324058                 88  ASC-PERFORM-FINALIZE-NO           VALUE 'N'.         
324059             15  ASC-PERFORM-DELETE-SW       PIC X(01).                   
324060                 88  ASC-PERFORM-DELETE                VALUE 'Y'.         
324061                 88  ASC-PERFORM-DELETE-NO             VALUE 'N'.         
324062                                                                  DPKCS036
324063 EJECT                                                            DPKCS036
324064*---------------------------------------------------------------* DPKCS036
324065*    ABEND PROCESSING COPYBOOK.                                 * DPKCS036
324066*---------------------------------------------------------------* DPKCS036
324067     COPY DPWS013.                                                DPKCS036
324068 EJECT                                                            DPKCS036
324069*---------------------------------------------------------------*         
324070*    DB2 AREA FOR DECON CONTROL PANEL RULES TABLE TRT_RUL.      *         
324071*---------------------------------------------------------------*         
324072     EXEC SQL                                                             
324073          INCLUDE TRT00014                                                
324074     END-EXEC.                                                            
324075*---------------------------------------------------------------*         
324076*    DB2 AREA FOR DECON CONTROL RULE CONSTRAINTS TABLE.         *         
324077*                                               TRT_RUL_CNSTR   *         
324078*---------------------------------------------------------------*         
324079     EXEC SQL                                                             
324080          INCLUDE TRT00015                                                
324081     END-EXEC.                                                            
324082*---------------------------------------------------------------*         
324083*    DB2 AREA FOR DECON CONTROL RULE CONSTRAINTS TABLE.         *         
324084*                                               TRT_AUD_RUL     *         
324085*---------------------------------------------------------------*         
324086     EXEC SQL                                                             
324087          INCLUDE TRT00016                                                
324088     END-EXEC.                                                            
324089*---------------------------------------------------------------*         
324090*    DB2 AREA FOR DECON CONTROL RULE CONSTRAINTS TABLE.         *         
324091*                                               TRT_AUD_RUL     *         
324092*---------------------------------------------------------------*         
324093     EXEC SQL                                                             
324094          INCLUDE TRT00017                                                
324095     END-EXEC.                                                            
324096*---------------------------------------------------------------*         
324097*    DB2 AREA FOR DECON CONTROL RULE CONSTRAINTS TABLE.         *         
324098*                                            TRT_AUD_RUL_CNSTR  *         
324099*---------------------------------------------------------------*         
324100     EXEC SQL                                                             
324101          INCLUDE TRT00018                                                
324102     END-EXEC.                                                            
324103*---------------------------------------------------------------*         
324104*    DB2 AREA FOR CONTAINER PO                                  *         
324105*---------------------------------------------------------------*         
324106     EXEC SQL                                                             
324107          INCLUDE TIMCNPO                                                 
324108     END-EXEC.                                                            
324109*---------------------------------------------------------------* DPKCS036
324110*    DB2 AREA FOR COMMUNICATIONS                                * DPKCS036
324111*---------------------------------------------------------------* DPKCS036
324112     EXEC SQL                                                     DPKCS036
324113          INCLUDE SQLCA                                           DPKCS036
324114     END-EXEC.                                                    DPKCS036
324115*---------------------------------------------------------------* DPKCS036
324116*    CURSOR TO SELECT ALL DISTINCT SCAC IDS                       DPKCS036
324117*---------------------------------------------------------------* DPKCS036
324118                                                                          
324119     EXEC SQL                                                             
324120        DECLARE SCAC_CUR CURSOR FOR                                       
324121              SELECT A.RUL_CNSTR_VAL_TXT                                  
324122              FROM   TRT_RUL_CNSTR A                                      
324123                    ,TRT_RUL_CNSTR B                                      
324130                    ,TRT_RUL       C                                      
324200              WHERE  A.RUL_CNSTR_TYP_CDE = 'DECN'                         
324300                AND  A.RUL_ID            = B.RUL_ID                       
324400                AND  A.RUL_ID            = C.RUL_ID                       
324500                AND  B.RUL_CNSTR_TYP_CDE = 'POE'                          
324600                AND  B.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                   
324700                AND  C.RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE             
324800                AND  C.RUL_END_DTE       = :ASC-WEEK-TO-DTE               
324900              GROUP BY A.RUL_CNSTR_VAL_TXT                                
324901              ORDER BY A.RUL_CNSTR_VAL_TXT                                
324902     END-EXEC.                                                            
324903                                                                          
324904*---------------------------------------------------------------* DPKCS036
324905*    CURSOR TO SELECT ALL RULE IDS FROM DEFAULT CONTAINERS        DPKCS036
324906*---------------------------------------------------------------* DPKCS036
324907                                                                          
324908     EXEC SQL                                                             
324909        DECLARE RULE_CUR CURSOR FOR                                       
324910              SELECT A.RUL_ID                                             
324920              FROM   TRT_RUL_CNSTR A                                      
324930                    ,TRT_RUL_CNSTR B                                      
324940                    ,TRT_RUL       C                                      
324950              WHERE  A.RUL_ID            = B.RUL_ID                       
324960                AND  A.RUL_ID            = C.RUL_ID                       
324970                AND  A.RUL_CNSTR_TYP_CDE = 'CONT'                         
324980                AND  B.RUL_CNSTR_TYP_CDE = 'POE'                          
324990                AND  B.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                   
325000                AND  C.RUL_CDE           = 'CONT'                         
325100                AND  C.RUL_TYP_CDE       = 'DEF'                          
325200                AND  C.RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE             
325300                AND  C.RUL_END_DTE       = :ASC-WEEK-TO-DTE               
325301              GROUP BY A.RUL_ID                                           
325302     END-EXEC.                                                            
325303                                                                          
325304*---------------------------------------------------------------* DPKCS036
325305*    CURSOR TO FINALIZE WORKING RULES                             DPKCS036
325306*---------------------------------------------------------------* DPKCS036
325307                                                                          
325308     EXEC SQL                                                             
325309        DECLARE FINLUPD_CUR CURSOR FOR                                    
325310              SELECT DISTINCT                                             
325320                     TR.RUL_ID                                            
325330                    ,TR.RUL_CDE                                           
325340                    ,TR.RUL_BEG_DTE                                       
325341                    ,TR.RUL_END_DTE                                       
325342              FROM TRT_RUL_CNSTR TRC                                      
325343                  ,TRT_RUL TR                                             
325344              WHERE TR.RUL_ID             = TRC.RUL_ID                    
325345                AND TR.RUL_TYP_CDE        = 'WKG'                         
325346                AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE            
325347                AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE              
325348                AND TRC.RUL_CNSTR_TYP_CDE = 'POE'                         
325349                AND TRC.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                  
325350     END-EXEC.                                                            
325351 EJECT                                                                    
325352*----------------------------------------------------------------*        
325353 LINKAGE SECTION.                                                 DPKCS036
325354                                                                  DPKCS036
325355 01  DFHCOMMAREA.                                                 DPKCS036
325356     05  FILLER                         OCCURS  1 TO 4072 TIMES   DPKCS036
325357                                        DEPENDING ON EIBCALEN.    DPKCS036
325358         10  FILLER                     PIC X.                    DPKCS036
325359                                                                  DPKCS036
325360 EJECT                                                            DPKCS036
325361*----------------------------------------------------------------*DPKCS036
325362 PROCEDURE DIVISION.                                              DPKCS036
325363*----------------------------------------------------------------*DPKCS036
325364*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *DPKCS036
325365*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *DPKCS036
325366*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *DPKCS036
325367*----------------------------------------------------------------*DPKCS036
325368 0000-MAIN-MODULE.                                                DPKCS036
325369                                                                  DPKCS036
325370     INITIALIZE DP030-CICS-API-FIELDS.                            DPKCS036
325371     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       DPKCS036
325372     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          DPKCS036
325373     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         DPKCS036
325374     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       DPKCS036
325375     MOVE LENGTH OF TR324AI        TO DP030-MAP-LENGTH (1).       DPKCS036
325376     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     DPKCS036
325377     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
325378*                                                                 DPKCS036
325379     PERFORM 1000-CONTROL-PROCESSING                              DPKCS036
325380*                                                                 DPKCS036
325381     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     DPKCS036
325382     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
325383                                                                  DPKCS036
325384**--------------------------------------------------------------**DPKCS036
325385**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **DPKCS036
325386**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **DPKCS036
325387**--------------------------------------------------------------**DPKCS036
325388 0001-CALL-CICS-ARCH-API.                                         DPKCS036
325389                                                                  DPKCS036
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      DPKCS036
325391                                    DFHCOMMAREA                           
325392                                    DP030-CICS-API-FIELDS                 
325393                                    DP020-STANDARD-COMMAREA               
325394                                    TR324AI.                              
325395*                                                                 DPKCS036
325396     IF  DP030-RC-CALL-SUCCESSFUL                                 DPKCS036
325397         CONTINUE                                                 DPKCS036
325398     ELSE                                                         DPKCS036
325399         SET DP013-NO-ROLLBACK                                    DPKCS036
325400             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
325401             DP013-CICS-ABEND      TO TRUE                        DPKCS036
325402         MOVE '0001-CALL-CICS-ARCH-API'                           DPKCS036
325403                                   TO DP013-PARAGRAPH             DPKCS036
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE ODPKCS036
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      DPKCS036
325406         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      DPKCS036
325407         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
325408     END-IF.                                                      DPKCS036
325409                                                                  DPKCS036
325410 EJECT                                                            DPKCS036
325411*----------------------------------------------------------------*DPKCS036
325412* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *DPKCS036
325413* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *DPKCS036
325414*                                                                *DPKCS036
325415* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *DPKCS036
325416*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *DPKCS036
325417*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *DPKCS036
325418*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *DPKCS036
325419*----------------------------------------------------------------*DPKCS036
325420 1000-CONTROL-PROCESSING.                                         DPKCS036
325421                                                                  DPKCS036
325422     EVALUATE TRUE                                                DPKCS036
325423         WHEN DP020-NEXT-ACT-INITIAL                              DPKCS036
325424             INITIALIZE ASC-SPECIFIC-COMMAREA                     DPKCS036
325425             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            DPKCS036
325426                                      ASC-SEL-TERM-ID             DPKCS036
325427             MOVE DP020-SRC-TASK-NUMBER                           DPKCS036
325428                                   TO ASC-LIST-TASK-NUMBER        DPKCS036
325429                                      ASC-SEL-TASK-NUMBER         DPKCS036
325430             MOVE PC-LIST-QUEUE-SEQ                               DPKCS036
325431                                   TO ASC-LIST-SEQ                DPKCS036
325432             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 DPKCS036
325433             PERFORM 1100-PROCESS-INTER-APPL-COMM                 DPKCS036
325434***-----$TEMPLATE NOTE$-------------------------------------------DPKCS036
325435*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,DPKCS036
325436*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  DPKCS036
325437*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.DPKCS036
325438***---------------------------------------------------------------DPKCS036
325439             IF  PS-COMMAREA-NOT-VALID                            DPKCS036
325440                 SET DP020-NEXT-ACT-APPL-ERROR                    DPKCS036
325441                                   TO TRUE                        DPKCS036
325442             ELSE                                                 DPKCS036
325443                 PERFORM 1200-BUILD-DCNSLR-SCAC-TABLE                     
325444                 PERFORM 1300-ADD-CONTR-COUNTS-TO-SCAC                    
325445                 PERFORM 4000-BUILD-INITIAL-PANEL                 DPKCS036
325446             END-IF                                               DPKCS036
325447                                                                  DPKCS036
325448         WHEN DP020-NEXT-ACT-READ-MAP                             DPKCS036
325449             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
325450                                   TO PV-TOP-ITEM                 DPKCS036
325451             PERFORM 2000-PROCESS-PANEL                           DPKCS036
325452                                                                  DPKCS036
325453         WHEN DP020-NEXT-ACT-RETURN                               DPKCS036
325454             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
325455                                   TO PV-TOP-ITEM                 DPKCS036
325456             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
325457             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
325458             PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
325459                                                                  DPKCS036
325460         WHEN OTHER                                               DPKCS036
325461             SET DP013-LOGIC-ABEND TO TRUE                        DPKCS036
325462             SET DP013-NO-ROLLBACK TO TRUE                        DPKCS036
325463             MOVE '1000-CONTROL-PROCESSING'                       DPKCS036
325464                                   TO DP013-PARAGRAPH             DPKCS036
325465             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    DPKCS036
325466                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
325467             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
325468     END-EVALUATE.                                                DPKCS036
325469                                                                  DPKCS036
325470 EJECT                                                            DPKCS036
325471*----------------------------------------------------------------*DPKCS036
325472* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *DPKCS036
325473* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *DPKCS036
325474*----------------------------------------------------------------*DPKCS036
325475 1100-PROCESS-INTER-APPL-COMM.                                    DPKCS036
325476                                                                  DPKCS036
325477     SET PS-COMMAREA-VALID         TO TRUE.                       DPKCS036
325478     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     DPKCS036
325479                                                                  DPKCS036
325481     MOVE TR320-POE-CDE            TO ASC-POE-CDE.                        
325483     MOVE TR320-WEEK-FROM-DTE      TO ASC-WEEK-FROM-DTE.                  
325485     MOVE TR320-WEEK-TO-DTE        TO ASC-WEEK-TO-DTE.                    
325487                                                                  DPKCS036
325488 EJECT                                                            DPKCS036
325489*----------------------------------------------------------------*DPKCS036
325490* CREATE WORKING TABLE OF UNIUE DECONSOLIDATOR SCAC CODES        *DPKCS036
325491*----------------------------------------------------------------*DPKCS036
325492 1200-BUILD-DCNSLR-SCAC-TABLE.                                    DPKCS036
325493                                                                          
325494     PERFORM 1210-OPEN-SCAC-CUR.                                  DPKCS036
325495                                                                          
325496     PERFORM 1220-PROCESS-SCAC-CUR                                DPKCS036
325497       UNTIL PS-END-OF-SCAC-CUR.                                          
325498                                                                          
325499     PERFORM 1230-CLOSE-SCAC-CUR.                                 DPKCS036
325500                                                                          
325501*----------------------------------------------------------------*DPKCS036
325502*   OPEN THE SCAC CURSOR                                          DPKCS036
325503*----------------------------------------------------------------*DPKCS036
325504 1210-OPEN-SCAC-CUR.                                              DPKCS036
325505                                                                  DPKCS036
325506     EXEC SQL                                                     DPKCS036
325507          OPEN SCAC_CUR                                           DPKCS036
325508     END-EXEC                                                     DPKCS036
325509                                                                  DPKCS036
325510     EVALUATE TRUE                                                DPKCS036
325511         WHEN SQLCODE = ZERO                                      DPKCS036
325512         WHEN SQLCODE = -904                                      DPKCS036
325513         WHEN SQLCODE = -913                                      DPKCS036
325514            CONTINUE                                              DPKCS036
325515         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
325516         WHEN SQLCODE < ZERO                                      DPKCS036
325517         WHEN SQLCODE > ZERO                                      DPKCS036
325518             MOVE '1210-OPEN-SCAC-CUR'                            DPKCS036
325519                               TO DP013-PARAGRAPH                 DPKCS036
325520             MOVE 'OPEN SCAC OCURSOR - '                          DPKCS036
325521                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
325522             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
325523             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
325524             SET DP013-DB2-ABEND                                  DPKCS036
325525                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
325526             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
325527     END-EVALUATE.                                                        
325528                                                                          
325529 EJECT                                                            DPKCS036
325530*----------------------------------------------------------------*DPKCS036
325531* BUILD INTERNAL TABLE OF ALL DEFAULT RULE SCAC IDS               DPKCS036
325532*----------------------------------------------------------------*DPKCS036
325533 1220-PROCESS-SCAC-CUR.                                           DPKCS036
325534                                                                          
325535     PERFORM 1221-FETCH-SCAC-CUR.                                         
325536                                                                          
325537     IF PS-END-OF-SCAC-CUR-NO                                             
325538        MOVE TRT00015-RUL-CNSTR-VAL-TXT TO DECNSL-SCAC(SCAC-IDX)          
325539        MOVE PC-DEFAULT                 TO VIEW(SCAC-IDX)                 
325600        MOVE ZEROES                     TO CNTR-CNT(SCAC-IDX)             
325700        MOVE ZEROES                     TO PO-CNT(SCAC-IDX)               
325800        MOVE ZEROES                     TO CART-CNT(SCAC-IDX)             
325900        MOVE ZEROES                     TO CBM-QTY(SCAC-IDX)              
326000        SET SCAC-IDX UP BY +1                                             
326100                                                                          
326200        MOVE TRT00015-RUL-CNSTR-VAL-TXT TO DECNSL-SCAC(SCAC-IDX)          
326300        MOVE PC-WORKING                 TO VIEW(SCAC-IDX)                 
326400        MOVE ZEROES                     TO CNTR-CNT(SCAC-IDX)             
326500        MOVE ZEROES                     TO PO-CNT(SCAC-IDX)               
326600        MOVE ZEROES                     TO CART-CNT(SCAC-IDX)             
326700        MOVE ZEROES                     TO CBM-QTY(SCAC-IDX)              
326800        SET SCAC-IDX UP BY +1                                             
326900                                                                          
327000        MOVE TRT00015-RUL-CNSTR-VAL-TXT TO DECNSL-SCAC(SCAC-IDX)          
327100        MOVE PC-ADJUSTED                TO VIEW(SCAC-IDX)                 
327200        MOVE ZEROES                     TO CNTR-CNT(SCAC-IDX)             
327300        MOVE ZEROES                     TO PO-CNT(SCAC-IDX)               
327400        MOVE ZEROES                     TO CART-CNT(SCAC-IDX)             
327500        MOVE ZEROES                     TO CBM-QTY(SCAC-IDX)              
327600        SET SCAC-IDX UP BY +1                                             
327700                                                                          
327800        ADD +3 TO PV-TABLE-STORE-COUNT                                    
327900     END-IF.                                                              
327901                                                                          
327902*----------------------------------------------------------------*DPKCS036
327903* FETCH THE RULES                                                 DPKCS036
327904*----------------------------------------------------------------*DPKCS036
327905 1221-FETCH-SCAC-CUR.                                             DPKCS036
327906                                                                  DPKCS036
327907     EXEC SQL                                                     DPKCS036
327908          FETCH SCAC_CUR                                          DPKCS036
327909          INTO :TRT00015-RUL-CNSTR-VAL-TXT                        DPKCS036
327910     END-EXEC.                                                    DPKCS036
327911                                                                  DPKCS036
327912     EVALUATE TRUE                                                DPKCS036
327913         WHEN SQLCODE = ZERO                                      DPKCS036
327914              CONTINUE                                                    
327915         WHEN SQLCODE = +100                                      DPKCS036
327916              SET PS-END-OF-SCAC-CUR TO TRUE                      DPKCS036
327917         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
327918         WHEN SQLCODE NOT = ZERO                                  DPKCS036
327919              MOVE '4310-FETCH-CURSOR'                            DPKCS036
327920                               TO DP013-PARAGRAPH                 DPKCS036
327921              MOVE 'FETCH CARTON DETAIL CURSOR'                   DPKCS036
327922                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
327923              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
327924              SET DP013-DB2-ABEND                                 DPKCS036
327925                               TO TRUE                            DPKCS036
327926              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
327927     END-EVALUATE.                                                DPKCS036
327928                                                                  DPKCS036
327929 EJECT                                                            DPKCS036
327930*----------------------------------------------------------------*DPKCS036
327931*   CLOSE THE SCAC CURSOR                                        *DPKCS036
327932*----------------------------------------------------------------*DPKCS036
327933 1230-CLOSE-SCAC-CUR.                                             DPKCS036
327934                                                                  DPKCS036
327935     EXEC SQL                                                     DPKCS036
327936          CLOSE SCAC_CUR                                          DPKCS036
327937     END-EXEC.                                                    DPKCS036
327938*                                                                 DPKCS036
327939     EVALUATE TRUE                                                DPKCS036
327940         WHEN SQLCODE = ZERO                                      DPKCS036
327941             CONTINUE                                             DPKCS036
327942         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
327943         WHEN SQLCODE < ZERO                                      DPKCS036
327944         WHEN SQLCODE > ZERO                                      DPKCS036
327945             MOVE '1220-CLOSE-SCAC-CUR'                           DPKCS036
327946                               TO DP013-PARAGRAPH                 DPKCS036
327947             MOVE 'CLOSE SCAC CURSOR '                            DPKCS036
327948                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
327949             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
327950             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
327951             SET DP013-DB2-ABEND                                  DPKCS036
327952                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
327953             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
327954     END-EVALUATE.                                                DPKCS036
327955                                                                  DPKCS036
327956 EJECT                                                            DPKCS036
327957*----------------------------------------------------------------*DPKCS036
327958* CREATE WORKING TABLE OF UNIUE DECONSOLIDATOR SCAC CODES        *DPKCS036
327959*----------------------------------------------------------------*DPKCS036
327960 1300-ADD-CONTR-COUNTS-TO-SCAC.                                   DPKCS036
327961                                                                          
327962     PERFORM 1310-OPEN-RULE-CUR.                                  DPKCS036
327963                                                                          
327964     PERFORM 1320-PROCESS-RULE-CUR                                DPKCS036
327965       UNTIL PS-END-OF-RULE-CUR.                                          
327966                                                                          
327967     PERFORM 1330-CLOSE-RULE-CUR.                                 DPKCS036
327968                                                                          
327969*----------------------------------------------------------------*DPKCS036
327970*   OPEN THE RULE DETAIL CURSOR                                   DPKCS036
327971*---------------------------------------------------------------- DPKCS036
327972 1310-OPEN-RULE-CUR.                                              DPKCS036
327973     EXEC SQL                                                     DPKCS036
327974          OPEN RULE_CUR                                           DPKCS036
327975     END-EXEC                                                     DPKCS036
327976                                                                  DPKCS036
327977     EVALUATE TRUE                                                DPKCS036
327978         WHEN SQLCODE = ZERO                                      DPKCS036
327979         WHEN SQLCODE = -904                                      DPKCS036
327980         WHEN SQLCODE = -913                                      DPKCS036
327981            CONTINUE                                              DPKCS036
327982         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
327983         WHEN SQLCODE < ZERO                                      DPKCS036
327984         WHEN SQLCODE > ZERO                                      DPKCS036
327985             MOVE '1310-OPEN-RULE-CUR'                            DPKCS036
327986                               TO DP013-PARAGRAPH                 DPKCS036
327987             MOVE 'OPEN SCAC CORSOR - '                           DPKCS036
327988                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
327989             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
327990             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
327991             SET DP013-DB2-ABEND                                  DPKCS036
327992                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
327993             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
327994     END-EVALUATE.                                                        
327995                                                                          
327996 EJECT                                                            DPKCS036
327997*----------------------------------------------------------------*DPKCS036
327998* FETCH THE RULE CURSOR                                           DPKCS036
327999*----------------------------------------------------------------*DPKCS036
328000 1320-PROCESS-RULE-CUR.                                           DPKCS036
328100                                                                          
328200     PERFORM 1321-FETCH-RULE-CUR.                                         
328300                                                                          
328400     IF PS-END-OF-RULE-CUR-NO                                             
328500                                                                          
328600*       DETERMIN CONTAINER ID AND SEQ OR ETA AND GET PO COUNTS            
328700        PERFORM 1322-SELECT-CONT-SEQ-NBR                                  
328800        IF PV-CONTAINER-SEQ EQUAL TO SPACES                               
328900           PERFORM 1323-SELECT-ETA-VAL                                    
329000           MOVE 'ETA'            TO PV-SEQ-OR-ETA                         
329100           MOVE PV-CONTAINER-ETA TO PV-SEQ-OR-ETA-VAL                     
329200           MOVE ZEROES           TO PV-PO-COUNT                           
329300           MOVE ZEROES           TO IMCNPO-PO-CART-CNT                    
329400           MOVE ZEROES           TO IMCNPO-PO-CBMT-QTY                    
329500        ELSE                                                              
329600           MOVE 'SEQ'            TO PV-SEQ-OR-ETA                         
329700           MOVE PV-CONTAINER-SEQ TO PV-SEQ-OR-ETA-VAL                     
329800           PERFORM 1324-SELECT-PO-DATA-CMN                                
329900        END-IF                                                            
330000        PERFORM 1325-SELECT-PO-DATA-CON                                   
330100                                                                          
330200*       PROCESS DEFAULT RULE                                              
330300        MOVE 'DEF' TO PV-RUL-TYPE                                         
330400        PERFORM 1326-CHECK-FOR-CONTAINER-RULE                             
330500        MOVE PV-DCNSL-SCAC TO PV-DEF-SCAC                                 
330600                                                                          
330700*       PROCESS ADJUSTED RULE                                             
330800        MOVE 'ADJ' TO PV-RUL-TYPE                                         
330900        PERFORM 1326-CHECK-FOR-CONTAINER-RULE                             
331000        IF PV-DCNSL-SCAC EQUAL SPACES                                     
331100           PERFORM 1327-SELECT-VESSEL-VOYAGE                              
331200           PERFORM 1328-CHECK-FOR-VESSEL-RULE                             
331400        END-IF                                                            
331500        IF PV-DCNSL-SCAC EQUAL SPACES                                     
331600           MOVE PV-DEF-SCAC   TO PV-ADJ-SCAC                              
331700        ELSE                                                              
331800           MOVE PV-DCNSL-SCAC TO PV-ADJ-SCAC                              
331900        END-IF                                                            
332000                                                                          
332100*       PROCESS WORKING RULE                                              
332200        MOVE 'WKG' TO PV-RUL-TYPE                                         
332300        PERFORM 1326-CHECK-FOR-CONTAINER-RULE                             
332400        IF PV-DCNSL-SCAC EQUAL SPACES                                     
332500           PERFORM 1327-SELECT-VESSEL-VOYAGE                              
332600           PERFORM 1328-CHECK-FOR-VESSEL-RULE                             
332700           CONTINUE                                                       
332800        END-IF                                                            
332900        IF PV-DCNSL-SCAC EQUAL SPACES                                     
333000           MOVE PV-ADJ-SCAC   TO PV-WKG-SCAC                              
333100        ELSE                                                              
333200           MOVE PV-DCNSL-SCAC TO PV-WKG-SCAC                              
333300        END-IF                                                            
333400                                                                          
333500*       ADD COUNTS TO SCAC                                                
333600        PERFORM 1329-ADD-RULE-TO-SCAC                                     
333700                                                                          
333800     END-IF.                                                              
333801                                                                          
333802*----------------------------------------------------------------*DPKCS036
333803* FETCH THE RULE CURSOR                                           DPKCS036
333804*----------------------------------------------------------------*DPKCS036
333805 1321-FETCH-RULE-CUR.                                             DPKCS036
333806                                                                  DPKCS036
333807     EXEC SQL                                                     DPKCS036
333808          FETCH RULE_CUR                                          DPKCS036
333809          INTO :TRT00015-RUL-ID                                   DPKCS036
333810     END-EXEC.                                                    DPKCS036
333811                                                                  DPKCS036
333812     EVALUATE TRUE                                                DPKCS036
333813         WHEN SQLCODE = ZERO                                      DPKCS036
333814              CONTINUE                                                    
333815         WHEN SQLCODE = +100                                      DPKCS036
333816              SET PS-END-OF-RULE-CUR TO TRUE                      DPKCS036
333817         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
333818         WHEN SQLCODE NOT = ZERO                                  DPKCS036
333819              MOVE '1321-FETCH-RULE-CUR'                          DPKCS036
333820                               TO DP013-PARAGRAPH                 DPKCS036
333821              MOVE 'FETCH RULE CURSOR'                            DPKCS036
333822                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
333823              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
333824              SET DP013-DB2-ABEND                                 DPKCS036
333825                               TO TRUE                            DPKCS036
333826              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
333827     END-EVALUATE.                                                DPKCS036
333828                                                                  DPKCS036
333829 EJECT                                                            DPKCS036
333830*----------------------------------------------------------------*DPKCS036
333831* SELECT A COUNT OF PO OVERRIDES                                  DPKCS036
333832*----------------------------------------------------------------*DPKCS036
333833 1322-SELECT-CONT-SEQ-NBR.                                        DPKCS036
333834                                                                          
333835     INITIALIZE PV-CONTAINER-ID                                           
333836                PV-CONTAINER-SEQ                                          
333837                PV-NULL-SEQ.                                              
333838                                                                          
333839     EXEC SQL                                                     DPKCS036
333840        SELECT A.RUL_CNSTR_VAL_TXT                                        
333850              ,B.RUL_CNSTR_VAL_TXT                                        
333860        INTO   :PV-CONTAINER-ID                                           
333870              ,:PV-CONTAINER-SEQ:PV-NULL-SEQ                              
333880        FROM   TRT_RUL_CNSTR A                                            
333890                  LEFT JOIN                                               
333900               TRT_RUL_CNSTR B                                            
334000                  ON A.RUL_ID = B.RUL_ID                                  
334100                 AND B.RUL_CNSTR_TYP_CDE = 'SEQ'                          
334200        WHERE A.RUL_ID = :TRT00015-RUL-ID                                 
334201          AND A.RUL_CNSTR_TYP_CDE = 'CONT'                                
334202     END-EXEC.                                                    DPKCS036
334203                                                                  DPKCS036
334204     EVALUATE TRUE                                                DPKCS036
334205         WHEN SQLCODE = ZERO                                      DPKCS036
334206         WHEN SQLCODE = -811                                      DPKCS036
883010              IF PV-NULL-SEQ = 0                                          
883011                CONTINUE                                                  
883012              ELSE                                                        
883013                MOVE SPACES TO PV-CONTAINER-SEQ                           
883014              END-IF                                                      
883015         WHEN SQLCODE = +100                                      DPKCS036
883016              MOVE SPACES TO PV-CONTAINER-ID                              
883017              MOVE SPACES TO PV-CONTAINER-SEQ                             
883018         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
883019         WHEN SQLCODE NOT = ZERO                                  DPKCS036
883020              MOVE '1322-SELECT-CONT-SEQ-ETA'                     DPKCS036
883021                               TO DP013-PARAGRAPH                 DPKCS036
883022              MOVE 'SQL ERROR SELECTING CONTAINER'                DPKCS036
883023                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
883024              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
883025              SET DP013-DB2-ABEND                                 DPKCS036
883026                               TO TRUE                            DPKCS036
883027              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
883028     END-EVALUATE.                                                DPKCS036
883029                                                                  DPKCS036
883030 EJECT                                                            DPKCS036
883031*----------------------------------------------------------------*DPKCS036
883032* SELECT A ETA FOR CONTAINER                                      DPKCS036
883033*----------------------------------------------------------------*DPKCS036
883034 1323-SELECT-ETA-VAL.                                             DPKCS036
883035                                                                          
883036     INITIALIZE PV-CONTAINER-ETA                                          
883037                PV-NULL-ETA.                                              
883038                                                                          
883039     EXEC SQL                                                     DPKCS036
883040        SELECT A.RUL_CNSTR_VAL_TXT                                        
883050        INTO  :PV-CONTAINER-ETA:PV-NULL-SEQ                               
883060        FROM   TRT_RUL_CNSTR A                                            
883070        WHERE A.RUL_ID = :TRT00015-RUL-ID                                 
883071          AND A.RUL_CNSTR_TYP_CDE = 'ETA'                                 
883072     END-EXEC.                                                    DPKCS036
883073                                                                  DPKCS036
883074     EVALUATE TRUE                                                DPKCS036
883075         WHEN SQLCODE = ZERO                                      DPKCS036
883076         WHEN SQLCODE = -811                                      DPKCS036
883077              IF PV-NULL-ETA = 0                                          
883078                CONTINUE                                                  
883079              ELSE                                                        
883080                MOVE SPACES TO PV-CONTAINER-ETA                           
883081              END-IF                                                      
883082         WHEN SQLCODE = +100                                      DPKCS036
883083              MOVE SPACES TO PV-CONTAINER-ETA                             
883084         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
883085         WHEN SQLCODE NOT = ZERO                                  DPKCS036
883086              MOVE '1323-SELECT-ETA-VAL'                          DPKCS036
883087                               TO DP013-PARAGRAPH                 DPKCS036
883088              MOVE 'SQL ERROR SELECTING ETA'                      DPKCS036
883089                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
883090              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
883091              SET DP013-DB2-ABEND                                 DPKCS036
883092                               TO TRUE                            DPKCS036
883093              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
883094     END-EVALUATE.                                                DPKCS036
883095                                                                  DPKCS036
883096 EJECT                                                            DPKCS036
883097*----------------------------------------------------------------*DPKCS036
883098* COUNT PO NUMBERS FOR CONTAINER AND SEQ NUMBER                   DPKCS036
883099*----------------------------------------------------------------*DPKCS036
883100 1324-SELECT-PO-DATA-CMN.                                         DPKCS036
883200                                                                          
883300     INITIALIZE PV-NULL-CART                                              
883400                PV-NULL-CBMT                                              
883500                PV-PO-COUNT                                               
883600                IMCNPO-PO-CART-CNT                                        
883700                IMCNPO-PO-CBMT-QTY.                                       
883800                                                                          
883900     MOVE PV-CONTAINER-ID       TO IMCNPO-CONTNR-ID.                      
884000     MOVE 30                    TO PV-TRIM-SPACE.                         
884100     PERFORM VARYING PV-COUNTER FROM 1 BY 1                               
884200       UNTIL PV-CONTAINER-SEQ(PV-TRIM-SPACE:1) IS NUMERIC                 
884300         SUBTRACT 1 FROM PV-TRIM-SPACE                                    
884400     END-PERFORM                                                          
884500     MOVE PV-CONTAINER-SEQ(1:PV-TRIM-SPACE)                               
884501                                TO IMCNPO-CONTNR-SEQ-NBR.                 
884502                                                                  DPKCS036
884503     EXEC SQL                                                     DPKCS036
884504        SELECT COUNT(DISTINCT PO.PO_NBR)                                  
884505              ,SUM(PO.PO_CART_CNT)                                        
884506              ,SUM(PO.PO_CBMT_QTY)                                        
884507        INTO :PV-PO-COUNT                                                 
884508            ,:IMCNPO-PO-CART-CNT:PV-NULL-CART                             
884509            ,:IMCNPO-PO-CBMT-QTY:PV-NULL-CBMT                             
884510        FROM TIMCNPO PO                                                   
884520        WHERE CONTNR_ID      = :IMCNPO-CONTNR-ID                          
884530          AND CONTNR_SEQ_NBR = :IMCNPO-CONTNR-SEQ-NBR                     
884540          AND PO.PO_NBR NOT IN                                            
884550                   (SELECT INT(RUL.RUL_CNSTR_VAL_TXT)                     
884560                    FROM TRT_RUL_CNSTR RUL                                
884570                    WHERE RUL.RUL_CNSTR_TYP_CDE = 'CONPO'                 
884571                      AND RUL.RUL_ID = :TRT00015-RUL-ID)                  
884572     END-EXEC.                                                    DPKCS036
884573                                                                  DPKCS036
884574     EVALUATE TRUE                                                DPKCS036
884575         WHEN SQLCODE = ZERO                                      DPKCS036
884576         WHEN SQLCODE = -811                                      DPKCS036
884577              CONTINUE                                            DPKCS036
884578         WHEN SQLCODE = +100                                      DPKCS036
884579              MOVE ZEROES TO PV-PO-COUNT                          DPKCS036
884580              MOVE ZEROES TO IMCNPO-PO-CART-CNT                   DPKCS036
884581              MOVE ZEROES TO IMCNPO-PO-CBMT-QTY                   DPKCS036
884582         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
884583         WHEN SQLCODE NOT = ZERO                                  DPKCS036
884584              MOVE '1324-SELECT-PO-DATA-CMN'                      DPKCS036
884585                               TO DP013-PARAGRAPH                 DPKCS036
884586              MOVE 'SQL ERROR SELECTING PO COUNT'                 DPKCS036
884587                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
884588              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
884589              SET DP013-DB2-ABEND                                 DPKCS036
884590                               TO TRUE                            DPKCS036
884591              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
884592     END-EVALUATE.                                                DPKCS036
884593                                                                  DPKCS036
884594 EJECT                                                            DPKCS036
884595*----------------------------------------------------------------*DPKCS036
884596* SELECT A COUNT OF PO OVERRIDES                                  DPKCS036
884597*----------------------------------------------------------------*DPKCS036
884598 1325-SELECT-PO-DATA-CON.                                         DPKCS036
884599                                                                          
884600     EXEC SQL                                                     DPKCS036
884700        SELECT COUNT(RUL_CNSTR_VAL_TXT)                                   
884800        INTO  :PV-CON-PO-COUNT                                            
884900        FROM   TRT_RUL_CNSTR                                              
885000        WHERE  RUL_ID = :TRT00015-RUL-ID                                  
885001          AND  RUL_CNSTR_TYP_CDE = 'CONPO'                                
885002     END-EXEC.                                                    DPKCS036
885003                                                                  DPKCS036
885004     EVALUATE TRUE                                                DPKCS036
885005         WHEN SQLCODE = ZERO                                      DPKCS036
885006         WHEN SQLCODE = -811                                      DPKCS036
885007              ADD PV-CON-PO-COUNT TO PV-PO-COUNT                  DPKCS036
885008         WHEN SQLCODE = +100                                      DPKCS036
885009              MOVE ZEROES TO PV-CON-PO-COUNT                              
885010         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
885011         WHEN SQLCODE NOT = ZERO                                  DPKCS036
885012              MOVE '1325-SELECT-PO-DATA-CON'                      DPKCS036
885013                               TO DP013-PARAGRAPH                 DPKCS036
885014              MOVE 'SQL ERROR SELECTING RULE'                     DPKCS036
885015                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
885016              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
885017              SET DP013-DB2-ABEND                                 DPKCS036
885018                               TO TRUE                            DPKCS036
885019              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
885020     END-EVALUATE.                                                DPKCS036
885021                                                                  DPKCS036
885022 EJECT                                                            DPKCS036
885023*----------------------------------------------------------------*DPKCS036
885024* COUNT PO NUMBERS FOR CONTAINER AND SEQ NUMBER                   DPKCS036
885025*----------------------------------------------------------------*DPKCS036
885026 1326-CHECK-FOR-CONTAINER-RULE.                                   DPKCS036
885027                                                                          
885028     EXEC SQL                                                     DPKCS036
885030        SELECT A.RUL_ID,                                                  
885031               A.RUL_CNSTR_VAL_TXT                                        
885032        INTO   :PV-RUL-ID                                                 
885033              ,:PV-DCNSL-SCAC                                             
885040        FROM   TRT_RUL_CNSTR A                                            
885050              ,TRT_RUL_CNSTR B                                            
885060              ,TRT_RUL_CNSTR C                                            
885070              ,TRT_RUL_CNSTR D                                            
885080              ,TRT_RUL       E                                            
885090        WHERE  A.RUL_ID            = B.RUL_ID                             
885100          AND  A.RUL_ID            = C.RUL_ID                             
885200          AND  A.RUL_ID            = D.RUL_ID                             
885300          AND  A.RUL_ID            = E.RUL_ID                             
885400          AND  A.RUL_CNSTR_TYP_CDE = 'DECN'                               
885500          AND  B.RUL_CNSTR_TYP_CDE = 'CONT'                               
885600          AND  B.RUL_CNSTR_VAL_TXT = :PV-CONTAINER-ID                     
885700          AND  C.RUL_CNSTR_TYP_CDE = :PV-SEQ-OR-ETA                       
885800          AND  C.RUL_CNSTR_VAL_TXT = :PV-SEQ-OR-ETA-VAL                   
885900          AND  D.RUL_CNSTR_TYP_CDE = 'POE'                                
886000          AND  D.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                         
886100          AND  E.RUL_CDE           = 'CONT'                               
886200          AND  E.RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE                   
886300          AND  E.RUL_END_DTE       = :ASC-WEEK-TO-DTE                     
886301          AND  E.RUL_TYP_CDE       = :PV-RUL-TYPE                         
               FETCH FIRST ROW ONLY                                             
886302     END-EXEC.                                                    DPKCS036
886303                                                                  DPKCS036
886304     EVALUATE TRUE                                                DPKCS036
886305         WHEN SQLCODE = ZERO                                      DPKCS036
886307              CONTINUE                                            DPKCS036
886308         WHEN SQLCODE = +100                                      DPKCS036
886309              MOVE SPACES TO PV-DCNSL-SCAC                                
886310              MOVE ZEROES TO PV-RUL-ID                                    
886311         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
886312         WHEN SQLCODE NOT = ZERO                                  DPKCS036
886313              MOVE '1326-CHECK-FOR-CONTAINER-RULE'                DPKCS036
886314                               TO DP013-PARAGRAPH                 DPKCS036
886315              MOVE 'SQL ERROR SELECTING RULE'                     DPKCS036
886316                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
886317              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
886318              SET DP013-DB2-ABEND                                 DPKCS036
886319                               TO TRUE                            DPKCS036
886320              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
886321     END-EVALUATE.                                                DPKCS036
886322                                                                  DPKCS036
886323 EJECT                                                            DPKCS036
886324*----------------------------------------------------------------*DPKCS036
886325* SELCT VESSEL RULES WHEN NO CONTAINER RULE                       DPKCS036
886326*----------------------------------------------------------------*DPKCS036
886327 1327-SELECT-VESSEL-VOYAGE.                                       DPKCS036
886328                                                                          
886329     EXEC SQL                                                     DPKCS036
886330        SELECT A.RUL_CNSTR_VAL_TXT                                        
886340        INTO   :PV-CNT-VESSEL                                             
886360        FROM   TRT_RUL_CNSTR A                                            
886380        WHERE  A.RUL_ID            = :TRT00015-RUL-ID                     
886400          AND  A.RUL_CNSTR_TYP_CDE = 'VSL'                                
              FETCH FIRST ROW ONLY                                              
886402     END-EXEC.                                                    DPKCS036
886403                                                                  DPKCS036
886404     EVALUATE TRUE                                                DPKCS036
886405         WHEN SQLCODE = ZERO                                      DPKCS036
886407              CONTINUE                                            DPKCS036
886408         WHEN SQLCODE = +100                                      DPKCS036
886409              MOVE SPACES TO PV-DCNSL-SCAC                                
886410         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
886411         WHEN SQLCODE NOT = ZERO                                  DPKCS036
886412              MOVE '1327-SELECT-VESSEL-VOYAGE'                    DPKCS036
886413                               TO DP013-PARAGRAPH                 DPKCS036
886414              MOVE 'SQL ERROR SELECTING RULE'                     DPKCS036
886415                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
886416              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
886417              SET DP013-DB2-ABEND                                 DPKCS036
886418                               TO TRUE                            DPKCS036
886419              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
886420     END-EVALUATE.                                                DPKCS036
886421                                                                  DPKCS036
886422 EJECT                                                            DPKCS036
886423*----------------------------------------------------------------*DPKCS036
886424* SELECT SCAC FOR VESSEL RULE IF NO CONTAINER RULE                DPKCS036
886425*----------------------------------------------------------------*DPKCS036
886426 1328-CHECK-FOR-VESSEL-RULE.                                      DPKCS036
886427                                                                          
886428     EXEC SQL                                                     DPKCS036
886430        SELECT A.RUL_ID                                                   
886431              ,A.RUL_CNSTR_VAL_TXT                                        
886432        INTO   :PV-RUL-ID                                                 
886433              ,:PV-DCNSL-SCAC                                             
886440        FROM   TRT_RUL_CNSTR A                                            
886450              ,TRT_RUL_CNSTR B                                            
886460**            ,TRT_RUL_CNSTR C                                            
886470              ,TRT_RUL_CNSTR D                                            
886480              ,TRT_RUL       E                                            
886490        WHERE  A.RUL_ID            = B.RUL_ID                             
886500**        AND  A.RUL_ID            = C.RUL_ID                             
886600          AND  A.RUL_ID            = D.RUL_ID                             
886700          AND  A.RUL_ID            = E.RUL_ID                             
886800          AND  A.RUL_CNSTR_TYP_CDE = 'DECN'                               
886900          AND  B.RUL_CNSTR_TYP_CDE = 'VSL'                                
887000          AND  B.RUL_CNSTR_VAL_TXT = :PV-CNT-VESSEL                       
887100**        AND  C.RUL_CNSTR_TYP_CDE = 'VOY'                                
887200**        AND  C.RUL_CNSTR_VAL_TXT = :PV-CNT-VOYAGE                       
887300          AND  D.RUL_CNSTR_TYP_CDE = 'POE'                                
887400          AND  D.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                         
887500          AND  E.RUL_CDE           = 'VSL'                                
887600          AND  E.RUL_BEG_DTE       = :ASC-WEEK-FROM-DTE                   
887700          AND  E.RUL_END_DTE       = :ASC-WEEK-TO-DTE                     
887701          AND  E.RUL_TYP_CDE       = :PV-RUL-TYPE                         
              FETCH FIRST ROW ONLY                                              
887702     END-EXEC.                                                    DPKCS036
887703                                                                  DPKCS036
887704     EVALUATE TRUE                                                DPKCS036
887705         WHEN SQLCODE = ZERO                                      DPKCS036
887707              CONTINUE                                            DPKCS036
887708         WHEN SQLCODE = +100                                      DPKCS036
887709              MOVE SPACES TO PV-DCNSL-SCAC                                
887710              MOVE ZEROES TO PV-RUL-ID                                    
887711         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
887712         WHEN SQLCODE NOT = ZERO                                  DPKCS036
887713              MOVE '1328-CHECK-FOR-VESSEL-RULE'                   DPKCS036
887714                               TO DP013-PARAGRAPH                 DPKCS036
887715              MOVE 'SQL ERROR SELECTING RULE'                     DPKCS036
887716                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
887717              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
887718              SET DP013-DB2-ABEND                                 DPKCS036
887719                               TO TRUE                            DPKCS036
887720              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
887721     END-EVALUATE.                                                DPKCS036
887722                                                                  DPKCS036
887723 EJECT                                                            DPKCS036
887724*----------------------------------------------------------------*DPKCS036
887725*   ADD RULE TO SCAC                                             *DPKCS036
887726*----------------------------------------------------------------*DPKCS036
887727 1329-ADD-RULE-TO-SCAC.                                           DPKCS036
887728                                                                  DPKCS036
887729     PERFORM WITH TEST AFTER                                              
887730     VARYING SCAC-IDX FROM 1 BY 1                                         
887731     UNTIL SCAC-IDX > PV-TABLE-STORE-COUNT                                
887740                                                                          
887750        EVALUATE TRUE                                                     
887760           WHEN DECNSL-SCAC(SCAC-IDX) = PV-DEF-SCAC                       
887770            AND VIEW(SCAC-IDX)        = PC-DEFAULT                        
887780               ADD +1                 TO CNTR-CNT(SCAC-IDX)               
887790               ADD PV-PO-COUNT        TO PO-CNT(SCAC-IDX)                 
887800               ADD IMCNPO-PO-CART-CNT TO CART-CNT(SCAC-IDX)               
887900               ADD IMCNPO-PO-CBMT-QTY TO CBM-QTY(SCAC-IDX)                
888000                                                                          
888100           WHEN DECNSL-SCAC(SCAC-IDX) = PV-ADJ-SCAC                       
888200            AND VIEW(SCAC-IDX)        = PC-ADJUSTED                       
888300               ADD +1                 TO CNTR-CNT(SCAC-IDX)               
888400               ADD PV-PO-COUNT        TO PO-CNT(SCAC-IDX)                 
888500               ADD IMCNPO-PO-CART-CNT TO CART-CNT(SCAC-IDX)               
888600               ADD IMCNPO-PO-CBMT-QTY TO CBM-QTY(SCAC-IDX)                
888700                                                                          
888800           WHEN DECNSL-SCAC(SCAC-IDX) = PV-WKG-SCAC                       
888900            AND VIEW(SCAC-IDX)        = PC-WORKING                        
889000               ADD +1                 TO CNTR-CNT(SCAC-IDX)               
889100               ADD PV-PO-COUNT        TO PO-CNT(SCAC-IDX)                 
889200               ADD IMCNPO-PO-CART-CNT TO CART-CNT(SCAC-IDX)               
889300               ADD IMCNPO-PO-CBMT-QTY TO CBM-QTY(SCAC-IDX)                
889400                                                                          
889500        END-EVALUATE                                                      
889600                                                                          
889700     END-PERFORM.                                                         
889701                                                                          
889702*----------------------------------------------------------------*DPKCS036
889703*   CLOSE THE RULE CUROSR                                         DPKCS036
889704*----------------------------------------------------------------*DPKCS036
889705 1330-CLOSE-RULE-CUR.                                             DPKCS036
889706                                                                  DPKCS036
889707     EXEC SQL                                                     DPKCS036
889708          CLOSE RULE_CUR                                          DPKCS036
889709     END-EXEC.                                                    DPKCS036
889710*                                                                 DPKCS036
889711     EVALUATE TRUE                                                DPKCS036
889712         WHEN SQLCODE = ZERO                                      DPKCS036
889713             CONTINUE                                             DPKCS036
889714         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
889715         WHEN SQLCODE < ZERO                                      DPKCS036
889716         WHEN SQLCODE > ZERO                                      DPKCS036
889717             MOVE '1330-CLOSE-RULE-CUR'                           DPKCS036
889718                               TO DP013-PARAGRAPH                 DPKCS036
889719             MOVE 'CLOSE RULE CURSOR '                            DPKCS036
889720                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
889721             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
889722             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
889723             SET DP013-DB2-ABEND                                  DPKCS036
889724                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
889725             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
889726     END-EVALUATE.                                                DPKCS036
889727                                                                  DPKCS036
889728 EJECT                                                            DPKCS036
889729*----------------------------------------------------------------*DPKCS036
889730* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *DPKCS036
889731* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *DPKCS036
889732* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *DPKCS036
889733* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *DPKCS036
889734* FUNCTION KEYS CAN GET THIS FAR.                                *DPKCS036
889735*----------------------------------------------------------------*DPKCS036
889736 2000-PROCESS-PANEL.                                              DPKCS036
889737                                                                  DPKCS036
889738     EVALUATE TRUE                                                DPKCS036
889739         WHEN DP020-SRC-AID = DP016-CLEAR                         DPKCS036
889740             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
889741             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
889742             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
889743                                                                  DPKCS036
889744         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    DPKCS036
889748             PERFORM 2050-DELETE-LIST-QUEUE                       DPKCS036
889749             PERFORM 1200-BUILD-DCNSLR-SCAC-TABLE                         
889750             PERFORM 1300-ADD-CONTR-COUNTS-TO-SCAC                        
889751             PERFORM 4000-BUILD-INITIAL-PANEL                     DPKCS036
889752                                                                          
889753         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                            
889754            EVALUATE TRUE                                                 
889755               WHEN ASC-PERFORM-FINALIZE                                  
889756                  PERFORM 6000-OPEN-FINLUPD-CUR                   DPKCS036
889757                  PERFORM 6200-PROCESS-FINLUPD-CUR                DPKCS036
889758                    UNTIL PS-END-OF-FINLUPD-CUR                           
889759                  PERFORM 6300-CLOSE-FINLUPD-CUR                  DPKCS036
889760                  MOVE PC-TSYMSG-00034        TO DP020-MSG-NUMBER DPKCS036
889770                  SET DP020-MSG-INFORMATIONAL TO TRUE             DPKCS036
889780                                                                          
889790               WHEN ASC-PERFORM-DELETE                                    
889800                  MOVE 'DEL' TO TRT00017-AUD-FUNC-CDE                     
889900                  PERFORM 7000-AUDIT-ALL-WKG-RULES                        
890000                  PERFORM 7100-AUDIT-ALL-WKG-CNSTRS                       
890100                  PERFORM 7200-DELETE-ALL-WKG-RULES                       
890200                  MOVE PC-TSYMSG-00034        TO DP020-MSG-NUMBER DPKCS036
890300                  SET DP020-MSG-INFORMATIONAL TO TRUE             DPKCS036
890400                                                                          
890401            END-EVALUATE                                                  
890402                                                                  DPKCS036
890403         WHEN OTHER                                               DPKCS036
890404             SET ASC-PERFORM-FINALIZE-NO                                  
890405                 ASC-PERFORM-DELETE-NO   TO TRUE                          
890406             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
890407             IF  PS-NO-ERROR                                      DPKCS036
890408                 SET DP030-CONTINUE-GO   TO TRUE                  DPKCS036
890409                 PERFORM 2100-CHECK-FUNCTION-KEY                  DPKCS036
890410             ELSE                                                 DPKCS036
890411                 SET DP030-OVERRIDE-GO   TO TRUE                  DPKCS036
890412             END-IF                                               DPKCS036
890413     END-EVALUATE.                                                DPKCS036
890414                                                                  DPKCS036
890415 EJECT                                                            DPKCS036
890416*----------------------------------------------------------------*DPKCS036
890417*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *DPKCS036
890418*----------------------------------------------------------------*DPKCS036
890419 2050-DELETE-LIST-QUEUE.                                          DPKCS036
890420                                                                  DPKCS036
890421     EXEC CICS                                                    DPKCS036
890422         DELETEQ TS                                               DPKCS036
890423             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
890424             RESP  (PV-CICS-RESP)                                 DPKCS036
890425     END-EXEC.                                                    DPKCS036
890426                                                                  DPKCS036
890427     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       DPKCS036
890428        (PV-CICS-RESP = DFHRESP(QIDERR))                          DPKCS036
890429         CONTINUE                                                 DPKCS036
890430     ELSE                                                         DPKCS036
890431         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
890432         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
890433                                                                  DPKCS036
890434         MOVE '2050-DELETE-LIST-QUEUE'                            DPKCS036
890435                                   TO DP013-PARAGRAPH             DPKCS036
890436         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    DPKCS036
890437                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
890438         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
890439     END-IF.                                                      DPKCS036
890440                                                                  DPKCS036
890441     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  DPKCS036
890442                                                                  DPKCS036
890443 EJECT                                                            DPKCS036
890444*----------------------------------------------------------------*DPKCS036
890445* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*DPKCS036
890446* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *DPKCS036
890447* CICS ARCHITECTURE API.                                         *DPKCS036
890448*----------------------------------------------------------------*DPKCS036
890449 2100-CHECK-FUNCTION-KEY.                                         DPKCS036
890450                                                                  DPKCS036
890451     EVALUATE TRUE                                                DPKCS036
890452                                                                          
890453**NAVIGATE TO THE ERROR LIST SCREEN***                                    
890454         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              DPKCS036
890455             INITIALIZE TR320-INTER-APPL-COMMAREA                         
890456             MOVE ASC-POE-CDE       TO TR320-POE-CDE                      
890458             MOVE ASC-WEEK-FROM-DTE TO TR320-WEEK-FROM-DTE                
890459             MOVE ASC-WEEK-TO-DTE   TO TR320-WEEK-TO-DTE                  
890460                                                                          
890461         WHEN DP020-FK-LOCAL-FUNC-09 (DP020-SRC-AID)              DPKCS036
890462            PERFORM 2170-CHECK-RACF-ACCESS                                
890464            IF DP008-ACCESS-DENIED                                        
890465*              -- NO SECURITY CLEARANCE FOR FUNCTION --                   
890466                MOVE PC-TSYMSG-01061                                      
890467                                TO DP020-MSG-NUMBER                       
890468                SET PS-ERROR                                              
890469                    DP020-MSG-WARNING                                     
890470                    DP030-OVERRIDE-GO   TO TRUE                           
890471*                   DP020-NEXT-ACT-APPL-ERROR                             
890472*                           TO TRUE                                       
890473            ELSE                                                          
890474                PERFORM 8000-CHECK-FOR-WORKING-RULES                      
890480                IF PV-RUL-ID EQUAL ZERO                                   
890490                    MOVE PC-TSYMSG-03326   TO DP020-MSG-NUMBER            
890500                    SET DP020-MSG-INFORMATIONAL TO TRUE                   
890600                ELSE                                                      
890700                   MOVE PC-TSYMSG-00004    TO DP020-MSG-NUMBER            
890800                   SET DP020-MSG-INFORMATIONAL                            
890900                       ASC-PERFORM-DELETE  TO TRUE                        
890901                END-IF                                                    
890902            END-IF                                                        
890903                                                                          
890904         WHEN DP020-FK-LOCAL-FUNC-10 (DP020-SRC-AID)              DPKCS036
890905            PERFORM 2170-CHECK-RACF-ACCESS                                
890906            IF DP008-ACCESS-DENIED                                        
890907*              -- NO SECURITY CLEARANCE FOR FUNCTION --                   
890908                MOVE PC-TSYMSG-01061                                      
890909                                TO DP020-MSG-NUMBER                       
890910                SET PS-ERROR                                              
890911                    DP020-MSG-WARNING                                     
890912                    DP030-OVERRIDE-GO   TO TRUE                           
890913*                   DP020-NEXT-ACT-APPL-ERROR                             
890914*                           TO TRUE                                       
890915            ELSE                                                          
890916                PERFORM 8000-CHECK-FOR-WORKING-RULES                      
890917                IF PV-RUL-ID EQUAL ZERO                                   
890918                    MOVE PC-TSYMSG-03325   TO DP020-MSG-NUMBER            
890919                    SET DP020-MSG-INFORMATIONAL TO TRUE                   
890920                ELSE                                                      
890921                    MOVE PC-TSYMSG-00004   TO DP020-MSG-NUMBER            
890922                    SET DP020-MSG-INFORMATIONAL                           
890923                        ASC-PERFORM-FINALIZE    TO TRUE                   
890924                END-IF                                                    
890925            END-IF                                                        
890926                                                                          
890927         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  DPKCS036
890928             MOVE +1               TO PV-TOP-ITEM                 DPKCS036
890929             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
890930                                                                  DPKCS036
890931         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   DPKCS036
890932             PERFORM 2110-BROWSE-BACKWARD                         DPKCS036
890933             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
890934                                                                  DPKCS036
890935         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   DPKCS036
890936             PERFORM 2120-BROWSE-FORWARD                          DPKCS036
890937             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
890938                                                                  DPKCS036
890939         WHEN DP020-SRC-AID = DP016-ENTER                         DPKCS036
890940             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   DPKCS036
890941             IF  PS-ERROR                                         DPKCS036
890942                 CONTINUE                                         DPKCS036
890943             ELSE                                                 DPKCS036
890944                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             DPKCS036
890945             END-IF                                               DPKCS036
890946                                                                  DPKCS036
890947         WHEN OTHER                                               DPKCS036
890948             SET DP013-NO-ROLLBACK                                DPKCS036
890949                 DP013-XCTL-DISPLAY-RESTART                       DPKCS036
890950                 DP013-CICS-ABEND  TO TRUE                        DPKCS036
890951             MOVE '2100-CHECK-FUNCTION-KEY'                       DPKCS036
890952                                   TO DP013-PARAGRAPH             DPKCS036
890953             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      DPKCS036
890954                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
890955             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
890956     END-EVALUATE.                                                DPKCS036
890957                                                                  DPKCS036
890958 EJECT                                                            DPKCS036
890959*----------------------------------------------------------------*DPKCS036
890960*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *DPKCS036
890961*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *DPKCS036
890962*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *DPKCS036
890963*    MESSAGE.                                                    *DPKCS036
890964*----------------------------------------------------------------*DPKCS036
890965 2110-BROWSE-BACKWARD.                                            DPKCS036
890966                                                                  DPKCS036
890967     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
890968         GIVING PV-TOP-ITEM.                                      DPKCS036
890969*                                                                 DPKCS036
890970     IF  ((PV-TOP-ITEM < +1)                                      DPKCS036
890971       OR (PV-TOP-ITEM = +1))                                     DPKCS036
890972         MOVE +1                   TO PV-TOP-ITEM                 DPKCS036
890973*---------- TOP OF LIST -----                                     DPKCS036
890974         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            DPKCS036
890975         SET DP020-MSG-INFORMATIONAL TO TRUE                      DPKCS036
890976     END-IF.                                                      DPKCS036
890977                                                                  DPKCS036
890978 EJECT                                                            DPKCS036
890979*----------------------------------------------------------------*DPKCS036
890980*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *DPKCS036
890981*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *DPKCS036
890982*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *DPKCS036
890983*----------------------------------------------------------------*DPKCS036
890984 2120-BROWSE-FORWARD.                                             DPKCS036
890985                                                                  DPKCS036
890986     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              DPKCS036
890987         GIVING PV-TOP-ITEM.                                      DPKCS036
890988     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   DPKCS036
890989         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
890990                                   TO PV-TOP-ITEM                 DPKCS036
890991*---------- BOTTOM OF LIST --                                     DPKCS036
890992         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            DPKCS036
890993         SET DP020-MSG-INFORMATIONAL                              DPKCS036
890994                                   TO TRUE                        DPKCS036
890995     ELSE                                                         DPKCS036
890996         COMPUTE PV-BOTTOM-ITEM =                                 DPKCS036
890997             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 DPKCS036
890998         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            DPKCS036
890999*-------------- BOTTOM OF LIST --                                 DPKCS036
891000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            DPKCS036
891001             SET DP020-MSG-INFORMATIONAL                          DPKCS036
891002                                   TO TRUE                        DPKCS036
891003         END-IF                                                   DPKCS036
891004     END-IF.                                                      DPKCS036
891005                                                                  DPKCS036
891006 EJECT                                                            DPKCS036
891007*----------------------------------------------------------------*DPKCS036
891008*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *DPKCS036
891009*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *DPKCS036
891010*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *DPKCS036
891011*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *DPKCS036
891012*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *DPKCS036
891013*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *DPKCS036
891014*----------------------------------------------------------------*DPKCS036
891015 2130-CHECK-FOR-JUMP-BROWSE.                                      DPKCS036
891016                                                                  DPKCS036
891017     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
891018     IF (ASC-START-ITEM-REQUEST = SPACE)                          DPKCS036
891019         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
891020                                   TO PV-TOP-ITEM                 DPKCS036
891021     ELSE                                                         DPKCS036
891022         MOVE ASC-START-ITEM-REQUEST                              DPKCS036
891023                                   TO DP010I-UNEDITED-FIELD       DPKCS036
891024         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       DPKCS036
891025         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     DPKCS036
891026         SET DP010I-NEGATIVE-NOT-ALLOWED                          DPKCS036
891027                                   TO TRUE                        DPKCS036
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
891029                                                                  DPKCS036
891030         IF  NOT DP010I-ERROR-DETECTED                            DPKCS036
891031             MOVE DP010I-NUMERIC-FIELD                            DPKCS036
891032                                   TO  ASC-START-ITEM-REQUEST-N   DPKCS036
891033             IF  ASC-START-ITEM-REQUEST-N > ZERO                  DPKCS036
891034                 IF  ASC-START-ITEM-REQUEST-N >                   DPKCS036
891035                                          ASC-NUMBER-OF-ITEMS-READDPKCS036
891036                     MOVE SPACE TO ASC-START-ITEM-REQUEST         DPKCS036
891037                     COMPUTE PV-TOP-ITEM =                        DPKCS036
891038                             ASC-NUMBER-OF-ITEMS-READ             DPKCS036
891039                             - PC-ITEMS-PER-PANEL + 1             DPKCS036
891040                     IF  PV-TOP-ITEM < +1                         DPKCS036
891041                         MOVE +1   TO PV-TOP-ITEM                 DPKCS036
891042                         MOVE PC-TSYMSG-00070                     DPKCS036
891043                                   TO DP020-MSG-NUMBER            DPKCS036
891044                         SET DP020-MSG-INFORMATIONAL              DPKCS036
891045                                   TO TRUE                        DPKCS036
891046                     END-IF                                       DPKCS036
891047                 ELSE                                             DPKCS036
891048                     MOVE ASC-START-ITEM-REQUEST-N                DPKCS036
891049                                   TO PV-TOP-ITEM                 DPKCS036
891050                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      DPKCS036
891051                     COMPUTE PV-BOTTOM-ITEM =                     DPKCS036
891052                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     DPKCS036
891053                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READDPKCS036
891054*-------------------------- BOTTOM OF LIST --                     DPKCS036
891055                         MOVE PC-TSYMSG-00070                     DPKCS036
891056                                   TO DP020-MSG-NUMBER            DPKCS036
891057                         SET DP020-MSG-INFORMATIONAL              DPKCS036
891058                                   TO TRUE                        DPKCS036
891059                     END-IF                                       DPKCS036
891060                 END-IF                                           DPKCS036
891061             ELSE                                                 DPKCS036
891062*------------------- VALUE OUT OF RANGE ----                      DPKCS036
891063                 MOVE PC-TSYMSG-00101                             DPKCS036
891064                                   TO DP020-MSG-NUMBER            DPKCS036
891065                 MOVE -1           TO APOECDEL                    DPKCS036
891066                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
891067                                   TO TRUE                        DPKCS036
891068                 MOVE DP015-REVERSE                               DPKCS036
891069                                   TO APOECDEH                    DPKCS036
891070                 MOVE DP015-RED    TO APOECDEC                    DPKCS036
891071                 MOVE DP015-UNP-NUM-BRT-MDT                       DPKCS036
891072                                   TO APOECDEA                    DPKCS036
891073                 SET DP020-MSG-FATAL                              DPKCS036
891074                                   TO TRUE                        DPKCS036
891075                 SET PS-ERROR      TO TRUE                        DPKCS036
891076             END-IF                                               DPKCS036
891077                                                                  DPKCS036
891078         ELSE                                                     DPKCS036
891079             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            DPKCS036
891080             MOVE -1               TO APOECDEL                    DPKCS036
891081             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  DPKCS036
891082             MOVE DP015-REVERSE    TO APOECDEH                    DPKCS036
891083             MOVE DP015-RED        TO APOECDEC                    DPKCS036
891084             MOVE DP015-UNP-NUM-BRT-MDT                           DPKCS036
891085                                   TO APOECDEA                    DPKCS036
891086             SET DP020-MSG-FATAL   TO TRUE                        DPKCS036
891087             SET PS-ERROR          TO TRUE                        DPKCS036
891088         END-IF                                                   DPKCS036
891089     END-IF.                                                      DPKCS036
891090                                                                  DPKCS036
891091 EJECT                                                            DPKCS036
891092                                                                          
891093***************************************************************           
891094*  CHECK RACF FUNCTION GROUP                                              
891095***************************************************************           
891096                                                                          
891097 2170-CHECK-RACF-ACCESS.                                                  
891098     SET DP008-RSRC-TYPE-FUNC     TO TRUE                                 
891099     MOVE 'TRDCNUPF'              TO DP008-FUNCTION-NAME                  
891100     SET DP008-ACCESS-TYPE-USE    TO TRUE                                 
891101                                                                          
891102     EXEC CICS                                                            
891103        LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                          
891104             COMMAREA (DP008-SECURITY-COMMAREA)                           
891105             LENGTH (DP008-SECURITY-COMMAREA-LENGTH)                      
891106     END-EXEC                                                             
891107                                                                          
891108     IF DP008-CALL-SUCCESSFUL                                             
891109         CONTINUE                                                         
891110     ELSE                                                                 
891111        MOVE '2170-CHECK-RACF-ACCESS'                                     
891112                              TO DP013-PARAGRAPH                          
891113         MOVE 'UNABLE TO ACCESS CICS'                                     
891114                              TO DP013-MESSAGE-TEXT (1)                   
891115         MOVE SQLCA           TO DP013-SQLCA                              
891116         SET DP013-DB2-ABEND                                              
891117             DP013-XCTL-DISPLAY-RESTART                                   
891118                              TO TRUE                                     
891119         PERFORM DP013-0000-PROCESS-ABEND                                 
891120     END-IF.                                                              
891121                                                                          
891122 EJECT                                                                    
891123**--------------------------------------------------------------**DPKCS036
891124** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **DPKCS036
891125** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **DPKCS036
891126**--------------------------------------------------------------**DPKCS036
891127 3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
891128                                                                  DPKCS036
891129     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
891130     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     DPKCS036
891131**                                                                DPKCS036
891132* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              DPKCS036
891133* EDITTING IS DONE FROM THE BOTTOM UP.                            DPKCS036
891134**                                                                DPKCS036
891135     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
891136         ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
891137     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
891138 EJECT                                                            DPKCS036
891139*----------------------------------------------------------------*DPKCS036
891140*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *DPKCS036
891141*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*DPKCS036
891142*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *DPKCS036
891143*                                                                *DPKCS036
891144*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *DPKCS036
891145*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *DPKCS036
891146*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *DPKCS036
891147*    US IN THE 2ND BLOCK OF THE ARRAY.                           *DPKCS036
891148*----------------------------------------------------------------*DPKCS036
891149 3100-SET-SUBSCRIPTS.                                             DPKCS036
891150                                                                  DPKCS036
891151     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
891152         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        DPKCS036
891153                                                                  DPKCS036
891154     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         DPKCS036
891155         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
891156                                                                  DPKCS036
891157         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               DPKCS036
891158     ELSE                                                         DPKCS036
891159         MOVE +1                     TO ASC-BLK-SUB               DPKCS036
891160     END-IF.                                                      DPKCS036
891161                                                                  DPKCS036
891162 EJECT                                                            DPKCS036
891163*----------------------------------------------------------------*DPKCS036
891164*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *DPKCS036
891165*    INITIALIZE ALL COUNTERS AND FLAGS.                          *DPKCS036
891166*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *DPKCS036
891167*    DISPLAY THE PANEL TO USER.                                  *DPKCS036
891168*----------------------------------------------------------------*DPKCS036
891169 4000-BUILD-INITIAL-PANEL.                                        DPKCS036
891170                                                                  DPKCS036
891171     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            DPKCS036
891172                                 ASC-BLOCK-ENTRIES (2).           DPKCS036
891173     MOVE +1                      TO ASC-BLK-SUB.                 DPKCS036
891174                                                                  DPKCS036
891175     MOVE +0                 TO ASC-ITEM-SUB                      DPKCS036
891176                                ASC-NUMBER-OF-ITEMS-READ          DPKCS036
891177                                ASC-NUMBER-OF-SELECTED-ITEMS      DPKCS036
891178                                ASC-HIGHEST-BLOCK-WRITTEN         DPKCS036
891179                                ASC-START-OF-SELECTED-RANGE       DPKCS036
891180                                ASC-END-OF-SELECTED-RANGE         DPKCS036
891181                                ASC-ITEM-AT-TOP-OF-PANEL.         DPKCS036
891182                                                                  DPKCS036
891183     INITIALIZE ASC-TOT-CONT-COUNT                                        
891184                ASC-TOT-PO-COUNT                                          
891185                ASC-TOT-CART-COUNT                                        
891186                ASC-TOT-CBMT-COUNT.                                       
891187     SET ASC-ITEMS-LEFT-ON-TABLE  TO TRUE.                        DPKCS036
891188     PERFORM 4300-READ-DEFAULT-ROWS.                              DPKCS036
891189     SET ASC-ITEMS-LEFT-ON-TABLE  TO TRUE.                        DPKCS036
891190     PERFORM 4310-READ-WORKING-ROWS.                              DPKCS036
891191     SET ASC-ITEMS-LEFT-ON-TABLE  TO TRUE.                        DPKCS036
891192     PERFORM 4320-READ-ADJUSTED-ROWS.                             DPKCS036
891193                                                                  DPKCS036
891194                                                                  DPKCS036
891195     MOVE +1                   TO  PV-TOP-ITEM.                   DPKCS036
891196     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          DPKCS036
891197         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    DPKCS036
891198         SET DP020-MSG-FATAL   TO  TRUE                           DPKCS036
891199         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               DPKCS036
891200     ELSE                                                         DPKCS036
891201         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
891202                               TO TRUE                            DPKCS036
891203         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     DPKCS036
891204     END-IF.                                                      DPKCS036
891205                                                                  DPKCS036
891206 EJECT                                                            DPKCS036
891207*----------------------------------------------------------------*DPKCS036
891208* READ AND WRITE THE SCACS WITH A DEFAULT VIEW.                   DPKCS036
891209*----------------------------------------------------------------*DPKCS036
891210 4300-READ-DEFAULT-ROWS.                                          DPKCS036
891211                                                                  DPKCS036
891212     PERFORM WITH TEST AFTER                                              
891213     VARYING SCAC-IDX FROM 1 BY 1                                         
891214     UNTIL ASC-NO-ITEMS-LEFT-ON-TABLE                                     
891215                                                                          
891216         IF SCAC-IDX > PV-TABLE-STORE-COUNT                               
891217             SET ASC-NO-ITEMS-LEFT-ON-TABLE TO TRUE                       
891218         END-IF                                                           
891219                                                                  DPKCS036
891220         IF  ASC-ITEMS-LEFT-ON-TABLE                              DPKCS036
891221         AND VIEW(SCAC-IDX) = PC-DEFAULT                                  
891222             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
891223                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
891224             ELSE                                                 DPKCS036
891225                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
891226                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
891227                                                                  DPKCS036
891228                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
891229                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
891230                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
891231                                   TO TRUE                        DPKCS036
891232                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
891233                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
891234                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
891235                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
891236                     ADD +1          TO ASC-BLK-SUB               DPKCS036
891237                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
891238                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
891239                                     TO TRUE                      DPKCS036
891240                 END-IF                                           DPKCS036
891241             END-IF                                               DPKCS036
891242             ADD +1                  TO ASC-NUMBER-OF-ITEMS-READ  DPKCS036
891243             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
891244                                     TO ASC-LIST-ITEM-NUMBER      DPKCS036
891245                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891246                                                                          
891247             STRING ' ' DECNSL-SCAC(SCAC-IDX)                             
891248                 DELIMITED BY SIZE INTO ASC-DECNSL-SCAC                   
891249                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
891250                                                                          
891251             MOVE CNTR-CNT(SCAC-IDX) TO ASC-CNTR-CNT              DPKCS036
891252                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891253             ADD  CNTR-CNT(SCAC-IDX) TO ASC-TOT-CONT-COUNT                
891254                                                                          
891255             MOVE PO-CNT(SCAC-IDX)   TO ASC-PO-CNT                DPKCS036
891256                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891257             ADD  PO-CNT(SCAC-IDX)   TO ASC-TOT-PO-COUNT                  
891258                                                                          
891259             MOVE CART-CNT(SCAC-IDX) TO ASC-CART-CNT              DPKCS036
891260                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891261             ADD  CART-CNT(SCAC-IDX) TO ASC-TOT-CART-COUNT                
891262                                                                          
891263             MOVE CBM-QTY(SCAC-IDX)  TO ASC-CBM-QTY               DPKCS036
891264                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891265             ADD  CBM-QTY(SCAC-IDX)  TO ASC-TOT-CBMT-COUNT                
891266                                                                          
891267             IF PS-DISPLAY-VIEW                                           
891268                MOVE VIEW(SCAC-IDX)    TO ASC-VIEW                        
891269                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
891270                SET PS-DISPLAY-VIEW-NO TO TRUE                            
891271             ELSE                                                         
891272                MOVE SPACES            TO ASC-VIEW                        
891273                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
891274             END-IF                                                       
891275                                                                  DPKCS036
891276         END-IF                                                   DPKCS036
891277     END-PERFORM.                                                 DPKCS036
891278                                                                          
891279     IF ASC-NUMBER-OF-ITEMS-READ > 0                                      
891280        PERFORM 4330-WRITE-BLANK-LINE                                     
891281     END-IF.                                                              
891282                                                                  DPKCS036
891283 EJECT                                                            DPKCS036
891284*----------------------------------------------------------------*DPKCS036
891285* READ AND WRITE THE SCACS WITH A WORKING VIEW.                   DPKCS036
891286*----------------------------------------------------------------*DPKCS036
891287 4310-READ-WORKING-ROWS.                                          DPKCS036
891288                                                                  DPKCS036
891289     PERFORM WITH TEST AFTER                                              
891290     VARYING SCAC-IDX FROM 1 BY 1                                         
891291     UNTIL ASC-NO-ITEMS-LEFT-ON-TABLE                                     
891292                                                                          
891293         IF SCAC-IDX > PV-TABLE-STORE-COUNT                               
891294             SET ASC-NO-ITEMS-LEFT-ON-TABLE TO TRUE                       
891295         END-IF                                                           
891296                                                                  DPKCS036
891297         IF  ASC-ITEMS-LEFT-ON-TABLE                              DPKCS036
891298         AND VIEW(SCAC-IDX) = PC-WORKING                                  
891299             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
891300                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
891301             ELSE                                                 DPKCS036
891302                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
891303                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
891304                                                                  DPKCS036
891305                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
891306                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
891307                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
891308                                   TO TRUE                        DPKCS036
891309                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
891310                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
891311                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
891312                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
891313                     ADD +1          TO ASC-BLK-SUB               DPKCS036
891314                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
891315                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
891316                                     TO TRUE                      DPKCS036
891317                 END-IF                                           DPKCS036
891318             END-IF                                               DPKCS036
891319             ADD +1                  TO ASC-NUMBER-OF-ITEMS-READ  DPKCS036
891320             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
891321                                     TO ASC-LIST-ITEM-NUMBER      DPKCS036
891322                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891323                                                                          
891324             STRING ' ' DECNSL-SCAC(SCAC-IDX)                             
891325                 DELIMITED BY SIZE INTO ASC-DECNSL-SCAC                   
891326                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
891327                                                                          
891328             MOVE CNTR-CNT(SCAC-IDX) TO ASC-CNTR-CNT              DPKCS036
891329                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891330             MOVE PO-CNT(SCAC-IDX)   TO ASC-PO-CNT                DPKCS036
891331                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891332             MOVE CART-CNT(SCAC-IDX) TO ASC-CART-CNT              DPKCS036
891333                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891334             MOVE CBM-QTY(SCAC-IDX)  TO ASC-CBM-QTY               DPKCS036
891335                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891336             IF PS-DISPLAY-VIEW                                           
891337                MOVE VIEW(SCAC-IDX)    TO ASC-VIEW                        
891338                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
891339                SET PS-DISPLAY-VIEW-NO TO TRUE                            
891340             ELSE                                                         
891341                MOVE SPACES            TO ASC-VIEW                        
891342                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
891343             END-IF                                                       
891344                                                                  DPKCS036
891345         END-IF                                                   DPKCS036
891346     END-PERFORM.                                                 DPKCS036
891347                                                                          
891348     IF ASC-NUMBER-OF-ITEMS-READ > 0                                      
891349        PERFORM 4330-WRITE-BLANK-LINE                                     
891350     END-IF.                                                              
891351                                                                  DPKCS036
891352 EJECT                                                            DPKCS036
891353*----------------------------------------------------------------*DPKCS036
891354* READ AND WRITE THE SCACS WITH A ADJUSTED VIEW.                  DPKCS036
891355*----------------------------------------------------------------*DPKCS036
891356 4320-READ-ADJUSTED-ROWS.                                         DPKCS036
891357                                                                  DPKCS036
891358     PERFORM WITH TEST AFTER                                              
891359     VARYING SCAC-IDX FROM 1 BY 1                                         
891360     UNTIL ASC-NO-ITEMS-LEFT-ON-TABLE                                     
891361                                                                          
891362         IF SCAC-IDX > PV-TABLE-STORE-COUNT                               
891363             SET ASC-NO-ITEMS-LEFT-ON-TABLE TO TRUE                       
891364         END-IF                                                           
891365                                                                  DPKCS036
891366         IF  ASC-ITEMS-LEFT-ON-TABLE                              DPKCS036
891367         AND VIEW(SCAC-IDX) = PC-ADJUSTED                                 
891368             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
891369                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
891370             ELSE                                                 DPKCS036
891371                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
891372                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
891373                                                                  DPKCS036
891374                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
891375                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
891376                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
891377                                   TO TRUE                        DPKCS036
891378                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
891379                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
891380                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
891381                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
891382                     ADD +1          TO ASC-BLK-SUB               DPKCS036
891383                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
891384                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
891385                                     TO TRUE                      DPKCS036
891386                 END-IF                                           DPKCS036
891387             END-IF                                               DPKCS036
891388             ADD +1                  TO ASC-NUMBER-OF-ITEMS-READ  DPKCS036
891389             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
891390                                     TO ASC-LIST-ITEM-NUMBER      DPKCS036
891391                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891392                                                                          
891393             STRING ' ' DECNSL-SCAC(SCAC-IDX)                             
891394                 DELIMITED BY SIZE INTO ASC-DECNSL-SCAC                   
891395                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
891396                                                                          
891397             MOVE CNTR-CNT(SCAC-IDX) TO ASC-CNTR-CNT              DPKCS036
891398                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891399             MOVE PO-CNT(SCAC-IDX)   TO ASC-PO-CNT                DPKCS036
891400                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891401             MOVE CART-CNT(SCAC-IDX) TO ASC-CART-CNT              DPKCS036
891402                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891403             MOVE CBM-QTY(SCAC-IDX)  TO ASC-CBM-QTY               DPKCS036
891404                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
891405             IF PS-DISPLAY-VIEW                                           
891406                MOVE VIEW(SCAC-IDX)    TO ASC-VIEW                        
891407                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
891408                SET PS-DISPLAY-VIEW-NO TO TRUE                            
891409             ELSE                                                         
891410                MOVE SPACES            TO ASC-VIEW                        
891411                                        (ASC-BLK-SUB ASC-ITEM-SUB)        
891412             END-IF                                                       
891413                                                                  DPKCS036
891414         END-IF                                                   DPKCS036
891415     END-PERFORM.                                                 DPKCS036
891416                                                                          
891417     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          DPKCS036
891418         MOVE +1               TO ASC-BLK-SUB                     DPKCS036
891419         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
891420         ADD +1                TO ASC-BLK-SUB                     DPKCS036
891421         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
891422                                                                  DPKCS036
891423         MOVE 1                TO ASC-BLK-SUB                     DPKCS036
891424                                  PV-BLOCK-NUMBER                 DPKCS036
891425         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
891426         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             DPKCS036
891427             MOVE 2            TO ASC-BLK-SUB                     DPKCS036
891428                                  PV-BLOCK-NUMBER                 DPKCS036
891429             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
891430         END-IF                                                   DPKCS036
891431     END-IF.                                                      DPKCS036
891432                                                                  DPKCS036
891433 EJECT                                                            DPKCS036
891434*----------------------------------------------------------------*DPKCS036
891435*    WRITE TOTAL LINE.                                           *DPKCS036
891436*----------------------------------------------------------------*DPKCS036
891437 4330-WRITE-BLANK-LINE.                                           DPKCS036
891438                                                                  DPKCS036
891439     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        DPKCS036
891440         ADD +1            TO ASC-ITEM-SUB                                
891441     ELSE                                                                 
891442         ADD +1            TO ASC-BLK-SUB                                 
891450         MOVE +1           TO ASC-ITEM-SUB                                
891460                                                                          
891470         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                         
891480             MOVE +1       TO ASC-BLK-SUB                                 
891490             SET ASC-BLOCK-MODIFIED (1)                                   
891500                           TO TRUE                                        
891600             PERFORM 5100-WRITE-TEMP-STORAGE                              
891700             MOVE ASC-BLOCK-ENTRIES                                       
891800                       (PC-MAX-BLOCKS-IN-ARRAY)                           
891900                        TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                 
892000             ADD +1        TO ASC-BLK-SUB                                 
892100             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                   
892200             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      
892300                           TO TRUE                                        
892400         END-IF                                                           
892500     END-IF                                                               
892600     ADD +1                TO ASC-NUMBER-OF-ITEMS-READ                    
892700     MOVE ASC-NUMBER-OF-ITEMS-READ                                        
892800                                    TO ASC-LIST-ITEM-NUMBER               
892900                                      (ASC-BLK-SUB ASC-ITEM-SUB).         
893000                                                                          
893100     MOVE 'BLANK'                   TO ASC-DECNSL-SCAC                    
893200                                      (ASC-BLK-SUB ASC-ITEM-SUB).         
893300     MOVE SPACES                    TO ASC-VIEW                           
893400                                      (ASC-BLK-SUB ASC-ITEM-SUB).         
893500     MOVE ZEROES                    TO ASC-CNTR-CNT                       
893600                                      (ASC-BLK-SUB ASC-ITEM-SUB).         
893700     MOVE ZEROES                    TO ASC-PO-CNT                         
893800                                      (ASC-BLK-SUB ASC-ITEM-SUB).         
893900     MOVE ZEROES                    TO ASC-CART-CNT                       
894000                                      (ASC-BLK-SUB ASC-ITEM-SUB).         
894100     MOVE ZEROES                    TO ASC-CBM-QTY                        
894200                                      (ASC-BLK-SUB ASC-ITEM-SUB).         
894300     SET  PS-DISPLAY-VIEW           TO TRUE.                              
894301                                                                          
894302 EJECT                                                            DPKCS036
894303*----------------------------------------------------------------*DPKCS036
894304* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *DPKCS036
894305*----------------------------------------------------------------*DPKCS036
894306 4400-MOVE-COMMAREA-TO-SCREEN.                                    DPKCS036
894307                                                                  DPKCS036
894308     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             DPKCS036
894309         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          DPKCS036
894310         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          DPKCS036
894311             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
894312             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
894313             ADD +1     TO ASC-BLK-SUB                            DPKCS036
894314             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
894315             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             DPKCS036
894316                 GIVING PV-BLOCK-NUMBER                           DPKCS036
894317                 REMAINDER PV-REMAINDER                           DPKCS036
894318             IF  PV-REMAINDER > ZERO                              DPKCS036
894319                 ADD +1 TO PV-BLOCK-NUMBER                        DPKCS036
894320             END-IF                                               DPKCS036
894321             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
894322             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
894323             ADD +1     TO ASC-BLK-SUB                            DPKCS036
894324                           PV-BLOCK-NUMBER                        DPKCS036
894325             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
894326     END-IF.                                                      DPKCS036
894327     MOVE +1            TO ASC-BLK-SUB.                           DPKCS036
894328     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
894329         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              DPKCS036
894330         + PC-ITEMS-PER-PANEL).                                   DPKCS036
894331*                                                                 DPKCS036
894332     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
894333         ADD +1         TO ASC-BLK-SUB                            DPKCS036
894334         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
894335     END-IF.                                                      DPKCS036
894336*                                                                 DPKCS036
894337     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           DPKCS036
894338         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                DPKCS036
894339     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        DPKCS036
894340     PERFORM 4420-FORMAT-LIST-LINES                               DPKCS036
894341         VARYING PV-SUB                                           DPKCS036
894342         FROM PC-ITEMS-PER-PANEL BY -1                            DPKCS036
894343         UNTIL PV-SUB < +1.                                       DPKCS036
894344*                                                                 DPKCS036
894345     COMPUTE ASC-ITEMS-DISPLAYED =                                DPKCS036
894346         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          DPKCS036
894347     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   DPKCS036
894348*                                                                 DPKCS036
894349     MOVE ASC-POE-CDE              TO APOECDEO.                           
894350                                                                          
894351     MOVE ASC-WEEK-FROM-DTE (1:4)  TO PV-YYYY.                            
894352     MOVE ASC-WEEK-FROM-DTE (6:2)  TO PV-MM.                              
894353     MOVE ASC-WEEK-FROM-DTE (9:2)  TO PV-DD.                              
894354     MOVE PV-DISPLAY-DATE          TO AFRMDTEO.                           
894355                                                                          
894356     MOVE ASC-WEEK-TO-DTE (1:4)    TO PV-YYYY.                            
894357     MOVE ASC-WEEK-TO-DTE (6:2)    TO PV-MM.                              
894358     MOVE ASC-WEEK-TO-DTE (9:2)    TO PV-DD.                              
894359     MOVE PV-DISPLAY-DATE          TO ATODTEO.                            
894360                                                                          
894370     MOVE ASC-TOT-CONT-COUNT       TO ATOTCNTO.                           
894380     MOVE ASC-TOT-PO-COUNT         TO ATOTPOO.                            
894390     MOVE ASC-TOT-CART-COUNT       TO ATOTCRTO.                           
894391     MOVE ASC-TOT-CBMT-COUNT       TO ATOTCBMO.                           
894392*                                                                 DPKCS036
894393     IF  DP020-MSG-NUMBER-X = SPACE                               DPKCS036
894394         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  DPKCS036
894395*--------------- MORE ITEMS TO DISPLAY ----                       DPKCS036
894396             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            DPKCS036
894397             SET DP020-MSG-INFORMATIONAL TO TRUE                  DPKCS036
894398         END-IF                                                   DPKCS036
894399     END-IF.                                                      DPKCS036
894400                                                                  DPKCS036
894401 EJECT                                                            DPKCS036
894402*----------------------------------------------------------------*DPKCS036
894403*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *DPKCS036
894404*----------------------------------------------------------------*DPKCS036
894405 4410-READ-TEMP-STORAGE.                                          DPKCS036
894406                                                                  DPKCS036
894407     EXEC CICS                                                    DPKCS036
894408         READQ TS                                                 DPKCS036
894409             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
894410             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
894411             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
894412             RESP  (PV-CICS-RESP)                                 DPKCS036
894413     END-EXEC.                                                    DPKCS036
894414                                                                  DPKCS036
894415     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       DPKCS036
894416       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     DPKCS036
894417         CONTINUE                                                 DPKCS036
894418     ELSE                                                         DPKCS036
894419         SET DP013-CICS-ABEND     TO TRUE                         DPKCS036
894420         SET DP013-NO-ROLLBACK    TO TRUE                         DPKCS036
894421         MOVE '4410-READ-TEMP-STORAGE'                            DPKCS036
894422                                  TO DP013-PARAGRAPH              DPKCS036
894423         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      DPKCS036
894424                                  TO DP013-MESSAGE-TEXT(1)        DPKCS036
894425         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
894426     END-IF.                                                      DPKCS036
894427                                                                  DPKCS036
894428     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
894429                                                                  DPKCS036
894430     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         DPKCS036
894431         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               DPKCS036
894432     END-IF.                                                      DPKCS036
894433                                                                  DPKCS036
894434 EJECT                                                            DPKCS036
894435*----------------------------------------------------------------*DPKCS036
894436*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *DPKCS036
894437*----------------------------------------------------------------*DPKCS036
894438 4420-FORMAT-LIST-LINES.                                          DPKCS036
894439                                                                  DPKCS036
894440     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      DPKCS036
894441         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                DPKCS036
894442         MOVE SPACE              TO MR-DECNSL-SCAC (PV-SUB)       DPKCS036
894443                                    MR-VIEW        (PV-SUB)       DPKCS036
894444                                    MR-CNTR-CNT-X  (PV-SUB)       DPKCS036
894445                                    MR-PO-CNT-X    (PV-SUB)       DPKCS036
894446                                    MR-CART-CNT-X  (PV-SUB)       DPKCS036
894447                                    MR-CBM-QTY-X   (PV-SUB)       DPKCS036
894448     ELSE                                                         DPKCS036
894449         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           DPKCS036
894450             MOVE ASC-DECNSL-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
894451                                    TO MR-DECNSL-SCAC (PV-SUB)    DPKCS036
894452             MOVE ASC-VIEW        (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
894453                                    TO MR-VIEW        (PV-SUB)    DPKCS036
894454             MOVE ASC-CNTR-CNT    (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
894455                                    TO MR-CNTR-CNT    (PV-SUB)    DPKCS036
894456             MOVE ASC-PO-CNT      (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
894457                                    TO MR-PO-CNT      (PV-SUB)    DPKCS036
894458             MOVE ASC-CART-CNT    (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
894459                                    TO MR-CART-CNT    (PV-SUB)    DPKCS036
894460             MOVE ASC-CBM-QTY     (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
894470                                    TO MR-CBM-QTY     (PV-SUB)    DPKCS036
894480             IF ASC-DECNSL-SCAC (ASC-BLK-SUB ASC-ITEM-SUB)                
894481                                     = 'BLANK'                            
894482                MOVE SPACE          TO MR-DECNSL-SCAC (PV-SUB)    DPKCS036
894483                                       MR-VIEW        (PV-SUB)    DPKCS036
894484                                       MR-CNTR-CNT-X  (PV-SUB)    DPKCS036
894485                                       MR-PO-CNT-X    (PV-SUB)    DPKCS036
894486                                       MR-CART-CNT-X  (PV-SUB)    DPKCS036
894487                                       MR-CBM-QTY-X   (PV-SUB)    DPKCS036
894488             END-IF                                                       
894489         END-IF                                                   DPKCS036
894490     END-IF.                                                      DPKCS036
894491     SUBTRACT +1 FROM ASC-ITEM-SUB                                DPKCS036
894492     IF  ASC-ITEM-SUB < + 1                                       DPKCS036
894493         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  DPKCS036
894494         MOVE +1                 TO ASC-BLK-SUB                   DPKCS036
894495     END-IF.                                                      DPKCS036
894496                                                                  DPKCS036
894497 EJECT                                                            DPKCS036
894498*----------------------------------------------------------------*DPKCS036
894499*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *DPKCS036
894500*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *DPKCS036
894501*  ISSUE A WARNING.                                              *DPKCS036
894502*----------------------------------------------------------------*DPKCS036
894503 4430-CHECK-FOR-BEGIN-AND-END.                                    DPKCS036
894504                                                                  DPKCS036
894505     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
894506         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
894507*-------------- NO END-OF-RANGE SPECFIED ---                      DPKCS036
894508             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            DPKCS036
894509             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
894510             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
894511         END-IF                                                   DPKCS036
894512     ELSE                                                         DPKCS036
894513         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     DPKCS036
894514*-------------- NO BEGINNING-OF-RANGE SPECFIED ---                DPKCS036
894515             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            DPKCS036
894516             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
894517             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
894518         END-IF                                                   DPKCS036
894519     END-IF.                                                      DPKCS036
894520                                                                  DPKCS036
894521 EJECT                                                            DPKCS036
894522*----------------------------------------------------------------*DPKCS036
894523*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *DPKCS036
894524*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *DPKCS036
894525*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *DPKCS036
894526*  POSITION THE CURSOR THERE.                                    *DPKCS036
894527*----------------------------------------------------------------*DPKCS036
894528 4431-POSITION-AT-WARNING.                                        DPKCS036
894529                                                                  DPKCS036
894530     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
894531                    - PV-TOP-ITEM + 1.                            DPKCS036
894532     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
894533         CONTINUE                                                 DPKCS036
894534     ELSE                                                         DPKCS036
894535         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
894536                                   TO TRUE                        DPKCS036
894537         MOVE -1                   TO MR-DECNSL-SCACL (PV-SUB)    DPKCS036
894538         MOVE DP015-REVERSE        TO MR-DECNSL-SCACH (PV-SUB)    DPKCS036
894539         MOVE DP015-YELLOW         TO MR-DECNSL-SCACC (PV-SUB)    DPKCS036
894540     END-IF.                                                      DPKCS036
894541*                                                                 DPKCS036
894542     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
894543                    - PV-TOP-ITEM + 1.                            DPKCS036
894544     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
894545         CONTINUE                                                 DPKCS036
894546     ELSE                                                         DPKCS036
894547         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
894548                                   TO TRUE                        DPKCS036
894549         MOVE -1                   TO MR-DECNSL-SCACL (PV-SUB)    DPKCS036
894550         MOVE DP015-REVERSE        TO MR-DECNSL-SCACH (PV-SUB)    DPKCS036
894551         MOVE DP015-YELLOW         TO MR-DECNSL-SCACC (PV-SUB)    DPKCS036
894552     END-IF.                                                      DPKCS036
894553                                                                  DPKCS036
894554 EJECT                                                            DPKCS036
894555*----------------------------------------------------------------*DPKCS036
894556*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *DPKCS036
894557*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *DPKCS036
894558*----------------------------------------------------------------*DPKCS036
894559 5100-WRITE-TEMP-STORAGE.                                         DPKCS036
894560                                                                  DPKCS036
894561     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     DPKCS036
894562                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
894563     COMPUTE PV-BLOCK-NUMBER =                                    DPKCS036
894564         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
894565                                                                  DPKCS036
894566     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
894567     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
894568         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      DPKCS036
894569             PERFORM 5105-REWRITE-ASC-LISTQ                       DPKCS036
894570         END-IF                                                   DPKCS036
894571     ELSE                                                         DPKCS036
894572         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       DPKCS036
894573         ASC-HIGHEST-BLOCK-WRITTEN + 1                            DPKCS036
894574         PERFORM 5110-WRITE-ASC-LISTQ                             DPKCS036
894575         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   DPKCS036
894576     END-IF.                                                      DPKCS036
894577                                                                  DPKCS036
894578     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
894579                                                                  DPKCS036
894580 EJECT                                                            DPKCS036
894581*----------------------------------------------------------------*DPKCS036
894582*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *DPKCS036
894583*  SPECIFIC COMMAREA.                                            *DPKCS036
894584*----------------------------------------------------------------*DPKCS036
894585 5105-REWRITE-ASC-LISTQ.                                          DPKCS036
894586                                                                  DPKCS036
894587     EXEC CICS                                                    DPKCS036
894588         WRITEQ TS                                                DPKCS036
894589             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
894590             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
894591             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
894592             REWRITE                                              DPKCS036
894593             RESP  (PV-CICS-RESP)                                 DPKCS036
894594     END-EXEC.                                                    DPKCS036
894595                                                                  DPKCS036
894596     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           DPKCS036
894597         CONTINUE                                                 DPKCS036
894598     ELSE                                                         DPKCS036
894599         SET DP013-CICS-ABEND            TO TRUE                  DPKCS036
894600         SET DP013-NO-ROLLBACK           TO TRUE                  DPKCS036
894601         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       DPKCS036
894602         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     DPKCS036
894603                                         TO DP013-MESSAGE-TEXT(1) DPKCS036
894604         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
894605     END-IF.                                                      DPKCS036
894606                                                                  DPKCS036
894607 EJECT                                                            DPKCS036
894608*----------------------------------------------------------------*DPKCS036
894609*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *DPKCS036
894610*  SPECIFIC COMMAREA.                                            *DPKCS036
894611*----------------------------------------------------------------*DPKCS036
894612 5110-WRITE-ASC-LISTQ.                                            DPKCS036
894613                                                                  DPKCS036
894614     EXEC CICS                                                    DPKCS036
894615         WRITEQ TS                                                DPKCS036
894616             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
894617             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
894618             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
894619             RESP  (PV-CICS-RESP)                                 DPKCS036
894620     END-EXEC.                                                    DPKCS036
894621     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      DPKCS036
894622         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
894623         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
894624         MOVE '5110-WRITE-ASC-LISTQ'                              DPKCS036
894625                                   TO DP013-PARAGRAPH             DPKCS036
894626         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           DPKCS036
894627                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
894628         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
894629     END-IF.                                                      DPKCS036
894630                                                                          
894631*----------------------------------------------------------------*DPKCS036
894632*   OPEN THE RULE DETAIL CURSOR                                   DPKCS036
894633*---------------------------------------------------------------- DPKCS036
894634 6000-OPEN-FINLUPD-CUR.                                           DPKCS036
894635                                                                          
894636     EXEC SQL                                                     DPKCS036
894637          OPEN FINLUPD_CUR                                        DPKCS036
894638     END-EXEC                                                     DPKCS036
894639                                                                  DPKCS036
894640     EVALUATE TRUE                                                DPKCS036
894641         WHEN SQLCODE = ZERO                                      DPKCS036
894642         WHEN SQLCODE = -904                                      DPKCS036
894643         WHEN SQLCODE = -913                                      DPKCS036
894644            CONTINUE                                              DPKCS036
894645         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
894646         WHEN SQLCODE < ZERO                                      DPKCS036
894647         WHEN SQLCODE > ZERO                                      DPKCS036
894648             MOVE '6000-OPEN-FINLUPD-CUR'                         DPKCS036
894649                               TO DP013-PARAGRAPH                 DPKCS036
894650             MOVE 'OPEN FINLUPD CORSOR - '                        DPKCS036
894651                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
894652             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
894653             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
894654             SET DP013-DB2-ABEND                                  DPKCS036
894655                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
894656             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
894657     END-EVALUATE.                                                        
894658                                                                          
894659 EJECT                                                            DPKCS036
894660*----------------------------------------------------------------*DPKCS036
894661* FETCH THE RULE CURSOR                                           DPKCS036
894662*----------------------------------------------------------------*DPKCS036
894663 6200-PROCESS-FINLUPD-CUR.                                        DPKCS036
894664                                                                          
894665     PERFORM 6110-FETCH-FINLUPD-CUR.                                      
894666                                                                          
894667     IF PS-END-OF-FINLUPD-CUR-NO                                          
894668                                                                          
894669*       AUDIT AND DELETE ANY EXISTING ADJUSTED RULES                      
894670        MOVE PV-AUDIT-WKG-RULE TO TRT00015-RUL-ID                         
894671        MOVE 'FIN'             TO TRT00017-AUD-FUNC-CDE                   
894672        MOVE 'ADJ'             TO PV-RUL-TYPE                             
894673        IF TRT00014-RUL-CDE = 'CONT'                                      
894674           PERFORM 1322-SELECT-CONT-SEQ-NBR                               
894675           IF PV-CONTAINER-SEQ EQUAL TO SPACES                            
894676              PERFORM 1323-SELECT-ETA-VAL                                 
894677              MOVE 'ETA'            TO PV-SEQ-OR-ETA                      
894678              MOVE PV-CONTAINER-ETA TO PV-SEQ-OR-ETA-VAL                  
894679           ELSE                                                           
894680              MOVE 'SEQ'            TO PV-SEQ-OR-ETA                      
894681              MOVE PV-CONTAINER-SEQ TO PV-SEQ-OR-ETA-VAL                  
894682           END-IF                                                         
894683           PERFORM 1326-CHECK-FOR-CONTAINER-RULE                          
894684        ELSE                                                              
894685           PERFORM 1327-SELECT-VESSEL-VOYAGE                              
894686           PERFORM 1328-CHECK-FOR-VESSEL-RULE                             
894687        END-IF                                                            
894688        IF PV-RUL-ID GREATER THAN ZEROES                                  
894689           MOVE PV-RUL-ID TO TRT00015-RUL-ID                              
894690           PERFORM 6170-AUDIT-ADJUSTED-RULE                               
894700           PERFORM 6180-AUDIT-ADJUSTED-CNSTR                              
894800           PERFORM 6190-DELETE-ADJUSTED-RULE                              
894900        END-IF                                                            
895000                                                                          
895001*       FINALIZE WORKING RULE                                             
895002        PERFORM 6120-AUDIT-WORKING-RULE                                   
895003        PERFORM 6130-ADD-ADJUSTED-RULE                                    
895004        PERFORM 6140-AUDIT-WORKING-CNSTR                                  
895005        PERFORM 6150-ADD-ADJUSTED-CNSTR                                   
895006        PERFORM 6160-DELETE-WORKING-RULE                                  
895007     END-IF.                                                              
895008                                                                          
895009*----------------------------------------------------------------*DPKCS036
895010* FETCH THE RULE CURSOR                                           DPKCS036
895011*----------------------------------------------------------------*DPKCS036
895012 6110-FETCH-FINLUPD-CUR.                                          DPKCS036
895013                                                                  DPKCS036
895014     EXEC SQL                                                     DPKCS036
895015          FETCH FINLUPD_CUR                                       DPKCS036
895016          INTO :PV-AUDIT-WKG-RULE                                 DPKCS036
895017              ,:TRT00014-RUL-CDE                                          
895018              ,:TRT00014-RUL-BEG-DTE                                      
895019              ,:TRT00014-RUL-END-DTE                                      
895020     END-EXEC.                                                    DPKCS036
895021                                                                  DPKCS036
895022     EVALUATE TRUE                                                DPKCS036
895023         WHEN SQLCODE = ZERO                                      DPKCS036
895024              CONTINUE                                                    
895025         WHEN SQLCODE = +100                                      DPKCS036
895026              SET PS-END-OF-FINLUPD-CUR TO TRUE                   DPKCS036
895027         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895028         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895029              MOVE '6110-FETCH-FINLUPD-CUR'                       DPKCS036
895030                               TO DP013-PARAGRAPH                 DPKCS036
895031              MOVE 'FETCH FINLUPD CURSOR'                         DPKCS036
895032                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895033              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895034              SET DP013-DB2-ABEND                                 DPKCS036
895035                               TO TRUE                            DPKCS036
895036              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895037     END-EVALUATE.                                                DPKCS036
895038                                                                  DPKCS036
895039 EJECT                                                            DPKCS036
895040*----------------------------------------------------------------*DPKCS036
895041* INSERT AUDIT ROW FOR ALL WORKING RULES                          DPKCS036
895042*----------------------------------------------------------------*DPKCS036
895043 6120-AUDIT-WORKING-RULE.                                         DPKCS036
895044                                                                          
895045     EXEC SQL                                                     DPKCS036
895046        INSERT INTO TRT_AUD_RUL                                           
895047        SELECT TR.RUL_ID                                                  
895048              ,TR.RUL_CDE                                                 
895049              ,TR.RUL_TYP_CDE                                             
895050              ,TR.RUL_BEG_DTE                                             
895051              ,TR.RUL_END_DTE                                             
895052              ,TR.CRE_TMST                                                
895053              ,TR.CRE_BY_USR_ID                                           
895054              ,:DP020-USERID                                              
895055              ,:TRT00017-AUD-FUNC-CDE                                     
895056              ,CURRENT TIMESTAMP                                          
895057        FROM TRT_RUL TR                                                   
895058        WHERE TR.RUL_ID = :PV-AUDIT-WKG-RULE                              
895059     END-EXEC.                                                    DPKCS036
895060                                                                  DPKCS036
895061     EVALUATE TRUE                                                DPKCS036
895062         WHEN SQLCODE = ZERO                                      DPKCS036
895063         WHEN SQLCODE = -811                                      DPKCS036
895064         WHEN SQLCODE = +100                                      DPKCS036
895065              CONTINUE                                            DPKCS036
895066         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895067         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895068              MOVE '6120-AUDIT-WORKING-RULE'                      DPKCS036
895069                               TO DP013-PARAGRAPH                 DPKCS036
895070              MOVE 'SQL ERROR INSERTING AUDIT RULE'               DPKCS036
895071                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895072              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895073              SET DP013-DB2-ABEND                                 DPKCS036
895074                               TO TRUE                            DPKCS036
895075              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895076     END-EVALUATE.                                                DPKCS036
895077                                                                  DPKCS036
895078 EJECT                                                            DPKCS036
895079*----------------------------------------------------------------*DPKCS036
895080* INSERT AUDIT ROW FOR ALL WORKING RULES                          DPKCS036
895081*----------------------------------------------------------------*DPKCS036
895082 6130-ADD-ADJUSTED-RULE.                                          DPKCS036
895083                                                                          
895084     EXEC SQL                                                     DPKCS036
895085        INSERT INTO TRT_RUL                                               
895086              (RUL_CDE                                                    
895087              ,RUL_TYP_CDE                                                
895088              ,RUL_BEG_DTE                                                
895089              ,RUL_END_DTE                                                
895090              ,CRE_TMST                                                   
895100              ,CRE_BY_USR_ID)                                             
895101       VALUES (:TRT00014-RUL-CDE                                          
895102              ,'ADJ'                                                      
895103              ,:TRT00014-RUL-BEG-DTE                                      
895104              ,:TRT00014-RUL-END-DTE                                      
895105              ,CURRENT TIMESTAMP                                          
895106              ,:DP020-USERID)                                             
895107     END-EXEC.                                                    DPKCS036
895108                                                                  DPKCS036
895109     EVALUATE TRUE                                                DPKCS036
895110         WHEN SQLCODE = ZERO                                      DPKCS036
895111         WHEN SQLCODE = -811                                      DPKCS036
895112         WHEN SQLCODE = +100                                      DPKCS036
895113              PERFORM 6131-RETRIEVE-INSERTED-RULE-ID              DPKCS036
895114         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895115         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895116              MOVE '6130-ADD-ADJUSTED-RULE'                       DPKCS036
895117                               TO DP013-PARAGRAPH                 DPKCS036
895118              MOVE 'SQL ERROR INSERTING ADJUSTED RULE'            DPKCS036
895119                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895120              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895121              SET DP013-DB2-ABEND                                 DPKCS036
895122                               TO TRUE                            DPKCS036
895123              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895124     END-EVALUATE.                                                DPKCS036
895125 EJECT                                                            DPKCS036
895126*----------------------------------------------------------------*DPKCS036
895127* INSERT AUDIT ROW FOR ALL WORKING RULES                          DPKCS036
895128*----------------------------------------------------------------*DPKCS036
895129 6131-RETRIEVE-INSERTED-RULE-ID.                                  DPKCS036
895130                                                                          
895140     EXEC SQL                                                     DPKCS036
895150        SET :PV-AUDIT-ADJ-RULE = IDENTITY_VAL_LOCAL ()                    
895151     END-EXEC.                                                            
895152                                                                  DPKCS036
895153     EVALUATE TRUE                                                DPKCS036
895154         WHEN SQLCODE = ZERO                                      DPKCS036
895155              CONTINUE                                            DPKCS036
895156         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895157         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895158              MOVE '6131-RETRIEVE-INSERTED-RULE-ID'               DPKCS036
895159                               TO DP013-PARAGRAPH                 DPKCS036
895160              MOVE 'SQL ERROR SELECT NEW RULE ID'                 DPKCS036
895161                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895162              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895163              SET DP013-DB2-ABEND                                 DPKCS036
895164                               TO TRUE                            DPKCS036
895165              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895166     END-EVALUATE.                                                DPKCS036
895167 EJECT                                                            DPKCS036
895168*----------------------------------------------------------------*DPKCS036
895169* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                    DPKCS036
895170*----------------------------------------------------------------*DPKCS036
895171 6140-AUDIT-WORKING-CNSTR.                                        DPKCS036
895172                                                                          
895173     EXEC SQL                                                     DPKCS036
895174        INSERT INTO TRT_AUD_RUL_CNSTR                                     
895175        SELECT TRC.RUL_ID                                                 
895176              ,TRC.RUL_CNSTR_CDE                                          
895177              ,TRC.RUL_CNSTR_TYP_CDE                                      
895178              ,TRC.RUL_CNSTR_VAL_TXT                                      
895179              ,TRC.CRE_TMST                                               
895180              ,TRC.CRE_BY_USR_ID                                          
895190              ,:DP020-USERID                                              
895200              ,:TRT00017-AUD-FUNC-CDE                                     
895300              ,CURRENT TIMESTAMP                                          
895400        FROM   TRT_RUL_CNSTR TRC                                          
895401        WHERE  TRC.RUL_ID = :PV-AUDIT-WKG-RULE                            
895402     END-EXEC.                                                    DPKCS036
895403                                                                  DPKCS036
895404     EVALUATE TRUE                                                DPKCS036
895405         WHEN SQLCODE = ZERO                                      DPKCS036
895406         WHEN SQLCODE = -811                                      DPKCS036
895407         WHEN SQLCODE = +100                                      DPKCS036
895408              CONTINUE                                            DPKCS036
895409         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895410         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895420              MOVE '6140-AUDIT-WORKING-CNSTR'                     DPKCS036
895421                               TO DP013-PARAGRAPH                 DPKCS036
895422              MOVE 'SQL ERROR INSERTING ADJUSTED RULE'            DPKCS036
895423                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895424              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895425              SET DP013-DB2-ABEND                                 DPKCS036
895426                               TO TRUE                            DPKCS036
895427              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895428     END-EVALUATE.                                                DPKCS036
895429 EJECT                                                            DPKCS036
895430*----------------------------------------------------------------*DPKCS036
895431* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                    DPKCS036
895432*----------------------------------------------------------------*DPKCS036
895433 6150-ADD-ADJUSTED-CNSTR.                                         DPKCS036
895434                                                                          
895435     EXEC SQL                                                     DPKCS036
895436        UPDATE TRT_RUL_CNSTR                                              
895437        SET    RUL_ID   = :PV-AUDIT-ADJ-RULE                              
895438        WHERE  RUL_ID   = :PV-AUDIT-WKG-RULE                              
895439     END-EXEC.                                                    DPKCS036
895440                                                                  DPKCS036
895441     EVALUATE TRUE                                                DPKCS036
895442         WHEN SQLCODE = ZERO                                      DPKCS036
895443         WHEN SQLCODE = -811                                      DPKCS036
895444         WHEN SQLCODE = +100                                      DPKCS036
895445              CONTINUE                                            DPKCS036
895446         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895447         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895448              MOVE '6150-ADD-ADJUSTED-CNSTR'                      DPKCS036
895449                               TO DP013-PARAGRAPH                 DPKCS036
895450              MOVE 'SQL ERROR UPDATING WKG TO ADJ'                DPKCS036
895451                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895452              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895453              SET DP013-DB2-ABEND                                 DPKCS036
895454                               TO TRUE                            DPKCS036
895455              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895456     END-EVALUATE.                                                DPKCS036
895457 EJECT                                                            DPKCS036
895458*----------------------------------------------------------------*DPKCS036
895459* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                    DPKCS036
895460*----------------------------------------------------------------*DPKCS036
895461 6160-DELETE-WORKING-RULE.                                        DPKCS036
895462                                                                          
895463     EXEC SQL                                                     DPKCS036
895464        DELETE FROM TRT_RUL                                               
895465        WHERE RUL_ID = :PV-AUDIT-WKG-RULE                                 
895466     END-EXEC.                                                    DPKCS036
895467                                                                  DPKCS036
895468     EVALUATE TRUE                                                DPKCS036
895469         WHEN SQLCODE = ZERO                                      DPKCS036
895470         WHEN SQLCODE = -811                                      DPKCS036
895471         WHEN SQLCODE = +100                                      DPKCS036
895472              CONTINUE                                            DPKCS036
895473         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895474         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895475              MOVE '6160-DELETE-WORKING-RULE'                     DPKCS036
895476                               TO DP013-PARAGRAPH                 DPKCS036
895477              MOVE 'SQL ERROR DELETING WKG RULE'                  DPKCS036
895478                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895479              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895480              SET DP013-DB2-ABEND                                 DPKCS036
895481                               TO TRUE                            DPKCS036
895482              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895483     END-EVALUATE.                                                DPKCS036
895484 EJECT                                                            DPKCS036
895485*----------------------------------------------------------------*DPKCS036
895486* AUDIT EXISTING ADJUSTED RULE                                    DPKCS036
895487*----------------------------------------------------------------*DPKCS036
895488 6170-AUDIT-ADJUSTED-RULE.                                        DPKCS036
895489                                                                          
895490     EXEC SQL                                                     DPKCS036
895491        INSERT INTO TRT_AUD_RUL                                           
895492        SELECT TR.RUL_ID                                                  
895493              ,TR.RUL_CDE                                                 
895494              ,TR.RUL_TYP_CDE                                             
895495              ,TR.RUL_BEG_DTE                                             
895496              ,TR.RUL_END_DTE                                             
895497              ,TR.CRE_TMST                                                
895498              ,TR.CRE_BY_USR_ID                                           
895499              ,:DP020-USERID                                              
895500              ,:TRT00017-AUD-FUNC-CDE                                     
895501              ,CURRENT TIMESTAMP                                          
895502        FROM TRT_RUL TR                                                   
895503        WHERE TR.RUL_ID = :TRT00015-RUL-ID                                
895504     END-EXEC.                                                    DPKCS036
895505                                                                  DPKCS036
895506     EVALUATE TRUE                                                DPKCS036
895507         WHEN SQLCODE = ZERO                                      DPKCS036
895508         WHEN SQLCODE = -811                                      DPKCS036
895509         WHEN SQLCODE = +100                                      DPKCS036
895510              CONTINUE                                            DPKCS036
895511         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895512         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895513              MOVE '6170-AUDIT-ADJUSTED-RULE'                     DPKCS036
895514                               TO DP013-PARAGRAPH                 DPKCS036
895515              MOVE 'SQL ERROR INSERTING AUDIT ADJ RULE'           DPKCS036
895516                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895517              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895518              SET DP013-DB2-ABEND                                 DPKCS036
895519                               TO TRUE                            DPKCS036
895520              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895521     END-EVALUATE.                                                DPKCS036
895522                                                                  DPKCS036
895523 EJECT                                                            DPKCS036
895524*----------------------------------------------------------------*DPKCS036
895525* AUDIT EXISTING ADJUSTED RULE CONSTRAINT                         DPKCS036
895526*----------------------------------------------------------------*DPKCS036
895527 6180-AUDIT-ADJUSTED-CNSTR.                                       DPKCS036
895528                                                                          
895529     EXEC SQL                                                     DPKCS036
895530        INSERT INTO TRT_AUD_RUL_CNSTR                                     
895531        SELECT TRC.RUL_ID                                                 
895532              ,TRC.RUL_CNSTR_CDE                                          
895533              ,TRC.RUL_CNSTR_TYP_CDE                                      
895534              ,TRC.RUL_CNSTR_VAL_TXT                                      
895535              ,TRC.CRE_TMST                                               
895536              ,TRC.CRE_BY_USR_ID                                          
895537              ,:DP020-USERID                                              
895538              ,:TRT00017-AUD-FUNC-CDE                                     
895539              ,CURRENT TIMESTAMP                                          
895540        FROM   TRT_RUL_CNSTR TRC                                          
895541        WHERE  TRC.RUL_ID = :TRT00015-RUL-ID                              
895542     END-EXEC.                                                    DPKCS036
895543                                                                  DPKCS036
895544     EVALUATE TRUE                                                DPKCS036
895545         WHEN SQLCODE = ZERO                                      DPKCS036
895546         WHEN SQLCODE = -811                                      DPKCS036
895547         WHEN SQLCODE = +100                                      DPKCS036
895548              CONTINUE                                            DPKCS036
895549         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895550         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895551              MOVE '6180-AUDIT-ADJUSTED-CNSTR'                    DPKCS036
895552                               TO DP013-PARAGRAPH                 DPKCS036
895553              MOVE 'SQL ERROR INSERTING AUDIT ADJ RULE'           DPKCS036
895554                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895555              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895556              SET DP013-DB2-ABEND                                 DPKCS036
895557                               TO TRUE                            DPKCS036
895558              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895559     END-EVALUATE.                                                DPKCS036
895560 EJECT                                                            DPKCS036
895561*----------------------------------------------------------------*DPKCS036
895562* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                    DPKCS036
895563*----------------------------------------------------------------*DPKCS036
895564 6190-DELETE-ADJUSTED-RULE.                                       DPKCS036
895565                                                                          
895566     EXEC SQL                                                     DPKCS036
895567        DELETE FROM TRT_RUL                                               
895568        WHERE RUL_ID = :TRT00015-RUL-ID                                   
895569     END-EXEC.                                                    DPKCS036
895570                                                                  DPKCS036
895571     EVALUATE TRUE                                                DPKCS036
895572         WHEN SQLCODE = ZERO                                      DPKCS036
895573         WHEN SQLCODE = -811                                      DPKCS036
895574         WHEN SQLCODE = +100                                      DPKCS036
895575              CONTINUE                                            DPKCS036
895576         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895577         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895578              MOVE '6190-DELETE-ADJUSTED-RULE'                    DPKCS036
895579                               TO DP013-PARAGRAPH                 DPKCS036
895580              MOVE 'SQL ERROR DELETING ADJ RULE'                  DPKCS036
895581                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895582              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895583              SET DP013-DB2-ABEND                                 DPKCS036
895584                               TO TRUE                            DPKCS036
895585              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895586     END-EVALUATE.                                                DPKCS036
895587 EJECT                                                            DPKCS036
895588*----------------------------------------------------------------*DPKCS036
895589*   CLOSE THE RULE CUROSR                                         DPKCS036
895590*----------------------------------------------------------------*DPKCS036
895591 6300-CLOSE-FINLUPD-CUR.                                          DPKCS036
895592                                                                  DPKCS036
895593     EXEC SQL                                                     DPKCS036
895594          CLOSE FINLUPD_CUR                                       DPKCS036
895595     END-EXEC.                                                    DPKCS036
895596*                                                                 DPKCS036
895597     EVALUATE TRUE                                                DPKCS036
895598         WHEN SQLCODE = ZERO                                      DPKCS036
895599             CONTINUE                                             DPKCS036
895600         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
895601         WHEN SQLCODE < ZERO                                      DPKCS036
895602         WHEN SQLCODE > ZERO                                      DPKCS036
895603             MOVE '1330-CLOSE-FINLUPD-CUR'                        DPKCS036
895604                               TO DP013-PARAGRAPH                 DPKCS036
895605             MOVE 'CLOSE FINLUPD CURSOR '                         DPKCS036
895606                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895607             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
895608             MOVE 'TRT_RUL '   TO DP013-DB2-TABLE-NAME (1)        DPKCS036
895609             SET DP013-DB2-ABEND                                  DPKCS036
895610                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
895611             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
895612     END-EVALUATE.                                                DPKCS036
895613                                                                  DPKCS036
895614 EJECT                                                            DPKCS036
895615*----------------------------------------------------------------*DPKCS036
895616* INSERT AUDIT ROW FOR ALL WORKING RULES                          DPKCS036
895617*----------------------------------------------------------------*DPKCS036
895618 7000-AUDIT-ALL-WKG-RULES.                                        DPKCS036
895619                                                                          
895620     EXEC SQL                                                     DPKCS036
895621        INSERT INTO TRT_AUD_RUL                                           
895622        SELECT TR.RUL_ID                                                  
895623              ,TR.RUL_CDE                                                 
895624              ,TR.RUL_TYP_CDE                                             
895625              ,TR.RUL_BEG_DTE                                             
895626              ,TR.RUL_END_DTE                                             
895627              ,TR.CRE_TMST                                                
895628              ,TR.CRE_BY_USR_ID                                           
895629              ,:DP020-USERID                                              
895630              ,:TRT00017-AUD-FUNC-CDE                                     
895631              ,CURRENT TIMESTAMP                                          
895632        FROM TRT_RUL TR                                                   
895633            ,TRT_RUL_CNSTR TRC                                            
895634        WHERE TR.RUL_ID             = TRC.RUL_ID                          
895635          AND TR.RUL_TYP_CDE        = 'WKG'                               
895636          AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
895637          AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
895638          AND TRC.RUL_CNSTR_TYP_CDE = 'POE'                               
895639          AND TRC.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
895640     END-EXEC.                                                    DPKCS036
895641                                                                  DPKCS036
895642     EVALUATE TRUE                                                DPKCS036
895643         WHEN SQLCODE = ZERO                                      DPKCS036
895644         WHEN SQLCODE = -811                                      DPKCS036
895645         WHEN SQLCODE = +100                                      DPKCS036
895646              CONTINUE                                            DPKCS036
895647         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
895648         WHEN SQLCODE NOT = ZERO                                  DPKCS036
895649              MOVE '7000-AUDIT-ALL-WKG-RULES'                     DPKCS036
895650                               TO DP013-PARAGRAPH                 DPKCS036
895651              MOVE 'SQL ERROR INSERTING AUDIT RULE'               DPKCS036
895652                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
895653              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
895654              SET DP013-DB2-ABEND                                 DPKCS036
895655                               TO TRUE                            DPKCS036
895656              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
895657     END-EVALUATE.                                                DPKCS036
895658                                                                  DPKCS036
895659 EJECT                                                            DPKCS036
895660*----------------------------------------------------------------*DPKCS036
895661* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                    DPKCS036
895662*----------------------------------------------------------------*DPKCS036
895663 7100-AUDIT-ALL-WKG-CNSTRS.                                       DPKCS036
895664                                                                          
895665     EXEC SQL                                                     DPKCS036
895666        INSERT INTO TRT_AUD_RUL_CNSTR                                     
895667        SELECT RUL_ID                                                     
895668              ,RUL_CNSTR_CDE                                              
895669              ,RUL_CNSTR_TYP_CDE                                          
895670              ,RUL_CNSTR_VAL_TXT                                          
895671              ,CRE_TMST                                                   
895672              ,CRE_BY_USR_ID                                              
895673              ,:DP020-USERID                                              
895674              ,:TRT00017-AUD-FUNC-CDE                                     
895680              ,CURRENT TIMESTAMP                                          
895690        FROM   TRT_RUL_CNSTR                                              
895700        WHERE RUL_ID IN (                                                 
895800           SELECT TR.RUL_ID                                               
895900           FROM   TRT_RUL TR                                              
896000                 ,TRT_RUL_CNSTR TRC                                       
896100           WHERE  TR.RUL_ID             = TRC.RUL_ID                      
896200             AND  TR.RUL_TYP_CDE        = 'WKG'                           
896300             AND  TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE              
896400             AND  TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                
896500             AND  TRC.RUL_CNSTR_TYP_CDE = 'POE'                           
896501             AND  TRC.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE)                   
896502     END-EXEC.                                                    DPKCS036
896503                                                                  DPKCS036
896504     EVALUATE TRUE                                                DPKCS036
896505         WHEN SQLCODE = ZERO                                      DPKCS036
896506         WHEN SQLCODE = -811                                      DPKCS036
896507         WHEN SQLCODE = +100                                      DPKCS036
896508              CONTINUE                                            DPKCS036
896509         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
896510         WHEN SQLCODE NOT = ZERO                                  DPKCS036
896520              MOVE '7100-AUDIT-ALL-WKG-CNSTRS'                    DPKCS036
896521                               TO DP013-PARAGRAPH                 DPKCS036
896522              MOVE 'SQL ERROR INSERTING ADJUSTED RULE'            DPKCS036
896523                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
896524              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
896525              SET DP013-DB2-ABEND                                 DPKCS036
896526                               TO TRUE                            DPKCS036
896527              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
896528     END-EVALUATE.                                                DPKCS036
896529 EJECT                                                            DPKCS036
896530*----------------------------------------------------------------*DPKCS036
896531* INSERT AUDIT ROW FOR WORKING RULE CONSTRAINT                    DPKCS036
896532*----------------------------------------------------------------*DPKCS036
896533 7200-DELETE-ALL-WKG-RULES.                                       DPKCS036
896534                                                                          
896535     EXEC SQL                                                     DPKCS036
896536        DELETE FROM TRT_RUL                                               
896537        WHERE RUL_ID IN (                                                 
896538           SELECT TR.RUL_ID                                               
896539           FROM TRT_RUL TR                                                
896540               ,TRT_RUL_CNSTR TRC                                         
896550           WHERE TR.RUL_ID             = TRC.RUL_ID                       
896560             AND TR.RUL_TYP_CDE        = 'WKG'                            
896570             AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE               
896580             AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                 
896590             AND TRC.RUL_CNSTR_TYP_CDE = 'POE'                            
896591             AND TRC.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE)                    
896592     END-EXEC.                                                    DPKCS036
896593                                                                  DPKCS036
896594     EVALUATE TRUE                                                DPKCS036
896595         WHEN SQLCODE = ZERO                                      DPKCS036
896596         WHEN SQLCODE = -811                                      DPKCS036
896597         WHEN SQLCODE = +100                                      DPKCS036
896598              CONTINUE                                            DPKCS036
896599         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
896600         WHEN SQLCODE NOT = ZERO                                  DPKCS036
896700              MOVE '7200-DELETE-ALL-WKG-RULES'                    DPKCS036
896701                               TO DP013-PARAGRAPH                 DPKCS036
896702              MOVE 'SQL ERROR DELETING WKG RULE'                  DPKCS036
896703                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
896704              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
896705              SET DP013-DB2-ABEND                                 DPKCS036
896706                               TO TRUE                            DPKCS036
896707              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
896708     END-EVALUATE.                                                DPKCS036
896709 EJECT                                                            DPKCS036
896710*----------------------------------------------------------------*DPKCS036
896711* COUNT WORKING RULES TO VERIFY THERE SOME TO ADJUST              DPKCS036
896712*----------------------------------------------------------------*DPKCS036
896713 8000-CHECK-FOR-WORKING-RULES.                                    DPKCS036
896714                                                                          
896715     INITIALIZE PV-RUL-ID.                                                
896716                                                                          
896717     EXEC SQL                                                     DPKCS036
896718        SELECT TR.RUL_ID                                                  
896719        INTO  :PV-RUL-ID                                                  
896720        FROM TRT_RUL TR                                                   
896730            ,TRT_RUL_CNSTR TRC                                            
896740        WHERE TR.RUL_ID             = TRC.RUL_ID                          
896750          AND TR.RUL_TYP_CDE        = 'WKG'                               
896760          AND TR.RUL_BEG_DTE        = :ASC-WEEK-FROM-DTE                  
896770          AND TR.RUL_END_DTE        = :ASC-WEEK-TO-DTE                    
896780          AND TRC.RUL_CNSTR_TYP_CDE = 'POE'                               
896781          AND TRC.RUL_CNSTR_VAL_TXT = :ASC-POE-CDE                        
              FETCH FIRST ROW ONLY                                              
896782     END-EXEC.                                                    DPKCS036
896783                                                                  DPKCS036
896784     EVALUATE TRUE                                                DPKCS036
896785         WHEN SQLCODE = ZERO                                      DPKCS036
896787         WHEN SQLCODE = +100                                      DPKCS036
896788              CONTINUE                                            DPKCS036
896789         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
896790         WHEN SQLCODE NOT = ZERO                                  DPKCS036
896800              MOVE '7200-DELETE-ALL-WKG-RULES'                    DPKCS036
896801                               TO DP013-PARAGRAPH                 DPKCS036
896802              MOVE 'SQL ERROR DELETING WKG RULE'                  DPKCS036
896803                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
896804              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
896805              SET DP013-DB2-ABEND                                 DPKCS036
896806                               TO TRUE                            DPKCS036
896807              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
896808     END-EVALUATE.                                                DPKCS036
896809 EJECT                                                            DPKCS036
896810*----------------------------------------------------------------*DPKCS036
896811*    ABEND PROCESSOR MODULE                                      *DPKCS036
896812*----------------------------------------------------------------*DPKCS036
896813                                                                  DPKCS036
896814     COPY DPPD013.                                                DPKCS036
