000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKRP028.                                00050073
000600 AUTHOR.                 BASKAR SRINI.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           06-20-2011.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  ***  SALES PRE-POSTING BALANCING PROGRAM                      *00120000
001300*                                                                *00130000
001400*       THE PURPOSE OF THIS PROGRAM IS TO DETECT AMOUNT DIFFER-  *00140000
001500*  ENCES IN THIS SALES POSTING FILES WHEN COMPARED WITH AMOUNTS  *00150000
001600*  IN THE SALE AUDIT POSTING SETTLEMENT FILE (ARRD048) WHICH     *00160000
001700*  HOLDS SETTLEMENT AMOUNTS FOR EACH STORE'S CHARGES (KCN) AND   *00170000
001800*  PAYMENTS (KCP).                                               *00180000
001900                                                                  00190000
002000* THIS PROGRAM READS ALL RECORDS IN ALL THE POSTING TRANSACTION  *00200000
002100* FILES ACCUMULATING TOTAL NET CHARGE AMOUNT FOR ALL STORES AND  *00210000
002200* FOR EACH STORE, TOTAL PAYMENT AMOUNT FOR ALL STORES AND FOR    *00220000
002300* EACH STORE, AND TOTAL EMPLOYEE DISCOUNT AMOUNT FOR ALL STORES  *00230000
002400* AND FOR EACH STORE.                                             00240000
002500*                                                                 00250000
002600* THESE AMOUNTS ARE COMPARED TO THE TOTAL CHARGE AMOUNT FOR     * 00260000
002700* ALL STORES AND THE TOTAL PAYMENT AMOUNT FOR ALL STORES FROM   * 00270000
002800* THE SALE AUDIT POSTING TABLE IN WS. IF THE POSTING FILES ARE  * 00280000
002900* NOT WITHIN A THRESHOLD AMOUNT DIFF WITH THE WS TABLE AMOUNTS, * 00290000
003000* GRAND TOTALS FOR EACH STORE TOTALS WILL BE WRITTEN TO THE     * 00300000
003100* REPORT. EACH POSTING FILE VS THE WS TABLE DIFFERENCE IS       * 00310000
003200* INDICATED BY AN ASTERISK ON THE REPORT. AFTER THE PROGRAM IS  * 00320000
003300* FINISHED WITH THE REPORT, THE PROGRAM IS ABORTED.             * 00330000
003400*                                                               * 00340000
003500* IF AMOUNTS ARE IN BALANCE, ONLY THE GRAND TOTAL OF ALL STORES * 00350000
003600* ARE PRINTED WITHOUT A PROGRAM ABORT.                          * 00360000
003700*                                                               * 00370000
003800* SALES-AUDIT-POST-FILE  - THIS IS THE SALES AUDIT POSTING FILE * 00380000
003900* AND WILL CONTAIN 2 CATEGORY RECORDS FOR EACH STORE. CURRENTLY * 00390000
004000* IT HAS AROUND 2100 RECORDS AS WE HAVE AROUND 1000 STORES.     * 00400000
004100* POSTING FILES 1 THRU 8 - THERE ARE 8 POSTING FILES THAT WILL  * 00410000
004200* BE PRODUCED EACH DAY. RECORD LAYOUT MATCHES WITH ARRD021.     * 00420000
004300* THE ABOVE FILES ARE INPUT.                                    * 00430000
004400*                                                               * 00440000
004500* OUTPUT IS A REPORT THAT PRINTS STORES THAT ARE NOT IN BALANCE.* 00450000
004600*                                                               * 00460000
004700***************************************************************** 00470000
004800*  06/XX/2011 BASKI SRINI - CREATED. MOVING THE PROCESS TO IBM  * 00480000
004900*             FROM TANDEM SELECT SYSTEM.                        * 00490000
005000***************************************************************** 00500073
005100*  JAN 2013   JAMES ALT - INCORPORATE THE ASSOCIATE DISCOUNT    * 00510073
005200*             TRANSACTIONS INTO THE POSTING CHARGE TOTAL TO     * 00520072
005300*             REFLECT THE FACT THAT ASSOCIATE DISCOUNT          * 00530073
005400*             TRANSACTIONS ARE INCLUDED IN THE SALES AUDITING   * 00540073
005500*             TOTALS.                                           * 00550073
005600***************************************************************** 00560073
005700 ENVIRONMENT DIVISION.                                            00570073
005800******************************************************************00580073
005900                                                                  00590073
006000 CONFIGURATION SECTION.                                           00600073
006100                                                                  00610073
006200 SOURCE-COMPUTER.        IBM-3090.                                00620073
006300 OBJECT-COMPUTER.        IBM-3090.                                00630073
006400                                                                  00640073
006500 INPUT-OUTPUT SECTION.                                            00650073
006600                                                                  00660073
006700 FILE-CONTROL.                                                    00670073
006800                                                                  00680073
006900     SELECT SALES-AUDIT-POST-FILE                                 00690073
007000         ASSIGN TO ADIT1.                                         00700073
007100                                                                  00710073
007200     SELECT POSTING-TRANS-FILE-1                                  00720073
007300         ASSIGN TO POST1.                                         00730073
007400                                                                  00740073
007500     SELECT POSTING-TRANS-FILE-2                                  00750073
007600         ASSIGN TO POST2.                                         00760073
007700                                                                  00770073
007800     SELECT POSTING-TRANS-FILE-3                                  00780073
007900         ASSIGN TO POST3.                                         00790073
008000                                                                  00800073
008100     SELECT POSTING-TRANS-FILE-4                                  00810073
008200         ASSIGN TO POST4.                                         00820073
008300                                                                  00830073
008400     SELECT POSTING-TRANS-FILE-5                                  00840073
008500         ASSIGN TO POST5.                                         00850073
008600                                                                  00860073
008700     SELECT POSTING-TRANS-FILE-6                                  00870073
008800         ASSIGN TO POST6.                                         00880073
008900                                                                  00890073
009000     SELECT POSTING-TRANS-FILE-7                                  00900073
009100         ASSIGN TO POST7.                                         00910073
009200                                                                  00920073
009300     SELECT POSTING-TRANS-FILE-8                                  00930073
009400         ASSIGN TO POST8.                                         00940073
009500                                                                  00950073
009600     SELECT PREPBAL-REPORT-FILE                                   00960073
009700         ASSIGN TO PRPT.                                          00970073
009800                                                                  00980073
009900******************************************************************00990073
010000 DATA DIVISION.                                                   01000073
010100******************************************************************01010073
010200                                                                  01020073
010300 FILE SECTION.                                                    01030073
010400                                                                  01040073
010500 FD  SALES-AUDIT-POST-FILE                                        01050073
010600     RECORDING MODE IS F                                          01060073
010700     LABEL RECORDS ARE STANDARD                                   01070073
010800     BLOCK CONTAINS 0 RECORDS                                     01080073
010900     RECORD CONTAINS 33 CHARACTERS                                01090073
011000     DATA RECORD IS SALES-AUDIT-POSTNG-RECORD.                    01100073
011100                                                                  01110073
011200 01  SALES-AUDIT-POSTNG-RECORD   PIC X(33).                       01120073
011300                                                                  01130073
011400 FD  POSTING-TRANS-FILE-1                                         01140073
011500     RECORDING MODE IS F                                          01150073
011600     LABEL RECORDS ARE STANDARD                                   01160073
011700     BLOCK CONTAINS 0 RECORDS                                     01170073
011800     RECORD CONTAINS 157 CHARACTERS.                              01180073
011900                                                                  01190073
012000 01  POSTING-TRANS-RECORD-1      PIC X(157).                      01200073
012100                                                                  01210073
012200 FD  POSTING-TRANS-FILE-2                                         01220073
012300     RECORDING MODE IS F                                          01230073
012400     LABEL RECORDS ARE STANDARD                                   01240073
012500     BLOCK CONTAINS 0 RECORDS                                     01250073
012600     RECORD CONTAINS 157 CHARACTERS.                              01260073
012700                                                                  01270073
012800 01  POSTING-TRANS-RECORD-2      PIC X(157).                      01280073
012900                                                                  01290073
013000 FD  POSTING-TRANS-FILE-3                                         01300073
013100     RECORDING MODE IS F                                          01310073
013200     LABEL RECORDS ARE STANDARD                                   01320073
013300     BLOCK CONTAINS 0 RECORDS                                     01330073
013400     RECORD CONTAINS 157 CHARACTERS.                              01340073
013500                                                                  01350073
013600 01  POSTING-TRANS-RECORD-3      PIC X(157).                      01360073
013700                                                                  01370073
013800 FD  POSTING-TRANS-FILE-4                                         01380073
013900     RECORDING MODE IS F                                          01390073
014000     LABEL RECORDS ARE STANDARD                                   01400073
014100     BLOCK CONTAINS 0 RECORDS                                     01410073
014200     RECORD CONTAINS 157 CHARACTERS.                              01420073
014300                                                                  01430073
014400 01  POSTING-TRANS-RECORD-4      PIC X(157).                      01440073
014500                                                                  01450073
014600 FD  POSTING-TRANS-FILE-5                                         01460073
014700     RECORDING MODE IS F                                          01470073
014800     LABEL RECORDS ARE STANDARD                                   01480073
014900     BLOCK CONTAINS 0 RECORDS                                     01490073
015000     RECORD CONTAINS 157 CHARACTERS.                              01500073
015100                                                                  01510073
015200 01  POSTING-TRANS-RECORD-5      PIC X(157).                      01520073
015300                                                                  01530073
015400 FD  POSTING-TRANS-FILE-6                                         01540073
015500     RECORDING MODE IS F                                          01550073
015600     LABEL RECORDS ARE STANDARD                                   01560073
015700     BLOCK CONTAINS 0 RECORDS                                     01570073
015800     RECORD CONTAINS 157 CHARACTERS.                              01580073
015900                                                                  01590073
016000 01  POSTING-TRANS-RECORD-6      PIC X(157).                      01600073
016100                                                                  01610073
016200 FD  POSTING-TRANS-FILE-7                                         01620073
016300     RECORDING MODE IS F                                          01630073
016400     LABEL RECORDS ARE STANDARD                                   01640073
016500     BLOCK CONTAINS 0 RECORDS                                     01650073
016600     RECORD CONTAINS 157 CHARACTERS.                              01660073
016700                                                                  01670073
016800 01  POSTING-TRANS-RECORD-7      PIC X(157).                      01680073
016900                                                                  01690073
017000 FD  POSTING-TRANS-FILE-8                                         01700073
017100     RECORDING MODE IS F                                          01710073
017200     LABEL RECORDS ARE STANDARD                                   01720073
017300     BLOCK CONTAINS 0 RECORDS                                     01730073
017400     RECORD CONTAINS 157 CHARACTERS.                              01740073
017500                                                                  01750073
017600 01  POSTING-TRANS-RECORD-8      PIC X(157).                      01760073
017700                                                                  01770073
017800 FD  PREPBAL-REPORT-FILE                                          01780073
017900     RECORDING MODE IS F                                          01790073
018000     LABEL RECORDS ARE STANDARD                                   01800073
018100     BLOCK CONTAINS 0 RECORDS                                     01810073
018200     RECORD CONTAINS 132 CHARACTERS.                              01820073
018300                                                                  01830073
018400 01  PREPOST-BAL-RECORD          PIC X(132).                      01840073
018500                                                                  01850073
018600*                                                                 01860073
018700 WORKING-STORAGE SECTION.                                         01870073
018800                                                                  01880073
018900*                                                                 01890073
019000*  SALES AUDIT FILE RECORD LAYOUT                                 01900073
019100*                                                                 01910073
019200                                                                  01920073
019300 01 ARRD048-REC.                                                  01930073
019400     COPY ARRD048.                                                01940073
019500                                                                  01950073
019600*                                                                 01960073
019700*  POSTING TRANSACTION FILE                                       01970073
019800*                                                                 01980073
019900                                                                  01990073
020000     COPY ARRD021.                                                02000073
020100                                                                  02010073
020200*                                                                 02020073
020300*  PARAMETER LIST FOR THE CALENDAR SUBROUTINE (DPKUT500)          02030073
020400*                                                                 02040073
020500                                                                  02050073
020600     COPY DPWS500.                                                02060073
020700                                                                  02070073
020800*** STANDARD HEADER LINE - 132 BYTES.                             02080073
020900     COPY DPWS132O.                                               02090073
021000*                                                                 02100073
021100 01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          02110073
021200                                              COMP SYNC.          02120073
021300     88  AC-INVLD-DATA-ON-CONTROL-CARD        VALUE +4008.        02130073
021400     88  AC-INVLD-TRANSACTION                 VALUE +4009.        02140073
021500     88  AC-MISMATCH-AUDIT-TBL                VALUE +4010.        02150073
021600     88  EC-STR-INDX-TABLE-OVERFLOW           VALUE +4011.        02160073
021700     88  CUMULATIVE-CHRG-OVERFLOW             VALUE +4012.        02170073
021800     88  CUMULATIVE-PAYT-OVERFLOW             VALUE +4013.        02180073
021900     88  CUMULATIVE-EMPDSCNT-OVERFLOW         VALUE +4014.        02190073
022000     88  THRESHOLD-COMPUTE-OVERFLOW           VALUE +4015.        02200073
022100                                                                  02210073
022200 01  PS-PROGRAM-SWITCHES.                                         02220073
022300     05  END-OF-AUD-POST-FILE-IND                                 02230073
022400                                 PIC X(1)     VALUE 'N'.          02240073
022500         88  END-OF-AUD-POST-FILE             VALUE 'Y'.          02250073
022600     05 W8-EOF-POSTFILE-1            PIC X(1) VALUE SPACES.       02260073
022700         88 PS-EOF-FILE1                      VALUE "Y".          02270073
022800         88 PS-NO-EOF-FILE1                   VALUE "N".          02280073
022900     05 W8-EOF-POSTFILE-2            PIC X(1) VALUE SPACES.       02290073
023000         88 PS-EOF-FILE2                      VALUE "Y".          02300073
023100         88 PS-NO-EOF-FILE2                   VALUE "N".          02310073
023200     05 W8-EOF-POSTFILE-3            PIC X(1) VALUE SPACES.       02320073
023300         88 PS-EOF-FILE3                      VALUE "Y".          02330073
023400         88 PS-NO-EOF-FILE3                   VALUE "N".          02340073
023500     05 W8-EOF-POSTFILE-4            PIC X(1) VALUE SPACES.       02350073
023600         88 PS-EOF-FILE4                      VALUE "Y".          02360073
023700         88 PS-NO-EOF-FILE4                   VALUE "N".          02370073
023800     05 W8-EOF-POSTFILE-5            PIC X(1) VALUE SPACES.       02380073
023900         88 PS-EOF-FILE5                      VALUE "Y".          02390073
024000         88 PS-NO-EOF-FILE5                   VALUE "N".          02400073
024100     05 W8-EOF-POSTFILE-6            PIC X(1) VALUE SPACES.       02410073
024200         88 PS-EOF-FILE6                      VALUE "Y".          02420073
024300         88 PS-NO-EOF-FILE6                   VALUE "N".          02430073
024400     05 W8-EOF-POSTFILE-7            PIC X(1) VALUE SPACES.       02440073
024500         88 PS-EOF-FILE7                      VALUE "Y".          02450073
024600         88 PS-NO-EOF-FILE7                   VALUE "N".          02460073
024700     05 W8-EOF-POSTFILE-8            PIC X(1) VALUE SPACES.       02470073
024800         88 PS-EOF-FILE8                      VALUE "Y".          02480073
024900         88 PS-NO-EOF-FILE8                   VALUE "N".          02490073
025000     05 W8-STORE-FLAG                PIC X(1) VALUE SPACE.        02500073
025100         88 NO-MORE-STORES                    VALUE 'N'.          02510073
025200         88 MORE-STORES                       VALUE 'Y'.          02520073
025300     05 W8-PRINT-STORE-FLAG          PIC X(1) VALUE SPACE.        02530073
025400         88 DONT-PRINT-STORE                  VALUE 'N'.          02540073
025500         88 PRINT-STORE                       VALUE 'Y'.          02550073
025600     05 W8-CHARGE-FLAG               PIC X(1) VALUE SPACE.        02560073
025700         88 CHARGE-OUT-OF-BALANCE             VALUE 'N'.          02570073
025800         88 CHARGE-IN-BALANCE                 VALUE 'Y'.          02580073
025900     05 W8-PAYMENT-FLAG              PIC X(1) VALUE SPACE.        02590073
026000         88 PAYMENT-OUT-OF-BALANCE            VALUE 'N'.          02600073
026100         88 PAYMENT-IN-BALANCE                VALUE 'Y'.          02610073
026200     05 W8-SAME-STORE-NBR-FLAG       PIC X(1) VALUE SPACE.        02620073
026300         88 SAME-STORE-NBR                    VALUE 'Y'.          02630073
026400         88 DIFF-STORE-NBR                    VALUE 'N'.          02640073
026500                                                                  02650073
026600 01  PC-PROGRAM-CONSTANTS.                                        02660073
026700     05  PC-PROGRAM-NAME         PIC X(8)     VALUE 'ARKRP028'.   02670073
026800     05  PC-MAX-STR-TBL-SIZE     PIC 9(5)     VALUE 2500.         02680073
026900     05  PC-MAX-STR-INDX-USED    PIC 9(8)     VALUE 0.            02690073
027000                                                                  02700073
027100 01  WS-PROGRAM-ACCUMULATORS.                                     02710073
027200     05  W9-POSTING-FILE-NBR     PIC 9(2)     VALUE 0.            02720073
027300     05  WX-SAVE-POSTING-REC     PIC X(157)   VALUE SPACE.        02730073
027400     05  WS-CURRENT-DATE.                                         02740073
027500         10 WS-CURRENT-YY        PIC 9(02)    VALUE ZEROES.       02750073
027600         10 WS-CURRENT-MM        PIC 9(02)    VALUE ZEROES.       02760073
027700         10 WS-CURRENT-DD        PIC 9(02)    VALUE ZEROES.       02770073
027800     05  WS-CURRENT-TIME.                                         02780073
027900         10 WS-CURRENT-HOUR      PIC 9(02)    VALUE ZEROES.       02790073
028000         10 WS-CURRENT-MINUTE    PIC 9(02)    VALUE ZEROES.       02800073
028100     05  PS-INPUT-RCDS-READ      PIC S9(11)   VALUE 0 COMP-3.     02810073
028200     05  W9-VALID-TRANS          PIC 9(4)     VALUE 0.            02820073
028300         88 VALID-TRANS          VALUES 8105 8115 8125 8135 8155  02830073
028400                                        8165 8136 8140 8141 8156  02840073
028500                                        8166 8120 8137.           02850073
028600     05  WX-TRANS-DATE           PIC X(10)    VALUE SPACE.        02860073
028700     05  FILLER REDEFINES WX-TRANS-DATE.                          02870073
028800         10  WX-TRANS-CC         PIC 9(2).                        02880073
028900         10  WX-TRANS-YY         PIC 9(2).                        02890073
029000         10  WX-FILL1            PIC X(1).                        02900073
029100         10  WX-TRANS-MM         PIC 9(2).                        02910073
029200         10  WX-FILL2            PIC X(1).                        02920073
029300         10  WX-TRANS-DD         PIC 9(2).                        02930073
029400                                                                  02940073
029500     05 WC-AUDIT-TOTAL-CHARGE-AMT  PIC S9(9)V99 VALUE ZERO COMP-3.02950073
029600     05 WC-AUDIT-TOTAL-PAYMENT-AMT PIC S9(9)V99 VALUE ZERO COMP-3.02960073
029700     05 WC-AUDIT-CHARGE-AMT-SUM    PIC S9(9)V99 VALUE ZERO COMP-3.02970073
029800     05 WC-AUDIT-PAYMENT-AMT-SUM   PIC S9(9)V99 VALUE ZERO COMP-3.02980073
029900     05 WC-THRESHLD-CHARGE-AMT-MAX PIC S9(9)V99 VALUE ZERO COMP-3.02990073
030000     05 WC-THRESHLD-PAYMNT-AMT-MAX PIC S9(9)V99 VALUE ZERO COMP-3.03000073
030100     05 WC-THRESHLD-CHARGE-AMT-MIN PIC S9(9)V99 VALUE ZERO COMP-3.03010073
030200     05 WC-THRESHLD-PAYMNT-AMT-MIN PIC S9(9)V99 VALUE ZERO COMP-3.03020073
030300     05 WC-POSTING-TOTL-CHARGE-AMT PIC S9(9)V99 VALUE ZERO COMP-3.03030073
030400     05 WC-POSTING-TOTL-PAYMNT-AMT PIC S9(9)V99 VALUE ZERO COMP-3.03040073
030500     05 WC-POSTING-TOTL-EMPDSC-AMT PIC S9(9)V99 VALUE ZERO COMP-3.03050073
030600     05 WC-TOTAL-CHARGE-DIFFERENCE PIC S9(9)V99 VALUE ZERO COMP-3.03060073
030700     05 WC-TOTAL-PAYMNT-DIFFERENCE PIC S9(9)V99 VALUE ZERO COMP-3.03070073
030800     05 WC-AMOUNT-9-DEFAULT        PIC S9(9)V99 VALUE             03080073
030900                                                +999999999.99.    03090073
031000     05 WC-AMOUNT-0-DEFAULT        PIC S9(9)V99 VALUE 0.00.       03100073
031100     05 WX-ERROR-MSG               PIC X(72)    VALUE SPACES.     03110073
031200***************************************************************** 03120073
031300***       C O N T R O L  C A R D  P A R A M E T E R S         *** 03130073
031400*                                                                 03140073
031500* PROCESSING-DATE.......THE SYSTEM DATE FOR TRANSACTION POSTING   03150073
031600* CHARGE CATEGORY.......CODE FOR CHARGE RECORDS IN WS TABLE       03160073
031700* PAYMNT CATEGORY.......CODE FOR PAYMNT RECORDS IN WS TABLE       03170073
031800* TOTALS-STORE-NBR......THE STORE NBR FOR GRAND TOTAL ROWS        03180073
031900* THRESHOLD-CHARGE-AMT..AN AMOUNT ADDED TO/SUBTRACTED FROM THE    03190073
032000*                       GRAND TOTAL CHARGE AMOUNT FOUND IN THE    03200073
032100*                       WS TABLE. TOTAL CHARGES IN THE POSTING    03210073
032200*                       FILES MUST FALL WITHIN THE RANGE OF THE   03220073
032300*                       CALCULATED AMOUNTS.                       03230073
032400* THRESHOLD-PAYMNT-AMT..AN AMOUNT ADDED TO/SUBTRACTED FROM THE    03240073
032500*                       GRAND TOTAL PAYMENT AMOUNT FOUND IN THE   03250073
032600*                       WS TABLE. TOTAL PAYMNTS IN THE POSTING    03260073
032700*                       FILES MUST FALL WITHIN THE RANGE OF THE   03270073
032800*                       CALCULATED AMOUNTS.                       03280073
032900* LIST-STORES-FLAG......Y/N FLAG TO INDICATE WHICH STORES TO PRINT03290073
033000*                       Y - PRINT ALL STORES                      03300073
033100*                       N - PRINT OUT OF BAL STORES ONLY          03310073
033200*----------------------------------------------------------------*03320073
033300 01  CC-CONTROL-CARD.                                             03330073
033400     05  CC-CONTROL-CARD-DISPLAY.                                 03340073
033500         10  CC-POS-DATE-MDY            PIC 9(08) VALUE ZERO.     03350073
033600         10  FILLER REDEFINES CC-POS-DATE-MDY.                    03360073
033700             15  CC-POS-MONTH           PIC 9(02).                03370073
033800             15  CC-POS-DAY             PIC 9(02).                03380073
033900             15  CC-POS-CENTURY         PIC 9(02).                03390073
034000             15  CC-POS-YEAR            PIC 9(02).                03400073
034100         10  CC-POST-CHARGE-CTG         PIC X(03).                03410073
034200         10  CC-POST-PAYMNT-CTG         PIC X(03).                03420073
034300         10  CC-POST-TOT-STORE-NBR      PIC 9(03).                03430073
034400         10  CC-POST-CHARGE-THRESHOLD   PIC 9(08).                03440073
034500         10  CC-POST-PAYMNT-THRESHOLD   PIC 9(08).                03450073
034600         10  CC-POST-TOTAL-FILES        PIC 9(02).                03460073
034700         10  CC-LIST-STORES-FLAG        PIC X(01).                03470073
034800             88 LIST-ALL-STORES         VALUE 'Y'.                03480073
034900             88 LIST-OUT-OF-BAL-STORES  VALUE 'N'.                03490073
035000     05  FILLER                         PIC X(44) VALUE SPACES.   03500073
035100                                                                  03510073
035200***************************************************************** 03520073
035300*      *** AUDIT POSTING FILE TABLE ***                         * 03530073
035400***************************************************************** 03540073
035500                                                                  03550073
035600 01  ADT-POSTING-FILE-TABLE.                                      03560073
035700     05  ADT-POSTING-FILE-ENTRY  OCCURS 5000 TIMES                03570073
035800                                 INDEXED BY AUD-INDX.             03580073
035900         10  ADT-SYSTEM-DTE      PIC X(10).                       03590073
036000         10  ADT-STORE-NBR       PIC 9(08).                       03600073
036100         10  ADT-CATEGORY-CDE    PIC X(03).                       03610073
036200         10  ADT-SETTLEMNT-AMT   PIC S9(9)V99                     03620073
036300                                 SIGN IS LEADING SEPARATE.        03630073
036400*                                                                 03640073
036500* THE "POSTING" FIELDS HOLD AMOUNTS ACCUMULATED FROM THE POSTING *03650073
036600* FILES. THE "AUDIT" FILEDS HOLDS AMOUNTS ACCUMULATED FROM THE   *03660073
036700* ADT-POSTING-FILE-TABLE.                                         03670073
036800*                                                                 03680073
036900 01 EG-POSTING-STORE-TABLE.                                       03690073
037000    05 EG-POSTING-STORE-TBL-DATA     OCCURS 2500 TIMES            03700073
037100                                     INDEXED BY WC-STR-INDX.      03710073
037200       10 EC-STORE-NBR               PIC  9(8)         VALUE 0.   03720073
037300       10 EC-POSTING-CHARGE-AMT      PIC S9(9)V99 COMP VALUE 0.   03730073
037400       10 EC-POSTING-PAYMENT-AMT     PIC S9(9)V99 COMP VALUE 0.   03740073
037500       10 EC-AUDIT-CHARGE-AMT        PIC S9(9)V99 COMP VALUE 0.   03750073
037600       10 EC-AUDIT-PAYMNT-AMT        PIC S9(9)V99 COMP VALUE 0.   03760073
037700       10 EC-POSTING-EMPL-DISCNT-AMT PIC S9(9)V99 COMP VALUE 0.   03770073
037800       10 EC-CHARGE-DIFFERENCE       PIC S9(9)V99 COMP VALUE 0.   03780073
037900       10 EC-PAYMENT-DIFFERENCE      PIC S9(9)V99 COMP VALUE 0.   03790073
038000                                                                  03800073
038100 01 PREBAL-REPORT.                                                03810073
038200    05 PR-DTL1-STORE-NBR        PIC Z(02)9(03)  VALUE SPACES.     03820073
038300    05 PR-REPORT-LINES          PIC S9(4)  COMP VALUE +0.         03830073
038400    05 PR-LINE-COUNT            PIC S9(4)  COMP VALUE +61.        03840073
038500    05 PR-PAGE-COUNT            PIC S9(4)  COMP VALUE 0.          03850073
038600    05 PR-REPORT-NBR            PIC S9(4)  COMP VALUE +1.         03860073
038700                                                                  03870073
038800    05 PR-REPORT-HEADER.                                          03880073
038900       10 FILLER                PIC X(48) VALUE SPACE.            03890073
039000       10 WG-REPORT-TITLE       PIC X(29) VALUE                   03900073
039100                                   "PRE-POSTING BALANCING REPORT".03910073
039200       10 FILLER                PIC X(55) VALUE SPACE.            03920073
039300                                                                  03930073
039400    05 PR-REPORT-HEADER-LINE1.                                    03940073
039500       10 FILLER                PIC X(10) VALUE 'POST DATE '.     03950073
039600       10 FILLER                PIC X(03) VALUE SPACES.           03960073
039700       10 FILLER                PIC X(05) VALUE 'STORE'.          03970073
039800       10 FILLER                PIC X(01) VALUE SPACES.           03980073
039900       10 FILLER                PIC X(15) VALUE '   AUDIT CHARGE'.03990073
040000       10 FILLER                PIC X(01) VALUE SPACES.           04000073
040100       10 FILLER                PIC X(15) VALUE '    POST CHARGE'.04010073
040200       10 FILLER                PIC X(02) VALUE SPACES.           04020073
040300       10 FILLER                PIC X(14) VALUE '   CHARGE DIFF'. 04030073
040400       10 FILLER                PIC X(02) VALUE SPACES.           04040073
040500       10 FILLER                PIC X(15) VALUE '   AUDIT PAYMNT'.04050073
040600       10 FILLER                PIC X(01) VALUE SPACES.           04060073
040700       10 FILLER                PIC X(15) VALUE '    POST PAYMNT'.04070073
040800       10 FILLER                PIC X(04) VALUE SPACES.           04080073
040900       10 FILLER                PIC X(14) VALUE '   PAYMNT DIFF'. 04090073
041000       10 FILLER                PIC X(01) VALUE SPACES.           04100073
041100       10 FILLER                PIC X(15) VALUE '  EMPL DISCNT '. 04110073
041200                                                                  04120073
041300    05 PR-REPORT-DETAIL-1.                                        04130073
041400     10 PR-DTL1-PROCESS-DATE          PIC X(10) VALUE SPACE.      04140073
041500     10 FILLER                        PIC X(03) VALUE SPACE.      04150073
041600     10 PR-DTL1-STORE-NBR-TEXT        PIC X(05) VALUE SPACE.      04160073
041700        88 W88-DTL1-TOTALS-TXT            VALUE 'TOTAL'.          04170073
041800     10 FILLER                        PIC X(01) VALUE SPACES.     04180073
041900     10 PR-DTL1-ADT-CHRG-AMT          PIC $$$$,$$$,$$9.99-.       04190073
042000     10 PR-DTL1-PST-CHRG-AMT          PIC $$$$,$$$,$$9.99-.       04200073
042100     10 FILLER                        PIC X(01) VALUE SPACE.      04210073
042200     10 PR-DTL1-CHARGE-DIFF           PIC $$$,$$$,$$9.99-.        04220073
042300     10 FILLER                        PIC X(02) VALUE SPACES.     04230073
042400     10 PR-DTL1-ADT-PYMNT-AMT         PIC $$$,$$$,$$9.99-.        04240073
042500     10 FILLER                        PIC X(01) VALUE SPACE.      04250073
042600     10 PR-DTL1-PST-PYMNT-AMT         PIC $$$,$$$,$$9.99-.        04260073
042700     10 FILLER                        PIC X(01) VALUE SPACE.      04270073
042800     10 PR-DTL1-PAYMENT-DIFF          PIC $$$,$$$,$$9.99-.        04280073
042900     10 FILLER                        PIC X(01) VALUE SPACES.     04290073
043000     10 PR-DTL1-EMP-DISC-AMT          PIC $$$,$$$,$$9.99-.        04300073
043100                                                                  04310073
043200   05 PR-REPORT-DETAIL-2.                                         04320073
043300     10 FILLER                        PIC X(33) VALUE SPACES.     04330073
043400     10 FILLER                        PIC X(18) VALUE             04340073
043500                                          'CHARGE THRESHOLD'.     04350073
043600     10 FILLER                        PIC X(01) VALUE SPACES.     04360073
043700     10 PR-DTL2-THRSHLD-CHRG          PIC $$$,$$$,$$9.99.         04370073
043800     10 FILLER                        PIC X(14) VALUE SPACES.     04380073
043900     10 FILLER                        PIC X(19) VALUE             04390073
044000                                          'PAYMENT THRESHOLD'.    04400073
044100     10 FILLER                        PIC X(02) VALUE SPACES.     04410073
044200     10 PR-DTL2-THRSHLD-PYMT          PIC $$$,$$$,$$9.99.         04420073
044300                                                                  04430073
044400 05 PR-EMPTY-REPORT.                                              04440073
044500     10 FILLER                        PIC X(40).                  04450073
044600     10 FILLER                        PIC X(42) VALUE             04460073
044700        '   ****    NO DATA TO REPORT     ****    '.              04470073
044800     10 FILLER                        PIC X(50).                  04480073
044900                                                                  04490073
045000 05 PR-MESSAGE-RPT.                                               04500073
045100     10 FILLER                        PIC X(02) VALUE SPACES.     04510073
045200     10 PR-MESSAGE                    PIC X(70) VALUE SPACES.     04520073
045300     10 FILLER                        PIC X(60).                  04530073
045400                                                                  04540073
045500******************************************************************04550073
045600 PROCEDURE DIVISION.                                              04560073
045700******************************************************************04570073
045800                                                                  04580073
045900 0000-MAINLINE.                                                   04590073
046000                                                                  04600073
046100     PERFORM 1000-INITIALIZE.                                     04610073
046200                                                                  04620073
046300     PERFORM 2000-PROCESS-POSTING-FILES                           04630073
046400       UNTIL W9-POSTING-FILE-NBR > CC-POST-TOTAL-FILES.           04640073
046500                                                                  04650073
046600     SET PC-MAX-STR-INDX-USED TO WC-STR-INDX.                     04660073
046700     PERFORM 3000-VALIDATE-AMOUNTS.                               04670073
046800                                                                  04680073
046900     IF PR-REPORT-LINES = 0                                       04690073
047000        PERFORM 6000-WRITE-HEADERS                                04700073
047100        WRITE PREPOST-BAL-RECORD  FROM PR-EMPTY-REPORT            04710073
047200              AFTER ADVANCING 2 LINES                             04720073
047300     END-IF.                                                      04730073
047400                                                                  04740073
047500     PERFORM 9000-EOJ-ROUTINE.                                    04750073
047600                                                                  04760073
047700     GOBACK.                                                      04770073
047800******************************************************************04780073
047900*  SET UP FOR PROGRAM PROCESSING BY ACCEPTING, DISPLAYING, AND   *04790073
048000*  VALIDATING THE CONTROL CARD, COMPUTING APPLICABLE DISCOUNT    *04800073
048100*  PERCENTAGES, OPENING ALL FILES, AND READING THE               *04810073
048200*  FIRST ACCOUNTS RECEIVABLE TRANSACTION RECORD.                 *04820073
048300******************************************************************04830073
048400                                                                  04840073
048500 1000-INITIALIZE.                                                 04850073
048600                                                                  04860073
048700     ACCEPT CC-CONTROL-CARD.                                      04870073
048800     DISPLAY PC-PROGRAM-NAME  ' - CONTROL CARD = ('               04880073
048900             CC-CONTROL-CARD-DISPLAY  ')'.                        04890073
049000                                                                  04900073
049100     PERFORM 1100-VALIDATE-CONTROL-CARD.                          04910073
049200                                                                  04920073
049300     OPEN INPUT  SALES-AUDIT-POST-FILE                            04930073
049400                 POSTING-TRANS-FILE-1                             04940073
049500                 POSTING-TRANS-FILE-2                             04950073
049600                 POSTING-TRANS-FILE-3                             04960073
049700                 POSTING-TRANS-FILE-4                             04970073
049800                 POSTING-TRANS-FILE-5                             04980073
049900                 POSTING-TRANS-FILE-6                             04990073
050000                 POSTING-TRANS-FILE-7                             05000073
050100                 POSTING-TRANS-FILE-8.                            05010073
050200                                                                  05020073
050300     OPEN OUTPUT PREPBAL-REPORT-FILE.                             05030073
050400                                                                  05040073
050500* SET REPORT HEADER DATE AND TIME                                 05050073
050600     ACCEPT WS-CURRENT-DATE FROM DATE.                            05060073
050700     ACCEPT WS-CURRENT-TIME FROM TIME.                            05070073
050800                                                                  05080073
050900     MOVE WS-CURRENT-YY            TO DP132O-RUN-YEAR.            05090073
051000     MOVE WS-CURRENT-MM            TO DP132O-RUN-MONTH.           05100073
051100     MOVE WS-CURRENT-DD            TO DP132O-RUN-DAY.             05110073
051200                                                                  05120073
051300     MOVE WS-CURRENT-HOUR          TO DP132O-RUN-HOUR.            05130073
051400     MOVE WS-CURRENT-MINUTE        TO DP132O-RUN-MINUTE.          05140073
051500                                                                  05150073
051600     MOVE PC-PROGRAM-NAME          TO DP132O-PROGRAM-NAME.        05160073
051700                                                                  05170073
051800* LOAD SALES AUDIT INPUT FILE TO WORKING STORAGE                  05180073
051900                                                                  05190073
052000     SET  AUD-INDX    TO 1.                                       05200073
052100     SET  WC-STR-INDX TO 1.                                       05210073
052200     MOVE 'N'         TO W8-SAME-STORE-NBR-FLAG.                  05220073
052300     ADD  1           TO W9-POSTING-FILE-NBR.                     05230073
052400                                                                  05240073
052500     MOVE SPACES      TO ADT-POSTING-FILE-TABLE.                  05250073
052600     PERFORM 1300-LOAD-POSTING-FILE-WSTBL                         05260073
052700       UNTIL END-OF-AUD-POST-FILE.                                05270073
052800                                                                  05280073
052900* READ ALL 8 INPUT POSTING FILES                                  05290073
053000                                                                  05300073
053100     PERFORM 7000-READ-POSTING-FILE.                              05310073
053200*                                                                 05320073
053300******************************************************************05330073
053400*  VALIDATE THE CONTROL CARD.  ENSURE THAT A VALID P.O.S. DATE   *05340073
053500*  HAS BEEN PROVIDED.  ENSURE THAT ALL DISCOUNT PERCENTAGES      *05350073
053600*  ARE NUMERIC, ARE GREATER THAN ZERO, AND ARE PRECEEDED BY THE  *05360073
053700*  APPROPRIATE IDENTIFYING LITERAL.                              *05370073
053800******************************************************************05380073
053900                                                                  05390073
054000 1100-VALIDATE-CONTROL-CARD.                                      05400073
054100                                                                  05410073
054200     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05420073
054300     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     05430073
054400     SET DPG52-LK-DTE-GREG-CC        TO TRUE.                     05440073
054500     MOVE CC-POS-DATE-MDY            TO DPG52-LK-DATE-INPUT.      05450073
054600                                                                  05460073
054700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05470073
054800                                             DPG54 DPG55 DPG56.   05480073
054900     IF DPG54-DATE-INVALID                                        05490073
055000        DISPLAY '*** ABEND ***'                                   05500073
055100        DISPLAY '*** PROGRAM = ARKRP028'                          05510073
055200        DISPLAY '*** PARA = 1100-VALIDATE-CONTROL-CARD'           05520073
055300        DISPLAY '*** INVALID CONTROL CARD DATE   ***'             05530073
055400        MOVE +4008  TO   ABEND-CODE                               05540073
055500        CALL 'ILBOABN0' USING ABEND-CODE                          05550073
055600     END-IF.                                                      05560073
055700                                                                  05570073
055800******************************************************************05580073
055900*    LOAD THE AUDIT POSTING SETTLEMENT AMOUNT AND CATEGORY FOR   *05590073
056000*    EACH STORE TO WORKING STORAGE TABLE.                        *05600073
056100******************************************************************05610073
056200                                                                  05620073
056300 1300-LOAD-POSTING-FILE-WSTBL.                                    05630073
056400                                                                  05640073
056500     READ SALES-AUDIT-POST-FILE                                   05650073
056600     INTO AR048-SALES-AUDIT-POSTING-REC                           05660073
056700          AT END                                                  05670073
056800             SET END-OF-AUD-POST-FILE TO TRUE                     05680073
056900             NOT AT END                                           05690073
057000                 PERFORM 1350-LOAD-WS-TABLE                       05700073
057100     END-READ.                                                    05710073
057200                                                                  05720073
057300 1350-LOAD-WS-TABLE.                                              05730073
057400                                                                  05740073
057500     MOVE AR048-SA-SELECT-SYSTEM-DTE   TO ADT-SYSTEM-DTE          05750073
057600                                                 (AUD-INDX)       05760073
057700     MOVE AR048-SA-STR-NBR             TO ADT-STORE-NBR           05770073
057800                                                 (AUD-INDX)       05780073
057900     MOVE AR048-SA-TRN-CTG-CDE         TO ADT-CATEGORY-CDE        05790073
058000                                                 (AUD-INDX)       05800073
058100     MOVE AR048-SA-STTLMNT-AMT         TO ADT-SETTLEMNT-AMT       05810073
058200                                                 (AUD-INDX)       05820073
058300     SET AUD-INDX UP BY 1.                                        05830073
058400                                                                  05840073
058500******************************************************************05850073
058600*  PROCESS POSTING FILES 1 BY 1                                  *05860073
058700*  PROCESS EACH RECORD IN THE POSTING TRANSACTION FILE.          *05870073
058800*  TRANSACTION AMOUNTS ARE ADDED TO OR SUBTRACTED FROM THE CHARGE*05880073
058900*  AND PAYMENT VALUES IN THE STORE TABLE. THE STORE NMBER IS USED*05890073
059000*  AS AN INDEX TO THE STORE TABLE. THE HIGHEST INDEX VALUE IS    *05900073
059100*  SAVED SO THAT IF THE STORE TABLE MUST BE PRINTED ON THE REPORT*05910073
059200*  ONLY ROWS WITH DATA ARE PROCESSED.                             05920073
059300*  TRANSACTION AMOUNTS ARE ACCUMULATED AS FOLLOWS :               05930073
059400*  TRAN 8105, 8141 - ADD TO CHARGE CATEGORY                       05940073
059500*  TRAN 8115, 8136, 8140 - SUBTRACT FROM CHARGE CATEGORY          05950073
059600*  TRAN 8125, 8137 - ADD TO PAYMENT CATEGORY                      05960073
059700*  TRAN 8135, 8120 - SUBTRACT FROM PAYMENT CATEGORY               05970073
059800*  TRAN 8155, 8156 - ADD TO EMPLOYEE DISCOUNT CATEGORY            05980073
059900*  TRAN 8165, 8166 - SUBTRACT FROM EMPLOYEE DISCOUNT CATEGORY     05990073
060000******************************************************************06000073
060100                                                                  06010073
060200 2000-PROCESS-POSTING-FILES.                                      06020073
060300                                                                  06030073
060400     IF WC-STR-INDX > PC-MAX-STR-TBL-SIZE                         06040073
060500        DISPLAY '*** ABEND ***'                                   06050073
060600        DISPLAY '*** PROGRAM = ARKRP028'                          06060073
060700        DISPLAY '*** PARA = 2000-PROCESS-POSTING-FILES'           06070073
060800        DISPLAY 'POSTING STORE TABLE OVERFLOW'                    06080073
060900        MOVE +4011  TO   ABEND-CODE                               06090073
061000        CALL 'ILBOABN0' USING ABEND-CODE                          06100073
061100     END-IF.                                                      06110073
061200                                                                  06120073
061300     IF (WC-STR-INDX = 1) AND (DIFF-STORE-NBR)                    06130073
061400        MOVE AR021-MERCHANT-ID      TO EC-STORE-NBR (WC-STR-INDX) 06140073
061500        MOVE "Y"                    TO W8-SAME-STORE-NBR-FLAG     06150073
061600     ELSE                                                         06160073
061700        IF AR021-MERCHANT-ID > EC-STORE-NBR (WC-STR-INDX)         06170073
061800           SET WC-STR-INDX UP BY 1                                06180073
061900           MOVE AR021-MERCHANT-ID   TO EC-STORE-NBR (WC-STR-INDX) 06190073
062000        END-IF                                                    06200073
062100     END-IF.                                                      06210073
062200                                                                  06220073
062300     IF AR021-TRANS-TYPE IS NUMERIC                               06230073
062400        MOVE AR021-TRANS-TYPE   TO W9-VALID-TRANS.                06240073
062500     IF AR021-AR-POSTING-RECORD NOT = WX-SAVE-POSTING-REC         06250073
062600     AND VALID-TRANS                                              06260073
062700        PERFORM 2500-COMPUTE-TRANS-CHARGES                        06270073
062800     END-IF.                                                      06280073
062900                                                                  06290073
063000     PERFORM 7000-READ-POSTING-FILE.                              06300073
063100                                                                  06310073
063200 2500-COMPUTE-TRANS-CHARGES.                                      06320073
063300                                                                  06330073
063400     EVALUATE AR021-TRANS-TYPE OF AR021-AR-POSTING-RECORD         06340073
063500         WHEN 8105                                                06350073
063600         WHEN 8141                                                06360073
063700            PERFORM 4000-ADD-POST-CHARGE                          06370073
063800         WHEN 8115                                                06380073
063900         WHEN 8136                                                06390073
064000         WHEN 8140                                                06400073
064100            PERFORM 4100-SUBTRACT-POST-CHARGE                     06410073
064200         WHEN 8125                                                06420073
064300         WHEN 8137                                                06430073
064400            PERFORM 4200-ADD-POST-PAYMENT                         06440073
064500         WHEN 8135                                                06450073
064600         WHEN 8120                                                06460073
064700            PERFORM 4300-SUBTRACT-POST-PAYMENT                    06470073
064800         WHEN 8155                                                06480073
064900         WHEN 8156                                                06490073
065000            PERFORM 4400-ADD-POST-DISCOUNT                        06500073
065100         WHEN 8165                                                06510073
065200         WHEN 8166                                                06520073
065300            PERFORM 4500-SUBTRACT-POST-DISCOUNT                   06530073
065400         WHEN OTHER                                               06540073
065500              DISPLAY '*** ABEND ***'                             06550073
065600              DISPLAY '*** PROGRAM = ARKRP028'                    06560073
065700              DISPLAY '*** PARA = 2000-PROCESS-POSTING-FILES'     06570073
065800              DISPLAY '*** INVALID TRANSACTION CODE : '           06580073
065900              DISPLAY AR021-TRANS-TYPE OF AR021-AR-POSTING-RECORD 06590073
066000              MOVE +4009  TO   ABEND-CODE                         06600073
066100              CALL 'ILBOABN0' USING ABEND-CODE                    06610073
066200     END-EVALUATE.                                                06620073
066300                                                                  06630073
066400     MOVE AR021-AR-POSTING-RECORD  TO WX-SAVE-POSTING-REC.        06640073
066500                                                                  06650073
066600                                                                  06660073
066700 3000-VALIDATE-AMOUNTS.                                           06670073
066800                                                                  06680073
066900     SET CHARGE-IN-BALANCE          TO TRUE                       06690073
067000     SET PAYMENT-IN-BALANCE         TO TRUE                       06700073
067100     MOVE CC-POS-MONTH              TO WX-TRANS-MM                06710073
067200     MOVE CC-POS-DAY                TO WX-TRANS-DD                06720073
067300     MOVE CC-POS-CENTURY            TO WX-TRANS-CC                06730073
067400     MOVE CC-POS-YEAR               TO WX-TRANS-YY                06740073
067500     MOVE '-'                       TO WX-FILL1 WX-FILL2          06750073
067600                                                                  06760073
067700* SELECT THE ROW WITH THE GRAND TOTAL CHARGE AMOUNT.              06770073
067800* CC-POST-TOT-STORE-NBR = 0 IS THE STORE CONTAINING TOTAL AMOUNT. 06780073
067900                                                                  06790073
068000     SET AUD-INDX                   TO 1                          06800073
068100     SEARCH ADT-POSTING-FILE-ENTRY VARYING AUD-INDX               06810073
068200         AT END                                                   06820073
068300              DISPLAY '*** ABEND ***'                             06830073
068400              DISPLAY '*** PROGRAM = ARKRP028'                    06840073
068500              DISPLAY '*** PARA = 3000-VALIDATE-AMOUNTS'          06850073
068600              DISPLAY '*** NO CHARGE ROW IN AUDIT TBL'            06860073
068700              STRING  WX-TRANS-DATE                               06870073
068800                      ' ' CC-POST-TOT-STORE-NBR                   06880073
068900                      ' ' CC-POST-CHARGE-CTG DELIMITED BY SIZE    06890073
069000                INTO  WX-ERROR-MSG                                06900073
069100              END-STRING                                          06910073
069200              DISPLAY WX-ERROR-MSG                                06920073
069300              MOVE +4010  TO   ABEND-CODE                         06930073
069400              CALL 'ILBOABN0' USING ABEND-CODE                    06940073
069500                                                                  06950073
069600       WHEN WX-TRANS-DATE         = ADT-SYSTEM-DTE   (AUD-INDX)   06960073
069700        AND CC-POST-TOT-STORE-NBR = ADT-STORE-NBR    (AUD-INDX)   06970073
069800        AND CC-POST-CHARGE-CTG    = ADT-CATEGORY-CDE (AUD-INDX)   06980073
069900            MOVE ADT-SETTLEMNT-AMT (AUD-INDX)                     06990073
070000              TO WC-AUDIT-TOTAL-CHARGE-AMT                        07000073
070100                                                                  07010073
070200     END-SEARCH.                                                  07020073
070300                                                                  07030073
070400* SELECT THE ROW WITH THE GRAND TOTAL PAYMENT AMOUNT.             07040073
070500                                                                  07050073
070600     SEARCH ADT-POSTING-FILE-ENTRY VARYING AUD-INDX               07060073
070700         AT END                                                   07070073
070800              DISPLAY '*** ABEND ***'                             07080073
070900              DISPLAY '*** PROGRAM = ARKRP028'                    07090073
071000              DISPLAY '*** PARA = 3000-VALIDATE-AMOUNTS'          07100073
071100              DISPLAY '*** NO PAYMENT ROW IN AUDIT TBL'           07110073
071200              STRING  WX-TRANS-DATE                               07120073
071300                      ' ' CC-POST-TOT-STORE-NBR                   07130073
071400                      ' ' CC-POST-CHARGE-CTG DELIMITED BY SIZE    07140073
071500                INTO  WX-ERROR-MSG                                07150073
071600              END-STRING                                          07160073
071700              DISPLAY WX-ERROR-MSG                                07170073
071800              MOVE +4010  TO   ABEND-CODE                         07180073
071900              CALL 'ILBOABN0' USING ABEND-CODE                    07190073
072000                                                                  07200073
072100       WHEN WX-TRANS-DATE         = ADT-SYSTEM-DTE   (AUD-INDX)   07210073
072200        AND CC-POST-TOT-STORE-NBR = ADT-STORE-NBR    (AUD-INDX)   07220073
072300        AND CC-POST-PAYMNT-CTG    = ADT-CATEGORY-CDE (AUD-INDX)   07230073
072400            MOVE ADT-SETTLEMNT-AMT (AUD-INDX)                     07240073
072500              TO WC-AUDIT-TOTAL-PAYMENT-AMT                       07250073
072600                                                                  07260073
072700     END-SEARCH.                                                  07270073
072800                                                                  07280073
072900     PERFORM 5000-CALC-THRSHLD-MIN-MAX.                           07290073
073000                                                                  07300073
073100* COMPARE POSTING CHARGE AMOUNT TO THE SALES AUDIT CHARGE AMT AND 07310073
073200* THE THRESHOLD CHARGE AMOUNT. COMPARE PAYMENT AMOUNT TO THE SALES07320073
073300* AUDIT PAYMENT AMOUNT AND THE THRESHOLD PAYMENT AMOUNT.          07330073
073400*----------------------------------------------------------------*07340073
073500     IF WC-POSTING-TOTL-CHARGE-AMT NOT =                          07350073
073600        WC-AUDIT-TOTAL-CHARGE-AMT                                 07360073
073700        COMPUTE WC-TOTAL-CHARGE-DIFFERENCE                        07370073
073800              = WC-AUDIT-TOTAL-CHARGE-AMT                         07380073
073900              - WC-POSTING-TOTL-CHARGE-AMT                        07390073
074000             ON SIZE ERROR                                        07400073
074100                MOVE WC-AMOUNT-9-DEFAULT                          07410073
074200                  TO WC-TOTAL-CHARGE-DIFFERENCE                   07420073
074300        END-COMPUTE                                               07430073
074400     END-IF                                                       07440073
074500                                                                  07450073
074600     IF WC-POSTING-TOTL-CHARGE-AMT < WC-THRESHLD-CHARGE-AMT-MIN   07460073
074700     OR WC-POSTING-TOTL-CHARGE-AMT > WC-THRESHLD-CHARGE-AMT-MAX   07470073
074800        SET CHARGE-OUT-OF-BALANCE  TO TRUE                        07480073
074900     END-IF.                                                      07490073
075000                                                                  07500073
075100     IF WC-POSTING-TOTL-PAYMNT-AMT NOT =                          07510073
075200        WC-AUDIT-TOTAL-PAYMENT-AMT                                07520073
075300        COMPUTE WC-TOTAL-PAYMNT-DIFFERENCE                        07530073
075400              = WC-AUDIT-TOTAL-PAYMENT-AMT                        07540073
075500              - WC-POSTING-TOTL-PAYMNT-AMT                        07550073
075600             ON SIZE ERROR                                        07560073
075700                MOVE WC-AMOUNT-9-DEFAULT                          07570073
075800                  TO WC-TOTAL-PAYMNT-DIFFERENCE                   07580073
075900         END-COMPUTE                                              07590073
076000     ELSE                                                         07600073
076100         MOVE WC-AMOUNT-0-DEFAULT                                 07610073
076200           TO WC-TOTAL-PAYMNT-DIFFERENCE                          07620073
076300     END-IF.                                                      07630073
076400                                                                  07640073
076500     IF WC-POSTING-TOTL-PAYMNT-AMT < WC-THRESHLD-PAYMNT-AMT-MIN   07650073
076600     OR WC-POSTING-TOTL-PAYMNT-AMT > WC-THRESHLD-PAYMNT-AMT-MAX   07660073
076700        SET PAYMENT-OUT-OF-BALANCE TO TRUE                        07670073
076800     END-IF.                                                      07680073
076900                                                                  07690073
077000     IF CHARGE-OUT-OF-BALANCE                                     07700073
077100     OR PAYMENT-OUT-OF-BALANCE                                    07710073
077200        PERFORM 5200-OUT-OF-BAL-PROCESS                           07720073
077300     ELSE                                                         07730073
077400        PERFORM 5400-IN-BAL-PROCESS                               07740073
077500     END-IF.                                                      07750073
077600                                                                  07760073
077700*----------------------------------------------------------------*07770073
077800* ADD POSTING CHARGE AMOUNT TO STORE TOTAL AND GRAND TOTAL.       07780073
077900*----------------------------------------------------------------*07790073
078000 4000-ADD-POST-CHARGE.                                            07800073
078100                                                                  07810073
078200     COMPUTE EC-POSTING-CHARGE-AMT (WC-STR-INDX)                  07820073
078300           = EC-POSTING-CHARGE-AMT (WC-STR-INDX)                  07830073
078400           + AR021-AMOUNT OF AR021-AR-POSTING-RECORD              07840073
078500             ON SIZE ERROR                                        07850073
078600                DISPLAY 'SIZE ERROR ON EC-POSTING-CHARGE-AMT'     07860073
078700                MOVE +4012      TO    ABEND-CODE                  07870073
078800                CALL 'ILBOABN0' USING ABEND-CODE                  07880073
078900     END-COMPUTE.                                                 07890073
079000                                                                  07900073
079100     COMPUTE WC-POSTING-TOTL-CHARGE-AMT                           07910073
079200           = WC-POSTING-TOTL-CHARGE-AMT                           07920073
079300           + AR021-AMOUNT OF AR021-AR-POSTING-RECORD              07930073
079400             ON SIZE ERROR                                        07940073
079500                DISPLAY 'SIZE ERROR ON WC-POSTING-TOTL-CHARGE-AMT'07950073
079600                MOVE +4012      TO    ABEND-CODE                  07960073
079700                CALL 'ILBOABN0' USING ABEND-CODE                  07970073
079800     END-COMPUTE.                                                 07980073
079900                                                                  07990073
080000*-----------------------------------------------------------------08000073
080100* SUBTRACT POSTING CHARGE AMOUNT FROM THE STORE TOTAL&GRAND TOTAL 08010073
080200*-----------------------------------------------------------------08020073
080300 4100-SUBTRACT-POST-CHARGE.                                       08030073
080400                                                                  08040073
080500     COMPUTE EC-POSTING-CHARGE-AMT (WC-STR-INDX)                  08050073
080600           = EC-POSTING-CHARGE-AMT (WC-STR-INDX)                  08060073
080700           - AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08070073
080800             ON SIZE ERROR                                        08080073
080900                DISPLAY 'SIZE ERROR ON EC-POSTING-CHARGE-AMT'     08090073
081000                MOVE +4012      TO    ABEND-CODE                  08100073
081100                CALL 'ILBOABN0' USING ABEND-CODE                  08110073
081200     END-COMPUTE.                                                 08120073
081300                                                                  08130073
081400     COMPUTE WC-POSTING-TOTL-CHARGE-AMT                           08140073
081500           = WC-POSTING-TOTL-CHARGE-AMT                           08150073
081600           - AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08160073
081700             ON SIZE ERROR                                        08170073
081800                DISPLAY 'SIZE ERROR ON WC-POSTING-TOTL-CHARGE-AMT'08180073
081900                MOVE +4012      TO    ABEND-CODE                  08190073
082000                CALL 'ILBOABN0' USING ABEND-CODE                  08200073
082100     END-COMPUTE.                                                 08210073
082200                                                                  08220073
082300*----------------------------------------------------------------*08230073
082400* ADD POSTING PAYMENT AMOUNT TO STORE TOTAL AND GRAND TOTAL.      08240073
082500*----------------------------------------------------------------*08250073
082600 4200-ADD-POST-PAYMENT.                                           08260073
082700                                                                  08270073
082800     COMPUTE EC-POSTING-PAYMENT-AMT (WC-STR-INDX)                 08280073
082900           = EC-POSTING-PAYMENT-AMT (WC-STR-INDX)                 08290073
083000           + AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08300073
083100             ON SIZE ERROR                                        08310073
083200                DISPLAY 'SIZE ERROR ON EC-POSTING-PAYMNT-AMT'     08320073
083300                MOVE +4013      TO    ABEND-CODE                  08330073
083400                CALL 'ILBOABN0' USING ABEND-CODE                  08340073
083500     END-COMPUTE.                                                 08350073
083600                                                                  08360073
083700     COMPUTE WC-POSTING-TOTL-PAYMNT-AMT                           08370073
083800           = WC-POSTING-TOTL-PAYMNT-AMT                           08380073
083900           + AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08390073
084000             ON SIZE ERROR                                        08400073
084100                DISPLAY 'SIZE ERROR ON WC-POSTING-TOTL-PAYMNT-AMT'08410073
084200                MOVE +4013      TO    ABEND-CODE                  08420073
084300                CALL 'ILBOABN0' USING ABEND-CODE                  08430073
084400     END-COMPUTE.                                                 08440073
084500                                                                  08450073
084600*----------------------------------------------------------------*08460073
084700* SUBTRACT POSTING PAYMENT AMOUNT FRM STORE TOTAL AND GRAND TOTAL.08470073
084800*----------------------------------------------------------------*08480073
084900 4300-SUBTRACT-POST-PAYMENT.                                      08490073
085000                                                                  08500073
085100     COMPUTE EC-POSTING-PAYMENT-AMT (WC-STR-INDX)                 08510073
085200           = EC-POSTING-PAYMENT-AMT (WC-STR-INDX)                 08520073
085300           - AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08530073
085400             ON SIZE ERROR                                        08540073
085500                DISPLAY 'SIZE ERROR ON EC-POSTING-PAYMNT-AMT'     08550073
085600                MOVE +4013      TO    ABEND-CODE                  08560073
085700                CALL 'ILBOABN0' USING ABEND-CODE                  08570073
085800     END-COMPUTE.                                                 08580073
085900                                                                  08590073
086000     COMPUTE WC-POSTING-TOTL-PAYMNT-AMT                           08600073
086100           = WC-POSTING-TOTL-PAYMNT-AMT                           08610073
086200           - AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08620073
086300             ON SIZE ERROR                                        08630073
086400                DISPLAY 'SIZE ERROR ON WC-POSTING-TOTL-PAYMNT-AMT'08640073
086500                MOVE +4013      TO    ABEND-CODE                  08650073
086600                CALL 'ILBOABN0' USING ABEND-CODE                  08660073
086700     END-COMPUTE.                                                 08670073
086800                                                                  08680073
086900*-----------------------------------------------------------------08690073
087000* ADD POSTING EMPLOYEE DISCOUNT AMOUNT TO STORE TOTAL & GRAND TOTL08700073
087100*-----------------------------------------------------------------08710073
087200 4400-ADD-POST-DISCOUNT.                                          08720073
087300                                                                  08730073
087400     IF AR021-ECOMM-ORDER-NBR = SPACES                            08740074
087500         IF AR021-EMP-DISC-SRC-CDE = 'H'                          08750077
087600             CONTINUE                                             08760077
087700         ELSE                                                     08770077
087800             PERFORM 4100-SUBTRACT-POST-CHARGE                    08780077
087900         END-IF                                                   08790077
088000     END-IF.                                                      08800074
088100                                                                  08810073
088200     COMPUTE EC-POSTING-EMPL-DISCNT-AMT (WC-STR-INDX)             08820073
088300           = EC-POSTING-EMPL-DISCNT-AMT (WC-STR-INDX)             08830073
088400           + AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08840073
088500             ON SIZE ERROR                                        08850073
088600                DISPLAY 'SIZE ERROR ON EC-POSTING-EMPL-DISCNT-AMT'08860073
088700                MOVE +4014      TO    ABEND-CODE                  08870073
088800                CALL 'ILBOABN0' USING ABEND-CODE                  08880073
088900     END-COMPUTE.                                                 08890073
089000                                                                  08900073
089100     COMPUTE WC-POSTING-TOTL-EMPDSC-AMT                           08910073
089200           = WC-POSTING-TOTL-EMPDSC-AMT                           08920073
089300           + AR021-AMOUNT OF AR021-AR-POSTING-RECORD              08930073
089400             ON SIZE ERROR                                        08940073
089500                DISPLAY 'SIZE ERROR ON WC-POSTING-TOTL-EMPDSC-AMT'08950073
089600                MOVE +4014      TO    ABEND-CODE                  08960073
089700                CALL 'ILBOABN0' USING ABEND-CODE                  08970073
089800     END-COMPUTE.                                                 08980073
089900                                                                  08990073
090000*-----------------------------------------------------------------09000073
090100* SUB POSTING EMPLOYEE DISCOUNT AMOUNT FROM STORE TOTAL&GRAND TOTL09010073
090200*-----------------------------------------------------------------09020073
090300 4500-SUBTRACT-POST-DISCOUNT.                                     09030073
090400                                                                  09040073
090500     IF AR021-ECOMM-ORDER-NBR = SPACES                            09050074
090600         IF AR021-EMP-DISC-SRC-CDE = 'H'                          09060077
090700             CONTINUE                                             09070077
090800         ELSE                                                     09080077
090900             PERFORM 4000-ADD-POST-CHARGE                         09090077
091000         END-IF                                                   09100077
091100     END-IF.                                                      09110074
091200                                                                  09120073
091300     COMPUTE EC-POSTING-EMPL-DISCNT-AMT (WC-STR-INDX)             09130073
091400           = EC-POSTING-EMPL-DISCNT-AMT (WC-STR-INDX)             09140073
091500           - AR021-AMOUNT OF AR021-AR-POSTING-RECORD              09150073
091600             ON SIZE ERROR                                        09160073
091700                DISPLAY 'SIZE ERROR ON EC-POSTING-EMPL-DISCNT-AMT'09170073
091800                MOVE +4014      TO    ABEND-CODE                  09180073
091900                CALL 'ILBOABN0' USING ABEND-CODE                  09190073
092000     END-COMPUTE.                                                 09200073
092100                                                                  09210073
092200     COMPUTE WC-POSTING-TOTL-EMPDSC-AMT                           09220073
092300           = WC-POSTING-TOTL-EMPDSC-AMT                           09230073
092400           - AR021-AMOUNT OF AR021-AR-POSTING-RECORD              09240073
092500             ON SIZE ERROR                                        09250073
092600                DISPLAY 'SIZE ERROR ON WC-POSTING-TOTL-EMPDSC-AMT'09260073
092700                MOVE +4014      TO    ABEND-CODE                  09270073
092800                CALL 'ILBOABN0' USING ABEND-CODE                  09280073
092900     END-COMPUTE.                                                 09290073
093000                                                                  09300073
093100 5000-CALC-THRSHLD-MIN-MAX.                                       09310073
093200                                                                  09320073
093300     COMPUTE WC-THRESHLD-CHARGE-AMT-MIN                           09330073
093400           = WC-AUDIT-TOTAL-CHARGE-AMT                            09340073
093500           - CC-POST-CHARGE-THRESHOLD                             09350073
093600             ON SIZE ERROR                                        09360073
093700                DISPLAY 'SIZE ERROR ON WC-THRESHLD-CHARGE-AMT-MIN'09370073
093800                MOVE +4015      TO    ABEND-CODE                  09380073
093900                CALL 'ILBOABN0' USING ABEND-CODE                  09390073
094000     END-COMPUTE.                                                 09400073
094100                                                                  09410073
094200     COMPUTE WC-THRESHLD-CHARGE-AMT-MAX                           09420073
094300           = WC-AUDIT-TOTAL-CHARGE-AMT                            09430073
094400           + CC-POST-CHARGE-THRESHOLD                             09440073
094500             ON SIZE ERROR                                        09450073
094600                DISPLAY 'SIZE ERROR ON WC-THRESHLD-CHARGE-AMT-MAX'09460073
094700                MOVE +4015      TO    ABEND-CODE                  09470073
094800                CALL 'ILBOABN0' USING ABEND-CODE                  09480073
094900     END-COMPUTE.                                                 09490073
095000                                                                  09500073
095100     COMPUTE WC-THRESHLD-PAYMNT-AMT-MIN                           09510073
095200           = WC-AUDIT-TOTAL-PAYMENT-AMT                           09520073
095300           - CC-POST-PAYMNT-THRESHOLD                             09530073
095400             ON SIZE ERROR                                        09540073
095500                DISPLAY 'SIZE ERROR ON WC-THRESHLD-PAYMNT-AMT-MIN'09550073
095600                MOVE +4015      TO    ABEND-CODE                  09560073
095700                CALL 'ILBOABN0' USING ABEND-CODE                  09570073
095800     END-COMPUTE.                                                 09580073
095900                                                                  09590073
096000     COMPUTE WC-THRESHLD-PAYMNT-AMT-MAX                           09600073
096100           = WC-AUDIT-TOTAL-PAYMENT-AMT                           09610073
096200           + CC-POST-PAYMNT-THRESHOLD                             09620073
096300             ON SIZE ERROR                                        09630073
096400                DISPLAY 'SIZE ERROR ON WC-THRESHLD-PAYMNT-AMT-MAX'09640073
096500                MOVE +4015      TO    ABEND-CODE                  09650073
096600                CALL 'ILBOABN0' USING ABEND-CODE                  09660073
096700     END-COMPUTE.                                                 09670073
096800                                                                  09680073
096900*--------------------------------------------------------------*  09690073
097000* EACH AND EVERY ROW FROM SALES AUDIT POSTING FILE(WS TABLE)      09700073
097100* IS READ AND THE EC STORAGE TABLE IS LOADED WITH CHARGE AND      09710073
097200* PAYMENT AMOUNTS FROM WS TABLE. GRAND TOTAL, STORE TOTALS AND    09720073
097300* THE THRESHOLD AMOUNTS ARE PRINTED ON THE REPORT.                09730073
097400*--------------------------------------------------------------*  09740073
097500 5200-OUT-OF-BAL-PROCESS.                                         09750073
097600                                                                  09760073
097700     SET AUD-INDX                TO 1                             09770073
097800     SET NO-MORE-STORES          TO TRUE                          09780073
097900     PERFORM VARYING AUD-INDX FROM 1 BY 1                         09790073
098000               UNTIL ADT-SYSTEM-DTE (AUD-INDX) = SPACES           09800073
098100                                                                  09810073
098200          IF ADT-STORE-NBR  (AUD-INDX) > ZEROES                   09820073
098300            PERFORM 5500-SEARCH-MATCH-CUMULATIVE                  09830073
098400          END-IF                                                  09840073
098500     END-PERFORM                                                  09850073
098600                                                                  09860073
098700     PERFORM 5700-PRINT-GRAND-TOTALS                              09870073
098800     PERFORM 5800-PRINT-STORE-TOTALS                              09880073
098900     PERFORM 5900-PRINT-THRESHOLDS.                               09890073
099000*                                                                 09900073
099100*----------------------------------------------------------------*09910073
099200* NOW START THE WORKING STORAGE TABLE AND MOVE ONE BY ONE         09920073
099300* AND MATCH IT WITH THE TOTAL CHARGE AND PAYMENT VALUES           09930073
099400* STORED IN WORKING STORAGE TABLE STORE WISE.                     09940073
099500* THIS MEANS, THE DRIVER TABLE IS SEQUENTIALLY READ AND           09950073
099600* MATCHED WITH THE CUMULATIVE TABLE STARTING FROM FIRST OCCURS    09960073
099700* FOR EACH AND EVERY ROW READ FROM THE DRIVER AUD-INDX TABLE      09970073
099800*----------------------------------------------------------------*09980073
099900*                                                                 09990073
100000 5400-IN-BAL-PROCESS.                                             10000073
100100                                                                  10010073
100200     IF WC-TOTAL-CHARGE-DIFFERENCE NOT = ZERO                     10020073
100300     OR WC-TOTAL-PAYMNT-DIFFERENCE NOT = ZERO                     10030073
100400        SET AUD-INDX                TO 1                          10040073
100500        PERFORM VARYING  AUD-INDX FROM 1 BY 1                     10050073
100600                UNTIL ADT-SYSTEM-DTE (AUD-INDX) = SPACES          10060073
100700             IF ADT-STORE-NBR  (AUD-INDX) > ZEROES                10070073
100800                PERFORM 5500-SEARCH-MATCH-CUMULATIVE              10080073
100900             END-IF                                               10090073
101000        END-PERFORM                                               10100073
101100                                                                  10110073
101200        PERFORM 5700-PRINT-GRAND-TOTALS                           10120073
101300        PERFORM 5800-PRINT-STORE-TOTALS                           10130073
101400        PERFORM 5900-PRINT-THRESHOLDS                             10140073
101500     ELSE                                                         10150073
101600        PERFORM 5700-PRINT-GRAND-TOTALS                           10160073
101700        PERFORM 5900-PRINT-THRESHOLDS                             10170073
101800     END-IF.                                                      10180073
101900                                                                  10190073
102000 5500-SEARCH-MATCH-CUMULATIVE.                                    10200073
102100                                                                  10210073
102200     SET WC-STR-INDX             TO 1.                            10220073
102300                                                                  10230073
102400     SEARCH EG-POSTING-STORE-TBL-DATA                             10240073
102500         VARYING WC-STR-INDX                                      10250073
102600         AT END                                                   10260073
102700             IF ADT-SETTLEMNT-AMT (AUD-INDX) NOT = ZEROES         10270073
102800                 STRING 'STORE NUMBER:'                           10280073
102900                        ADT-STORE-NBR (AUD-INDX)                  10290073
103000                        ' FROM SALES AUDIT NOT FOUND IN POSTING'  10300073
103100                        ' TABLE ' DELIMITED BY SIZE               10310073
103200                       INTO WX-ERROR-MSG                          10320073
103300                 END-STRING                                       10330073
103400                 DISPLAY WX-ERROR-MSG                             10340073
103500             END-IF                                               10350073
103600         WHEN ADT-SYSTEM-DTE(AUD-INDX) = WX-TRANS-DATE            10360073
103700         AND  ADT-STORE-NBR (AUD-INDX) > ZEROES                   10370073
103800         AND  ADT-STORE-NBR (AUD-INDX) =                          10380073
103900              EC-STORE-NBR (WC-STR-INDX)                          10390073
104000             PERFORM 5600-LOAD-STORE-TBL                          10400073
104100     END-SEARCH.                                                  10410073
104200                                                                  10420073
104300 5600-LOAD-STORE-TBL.                                             10430073
104400                                                                  10440073
104500     EVALUATE ADT-CATEGORY-CDE (AUD-INDX)                         10450073
104600         WHEN CC-POST-CHARGE-CTG                                  10460073
104700              MOVE ADT-SETTLEMNT-AMT   (AUD-INDX)                 10470073
104800                TO EC-AUDIT-CHARGE-AMT (WC-STR-INDX)              10480073
104900              COMPUTE WC-AUDIT-CHARGE-AMT-SUM                     10490073
105000                    = WC-AUDIT-CHARGE-AMT-SUM                     10500073
105100                    + EC-AUDIT-CHARGE-AMT (WC-STR-INDX)           10510073
105200              END-COMPUTE                                         10520073
105300                                                                  10530073
105400         WHEN CC-POST-PAYMNT-CTG                                  10540073
105500              MOVE ADT-SETTLEMNT-AMT   (AUD-INDX)                 10550073
105600                TO EC-AUDIT-PAYMNT-AMT (WC-STR-INDX)              10560073
105700              COMPUTE WC-AUDIT-PAYMENT-AMT-SUM                    10570073
105800                    = WC-AUDIT-PAYMENT-AMT-SUM                    10580073
105900                    + EC-AUDIT-PAYMNT-AMT (WC-STR-INDX)           10590073
106000              END-COMPUTE                                         10600073
106100     END-EVALUATE.                                                10610073
106200                                                                  10620073
106300 5700-PRINT-GRAND-TOTALS.                                         10630073
106400                                                                  10640073
106500     PERFORM 6000-WRITE-HEADERS.                                  10650073
106600                                                                  10660073
106700     ADD 2                       TO PR-REPORT-LINES               10670073
106800     ADD 2                       TO PR-LINE-COUNT                 10680073
106900                                                                  10690073
107000     MOVE WX-TRANS-DATE (1:4)    TO PR-DTL1-PROCESS-DATE (7:4)    10700073
107100     MOVE WX-TRANS-DATE (6:2)    TO PR-DTL1-PROCESS-DATE (1:2)    10710073
107200     MOVE WX-TRANS-DATE (9:2)    TO PR-DTL1-PROCESS-DATE (4:2)    10720073
107300     MOVE '/'                    TO PR-DTL1-PROCESS-DATE (3:1)    10730073
107400                                    PR-DTL1-PROCESS-DATE (6:1)    10740073
107500     SET  W88-DTL1-TOTALS-TXT          TO TRUE                    10750073
107600     MOVE WC-AUDIT-TOTAL-CHARGE-AMT    TO PR-DTL1-ADT-CHRG-AMT    10760073
107700     MOVE WC-POSTING-TOTL-CHARGE-AMT   TO PR-DTL1-PST-CHRG-AMT    10770073
107800     MOVE WC-AUDIT-TOTAL-PAYMENT-AMT   TO PR-DTL1-ADT-PYMNT-AMT   10780073
107900     MOVE WC-POSTING-TOTL-PAYMNT-AMT   TO PR-DTL1-PST-PYMNT-AMT   10790073
108000     MOVE WC-POSTING-TOTL-EMPDSC-AMT   TO PR-DTL1-EMP-DISC-AMT    10800073
108100     MOVE WC-TOTAL-CHARGE-DIFFERENCE   TO PR-DTL1-CHARGE-DIFF     10810073
108200     MOVE WC-TOTAL-PAYMNT-DIFFERENCE   TO PR-DTL1-PAYMENT-DIFF    10820073
108300                                                                  10830073
108400     WRITE PREPOST-BAL-RECORD   FROM   PR-REPORT-DETAIL-1         10840073
108500           AFTER ADVANCING 1 LINE.                                10850073
108600                                                                  10860073
108700     PERFORM 6100-WRITE-SPACES.                                   10870073
108800                                                                  10880073
108900*-----------------------------------------------------------------10890073
109000* LOOP THROUGH THE WORKING  STORAGE STORE TABLE, PRINTING THE     10900073
109100* THE CHARGE AMOUNT AND PAYMENT AMOUNTS FROM THE POSTING FILES AND10910073
109200* THE CHARGE AMOUNT AND PAYMENT AUDIT AMOUNTS FROM THE AUDIT TABL.10920073
109300* IF THE CHARGES OR PAYMENTS ARE OUT-OF-BALANCE,SET THE OUT-OF-BAL10930073
109400* INDICATOR TO AN ASTERISK.                                       10940073
109500*-----------------------------------------------------------------10950073
109600                                                                  10960073
109700 5800-PRINT-STORE-TOTALS.                                         10970073
109800                                                                  10980073
109900     PERFORM VARYING WC-STR-INDX FROM 1 BY 1                      10990073
110000       UNTIL WC-STR-INDX > PC-MAX-STR-INDX-USED                   11000073
110100         SET DONT-PRINT-STORE           TO TRUE                   11010073
110200         IF LIST-ALL-STORES                                       11020073
110300            SET PRINT-STORE             TO TRUE                   11030073
110400         ELSE                                                     11040073
110500            IF (EC-POSTING-CHARGE-AMT (WC-STR-INDX) NOT =         11050073
110600                EC-AUDIT-CHARGE-AMT   (WC-STR-INDX))              11060073
110700            OR (EC-POSTING-PAYMENT-AMT(WC-STR-INDX) NOT =         11070073
110800                EC-AUDIT-PAYMNT-AMT   (WC-STR-INDX))              11080073
110900                SET PRINT-STORE         TO TRUE                   11090073
111000            END-IF                                                11100073
111100         END-IF                                                   11110073
111200         IF PRINT-STORE                                           11120073
111300            PERFORM 6000-WRITE-HEADERS                            11130073
111400            ADD 1                       TO PR-REPORT-LINES        11140073
111500            ADD 1                       TO PR-LINE-COUNT          11150073
111600            MOVE WX-TRANS-DATE (1:4)    TO                        11160073
111700                                        PR-DTL1-PROCESS-DATE (7:4)11170073
111800            MOVE WX-TRANS-DATE (6:2)    TO                        11180073
111900                                        PR-DTL1-PROCESS-DATE (1:2)11190073
112000            MOVE WX-TRANS-DATE (9:2)    TO                        11200073
112100                                        PR-DTL1-PROCESS-DATE (4:2)11210073
112200            MOVE '/'                    TO                        11220073
112300                                        PR-DTL1-PROCESS-DATE (3:1)11230073
112400                                        PR-DTL1-PROCESS-DATE (6:1)11240073
112500            MOVE EC-STORE-NBR (WC-STR-INDX)                       11250073
112600                                        TO PR-DTL1-STORE-NBR      11260073
112700            MOVE PR-DTL1-STORE-NBR      TO PR-DTL1-STORE-NBR-TEXT 11270073
112800            MOVE EC-AUDIT-CHARGE-AMT    (WC-STR-INDX)             11280073
112900                                        TO PR-DTL1-ADT-CHRG-AMT   11290073
113000            MOVE EC-POSTING-CHARGE-AMT  (WC-STR-INDX)             11300073
113100                                        TO PR-DTL1-PST-CHRG-AMT   11310073
113200            MOVE EC-AUDIT-PAYMNT-AMT    (WC-STR-INDX)             11320073
113300                                        TO PR-DTL1-ADT-PYMNT-AMT  11330073
113400            MOVE EC-POSTING-PAYMENT-AMT (WC-STR-INDX)             11340073
113500                                        TO PR-DTL1-PST-PYMNT-AMT  11350073
113600            MOVE EC-POSTING-EMPL-DISCNT-AMT  (WC-STR-INDX)        11360073
113700                                        TO PR-DTL1-EMP-DISC-AMT   11370073
113800            IF EC-POSTING-CHARGE-AMT (WC-STR-INDX) NOT =          11380073
113900               EC-AUDIT-CHARGE-AMT   (WC-STR-INDX)                11390073
114000               COMPUTE EC-CHARGE-DIFFERENCE  (WC-STR-INDX)        11400073
114100                     = EC-AUDIT-CHARGE-AMT   (WC-STR-INDX)        11410073
114200                     - EC-POSTING-CHARGE-AMT (WC-STR-INDX)        11420073
114300                    ON SIZE ERROR                                 11430073
114400                       MOVE WC-AMOUNT-9-DEFAULT                   11440073
114500                         TO EC-CHARGE-DIFFERENCE (WC-STR-INDX)    11450073
114600               END-COMPUTE                                        11460073
114700            ELSE                                                  11470073
114800               MOVE WC-AMOUNT-0-DEFAULT                           11480073
114900                                       TO EC-CHARGE-DIFFERENCE    11490073
115000                                             (WC-STR-INDX)        11500073
115100            END-IF                                                11510073
115200            MOVE EC-CHARGE-DIFFERENCE (WC-STR-INDX)               11520073
115300                                       TO PR-DTL1-CHARGE-DIFF     11530073
115400            IF EC-POSTING-PAYMENT-AMT (WC-STR-INDX) NOT =         11540073
115500               EC-AUDIT-PAYMNT-AMT    (WC-STR-INDX)               11550073
115600               COMPUTE EC-PAYMENT-DIFFERENCE  (WC-STR-INDX)       11560073
115700                     = EC-AUDIT-PAYMNT-AMT    (WC-STR-INDX)       11570073
115800                     - EC-POSTING-PAYMENT-AMT (WC-STR-INDX)       11580073
115900               END-COMPUTE                                        11590073
116000            ELSE                                                  11600073
116100                MOVE WC-AMOUNT-0-DEFAULT TO EC-PAYMENT-DIFFERENCE 11610073
116200                                              (WC-STR-INDX)       11620073
116300            END-IF                                                11630073
116400            MOVE EC-PAYMENT-DIFFERENCE (WC-STR-INDX)              11640073
116500                                         TO PR-DTL1-PAYMENT-DIFF  11650073
116600                                                                  11660073
116700            WRITE PREPOST-BAL-RECORD   FROM PR-REPORT-DETAIL-1    11670073
116800                     AFTER ADVANCING 1 LINE                       11680073
116900            PERFORM 6100-WRITE-SPACES                             11690073
117000        END-IF                                                    11700073
117100     END-PERFORM.                                                 11710073
117200                                                                  11720073
117300*-----------------------------------------------------------------11730073
117400* PRINT THE CHARGE AND PAYMENT THRESHOLD AMOUNTS THAT WERE PASSED 11740073
117500* INTO THE PROGRAM AS PARAMETERS.                                 11750073
117600*-----------------------------------------------------------------11760073
117700 5900-PRINT-THRESHOLDS.                                           11770073
117800                                                                  11780073
117900     PERFORM 6100-WRITE-SPACES.                                   11790073
118000     PERFORM 6100-WRITE-SPACES.                                   11800073
118100                                                                  11810073
118200     MOVE CC-POST-CHARGE-THRESHOLD       TO PR-DTL2-THRSHLD-CHRG  11820073
118300     MOVE CC-POST-PAYMNT-THRESHOLD       TO PR-DTL2-THRSHLD-PYMT  11830073
118400                                                                  11840073
118500     WRITE PREPOST-BAL-RECORD   FROM PR-REPORT-DETAIL-2           11850073
118600                     AFTER ADVANCING 1 LINE.                      11860073
118700                                                                  11870073
118800     ADD 1                               TO PR-REPORT-LINES       11880073
118900     ADD 1                               TO PR-LINE-COUNT         11890073
119000                                                                  11900073
119100     PERFORM 6000-WRITE-HEADERS.                                  11910073
119200     PERFORM 6100-WRITE-SPACES.                                   11920073
119300                                                                  11930073
119400     MOVE SPACES TO PR-MESSAGE-RPT.                               11940073
119500     IF CHARGE-OUT-OF-BALANCE                                     11950073
119600     OR PAYMENT-OUT-OF-BALANCE                                    11960073
119700        STRING                                                    11970073
119800            "*****"                                               11980073
119900            " POSTING FILES ARE OUT-OF-BALANCE"                   11990073
120000            " WITH AUDIT FILE"                                    12000073
120100            " *****"                                              12010073
120200              DELIMITED BY SIZE        INTO  PR-MESSAGE           12020073
120300        END-STRING                                                12030073
120400     ELSE                                                         12040073
120500        STRING                                                    12050073
120600            "*****"                                               12060073
120700            " POSTING FILES ARE IN-BALANCE"                       12070073
120800            " WITH AUDIT FILE"                                    12080073
120900            " *****"                                              12090073
121000              DELIMITED BY SIZE        INTO  PR-MESSAGE           12100073
121100        END-STRING                                                12110073
121200     END-IF.                                                      12120073
121300                                                                  12130073
121400     ADD 1                               TO PR-REPORT-LINES       12140073
121500     ADD 1                               TO PR-LINE-COUNT         12150073
121600     PERFORM 6000-WRITE-HEADERS                                   12160073
121700     WRITE PREPOST-BAL-RECORD FROM PR-MESSAGE-RPT                 12170073
121800           AFTER ADVANCING  1 LINE.                               12180073
121900     PERFORM 6100-WRITE-SPACES.                                   12190073
122000                                                                  12200073
122100*----------------------------------*                              12210073
122200* IF OUT-OF-BALANCE, WRITE A MESSAGE                              12220073
122300*----------------------------------*                              12230073
122400     IF CHARGE-OUT-OF-BALANCE                                     12240073
122500        PERFORM 6100-WRITE-SPACES                                 12250073
122600        MOVE 'CHARGES ARE OUT-OF-BALANCE'  TO PR-MESSAGE          12260073
122700     END-IF                                                       12270073
122800     IF PAYMENT-OUT-OF-BALANCE                                    12280073
122900        PERFORM 6100-WRITE-SPACES                                 12290073
123000        MOVE 'PAYMENTS ARE OUT-OF-BALANCE' TO PR-MESSAGE          12300073
123100     END-IF.                                                      12310073
123200     IF CHARGE-OUT-OF-BALANCE                                     12320073
123300     OR PAYMENT-OUT-OF-BALANCE                                    12330073
123400        ADD 1                              TO PR-REPORT-LINES     12340073
123500        ADD 1                              TO PR-LINE-COUNT       12350073
123600        PERFORM 6000-WRITE-HEADERS                                12360073
123700        WRITE PREPOST-BAL-RECORD FROM PR-MESSAGE-RPT              12370073
123800              AFTER ADVANCING  1 LINE                             12380073
123900        MOVE 4044                          TO RETURN-CODE         12390073
124000     END-IF.                                                      12400073
124100                                                                  12410073
124200******************************************************************12420073
124300*  PRINT THE PRE BALANCE REPORT HEADER                           *12430073
124400******************************************************************12440073
124500 6000-WRITE-HEADERS.                                              12450073
124600                                                                  12460073
124700      IF PR-LINE-COUNT > 60                                       12470073
124800         ADD  1                 TO PR-PAGE-COUNT                  12480073
124900         MOVE PR-PAGE-COUNT     TO DP132O-PAGE-NUMBER             12490073
125000         MOVE 0                 TO PR-LINE-COUNT                  12500073
125100         MOVE PR-REPORT-NBR     TO DP132O-REPORT-NUMBER           12510073
125200         WRITE PREPOST-BAL-RECORD        FROM                     12520073
125300                              DP132O-STANDRD-HEADER-132-COLS      12530073
125400                AFTER ADVANCING PAGE                              12540073
125500         WRITE PREPOST-BAL-RECORD        FROM                     12550073
125600                               PR-REPORT-HEADER                   12560073
125700                AFTER ADVANCING 2 LINES                           12570073
125800                                                                  12580073
125900         WRITE PREPOST-BAL-RECORD        FROM                     12590073
126000                               PR-REPORT-HEADER-LINE1             12600073
126100                AFTER ADVANCING 2 LINES                           12610073
126200         MOVE SPACES            TO PREPOST-BAL-RECORD             12620073
126300         WRITE PREPOST-BAL-RECORD                                 12630073
126400         ADD  6                 TO PR-REPORT-LINES                12640073
126500         ADD  6                 TO PR-LINE-COUNT                  12650073
126600      END-IF.                                                     12660073
126700                                                                  12670073
126800 6100-WRITE-SPACES.                                               12680073
126900                                                                  12690073
127000     MOVE SPACES                         TO PREPOST-BAL-RECORD    12700073
127100     WRITE PREPOST-BAL-RECORD                                     12710073
127200     ADD 1                               TO PR-REPORT-LINES       12720073
127300     ADD 1                               TO PR-LINE-COUNT         12730073
127400     PERFORM 6000-WRITE-HEADERS.                                  12740073
127500                                                                  12750073
127600******************************************************************12760073
127700*  READ AN ACCOUNTS RECEIVABLE TRANSACTION RECORD.               *12770073
127800******************************************************************12780073
127900                                                                  12790073
128000 7000-READ-POSTING-FILE.                                          12800073
128100                                                                  12810073
128200     EVALUATE W9-POSTING-FILE-NBR                                 12820073
128300         WHEN 1                                                   12830073
128400              READ POSTING-TRANS-FILE-1                           12840073
128500                   INTO AR021-AR-POSTING-RECORD                   12850073
128600                AT END                                            12860073
128700                   SET PS-EOF-FILE1 TO TRUE                       12870073
128800                   ADD +1 TO W9-POSTING-FILE-NBR                  12880073
128900               NOT AT END                                         12890073
129000                   ADD +1 TO PS-INPUT-RCDS-READ                   12900073
129100              END-READ                                            12910073
129200         WHEN 2                                                   12920073
129300              READ POSTING-TRANS-FILE-2                           12930073
129400                   INTO AR021-AR-POSTING-RECORD                   12940073
129500                AT END                                            12950073
129600                   SET PS-EOF-FILE2    TO TRUE                    12960073
129700                   ADD +1 TO W9-POSTING-FILE-NBR                  12970073
129800               NOT AT END                                         12980073
129900                   ADD +1 TO PS-INPUT-RCDS-READ                   12990073
130000              END-READ                                            13000073
130100         WHEN 3                                                   13010073
130200              READ POSTING-TRANS-FILE-3                           13020073
130300                   INTO AR021-AR-POSTING-RECORD                   13030073
130400                AT END                                            13040073
130500                   SET PS-EOF-FILE3    TO TRUE                    13050073
130600                   ADD +1 TO W9-POSTING-FILE-NBR                  13060073
130700               NOT AT END                                         13070073
130800                   ADD +1 TO PS-INPUT-RCDS-READ                   13080073
130900              END-READ                                            13090073
131000         WHEN 4                                                   13100073
131100              READ POSTING-TRANS-FILE-4                           13110073
131200                   INTO AR021-AR-POSTING-RECORD                   13120073
131300                AT END                                            13130073
131400                   SET PS-EOF-FILE4 TO TRUE                       13140073
131500                   ADD +1 TO W9-POSTING-FILE-NBR                  13150073
131600               NOT AT END                                         13160073
131700                   ADD +1 TO PS-INPUT-RCDS-READ                   13170073
131800              END-READ                                            13180073
131900         WHEN 5                                                   13190073
132000              READ POSTING-TRANS-FILE-5                           13200073
132100                   INTO AR021-AR-POSTING-RECORD                   13210073
132200                AT END                                            13220073
132300                   SET PS-EOF-FILE5 TO TRUE                       13230073
132400                   ADD +1 TO W9-POSTING-FILE-NBR                  13240073
132500               NOT AT END                                         13250073
132600                   ADD +1 TO PS-INPUT-RCDS-READ                   13260073
132700              END-READ                                            13270073
132800         WHEN 6                                                   13280073
132900              READ POSTING-TRANS-FILE-6                           13290073
133000                   INTO AR021-AR-POSTING-RECORD                   13300073
133100                AT END                                            13310073
133200                   SET PS-EOF-FILE6 TO TRUE                       13320073
133300                   ADD +1 TO W9-POSTING-FILE-NBR                  13330073
133400               NOT AT END                                         13340073
133500                   ADD +1 TO PS-INPUT-RCDS-READ                   13350073
133600              END-READ                                            13360073
133700         WHEN 7                                                   13370073
133800              READ POSTING-TRANS-FILE-7                           13380073
133900                   INTO AR021-AR-POSTING-RECORD                   13390073
134000                AT END                                            13400073
134100                   SET PS-EOF-FILE7 TO TRUE                       13410073
134200                   ADD +1 TO W9-POSTING-FILE-NBR                  13420073
134300               NOT AT END                                         13430073
134400                   ADD +1 TO PS-INPUT-RCDS-READ                   13440073
134500              END-READ                                            13450073
134600         WHEN 8                                                   13460073
134700              READ POSTING-TRANS-FILE-8                           13470073
134800                   INTO AR021-AR-POSTING-RECORD                   13480073
134900                AT END                                            13490073
135000                   SET PS-EOF-FILE8 TO TRUE                       13500073
135100                   ADD +1 TO W9-POSTING-FILE-NBR                  13510073
135200               NOT AT END                                         13520073
135300                   ADD +1 TO PS-INPUT-RCDS-READ                   13530073
135400              END-READ                                            13540073
135500     END-EVALUATE.                                                13550073
135600                                                                  13560073
135700******************************************************************13570073
135800*  DISPLAY THE POSTING FILE COUNT AND TOTAL LINES PRINTED.       *13580073
135900*  CLOSE ALL FILES.                                              *13590073
136000******************************************************************13600073
136100                                                                  13610073
136200 9000-EOJ-ROUTINE.                                                13620073
136300                                                                  13630073
136400     DISPLAY 'TOTAL POSTING RECORDS ' PS-INPUT-RCDS-READ.         13640073
136500     DISPLAY 'LINES PRINTED      '    PR-REPORT-LINES.            13650073
136600                                                                  13660073
136700     CLOSE SALES-AUDIT-POST-FILE                                  13670073
136800           POSTING-TRANS-FILE-1                                   13680073
136900           POSTING-TRANS-FILE-2                                   13690073
137000           POSTING-TRANS-FILE-3                                   13700073
137100           POSTING-TRANS-FILE-4                                   13710073
137200           POSTING-TRANS-FILE-5                                   13720073
137300           POSTING-TRANS-FILE-6                                   13730073
137400           POSTING-TRANS-FILE-7                                   13740073
137500           POSTING-TRANS-FILE-8                                   13750073
137600           PREPBAL-REPORT-FILE.                                   13760073
137700                                                                  13770073
