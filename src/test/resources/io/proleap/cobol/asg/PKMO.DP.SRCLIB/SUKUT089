000100******************************************************************00010089
000200 IDENTIFICATION DIVISION.                                         00020089
000300******************************************************************00030089
000400                                                                  00040089
000500 PROGRAM-ID.             SUKUT089.                                00050089
000600 AUTHOR.                 LYNN MCADAMS.                            00060089
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070089
000800 DATE-WRITTEN            MARCH, 2003.                             00080089
000900 DATE-COMPILED.                                                   00090089
001000                                                                  00100089
001100*----------------------------------------------------------------*00110089
001200* THIS PROGRAM WILL GET PO,RCVR,LINE LEVEL DATA FOR CARTONS      *00120089
001300* IN THE EXTRACT CREATED BY SUKUT088.  THIS PROGRAM WILL         *00130089
001400* ELIMINATE CARTONS THAT SHOULD NOT BE REPORTED ON, BASED ON     *00140089
001500* THE DATE THE CARTON WAS CREATED.                               *00150089
001600*                                                                *00160089
001700* IT WILL ALSO GATHER PURCHASE ORDER AND RECEIVER INFORMATION    *00170089
001800* AND FORMAT A NEW EXTRACT RECORD BY PO,RCVR,LINE LEVEL WITHIN   *00180089
001900* THE CARTON.                                                    *00190089
002000*                                                                *00200089
002100* THE INPUT FILE LAYOUT IS SURD044 AND THE OUTPUT FILE LAYOUT    *00210089
002200* IS SURD045.                                                    *00220089
002300*----------------------------------------------------------------*00230089
002400                                                                  00240089
002500***************************************************************** 00250089
002600 ENVIRONMENT DIVISION.                                            00260089
002700***************************************************************** 00270089
002800 INPUT-OUTPUT SECTION.                                            00280089
002900                                                                  00290089
003000 FILE-CONTROL.                                                    00300089
003100                                                                  00310089
003200     SELECT INPUT-FILE ASSIGN TO INP01.                           00320089
003300                                                                  00330089
003400     SELECT EXTRACT-FILE ASSIGN TO OUT01.                         00340089
003500                                                                  00350089
003600***************************************************************** 00360089
003700 DATA DIVISION.                                                   00370089
003800***************************************************************** 00380089
003900 FILE SECTION.                                                    00390089
004000*                                                                 00400089
004100*                                                                 00410089
004200 FD  INPUT-FILE                                                   00420089
004300     RECORDING MODE IS F                                          00430089
004400     LABEL RECORDS ARE STANDARD                                   00440089
004500     BLOCK CONTAINS 0 RECORDS.                                    00450089
004600 01  INPUT-RECORD                PIC X(400).                      00460089
004700                                                                  00470089
004800 FD  EXTRACT-FILE                                                 00480089
004900     RECORDING MODE IS F                                          00490089
005000     LABEL RECORDS ARE STANDARD                                   00500089
005100     BLOCK CONTAINS 0 RECORDS.                                    00510089
005200 01  EXTRACT-RECORD              PIC X(200).                      00520089
005300*                                                                 00530089
005400*                                                                 00540089
005500***************************************************************** 00550089
005600 WORKING-STORAGE SECTION.                                         00560089
005700                                                                  00570089
005800 01  PS-PROGRAM-SWITCHES.                                         00580089
005900     05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'N'.       00590089
006000         88  PS-END-OF-INPUT-FILE                VALUE 'Y'.       00600089
006100         88  PS-NOT-END-OF-INPUT-FILE            VALUE 'N'.       00610089
006200     05  PS-EOF-PO-RCVR-LINE-CSR-SW     PIC X(01)  VALUE 'N'.     00620089
006300         88  PS-EOF-PO-RCVR-LINE-CSR               VALUE 'Y'.     00630089
006400         88  PS-NOT-EOF-PO-RCVR-LINE-CSR           VALUE 'N'.     00640089
006500*LMM TEST ONLY                                                    00650089
006600     05  PS-TRECEIV-FOUND-SW          PIC X(01)  VALUE 'N'.       00660089
006700         88  PS-TRECEIV-FOUND-YES                VALUE 'Y'.       00670089
006800         88  PS-TRECEIV-FOUND-NO                 VALUE 'N'.       00680089
006900                                                                  00690089
007000 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       00700089
007100                                                 COMP SYNC.       00710089
007200     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     00720089
007300                                                                  00730089
007400 01  PV-PROGRAM-VARIABLES.                                        00740089
007500     05  PV-READ-COUNT                PIC S9(09) VALUE ZERO       00750089
007600                                                  COMP SYNC.      00760089
007700     05  PV-WRITE-EXTR-COUNT          PIC S9(09) VALUE ZERO       00770089
007800                                                  COMP SYNC.      00780089
007900                                                                  00790089
008000     05  PV-DISPLAY-READ-CNT          PIC ZZZ,ZZZ,ZZ9.            00800089
008100     05  PV-DISPLAY-WRITE-CNT         PIC ZZZ,ZZZ,ZZ9.            00810089
008200                                                                  00820089
008300     05  PV-DISPLAY-TRN-NBR           PIC Z(8)9-.                 00830089
008400     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC 9999-.                  00840089
008500     05  PV-DISPLAY-TRN-LNE-NBR       PIC 9999-.                  00850089
008600     05  PV-DISPLAY-SHIPT-UNT-ID      PIC 9(18).                  00860089
008700                                                                  00870089
008800     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     00880089
008900     05  PV-DB2-FUNCTION              PIC X(30)  VALUE SPACE.     00890089
009000     05  PV-DB2-TABLE-NAME1           PIC X(08)  VALUE SPACE.     00900089
009100     05  PV-DB2-TABLE-NAME2           PIC X(08)  VALUE SPACE.     00910089
009200     05  PV-VRFD-DATE                  PIC X(10)  VALUE SPACE.    00920089
009300     05  PV-VRFD-TIME                  PIC X(08)  VALUE SPACE.    00930089
009400                                                                  00940089
009500     05  PV-CRE-DATE                    PIC X(10)   VALUE SPACE.  00950089
009600     05  PV-CRE-DATE-R REDEFINES  PV-CRE-DATE.                    00960089
009700         10   PV-CRE-DATE-CC            PIC X(02).                00970089
009800         10   PV-CRE-DATE-YY            PIC X(02).                00980089
009900         10   FILLER                    PIC X(01).                00990089
010000         10   PV-CRE-DATE-MM            PIC X(02).                01000089
010100         10   FILLER                    PIC X(01).                01010089
010200         10   PV-CRE-DATE-DD            PIC X(02).                01020089
010300                                                                  01030089
010400     05  PV-CRE-TIME                    PIC X(08)   VALUE SPACE.  01040089
010500     05  PV-CRE-TIME-R REDEFINES  PV-CRE-TIME.                    01050089
010600         10   PV-CRE-TIME-HRS           PIC X(02).                01060089
010700         10   FILLER                    PIC X(01).                01070089
010800         10   PV-CRE-TIME-MIN           PIC X(02).                01080089
010900         10   FILLER                    PIC X(01).                01090089
011000         10   PV-CRE-TIME-SEC           PIC X(02).                01100089
011100                                                                  01110089
011200     05  PV-CREATE-TMST.                                          01120089
011300         10   PV-TMST-CC                PIC X(02)   VALUE SPACES. 01130089
011400         10   PV-TMST-YY                PIC X(02)   VALUE SPACES. 01140089
011500         10   PV-DASH1                  PIC X(01)   VALUE '-'.    01150089
011600         10   PV-TMST-MM                PIC X(02)   VALUE SPACES. 01160089
011700         10   PV-DASH2                  PIC X(01)   VALUE '-'.    01170089
011800         10   PV-TMST-DD                PIC X(02)   VALUE SPACES. 01180089
011900         10   PV-DASH3                  PIC X(01)   VALUE '-'.    01190089
012000         10   PV-TMST-HRS               PIC X(02)   VALUE SPACES. 01200089
012100         10   PV-PERIOD1                PIC X(01)   VALUE '.'.    01210089
012200         10   PV-TMST-MIN               PIC X(02)   VALUE SPACES. 01220089
012300         10   PV-PERIOD2                PIC X(01)   VALUE '.'.    01230089
012400         10   PV-TMST-SEC               PIC X(02)   VALUE SPACES. 01240089
012500         10   FILLER                    PIC X(07)   VALUE SPACES. 01250089
012600                                                                  01260089
012700     05  PV-RCVR-TRBL-CNT             PIC S9(09)  VALUE ZERO      01270089
012800                                                  COMP-3.         01280089
012900     05  PV-LINE-TRBL-CNT             PIC S9(09)  VALUE ZERO      01290089
013000                                                  COMP-3.         01300089
013100     05  PV-PREVIOUS-CS               PIC S9(09)  VALUE ZERO.     01310089
013110     05  PV-PREVIOUS-PO               PIC S9(09)  VALUE ZERO.     01311089
013200     05  PV-PREVIOUS-RCVR             PIC S9(04)  VALUE ZERO.     01320089
013300     05  PV-PREVIOUS-LINE             PIC S9(04)  VALUE ZERO.     01330089
013400                                                                  01340089
013500 01  DK-DB-KEYS.                                                  01350089
013600     05  DK-SHIPT-UNT-ID             PIC  S9(18)V COMP-3.         01360089
013700     05  DK-RCVR-SEQ-NBR             PIC  S9(9) COMP.             01370089
013800     05  DK-TRN-LNE-NBR              PIC  S9(9) COMP.             01380089
013900                                                                  01390089
014000 01 PC-PROGRAM-CONSTANTS.                                         01400089
014100     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT089'. 01410089
014200     05 PC-DEFAULT-TMST              PIC X(26)                    01420089
014300             VALUE '9999-09-09-09.09.09.999999'.                  01430089
014400     05 PC-DEFAULT-DATE              PIC X(10)                    01440089
014500             VALUE '9999-09-09'.                                  01450089
014600     05 PC-DEFAULT-TIME              PIC X(08)                    01460089
014700             VALUE '09.09.09'.                                    01470089
014800     05 PC-01                       PIC  X(02)  VALUE '01'.       01480089
014900     05 PC-Y                        PIC  X(01)  VALUE 'Y'.        01490089
015000     05 PC-N                        PIC  X(01)  VALUE 'N'.        01500089
015100                                                                  01510089
015200 01  PV-ABEND-FIELDS.                                             01520089
015300     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01530089
015400                                                 COMP SYNC.       01540089
015500     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT089'.01550089
015600     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01560089
015700     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01570089
015800     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01580089
015900     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30) VALUE SPACES.    01590089
016000     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01600089
016100     05  PV-SQL-RETURN-CD             PIC  999-.                  01610089
016200     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01620089
016300     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01630089
016400     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01640089
016500     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01650089
016600                                                                  01660089
016700******************************************************************01670089
016800*  USED FOR DB2 ERROR MESSAGE BUILDING                            01680089
016900******************************************************************01690089
017000     COPY DPWS004.                                                01700089
017100                                                                  01710089
017200*----------------------------------------------------------------*01720089
017300*    ABEND PROCESSING COPYBOOK.                                  *01730089
017400*----------------------------------------------------------------*01740089
017500                                                                  01750089
017600     COPY DPWS013.                                                01760089
017700******************************************************************01770089
017800*   DB2 SQL COMMUNICATION AREA                                    01780089
017900******************************************************************01790089
018000     EXEC SQL                                                     01800089
018100          INCLUDE SQLCA                                           01810089
018200     END-EXEC.                                                    01820089
018300                                                                  01830089
018400*DB2 AREA FOR COMMUNICATIONS AREA2                                01840089
018500     COPY SQLCA2.                                                 01850089
018600                                                                  01860089
018700******************************************************************01870089
018800*   DB2 DCLGEN FOR SU-OUTBOUND UPC TABLE                          01880089
018900*   SUT_OTBND_UPC                                                 01890089
019000******************************************************************01900089
019100     EXEC SQL                                                     01910089
019200          INCLUDE SUT00028                                        01920089
019300     END-EXEC.                                                    01930089
019400                                                                  01940089
019500******************************************************************01950089
019600*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   01960089
019700*   RC-RECEIVER TABLE                                             01970089
019800******************************************************************01980089
019900     EXEC SQL                                                     01990089
020000          INCLUDE TRECEIV                                         02000089
020100     END-EXEC.                                                    02010089
020200                                                                  02020089
020300******************************************************************02030089
020400*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02040089
020500*   RC-RECEIPT ITEM TABLE                                         02050089
020600******************************************************************02060089
020700     EXEC SQL                                                     02070089
020800          INCLUDE TRECITM                                         02080089
020900     END-EXEC.                                                    02090089
021000                                                                  02100089
021100******************************************************************02110089
021200*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02120089
021300*   PO-PURCHASE TABLE                                             02130089
021400******************************************************************02140089
021500     EXEC SQL                                                     02150089
021600          INCLUDE TPURCHS                                         02160089
021700     END-EXEC.                                                    02170089
021800                                                                  02180089
021900******************************************************************02190089
022000*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02200089
022100*   EXTERNAL ENTERPRISE NAME TABLE                                02210089
022200******************************************************************02220089
022300     EXEC SQL                                                     02230089
022400          INCLUDE TENTNME                                         02240089
022500     END-EXEC.                                                    02250089
022600                                                                  02260089
022700******************************************************************02270089
022800*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02280089
022900*   RC-TROUBLE NOTIFICATION TABLE                                 02290089
023000******************************************************************02300089
023100     EXEC SQL                                                     02310089
023200          INCLUDE TTRBNTF                                         02320089
023300     END-EXEC.                                                    02330089
023400                                                                  02340089
023500******************************************************************02350089
023600*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02360089
023700*   RC-TROUBLE REASON CODES TABLE                                 02370089
023800******************************************************************02380089
023900     EXEC SQL                                                     02390089
024000          INCLUDE TTRBRSN                                         02400089
024100     END-EXEC.                                                    02410089
024200                                                                  02420089
024300******************************************************************02430089
024400*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02440089
024500*   SU-OUTBOUND EDI PACKLIST/VENDOR TABLE                         02450089
024600*   SUT_OTBND_VND                                                 02460089
024700******************************************************************02470089
024800     EXEC SQL                                                     02480089
024900          INCLUDE SUT00026                                        02490089
025000     END-EXEC.                                                    02500089
025100                                                                  02510089
025200******************************************************************02520089
025300*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE                   02530089
025400*   RC-PACK SLIP TABLE                                            02540089
025500******************************************************************02550089
025600     EXEC SQL                                                     02560089
025700          INCLUDE TPKSLIP                                         02570089
025800     END-EXEC.                                                    02580089
025900                                                                  02590089
026000                                                                  02600089
026010******************************************************************02601089
026030*   XLT_UPC                                                       02603089
026040******************************************************************02604089
026050     EXEC SQL                                                     02605089
026060          INCLUDE XLT00006                                        02606089
026070     END-EXEC.                                                    02607089
026080                                                                  02608089
026090                                                                  02609089
026091******************************************************************02609189
026092*   XLT_SKU                                                       02609289
026093******************************************************************02609389
026094     EXEC SQL                                                     02609489
026095          INCLUDE XLT00003                                        02609589
026096     END-EXEC.                                                    02609689
026097                                                                  02609789
026098                                                                  02609889
026099******************************************************************02609989
026100*   XLV_VND_STYL                                                  02610089
026101******************************************************************02610189
026102     EXEC SQL                                                     02610289
026103          INCLUDE XLV00001                                        02610389
026104     END-EXEC.                                                    02610489
026105                                                                  02610589
026106                                                                  02610689
026110******************************************************************02611089
026200* PO-RCVR-LINE-CSR                                                02620089
026300******************************************************************02630089
026400     EXEC SQL                                                     02640089
026500          DECLARE PO-RCVR-LINE-CSR CURSOR FOR                     02650089
026600   SELECT DISTINCT TRN_NBR                                        02660089
026700        , RCVR_SEQ_NBR                                            02670089
026800        , TRN_LNE_NBR                                             02680089
026900        , TRN_TYP_CDE                                             02690089
026910        , UPC_NBR                                                 02691089
026920     FROM SUT_OTBND_UPC                                           02692089
026930    WHERE SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                         02693089
026940      AND SHPD_UNT_QTY > 0                                        02694089
026950     WITH UR                                                      02695089
026960     END-EXEC.                                                    02696089
026970                                                                  02697089
026980                                                                  02698089
026990***********************************************************       02699089
027000*  RECORD LAYOUT FOR THE SML EXTRACT FILE FOR CARTONS             02700089
027100*  CREATED AND NOT MANIFESTED TO A TRAILER.                       02710089
027200***********************************************************       02720089
027300*INPUT FILE LAYOUT                                                02730089
027400     COPY SURD044.                                                02740089
027500                                                                  02750089
027600***********************************************************       02760089
027700*  RECORD LAYOUT FOR THE SML EXTRACT FILE FOR CARTONS             02770089
027800*  CREATED AND MANIFESTED TO A TRAILER.                           02780089
027900***********************************************************       02790089
028000*OUTPUT FILE LAYOUT                                               02800089
028100     COPY SURD045.                                                02810089
028200                                                                  02820089
028300                                                                  02830089
028400 EJECT                                                            02840089
028500***********************************************************       02850089
028600 PROCEDURE DIVISION.                                              02860089
028700***********************************************************       02870089
028800     DISPLAY '***BEGINNING SUKUT089***'.                          02880089
028900                                                                  02890089
029000     PERFORM 1000-INITIALIZE.                                     02900089
029100                                                                  02910089
029200     PERFORM 2000-PROCESS-EXTRACTS                                02920089
029300         UNTIL PS-END-OF-INPUT-FILE.                              02930089
029400                                                                  02940089
029500     PERFORM 9000-CLOSE-FILES.                                    02950089
029600                                                                  02960089
029700     GOBACK.                                                      02970089
029800                                                                  02980089
029900                                                                  02990089
030000******************************************************************03000089
030100*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        03010089
030200 1000-INITIALIZE.                                                 03020089
030300******************************************************************03030089
030400     OPEN INPUT  INPUT-FILE                                       03040089
030500          OUTPUT EXTRACT-FILE.                                    03050089
030600                                                                  03060089
030700     PERFORM 7000-READ-INPUT-FILE.                                03070089
030800                                                                  03080089
030900                                                                  03090089
031000***************************************************************** 03100089
031100 2000-PROCESS-EXTRACTS.                                           03110089
031200***************************************************************** 03120089
031300     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       03130089
031400                                                                  03140089
031500        MOVE SU044-CRE-DATE          TO PV-CRE-DATE               03150089
031600        MOVE PV-CRE-DATE-CC          TO PV-TMST-CC                03160089
031700        MOVE PV-CRE-DATE-YY          TO PV-TMST-YY                03170089
031800        MOVE PV-CRE-DATE-MM          TO PV-TMST-MM                03180089
031900        MOVE PV-CRE-DATE-DD          TO PV-TMST-DD                03190089
032000                                                                  03200089
032100        MOVE SU044-CRE-TIME          TO PV-CRE-TIME               03210089
032200        MOVE PV-CRE-TIME-HRS         TO PV-TMST-HRS               03220089
032300        MOVE PV-CRE-TIME-MIN         TO PV-TMST-MIN               03230089
032400        MOVE PV-CRE-TIME-SEC         TO PV-TMST-SEC               03240089
032500                                                                  03250089
032600                                                                  03260089
032700        IF SU044-CART-SRC-CDE = 'P2L'                             03270089
032800           IF PV-CREATE-TMST >= SU044-P2L-BEG-TMST AND            03280089
032900              PV-CREATE-TMST <= SU044-P2L-END-TMST                03290089
033000              PERFORM 2100-GET-PO-RCVR-LINES                      03300089
033100           END-IF                                                 03310089
033200        ELSE                                                      03320089
033300        IF SU044-CART-SRC-CDE = 'JWL'                             03330089
033400           IF PV-CREATE-TMST >= SU044-JWL-BEG-TMST AND            03340089
033500              PV-CREATE-TMST <= SU044-JWL-END-TMST                03350089
033600              PERFORM 2100-GET-PO-RCVR-LINES                      03360089
033700           END-IF                                                 03370089
033800        ELSE                                                      03380089
033900           IF PV-CREATE-TMST >= SU044-FLAT-BEG-TMST AND           03390089
034000              PV-CREATE-TMST <= SU044-OTHER-END-TMST              03400089
034100              PERFORM 2100-GET-PO-RCVR-LINES                      03410089
034200           END-IF                                                 03420089
034300        END-IF                                                    03430089
034400        END-IF.                                                   03440089
034500                                                                  03450089
034600        PERFORM 7000-READ-INPUT-FILE.                             03460089
034700                                                                  03470089
034800***************************************************************** 03480089
034900 2100-GET-PO-RCVR-LINES.                                          03490089
035000***************************************************************** 03500089
035100     MOVE  ZEROES  TO  PV-PREVIOUS-PO                             03510089
035200                       PV-PREVIOUS-RCVR                           03520089
035300                       PV-PREVIOUS-LINE.                          03530089
035400                                                                  03540089
035500     PERFORM 7010-OPEN-PO-RCVR-LINE-CSR.                          03550089
035600                                                                  03560089
035700     PERFORM 7020-FETCH-PO-RCVR-LINE-CSR.                         03570089
035800                                                                  03580089
035810*** DMH 12/31/09 - BEGIN                                          03581089
035820     IF  SUT00028-TRN-TYP-CDE  =  'CS'                            03582089
035821         PERFORM 2400-GET-CS-DETAILS                              03582189
035822            UNTIL PS-EOF-PO-RCVR-LINE-CSR                         03582289
035830     ELSE                                                         03583089
035840*** DMH 12/31/09 - END                                            03584089
035850                                                                  03585089
035900         PERFORM 2110-GET-PO-DETAILS                              03590089
036000             UNTIL PS-EOF-PO-RCVR-LINE-CSR                        03600089
036010     END-IF.                                                      03601089
036100                                                                  03610089
036200     PERFORM 7030-CLOSE-PO-RCVR-LINE-CSR.                         03620089
036300                                                                  03630089
036400     SET  PS-NOT-EOF-PO-RCVR-LINE-CSR TO TRUE.                    03640089
036500                                                                  03650089
036600                                                                  03660089
036700***************************************************************** 03670089
036800 2110-GET-PO-DETAILS.                                             03680089
036900***************************************************************** 03690089
037000     IF  SUT00028-TRN-NBR  =  PV-PREVIOUS-PO  AND                 03700089
037100         DK-RCVR-SEQ-NBR   =  PV-PREVIOUS-RCVR                    03710089
037200         CONTINUE                                                 03720089
037300     ELSE                                                         03730089
037400         IF  SUT00028-TRN-TYP-CDE  =  'PO'                        03740089
037500             SET  PS-TRECEIV-FOUND-NO  TO  TRUE                   03750089
037600             PERFORM 7100-SELECT-TRECEIV                          03760089
037700         END-IF                                                   03770089
037800     END-IF.                                                      03780089
037900                                                                  03790089
038000     IF  PS-TRECEIV-FOUND-YES                                     03800089
038100         IF  SUT00028-TRN-NBR      =  PV-PREVIOUS-PO    AND       03810089
038200             DK-RCVR-SEQ-NBR       =  PV-PREVIOUS-RCVR  AND       03820089
038300             SUT00028-TRN-LNE-NBR  =  PV-PREVIOUS-LINE            03830089
038400             CONTINUE                                             03840089
038500         ELSE                                                     03850089
038600             IF  SUT00028-TRN-TYP-CDE  =  'PO'                    03860089
038700                 PERFORM 7200-SELECT-TRECITM                      03870089
038800                 PERFORM 7300-CHECK-FOR-RCVR-TRBL                 03880089
038900                 PERFORM 7400-GET-VENDOR-INFO                     03890089
039000             END-IF                                               03900089
039100         END-IF                                                   03910089
039200     ELSE                                                         03920089
039300       CONTINUE                                                   03930089
039400     END-IF                                                       03940089
039500                                                                  03950089
039600     PERFORM 2200-LOAD-EXTRACT-RECORD.                            03960089
039700     ADD +1 TO PV-WRITE-EXTR-COUNT                                03970089
039800     PERFORM 8000-WRITE-EXTRACT.                                  03980089
039900                                                                  03990089
040000     MOVE SUT00028-TRN-NBR      TO  PV-PREVIOUS-PO                04000089
040010                                    PV-PREVIOUS-CS.               04001091
040100     MOVE DK-RCVR-SEQ-NBR       TO  PV-PREVIOUS-RCVR              04010089
040200     MOVE SUT00028-TRN-LNE-NBR  TO  PV-PREVIOUS-LINE              04020089
040300                                                                  04030089
040400     PERFORM 7020-FETCH-PO-RCVR-LINE-CSR.                         04040089
040500                                                                  04050089
040600                                                                  04060089
040700***************************************************************** 04070089
040800 2200-LOAD-EXTRACT-RECORD.                                        04080089
040900***************************************************************** 04090089
041000     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       04100089
041100                                                                  04110089
041200     INITIALIZE SU045-EXTRACT-RECORD.                             04120089
041300                                                                  04130089
041400     MOVE SU044-ORGN-LOC-NBR       TO SU045-ORGN-LOC-NBR.         04140089
041500     MOVE SU044-DEST-LOC-NBR       TO SU045-DEST-LOC-NBR.         04150089
041600     MOVE SU044-SHIPT-UNT-ID       TO SU045-SHIPT-UNT-ID.         04160089
041700     MOVE SU044-CART-SRC-CDE       TO SU045-CART-SRC-CDE.         04170089
041800     MOVE SU044-CRTN-STATUS        TO SU045-CRTN-STATUS.          04180089
041900     MOVE SU044-NEW-STR-IND        TO SU045-NEW-STR-IND.          04190089
042000     MOVE SUT00028-TRN-NBR         TO SU045-TRN-NBR.              04200089
042100     MOVE SUT00028-UPC-NBR         TO SU045-UPC-NBR.              04210089
042200     MOVE DK-RCVR-SEQ-NBR          TO SU045-RCVR-SEQ-NBR.         04220089
042300     MOVE DK-TRN-LNE-NBR           TO SU045-TRN-LNE-NBR.          04230089
042400     MOVE PV-CRE-DATE              TO SU045-CRE-DATE.             04240089
042500     MOVE PV-CRE-TIME              TO SU045-CRE-TIME.             04250089
042600     MOVE SPACES                   TO SU045-LNE-LOC-CDE.          04260089
042700     MOVE SPACES                   TO SU045-PRC-AREA-ID.          04270089
042800     MOVE PV-VRFD-DATE             TO SU045-VERIFY-DATE.          04280089
042900     MOVE PV-VRFD-TIME             TO SU045-VERIFY-TIME.          04290089
043000     IF PV-RCVR-TRBL-CNT > 0 OR PV-LINE-TRBL-CNT > 0              04300089
043100        MOVE PC-Y                  TO SU045-TRBL-IND              04310089
043200     ELSE                                                         04320089
043300        MOVE PC-N                  TO SU045-TRBL-IND              04330089
043400     END-IF                                                       04340089
043500     IF RECITM-STATUS-CDE = 'VE'                                  04350089
043600        MOVE PC-Y                  TO SU045-LINE-VRFD-IND         04360089
043700     ELSE                                                         04370089
043800        MOVE PC-N                  TO SU045-LINE-VRFD-IND         04380089
043900     END-IF                                                       04390089
044000     IF RECEIV-STATUS-CDE = 'VE'                                  04400089
044100        MOVE PC-Y                  TO SU045-RCVR-VRFD-IND         04410089
044200     ELSE                                                         04420089
044300        MOVE PC-N                  TO SU045-RCVR-VRFD-IND         04430089
044400     END-IF                                                       04440089
044500     MOVE PURCHS-ENT-ID            TO SU045-VENDOR-ID.            04450089
044600     MOVE ENTNME-ENT-NAME-DESC     TO SU045-VENDOR-NAME.          04460089
044700     MOVE PURCHS-SEASET-SHRT-NM    TO SU045-SEASET-NAME.          04470089
044800     MOVE PURCHS-DEPT-NBR          TO SU045-DEPT-NBR.             04480089
044900                                                                  04490089
044901***************************************************************** 04490189
044902* GET CENTRAL STOCK CARTON DETAILS                              * 04490289
044903* DMH 12/31/09                                                  * 04490389
044904***************************************************************** 04490489
044910 2400-GET-CS-DETAILS.                                             04491089
044911     MOVE  ZEROES  TO         PV-VRFD-DATE                        04491189
044912                              PV-VRFD-TIME                        04491289
044913                              RECITM-PREPK-ID                     04491389
044914                              PV-RCVR-TRBL-CNT                    04491489
044915                              PURCHS-ENT-ID                       04491589
044916                              PURCHS-DEPT-NBR.                    04491689
044917                                                                  04491789
044918     MOVE  SPACES  TO         RECEIV-STATUS-CDE                   04491889
044919                              RECITM-STATUS-CDE                   04491989
044920                              PURCHS-SEASET-SHRT-NM               04492089
044922                              ENTNME-ENT-NAME-DESC.               04492289
044923                                                                  04492389
044924     IF  SUT00028-TRN-NBR  =  PV-PREVIOUS-CS                      04492489
044926         CONTINUE                                                 04492689
044927     ELSE                                                         04492789
044929         PERFORM 7500-GET-CS-VENDOR-INFO                          04492989
044932     END-IF.                                                      04493289
044933                                                                  04493389
044950     PERFORM 2500-LOAD-CS-EXTRACT-RECORD.                         04495089
044951     ADD +1 TO PV-WRITE-EXTR-COUNT                                04495189
044952     PERFORM 8000-WRITE-EXTRACT.                                  04495289
044953                                                                  04495389
044954     MOVE SUT00028-TRN-NBR      TO  PV-PREVIOUS-CS                04495489
044955                                    PV-PREVIOUS-PO.               04495591
044957                                                                  04495789
044958     PERFORM 7020-FETCH-PO-RCVR-LINE-CSR.                         04495889
044959                                                                  04495989
044960                                                                  04496089
044961***************************************************************** 04496189
044962* BUILD CENTRAL STOCK EXTRACT RECORD.                           * 04496289
044963* DMH 12/31/09                                                  * 04496389
044964***************************************************************** 04496489
044965 2500-LOAD-CS-EXTRACT-RECORD.                                     04496589
044966     MOVE '2500-LOAD-CS-EXTRACT    ' TO PV-ABEND-PARAGRAPH.       04496689
044967                                                                  04496789
044968     INITIALIZE SU045-EXTRACT-RECORD.                             04496889
044969                                                                  04496989
044970     MOVE SU044-ORGN-LOC-NBR       TO SU045-ORGN-LOC-NBR.         04497089
044971     MOVE SU044-DEST-LOC-NBR       TO SU045-DEST-LOC-NBR.         04497189
044972     MOVE SU044-SHIPT-UNT-ID       TO SU045-SHIPT-UNT-ID.         04497289
044973     MOVE SU044-CART-SRC-CDE       TO SU045-CART-SRC-CDE.         04497389
044974     MOVE SU044-CRTN-STATUS        TO SU045-CRTN-STATUS.          04497489
044975     MOVE SU044-NEW-STR-IND        TO SU045-NEW-STR-IND.          04497589
044976     MOVE SUT00028-TRN-NBR         TO SU045-TRN-NBR.              04497689
044977     MOVE SUT00028-UPC-NBR         TO SU045-UPC-NBR.              04497789
044978     MOVE ZEROES                   TO SU045-RCVR-SEQ-NBR.         04497889
044979     MOVE SUT00028-TRN-LNE-NBR     TO SU045-TRN-LNE-NBR.          04497989
044980     MOVE PV-CRE-DATE              TO SU045-CRE-DATE.             04498089
044981     MOVE PV-CRE-TIME              TO SU045-CRE-TIME.             04498189
044982     MOVE SPACES                   TO SU045-LNE-LOC-CDE.          04498289
044983     MOVE SPACES                   TO SU045-PRC-AREA-ID.          04498389
044984     MOVE SU044-CRE-DATE           TO SU045-VERIFY-DATE.          04498489
044985     MOVE SU044-CRE-TIME           TO SU045-VERIFY-TIME.          04498589
044987     MOVE SPACES                   TO SU045-TRBL-IND              04498789
044992     MOVE SPACES                   TO SU045-LINE-VRFD-IND         04499289
044997     MOVE SPACES                   TO SU045-RCVR-VRFD-IND         04499789
045001     MOVE XLV00001-ENT-ID          TO SU045-VENDOR-ID.            04500189
045002     MOVE ENTNME-ENT-NAME-DESC     TO SU045-VENDOR-NAME.          04500289
045003     MOVE SPACES                   TO SU045-SEASET-NAME.          04500389
045004     MOVE XLV00001-DEPT-NBR        TO SU045-DEPT-NBR.             04500489
045005                                                                  04500589
045006                                                                  04500689
045007                                                                  04500789
045010***************************************************************** 04501089
045100 7000-READ-INPUT-FILE.                                            04510089
045200***************************************************************** 04520089
045300      READ INPUT-FILE INTO SU044-EXTRACT-RECORD                   04530089
045400        AT END                                                    04540089
045500           SET PS-END-OF-INPUT-FILE TO TRUE                       04550089
045600        NOT AT END                                                04560089
045700           ADD +1 TO PV-READ-COUNT                                04570089
045800      END-READ.                                                   04580089
045900                                                                  04590089
046000***************************************************************** 04600089
046100 7010-OPEN-PO-RCVR-LINE-CSR.                                      04610089
046200***************************************************************** 04620089
046300     MOVE SU044-SHIPT-UNT-ID TO DK-SHIPT-UNT-ID                   04630089
046400                                                                  04640089
046500     EXEC SQL                                                     04650089
046600         OPEN PO-RCVR-LINE-CSR                                    04660089
046700     END-EXEC.                                                    04670089
046800                                                                  04680089
046900     EVALUATE TRUE                                                04690089
047000         WHEN SQLCODE = +0                                        04700089
047100             CONTINUE                                             04710089
047200         WHEN SQLWARN0 NOT = SPACE                                04720089
047300         WHEN SQLCODE  NOT = +0                                   04730089
047400             MOVE '7010-OPEN-PO-RCVR-LINE-CSR'                    04740089
047500                                 TO PV-ABEND-PARAGRAPH            04750089
047600             MOVE 'OPEN CURSOR '                                  04760089
047700                                 TO PV-ABEND-OPERATION            04770089
047800             MOVE 'SUT_OTBND_UPC '                                04780089
047900                                 TO PV-DB2-TABLE-NAME1            04790089
048000             PERFORM Z999-SQL-ABEND                               04800089
048100     END-EVALUATE.                                                04810089
048200                                                                  04820089
048300                                                                  04830089
048400***************************************************************** 04840089
048500* FETCH PO-RCVR-LINES FOR EACH CARTON.                            04850089
048600* IF RCVR IS 0 GET RCVR FROM SUT_OTBND_VND, TPKSLIP               04860089
048700 7020-FETCH-PO-RCVR-LINE-CSR.                                     04870089
048800***************************************************************** 04880089
048900     EXEC SQL                                                     04890089
049000          FETCH PO-RCVR-LINE-CSR                                  04900089
049100           INTO  :SUT00028-TRN-NBR                                04910089
049200               , :SUT00028-RCVR-SEQ-NBR                           04920089
049300               , :SUT00028-TRN-LNE-NBR                            04930089
049400               , :SUT00028-TRN-TYP-CDE                            04940089
049500               , :SUT00028-UPC-NBR                                04950089
049600     END-EXEC.                                                    04960089
049700                                                                  04970089
049800     EVALUATE TRUE                                                04980089
049900         WHEN SQLCODE = +0                                        04990089
050000              MOVE SUT00028-TRN-LNE-NBR TO DK-TRN-LNE-NBR         05000089
050100                                                                  05010089
050200              IF  SUT00028-TRN-TYP-CDE  =  'PO'                   05020089
050300                  IF  SUT00028-TRN-NBR  >      0  AND             05030089
050400                      SUT00028-RCVR-SEQ-NBR =  0                  05040089
050500                      PERFORM 7050-GET-RECEIVER                   05050089
050600                  ELSE                                            05060089
050700                     MOVE SUT00028-RCVR-SEQ-NBR TO DK-RCVR-SEQ-NBR05070089
050800                  END-IF                                          05080089
050900              ELSE                                                05090089
051000                  MOVE ZEROES  TO  DK-RCVR-SEQ-NBR                05100089
051100              END-IF                                              05110089
051200                                                                  05120089
051300         WHEN SQLCODE = +100                                      05130089
051400              SET PS-EOF-PO-RCVR-LINE-CSR TO TRUE                 05140089
051500         WHEN SQLWARN0 NOT = SPACE                                05150089
051600         WHEN SQLCODE  NOT = +0                                   05160089
051700              MOVE '7020-FETCH-PO-RCVR-LINE-CSR'                  05170089
051800                                   TO PV-ABEND-PARAGRAPH          05180089
051900              MOVE 'ATTEMPTING TO FETCH PO-RCVR-LINE CURSOR'      05190089
052000                                   TO PV-ABEND-OPERATION          05200089
052100              MOVE SUT00028-TRN-NBR      TO                       05210089
052200                                PV-DISPLAY-TRN-NBR                05220089
052300              MOVE DK-RCVR-SEQ-NBR TO                             05230089
052400                                PV-DISPLAY-RCVR-SEQ-NBR           05240089
052500              MOVE SUT00028-TRN-LNE-NBR  TO                       05250089
052600                                PV-DISPLAY-TRN-LNE-NBR            05260089
052700              PERFORM Z999-SQL-ABEND                              05270089
052800     END-EVALUATE.                                                05280089
052900                                                                  05290089
053000                                                                  05300089
053100***************************************************************** 05310089
053200 7030-CLOSE-PO-RCVR-LINE-CSR.                                     05320089
053300***************************************************************** 05330089
053400     EXEC SQL                                                     05340089
053500         CLOSE PO-RCVR-LINE-CSR                                   05350089
053600     END-EXEC                                                     05360089
053700                                                                  05370089
053800     EVALUATE TRUE                                                05380089
053900         WHEN SQLCODE = ZERO                                      05390089
054000             CONTINUE                                             05400089
054100         WHEN OTHER                                               05410089
054200             MOVE '7030-CLOSE-PO-RCVR-LINE-CURSOR'                05420089
054300                                 TO PV-ABEND-PARAGRAPH            05430089
054400             MOVE 'CLOSE CURSOR '                                 05440089
054500                                 TO PV-ABEND-OPERATION            05450089
054600             MOVE 'SUT_OTBND_UPC '                                05460089
054700                                 TO PV-DB2-TABLE-NAME1            05470089
054800             PERFORM Z999-SQL-ABEND                               05480089
054900     END-EVALUATE.                                                05490089
055000                                                                  05500089
055100***************************************************************** 05510089
055200 7050-GET-RECEIVER.                                               05520089
055300***************************************************************** 05530089
055400     EXEC SQL                                                     05540089
055500         SELECT   DISTINCT B.REC_SEQ_NBR                          05550089
055600           INTO   :PKSLIP-REC-SEQ-NBR                             05560089
055700           FROM   SUT_OTBND_VND A                                 05570089
055800              ,   TPKSLIP       B                                 05580089
055900          WHERE   A.SHIPT_UNT_ID     = :DK-SHIPT-UNT-ID           05590089
056000            AND   B.VER_STAT_CDE     = 'A'                        05600089
056100            AND   A.PO_NBR           = B.PO_NBR                   05610089
056200            AND   A.PKSL_SEQ_NBR     = B.SEQ_NBR                  05620089
056300        WITH UR                                                   05630089
056400     END-EXEC.                                                    05640089
056500                                                                  05650089
056600     EVALUATE TRUE                                                05660089
056700         WHEN SQLCODE = +0                                        05670089
056800              MOVE PKSLIP-REC-SEQ-NBR TO DK-RCVR-SEQ-NBR          05680089
056900         WHEN SQLWARN0 NOT = SPACE                                05690089
057000         WHEN SQLCODE  NOT = +0                                   05700089
057100              MOVE '7050-GET-RECEIVER'                            05710089
057200                                   TO PV-ABEND-PARAGRAPH          05720089
057300              MOVE 'ATTEMPTING TO SELECT SUT_OTBND_VND '          05730089
057400                                   TO PV-ABEND-OPERATION          05740089
057500              MOVE SUT00026-PO-NBR      TO                        05750089
057600                                PV-DISPLAY-TRN-NBR                05760089
057700                                                                  05770089
057800              MOVE SUT00026-PKSL-SEQ-NBR TO                       05780089
057900                                PV-DISPLAY-RCVR-SEQ-NBR           05790089
058000              PERFORM Z999-SQL-ABEND                              05800089
058100     END-EVALUATE.                                                05810089
058200                                                                  05820089
058300***************************************************************** 05830089
058400 7100-SELECT-TRECEIV.                                             05840089
058500***************************************************************** 05850089
058600     EXEC SQL                                                     05860089
058700         SELECT   DATE(VERFYD_TMST)                               05870089
058800              ,   TIME(VERFYD_TMST)                               05880089
058900              ,   STATUS_CDE                                      05890089
059000           INTO  :PV-VRFD-DATE                                    05900089
059100              ,  :PV-VRFD-TIME                                    05910089
059200              ,  :RECEIV-STATUS-CDE                               05920089
059300           FROM   TRECEIV                                         05930089
059400          WHERE   ORD_NBR        = :SUT00028-TRN-NBR              05940089
059500            AND   REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR               05950089
059600            WITH UR                                               05960089
059700     END-EXEC.                                                    05970089
059800                                                                  05980089
059900     EVALUATE TRUE                                                05990089
060000         WHEN SQLCODE = +0                                        06000089
060100              SET PS-TRECEIV-FOUND-YES TO TRUE                    06010089
060200              IF  RECEIV-STATUS-CDE  = 'VE'                       06020089
060300                  CONTINUE                                        06030089
060400              ELSE                                                06040089
060500                 MOVE SPACES TO PV-VRFD-DATE                      06050089
060600                                PV-VRFD-TIME                      06060089
060700              END-IF                                              06070089
060800                                                                  06080089
060900         WHEN SQLCODE = +100                                      06090089
061000              SET PS-TRECEIV-FOUND-NO  TO TRUE                    06100089
061100         WHEN SQLWARN0 NOT = SPACE                                06110089
061200         WHEN SQLCODE  NOT = +0                                   06120089
061300              MOVE '7100-SELECT-TRECEIV'                          06130089
061400                                   TO PV-ABEND-PARAGRAPH          06140089
061500              MOVE 'ATTEMPTING TO SELECT TRECEIV'                 06150089
061600                                   TO PV-ABEND-OPERATION          06160089
061700              MOVE SUT00028-TRN-NBR      TO                       06170089
061800                                PV-DISPLAY-TRN-NBR                06180089
061900              MOVE DK-RCVR-SEQ-NBR TO                             06190089
062000                                PV-DISPLAY-RCVR-SEQ-NBR           06200089
062100              PERFORM Z999-SQL-ABEND                              06210089
062200     END-EVALUATE.                                                06220089
062300                                                                  06230089
062400***************************************************************** 06240089
062500 7200-SELECT-TRECITM.                                             06250089
062600***************************************************************** 06260089
062700     MOVE SPACE  TO RECITM-STATUS-CDE.                            06270089
062800     MOVE ZERO   TO RECITM-PREPK-ID.                              06280089
062900                                                                  06290089
063000     EXEC SQL                                                     06300089
063100         SELECT   STATUS_CDE                                      06310089
063200              ,   PREPK_ID                                        06320089
063300           INTO  :RECITM-STATUS-CDE                               06330089
063400              ,  :RECITM-PREPK-ID                                 06340089
063500           FROM   TRECITM                                         06350089
063600          WHERE   ORD_NBR        = :SUT00028-TRN-NBR              06360089
063700            AND   REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR               06370089
063800            AND   ORD_LNE_NBR    = :DK-TRN-LNE-NBR                06380089
063900            WITH UR                                               06390089
064000     END-EXEC.                                                    06400089
064100                                                                  06410089
064200     EVALUATE TRUE                                                06420089
064300         WHEN SQLCODE = +0                                        06430089
064400         WHEN SQLCODE = +100                                      06440089
064500              CONTINUE                                            06450089
064600         WHEN SQLWARN0 NOT = SPACE                                06460089
064700         WHEN SQLCODE  NOT = +0                                   06470089
064800              MOVE '7200-SELECT-TRECITM'                          06480089
064900                                   TO PV-ABEND-PARAGRAPH          06490089
065000              MOVE 'ATTEMPTING TO SELECT TRECITM'                 06500089
065100                                   TO PV-ABEND-OPERATION          06510089
065200              MOVE SUT00028-TRN-NBR      TO                       06520089
065300                                PV-DISPLAY-TRN-NBR                06530089
065400              MOVE DK-RCVR-SEQ-NBR TO                             06540089
065500                                PV-DISPLAY-RCVR-SEQ-NBR           06550089
065600              MOVE DK-TRN-LNE-NBR  TO                             06560089
065700                                PV-DISPLAY-TRN-LNE-NBR            06570089
065800              PERFORM Z999-SQL-ABEND                              06580089
065900     END-EVALUATE.                                                06590089
066000                                                                  06600089
066100***************************************************************** 06610089
066200*FIRST CHECK FOR TROUBLE AT RCVR LEVEL.  IF TROUBLE COUNT IS 0,   06620089
066300*CHECK AT THE LINE LEVEL.                                         06630089
066400 7300-CHECK-FOR-RCVR-TRBL.                                        06640089
066500***************************************************************** 06650089
066600     EXEC SQL                                                     06660089
066700         SELECT   COUNT(*)                                        06670089
066800           INTO  :PV-RCVR-TRBL-CNT                                06680089
066900           FROM   TTRBNTF A                                       06690089
067000              ,   TTRBRSN B                                       06700089
067100          WHERE   A.PO_NBR         = :SUT00028-TRN-NBR            06710089
067200            AND   A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR             06720089
067300            AND   A.PO_LNE_NBR     = 0                            06730089
067400            AND   A.PREPK_ID       = 0                            06740089
067500            AND   A.RESOLVED_IND   IN ('N','I','R')               06750089
067600            AND   A.TRBL_RSN_CDE   = B.TRBL_RSN_CDE               06760089
067700            AND   A.TRBL_RSN_CDE NOT IN (999,301,998)             06770089
067800            AND   B.NOTIF_IND      = 'T'                          06780089
067900            WITH UR                                               06790089
068000     END-EXEC.                                                    06800089
068100                                                                  06810089
068200     EVALUATE TRUE                                                06820089
068300         WHEN SQLCODE = +0                                        06830089
068400              IF PV-RCVR-TRBL-CNT > 0                             06840089
068500                 SET SU045-TRBL-YES TO TRUE                       06850089
068600              ELSE                                                06860089
068700                 PERFORM 7350-CHECK-FOR-LINE-TRBL                 06870089
068800              END-IF                                              06880089
068900         WHEN SQLCODE = +100                                      06890089
069000              CONTINUE                                            06900089
069100         WHEN SQLWARN0 NOT = SPACE                                06910089
069200         WHEN SQLCODE  NOT = +0                                   06920089
069300              MOVE '7300-CHECK-FOR-RCVR-TRBL'                     06930089
069400                                   TO PV-ABEND-PARAGRAPH          06940089
069500              MOVE 'ATTEMPTING TO SELECT TTRBNTF'                 06950089
069600                                   TO PV-ABEND-OPERATION          06960089
069700              MOVE SUT00028-TRN-NBR      TO                       06970089
069800                                PV-DISPLAY-TRN-NBR                06980089
069900              MOVE DK-RCVR-SEQ-NBR TO                             06990089
070000                                PV-DISPLAY-RCVR-SEQ-NBR           07000089
070100              PERFORM Z999-SQL-ABEND                              07010089
070200     END-EVALUATE.                                                07020089
070300                                                                  07030089
070400***************************************************************** 07040089
070500 7350-CHECK-FOR-LINE-TRBL.                                        07050089
070600***************************************************************** 07060089
070700     EXEC SQL                                                     07070089
070800         SELECT   COUNT(*)                                        07080089
070900           INTO  :PV-LINE-TRBL-CNT                                07090089
071000           FROM   TTRBNTF A                                       07100089
071100              ,   TTRBRSN B                                       07110089
071200          WHERE   A.PO_NBR         = :SUT00028-TRN-NBR            07120089
071300            AND   A.REC_SEQ_NBR    = :DK-RCVR-SEQ-NBR             07130089
071400            AND   ((A.PO_LNE_NBR   = :SUT00028-TRN-LNE-NBR        07140089
071500            AND     B.TRBL_LVL_IND <> 'M')                        07150089
071600             OR   (A.PREPK_ID      = :RECITM-PREPK-ID             07160089
071700            AND    B.TRBL_LVL_IND  = 'M'))                        07170089
071800            AND   A.RESOLVED_IND   NOT IN ('A')                   07180089
071900            AND   A.TRBL_RSN_CDE   =  B.TRBL_RSN_CDE              07190089
072000            AND   B.NOTIF_IND      = 'T'                          07200089
072100            WITH UR                                               07210089
072200     END-EXEC.                                                    07220089
072300                                                                  07230089
072400     EVALUATE TRUE                                                07240089
072500         WHEN SQLCODE = +0                                        07250089
072600              IF PV-LINE-TRBL-CNT > 0                             07260089
072700                 SET SU045-TRBL-YES TO TRUE                       07270089
072800              ELSE                                                07280089
072900                 SET SU045-TRBL-NO  TO TRUE                       07290089
073000              END-IF                                              07300089
073100         WHEN SQLCODE = +100                                      07310089
073200              CONTINUE                                            07320089
073300         WHEN SQLWARN0 NOT = SPACE                                07330089
073400         WHEN SQLCODE  NOT = +0                                   07340089
073500              MOVE '7350-CHECK-FOR-LINE-TRBL'                     07350089
073600                                   TO PV-ABEND-PARAGRAPH          07360089
073700              MOVE 'ATTEMPTING TO SELECT TTRBNTF'                 07370089
073800                                   TO PV-ABEND-OPERATION          07380089
073900              MOVE SUT00028-TRN-NBR      TO                       07390089
074000                                PV-DISPLAY-TRN-NBR                07400089
074100              MOVE DK-RCVR-SEQ-NBR TO                             07410089
074200                                PV-DISPLAY-RCVR-SEQ-NBR           07420089
074300              MOVE SUT00028-TRN-LNE-NBR  TO                       07430089
074400                                PV-DISPLAY-TRN-LNE-NBR            07440089
074500                                                                  07450089
074600              PERFORM Z999-SQL-ABEND                              07460089
074700     END-EVALUATE.                                                07470089
074800                                                                  07480089
074900***************************************************************** 07490089
075000 7400-GET-VENDOR-INFO.                                            07500089
075100***************************************************************** 07510089
075200     EXEC SQL                                                     07520089
075300         SELECT   A.ENT_ID                                        07530089
075400              ,   A.SEASET_SHRT_NM                                07540089
075500              ,   A.DEPT_NBR                                      07550089
075600              ,   B.ENT_NAME_DESC                                 07560089
075700           INTO  :PURCHS-ENT-ID                                   07570089
075800              ,  :PURCHS-SEASET-SHRT-NM                           07580089
075900              ,  :PURCHS-DEPT-NBR                                 07590089
076000              ,  :ENTNME-ENT-NAME-DESC                            07600089
076100           FROM   TPURCHS A                                       07610089
076200              ,   TENTNME B                                       07620089
076300          WHERE   A.PO_NBR         = :SUT00028-TRN-NBR            07630089
076400            AND   A.VER_STATUS_CDE = 'A'                          07640089
076500            AND   A.ENT_ID         = B.ENT_ID                     07650089
076600            AND   B.TYPE_CDE       = :PC-01                       07660089
076700            WITH UR                                               07670089
076800     END-EXEC.                                                    07680089
076900                                                                  07690089
077000     EVALUATE TRUE                                                07700089
077100         WHEN SQLCODE = +0                                        07710089
077200         WHEN SQLCODE = +100                                      07720089
077300              CONTINUE                                            07730089
077400         WHEN SQLWARN0 NOT = SPACE                                07740089
077500         WHEN SQLCODE  NOT = +0                                   07750089
077600              MOVE '7400-GET-VENDOR-INFO'                         07760089
077700                                   TO PV-ABEND-PARAGRAPH          07770089
077800              MOVE 'ATTEMPTING TO SELECT TENTNME'                 07780089
077900                                   TO PV-ABEND-OPERATION          07790089
078000                                                                  07800089
078100              MOVE SUT00028-TRN-NBR      TO                       07810089
078200                                PV-DISPLAY-TRN-NBR                07820089
078300                                                                  07830089
078400              PERFORM Z999-SQL-ABEND                              07840089
078500     END-EVALUATE.                                                07850089
078600                                                                  07860089
078700                                                                  07870089
078701***************************************************************** 07870189
078702* GET VENDOR INFORMATION FOR CENTRAL STOCK PULL                 * 07870289
078703* DMH 12/31/09                                                  * 07870389
078704***************************************************************** 07870489
078710 7500-GET-CS-VENDOR-INFO.                                         07871089
078711                                                                  07871189
078712     EXEC SQL                                                     07871289
078713           SELECT  A.UPC_NBR                                      07871389
078714                 , C.ENT_ID                                       07871489
078715                 , C.DEPT_NBR                                     07871589
078716                 , D.ENT_NAME_DESC                                07871689
078717           INTO  :XLT00006-UPC-NBR                                07871789
078718              ,  :XLV00001-ENT-ID                                 07871889
078719              ,  :XLV00001-DEPT-NBR                               07871989
078720              ,  :ENTNME-ENT-NAME-DESC                            07872089
078721           FROM XLT_UPC A                                         07872190
078722              , XLT_SKU B                                         07872290
078723              , XLV_VND_STYL C                                    07872390
078724              , TENTNME D                                         07872490
078725           WHERE A.UPC_NBR      =  :SUT00028-UPC-NBR              07872589
078726             AND A.INTR_UPC_ID  =  B.INTR_UPC_ID                  07872689
078727             AND B.STYL_ID      =  C.STYL_ID                      07872789
078728             AND C.ENT_ID       =  D.ENT_ID                       07872889
078729             AND D.TYPE_CDE     =  :PC-01                         07872989
078730                    WITH UR                                       07873089
078731     END-EXEC.                                                    07873189
078732                                                                  07873289
078733     EVALUATE TRUE                                                07873389
078734         WHEN SQLCODE = +0                                        07873489
078735         WHEN SQLCODE = +100                                      07873589
078736              CONTINUE                                            07873689
078737         WHEN SQLWARN0 NOT = SPACE                                07873789
078738         WHEN SQLCODE  NOT = +0                                   07873889
078739              MOVE '7500-GET-CS-VENDOR-INFO'                      07873989
078740                                   TO PV-ABEND-PARAGRAPH          07874089
078741              MOVE 'ATTEMPTING TO SELECT TENTNME'                 07874189
078742                                   TO PV-ABEND-OPERATION          07874289
078743                                                                  07874389
078744              MOVE SUT00028-TRN-NBR      TO                       07874489
078745                                PV-DISPLAY-TRN-NBR                07874589
078746                                                                  07874689
078747              PERFORM Z999-SQL-ABEND                              07874789
078748     END-EVALUATE.                                                07874889
078749                                                                  07874989
078750                                                                  07875089
078800***************************************************************** 07880089
078900 8000-WRITE-EXTRACT.                                              07890089
079000***************************************************************** 07900089
079100     WRITE EXTRACT-RECORD                                         07910089
079200       FROM SU045-EXTRACT-RECORD.                                 07920089
079300                                                                  07930089
079400                                                                  07940089
079500***************************************************************** 07950089
079600 9000-CLOSE-FILES.                                                07960089
079700                                                                  07970089
079800     MOVE PV-READ-COUNT              TO PV-DISPLAY-READ-CNT.      07980089
079900     DISPLAY 'TOT RECS READ       : '   PV-DISPLAY-READ-CNT.      07990089
080000                                                                  08000089
080100     MOVE PV-WRITE-EXTR-COUNT        TO PV-DISPLAY-WRITE-CNT.     08010089
080200     DISPLAY 'TOT RECS WRITTEN    : '   PV-DISPLAY-WRITE-CNT.     08020089
080300                                                                  08030089
080400     CLOSE INPUT-FILE                                             08040089
080500           EXTRACT-FILE.                                          08050089
080600                                                                  08060089
080700                                                                  08070089
080800***************************************************************** 08080089
080900 Z999-SQL-ABEND.                                                  08090089
081000***************************************************************** 08100089
081100     MOVE SQLCODE                     TO PV-DISPLAY-SQLCODE.      08110089
081200     MOVE SU044-SHIPT-UNT-ID          TO PV-DISPLAY-SHIPT-UNT-ID. 08120089
081300     MOVE SUT00028-TRN-NBR            TO PV-DISPLAY-TRN-NBR.      08130089
081400     MOVE SUT00028-RCVR-SEQ-NBR       TO PV-DISPLAY-RCVR-SEQ-NBR. 08140089
081500     MOVE SUT00028-TRN-LNE-NBR        TO PV-DISPLAY-TRN-LNE-NBR.  08150089
081600                                                                  08160089
081700     DISPLAY '** ABEND **         ** = SQLERROR'.                 08170089
081800     DISPLAY '** PROGRAM      ** = ' PC-PROGRAM-NAME.             08180089
081900     DISPLAY '** SHIPT UNT ID ** = ' PV-DISPLAY-SHIPT-UNT-ID.     08190089
082000     DISPLAY '** TRN NBR      ** = ' PV-DISPLAY-TRN-NBR.          08200089
082100     DISPLAY '** RCVR SEQ NBR ** = ' PV-DISPLAY-RCVR-SEQ-NBR.     08210089
082200     DISPLAY '** TRN LNE NBR  ** = ' PV-DISPLAY-TRN-LNE-NBR.      08220089
082300     DISPLAY '** TRN TYP CDE  ** = ' SUT00028-TRN-TYP-CDE.        08230089
082400                                                                  08240089
082500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             08250089
082600     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                08260089
082700     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             08270089
082800     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME2.             08280089
082900     DISPLAY '** SQLCODE   ** = ' PV-DISPLAY-SQLCODE.             08290089
083000                                                                  08300089
083100     MOVE +4013                  TO PV-ABEND-CODE.                08310089
083200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08320089
