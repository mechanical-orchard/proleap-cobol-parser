      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.       TFKCS404.                                      00050000
       AUTHOR.           WILLIAM B. BURT.                               00060000
       INSTALLATION.     KOHLS.                                         00070000
       DATE-WRITTEN      AUGUST, 1996.                                  00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      * THIS PROGRAM VALIDATES AND ADDS UPC'S TO A TRANSFER AS THE      00120000
      * TRANSFER IS BEING CREATED.                                      00130000
      ******************************************************************00140000
      *  DATE 01/15/01                                                  00150000
      *  ADD CODE FOR 2ND LISTNER                                       00160000
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00170000
      ******************************************************************00180000
      *  1/20/2003 - RAY GRAF                                           00190000
      *   PROCESS NONINTELLIGENT SKU.                                   00200000
      ******************************************************************00210000
      * 12/09/2003 - DAVE WELLER          WR/IR #: 25501                00220000
      *     DEFECTIVE DAMAGES MOS AND RTV                               00230000
      *     HANDLE RED TICKET DETERMINATION PROPERLY                    00240000
      *     REJECT MOS ITEMS FOR RTV DEF/DAM SORT 2 TRANSFER TYPE       00241000
      *     REJECT RTV ITEMS FOR MOS DEF/DAM SORT 1 TRANSFER TYPE       00242000
      *     REJECT DEPT 127 AND 427 FOR EITHER DEF/DAM TRANSFER TYPE    00243000
      * 12/02/2003 - DAVE WELLER          WR/IR #: 25501                00244000
      *     IF AN ITEM IS NOT MO, ALLOW IT TO BE ADDED TO               00245000
      *     AN RTV (SORT2) TRANSFER.                                    00246000
      ******************************************************************00247000
      *  9/29/2004 - RAY GRAF                                           00248000
      *   REMOVE ALL REFERENCES TO TABLE TPPCPRC IN ORDER FOR           00249000
      *   DBA TO REDEFINE AN INDEX FOR THIS TABLE.  TPPCPRC IS NOT      00249100
      *   BEING ACCESSED IN THIS PROGRAM.                               00249200
      ******************************************************************00249300
      *  9/29/2004 - RAY GRAF                                           00249400
      *   REMOVE ALL REFERENCES TO TABLE TPPCPRC IN ORDER FOR           00249500
      *   DBA TO REDEFINE AN INDEX FOR THIS TABLE.  TPPCPRC IS NOT      00249600
      *   BEING ACCESSED IN THIS PROGRAM.                               00249700
      ******************************************************************00249800
      * 10/20/2004 - DAVE WELLER                                        00249900
      *   XS DOMAIN COMPLIANCE                                          00250000
      ******************************************************************00250100
      * 01/03/2005 - DAVE WELLER                                        00250200
      *   +100 ACCEPTABLE RETURN FROM 7050-SELECT-UPC                   00250300
      ******************************************************************00250400
      * 01/12/2005 - DAVE WELLER                                        00250500
      *   +100 ACCEPTABLE RETURN FROM 7000-SELECT-UPC                   00250600
      *       BUT ONLY IF XST00012-INTR-UPC-ID > ZEROS                  00250700
      ******************************************************************00250800
      * 02/16/2005 - DAVE WELLER   WR27349                              00250900
      * STANDARDIZE USAGE OF TFWS007                                    00251000
      ******************************************************************00251100
      * 02/28/2005 - DAVE WELLER   WR27349                              00251200
      * SEPARATE SELECT FOR XST_VND_DEPT TABLE                          00251300
      ******************************************************************00251400
051705*  DATE 05/17/05 RAY GRAF                                         00251500
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00251600
051705******************************************************************00251700
994589*  DATE 10/05/09  PRAVEENA ADAVIKOLANU       INC000000994589      00251800
994589*  ADDED DEPT 927 TO GET BLOCKED  IN THE TRANSFERS.               00251900
994589******************************************************************00252000
PK4093*  DATE 05/25/10  COGNIZANT                  PKE000000004093      00252100
PK4093*  REJECT DEPT 029, 129, 327, 527, 927,827 IN ADDITION TO 127 AND 00252200
PK4093*  427 FOR EITHER DEF/DAM TRANSFER TYPE WHEN THE 'TO' STORE       00252300
PK4093*  IS 811 (FINDLAY).                                              00252400
070711******************************************************************00252500
070711*  DATE 07/07/11  CHERI PARMLEY              WR#40189             00252600
070711*  LOOK AT XST_DEPT TABLE FOR JEWELRY DEPTS AND ELIMINATE HARD-   00252700
070711*  CODING.                                                        00252800
      ******************************************************************00252900
SR3403*  DATE:03/06/2012 JALAJ KUMAR               WR#SR3403            00253000
SR3403*  RECOMPILED THE PROGRAM FOR CHANGES DONE IN TFRD010 COPYBOOK    00254000
SR3403*  AS A PART OF LARGE RETAIL PROJECT                              00254100
      ******************************************************************00254200
P11870*  DATE:05/08/2017 BARB SCHULTZ              CHG0170592           00254300
P11870*  BLOCK PREMIUM SUNGLASSES - DEPT 431 AND APPLE WATCHES - DEPT   00254400
P11870*  30, MAJOR CLASS = 10 AND (SUBCLASS = 11 OR 12)                 00254500
P11870*  ALSO REPLACED MESSAGE 3194 WITH 3795.                          00254600
      ******************************************************************00254700
      *  DATE:02/14/2023 JEAN KURK                 CHG0281369           00254801
      *  REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE                    00254901
      ******************************************************************00255201
      ******************************************************************00255300
       ENVIRONMENT DIVISION.                                            00255400
      ******************************************************************00255500
                                                                        00255600
      ******************************************************************00255700
       DATA DIVISION.                                                   00255800
      ******************************************************************00255900
                                                                        00256000
      ******************************************************************00256100
       WORKING-STORAGE SECTION.                                         00256200
      ******************************************************************00256300
      *                                                                 00256400
      *  LISTENER QUEUE NAMES                                           00256500
      *                                                                 00257000
           COPY RFWS001.                                                00258000
                                                                        00259000
      *                                                                 00260000
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00270000
      *                                                                 00280000
           COPY TFRD009.                                                00290000
                                                                        00300000
      *                                                                 00310000
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00320000
      *                                                                 00330000
           COPY TFRD010.                                                00340000
                                                                        00350000
      *                                                                 00360000
      *  NISKU WORK AREA                                                00370000
      *                                                                 00380000
           COPY ISWS006.                                                00390000
                                                                        00400000
      *                                                                 00410000
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00420000
      *                                                                 00430000
           COPY DPWS013.                                                00440000
      *                                                                 00510000
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00520000
      *                                                                 00530000
           COPY DPRD507I.                                               00540000
                                                                        00550000
      *                                                                 00560000
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00570000
      *                                                                 00580000
           COPY DPWS011.                                                00590000
           EXEC SQL                                                     00600000
                INCLUDE XST00008                                        00610000
           END-EXEC.                                                    00620000
           EXEC SQL                                                     00630000
                INCLUDE XST00010                                        00640000
           END-EXEC.                                                    00650000
           EXEC SQL                                                     00660000
                INCLUDE XST00012                                        00670000
           END-EXEC.                                                    00680000
           EXEC SQL                                                     00690000
                INCLUDE XST00013                                        00700000
           END-EXEC.                                                    00710000
           EXEC SQL                                                     00720000
                INCLUDE XST00015                                        00730000
           END-EXEC.                                                    00740000
           EXEC SQL                                                     00750000
                INCLUDE XST00017                                        00760000
           END-EXEC.                                                    00770000
           EXEC SQL                                                     00780000
                INCLUDE XST00018                                        00790000
           END-EXEC.                                                    00800000
                                                                        00810000
      *                                                                 00820000
      *  COMMUNICATIONS AREA FOR DB2                                    00830000
      *                                                                 00840000
           EXEC SQL                                                     00850000
               INCLUDE SQLCA                                            00860000
           END-EXEC.                                                    00870000
                                                                        00880000
                                                                        00890000
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          00900000
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          00910000
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           00920000
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           00930000
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          00940000
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           00950000
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          00960000
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          00970000
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          00980000
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          00990000
                                                                        01000000
      *    API CONTROL BLOCKS                                           01010000
                                                                        01020000
       01  MQM-OBJECT-DESCRIPTOR.                                       01030000
           COPY CMQODV.                                                 01040000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01050000
           COPY CMQMDV.                                                 01060000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01070000
           COPY CMQGMOV.                                                01080000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01090000
           COPY CMQPMOV.                                                01100000
                                                                        01110000
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01120000
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01130000
                                                                        01140000
       01  MQM-CONSTANTS.                                               01150000
           COPY CMQV.                                                   01160000
                                                                        01170000
      ***                                                               01180000
      *  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE      01190000
      *  (EPPD000)                                                      01200000
      ***                                                               01210000
                                                                        01220000
           COPY EPWS000.                                                01230000
           COPY TFWS007.                                                01240000
                                                                        01250000
       01  DK-DB2-KEYS.                                                 01260000
           05  DK-UPC-NBR                      PIC S9(15)  VALUE ZEROS  01270000
                                                           COMP-3.      01280000
           05  DK-STR-NBR                      PIC S9(04)  VALUE ZEROS  01290000
                                                           COMP.        01300000
                                                                        01310000
       01  PC-PROGRAM-CONSTANTS.                                        01320000
           05  PC-SECURE-TOTE                  PIC  X(02)  VALUE '02'.  01330000
           05  PC-VND-DC-RET-CDE               PIC  X(02)  VALUE SPACE. 01340000
               88  PC-SORT1-RET-CDE                        VALUE 'MO'.  01350000
           05  PC-ONE                          PIC  9(01)  VALUE 1.     01360000
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   01370000
           05  PC-CLEARANCE-STATUS-CODE        PIC  9(02)  VALUE 30.    01380000
           05  PC-VENDOR-UPC                   PIC  X(01)  VALUE 'V'.   01390000
           05  PC-KOHLS-INTERNAL-UPC           PIC  X(01)  VALUE 'I'.   01400000
           05  PC-RENUMBERED-UPC               PIC  X(01)  VALUE 'R'.   01410000
           05  PC-DUMMY-UPC                    PIC  X(03)  VALUE '000'. 01420000
           05  PC-DUMMY-UPC-MSG                PIC  X(42)               01430000
               VALUE 'MUST CREATE TRANSFER WITH DUMMY UPC ON CRT'.      01440000
           05  PC-ERROR-CODE                   PIC  X(01)  VALUE 'E'.   01450000
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01460000
               'TFKCS404'.                                              01470000
                                                                        01480000
           05  PC-TSYMSG-NUMBERS.                                       01490000
      ***                                                               01500000
      *  UPC DOES NOT EXIST                                             01510000
      ***                                                               01520000
               10  PC-TSYMSG-00100             PIC  9(05)  VALUE  00100.01530000
      ***                                                               01540000
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                01550000
      ***                                                               01560000
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.01570000
      ***                                                               01580000
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           01590000
      ***                                                               01600000
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.01610000
      ***                                                               01620000
      *  CANNOT ACCEPT THIS ITEM FOR TRANSFER. MUST BE IN A SECURE TOTE.01630000
      ***                                                               01640000
               10  PC-TSYMSG-01544             PIC  9(05)  VALUE  01544.01650000
      ***                                                               01660000
      *  INVALID TRANSFER ITEM TYPE.  MUST BE A (SORT1-DC) ITEM.        01670000
      ***                                                               01680000
               10  PC-TSYMSG-03192             PIC  9(05)  VALUE  03192.01690000
      ***                                                               01700000
      *  INVALID TRANSFER ITEM TYPE.  MUST BE A (SORT2-RTV) ITEM.       01710000
      ***                                                               01720000
               10  PC-TSYMSG-03193             PIC  9(05)  VALUE  03193.01730000
      ***                                                               01740000
      ** THIS DEPT REQUIRES CALLBACK TRANSFER.  CHECK STORENET FOR #.   01750000
P11870**  (OLD MESSAGE - BEEN REPLACED BY MESSAGE # 3795)               01760000
P11870***                                                               01770000
P11870***      10  PC-TSYMSG-03194             PIC  9(05)  VALUE  03194.01780000
P11870***                                                               01790000
P11870*  ITEM NOT ELIGIBLE. PLEASE REFER TO THE DAMAGED/DEFECTIVE BEST  01800000
P11870*  PRACTICE. (NEW MESSAGE)                                        01810000
P11870***                                                               01820000
P11870         10  PC-TSYMSG-03795             PIC  9(05)  VALUE  03795.01830000
                                                                        01840000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   01850000
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          01860000
           05  PH-REASON                   PIC  S9(09) BINARY.          01870000
                                                                        01880000
       01  PS-PROGRAM-SWITCHES.                                         01890000
           05  PS-SECURE-HAND-CARRY-SW        PIC  X(01)  VALUE 'N'.    01900000
               88  PS-SECURE-HAND-CARRY-OK                VALUE 'Y'.    01910000
               88  PS-SECURE-HAND-CARRY-NOT-OK            VALUE 'N'.    01920000
           05  PS-REGN-CLR-FOUND-SW            PIC  X(01)  VALUE 'N'.   01930000
               88  PS-REGN-CLR-FOUND                       VALUE 'Y'.   01940000
               88  PS-REGN-CLR-NOT-FOUND                   VALUE 'N'.   01950000
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   01960000
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   01970000
070111     05  PS-IS-DEPT-FOUND               PIC  X(01)  VALUE 'Y'.    01980000
070111         88  PS-DEPT-NOT-FOUND                      VALUE 'N'.    01990000
070111         88  PS-DEPT-FOUND                          VALUE 'Y'.    02000000
P11870     05  PS-BLOCK-SUNGLASS-WATCHES-SW   PIC  X(01)  VALUE 'N'.    02010000
P11870         88  PS-BLOCK-SUNGLASS-WATCHES              VALUE 'Y'.    02020000
                                                                        02030000
       01  PV-PROGRAM-VARIABLES.                                        02040000
           05  PV-GP-RTL-QTY-NULL-IND  PIC S9(04)  VALUE +0             02050000
                                                   COMP SYNC.           02060000
           05  PV-GP-RTL-AMT-NULL-IND  PIC S9(04)  VALUE +0             02070000
                                                   COMP SYNC.           02080000
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          02090000
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          02100000
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          02110000
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          02120000
           05  PV-QM-NAME              PIC X(48).                       02130000
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02140000
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        02150000
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        02160000
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        02170000
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        02180000
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02190000
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02200000
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02210000
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02220000
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02230000
                                                                        02240000
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  02250000
                                                           COMP SYNC.   02260000
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02270000
                                                           COMP SYNC.   02280000
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02290000
                                                                        02300000
           05  PV-TCPIPPRQ-RECORD1.                                     02310000
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02320000
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02330000
               10  FILLER                      PIC X(4104) VALUE SPACE. 02340000
           05  PV-TCPIPPRQ-RECORD2.                                     02350000
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02360000
               10  FILLER                      PIC X(4112) VALUE SPACE. 02370000
           05  PV-DISPLAY-UPC-NBR              PIC  9(13)  VALUE ZEROS. 02380000
           05  PV-DISPLAY-INTR-UPC-ID          PIC  9(09)  VALUE ZEROS. 02390000
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02400000
                                                           COMP SYNC.   02410000
P11870     05  PV-DEPT-NBR                     PIC 9(4)  VALUE ZEROES.  02420000
P11870     05  PV-MAJ-CL-NBR                   PIC 9(4)  VALUE ZEROES.  02430000
P11870     05  PV-SUB-CL-NBR                   PIC 9(4)  VALUE ZEROES.  02440000
           05  PV-CUR-RTL-AMT                  PIC S9(7)V9(2) COMP-3.   02450000
           05  PV-FROM-PRICE                   PIC S9(7)V9(2) COMP-3.   02460000
           05  PV-TO-PRICE                     PIC S9(7)V9(2) COMP-3.   02470000
           05  PV-GP-QTY                       PIC S9(3)V COMP-3.       02480000
           05  PV-GP-RTL-AMT                   PIC S9(5)V9(2) COMP-3.   02490000
           05  PV-HOLD-UPC-NBR.                                         02500000
               10  FILLER                      PIC X(02).               02510000
               10  PV-KOHLS-UPC-DIGITS         PIC X(04).               02520000
               10  PV-KOHLS-DEPT               PIC X(03).               02530000
               10  PV-KOHLS-CL.                                         02540000
                   15  PV-KOHLS-CL-1           PIC X(01).               02550000
                   15  PV-KOHLS-CL-2           PIC X(01).               02560000
               10  PV-KOHLS-CL-9 REDEFINES PV-KOHLS-CL                  02570000
                                               PIC 9(02).               02580000
               10  PV-KOHLS-DUMMY-UPC          PIC X(03).               02590000
               10  PV-KOHLS-CHECKDIGIT         PIC X(01).               02600000
           05  PV-HOLD-UPC-NBR-9 REDEFINES PV-HOLD-UPC-NBR              02610000
                                               PIC 9(15).               02620000
           05  PV-NUM-ROWS                     PIC S9(9)    VALUE ZEROS 02630000
                                                            COMP SYNC.  02640000
                                                                        02650000
      *                                                                 02660000
      ******************************************************************02670000
       PROCEDURE DIVISION.                                              02680000
      ******************************************************************02690000
       0000-PROGRAM-MAINLINE.                                           02700000
           INITIALIZE TF010-XFER-TO-PTC-RECORD.                         02710000
                                                                        02720000
           PERFORM 1000-RETRIEVE-TEXT.                                  02730000
                                                                        02740000
           PERFORM 2000-PROCESS-PTC-REQUEST.                            02750000
                                                                        02760000
           GOBACK.                                                      02770000
      *                                                                 02780000
       1000-RETRIEVE-TEXT.                                              02790000
           EXEC CICS                                                    02800000
               RETRIEVE                                                 02810000
                   INTO  (TF009-XFER-FROM-PTC-RECORD)                   02820000
                   RESP  (PV-CICS-RESPONSE)                             02830000
           END-EXEC.                                                    02840000
                                                                        02850000
           EVALUATE TRUE                                                02860000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02870000
                   CONTINUE                                             02880000
               WHEN OTHER                                               02890000
                   MOVE '1000-RETRIEVE-TEXT'                            02900000
                                   TO DP013-PARAGRAPH                   02910000
                   MOVE 'UNABLE TO RECEIVE TEXT'                        02920000
                                   TO DP013-MESSAGE-TEXT (1)            02930000
                   MOVE  TF009-XFER-FROM-PTC-RECORD                     02940000
                                   TO DP013-MESSAGE-TEXT (2)            02950000
                   SET DP013-CICS-ABEND                                 02960000
                       DP013-NO-ROLLBACK                                02970000
                                   TO TRUE                              02980000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      02990000
                   SET  DP011-MSG-FATAL                                 03000000
                                   TO TRUE                              03010000
                   MOVE PC-TSYMSG-01064                                 03020000
                                   TO DP011-MSG-NUMBER                  03030000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03040000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03050000
           END-EVALUATE.                                                03060000
                                                                        03070000
                                                                        03080000
           MOVE TF009-LISTENER-CODE                                     03090000
                                   TO PV-QUEUE-PARM.                    03100000
                                                                        03110000
           IF  PV-VALID-PARM                                            03120000
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03130000
                                   TO PV-TSQ-NAME                       03140000
                                                                        03150000
           ELSE                                                         03160000
               MOVE '1000-RETRIEVE-TEXT'                                03170000
                                   TO DP013-PARAGRAPH                   03180000
               MOVE 'INVALID PARM VALUE'                                03190000
                                   TO DP013-MESSAGE-TEXT (1)            03200000
               MOVE 'PARM VALUE = '                                     03210000
                                   TO DP013-MESSAGE-TEXT (2)            03220000
               MOVE TF009-LISTENER-CODE                                 03230000
                                   TO DP013-MESSAGE-TEXT (3)            03240000
                                                                        03250000
               SET DP013-LOGIC-ABEND                                    03260000
                   DP013-NO-ROLLBACK                                    03270000
                                   TO TRUE                              03280000
                                                                        03290000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          03300000
                                                                        03310000
               SET DP011-MSG-FATAL TO TRUE                              03320000
                                                                        03330000
               MOVE PC-TSYMSG-01064                                     03340000
                                   TO DP011-MSG-NUMBER                  03350000
                                                                        03360000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03370000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03380000
           END-IF.                                                      03390000
                                                                        03400000
                                                                        03410000
      ******************************************************************03420000
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 03430000
      ******************************************************************03440000
       2000-PROCESS-PTC-REQUEST.                                        03450000
                                                                        03460000
           MOVE TF009-UPC-NBR      TO  DK-UPC-NBR.                      03470000
           PERFORM 2500-CHECK-FOR-DUMMY-UPC.                            03480000
           PERFORM 7050-SELECT-UPC.                                     03490000
           PERFORM 3000-PROCESS-UPC.                                    03500000
                                                                        03510000
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          03520000
                                                                        03530000
       2500-CHECK-FOR-DUMMY-UPC.                                        03540000
           MOVE TF009-UPC-NBR      TO PV-HOLD-UPC-NBR.                  03550000
           IF (PV-KOHLS-UPC-DIGITS = '0400')  AND                       03560000
              (PV-KOHLS-DUMMY-UPC = PC-DUMMY-UPC)                       03570000
               MOVE PC-ERROR-CODE  TO  TF010-ERR-TYP-IND                03580000
               MOVE PC-DUMMY-UPC-MSG                                    03590000
                                   TO  TF010-ERR-MSG                    03600000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03610000
           END-IF.                                                      03620000
                                                                        03630000
       3000-PROCESS-UPC.                                                03640000
           PERFORM 3010-FIND-KOHLS-UPC-NBR.                             03650000
           IF XST00010-REGN-PRIC-IND = PC-YES                           03660000
      *        MOVE TF009-STR-NBR  TO DK-STR-NBR                        03670000
      *        RETRIEVE A DIFFERENT XST_SKU_LOC ROW                     03680000
               PERFORM 7800-CHECK-REGN-PRC                              03690000
           END-IF.                                                      03700000
           PERFORM 3432-SELECT-DC-RET-CDE.                              03710000
           MOVE XST00013-VS-NBR    TO TF010-VENDOR-STYLE.               03720000
           MOVE XST00018-ENT-NM-DESC                                    03730000
                                   TO TF010-VENDOR.                     03740000
           MOVE XST00010-NRF-CLOR-DESC                                  03750000
                                   TO TF010-COLOR.                      03760000
           MOVE XST00010-SIZE-DESC TO TF010-SIZE.                       03770000
           MOVE XST00010-SKU-DESC  TO  TF010-SKU-DESC.                  03780000
           MOVE XST00013-DEPT-NBR  TO TF010-DEPT                        03790000
                                      NI-DEPT-9-4                       03800000
P11870                                PV-DEPT-NBR.                      03810000
           MOVE XST00013-MAJ-CL-NBR                                     03820000
                                   TO TF010-CLASS                       03830000
P11870                                PV-MAJ-CL-NBR.                    03840000
           MOVE XST00013-SUB-CL-NBR                                     03850000
                                   TO TF010-SUBCLASS                    03860000
P11870                                PV-SUB-CL-NBR.                    03870000
           MOVE XST00010-SKU-NBR   TO TF010-SKU-NBR.                    03880000
           MOVE XST00008-UNT-RTL-AMT                                    03890000
                                   TO PV-CUR-RTL-AMT.                   03900000
           MOVE XST00008-GP-RTL-QTY                                     03910000
                                   TO PV-GP-QTY.                        03920000
P11870* PREMIUM SUNGLASSES                                              03930000
P11870     IF PV-DEPT-NBR = 431 OR                                      03940000
P11870* APPLE WATCHES                                                   03950000
P11870       (PV-DEPT-NBR = 30 AND                                      03960000
P11870        PV-MAJ-CL-NBR = 10 AND                                    03970000
P11870       (PV-SUB-CL-NBR = 11 OR                                     03980000
P11870        PV-SUB-CL-NBR = 12))                                      03990000
P11870          SET PS-BLOCK-SUNGLASS-WATCHES TO TRUE                   04000000
P11870     END-IF.                                                      04010000
      ***                                                               04020000
      * DEFECTIVES/DAMAGE MOS TRANSFERS CAN HAVE ONLY MOS ITEMS         04030000
      * DEFECTIVES/DAMAGE RTV TRANSFERS CAN HAVE ONLY RTV ITEMS         04040000
      ***                                                               04050000
           EVALUATE TF009-XFER-TYP-CDE-X                                04060000
               WHEN TF007-DEFECTIVES-DAMAGES-SORT1                      04070000
               WHEN TF007-DEFECTIVES-DAMAGES-SORT2                      04080000
      ***                                                               04090000
      * CERTAIN DEPARTMENTS CAN'T BE RETURNED AS DEF/DAMAGE             04100000
      ***                                                               04110000
070711             MOVE XST00013-DEPT-NBR TO XST00015-DEPT-NBR          04120000
070711             PERFORM 3005-CHECK-JEWELRY-DEPT                      04130000
                   IF PS-DEPT-FOUND OR                                  04140000
P11870                PS-BLOCK-SUNGLASS-WATCHES                         04150000
                       SET DP011-MSG-FATAL                              04160000
                                   TO TRUE                              04170000
P11870                 MOVE PC-TSYMSG-03795                             04180000
                                   TO DP011-MSG-NUMBER                  04190000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  04200000
                       PERFORM 8000-SEND-DATA-TO-LISTENER               04210000
                   END-IF                                               04220000
                   EVALUATE TF009-XFER-TYP-CDE-X                        04230000
                       WHEN TF007-DEFECTIVES-DAMAGES-SORT1              04240000
                           IF NOT PC-SORT1-RET-CDE THEN                 04250000
                               SET  DP011-MSG-FATAL                     04260000
                                   TO TRUE                              04270000
                               MOVE PC-TSYMSG-03192                     04280000
                                   TO DP011-MSG-NUMBER                  04290000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          04300000
                               PERFORM 8000-SEND-DATA-TO-LISTENER       04310000
                           END-IF                                       04320000
                       WHEN TF007-DEFECTIVES-DAMAGES-SORT2              04330000
                           IF PC-SORT1-RET-CDE THEN                     04340000
                               SET  DP011-MSG-FATAL                     04350000
                                   TO TRUE                              04360000
                               MOVE PC-TSYMSG-03193                     04370000
                                   TO DP011-MSG-NUMBER                  04380000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          04390000
                               PERFORM 8000-SEND-DATA-TO-LISTENER       04400000
                           END-IF                                       04410000
                   END-EVALUATE                                         04420000
           END-EVALUATE.                                                04430000
                                                                        04440000
      ***                                                               04450000
      * TF010-NOT-1ST-MKDN => FROM AND TO STORE PRICES ARE EQUAL        04460000
      * TF010-1ST-MKDN     => FROM AND TO STORE PRICES NOT EQUAL        04470000
      * TF010-NOT-CLR-ITM  => ITEM NOT IN RED STATUS. LOCK GUN PRICE    04480000
      * TF010-CLR-ITM      => ITEM IN RED STATUS. LOCK GUN PRICE NOT    04490000
      * TF010-NOT-REGN-PRC-ITM => NEITHER STORE IN RCP                  04500000
      * TF010-REGN-PRC-ITM     => AT LEAST ONE STORE IN RCP             04510000
      ***                                                               04520000
           EVALUATE TF009-XFER-TYP-CDE-X                                04530000
               WHEN  TF007-DEFECTIVES-DAMAGES-SORT1                     04540000
               WHEN  TF007-DEFECTIVES-DAMAGES-SORT2                     04550000
               WHEN  TF007-CALLBACK                                     04560000
                   SET TF010-NOT-CLR-ITM                                04561000
                       TF010-NOT-REGN-PRC-ITM                           04562000
                       TF010-NOT-1ST-MKDN                               04563000
                                   TO  TRUE                             04564000
                   IF XST00010-REGN-PRIC-IND = PC-YES                   04565000
                       IF PS-REGN-CLR-FOUND                             04566000
                           SET TF010-REGN-PRC-ITM                       04567000
                                   TO TRUE                              04568000
                           SET TF010-NOT-1ST-MKDN                       04568100
                                   TO TRUE                              04568200
                           MOVE XST00008-UNT-RTL-AMT                    04568300
                                   TO PV-CUR-RTL-AMT                    04568400
                           MOVE +1 TO PV-GP-QTY                         04568500
                           IF XST00008-UNT-RTL-CHG-DTE >                04568600
                               XST00008-UPC-STAT-CHG-DTE                04568700
                               SET TF010-CLR-ITM                        04568800
                                   TO  TRUE                             04568900
                           ELSE                                         04569000
                               SET TF010-NOT-CLR-ITM                    04569100
                                   TO  TRUE                             04569200
                           END-IF                                       04569300
                       END-IF                                           04569400
                   END-IF                                               04569500
                                                                        04569600
                   IF (XST00010-REGN-PRIC-IND NOT = PC-YES) OR          04569700
                      (TF010-NOT-REGN-PRC-ITM)                          04569800
                       PERFORM 5100-CHK-CLR-ITM-1ST-MKDN                04569900
                   END-IF                                               04570000
                                                                        04570100
               WHEN  TF007-STOCK-BALANCE-CORPORATE                      04570200
               WHEN  TF007-STOCK-BALANCE-STORE                          04570300
               WHEN  TF007-CUSTOMER                                     04570400
                   SET TF010-NOT-CLR-ITM                                04570500
                       TF010-NOT-REGN-PRC-ITM                           04570600
                       TF010-1ST-MKDN                                   04570700
                                   TO  TRUE                             04570800
                   IF XST00010-REGN-PRIC-IND = PC-YES                   04570900
                       IF PS-REGN-CLR-FOUND                             04571000
                           SET TF010-REGN-PRC-ITM                       04571100
                                   TO TRUE                              04571200
                           SET TF010-NOT-CLR-ITM                        04571300
                                   TO TRUE                              04571400
                           MOVE XST00008-UNT-RTL-AMT                    04571500
                                   TO PV-CUR-RTL-AMT                    04571600
                                      PV-TO-PRICE                       04571700
                           MOVE +1 TO PV-GP-QTY                         04571800
                       ELSE                                             04571900
                           MOVE XST00008-UNT-RTL-AMT                    04572000
                                   TO PV-TO-PRICE                       04572100
                       END-IF                                           04572200
                       IF PS-REGN-CLR-FOUND                             04572300
                           SET TF010-REGN-PRC-ITM                       04572400
                                   TO TRUE                              04572500
                           SET TF010-NOT-CLR-ITM                        04572600
                                   TO TRUE                              04572700
                           MOVE XST00008-UNT-RTL-AMT                    04572800
                                   TO PV-FROM-PRICE                     04572900
                       ELSE                                             04573000
                           MOVE XST00008-UNT-RTL-AMT                    04574000
                                   TO PV-FROM-PRICE                     04574100
                       END-IF                                           04574200
                   END-IF                                               04574300
                                                                        04574400
                   IF XST00010-REGN-PRIC-IND = PC-YES                   04574500
                       IF PV-FROM-PRICE = PV-TO-PRICE                   04574600
                           SET TF010-NOT-1ST-MKDN                       04574700
                                   TO TRUE                              04574800
                       ELSE                                             04574900
                           SET TF010-1ST-MKDN                           04575000
                                   TO TRUE                              04575100
                       END-IF                                           04575200
                   END-IF                                               04575300
                                                                        04575400
                   IF (XST00010-REGN-PRIC-IND NOT = PC-YES) OR          04575500
                      (TF010-NOT-REGN-PRC-ITM)                          04575600
                       PERFORM 5100-CHK-CLR-ITM-1ST-MKDN                04575700
                   END-IF                                               04575800
           END-EVALUATE.                                                04575900
           IF PV-GP-QTY  >  PC-ONE                                      04576000
               COMPUTE PV-CUR-RTL-AMT  =                                04576100
                   (XST00008-GP-RTL-AMT  /  PV-GP-QTY)                  04576200
               SET TF010-GP-PRICE-ITM                                   04576300
                                   TO TRUE                              04576400
           ELSE                                                         04576500
               SET  TF010-NOT-GP-PRICE-ITM                              04576600
                                   TO  TRUE                             04576700
           END-IF.                                                      04576800
           MOVE PV-CUR-RTL-AMT     TO  TF010-CUR-UNT-RTL-AMT.           04576900
                                                                        04577000
           PERFORM 5200-CHK-IF-SECURITY-DEPT.                           04577100
                                                                        04577200
      **************************************************************    04577300
      * CHECK IF VALID JEWELRY DEPT ON XST_DEPT TABLE              *    04577400
      **************************************************************    04577500
070711 3005-CHECK-JEWELRY-DEPT.                                         04577600
070711     EXEC SQL                                                     04577700
070711         SELECT 1                                                 04577800
070711           INTO :PV-NUM-ROWS                                      04577900
070711           FROM XST_DEPT                                          04578000
070711          WHERE  DEPT_NBR = :XST00015-DEPT-NBR                    04578100
070711            AND  BUS_GP_NBR IN (53, 54, 55, 56)                   04578200
070711     END-EXEC                                                     04578300
                                                                        04578400
070711     EVALUATE TRUE                                                04578500
070711         WHEN SQLCODE = ZERO                                      04578600
070711             SET PS-DEPT-FOUND TO TRUE                            04578700
070711         WHEN SQLCODE = +100                                      04578800
070711             SET PS-DEPT-NOT-FOUND TO TRUE                        04578900
070711         WHEN OTHER                                               04579000
070711             MOVE '3005-CHECK-JEWELRY-DEPT'                       04579100
070711                                TO DP013-PARAGRAPH                04579200
070711             MOVE 'SELECT DEPT'                                   04579300
070711                                TO DP013-MESSAGE-TEXT (1)         04579400
070711             MOVE SQLCA          TO DP013-SQLCA                   04579500
070711             MOVE 'XST_DEPT' TO DP013-DB2-TABLE-NAME (1)          04579600
070711             SET DP013-DB2-ABEND                                  04579700
070711                     DP013-NO-ROLLBACK                            04579800
070711                                 TO TRUE                          04579900
070711             PERFORM 9999-WRITE-CICS-LOG-MSG                      04580000
070711             SET  DP011-MSG-FATAL                                 04580100
070711                            TO TRUE                               04580200
070711             MOVE PC-TSYMSG-01064                                 04580300
070711                             TO DP011-MSG-NUMBER                  04580400
070711             PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04580500
070711             PERFORM 8000-SEND-DATA-TO-LISTENER                   04580600
070711     END-EVALUATE.                                                04580700
                                                                        04580800
       3010-FIND-KOHLS-UPC-NBR.                                         04580900
           EVALUATE TRUE                                                04581000
               WHEN XST00012-UPC-TYP-CDE = PC-VENDOR-UPC                04582000
                   PERFORM 7100-SELECT-KOHLS-INTERNAL-UPC               04583000
                   MOVE XST00012-UPC-NBR                                04584000
                                   TO TF010-KOHLS-INTERNAL-UPC-NBR      04585000
               WHEN XST00012-UPC-TYP-CDE = PC-RENUMBERED-UPC            04586000
                   PERFORM 7100-SELECT-KOHLS-INTERNAL-UPC               04587000
                   MOVE XST00012-UPC-NBR                                04588000
                                   TO TF010-KOHLS-INTERNAL-UPC-NBR      04589000
               WHEN XST00012-UPC-TYP-CDE = PC-KOHLS-INTERNAL-UPC        04590000
                   MOVE DK-UPC-NBR TO TF010-KOHLS-INTERNAL-UPC-NBR      04600000
           END-EVALUATE.                                                04610000
                                                                        04620000
       3432-SELECT-DC-RET-CDE.                                          04630000
           INITIALIZE DCLXST00017.                                      04640000
                                                                        04650000
           EXEC SQL                                                     04660000
               SELECT  DC_RET_CDE                                       04670000
                 INTO  :XST00017-DC-RET-CDE                             04680000
                 FROM  XST_VND_DEPT                                     04690000
                WHERE   ENT_ID    =  :XST00013-ENT-ID                   04700000
                  AND   DEPT_NBR  =  :XST00013-DEPT-NBR                 04710000
           END-EXEC.                                                    04720000
                                                                        04730000
           EVALUATE TRUE                                                04740000
               WHEN SQLCODE = ZERO                                      04750000
                   MOVE XST00017-DC-RET-CDE                             04760000
                                           TO PC-VND-DC-RET-CDE         04770000
               WHEN SQLCODE = +100                                      04780000
                   MOVE SPACES             TO XST00017-DC-RET-CDE       04790000
                   MOVE SPACES             TO PC-VND-DC-RET-CDE         04800000
               WHEN OTHER                                               04810000
                       MOVE '3432-SELECT-DC-RET-CDE'                    04820000
                                           TO DP013-PARAGRAPH           04830000
                       MOVE 'SELECT DC RTN CDE'                         04840000
                                           TO DP013-MESSAGE-TEXT (1)    04850000
                       MOVE SQLCA          TO DP013-SQLCA               04860000
                       MOVE 'XST_VND_DEPT' TO DP013-DB2-TABLE-NAME (1)  04870000
                       SET DP013-DB2-ABEND                              04880000
                           DP013-NO-ROLLBACK                            04890000
                                       TO TRUE                          04900000
                       PERFORM 9999-WRITE-CICS-LOG-MSG                  04910000
                       SET  DP011-MSG-FATAL                             04920000
                                       TO TRUE                          04930000
                       MOVE PC-TSYMSG-01064                             04931000
                                       TO DP011-MSG-NUMBER              04932000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  04933000
                       PERFORM 8000-SEND-DATA-TO-LISTENER               04934000
           END-EVALUATE.                                                04935000
                                                                        04936000
       5100-CHK-CLR-ITM-1ST-MKDN.                                       04937000
           SET TF010-NOT-REGN-PRC-ITM                                   04938000
                                   TO TRUE.                             04939000
      ***                                                               04940000
      *  PRICES ARE EQUAL                                               04950000
      ***                                                               04960000
           SET TF010-NOT-1ST-MKDN  TO TRUE.                             04970000
           IF XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE-STATUS-CODE      04980000
               IF XST00008-UNT-RTL-CHG-DTE > XST00008-UPC-STAT-CHG-DTE  04990000
                   SET TF010-CLR-ITM                                    05000000
                                   TO TRUE                              05010000
               ELSE                                                     05020000
                   SET TF010-NOT-CLR-ITM                                05030000
                                   TO  TRUE                             05040000
               END-IF                                                   05050000
           ELSE                                                         05060000
      ***                                                               05070000
      * NOT IN RED TICKET                                               05080000
      ***                                                               05090000
               SET TF010-NOT-CLR-ITM                                    05100000
                                   TO TRUE                              05110000
           END-IF.                                                      05120000
                                                                        05130000
      ******************************************************************05140000
      *  FINE JEWELRY MUST BE IN A SECURE TOTE ALWAYS                   05150000
      ******************************************************************05160000
       5200-CHK-IF-SECURITY-DEPT.                                       05170000
                                                                        05180000
070711     MOVE TF010-DEPT-X TO XST00015-DEPT-NBR                       05190000
070711     PERFORM 3005-CHECK-JEWELRY-DEPT                              05200000
070711     IF PS-DEPT-FOUND                                             05210000
                  IF TF009-CONTNR-TYP-CDE = PC-SECURE-TOTE              05220000
                      CONTINUE                                          05230000
                  ELSE                                                  05240000
                      SET  DP011-MSG-FATAL TO TRUE                      05250000
                      MOVE PC-TSYMSG-01544 TO DP011-MSG-NUMBER          05260000
                      PERFORM 9000-FMT-ERR-MSG-TO-PTC                   05270000
                      PERFORM 8000-SEND-DATA-TO-LISTENER                05280000
               END-IF                                                   05290000
           END-IF.                                                      05300000
                                                                        05310000
       7050-SELECT-UPC.                                                 05320000
                                                                        05330000
           INITIALIZE DCLXST00008.                                      05340000
           INITIALIZE DCLXST00010.                                      05350000
           INITIALIZE DCLXST00012.                                      05360000
           INITIALIZE DCLXST00013.                                      05370000
           INITIALIZE DCLXST00018.                                      05380000
                                                                        05390000
           MOVE +0                     TO DK-STR-NBR.                   05400000
                                                                        05410000
           EXEC SQL                                                     05420000
               SELECT  A.UPC_TYP_CDE                                    05430000
                     , A.INTR_UPC_ID                                    05440000
                     , B.SKU_DESC                                       05450000
                     , B.REGN_PRIC_IND                                  05460000
                     , B.SIZE_DESC                                      05470000
                     , B.NRF_CLOR_DESC                                  05480000
                     , B.SKU_NBR                                        05490000
                     , C.DEPT_NBR                                       05500000
                     , C.MAJ_CL_NBR                                     05510000
                     , C.SUB_CL_NBR                                     05520000
                     , C.VS_NBR                                         05530000
                     , C.ENT_ID                                         05540000
                     , D.ENT_NM_DESC                                    05550000
                     , F.UNT_RTL_AMT                                    05560000
                     , F.LOC_SKU_STAT_CDE                               05570000
                     , F.UPC_STAT_CHG_DTE                               05580000
                     , F.UNT_RTL_CHG_DTE                                05590000
                     , F.GP_RTL_AMT                                     05600000
                     , F.GP_RTL_QTY                                     05610000
                 INTO  :XST00012-UPC-TYP-CDE                            05620000
                     , :XST00012-INTR-UPC-ID                            05630000
                     , :XST00010-SKU-DESC                               05640000
                     , :XST00010-REGN-PRIC-IND                          05650000
                     , :XST00010-SIZE-DESC                              05660000
                     , :XST00010-NRF-CLOR-DESC                          05670000
                     , :XST00010-SKU-NBR                                05680000
                     , :XST00013-DEPT-NBR                               05690000
                     , :XST00013-MAJ-CL-NBR                             05700000
                     , :XST00013-SUB-CL-NBR                             05710000
                     , :XST00013-VS-NBR                                 05720000
                     , :XST00013-ENT-ID                                 05730000
                     , :XST00018-ENT-NM-DESC                            05740000
                     , :XST00008-UNT-RTL-AMT                            05750000
                     , :XST00008-LOC-SKU-STAT-CDE                       05760000
                     , :XST00008-UPC-STAT-CHG-DTE                       05770000
                     , :XST00008-UNT-RTL-CHG-DTE                        05780000
                     , :XST00008-GP-RTL-AMT   :PV-GP-RTL-AMT-NULL-IND   05790000
                     , :XST00008-GP-RTL-QTY   :PV-GP-RTL-QTY-NULL-IND   05800000
                 FROM  XST_UPC              A                           05810000
                     , XST_SKU              B                           05820000
                     , XST_VND_STYL         C                           05830000
                     , XST_VND              D                           05840000
                     , XST_SKU_LOC          F                           05850000
                WHERE  A.UPC_NBR            =  :DK-UPC-NBR              05860000
                  AND  A.LAST_ACTN_CDE     IN  ('A', 'U')               05870000
                  AND  B.INTR_UPC_ID        =  A.INTR_UPC_ID            05880000
                  AND  C.STYL_ID            =  B.STYL_ID                05890000
                  AND  D.ENT_ID             =  C.ENT_ID                 05900000
                  AND  F.INTR_UPC_ID        =  B.INTR_UPC_ID            05910000
                  AND  F.LOC_NBR            =  :DK-STR-NBR              05920000
                  AND  F.BEG_TMST           <= CURRENT TIMESTAMP        05930000
                  AND  (F.END_TMST          >  CURRENT TIMESTAMP        05940000
                   OR  F.END_TMST           IS NULL)                    05950000
                 WITH  UR                                               05960000
           END-EXEC.                                                    05970000
                                                                        05980000
           EVALUATE SQLCODE                                             05990000
               WHEN ZERO                                                06000000
      ************ ZERO THE NULL VALUES                                 06010000
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        06020000
                       MOVE +1     TO XST00008-GP-RTL-QTY               06030000
                   END-IF                                               06040000
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        06050000
                       MOVE ZEROS  TO XST00008-GP-RTL-AMT               06060000
                   END-IF                                               06070000
               WHEN +100                                                06080000
                   IF XST00012-INTR-UPC-ID > ZEROS                      06090000
                       IF PV-GP-RTL-QTY-NULL-IND < 0                    06100000
                           MOVE +1 TO XST00008-GP-RTL-QTY               06110000
                       END-IF                                           06120000
                       IF PV-GP-RTL-AMT-NULL-IND < 0                    06130000
                           MOVE ZEROS  TO XST00008-GP-RTL-AMT           06140000
                       END-IF                                           06150000
                   ELSE                                                 06160000
                       SET  DP011-MSG-FATAL                             06170000
                                   TO TRUE                              06180000
                       MOVE PC-TSYMSG-00100                             06190000
                                   TO DP011-MSG-NUMBER                  06200000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  06210000
                       PERFORM 8000-SEND-DATA-TO-LISTENER               06220000
                   END-IF                                               06230000
               WHEN -904                                                06240000
               WHEN -913                                                06250000
                   SET  DP011-MSG-FATAL                                 06260000
                                   TO TRUE                              06270000
                   MOVE PC-TSYMSG-01063                                 06280000
                                   TO DP011-MSG-NUMBER                  06290000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06300000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06310000
               WHEN OTHER                                               06320000
                   MOVE '7050-SELECT-UPC'                               06330000
                                   TO DP013-PARAGRAPH                   06340000
                   MOVE 'SELECT UPC: '                                  06350000
                                   TO DP013-MESSAGE-TEXT (1)            06360000
                   MOVE DK-UPC-NBR TO PV-DISPLAY-UPC-NBR                06370000
                   MOVE PV-DISPLAY-UPC-NBR                              06380000
                                   TO DP013-MESSAGE-TEXT (2)            06390000
                   MOVE SQLCA      TO DP013-SQLCA                       06400000
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          06410000
                   SET DP013-DB2-ABEND                                  06420000
                       DP013-NO-ROLLBACK                                06430000
                                   TO TRUE                              06440000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06450000
                   SET  DP011-MSG-FATAL                                 06460000
                                   TO TRUE                              06470000
                   MOVE PC-TSYMSG-01064                                 06480000
                                   TO DP011-MSG-NUMBER                  06490000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06500000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06510000
           END-EVALUATE.                                                06520000
                                                                        06530000
       7100-SELECT-KOHLS-INTERNAL-UPC.                                  06540000
           EXEC SQL                                                     06550000
               SELECT  UPC_NBR                                          06560000
                 INTO  :XST00012-UPC-NBR                                06570000
                 FROM  XST_UPC                                          06580000
                WHERE  INTR_UPC_ID   =  :XST00012-INTR-UPC-ID           06590000
                  AND  UPC_TYP_CDE   =  :PC-KOHLS-INTERNAL-UPC          06600000
                  AND  LAST_ACTN_CDE IN ('A', 'U')                      06610000
                 WITH  UR                                               06620000
           END-EXEC.                                                    06630000
                                                                        06640000
           EVALUATE SQLCODE                                             06650000
               WHEN ZERO                                                06660000
                   CONTINUE                                             06670000
               WHEN -904                                                06680000
               WHEN -913                                                06690000
                   SET  DP011-MSG-FATAL                                 06700000
                                   TO TRUE                              06710000
                   MOVE PC-TSYMSG-01063                                 06720000
                                   TO DP011-MSG-NUMBER                  06730000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06740000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06750000
               WHEN OTHER                                               06760000
                   MOVE '7100-SELECT-KOHLS-INTERNAL-UPC'                06770000
                                   TO DP013-PARAGRAPH                   06780000
                   MOVE 'SELECT KOHLS INTERNAL UPC FOR INTR-UPC-ID:'    06790000
                                   TO DP013-MESSAGE-TEXT (1)            06800000
                   MOVE XST00012-INTR-UPC-ID                            06810000
                                   TO PV-DISPLAY-INTR-UPC-ID            06820000
                   MOVE PV-DISPLAY-INTR-UPC-ID                          06830000
                                   TO DP013-MESSAGE-TEXT (2)            06840000
                   MOVE SQLCA      TO DP013-SQLCA                       06850000
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          06860000
                   SET DP013-DB2-ABEND                                  06870000
                       DP013-NO-ROLLBACK                                06880000
                                   TO TRUE                              06890000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06900000
                   SET  DP011-MSG-FATAL                                 06910000
                                   TO TRUE                              06920000
                   MOVE PC-TSYMSG-01064                                 06930000
                                   TO DP011-MSG-NUMBER                  06940000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06950000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06960000
           END-EVALUATE.                                                06970000
                                                                        06980000
                                                                        06990000
                                                                        07000000
       7800-CHECK-REGN-PRC.                                             07010000
           EVALUATE TF009-XFER-TYP-CDE-X                                07020000
      * USE THE FROM STORE FOR THESE TRANSFER TYPES                     07030000
               WHEN  TF007-DEFECTIVES-DAMAGES-SORT1                     07040000
               WHEN  TF007-DEFECTIVES-DAMAGES-SORT2                     07050000
               WHEN  TF007-CALLBACK                                     07060000
                   MOVE TF009-STR-NBR                                   07070000
                                   TO DK-STR-NBR                        07080000
      * USE THE TO STORE FOR OTHER TRANSFER TYPES                       07090000
               WHEN  OTHER                                              07100000
                   MOVE TF009-TO-STR-NBR                                07110000
                                   TO DK-STR-NBR                        07120000
           END-EVALUATE.                                                07130000
                                                                        07140000
           EXEC SQL                                                     07150000
               SELECT  UNT_RTL_AMT                                      07160000
                     , LOC_SKU_STAT_CDE                                 07170000
                     , UPC_STAT_CHG_DTE                                 07180000
                     , UNT_RTL_CHG_DTE                                  07190000
                     , GP_RTL_AMT                                       07200000
                     , GP_RTL_QTY                                       07210000
                 INTO  :XST00008-UNT-RTL-AMT                            07220000
                     , :XST00008-LOC-SKU-STAT-CDE                       07230000
                     , :XST00008-UPC-STAT-CHG-DTE                       07240000
                     , :XST00008-UNT-RTL-CHG-DTE                        07250000
                     , :XST00008-GP-RTL-AMT   :PV-GP-RTL-AMT-NULL-IND   07260000
                     , :XST00008-GP-RTL-QTY   :PV-GP-RTL-QTY-NULL-IND   07270000
                 FROM                                                   07280000
                       XST_SKU_LOC                                      07290000
                WHERE  INTR_UPC_ID          =  :XST00012-INTR-UPC-ID    07300000
                  AND  LOC_NBR              =  :DK-STR-NBR              07310000
                  AND  BEG_TMST             <= CURRENT TIMESTAMP        07320000
                  AND  (END_TMST            >  CURRENT TIMESTAMP        07330000
                   OR  END_TMST             IS NULL)                    07340000
                 WITH  UR                                               07350000
           END-EXEC.                                                    07360000
                                                                        07370000
           EVALUATE TRUE                                                07380000
               WHEN SQLCODE = ZERO                                      07390000
      ************ ZERO THE NULL VALUES                                 07400000
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        07410000
                       MOVE +1     TO XST00008-GP-RTL-QTY               07420000
                   END-IF                                               07430000
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        07440000
                       MOVE ZEROS  TO XST00008-GP-RTL-AMT               07450000
                   END-IF                                               07460000
                   IF XST00008-LOC-SKU-STAT-CDE =                       07470000
                           PC-CLEARANCE-STATUS-CODE                     07480000
                       SET PS-REGN-CLR-FOUND                            07490000
                                   TO TRUE                              07500000
                   END-IF                                               07510000
               WHEN SQLCODE = +100                                      07520000
                   SET PS-REGN-CLR-NOT-FOUND                            07530000
                                   TO TRUE                              07540000
               WHEN OTHER                                               07550000
                   MOVE '7800-CHECK-REGN-PRC'                           07560000
                                   TO DP013-PARAGRAPH                   07570000
                   MOVE 'SELECT DATA FROM TUPCPLS'                      07580000
                                   TO DP013-MESSAGE-TEXT (1)            07590000
                   MOVE SQLCA      TO DP013-SQLCA                       07600000
                   MOVE 'TUPCPLS'  TO DP013-DB2-TABLE-NAME (1)          07610000
                   SET DP013-DB2-ABEND                                  07620000
                       DP013-ROLLBACK                                   07630000
                                   TO TRUE                              07640000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07650000
                   SET  DP011-MSG-FATAL                                 07660000
                                   TO TRUE                              07670000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              07680000
                       MOVE PC-TSYMSG-01063                             07690000
                                   TO DP011-MSG-NUMBER                  07700000
                   ELSE                                                 07710000
                       MOVE PC-TSYMSG-01064                             07720000
                                   TO DP011-MSG-NUMBER                  07730000
                   END-IF                                               07740000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07750000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07760000
           END-EVALUATE.                                                07770000
                                                                        07780000
      ******************************************************************07790000
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  07800000
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           07810000
      ******************************************************************07820000
       8000-SEND-DATA-TO-LISTENER.                                      07830000
           IF TF009-MQ-INDICATOR-Y                                      07840000
               PERFORM 8500-MQ-SETUP                                    07850000
               PERFORM 8510-MQ-SETUP-REMOTE                             07860000
               PERFORM 8520-PUT-QUEUE                                   07870000
               PERFORM 8600-CLOSE-PUT-Q                                 07880000
               PERFORM 8610-DISCONNECT-QMGR                             07890000
               PERFORM 9100-EXEC-CICS-RETURN                            07900000
           ELSE                                                         07910000
               PERFORM 8110-ENQ-TCPIPPRQ                                07920000
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      07930000
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      07940000
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   07950000
               ADD 1               TO PV-NEXT-RECORD                    07960000
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     07970000
                   MOVE 3          TO PV-NEXT-RECORD                    07980000
               END-IF                                                   07990000
                                                                        08000000
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    08010000
               PERFORM 8160-DEQ-TCPIPPRQ                                08020000
                                                                        08030000
               PERFORM 9100-EXEC-CICS-RETURN                            08040000
           END-IF.                                                      08050000
                                                                        08060000
      ******************************************************************08070000
       8110-ENQ-TCPIPPRQ.                                               08080000
           EXEC CICS                                                    08090000
               ENQ                                                      08100000
                   RESOURCE  (PV-TSQ-NAME)                              08110000
                   RESP      (PV-CICS-RESPONSE)                         08120000
           END-EXEC.                                                    08130000
                                                                        08140000
           EVALUATE TRUE                                                08150000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08160000
                   CONTINUE                                             08170000
               WHEN OTHER                                               08180000
                   MOVE '8110-ENQ-TCPIPPRQ'                             08190000
                                   TO DP013-PARAGRAPH                   08200000
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q08210000
      -                 'UEUE: '                                        08220000
                                   TO DP013-MESSAGE-TEXT (1)            08230000
                   MOVE PV-TSQ-NAME                                     08240000
                                   TO DP013-MESSAGE-TEXT (2)            08250000
                   SET DP013-CICS-ABEND                                 08260000
                       DP013-NO-ROLLBACK                                08270000
                                   TO TRUE                              08280000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08290000
                   PERFORM 9100-EXEC-CICS-RETURN                        08300000
           END-EVALUATE.                                                08310000
      *                                                                 08320000
      ******************************************************************08330000
       8120-READQ-TCPIPPRQ-RECORD1.                                     08340000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           08350000
                                   TO PV-TSQ-LENGTH.                    08360000
                                                                        08370000
           EXEC CICS                                                    08380000
               READQ TS                                                 08390000
                   QUEUE   (PV-TSQ-NAME)                                08400000
                   INTO    (PV-TCPIPPRQ-RECORD1)                        08410000
                   LENGTH  (PV-TSQ-LENGTH)                              08420000
                   ITEM    (1)                                          08430000
                   RESP    (PV-CICS-RESPONSE)                           08440000
           END-EXEC.                                                    08450000
                                                                        08460000
           EVALUATE TRUE                                                08470000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08480000
                   CONTINUE                                             08490000
               WHEN OTHER                                               08500000
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   08510000
                                   TO DP013-PARAGRAPH                   08520000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 08530000
      -                 'QUEUE: '                                       08540000
                                   TO DP013-MESSAGE-TEXT (1)            08550000
                   MOVE PV-TSQ-NAME                                     08560000
                                   TO DP013-MESSAGE-TEXT (2)            08570000
                   SET DP013-CICS-ABEND                                 08580000
                       DP013-NO-ROLLBACK                                08590000
                                   TO TRUE                              08600000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08610000
                   PERFORM 9100-EXEC-CICS-RETURN                        08620000
           END-EVALUATE.                                                08630000
      *                                                                 08640000
      ******************************************************************08650000
       8130-READQ-TCPIPPRQ-RECORD2.                                     08660000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           08670000
                                   TO PV-TSQ-LENGTH.                    08680000
                                                                        08690000
           EXEC CICS                                                    08700000
               READQ TS                                                 08710000
                   QUEUE   (PV-TSQ-NAME)                                08720000
                   INTO    (PV-TCPIPPRQ-RECORD2)                        08730000
                   LENGTH  (PV-TSQ-LENGTH)                              08740000
                   ITEM    (2)                                          08750000
                   RESP    (PV-CICS-RESPONSE)                           08760000
           END-EXEC.                                                    08770000
                                                                        08780000
           EVALUATE TRUE                                                08790000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08800000
                   CONTINUE                                             08810000
               WHEN OTHER                                               08820000
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   08830000
                                   TO DP013-PARAGRAPH                   08840000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 08850000
      -                 'QUEUE: '                                       08860000
                                   TO DP013-MESSAGE-TEXT (1)            08870000
                   MOVE PV-TSQ-NAME                                     08880000
                                   TO DP013-MESSAGE-TEXT (2)            08890000
                   SET DP013-CICS-ABEND                                 08900000
                       DP013-NO-ROLLBACK                                08910000
                                   TO TRUE                              08920000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08930000
                   PERFORM 9100-EXEC-CICS-RETURN                        08940000
           END-EVALUATE.                                                08950000
      *                                                                 08960000
      ******************************************************************08970000
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  08980000
           MOVE LENGTH OF TF010-XFER-TO-PTC-RECORD                      08990000
                                   TO  TF010-TOT-REC-LENGTH.            09000000
                                                                        09010000
           MOVE TF009-MATCHING-NBR-FIELD                                09020000
                                   TO  TF010-MATCHING-NBR-FIELD.        09030000
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     09040000
                                                                        09050000
           EXEC CICS                                                    09060000
               WRITEQ TS                                                09070000
                   QUEUE   (PV-TSQ-NAME)                                09080000
                   FROM    (TF010-XFER-TO-PTC-RECORD)                   09090000
                   LENGTH  (PV-TSQ-LENGTH)                              09100000
                   ITEM    (PV-ITEM-NBR)                                09110000
                       REWRITE                                          09120000
                   RESP    (PV-CICS-RESPONSE)                           09130000
           END-EXEC.                                                    09140000
                                                                        09150000
           EVALUATE TRUE                                                09160000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09170000
                   CONTINUE                                             09180000
               WHEN OTHER                                               09190000
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                09200000
                                   TO DP013-PARAGRAPH                   09210000
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA09220000
      -                 'STORAGE QUEUE: '                               09230000
                                   TO DP013-MESSAGE-TEXT (1)            09240000
                   MOVE PV-TSQ-NAME                                     09250000
                                   TO DP013-MESSAGE-TEXT (2)            09260000
                   SET DP013-CICS-ABEND                                 09270000
                       DP013-NO-ROLLBACK                                09280000
                                   TO TRUE                              09290000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09300000
                   PERFORM 9100-EXEC-CICS-RETURN                        09310000
           END-EVALUATE.                                                09320000
      *                                                                 09330000
      ******************************************************************09340000
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   09350000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           09360000
                                   TO PV-TSQ-LENGTH.                    09370000
           MOVE +1                 TO PV-ITEM-NBR.                      09380000
                                                                        09390000
           EXEC CICS                                                    09400000
               WRITEQ TS                                                09410000
                   QUEUE   (PV-TSQ-NAME)                                09420000
                   FROM    (PV-TCPIPPRQ-RECORD1)                        09430000
                   LENGTH  (PV-TSQ-LENGTH)                              09440000
                   ITEM    (PV-ITEM-NBR)                                09450000
                       REWRITE                                          09460000
                   RESP    (PV-CICS-RESPONSE)                           09470000
           END-EXEC.                                                    09480000
                                                                        09490000
           EVALUATE TRUE                                                09500000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09510000
                   CONTINUE                                             09520000
               WHEN OTHER                                               09530000
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 09540000
                                   TO DP013-PARAGRAPH                   09550000
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   09560000
                                   TO DP013-MESSAGE-TEXT (1)            09570000
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     09580000
                                   TO DP013-MESSAGE-TEXT (2)            09590000
                   MOVE PV-TSQ-NAME                                     09600000
                                   TO DP013-MESSAGE-TEXT (3)            09610000
                   MOVE PV-TCPIPPRQ-RECORD1                             09620000
                                   TO DP013-MESSAGE-TEXT (4)            09630000
                   SET DP013-CICS-ABEND                                 09640000
                       DP013-NO-ROLLBACK                                09650000
                                   TO TRUE                              09660000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09670000
                   PERFORM 9100-EXEC-CICS-RETURN                        09680000
           END-EVALUATE.                                                09690000
      *                                                                 09700000
      ******************************************************************09710000
       8160-DEQ-TCPIPPRQ.                                               09720000
           EXEC CICS                                                    09730000
               DEQ                                                      09740000
                   RESOURCE  (PV-TSQ-NAME)                              09750000
                   RESP      (PV-CICS-RESPONSE)                         09760000
           END-EXEC.                                                    09770000
                                                                        09780000
           EVALUATE TRUE                                                09790000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09800000
                   CONTINUE                                             09810000
               WHEN OTHER                                               09820000
                   MOVE '8160-DEQ-TCPIPPRQ'                             09830000
                                   TO DP013-PARAGRAPH                   09840000
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q09850000
      -                 'UEUE: '                                        09860000
                                   TO DP013-MESSAGE-TEXT (1)            09870000
                   MOVE PV-TSQ-NAME                                     09880000
                                   TO DP013-MESSAGE-TEXT (2)            09890000
                   SET DP013-CICS-ABEND                                 09900000
                       DP013-NO-ROLLBACK                                09910000
                                   TO TRUE                              09920000
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        09930000
                 PERFORM 9100-EXEC-CICS-RETURN                          09940000
           END-EVALUATE.                                                09950000
                                                                        09960000
       8500-MQ-SETUP.                                                   09970000
      ***                                                               09980000
      * DETERMINE THE SYSTEM                                            09990000
      ***                                                               10000000
           PERFORM EP000-0000-INITIALIZE.                               10010000
           IF EP000-PV-KOHLS-PROD-SYSTEM                                10020000
               SET PV-PROD-QMGR-NAME                                    10030000
                                   TO TRUE                              10040000
           ELSE                                                         10050000
                IF EP000-PV-KOHLS-QA-SYSTEM                             10060000
                    SET PV-QA-QMGR-NAME                                 10070000
                                   TO TRUE                              10080000
                ELSE                                                    10090000
                    SET PV-TEST-QMGR-NAME                               10100000
                                   TO TRUE                              10110000
                END-IF                                                  10120000
           END-IF.                                                      10130000
                                                                        10140000
      ***************************************************************   10150000
      *    CONNECT TO THE QUEUE MANAGER                                 10160000
      ***************************************************************   10170000
                                                                        10180000
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       10190000
           CALL WS-MQCONN USING PV-QM-NAME                              10200000
                                PV-HCONN                                10210000
                                PV-COMPLETION-CODE                      10220000
                                PV-REASON.                              10230000
                                                                        10240000
      ***************************************************************   10250000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              10260000
      *    AND EXIT                                                     10270000
      ***************************************************************   10280000
                                                                        10290000
           MOVE PV-REASON          TO PV-CON-REASON.                    10300000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   10310000
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  10320000
               MOVE '8500-MQ-SETUP'                                     10330000
                                   TO DP013-PARAGRAPH                   10340000
               MOVE  PV-ERROR-MESSAGE                                   10350000
                                   TO DP013-MESSAGE-TEXT (1)            10360000
               MOVE  PV-COMPLETION-CODE                                 10370000
                                   TO DP013-MESSAGE-TEXT (2)            10380000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            10390000
               SET DP013-CICS-ABEND                                     10400000
                   DP013-NO-ROLLBACK                                    10410000
                                   TO TRUE                              10420000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          10430000
               PERFORM 9100-EXEC-CICS-RETURN                            10440000
           END-IF.                                                      10450000
                                                                        10460000
                                                                        10470000
       8510-MQ-SETUP-REMOTE.                                            10480000
      ***************************************************************   10490000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     10500000
      *    THIS IS A REMOTE QUEUE.                                      10510000
      ***************************************************************   10520000
                                                                        10530000
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      10540000
                                     MQOO-FAIL-IF-QUIESCING.            10550000
                                                                        10560000
           MOVE TF009-REPLYTOQ     TO MQOD-OBJECTNAME.                  10570000
           MOVE TF009-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              10580000
                                                                        10590000
           CALL WS-MQOPEN USING PV-HCONN                                10600000
                                MQM-OBJECT-DESCRIPTOR                   10610000
                                PV-OPEN-OPTIONS                         10620000
                                PV-PQ-HANDLE                            10630000
                                PV-COMPLETION-CODE                      10640000
                                PV-REASON.                              10650000
                                                                        10660000
      ********************************************************          10670000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    10680000
      *    AND EXIT.                                                    10690000
      ********************************************************          10700000
                                                                        10710000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   10720000
               PERFORM 8600-CLOSE-PUT-Q                                 10730000
               PERFORM 8610-DISCONNECT-QMGR                             10740000
               MOVE 'MQOPEN WRITE Q'                                    10750000
                                   TO PV-ERROR-MESSAGE                  10760000
               MOVE '8510-MQ-SETUP-REMOTE'                              10770000
                                   TO DP013-PARAGRAPH                   10780000
               MOVE  PV-ERROR-MESSAGE                                   10790000
                                   TO DP013-MESSAGE-TEXT (1)            10800000
               MOVE  PV-COMPLETION-CODE                                 10810000
                                   TO DP013-MESSAGE-TEXT (2)            10820000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            10830000
               SET DP013-CICS-ABEND                                     10840000
                   DP013-NO-ROLLBACK                                    10850000
                                   TO TRUE                              10860000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          10870000
               PERFORM 9100-EXEC-CICS-RETURN                            10880000
           END-IF.                                                      10890000
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          10900000
                                                                        10910000
      ******************************************************************10920000
       8520-PUT-QUEUE.                                                  10930000
           MOVE TF009-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              10940000
           MOVE TF009-REPLYTOQ     TO MQOD-OBJECTNAME.                  10950000
           MOVE TF009-MSGID        TO MQMD-CORRELID.                    10960000
           MOVE MQMI-NONE          TO MQMD-MSGID.                       10970000
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      10980000
           MOVE 5000               TO MQMD-EXPIRY.                      10990000
           MOVE LENGTH OF TF010-XFER-TO-PTC-RECORD                      11000000
                                   TO PV-DATA-LENGTH.                   11010000
           MOVE TF010-XFER-TO-PTC-RECORD                                11020000
                                   TO PV-MSGBUFFER.                     11030000
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 11040000
                                                                        11050000
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      11060000
                                                                        11070000
                                                                        11080000
                                                                        11090000
           CALL WS-MQPUT USING PV-HCONN                                 11100000
                               PV-FMT-OPEN-OUTPUT-HNDL                  11110000
                               MQM-MESSAGE-DESCRIPTOR                   11120000
                               MQM-PUT-MESSAGE-OPTIONS                  11130000
                               PV-DATA-LENGTH                           11140000
                               PV-MSGBUFFER                             11150000
                               PV-COMPLETION-CODE                       11160000
                               PV-REASON.                               11170000
                                                                        11180000
      ***********************************************************       11190000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 11200000
      *        AND BREAK OUT OF LOOP                                    11210000
      ***********************************************************       11220000
                                                                        11230000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   11240000
                  MOVE PV-COMPLETION-CODE                               11250000
                                   TO PH-COMPLETION-CODE                11260000
                  MOVE PV-REASON   TO PH-REASON                         11270000
                  PERFORM 8600-CLOSE-PUT-Q                              11280000
                  PERFORM 8610-DISCONNECT-QMGR                          11290000
                  MOVE 'MQPUT ERR' TO PV-ERROR-MESSAGE                  11300000
                  MOVE '8520-PUT-QUEUE'                                 11310000
                                   TO DP013-PARAGRAPH                   11320000
                  MOVE PV-ERROR-MESSAGE                                 11330000
                                   TO DP013-MESSAGE-TEXT (1)            11340000
                  MOVE PH-COMPLETION-CODE                               11350000
                                   TO DP013-MESSAGE-TEXT (2)            11360000
                  MOVE PH-REASON   TO DP013-MESSAGE-TEXT (3)            11370000
                  SET DP013-CICS-ABEND                                  11380000
                      DP013-NO-ROLLBACK                                 11390000
                                   TO TRUE                              11400000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       11410000
                  PERFORM 9100-EXEC-CICS-RETURN                         11420000
           ELSE                                                         11430000
              SET PS-MQPUT-SUCCESSFUL                                   11440000
                                   TO TRUE                              11450000
           END-IF.                                                      11460000
                                                                        11470000
      ******************************************************************11480000
       8600-CLOSE-PUT-Q.                                                11490000
           CALL WS-MQCLOSE USING PV-HCONN                               11500000
                                 PV-PQ-HANDLE                           11510000
                                 MQCO-NONE                              11520000
                                 PV-COMPLETION-CODE                     11530000
                                 PV-REASON.                             11540000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   11550000
               MOVE 'MQCLOSE PQ HANDLE'                                 11560000
                                   TO PV-ERROR-MESSAGE                  11570000
               MOVE '8600-CLOSE-PUT-Q'                                  11580000
                                   TO DP013-PARAGRAPH                   11590000
               MOVE  PV-ERROR-MESSAGE                                   11600000
                                   TO DP013-MESSAGE-TEXT (1)            11610000
               MOVE  PV-COMPLETION-CODE                                 11620000
                                   TO DP013-MESSAGE-TEXT (2)            11630000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            11640000
               SET DP013-CICS-ABEND                                     11650000
                   DP013-NO-ROLLBACK                                    11660000
                                   TO TRUE                              11670000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          11680000
               PERFORM 9100-EXEC-CICS-RETURN                            11690000
           END-IF.                                                      11700000
                                                                        11710000
      ******************************************************************11720000
       8610-DISCONNECT-QMGR.                                            11730000
                                                                        11740000
           IF PV-CON-REASON IS NOT EQUAL                                11750000
                                   TO MQRC-ALREADY-CONNECTED            11760000
              CALL WS-MQDISC USING PV-HCONN                             11770000
                                   PV-COMPLETION-CODE                   11780000
                                   PV-REASON                            11790000
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                11800000
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  11810000
                  MOVE '8610-DISCONNECT'                                11820000
                                   TO DP013-PARAGRAPH                   11830000
                  MOVE PV-ERROR-MESSAGE                                 11840000
                                   TO DP013-MESSAGE-TEXT (1)            11850000
                  MOVE PV-COMPLETION-CODE                               11860000
                                   TO DP013-MESSAGE-TEXT (2)            11870000
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            11880000
                  SET DP013-CICS-ABEND                                  11890000
                      DP013-NO-ROLLBACK                                 11900000
                                   TO TRUE                              11910000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       11920000
                  PERFORM 9100-EXEC-CICS-RETURN                         11930000
              END-IF                                                    11940000
           END-IF.                                                      11950000
                                                                        11960000
                                                                        11970000
      ******************************************************************11980000
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          11990000
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   12000000
      *    STREAM BEING SENT BACK TO THE PTC.                           12010000
      ******************************************************************12020000
       9000-FMT-ERR-MSG-TO-PTC.                                         12030000
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         12040000
           MOVE DP011-MSG-LEVEL    TO  TF010-ERR-TYP-IND.               12050000
           MOVE DP011-MSG-TEXT     TO  TF010-ERR-MSG.                   12060000
                                                                        12070000
       9100-EXEC-CICS-RETURN.                                           12080000
           EXEC CICS                                                    12090000
               RETURN                                                   12100000
           END-EXEC.                                                    12110000
                                                                        12120000
       9999-WRITE-CICS-LOG-MSG.                                         12130000
           MOVE PC-CURRENT-PROGRAM-NAME                                 12140000
                                   TO  DP013-PROGRAM.                   12150000
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  12160000
                                                                        12170000
           INITIALIZE DP013-SRC-TASK-NUMBER                             12180000
                      DP013-STACK.                                      12190000
                                                                        12200000
           SET DP013-LINK-RETURN   TO  TRUE.                            12210000
                                                                        12220000
           EXEC CICS                                                    12230000
               LINK                                                     12240000
                   PROGRAM   (DP013-NAME)                               12250000
                   COMMAREA  (DP013-PARAMETERS)                         12260000
                   LENGTH    (DP013-LENGTH)                             12270000
           END-EXEC.                                                    12280000
                                                                        12290000
      ***                                                               12300000
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           12310000
      ***                                                               12320000
                                                                        12330000
           COPY DPPD011.                                                12340000
      ***                                                               12350000
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     12360000
      ***                                                               12370000
                                                                        12380000
           COPY DPPD014.                                                12390000
                                                                        12400000
           COPY EPPD000.                                                12410000
                                                                        12420000
