000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT504.                                        00020000
000300 AUTHOR.         JEAN KURK.                                       00030000
000400*DATE-WRITTEN.   JUNE 2023.                                       00040000
000500*DATE-COMPILED.                                                   00050000
000600*************************************************************     00060000
000800*                                                           *     00080000
000900*    CONVERT EDI 852 TO INVOICE FILE FOR CLAIRES            *     00090000
001000*                                                           *     00100000
001100*************************************************************     00110000
001200*                                                           *     00120000
001500* INPUT:                                                    *     00133000
001600* 1.  EDI 852 RECORDS FOR CLAIRES             ETRD019       *     00134013
001800*                                                           *     00136000
001900* OUTPUT                                                    *     00137000
002000* 1.  INVOICE FILE                            APRD045       *     00138013
002100*                                                           *     00139000
002100* DB2 TABLES                                                *     00139101
002100* 1.  TEXTENT   EXTERNAL ENTITY                             *     00139201
002100* 2.  TENTNME   EXTERNAL ENTITY NAME                        *     00139313
002100* 3.  TUPCSKU   UPC/SKU XREF                                *     00139418
002100* 4.  TSKXREF   SKU XREF                                    *     00139518
002100* 5.  TUPCPLS   UPC PHYSICAL LOCATION                       *     00139618
002100*                                                           *     00140018
002200*************************************************************     00141018
002300* CHANGE LOG:                                               *     00150000
002400*                                                           *     00160000
002500* 06/21/23    INITIAL VERSION.                              *     00170046
007295*     MADE BY: JEAN KURK               CHG0289911               * 00730146
007300***************************************************************** 00730200
007400                                                                  00730300
007500 ENVIRONMENT DIVISION.                                            00730400
007600                                                                  00730500
007700 INPUT-OUTPUT SECTION.                                            00730600
007800                                                                  00730700
007900 FILE-CONTROL.                                                    00730800
008000                                                                  00730900
008100     SELECT EDI-852-FILE     ASSIGN     TO UT-S-INP01.            00731000
008200                                                                  00732000
008500     SELECT INVOICE-FILE     ASSIGN     TO OUT01.                 00735000
008600                                                                  00736000
008700 DATA DIVISION.                                                   00737000
008800                                                                  00738000
008900 FILE SECTION.                                                    00739000
009000                                                                  00740000
009100 FD  EDI-852-FILE                                                 00750000
009200         LABEL RECORDS  ARE STANDARD                              00760000
009300         RECORDING MODE IS  F                                     00770000
009400         DATA RECORD    IS  EDI-852-RECORD.                       00780000
009600 01  EDI-852-RECORD                PIC X(150).                    00800000
009700                                                                  00810000
010500 FD  INVOICE-FILE                                                 00890000
010600     RECORDING MODE IS F                                          00900000
010700     LABEL RECORDS ARE STANDARD                                   00910000
010800     BLOCK CONTAINS 0 RECORDS                                     00920000
010900     DATA RECORD IS INVOICE-RECORD.                               00930000
011100 01  INVOICE-RECORD                PIC X(500).                    00950013
011200                                                                  00960000
011300/                                                                 00970000
011400 WORKING-STORAGE SECTION.                                         00980000
011500                                                                  00990000
011600 01  FILLER                        PIC X(25) VALUE                01000000
011700                             'WS FOR APKUT504 BEGINS==>'.         01010000
011800                                                                  01020000
011900 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01030000
012000                                             VALUE ZEROS.         01040000
012100     88 AP-EMPTY-FILE              VALUE +4005.                   01050000
012200     88 AP-DB2-ERROR               VALUE +4013.                   01060000
012300                                                                  01070000
012400 01  PROGRAM-CONSTANTS.                                           01080000
012500     05  PC-PROGRAM-NAME           PIC X(08) VALUE 'APKUT504'.    01090001
012900                                                                  01130000
013000                                                                  01140000
012400 01  PROGRAM-VARIABLES.                                           01141001
013100     05  PV-DATE                   PIC X(10) VALUE SPACES.        01150001
013200     05  PV-DATE-CCYY-MM-DD REDEFINES PV-DATE.                    01160001
013400         10 PV-DATE-YY             PIC 9(04).                     01180015
013500         10 PV-DASH-1              PIC X(01).                     01190033
013600         10 PV-DATE-MM             PIC 9(02).                     01200001
013700         10 PV-DASH-2              PIC X(01).                     01210034
013800         10 PV-DATE-DD             PIC 9(02).                     01220001
013100     05  PV-SAVE-ENT-ID            PIC S9(9) COMP VALUE 0.        01230023
013101     05  PV-SAVE-DEPT-NBR          PIC X(03) VALUE SPACES.        01240013
013101     05  PV-SAVE-UPC-TYPE          PIC X(02) VALUE SPACES.        01241013
013102     05  PV-SAVE-UPC-CODE          PIC 9(15) VALUE 0.             01250009
017100     05  PV-UPC-CODE               PIC 9(13) VALUE ZEROS.         01254020
017200     05  PV-UPC-CODE-X REDEFINES PV-UPC-CODE PIC X(13).           01255016
017300     05  PV-UPC-CODE-COMP3         PIC S9(15) COMP-3              01256020
017400                                               VALUE ZEROS.       01257016
023000     05  PV-SUBCLASS-NUM           PIC 9(4)    VALUE ZEROS.       01257130
022700     05  PV-SAVE-SUBCLASS          REDEFINES PV-SUBCLASS-NUM.     01258029
022800         10  PV-SAVE-SUBCL-B       PIC X(02).                     01259031
022900         10  PV-SAVE-SUBCL-E       PIC X(02).                     01259131
023000     05  PV-DOC-NBR                PIC X(16)   VALUE SPACES.      01259237
022700     05  PV-DOC-NUM-STRUC          REDEFINES PV-DOC-NBR.          01259338
022800         10  PV-DOC-NUM            PIC 9(05).                     01259437
022900         10  PV-DOC-YY             PIC 9(04).                     01259537
022900         10  PV-DOC-MM             PIC 9(02).                     01259637
022900         10  PV-DOC-DD             PIC 9(02).                     01259737
022900         10  PV-DOC-FILL           PIC X(03).                     01259845
023000     05  PV-REASON-TEXT            PIC X(50)   VALUE SPACES.      01259945
022700     05  PV-REASON-STRUC           REDEFINES PV-REASON-TEXT.      01260045
022800         10  PV-REASON-TXT         PIC X(16).                     01260145
022900         10  PV-REASON-MM          PIC 9(02).                     01260245
022900         10  PV-REASON-SLASH1      PIC X(01).                     01260345
022900         10  PV-REASON-DD          PIC 9(02).                     01260445
022900         10  PV-REASON-SLASH2      PIC X(01).                     01260545
022900         10  PV-REASON-YY          PIC 9(04).                     01260645
022900         10  PV-REASON-FILL        PIC X(24).                     01260745
013101     05  PV-SAVE-DTL-TYPE          PIC X(02) VALUE SPACES.        01260845
013101         88 PV-QTY-SOLD                VALUE 'QS'.                01261001
013101         88 PV-QTY-AVAIL               VALUE 'QA'.                01262001
013101     05  PV-SAVE-UNIT-PRICE        PIC S9(9)V99 VALUE 0.          01270001
013101     05  PV-SAVE-RTL-PRICE         PIC S9(9)V99 VALUE 0.          01270117
013101     05  PV-GROSS-AMT              PIC S9(9)V99 VALUE 0.          01271009
013101     05  PV-RETL-AMT               PIC S9(9)V99 VALUE 0.          01272020
013101     05  PV-DISPLAY-NBR            PIC 9(9) VALUE 0.              01280023
013101     05  PV-STR-IDX                PIC 9(3) VALUE 0.              01281023
013101     05  PV-STR-IDX-MAX            PIC 9(3) VALUE 10.             01290001
014100     05  PV-TMST                   PIC X(26) VALUE SPACES.        01300020
014200     05  PV-TIMESTAMP-DETAIL       REDEFINES PV-TMST.             01310015
014500         10  PV-TIMESTAMP-19.                                     01340015
014600             15  PV-TMS-DATE.                                     01350015
014700                 20  PV-TMS-YEAR    PIC X(04).                    01360020
015000                 20  FILLER         PIC X(01).                    01390020
015100                 20  PV-TMS-MONTH   PIC X(02).                    01400020
015200                 20  FILLER         PIC X(01).                    01410020
015300                 20  PV-TMS-DAY     PIC X(02).                    01420020
015400             15  FILLER             PIC X(01).                    01430020
015500             15  PV-TMS-HOUR        PIC X(02).                    01431020
015600             15  FILLER             PIC X(01).                    01432020
015700             15  PV-TMS-MINUTE      PIC X(02).                    01433020
015800             15  FILLER             PIC X(01).                    01434020
015900             15  PV-TMS-SECOND      PIC X(02).                    01435020
016000         10  FILLER                 PIC X(01).                    01436020
016100         10  PV-TMS-MSECOND         PIC X(06).                    01437020
016000                                                                  01440000
016100 01  PV-ABEND-FILEDS.                                             01450000
016200     05  PV-ABEND-PROGRAM           PIC X(8)  VALUE 'APKUT504'.   01460020
016300     05  PV-ABEND-SQLCODE           PIC X(4)  VALUE SPACES.       01470020
016400     05  PV-ABEND-PARAGRAPH         PIC X(50) VALUE SPACES.       01480020
016500     05  PV-ABEND-OPERATION         PIC X(50) VALUE SPACES.       01490020
016600     05  PV-ABEND-STRUCTURE-1       PIC X(8)  VALUE SPACES.       01500020
016700     05  PV-ABEND-STRUCTURE-2       PIC X(8)  VALUE SPACES.       01510020
016800     05  PV-ABEND-STATUS            PIC XX    VALUE SPACES.       01520020
016900                                                                  01530000
017000 01  PC-PROGRAM-CONSTANTS.                                        01540002
017100     05  PC-PROGRAM-NAME         PIC X(08)     VALUE 'APKUT504'.  01550002
017100     05  PC-PO-NBR               PIC X(09)     VALUE '001111111'. 01551002
017200                                                                  01560000
017400 01  PV-PROGRAM-COUNTERS.                                         01580000
017500     05  PV-INPUT-REC-CNT        PIC 9(9)  VALUE ZEROS.           01590004
017600     05  PV-OUTPUT-REC-CNT       PIC 9(9)  VALUE ZEROS.           01600004
017700     05  PV-ENTID-CNT            PIC 9(9)  VALUE ZEROS.           01610004
017700     05  PV-UPC-CNT              PIC 9(9)  VALUE ZEROS.           01611004
017800                                                                  01620000
017900 01  PV-SWITCHES.                                                 01630000
008800     05  PS-INPUT-EOF-SW         PIC X     VALUE 'N'.             01631020
008900         88  PS-INPUT-EOF-N                VALUE 'N'.             01632020
009000         88  PS-INPUT-E0F-Y                VALUE 'Y'.             01633020
010400     05  VALID-UPC-NUMBER-SW     PIC X(1)  VALUE ' '.             01634016
010500         88  PS-VALID-UPC                  VALUE 'Y'.             01635018
010600         88  PS-NOT-VALID-UPC              VALUE 'N'.             01636018
020200                                                                  01860000
009500*--------------------------------------------------------------*  01870001
009600*  RECORD LAYOUT FOR EDI 852 - INPUT RECORD                    *  01880001
009700*--------------------------------------------------------------*  01881001
009800     COPY ETRD019.                                                01882001
020200                                                                  01883001
009500*--------------------------------------------------------------*  01884001
009600*  RECORD LAYOUT FOR OUTPUT RECORD - INVOICE                   *  01885001
009700*--------------------------------------------------------------*  01886001
020500     COPY APRD045.                                                01890013
020600                                                                  01900000
022100                                                                  02050000
022200******************************************************************02060000
022300*  COMMUNICATIONS AREA2 FOR DB2                                   02070000
022400******************************************************************02080000
022500     COPY SQLCA2.                                                 02090000
022500     COPY DPWS004.                                                02091005
022600                                                                  02100000
022700     EXEC SQL                                                     02110000
022800          INCLUDE SQLCA                                           02120000
022900     END-EXEC.                                                    02130000
023000                                                                  02140000
023100     EXEC SQL                                                     02150000
023200          INCLUDE TEXTENT                                         02160001
023300     END-EXEC.                                                    02170000
023400                                                                  02180000
023100     EXEC SQL                                                     02190013
023200          INCLUDE TENTNME                                         02200013
023300     END-EXEC.                                                    02210013
023400                                                                  02220013
023100     EXEC SQL                                                     02230018
023200          INCLUDE TUPCSKU                                         02240018
023300     END-EXEC.                                                    02241018
023400                                                                  02242018
023100     EXEC SQL                                                     02243018
023200          INCLUDE TUPCPLS                                         02244018
023300     END-EXEC.                                                    02245018
023400                                                                  02246018
023100     EXEC SQL                                                     02247018
023200          INCLUDE TSKXREF                                         02248018
023300     END-EXEC.                                                    02249018
024100                                                                  02250000
024400                                                                  02280000
024500 PROCEDURE DIVISION.                                              02290000
024600                                                                  02300000
024700 A100-MAINLINE.                                                   02310000
024800                                                                  02320000
024900     PERFORM H100-HOUSEKEEPING.                                   02330000
025000                                                                  02340000
025100     PERFORM B100-PROCESSING                                      02350000
025200        UNTIL PS-INPUT-E0F-Y.                                     02360005
025300                                                                  02370000
025400     PERFORM Z900-END-OF-JOB.                                     02380000
025500                                                                  02390000
025600     GOBACK.                                                      02400000
025800                                                                  02420000
026000*                                                                 02440000
026100***************************************************************** 02450000
026200*     READ THE EDI 852 FILE.  SAVE OFF THE DATA FROM THE 02, 03   02460001
026300*     AND 04 RECORDS.  FOR EACH STORE ON THE 05 RECORD THAT HAS   02470001
026400*     A SALE, CREATE AN OUTPUT INVOICE RECORD                     02480001
026700***************************************************************** 02510000
025900 B100-PROCESSING.                                                 02511001
026800*                                                                 02520000
031600     EVALUATE TRUE                                                02530001
031700         WHEN ET019-HEADER-RECORD                                 02531013
013101             MOVE ET019-DEPARTMENT  TO PV-SAVE-DEPT-NBR           02532013
031700         WHEN ET019-ITEM-RECORD                                   02540001
013101             MOVE ET019-UPC-TYPE    TO PV-SAVE-UPC-TYPE           02541001
013101             MOVE ET019-UPC-CODE    TO PV-SAVE-UPC-CODE           02541101
013101             ADD 1                  TO PV-UPC-CNT                 02541204
031700         WHEN ET019-DETAIL-TYPE-RECORD                            02541304
013101             MOVE ET019-DETAIL-TYPE TO PV-SAVE-DTL-TYPE           02541404
031700         WHEN ET019-DETAIL-PRICE-RECORD                           02541504
013101             MOVE ET019-UNIT-PRICE   TO PV-SAVE-UNIT-PRICE        02541605
031700         WHEN ET019-DETAIL-QTY-RECORD                             02541704
032300             IF PV-QTY-SOLD                                       02564001
032400                 PERFORM B200-PROCESS-STORES                      02565001
032400                     VARYING PV-STR-IDX FROM 1 BY 1               02565101
032400                     UNTIL PV-STR-IDX > PV-STR-IDX-MAX            02565201
032300             END-IF                                               02566001
033500     END-EVALUATE.                                                02569701
057700                                                                  05720000
057700     PERFORM R100-READ-INPUT.                                     05720108
057700                                                                  05721001
057700                                                                  05721108
026100***************************************************************** 05722001
026200*     READ THRU THE STORE RECORDS.  IF THE QUANTITY > 0, THEN     05723001
026300*     WRITE OUT A SET OF INVOICE RECORDS.                         05724001
026700***************************************************************** 05726001
025900 B200-PROCESS-STORES.                                             05727001
057700                                                                  05728001
031600     IF ET019-QUANTITY(PV-STR-IDX) NOT = 0                        05729118
031600         PERFORM B300-FORMAT-OUTPUT                               05729201
031600     END-IF.                                                      05729301
057700                                                                  05729401
057700                                                                  05729501
026100***************************************************************** 05729601
026200*     FORMAT THE OUTPUT RECORDS FOR THE STORE THAT HAS A SOLD     05729701
026300*     QUANTITY.                                                   05729801
026700***************************************************************** 05729901
025900 B300-FORMAT-OUTPUT.                                              05730001
095900     MOVE PV-SAVE-UPC-CODE TO PV-UPC-CODE.                        05730118
096200     IF PV-UPC-CODE-X NUMERIC                                     05730518
096300         MOVE PV-UPC-CODE TO PV-UPC-CODE-COMP3                    05730618
097100         PERFORM S200-GET-UPC-DETAILS                             05730929
097200         IF SQLCODE = +0                                          05731029
097900             PERFORM S400-GET-COST-RETAIL                         05731129
097200         END-IF                                                   05731229
096700     ELSE                                                         05731316
096800         SET PS-NOT-VALID-UPC TO TRUE                             05731420
096900     END-IF.                                                      05731516
096900                                                                  05731619
057700     COMPUTE PV-GROSS-AMT ROUNDED =                               05732721
057700            ET019-QUANTITY(PV-STR-IDX) * PV-SAVE-UNIT-PRICE.      05732820
057700                                                                  05732919
057700     COMPUTE PV-RETL-AMT ROUNDED =                                05733021
057700            ET019-QUANTITY(PV-STR-IDX) * PV-SAVE-RTL-PRICE.       05733120
057700                                                                  05733219
057700     INITIALIZE AP045-TRANSACTION-FILE.                           05733319
057700     MOVE EXTENT-DUN-NBR          TO AP045-VND-NBR.               05733413
057700     MOVE ET019-STORE(PV-STR-IDX) TO PV-DOC-NUM.                  05733542
057700     MOVE PV-DOC-NBR              TO AP045-DOC-NBR.               05733637
057700     MOVE PV-DATE                 TO AP045-DOC-DTE.               05733715
057700     MOVE '2'                     TO AP045-RECD-TYP-CDE.          05733813
057700     MOVE PV-SAVE-DEPT-NBR        TO AP045-DEPT-NBR.              05733913
057700     MOVE PV-SAVE-ENT-ID          TO AP045-ENT-ID.                05734013
057700     MOVE ENTNME-ENT-NAME-DESC    TO AP045-ENT-NME-DESC.          05734113
057700     MOVE ET019-STORE(PV-STR-IDX) TO AP045-STR-NBR.               05734213
057700     MOVE SKXREF-SUBCLASS         TO PV-SUBCLASS-NUM.             05734441
057700     MOVE PV-SAVE-SUBCL-E         TO AP045-CL-NBR.                05734541
057700     MOVE PV-GROSS-AMT            TO AP045-GRO-COST-AMT.          05734641
057700     MOVE PV-RETL-AMT             TO AP045-RETL-AMT.              05734741
057700     MOVE PV-GROSS-AMT            TO AP045-NET-COST-AMT.          05734841
057700     MOVE SKXREF-SKU              TO AP045-SKU-NBR.               05734941
057700     MOVE PV-DATE                 TO AP045-PYMT-DUE-DTE.          05735041
057700     MOVE 'N'                     TO AP045-DOC-HLD-CDE.           05735141
057700     MOVE PV-REASON-TEXT          TO AP045-RSN-1ST-LNE-TXT.       05736041
057700     PERFORM W100-WRITE-INVOICE.                                  05745809
057700                                                                  05746243
057700                                                                  05746343
058000***************************************************************** 05746443
057800 H100-HOUSEKEEPING.                                               05747004
058000***************************************************************** 05750000
058300*                                                                 05780000
058400     OPEN  INPUT   EDI-852-FILE                                   05790000
058600          OUTPUT   INVOICE-FILE.                                  05810000
058700                                                                  05820000
062200     PERFORM S100-GET-CURRENT-DATE.                               06130014
062200     PERFORM R100-READ-INPUT.                                     06140014
062400                                                                  06150000
062400     IF PS-INPUT-EOF-N                                            06150101
062400          PERFORM S300-GET-DUN-NBR                                06150214
062400     END-IF.                                                      06150301
062400                                                                  06150401
062400                                                                  06151001
062900***************************************************************** 06152001
062800*     READ THE CLAIRES 852 RECORD                                 06190001
062900***************************************************************** 06200000
062500 R100-READ-INPUT.                                                 06201001
063000*                                                                 06210000
025800     READ EDI-852-FILE INTO ET019-PRODUCT-ACTIVITY-RECORD         06211005
025900        AT END                                                    06212001
026000            SET PS-INPUT-E0F-Y       TO TRUE                      06213004
026100        NOT AT END                                                06214001
026200            ADD 1                    TO PV-INPUT-REC-CNT          06215004
026200            IF ET019-HEADER-RECORD                                06216001
026200                MOVE ET019-ENT-ID    TO PV-SAVE-ENT-ID            06217001
026200                ADD 1                TO PV-ENTID-CNT              06218004
026200            END-IF                                                06219301
026300     END-READ.                                                    06219401
064000                                                                  06310000
065700                                                                  06480000
065900***************************************************************** 06500000
066000*    GET CURRENT DATE                                             06510014
066100***************************************************************** 06520000
065800 S100-GET-CURRENT-DATE.                                           06521014
066200                                                                  06530000
066300     EXEC SQL                                                     06540000
066500          SET :PV-TMST = CURRENT TIMESTAMP                        06560022
066500     END-EXEC.                                                    06570022
067600                                                                  06690000
067700     EVALUATE TRUE                                                06700000
067800         WHEN SQLCODE = ZEROS                                     06710000
067900               MOVE PV-TMS-YEAR           TO PV-DATE-YY           06720015
067900               MOVE PV-TMS-MONTH          TO PV-DATE-MM           06730015
067900               MOVE PV-TMS-DAY            TO PV-DATE-DD           06740015
067900               MOVE '-'                   TO PV-DASH-1            06741033
067900               MOVE '-'                   TO PV-DASH-2            06742033
067900               MOVE PV-TMS-YEAR           TO PV-DOC-YY            06743037
067900               MOVE PV-TMS-MONTH          TO PV-DOC-MM            06744037
067900               MOVE PV-TMS-DAY            TO PV-DOC-DD            06745037
067900               MOVE PV-TMS-YEAR           TO PV-REASON-YY         06747037
067900               MOVE PV-TMS-MONTH          TO PV-REASON-MM         06748037
067900               MOVE PV-TMS-DAY            TO PV-REASON-DD         06749037
067900               MOVE '/'                   TO PV-REASON-SLASH1     06749137
067900               MOVE '/'                   TO PV-REASON-SLASH2     06749237
067900               MOVE 'KOHLS SBT SALES '    TO PV-REASON-TXT        06749340
068200          WHEN OTHER                                              06750000
068300               MOVE 'S100- '              TO PV-ABEND-PARAGRAPH   06760015
068400               MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION   06770000
068500               MOVE 'DATETIME'            TO PV-ABEND-STRUCTURE-1 06780015
068600               MOVE SPACES                TO PV-ABEND-STRUCTURE-2 06790000
068700               PERFORM Z999-SQL-ERROR                             06800000
068800      END-EVALUATE.                                               06810000
069020                                                                  06820000
069020                                                                  06821001
130200*--------------------------------------------------------------*  06821116
130300* GET THE DEPT,SUBCLASS, SKU AND ITM_NBR                          06821216
130400* ITM_NBR WILL BE USED TO GET UNT_RTL_AMT FROM TUPCPLS TABLE      06821316
130500*--------------------------------------------------------------*  06821416
130600 S200-GET-UPC-DETAILS.                                            06821516
130700                                                                  06821716
130800     EXEC SQL                                                     06821816
131000         SELECT B.SUBCLASS                                        06822016
131100              , B.SKU                                             06822116
131200              , B.ITM_NBR                                         06822216
131700         INTO  :SKXREF-SUBCLASS                                   06822716
131800              ,:SKXREF-SKU                                        06822816
131900              ,:SKXREF-ITM-NBR                                    06822916
132300         FROM  TUPCSKU A                                          06823316
132400              ,TSKXREF B                                          06823416
132500         WHERE  A.UPC_NBR = :PV-UPC-CODE-COMP3                    06823518
132600           AND  A.ITEM_NBR = B.ITM_NBR                            06823616
132700     END-EXEC.                                                    06823716
132800                                                                  06823816
132900     EVALUATE TRUE                                                06823916
133000         WHEN SQLCODE = ZERO                                      06824016
133100             SET PS-VALID-UPC TO TRUE                             06824118
133200         WHEN SQLCODE = +100                                      06824436
133300         WHEN SQLCODE = -904                                      06824536
133400         WHEN SQLCODE = -913                                      06824636
133500             MOVE 0 TO SKXREF-SUBCLASS                            06824719
133500             MOVE 0 TO SKXREF-SKU                                 06824819
133500             SET PS-NOT-VALID-UPC TO TRUE                         06824919
133600         WHEN OTHER                                               06825019
068300             MOVE 'S200- '              TO PV-ABEND-PARAGRAPH     06825119
068400             MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION     06825219
068500             MOVE 'TUPCSKU'             TO PV-ABEND-STRUCTURE-1   06825319
068600             MOVE 'TSKXREF'             TO PV-ABEND-STRUCTURE-2   06825419
068700             PERFORM Z999-SQL-ERROR                               06825519
135100     END-EVALUATE.                                                06826616
135200                                                                  06826716
135200                                                                  06826817
065900***************************************************************** 06826917
066000*    READ ENTITY TABLES                                           06827017
066100***************************************************************** 06827117
065800 S300-GET-DUN-NBR.                                                06827217
066200                                                                  06827317
066300     EXEC SQL                                                     06827417
066400         SELECT                                                   06827517
066500             T.DUN_NBR                                            06827617
066500           , N.ENT_NAME_DESC                                      06827717
066800         INTO                                                     06827817
066900             :EXTENT-DUN-NBR                                      06827917
066900           , :ENTNME-ENT-NAME-DESC                                06828017
067200         FROM TEXTENT T                                           06828117
067200            , TENTNME N                                           06828217
067300         WHERE T.ENT_ID          = :PV-SAVE-ENT-ID                06828317
067300           AND T.ENT_ID          = N.ENT_ID                       06828417
067300           AND N.TYPE_CDE        = '01'                           06828524
067500     END-EXEC.                                                    06828624
067600                                                                  06828724
067700     EVALUATE TRUE                                                06828824
067800         WHEN SQLCODE = ZEROS                                     06828924
067900              CONTINUE                                            06829024
068200          WHEN OTHER                                              06829124
068300             MOVE PV-SAVE-ENT-ID        TO PV-DISPLAY-NBR         06829224
068300             DISPLAY 'ENT ID ' PV-DISPLAY-NBR                     06829324
068300             MOVE 'S300- '              TO PV-ABEND-PARAGRAPH     06829424
068400             MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION     06829524
068500             MOVE 'TEXTENT'             TO PV-ABEND-STRUCTURE-1   06829624
068600             MOVE SPACES                TO PV-ABEND-STRUCTURE-2   06829724
068700             PERFORM Z999-SQL-ERROR                               06829824
068800      END-EVALUATE.                                               06829924
069020                                                                  06830024
069020                                                                  06830124
135300*--------------------------------------------------------------*  06830224
135400* GET THE UNT_COST_AMT & UNT_RTL_AMT FROM UPCPLS TABLE            06830324
135500*--------------------------------------------------------------*  06830424
135600 S400-GET-COST-RETAIL.                                            06830524
135600                                                                  06830624
135700     MOVE ET019-STORE(PV-STR-IDX) TO UPCPLS-STR-NBR.              06830724
135800     EXEC SQL                                                     06830824
135900          SELECT UNT_COST_AMT                                     06830924
135900               , UNT_RTL_AMT                                      06831024
136000            INTO :UPCPLS-UNT-COST-AMT                             06831124
136000               , :UPCPLS-UNT-RTL-AMT                              06831224
136100            FROM TUPCPLS                                          06831324
136200           WHERE ITM_NBR = :SKXREF-ITM-NBR                        06831424
136300             AND STR_NBR = :UPCPLS-STR-NBR                        06831524
136400             AND EFF_END_TMST IS NULL                             06831624
136500     END-EXEC.                                                    06831724
136600                                                                  06831824
136700     EVALUATE TRUE                                                06831924
136800         WHEN SQLCODE = ZERO                                      06832024
136900             MOVE UPCPLS-UNT-COST-AMT    TO PV-SAVE-UNIT-PRICE    06832124
136900             MOVE UPCPLS-UNT-RTL-AMT     TO PV-SAVE-RTL-PRICE     06832224
137000         WHEN SQLCODE = +100                                      06832324
137100             PERFORM S425-GET-COST-RETAIL-STORE0                  06832424
137200         WHEN OTHER                                               06832524
068300               MOVE 'S400- '              TO PV-ABEND-PARAGRAPH   06832624
068400               MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION   06832724
068500               MOVE 'TUPCPLS'             TO PV-ABEND-STRUCTURE-1 06832824
068600               MOVE SPACES                TO PV-ABEND-STRUCTURE-2 06832924
068700               PERFORM Z999-SQL-ERROR                             06833024
138400     END-EVALUATE.                                                06833617
138500                                                                  06833717
138500                                                                  06833817
138600*--------------------------------------------------------------*  06833917
138700* GET THE UNT_COST_AMT & UNT_RTL_AMT FROM UPCPLS TABLE FOR STORE 006834017
138800*--------------------------------------------------------------*  06834117
138900 S425-GET-COST-RETAIL-STORE0.                                     06834217
139000                                                                  06834317
139100     MOVE ZERO TO UPCPLS-STR-NBR.                                 06834417
139200     EXEC SQL                                                     06834517
135900          SELECT UNT_COST_AMT                                     06834617
135900               , UNT_RTL_AMT                                      06834717
136000            INTO :UPCPLS-UNT-COST-AMT                             06834817
136000               , :UPCPLS-UNT-RTL-AMT                              06834917
139500            FROM TUPCPLS                                          06835217
139600           WHERE ITM_NBR = :SKXREF-ITM-NBR                        06835317
139700             AND STR_NBR = :UPCPLS-STR-NBR                        06835417
139800             AND EFF_END_TMST IS NULL                             06835517
139900     END-EXEC.                                                    06835617
140000                                                                  06835717
140100     EVALUATE TRUE                                                06835817
140200         WHEN SQLCODE = ZERO                                      06835917
136900             MOVE UPCPLS-UNT-COST-AMT    TO PV-SAVE-UNIT-PRICE    06836018
136900             MOVE UPCPLS-UNT-RTL-AMT     TO PV-SAVE-RTL-PRICE     06836118
140400         WHEN SQLCODE = +100                                      06836317
136900             MOVE ZERO                   TO PV-SAVE-UNIT-PRICE    06836418
136900             MOVE ZERO                   TO PV-SAVE-RTL-PRICE     06836518
140700         WHEN OTHER                                               06836817
068300               MOVE 'S425- '              TO PV-ABEND-PARAGRAPH   06836917
068400               MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION   06837017
068500               MOVE 'TUPCPLS'             TO PV-ABEND-STRUCTURE-1 06837117
068600               MOVE SPACES                TO PV-ABEND-STRUCTURE-2 06837217
068700               PERFORM Z999-SQL-ERROR                             06837317
141800     END-EVALUATE.                                                06838017
138500                                                                  06838217
138500                                                                  06838317
071500***************************************************************** 06842217
071600*     WRITE THE OUTPUT RECORD                                     06842317
071700***************************************************************** 06842417
069100 W100-WRITE-INVOICE.                                              06843002
069200                                                                  06850000
071000     WRITE INVOICE-RECORD FROM AP045-TRANSACTION-FILE.            07020013
071100     ADD 1 TO PV-OUTPUT-REC-CNT.                                  07030004
071200                                                                  07040000
071200                                                                  07041004
071500***************************************************************** 07070000
071600*     CLOSE ALL FILES, REPORT ON NECESSARY TOTALS                 07080000
071700***************************************************************** 07090000
071300 Z900-END-OF-JOB.                                                 07101013
071400*                                                                 07102013
071900     DISPLAY '************************************************'.  07110000
072000     DISPLAY 'TOTAL INPUT RECORDS READ    = '                     07120004
072100              PV-INPUT-REC-CNT                                    07130004
072200     DISPLAY '************************************************'.  07140000
072300     DISPLAY 'TOTAL OUTPUT RECORDS WRITTEN   = '                  07150004
072400              PV-OUTPUT-REC-CNT                                   07160004
072500     DISPLAY '************************************************'.  07170000
072600     DISPLAY 'TOTAL UPC COUNT  = '                                07180004
072700              PV-UPC-CNT                                          07190004
072800     DISPLAY '************************************************'.  07200000
072600     DISPLAY 'TOTAL ENTID COUNT  = '                              07201004
072700              PV-ENTID-CNT                                        07202004
072800     DISPLAY '************************************************'.  07203004
072900                                                                  07210000
073000     CLOSE EDI-852-FILE                                           07220000
073200           INVOICE-FILE.                                          07240000
073300                                                                  07250000
074200***************************************************************** 07340000
074300*     PROCESS DB2 ABENDS                                          07350000
074400***************************************************************** 07360000
074000 Z999-SQL-ERROR.                                                  07371013
074100*                                                                 07372013
074600                                                                  07380000
074700     DISPLAY '*** DB2 ERROR '.                                    07390000
074800     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                 07400000
074900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 07410000
075000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               07420000
075100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               07430000
075200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             07440000
075300     IF PV-ABEND-STRUCTURE-2 > SPACES                             07450000
075400         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         07460000
075500                                                                  07470000
075600     COPY DPPD004.                                                07480000
075700     MOVE +4013                    TO ABEND-CODE.                 07490000
075800                                                                  07500000
075900     CALL 'ILBOABN0' USING ABEND-CODE.                            07510000
076000                                                                  07520000
