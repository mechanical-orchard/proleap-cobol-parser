000100******************************************************************00010012
000200 IDENTIFICATION DIVISION.                                         00020013
000300******************************************************************00030013
000400 PROGRAM-ID.    SUKUT164.                                         00040013
000500 AUTHOR.        JIM HUNTER.                                       00050013
000600 INSTALLATION.  KOHLS.                                            00060013
000700 DATE-WRITTEN   MARCH, 2017.                                      00070013
000800 DATE-COMPILED.                                                   00080013
000900******************************************************************00090013
001000*   THIS PROGRAM DETERMINES IF STORE SCANNING HAS BEEN TURNED ON  00100013
001100*   AND IF IT IS, HOW MANY DAYS BACK TO LOOK FOR CARTONS THAT     00110013
001200*   WERE NEVER SCANNED.                                           00120013
001300*   IT WILL GET A LIST OF THE TRIP IDS FROM THE TSUOBTS TABLE     00130013
001400*   THAT WERE UNLOADED ON THE DAY WE ARE LOOKING AT (INITIALLY,   00140013
001500*   14 DAYS PRIOR TO CURRENT DATE).                               00150013
001600*   IF THE STORES ASSOCIATED TO THE TRIP IDS ARE SCANNING STORES  00160013
001700*   THE NEW STORE SCANNING TABLE WILL BE CHECKED TO SEE IF THE    00170013
001800*   TRIP ID IS FOUND.  IF IT ISN'T, WRITE THE TRIP ID TO THE      00180013
001900*   OUTPUT FILE.                                                  00190013
002000******************************************************************00200013
002100*  07/18/2017    JIM ARENDT        CHG0173485                     00210013
002200*  CHANGED PROGRAM TO RETRIEVE THE BATCH PROCESSING DATE FROM AN  00220013
002300*  INPUT CONTROL CARD INSTEAD OF FROM DB2 TABLE TCOCNTL.          00230013
002400******************************************************************00240013
002500 ENVIRONMENT DIVISION.                                            00250013
002600 CONFIGURATION SECTION.                                           00260013
002700                                                                  00270013
002800 SOURCE-COMPUTER.        IBM-3090.                                00280013
002900 OBJECT-COMPUTER.        IBM-3090.                                00290013
003000                                                                  00300013
003100 INPUT-OUTPUT SECTION.                                            00310013
003200 FILE-CONTROL.                                                    00320013
003300                                                                  00330013
003400     SELECT BATCH-DATE-IN                                         00340013
003500         ASSIGN TO INP01.                                         00350013
003600                                                                  00360013
003700     SELECT ASSUMPTIVE-CTN-FILE-OUT                               00370013
003800         ASSIGN TO OUT01.                                         00380013
003900                                                                  00390013
004000******************************************************************00400013
004100 DATA DIVISION.                                                   00410013
004200 FILE SECTION.                                                    00420013
004300                                                                  00430013
004400 FD  BATCH-DATE-IN                                                00440013
004500     RECORDING MODE IS F                                          00450013
004600     LABEL RECORDS ARE STANDARD                                   00460013
004700     BLOCK CONTAINS 0 RECORDS.                                    00470013
004800                                                                  00480013
004900 01  BATCH-DATE-RECORD-IN               PIC  X(80).               00490013
005000                                                                  00500013
005100 FD  ASSUMPTIVE-CTN-FILE-OUT                                      00510013
005200     RECORDING MODE IS F                                          00520013
005300     LABEL RECORDS ARE STANDARD                                   00530013
005400     BLOCK CONTAINS 0 RECORDS.                                    00540013
005500                                                                  00550013
005600 01  ASSUMPTIVE-CTN-RECORD-OUT          PIC  X(100).              00560013
005700*                                                                 00570013
005800******************************************************************00580013
005900 WORKING-STORAGE SECTION.                                         00590013
006000******************************************************************00600013
006100******************************************************************00610013
006200*  ASSUMPTIVE CARTON OUTPUT FILE                                  00620013
006300******************************************************************00630013
006400     COPY SURD152.                                                00640013
006500                                                                  00650013
006600 01  PV-INPUT-FILE.                                               00660013
006700     05  PIF-RUN-DATE                PIC  X(10)    VALUE SPACES.  00670013
006800     05  FILLER                      PIC  X(70)    VALUE SPACES.  00680013
006900                                                                  00690013
007000 01  PS-PROGRAM-SWITCHES.                                         00700013
007100     05  PS-END-OF-TSUOBTS-CSR-SW    PIC  X(01)    VALUE 'N'.     00710013
007200         88  PS-END-OF-TSUOBTS-CSR                 VALUE 'Y'.     00720013
007300         88  PS-NOT-END-OF-TSUOBTS-CSR             VALUE 'N'.     00730013
007400                                                                  00740013
007500     05  PS-STORE-SCANNING-SW        PIC  X(01)    VALUE 'N'.     00750013
007600         88  PS-NON-SCANNING-STORE                 VALUE 'N'.     00760013
007700         88  PS-SCANNING-STORE                     VALUE 'S'.     00770013
007800                                                                  00780013
007900     05  PS-END-OF-CONTROL-SW        PIC  X(01)    VALUE 'N'.     00790013
008000         88  PS-END-OF-CONTROL                     VALUE 'Y'.     00800013
008100         88  PS-NOT-END-OF-CONTROL                 VALUE 'N'.     00810013
008200                                                                  00820013
008300 01  PC-PROGRAM-CONSTANTS.                                        00830013
008400     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT164'. 00840013
008500                                                                  00850013
008600 01  PV-PROGRAM-VARIABLES.                                        00860013
008700     05  PV-PARAGRAPH-NAME           PIC  X(30)     VALUE SPACES. 00870013
008800     05  PV-TRIP-IDS-FETCHED         PIC  9(9) COMP VALUE ZEROS.  00880013
008900     05  PV-ASSUMPTIVE-WRITE-COUNT   PIC  9(9) COMP VALUE ZEROS.  00890013
009000     05  PV-TOTAL-WRITE-COUNT        PIC  9(9) COMP VALUE ZEROS.  00900013
009100     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            00910013
009200     05  PV-DISPLAY-SQLCODE          PIC  +999  VALUE ZEROES.     00920013
009300     05  PV-DISPLAY-STORE            PIC  9999  VALUE ZEROES.     00930013
009400     05  PV-DISPLAY-TRIP-ID          PIC  Z(8)9.                  00940013
009500     05  PV-PREV-STORE               PIC S9(4)  COMP VALUE ZEROS. 00950013
009600     05  PV-PREV-TRIP-ID             PIC S9(9)  COMP VALUE ZEROS. 00960013
009700     05  PV-FUNC-TXT                 PIC  X(25) VALUE SPACES.     00970013
009800     05  PV-ASSMPT-QTY               PIC S9(4)  COMP VALUE +0.    00980013
009900     05  PV-ASSMPT-DATE              PIC  X(10) VALUE SPACES.     00990013
010000     05  PV-ASSMPT-VIRT-QTY          PIC S9(4)  COMP VALUE +0.    01000013
010100     05  PV-ASSMPT-VIRT-DATE         PIC  X(10) VALUE SPACES.     01010013
010110     05  PV-SCHED-INV-QTY            PIC S9(4)  COMP VALUE +0.    01011013
010120     05  PV-SCHED-INV-DATE           PIC  X(10) VALUE SPACES.     01012013
010130     05  PV-RANGE-INV-QTY            PIC S9(4)  COMP VALUE +0.    01013013
010140     05  PV-RANGE-INV-DATE           PIC  X(10) VALUE SPACES.     01014013
010150     05  PV-ASSMPT-RFID-QTY          PIC S9(4)  COMP VALUE +0.    01015015
010160     05  PV-ASSMPT-RFID-DATE         PIC  X(10) VALUE SPACES.     01016015
010170     05  PV-ASSMPT-VIRT-RFID-QTY     PIC S9(4)  COMP VALUE +0.    01017015
010180     05  PV-ASSMPT-VIRT-RFID-DATE    PIC  X(10) VALUE SPACES.     01018015
010200     05  PV-DISPLAY-QTY              PIC  +9999.                  01020013
010300     05  PV-ELEM-STORE               PIC S9(10)V9(5) COMP-3.      01030013
010310     05  PV-ASSUMP-REASON            PIC  X(1)  VALUE SPACE.      01031023
010320     05  PV-HOLD-TRIP-ID             PIC  S9(9) COMP.             01032023
010321     05  PV-DISP-TRIP                PIC   9(9).                  01032123
010330     05  PV-BYPASS-COUNT             PIC  9(9) COMP VALUE ZEROS.  01033023
010400                                                                  01040013
010500 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     01050013
010600                                                   COMP SYNC.     01060013
010700 01  PV-ABEND-FIELDS.                                             01070013
010800     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT164'.01080013
010900     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    01090013
011000     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    01100013
011100     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    01110013
011200     05  PV-ABEND-STRUCTURE-2         PIC X(20)  VALUE SPACES.    01120013
011300     05  PV-ABEND-STRUCTURE-3         PIC X(20)  VALUE SPACES.    01130013
011400     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    01140013
011500     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01150013
011600     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01160013
011700     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01170013
011800     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01180013
011900*  USED FOR DB2 ERROR MESSAGE BUILDING                            01190013
012000     COPY DPWS004.                                                01200013
012100                                                                  01210013
012200******************************************************************01220013
012300*  COMMUNICATIONS AREA FOR DB2                                    01230013
012400******************************************************************01240013
012500     EXEC SQL                                                     01250013
012600          INCLUDE SQLCA                                           01260013
012700     END-EXEC.                                                    01270013
012800                                                                  01280013
012900******************************************************************01290013
013000*  OUTBOUND STORE SCAN TABLE                                      01300013
013100******************************************************************01310013
013200     EXEC SQL                                                     01320013
013300          INCLUDE SUT00121                                        01330013
013400     END-EXEC.                                                    01340013
013500                                                                  01350013
013600******************************************************************01360013
013700*  OUTBOUND TRAILER TRIP TABLE                                    01370013
013800******************************************************************01380013
013900     EXEC SQL                                                     01390013
014000          INCLUDE TSUOBTR                                         01400013
014100     END-EXEC.                                                    01410013
014200                                                                  01420013
014300******************************************************************01430013
014400*  OUTBOUND TRAILER TRIP STATUS TABLE                             01440013
014500******************************************************************01450013
014600     EXEC SQL                                                     01460013
014700          INCLUDE TSUOBTS                                         01470013
014800     END-EXEC.                                                    01480013
014900                                                                  01490013
015000******************************************************************01500013
015100*  PARAMATER TABLE                                                01510013
015200******************************************************************01520013
015300     EXEC SQL                                                     01530013
015400          INCLUDE TKRPRPM                                         01540013
015500     END-EXEC.                                                    01550013
015600                                                                  01560013
015700***************************************************************** 01570013
015800*    WST_INTGRTN_TYP TABLE                                        01580013
015900***************************************************************** 01590013
016000     EXEC SQL                                                     01600013
016100          INCLUDE WST00008                                        01610013
016200     END-EXEC.                                                    01620013
016300                                                                  01630013
016400***************************************************************** 01640013
016500*    WST_ATTR_ELEM TABLE                                          01650013
016600***************************************************************** 01660013
016700     EXEC SQL                                                     01670013
016800          INCLUDE WST00009                                        01680013
016900     END-EXEC.                                                    01690013
017000                                                                  01700013
017100***************************************************************** 01710013
017200*    WST_ATTR_DEFN TABLE                                          01720013
017300***************************************************************** 01730013
017400     EXEC SQL                                                     01740013
017500          INCLUDE WST00010                                        01750013
017600     END-EXEC.                                                    01760013
017700                                                                  01770013
017800******************************************************************01780013
017900*    TCNTRID - TRAILIER ID TABLE                                  01790013
018000******************************************************************01800013
018100     EXEC SQL                                                     01810013
018200          INCLUDE TCNTRID                                         01820013
018300     END-EXEC.                                                    01830013
018400                                                                  01840013
018500******************************************************************01850013
018600*  LOGISTICS STORE TABLE (XLT_LOC)                                01860013
018700******************************************************************01870013
018800     EXEC SQL                                                     01880013
018900          INCLUDE XLT00010                                        01890013
019000     END-EXEC.                                                    01900013
019100                                                                  01910013
019110******************************************************************01911020
019120*  LOGISTICS INVENTORY PARM TABLE (XLT_MDSE_INV_PARM)             01912020
019130******************************************************************01913020
019140     EXEC SQL                                                     01914020
019150          INCLUDE XLT00025                                        01915020
019160     END-EXEC.                                                    01916020
019170                                                                  01917020
019200                                                                  01920013
019300*---------------------------------------------------------------* 01930013
019400*    TSUOBTS CURSOR TO FIND TRIP IDS TO PROCESS THRU THE          01940015
019401*    ASSUMPTIVE RECEIPT PROCESS.  THIS IS A UNION WITH 6 DIFFERENT01940115
019402*    SELECT STATEMENTS - THE FOLLOWING EXPLAINS THE SETS OF SELECT01940215
019403*    STATEMENTS.  THE SELECT STATEMENTS ARE GROUPED IN TWOS WITH  01940315
019404*    THE FIRST PICKING UP A REGULAR TRIP (TRAILERS DEFINED AS     01940415
019405*    LONGER THAN 1 FOOT) AND THE SECOND PICKING A VIRTUAL TRIP    01940515
019406*    (TRAILERS DEFINED AS 1 FOOT TRAILERS).  THERE MIGHT BE       01940615
019407*    DIFFERENT DAYS PARAMETER VALUES FOR THE REGULAR VS VIRTUAL   01940715
019408*    TRIPS.                                                       01940815
019410*    => FIRST TWO SELECT STATEMENTS WILL BE USED TO PICK UP THE   01941015
019420*       TRIPS BASED ON THE STANDARD DAYS DEFINITION (FIRST        01942015
019430*       SELECT BASED ON REGULAR TRAILERS AND THE SECOND           01943015
019440*       SELECT BASED ON VIRTUAL TRAILERS).                        01944015
019450*       BASED ON THE ASMPRC AND ASMVRT PARMS TO CALCULATE THE     01945015
019460*       DATES.                                                    01946015
019470*    => THE THIRD AND FOURTH SELECT STATMENTS WILL BE USED TO     01947015
019480*       PICK UP TRAILERS FOR THOSE STORES SCHEDULED FOR A         01948015
019490*       PHYSICAL INVENTORY PROCESS (THESE TRAILERS WILL BE RUN    01949015
019491*       THRU THE ASSUMPTIVE RECEIPT SOONER THAN THE RULES FROM    01949115
019492*       THE FIRST 2 SELECT STATEMENTS.                            01949215
019493*       THE ASMPID PARM IS USED TO COME UP WITH THE DATE TO BE    01949315
019494*       USED WHEN JOINING TO THE XLT_MDSE_INV_PARM TO GET THE     01949415
019495*       STORES SCHEDULED AND THE ASMPRC AND ASMPRM PARMS WILL     01949515
019496*       BE USED TO COME UP WITH THE BOOKEND DATES.                01949615
019497*    => THE FIFTH AND SIXTH SELECT STATEMENTS WILL BE USED TO     01949715
019498*       PICK UP TRAILERS FOR THOSE STORES THAT ARE PART OF THE    01949815
019499*       RFID PILOT STORE PROGRAM - THESE TRAILERS ARE TO BE       01949915
019500*       ASSUMPTIVE RECEIPT SOONER THAN THE FIRST 2 SELECT         01950015
019501*       STATEMENTS.                                               01950115
019502*    => THE SEVENTH SELECT STATEMENT WILL BE USED TO FORCE THE    01950216
019503*       ASSUMPTIVE RECEIPT PROCESS FOR A TRAILER BEFORE THE       01950316
019504*       TRAILER WOULD GET PROCESSED BY ANY OF THE OTHER SELECT    01950416
019505*       STATEMENTS.  TRIPS TO BE FORCE PROCESSED WOULD NEED TO    01950516
019506*       BE SET UP WITHIN THE WST CONFIGURATION PARM ASMRECFORC.   01950616
019507*    => THE EIGHTH SELECT STATEMENT WILL BE USED TO FORCE THE     01950722
019509*       ASSUMPTIVE RECEIPT PROCESS FOR A TRAILER BEFORE THE       01950922
019510*       TRAILER WOULD GET PROCESSED BY ANY OF THE OTHER SELECT    01951022
019511*       STATEMENTS.  TRIPS TO BE FORCE PROCESSED ARE TRIPS        01951122
019512*       RELATED TO A STORE THAT HAS BEEN SET UP IN THE WSTE       01951222
019513*       CONFIGURATION PARM ASMRECSTOR WHICH CAN BE USED TO PICK   01951322
019514*       UP ALL TRAILERS FOR A STORE PRIOR TO THE END DATE THAT    01951422
019515*       ARE SET TO THE UNLOADED AT STORE STATUS.                  01951522
019516*                                                                 01951622
019517*    NOW, WITH THIS CURSOR BEING A UNION, IF THE SAME TRIP GETS   01951722
019518*    PICKED UP FROM THE DIFFERENT SELECT STATMENTS, BECAUSE OF    01951822
019519*    THE UNION AND THE COLUMNS BEING SELECTED, THE TRIP WILL      01951922
019520*    ONLY BE RETURNED ONCE FROM THIS.                             01952022
019521*                                                                 01952122
019522*    SHOULD ALSO BE NOTED THAT IF A TRIP IS PICKED UP TODAY AND   01952222
019523*    ASSUMPTIVE RECEIPTED, IF THE TRIP GETS PICKED UP AT A LATER  01952322
019524*    RUN DATE AGAIN BY ANOTHER SELECT, THE TRIP WOULD GET PASSED  01952422
019525*    THRU THE PROCESS BUT BECAUSE ASSUMPTIVE RECEIPT WAS ALREADY  01952522
019526*    DONE, THE SECOND PASS WOULD NOT PICK UP ANY CARTONS TO       01952622
019527*    ASSUMPTIVE RECEIVE SO NO HARM LETTING THE TRIP GO THRU A     01952722
019528*    SECOND TIME ON A DIFFERENT DAY.                              01952822
019530*                                                                 01953022
020000*---------------------------------------------------------------* 02000013
020100     EXEC SQL                                                     02010013
020200       DECLARE TSUOBTS-CSR CURSOR FOR                             02020013
020300         SELECT  'A'                                              02030023
020310              ,  A.OTBND_TRIP_ID                                  02031023
020400              ,  A.OTBND_STAT_TMST                                02040013
020500              ,  A.STAT_OPER_UNT_ID                               02050013
020600              ,  B.DEST_OPER_UNT_ID                               02060013
020700           FROM  TSUOBTS  A                                       02070013
020800              ,  TSUOBTR  B                                       02080013
020900              ,  TCNTRID  C                                       02090013
021000              ,  XLT_LOC  D                                       02100013
021100          WHERE  DATE(A.OTBND_STAT_TMST)  = :PV-ASSMPT-DATE       02110013
021200            AND  C.TRLR_SIZE_MU          <> 1                     02120013
021300            AND  A.TRIP_STAT_CDE          = 'SU'                  02130013
021400            AND  A.OTBND_TRIP_ID          = B.OTBND_TRIP_ID       02140013
021500            AND  B.TRLR_SRL_NBR           = C.TRLR_SRL_NBR        02150013
021600            AND  D.LOC_NBR                = B.DEST_OPER_UNT_ID    02160013
021700            AND  D.LOC_TYP_CDE            = 'DS'                  02170013
021800            AND  D.E_BUS_IND              = 'N'                   02180013
021900                                                                  02190013
022000          UNION                                                   02200013
022100                                                                  02210013
022200         SELECT  'B'                                              02220023
022210              ,  A.OTBND_TRIP_ID                                  02221023
022300              ,  A.OTBND_STAT_TMST                                02230013
022400              ,  A.STAT_OPER_UNT_ID                               02240013
022500              ,  B.DEST_OPER_UNT_ID                               02250013
022600           FROM  TSUOBTS  A                                       02260013
022700              ,  TSUOBTR  B                                       02270013
022800              ,  TCNTRID  C                                       02280013
022900              ,  XLT_LOC  D                                       02290013
023000          WHERE  DATE(A.OTBND_STAT_TMST) = :PV-ASSMPT-VIRT-DATE   02300013
023100            AND  C.TRLR_SIZE_MU          = 1                      02310013
023200            AND  A.TRIP_STAT_CDE         = 'SU'                   02320013
023300            AND  A.OTBND_TRIP_ID         = B.OTBND_TRIP_ID        02330013
023400            AND  B.TRLR_SRL_NBR          = C.TRLR_SRL_NBR         02340013
023500            AND  D.LOC_NBR               = B.DEST_OPER_UNT_ID     02350013
023600            AND  D.LOC_TYP_CDE           = 'DS'                   02360013
023700            AND  D.E_BUS_IND             = 'N'                    02370013
023710                                                                  02371013
023720          UNION                                                   02372013
023730                                                                  02373013
023740         SELECT  'C'                                              02374023
023741              ,  A.OTBND_TRIP_ID                                  02374123
023750              ,  A.OTBND_STAT_TMST                                02375013
023760              ,  A.STAT_OPER_UNT_ID                               02376013
023770              ,  B.DEST_OPER_UNT_ID                               02377013
023780           FROM  TSUOBTS  A                                       02378013
023790              ,  TSUOBTR  B                                       02379013
023791              ,  TCNTRID  C                                       02379113
023792              ,  XLT_LOC  D                                       02379213
023793              ,  XLT_MDSE_INV_PARM E                              02379313
023794          WHERE  DATE(A.OTBND_STAT_TMST) BETWEEN                  02379413
023795                   :PV-ASSMPT-DATE AND :PV-RANGE-INV-DATE         02379513
023796            AND  C.TRLR_SIZE_MU         <> 1                      02379613
023797            AND  A.TRIP_STAT_CDE         = 'SU'                   02379713
023798            AND  A.OTBND_TRIP_ID         = B.OTBND_TRIP_ID        02379813
023799            AND  NOT A.FINCL_POST_TMST   =                        02379913
023800                   '9999-09-09-09.09.09.999999'                   02380013
023801            AND  B.TRLR_SRL_NBR          = C.TRLR_SRL_NBR         02380113
023802            AND  D.LOC_NBR               = B.DEST_OPER_UNT_ID     02380213
023803            AND  D.LOC_TYP_CDE           = 'DS'                   02380313
023804            AND  D.E_BUS_IND             = 'N'                    02380413
023805            AND  E.LOC_NBR               = A.STAT_OPER_UNT_ID     02380513
023806            AND  E.ACTV_IND              = 'Y'                    02380613
023807            AND  E.LOC_INV_STAT_CDE      = 'IN'                   02380713
023808            AND  E.PLND_INV_DTE          = :PV-SCHED-INV-DATE     02380813
023810                                                                  02381013
023820          UNION                                                   02382013
023830                                                                  02383013
023840         SELECT  'D'                                              02384023
023841              ,  A.OTBND_TRIP_ID                                  02384123
023850              ,  A.OTBND_STAT_TMST                                02385013
023860              ,  A.STAT_OPER_UNT_ID                               02386013
023870              ,  B.DEST_OPER_UNT_ID                               02387013
023880           FROM  TSUOBTS  A                                       02388013
023890              ,  TSUOBTR  B                                       02389013
023891              ,  TCNTRID  C                                       02389113
023892              ,  XLT_LOC  D                                       02389213
023893              ,  XLT_MDSE_INV_PARM E                              02389313
023894          WHERE  DATE(A.OTBND_STAT_TMST) BETWEEN                  02389413
023895                   :PV-ASSMPT-VIRT-DATE AND :PV-RANGE-INV-DATE    02389513
023897            AND  C.TRLR_SIZE_MU          = 1                      02389713
023898            AND  A.TRIP_STAT_CDE         = 'SU'                   02389813
023899            AND  A.OTBND_TRIP_ID         = B.OTBND_TRIP_ID        02389913
023900            AND  NOT A.FINCL_POST_TMST   =                        02390013
023901                   '9999-09-09-09.09.09.999999'                   02390113
023902            AND  B.TRLR_SRL_NBR          = C.TRLR_SRL_NBR         02390213
023903            AND  D.LOC_NBR               = B.DEST_OPER_UNT_ID     02390313
023904            AND  D.LOC_TYP_CDE           = 'DS'                   02390413
023905            AND  D.E_BUS_IND             = 'N'                    02390513
023906            AND  E.LOC_NBR               = A.STAT_OPER_UNT_ID     02390613
023907            AND  E.ACTV_IND              = 'Y'                    02390713
023908            AND  E.LOC_INV_STAT_CDE      = 'IN'                   02390813
023909            AND  E.PLND_INV_DTE          = :PV-SCHED-INV-DATE     02390913
023910                                                                  02391013
023911          UNION                                                   02391115
023912                                                                  02391215
023913         SELECT  'E'                                              02391323
023914              ,  A.OTBND_TRIP_ID                                  02391423
023915              ,  A.OTBND_STAT_TMST                                02391523
023916              ,  A.STAT_OPER_UNT_ID                               02391623
023917              ,  B.DEST_OPER_UNT_ID                               02391723
023918           FROM  TSUOBTS  A                                       02391823
023919              ,  TSUOBTR  B                                       02391923
023920              ,  TCNTRID  C                                       02392023
023921              ,  XLT_LOC  D                                       02392123
023922              ,  TKRPRPM  E                                       02392223
023923          WHERE  DATE(A.OTBND_STAT_TMST) = :PV-ASSMPT-RFID-DATE   02392323
023924            AND  C.TRLR_SIZE_MU         <> 1                      02392423
023925            AND  A.TRIP_STAT_CDE         = 'SU'                   02392523
023926            AND  A.OTBND_TRIP_ID         = B.OTBND_TRIP_ID        02392623
023927            AND  NOT A.FINCL_POST_TMST   =                        02392723
023928                   '9999-09-09-09.09.09.999999'                   02392823
023929            AND  B.TRLR_SRL_NBR          = C.TRLR_SRL_NBR         02392923
023930            AND  D.LOC_NBR               = B.DEST_OPER_UNT_ID     02393023
023931            AND  D.LOC_TYP_CDE           = 'DS'                   02393123
023932            AND  D.E_BUS_IND             = 'N'                    02393223
023933            AND  E.INTFC_SYS_CDE         = 'KHL'                  02393323
023934            AND  E.SYS_PRC_FUNC_CDE      = 'ASMRFS'               02393423
023935            AND  E.FUNC_PRC_STAT_CDE     = 'AC'                   02393523
023936            AND  E.LOC_ID                = A.STAT_OPER_UNT_ID     02393623
023937            AND  E.FUNC_TXT              = 'Y'                    02393723
023938            AND  E.FUNC_BEG_TMST        <= CURRENT TIMESTAMP      02393823
023939            AND  E.FUNC_END_TMST        >= CURRENT TIMESTAMP      02393923
023940                                                                  02394023
023941          UNION                                                   02394123
023942                                                                  02394223
023943         SELECT  'F'                                              02394323
023944              ,  A.OTBND_TRIP_ID                                  02394423
023945              ,  A.OTBND_STAT_TMST                                02394523
023946              ,  A.STAT_OPER_UNT_ID                               02394623
023947              ,  B.DEST_OPER_UNT_ID                               02394723
023948           FROM  TSUOBTS  A                                       02394823
023949              ,  TSUOBTR  B                                       02394923
023950              ,  TCNTRID  C                                       02395023
023951              ,  XLT_LOC  D                                       02395123
023952              ,  TKRPRPM  E                                       02395223
023953          WHERE  DATE(A.OTBND_STAT_TMST) =                        02395323
023954                 :PV-ASSMPT-VIRT-RFID-DATE                        02395423
023955            AND  C.TRLR_SIZE_MU          = 1                      02395523
023956            AND  A.TRIP_STAT_CDE         = 'SU'                   02395623
023957            AND  A.OTBND_TRIP_ID         = B.OTBND_TRIP_ID        02395723
023958            AND  NOT A.FINCL_POST_TMST   =                        02395823
023959                   '9999-09-09-09.09.09.999999'                   02395923
023960            AND  B.TRLR_SRL_NBR          = C.TRLR_SRL_NBR         02396023
023961            AND  D.LOC_NBR               = B.DEST_OPER_UNT_ID     02396123
023962            AND  D.LOC_TYP_CDE           = 'DS'                   02396223
023963            AND  D.E_BUS_IND             = 'N'                    02396323
023964            AND  E.INTFC_SYS_CDE         = 'KHL'                  02396423
023965            AND  E.SYS_PRC_FUNC_CDE      = 'ASMRFS'               02396523
023966            AND  E.FUNC_PRC_STAT_CDE     = 'AC'                   02396623
023967            AND  E.LOC_ID                = A.STAT_OPER_UNT_ID     02396723
023968            AND  E.FUNC_TXT              = 'Y'                    02396823
023969            AND  E.FUNC_BEG_TMST        <= CURRENT TIMESTAMP      02396923
023970            AND  E.FUNC_END_TMST        >= CURRENT TIMESTAMP      02397023
023971                                                                  02397123
023972          UNION                                                   02397223
023973                                                                  02397323
023974         SELECT  'G'                                              02397423
023975              ,  I.OTBND_TRIP_ID                                  02397523
023976              ,  I.OTBND_STAT_TMST                                02397623
023977              ,  I.STAT_OPER_UNT_ID                               02397723
023978              ,  J.DEST_OPER_UNT_ID                               02397823
023979           FROM  WST_INTGRTN_TYP   A                              02397923
023980              ,  WST_ATTR_DEFN     B                              02398023
023981              ,  WST_ATTR_ELEM     C                              02398123
023982              ,  WST_ATTR_ELEM     D                              02398223
023983              ,  WST_ATTR_ELEM     E                              02398323
023984              ,  WST_ATTR_ELEM     F                              02398423
023985              ,  WST_ATTR_ELEM     G                              02398523
023986              ,  WST_ATTR_ELEM     H                              02398623
023987              ,  TSUOBTS  I                                       02398723
023988              ,  TSUOBTR  J                                       02398823
023989              ,  XLT_LOC  K                                       02398923
023990          WHERE  A.INTGRTN_TYP_CDE    = 'ASMRECFORC'              02399016
023991            AND  B.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02399116
023992            AND  B.ATTR_DEFN_SEQ_NBR  = 1                         02399216
023993            AND  C.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02399316
023994            AND  C.ATTR_DEFN_SEQ_NBR  = 1                         02399416
023995            AND  D.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02399516
023996            AND  D.ATTR_DEFN_SEQ_NBR  = 2                         02399616
023997            AND  D.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02399716
023998            AND  E.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02399816
023999            AND  E.ATTR_DEFN_SEQ_NBR  = 3                         02399916
024000            AND  E.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02400016
024001            AND  DATE(E.ATTR_ELEM_TMST) = :PIF-RUN-DATE           02400116
024002            AND  F.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02400216
024003            AND  F.ATTR_DEFN_SEQ_NBR  = 4                         02400316
024004            AND  F.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02400416
024005            AND  F.ATTR_ELEM_TXT      = 'Y'                       02400516
024006            AND  G.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02400616
024007            AND  G.ATTR_DEFN_SEQ_NBR  = 5                         02400716
024008            AND  G.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02400816
024009            AND  H.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02400916
024010            AND  H.ATTR_DEFN_SEQ_NBR  = 6                         02401016
024011            AND  H.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02401116
024012            AND  I.OTBND_TRIP_ID      = C.ATTR_ELEM_NBR           02401216
024013            AND  I.TRIP_STAT_CDE      = 'SU'                      02401316
024014            AND  NOT I.FINCL_POST_TMST =                          02401417
024015                   '9999-09-09-09.09.09.999999'                   02401517
024016            AND  J.OTBND_TRIP_ID      = I.OTBND_TRIP_ID           02401617
024017            AND  J.DEST_OPER_UNT_ID   = D.ATTR_ELEM_NBR           02401717
024018            AND  K.LOC_NBR            = J.DEST_OPER_UNT_ID        02401817
024019            AND  K.LOC_TYP_CDE        = 'DS'                      02401917
024020            AND  K.E_BUS_IND          = 'N'                       02402017
024021                                                                  02402118
024022          UNION                                                   02402218
024023                                                                  02402318
024024         SELECT  'H'                                              02402423
024025              ,  K.OTBND_TRIP_ID                                  02402523
024026              ,  K.OTBND_STAT_TMST                                02402623
024027              ,  K.STAT_OPER_UNT_ID                               02402723
024028              ,  J.DEST_OPER_UNT_ID                               02402823
024029           FROM  WST_INTGRTN_TYP   A                              02402923
024030              ,  WST_ATTR_DEFN     B                              02403023
024031              ,  WST_ATTR_ELEM     C                              02403123
024032              ,  WST_ATTR_ELEM     D                              02403223
024033              ,  WST_ATTR_ELEM     E                              02403323
024034              ,  WST_ATTR_ELEM     F                              02403423
024035              ,  WST_ATTR_ELEM     G                              02403523
024036              ,  WST_ATTR_ELEM     H                              02403623
024037              ,  WST_ATTR_ELEM     I                              02403723
024038              ,  TSUOBTR  J                                       02403818
024039              ,  TSUOBTS  K                                       02403918
024040              ,  XLT_LOC  L                                       02404018
024041          WHERE  A.INTGRTN_TYP_CDE    = 'ASMRECSTOR'              02404118
024042            AND  B.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02404218
024043            AND  B.ATTR_DEFN_SEQ_NBR  = 1                         02404318
024044            AND  C.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02404418
024045            AND  C.ATTR_DEFN_SEQ_NBR  = 1                         02404518
024046            AND  D.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02404618
024047            AND  D.ATTR_DEFN_SEQ_NBR  = 2                         02404718
024048            AND  D.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02404818
024049            AND  E.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02404918
024050            AND  E.ATTR_DEFN_SEQ_NBR  = 3                         02405018
024051            AND  E.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02405118
024052            AND  DATE(E.ATTR_ELEM_TMST) >= :PIF-RUN-DATE          02405218
024053            AND  F.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02405318
024054            AND  F.ATTR_DEFN_SEQ_NBR  = 4                         02405418
024055            AND  F.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02405518
024056            AND  F.ATTR_ELEM_TXT      = 'Y'                       02405618
024057            AND  G.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02405718
024058            AND  G.ATTR_DEFN_SEQ_NBR  = 5                         02405818
024059            AND  G.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02405918
024060            AND  H.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02406018
024061            AND  H.ATTR_DEFN_SEQ_NBR  = 6                         02406118
024062            AND  H.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02406218
024063            AND  I.INTGRTN_TYP_CDE    = A.INTGRTN_TYP_CDE         02406318
024064            AND  I.ATTR_DEFN_SEQ_NBR  = 7                         02406418
024065            AND  I.ATTR_ELEM_SEQ_NBR  = C.ATTR_ELEM_SEQ_NBR       02406518
024066            AND  J.DEST_OPER_UNT_ID   = C.ATTR_ELEM_NBR           02406618
024067            AND  K.OTBND_TRIP_ID      = J.OTBND_TRIP_ID           02406718
024069            AND  K.TRIP_STAT_CDE      = 'SU'                      02406918
024070            AND  DATE(K.FINCL_POST_TMST) =                        02407019
024071                   DATE(:PIF-RUN-DATE) - D.ATTR_ELEM_NBR DAYS     02407118
024074            AND  L.LOC_NBR            = J.DEST_OPER_UNT_ID        02407418
024075            AND  L.LOC_TYP_CDE        = 'DS'                      02407518
024076            AND  L.E_BUS_IND          = 'N'                       02407618
024077                                                                  02407718
024078       ORDER BY  2,1                                              02407823
024080        WITH UR                                                   02408018
024100     END-EXEC.                                                    02410013
024200                                                                  02420013
024300                                                                  02430013
024400******************************************************************02440013
024500 PROCEDURE DIVISION.                                              02450013
024600******************************************************************02460013
024700******************************************************************02470013
024800* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02480013
024900*      PROGRAM.                                                   02490013
025000******************************************************************02500013
025100 0000-PROGRAM-MAINLINE.                                           02510013
025200                                                                  02520013
025300     DISPLAY ' '.                                                 02530013
025400     DISPLAY '***** SUKUT164 STARTED *****'.                      02540013
025500                                                                  02550013
025600     PERFORM 1000-INITIALIZE.                                     02560013
025700                                                                  02570013
025800     IF PV-FUNC-TXT = 'A' OR 'E'                                  02580013
025900         PERFORM 2000-PROCESS-TSUOBTS-TRIP-IDS                    02590013
026000     END-IF.                                                      02600013
026100                                                                  02610013
026200     PERFORM 9000-EOJ-ROUTINE.                                    02620013
026300                                                                  02630013
026400     STOP RUN.                                                    02640013
026500                                                                  02650013
026600******************************************************************02660013
026700*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02670013
026800*  -- OPEN INPUT/OUTPUT FILES                                     02680013
026900*  -- READ TKRPRPM PARM TABLE TO SEE IF STORES ARE SCANNING       02690013
027000*     IF THEY ARE:                                                02700013
027100*     READ THE CURRENT BATCH PROCESS DATE FROM THE INPUT RECORD,  02710013
027200*     GET THE OFFSET DAYS FROM THE TKRPRPM TABLE AND SUBTRACT     02720013
027300*     IT FROM THE BATCH PROCESS DATE TO GET THE PROCESSING DATE   02730013
027400*     TO USE IN DETERMINING ASSUMPTIVE CARTONS.                   02740013
027500******************************************************************02750013
027600 1000-INITIALIZE.                                                 02760013
027700                                                                  02770013
027800     OPEN INPUT  BATCH-DATE-IN                                    02780013
027900          OUTPUT ASSUMPTIVE-CTN-FILE-OUT.                         02790013
028000                                                                  02800013
028100     PERFORM 1100-READ-TKRPRPM-SCAN-IND.                          02810013
028200                                                                  02820013
028300     IF PV-FUNC-TXT = 'A' OR 'E'                                  02830013
028400         PERFORM 1200-READ-CONTROL-CARD                           02840013
028500         PERFORM 1300-READ-TKRPRPM-DAYS                           02850013
028600         PERFORM 1400-READ-TKRPRPM-VIRTUAL-DAYS                   02860013
028610         PERFORM 1500-READ-PARM-SCHED-INV-DAYS                    02861014
028620         PERFORM 1600-READ-PARM-INV-RANGE-DAYS                    02862014
028630         PERFORM 1700-READ-PARM-RFID-DAYS                         02863015
028640         PERFORM 1800-READ-PARM-RFID-VIRT-DAYS                    02864015
028700     END-IF.                                                      02870013
028800                                                                  02880013
028900                                                                  02890013
029000                                                                  02900013
029100******************************************************************02910013
029200*  READ PARM TABLE TO DETERMINE IF ALL STORES, NO STORES OR       02920013
029300*  SOME STORES ARE SCANNING.                                      02930013
029400******************************************************************02940013
029500 1100-READ-TKRPRPM-SCAN-IND.                                      02950013
029600                                                                  02960013
029700     EXEC SQL                                                     02970013
029800         SELECT  FUNC_TXT                                         02980013
029900           INTO  :PV-FUNC-TXT                                     02990013
030000           FROM  TKRPRPM                                          03000013
030100          WHERE  LOC_ID            = 90                           03010013
030200            AND  INTFC_SYS_CDE     = 'KHL'                        03020013
030300            AND  SYS_PRC_FUNC_CDE  = 'STRSCN'                     03030013
030400            AND  FUNC_PRC_STAT_CDE = 'AC'                         03040013
030500     END-EXEC.                                                    03050013
030600                                                                  03060013
030700     EVALUATE TRUE                                                03070013
030800         WHEN SQLCODE = ZERO                                      03080013
030900             IF PV-FUNC-TXT = 'A' OR 'E' OR 'N'                   03090013
031000                 DISPLAY 'STORES SCANNING OPTION = ' PV-FUNC-TXT  03100013
031100             ELSE                                                 03110013
031200                 DISPLAY 'PARA 1100-READ-TKRPRPM-SCAN-IND '       03120013
031300                         'FOUND INVALID OPTION (NOT A, E, N)'     03130013
031400                 DISPLAY 'SYS_PRC_FUNC_CDE = STRSCN'              03140013
031500                 DISPLAY 'PV-FUNC-TXT = ' PV-FUNC-TXT             03150013
031600                 DISPLAY 'DEFAULTING TO OPTION E'                 03160013
031700                 MOVE 'E' TO PV-FUNC-TXT                          03170013
031800             END-IF                                               03180013
031900         WHEN SQLCODE = +100                                      03190013
032000                 DISPLAY 'PARA 1100-READ-TKRPRPM-SCAN-IND '       03200013
032100                         'PARM NOT FOUND'                         03210013
032200                 DISPLAY 'SYS_PRC_FUNC_CDE = STRSCN'              03220013
032300                 DISPLAY 'DEFAULTING TO OPTION E'                 03230013
032400                 MOVE 'E' TO PV-FUNC-TXT                          03240013
032500         WHEN OTHER                                               03250013
032600             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          03260013
032700             MOVE  '1100-READ-TKRPRPM-SCAN-IND'                   03270013
032800                                   TO PV-ABEND-PARAGRAPH          03280013
032900             MOVE 'SYS_PRC_FUNC_CDE  = STRSCN'                    03290013
033000                                   TO PV-ABEND-OPERATION          03300013
033100             MOVE 'CHECKING STORE SCAN PARM '                     03310013
033200                                   TO PV-DB2-OPERATION-MESSAGE-1  03320013
033300             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        03330013
033400             PERFORM 9900-DB2-ABEND                               03340013
033500     END-EVALUATE.                                                03350013
033600                                                                  03360013
033700                                                                  03370013
033800******************************************************************03380013
033900*  READ INPUT CONTROL CARD TO GET THE CURRENT BATCH PROCESSING    03390013
034000*  DATE.                                                          03400013
034100******************************************************************03410013
034200 1200-READ-CONTROL-CARD.                                          03420013
034300                                                                  03430013
034400     READ BATCH-DATE-IN                                           03440013
034500         INTO PV-INPUT-FILE                                       03450013
034600             AT END                                               03460013
034700                 MOVE 'Y' TO PS-END-OF-CONTROL-SW.                03470013
034800                                                                  03480013
034900     IF PS-END-OF-CONTROL                                         03490013
035000         DISPLAY ' '                                              03500013
035100         DISPLAY ' *** NO CONTROL CARD FOUND TO PROCESS ***'      03510013
035200         DISPLAY ' '                                              03520013
035300     ELSE                                                         03530013
035400         DISPLAY 'BATCH PROCESSING CONTROL CARD DATE  = '         03540021
035410                 PIF-RUN-DATE                                     03541021
035500     END-IF.                                                      03550013
035600                                                                  03560013
035700******************************************************************03570013
035800*  READ PARM TABLE TO GET THE NUMBER OF DAYS BACK FROM THE        03580013
035900*  CURRENT BATCH PROCESS DATE THAT THE PROCESSING DATE FOR        03590013
036000*  FINDING ASSUMPTIVE CARTONS SHOULD BE SET TO.                   03600013
036100******************************************************************03610013
036200 1300-READ-TKRPRPM-DAYS.                                          03620013
036300                                                                  03630013
036400     EXEC SQL                                                     03640013
036500         SELECT  FUNC_QTY                                         03650013
036600               , DATE(DAYS(:PIF-RUN-DATE) - FUNC_QTY)             03660013
036700           INTO  :PV-ASSMPT-QTY                                   03670013
036800               , :PV-ASSMPT-DATE                                  03680013
036900           FROM  TKRPRPM                                          03690013
037000          WHERE  LOC_ID            = 90                           03700013
037100            AND  INTFC_SYS_CDE     = 'KHL'                        03710013
037200            AND  SYS_PRC_FUNC_CDE  = 'ASMPRC'                     03720013
037300            AND  FUNC_PRC_STAT_CDE = 'AC'                         03730013
037400     END-EXEC.                                                    03740013
037500                                                                  03750013
037600     EVALUATE TRUE                                                03760013
037700         WHEN SQLCODE = ZERO                                      03770013
037800             MOVE PV-ASSMPT-QTY          TO   PV-DISPLAY-QTY      03780013
037900             DISPLAY 'ASSUMPT OFFSET DAYS = ' PV-DISPLAY-QTY      03790013
038000             DISPLAY 'ASSUMPT PROCESS DATE= ' PV-ASSMPT-DATE      03800013
038100         WHEN OTHER                                               03810013
038200             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          03820013
038300             MOVE  '1300-READ-TKRPRPM-DAYS '                      03830013
038400                                   TO PV-ABEND-PARAGRAPH          03840013
038500             MOVE 'SYS_PRC_FUNC_CDE  = ASMPRC'                    03850013
038600                                   TO PV-ABEND-OPERATION          03860013
038700             MOVE 'CHECKING OFFSET DAYS PARM '                    03870013
038800                                   TO PV-DB2-OPERATION-MESSAGE-1  03880013
038900             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        03890013
039000             PERFORM 9900-DB2-ABEND                               03900013
039100     END-EVALUATE.                                                03910013
039200                                                                  03920013
039300                                                                  03930013
039400******************************************************************03940013
039500*  READ PARM TABLE TO GET THE NUMBER OF DAYS BACK FROM THE        03950013
039600*  CURRENT BATCH PROCESS DATE THAT THE PROCESSING DATE FOR        03960013
039700*  FINDING ASSUMPTIVE CARTONS ON VIRTUAL TRAILERS SHOULD BE SET   03970013
039800*  TO.                                                            03980013
039900******************************************************************03990013
040000 1400-READ-TKRPRPM-VIRTUAL-DAYS.                                  04000013
040100                                                                  04010013
040200     EXEC SQL                                                     04020013
040300         SELECT  FUNC_QTY                                         04030013
040400               , DATE(DAYS(:PIF-RUN-DATE) - FUNC_QTY)             04040013
040500           INTO  :PV-ASSMPT-VIRT-QTY                              04050013
040600               , :PV-ASSMPT-VIRT-DATE                             04060013
040700           FROM  TKRPRPM                                          04070013
040800          WHERE  LOC_ID            = 90                           04080013
040900            AND  INTFC_SYS_CDE     = 'KHL'                        04090013
041000            AND  SYS_PRC_FUNC_CDE  = 'ASMVRT'                     04100013
041100            AND  FUNC_PRC_STAT_CDE = 'AC'                         04110013
041200     END-EXEC.                                                    04120013
041300                                                                  04130013
041400     EVALUATE TRUE                                                04140013
041500         WHEN SQLCODE = ZERO                                      04150013
041600             MOVE PV-ASSMPT-VIRT-QTY     TO   PV-DISPLAY-QTY      04160013
041700             DISPLAY 'VIRTUAL OFFSET DAYS = ' PV-DISPLAY-QTY      04170013
041800             DISPLAY 'VIRTUAL PROCESS DATE= ' PV-ASSMPT-VIRT-DATE 04180013
041900         WHEN OTHER                                               04190013
042000             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04200013
042100             MOVE  '1400-READ-TKRPRPM-VIRTUAL-DAYS'               04210013
042200                                   TO PV-ABEND-PARAGRAPH          04220013
042300             MOVE 'SYS_PRC_FUNC_CDE  = ASMVRT'                    04230013
042400                                   TO PV-ABEND-OPERATION          04240013
042500             MOVE 'CHECKING VIRTUAL OFFSET DAYS PARM '            04250013
042600                                   TO PV-DB2-OPERATION-MESSAGE-1  04260013
042700             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04270013
042800             PERFORM 9900-DB2-ABEND                               04280013
042900     END-EVALUATE.                                                04290013
043000                                                                  04300013
043010                                                                  04301013
043011******************************************************************04301113
043012*  READ PARM TABLE TO GET THE NUMBER OF DAYS TO ADD TO THE        04301213
043013*  CURRENT BATCH PROCESS DATE TO DETERMINE WHAT STORES ARE        04301313
043014*  SCHEDULED FOR A PHYSICAL INVENTORY SO THAT WE CAN PERFORM      04301413
043015*  ASSUMPTIVE CARTON LOGIC FOR ADDITIONAL TRAILERS.               04301513
043018******************************************************************04301813
043020 1500-READ-PARM-SCHED-INV-DAYS.                                   04302014
043021                                                                  04302113
043022     EXEC SQL                                                     04302213
043023         SELECT  FUNC_QTY                                         04302313
043024               , DATE(DAYS(:PIF-RUN-DATE) + FUNC_QTY)             04302413
043025           INTO  :PV-SCHED-INV-QTY                                04302513
043026               , :PV-SCHED-INV-DATE                               04302613
043027           FROM  TKRPRPM                                          04302713
043028          WHERE  LOC_ID            = 90                           04302813
043029            AND  INTFC_SYS_CDE     = 'KHL'                        04302913
043030            AND  SYS_PRC_FUNC_CDE  = 'ASMPID'                     04303013
043031            AND  FUNC_PRC_STAT_CDE = 'AC'                         04303113
043032     END-EXEC.                                                    04303213
043033                                                                  04303313
043034     EVALUATE TRUE                                                04303413
043035         WHEN SQLCODE = ZERO                                      04303513
043036             MOVE PV-SCHED-INV-QTY       TO   PV-DISPLAY-QTY      04303613
043037             DISPLAY 'SCHED INV DAYS      = ' PV-DISPLAY-QTY      04303713
043038             DISPLAY 'SCHED INV DATE      = ' PV-SCHED-INV-DATE   04303813
043039         WHEN OTHER                                               04303913
043040             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04304013
043041             MOVE  '1500-READ-PARM-SCHED-INV-DAYS'                04304114
043042                                   TO PV-ABEND-PARAGRAPH          04304213
043043             MOVE 'SYS_PRC_FUNC_CDE  = ASMPID'                    04304313
043044                                   TO PV-ABEND-OPERATION          04304413
043045             MOVE 'CHECKING SCHEDULED INVENTORY DAYS PARM '       04304513
043046                                   TO PV-DB2-OPERATION-MESSAGE-1  04304613
043047             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04304713
043048             PERFORM 9900-DB2-ABEND                               04304813
043049     END-EVALUATE.                                                04304913
043050                                                                  04305013
043051******************************************************************04305113
043052*  READ PARM TABLE TO GET THE NUMBER OF DAYS TO SUBTRACT FROM THE 04305213
043053*  CURRENT BATCH PROCESS DATE TO BUILD A DATE RANGE FOR PICKING   04305313
043054*  UP ADDITIONAL TRAILERS FOR THE SCHEDULED INVENTORY STORES      04305413
043055*  BASED ON THE UNLOADED AT STORE DATE TO PERFORM THE             04305513
043056*  ASSUMPTIVE CARTON LOGIC FOR.                                   04305613
043057******************************************************************04305713
043058 1600-READ-PARM-INV-RANGE-DAYS.                                   04305814
043060                                                                  04306013
043070     EXEC SQL                                                     04307013
043080         SELECT  FUNC_QTY                                         04308013
043090               , DATE(DAYS(:PIF-RUN-DATE) - FUNC_QTY)             04309013
043091           INTO  :PV-RANGE-INV-QTY                                04309113
043092               , :PV-RANGE-INV-DATE                               04309213
043093           FROM  TKRPRPM                                          04309313
043094          WHERE  LOC_ID            = 90                           04309413
043095            AND  INTFC_SYS_CDE     = 'KHL'                        04309513
043096            AND  SYS_PRC_FUNC_CDE  = 'ASMPRM'                     04309613
043097            AND  FUNC_PRC_STAT_CDE = 'AC'                         04309713
043098     END-EXEC.                                                    04309813
043099                                                                  04309913
043100     EVALUATE TRUE                                                04310013
043101         WHEN SQLCODE = ZERO                                      04310113
043102             MOVE PV-RANGE-INV-QTY       TO   PV-DISPLAY-QTY      04310213
043103             DISPLAY 'RANGE INV DAYS      = ' PV-DISPLAY-QTY      04310313
043104             DISPLAY 'RANGE INV DATE      = ' PV-RANGE-INV-DATE   04310413
043105             DISPLAY ' '                                          04310513
043106             DISPLAY 'FOR PLANNED PHYSICAL INVENTORY STORES: '    04310613
043107             DISPLAY '  DATE RANGE 1 FOOT TRAILERS FROM '         04310713
043108                     PV-ASSMPT-VIRT-DATE ' TO '                   04310813
043109                     PV-RANGE-INV-DATE                            04310913
043110             DISPLAY ' '                                          04311013
043111             DISPLAY '  DATE RANGE GT 1 FOOT TRAILERS FROM '      04311113
043112                     PV-ASSMPT-DATE ' TO '                        04311213
043113                     PV-RANGE-INV-DATE                            04311313
043114         WHEN OTHER                                               04311413
043115             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04311513
043116             MOVE  '1600-READ-PARM-INV-RANGE-DAYS'                04311614
043117                                   TO PV-ABEND-PARAGRAPH          04311713
043118             MOVE 'SYS_PRC_FUNC_CDE  = ASMPRM'                    04311813
043119                                   TO PV-ABEND-OPERATION          04311913
043120             MOVE 'CHECKING SCHEDULED INVENTORY DAYS PARM '       04312013
043121                                   TO PV-DB2-OPERATION-MESSAGE-1  04312113
043122             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04312213
043123             PERFORM 9900-DB2-ABEND                               04312313
043124     END-EVALUATE.                                                04312413
043130                                                                  04313013
043140******************************************************************04314015
043150*  READ PARM TABLE TO GET THE NUMBER OF DAYS TO SUBTRACT FROM THE 04315015
043160*  CURRENT BATCH PROCESS DATE TO BUILD THE DATE TO BE USED FOR    04316015
043170*  PICKING UP REGULAR TRAILERS FOR RFID PILOT STORES BASED ON     04317015
043180*  THE ASMRFS PARM AND THE UNLOADED AT STORE DATE TO PERFORM      04318015
043190*  THE ASSUMPTIVE CARTON LOGIC FOR.                               04319015
043191******************************************************************04319115
043192 1700-READ-PARM-RFID-DAYS.                                        04319215
043193                                                                  04319315
043194     EXEC SQL                                                     04319415
043195         SELECT  FUNC_QTY                                         04319515
043196               , DATE(DAYS(:PIF-RUN-DATE) - FUNC_QTY)             04319615
043197           INTO  :PV-ASSMPT-RFID-QTY                              04319715
043198               , :PV-ASSMPT-RFID-DATE                             04319815
043199           FROM  TKRPRPM                                          04319915
043200          WHERE  LOC_ID            = 90                           04320015
043201            AND  INTFC_SYS_CDE     = 'KHL'                        04320115
043202            AND  SYS_PRC_FUNC_CDE  = 'ASMRFD'                     04320215
043203            AND  FUNC_PRC_STAT_CDE = 'AC'                         04320315
043204     END-EXEC.                                                    04320415
043205                                                                  04320515
043206     EVALUATE TRUE                                                04320615
043207         WHEN SQLCODE = ZERO                                      04320715
043208             MOVE PV-ASSMPT-RFID-QTY     TO   PV-DISPLAY-QTY      04320815
043209             DISPLAY ' '                                          04320915
043210             DISPLAY 'FOR RFID PILOT STORES REGULAR TRAILERS:'    04321015
043211             DISPLAY 'RFID REG TRIP DAYS  = ' PV-DISPLAY-QTY      04321115
043212             DISPLAY 'RFID REG TRIP DATE  = ' PV-ASSMPT-RFID-DATE 04321215
043220         WHEN OTHER                                               04322015
043221             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04322115
043222             MOVE  '1700-READ-PARM-RFID-DAYS'                     04322215
043223                                   TO PV-ABEND-PARAGRAPH          04322315
043224             MOVE 'SYS_PRC_FUNC_CDE  = ASMRFD'                    04322415
043225                                   TO PV-ABEND-OPERATION          04322515
043226             MOVE 'CHECKING SCHEDULED INVENTORY DAYS PARM '       04322615
043227                                   TO PV-DB2-OPERATION-MESSAGE-1  04322715
043228             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04322815
043229             PERFORM 9900-DB2-ABEND                               04322915
043230     END-EVALUATE.                                                04323015
043231                                                                  04323115
043232******************************************************************04323215
043233*  READ PARM TABLE TO GET THE NUMBER OF DAYS TO SUBTRACT FROM THE 04323315
043234*  CURRENT BATCH PROCESS DATE TO BUILD THE DATE TO BE USED FOR    04323415
043235*  PICKING UP REGULAR TRAILERS FOR RFID PILOT STORES BASED ON     04323515
043236*  THE ASMRFS PARM AND THE UNLOADED AT STORE DATE TO PERFORM      04323615
043237*  THE ASSUMPTIVE CARTON LOGIC FOR.                               04323715
043238******************************************************************04323815
043239 1800-READ-PARM-RFID-VIRT-DAYS.                                   04323915
043240                                                                  04324015
043241     EXEC SQL                                                     04324115
043242         SELECT  FUNC_QTY                                         04324215
043243               , DATE(DAYS(:PIF-RUN-DATE) - FUNC_QTY)             04324315
043244           INTO  :PV-ASSMPT-VIRT-RFID-QTY                         04324415
043245               , :PV-ASSMPT-VIRT-RFID-DATE                        04324515
043246           FROM  TKRPRPM                                          04324615
043247          WHERE  LOC_ID            = 90                           04324715
043248            AND  INTFC_SYS_CDE     = 'KHL'                        04324815
043249            AND  SYS_PRC_FUNC_CDE  = 'ASMRFV'                     04324915
043250            AND  FUNC_PRC_STAT_CDE = 'AC'                         04325015
043251     END-EXEC.                                                    04325115
043252                                                                  04325215
043253     EVALUATE TRUE                                                04325315
043254         WHEN SQLCODE = ZERO                                      04325415
043255             DISPLAY ' '                                          04325515
043256             MOVE PV-ASSMPT-VIRT-RFID-QTY TO   PV-DISPLAY-QTY     04325615
043257             DISPLAY 'FOR RFID PILOT STORES VIRTUAL TRAILERS:'    04325715
043258             DISPLAY 'RFID VIRTUAL TRIP DAYS = ' PV-DISPLAY-QTY   04325815
043259             DISPLAY 'RFID VIRTUAL TRIP DATE = '                  04325915
043260                     PV-ASSMPT-VIRT-RFID-DATE                     04326015
043262         WHEN OTHER                                               04326215
043263             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04326315
043264             MOVE  '1800-READ-PARM-RFID-VIRT-DAYS'                04326415
043265                                   TO PV-ABEND-PARAGRAPH          04326515
043266             MOVE 'SYS_PRC_FUNC_CDE  = ASMRFV'                    04326615
043267                                   TO PV-ABEND-OPERATION          04326715
043268             MOVE 'CHECKING SCHEDULED INVENTORY DAYS PARM '       04326815
043269                                   TO PV-DB2-OPERATION-MESSAGE-1  04326915
043270             MOVE 'TKRPRPM'        TO PV-ABEND-STRUCTURE-1        04327015
043271             PERFORM 9900-DB2-ABEND                               04327115
043272     END-EVALUATE.                                                04327215
043273                                                                  04327315
043280******************************************************************04328015
043300*  FIND ALL TRIP IDS ON THE TSUOBTS TABLE THAT WERE SET TO        04330013
043400*  THE 'SU' STATUS ON THE PROCESS DATE DETERMINED IN THE          04340013
043500*  INITIALIZATION PARAGRAPH.                                      04350013
043600******************************************************************04360013
043700 2000-PROCESS-TSUOBTS-TRIP-IDS.                                   04370013
043800                                                                  04380013
043900     SET PS-NOT-END-OF-TSUOBTS-CSR TO TRUE.                       04390013
044000     PERFORM 2100-OPEN-TSUOBTS-CSR.                               04400013
044100     PERFORM 2200-FETCH-TSUOBTS-CSR.                              04410013
044200     PERFORM 2300-PROCESS-TSUOBTS-CSR UNTIL                       04420013
044300             PS-END-OF-TSUOBTS-CSR.                               04430013
044400     PERFORM 2400-CLOSE-TSUOBTS-CSR.                              04440013
044500                                                                  04450013
044600                                                                  04460013
044700******************************************************************04470013
044800*  OPEN TSUOBTS TRIP ID CURSOR.                                   04480013
044900******************************************************************04490013
045000 2100-OPEN-TSUOBTS-CSR.                                           04500013
045100                                                                  04510013
045200     EXEC SQL                                                     04520013
045300         OPEN TSUOBTS-CSR                                         04530013
045400     END-EXEC.                                                    04540013
045500                                                                  04550013
045600     EVALUATE TRUE                                                04560013
045700         WHEN SQLCODE = ZERO                                      04570013
045800             CONTINUE                                             04580013
045900         WHEN OTHER                                               04590013
046000             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04600013
046100             MOVE  '2100-OPEN-TSUOBTS-CSR '                       04610013
046200                                   TO PV-ABEND-PARAGRAPH          04620013
046300             MOVE 'OPEN CURSOR '                                  04630013
046400                                   TO PV-ABEND-OPERATION          04640013
046500             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        04650013
046600             PERFORM 9900-DB2-ABEND                               04660013
046700     END-EVALUATE.                                                04670013
046800                                                                  04680013
046900                                                                  04690013
047000******************************************************************04700013
047100*  FETCH TSUOBTS TRIP ID CURSOR ROW.                              04710013
047200******************************************************************04720013
047300 2200-FETCH-TSUOBTS-CSR.                                          04730013
047400     EXEC SQL                                                     04740013
047500        FETCH TSUOBTS-CSR                                         04750013
047600         INTO  :PV-ASSUMP-REASON                                  04760023
047610             , :SUOBTS-OTBND-TRIP-ID                              04761023
047700             , :SUOBTS-OTBND-STAT-TMST                            04770013
047800             , :SUOBTS-STAT-OPER-UNT-ID                           04780013
047900             , :SUOBTR-DEST-OPER-UNT-ID                           04790013
048000     END-EXEC.                                                    04800013
048100                                                                  04810013
048200     EVALUATE TRUE                                                04820013
048300         WHEN SQLCODE = ZERO                                      04830013
048400             ADD +1 TO PV-TRIP-IDS-FETCHED                        04840013
048500         WHEN SQLCODE = +100                                      04850013
048600             SET PS-END-OF-TSUOBTS-CSR     TO  TRUE               04860013
048700         WHEN OTHER                                               04870013
048800             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          04880013
048900             MOVE  '2200-FETCH-TSUOBTS-CSR'                       04890013
049000                                   TO PV-ABEND-PARAGRAPH          04900013
049100             MOVE 'FETCH CURSOR '                                 04910013
049200                                   TO PV-ABEND-OPERATION          04920013
049300             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        04930013
049400             PERFORM 9900-DB2-ABEND                               04940013
049500     END-EVALUATE.                                                04950013
049600                                                                  04960013
049700******************************************************************04970013
049800*  PROCESS TSUOBTS TRIP ID CURSOR ROW.                            04980013
049900******************************************************************04990013
050000 2300-PROCESS-TSUOBTS-CSR.                                        05000013
050100                                                                  05010013
050110     IF  SUOBTS-OTBND-TRIP-ID  =  PV-HOLD-TRIP-ID                 05011023
050111         MOVE SUOBTS-OTBND-TRIP-ID  TO  PV-DISP-TRIP              05011124
050112         DISPLAY ' BYPASS DUPLICATE:  '  PV-DISP-TRIP             05011223
050113         ADD  1  TO  PV-BYPASS-COUNT                              05011323
050130     ELSE                                                         05013023
050140         MOVE SUOBTS-OTBND-TRIP-ID  TO  PV-HOLD-TRIP-ID           05014023
050150                                                                  05015023
050200         IF PV-FUNC-TXT = 'A'                                     05020023
050300**           ALL STORES ARE SCANNING                              05030023
050400             PERFORM 4000-CALL-STR-SCN-TABLE                      05040023
050500         ELSE                                                     05050023
050600**               EXCEPTION STORES ARE SCANNING ('E')              05060023
050700             IF  SUOBTS-STAT-OPER-UNT-ID   = PV-PREV-STORE        05070023
050800             AND SUOBTS-OTBND-TRIP-ID      = PV-PREV-TRIP-ID      05080023
050900                 IF PS-SCANNING-STORE                             05090023
051000                     PERFORM 4000-CALL-STR-SCN-TABLE              05100023
051100                 END-IF                                           05110023
051200             ELSE                                                 05120023
051300                 PERFORM 3500-CHECK-IF-SCANNING-STORE             05130023
051400                 IF PS-SCANNING-STORE                             05140023
051500                     PERFORM 4000-CALL-STR-SCN-TABLE              05150023
051600                 END-IF                                           05160023
051700                 MOVE SUOBTS-STAT-OPER-UNT-ID TO PV-PREV-STORE    05170023
051800                 MOVE SUOBTS-OTBND-TRIP-ID   TO PV-PREV-TRIP-ID   05180023
051900             END-IF                                               05190023
052000         END-IF                                                   05200023
052010     END-IF.                                                      05201023
052100                                                                  05210013
052200     PERFORM 2200-FETCH-TSUOBTS-CSR.                              05220013
052300                                                                  05230013
052400******************************************************************05240013
052500*  CLOSE TSUOBTS TRIP ID CURSOR.                                  05250013
052600******************************************************************05260013
052700 2400-CLOSE-TSUOBTS-CSR.                                          05270013
052800     EXEC SQL                                                     05280013
052900        CLOSE TSUOBTS-CSR                                         05290013
053000     END-EXEC.                                                    05300013
053100                                                                  05310013
053200     EVALUATE TRUE                                                05320013
053300         WHEN SQLCODE = ZERO                                      05330013
053400             CONTINUE                                             05340013
053500         WHEN OTHER                                               05350013
053600             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          05360013
053700             MOVE  '2400-CLOSE-TSUOBTS-CSR'                       05370013
053800                                   TO PV-ABEND-PARAGRAPH          05380013
053900             MOVE 'CLOSE CURSOR '                                 05390013
054000                                   TO PV-ABEND-OPERATION          05400013
054100             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        05410013
054200             PERFORM 9900-DB2-ABEND                               05420013
054300     END-EVALUATE.                                                05430013
054400                                                                  05440013
054500                                                                  05450013
054600******************************************************************05460013
054700*  CHECK IF SCANNING HAS BEEN TURNED ON FOR THE STORE.            05470013
054800*  ONLY STORE EXPECTED RECORDS WILL BE PROCESSED IN THIS PARA.    05480013
054900******************************************************************05490013
055000 3500-CHECK-IF-SCANNING-STORE.                                    05500013
055100                                                                  05510013
055200     MOVE SUOBTS-STAT-OPER-UNT-ID TO PV-DISPLAY-STORE.            05520013
055300     MOVE SUOBTS-OTBND-TRIP-ID    TO PV-DISPLAY-TRIP-ID.          05530013
055400                                                                  05540013
055500     EXEC SQL                                                     05550013
055600        SELECT  E.OTBND_STAT_TMST                                 05560013
055700          INTO :SUOBTS-OTBND-STAT-TMST                            05570013
055800          FROM  WST_INTGRTN_TYP   A                               05580013
055900             ,  WST_ATTR_DEFN     B                               05590013
056000             ,  WST_ATTR_ELEM     C                               05600013
056100             ,  WST_ATTR_ELEM     D                               05610013
056200             ,  TSUOBTS           E                               05620013
056300             ,  TSUOBTR           F                               05630013
056400         WHERE  C.ATTR_ELEM_NBR      = F.DEST_OPER_UNT_ID         05640013
056500           AND  A.INTGRTN_TYP_CDE    = 'STOTBNDUPD'               05650013
056600           AND  A.INTGRTN_TYP_CDE    = B.INTGRTN_TYP_CDE          05660013
056700           AND  B.ATTR_DEFN_SEQ_NBR  = 1                          05670013
056800           AND  B.INTGRTN_TYP_CDE    = C.INTGRTN_TYP_CDE          05680013
056900           AND  C.ATTR_DEFN_SEQ_NBR  = 1                          05690013
057000           AND  B.INTGRTN_TYP_CDE    = D.INTGRTN_TYP_CDE          05700013
057100           AND  D.ATTR_DEFN_SEQ_NBR  = 2                          05710013
057200           AND  C.INTGRTN_TYP_CDE    = D.INTGRTN_TYP_CDE          05720013
057300           AND  C.ATTR_ELEM_SEQ_NBR  = D.ATTR_ELEM_SEQ_NBR        05730013
057400           AND  E.OTBND_TRIP_ID      = :SUOBTS-OTBND-TRIP-ID      05740013
057500           AND  E.OTBND_TRIP_ID      = F.OTBND_TRIP_ID            05750013
057600           AND  E.TRIP_STAT_CDE      = 'DS'                       05760013
057700           AND  D.ATTR_ELEM_TMST     <= E.OTBND_STAT_TMST         05770013
057800         WITH UR                                                  05780013
057900       END-EXEC.                                                  05790013
058000                                                                  05800013
058100     EVALUATE TRUE                                                05810013
058200         WHEN SQLCODE = ZERO                                      05820013
058300              SET PS-SCANNING-STORE      TO TRUE                  05830013
058400         WHEN SQLCODE = -811                                      05840013
058500              SET PS-SCANNING-STORE      TO TRUE                  05850013
058600         WHEN SQLCODE = +100                                      05860013
058700              SET PS-NON-SCANNING-STORE  TO TRUE                  05870013
058800         WHEN SQLWARN0 NOT = SPACES                               05880013
058900         WHEN SQLCODE < ZERO                                      05890013
059000         WHEN SQLCODE > ZERO                                      05900013
059100             MOVE  SQLCODE         TO PV-DISPLAY-SQLCODE          05910013
059200             MOVE  '3500-CHECK-IF-SCANNING-STORE'                 05920013
059300                                   TO PV-ABEND-PARAGRAPH          05930013
059400             MOVE 'SELECT WST_* TABLES '                          05940013
059500                                   TO PV-ABEND-OPERATION          05950013
059600             MOVE 'TRIP ID BEING PROCESSED: '                     05960013
059700                                   TO PV-DB2-OPERATION-MESSAGE-1  05970013
059800             MOVE SUOBTS-OTBND-TRIP-ID  TO PV-DISPLAY-TRIP-ID     05980013
059900             MOVE PV-DISPLAY-TRIP-ID                              05990013
060000                                   TO PV-DB2-OPERATION-MESSAGE-2  06000013
060100             MOVE  'CHECK TO SEE IF STORE SCANS'                  06010013
060200                                   TO PV-DB2-OPERATION-MESSAGE-3  06020013
060300             MOVE 'TSUOBTS'        TO PV-ABEND-STRUCTURE-1        06030013
060400             MOVE 'TSUOBTR'        TO PV-ABEND-STRUCTURE-2        06040013
060500             PERFORM 9900-DB2-ABEND                               06050013
060600     END-EVALUATE.                                                06060013
060700                                                                  06070013
060800******************************************************************06080013
060900*  READ STORE SCAN TABLE TO SEE IF TRIP ID WAS SCANNED.           06090013
061000******************************************************************06100013
061100 4000-CALL-STR-SCN-TABLE.                                         06110013
061200                                                                  06120013
061300     MOVE SUOBTS-OTBND-TRIP-ID    TO PV-DISPLAY-TRIP-ID.          06130013
061400                                                                  06140013
061500     EXEC SQL                                                     06150013
061600        SELECT  DISTINCT SCN_LOC_NBR                              06160013
061700          INTO :SUT00121-SCN-LOC-NBR                              06170013
061800          FROM  SUT_OTBND_STR_SCN                                 06180013
061900         WHERE  SCN_OTBND_TRIP_ID    = :SUOBTS-OTBND-TRIP-ID      06190013
062000           AND  ACTV_IND             = 'Y'                        06200013
062100           AND  SCN_LOC_NBR          = :SUOBTR-DEST-OPER-UNT-ID   06210013
062200         WITH UR                                                  06220013
062300       END-EXEC.                                                  06230013
062400                                                                  06240013
062500     EVALUATE TRUE                                                06250013
062600         WHEN SQLCODE = ZERO                                      06260013
062700              INITIALIZE SU152-ASSUMPTIVE-CTN-REC                 06270013
062800              MOVE SUT00121-SCN-LOC-NBR     TO SU152-SCAN-STORE   06280013
062900              PERFORM 8000-WRITE-ASSUMPTIVE-CTN-FILE              06290013
063000         WHEN SQLCODE = +100                                      06300013
063100              INITIALIZE SU152-ASSUMPTIVE-CTN-REC                 06310013
063200              PERFORM 4500-DIVERTED-TRAILER-CHECK                 06320013
063300              PERFORM 8000-WRITE-ASSUMPTIVE-CTN-FILE              06330013
063400         WHEN SQLWARN0 NOT = SPACES                               06340013
063500         WHEN SQLCODE < ZERO                                      06350013
063600         WHEN SQLCODE > ZERO                                      06360013
063700             MOVE SQLCODE         TO PV-DISPLAY-SQLCODE           06370013
063800             MOVE '4000-CALL-STR-SCN-TABLE'                       06380013
063900                                   TO PV-ABEND-PARAGRAPH          06390013
064000             MOVE 'SELECT STR_SCN TABLE '                         06400013
064100                                   TO PV-ABEND-OPERATION          06410013
064200             MOVE 'TRIP ID BEING PROCESSED: '                     06420013
064300                                   TO PV-DB2-OPERATION-MESSAGE-1  06430013
064400             MOVE SUOBTS-OTBND-TRIP-ID  TO PV-DISPLAY-TRIP-ID     06440013
064500             MOVE PV-DISPLAY-TRIP-ID                              06450013
064600                                   TO PV-DB2-OPERATION-MESSAGE-2  06460013
064700             MOVE  'CHECK TO SEE IF TRIP ID WAS SCANNED'          06470013
064800                                   TO PV-DB2-OPERATION-MESSAGE-3  06480013
064900             MOVE 'SUT_OTBND_STR_SCN'   TO PV-ABEND-STRUCTURE-1   06490013
065000             PERFORM 9900-DB2-ABEND                               06500013
065100     END-EVALUATE.                                                06510013
065200                                                                  06520013
065300                                                                  06530013
065400******************************************************************06540013
065500*  CHECK PARM TABLE TO SEE IF TRAILER WAS DIVERTED.               06550013
065600******************************************************************06560013
065700 4500-DIVERTED-TRAILER-CHECK.                                     06570013
065800                                                                  06580013
065900     MOVE SUOBTS-OTBND-TRIP-ID    TO PV-DISPLAY-TRIP-ID.          06590013
066000                                                                  06600013
066100     EXEC SQL                                                     06610013
066200        SELECT D.ATTR_ELEM_NBR                                    06620013
066300          INTO :PV-ELEM-STORE                                     06630013
066400          FROM WST_INTGRTN_TYP A                                  06640013
066500             , WST_ATTR_DEFN   B                                  06650013
066600             , WST_ATTR_ELEM   C                                  06660013
066700             , WST_ATTR_ELEM   D                                  06670013
066800             , WST_ATTR_ELEM   E                                  06680013
066900             , WST_ATTR_ELEM   F                                  06690013
067000         WHERE A.INTGRTN_TYP_CDE   = 'TRLRDIVERT'                 06700013
067100           AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE            06710013
067200           AND B.ATTR_DEFN_SEQ_NBR = 1                            06720013
067300           AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE            06730013
067400           AND C.ATTR_DEFN_SEQ_NBR = 1                            06740013
067500           AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE            06750013
067600           AND D.ATTR_DEFN_SEQ_NBR = 2                            06760013
067700           AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE            06770013
067800           AND E.ATTR_DEFN_SEQ_NBR = 3                            06780013
067900           AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE            06790013
068000           AND F.ATTR_DEFN_SEQ_NBR = 4                            06800013
068100           AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR          06810013
068200           AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR          06820013
068300           AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR          06830013
068400           AND C.ATTR_ELEM_NBR     = :SUOBTS-OTBND-TRIP-ID        06840013
068500           AND E.ATTR_ELEM_TMST   <=  CURRENT TIMESTAMP           06850013
068600           AND F.ATTR_ELEM_TMST   >=  CURRENT TIMESTAMP           06860013
068700         WITH UR                                                  06870013
068800       END-EXEC.                                                  06880013
068900                                                                  06890013
069000     EVALUATE TRUE                                                06900013
069100         WHEN SQLCODE = ZERO                                      06910013
069110         WHEN SQLCODE = -811                                      06911025
069200** IF FOUND, MOVE PARM STORE TO SU152-SCAN-STORE                  06920013
069300              MOVE PV-ELEM-STORE           TO SU152-SCAN-STORE    06930013
069400              DISPLAY 'TRAILER WAS DIVERTED FOR TRIP ID '         06940013
069500              PV-DISPLAY-TRIP-ID ' TO STORE ' SU152-SCAN-STORE    06950013
069600         WHEN SQLCODE = +100                                      06960013
069700** IF NOT FOUND, MOVE SUOBTR-DEST-OPER-UNT-ID TO SU152-SCAN-STORE 06970013
069800              MOVE SUOBTR-DEST-OPER-UNT-ID TO SU152-SCAN-STORE    06980013
069900         WHEN SQLWARN0 NOT = SPACES                               06990013
070000         WHEN SQLCODE < ZERO                                      07000013
070100         WHEN SQLCODE > ZERO                                      07010013
070200             MOVE SQLCODE          TO PV-DISPLAY-SQLCODE          07020013
070300             MOVE '4500-DIVERTED-TRAILER-CHECK'                   07030013
070400                                   TO PV-ABEND-PARAGRAPH          07040013
070500             MOVE 'SELECT WST_* TABLES '                          07050013
070600                                   TO PV-ABEND-OPERATION          07060013
070700             MOVE 'TRIP ID BEING PROCESSED: '                     07070013
070800                                   TO PV-DB2-OPERATION-MESSAGE-1  07080013
070900             MOVE SUOBTS-OTBND-TRIP-ID  TO PV-DISPLAY-TRIP-ID     07090013
071000             MOVE PV-DISPLAY-TRIP-ID                              07100013
071100                                   TO PV-DB2-OPERATION-MESSAGE-2  07110013
071200             MOVE 'CHECK TO SEE IF TRAILER WAS DIVERTED'          07120013
071300                                   TO PV-DB2-OPERATION-MESSAGE-3  07130013
071400             PERFORM 9900-DB2-ABEND                               07140013
071500     END-EVALUATE.                                                07150013
071600                                                                  07160013
071700                                                                  07170013
071800******************************************************************07180013
071900*  WRITE ASSUMPTIVE CARTON OUTPUT FILE.                           07190013
072000******************************************************************07200013
072100 8000-WRITE-ASSUMPTIVE-CTN-FILE.                                  07210013
072200                                                                  07220013
072300     MOVE SUOBTS-OTBND-TRIP-ID     TO SU152-TRIP-ID.              07230013
072500     MOVE SUOBTR-DEST-OPER-UNT-ID  TO SU152-TRIP-STORE.           07250013
072510     MOVE PV-ASSUMP-REASON         TO SU152-ASSUMP-REASON.        07251024
072600                                                                  07260013
072700     WRITE ASSUMPTIVE-CTN-RECORD-OUT                              07270013
072800      FROM SU152-ASSUMPTIVE-CTN-REC.                              07280013
072900                                                                  07290013
073000     ADD +1 TO PV-ASSUMPTIVE-WRITE-COUNT                          07300013
073100               PV-TOTAL-WRITE-COUNT.                              07310013
073200                                                                  07320013
073300                                                                  07330013
073400******************************************************************07340013
073500*  CLOSE OUTPUT FILES.  DISPLAY COUNTS.                           07350013
073600******************************************************************07360013
073700 9000-EOJ-ROUTINE.                                                07370013
073800     CLOSE BATCH-DATE-IN                                          07380013
073900           ASSUMPTIVE-CTN-FILE-OUT.                               07390013
074000                                                                  07400013
074100     MOVE PV-TRIP-IDS-FETCHED          TO  PV-DISPLAY-COUNT.      07410013
074200     DISPLAY 'TOTAL TRIP IDS READ....: '   PV-DISPLAY-COUNT.      07420013
074300     DISPLAY '                         '.                         07430013
074400                                                                  07440013
074500     MOVE PV-BYPASS-COUNT              TO  PV-DISPLAY-COUNT.      07450023
074600     DISPLAY 'BYPASS DUPLICATE TRIP..: '   PV-DISPLAY-COUNT.      07460023
074601     DISPLAY '                         '.                         07460123
074610     MOVE PV-ASSUMPTIVE-WRITE-COUNT    TO  PV-DISPLAY-COUNT.      07461023
074620     DISPLAY 'ASSUMPTIVE RECS WRITTEN: '   PV-DISPLAY-COUNT.      07462023
074700     MOVE PV-TOTAL-WRITE-COUNT         TO  PV-DISPLAY-COUNT.      07470013
074800     DISPLAY 'TOTAL RECORDS WRITTEN..: '   PV-DISPLAY-COUNT.      07480013
074900     DISPLAY '                       '.                           07490013
075000     DISPLAY '*****  SUKUT164 ENDED  *****'.                      07500013
075100                                                                  07510013
075200                                                                  07520013
075300******************************************************************07530013
075400*  FORMAT DB2 ABEND MESSAGES AND ABEND.                           07540013
075500******************************************************************07550013
075600 9900-DB2-ABEND.                                                  07560013
075700                                                                  07570013
075800     DISPLAY '*** DB2 ERROR '.                                    07580013
075900     DISPLAY '*** SQLCODE   = ' PV-DISPLAY-SQLCODE                07590013
076000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM                  07600013
076100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               07610013
076200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               07620013
076300     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       07630013
076400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       07640013
076500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       07650013
076600     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             07660013
076700     DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.             07670013
076800                                                                  07680013
076900                                                                  07690013
077000     COPY DPPD004.                                                07700013
077100                                                                  07710013
077200     IF SQLCODE NOT = -911                                        07720013
077300         EXEC SQL                                                 07730013
077400              ROLLBACK                                            07740013
077500         END-EXEC                                                 07750013
077600     END-IF.                                                      07760013
077700                                                                  07770013
077800     MOVE +4013                  TO PV-ABEND-CODE.                07780013
077900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07790013
078000                                                                  07800013
