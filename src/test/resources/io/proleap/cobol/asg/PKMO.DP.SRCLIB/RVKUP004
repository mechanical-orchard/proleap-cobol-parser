000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.   RVKUP004.                                          00050000
000600 AUTHOR.       DENISE HAHN.                                       00060000
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                           00070000
000800 DATE-WRITTEN. FEBRUARY 2010.                                     00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  RTV - VALIDATE DEPT/SUBCLASS DETAILS                           00120000
001300*                                                                 00130000
001400*  IF INVALID DEPT/SUBCLASS PROGRAM WILL UPDATE THE FILE WITH     00140000
001500*  THE CORRECT DEPT/SUBCLASS BASED ON THE SKU NUMBER              00150000
001600******************************************************************00160000
001700* DTL FILE: SORT FIELDS=(16,10,CH,A,           SKU                00170000
001800*                        81,10,CH,A,           DEPT               00180000
001900*                        91,10,CH,A,           CLASS/SUBCLASS     00190000
002000*                        1,6,CH,A,             DFCT ORD ID        00200000
002100*                        51,9,CH,A)            RETAIL COST        00210000
002200*-----------------------------------------------------------------00220000
002300* DATE:        10/30/2011                                         00230000
002400* PROJ#:       3219  GENCO/RTV UPGRADE PROJECT                    00240000
002500* WR/IR#:      WR40134                                            00250000
002600* PROGRAMMER:  JOHN HUTCHINSON / CHRIS STRODTHOFF                 00260000
002700* DESCRIPTION: USING RV051-TO-LOC-NBR LOCATION, SELECT FROM       00270000
002800*              XLT_LOC TABLE. FORMAT REPORT FOR RTV LOCATION      00280000
002900*              AND NAME.                                          00290000
003000*-----------------------------------------------------------------00300000
003100*                                                                 00310000
003200* ----------------------------------------------------------------00320000
003300*  THERE ARE 4 RETURN TYPES                                       00330000
003400*      'C' - CALLBACKS ARE NOT PROCESSED AND COMPLETELY BYPASSED  00340000
003500*      'M' - RETURN TYPES ARE MARK-OUT-OF-STOCK                   00350000
003600*      'R' - ARE RETURN TO VENDOR                                 00360000
003700*      'D' - CAN EITHER BE DEBIT-&-DAMAGED OR DEBIT & DESTROY     00370000
003800*                                                                 00380000
003900*      'D' - RETURN TYPES ARE DIFFERENTIATED BY WHETHER THERE ARE 00390000
004000*            SHIPPING ROWS GENERATED - THE DEBIT AND              00400000
004100*            THE DEBIT & DAMAGED WILL REQUIRE THE CARR_TRKG_ID &  00410000
004200*            SHIPPING ROWS WILL BE CREATED                        00420000
004300*            THE DEBIT & DESTROY - SHOULD NOT BE A CARR-TRKG-ID   00430000
004400*            & NO SHIPPING ROWS WILL BE GENERATED.                00440000
004500*            EITHER WAY FOR 'D', THEY ARE REFERRED TO AS          00450000
004600*            'DEBIT&DISPOSE' ON THE BUSINESS SIDE.                00460000
004700*                                                                 00470000
004800*   >>>>> BELOW IS A MATRIX OF EDITS AND SPECIAL CONDITIONS <<<<< 00480000
004900*-----------------------------------------------------------------00490000
005000* INPUT FILE FLD | 'R' RET TYP    | 'M' RET TYP   | 'D' RET TYP   00500000
005100*                |                |               |               00510000
005200*________________|________________|_______________|_______________00520000
005300*DFCT-ORD-ID     |MUST BE NUMERIC                                 00530000
005400*________________|________________________________________________00540000
005500*VENDOR-DUNS-NBR |   REQRD        |  NOT REQRD    |      REQRD    00550000
005600*________________|________________|_______________|_______________00560000
005700*VEND-NAME       |VALIDATE WITH   |IF BLANK & NO  |VALIDATE WITH  00570000
005800*                |DUNS OR WARN    |DUNS, USE MSG  |DUNS OR WARN   00580000
005900*________________|________________|_______________|_______________00590000
006000*RETURN-TYPE     |MUST BE POPULATED WITH 'C', 'D', 'M' OR 'R'     00600000
006100*________________|________________________________________________00610000
006200*ORD-DTE         |S/B VALID OR BYPASS THE ENTIRE LISTING(DFCT-ORD)00620000
006300*________________|________________________________________________00630000
006400*OPER-UNT-ID     |THIS SHOULD BE 0810 FROM GENCO OR WE MOVE 0810  00640000
006500*________________|________________________________________________00650000
006600*LOC-ID          |NO EDITS - IF NULLS, MOVE SPACES.               00660000
006700*________________|________________________________________________00670000
006800*STATUS-CHG-DTE  |VALID OR BYPASS ENTIRE LISTING (DFCT-ORD-ID)    00680000
006900*________________|________________________________________________00690000
007000*DFCT-ORD-STAT-  |                                                00700000
007100*            CDE |MUST BE 'S' OR 'D' OTHERWISE BYPASS LISTING     00710000
007200*                |THIS SHOULD BE 'S' 'SHIPPED' FOR  RETURNS,      00720000
007300*                |MOS OR DEBIT&DAMAGED - THIS SHOULD BE 'D' FOR   00730000
007400*                |DEBIT&DISPOSED - THIS    IS    NOT  ENFORCED    00740000
007500*                |IN THE CODE - IT IS JUST ASSUMED GENCO GETS IT !00750000
007600*________________|________________________________________________00760000
007700*DFCT-SHIPT-ID   | THIS IS NEVER USED FROM THE INPUT, EITHER IT IS00770000
007800*                | USED FROM RVT_DFCT_SHIPT IF THE CARR-TRKG-ID & 00780000
007900*                | SCAC ARE A HIT -OR- A NEW SHIPPING ROW IS ADDED00790000
008000*                | WITH THE DFCT-SHIPT-ID A RANDOM GENERATED NBR  00800000
008100*________________|________________________________________________00810000
008200*SHIPT-DTE       |IF IT IS NOT VALID, BYPASS ENTIRE LISTING       00820000
008300*________________|________________________________________________00830000
008400*SHIPT-STAT-CDE  |WE DON'T EDIT - JUST HARD CODE AN 'S'           00840000
008500*________________|________________________________________________00850000
008600*CART-QTY        |IF NOT NUMERIC, MOVE ZERO                       00860000
008700*________________|________________________________________________00870000
008800*VND-AUTH-NBR    |'R' = MUST BE   |'M' = CAN BE   |'D' = MUST BE  00880000
008900*                | SENT & COUPLED | SPACES FROM   | SENT & COUPLED00890000
009000*                | WITH VALID     | GENCO         | WITH VALID    00900000
009100*                | VND-AUTH-DTE   |               | VND-AUTH-DTE  00910000
009200*                | OR BYPASS THE  |               | OR BYPASS THE 00920000
009300*                | ENTIRE LISTING |               | ENTIRE LISTING00930000
009400*________________|________________|_______________|_______________00940000
009500*VND-AUTH-DTE    | 'R' = MUST BE  |NO NEED TO EDIT| 'D' = MUST BE 00950000
009600*                |  VALID AND     |AS NULLS ARE   |  VALID AND    00960000
009700*                |COUPLED WITH A  |ALWAYS MOVED   |COUPLED WITH A 00970000
009800*                |VND-AUTH-NBR OR |FOR 'M'        |VND-AUTH-NBR OR00980000
009900*                |BYPASS LISTING  |               |BYPASS LISTING 00990000
010000*________________|________________________________________________01000000
010100* _SIGN  FIELDS  |(-) MEANS NEXT FIELD IS NEGATIVE, ANYTHING      01010000
010200*                | ELSE IS INTERPRETTED AS A POSITIVE             01020000
010300*________________|________________________________________________01030000
010400* _AMT  FIELDS   | EDITED FOR NUMERIC, IF NOT LOAD ZEROS          01040000
010500*________________|________________________________________________01050000
010600* WEIGHT         | EDITED FOR NUMERIC, IF NOT LOAD ZEROS          01060000
010700*________________|________________________________________________01070000
010800*RET-RSN-CDE     |MUST BE VALUE 1-9, IF NOT MOVE 9                01080000
010900*________________|________________________________________________01090000
011000*PAYT-TYP-CDE    | SHOULD BE 'P' OR 'C' FOR A RETURN-TYPE 'R', 'M'01100000
011100*                | OR ('D'  WHERE CARR_TRKG_ID IS NOT SPACES).    01110000
011200*                | SHOULD BE SPACE WHERE (RETURN-TYPE IS 'D' AND  01120000
011300*                | CARR_TRKG_ID SPACES)                           01130000
011400*                | 06/06/07 SIMPLIFY EDIT - IF ANYTHING           01140000
011500*                | 06/06/07 OTHER THAN 'P'OR'C' REPLACE WITH A 'P'01150000
011600*                | 06/06/07 NO ERROR WILL BE ISSUED TO ERR TABLE  01160000
011700*________________|________________________________________________01170000
011800*CARR-TRKG-ID    | MUST BE SENT OR|MUST BE SENT OR|DEBIT&DESTROY =01180000
011900*                | BYPASS LISTING |BYPASS LISTING |NO CARR_TRKG_ID01190000
012000*                |                |               |NO SHIPPING    01200000
012100*                |                |               |ROWS CREATED   01210000
012200*                |                |               | -----------   01220000
012300*                |                |               |DEBIT&DAMAGED =01230000
012400*                |                |               |CARR_TRKG_ID IS01240000
012500*                |                |               |REQUIRED AND   01250000
012600*                |                |               |SHIPPING ROWS  01260000
012700*                |                |               |ARE CREATED    01270000
012800*________________|________________|_______________|_______________01280000
012900*USR-ID          | IF SPACE MOVE DEFAULT 'RLOG'                   01290000
013000*________________|________________________________________________01300000
013100*TRLR-ID         |IF NULLS, MOVE SPACES                           01310000
013200*________________|________________________________________________01320000
013300*SCAC-CDE        | MUST BE VALID  | MUST BE VALID |DEBIT&DISPOSE =01330000
013400*                |KOHL'S CARRIER  |KOHL'S CARRIER |CARR_TRKG_ID,  01340000
013500*                |                |               |TRLR_ID &      01350000
013600*                |                |               |DFCT_SHIPT_ID  01360000
013700*                |                |               |SHOULD BE SPACE01370000
013800*                |                |               |FROM GENCO.THIS01380000
013900*                |                |               |IS NOT ENFORCED01390000
014000*                |                |               |IN THE CODE.   01400000
014100*________________|________________|_______________|_______________01410000
014200*VEND-ATTN-NAME  | NO EDITS.                                      01420000
014300*VEND-ADDR-DESC  |                                                01430000
014400*CITY            |                                                01440000
014500*STATE-CDE       |                                                01450000
014600*VND-EMAIL-ADDR  |                                                01460000
014700*________________|________________________________________________01470000
014800*ZIPCODE         | IF NOT NUMERIC, MOVE ZEROS.                    01480000
014900*PHN-AREA-CDE    |                                                01490000
015000*PHN-EXCH-NBR    |                                                01500000
015100*PHN-NBR         |                                                01510000
015200*FAX-PHN-AREA-CDE|                                                01520000
015300*FAX-EXCH-NBR    |                                                01530000
015400*FAX-PHN-NBR     |                                                01540000
015500*________________|________________________________________________01550000
015600*SEQ-NBR         | MUST BE NUMERIC.                               01560000
015700*________________|________________________________________________01570000
015800*SKU             |INPUT FORMAT IS FIRST 8 BYTES ARE SKU AND LAST  01580000
015900*                |2 BYTES ARE SPACES. THE ITEM NBR IS RETRIEVED   01590000
016000*                |USING KOHL'S BLACK BOX ROUTINE.                 01600000
016100*________________|________________________________________________01610000
016200*UPC             |THIS IS SENT AND ABSOLUTLY NOTHING IS EDITED OR 01620000
016300*                |DONE WITH THIS - IT IS NOT LOADED ANYWHERE      01630000
016400*                |ON THE RTV TABLES.                              01640000
016500*________________|________________________________________________01650000
016600*DFCT-RET-DTE    |EDIT FOR VALID DATE OR MOVE DEFAULT 0001-01-01. 01660000
016700*________________|________________________________________________01670000
016800*RTL-COST-AMT    | EDIT FOR NUMERIC & CANNOT BE ZERO OR BYPASS    01680000
016900*                | THE ENTIRE LISTING.                            01690000
017000*________________|________________________________________________01700000
017100*UNIT-COST-AMT   | EDIT FOR NUMERIC, IF NOT MOVE ZERO.            01710000
017200*________________|________________________________________________01720000
017300*MKOUT-ORD-ID    |SHOULD BE ZEROES FROM GENCO. THIS IS CALCULATED 01730000
017400*                |IN THE PROGRAM AND ONLY NEEDED FOR 'M' RETURNS. 01740000
017500*________________|________________________________________________01750000
017600*DEPT-NBR        | CANNOT BE BLANK FOR REGULAR OR DUMMY SKUS -    01760000
017700*                | MUST BE VALIDATED BY BLACK BOX ROUTINE OR      01770000
017800*                | IN THE CASE OF DUMMY'S - BUMPED AGAINST        01780000
017900*                | XLT_SUB_CL.                                    01790000
018000*________________|________________________________________________01800000
018100*SUB-CLASS-NBR   | CANNOT BE BLANK FOR REGULAR OR DUMMY SKUS -    01810000
018200*                | MUST BE VALIDATED BY BLACK BOX ROUTINE OR      01820000
018300*                | IN THE CASE OF DUMMY'S - BUMPED AGAINST        01830000
018400*                | XLT_SUB_CL.                                    01840000
018500*________________|________________________________________________01850000
018600*LOC-NBR         |NO EDIT CAN BE NULL. GENCO SEND THE LOC-NBR IN  01860000
018700*                |THE FIRST 4 BYTES OF A 5CHAR FIELD - THE LAST   01870000
018800*                |BYTE IS A SPACE - THIS IS DUE TO THE WAY WE SEND01880000
018900*                |IT TO THEM.                                     01890000
019000******************************************************************01900000
019100******************************************************************01910000
019200 ENVIRONMENT DIVISION.                                            01920000
019300******************************************************************01930000
019400                                                                  01940000
019500 CONFIGURATION SECTION.                                           01950000
019600                                                                  01960000
019700 SOURCE-COMPUTER.        IBM-3090.                                01970000
019800 OBJECT-COMPUTER.        IBM-3090.                                01980000
019900                                                                  01990000
020000 INPUT-OUTPUT SECTION.                                            02000000
020100                                                                  02010000
020200 FILE-CONTROL.                                                    02020000
020300                                                                  02030000
020400     SELECT RTV-DETAIL-FILE        ASSIGN TO INP01.               02040000
020500                                                                  02050000
020600     SELECT RTV-DETAIL-FILE-NEW    ASSIGN TO OUT01.               02060000
020700                                                                  02070000
020800     SELECT ERROR-REPORT           ASSIGN TO RPT01.               02080000
020900                                                                  02090000
021000******************************************************************02100000
021100 DATA DIVISION.                                                   02110000
021200******************************************************************02120000
021300                                                                  02130000
021400 FILE SECTION.                                                    02140000
021500                                                                  02150000
021600 FD  RTV-DETAIL-FILE                                              02160000
021700     RECORDING MODE IS F                                          02170000
021800     LABEL RECORDS ARE STANDARD                                   02180000
021900     BLOCK CONTAINS 0 RECORDS.                                    02190000
022000                                                                  02200000
022100 01  RTV-DETAIL-RECORD               PIC X(200).                  02210000
022200                                                                  02220000
022300 FD  RTV-DETAIL-FILE-NEW                                          02230000
022400     RECORDING MODE IS F                                          02240000
022500     LABEL RECORDS ARE STANDARD                                   02250000
022600     BLOCK CONTAINS 0 RECORDS.                                    02260000
022700                                                                  02270000
022800 01  RTV-DETAIL-RECORD-NEW           PIC X(200).                  02280000
022900                                                                  02290000
023000 FD  ERROR-REPORT                                                 02300000
023100     RECORDING MODE IS F                                          02310000
023200     LABEL RECORDS ARE STANDARD                                   02320000
023300     BLOCK CONTAINS 0 RECORDS.                                    02330000
023400                                                                  02340000
023500 01  ERROR-RPT-RECORD               PIC X(132).                   02350000
023600                                                                  02360000
023700******************************************************************02370000
023800 WORKING-STORAGE SECTION.                                         02380000
023900******************************************************************02390000
024000**  CMS 10/30/2011  BEG                                           02400000
024100***************************************************************** 02410000
024200*    CONTROL CARD INPUT                                           02420000
024300***************************************************************** 02430000
024400 01  CC-CONTROL-CARD.                                             02440000
024500     05  CC-LOC                       PIC X(04).                  02450000
024600     05  FILLER REDEFINES CC-LOC.                                 02460000
024700         10  CC-LOC-NBR               PIC 9(04).                  02470000
024800     05  FILLER                       PIC X(76).                  02480000
024900                                                                  02490000
025000**  CMS 10/30/2011  END                                           02500000
025100                                                                  02510000
025200******************************************************************02520000
025300*  COMMUNICATIONS AREA FOR DB2                                    02530000
025400******************************************************************02540000
025500     EXEC SQL                                                     02550000
025600          INCLUDE SQLCA                                           02560000
025700     END-EXEC.                                                    02570000
025800                                                                  02580000
025900******************************************************************02590000
026000*  DB2 TABLE DECLARATION - LOGISTICS - SKU.                       02600000
026100*      (XLT_SKU)                                                  02610000
026200******************************************************************02620000
026300     EXEC SQL                                                     02630000
026400          INCLUDE XLT00003                                        02640000
026500     END-EXEC.                                                    02650000
026600                                                                  02660000
026700******************************************************************02670000
026800*  DB2 TABLE DECLARATION - LOGISTICS - VENDOR SUB CLASS.          02680000
026900*      (XLT_SUB_CL).                                              02690000
027000******************************************************************02700000
027100     EXEC SQL                                                     02710000
027200          INCLUDE XLT00023                                        02720000
027300     END-EXEC.                                                    02730000
027400                                                                  02740000
027500******************************************************************02750000
027600*  DB2 TABLE DECLARATION - LOGISTICS - UPC.                       02760000
027700*      (XLT_UPC).                                                 02770000
027800******************************************************************02780000
027900     EXEC SQL                                                     02790000
028000          INCLUDE XLT00006                                        02800000
028100     END-EXEC.                                                    02810000
028200                                                                  02820000
028300******************************************************************02830000
028400*  DB2 TABLE DECLARATION - LOGISTICS - VENDOR STYLE               02840000
028500*      (XLT_VND_STYL)                                             02850000
028600******************************************************************02860000
028700     EXEC SQL                                                     02870000
028800          INCLUDE XLT00004                                        02880000
028900     END-EXEC.                                                    02890000
029000                                                                  02900000
029100**  JH  10/30/2011 BEG                                            02910000
029200******************************************************************02920000
029300*  DB2 TABLE DECLARATION                                          02930000
029400*  (XLT_LOC    - LOGISTICS LOCATION TABLE)                        02940000
029500******************************************************************02950000
029600     EXEC SQL                                                     02960000
029700         INCLUDE XLT00010                                         02970000
029800     END-EXEC.                                                    02980000
029900                                                                  02990000
030000***************************************************************** 03000000
030100**   TCOCNTL TABLE                                                03010000
030200***************************************************************** 03020000
030300     EXEC SQL                                                     03030000
030400          INCLUDE TCOCNTL                                         03040000
030500     END-EXEC.                                                    03050000
030600**  JH  10/30/2011  END                                           03060000
030700                                                                  03070000
030800******************************************************************03080000
030900* INPUT LAYOUT - RV050-GENCO-RTV-DETAIL-RECORD.                   03090000
031000******************************************************************03100000
031100     COPY RVRD051.                                                03110000
031200                                                                  03120000
031300******************************************************************03130000
031400*  DB2 FORMATTED MESSAGE AREA                                     03140000
031500******************************************************************03150000
031600     COPY DPWS004.                                                03160000
031700                                                                  03170000
031800******************************************************************03180000
031900*  COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE               03190000
032000******************************************************************03200000
032100     COPY XLWS001.                                                03210000
032200*                                                                 03220000
032300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       03230000
032400                                                   COMP SYNC.     03240000
032500 01  PA-PROGRAM-ACCUMULATORS.                                     03250000
032600     05  PA-TOTALS.                                               03260000
032700         10 PA-TOT-RECS-READ          PIC S9(09) VALUE +0 COMP-3. 03270000
032800         10 PA-TOT-DTL-RECS-READ      PIC S9(09) VALUE +0 COMP-3. 03280000
032900         10 PA-TOT-RECS-WRITTEN       PIC S9(09) VALUE +0 COMP-3. 03290000
033000                                                                  03300000
033100 01  PS-PROGRAM-SWITCHES.                                         03310000
033200     05  PS-END-OF-DTL-INPUT-SW        PIC  X(01)    VALUE 'N'.   03320000
033300         88  PS-END-OF-DTL-INPUT-YES                 VALUE 'Y'.   03330000
033400         88  PS-END-OF-DTL-INPUT-NO                  VALUE 'N'.   03340000
033500     05  PS-DEPT-CLS-VALID-SW          PIC  X(01)    VALUE 'N'.   03350000
033600         88  PS-DEPT-CLS-VALID-YES                   VALUE 'Y'.   03360000
033700         88  PS-DEPT-CLS-VALID-NO                    VALUE 'N'.   03370000
033800     05  PS-DTL-CRITICAL-ERR-SW        PIC  X(01)    VALUE 'N'.   03380000
033900         88  PS-DTL-CRITICAL-ERR-YES                 VALUE 'Y'.   03390000
034000         88  PS-DTL-CRITICAL-ERR-NO                  VALUE 'N'.   03400000
034100                                                                  03410000
034200 01  PS-ERROR-SWITCHES.                                           03420000
034300     05  PS-ERROR-TEXT                 PIC  X(35)    VALUE SPACE. 03430000
034400         88  PS-INVALID-DEPT-SUBCLASS                VALUE        03440000
034500             'INVALID DEPT/CLASS                '.                03450000
034600         88  PS-DEPT-SUBCL-NOT-MATCH-SKU             VALUE        03460000
034700             'SKU - DEPT/SUBCLASS MISMATCH      '.                03470000
034800                                                                  03480000
034900 01  PC-PROGRAM-CONSTANTS.                                        03490000
035000     05  PC-CURRENT-PROGRAM-NAME     PIC X(08)  VALUE 'RVKUP004'. 03500000
035100     05  PC-C                        PIC X(01)  VALUE 'C'.        03510000
035200     05  PC-D                        PIC X(01)  VALUE 'D'.        03520000
035300     05  PC-M                        PIC X(01)  VALUE 'M'.        03530000
035400     05  PC-R                        PIC X(01)  VALUE 'R'.        03540000
035500     05  PC-SPACE                    PIC X(01)  VALUE ' '.        03550000
035600     05  PC-DUMMY-SKU-IND            PIC X(03)  VALUE '000'.      03560000
035700     05  PC-MAX-REPORT-LINES         PIC 9(02)  VALUE 55.         03570000
035800                                                                  03580000
035900 01  PV-PROGRAM-VARIABLES.                                        03590000
036000     05  PV-ABEND-MESSAGE              PIC  X(30) VALUE SPACE.    03600000
036100     05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACE.    03610000
036200     05  PV-SQLCODE                    PIC  S9(9) VALUE ZEROES.   03620000
036300     05  PV-DB2-VIEW-NAME              PIC  X(10) VALUE SPACES.   03630000
036400     05  PV-PAGE-COUNT                 PIC  9(05) VALUE 0.        03640000
036500     05  PV-REPT-LINE-COUNT            PIC  9(02) VALUE 0.        03650000
036600     05  PV-HOLD-SKU                   PIC  X(09) VALUE SPACE.    03660000
036700     05  PV-PREV-SKU                   PIC  X(09) VALUE SPACE.    03670000
036800     05  PV-PREV-SKU-DEPT              PIC  9(04) VALUE ZEROES.   03680000
036900     05  PV-PREV-SKU-DEPT-R REDEFINES PV-PREV-SKU-DEPT.           03690000
037000         10  PV-PREV-SKU-DEPT-1        PIC  9(01).                03700000
037100         10  PV-PREV-SKU-DEPT-2-4      PIC  9(03).                03710000
037200                                                                  03720000
037300     05  PV-PREV-SKU-SUBCL             PIC  9(04) VALUE ZEROES.   03730000
037400     05  PV-PREV-SKU-SUBCL-R REDEFINES PV-PREV-SKU-SUBCL.         03740000
037500         10  PV-PREV-SKU-SUBCL-1-2     PIC  9(02).                03750000
037600         10  PV-PREV-SKU-SUBCL-3-4     PIC  9(02).                03760000
037700                                                                  03770000
037800     05  PV-HOLD-SKU-DEPT              PIC  9(03) VALUE ZEROES.   03780000
037900     05  PV-HOLD-SKU-SUBCL             PIC  9(02) VALUE ZEROES.   03790000
038000                                                                  03800000
038100     05  PV-REC-READ                   PIC  9(09) VALUE 0.        03810000
038200     05  PV-REC-WRITTEN                PIC  9(09) VALUE 0.        03820000
038300     05  PV-BAD-DEPT-SUBCLS-CNT        PIC  9(09) VALUE 0.        03830000
038400     05  PV-BAD-SKU-DEPT-SUBCLS-CNT    PIC  9(09) VALUE 0.        03840000
038500     05  PV-DISPLAY-COUNT              PIC  9(09) VALUE 0.        03850000
038600                                                                  03860000
038700     05  PV-SKU-REDEFINE.                                         03870000
038800         10 PV-INPUT-SKU-DEPT          PIC X(03) VALUE SPACE.     03880000
038900         10 PV-INPUT-SKU-CLASS         PIC X(02) VALUE SPACE.     03890000
039000         10 PV-INPUT-SKU-SEQ           PIC X(03) VALUE SPACE.     03900000
039100         10 PV-INPUT-SKU-FILLER        PIC X(02) VALUE SPACE.     03910000
039200     05  PV-DEPT-REDEFINE.                                        03920000
039300         10 PV-INPUT-DEPT-PADDING      PIC X(01) VALUE SPACE.     03930000
039400         10 PV-INPUT-DEPT              PIC X(03) VALUE SPACE.     03940000
039500         10 PV-INPUT-DEPT-FILLER       PIC X(06) VALUE SPACE.     03950000
039600     05  PV-SUBCLASS-REDEFINE.                                    03960000
039700         10 PV-INPUT-SUBCLASS-PADDING  PIC X(02) VALUE SPACE.     03970000
039800         10 PV-INPUT-SUBCLASS          PIC X(02) VALUE SPACE.     03980000
039900         10 PV-INPUT-SUBCLASS-FILLER   PIC X(06) VALUE SPACE.     03990000
040000                                                                  04000000
040100     05  PV-INPUT-DEPT-9            PIC 9(03) VALUE ZERO.         04010000
040200     05  PV-INPUT-DEPT-COMP3        PIC S9(04) COMP-3 VALUE +0.   04020000
040300     05  PV-INPUT-SUBCLASS-9        PIC 9(02) VALUE ZERO.         04030000
040400     05  PV-INPUT-SUBCLASS-COMP3    PIC S9(04) COMP-3 VALUE +0.   04040000
040500                                                                  04050000
040600     05  PV-DISP-SKU                PIC  9(08) VALUE ZEROES.      04060000
040700     05  PV-ORIG-DEPT               PIC  9(03) VALUE ZEROES.      04070000
040800     05  PV-ORIG-SUBCLS             PIC  9(02) VALUE ZEROES.      04080000
040900     05  PV-NEW-DEPT                PIC  9(03) VALUE ZEROES.      04090000
041000     05  PV-NEW-SUBCLS              PIC  9(02) VALUE ZEROES.      04100000
041100**  JH  10/30/2011 BEG                                            04110000
041200     05  PV-LOC-NBR                 PIC  S9(04) VALUE +0 COMP.    04120000
041300     05  PV-LOC-NBR-DISPLAY         PIC   9(04).                  04130000
041400     05  PV-PD-DTE.                                               04140000
041500         10  PV-PD-CY               PIC  9(04)  VALUE ZERO.       04150000
041600         10  FILLER                 PIC  X(01).                   04160000
041700         10  PV-PD-MM               PIC  9(02)  VALUE ZERO.       04170000
041800         10  FILLER                 PIC  X(01).                   04180000
041900         10  PV-PD-DD               PIC  9(02)  VALUE ZERO.       04190000
042000**  JH  10/30/2011 END                                            04200000
042100                                                                  04210000
042200 01  PV-ABEND-VARIABLES.                                          04220000
042300     05  PV-ABEND-CODE              PIC  S9(04) VALUE +0 COMP.    04230000
042400**  JH  10/30/2011 BEG                                            04240000
042500     05  PV-ABEND-LOC               PIC  X(10) VALUE SPACE.       04250000
042600     05  PV-ABEND-DEPT              PIC  X(10) VALUE SPACE.       04260000
042700     05  PV-ABEND-SKU               PIC  X(10) VALUE SPACE.       04270000
042800     05  PV-ABEND-SUBCL             PIC  X(10) VALUE SPACE.       04280000
042900**  JH  10/30/2011 END                                            04290000
043000                                                                  04300000
043100***  SYSTEM DATE VARIABLES                                        04310000
043200 01  SD-SYSTEM-DATE.                                              04320000
043300     05  SD-SYSTEM-CCYY              PIC  9(04)  VALUE ZEROS.     04330000
043400     05  SD-SYSTEM-MONTH             PIC  9(02)  VALUE ZEROS.     04340000
043500     05  SD-SYSTEM-DAY               PIC  9(02)  VALUE ZEROS.     04350000
043600                                                                  04360000
043700***  SYSTEM TIME VARIABLES                                        04370000
043800 01  ST-SYSTEM-TIME.                                              04380000
043900     05  ST-SYSTEM-HOUR              PIC  9(02)  VALUE ZEROS.     04390000
044000     05  ST-SYSTEM-MINUTE            PIC  9(02)  VALUE ZEROS.     04400000
044100                                                                  04410000
044200***  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT               04420000
044300     COPY DPWS132.                                                04430000
044400                                                                  04440000
044500***  CALENDAR ROUTINE COPYBOOK                                    04450000
044600     COPY DPWS500.                                                04460000
044700                                                                  04470000
044800                                                                  04480000
044900***  REPORT HEADING AND DETAIL LINES                              04490000
045000 01  PH2-PAGE-HEADING-2.                                          04500000
045100     05  FILLER                          PIC  X(42)  VALUE SPACE. 04510000
045200     05  FILLER                          PIC  X(49)  VALUE        04520000
045300         'RETURNS   - SKU DEPT/SUBCLS MISMATCH ERROR REPORT'.     04530000
045400     05  FILLER                          PIC  X(41)  VALUE SPACE. 04540000
045500                                                                  04550000
045600 01  PH3-PAGE-HEADING-3.                                          04560000
045700     05  FILLER                          PIC  X(54)  VALUE SPACE. 04570000
045800     05  FILLER                          PIC  X(16)  VALUE        04580000
045900         'PROCESSING DATE '.                                      04590000
046000**  JH  10/30/2011  BEG                                           04600000
046100     05  PH3-DATE.                                                04610000
046200         10  PH3-DATE-MM                 PIC  9(2).               04620000
046300         10  FILLER                      PIC  X      VALUE '/'.   04630000
046400         10  PH3-DATE-DD                 PIC  9(2).               04640000
046500         10  FILLER                      PIC  X      VALUE '/'.   04650000
046600         10  PH3-DATE-CCYY               PIC  9(4).               04660000
046700     05  FILLER                          PIC  X(52)  VALUE SPACE. 04670000
046800                                                                  04680000
046900 01  PH4-PAGE-HEADING-4.                                          04690000
047000     05  FILLER                          PIC  X(17)  VALUE        04700000
047100         '  RTV LOCATION:  '.                                     04710000
047200     05  PH4-RTV-LOC                     PIC  X(06).              04720000
047300     05  FILLER                          PIC  X(02)  VALUE SPACE. 04730000
047400     05  PH4-RTV-NAME                    PIC  X(10).              04740000
047500**  JH  10/30/2011 END                                            04750000
047600                                                                  04760000
047700 01  DH1-DETAIL-HEADING-1.                                        04770000
047800     05  FILLER                          PIC  X(04)  VALUE SPACE. 04780000
047900     05  FILLER                          PIC  X(06)  VALUE        04790000
048000         'DEFECT'.                                                04800000
048100     05  FILLER                          PIC  X(09)  VALUE SPACE. 04810001
048110     05  FILLER                          PIC  X(04)  VALUE        04811001
048120         'SEQ.'.                                                  04812001
048200     05  FILLER                          PIC  X(04)  VALUE SPACE. 04820001
048610     05  FILLER                          PIC  X(06)  VALUE        04861001
048620         'RETURN'.                                                04862001
048700     05  FILLER                          PIC  X(04)  VALUE SPACE. 04870000
048800     05  FILLER                          PIC  X(12)  VALUE        04880000
048900         'ORDER DATE /'.                                          04890000
049000     05  FILLER                          PIC  X(09)  VALUE SPACE. 04900000
049100     05  FILLER                          PIC  X(03)  VALUE 'SUB'. 04910000
049200     05  FILLER                          PIC  X(16)  VALUE SPACE. 04920000
049300     05  FILLER                          PIC  X(16)  VALUE        04930000
049400         '**CORRECTED**'.                                         04940000
049500     05  FILLER                          PIC  X(28)  VALUE SPACE. 04950000
049600                                                                  04960000
049700 01  DH2-DETAIL-HEADING-2.                                        04970000
049800     05  FILLER                          PIC  X(04)  VALUE SPACE. 04980000
049900     05  FILLER                          PIC  X(06)  VALUE        04990000
050000         'ORD ID'.                                                05000000
050100     05  FILLER                          PIC  X(09)  VALUE SPACE. 05010001
050200     05  FILLER                          PIC  X(03)  VALUE        05020001
050300         'NBR'.                                                   05030001
050400     05  FILLER                          PIC  X(06)  VALUE SPACE. 05040001
050500     05  FILLER                          PIC  X(04)  VALUE        05050000
050600         'TYPE'.                                                  05060000
050700     05  FILLER                          PIC  X(04)  VALUE SPACE. 05070000
050800     05  FILLER                          PIC  X(11)  VALUE        05080000
050900         'RETURN DATE'.                                           05090000
051000     05  FILLER                          PIC  X(04)  VALUE SPACE. 05100000
051100     05  FILLER                          PIC  X(04)  VALUE        05110000
051200         'DEPT'.                                                  05120000
051300     05  FILLER                          PIC  X(02)  VALUE SPACE. 05130000
051400     05  FILLER                          PIC  X(05)  VALUE        05140000
051500         'CLASS'.                                                 05150000
051600     05  FILLER                          PIC  X(04)  VALUE SPACE. 05160000
051700     05  FILLER                          PIC  X(03)  VALUE 'SKU'. 05170000
051800     05  FILLER                          PIC  X(09)  VALUE SPACE. 05180000
051900     05  FILLER                          PIC  X(04)  VALUE        05190000
052000         'DEPT'.                                                  05200000
052100     05  FILLER                          PIC  X(02)  VALUE SPACE. 05210000
052200     05  FILLER                          PIC  X(06)  VALUE        05220000
052300         'SUB CL'.                                                05230000
052400     05  FILLER                          PIC  X(06)  VALUE SPACE. 05240000
052500     05  FILLER                          PIC  X(13)  VALUE        05250000
052600         'ERROR MESSAGE'.                                         05260000
052700     05  FILLER                          PIC  X(11)  VALUE SPACE. 05270000
052800                                                                  05280000
052900 01  DH3-DETAIL-HEADING-3.                                        05290000
053000     05  FILLER                          PIC  X(132) VALUE        05300000
053100                                                       ALL '-'.   05310000
053200 01  DL2-DETAIL-LINE-DTL.                                         05320000
053300     05  FILLER                          PIC  X(02)  VALUE SPACE. 05330000
053400     05  DL2-ORD-ID-X.                                            05340000
053500         10  DL2-ORD-ID-9                PIC  Z(12).              05350000
053600     05  FILLER                          PIC  X(02)  VALUE SPACE. 05360000
053700     05  DL2-SEQ-NBR-X.                                           05370000
053800         10  DL2-SEQ-NBR-9               PIC  ZZZZ9.              05380000
053900     05  FILLER                          PIC  X(08)  VALUE SPACE. 05390000
054000     05  DL2-RETURN-TYPE                 PIC  X(01)  VALUE SPACE. 05400000
054100     05  FILLER                          PIC  X(06)  VALUE SPACE. 05410000
054200     05  DL2-RETURN-DATE                 PIC  X(10)  VALUE SPACE. 05420000
054300     05  FILLER                          PIC  X(06)  VALUE SPACE. 05430000
054400     05  DL2-DEPT                        PIC  X(03)  VALUE SPACE. 05440000
054500     05  FILLER                          PIC  X(04)  VALUE SPACE. 05450000
054600     05  DL2-SUB-CLASS                   PIC  X(02)  VALUE SPACE. 05460000
054700     05  FILLER                          PIC  X(03)  VALUE SPACE. 05470000
054800     05  DL2-SKU                         PIC  X(08)  VALUE SPACE. 05480000
054900     05  FILLER                          PIC  X(07)  VALUE SPACE. 05490000
055000     05  DL2-NEW-DEPT                    PIC  9(03)  VALUE ZERO.  05500000
055100     05  FILLER                          PIC  X(03)  VALUE SPACE. 05510000
055200     05  DL2-NEW-SUBCLASS                PIC  9(02)  VALUE ZERO.  05520000
055300     05  FILLER                          PIC  X(06)  VALUE SPACE. 05530000
055400     05  DL2-ERROR-MSG                   PIC  X(37)  VALUE SPACE. 05540000
055500                                                                  05550000
055600 01  BLANK-LINE.                                                  05560000
055700     05  FILLER                          PIC  X(132) VALUE SPACE. 05570000
055800                                                                  05580000
055900 01  END-OF-REPORT-LINE.                                          05590000
056000     05  FILLER                          PIC  X(54)  VALUE SPACE. 05600000
056100     05  FILLER                          PIC  X(25)  VALUE        05610000
056200         '***** END OF REPORT *****'.                             05620000
056300     05  FILLER                          PIC  X(53)  VALUE SPACE. 05630000
056400                                                                  05640000
056500                                                                  05650000
056600******************************************************************05660000
056700 LINKAGE SECTION.                                                 05670000
056800******************************************************************05680000
056900                                                                  05690000
057000******************************************************************05700000
057100 PROCEDURE DIVISION.                                              05710000
057200******************************************************************05720000
057300******************************************************************05730000
057400*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *05740000
057500******************************************************************05750000
057600 0000-PROGRAM-MAINLINE.                                           05760000
057700                                                                  05770000
057800     DISPLAY '************ START OF RVKUP004 ***************'     05780000
057900                                                                  05790000
058000     PERFORM 1000-INITIALIZE.                                     05800000
058100                                                                  05810000
058200     PERFORM 2000-PROCESS-DETAIL                                  05820000
058300             UNTIL PS-END-OF-DTL-INPUT-YES.                       05830000
058400                                                                  05840000
058500     PERFORM 8000-EOJ-ROUTINE.                                    05850000
058600                                                                  05860000
058700     DISPLAY '************  END OF RVKUP004  ***************'     05870000
058800**  JH  10/30/2011  BEG                                           05880000
058900     GOBACK.                                                      05890000
059000**  JH  10/30/2011  END                                           05900000
059100                                                                  05910000
059200                                                                  05920000
059300******************************************************************05930000
059400* INITIALIZE VARIABLES.                                           05940000
059500* OPEN INPUT FILES.                                               05950000
059600* DO A PRIME READ FOR THE DTL FILE                                05960000
059700******************************************************************05970000
059800                                                                  05980000
059900 1000-INITIALIZE.                                                 05990000
060000**  JH  10/30/2011  BEG                                           06000000
060100     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           06010000
060200     PERFORM 1100-VALIDATE-CONTOL-CARD.                           06020000
060300                                                                  06030000
060400     PERFORM 5000-SELECT-TCOCNTL.                                 06040000
060500                                                                  06050000
060600     MOVE COCNTL-BTCH-PRC-DTE TO PV-PD-DTE.                       06060000
060700                                                                  06070000
060800     MOVE PV-PD-MM TO PH3-DATE-MM.                                06080000
060900     MOVE PV-PD-DD TO PH3-DATE-DD.                                06090000
061000     MOVE PV-PD-CY TO PH3-DATE-CCYY.                              06100000
061100                                                                  06110000
061200**  JH  10/30/2011  END                                           06120000
061300                                                                  06130000
061400     OPEN INPUT  RTV-DETAIL-FILE                                  06140000
061500          OUTPUT RTV-DETAIL-FILE-NEW                              06150000
061600                 ERROR-REPORT.                                    06160000
061700                                                                  06170000
061800     SET PS-DTL-CRITICAL-ERR-NO TO TRUE.                          06180000
061900                                                                  06190000
062000     MOVE FUNCTION CURRENT-DATE (1:8) TO SD-SYSTEM-DATE.          06200000
062100     MOVE FUNCTION CURRENT-DATE (9:6) TO ST-SYSTEM-TIME.          06210000
062200                                                                  06220000
062300     MOVE SD-SYSTEM-CCYY   TO DP132-RUN-YEAR.                     06230000
062400     MOVE SD-SYSTEM-MONTH  TO DP132-RUN-MONTH.                    06240000
062500     MOVE SD-SYSTEM-DAY    TO DP132-RUN-DAY.                      06250000
062600                                                                  06260000
062700     MOVE ST-SYSTEM-HOUR   TO DP132-RUN-HOUR.                     06270000
062800     MOVE ST-SYSTEM-MINUTE TO DP132-RUN-MINUTE.                   06280000
062900                                                                  06290000
063000     MOVE 'RVKUP004'       TO DP132-PROGRAM-NAME.                 06300000
063100     MOVE 1                TO DP132-REPORT-NUMBER.                06310000
063200                                                                  06320000
063300**  JH  10/30/2011 BEG                                            06330000
063400**   PERFORM 4000-WRITE-PAGE-HEADING.                             06340000
063500**  JH  10/30/2011 END                                            06350000
063600                                                                  06360000
063700**PRIME READ OF DTL FILE                                          06370000
063800                                                                  06380000
063900     PERFORM 6001-READ-RTV-DTL-FILE.                              06390000
064000                                                                  06400000
064100**  CMS 10/30/2011 BEG                                            06410000
064200     IF RV051-TO-LOC-NBR IS NUMERIC AND                           06420000
064300        RV051-TO-LOC-NBR IS GREATER THAN ZERO                     06430000
064400         MOVE RV051-TO-LOC-NBR TO PV-LOC-NBR                      06440000
064500     ELSE                                                         06450000
064600         MOVE CC-LOC           TO PV-LOC-NBR                      06460000
064700     END-IF.                                                      06470000
064800     MOVE PV-LOC-NBR           TO PV-LOC-NBR-DISPLAY.             06480000
064900**  CMS 10/30/2011 END                                            06490000
065000                                                                  06500000
065100**  JH  10/30/2011 BEG                                            06510000
065200     PERFORM 6030-VALIDATE-LOCATION.                              06520000
065300                                                                  06530000
065400     PERFORM 4000-WRITE-PAGE-HEADING.                             06540000
065500**  JH  10/30/2011 END                                            06550000
065600                                                                  06560000
065700**   CMS 10/30/2011  BEG                                          06570000
065800 1100-VALIDATE-CONTOL-CARD.                                       06580000
065900     IF CC-LOC-NBR IS NOT NUMERIC                                 06590000
066000         DISPLAY '** ABEND **'                                    06600000
066100         DISPLAY '** PARAGRAPH '                                  06610000
066200                 '= 1100-VALIDATE-CONTOL-CARD **'                 06620000
066300         DISPLAY '** INVALID LOC NBR IN CONTROL CARD **'          06630000
066400         MOVE +4003 TO PV-ABEND-CODE                              06640000
066500         CALL 'ILBOABN0' USING PV-ABEND-CODE                      06650000
066600     END-IF.                                                      06660000
066700**   CMS 10/30/2011  END                                          06670000
066800                                                                  06680000
066900******************************************************************06690000
067000*                                                                *06700000
067100******************************************************************06710000
067200 2000-PROCESS-DETAIL.                                             06720000
067300                                                                  06730000
067400     PERFORM  2100-EDIT-DTL-REC.                                  06740000
067500                                                                  06750000
067600     PERFORM 6020-WRITE-RTV-DTL-NEW.                              06760000
067700                                                                  06770000
067800     PERFORM 6001-READ-RTV-DTL-FILE.                              06780000
067900                                                                  06790000
068000                                                                  06800000
068100******************************************************************06810000
068200* EDIT THE DETAIL REC                                             06820000
068300******************************************************************06830000
068400 2100-EDIT-DTL-REC.                                               06840000
068500                                                                  06850000
068600                                                                  06860000
068700     IF  RV051-DTL-RETURN-TYPE =  PC-M OR                         06870000
068800         RV051-DTL-RETURN-TYPE =  PC-R OR                         06880000
068900         RV051-DTL-RETURN-TYPE =  PC-D                            06890000
069000         PERFORM 2150-CHECK-NUMERIC                               06900000
069100     END-IF.                                                      06910000
069200                                                                  06920000
069300                                                                  06930000
069400******************************************************************06940000
069500* NUMERIC EDITS                                                   06950000
069600******************************************************************06960000
069700 2150-CHECK-NUMERIC.                                              06970000
069800                                                                  06980000
069900** DFCT-ORD-ID MUST BE > 0                                        06990000
070000** DFCT-ORD-ID MUST NUMERIC                                       07000000
070100** SEQ-NBR MUST BE > 0                                            07010000
070200** SEQ-NBR MUST BE NUMERIC                                        07020000
070300** SKU CANNOT BE BLANK                                            07030000
070400                                                                  07040000
070500     IF  RV051-DFCT-ORD-ID = 0            OR                      07050000
070600         RV051-DFCT-ORD-ID NOT NUMERIC    OR                      07060000
070700         RV051-SEQ-NBR = 0                OR                      07070000
070800         RV051-SEQ-NBR NOT NUMERIC        OR                      07080000
070900         RV051-SKU EQUAL PC-SPACE                                 07090000
071000         CONTINUE                                                 07100000
071100     ELSE                                                         07110000
071200        PERFORM 2200-CHECK-DUMMY-SKU                              07120000
071300     END-IF.                                                      07130000
071400                                                                  07140000
071500                                                                  07150000
071600******************************************************************07160000
071700* SKU CAN BE A DUMMY (LAST THREE SKU DIGITS ARE ZEROES)           07170000
071800******************************************************************07180000
071900 2200-CHECK-DUMMY-SKU.                                            07190000
072000                                                                  07200000
072100     MOVE RV051-SKU TO PV-SKU-REDEFINE                            07210000
072200     IF  PV-INPUT-SKU-SEQ = PC-DUMMY-SKU-IND                      07220000
072300         CONTINUE                                                 07230000
072400     ELSE                                                         07240000
072500         PERFORM 2325-VALIDATE-SKU                                07250000
072600         IF  XL001-SKU-SQLCODE = +100                             07260000
072700             CONTINUE                                             07270000
072800         ELSE                                                     07280000
072900                                                                  07290000
073000**  VALIDATE DEPT-CLASS                                           07300000
073100**    !!!!!!!!!   IMPORTANT NOTE: !!!!!!!!!!!!!!!                 07310000
073200*     EVEN THOUGH SAYS "CLASS", IT IS REALLY LOADED WITH THE      07320000
073300*     SUB CLASS.                                                  07330000
073400*     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!                 07340000
073500             PERFORM 2315-VALIDATE-DEPT-CLS                       07350000
073600                                                                  07360000
073700         END-IF                                                   07370000
073800     END-IF.                                                      07380000
073900                                                                  07390000
074000                                                                  07400000
074100******************************************************************07410000
074200* VALIDATE THE DUMMY SKU DEPT AND SUBCLASS SENT FROM GENCO - WE  *07420000
074300* SEND THEM THE DATA AND THEY S/B SENDING IT BACK - BUT VALIDATE *07430000
074400* THEIR FORMATTING AND ACCURACY.                                 *07440000
074500******************************************************************07450000
074600 2315-VALIDATE-DEPT-CLS.                                          07460000
074700                                                                  07470000
074800     SET PS-DEPT-CLS-VALID-NO TO TRUE.                            07480000
074900                                                                  07490000
075000**THIS REFORMATTING PARSES THE DEPT FROM CHAR10, THEN MOVES       07500000
075100**CHAR03 TO NUM03, THEN MOVES NUM03 TO COMP3.                     07510000
075200     MOVE RV051-DEPT-NBR          TO PV-DEPT-REDEFINE.            07520000
075300     MOVE PV-INPUT-DEPT           TO PV-INPUT-DEPT-9.             07530000
075400     MOVE PV-INPUT-DEPT-9         TO PV-INPUT-DEPT-COMP3.         07540000
075500                                                                  07550000
075600**THIS REFORMATTING PARSES THE SUBCLASS FROM CHAR10, THEN MOVES   07560000
075700**CHAR02 TO NUM02, THEN MOVES NUM02 TO COMP3.                     07570000
075800     MOVE RV051-SUB-CLASS-NBR     TO PV-SUBCLASS-REDEFINE.        07580000
075900     MOVE PV-INPUT-SUBCLASS       TO PV-INPUT-SUBCLASS-9.         07590000
076000     MOVE PV-INPUT-SUBCLASS-9     TO PV-INPUT-SUBCLASS-COMP3.     07600000
076100                                                                  07610000
076200                                                                  07620000
076300     EXEC SQL                                                     07630000
076400         SELECT  DEPT_NBR                                         07640000
076500              ,  SUB_CL_NBR                                       07650000
076600           INTO  :XLT00023-DEPT-NBR                               07660000
076700              ,  :XLT00023-SUB-CL-NBR                             07670000
076800         FROM  XLT_SUB_CL                                         07680000
076900          WHERE (DEPT_NBR   =  :PV-INPUT-DEPT-COMP3               07690000
077000            AND  SUB_CL_NBR =  :PV-INPUT-SUBCLASS-COMP3)          07700000
077100     END-EXEC.                                                    07710000
077200                                                                  07720000
077300     EVALUATE TRUE                                                07730000
077400         WHEN SQLCODE = +0                                        07740000
077500         WHEN SQLCODE = -811                                      07750000
077600              SET PS-DEPT-CLS-VALID-YES TO TRUE                   07760000
077700              PERFORM 2340-CHECK-SKU-DEPT-CLASS                   07770000
077800         WHEN SQLCODE = +100                                      07780000
077900              SET PS-INVALID-DEPT-SUBCLASS  TO  TRUE              07790000
078000              PERFORM 2330-GET-CORRECT-DEPT-SUBCLS                07800000
078100                                                                  07810000
078200         WHEN SQLWARN0 NOT EQUAL SPACE                            07820000
078300         WHEN SQLCODE NOT EQUAL ZERO                              07830000
078400             DISPLAY '******************************************' 07840000
078500             DISPLAY '** ABEND                                **' 07850000
078600             DISPLAY '** PROGRAM = RVKUP004                   **' 07860000
078700             DISPLAY '** PARAGRAPH = 2315-VALIDATE-DEPT-CLS   **' 07870000
078800             DISPLAY '** DEPT_NBR   =  '  XLT00023-DEPT-NBR       07880000
078900             DISPLAY '** SUB_CL_NBR =  '  XLT00023-SUB-CL-NBR     07890000
079000             DISPLAY '** CHECKING DUMMY SKU DEPT & SUBCLASS   **' 07900000
079100             DISPLAY '******************************************' 07910000
079200             PERFORM 9100-SQL-ABEND                               07920000
079300     END-EVALUATE.                                                07930000
079400                                                                  07940000
079500                                                                  07950000
079600******************************************************************07960000
079700* CALL MODULE XLKUT001 TO VALIDATE THE SKU AND GET DEPT, SUB CLASS07970000
079800******************************************************************07980000
079900 2325-VALIDATE-SKU.                                               07990000
080000                                                                  08000000
080100     INITIALIZE XL001-ITEM-COMMAREA.                              08010000
080200                                                                  08020000
080300     MOVE RV051-SKU (1:8)      TO XL001-KEY-SKU.                  08030000
080400                                                                  08040000
080500     SET  XL001-BY-NUMERIC-SKU                                    08050000
080600          XL001-SELECT-SKU TO TRUE.                               08060000
080700                                                                  08070000
080800     CALL XL001-VSM-PGM USING  XL001-ITEM-COMMAREA.               08080000
080900                                                                  08090000
081000     EVALUATE TRUE                                                08100000
081100                                                                  08110000
081200      WHEN XL001-SKU-SQLCODE = +0                                 08120000
081300        CONTINUE                                                  08130000
081400                                                                  08140000
081500      WHEN XL001-SKU-SQLCODE = +100                               08150000
081600        CONTINUE                                                  08160000
081700                                                                  08170000
081800      WHEN XL001-SKU-CONTENTION                                   08180000
081900        MOVE '2325-VALIDATE-SKU'                                  08190000
082000                               TO PV-PARAGRAPH-NAME               08200000
082100        MOVE 'XL001-SKU-CONTENTION'                               08210000
082200                               TO PV-ABEND-MESSAGE                08220000
082300        MOVE XL001-SKU-SQLCODE TO PV-SQLCODE                      08230000
082400        MOVE 'XLV_SKU'         TO PV-DB2-VIEW-NAME                08240000
082500        PERFORM 9100-SQL-ABEND                                    08250000
082600                                                                  08260000
082700      WHEN OTHER                                                  08270000
082800        MOVE '2325-VALIDATE-SKU'                                  08280000
082900                               TO PV-PARAGRAPH-NAME               08290000
083000        MOVE 'SELECT ROW FROM XLV_SKU'                            08300000
083100                               TO PV-ABEND-MESSAGE                08310000
083200        MOVE XL001-SKU-SQLCODE TO PV-SQLCODE                      08320000
083300        MOVE 'XLV_SKU'         TO PV-DB2-VIEW-NAME                08330000
083400        PERFORM 9100-SQL-ABEND                                    08340000
083500                                                                  08350000
083600     END-EVALUATE.                                                08360000
083700                                                                  08370000
083800                                                                  08380000
083900******************************************************************08390000
084000* GET THE CORRECT DEPT/SUBCLS USING THE SKU                      *08400000
084100******************************************************************08410000
084200 2330-GET-CORRECT-DEPT-SUBCLS.                                    08420000
084300                                                                  08430000
084400     MOVE  RV051-SKU (1:8)     TO  XLT00003-SKU-NBR.              08440000
084500                                                                  08450000
084600     EXEC SQL                                                     08460000
084700         SELECT  B.DEPT_NBR                                       08470000
084800              ,  B.SUB_CL_NBR                                     08480000
084900           INTO  :XLT00004-DEPT-NBR                               08490000
085000              ,  :XLT00004-SUB-CL-NBR                             08500000
085100           FROM  XLT_SKU  A                                       08510000
085200              ,  XLT_VND_STYL  B                                  08520000
085300          WHERE  A.SKU_NBR  =  :XLT00003-SKU-NBR                  08530000
085400            AND  A.STYL_ID  =   B.STYL_ID                         08540000
085500     END-EXEC.                                                    08550000
085600                                                                  08560000
085700     EVALUATE TRUE                                                08570000
085800         WHEN SQLCODE = +0                                        08580000
085900              MOVE  XLT00003-SKU-NBR        TO PV-DISP-SKU        08590000
086000              MOVE  PV-INPUT-DEPT-COMP3     TO PV-ORIG-DEPT       08600000
086100              MOVE  PV-INPUT-SUBCLASS-COMP3 TO PV-ORIG-SUBCLS     08610000
086200              MOVE  XLT00004-DEPT-NBR       TO PV-NEW-DEPT        08620000
086300              MOVE  XLT00004-SUB-CL-NBR     TO PV-NEW-SUBCLS      08630000
086400                                                                  08640000
086500***           DISPLAY                                             08650000
086600***               ' DEFECT: '        RV051-DFCT-ORD-ID            08660000
086700***               '  SEQ: '          RV051-SEQ-NBR                08670000
086800***               '  SKU: '          PV-DISP-SKU                  08680000
086900***               '  ORIG DEPT: '    PV-ORIG-DEPT                 08690000
087000***               '  ORIG SUBCLS: '  PV-ORIG-SUBCLS               08700000
087100***               '  NEW DEPT: '     PV-NEW-DEPT                  08710000
087200***               '  NEW SUBCLS: '   PV-NEW-SUBCLS                08720000
087300                                                                  08730000
087400             MOVE XLT00004-DEPT-NBR     TO DL2-NEW-DEPT           08740000
087500             MOVE XLT00004-SUB-CL-NBR   TO DL2-NEW-SUBCLASS       08750000
087600             MOVE XLT00004-DEPT-NBR     TO PV-HOLD-SKU-DEPT       08760000
087700             MOVE XLT00004-SUB-CL-NBR   TO PV-HOLD-SKU-SUBCL      08770000
087800                                                                  08780000
087900             PERFORM 2400-MOVE-DTL-TO-DETAIL-LINE2                08790000
088000                                                                  08800000
088100             MOVE  PV-HOLD-SKU-DEPT     TO  PV-INPUT-DEPT         08810000
088200             MOVE  PV-HOLD-SKU-SUBCL    TO  PV-INPUT-SUBCLASS     08820000
088300             MOVE  PV-DEPT-REDEFINE     TO  RV051-DEPT-NBR        08830000
088400             MOVE  PV-SUBCLASS-REDEFINE TO  RV051-SUB-CLASS-NBR   08840000
088500                                                                  08850000
088600             ADD  1  TO  PV-BAD-DEPT-SUBCLS-CNT                   08860000
088700                                                                  08870000
088800         WHEN SQLCODE = +100                                      08880000
088900              CONTINUE                                            08890000
089000                                                                  08900000
089100         WHEN SQLWARN0 NOT EQUAL SPACE                            08910000
089200         WHEN SQLCODE NOT EQUAL ZERO                              08920000
089300             DISPLAY '******************************************' 08930000
089400             DISPLAY '** ABEND                                **' 08940000
089500             DISPLAY '** PROGRAM = RVKUP004                   **' 08950000
089600             DISPLAY '** PARAGRAPH = 2315-VALIDATE-DEPT-CLS   **' 08960000
089700             DISPLAY '** DEPT_NBR   =  '  XLT00023-DEPT-NBR       08970000
089800             DISPLAY '** SUB_CL_NBR =  '  XLT00023-SUB-CL-NBR     08980000
089900             DISPLAY '** CHECKING DUMMY SKU DEPT & SUBCLASS   **' 08990000
090000             DISPLAY '******************************************' 09000000
090100             PERFORM 9100-SQL-ABEND                               09010000
090200     END-EVALUATE.                                                09020000
090300                                                                  09030000
090400                                                                  09040000
090500******************************************************************09050000
090600*  CHECK IF THE DEPT/SUBCLASS FROM GENCO MATCH THE SKU           *09060000
090700******************************************************************09070000
090800 2340-CHECK-SKU-DEPT-CLASS.                                       09080000
090900                                                                  09090000
091000     IF  RV051-SKU (1:8)  =  PV-PREV-SKU                          09100000
091100         CONTINUE                                                 09110000
091200     ELSE                                                         09120000
091300         PERFORM 2350-GET-SKU-DEPT-SUBCL                          09130000
091400     END-IF.                                                      09140000
091500                                                                  09150000
091600***  DISPLAY RV051-SKU (1:8) '-'                                  09160000
091700***          PV-INPUT-DEPT    '-'                                 09170000
091800***          PV-INPUT-SUBCLASS                                    09180000
091900***          ' *** '                                              09190000
092000***          ' PREVIOUS '                                         09200000
092100***          ' *** '                                              09210000
092200***          PV-PREV-SKU '-'                                      09220000
092300***          PV-PREV-SKU-DEPT '-'                                 09230000
092400***          PV-PREV-SKU-SUBCL                                    09240000
092500                                                                  09250000
092600     IF  PV-INPUT-DEPT      =  PV-PREV-SKU-DEPT-2-4   AND         09260000
092700         PV-INPUT-SUBCLASS  =  PV-PREV-SKU-SUBCL-3-4              09270000
092800         CONTINUE                                                 09280000
092900     ELSE                                                         09290000
093000         SET PS-DEPT-SUBCL-NOT-MATCH-SKU TO  TRUE                 09300000
093100         MOVE PV-PREV-SKU-DEPT-2-4   TO DL2-NEW-DEPT              09310000
093200         MOVE PV-PREV-SKU-SUBCL-3-4  TO DL2-NEW-SUBCLASS          09320000
093300                                                                  09330000
093400         PERFORM 2400-MOVE-DTL-TO-DETAIL-LINE2                    09340000
093500                                                                  09350000
093600         MOVE  PV-PREV-SKU-DEPT     TO  RV051-DEPT-NBR            09360000
093700         MOVE  PV-PREV-SKU-SUBCL    TO  RV051-SUB-CLASS-NBR       09370000
093800                                                                  09380000
093900         ADD  1  TO  PV-BAD-SKU-DEPT-SUBCLS-CNT                   09390000
094000                                                                  09400000
094100     END-IF.                                                      09410000
094200                                                                  09420000
094300                                                                  09430000
094400******************************************************************09440000
094500*  GET THE DEPT/SUBCLASS FOR THE SKU                             *09450000
094600******************************************************************09460000
094700 2350-GET-SKU-DEPT-SUBCL.                                         09470000
094800                                                                  09480000
094900     MOVE  RV051-SKU (1:8)     TO  XLT00003-SKU-NBR.              09490000
095000                                                                  09500000
095100     EXEC SQL                                                     09510000
095200         SELECT  B.DEPT_NBR                                       09520000
095300              ,  B.SUB_CL_NBR                                     09530000
095400           INTO  :XLT00004-DEPT-NBR                               09540000
095500              ,  :XLT00004-SUB-CL-NBR                             09550000
095600           FROM  XLT_SKU  A                                       09560000
095700              ,  XLT_VND_STYL  B                                  09570000
095800          WHERE  A.SKU_NBR  =  :XLT00003-SKU-NBR                  09580000
095900            AND  A.STYL_ID  =   B.STYL_ID                         09590000
096000     END-EXEC.                                                    09600000
096100                                                                  09610000
096200     EVALUATE TRUE                                                09620000
096300         WHEN SQLCODE = +0                                        09630000
096400              MOVE XLT00004-DEPT-NBR    TO  PV-PREV-SKU-DEPT      09640000
096500              MOVE XLT00004-SUB-CL-NBR  TO  PV-PREV-SKU-SUBCL     09650000
096600              MOVE RV051-SKU (1:8)      TO  PV-PREV-SKU           09660000
096700                                                                  09670000
096800         WHEN SQLCODE = +100                                      09680000
096900              CONTINUE                                            09690000
097000                                                                  09700000
097100         WHEN SQLWARN0 NOT EQUAL SPACE                            09710000
097200         WHEN SQLCODE NOT EQUAL ZERO                              09720000
097300             DISPLAY '******************************************' 09730000
097400             DISPLAY '** ABEND                                **' 09740000
097500             DISPLAY '** PROGRAM = RVKUP004                   **' 09750000
097600             DISPLAY '** PARAGRAPH = 2350-GET-SKU-DEPT-SUBCL  **' 09760000
097700             DISPLAY '** DEPT_NBR   =  '  XLT00023-DEPT-NBR       09770000
097800             DISPLAY '** SUB_CL_NBR =  '  XLT00023-SUB-CL-NBR     09780000
097900             DISPLAY '** CHECKING DUMMY SKU DEPT & SUBCLASS   **' 09790000
098000             DISPLAY '******************************************' 09800000
098100             PERFORM 9100-SQL-ABEND                               09810000
098200     END-EVALUATE.                                                09820000
098300                                                                  09830000
098400                                                                  09840000
098500******************************************************************09850000
098600*** 2400 MOVE-DTL-TO-DETAIL-LINE2.                                09860000
098700***   - MOVE FIELDS TO DETAIL LINE FOR REPORT                     09870000
098800***   - WRITE REPORT RECORD                                       09880000
098900******************************************************************09890000
099000 2400-MOVE-DTL-TO-DETAIL-LINE2.                                   09900000
099100                                                                  09910000
099200     MOVE RV051-DFCT-ORD-ID             TO DL2-ORD-ID-9.          09920000
099300     MOVE RV051-SEQ-NBR                 TO DL2-SEQ-NBR-9.         09930000
099400     MOVE RV051-DTL-RETURN-TYPE         TO DL2-RETURN-TYPE.       09940000
099500     MOVE RV051-DFCT-RET-DTE            TO DL2-RETURN-DATE.       09950000
099600     MOVE PV-INPUT-DEPT                 TO DL2-DEPT.              09960000
099700     MOVE PV-INPUT-SUBCLASS             TO DL2-SUB-CLASS.         09970000
099800     MOVE RV051-SKU                     TO DL2-SKU.               09980000
099900     MOVE PS-ERROR-TEXT                 TO DL2-ERROR-MSG.         09990000
100000                                                                  10000000
100100     PERFORM 4100-WRITE-REPORT.                                   10010000
100200                                                                  10020000
100300     SET  PS-DTL-CRITICAL-ERR-YES       TO  TRUE.                 10030000
100400                                                                  10040000
100500                                                                  10050000
100600******************************************************************10060000
100700*** 4000-WRITE-PAGE-HEADING.                                      10070000
100800***   - WRITE HEADING TO THE REPORT.                              10080000
100900***   - EXECUTES WHEN PAGE BREAK OCCURS.                          10090000
101000******************************************************************10100000
101100 4000-WRITE-PAGE-HEADING.                                         10110000
101200     ADD  1             TO PV-PAGE-COUNT.                         10120000
101300     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     10130000
101400                                                                  10140000
101500     WRITE ERROR-RPT-RECORD                                       10150000
101600         FROM DP132-STANDRD-HEADER-132-COLS                       10160000
101700         AFTER ADVANCING PAGE.                                    10170000
101800                                                                  10180000
101900     WRITE ERROR-RPT-RECORD                                       10190000
102000         FROM PH2-PAGE-HEADING-2                                  10200000
102100         AFTER ADVANCING 1 LINES.                                 10210000
102200                                                                  10220000
102300     WRITE ERROR-RPT-RECORD                                       10230000
102400         FROM PH3-PAGE-HEADING-3                                  10240000
102500         AFTER ADVANCING 1 LINES.                                 10250000
102600                                                                  10260000
102700**  JH  10/30/2011 BEG                                            10270000
102800     WRITE ERROR-RPT-RECORD                                       10280000
102900         FROM PH4-PAGE-HEADING-4                                  10290000
103000         AFTER ADVANCING 1 LINES.                                 10300000
103100**  JH  10/30/2011 END                                            10310000
103200                                                                  10320000
103300     WRITE ERROR-RPT-RECORD                                       10330000
103400         FROM BLANK-LINE                                          10340000
103500         AFTER ADVANCING 1 LINES.                                 10350000
103600                                                                  10360000
103700     WRITE ERROR-RPT-RECORD                                       10370000
103800         FROM DH1-DETAIL-HEADING-1                                10380000
103900         AFTER ADVANCING 1 LINES.                                 10390000
104000                                                                  10400000
104100     WRITE ERROR-RPT-RECORD                                       10410000
104200         FROM DH2-DETAIL-HEADING-2                                10420000
104300         AFTER ADVANCING 1 LINES.                                 10430000
104400                                                                  10440000
104500     WRITE ERROR-RPT-RECORD                                       10450000
104600         FROM DH3-DETAIL-HEADING-3                                10460000
104700         AFTER ADVANCING 1 LINES.                                 10470000
104800                                                                  10480000
104900     WRITE ERROR-RPT-RECORD                                       10490000
105000         FROM BLANK-LINE                                          10500000
105100         AFTER ADVANCING 1 LINES.                                 10510000
105200                                                                  10520000
105300     MOVE  8 TO PV-REPT-LINE-COUNT.                               10530000
105400                                                                  10540000
105500******************************************************************10550000
105600*** 4100-WRITE-REPORT.                                            10560000
105700***   - WRITE DETAIL LINES TO THE REPORT.                         10570000
105800******************************************************************10580000
105900 4100-WRITE-REPORT.                                               10590000
106000     IF  PV-REPT-LINE-COUNT > PC-MAX-REPORT-LINES                 10600000
106100         PERFORM 4000-WRITE-PAGE-HEADING                          10610000
106200     END-IF.                                                      10620000
106300                                                                  10630000
106400     IF  RV051-SKU (1:8)  =  PV-HOLD-SKU                          10640000
106500         WRITE ERROR-RPT-RECORD                                   10650000
106600          FROM DL2-DETAIL-LINE-DTL                                10660000
106700         AFTER ADVANCING 1 LINES                                  10670000
106800         ADD 1 TO PV-REPT-LINE-COUNT                              10680000
106900     ELSE                                                         10690000
107000         WRITE ERROR-RPT-RECORD                                   10700000
107100          FROM BLANK-LINE                                         10710000
107200         AFTER ADVANCING 1 LINES                                  10720000
107300         ADD 1 TO PV-REPT-LINE-COUNT                              10730000
107400                                                                  10740000
107500         WRITE ERROR-RPT-RECORD                                   10750000
107600          FROM DL2-DETAIL-LINE-DTL                                10760000
107700         AFTER ADVANCING 1 LINES                                  10770000
107800         ADD 1 TO PV-REPT-LINE-COUNT                              10780000
107900     END-IF.                                                      10790000
108000                                                                  10800000
108100     MOVE  RV051-SKU (1:8)  TO  PV-HOLD-SKU.                      10810000
108200                                                                  10820000
108300     INITIALIZE DL2-DETAIL-LINE-DTL.                              10830000
108400                                                                  10840000
108500 5000-SELECT-TCOCNTL.                                             10850000
108600                                                                  10860000
108700     MOVE '5000-SELECT-TCOCNTL'  TO PV-PARAGRAPH-NAME.            10870000
108800                                                                  10880000
108900     EXEC SQL                                                     10890000
109000        SELECT  A.BTCH_PRC_DTE                                    10900000
109100          INTO :COCNTL-BTCH-PRC-DTE                               10910000
109200          FROM  TCOCNTL A                                         10920000
109300          WHERE A.OPER_UNT_ID   =  90                             10930000
109400     END-EXEC.                                                    10940000
109500                                                                  10950000
109600     EVALUATE TRUE                                                10960000
109700                                                                  10970000
109800         WHEN SQLCODE = ZEROS                                     10980000
109900             CONTINUE                                             10990000
110000         WHEN OTHER                                               11000000
110100             MOVE 'TCOCNTL' TO PV-DB2-VIEW-NAME                   11010000
110200             PERFORM 9100-SQL-ABEND                               11020000
110300                                                                  11030000
110400     END-EVALUATE.                                                11040000
110500**  JH  10/30/2011  END                                           11050000
110600                                                                  11060000
110700******************************************************************11070000
110800* READ THE RTV DETAIL FILE                                       *11080000
110900******************************************************************11090000
111000 6001-READ-RTV-DTL-FILE.                                          11100000
111100                                                                  11110000
111200     READ RTV-DETAIL-FILE                                         11120000
111300         INTO RV051-GENCO-RTV-DETAIL-RECORD                       11130000
111400         AT END                                                   11140000
111500           SET PS-END-OF-DTL-INPUT-YES TO TRUE.                   11150000
111600                                                                  11160000
111700     IF PS-END-OF-DTL-INPUT-NO                                    11170000
111800        ADD +1  TO PA-TOT-RECS-READ                               11180000
111900                   PA-TOT-DTL-RECS-READ                           11190000
112000        ADD  1  TO  PV-REC-READ                                   11200000
112100        ADD  1  TO  PV-DISPLAY-COUNT                              11210000
112200     END-IF.                                                      11220000
112300                                                                  11230000
112400     IF  PV-DISPLAY-COUNT  >= 1000                                11240000
112500         DISPLAY 'PROCESS COUNT: '  PV-REC-READ                   11250000
112600         MOVE  ZEROES  TO  PV-DISPLAY-COUNT                       11260000
112700     END-IF.                                                      11270000
112800                                                                  11280000
112900******************************************************************11290000
113000* WRITE THE NEW DETAIL FILE                                      *11300000
113100******************************************************************11310000
113200 6020-WRITE-RTV-DTL-NEW.                                          11320000
113300                                                                  11330000
113400     WRITE RTV-DETAIL-RECORD-NEW                                  11340000
113500      FROM RV051-GENCO-RTV-DETAIL-RECORD.                         11350000
113600                                                                  11360000
113700       ADD +1  TO PA-TOT-RECS-WRITTEN.                            11370000
113800                                                                  11380000
113900       ADD  1  TO  PV-REC-WRITTEN.                                11390000
114000                                                                  11400000
114100                                                                  11410000
114200**  JH  10/30/2011 BEG                                            11420000
114300******************************************************************11430000
114400* VALIDATE THE LOCATION, MOVE LOC, NAME TO REPORT                *11440000
114500******************************************************************11450000
114600 6030-VALIDATE-LOCATION.                                          11460000
114700                                                                  11470000
114800     INITIALIZE DCLXLT00010.                                      11480000
114900                                                                  11490000
115000     EXEC SQL                                                     11500000
115100         SELECT  LOC_NBR                                          11510000
115200                ,LOC_10_ABBR_NM                                   11520000
115300           INTO  :XLT00010-LOC-NBR                                11530000
115400                ,:XLT00010-LOC-10-ABBR-NM                         11540000
115500           FROM XLT_LOC                                           11550000
115600         WHERE LOC_NBR = :PV-LOC-NBR                              11560000
115700     END-EXEC.                                                    11570000
115800                                                                  11580000
115900     EVALUATE TRUE                                                11590000
116000         WHEN SQLCODE = +0                                        11600000
116100             MOVE XLT00010-LOC-NBR        TO PH4-RTV-LOC          11610000
116200             MOVE XLT00010-LOC-10-ABBR-NM TO PH4-RTV-NAME         11620000
116300             CONTINUE                                             11630000
116400         WHEN SQLCODE = +100                                      11640000
116500         WHEN SQLWARN0 NOT EQUAL SPACE                            11650000
116600         WHEN SQLCODE  NOT EQUAL ZERO                             11660000
116700             DISPLAY '** ABEND **'                                11670000
116800             DISPLAY '** PROGRAM = RVKUP004 **'                   11680000
116900             DISPLAY '** PARAGRAPH = 6030-VALIDATE-LOCATION '     11690000
117000             DISPLAY 'RTV LOCATION NBR      ' PV-LOC-NBR-DISPLAY  11700000
117100             DISPLAY 'RV051 DEPARTMENT NBR  ' RV051-DEPT-NBR      11710000
117200             DISPLAY 'RV051 SKU NBR         ' RV051-SKU           11720000
117300             DISPLAY 'RV051 SUB CLASS NBR   ' RV051-SUB-CLASS-NBR 11730000
117400             MOVE SQLCODE                  TO PV-SQLCODE          11740000
117500             MOVE '6030-VALIDATE-LOCATION' TO PV-PARAGRAPH-NAME   11750000
117600             MOVE 'SELECT FROM XLT_LOC '   TO PV-ABEND-MESSAGE    11760000
117700             PERFORM 9100-SQL-ABEND                               11770000
117800     END-EVALUATE.                                                11780000
117900                                                                  11790000
118000**  JH  10/30/2011 END                                            11800000
118100                                                                  11810000
118200******************************************************************11820000
118300*                                                                 11830000
118400*                                                                 11840000
118500*                                                                 11850000
118600******************************************************************11860000
118700 8000-EOJ-ROUTINE.                                                11870000
118800                                                                  11880000
118900     WRITE ERROR-RPT-RECORD                                       11890000
119000         FROM END-OF-REPORT-LINE                                  11900000
119100         AFTER ADVANCING 2 LINES.                                 11910000
119200                                                                  11920000
119300                                                                  11930000
119400      CLOSE RTV-DETAIL-FILE                                       11940000
119500            RTV-DETAIL-FILE-NEW                                   11950000
119600            ERROR-REPORT.                                         11960000
119700                                                                  11970000
119800     DISPLAY '***********************************************'.   11980000
119900     DISPLAY '**    * RVKUP004 SUMMARY STATISTICS *        **'.   11990000
120000     DISPLAY '**                                           **'.   12000000
120100     DISPLAY '**    --------------------------------       **'.   12010000
120200     DISPLAY '**    GENCO RTV - SKU/DEPT/SUBCLS EDIT       **'.   12020000
120300     DISPLAY '**    --------------------------------       **'.   12030000
120400     DISPLAY '** RECORDS READ:        ' PV-REC-READ.              12040000
120500     DISPLAY '** RECORDS WRITTEN:     ' PV-REC-WRITTEN.           12050000
120600     DISPLAY '** INVALID DEPT/SUBCLS: ' PV-BAD-DEPT-SUBCLS-CNT.   12060000
120700     DISPLAY '** SKU/DEPT/CLS MISMTCH:'                           12070000
120800                                 PV-BAD-SKU-DEPT-SUBCLS-CNT.      12080000
120900     DISPLAY '**                                           **'.   12090000
121000     DISPLAY '***********************************************'.   12100000
121100                                                                  12110000
121200     IF  PS-DTL-CRITICAL-ERR-YES                                  12120000
121300         MOVE 4095 TO RETURN-CODE                                 12130000
121400     END-IF.                                                      12140000
121500                                                                  12150000
121600******************************************************************12160000
121700* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *12170000
121800* ERROR OR WARNING CODE OCCURS.                                  *12180000
121900******************************************************************12190000
122000 9100-SQL-ABEND.                                                  12200000
122100******************************************************************12210000
122200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *12220000
122300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *12230000
122400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *12240000
122500* FORMAT.                                                        *12250000
122600******************************************************************12260000
122700                                                                  12270000
122800     COPY DPPD004.                                                12280000
122900*                                                                 12290000
123000     DISPLAY '***********************************'.               12300000
123100     DISPLAY '      GENCO RTV LOAD ABEND         '.               12310000
123200     DISPLAY '***********************************'.               12320000
123300     DISPLAY '* CURRENT STATS AT TIME OF ABEND  *'.               12330000
123400     DISPLAY '***********************************'.               12340000
123500     DISPLAY '** TOT DTL RECS READ   :' PA-TOT-DTL-RECS-READ.     12350000
123600     DISPLAY '***********************************************'.   12360000
123700     DISPLAY '**    * RVKUP004 SUMMARY STATISTICS *        **'.   12370000
123800     DISPLAY '**                                           **'.   12380000
123900     DISPLAY '**    --------------------------------       **'.   12390000
124000     DISPLAY '**    GENCO RTV - SKU/DEPT/SUBCLS EDIT       **'.   12400000
124100     DISPLAY '**    --------------------------------       **'.   12410000
124200     DISPLAY '** RECORDS READ:        ' PV-REC-READ.              12420000
124300     DISPLAY '** RECORDS WRITTEN:     ' PV-REC-WRITTEN.           12430000
124400     DISPLAY '** INVALID DEPT/SUBCLS: ' PV-BAD-DEPT-SUBCLS-CNT.   12440000
124500     DISPLAY '** SKU/DEPT/CLS MISMTCH:'                           12450000
124600                                 PV-BAD-SKU-DEPT-SUBCLS-CNT.      12460000
124700     DISPLAY '**                                           **'.   12470000
124800     DISPLAY '***********************************************'.   12480000
124900     DISPLAY '**                                           **'.   12490000
125000     DISPLAY '** ABEND PARAGRAPH **  ' PV-PARAGRAPH-NAME.         12500000
125100     DISPLAY '** ERROR MESSAGE   **  ' PV-ABEND-MESSAGE.          12510000
125200     DISPLAY '** SQLCODE         **  ' PV-SQLCODE.                12520000
125300     DISPLAY '** VIEW  NAME      **  ' PV-DB2-VIEW-NAME.          12530000
125400     DISPLAY '***********************************************'.   12540000
125500     DISPLAY ' '.                                                 12550000
125600     MOVE +4013 TO ABEND-CODE.                                    12560000
125700     CALL 'ILBOABN0' USING ABEND-CODE.                            12570000
125800                                                                  12580000
125900****************************************************************  12590000
126000** PERFORM NON SQL ABEND PROCESSING                               12600000
126100****************************************************************  12610000
126200 9200-NON-SQL-ABEND.                                              12620000
126300*                                                                 12630000
126400     DISPLAY '************************************************'.  12640000
126500     DISPLAY '********** NON SQL PROGRAM ABEND ***************'.  12650000
126600     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          12660000
126700     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    12670000
126800     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH-NAME.                12680000
126900     DISPLAY '** MESSAGE:    ', PV-ABEND-MESSAGE.                 12690000
127000     DISPLAY '***********************************'.               12700000
127100     DISPLAY '* CURRENT STATS AT TIME OF ABEND  *'.               12710000
127200     DISPLAY '***********************************'.               12720000
127300     DISPLAY '***********************************************'.   12730000
127400     DISPLAY '**    * RVKUP004 SUMMARY STATISTICS *        **'.   12740000
127500     DISPLAY '**                                           **'.   12750000
127600     DISPLAY '**    --------------------------------       **'.   12760000
127700     DISPLAY '**    GENCO RTV - SKU/DEPT/SUBCLS EDIT       **'.   12770000
127800     DISPLAY '**    --------------------------------       **'.   12780000
127900     DISPLAY '** RECORDS READ:        ' PV-REC-READ.              12790000
128000     DISPLAY '** RECORDS WRITTEN:     ' PV-REC-WRITTEN.           12800000
128100     DISPLAY '** INVALID DEPT/SUBCLS: ' PV-BAD-DEPT-SUBCLS-CNT.   12810000
128200     DISPLAY '** SKU/DEPT/CLS MISMTCH:'                           12820000
128300                                 PV-BAD-SKU-DEPT-SUBCLS-CNT.      12830000
128400     DISPLAY '**                                           **'.   12840000
128500     DISPLAY '***********************************************'.   12850000
128600     MOVE +4013 TO ABEND-CODE.                                    12860000
128700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         12870000
128800                                                                  12880000
128900******************************************************************12890000
129000*                       END OF PROGRAM                            12900000
129100******************************************************************12910000
