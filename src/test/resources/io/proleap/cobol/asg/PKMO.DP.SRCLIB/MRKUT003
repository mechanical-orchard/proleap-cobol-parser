000100***************************************************************** 00010050
000200 IDENTIFICATION DIVISION.                                         00020050
000300***************************************************************** 00030050
000400                                                                  00040050
000500 PROGRAM-ID.             MRKUT003.                                00050050
000600 AUTHOR.                 XXXXXXXXXXXXXXX.                         00060050
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070050
000800 DATE-WRITTEN            11-XX-92.                                00080050
000900 DATE-COMPILED.                                                   00090050
001000                                                                  00100050
001100***************************************************************** 00110050
001200*          CREATE TRANSFER RECORD INPUT                         * 00120050
001300*                                                               * 00130050
001400*  VERSION OF MRKUT003                                          * 00140050
001500*  RETRIEVES RECORDS, DOES NOT ASSIGN WEEK NUMBER, RETRIEVES    * 00150050
001600*  BASED ON RT_NBR                                              * 00160050
001700*                                                               * 00170050
001800*  THIS PROGRAM IS A VERSION OF MRKUT003.  IT WILL READ IN      * 00180050
001900*  A SEQUENTIAL INPUT FILE CREATED IN ANOTHER PROGRAM AND       * 00190050
002000*  UPDATE EACH RECORD.                                          * 00200050
002100*                                                               * 00210050
002200***************************************************************** 00220050
002300*  CHANGE MADE:                                                 * 00230050
002400*                                                               * 00240050
002500***************************************************************** 00250050
002600* CHANGED 06/21/93 BY CHRISTINE FOLEY                             00260050
002700*   WR# XXXXXXXXXXXX                                              00270050
002800*            ADDED CHECK FOR UCYCLE OF 5 TO CALCULATE FOR 4       00280050
002900*            WEEKS OF CPS.                                        00290050
003000*                                                                 00300050
003100*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  00310050
003200*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  00320050
003300***************************************************************** 00330050
003400* CHANGED 09/08/95 BY HOWARD MENDELSON                            00340050
003500*   WR# 2784                                                      00350050
003600*            EXTRACT HISTORY VALUES FROM TMRISHS AND ADD THE      00360050
003700*            VALUES TO THE TRANSFER RECORD.                       00370050
003800*                                                                 00380050
003900***************************************************************** 00390050
004000* CHANGED 10/31/95 BY HOWARD MENDELSON                            00400050
004100*   WR# 2784                                                      00410050
004200*            REMOVED ITEM STORE HISTORY OUTPUT FILE CODE          00420050
004300*                                                                 00430050
004400***************************************************************** 00440050
004500* CHANGED 12/14/95 BY HOWARD MENDELSON                            00450050
004600*   WR# 2916                                                      00460050
004700*            ADD CORPORATE STORE LOGIC                            00470050
004800*                                                                 00480050
004900***************************************************************** 00490050
005000* CHANGED 08/12/98 BY PAUL KEBER - STRATAGEM                      00500050
005100*   WR# 6041                                                      00510050
005200*            AS PART OF Y2K CHANGES, UPDATED PROGRAM TO ACCESS    00520050
005300*            THE NEW WEEKLY SALES TABLE - TSKSTWKS AND REPLACED   00530050
005400*            SALES_INDCT FIELD WITH NEW DATE FIELD FSCL_BOW_DTE.  00540050
005500*            PV-MIN-DATE AND PV-MAX-DATE WERE CHANGED TO PV-MIN-  00550050
005600*            BOW-DATE AND PV-MAX-BOW-DATE AND WERE FILLED WITH    00560050
005700*            NEW DATE ROUTINE CALLS.  PV-UCYCLE-MIN-DATE AND      00570050
005800*            PV-UCYCLE-MAX-DATE FIELDS WERE FILLED WITH NEW DATE  00580050
005900*            ROUTINE CALLS.                                       00590050
006000*                                                                 00600050
006100***************************************************************** 00610050
006200* CHANGED 10/19/98 BY PATRICK MCGRAW                              00620050
006300*            AS PART OF Y2K CHANGES, CHANGED PIVOT YEAR TO 80     00630050
006400*            FROM 88 IN ORDER TO HAVE UNIFORMITY IN THE MW SYSTEM 00640050
006500*            PROGRAMS.                                            00650050
006600***************************************************************** 00660050
006610* CHANGED 03/22/00 BY STEVE ROEGNER                               00670050
006620*            CHANGED THE PROGRAM TO USE DB2 TABLE TSKSTOO FOR ITS 00680050
006630*            ONORDER DATA FROM THE VSAM FILE PKMCIC.FS.ONORDER.   00690050
006631***************************************************************** 00700050
006632* CHANGED 08/13/02 BY LINDA FRIESS                                00710050
006633*            ADDED DISPLAY OF ITEM COUNT AT END OF PROGRAM.       00720050
006634***************************************************************** 00730050
006635* CHANGED 09/04/02 BY IBM GLOBAL SERVICES INDIA                   00740050
006636*                     WR # 21601 (NI-SKU PROJECT)                 00750050
006637*            DEPARTMENT, CLASS AND 8-DIGIT SKU ARE FETCHED FROM   00760050
006638*            FROM TSKXREF AND WRITTEN INTO OUTPUT.                00770050
006639***************************************************************** 00780050
006640* CHANGED 11/05/02 BY DON TOMLINSON                               00790050
006641*                    PIT: 505764 (NI-SKU PROJECT)                 00800050
006642*            PREVIOUS CHANGE REMOVED CODE THAT SHOULD NOT HAVE    00810050
006643*            BEEN REMOVED. PUT CODE BACK INTO PROGRAM. SEE        00820050
006644*            D100 PARAGRAPH.                                      00830050
006645***************************************************************** 00840050
006635* CHANGED 06/02/04 BY BOB FORD                                    00850050
006636*                     WR # 26363 (STORE NUMBER EXPANSION)         00860050
006637*            CHANGED PROGRAM TO HANDLE 5-DIGIT STORE NUMBERS.     00870050
006637*            REPLACED TSTR000 WITH XMT_LOC.                       00880050
006639***************************************************************** 00890050
006646 ENVIRONMENT DIVISION.                                            00900050
006647***************************************************************** 00910050
006648                                                                  00920050
006649 CONFIGURATION SECTION.                                           00930050
006650                                                                  00940050
006660 SOURCE-COMPUTER.        IBM-3090.                                00950050
006670 OBJECT-COMPUTER.        IBM-3090.                                00960050
006680                                                                  00970050
006690 INPUT-OUTPUT SECTION.                                            00980050
006700                                                                  00990050
006800 FILE-CONTROL.                                                    01000050
006900*                                                                 01010050
007000     SELECT IC-CONTROL-FILE    ASSIGN       TO INP01              01020050
007100                               ORGANIZATION IS INDEXED            01030050
007200                               ACCESS       IS RANDOM             01040050
007300                               RECORD KEY   IS ICCTL-KEY          01050050
007400                               FILE STATUS  IS PV-CONTROL-STATUS. 01060050
007500     SELECT BIM-FILE           ASSIGN       TO INP02              01070050
007600                               ORGANIZATION IS INDEXED            01080050
007700                               ACCESS       IS RANDOM             01090050
007800                               RECORD KEY   IS BIM-FILE-KEY       01100050
007900                               FILE STATUS  IS PV-BIM-STATUS.     01110050
008000     SELECT TRANSFER-RECORD-IN ASSIGN TO INP03.                   01120050
008100     SELECT TRANSFER-RECORD    ASSIGN TO OUT01.                   01130050
008200*                                                                 01140050
008300***************************************************************** 01150050
008400 DATA DIVISION.                                                   01160050
008500***************************************************************** 01170050
008600*                                                                 01180050
008700 FILE SECTION.                                                    01190050
008800*                                                                 01200050
008900 FD  IC-CONTROL-FILE.                                             01210050
009000 01  IC-CONTROL-REC.                                              01220050
009100     05  ICCTL-KEY                   PIC  X(21).                  01230050
009200     05  FILLER                      PIC  X(379).                 01240050
009300*                                                                 01250050
009400 FD  BIM-FILE.                                                    01260050
009500 01  BIM-REC.                                                     01270050
009600     05  BIM-FILE-KEY                PIC  X(07).                  01280050
009700     05  FILLER                      PIC  X(228).                 01290050
009800*                                                                 01300050
009900 FD  TRANSFER-RECORD-IN                                           01310050
010000     RECORDING MODE IS F                                          01320050
010100     LABEL RECORDS ARE STANDARD                                   01330050
010200     RECORD CONTAINS 1143 CHARACTERS                              01340050
010300     BLOCK CONTAINS 0  RECORDS.                                   01350050
010400 01  TRANSFER-REC-IN                 PIC  X(1143).                01360050
010500*                                                                 01370050
010600 FD  TRANSFER-RECORD                                              01380050
010700     RECORDING MODE IS F                                          01390050
010800     LABEL RECORDS ARE STANDARD                                   01400050
010900     RECORD CONTAINS 2900 CHARACTERS                              01410050
011000     BLOCK CONTAINS 0  RECORDS.                                   01420050
011100 01  TRANSFER-REC                    PIC  X(2900).                01430050
011200*                                                                 01440050
011300 WORKING-STORAGE SECTION.                                         01450050
011400*                                                                 01460050
011500 01  FILLER.                                                      01470050
011600     05  FILLER                      PIC  X(36)    VALUE          01480050
011700         ' ***** WORKING STORAGE PGM=MRKUT003 '.                  01490050
011800     05  FILLER                      PIC  X(10)    VALUE          01500050
011900         ' LOCATION='.                                            01510050
012000     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   01520050
012100     05  FILLER                      PIC  X(06)    VALUE          01530050
012200         ' *****'.                                                01540050
012300 EJECT                                                            01550050
012400 01  PROGRAM-SWITCHES.                                            01560050
012500     05  PS-EOF-TRANS-REC            PIC  X(01)    VALUE 'N'.     01570050
012600         88  EOF-TRANS-REC                         VALUE 'Y'.     01580050
012700     05  PS-NO-INPUT                 PIC  X(01)    VALUE 'N'.     01590050
012800         88  NO-INPUT                              VALUE 'Y'.     01600050
012900     05  PS-ROW-FOUND-SWITCH         PIC  X(01)    VALUE 'Y'.     01610050
013000         88  PS-ROW-FOUND                          VALUE 'Y'.     01620050
013100         88  PS-ROW-NOT-FOUND                      VALUE 'N'.     01630050
013200*                                                                 01640050
013300/                                                                 01650050
013400 01  PC-CONSTANTS.                                                01660050
013500     05  PC-PGRM-NAME                PIC  X(08)    VALUE          01670050
013600                                                  'MRKUT003'.     01680050
013700     05  PC-PLUS-1                   PIC S9(04)    VALUE +1       01690050
013800                                                   COMP SYNC.     01700050
013900     05  PC-NEG-1                    PIC S9(04)    VALUE -1       01710050
014000                                                   COMP SYNC.     01720050
014100     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01730050
014200                                                   COMP SYNC.     01740050
014300     05  PC-01                       PIC  X(02)    VALUE '01'.    01750050
014400     05  PC-1                        PIC S9(03)    VALUE +1       01760050
014500                                                   COMP-3.        01770050
014600     05  PC-2                        PIC S9(03)    VALUE +2       01780050
014700                                                   COMP-3.        01790050
014800     05  PC-3                        PIC S9(03)    VALUE +3       01800050
014900                                                   COMP-3.        01810050
015000     05  PC-4                        PIC S9(03)    VALUE +4       01820050
015100                                                   COMP-3.        01830050
015200     05  PC-5                        PIC S9(03)    VALUE +5       01840050
015300                                                   COMP-3.        01850050
015400     05  PC-6                        PIC S9(03)    VALUE +6       01860050
015500                                                   COMP-3.        01870050
015600     05  PC-7                        PIC S9(03)    VALUE +7       01880050
015700                                                   COMP-3.        01890050
015800     05  PC-200                      PIC S9(03)    VALUE +200     01900050
015900                                                   COMP-3.        01910050
016000     05  PC-999                      PIC S9(03)    VALUE +999     01920050
016100                                                   COMP-3.        01930050
016200     05  PC-03                       PIC  X(02)    VALUE '03'.    01940050
016300     05  PC-13                       PIC  X(02)    VALUE '13'.    01950050
016400     05  PC-17                       PIC  X(02)    VALUE '17'.    01960050
016500     05  PC-19                       PIC  X(02)    VALUE '19'.    01970050
016600     05  PC-20                       PIC  X(02)    VALUE '20'.    01980050
016700     05  PC-52                       PIC  9(02)    VALUE  52.     01990050
016800     05  PC-1P                       PIC  S99V     VALUE +1       02000050
016900                                                   COMP-3.        02010050
017000     05  PC-2P                       PIC  S99V     VALUE +2       02020050
017100                                                   COMP-3.        02030050
017200     05  PC-3P                       PIC  S99V     VALUE +3       02040050
017300                                                   COMP-3.        02050050
017400     05  PC-4P                       PIC  S99V     VALUE +4       02060050
017500                                                   COMP-3.        02070050
017600     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     02080050
017700     05  PC-A0                       PIC  X(02)    VALUE 'A0'.    02090050
017800     05  PC-F2                       PIC  X(02)    VALUE 'F2'.    02100050
017900     05  PC-F4                       PIC  X(02)    VALUE 'F4'.    02110050
018000     05  PC-DECR-7-DAYS              PIC  9(05)    VALUE 00007.   02120050
018100     05  PC-DPT                      PIC  X(03)    VALUE 'DPT'.   02130050
018200     05  PC-BYR                      PIC  X(03)    VALUE 'BYR'.   02140050
018300     05  PC-RCD-TYPE                 PIC  X(03)    VALUE 'SYS'.   02150050
018400     05  PC-FLNAME-LENGTH            PIC S9(03)    VALUE +30      02160050
018500                                                   COMP-3.        02170050
018600     05  PC-PGM-DPKUT500             PIC  X(08)    VALUE          02180050
018700                                                   'DPKUT500'.    02190050
018800     05  PC-OPER-CO                  PIC  XX       VALUE '03'.    02200050
018900     05  PC-CORPORATE-STORE          PIC  9(05)    VALUE ZERO.    02210050
019000     05  PC-085                      PIC  9(03)    COMP-3         02220050
019100                                                   VALUE 085.     02230050
019200     05  PC-810                      PIC  9(03)    COMP-3         02240050
019300                                                   VALUE 810.     02250050
019400     05  PC-899                      PIC  9(03)    COMP-3         02260050
019500                                                   VALUE 899.     02270050
019600 EJECT                                                            02280050
019700*                                                                 02290050
019800 01  PV-NULL-INDICATORS.                                          02300050
019900     05  PV-SALES-UNIT-QTY-NULL      PIC S9(04)    VALUE +0       02310050
020000                                                   COMP SYNC.     02320050
019900     05  PV-NULL-HISTCPS-QTY         PIC S9(04)    VALUE +0       02321050
020000                                                   COMP SYNC.     02322050
020100     05  PV-NULL-SLS-QTY             PIC S9(04)    VALUE +0       02323050
020200                                                   COMP SYNC.     02324050
020300     05  PV-NULL-OO                  PIC S9(04)    VALUE +0       02325050
020400                                                   COMP SYNC.     02326050
020500*                                                                 02327050
020600 01  PV-ACCUMULATOR-FIELDS.                                       02328050
020610     05  PV-SYSTEM-INPUT-CNT         PIC S9(07)    VALUE ZERO     02329050
020620                                                   COMP-3.        02330050
020630     05  PV-TRANS-INPUT-CNT          PIC S9(07)    VALUE ZERO     02340050
020640                                                   COMP-3.        02350050
020650     05  PV-SYSTEM-OUTPUT-CNT        PIC S9(07)    VALUE ZERO     02360050
020660                                                   COMP-3.        02370050
020670     05  PV-ITEM-COUNT               PIC S9(07)    VALUE ZERO     02380050
020680                                                   COMP-3.        02390050
020690 EJECT                                                            02400050
020700*                                                                 02410050
020800 01  PV-MISC-FIELDS.                                              02420050
020900     05  PV-9-5                      PIC 9(05)    VALUE ZERO.     02430050
020900     05  PV-X-5 REDEFINES PV-9-5.                                 02440050
022300         10   FILLER                 PIC X(2).                    02450050
022300         10   PV-X-3                 PIC X(3).                    02460050
020900     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     02470050
021000                                                   COMP SYNC.     02480050
021100     05  PV-VSAM-STATUS              PIC  X(02)    VALUE SPACE.   02490050
021200         88   PV-NO-REC-FOUND                      VALUE '23'.    02500050
021300                                                                  02510050
021400     05  PV-CONTROL-STATUS           PIC  X(02)    VALUE SPACE.   02520050
021500         88  PV-CONTROL-SUCCESSFUL                 VALUE '00'.    02530050
021600         88  PV-CONTROL-VERIFY                     VALUE '97'.    02540050
021700     05  PV-BIM-STATUS               PIC  X(02)    VALUE SPACE.   02550050
021800         88  PV-BIM-SUCCESSFUL                     VALUE '00'.    02560050
021900         88  PV-BIM-VERIFY                         VALUE '97'.    02570050
022000                                                                  02580050
022100     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  02590050
022200     05  PV-MESSAGES.                                             02600050
022300         10   PV-PARAGRAPH-NAME-MSG.                              02610050
022400             15  FILLER              PIC  X(13)    VALUE          02620050
022500                                    'PARAGRAPH IS '.              02630050
022600             15  PV-PARAGRAPH-NAME   PIC  X(25).                  02640050
022700         10   PV-ERROR-FILE-MSG.                                  02650050
022800             15  FILLER              PIC  X(26)    VALUE          02660050
022900                   'ERROR HAS OCCURED FILE IS '.                  02670050
023000             15  PV-ERROR-FILE       PIC  X(19).                  02680050
023100         10   PV-ERROR-OPERATION-MSG.                             02690050
023200             15  FILLER              PIC  X(13)    VALUE          02700050
023300                   'OPERATION IS '.                               02710050
023400             15  PV-ERROR-OPERATION  PIC  X(19).                  02720050
023500         10   PV-ERROR-STATUS-MSG.                                02730050
023600             15  FILLER              PIC  X(10)    VALUE          02740050
023700                   'STATUS IS '.                                  02750050
023800             15  PV-ERROR-STATUS     PIC  X(20).                  02760050
023900         10   PV-NOT-FOUND-MSG.                                   02770050
024000             15  FILLER              PIC  X(12)    VALUE          02780050
024100                   'FILE KEY IS '.                                02790050
024200             15  PV-NOT-FOUND-KEY    PIC  X(21).                  02800050
024300     05  PC-DATE.                                                 02810050
024400         10  PC-MO                   PIC 9(2) VALUE ZEROES.       02820050
024500         10  FILLER                  PIC X(1) VALUE '/'.          02830050
024600         10  PC-DY                   PIC 9(2) VALUE ZEROES.       02840050
024700         10  FILLER                  PIC X(1) VALUE '/'.          02850050
024800         10  PC-YR                   PIC 9(2) VALUE ZEROES.       02860050
024900                                                                  02870050
025000     05  PV-TODAYS-DATE              PIC  X(08).                  02880050
025100     05  PV-TODAYS-WEEK              PIC  9(02).                  02890050
025200     05  PV-FIRST-DATE.                                           02900050
025300         10  PV-FIRST-MO             PIC  9(02).                  02910050
025400         10  FILLER                  PIC  X(01)    VALUE '/'.     02920050
025500         10  PV-FIRST-DY             PIC  9(02).                  02930050
025600         10  FILLER                  PIC  X(01)    VALUE '/'.     02940050
025700         10  PV-FIRST-YR             PIC  9(02).                  02950050
025800     05  PV-UCYCLE-MIN-DATE                        VALUE SPACES.  02960050
025900         10  PV-UCYCLE-MIN-CCYR      PIC  9(04).                  02970050
026000         10  FILLER                  PIC  X(06).                  02980050
025800     05  PV-UCYCLE5-MIN-DATE                       VALUE SPACES.  02990050
025900         10  PV-UCYCLE5-MIN-CCYR     PIC  9(04).                  03000050
026000         10  FILLER                  PIC  X(06).                  03010050
025800     05  PV-UCYCLE9-MIN-DATE                       VALUE SPACES.  03020050
025900         10  PV-UCYCLE9-MIN-CCYR     PIC  9(04).                  03030050
026000         10  FILLER                  PIC  X(06).                  03040050
026100     05  PV-UCYCLE-MIN-YR            PIC  9(02)    VALUE ZERO.    03050050
026200     05  PV-UCYCLE-MAX-DATE                        VALUE SPACES.  03060050
026300         10  PV-UCYCLE-MAX-CCYR      PIC  9(04).                  03070050
026400         10  FILLER                  PIC  X(06).                  03080050
026200     05  PV-UCYCLE5-MAX-DATE                       VALUE SPACES.  03090050
026300         10  PV-UCYCLE5-MAX-CCYR     PIC  9(04).                  03091050
026400         10  FILLER                  PIC  X(06).                  03092050
026200     05  PV-UCYCLE9-MAX-DATE                       VALUE SPACES.  03093050
026300         10  PV-UCYCLE9-MAX-CCYR     PIC  9(04).                  03094050
026400         10  FILLER                  PIC  X(06).                  03095050
026500     05  PV-UCYCLE-MAX-YR            PIC  9(02)    VALUE ZERO.    03096050
026600**   05  PV-UCYCLE-MIN-DATE.                                      03097050
026700**       10  PV-UCYCLE-MIN-YR        PIC  9(02).                  03098050
026800**       10  PV-UCYCLE-MIN-WK        PIC  9(02).                  03099050
026900**   05  PV-UCYCLE-MAX-DATE.                                      03100050
027000**       10  PV-UCYCLE-MAX-YR        PIC  9(02).                  03110050
027100**       10  PV-UCYCLE-MAX-WK        PIC  9(02).                  03120050
027200     05  PV-CURRENT-DATE.                                         03130050
027300         10  PV-CURRENT-DATE-CC      PIC  9(02)    VALUE ZERO.    03140050
027400         10  PV-CURRENT-DATE-YR      PIC  9(02)    VALUE ZERO.    03150050
027500         10  FILLER                  PIC  X(01)    VALUE '-'.     03160050
027600         10  PV-CURRENT-DATE-MO      PIC  9(02)    VALUE ZERO.    03170050
027700         10  FILLER                  PIC  X(01)    VALUE '-'.     03180050
027800         10  PV-CURRENT-DATE-DY      PIC  9(02)    VALUE ZERO.    03190050
027900     05  PV-CURRENT-DATE-R REDEFINES PV-CURRENT-DATE              03200050
028000                                     PIC  X(10).                  03210050
028100     05  PV-SUBSCRIPTS.                                           03220050
028200         10  PV-HIST-SUB             PIC  9(02)    VALUE ZERO.    03230050
028300         10  PV-CST-SUB              PIC  9(02)    VALUE ZERO.    03240050
028400         10  PV-BIM-SUB              PIC  9(02)    VALUE ZERO.    03250050
028500         10  PV-BIM-SUB2             PIC  9(02)    VALUE ZERO.    03260050
028600         10  PV-WBI-SUB              PIC  9(02)    VALUE ZERO.    03270050
028700         10  PV-MBI-SUB              PIC  9(02)    VALUE ZERO.    03280050
028800         10  PV-BPN-SUB              PIC S9(01)    COMP.          03290050
028900     05  PV-CALC-DAYS                PIC S9(03)    VALUE ZERO.    03300050
029000* ###                                                             03310050
029100     05  PV-CALC-DAYS-POSITIVE       PIC S9(03)    VALUE ZERO.    03320050
029200     05  PV-MIN-DATE-CALC-DAYS       PIC S9(03)    VALUE ZERO.    03330050
029300* ###                                                             03340050
029400     05  PV-MIN-DATE-CALC-DAYS-POSI  PIC S9(03)    VALUE ZEROS.   03350050
029500     05  PV-BYR-NAME                 PIC  X(30)    VALUE SPACES.  03360050
029600     05  PV-TSKSTWKS-MIN-DTE         PIC  X(10)    VALUE SPACES.  03370050
029700     05  PV-TSKSTWKS-MAX-DTE         PIC  X(10)    VALUE SPACES.  03380050
029800     05  PV-MIN-BOW-DATE             PIC  X(10)    VALUE SPACES.  03390050
029900     05  PV-MAX-BOW-DATE             PIC  X(10)    VALUE SPACES.  03400050
030000                                                                  03410050
030100*    05  PV-MIN-DATE.                                             03420050
030200*        10 PV-MIN-YR                PIC  9(02).                  03430050
030300*        10 PV-MIN-WK                PIC  X(02).                  03440050
030400*    05 PV-MIN-WEEK                  PIC  X(02).                  03450050
030500*    05 PV-MIN-WEEK-N REDEFINES PV-MIN-WEEK                       03460050
030600*                                    PIC 9(02).                   03470050
030700*    05  PV-MAX-DATE.                                             03480050
030800*        10 PV-MAX-YR                PIC  9(02).                  03490050
030900*        10 PV-MAX-WK                PIC  X(02).                  03500050
031000*    05 PV-MAX-WEEK                  PIC  X(02).                  03510050
031100*    05 PV-MAX-WEEK-N REDEFINES PV-MAX-WEEK                       03520050
031200*                                    PIC 9(02).                   03530050
031300                                                                  03540050
031400     05  PV-CPS-QTY                  PIC S9999999V COMP-3.        03550050
031500     05  PV-WN                       PIC S9(02)    VALUE ZEROES.  03560050
031600     05  PV-OO                       PIC S9(07)    COMP-3         03570050
031700                                                   VALUE ZEROES.  03580050
031900     05  PV-F4-NBR-FISCAL-WEEKS      PIC  9(02)    VALUE ZEROES.  03590050
032000     05  PV-F4-NBR-FISCAL-PERIOD-WKS PIC  9(02)    VALUE ZEROES.  03600050
032100*                                                                 03610050
032200     05  PV-PREV-FIELDS.                                          03620050
032300         10  PV-PREV-SORT-SKU.                                    03630050
032400             15  PV-PREV-DEPT       PIC  X(03)    VALUE SPACES.   03640050
032500             15  PV-PREV-CLASS      PIC  X(02)    VALUE SPACES.   03650050
032600             15  PV-PREV-VEND-NBR   PIC  X(03)    VALUE SPACES.   03660050
032700             15  PV-PREV-SKU        PIC S9(08)    COMP-3          03670050
032800                                                  VALUE ZEROES.   03680050
032900         10  PV-PREV-STORE          PIC S9(05)    VALUE ZEROES.   03690050
033000         10  PV-PREV-ITEM-NBR       PIC 9(15)     COMP-3 VALUE 0. 03700050
033100         10  PV-PREV-WEEK-NBR       PIC S99V      COMP-3 VALUE 0. 03710050
033200         10  PV-PREV-SEQ-NBR        PIC S99V      COMP-3 VALUE 0. 03720050
033300         10  PV-PREV-LFWM-QTY       PIC S9(6)V9   COMP-3 VALUE 0. 03730050
033400         10  PV-PREV-FWM-QTY        PIC S9(6)V9   COMP-3 VALUE 0. 03740050
033500*                                                                 03750050
033600 EJECT                                                            03760050
033700*                                                                 03770050
033800 01 PV-INPUT.                                                     03780050
033900     COPY MRRD017.                                                03790050
034000 EJECT                                                            03800050
034100 01 PV-OUTPUT.                                                    03810050
034200     COPY MRRD004O.                                               03820050
034300 EJECT                                                            03830050
034400     COPY DPWS024.                                                03840050
034500 EJECT                                                            03850050
034600     COPY DPWS500.                                                03860050
034700 EJECT                                                            03870050
034800     COPY MRRD001I.                                               03880050
034900 EJECT                                                            03890050
035000 01 PAN-BIM-FILE.                                                 03900050
035100     COPY IPFGBIC.                                                03910050
035200 EJECT                                                            03920050
035300 01  SYSTEM-RECORD.                                               03930050
035400     COPY ICI005C.                                                03940050
035500 EJECT                                                            03950050
035600     EXEC SQL                                                     03960050
035700         INCLUDE TMRISFL                                          03970050
035800     END-EXEC.                                                    03980050
035900 EJECT                                                            03990050
036000     EXEC SQL                                                     04000050
036100         INCLUDE TENTNME                                          04010050
036200     END-EXEC.                                                    04020050
036300 EJECT                                                            04030050
036400     EXEC SQL                                                     04040050
036500         INCLUDE TSKSTOO                                          04050050
036600     END-EXEC.                                                    04060050
036700 EJECT                                                            04070050
036800*    EXEC SQL                                                     04080050
036900*        INCLUDE TSTR000                                          04090050
037000*    END-EXEC.                                                    04100050
037100*EJECT                                                            04110050
036800     EXEC SQL                                                     04120050
036900         INCLUDE XMT00001                                         04130050
037000     END-EXEC.                                                    04140050
037100 EJECT                                                            04150050
037200     EXEC SQL                                                     04160050
037300         INCLUDE TVNDDPT                                          04170050
037400     END-EXEC.                                                    04180050
037500 EJECT                                                            04190050
037600     EXEC SQL                                                     04200050
037700         INCLUDE TSKSTWKS                                         04210050
037800     END-EXEC.                                                    04220050
037900 EJECT                                                            04230050
038000     EXEC SQL                                                     04240050
038100         INCLUDE TSKST                                            04250050
038200     END-EXEC.                                                    04260050
038300 EJECT                                                            04270050
038400     EXEC SQL                                                     04280050
038500         INCLUDE TMRITST                                          04290050
038600     END-EXEC.                                                    04300050
038700 EJECT                                                            04310050
038800     EXEC SQL                                                     04320050
038900         INCLUDE TUPCSKU                                          04330050
039000     END-EXEC.                                                    04340050
039100 EJECT                                                            04350050
039200     EXEC SQL                                                     04360050
039300         INCLUDE TRSPBAR                                          04370050
039400     END-EXEC.                                                    04380050
039500 EJECT                                                            04390050
039600     EXEC SQL                                                     04400050
039700         INCLUDE TMDSEAR                                          04410050
039800     END-EXEC.                                                    04420050
039900 EJECT                                                            04430050
040000* DB2 COMMUNICATION AREA                                          04440050
040100*                                                                 04450050
040200     EXEC SQL                                                     04460050
040300         INCLUDE SQLCA                                            04470050
040400     END-EXEC.                                                    04480050
040500 EJECT                                                            04490050
040600* DB2 COMMUNICATION AREA2                                         04500050
040700*                                                                 04510050
040800     COPY SQLCA2.                                                 04520050
040900 EJECT                                                            04530050
041000*                                                                 04540050
041100*                                                                 04550050
041200 LINKAGE SECTION.                                                 04560050
041300*** DATABASE PCB AREA ***                                         04570050
041400*                                                                 04580050
041500*** DEBIT MASTER DATABASE                                         04590050
041600*                                                                 04600050
041700***************************************************************** 04610050
041800*PROCEDURE DIVISION.                                              04620050
041900***************************************************************** 04630050
042000 PROCEDURE DIVISION.                                              04640050
042100*                                                                 04650050
042200 A000-MAINLINE-PROCESSING.                                        04660050
042300*                                                                 04670050
042400     PERFORM A100-INITIALIZATION.                                 04680050
042500*                                                                 04690050
042600     PERFORM B000-PROCESS-SYSTEM-RECORD                           04700050
042700             UNTIL EOF-TRANS-REC.                                 04710050
042800*                                                                 04720050
042900     PERFORM Y100-END-ROUTINE.                                    04730050
043000*                                                                 04740050
043100     GOBACK.                                                      04750050
043200*                                                                 04760050
043300 EJECT                                                            04770050
043400******************************************************************04780050
043500** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                 04790050
043600** CALL CALENDAR ROUTINES TO RETRIEVE VALUES NEEDED IN PROGRAM    04800050
043700******************************************************************04810050
043800 A100-INITIALIZATION.                                             04820050
043900*                                                                 04830050
044000*    DISPLAY 'A100-INITIALIZATION'.                               04840050
044100*                                                                 04850050
044200     OPEN  INPUT IC-CONTROL-FILE                                  04860050
044300           INPUT BIM-FILE                                         04870050
044400           INPUT TRANSFER-RECORD-IN                               04880050
044500          OUTPUT TRANSFER-RECORD.                                 04890050
044600*                                                                 04900050
044700     IF  PV-CONTROL-SUCCESSFUL OR                                 04910050
044800         PV-CONTROL-VERIFY                                        04920050
044900        CONTINUE                                                  04930050
045000     ELSE                                                         04940050
045100        MOVE 'A100-INITIALIATION' TO PV-PARAGRAPH-NAME            04950050
045200        MOVE 'IC-CONTROL-FILE'    TO PV-ERROR-FILE                04960050
045300        MOVE 'OPENING INPUT FILE' TO PV-ERROR-OPERATION           04970050
045400        MOVE 'BAD-OPEN'           TO PV-ERROR-STATUS              04980050
045500        MOVE  PV-CONTROL-STATUS   TO PV-VSAM-STATUS               04990050
045600        MOVE  '//////////////'    TO PV-NOT-FOUND-KEY             05000050
045700        PERFORM Z999-VSAM-ERROR                                   05010050
045800        MOVE +4005                TO PV-ABEND-CODE                05020050
045900        CALL 'ILBOABN0'        USING PV-ABEND-CODE                05030050
046000     END-IF.                                                      05040050
046100*                                                                 05050050
046200     IF  PV-BIM-SUCCESSFUL OR                                     05060050
046300         PV-BIM-VERIFY                                            05070050
046400        CONTINUE                                                  05080050
046500     ELSE                                                         05090050
046600        MOVE 'A100-INITIALIATION' TO PV-PARAGRAPH-NAME            05100050
046700        MOVE 'BIM-FILE'           TO PV-ERROR-FILE                05110050
046800        MOVE 'OPENING INPUT FILE' TO PV-ERROR-OPERATION           05120050
046900        MOVE 'BAD-OPEN'           TO PV-ERROR-STATUS              05130050
047000        MOVE  PV-BIM-STATUS       TO PV-VSAM-STATUS               05140050
047100        MOVE  '//////////////'    TO PV-NOT-FOUND-KEY             05150050
047200        PERFORM Z999-VSAM-ERROR                                   05160050
047300        MOVE +4005                TO PV-ABEND-CODE                05170050
047400        CALL 'ILBOABN0'        USING PV-ABEND-CODE                05180050
047500     END-IF.                                                      05190050
047600*                                                                 05200050
047700     ACCEPT PARAMETER-INPUT-RECORD.                               05210050
047800*                                                                 05220050
047900*  ##Y2K                                                          05230050
048000                                                                  05240050
048100     ACCEPT DPG51-SYSTEM-DATE-N FROM DATE.                        05250050
048200     MOVE DPG51-SYSTEM-DATE-YR TO PV-CURRENT-DATE-YR              05260050
048300                                  PC-YR.                          05270050
048400     MOVE DPG51-SYSTEM-DATE-MO TO PV-CURRENT-DATE-MO              05280050
048500                                  PC-MO.                          05290050
048600     MOVE DPG51-SYSTEM-DATE-DY TO PV-CURRENT-DATE-DY              05300050
048700                                  PC-DY.                          05310050
048800*    DISPLAY 'PC-DATE: ' PC-DATE.                                 05320050
048900     MOVE PC-DATE TO DPG52-LK-DATE-INPUT.                         05330050
049000                                                                  05340050
049100* ***********GET FIRST FISCAL DATE FROM SYSTEM DATE **********    05350050
049200* *                                                               05360050
049300     MOVE SPACES              TO DPG51-INCREMENT-DECREMENT-FLAG.  05370050
049400     MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             05380050
049500     SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           05390050
049600     PERFORM I000-CALENDAR-ROUTINE.                               05400050
049700     MOVE DPG56-FIRST-FD-GREG-FMT TO PV-TODAYS-DATE.              05410050
049800     MOVE DPG56-FISCAL-WEEK-NBR TO PV-TODAYS-WEEK.                05420050
049900*                                                                 05430050
050000     IF DPG51-SYSTEM-DATE-YR > 80                                 05440050
050100         MOVE PC-19           TO PV-CURRENT-DATE-CC               05450050
050200     ELSE                                                         05460050
050300         MOVE PC-20           TO PV-CURRENT-DATE-CC               05470050
050400     END-IF.                                                      05480050
050500*                                                                 05490050
050600     MOVE MR001I-S-SYS-ID   TO  S-SYS-ID.                         05500050
050700     MOVE PC-RCD-TYPE       TO  S-RCD-TYPE.                       05510050
050800     MOVE LOW-VALUES        TO  S-RCD-ID.                         05520050
050900     MOVE S-KEY             TO  ICCTL-KEY.                        05530050
051000     PERFORM R000-READ-CONTROL-FILE.                              05540050
051100*                                                                 05550050
051200     PERFORM T150-DATE-ROUTINE.                                   05560050
063400     MOVE PC-2 TO PV-BPN-SUB.                                     05570050
063500     PERFORM T155-UCYCLE-CALENDAR-ROUTINE.                        05580050
063600     MOVE PV-UCYCLE-MAX-DATE TO PV-UCYCLE5-MAX-DATE.              05590050
063700     MOVE PV-UCYCLE-MIN-DATE TO PV-UCYCLE5-MIN-DATE.              05600050
063400     MOVE PC-1 TO PV-BPN-SUB.                                     05601050
063500     PERFORM T155-UCYCLE-CALENDAR-ROUTINE.                        05602050
063600     MOVE PV-UCYCLE-MAX-DATE TO PV-UCYCLE9-MAX-DATE.              05603050
063700     MOVE PV-UCYCLE-MIN-DATE TO PV-UCYCLE9-MIN-DATE.              05604050
051300**************************************************************    05605050
051400**   THIS LOGIC IS OBSOLETE SINCE THE NEW PV-MIN-BOW-DATE AND     05606050
051500**   PV-MAX-BOW-DATE FIELDS ARE FILLED IN THE T150- ROUTINE.      05607050
051600**                                                                05608050
051700**   COMPUTE PV-MAX-WEEK-N =                                      05609050
051800**       (PV-MIN-WEEK-N + PV-F4-NBR-FISCAL-PERIOD-WKS) - 1.       05610050
051900***********************************************************       05620050
052000****   THIS IF STATEMENT CAN NEVER BE TRUE  ***************       05630050
052100**   IF PV-MAX-WEEK-N < 1                                         05640050
052200**       ADD PV-F4-NBR-FISCAL-WEEKS TO PV-MAX-WEEK-N              05650050
052300**       SUBTRACT 1                       FROM PV-MAX-YR          05660050
052400**   END-IF.                                                      05670050
052500***********************************************************       05680050
052600**   MOVE PV-MIN-WEEK               TO PV-MIN-WK.                 05690050
052700**   MOVE PV-MAX-WEEK               TO PV-MAX-WK.                 05700050
052800**                                                                05710050
052900     PERFORM R200-READ-TRANS-REC-IN.                              05720050
053000     IF EOF-TRANS-REC                                             05730050
053100         MOVE PC-Y             TO PS-NO-INPUT                     05740050
053200     ELSE                                                         05750050
053300         INITIALIZE PV-OUTPUT                                     05760050
053400         PERFORM D100-MOVE-TRANS-DATA                             05770050
053500         MOVE MR017-TR-SORT-FIELDS TO PV-PREV-FIELDS              05780050
053600*                                                                 05790050
053700         MOVE MR017-DEPT-NBR   TO VNDDPT-DEPT-NBR                 05800050
053800         MOVE MR017-VEND-NBR   TO VNDDPT-INHOUSE-NBR              05810050
053900         PERFORM T700-SELECT-VENDOR-NAME                          05820050
054000*                                                                 05830050
054100         MOVE MR017-DEPT-NBR   TO MDSEAR-DEPT-NBR                 05840050
054200         MOVE PC-DPT           TO MDSEAR-MDSELV-CDE               05850050
054300         PERFORM T800-SELECT-MDSEAR-DKEY                          05860050
054400         MOVE MDSEAR-DKEY      TO RSPBAR-MDSEAR-DKEY              05870050
054500         MOVE PC-BYR           TO RSPBAR-RSPLVL-CDE               05880050
054600         PERFORM T900-SELECT-BUYER-NAME                           05890050
054700*                                                                 05900050
054800         PERFORM T300-SELECT-PO-RECORD                            05910050
054900         PERFORM T000-SELECT-UPC-NUMBER                           05920050
055000         PERFORM C000-FORMAT-TRANSFER-REC                         05930050
055100     END-IF.                                                      05940050
055200*                                                                 05950050
055300 EJECT                                                            05960050
055400******************************************************************05970050
055500*  THIS IS THE MAIN CONTROLLING PARAGRAPH FOR PROCESSING THE     *05980050
055600*  SYSTEM RECORD.                                                *05990050
055700******************************************************************06000050
055800 B000-PROCESS-SYSTEM-RECORD.                                      06010050
055900*                                                                 06020050
056000*    DISPLAY 'B000-PROCESS-SYSTEM-RECORD'.                        06030050
056100*    DISPLAY ' CR DEPT:' MR017-DEPT-NBR 'PV DEPT:' PV-PREV-DEPT.  06040050
056200*    DISPLAY ' CR SKU:' MR017-SORT-SKU 'PV SKU:' PV-PREV-SKU.     06050050
056300*    DISPLAY ' CR STR:' MR017-STR-NBR 'PV STR:' PV-PREV-STORE.    06060050
056400*    DISPLAY ' CR WK:' MR017-WEEK-NBR 'PV WK:' PV-PREV-WEEK-NBR.  06070050
056500*                                                                 06080050
056600       IF MR017-DEPT-NBR = PV-PREV-DEPT                           06090050
056700         IF MR017-SORT-SKU = PV-PREV-SORT-SKU                     06100050
056800           IF MR017-STR-NBR = PV-PREV-STORE                       06110050
056900             PERFORM C100-ACCUM-FE-DETAIL                         06120050
057000           ELSE                                                   06130050
057100             PERFORM W000-WRITE-OUTPUT                            06140050
057200             PERFORM D100-MOVE-TRANS-DATA                         06150050
057300             PERFORM T300-SELECT-PO-RECORD                        06160050
057400             PERFORM C000-FORMAT-TRANSFER-REC                     06170050
057500           END-IF                                                 06180050
057600         ELSE                                                     06190050
057700                                                                  06200050
057800           PERFORM W000-WRITE-OUTPUT                              06210050
057900           PERFORM D100-MOVE-TRANS-DATA                           06220050
058000           MOVE MR017-DEPT-NBR       TO VNDDPT-DEPT-NBR           06230050
058100           MOVE MR017-VEND-NBR       TO VNDDPT-INHOUSE-NBR        06240050
058200*                                                                 06250050
058300           PERFORM T700-SELECT-VENDOR-NAME                        06260050
058400           PERFORM T000-SELECT-UPC-NUMBER                         06270050
058500           PERFORM T300-SELECT-PO-RECORD                          06280050
058600           PERFORM C000-FORMAT-TRANSFER-REC                       06290050
058700         END-IF                                                   06300050
058800       ELSE                                                       06310050
058900         PERFORM W000-WRITE-OUTPUT                                06320050
059000         PERFORM D100-MOVE-TRANS-DATA                             06330050
059100*                                                                 06340050
059200         MOVE MR017-DEPT-NBR       TO VNDDPT-DEPT-NBR             06350050
059300         MOVE MR017-VEND-NBR       TO VNDDPT-INHOUSE-NBR          06360050
059400         PERFORM T700-SELECT-VENDOR-NAME                          06370050
059500*                                                                 06380050
059600         MOVE MR017-DEPT-NBR       TO MDSEAR-DEPT-NBR             06390050
059700         MOVE PC-DPT               TO MDSEAR-MDSELV-CDE           06400050
059800         PERFORM T800-SELECT-MDSEAR-DKEY                          06410050
059900         MOVE MDSEAR-DKEY          TO RSPBAR-MDSEAR-DKEY          06420050
060000         MOVE PC-BYR               TO RSPBAR-RSPLVL-CDE           06430050
060100         PERFORM T900-SELECT-BUYER-NAME                           06440050
060200*                                                                 06450050
060300         PERFORM T000-SELECT-UPC-NUMBER                           06460050
060400         PERFORM T300-SELECT-PO-RECORD                            06470050
060500         PERFORM C000-FORMAT-TRANSFER-REC                         06480050
060600       END-IF.                                                    06490050
060700*                                                                 06500050
060800       MOVE MR017-TR-SORT-FIELDS TO PV-PREV-FIELDS.               06510050
060900       PERFORM R200-READ-TRANS-REC-IN.                            06520050
061000*                                                                 06530050
061100 EJECT                                                            06540050
061200******************************************************************06550050
061300*  MOVE VALUES TO OUTPUT FOR A REPLENISHMENT RUN(TYPE-CD = 1)    *06560050
061400******************************************************************06570050
061500 C000-FORMAT-TRANSFER-REC.                                        06580050
061600*                                                                 06590050
061700     PERFORM T100-SELECT-ONHAND-QTY.                              06600050
061800*                                                                 06610050
061900*    DISPLAY ' C000-FORMAT-TRANSFER-REC.'                         06620050
062000*    DISPLAY '  UCYCLE ' MR017-UCYCLE.                            06630050
062100*    DISPLAY 'PV-MAX-BOW-DATE ' PV-MAX-BOW-DATE.                  06640050
062200*    DISPLAY 'PV-MIN-BOW-DATE ' PV-MIN-BOW-DATE.                  06650050
062300*    DISPLAY 'PV-UCYCLE-MAX-DATE ' PV-UCYCLE-MAX-DATE.            06660050
062400*    DISPLAY 'PV-UCYCLE-MIN-DATE ' PV-UCYCLE-MIN-DATE.            06670050
062500                                                                  06680050
062600     IF MR017-UCYCLE = S-UCYCLE (3) AND                           06690050
062700       MR017-UCYCLE = PC-4                                        06700050
062800         MOVE PV-MAX-BOW-DATE TO PV-TSKSTWKS-MAX-DTE              06710050
062900         MOVE PV-MIN-BOW-DATE TO PV-TSKSTWKS-MIN-DTE              06720050
063000         PERFORM S600-SUM-CPS-QTY                                 06730050
063100     ELSE                                                         06740050
063200         IF MR017-UCYCLE = S-UCYCLE (2) AND                       06750050
063300           MR017-UCYCLE = PC-5                                    06760050
063400             MOVE PC-2                TO PV-BPN-SUB               06770050
063600             MOVE PV-UCYCLE5-MAX-DATE TO PV-TSKSTWKS-MAX-DTE      06780050
063700             MOVE PV-UCYCLE5-MIN-DATE TO PV-TSKSTWKS-MIN-DTE      06790050
063800             PERFORM S600-SUM-CPS-QTY                             06800050
063900         ELSE                                                     06810050
064000             MOVE PC-1                TO PV-BPN-SUB               06820050
064200             MOVE PV-UCYCLE9-MAX-DATE TO PV-TSKSTWKS-MAX-DTE      06830050
064300             MOVE PV-UCYCLE9-MIN-DATE TO PV-TSKSTWKS-MIN-DTE      06840050
064400             PERFORM S600-SUM-CPS-QTY                             06850050
064500         END-IF                                                   06860050
064600     END-IF.                                                      06870050
064700     MOVE SKSTWKS-SALES-UNIT-QTY TO PV-CPS-QTY.                   06880050
064800*                                                                 06890050
064900*    LOAD VALUES FROM THE TMRISHS TABLE                           06900050
065000*    TO HISTCPS, HISTOH, HISTDD, HISTMAD.                         06910050
065100*                                                                 06920050
065200     MOVE PC-1                TO PV-HIST-SUB.                     06930050
065300*                                                                 06940050
065400     PERFORM E000-LOAD-REPL-HIST                                  06950050
065500             VARYING PV-HIST-SUB                                  06960050
065600             FROM 1 BY 1                                          06970050
065700             UNTIL PV-HIST-SUB > PC-13.                           06980050
065800*                                                                 06990050
065900*    LOAD ZEROES TO HISTLYS                                       07000050
066000*                                                                 07010050
066100     MOVE PC-1 TO PV-HIST-SUB.                                    07020050
066200     PERFORM E300-LOAD-HISTLYS-QTY                                07030050
066300             UNTIL PV-HIST-SUB > PC-17.                           07040050
066400*                                                                 07050050
066500     MOVE MR017-PTAG     TO GBI-KEY-PTAG.                         07060050
066600     MOVE MR017-PTAG     TO BIM-FILE-KEY.                         07070050
066700     PERFORM R100-READ-BIM-FILE.                                  07080050
066800*                                                                 07090050
066900     PERFORM F000-FORMAT-TRAN-INPUT.                              07100050
067000*                                                                 07110050
067100     PERFORM H000-FORMAT-ROH-USER-AREA.                           07120050
067200*                                                                 07130050
067300*                                                                 07140050
067400******************************************************************07150050
067500*   ACCUMULATE MRISFE DETAIL                                      07160050
067600******************************************************************07170050
067700 C100-ACCUM-FE-DETAIL.                                            07180050
067800*                                                                 07190050
067900*    DISPLAY 'C100-ACCUM-FE-DETAIL'.                              07200050
068000*                                                                 07210050
068100     EVALUATE TRUE                                                07220050
068200     WHEN MR017-WEEK-NBR = PC-1P                                  07230050
068300      MOVE MR017-LFWM-QTY    TO MR004O-LFWM(1)                    07240050
068400      MOVE MR017-FWM-QTY     TO MR004O-FWM(1)                     07250050
068500     WHEN MR017-WEEK-NBR = PC-2P                                  07260050
068600      MOVE MR017-LFWM-QTY    TO MR004O-LFWM(2)                    07270050
068700      MOVE MR017-FWM-QTY     TO MR004O-FWM(2)                     07280050
068800     WHEN MR017-WEEK-NBR = PC-3P                                  07290050
068900      MOVE MR017-LFWM-QTY    TO MR004O-LFWM(3)                    07300050
069000      MOVE MR017-FWM-QTY     TO MR004O-FWM(3)                     07310050
069100     WHEN MR017-WEEK-NBR = PC-4P                                  07320050
069200      MOVE MR017-LFWM-QTY    TO MR004O-LFWM(4)                    07330050
069300      MOVE MR017-FWM-QTY     TO MR004O-FWM(4)                     07340050
069400     WHEN OTHER                                                   07350050
069500         CONTINUE                                                 07360050
069600     END-EVALUATE.                                                07370050
069700*                                                                 07380050
069800******************************************************************07390050
069900*   ACCUMULATE MRISFE DETAIL                                      07400050
070000******************************************************************07410050
070100 D100-MOVE-TRANS-DATA.                                            07420050
070200*                                                                 07430050
070300*    DISPLAY 'D100-MOVE-TRANS-DATA'.                              07440050
070400*                                                                 07450050
070500     MOVE MR017-UCYCLE           TO MR004O-UCYCLE.                07460050
070600     MOVE MR017-WN               TO MR004O-WN.                    07470050
070700     MOVE MR017-DN               TO MR004O-DN.                    07480050
070800     MOVE MR017-CADL             TO MR004O-CADL.                  07490050
070900*WR20601 FIX   PUT CODE BACK THAT WAS DELETED.  START             07500050
071000     MOVE MR017-IDFL             TO MR004O-IDFL.                  07510050
071100     MOVE MR017-HIDFL            TO MR004O-HIDFL.                 07520050
071200     MOVE MR017-LODFL            TO MR004O-LODFL.                 07530050
071300     MOVE MR017-NDFL             TO MR004O-NDFL.                  07540050
071400     MOVE MR017-MINSMK           TO MR004O-MINSMK.                07550050
071500     MOVE MR017-MAXSMK           TO MR004O-MAXSMK.                07560050
071600     MOVE MR017-DAMP             TO MR004O-DAMP.                  07570050
071700     MOVE MR017-TSL              TO MR004O-TSL.                   07580050
071800*WR20601 FIX   PUT CODE BACK THAT WAS DELETED.  END               07590050
071900     MOVE MR017-BYPDDU           TO MR004O-BYPDDU.                07600050
072000     MOVE MR017-BYPSCL           TO MR004O-BYPSCL.                07610050
072100     MOVE MR017-FRCDDU           TO MR004O-FRCDDU.                07620050
072200     MOVE MR017-BYPZSL           TO MR004O-BYPZSL.                07630050
072300     MOVE MR017-BYPTFP           TO MR004O-BYPTFP.                07640050
072400     MOVE MR017-BYPZOH           TO MR004O-BYPZOH.                07650050
072500     MOVE MR017-BYPBEF           TO MR004O-BYPBEF.                07660050
072600     MOVE MR017-BYPAFT           TO MR004O-BYPAFT.                07670050
072700     MOVE MR017-LUMPSW           TO MR004O-LUMPSW.                07680050
072800     MOVE MR017-MINBI            TO MR004O-MINBI.                 07690050
072900     MOVE MR017-DDFTSW           TO MR004O-DDFTSW.                07700050
073000     MOVE MR017-HIPCT            TO MR004O-HIPCT.                 07710050
073100     MOVE MR017-LOPCT            TO MR004O-LOPCT.                 07720050
073200     MOVE MR017-MINDD            TO MR004O-MINDD.                 07730050
073300     MOVE MR017-HIMADP           TO MR004O-HIMADP.                07740050
073400     MOVE MR017-LOMADP           TO MR004O-LOMADP.                07750050
073500     MOVE MR017-RT               TO MR004O-RT.                    07760050
073600     MOVE MR017-RTF              TO MR004O-RTF.                   07770050
073700     MOVE MR017-ZOPSW            TO MR004O-ZOPSW.                 07780050
073800     MOVE MR017-OUTLSW           TO MR004O-OUTLSW.                07790050
073900     MOVE MR017-ZSSTOCK          TO MR004O-ZSSTOCK.               07800050
074000     MOVE MR017-PACKSW           TO MR004O-PACKSW.                07810050
074100     MOVE MR017-DSER             TO MR004O-DSER.                  07820050
074200     MOVE MR017-PTAG             TO MR004O-PTAG.                  07830050
074300     MOVE MR017-LT               TO MR004O-LT.                    07840050
074400     MOVE MR017-ICOST            TO MR004O-ICOST.                 07850050
074500     MOVE MR017-OO               TO MR004O-OO.                    07860050
074600     MOVE MR017-COMSTK           TO MR004O-COMSTK.                07870050
074700     MOVE MR017-SPOQSW           TO MR004O-SPOQSW.                07880050
074800     MOVE MR017-SPOQ             TO MR004O-SPOQ.                  07890050
074900     MOVE MR017-INAME            TO MR004O-INAME.                 07900050
075000     MOVE MR017-DEPT-NBR         TO MR004O-H-DEPT.                07910050
075100     MOVE MR017-CLASS-NBR        TO MR004O-H-CLASS.               07920050
075200     MOVE MR017-SKU              TO MR004O-SKU.                   07930050
075300     MOVE MR017-UPC              TO MR004O-UPC.                   07940050
075400     MOVE MR017-FT               TO MR004O-FT.                    07950050
075500     MOVE MR017-OSTRAT           TO MR004O-OSTRAT.                07960050
075600     MOVE MR017-PACKSZ           TO MR004O-PACKSZ.                07970050
075700     MOVE MR017-IMIN             TO MR004O-IMIN.                  07980050
075800     MOVE MR017-IMAX             TO MR004O-IMAX.                  07990050
075900     MOVE MR017-CSTOCK           TO MR004O-CSTOCK.                08000050
076000     MOVE MR017-SSADJ            TO MR004O-SSADJ.                 08010050
076100     MOVE MR017-MINOUTL          TO MR004O-MINOUTL.               08020050
076200     MOVE MR017-MAXOUTL          TO MR004O-MAXOUTL.               08030050
076300     MOVE MR017-MAXOQP           TO MR004O-MAXOQP.                08040050
076400     MOVE MR017-FOQ              TO MR004O-FOQ.                   08050050
076500     MOVE MR017-TMIN             TO MR004O-TMIN.                  08060050
076600     MOVE MR017-USERMIN          TO MR004O-USERMIN.               08070050
076700     MOVE MR017-USERMAX          TO MR004O-USERMAX.               08080050
076800     MOVE MR017-DD               TO MR004O-DD.                    08090050
076900     MOVE MR017-DDI              TO MR004O-DDI.                   08100050
077000     MOVE MR017-LPP              TO MR004O-LPP.                   08110050
077100     MOVE MR017-MADSS            TO MR004O-MADSS.                 08120050
077200     MOVE MR017-FWMAD            TO MR004O-FWMAD.                 08130050
077300     MOVE MR017-TRNDP            TO MR004O-TRNDP.                 08140050
077400     MOVE MR017-MSDTS            TO MR004O-MSDTS.                 08150050
077500     MOVE MR017-MADTS            TO MR004O-MADTS.                 08160050
077600     MOVE MR017-LTVFACT          TO MR004O-LTVFACT.               08170050
077700     MOVE MR017-PCTZ             TO MR004O-PCTZ.                  08180050
077800     MOVE MR017-MADSTAT          TO MR004O-MADSTAT.               08190050
077900     MOVE MR017-DFLREG           TO MR004O-DFLREG.                08200050
078000     MOVE MR017-TSREG            TO MR004O-TSREG.                 08210050
078100     MOVE MR017-DIREG            TO MR004O-DIREG.                 08220050
078200     MOVE MR017-BYPREG           TO MR004O-BYPREG.                08230050
078300     MOVE MR017-LDD              TO MR004O-LDD.                   08240050
078400     MOVE MR017-LDDI             TO MR004O-LDDI.                  08250050
078500     MOVE MR017-LMADSS           TO MR004O-LMADSS.                08260050
078600     MOVE MR017-OUTSTAT          TO MR004O-OUTSTAT.               08270050
078700     MOVE MR017-LRTFCST          TO MR004O-LRTFCST.               08280050
078800     MOVE MR017-ORDSTAT          TO MR004O-ORDSTAT.               08290050
078900     MOVE MR017-DDUPRM           TO MR004O-DDUPRM.                08300050
079000     PERFORM D200-MOVE-CST-MIN-MAX                                08310050
079100        VARYING PV-CST-SUB                                        08320050
079200        FROM 1 BY 1                                               08330050
079300        UNTIL  PV-CST-SUB > PC-6.                                 08340050
079400                                                                  08350050
079500     MOVE MR017-FTJOPF           TO MR004O-FTJOPF.                08360050
079600     MOVE MR017-COST-UNIT-MSMT   TO MR004O-COST-UNIT-MSMT.        08370050
079700     MOVE MR017-RTL-UNIT-MSMT    TO MR004O-RTL-UNIT-MSMT.         08380050
079800     MOVE MR017-CUR-UNIT-RTL-AMT TO MR004O-CUR-UNIT-RTL-AMT.      08390050
079900     MOVE MR017-GR-RTL-AMT       TO MR004O-GR-RTL-AMT.            08400050
080000     MOVE MR017-GR-QTY           TO MR004O-GR-QTY.                08410050
080100     MOVE MR017-MERCH-DIV-CODE   TO MR004O-MERCH-DIV-CODE.        08420050
080200     MOVE MR017-DMM-NBR          TO MR004O-DMM-NBR.               08430050
080300     MOVE SPACES                 TO MR004O-SEQ-NBR.               08440050
080400*                                                                 08450050
080500******************************************************************08460050
080600 D200-MOVE-CST-MIN-MAX.                                           08470050
080700*                                                                 08480050
080800*    DISPLAY 'D200-MOVE-CST-MIN-MAX'.                             08490050
080900*                                                                 08500050
081000     MOVE MR017-CSTKMINT (PV-CST-SUB)                             08510050
081100                                 TO MR004O-CSTKMINT(PV-CST-SUB).  08520050
081200     MOVE MR017-CSTKMAXT (PV-CST-SUB)                             08530050
081300                                 TO MR004O-CSTKMAXT(PV-CST-SUB).  08540050
081400*                                                                 08550050
081500******************************************************************08560050
081600*  REPLENISHMENT QUANTITY FIELDS : CPS, OH, MAD, & DD.            08570050
081700*-----------------------------------------------------------------08580050
081800*  THERE ARE 13 OCCURANCES AND THE MAKEUP OF THESE SHOULD BE:     08590050
081900*        OCCURANCE 1  - TNOW-WN - 1                               08600050
082000*        OCCURANCE 2  - TNOW-WN - 2                               08610050
082100*        OCCURANCE 3  - TNOW-WN - 3                               08620050
082200*        OCCURANCE 4  - TNOW-WN - 4                               08630050
082300*        OCCURANCE 5  - TNOW-WN - 5                               08640050
082400*        OCCURANCE 6  - TNOW-WN - 6                               08650050
082500*        OCCURANCE 7  - TNOW-WN - 7                               08660050
082600*        OCCURANCE 8  - TNOW-WN - 8                               08670050
082700*        OCCURANCE 9  - TNOW-WN - 9                               08680050
082800*        OCCURANCE 10 - TNOW-WN - 10                              08690050
082900*        OCCURANCE 11 - TNOW-WN - 11                              08700050
083000*        OCCURANCE 12 - TNOW-WN - 12                              08710050
083100*        OCCURANCE 13 - TNOW-WN - 13                              08720050
083200******************************************************************08730050
083300*                                                                 08740050
083400*                                                                 08750050
083500 E000-LOAD-REPL-HIST.                                             08760050
083600*                                                                 08770050
083700*    DISPLAY 'E000-LOAD-REPL-HIST'.                               08780050
083800*                                                                 08790050
083900         MOVE MR017-HISTBPN(PV-HIST-SUB)                          08800050
084000                               TO  MR004O-HISTBPN(PV-HIST-SUB).   08810050
084100         MOVE MR017-HISTCPS(PV-HIST-SUB)                          08820050
084200                               TO  MR004O-HISTCPS(PV-HIST-SUB).   08830050
084300         MOVE MR017-HISTMAD(PV-HIST-SUB)                          08840050
084400                               TO  MR004O-HISTMAD(PV-HIST-SUB).   08850050
084500         MOVE MR017-HISTOH(PV-HIST-SUB)                           08860050
084600                               TO  MR004O-HISTOH(PV-HIST-SUB).    08870050
084700         MOVE MR017-HISTDD(PV-HIST-SUB)                           08880050
084800                               TO  MR004O-HISTDD(PV-HIST-SUB).    08890050
084900*                                                                 08900050
085000******************************************************************08910050
085100*  LAST YEAR SALES HISTORY QUANTITIES.                            08920050
085200*-----------------------------------------------------------------08930050
085300*  THERE ARE 17 OCCURANCES AND THE MAKEUP OF THESE SHOULD BE:     08940050
085400*        OCCURANCE 1 - TNOW-WN + 2                                08950050
085500*        OCCURANCE 2 - TNOW-WN + 1                                08960050
085600*        OCCURANCE 3 - TNOW-WN                                    08970050
085700*        OCCURANCE 4 - TNOW-WN  OR IF UCYCLE = 4, TOTAL OF WEEKS I08980050
085800*                                  THE PERIOD ( 4 OR 5 WEEKS)     08990050
085900*        OCCURANCE 5 - TNOW-WN - 1                                09000050
086000*        OCCURANCE 6 - TNOW-WN - 2                                09010050
086100*        OCCURANCE 7 - TNOW-WN - 3                                09020050
086200*        OCCURANCE 8 - TNOW-WN - 4                                09030050
086300*        OCCURANCE 9 - TNOW-WN - 5                                09040050
086400*        OCCURANCE 10 - TNOW-WN - 6                               09050050
086500*        OCCURANCE 11 - TNOW-WN - 7                               09060050
086600*        OCCURANCE 12 - TNOW-WN - 8                               09070050
086700*        OCCURANCE 13 - TNOW-WN - 9                               09080050
086800*        OCCURANCE 14 - TNOW-WN - 10                              09090050
086900*        OCCURANCE 15 - TNOW-WN - 11                              09100050
087000*        OCCURANCE 16 - TNOW-WN - 12                              09110050
087100*        OCCURANCE 17 - TNOW-WN - 13                              09120050
087200******************************************************************09130050
087300 E300-LOAD-HISTLYS-QTY.                                           09140050
087400*                                                                 09150050
087500*    DISPLAY 'E300-LOAD-HISTLYS-QTY'.                             09160050
087600*                                                                 09170050
087700        MOVE ZEROES         TO  MR004O-HISTLYS(PV-HIST-SUB).      09180050
087800        ADD PC-1            TO  PV-HIST-SUB.                      09190050
087900*                                                                 09200050
088000*                                                                 09210050
088100******************************************************************09220050
088200*  MOVE VALUES INTO THE TRANSFER-RECORD LAYOUT FOR OUTPUT         09230050
088300******************************************************************09240050
088400 F000-FORMAT-TRAN-INPUT.                                          09250050
088500*                                                                 09260050
088600*    DISPLAY 'F000-FORMAT-TRAN-INPUT'.                            09270050
088700*                                                                 09280050
088800*                                                                 09290050
088900     MOVE PC-1                        TO PV-BIM-SUB,              09300050
089000                                         PV-WBI-SUB,              09310050
089100                                         PV-MBI-SUB,              09320050
089200                                         PV-BIM-SUB2.             09330050
089300     PERFORM F100-MOVE-BIM-AMOUNTS VARYING PV-BIM-SUB             09340050
089400             FROM 1 BY 1 UNTIL PV-BIM-SUB > PC-52.                09350050
089500     PERFORM F200-MOVE-MTHLY-BIM   VARYING PV-BIM-SUB2            09360050
089600             FROM 1 BY 1 UNTIL PV-BIM-SUB2 > PC-13.               09370050
089700     MOVE PV-CPS-QTY                  TO MR004O-CPS.              09380050
089800     MOVE TSKST-ONHAND-QTY            TO MR004O-OH.               09390050
089900     MOVE PV-OO                       TO MR004O-OO.               09400050
090000*                                                                 09410050
090100     MOVE TUPCSKU-UPC-NBR             TO MR004O-UPC.              09420050
090200*                                                                 09430050
090300******************************************************************09440050
090400*  MOVE WEEKLY AMOUNTS FROM THE BIM FILE TO THE TRANSFER RECORD   09450050
090500******************************************************************09460050
090600 F100-MOVE-BIM-AMOUNTS.                                           09470050
090700*                                                                 09480050
090800*    DISPLAY 'F100-MOVE-BIM-AMOUNTS'.                             09490050
090900*                                                                 09500050
091000     MOVE GBI-BI-WEEK(PV-BIM-SUB)     TO MR004O-WBI(PV-WBI-SUB).  09510050
091100*                                                                 09520050
091200     ADD PC-PLUS-1                    TO PV-WBI-SUB.              09530050
091300*                                                                 09540050
091400******************************************************************09550050
091500*  MOVE MONTHLY AMOUNTS FROM THE BIM FILE TO THE TRANSFER RECORD  09560050
091600******************************************************************09570050
091700 F200-MOVE-MTHLY-BIM.                                             09580050
091800*                                                                 09590050
091900*    DISPLAY 'F100-MOVE-MTHLY-BIM  '.                             09600050
092000*                                                                 09610050
092100     MOVE GBI-BI-MNTH(PV-BIM-SUB2)    TO MR004O-MBI(PV-MBI-SUB).  09620050
092200*                                                                 09630050
092300     ADD PC-PLUS-1                    TO PV-MBI-SUB.              09640050
092400*                                                                 09650050
092500*                                                                 09660050
092600******************************************************************09670050
092700*   MOVE APPROPRIATE FIELDS TO THE HEADER USER AREA FOR OUTPUT    09680050
092800******************************************************************09690050
092900 H000-FORMAT-ROH-USER-AREA.                                       09700050
093000*                                                                 09710050
093100*    DISPLAY 'H000-FORMAT-ROH-USER-AREA'.                         09720050
093200*                                                                 09730050
093300*    MOVE DMIVDRNM                    TO MR004O-H-VENDOR-NAME.    09740050
093400     MOVE ENTNME-ENT-NAME-DESC        TO MR004O-H-VENDOR-NAME.    09750050
093500     MOVE MDSEAR-BYR-NBR              TO MR004O-H-BUYER-ID.       09760050
093600     MOVE PV-BYR-NAME                 TO MR004O-H-BUYER-NAME.     09770050
093700*                                                                 09780050
093800******************************************************************09790050
093900*  THIS PARAGRAPH CALLS THE CALENDAR ROUTINE                      09800050
094000******************************************************************09810050
094100 I000-CALENDAR-ROUTINE.                                           09820050
094200*                                                                 09830050
094300*    DISPLAY 'I000-CALENDAR-ROUTINE'.                             09840050
094400*                                                                 09850050
094500     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       09860050
094600                                DPG53 DPG54                       09870050
094700                                DPG55 DPG56.                      09880050
094800     EVALUATE TRUE                                                09890050
094900     WHEN DPG54-SEVERE-ERROR                                      09900050
095000         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               09910050
095100         DISPLAY DPG54-ERROR-MESSAGE                              09920050
095200         DISPLAY 'INPUT DATE: '  DPG52-LK-DATE-INPUT              09930050
095300         CALL 'ILBOABN0'        USING PV-ABEND-CODE               09940050
095400     WHEN DPG54-WARNING-ERROR                                     09950050
095500         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              09960050
095600         DISPLAY DPG54-ERROR-MESSAGE                              09970050
095700     WHEN DPG54-NO-ERROR                                          09980050
095800         CONTINUE                                                 09990050
095900     END-EVALUATE.                                                10000050
096000*                                                                 10010050
096100******************************************************************10020050
096200* THIS SECTION READS THE VSAM SYSTEM RECORD                      *10030050
096300******************************************************************10040050
096400 R000-READ-CONTROL-FILE.                                          10050050
096500*                                                                 10060050
096600*    DISPLAY 'R000-READ-CONTROL-FILE'.                            10070050
096700*                                                                 10080050
096800      READ IC-CONTROL-FILE INTO  SYSTEM-RECORD                    10090050
096900                                KEY IS ICCTL-KEY.                 10100050
097000*                                                                 10110050
097100     IF  PV-CONTROL-SUCCESSFUL OR                                 10120050
097200         PV-CONTROL-VERIFY                                        10130050
097300*       DISPLAY 'BPN-1: ' S-BPN(1)                                10140050
097400*       DISPLAY 'BPN-2: ' S-BPN(2)                                10150050
097500*       DISPLAY 'BPN-3: ' S-BPN(3)                                10160050
097600*       DISPLAY 'BPN-4: ' S-BPN(4)                                10170050
097700*       DISPLAY 'BPN-5: ' S-BPN(5)                                10180050
097800*       DISPLAY 'BPN-6: ' S-BPN(6)                                10190050
097900        CONTINUE                                                  10200050
098000     ELSE                                                         10210050
098100        MOVE 'R000-READ-CONTROL-FILE' TO PV-PARAGRAPH-NAME        10220050
098200        MOVE 'IC-CONTROL-FILE'        TO PV-ERROR-FILE            10230050
098300        MOVE 'READING INPUT FILE'     TO PV-ERROR-OPERATION       10240050
098400        MOVE 'BAD-READ'               TO PV-ERROR-STATUS          10250050
098500        MOVE  PV-CONTROL-STATUS       TO PV-VSAM-STATUS           10260050
098600        MOVE  ICCTL-KEY               TO PV-NOT-FOUND-KEY         10270050
098700            IF PV-NO-REC-FOUND                                    10280050
098800               PERFORM Z999-VSAM-ERROR                            10290050
098900               MOVE +4002  TO        PV-ABEND-CODE                10300050
099000               CALL 'ILBOABN0' USING PV-ABEND-CODE                10310050
099100            ELSE                                                  10320050
099200               PERFORM Z999-VSAM-ERROR                            10330050
099300               MOVE +4008         TO PV-ABEND-CODE                10340050
099400               CALL 'ILBOABN0' USING PV-ABEND-CODE                10350050
099500            END-IF                                                10360050
099600     END-IF.                                                      10370050
099700*                                                                 10380050
099800     ADD PC-PLUS-1 TO PV-SYSTEM-INPUT-CNT.                        10390050
099900*                                                                 10400050
100000 EJECT                                                            10410050
100100******************************************************************10420050
100200* THIS SECTION READS THE VSAM SYSTEM RECORD                      *10430050
100300******************************************************************10440050
100400 R100-READ-BIM-FILE.                                              10450050
100500*                                                                 10460050
100600*    DISPLAY 'R100-READ-BIM-FILE'.                                10470050
100700*                                                                 10480050
100800     READ BIM-FILE        INTO  PAN-BIM-FILE                      10490050
100900                                KEY IS BIM-FILE-KEY.              10500050
101000*                                                                 10510050
101100     IF  PV-BIM-SUCCESSFUL OR                                     10520050
101200         PV-BIM-VERIFY                                            10530050
101300        CONTINUE                                                  10540050
101400     ELSE                                                         10550050
101500        MOVE  PV-BIM-STATUS       TO PV-VSAM-STATUS               10560050
101600        MOVE  SPACES              TO PV-NOT-FOUND-KEY             10570050
101700            IF PV-NO-REC-FOUND                                    10580050
101800               CONTINUE                                           10590050
101900*              DISPLAY '** MESSAGE IS '                           10600050
102000*              'RECORD NOT FOUND, STATUS IS ' PV-VSAM-STATUS      10610050
102100*              ' BIM KEY: ' GBI-KEY-PTAG                          10620050
102200            ELSE                                                  10630050
102300               MOVE 'R100-READ-BIM-FILE' TO PV-PARAGRAPH-NAME     10640050
102400               MOVE 'BIM-FILE'           TO PV-ERROR-FILE         10650050
102500               MOVE 'READING INPUT FILE' TO PV-ERROR-OPERATION    10660050
102600               MOVE 'BAD-READ'           TO PV-ERROR-STATUS       10670050
102700               MOVE  GBI-KEY-PTAG        TO PV-NOT-FOUND-KEY      10680050
102800               PERFORM Z999-VSAM-ERROR                            10690050
102900               MOVE +4008           TO PV-ABEND-CODE              10700050
103000               CALL 'ILBOABN0'   USING PV-ABEND-CODE              10710050
103100            END-IF                                                10720050
103200     END-IF.                                                      10730050
103300*                                                                 10740050
103400     ADD PC-PLUS-1 TO PV-SYSTEM-INPUT-CNT.                        10750050
103500*                                                                 10760050
103600 EJECT                                                            10770050
103700******************************************************************10780050
103800* THIS SECTION READS THE VSAM SYSTEM RECORD                      *10790050
103900******************************************************************10800050
104000 R200-READ-TRANS-REC-IN.                                          10810050
104100*                                                                 10820050
104200*    DISPLAY 'R200-READ-TRANS-REC-IN'.                            10830050
104300*                                                                 10840050
104400     READ TRANSFER-RECORD-IN INTO  PV-INPUT                       10850050
104500       AT END MOVE PC-Y TO PS-EOF-TRANS-REC.                      10860050
104600*                                                                 10870050
104700     ADD PC-PLUS-1 TO PV-TRANS-INPUT-CNT.                         10880050
104800*                                                                 10890050
104900 EJECT                                                            10900050
105000******************************************************************10910050
105100*  THIS PARAGRAPH SUMS THE CURRENT PERIOD SALES FOR LYS WHEN     *10920050
105200*  THE UCYCLE CODE = 4(MONTHLY)                                  *10930050
105300******************************************************************10940050
105400 S600-SUM-CPS-QTY.                                                10950050
105500*                                                                 10960050
105600*    DISPLAY 'S600-SUM-CPS-QTY'.                                  10970050
105700*                                                                 10980050
105800     MOVE 'S600'                   TO PGM-LOCATION.               10990050
105900     MOVE 'S600-SUM-CPS-QTY        '                              11000050
106000                                   TO PV-ABEND-PARAGRAPH.         11010050
106100                                                                  11020050
106100                                                                  11030050
106200     INITIALIZE SKSTWKS-SALES-UNIT-QTY.                           11040050
106300     MOVE MR017-ITEM-NBR TO SKSTWKS-ITEM-NMBR.                    11050050
106400     MOVE MR017-STR-NBR  TO SKSTWKS-STR-NBR.                      11060053
 06400*    MOVE MR017-STR-NBR  TO PV-9-5                                11061051
106400*    MOVE PV-X-3         TO SKSTWKS-STORE-NMBR.                   11070051
106500*    DISPLAY 'ITEM NBR: ' SKSTWKS-ITEM-NMBR.                      11080050
106600*    DISPLAY 'STORE NBR: ' SKSTWKS-STORE-NMBR.                    11090050
106700*    DISPLAY 'MIN WEEK: ' PV-TSKSTWKS-MIN-DTE.                    11091050
106800*    DISPLAY 'MAX WEEK: ' PV-TSKSTWKS-MAX-DTE.                    11092050
106900                                                                  11093050
107000**     DISPLAY 'MIN DATE: ' PV-TSKSTWKS-MIN-DTE                   11094050
107100**     DISPLAY 'MAX DATE: ' PV-TSKSTWKS-MAX-DTE                   11095050
107200*                                                                 11096050
107300     EXEC SQL                                                     11097050
107400         SELECT SUM(SALES_UNIT_QTY)                               11098050
107500           INTO :SKSTWKS-SALES-UNIT-QTY                           11099050
107600                :PV-NULL-HISTCPS-QTY                              11099150
107700           FROM TSKSTWKS                                          11099250
107800          WHERE FSCL_BOW_DTE BETWEEN :PV-TSKSTWKS-MIN-DTE         11099350
107900                               AND  :PV-TSKSTWKS-MAX-DTE          11099450
108000            AND ITEM_NMBR = :SKSTWKS-ITEM-NMBR                    11099550
108100            AND STR_NBR  = :SKSTWKS-STR-NBR                       11099654
108200     END-EXEC.                                                    11099750
108300                                                                  11099850
108400     EVALUATE TRUE                                                11099950
108500       WHEN SQLCODE         = ZERO                                11100050
108600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    11100150
108700         CONTINUE                                                 11100250
108800       WHEN OTHER                                                 11100350
108900         DISPLAY PV-ABEND-PARAGRAPH                               11100450
109000         PERFORM Z999-SQL-ERROR                                   11100550
109100     END-EVALUATE.                                                11100650
109200*                                                                 11100750
109300******************************************************************11100850
109400* THIS PARAGRAPH SELECTS THE UPC NUMBER FOR OUTPUT               *11100950
109500******************************************************************11101050
109600 T000-SELECT-UPC-NUMBER.                                          11102050
109700*                                                                 11103050
109800*    DISPLAY 'T000-SELECT-UPC-NUMBER'.                            11104050
109900*                                                                 11105050
110000     MOVE 'T000'                   TO PGM-LOCATION.               11106050
110100     MOVE 'T000-SELECT-UPC-NUMBER'                                11107050
110200                                   TO PV-ABEND-PARAGRAPH.         11108050
110300     MOVE MR017-ITEM-NBR TO TUPCSKU-ITEM-NBR.                     11109050
110400     ADD  PC-1           TO PV-ITEM-COUNT.                        11110050
110500     MOVE PC-Y TO TUPCSKU-EDI-ORD-IND                             11120050
110600*                                                                 11130050
110700     EXEC SQL                                                     11140050
110800       SELECT UPC_NBR                                             11150050
110900         INTO :TUPCSKU-UPC-NBR                                    11160050
111000         FROM TUPCSKU                                             11170050
111100        WHERE ITEM_NBR = :TUPCSKU-ITEM-NBR                        11180050
111200          AND EDI_ORD_IND = :TUPCSKU-EDI-ORD-IND                  11190050
111300     END-EXEC.                                                    11200050
111400*                                                                 11210050
111500     EVALUATE TRUE                                                11220050
111600       WHEN SQLCODE         = ZERO                                11230050
111700         CONTINUE                                                 11240050
111800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    11250050
111900         MOVE ZEROES TO TUPCSKU-UPC-NBR                           11260050
112000       WHEN OTHER                                                 11270050
112100         DISPLAY PV-ABEND-PARAGRAPH                               11280050
112200         DISPLAY 'ITEM NBR: ' TUPCSKU-ITEM-NBR                    11290050
112300         DISPLAY 'UPC NBR: ' TUPCSKU-UPC-NBR                      11300050
112400         PERFORM Z999-SQL-ERROR                                   11310050
112500     END-EVALUATE.                                                11320050
112600*                                                                 11330050
112700 EJECT                                                            11340050
112800******************************************************************11350050
112900*  THIS PARAGRAPH SELECTS THE ON-HAND QUANTITY FOR OUTPUT        *11360050
113000******************************************************************11370050
113100 T100-SELECT-ONHAND-QTY.                                          11380050
113200*                                                                 11390050
113300*    DISPLAY 'T100-SELECT-ONHAND-QTY'.                            11400050
113400*                                                                 11410050
113500     MOVE 'T100'                   TO PGM-LOCATION.               11420050
113600     MOVE 'T100-SELECT-ONHAND-QTY'                                11430050
113700                                   TO PV-ABEND-PARAGRAPH.         11440050
113800     MOVE MR017-ITEM-NBR TO TSKST-ITEM-NMBR.                      11450050
113900     MOVE MR017-STR-NBR  TO TSKST-LOC-NBR                         11460050
114000*                                                                 11470050
114100     IF MR017-STR-NBR EQUAL PC-CORPORATE-STORE                    11480050
114200         PERFORM T110-SUM-ONHAND-QTY                              11490050
114300     ELSE                                                         11500050
114400         PERFORM T120-SELECT-ONHAND-QTY                           11510050
114500     END-IF.                                                      11520050
114600*                                                                 11530050
114700******************************************************************11540050
114800*  THIS PARAGRAPH SUMS THE ON-HAND QUANTITY FOR THE CORPORATE STR*11550050
114900******************************************************************11560050
115000 T110-SUM-ONHAND-QTY.                                             11570050
115100*                                                                 11580050
115200*    DISPLAY 'T110-SUM-ONHAND-QTY'.                               11590050
115300*                                                                 11600050
115400     MOVE 'T110'                   TO PGM-LOCATION.               11610050
115500     MOVE 'T110-SUM-ONHAND-QTY'                                   11620050
115600                                   TO PV-ABEND-PARAGRAPH.         11630050
115700*                                                                 11640050
115800     EXEC SQL                                                     11650050
115900       SELECT SUM(ONHAND_QTY)                                     11660050
116000         INTO :TSKST-ONHAND-QTY                                   11670050
116100         FROM TSKST   A,                                          11680050
116200              TMRITST B                                           11690050
116300        WHERE ITEM_NMBR  = :TSKST-ITEM-NMBR                       11700050
116400          AND A.ITEM_NMBR  = B.ITEM_NBR                           11710050
116500          AND A.LOC_NBR    = B.STR_NBR                            11720050
116600          AND A.LOC_NBR    <>  0                                  11730050
116700          AND A.ONHAND_QTY > 0                                    11740050
116800     END-EXEC.                                                    11750050
116900*                                                                 11760050
117000     EVALUATE TRUE                                                11770050
117100       WHEN SQLCODE         = ZERO                                11780050
117200            IF TSKST-ONHAND-QTY < ZERO                            11790050
117300               MOVE ZERO TO TSKST-ONHAND-QTY                      11800050
117400            END-IF                                                11810050
117500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    11820050
117600       WHEN SQLCODE         = -305                                11830050
117700         MOVE ZEROES        TO TSKST-ONHAND-QTY                   11840050
117800       WHEN OTHER                                                 11850050
117900         DISPLAY PV-ABEND-PARAGRAPH                               11860050
118000         PERFORM Z999-SQL-ERROR                                   11870050
118100     END-EVALUATE.                                                11880050
118200*                                                                 11890050
118300******************************************************************11900050
118400*  THIS PARAGRAPH SELECTS THE ON-HAND QUANTITY FOR OUTPUT        *11910050
118500******************************************************************11920050
118600 T120-SELECT-ONHAND-QTY.                                          11930050
118700*                                                                 11940050
118800*    DISPLAY 'T120-SELECT-ONHAND-QTY'.                            11950050
118900*                                                                 11960050
119000     MOVE 'T120'                   TO PGM-LOCATION.               11970050
119100     MOVE 'T120-SELECT-ONHAND-QTY'                                11980050
119200                                   TO PV-ABEND-PARAGRAPH.         11990050
119300*                                                                 12000050
119400     EXEC SQL                                                     12010050
119500       SELECT ONHAND_QTY                                          12020050
119600         INTO :TSKST-ONHAND-QTY                                   12030050
119700         FROM TSKST                                               12040050
119800        WHERE ITEM_NMBR  = :TSKST-ITEM-NMBR                       12050050
119900          AND LOC_NBR    = :TSKST-LOC-NBR                         12060050
120000     END-EXEC.                                                    12070050
120100*                                                                 12080050
120200     EVALUATE TRUE                                                12090050
120300       WHEN SQLCODE         = ZERO                                12100050
120400            IF TSKST-ONHAND-QTY < ZERO                            12110050
120500               MOVE ZERO TO TSKST-ONHAND-QTY                      12120050
120600            END-IF                                                12130050
120700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    12140050
120800         MOVE ZEROES        TO TSKST-ONHAND-QTY                   12150050
120900       WHEN OTHER                                                 12160050
121000         DISPLAY PV-ABEND-PARAGRAPH                               12170050
121100         PERFORM Z999-SQL-ERROR                                   12180050
121200     END-EVALUATE.                                                12190050
121300*                                                                 12200050
121400 T150-DATE-ROUTINE.                                               12210050
121500******************************************************************12220050
121600*  THIS PARAGRAPH SELECTS THE SALES UNIT QUANTITY FOR OUTPUT     *12230050
121700******************************************************************12240050
121800*                                                                 12250050
121900*  THIS COMPARES S-TNOW-WN (THE INPUT WEEK #) TO THE SYSTEM RUN   12260050
122000*  DATE WEEK # IN THE F2 CALENDAR.                                12270050
122100*                                                                 12280050
122200*  IF THE INPUT WEEK # IS GREATER THAN THE RUN WEEK # THEN THE    12290050
122300*  INPUT IS FROM THE PREVIOUS YEAR.                               12300050
122400*                                                                 12310050
122500*  CALL THE CALENDAR ROUTINE TO GET THE FIRST DAY OF THE PREVIOUS 12320050
122600*  YEAR.                                                          12330050
122700*                                                                 12340050
122800******************************************************************12350050
122900                                                                  12360050
123000     MOVE PV-TODAYS-DATE TO PV-FIRST-DATE.                        12370050
123100                                                                  12380050
123200     IF S-TNOW-WN > PV-TODAYS-WEEK                                12390050
123300            MOVE '01'  TO  PV-FIRST-MO                            12400050
123400            MOVE '01'  TO  PV-FIRST-DY                            12410050
123500            MOVE PV-FIRST-DATE TO DPG52-LK-DATE-INPUT             12420050
123600                                                                  12430050
123700            MOVE PC-F2               TO DPG51-CALENDAR-TYPE       12440050
123800                                                                  12450050
123900            SET DPG52-LK-DTE-GREG-FMT TO TRUE                     12460050
124000                                                                  12470050
124100            MOVE SPACES TO DPG51-INCREMENT-DECREMENT-FLAG         12480050
124200                                                                  12490050
124300            PERFORM I000-CALENDAR-ROUTINE                         12500050
124400                                                                  12510050
124500            MOVE DPG56-FIRST-FD-GREG-FMT TO PV-FIRST-DATE         12520050
124600                                                                  12530050
124700     END-IF.                                                      12540050
124800                                                                  12550050
124900******************************************************************12560050
125000*                                                                 12570050
125100*  THE INPUT TO THIS ROUTINE IS EITHER THE FIRST DATE OF THE      12580050
125200*  CURRENT YEAR OR THE FIRST DATE OF THE PREVIOUS YEAR DEPENDING  12590050
125300*  ON THE PREVIOUS WEEK # COMPARISONS.                            12600050
125400*                                                                 12610050
125500*  THIS CALL TO THE CALENDAR ROUTINE WILL INCREMENT OUT THE # OF  12620050
125600*  WEEKS - 1 TO GIVE A WEEK NUMBER IN F2 FOR LATER CONVERSION.    12630050
125700******************************************************************12640050
125800                                                                  12650050
125900     MOVE PV-FIRST-DATE TO DPG52-LK-DATE-INPUT.                   12660050
126000                                                                  12670050
126100     SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           12680050
126200     MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             12690050
126300                                                                  12700050
126400     COMPUTE DPG51-INCR-DECR-DAYS-9 = ( S-TNOW-WN - 1 ) * 7 +     12710050
126500                                      ( S-TNOW-DN - 1 ).          12720050
126600                                                                  12730050
126700     SET DPG51-INCREMENT-DATE TO TRUE.                            12740050
126800                                                                  12750050
126900     PERFORM I000-CALENDAR-ROUTINE.                               12760050
127000                                                                  12770050
127100     MOVE DPG55-GREG-DATE-FMT  TO PV-TODAYS-DATE.                 12780050
127200                                                                  12790050
127300******************************************************************12800050
127400* RETRIEVE THE NBR OF FISCAL PERIOD WEEKS FOR THE PREVIOUS MONTH  12810050
127500* IN THE F4 CALENDAR AND USE THE FIRST FISCAL PERIOD DATE AS THE  12820050
127600* MIN BOW DATE.                                                   12830050
127700******************************************************************12840050
127800                                                                  12850050
127900     MOVE DPG56-FIRST-FP-GREG-FMT                                 12860050
128000                        TO DPG52-LK-DATE-INPUT.                   12870050
128100                                                                  12880050
128200     SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           12890050
128300     MOVE PC-F4               TO DPG51-CALENDAR-TYPE.             12900050
128400                                                                  12910050
128500     MOVE PC-7   TO DPG51-INCR-DECR-DAYS-9.                       12920050
128600     SET DPG51-DECREMENT-DATE TO TRUE.                            12930050
128700                                                                  12940050
128800     PERFORM I000-CALENDAR-ROUTINE.                               12950050
128900                                                                  12960050
129000     MOVE DPG56-NBR-FISCAL-PERIOD-WEEKS                           12970050
129100                                TO PV-F4-NBR-FISCAL-PERIOD-WKS.   12980050
129200     MOVE DPG56-FIRST-FP-DB2-ISO-FMT                              12990050
129300                                TO PV-MIN-BOW-DATE.               13000050
129400                                                                  13010050
129500******************************************************************13020050
129600* RETRIEVE THE MAXIMUM BOW DATE AS AN OFFSET OF THE MIN BOW DATE  13030050
129700******************************************************************13040050
129800                                                                  13050050
129900     MOVE DPG56-FIRST-FP-DB2-ISO-FMT                              13060050
130000                              TO DPG52-LK-DATE-INPUT.             13070050
130100     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            13080050
130200     MOVE PC-A0               TO DPG51-CALENDAR-TYPE.             13090050
130300                                                                  13100050
130400     COMPUTE DPG51-INCR-DECR-DAYS-9 =                             13110050
130500           (PV-F4-NBR-FISCAL-PERIOD-WKS - 1 ) * 7.                13120050
130600                                                                  13130050
130700     SET DPG51-INCREMENT-DATE TO TRUE.                            13140050
130800                                                                  13150050
130900     PERFORM I000-CALENDAR-ROUTINE.                               13160050
131000                                                                  13170050
131100     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-MAX-BOW-DATE.              13180050
131200                                                                  13190050
131300******************************************************************13200050
131400* RETRIEVE THE MIN WEEK NUMBER TO BE USED FOR MONTHLY CPS SALES   13210050
131500******************************************************************13220050
131600***   THE NEXT DATE ROUTINE CALL IS COMMENTED OUT BECAUSE         13230050
131700***   IT IS NO LONGER NEEDED.                                     13240050
131800*                                                                 13250050
131900*    MOVE DPG56-FIRST-FP-GREG-FMT TO DPG52-LK-DATE-INPUT.         13260050
132000*    SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           13270050
132100*    MOVE PC-F4               TO DPG51-CALENDAR-TYPE.             13280050
132200*                                                                 13290050
132300*    MOVE ZEROES TO DPG51-INCR-DECR-DAYS-9.                       13300050
132400*    MOVE SPACES TO DPG51-INCREMENT-DECREMENT-FLAG.               13310050
132500*                                                                 13320050
132600*    PERFORM I000-CALENDAR-ROUTINE.                               13330050
132700*                                                                 13340050
132800*    MOVE DPG56-FISCAL-WEEK-NBR                                   13350050
132900*                               TO PV-MIN-WEEK.                   13360050
133000*    MOVE DPG56-FISCAL-YEAR-NBR TO PV-MIN-YR                      13370050
133100*                                  PV-MAX-YR                      13380050
133200*                                                                 13390050
133300******************************************************************13400050
133400*                                                                 13410050
133500*  THE INPUT TO THIS ROUTINE IS AN F2 WEEK NUMBER AND YEAR. THIS  13420050
133600*  IS TO BE CONVERTED TO THE F4 WEEK NUMBER FOR COMPARISON TO THE 13430050
133700*  SALES/HISTORY TABLE.                                           13440050
133800*                                                                 13450050
133900*  THE OUTPUT F4 WEEK NUMBER IS TO BE USED FOR THE CALCULATION OF 13460050
134000*  THE MINIMIUM AND MAXIMIUM WEEKS.                               13470050
134100******************************************************************13480050
134200***   THE NEXT DATE ROUTINE CALL IS COMMENTED OUT BECAUSE         13490050
134300***   PV-F4-NBR-FISCAL-WEEKS IS NO LONGER BEING USED.             13500050
134400*                                                                 13510050
134500*    MOVE PV-TODAYS-DATE       TO DPG52-LK-DATE-INPUT.            13520050
134600*                                                                 13530050
134700*    MOVE PC-F4                TO DPG51-CALENDAR-TYPE.            13540050
134800*                                                                 13550050
134900*    SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           13560050
135000*                                                                 13570050
135100*    MOVE SPACES TO DPG51-INCREMENT-DECREMENT-FLAG.               13580050
135200*                                                                 13590050
135300*    PERFORM I000-CALENDAR-ROUTINE.                               13600050
135400*                                                                 13610050
135500*    MOVE DPG56-NBR-FISCAL-WEEKS TO PV-F4-NBR-FISCAL-WEEKS.       13620050
135600*                                                                 13630050
135700******************************************************************13640050
135800*   END                                                           13650050
135900*                                                                 13660050
136000 T155-UCYCLE-CALENDAR-ROUTINE.                                    13670050
136100******************************************************************13680050
136200*                                                                *13690050
136300******************************************************************13700050
136400                                                                  13710050
136500*    DISPLAY 'T155-UCYCLE-CALENDAR-ROUTINE'.                      13720050
136600*    DISPLAY 'FIRST DATE: ' PV-FIRST-DATE                         13730050
136700     MOVE PV-FIRST-DATE TO DPG52-LK-DATE-INPUT.                   13740050
136800                                                                  13750050
136900     SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           13760050
137000     MOVE PC-A0               TO DPG51-CALENDAR-TYPE.             13770050
137100*    MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             13780050
137200*                                                                 13790050
137300*    DISPLAY 'BPN: ' S-BPN(PV-BPN-SUB).                           13800050
137400*    DISPLAY 'BPN SUB: ' PV-BPN-SUB.                              13810050
137500*                                                                 13820050
137600*    DISPLAY 'PV-CALC-DAYS 'PV-CALC-DAYS.                         13830050
137700     COMPUTE PV-CALC-DAYS = ((S-TNOW-WN - 2) * 7) +               13840050
137800                             (S-TNOW-DN - 1).                     13850050
137900                                                                  13860050
138000* *** ###                                                         13870050
138100     IF PV-CALC-DAYS IS NEGATIVE                                  13880050
138200* ***IF PV-CALC-DAYS <  0                                         13890050
138300       COMPUTE PV-CALC-DAYS-POSITIVE = ((PV-CALC-DAYS) * (-1))    13900050
138400       MOVE PV-CALC-DAYS-POSITIVE TO DPG51-INCR-DECR-DAYS-9       13910050
138500     ELSE                                                         13920050
138600       MOVE PV-CALC-DAYS TO DPG51-INCR-DECR-DAYS-9                13930050
138700     END-IF.                                                      13940050
138800                                                                  13950050
138900                                                                  13960050
139000     IF PV-CALC-DAYS > 0                                          13970050
139100         SET DPG51-INCREMENT-DATE TO TRUE                         13980050
139200     ELSE                                                         13990050
139300         SET DPG51-DECREMENT-DATE TO TRUE                         14000050
139400     END-IF.                                                      14010050
139500                                                                  14020050
139600     PERFORM I000-CALENDAR-ROUTINE.                               14030050
139700                                                                  14040050
139800     MOVE DPG55-1ST-WKDY-DB2ISO-FMT                               14050050
139900                                TO PV-UCYCLE-MAX-DATE.            14060050
140000                                                                  14070050
140100*****************************************************             14080050
140200***   THE NEXT DATE ROUTINE CALL IS COMMENTED OUT BECAUSE         14090050
140300***   IT IS NO LONGER NEEDED.                                     14100050
140400*    MOVE DPG55-GREG-DATE-FMT   TO DPG52-LK-DATE-INPUT.           14110050
140500*    SET DPG52-LK-DTE-GREG-FMT  TO TRUE.                          14120050
140600*    MOVE PC-F4                 TO DPG51-CALENDAR-TYPE.           14130050
140700*    MOVE SPACES TO DPG51-INCREMENT-DECREMENT-FLAG.               14140050
140800*    MOVE ZEROES TO DPG51-INCR-DECR-DAYS-9.                       14150050
140900*    PERFORM I000-CALENDAR-ROUTINE.                               14160050
141000*                                                                 14170050
141100*    MOVE DPG56-FISCAL-WEEK-NBR TO PV-UCYCLE-MAX-WK.              14180050
141200*    MOVE DPG56-FISCAL-YEAR-NBR TO PV-UCYCLE-MAX-YR.              14190050
141300*****************************************************             14200050
141400                                                                  14210050
141500     COMPUTE PV-MIN-DATE-CALC-DAYS =                              14220050
141600           ((S-BPN(PV-BPN-SUB) - 1) * 7 ) + (S-TNOW-DN - 1 ).     14230050
141700*    DISPLAY 'PV-MIN-DATE-CALC-DAYS 'PV-MIN-DATE-CALC-DAYS.       14240050
141800*************************************************************     14250050
141900****   THIS IF STATEMENT WAS REMOVED BECAUSE THE ELSE PORTION     14260050
142000****   OF THE IF STATEMENT IS THE SAME VALUE AS THE IF PORTION    14270050
142100**   IF S-BPN(PV-BPN-SUB) > PC-1                                  14280050
142200**      COMPUTE DPG51-INCR-DECR-DAYS-9 =                          14290050
142300**           ((S-BPN(PV-BPN-SUB) - 1) * 7 ) + (S-TNOW-DN - 1 )    14300050
142400**   ELSE                                                         14310050
142500**      COMPUTE DPG51-INCR-DECR-DAYS-9 = (S-TNOW-DN - 1 )         14320050
142600**   END-IF                                                       14330050
142700***********************************************************       14340050
142800                                                                  14350050
142900     IF PV-MIN-DATE-CALC-DAYS > PV-CALC-DAYS                      14360050
143000*      GET THE NUMBER OF DAYS IN THE PREVIOUS FISCAL YEAR IN      14370050
143100*      ORDER TO SUBTRACT THAT NUMBER OF DAYS FROM PV-MIN-DATE-    14380050
143200*      CALC-DAYS TO GET THE CORRECT MINIMUM DATE CALC DAYS        14390050
143300         INITIALIZE            DPG51 DPG52                        14400050
143400                               DPG53 DPG54                        14410050
143500                               DPG55 DPG56                        14420050
143600         MOVE SPACES           TO DPG52-LK-DATE-INPUT             14430050
143700         MOVE PV-FIRST-YR      TO DPG52-FISCAL-PRD-YR             14440050
143800         MOVE 1                TO DPG52-FISCAL-PRD-PP             14450050
143900         SET DPG52-LK-DTE-FISC-PRD TO TRUE                        14460050
144000         MOVE PC-F4            TO DPG51-CALENDAR-TYPE             14470050
144100         SET DPG51-DECREMENT-DATE TO TRUE                         14480050
144200         MOVE 1                TO DPG51-INCR-DECR-FISCAL-PRD-9    14490050
144300         PERFORM I000-CALENDAR-ROUTINE                            14500050
144400         COMPUTE PV-MIN-DATE-CALC-DAYS = PV-MIN-DATE-CALC-DAYS -  14510050
144500           (DPG56-NBR-FISCAL-WEEKS * 7 )                          14520050
144600     END-IF.                                                      14530050
144700                                                                  14540050
144800         INITIALIZE            DPG51 DPG52                        14550050
144900                               DPG53 DPG54                        14560050
145000                               DPG55 DPG56.                       14570050
145100                                                                  14580050
145200     MOVE PV-FIRST-DATE TO DPG52-LK-DATE-INPUT.                   14590050
145300                                                                  14600050
145400     SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           14610050
145500     MOVE PC-A0               TO DPG51-CALENDAR-TYPE.             14620050
145600**   MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             14630050
145700                                                                  14640050
145800* ###                                                             14650050
145900     IF PV-MIN-DATE-CALC-DAYS IS NEGATIVE                         14660050
146000        COMPUTE PV-MIN-DATE-CALC-DAYS-POSI =                      14670050
146100        ((PV-MIN-DATE-CALC-DAYS) * (-1))                          14680050
146200          MOVE PV-MIN-DATE-CALC-DAYS-POSI                         14690050
146300             TO DPG51-INCR-DECR-DAYS-9                            14700050
146400     ELSE                                                         14710050
146500        MOVE PV-MIN-DATE-CALC-DAYS TO DPG51-INCR-DECR-DAYS-9      14720050
146600     END-IF.                                                      14730050
146700                                                                  14740050
146800     IF PV-MIN-DATE-CALC-DAYS > 0                                 14750050
146900         SET DPG51-INCREMENT-DATE TO TRUE                         14760050
147000     ELSE                                                         14770050
147100         SET DPG51-DECREMENT-DATE TO TRUE                         14780050
147200     END-IF.                                                      14790050
147300                                                                  14800050
147400     PERFORM I000-CALENDAR-ROUTINE.                               14810050
147500                                                                  14820050
147600     MOVE DPG55-1ST-WKDY-DB2ISO-FMT                               14830050
147700                                TO PV-UCYCLE-MIN-DATE.            14840050
147800                                                                  14850050
147900*****************************************************             14860050
148000***   THE NEXT DATE ROUTINE CALL IS COMMENTED OUT BECAUSE         14870050
148100***   IT IS NO LONGER NEEDED.                                     14880050
148200*    MOVE DPG55-GREG-DATE-FMT TO DPG52-LK-DATE-INPUT.             14890050
148300*    SET DPG52-LK-DTE-GREG-FMT TO TRUE.                           14900050
148400*    MOVE PC-F4               TO DPG51-CALENDAR-TYPE.             14910050
148500*    MOVE SPACES TO DPG51-INCREMENT-DECREMENT-FLAG.               14920050
148600*    MOVE ZEROES TO DPG51-INCR-DECR-DAYS-9.                       14930050
148700*    PERFORM I000-CALENDAR-ROUTINE.                               14940050
148800*                                                                 14950050
148900*    MOVE DPG56-FISCAL-WEEK-NBR TO PV-UCYCLE-MIN-WK.              14960050
149000*    MOVE DPG56-FISCAL-YEAR-NBR TO PV-UCYCLE-MIN-YR.              14970050
149100                                                                  14980050
149200*    IF PV-UCYCLE-MIN-YR >  PV-UCYCLE-MAX-YR                      14990050
149300*        MOVE PV-UCYCLE-MAX-YR TO PV-UCYCLE-MIN-YR                15000050
149400*    END-IF.                                                      15010050
149500*****************************************************             15020050
149600                                                                  15030050
149700 EJECT                                                            15040050
149800******************************************************************15050050
149900*  THIS PARAGRAPH SELECTS THE PO RECORD FOR ON-ORDER QUANTITY    *15060050
150000*  BASED ON SKU.                                                 *15070050
150100******************************************************************15080050
150200 T300-SELECT-PO-RECORD.                                           15090050
150300*                                                                 15100050
150400*    DISPLAY 'T300-SELECT-PO-RECORD'.                             15110050
150500*                                                                 15120050
150600     MOVE 'T300'                   TO PGM-LOCATION.               15130050
150700     MOVE 'T300-SELECT-PO-RECORD'                                 15140050
150800                                   TO PV-ABEND-PARAGRAPH.         15150050
150900*                                                                 15160050
151000*    DISPLAY 'ON-ORD-SKU: ' SKSTOO-SKU-SEQ-NBR.                   15170050
151100*                                                                 15180050
151500     IF MR017-STR-NBR EQUAL PC-CORPORATE-STORE                    15190050
151600        PERFORM T350-ACCUM-CORP-OO-TOTAL                          15200050
151700     ELSE                                                         15210050
151800        PERFORM T360-ACCUM-STORE-OO-TOTAL                         15220050
151900     END-IF.                                                      15230050
152000*                                                                 15240050
152100*                                                                 15250050
152200 EJECT                                                            15260050
152300******************************************************************15270050
152400*  THIS PARAGRAPH SELECTS THE TOTAL ONORDER AT THE CORP LEVEL    *15280050
152500******************************************************************15290050
152600 T350-ACCUM-CORP-OO-TOTAL.                                        15300050
152700*                                                                 15310050
152800     MOVE 'T350'                   TO PGM-LOCATION.               15320050
152900     MOVE 'T350-ACCUM-CORP-OO-TOTAL'                              15330050
153000                                   TO PV-ABEND-PARAGRAPH.         15340050
153100     MOVE ZEROS               TO PV-OO                            15350050
153200     MOVE MR017-ITEM-NBR TO SKSTOO-ITM-NBR.                       15360050
153300     EXEC SQL                                                     15370050
153400        SELECT SUM(ONORD_UNT_QTY)                                 15380050
153500        INTO :PV-OO:PV-NULL-OO                                    15390050
153600        FROM TSKSTOO A                                            15400050
153700            , XMT_LOC B                                           15410050
153800        WHERE A.STR_NBR    =   B.LOC_NBR                          15420050
153900        AND B.LOC_TYP_CDE  =   'DS'                               15430050
154000        AND A.ITM_NBR          =   :SKSTOO-ITM-NBR                15440050
154100     END-EXEC.                                                    15450050
154200*                                                                 15460050
154300     EVALUATE TRUE                                                15470050
154400       WHEN SQLCODE         = ZERO                                15480050
154500         CONTINUE                                                 15490050
154600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    15500050
154700          IF PV-NULL-OO = -1                                      15510050
154800             MOVE 0 TO PV-OO                                      15520050
154900          END-IF                                                  15530050
155000       WHEN OTHER                                                 15540050
155100         DISPLAY '**** ABEND ****'                                15550050
155200         DISPLAY '**** PROGRAM   = MRKUT003 ****'                 15560050
155300         DISPLAY '**** PARAGRAPH = T350-ACCUM-  '                 15570050
155400         DISPLAY '**** INVALID SELECT SUM ON TSKSTOO    '         15580050
155500         DISPLAY '**** ITEM-NBR  = ' MR017-ITEM-NBR               15590050
155600         DISPLAY PV-ABEND-PARAGRAPH                               15600050
155700         PERFORM Z999-SQL-ERROR                                   15610050
155800     END-EVALUATE.                                                15620050
155900 EJECT                                                            15630050
156000******************************************************************15640050
156100*  THIS PARAGRAPH SELECTS THE TOTAL ONORDER AT THE STORE LEVEL   *15650050
156200******************************************************************15660050
156300 T360-ACCUM-STORE-OO-TOTAL.                                       15670050
156400*                                                                 15680050
156500     MOVE 'T360'                   TO PGM-LOCATION.               15690050
156600     MOVE 'T360-ACCUM-STORE-OO-TOTAL'                             15700050
156700                                   TO PV-ABEND-PARAGRAPH.         15710050
156800     MOVE ZEROS               TO PV-OO                            15720050
156900     MOVE MR017-ITEM-NBR TO SKSTOO-ITM-NBR.                       15730050
157000     MOVE MR017-STR-NBR TO  XMT00001-LOC-NBR                      15740050
157100     EXEC SQL                                                     15750050
157200        SELECT SUM(ONORD_UNT_QTY)                                 15760050
157300        INTO :PV-OO:PV-NULL-OO                                    15770050
157400        FROM TSKSTOO A,                                           15780050
157500             XMT_LOC B                                            15790050
157600        WHERE A.STR_NBR    =   B.LOC_NBR                          15800050
157700        AND B.LOC_TYP_CDE  =   'DS'                               15810050
157800        AND B.LOC_NBR      =   :XMT00001-LOC-NBR                  15820050
157900        AND A.ITM_NBR      =   :SKSTOO-ITM-NBR                    15830050
158000     END-EXEC.                                                    15840050
158100*                                                                 15850050
158200     EVALUATE TRUE                                                15860050
158300       WHEN SQLCODE         = ZERO                                15870050
158400         CONTINUE                                                 15880050
158500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    15890050
158600          IF PV-NULL-OO = -1                                      15900050
158700             MOVE 0 TO PV-OO                                      15910050
158800          END-IF                                                  15920050
158900       WHEN OTHER                                                 15930050
159000         DISPLAY '**** ABEND ****'                                15940050
159100         DISPLAY '**** PROGRAM   = MRKUT003 ****'                 15950050
159200         DISPLAY '**** PARAGRAPH = T360-ACCUM-  '                 15960050
159300         DISPLAY '**** INVALID SELECT SUM ON TSKSTOO    '         15970050
159400         DISPLAY '**** ITEM-NBR  = ' MR017-ITEM-NBR               15980050
159500         DISPLAY PV-ABEND-PARAGRAPH                               15990050
159600         PERFORM Z999-SQL-ERROR                                   16000050
159700     END-EVALUATE.                                                16010050
159800 EJECT                                                            16020050
159900                                                                  16030050
160000*  THIS PARAGRAPH SELECTS THE VENDOR NAME FOR OUTPUT             *16040050
160100******************************************************************16050050
160200 T700-SELECT-VENDOR-NAME.                                         16060050
160300*                                                                 16070050
160400*    DISPLAY 'T700-SELECT-VENDOR-NAME'.                           16080050
160500*                                                                 16090050
160600     MOVE 'T700'                   TO PGM-LOCATION.               16100050
160700     MOVE 'T700-SELECT-VENDOR-NAME'                               16110050
160800                                   TO PV-ABEND-PARAGRAPH.         16120050
160900*                                                                 16130050
161000     MOVE PC-01  TO ENTNME-TYPE-CDE                               16140050
161100     EXEC SQL                                                     16150050
161200         SELECT A.ENT_NAME_DESC                                   16160050
161300           INTO :ENTNME-ENT-NAME-DESC                             16170050
161400           FROM TENTNME A,                                        16180050
161500                TVNDDPT B                                         16190050
161600           WHERE A.ENT_ID          = B.ENT_ID                     16200050
161700             AND B.DEPT_NBR        = :VNDDPT-DEPT-NBR             16210050
161800             AND B.INHOUSE_NBR     = :VNDDPT-INHOUSE-NBR          16220050
161900             AND A.TYPE_CDE        = :ENTNME-TYPE-CDE             16230050
162000     END-EXEC.                                                    16240050
162100*                                                                 16250050
162200     EVALUATE TRUE                                                16260050
162300       WHEN SQLCODE = ZEROS                                       16270050
162400         MOVE PC-FLNAME-LENGTH   TO DP024-FLNAME-LENGTH           16280050
162500         MOVE RSPBAR-WORKER-FIR-NAME                              16290050
162600                                 TO DP024-FNAME                   16300050
162700         MOVE RSPBAR-WORKER-LAST-NAME                             16310050
162800                                 TO DP024-LNAME                   16320050
162900         PERFORM DP024-0000-FORMAT-NAME                           16330050
163000         MOVE DP024-FLNAME       TO PV-BYR-NAME                   16340050
163100       WHEN SQLCODE = PC-ROW-NOT-FOUND                            16350050
163200         MOVE SPACES             TO PV-BYR-NAME                   16360050
163300       WHEN OTHER                                                 16370050
163400         DISPLAY PV-ABEND-PARAGRAPH                               16380050
163500         DISPLAY 'MDSEAR-DKEY: '                                  16390050
163600                  MDSEAR-DKEY                                     16400050
163700         DISPLAY 'PC-BUYER  : '                                   16410050
163800                  PC-BYR                                          16420050
163900         DISPLAY 'PV-CURRENT-DATE-R: '                            16430050
164000                  PV-CURRENT-DATE-R                               16440050
164100         PERFORM Z999-SQL-ERROR                                   16450050
164200     END-EVALUATE.                                                16460050
164300*                                                                 16470050
164400 EJECT                                                            16480050
164500******************************************************************16490050
164600*  THIS PARAGRAPH SELECTS THE BUYER NUMBER FOR OUTPUT AND THE    *16500050
164700*  DKEY TO RETRIEVE THE BUYER NAME                               *16510050
164800******************************************************************16520050
164900 T800-SELECT-MDSEAR-DKEY.                                         16530050
165000*                                                                 16540050
165100*    DISPLAY 'T800-SELECT-MDSEAR-DKEY'.                           16550050
165200*                                                                 16560050
165300     MOVE 'T800'                   TO PGM-LOCATION.               16570050
165400     MOVE 'T800-SELECT-MDSEAR-DKEY'                               16580050
165500                                   TO PV-ABEND-PARAGRAPH.         16590050
165600     MOVE PC-OPER-CO TO  MDSEAR-OPERCO-NBR                        16600050
165700*                                                                 16610050
165800     EXEC SQL                                                     16620050
165900         SELECT  MDSEAR_DKEY,                                     16630050
166000                 BYR_NBR                                          16640050
166100           INTO  :MDSEAR-DKEY,                                    16650050
166200                 :MDSEAR-BYR-NBR                                  16660050
166300           FROM TMDSEAR                                           16670050
166400          WHERE DEPT_NBR   = :MDSEAR-DEPT-NBR                     16680050
166500            AND MDSELV_CDE = :MDSEAR-MDSELV-CDE                   16690050
166600            AND OPERCO_NBR = :MDSEAR-OPERCO-NBR                   16700050
166700            AND :PV-CURRENT-DATE-R BETWEEN                        16710050
166800                STRT_DTE AND END_DTE                              16720050
166900     END-EXEC.                                                    16730050
167000*                                                                 16740050
167100     EVALUATE TRUE                                                16750050
167200       WHEN SQLCODE         = ZERO                                16760050
167300         CONTINUE                                                 16770050
167400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    16780050
167500         MOVE ZEROES TO MDSEAR-DKEY                               16790050
167600         MOVE SPACES TO MDSEAR-BYR-NBR                            16800050
167700       WHEN OTHER                                                 16810050
167800         DISPLAY '**** ABEND ****'                                16820050
167900         DISPLAY '**** PROGRAM   = MRKUT003 ****'                 16830050
168000         DISPLAY '**** PARAGRAPH = T800-SELECT  '                 16840050
168100         DISPLAY '**** INVALID SELECT ON TMDSEAR TABLE     '      16850050
168200         DISPLAY '**** DEPT-NBR  = ' MDSEAR-DEPT-NBR              16860050
168300         DISPLAY '**** MDSELV-CDE = ' MDSEAR-MDSELV-CDE           16870050
168400         DISPLAY '**** PROCESS DTE = ' PV-CURRENT-DATE-R          16880050
168500         DISPLAY PV-ABEND-PARAGRAPH                               16890050
168600         PERFORM Z999-SQL-ERROR                                   16900050
168700     END-EVALUATE.                                                16910050
168800*                                                                 16920050
168900 EJECT                                                            16930050
169000******************************************************************16940050
169100*  RETRIEVES THE BUYER   NAME.                                   *16950050
169200******************************************************************16960050
169300*                                                                 16970050
169400 T900-SELECT-BUYER-NAME.                                          16980050
169500*                                                                 16990050
169600*    DISPLAY 'T900-SELECT-BUYER-NAME'.                            17000050
169700*                                                                 17010050
169800     MOVE 'T900'                 TO PGM-LOCATION.                 17020050
169900     MOVE 'T900-GET-BUYER-NAME       '                            17030050
170000                                 TO PV-ABEND-PARAGRAPH.           17040050
170100*                                                                 17050050
170200     EXEC SQL                                                     17060050
170300         SELECT WORKER_FIR_NAME,                                  17070050
170400                WORKER_LAST_NAME                                  17080050
170500           INTO :RSPBAR-WORKER-FIR-NAME,                          17090050
170600                :RSPBAR-WORKER-LAST-NAME                          17100050
170700           FROM TRSPBAR                                           17110050
170800           WHERE MDSEAR_DKEY       = :RSPBAR-MDSEAR-DKEY          17120050
170900             AND RSPLVL_CDE        = :RSPBAR-RSPLVL-CDE           17130050
171000             AND :PV-CURRENT-DATE-R BETWEEN                       17140050
171100                 WORKER_STRT_DTE AND WORKER_END_DTE               17150050
171200     END-EXEC.                                                    17160050
171300*                                                                 17170050
171400     EVALUATE TRUE                                                17180050
171500       WHEN SQLCODE = ZEROS                                       17190050
171600         MOVE PC-FLNAME-LENGTH   TO DP024-FLNAME-LENGTH           17200050
171700         MOVE RSPBAR-WORKER-FIR-NAME                              17210050
171800                                 TO DP024-FNAME                   17220050
171900         MOVE RSPBAR-WORKER-LAST-NAME                             17230050
172000                                 TO DP024-LNAME                   17240050
172100         PERFORM DP024-0000-FORMAT-NAME                           17250050
172200         MOVE DP024-FLNAME       TO PV-BYR-NAME                   17260050
172300       WHEN SQLCODE = PC-ROW-NOT-FOUND                            17270050
172400         MOVE SPACES             TO PV-BYR-NAME                   17280050
172500       WHEN OTHER                                                 17290050
172600         DISPLAY PV-ABEND-PARAGRAPH                               17300050
172700         DISPLAY 'MDSEAR-DKEY: '                                  17310050
172800                  MDSEAR-DKEY                                     17320050
172900         DISPLAY 'PC-BUYER  : '                                   17330050
173000                  PC-BYR                                          17340050
173100         DISPLAY 'PV-CURRENT-DATE-R: '                            17350050
173200                  PV-CURRENT-DATE-R                               17360050
173300         PERFORM Z999-SQL-ERROR                                   17370050
173400     END-EVALUATE.                                                17380050
173500 EJECT                                                            17390050
173600******************************************************************17400050
173700*     WRITES THE INPUT TRANSFER RECORD TO BE USED IN THE         *17410050
173800*     REPLENISHMENT SYSTEM                                       *17420050
173900******************************************************************17430050
174000 W000-WRITE-OUTPUT.                                               17440050
174100*                                                                 17450050
174200*    DISPLAY 'W000-WRITE'.                                        17460050
174300     MOVE 'W000'                  TO PGM-LOCATION.                17470050
174400     MOVE 'W000-WRITE-SYSTEM-RECORD   '                           17480050
174500                                  TO PV-ABEND-PARAGRAPH.          17490050
174600*                                                                 17500050
174700     WRITE TRANSFER-REC           FROM PV-OUTPUT.                 17510050
174800*                                                                 17520050
174900     ADD PC-PLUS-1 TO PV-SYSTEM-OUTPUT-CNT.                       17530050
175000*                                                                 17540050
175100 EJECT                                                            17550050
175200******************************************************************17560050
175300*   CLOSES FILES AND DISPLAYS MESSAGES.                          *17570050
175400******************************************************************17580050
175500 Y100-END-ROUTINE.                                                17590050
175600*                                                                 17600050
175700     IF NO-INPUT                                                  17610050
175800         CONTINUE                                                 17620050
175900     ELSE                                                         17630050
176000         PERFORM W000-WRITE-OUTPUT                                17640050
176100     END-IF.                                                      17650050
176200*                                                                 17660050
176300     CLOSE  IC-CONTROL-FILE                                       17670050
176400            BIM-FILE                                              17680050
176500            TRANSFER-RECORD-IN                                    17690050
176600            TRANSFER-RECORD.                                      17700050
176700                                                                  17710050
176800     IF NOT (PV-CONTROL-SUCCESSFUL OR                             17720050
176900             PV-CONTROL-VERIFY)                                   17730050
177000        MOVE 'Y100-END-ROUTINE'   TO PV-PARAGRAPH-NAME            17740050
177100        MOVE 'IC-CONTROL-FILE'    TO PV-ERROR-FILE                17750050
177200        MOVE 'CLOSING INPUT FILE' TO PV-ERROR-OPERATION           17760050
177300        MOVE 'BAD-CLOSE'          TO PV-ERROR-STATUS              17770050
177400        MOVE  PV-CONTROL-STATUS   TO PV-VSAM-STATUS               17780050
177500        MOVE  '//////////////'    TO PV-NOT-FOUND-KEY             17790050
177600        PERFORM Z999-VSAM-ERROR                                   17800050
177700        MOVE +4006              TO PV-ABEND-CODE                  17810050
177800        CALL 'ILBOABN0'        USING PV-ABEND-CODE                17820050
177900     END-IF.                                                      17830050
178000                                                                  17840050
178100     IF NOT (PV-BIM-SUCCESSFUL OR                                 17850050
178200             PV-BIM-VERIFY)                                       17860050
178300        MOVE 'Y100-END-ROUTINE'   TO PV-PARAGRAPH-NAME            17870050
178400        MOVE 'BIM-FILE'           TO PV-ERROR-FILE                17880050
178500        MOVE 'CLOSING INPUT FILE' TO PV-ERROR-OPERATION           17890050
178600        MOVE 'BAD-CLOSE'          TO PV-ERROR-STATUS              17900050
178700        MOVE  PV-BIM-STATUS       TO PV-VSAM-STATUS               17910050
178800        MOVE  '//////////////'    TO PV-NOT-FOUND-KEY             17920050
178900        PERFORM Z999-VSAM-ERROR                                   17930050
179000        MOVE +4006              TO PV-ABEND-CODE                  17940050
179100        CALL 'ILBOABN0'        USING PV-ABEND-CODE                17950050
179200     END-IF.                                                      17960050
179300*                                                                 17970050
179400*** DISPLAY COUNT OF ITEMS PROCESSED.  (DIVIDE COUNT BY 2 TO      17980050
179500*** ELIMINATE CORPORATE RECORDS, FOR ALL SYSTEMS EXCEPT 02.)      17990050
179600*                                                                 18000050
179700     IF MR001I-S-SYS-ID EQUAL '02'                                18010050
179800        CONTINUE                                                  18020050
179900     ELSE                                                         18030050
179901        COMPUTE PV-ITEM-COUNT = PV-ITEM-COUNT / 2                 18040050
179902     END-IF.                                                      18050050
179903     DISPLAY '*******************************'.                   18060050
179904     DISPLAY '*  TOTAL ITEMS: ' PV-ITEM-COUNT.                    18070050
179905     DISPLAY '*******************************'.                   18080050
179906*                                                                 18090050
179907 EJECT                                                            18100050
179908******************************************************************18110050
179909*     VSAM WARNING OR ERROR PROCESSING                           *18120050
179910*                                                                *18130050
179920******************************************************************18140050
179930                                                                  18150050
179940 Z999-VSAM-ERROR.                                                 18160050
179950*---------------                                                  18170050
179960*                                                                 18180050
179970*    DISPLAY 'Z999-VSAM-ERROR'.                                   18190050
179980     DISPLAY '**   ABEND   **'.                                   18200050
179990     DISPLAY 'PROGRAM NAME = ' PC-PGRM-NAME.                      18210050
180000     DISPLAY PV-PARAGRAPH-NAME-MSG.                               18220050
180100     DISPLAY PV-ERROR-FILE-MSG.                                   18230050
180200     DISPLAY PV-ERROR-OPERATION-MSG.                              18240050
180300     DISPLAY PV-ERROR-STATUS-MSG.                                 18250050
180400     DISPLAY PV-NOT-FOUND-MSG                                     18260050
180500     DISPLAY 'VSAM STATUS = ' PV-VSAM-STATUS.                     18270050
180600     DISPLAY '***************'.                                   18280050
180700*                                                                 18290050
180800 EJECT                                                            18300050
180900******************************************************************18310050
181000*     SQL WARNING OR ERROR PROCESSING                            *18320050
181100*                                                                *18330050
181200******************************************************************18340050
181300                                                                  18350050
181400 Z999-SQL-ERROR.                                                  18360050
181500*---------------                                                  18370050
181600                                                                  18380050
181700     MOVE SQLCODE    TO SQLCODE2.                                 18390050
181800     MOVE SQLERRD(3) TO SQLERRD3.                                 18400050
181900     DISPLAY '** ABEND **       ** = SQLERROR'.                   18410050
182000     DISPLAY '** PROGRAM        ** = MRKUT003'.                   18420050
182100     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  18430050
182200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  18440050
182300     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   18450050
182400     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  18460050
182500     MOVE +4013 TO PV-ABEND-CODE.                                 18470050
182600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         18480050
182700*                                                                 18490050
182800******************************************************************18500050
182900     COPY DPPD024.                                                18510050
183000 EJECT                                                            18520050
183100******************************************************************18530050
183200******************************************************************18540050
