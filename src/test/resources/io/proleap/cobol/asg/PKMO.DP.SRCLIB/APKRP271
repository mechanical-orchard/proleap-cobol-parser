000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKRP271.                                        00020000
000300 AUTHOR.         PAUL KEBER - STRATAGEM                           00030000
000400 DATE-WRITTEN.   08/17/1995.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600***************************************************************** 00060000
000700*    COBOL 2 / DB2                                              * 00070000
000800*                                                               * 00080000
000900*    INVOICES REQUIRING DETAIL ENTRY BY PO REPORT               * 00090000
001000*                                                               * 00100000
001100*   PROGRAM OVERVIEW:                                           * 00110000
001200*                                                               * 00120000
001300*     THIS PROGRAM CREATES THE INVOICES REQUIRING DETAIL        * 00130000
001400*   ENTRY BY PO NUMBER REPORT FROM A REPORT FILE PRODUCED       * 00140000
001500*   IN APKUP250 AND BY ACCESSING DB2 TABLES.                    * 00150000
001600*     A PAGE BREAK OCCURS FOR EACH VENDOR/PO.  FOR EACH PO,     * 00160000
001700*   A REPORT HEADING CONSISTING OF VENDOR, VENDOR NUMBER,       * 00170000
001800*   AND PO NUMBER WILL BE CREATED.  REPORT LINES FOR            * 00180000
001900*   EACH INVOICE LINE WILL FOLLOW THE HEADER.  IF THE           * 00190000
002000*   INVOICE LINE HAS ADDITIONAL ALLOWANCES, THE DISCOUNT        * 00200000
002100*   CURSOR WILL BE READ TO OBTAIN THESE ALLOWANCES FROM THE     * 00210000
002200*   TALCHRG TABLE.  REPORT RECORDS WILL BE CREATED FOR ALL      * 00220000
002300*   PO LINES AND WILL FOLLOW THE INVOICE LINES.                 * 00230000
002400*                                                               * 00240000
002500*   INPUT:                                                      * 00250000
002600*                                                               * 00260000
002700*     SORTED INVOICES REQUIRING DETAIL ENTRY BY PO REPORT       * 00270000
002800*     FILE.                                                     * 00280000
002900*                                                               * 00290000
003000*   OUTPUT:                                                     * 00300000
003100*                                                               * 00310000
003200*     RPT01  - INVOICES REQUIRING DETAIL ENTRY BY PO REPORT     * 00320000
003300***************************************************************** 00330000
003400* CHANGE LOG:                                                   * 00340000
003500*                                                               * 00350000
003600* 01/04/96 MARY KING                                            * 00360000
003700*          CHANGED LOGIC IN 2000-PROCESS-INPUT TO HANDLE        * 00370000
003800*          BY STORE SEQUENCED INPUT RECORDS.                    * 00380000
003900*                                                               * 00390000
004000* 05/10/96 DARYL WOELFEL                                        * 00400000
004100*          CHANGED LOGIC IN 2000-PROCESS-INPUT TO BYPASS        * 00410000
004200*          RECEIVER RECORDS THAT DO NOT HAVE MATCHING           * 00420000
004300*          HEADER OR INVOICE RECORDS.                           * 00430000
004400*                                                               * 00440000
004500* 03/01/02 MIKE BESKE                        WR# 21278          * 00450000
004600*          REPLACED THE TSK TABLE WITH TSKXREF AS PART          * 00460000
004700*          OF RETEK PROJECT PRELIM FOR AP.  (PARA 2550-)        * 00470000
004800*                                                               * 00480000
004900* 09/09/02 BRIAN HASSLINGER                  WR# 23500          * 00490000
005000*          REPLACED PAYT_REQ_SEQ_NBR WITH PURCHASE ORDER        * 00500000
005100*          AND INVOICE ID IN THE DISCOUNT CURSOR.  AN INDEX     * 00510000
005200*          WAS CREATED USING THE PO NUMBER AND INVOICE ID       * 00520000
005300*          TO INCREASE EFFICIENCY.                              * 00530000
005400*                                                               * 00540000
005500* 05/12/03  ADDED CODE FOR NI-SKU PROJECT.  REPLACED THE USE    * 00550000
005600*        OF DEPT#, CLASS AND SKU SEQ NBR BEING DISPLAYED ON     * 00560000
005700*        THE REPORT. NOW EITHER THE SKU FROM TSKXREF OR THE     * 00570000
005800*        THE RMS-PO-SKU-NBR FROM TPURITM WILL BE DISPLAYED.     * 00580000
005900*        THE CURSOR WILL HAVE TSKXREF JOINED TO TPURITM.        * 00590000
006000*         BY: MIKE BESKE                     WR: 22557          * 00600000
006100*                                                               * 00610000
006200* DATE  01/04/2005                                              * 00620000
006300*     CHANGE MADE: 2005 SUNRISE PROJECT - UPC/EAN EXPANSION.    * 00630000
006400*     IN PARAGRAPH 2550, CHANGED THE STRING STATEMENT TO BEGIN  * 00640000
006500*     AT POSITION 3:2 INSTEAD OF 4:1.  THIS WILL BRING IN 13    * 00650000
006600*     BYTES INSTEAD OF 12 TO ACCOMMODATE EAN-13.                * 00660000
006700*     MADE BY: KEVIN CATLIN            WR/IR #: WR27714         * 00670000
006800*                                                               * 00680000
006810* DATE  03/11/2007                                              * 00690000
006820*     CHANGE MADE: MATCH BY DC PROJECT.                         * 00700000
006830*     ADDED DC NBR TO THE DETAIL HEADER AND DETAIL LINE.        * 00710000
006840*     MODIFIED PARAGRAPH 2210- TO INCLUDE DC NBR IN THE INV     * 00720000
006850*     DETAIL LINE1.                                             * 00730000
006860*     MADE BY: ROLF NOHE               WR/IR #: WR21578         * 00740000
006870*                                                               * 00750000
006880* DATE  11/04/2014                                              * 00760000
006890*     CHANGE MADE: PO EXTENTION PROJECT.                        * 00770000
006900*     CHANGE THE LENGTH OF HL3-PO-NBR VARIABLE TO 9 FROM        * 00780000
007000*     LENGTH 7. SINCE THE LENGTH OF AP271-PURCHASE-ORDER        * 00790000
007100*     VARIABLE IS INCREASED TO 9 IN APRD271 COPYBOOK.           * 00800000
007101*     MADE BY: COGNIZANT               WR/IR: CHG0094517        * 00810000
007102*                                                               * 00820000
007103***************************************************************** 00830000
007104/                                                                 00840000
007105 ENVIRONMENT DIVISION.                                            00850000
007200 CONFIGURATION SECTION.                                           00860000
007300 INPUT-OUTPUT SECTION.                                            00870000
007400 FILE-CONTROL.                                                    00880000
007500                                                                  00890000
007600     SELECT INVOIC-REQ-DTL-FILE  ASSIGN TO UT-S-INP01.            00900000
007700     SELECT RPT01-FILE           ASSIGN TO UT-S-RPT01.            00910000
007800                                                                  00920000
007900 DATA DIVISION.                                                   00930000
008000 FILE SECTION.                                                    00940000
008100 FD  INVOIC-REQ-DTL-FILE                                          00950000
008200     RECORDING MODE IS F                                          00960000
008300     LABEL RECORDS ARE STANDARD                                   00970000
008400     BLOCK CONTAINS 0 RECORDS                                     00980000
008500     DATA RECORD IS INVOIC-REQ-DTL-RECORD.                        00990000
008600 01  INVOIC-REQ-DTL-RECORD       PIC  X(150).                     01000000
008700                                                                  01010000
008800 FD  RPT01-FILE                                                   01020000
008900     RECORDING MODE IS F                                          01030000
009000     LABEL RECORDS ARE STANDARD                                   01040000
009100     BLOCK CONTAINS 0 RECORDS                                     01050000
009200     DATA RECORD IS RPT01-RECORD.                                 01060000
009300 01  RPT01-RECORD                PIC  X(132).                     01070000
009400                                                                  01080000
009500 EJECT                                                            01090000
009600 WORKING-STORAGE SECTION.                                         01100000
009700                                                                  01110000
009800 01  PROGRAM-WORKAREA.                                            01120000
009900     05  FILLER                  PIC  X(30)           VALUE       01130000
010000         '** BEGINING OF APKRP271 W/S **'.                        01140000
010100                                                                  01150000
010200     05  PW-CURRENT-PARAGRAPH    PIC  X(30)           VALUE SPACE.01160000
010300     05  PW-PROGRAM-NAME         PIC  X(08)           VALUE       01170000
010400         'APKRP271'.                                              01180000
010500     05  PW-VENDOR-NAME          PIC  X(30)           VALUE SPACE.01190000
010600     05  PW-PO-NBR               PIC S9(09)    COMP   VALUE +0.   01200000
010700     05  PW-RCVD-UNIT-COST       PIC S9(07)V99 COMP-3 VALUE +0.   01210000
010800     05  PW-SKU-NBR              PIC  X(08)           VALUE SPACE.01220000
010900     05  DB2-RETRY-MAX           PIC S9(04)    COMP   VALUE +3.   01230000
011000                                                                  01240000
011100 01  ACCUM-FIELDS.                                                01250000
011200     05  T-RCVD-QUANTITY         PIC S9(09)    COMP   VALUE +0.   01260000
011300     05  T-DETAIL-COUNT          PIC S9(07)    COMP-3 VALUE +0.   01270000
011400     05  T-DETAIL-AMOUNT         PIC S9(11)V99 COMP-3 VALUE +0.   01280000
011500                                                                  01290000
011600     05  T-REPORT-COUNT          PIC S9(07)    COMP-3 VALUE +0.   01300000
011700     05  T-REPORT-AMOUNT         PIC S9(11)V99 COMP-3 VALUE +0.   01310000
011800                                                                  01320000
011900 01  PC-PROGRAM-CONSTANTS.                                        01330000
012000     05  PC-MULTIPLE-UPC                PIC X(15)  VALUE          01340000
012100         'MORE THAN 1 UPC'.                                       01350000
012200     05  PC-NO-VENDOR-UPC               PIC X(15)  VALUE          01360000
012300         'NO VENDOR UPC  '.                                       01370000
012400     05  PC-MIN-UPC                     PIC S9(15)V               01380000
012500                                         VALUE +000400000000000   01390000
012600                                                   COMP-3.        01400000
012700     05  PC-MAX-UPC                     PIC S9(15)V               01410000
012800                                         VALUE +000409999999999   01420000
012900                                                   COMP-3.        01430000
013000                                                                  01440000
013100 01  PRINT-FIELDS.                                                01450000
013200     05  PR-MAX-LINES            PIC S9(05)   COMP-3  VALUE +64.  01460000
013300     05  PR-LINE-COUNT           PIC S9(05)   COMP-3  VALUE +99.  01470000
013400     05  PR-PAGE-COUNT           PIC S9(05)   COMP-3  VALUE +0.   01480000
013500     05  PR-DETAIL-CC            PIC S9(01)   COMP-3  VALUE +0.   01490000
013600     05  PR-CC                   PIC S9(01)   COMP-3  VALUE +0.   01500000
013700                                                                  01510000
013800     05  PR-LINE                 PIC  X(132)  VALUE SPACES.       01520000
013900                                                                  01530000
014000 01  PROGRAM-SWITCHES-SUBSCRIPTS.                                 01540000
014100     05  PS-END-OF-PO-LINE-RECS-SW                                01550000
014200                                 PIC  X(01)   VALUE 'N'.          01560000
014300         88  END-OF-PO-LINE-RECS              VALUE 'Y'.          01570000
014400     05  PS-EOF-DISCOUNT-CSR-SW  PIC  X(01)   VALUE 'N'.          01580000
014500         88  EOF-DISCOUNT-CSR                 VALUE 'Y'.          01590000
014600     05  PS-EOF-SW               PIC  X(01)   VALUE 'N'.          01600000
014700         88  EOF                              VALUE 'Y'.          01610000
014800     05  PS-EOF-PO-ITEM-CSR-SW   PIC  X(01)   VALUE 'N'.          01620000
014900         88  EOF-PO-ITEM-CSR                  VALUE 'Y'.          01630000
015000     05  PS-REPORTING-SW         PIC  X(01)   VALUE SPACE.        01640000
015100         88  INVOICE-REPORTING                VALUE 'I'.          01650000
015200         88  PO-LINE-REPORTING                VALUE 'P'.          01660000
015300     05  PS-INVOICE-SW           PIC  X(01)   VALUE SPACE.        01670000
015400         88  INVOICE-FOUND                    VALUE 'Y'.          01680000
015500         88  NOT-INVOICE-FOUND                VALUE 'N'.          01690000
015600     05  SUB                     PIC S9(09)   COMP    VALUE +0.   01700000
015700     05  SUB2                    PIC S9(09)   COMP    VALUE +0.   01710000
015800                                                                  01720000
015900 01  PV-UPC-INFO.                                                 01730000
016000     05  PV-UPC-NBR                     PIC 9(15).                01740000
016100     05  PV-UPC-NBR-X REDEFINES PV-UPC-NBR                        01750000
016200                                        PIC X(15).                01760000
016300     05  PV-UPC-NBR-DISPLAY             PIC X(16)   VALUE SPACES. 01770000
016400                                                                  01780000
016500 01  PW-CURRENT-DATE.                                             01790000
016600     05  PW-CURRENT-YEAR         PIC  9(02).                      01800000
016700     05  PW-CURRENT-MONTH        PIC  9(02).                      01810000
016800     05  PW-CURRENT-DAY          PIC  9(02).                      01820000
016900                                                                  01830000
017000 01  PW-CURRENT-TIME.                                             01840000
017100     05  PW-CURRENT-HOUR         PIC  9(02).                      01850000
017200     05  PW-CURRENT-MINUTE       PIC  9(02).                      01860000
017300     05  FILLER                  PIC  9(02)           VALUE 00.   01870000
017400                                                                  01880000
017500 EJECT                                                            01890000
017600*  INPUT RECORD AREA                                              01900000
017700                                                                  01910000
017800     COPY APRD271.                                                01920000
017900                                                                  01930000
018000 EJECT                                                            01940000
018100*  PRINT AREA                                                     01950000
018200                                                                  01960000
018300     COPY DPWS133O.                                               01970000
018400                                                                  01980000
018500 01  HDR-LINE2.                                                   01990000
018600     05  FILLER                  PIC  X(40)   VALUE SPACES.       02000000
018700     05  HL2-TITLE               PIC  X(52)   VALUE               02010000
018800         '    INVOICES REQUIRING DETAIL ENTRY BY PO NUMBER    '.  02020000
018900     05  FILLER                  PIC  X(40)   VALUE SPACES.       02030000
019000                                                                  02040000
019100 01  HDR-LINE3.                                                   02050000
019200     05  FILLER                  PIC  X(08)    VALUE 'VENDOR: '.  02060000
019300     05  HL3-VENDOR-NAME         PIC  X(30)    VALUE SPACES.      02070000
019400     05  FILLER                  PIC  X(05)    VALUE SPACES.      02080000
019500     05  FILLER                  PIC  X(10)    VALUE 'VENDOR #: '.02090000
019600     05  HL3-VENDOR-NUMBER       PIC  X(09)    VALUE SPACES.      02100000
019700     05  FILLER                  PIC  X(05)    VALUE SPACES.      02110000
019800     05  FILLER                  PIC  X(08)    VALUE 'PO NBR: '.  02120000
019900     05  HL3-PO-NBR              PIC  ZZZZZZZZ9 VALUE ZERO.       02130000
020000     05  FILLER                  PIC  X(48)    VALUE SPACE.       02140000
020100                                                                  02150000
020200 01  INV-HDR-LINE1.                                               02160000
020300     05  FILLER                  PIC  X(12)    VALUE              02170000
020400         'ENTRY DATE  '.                                          02180000
020500     05  FILLER                  PIC  X(24)    VALUE              02190000
020600         'INVOICE #               '.                              02200000
020700     05  FILLER                  PIC  X(09)    VALUE              02210000
020800         'STORE #  '.                                             02220000
020900     05  FILLER                  PIC  X(08)    VALUE              02230000
021000         'DETAIL  '.                                              02240000
021100     05  FILLER                  PIC  X(14)    VALUE              02250000
021200         'ENTRY METHOD  '.                                        02260000
021300     05  FILLER                  PIC  X(16)    VALUE              02270000
021400         ' GROSS INVOICE  '.                                      02280000
021500     05  FILLER                  PIC  X(10)    VALUE              02290000
021600         'ALLW CDE  '.                                            02300000
021700     05  FILLER                  PIC  X(14)    VALUE              02310000
021800         'ALLW PERCENT  '.                                        02320000
021900     05  FILLER                  PIC  X(10)    VALUE              02330000
022000         'ALLW AMT  '.                                            02340000
022210     05  FILLER                  PIC  X(05)    VALUE              02350000
022220         'DC # '.                                                 02360000
022230     05  FILLER                  PIC  X(05)    VALUE              02370000
022240         ' LVL '.                                                 02380000
022300     05  FILLER                  PIC  X(05)    VALUE SPACES.      02390000
022400                                                                  02400000
022500 01  INV-HDR-LINE2.                                               02410000
022600     05  FILLER                  PIC  X(12)    VALUE              02420000
022700         '----------  '.                                          02430000
022800     05  FILLER                  PIC  X(24)    VALUE              02440000
022900         '----------------------  '.                              02450000
023000     05  FILLER                  PIC  X(09)    VALUE              02460000
023100         '-------  '.                                             02470000
023200     05  FILLER                  PIC  X(08)    VALUE              02480000
023300         '------  '.                                              02490000
023400     05  FILLER                  PIC  X(14)    VALUE              02500000
023500         '------------  '.                                        02510000
023600     05  FILLER                  PIC  X(16)    VALUE              02520000
023700         '--------------  '.                                      02530000
023800     05  FILLER                  PIC  X(10)    VALUE              02540000
023900         '--------  '.                                            02550000
024000     05  FILLER                  PIC  X(14)    VALUE              02560000
024100         '------------  '.                                        02570000
024200     05  FILLER                  PIC  X(10)    VALUE              02580000
024300         '--------  '.                                            02590000
024510     05  FILLER                  PIC  X(07)    VALUE              02600000
024520         '-----  '.                                               02610000
024530     05  FILLER                  PIC  X(03)    VALUE              02620000
024540         '---'.                                                   02630000
024700                                                                  02640000
024800 01  DETAIL-LINE                 PIC  X(132)   VALUE SPACES.      02650000
024900                                                                  02660000
025000 01  INV-DETAIL-LINE             REDEFINES  DETAIL-LINE.          02670000
025100     05  FILLER                  PIC  X(01).                      02680000
025200     05  IDL-ENTRY-DATE.                                          02690000
025300         10  IDL-ENTRY-MONTH     PIC  9(02).                      02700000
025400         10  IDL-ENTRY-LIT1      PIC  X(01).                      02710000
025500         10  IDL-ENTRY-DAY       PIC  9(02).                      02720000
025600         10  IDL-ENTRY-LIT2      PIC  X(01).                      02730000
025700         10  IDL-ENTRY-YEAR      PIC  9(02).                      02740000
025800     05  FILLER                  PIC  X(03).                      02750000
025900     05  IDL-INVOICE-NUMBER      PIC  X(22).                      02760000
026000     05  FILLER                  PIC  X(03).                      02770000
026100     05  IDL-STORE-NUMBER        PIC  9(04).                      02780000
026200     05  FILLER                  PIC  X(06).                      02790000
026300     05  IDL-INVOICE-DETAIL-IND  PIC  X(01).                      02800000
026400     05  FILLER                  PIC  X(05).                      02810000
026500     05  IDL-INVOICE-ENTRY-METHOD PIC X(06).                      02820000
026600     05  FILLER                  PIC  X(08).                      02830000
026700     05  IDL-GROSS-INVOICE-AMT   PIC  ZZZ,ZZZ,ZZ9.99.             02840000
026800     05  FILLER                  PIC  X(03).                      02850000
026900     05  IDL-ALLW-CDE.                                            02860000
027000         10  IDL-ALLW-CDE-FILL1  PIC  X(01).                      02870000
027100         10  IDL-ALLW-CDE-TXT    PIC  X(03).                      02880000
027200         10  IDL-ALLW-CDE-FILL2  PIC  X(01).                      02890000
027300     05  FILLER                  PIC  X(07).                      02900000
027400     05  IDL-ALLW-PERCENT        PIC  Z9.99.                      02910000
027500     05  FILLER                  PIC  X(01).                      02920000
027600     05  IDL-ALLW-PERCENT-SIGN   PIC  X(01).                      02930000
027700     05  FILLER                  PIC  X(02).                      02940000
027800     05  IDL-ALLW-AMT            PIC  ZZZ,ZZ9.99.                 02950000
027900     05  FILLER                  PIC  X(03).                      02960000
028020     05  IDL-DC-NUMBER           PIC  X(03).                      02970000
028100     05  FILLER                  PIC  X(04).                      02980000
028101     05  IDL-MTCH-LVL-CDE        PIC  X(01).                      02990000
028110     05  FILLER                  PIC  X(04).                      03000000
028200                                                                  03010000
028300 01  INV-DETAIL-LINE2            REDEFINES  DETAIL-LINE.          03020000
028400     05  DL2-TYPE                PIC  X(29).                      03030000
028500     05  FILLER                  PIC  X(01).                      03040000
028600     05  DL2-COUNT               PIC  Z,ZZZ,ZZ9.                  03050000
028700     05  FILLER                  PIC  X(01).                      03060000
028800     05  DL2-AMOUNT              PIC  ZZ,ZZZ,ZZZ,ZZ9.99.          03070000
028900     05  FILLER                  PIC  X(75).                      03080000
029000                                                                  03090000
029100 01  POLNE-DETAIL-LINE           REDEFINES  DETAIL-LINE.          03100000
029200     05  PDL-APP-PO-LINE-NBR     PIC  Z(03)9.                     03110000
029300     05  FILLER                  PIC  X(03).                      03120000
029400     05  PDL-SKU                 PIC  X(08).                      03130000
029500     05  FILLER                  PIC  X(04).                      03140000
029600     05  PDL-UPC-NUMBER          PIC  X(16).                      03150000
029700     05  FILLER                  PIC  X(02).                      03160000
029800     05  PDL-VENDOR-STYLE        PIC  X(20).                      03170000
029900     05  FILLER                  PIC  X(02).                      03180000
030000     05  PDL-SKU-DESC            PIC  X(25).                      03190000
030100     05  FILLER                  PIC  X(02).                      03200000
030200     05  PDL-COLOR-DESC          PIC  X(10).                      03210000
030300     05  FILLER                  PIC  X(02).                      03220000
030400     05  PDL-SIZE-DESC           PIC  X(10).                      03230000
030500     05  FILLER                  PIC  X(02).                      03240000
030600     05  PDL-RCVD-UNIT-QTY       PIC  Z(07)9.                     03250000
030700     05  FILLER                  PIC  X(02).                      03260000
030800     05  PDL-RCVD-UNIT-COST      PIC  Z,ZZZ,ZZZ.99.               03270000
030900                                                                  03280000
031000 01  POLNE-HDR-LINE1.                                             03290000
031100     05  FILLER                  PIC  X(03)    VALUE ' PO'.       03300000
031200     05  FILLER                  PIC  X(122)   VALUE SPACES.      03310000
031300     05  FILLER                  PIC  X(04)    VALUE 'RCVD'.      03320000
031400     05  FILLER                  PIC  X(03)    VALUE SPACES.      03330000
031500                                                                  03340000
031600 01  POLNE-HDR-LINE2.                                             03350000
031700     05  FILLER                  PIC  X(07)    VALUE              03360000
031800         'LINE   '.                                               03370000
031900     05  FILLER                  PIC  X(03)    VALUE              03380000
032000         'SKU'.                                                   03390000
032100     05  FILLER                  PIC  X(09)    VALUE SPACES.      03400000
032200     05  FILLER                  PIC  X(03)    VALUE              03410000
032300         'UPC'.                                                   03420000
032400     05  FILLER                  PIC  X(15)    VALUE SPACES.      03430000
032500     05  FILLER                  PIC  X(12)    VALUE              03440000
032600         'VENDOR STYLE'.                                          03450000
032700     05  FILLER                  PIC  X(10)    VALUE SPACES.      03460000
032800     05  FILLER                  PIC  X(15)    VALUE              03470000
032900         'SKU DESCRIPTION'.                                       03480000
033000     05  FILLER                  PIC  X(12)    VALUE SPACES.      03490000
033100     05  FILLER                  PIC  X(12)    VALUE              03500000
033200         'COLOR       '.                                          03510000
033300     05  FILLER                  PIC  X(12)    VALUE              03520000
033400         'SIZE        '.                                          03530000
033500     05  FILLER                  PIC  X(13)    VALUE              03540000
033600         'RCVD QTY     '.                                         03550000
033700     05  FILLER                  PIC  X(09)    VALUE              03560000
033800         'UNIT COST'.                                             03570000
033900                                                                  03580000
034000 01  POLNE-HDR-LINE3.                                             03590000
034100     05  FILLER                  PIC  X(07)    VALUE              03600000
034200         '----   '.                                               03610000
034300     05  FILLER                  PIC  X(12)    VALUE              03620000
034400         '----------  '.                                          03630000
034500     05  FILLER                  PIC  X(18)    VALUE              03640000
034600         '----------------  '.                                    03650000
034700     05  FILLER                  PIC  X(22)    VALUE              03660000
034800         '--------------------  '.                                03670000
034900     05  FILLER                  PIC  X(27)    VALUE              03680000
035000         '-------------------------  '.                           03690000
035100     05  FILLER                  PIC  X(12)    VALUE              03700000
035200         '----------  '.                                          03710000
035300     05  FILLER                  PIC  X(12)    VALUE              03720000
035400         '----------  '.                                          03730000
035500     05  FILLER                  PIC  X(10)    VALUE              03740000
035600         '--------  '.                                            03750000
035700     05  FILLER                  PIC  X(12)    VALUE              03760000
035800         '------------'.                                          03770000
035900                                                                  03780000
036000 01  EOR-END-OF-REPORT.                                           03790000
036100     05  FILLER                  PIC  X(52)  VALUE SPACES.        03800000
036200     05  FILLER                  PIC  X(80)  VALUE                03810000
036300         '*****  END OF REPORT *****'.                            03820000
036400                                                                  03830000
036500 EJECT                                                            03840000
036600*  ABEND AREA                                                     03850000
036700                                                                  03860000
036800 01  ABEND-CODE                  PIC S9(04)  COMP.                03870000
036900     88  AC-MISSING-HEADER       VALUE +4001.                     03880000
037000                                                                  03890000
037100 01  ABEND-AREAS.                                                 03900000
037200     05  AA-ABEND-LIT            PIC  X(40)  VALUE                03910000
037300             '*****       ABEND'.                                 03920000
037400     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                03930000
037500             '*****   PROGRAM: '.                                 03940000
037600     05  AA-PARAGRAPH-LIT        PIC  X(40)  VALUE                03950000
037700             '***** PARAGRAPH: '.                                 03960000
037800     05  AA-ABEND-OPERATION      PIC  X(50)  VALUE SPACES.        03970000
037900     05  AA-MESSAGE-LINE.                                         03980000
038000         10  FILLER              PIC  X(06)  VALUE '*****'.       03990000
038100         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        04000000
038200     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                04010000
038300             '*****    DB2 ERROR'.                                04020000
038400     05  AA-DB2-OPERATION-LIT.                                    04030000
038500         10  FILLER              PIC  X(17)  VALUE                04040000
038600             '***** OPERATION: '.                                 04050000
038700         10  AA-DB2-OPERATION.                                    04060000
038800             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        04070000
038900             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        04080000
039000     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        04090000
039100     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        04100000
039200     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        04110000
039300     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        04120000
039400     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        04130000
039500                                                                  04140000
039600     COPY DPWS004.                                                04150000
039700                                                                  04160000
039800 01  FILLER                      PIC  X(25)  VALUE                04170000
039900     '** END OF APKRP271 W/S **'.                                 04180000
040000                                                                  04190000
040100 EJECT                                                            04200000
040200*  DB2 AREA                                                       04210000
040300                                                                  04220000
040400     COPY SQLCA2.                                                 04230000
040500                                                                  04240000
040600     EXEC SQL                                                     04250000
040700          INCLUDE SQLCA                                           04260000
040800     END-EXEC.                                                    04270000
040900                                                                  04280000
041000*---------------------------------------------------------------* 04290000
041100*    DB2 AREA FOR THE SKU TABLE                                 * 04300000
041200*---------------------------------------------------------------* 04310000
041300     EXEC SQL                                                     04320000
041400          INCLUDE TSKXREF                                         04330000
041500     END-EXEC.                                                    04340000
041600/                                                                 04350000
041700*---------------------------------------------------------------* 04360000
041800*    DB2 AREA FOR THE UPC SKU TABLE                             * 04370000
041900*---------------------------------------------------------------* 04380000
042000     EXEC SQL                                                     04390000
042100          INCLUDE TUPCSKU                                         04400000
042200     END-EXEC.                                                    04410000
042300/                                                                 04420000
042400*---------------------------------------------------------------* 04430000
042500*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 04440000
042600*---------------------------------------------------------------* 04450000
042700     EXEC SQL                                                     04460000
042800          INCLUDE TPURCHS                                         04470000
042900     END-EXEC.                                                    04480000
043000                                                                  04490000
043100/                                                                 04500000
043200*---------------------------------------------------------------* 04510000
043300*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 04520000
043400*---------------------------------------------------------------* 04530000
043500     EXEC SQL                                                     04540000
043600          INCLUDE TPURITM                                         04550000
043700     END-EXEC.                                                    04560000
043800                                                                  04570000
043900/                                                                 04580000
044000*---------------------------------------------------------------* 04590000
044100*    DB2 AREA FOR THE ALLOWANCE/CHARGE TABLE                    * 04600000
044200*---------------------------------------------------------------* 04610000
044300     EXEC SQL                                                     04620000
044400          INCLUDE TALCHRG                                         04630000
044500     END-EXEC.                                                    04640000
044600                                                                  04650000
044700/                                                                 04660000
044800*---------------------------------------------------------------* 04670000
044900*  CURSOR TO SELECT LINE ITEMS WHEN PO IS APPROVED              * 04680000
045000*---------------------------------------------------------------* 04690000
045100                                                                  04700000
045200     EXEC SQL                                                     04710000
045300         DECLARE ITEM-CSR CURSOR FOR                              04720000
045400          SELECT A.APP_PO_LNE_NBR                                 04730000
045500                ,A.RMS_PO_SKU_NBR                                 04740000
045600                ,A.ITM_NBR                                        04750000
045700                ,A.VEND_STYL_NAME                                 04760000
045800                ,A.SKU_DESC                                       04770000
045900                ,A.COLOR_DESC                                     04780000
046000                ,A.SIZE_DESC                                      04790000
046100                ,B.SKU                                            04800000
046200           FROM TPURITM A                                         04810000
046300               ,TSKXREF B                                         04820000
046400          WHERE A.ITM_NBR        = B.ITM_NBR                      04830000
046500            AND A.PO_NBR         = :PW-PO-NBR                     04840000
046600            AND A.VER_STATUS_CDE = 'A'                            04850000
046700          ORDER BY                                                04860000
046800                A.APP_PO_LNE_NBR                                  04870000
046900     END-EXEC.                                                    04880000
047000                                                                  04890000
047100/                                                                 04900000
047200*----------------------------------------------------------------*04910000
047300* DISCOUNT-CSR GETS ALL DISCOUNTS FOR THE INVOICE.               *04920000
047400*----------------------------------------------------------------*04930000
047500     EXEC SQL                                                     04940000
047600       DECLARE DISCOUNT-CSR CURSOR FOR                            04950000
047700         SELECT ALW_CHRG_AMT                                      04960000
047800               ,ALW_CHRG_PCT                                      04970000
047900               ,ALW_CHRG_CDE                                      04980000
048000            FROM TALCHRG                                          04990000
048100            WHERE PO_NBR          = :PW-PO-NBR                    05000000
048200              AND INVC_ID         = :AP271-INVOICE-NUMBER         05010000
048300              AND ALW_CHRG_TYP_CDE = 'A'                          05020000
048400     END-EXEC.                                                    05030000
048500                                                                  05040000
048600                                                                  05050000
048700 EJECT                                                            05060000
048800 PROCEDURE DIVISION.                                              05070000
048900                                                                  05080000
049000***************************************************************** 05090000
049100*  MAIN PARAGRAPH                                                 05100000
049200***************************************************************** 05110000
049300 0000-MAIN.                                                       05120000
049400                                                                  05130000
049500     MOVE '0000-MAIN'            TO   PW-CURRENT-PARAGRAPH.       05140000
049600                                                                  05150000
049700     PERFORM 1000-BEGIN-PROGRAM.                                  05160000
049800                                                                  05170000
049900     PERFORM 2000-PROCESS-INPUT                                   05180000
050000         UNTIL EOF.                                               05190000
050100                                                                  05200000
050200     PERFORM 3000-END-PROGRAM.                                    05210000
050300                                                                  05220000
050400     GOBACK.                                                      05230000
050500                                                                  05240000
050600 EJECT                                                            05250000
050700***************************************************************** 05260000
050800*  BEGIN PROGRAM STUFF                                            05270000
050900*                                                                 05280000
051000*  CALLED FROM 0000-MAIN                                          05290000
051100***************************************************************** 05300000
051200 1000-BEGIN-PROGRAM.                                              05310000
051300                                                                  05320000
051400     MOVE '1000-BEGIN-PROGRAM'   TO   PW-CURRENT-PARAGRAPH.       05330000
051500                                                                  05340000
051600     OPEN INPUT  INVOIC-REQ-DTL-FILE                              05350000
051700          OUTPUT RPT01-FILE.                                      05360000
051800                                                                  05370000
051900     ACCEPT PW-CURRENT-DATE      FROM DATE.                       05380000
052000     MOVE PW-CURRENT-MONTH       TO   DP133O-RUN-MONTH.           05390000
052100     MOVE PW-CURRENT-DAY         TO   DP133O-RUN-DAY.             05400000
052200     MOVE PW-CURRENT-YEAR        TO   DP133O-RUN-YEAR.            05410000
052300                                                                  05420000
052400     ACCEPT PW-CURRENT-TIME      FROM TIME.                       05430000
052500     MOVE PW-CURRENT-HOUR        TO   DP133O-RUN-HOUR.            05440000
052600     MOVE PW-CURRENT-MINUTE      TO   DP133O-RUN-MINUTE.          05450000
052700                                                                  05460000
052800     MOVE PW-PROGRAM-NAME        TO   DP133O-PROGRAM-NAME.        05470000
052900     MOVE 1                      TO   DP133O-REPORT-NUMBER.       05480000
053000                                                                  05490000
053100     MOVE SPACE                  TO   DETAIL-LINE.                05500000
053200                                                                  05510000
053300     PERFORM 8000-READ-INVOIC-REQ-DTL-FILE.                       05520000
053400                                                                  05530000
053500 EJECT                                                            05540000
053600***************************************************************** 05550000
053700*  2000-PROCESS-INPUT FIRST VERIFIES THE INPUT FILE IS IN THE     05560000
053800*  CORRECT SEQUENCE AND THEN PREPARES REPORT LINES DEPENDING ON   05570000
053900*  THE INPUT RECORD TYPE.  PAGE BREAKS OCCUR ON EACH PO/STORE     05580000
054000*  COMBINATION.                                                   05590000
054100*  FOR BULK PROCESSING THE RECORD SEQUENCE EXPECTED IS:           05600000
054200*      HEADER, INVOICES, PO LINES                                 05610000
054300*   OR HEADER, INVOICES                                           05620000
054400*  FOR BY STORE PROCESSING THE RECORD SEQUENCE EXPECTED IS:       05630000
054500*      HEADER, INVOICES - FIRST STORE, PO LINES - FIRST STORE,    05640000
054600*      HEADER, INVOICES - SECOND STORE, PO LINES - SECOND STORE,  05650000
054700*      ETC.                                                       05660000
054800*   OR HEADER, INVOICES                                           05670000
054900*                                                                 05680000
055000*  CALLED FROM 0000-MAIN                                          05690000
055100***************************************************************** 05700000
055200 2000-PROCESS-INPUT.                                              05710000
055300                                                                  05720000
055400     MOVE '2000-PROCESS-INPUT'   TO   PW-CURRENT-PARAGRAPH.       05730000
055500                                                                  05740000
055600     IF HEADER-REC                                                05750000
055700       AND NOT INVOICE-REPORTING                                  05760000
055800*      FALL THRU TO PO LINE PROCESSING IF NO PO LINE RECS ARE     05770000
055900*      ON THE INPUT FILE FOR THIS PO                              05780000
056000         MOVE SPACE TO PS-REPORTING-SW                            05790000
056100         MOVE 'N'   TO PS-EOF-PO-ITEM-CSR-SW                      05800000
056200         MOVE 'N'   TO PS-END-OF-PO-LINE-RECS-SW                  05810000
056300         PERFORM 2100-PROCESS-HEADER                              05820000
056400         SET NOT-INVOICE-FOUND TO TRUE                            05830000
056500         PERFORM 8000-READ-INVOIC-REQ-DTL-FILE                    05840000
056600     ELSE                                                         05850000
056700         IF INVOICE-REC                                           05860000
056800             IF PO-LINE-REPORTING                                 05870000
056900                 IF PW-PO-NBR = AP271-PURCHASE-ORDER              05880000
057000*  NEW STORE FOR THE SAME PO -- FORCE PAGE BREAK, RESET EOF SW    05890000
057100                     MOVE +99   TO PR-LINE-COUNT                  05900000
057200                     MOVE 'N'   TO PS-EOF-PO-ITEM-CSR-SW          05910000
057300                     MOVE 'N'   TO PS-END-OF-PO-LINE-RECS-SW      05920000
057400                 ELSE                                             05930000
057500*  A NEW PO IS ENCOUNTERED WITHOUT A HEADER RECORD                05940000
057600                     MOVE                                         05950000
057700                      'SEQUENCE ERROR - HEADER RECORD MISSING'    05960000
057800                         TO AA-ABEND-OPERATION                    05970000
057900                     SET AC-MISSING-HEADER TO TRUE                05980000
058000                     PERFORM 9999-ABEND                           05990000
058100                 END-IF                                           06000000
058200             END-IF                                               06010000
058300             SET INVOICE-REPORTING TO TRUE                        06020000
058400             SET INVOICE-FOUND TO TRUE                            06030000
058500             PERFORM 2200-PROCESS-INVOICE                         06040000
058600             PERFORM 8000-READ-INVOIC-REQ-DTL-FILE                06050000
058700         ELSE                                                     06060000
058800             IF HEADER-REC                                        06070000
058900                 SET END-OF-PO-LINE-RECS TO TRUE                  06080000
059000             END-IF                                               06090000
059100             IF PO-LINE-REC                                       06100000
059200               AND (AP271-PURCHASE-ORDER NOT = PW-PO-NBR OR       06110000
059300                    AP271-VENDOR-NAME    NOT = PW-VENDOR-NAME OR  06120000
059400                    NOT-INVOICE-FOUND)                            06130000
059500                 PERFORM 8000-READ-INVOIC-REQ-DTL-FILE            06140000
059600             ELSE                                                 06150000
059700                 SET PO-LINE-REPORTING TO TRUE                    06160000
059800                 PERFORM 2300-PROCESS-PO-LINES                    06170000
059900             END-IF                                               06180000
060000         END-IF                                                   06190000
060100     END-IF.                                                      06200000
060200                                                                  06210000
060300                                                                  06220000
060400 EJECT                                                            06230000
060500***************************************************************** 06240000
060600*  PROCESSES A HEADER RECORD.  MOVES VENDOR AND PO INFO TO A      06250000
060700*  REPORT HEADER LINE SO WE DO NOT REPEAT THIS STUFF.  DETECTS    06260000
060800*  A NEW PO AND PLACES IT ON A NEW PAGE.  OBTAINS THE PO          06270000
060900*  DEPARTMENT TO BE USED FOR THE PO LINE SKU NUMBERS.             06280000
061000*                                                                 06290000
061100*  CALLED FROM 2000-PROCESS-INPUT                                 06300000
061200***************************************************************** 06310000
061300 2100-PROCESS-HEADER.                                             06320000
061400                                                                  06330000
061500     MOVE '2100-PROCESS-HEADER'  TO   PW-CURRENT-PARAGRAPH.       06340000
061600                                                                  06350000
061700     MOVE 2                      TO   PR-DETAIL-CC.               06360000
061800                                                                  06370000
061900     MOVE AP271-PURCHASE-ORDER   TO   HL3-PO-NBR                  06380000
062000                                      PW-PO-NBR.                  06390000
062100     MOVE AP271-VENDOR-NAME      TO   HL3-VENDOR-NAME             06400000
062200                                      PW-VENDOR-NAME.             06410000
062300     MOVE AP271-VENDOR-NUMBER    TO   HL3-VENDOR-NUMBER.          06420000
062400                                                                  06430000
062500     MOVE 99                     TO   PR-LINE-COUNT.              06440000
062600                                                                  06450000
062700     PERFORM WITH TEST AFTER                                      06460000
062800         VARYING SUB2 FROM 1 BY 1                                 06470000
062900             UNTIL SUB2 > DB2-RETRY-MAX OR                        06480000
063000                   SQLCODE = ZERO                                 06490000
063100                                                                  06500000
063200         EXEC SQL                                                 06510000
063300             SELECT DEPT_NBR                                      06520000
063400               INTO :PURCHS-DEPT-NBR                              06530000
063500               FROM TPURCHS                                       06540000
063600               WHERE PO_NBR         = :PW-PO-NBR                  06550000
063700                AND VER_STATUS_CDE = 'A'                          06560000
063800         END-EXEC                                                 06570000
063900                                                                  06580000
064000         EVALUATE TRUE                                            06590000
064100             WHEN SQLCODE = ZERO                                  06600000
064200                  CONTINUE                                        06610000
064300                                                                  06620000
064400             WHEN SQLCODE = -904                                  06630000
064500             WHEN SQLCODE = -913                                  06640000
064600                  CONTINUE                                        06650000
064700                                                                  06660000
064800             WHEN SQLWARN0 NOT = SPACES                           06670000
064900             WHEN SQLCODE  NOT = ZERO                             06680000
065000                 MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'            06690000
065100                                 TO   AA-DB2-OPERATION            06700000
065200                 MOVE 'TPURCHS'  TO   AA-DB2-TABLE-1              06710000
065300                 MOVE SPACE      TO   AA-DB2-TABLE-2              06720000
065400                                      AA-DB2-TABLE-3              06730000
065500                                      AA-DB2-TABLE-4              06740000
065600                                      AA-DB2-TABLE-5              06750000
065700                 PERFORM 9998-DB2-ABEND                           06760000
065800         END-EVALUATE                                             06770000
065900     END-PERFORM.                                                 06780000
066000                                                                  06790000
066100     IF SUB2 > DB2-RETRY-MAX                                      06800000
066200         MOVE 'MAX RETRIES EXCEEDED ON TPURCHS SELECT'            06810000
066300                                 TO   AA-DB2-OPERATION            06820000
066400         MOVE 'TPURCHS'          TO   AA-DB2-TABLE-1              06830000
066500         MOVE SPACE              TO   AA-DB2-TABLE-2              06840000
066600                                      AA-DB2-TABLE-3              06850000
066700                                      AA-DB2-TABLE-4              06860000
066800                                      AA-DB2-TABLE-5              06870000
066900         PERFORM 9998-DB2-ABEND                                   06880000
067000     END-IF.                                                      06890000
067100                                                                  06900000
067200 EJECT                                                            06910000
067300***************************************************************** 06920000
067400*  DETERMINES WHICH TYPE OF INVOICE DETAIL LINE IS TO BE CREATED  06930000
067500*                                                                 06940000
067600*  CALLED FROM 2000-PROCESS-INPUT                                 06950000
067700***************************************************************** 06960000
067800 2200-PROCESS-INVOICE.                                            06970000
067900                                                                  06980000
068000     MOVE '2200-PROCESS-INVOICE' TO   PW-CURRENT-PARAGRAPH.       06990000
068100                                                                  07000000
068200     PERFORM 2210-FORMAT-INV-DETAIL-LINE1.                        07010000
068300                                                                  07020000
068400     IF AP271-ADDIT-ALLOW-IND EQUAL 'Y'                           07030000
068500*      PROCESS THE DISCOUNT CURSOR                                07040000
068600         MOVE 'N'   TO PS-EOF-DISCOUNT-CSR-SW                     07050000
068700         PERFORM 2230-OPEN-DISCOUNT-CSR                           07060000
068800         PERFORM 2240-PROCESS-DISCOUNTS                           07070000
068900             UNTIL EOF-DISCOUNT-CSR                               07080000
069000         PERFORM 2250-CLOSE-DISCOUNT-CSR                          07090000
069100     END-IF.                                                      07100000
069200                                                                  07110000
069300 EJECT                                                            07120000
069400***************************************************************** 07130000
069500*  FORMATS AND WRITES AN INVOICE DETAIL LINE 1                    07140000
069600*                                                                 07150000
069700*  CALLED FROM 2200-PROCESS-INVOICE                               07160000
069800***************************************************************** 07170000
069900 2210-FORMAT-INV-DETAIL-LINE1.                                    07180000
070000                                                                  07190000
070100     MOVE '2210-FORMAT-INV-DETAIL-LINE1' TO PW-CURRENT-PARAGRAPH. 07200000
070200                                                                  07210000
070300*  FORMAT PRINT LINE                                              07220000
070400                                                                  07230000
070500     MOVE AP271-ENTRY-MONTH      TO   IDL-ENTRY-MONTH.            07240000
070600     MOVE '-'                    TO   IDL-ENTRY-LIT1.             07250000
070700     MOVE AP271-ENTRY-DAY        TO   IDL-ENTRY-DAY.              07260000
070800     MOVE '-'                    TO   IDL-ENTRY-LIT2.             07270000
070900     MOVE AP271-ENTRY-YEAR       TO   IDL-ENTRY-YEAR.             07280000
071000     MOVE AP271-INVOICE-NUMBER   TO   IDL-INVOICE-NUMBER.         07290000
071100     MOVE AP271-STORE-NUMBER     TO   IDL-STORE-NUMBER.           07300000
071110     MOVE AP271-DC-NBR           TO   IDL-DC-NUMBER.              07310000
071120     MOVE AP271-MTCH-LVL-CDE     TO   IDL-MTCH-LVL-CDE.           07320000
071200     MOVE AP271-DETAIL-ENTERED-IND                                07330000
071300                                 TO   IDL-INVOICE-DETAIL-IND.     07340000
071400                                                                  07350000
071500     IF AP271-INVOICE-ENTRY-METHOD EQUAL 'MN'                     07360000
071600         MOVE 'MANUAL'           TO   IDL-INVOICE-ENTRY-METHOD    07370000
071700     ELSE                                                         07380000
071800         IF AP271-INVOICE-ENTRY-METHOD EQUAL 'ED'                 07390000
071900             MOVE 'EDI'          TO   IDL-INVOICE-ENTRY-METHOD    07400000
072000         ELSE                                                     07410000
072100             MOVE SPACES         TO   IDL-INVOICE-ENTRY-METHOD    07420000
072200         END-IF                                                   07430000
072300     END-IF.                                                      07440000
072400                                                                  07450000
072500     MOVE AP271-GROSS-INVOICE-AMT                                 07460000
072600                                 TO   IDL-GROSS-INVOICE-AMT.      07470000
072800     MOVE '%'                    TO   IDL-ALLW-PERCENT-SIGN.      07480000
072900     MOVE 'TERMS'                TO   IDL-ALLW-CDE.               07490000
073000     MULTIPLY AP271-ALLW-CHRG-PCT BY 100 GIVING IDL-ALLW-PERCENT. 07500000
073100                                                                  07510000
073200*  WRITE REPORT & CLEAR DETAIL                                    07520000
073300                                                                  07530000
073400     PERFORM 9100-WRITE-DETAIL.                                   07540000
073500                                                                  07550000
073600     MOVE SPACE                  TO   DETAIL-LINE.                07560000
073700     MOVE 1                      TO   PR-DETAIL-CC.               07570000
073800                                                                  07580000
073900*  ACCUMULATE TOTALS                                              07590000
074000                                                                  07600000
074100     IF AP271-DETAIL-ENTERED-IND EQUAL 'Y'                        07610000
074200         ADD 1                   TO   T-DETAIL-COUNT              07620000
074300         ADD AP271-GROSS-INVOICE-AMT                              07630000
074400                                 TO   T-DETAIL-AMOUNT             07640000
074500     END-IF.                                                      07650000
074600                                                                  07660000
074700     ADD 1                       TO   T-REPORT-COUNT.             07670000
074800     ADD AP271-GROSS-INVOICE-AMT                                  07680000
074900                                 TO   T-REPORT-AMOUNT.            07690000
075000                                                                  07700000
075100 EJECT                                                            07710000
075200***************************************************************** 07720000
075300*  FORMATS AND WRITES AN INVOICE DETAIL LINE 2                    07730000
075400*                                                                 07740000
075500*  CALLED FROM 2200-PROCESS-INVOICE                               07750000
075600***************************************************************** 07760000
075700 2220-FORMAT-INV-DETAIL-LINE2.                                    07770000
075800                                                                  07780000
075900     MOVE '2220-FORMAT-INV-DETAIL-LINE2' TO PW-CURRENT-PARAGRAPH. 07790000
076000                                                                  07800000
076100*  FORMAT PRINT LINE                                              07810000
076200                                                                  07820000
076300     MOVE ALCHRG-ALW-CHRG-CDE    TO   IDL-ALLW-CDE-TXT.           07830000
076400     MULTIPLY ALCHRG-ALW-CHRG-PCT BY 100 GIVING IDL-ALLW-PERCENT. 07840000
076500     MOVE '%'                    TO   IDL-ALLW-PERCENT-SIGN.      07850000
076600     MOVE ALCHRG-ALW-CHRG-AMT    TO   IDL-ALLW-AMT.               07860000
076700                                                                  07870000
076800*  WRITE REPORT & CLEAR DETAIL                                    07880000
076900                                                                  07890000
077000     PERFORM 9100-WRITE-DETAIL.                                   07900000
077100                                                                  07910000
077200     MOVE SPACE                  TO   DETAIL-LINE.                07920000
077300     MOVE 1                      TO   PR-DETAIL-CC.               07930000
077400                                                                  07940000
077500 EJECT                                                            07950000
077600***************************************************************** 07960000
077700*  OPENS THE ALLOWANCE DISCOUNT CURSOR                            07970000
077800*                                                                 07980000
077900*  CALLED FROM 2200-PROCESS-INVOICE                               07990000
078000***************************************************************** 08000000
078100 2230-OPEN-DISCOUNT-CSR.                                          08010000
078200                                                                  08020000
078300     MOVE '2230-OPEN-DISCOUNT-CSR' TO  PW-CURRENT-PARAGRAPH.      08030000
078400                                                                  08040000
078500     PERFORM WITH TEST AFTER                                      08050000
078600         VARYING SUB2 FROM 1 BY 1                                 08060000
078700             UNTIL SUB2 > DB2-RETRY-MAX OR                        08070000
078800                   SQLCODE = ZERO                                 08080000
078900                                                                  08090000
079000         EXEC SQL                                                 08100000
079100              OPEN DISCOUNT-CSR                                   08110000
079200         END-EXEC                                                 08120000
079300                                                                  08130000
079400         EVALUATE TRUE                                            08140000
079500             WHEN SQLCODE = ZERO                                  08150000
079600                  CONTINUE                                        08160000
079700                                                                  08170000
079800             WHEN SQLCODE = -904                                  08180000
079900             WHEN SQLCODE = -913                                  08190000
080000                  CONTINUE                                        08200000
080100                                                                  08210000
080200             WHEN SQLWARN0 NOT = SPACES                           08220000
080300             WHEN SQLCODE  NOT = ZERO                             08230000
080400                 MOVE 'UNSUCCESSFUL DISCOUNT CURSOR OPEN'         08240000
080500                                 TO   AA-DB2-OPERATION            08250000
080600                 MOVE 'TALCHRG'  TO   AA-DB2-TABLE-1              08260000
080700                 MOVE SPACE      TO   AA-DB2-TABLE-2              08270000
080800                                      AA-DB2-TABLE-3              08280000
080900                                      AA-DB2-TABLE-4              08290000
081000                                      AA-DB2-TABLE-5              08300000
081100                 PERFORM 9998-DB2-ABEND                           08310000
081200         END-EVALUATE                                             08320000
081300     END-PERFORM.                                                 08330000
081400                                                                  08340000
081500     IF SUB2 > DB2-RETRY-MAX                                      08350000
081600         MOVE 'MAX RETRIES EXCEEDED ON DISCOUNT CURSOR OPEN'      08360000
081700                                 TO   AA-DB2-OPERATION            08370000
081800         MOVE 'TALCHRG'          TO   AA-DB2-TABLE-1              08380000
081900         MOVE SPACE              TO   AA-DB2-TABLE-2              08390000
082000                                      AA-DB2-TABLE-3              08400000
082100                                      AA-DB2-TABLE-4              08410000
082200                                      AA-DB2-TABLE-5              08420000
082300         PERFORM 9998-DB2-ABEND                                   08430000
082400     END-IF.                                                      08440000
082500                                                                  08450000
082600 EJECT                                                            08460000
082700*----------------------------------------------------------------*08470000
082800*    RETRIEVES ALL DISCOUNTS FOR THE SPECIFIED INVOICE.          *08480000
082900*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE SIMPLY        *08490000
083000*           RESULTS IN THE OUT OF DISCOUNTS SWITCH BEING SET.    *08500000
083100*----------------------------------------------------------------*08510000
083200 2240-PROCESS-DISCOUNTS.                                          08520000
083300                                                                  08530000
083400     MOVE '2240-PROCESS-DISCOUNTS' TO PW-CURRENT-PARAGRAPH.       08540000
083500                                                                  08550000
083600     PERFORM WITH TEST AFTER                                      08560000
083700         VARYING SUB2 FROM 1 BY 1                                 08570000
083800             UNTIL SUB2 > DB2-RETRY-MAX OR                        08580000
083900                   SQLCODE = ZERO OR                              08590000
084000                   SQLCODE = +100                                 08600000
084100                                                                  08610000
084200             EXEC SQL                                             08620000
084300                 FETCH DISCOUNT-CSR                               08630000
084400                 INTO :ALCHRG-ALW-CHRG-AMT                        08640000
084500                     ,:ALCHRG-ALW-CHRG-PCT                        08650000
084600                     ,:ALCHRG-ALW-CHRG-CDE                        08660000
084700             END-EXEC                                             08670000
084800                                                                  08680000
084900             EVALUATE TRUE                                        08690000
085000                 WHEN SQLCODE = ZERO                              08700000
085100                     PERFORM 2220-FORMAT-INV-DETAIL-LINE2         08710000
085200                 WHEN SQLCODE = +100                              08720000
085300                     SET EOF-DISCOUNT-CSR TO TRUE                 08730000
085400                 WHEN SQLCODE = -904                              08740000
085500                 WHEN SQLCODE = -913                              08750000
085600                      CONTINUE                                    08760000
085700                                                                  08770000
085800                 WHEN SQLWARN0 NOT = SPACES                       08780000
085900                 WHEN SQLCODE  NOT = ZERO                         08790000
086000                     MOVE                                         08800000
086100                       'UNSUCCESSFUL FETCH WITH DISCOUNT-CSR'     08810000
086200                                         TO AA-DB2-OPERATION      08820000
086300                     MOVE 'TALCHRG'      TO AA-DB2-TABLE-1        08830000
086400                     MOVE SPACES         TO AA-DB2-TABLE-2        08840000
086500                                            AA-DB2-TABLE-3        08850000
086600                                            AA-DB2-TABLE-4        08860000
086700                                            AA-DB2-TABLE-5        08870000
086800                     PERFORM 9998-DB2-ABEND                       08880000
086900             END-EVALUATE                                         08890000
087000     END-PERFORM.                                                 08900000
087100                                                                  08910000
087200     IF SUB2 > DB2-RETRY-MAX                                      08920000
087300         MOVE 'MAX RETRIES EXCEEDED ON FETCH FOR DISCOUNT-CSR'    08930000
087400                             TO AA-DB2-OPERATION                  08940000
087500         MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                    08950000
087600         MOVE SPACES         TO AA-DB2-TABLE-2                    08960000
087700                                AA-DB2-TABLE-3                    08970000
087800                                AA-DB2-TABLE-4                    08980000
087900                                AA-DB2-TABLE-5                    08990000
088000         PERFORM 9998-DB2-ABEND                                   09000000
088100     END-IF.                                                      09010000
088200                                                                  09020000
088300 EJECT                                                            09030000
088400***************************************************************** 09040000
088500*  CLOSE THE ALLOWANCE DISCOUNT CURSOR                            09050000
088600*                                                                 09060000
088700*  CALLED FROM 2200-PROCESS-INVOICE                               09070000
088800***************************************************************** 09080000
088900 2250-CLOSE-DISCOUNT-CSR.                                         09090000
089000                                                                  09100000
089100     MOVE '2250-CLOSE-DISCOUNT-CSR' TO PW-CURRENT-PARAGRAPH.      09110000
089200                                                                  09120000
089300     PERFORM WITH TEST AFTER                                      09130000
089400         VARYING SUB2 FROM 1 BY 1                                 09140000
089500             UNTIL SUB2 > DB2-RETRY-MAX OR                        09150000
089600                   SQLCODE = ZERO                                 09160000
089700                                                                  09170000
089800         EXEC SQL                                                 09180000
089900              CLOSE DISCOUNT-CSR                                  09190000
090000         END-EXEC                                                 09200000
090100                                                                  09210000
090200         EVALUATE TRUE                                            09220000
090300             WHEN SQLCODE = ZERO                                  09230000
090400                  CONTINUE                                        09240000
090500                                                                  09250000
090600             WHEN SQLCODE = -904                                  09260000
090700             WHEN SQLCODE = -913                                  09270000
090800                  CONTINUE                                        09280000
090900                                                                  09290000
091000             WHEN SQLWARN0 NOT = SPACES                           09300000
091100             WHEN SQLCODE  NOT = ZERO                             09310000
091200                 MOVE 'UNSUCCESSFUL DISCOUNT CURSOR CLOSE'        09320000
091300                                 TO   AA-DB2-OPERATION            09330000
091400                 MOVE 'TALCHRG'  TO   AA-DB2-TABLE-1              09340000
091500                 MOVE SPACE      TO   AA-DB2-TABLE-2              09350000
091600                                      AA-DB2-TABLE-3              09360000
091700                                      AA-DB2-TABLE-4              09370000
091800                                      AA-DB2-TABLE-5              09380000
091900                 PERFORM 9998-DB2-ABEND                           09390000
092000         END-EVALUATE                                             09400000
092100     END-PERFORM.                                                 09410000
092200                                                                  09420000
092300     IF SUB2 > DB2-RETRY-MAX                                      09430000
092400         MOVE 'MAX RETRIES EXCEEDED ON DISCOUNT CURSOR CLOSE'     09440000
092500                                 TO   AA-DB2-OPERATION            09450000
092600         MOVE 'TALCHRG'          TO   AA-DB2-TABLE-1              09460000
092700         MOVE SPACE              TO   AA-DB2-TABLE-2              09470000
092800                                      AA-DB2-TABLE-3              09480000
092900                                      AA-DB2-TABLE-4              09490000
093000                                      AA-DB2-TABLE-5              09500000
093100         PERFORM 9998-DB2-ABEND                                   09510000
093200     END-IF.                                                      09520000
093300                                                                  09530000
093400                                                                  09540000
093500 EJECT                                                            09550000
093600***************************************************************** 09560000
093700*  PROCESSES THE PO ITEM CURSOR AND CREATES ALL PO LINE REPORT    09570000
093800*  RECORDS                                                        09580000
093900*                                                                 09590000
094000*  CALLED FROM 2000-PROCESS-INPUT                                 09600000
094100***************************************************************** 09610000
094200 2300-PROCESS-PO-LINES.                                           09620000
094300                                                                  09630000
094400     MOVE '2300-PROCESS-PO-LINES' TO  PW-CURRENT-PARAGRAPH.       09640000
094500                                                                  09650000
094600*  PRINT PO LINE HEADERS UNLESS A NEW PAGE WILL BEGIN             09660000
094700     IF (PR-LINE-COUNT + 6) <= PR-MAX-LINES                       09670000
094800*      PO LINE HEADING LINE 1 (COLUMN NAMES)                      09680000
094900         MOVE 3                  TO   PR-CC                       09690000
095000         MOVE POLNE-HDR-LINE1    TO   PR-LINE                     09700000
095100         PERFORM 9000-WRITE-REPORT                                09710000
095200*      PO LINE HEADING LINE 2 (COLUMN NAMES)                      09720000
095300         MOVE 1                  TO   PR-CC                       09730000
095400         MOVE POLNE-HDR-LINE2    TO   PR-LINE                     09740000
095500         PERFORM 9000-WRITE-REPORT                                09750000
095600*      PO LINE HEADING LINE 3 (COLUMN UNDERLINES)                 09760000
095700         MOVE 1                  TO   PR-CC                       09770000
095800         MOVE POLNE-HDR-LINE3    TO   PR-LINE                     09780000
095900         PERFORM 9000-WRITE-REPORT                                09790000
096000     END-IF.                                                      09800000
096100                                                                  09810000
096200*  PROCESS THE PO ITEM CURSOR                                     09820000
096300     PERFORM 2310-OPEN-PO-ITEM-CSR.                               09830000
096400                                                                  09840000
096500     PERFORM 2320-PROCESS-PO-ITEMS                                09850000
096600         UNTIL EOF-PO-ITEM-CSR.                                   09860000
096700                                                                  09870000
096800     PERFORM 2330-CLOSE-PO-ITEM-CSR.                              09880000
096900                                                                  09890000
097000 EJECT                                                            09900000
097100***************************************************************** 09910000
097200*  OPENS THE PO ITEM LINE CURSOR                                  09920000
097300*                                                                 09930000
097400*  CALLED FROM 2300-PROCESS-PO-LINES                              09940000
097500***************************************************************** 09950000
097600 2310-OPEN-PO-ITEM-CSR.                                           09960000
097700                                                                  09970000
097800     MOVE '2310-OPEN-PO-ITEM-CSR' TO  PW-CURRENT-PARAGRAPH.       09980000
097900                                                                  09990000
098000     PERFORM WITH TEST AFTER                                      10000000
098100         VARYING SUB2 FROM 1 BY 1                                 10010000
098200             UNTIL SUB2 > DB2-RETRY-MAX OR                        10020000
098300                   SQLCODE = ZERO                                 10030000
098400                                                                  10040000
098500         EXEC SQL                                                 10050000
098600              OPEN ITEM-CSR                                       10060000
098700         END-EXEC                                                 10070000
098800                                                                  10080000
098900         EVALUATE TRUE                                            10090000
099000             WHEN SQLCODE = ZERO                                  10100000
099100                  CONTINUE                                        10110000
099200                                                                  10120000
099300             WHEN SQLCODE = -904                                  10130000
099400             WHEN SQLCODE = -913                                  10140000
099500                  CONTINUE                                        10150000
099600                                                                  10160000
099700             WHEN SQLWARN0 NOT = SPACES                           10170000
099800             WHEN SQLCODE  NOT = ZERO                             10180000
099900                 MOVE 'UNSUCCESSFUL PO ITEM CURSOR OPEN'          10190000
100000                                 TO   AA-DB2-OPERATION            10200000
100100                 MOVE 'TPURITM'  TO   AA-DB2-TABLE-1              10210000
100200                 MOVE SPACE      TO   AA-DB2-TABLE-2              10220000
100300                                      AA-DB2-TABLE-3              10230000
100400                                      AA-DB2-TABLE-4              10240000
100500                                      AA-DB2-TABLE-5              10250000
100600                 PERFORM 9998-DB2-ABEND                           10260000
100700         END-EVALUATE                                             10270000
100800     END-PERFORM.                                                 10280000
100900                                                                  10290000
101000     IF SUB2 > DB2-RETRY-MAX                                      10300000
101100         MOVE 'MAX RETRIES EXCEEDED ON PO ITEM CURSOR OPEN'       10310000
101200                                 TO   AA-DB2-OPERATION            10320000
101300         MOVE 'TPURITM'          TO   AA-DB2-TABLE-1              10330000
101400         MOVE SPACE              TO   AA-DB2-TABLE-2              10340000
101500                                      AA-DB2-TABLE-3              10350000
101600                                      AA-DB2-TABLE-4              10360000
101700                                      AA-DB2-TABLE-5              10370000
101800         PERFORM 9998-DB2-ABEND                                   10380000
101900     END-IF.                                                      10390000
102000                                                                  10400000
102100 EJECT                                                            10410000
102200***************************************************************** 10420000
102300*  FETCHES THE PO ITEM LINE CURSOR                                10430000
102400*                                                                 10440000
102500*  CALLED FROM 2300-PROCESS-PO-LINES                              10450000
102600***************************************************************** 10460000
102700 2320-PROCESS-PO-ITEMS.                                           10470000
102800                                                                  10480000
102900     MOVE '2320-PROCESS-PO-ITEMS'  TO PW-CURRENT-PARAGRAPH.       10490000
103000                                                                  10500000
103100*  WRITE REPORT & CLEAR DETAIL                                    10510000
103200                                                                  10520000
103300     PERFORM 2325-FETCH-PO-ITEM-CSR.                              10530000
103400                                                                  10540000
103500     IF NOT EOF-PO-ITEM-CSR                                       10550000
103600         MOVE ZERO TO PW-RCVD-UNIT-COST                           10560000
103700         MOVE ZERO TO T-RCVD-QUANTITY                             10570000
103800         PERFORM 2400-PROCESS-PO-LINE-REC                         10580000
103900             UNTIL END-OF-PO-LINE-RECS                            10590000
104000                OR EOF                                            10600000
104100                OR PURITM-APP-PO-LNE-NBR < AP271-APP-PO-LINE-NBR  10610000
104200                OR NOT PO-LINE-REC                                10620000
104300                OR PW-PO-NBR NOT = AP271-PURCHASE-ORDER           10630000
104400                OR PW-VENDOR-NAME NOT = AP271-VENDOR-NAME         10640000
104500         PERFORM 2500-FORMAT-PO-LINE-REC                          10650000
104600     END-IF.                                                      10660000
104700                                                                  10670000
104800 EJECT                                                            10680000
104900***************************************************************** 10690000
105000*  FETCHES THE PO ITEM LINE CURSOR                                10700000
105100*                                                                 10710000
105200*  CALLED FROM 2320-PROCESS-PO-ITEMS                              10720000
105300***************************************************************** 10730000
105400 2325-FETCH-PO-ITEM-CSR.                                          10740000
105500                                                                  10750000
105600     MOVE '2325-FETCH-PO-ITEM-CSR' TO PW-CURRENT-PARAGRAPH.       10760000
105700                                                                  10770000
105800     PERFORM WITH TEST AFTER                                      10780000
105900         VARYING SUB2 FROM 1 BY 1                                 10790000
106000             UNTIL SUB2 > DB2-RETRY-MAX OR                        10800000
106100                   SQLCODE = ZERO OR                              10810000
106200                   SQLCODE = +100                                 10820000
106300                                                                  10830000
106400         EXEC SQL                                                 10840000
106500              FETCH ITEM-CSR                                      10850000
106600                INTO :PURITM-APP-PO-LNE-NBR                       10860000
106700                    ,:PURITM-RMS-PO-SKU-NBR                       10870000
106800                    ,:PURITM-ITM-NBR                              10880000
106900                    ,:PURITM-VEND-STYL-NAME                       10890000
107000                    ,:PURITM-SKU-DESC                             10900000
107100                    ,:PURITM-COLOR-DESC                           10910000
107200                    ,:PURITM-SIZE-DESC                            10920000
107300                    ,:SKXREF-SKU                                  10930000
107400         END-EXEC                                                 10940000
107500                                                                  10950000
107600         EVALUATE TRUE                                            10960000
107700             WHEN SQLCODE = ZERO                                  10970000
107800                  IF PURITM-RMS-PO-SKU-NBR NOT = 0                10980000
107900                     MOVE PURITM-RMS-PO-SKU-NBR TO PW-SKU-NBR     10990000
108000                  ELSE                                            11000000
108100                     MOVE SKXREF-SKU            TO PW-SKU-NBR     11010000
108200                  END-IF                                          11020000
108300                                                                  11030000
108400             WHEN SQLCODE = +100                                  11040000
108500                  SET EOF-PO-ITEM-CSR TO TRUE                     11050000
108600                                                                  11060000
108700             WHEN SQLCODE = -904                                  11070000
108800             WHEN SQLCODE = -913                                  11080000
108900                  CONTINUE                                        11090000
109000                                                                  11100000
109100             WHEN SQLWARN0 NOT = SPACES                           11110000
109200             WHEN SQLCODE  NOT = ZERO                             11120000
109300                 MOVE 'UNSUCCESSFUL PO ITEM CURSOR FETCH'         11130000
109400                                 TO   AA-DB2-OPERATION            11140000
109500                 MOVE 'TPURITM'  TO   AA-DB2-TABLE-1              11150000
109600                 MOVE 'TSKXREF'  TO   AA-DB2-TABLE-2              11160000
109700                 MOVE SPACE      TO   AA-DB2-TABLE-3              11170000
109800                                      AA-DB2-TABLE-4              11180000
109900                                      AA-DB2-TABLE-5              11190000
110000                 PERFORM 9998-DB2-ABEND                           11200000
110100         END-EVALUATE                                             11210000
110200     END-PERFORM.                                                 11220000
110300                                                                  11230000
110400     IF SUB2 > DB2-RETRY-MAX                                      11240000
110500         MOVE 'MAX RETRIES EXCEEDED ON PO ITEM CURSOR FETCH'      11250000
110600                                 TO   AA-DB2-OPERATION            11260000
110700         MOVE 'TPURITM'          TO   AA-DB2-TABLE-1              11270000
110800         MOVE 'TSKXREF'          TO   AA-DB2-TABLE-2              11280000
110900         MOVE SPACE              TO   AA-DB2-TABLE-3              11290000
111000                                      AA-DB2-TABLE-4              11300000
111100                                      AA-DB2-TABLE-5              11310000
111200         PERFORM 9998-DB2-ABEND                                   11320000
111300     END-IF.                                                      11330000
111400                                                                  11340000
111500 EJECT                                                            11350000
111600***************************************************************** 11360000
111700*  CLOSES THE PO ITEM LINE CURSOR                                 11370000
111800*                                                                 11380000
111900*  CALLED FROM 2300-PROCESS-PO-LINES                              11390000
112000***************************************************************** 11400000
112100 2330-CLOSE-PO-ITEM-CSR.                                          11410000
112200                                                                  11420000
112300     MOVE '2330-CLOSE-PO-ITEM-CSR' TO PW-CURRENT-PARAGRAPH.       11430000
112400                                                                  11440000
112500     PERFORM WITH TEST AFTER                                      11450000
112600         VARYING SUB2 FROM 1 BY 1                                 11460000
112700             UNTIL SUB2 > DB2-RETRY-MAX OR                        11470000
112800                   SQLCODE = ZERO                                 11480000
112900                                                                  11490000
113000         EXEC SQL                                                 11500000
113100              CLOSE ITEM-CSR                                      11510000
113200         END-EXEC                                                 11520000
113300                                                                  11530000
113400         EVALUATE TRUE                                            11540000
113500             WHEN SQLCODE = ZERO                                  11550000
113600                  CONTINUE                                        11560000
113700                                                                  11570000
113800             WHEN SQLCODE = -904                                  11580000
113900             WHEN SQLCODE = -913                                  11590000
114000                  CONTINUE                                        11600000
114100                                                                  11610000
114200             WHEN SQLWARN0 NOT = SPACES                           11620000
114300             WHEN SQLCODE  NOT = ZERO                             11630000
114400                 MOVE 'UNSUCCESSFUL PO ITEM CURSOR CLOSE'         11640000
114500                                 TO   AA-DB2-OPERATION            11650000
114600                 MOVE 'TPURITM'  TO   AA-DB2-TABLE-1              11660000
114700                 MOVE SPACE      TO   AA-DB2-TABLE-2              11670000
114800                                      AA-DB2-TABLE-3              11680000
114900                                      AA-DB2-TABLE-4              11690000
115000                                      AA-DB2-TABLE-5              11700000
115100                 PERFORM 9998-DB2-ABEND                           11710000
115200         END-EVALUATE                                             11720000
115300     END-PERFORM.                                                 11730000
115400                                                                  11740000
115500     IF SUB2 > DB2-RETRY-MAX                                      11750000
115600         MOVE 'MAX RETRIES EXCEEDED ON PO ITEM CURSOR CLOSE'      11760000
115700                                 TO   AA-DB2-OPERATION            11770000
115800         MOVE 'TPURITM'          TO   AA-DB2-TABLE-1              11780000
115900         MOVE SPACE              TO   AA-DB2-TABLE-2              11790000
116000                                      AA-DB2-TABLE-3              11800000
116100                                      AA-DB2-TABLE-4              11810000
116200                                      AA-DB2-TABLE-5              11820000
116300         PERFORM 9998-DB2-ABEND                                   11830000
116400     END-IF.                                                      11840000
116500                                                                  11850000
116600 EJECT                                                            11860000
116700***************************************************************** 11870000
116800*  READS ALL PO LINE RECORDS FOR AN APP PO LINE NUMBER            11880000
116900*                                                                 11890000
117000*  CALLED FROM 2320-PROCESS-PO-ITEMS                              11900000
117100***************************************************************** 11910000
117200 2400-PROCESS-PO-LINE-REC.                                        11920000
117300                                                                  11930000
117400     MOVE '2400-PROCESS-PO-LINE-REC' TO PW-CURRENT-PARAGRAPH.     11940000
117500                                                                  11950000
117600     IF PURITM-APP-PO-LNE-NBR = AP271-APP-PO-LINE-NBR             11960000
117700         MOVE AP271-RCVD-UNIT-COST TO PW-RCVD-UNIT-COST           11970000
117800         ADD AP271-RCVD-UNIT-QTY TO T-RCVD-QUANTITY               11980000
117900     END-IF.                                                      11990000
118000                                                                  12000000
118100*      READ NEXT INPUT RECORD                                     12010000
118200     PERFORM 8000-READ-INVOIC-REQ-DTL-FILE.                       12020000
118300                                                                  12030000
118400 EJECT                                                            12040000
118500***************************************************************** 12050000
118600*  FORMATS AND WRITES A PO ITEM LINE REPORT RECORD                12060000
118700*                                                                 12070000
118800*  CALLED FROM 2320-PROCESS-PO-ITEMS                              12080000
118900***************************************************************** 12090000
119000 2500-FORMAT-PO-LINE-REC.                                         12100000
119100                                                                  12110000
119200     MOVE '2500-FORMAT-PO-LINE-REC' TO PW-CURRENT-PARAGRAPH.      12120000
119300                                                                  12130000
119400     PERFORM 2550-GET-UPC-INFO.                                   12140000
119500                                                                  12150000
119600*  FORMAT PRINT LINE                                              12160000
119700                                                                  12170000
119800     MOVE PURITM-APP-PO-LNE-NBR  TO   PDL-APP-PO-LINE-NBR.        12180000
119900     MOVE PW-SKU-NBR             TO   PDL-SKU.                    12190000
120000     MOVE PV-UPC-NBR-DISPLAY     TO   PDL-UPC-NUMBER.             12200000
120100     MOVE PURITM-VEND-STYL-NAME  TO   PDL-VENDOR-STYLE.           12210000
120200     MOVE PURITM-SKU-DESC        TO   PDL-SKU-DESC.               12220000
120300     MOVE PURITM-COLOR-DESC      TO   PDL-COLOR-DESC.             12230000
120400     MOVE PURITM-SIZE-DESC       TO   PDL-SIZE-DESC.              12240000
120500     MOVE T-RCVD-QUANTITY        TO   PDL-RCVD-UNIT-QTY.          12250000
120600                                                                  12260000
120700     IF T-RCVD-QUANTITY > ZERO                                    12270000
120800         MOVE PW-RCVD-UNIT-COST  TO   PDL-RCVD-UNIT-COST          12280000
120900     ELSE                                                         12290000
121000         MOVE ZERO               TO   PDL-RCVD-UNIT-COST          12300000
121100     END-IF.                                                      12310000
121200                                                                  12320000
121300*  WRITE REPORT & CLEAR DETAIL                                    12330000
121400                                                                  12340000
121500     PERFORM 9100-WRITE-DETAIL.                                   12350000
121600                                                                  12360000
121700     MOVE SPACE                  TO   DETAIL-LINE.                12370000
121800     MOVE 2                      TO   PR-DETAIL-CC.               12380000
121900                                                                  12390000
122000 EJECT                                                            12400000
122100***************************************************************** 12410000
122200* SELECT A ROW FROM THE DB2 TUPCSKU TABLE.                        12420000
122300*                                                                 12430000
122400*  CALLED FROM 2500-FORMAT-PO-LINE-REC                            12440000
122500***************************************************************** 12450000
122600                                                                  12460000
122700 2550-GET-UPC-INFO.                                               12470000
122800                                                                  12480000
122900     MOVE '2550-GET-UPC-INFO' TO PW-CURRENT-PARAGRAPH.            12490000
123000                                                                  12500000
123100     PERFORM WITH TEST AFTER                                      12510000
123200         VARYING SUB2 FROM 1 BY 1                                 12520000
123300             UNTIL SUB2 > DB2-RETRY-MAX OR                        12530000
123400                   SQLCODE = ZERO OR                              12540000
123500                   SQLCODE = +100 OR                              12550000
123600                   SQLCODE = -811                                 12560000
123700                                                                  12570000
123800         EXEC SQL                                                 12580000
123900             SELECT DISTINCT                                      12590000
124000                  A.UPC_NBR                                       12600000
124100              INTO :TUPCSKU-UPC-NBR                               12610000
124200              FROM TUPCSKU A                                      12620000
124300             WHERE                                                12630000
124400                   A.ITEM_NBR = :PURITM-ITM-NBR                   12640000
124500               AND (A.UPC_NBR NOT BETWEEN                         12650000
124600                   :PC-MIN-UPC AND :PC-MAX-UPC)                   12660000
124700         END-EXEC                                                 12670000
124800                                                                  12680000
124900         EVALUATE TRUE                                            12690000
125000             WHEN SQLCODE = +0                                    12700000
125100               MOVE TUPCSKU-UPC-NBR  TO PV-UPC-NBR                12710000
125200               STRING PV-UPC-NBR-X(3:2)  DELIMITED BY SIZE        12720000
125300                      '-'                DELIMITED BY SIZE        12730000
125400                      PV-UPC-NBR-X(5:5)  DELIMITED BY SIZE        12740000
125500                      '-'                DELIMITED BY SIZE        12750000
125600                      PV-UPC-NBR-X(10:5) DELIMITED BY SIZE        12760000
125700                      '-'                DELIMITED BY SIZE        12770000
125800                      PV-UPC-NBR-X(15:1) DELIMITED BY SIZE        12780000
125900                                   INTO PV-UPC-NBR-DISPLAY        12790000
126000                                                                  12800000
126100             WHEN SQLCODE = +100                                  12810000
126200               MOVE PC-NO-VENDOR-UPC TO PV-UPC-NBR-DISPLAY        12820000
126300                                                                  12830000
126400             WHEN SQLCODE = -811                                  12840000
126500               MOVE PC-MULTIPLE-UPC  TO PV-UPC-NBR-DISPLAY        12850000
126600                                                                  12860000
126700             WHEN SQLCODE = -904                                  12870000
126800             WHEN SQLCODE = -913                                  12880000
126900                  CONTINUE                                        12890000
127000                                                                  12900000
127100             WHEN SQLWARN0 NOT = SPACES                           12910000
127200             WHEN SQLCODE  NOT = ZERO                             12920000
127300                 MOVE 'UNSUCCESSFUL SELECT'                       12930000
127400                                 TO   AA-DB2-OPERATION            12940000
127500                 MOVE 'TUPCSKU'  TO   AA-DB2-TABLE-1              12950000
127600                 MOVE SPACE      TO   AA-DB2-TABLE-2              12960000
127700                                      AA-DB2-TABLE-3              12970000
127800                                      AA-DB2-TABLE-4              12980000
127900                                      AA-DB2-TABLE-5              12990000
128000                 PERFORM 9998-DB2-ABEND                           13000000
128100         END-EVALUATE                                             13010000
128200     END-PERFORM.                                                 13020000
128300                                                                  13030000
128400     IF SUB2 > DB2-RETRY-MAX                                      13040000
128500         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    13050000
128600                                 TO   AA-DB2-OPERATION            13060000
128700         MOVE 'TUPCSKU'          TO   AA-DB2-TABLE-1              13070000
128800         MOVE '       '          TO   AA-DB2-TABLE-2              13080000
128900         MOVE SPACE              TO   AA-DB2-TABLE-3              13090000
129000                                      AA-DB2-TABLE-4              13100000
129100                                      AA-DB2-TABLE-5              13110000
129200         PERFORM 9998-DB2-ABEND                                   13120000
129300     END-IF.                                                      13130000
129400***************************************************************** 13140000
129500*                                                                 13150000
129600*  CALLED FROM 0000-MAIN                                          13160000
129700***************************************************************** 13170000
129800 3000-END-PROGRAM.                                                13180000
129900                                                                  13190000
130000     MOVE '3000-END-PROGRAM'     TO   PW-CURRENT-PARAGRAPH.       13200000
130100                                                                  13210000
130200     IF INVOICE-REPORTING                                         13220000
130300         SET PO-LINE-REPORTING TO TRUE                            13230000
130400         PERFORM 2300-PROCESS-PO-LINES                            13240000
130500     END-IF.                                                      13250000
130600                                                                  13260000
130700     PERFORM 9300-WRITE-TOTALS.                                   13270000
130800                                                                  13280000
130900     CLOSE       INVOIC-REQ-DTL-FILE                              13290000
131000                 RPT01-FILE.                                      13300000
131100                                                                  13310000
131200 EJECT                                                            13320000
131300***************************************************************** 13330000
131400*  THIS ROUTINE READS THE REPORT FILE FROM APKUP250               13340000
131500*                                                                 13350000
131600*  CALLED FROM 1000-BEGIN-PROGRAM                                 13360000
131700*  CALLED FROM 2200-PROCESS-INPUT                                 13370000
131800***************************************************************** 13380000
131900 8000-READ-INVOIC-REQ-DTL-FILE.                                   13390000
132000                                                                  13400000
132100     MOVE '8000-READ-INVOIC-REQ-DTL-FILE'                         13410000
132200                                 TO   PW-CURRENT-PARAGRAPH.       13420000
132300                                                                  13430000
132400     READ INVOIC-REQ-DTL-FILE    INTO AP271-RECORD                13440000
132500         AT END                                                   13450000
132600             SET EOF TO TRUE.                                     13460000
132700                                                                  13470000
132800 EJECT                                                            13480000
132900***************************************************************** 13490000
133000*  THIS IS THE ACTUAL WRITE TO THE REPORT FILE.  IT USES PR-CC    13500000
133100*  TO DETERMINE THE HORIZONTAL SPACING.                           13510000
133200*                                                                 13520000
133300*  CALLED FROM 9100-WRITE-DETAIL                                  13530000
133400*  CALLED FROM 9200-WRITE-HEADING                                 13540000
133500***************************************************************** 13550000
133600 9000-WRITE-REPORT.                                               13560000
133700                                                                  13570000
133800     MOVE '9000-WRITE-REPORT'    TO   PW-CURRENT-PARAGRAPH.       13580000
133900                                                                  13590000
134000     IF PR-CC = 0                                                 13600000
134100         MOVE 1                  TO   PR-CC                       13610000
134200         WRITE RPT01-RECORD FROM PR-LINE                          13620000
134300             AFTER ADVANCING PAGE                                 13630000
134400     ELSE                                                         13640000
134500         WRITE RPT01-RECORD FROM PR-LINE                          13650000
134600             AFTER ADVANCING PR-CC                                13660000
134700     END-IF.                                                      13670000
134800                                                                  13680000
134900*  BUMP LINE COUNT                                                13690000
135000                                                                  13700000
135100     ADD PR-CC                   TO   PR-LINE-COUNT.              13710000
135200                                                                  13720000
135300 EJECT                                                            13730000
135400***************************************************************** 13740000
135500*  REPORT DETAIL FOR EACH OF THE REPORTS.  THIS ROUTINE CHECKS    13750000
135600*  FOR PAGE OVERFLOW AND PERFORMS A HEADING ROUTINE IF NECESSARY  13760000
135700*                                                                 13770000
135800***************************************************************** 13780000
135900 9100-WRITE-DETAIL.                                               13790000
136000                                                                  13800000
136100     MOVE '9100-WRITE-DETAIL'    TO   PW-CURRENT-PARAGRAPH.       13810000
136200                                                                  13820000
136300*  CHECK FOR PAGE OVERFLOW.                                       13830000
136400*                                                                 13840000
136500*  WE WANT TO DISPLAY VENDOR & PO ONCE PER PAGE, AT A PO BREAK OR 13850000
136600*  AT A PAGE BREAK                                                13860000
136700                                                                  13870000
136800     IF (PR-DETAIL-CC + PR-LINE-COUNT) > PR-MAX-LINES             13880000
136900         PERFORM 9200-WRITE-HEADING                               13890000
137000         MOVE 1                  TO   PR-DETAIL-CC                13900000
137100     END-IF.                                                      13910000
137200                                                                  13920000
137300*  MOVE TO PRINT AREA & WRITE REPORT LINE                         13930000
137400                                                                  13940000
137500     MOVE PR-DETAIL-CC           TO   PR-CC.                      13950000
137600     MOVE DETAIL-LINE            TO   PR-LINE.                    13960000
137700     PERFORM 9000-WRITE-REPORT.                                   13970000
137800                                                                  13980000
137900 EJECT                                                            13990000
138000***************************************************************** 14000000
138100*  REPORT AND COLUMN HEADINGS FOR EACH OF THE FOUR REPORTS        14010000
138200*                                                                 14020000
138300*  CALLED FROM 9100-WRITE-DETAIL                                  14030000
138400***************************************************************** 14040000
138500 9200-WRITE-HEADING.                                              14050000
138600                                                                  14060000
138700     MOVE '9200-WRITE-HEADING'   TO   PW-CURRENT-PARAGRAPH.       14070000
138800                                                                  14080000
138900*  BUMP PAGE COUNT                                                14090000
139000                                                                  14100000
139100     ADD 1                       TO   PR-PAGE-COUNT.              14110000
139200     MOVE PR-PAGE-COUNT          TO   DP133O-PAGE-NUMBER.         14120000
139300                                                                  14130000
139400*  CLEAR LINE COUNT                                               14140000
139500                                                                  14150000
139600     MOVE 0                      TO   PR-LINE-COUNT.              14160000
139700                                                                  14170000
139800*  HEADING LINE 1 (STANDARD)                                      14180000
139900                                                                  14190000
140000     MOVE 0                      TO   PR-CC.                      14200000
140100     MOVE DP133O-STANDRD-HEADER-133-COLS                          14210000
140200                                 TO   PR-LINE.                    14220000
140300     PERFORM 9000-WRITE-REPORT.                                   14230000
140400                                                                  14240000
140500*  HEADING LINE 2 (REPORT TITLE)                                  14250000
140600                                                                  14260000
140700     MOVE 1                      TO   PR-CC.                      14270000
140800     MOVE HDR-LINE2              TO   PR-LINE.                    14280000
140900     PERFORM 9000-WRITE-REPORT.                                   14290000
141000                                                                  14300000
141100*  HEADING LINE 3 (REPORT TITLE)                                  14310000
141200                                                                  14320000
141300     MOVE 2                      TO   PR-CC.                      14330000
141400     MOVE HDR-LINE3              TO   PR-LINE.                    14340000
141500     PERFORM 9000-WRITE-REPORT.                                   14350000
141600                                                                  14360000
141700     IF INVOICE-REPORTING                                         14370000
141800*      INVOICE HEADING LINE 1 (COLUMN NAMES)                      14380000
141900         MOVE 2                  TO   PR-CC                       14390000
142000         MOVE INV-HDR-LINE1      TO   PR-LINE                     14400000
142100         PERFORM 9000-WRITE-REPORT                                14410000
142200*      INVOICE HEADING LINE 2 (COLUMN UNDERLINES)                 14420000
142300         MOVE 1                  TO   PR-CC                       14430000
142400         MOVE INV-HDR-LINE2      TO   PR-LINE                     14440000
142500         PERFORM 9000-WRITE-REPORT                                14450000
142600     ELSE                                                         14460000
142700*      PO LINE HEADING LINE 1 (COLUMN NAMES)                      14470000
142800         MOVE 2                  TO   PR-CC                       14480000
142900         MOVE POLNE-HDR-LINE1    TO   PR-LINE                     14490000
143000         PERFORM 9000-WRITE-REPORT                                14500000
143100*      PO LINE HEADING LINE 2 (COLUMN NAMES)                      14510000
143200         MOVE 1                  TO   PR-CC                       14520000
143300         MOVE POLNE-HDR-LINE2    TO   PR-LINE                     14530000
143400         PERFORM 9000-WRITE-REPORT                                14540000
143500*      PO LINE HEADING LINE 3 (COLUMN UNDERLINES)                 14550000
143600         MOVE 1                  TO   PR-CC                       14560000
143700         MOVE POLNE-HDR-LINE3    TO   PR-LINE                     14570000
143800         PERFORM 9000-WRITE-REPORT                                14580000
143900     END-IF.                                                      14590000
144000                                                                  14600000
144100 EJECT                                                            14610000
144200***************************************************************** 14620000
144300*  LAST PAGE TOTALS FOR THE REPORT                                14630000
144400*                                                                 14640000
144500*  CALLED FROM 3000-END-PROGRAM                                   14650000
144600***************************************************************** 14660000
144700 9300-WRITE-TOTALS.                                               14670000
144800                                                                  14680000
144900     MOVE '9300-WRITE-TOTALS'    TO   PW-CURRENT-PARAGRAPH.       14690000
145000                                                                  14700000
145100*  DO HEADING IF NOT DONE YET                                     14710000
145200                                                                  14720000
145300     IF T-REPORT-COUNT = 0                                        14730000
145400         PERFORM 9200-WRITE-HEADING                               14740000
145500     END-IF.                                                      14750000
145600                                                                  14760000
145700*  CLEAR DETAIL LINE                                              14770000
145800                                                                  14780000
145900     MOVE SPACE                  TO   DETAIL-LINE.                14790000
146000                                                                  14800000
146100*  DETAIL TOTAL                                                   14810000
146200                                                                  14820000
146300     MOVE 'TOTAL INVOICES WITH DETAIL'                            14830000
146400                                 TO   DL2-TYPE.                   14840000
146500     MOVE T-DETAIL-COUNT         TO   DL2-COUNT.                  14850000
146600     MOVE T-DETAIL-AMOUNT        TO   DL2-AMOUNT.                 14860000
146700                                                                  14870000
146800     MOVE 2                      TO   PR-CC.                      14880000
146900     MOVE DETAIL-LINE            TO   PR-LINE.                    14890000
147000     PERFORM 9000-WRITE-REPORT.                                   14900000
147100                                                                  14910000
147200     MOVE SPACE                  TO   DETAIL-LINE.                14920000
147300                                                                  14930000
147400*  REPORT TOTAL                                                   14940000
147500                                                                  14950000
147600     MOVE 'TOTAL INVOICES'       TO   DL2-TYPE.                   14960000
147700     MOVE T-REPORT-COUNT         TO   DL2-COUNT.                  14970000
147800     MOVE T-REPORT-AMOUNT        TO   DL2-AMOUNT.                 14980000
147900                                                                  14990000
148000     MOVE 1                      TO   PR-CC.                      15000000
148100     MOVE DETAIL-LINE            TO   PR-LINE.                    15010000
148200     PERFORM 9000-WRITE-REPORT.                                   15020000
148300                                                                  15030000
148400     MOVE SPACE                  TO   DETAIL-LINE.                15040000
148500                                                                  15050000
148600*  END OF REPORT LITERAL                                          15060000
148700                                                                  15070000
148800     MOVE 2                      TO   PR-CC.                      15080000
148900     MOVE EOR-END-OF-REPORT      TO   PR-LINE.                    15090000
149000     PERFORM 9000-WRITE-REPORT.                                   15100000
149100                                                                  15110000
149200 EJECT                                                            15120000
149300***************************************************************** 15130000
149400*  DB2 ABEND ROUTINE                                              15140000
149500*                                                                 15150000
149600*  CALLED FROM 2221-FIND-DETAIL                                   15160000
149700***************************************************************** 15170000
149800 9998-DB2-ABEND.                                                  15180000
149900                                                                  15190000
150000     DISPLAY AA-ABEND-LIT.                                        15200000
150100     DISPLAY AA-DB2-ERROR-LIT.                                    15210000
150200     DISPLAY AA-PROGRAM-LIT     PW-PROGRAM-NAME.                  15220000
150300     DISPLAY AA-PARAGRAPH-LIT   PW-CURRENT-PARAGRAPH.             15230000
150400     DISPLAY AA-DB2-OPERATION-LIT.                                15240000
150500     DISPLAY AA-DB2-TABLE-1.                                      15250000
150600     DISPLAY AA-DB2-TABLE-2.                                      15260000
150700     DISPLAY AA-DB2-TABLE-3.                                      15270000
150800     DISPLAY AA-DB2-TABLE-4.                                      15280000
150900                                                                  15290000
151000     COPY DPPD004.                                                15300000
151100                                                                  15310000
151200     MOVE +4013                  TO   ABEND-CODE.                 15320000
151300                                                                  15330000
151400     CALL 'ILBOABN0' USING ABEND-CODE.                            15340000
151500                                                                  15350000
151600 EJECT                                                            15360000
151700***************************************************************** 15370000
151800*  ABEND ROUTINE                                                  15380000
151900***************************************************************** 15390000
152000 9999-ABEND.                                                      15400000
152100                                                                  15410000
152200     DISPLAY '*** PROGRAM   = ' PW-PROGRAM-NAME.                  15420000
152300     DISPLAY '*** PARAGRAPH = ' PW-CURRENT-PARAGRAPH.             15430000
152400     DISPLAY '*** OPERATION = ' AA-ABEND-OPERATION.               15440000
152500                                                                  15450000
152600     CALL 'ILBOABN0'            USING ABEND-CODE.                 15460000
152700                                                                  15470000
