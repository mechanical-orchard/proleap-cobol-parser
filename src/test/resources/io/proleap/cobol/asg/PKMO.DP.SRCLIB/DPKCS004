00001 ******************************************************************09/25/91
00002  IDENTIFICATION DIVISION.                                         DPKCS004
00003 ******************************************************************   LV002
00004                                                                      CL**1
00005  PROGRAM-ID.                DPKCS004.                                CL**1
00006  AUTHOR.                    J. KNOKE  (TCC)                          CL**1
00007  INSTALLATION.              KOHLS DEPARTMENT STORES.                 CL**1
00008  DATE-WRITTEN.              02-06-90.                                CL**1
00009  DATE-COMPILED.                                                      CL**1
00010                                                                      CL**1
00011 ******************************************************************   CL**1
00012 *  CICS PROGRAM - DPKCS004 - Z004                                *   CL**1
00013 *                                                                *   CL**1
00014 *   DB2 CHECKPOINT RESTART SYSTEM - CHECKPOINT CONTROL           *   CL**1
00015 *                                   MAINTENANCE                  *   CL**1
00016 *                                                                *   CL**1
262023******************************************************************        
262023*  CHANGED 09/28/2021    BY JIM HUNTER      WR: CHG0262023       *        
262023*  CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE   *        
262023*  MAKING THE CALL DYNAMIC VS STATIC                             *        
00017 ******************************************************************   CL**1
00018                                                                      CL**1
00019 ******************************************************************   CL**1
00020  ENVIRONMENT DIVISION.                                               CL**1
00021 ******************************************************************   CL**1
00022                                                                      CL**1
00023 ******************************************************************   CL**1
00024  DATA DIVISION.                                                      CL**1
00025 ******************************************************************   CL**1
00026                                                                      CL**1
00027  WORKING-STORAGE SECTION.                                            CL**1
00028                                                                      CL**1
00029 *                                                                    CL**1
00030 *  SENDING/RECEIVING AREA FOR NUMERIC EDIT ROUTINE (DPKUT100)        CL**1
00031 *                                                                    CL**1
00032                                                                      CL**1
00033      COPY DPWS010I.                                                  CL**2
00034                                                                      CL**1
00035 *                                                                    CL**1
00036 *  STANDARD ATTENTION IDENTIFIER LIST                                CL**1
00037 *                                                                    CL**1
00038                                                                      CL**1
00039      COPY DFHAID.                                                    CL**1
00040                                                                      CL**1
00041 *                                                                    CL**1
00042 *  STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTERS LIST            CL**1
00043 *                                                                    CL**1
00044                                                                      CL**1
00045      COPY DFHBMSCA.                                                  CL**1
00046                                                                      CL**1
00047 *                                                                    CL**1
00048 *  DESCRIPTIVE ATTRIBUTES                                            CL**1
00049 *                                                                    CL**1
00050                                                                      CL**1
00051      COPY ATTRIB.                                                    CL**2
00052                                                                      CL**1
00053  01  PS-PROGRAM-SWITCHES.                                            CL**1
00054      05  PS-EDIT-ERROR-IND            PIC X(1)    VALUE 'N'.         CL**1
00055          88  PS-NO-EDIT-ERROR                     VALUE 'N'.         CL**1
00056          88  PS-EDIT-ERROR                        VALUE 'Y'.         CL**1
00057      05  PS-SQL-RECORD-IND            PIC X(1)    VALUE 'N'.         CL**1
00058          88  PS-SQL-REC-FOUND                     VALUE 'Y'.         CL**1
00059          88  PS-SQL-REC-NOT-FOUND                 VALUE 'N'.         CL**1
00060      05  PS-UPDATE-SW                 PIC X(1)    VALUE 'N'.         CL**1
00061          88  PS-UPDATE-COMPLETE                   VALUE 'Y'.         CL**1
00062          88  PS-UPDATE-INCOMPLETE                 VALUE 'N'.         CL**1
00063                                                                      CL**1
00064  01  PV-PROGRAM-VARIABLES.                                           CL**1
00065      05  PV-RBA                       PIC S9(9)   VALUE ZERO         CL**1
00066                                       COMP SYNC.                     CL**1
00067      05  PV-LAST-DB2-ACTION           PIC X(48)   VALUE SPACES.      CL**1
00068          88  PV-OPEN-JOB-PLAN-CURSOR              VALUE              CL**1
00069              'OPEN JOB/PLAN CURSOR  -  TCKRSTCNTL            '.      CL**1
00070          88  PV-FETCH-JOB-PLAN-TABLE              VALUE              CL**1
00071              'FETCH JOB/PLAN TABLE  -  TCKRSTCNTL            '.      CL**1
00072          88  PV-CLOSE-JOB-PLAN-CURSOR             VALUE              CL**1
00073              'CLOSE JOB/PLAN CURSOR  -  TCKRSTCNTL           '.      CL**1
00074          88  PV-INSERT-JOB-PLAN-ROW               VALUE              CL**1
00075              'INSERT JOB/PLAN ROW    -  TCKRSTCNTL           '.      CL**1
00076          88  PV-UPDATE-JOB-PLAN-STATUS            VALUE              CL**1
00077              'UPDATE JOB/PLAN STATUS   -  TCKRSTCNTL         '.      CL**1
00078          88  PV-UPDATE-JOB-PLAN-CONTROL           VALUE              CL**1
00079              'UPDATE JOB/PLAN CONTROL  -  TCKRSTCNTL         '.      CL**1
00080          88  PV-DELETE-JOB-PLAN-ROW               VALUE              CL**1
00081              'DELETE JOB/PLAN ROW   -  TCKRSTCNTL            '.      CL**1
00082      05  PV-CHECK-STATUS              PIC X       VALUE SPACES.      CL**1
00083          88  PV-VALID-STATUS                      VALUE '0' '1'      CL**1
00084                                                     '2' '3' '4'.     CL**1
00085          88  PV-INVALID-DELETE-STATUS             VALUE '1' '2'      CL**1
00086                                                         '3'.         CL**1
00087      05  PV-CONTROL-CODE              PIC X       VALUE SPACES.      CL**1
00088          88  PV-VALID-CONTROL                     VALUE 'A' 'R'.     CL**1
00089          88  PV-VALID-CONTROL-A                   VALUE 'A'.         CL**1
00090          88  PV-VALID-CONTROL-R                   VALUE 'R'.         CL**1
00091      05  PV-TYPE-CODE                 PIC X       VALUE SPACES.      CL**1
00092          88  PV-VALID-TYPE                        VALUE 'C' 'L'      CL**1
00093                                                         'T'.         CL**1
00094      05  PV-ACTION                    PIC X       VALUE SPACES.      CL**1
00095          88  PV-VALID-ACTION                      VALUE 'A' 'C'      CL**1
00096                                                         'D'.         CL**1
00097                                                                      CL**1
00098  01  PC-PROGRAM-CONSTANTS.                                           CL**1
00099      05  PC-MAIN-MENU                 PIC X(8)    VALUE              CL**1
00100          'DPKCS000'.                                                 CL**1
00101      05  PC-DB2-ERROR-LENGTH          PIC S9(4)   VALUE +290         CL**1
00102                                       COMP SYNC.                     CL**1
00103      05  PC-DB2-WARNING-LENGTH        PIC S9(4)   VALUE +164         CL**1
00104                                       COMP SYNC.                     CL**1
00105      05  PC-TRANS-DPKCS005-LENGTH     PIC S9(4)   VALUE +33          CL**1
00106                                       COMP SYNC.                     CL**1
00107      05  PC-COMMON-AREA-LENGTH        PIC S9(4)   VALUE +52          CL**1
00108                                       COMP SYNC.                     CL**1
00109      05  PC-EOF-KEYED-COMP            PIC S9(4)   VALUE +128         CL**1
00110                                       COMP SYNC.                     CL**1
00111      05  FILLER                       REDEFINES                      CL**1
00112                                           PC-EOF-KEYED-COMP.         CL**1
00113          10  FILLER                   PIC X.                         CL**1
00114          10  PC-EOF-KEYED             PIC X.                         CL**1
00115      05  PC-MAX-RETRY                 PIC S9(4)   VALUE +3           CL**1
00116                                       COMP SYNC.                     CL**1
00117      05  PC-MORE-THAN-MAX-RETRY       PIC S9(4)   VALUE +4           CL**1
00118                                       COMP SYNC.                     CL**1
00119      05  PC-ACTIONS.                                                 CL**1
00120          10  PC-ADD                   PIC X       VALUE 'A'.         CL**1
00121          10  PC-CHANGE                PIC X       VALUE 'C'.         CL**1
00122          10  PC-DELETE                PIC X       VALUE 'D'.         CL**1
00123                                                                      CL**1
00124  01  PT-PROGRAM-TRANSFER-AREAS.                                      CL**1
00125      05  PT-TRANSFER-PROGRAM          PIC X(8)    VALUE SPACES.      CL**1
00126      05  PT-TRANSFER-LENGTH           PIC S9(4)   VALUE +0           CL**1
00127                                       COMP SYNC.                     CL**1
00128                                                                      CL**1
00129  01  PW-PROGRAM-WORKAREAS.                                           CL**1
00130      05  PW-RETRY-COUNT               PIC S9(4)   VALUE +0           CL**1
00131                                       COMP SYNC.                     CL**1
00132                                                                      CL**1
00133 *************                                                        CL**1
00134 *   UNFORMATTED MESSAGES FOR DB2 ERRORS/WARNINGS                     CL**1
00135 *************                                                        CL**1
00136                                                                      CL**1
00137  01  DB2-MESSSAGE.                                                   CL**1
00138                                                                      CL**1
00139      05  DM-RESOURCE-UNAVAIL-MSG.                                    CL**1
00140          10  FILLER                        PIC X(48)   VALUE         CL**1
00141              'A RESOURCE WAS NOT AVAILABLE.  PLEASE TRY AGAIN.'.     CL**1
00142          10  FILLER                        PIC X(36)   VALUE         CL**1
00143              'IF THE PROBLEM PERSISTS, CONTACT DP '.                 CL**1
00144                                                                      CL**1
00145      05  DM-DEADLOCK-TIMEOUT-MSG.                                    CL**1
00146          10  FILLER                        PIC X(48)   VALUE         CL**1
00147              'DEADLOCK OR TIMEOUT.  PLEASE TRY AGAIN.         '.     CL**1
00148          10  FILLER                        PIC X(36)   VALUE         CL**1
00149              'IF THE PROBLEM PERSISTS, CONTACT DP '.                 CL**1
00150                                                                      CL**1
00151      05  DM-NOT-AUTHORIZED-MSG.                                      CL**1
00152          10  FILLER                        PIC X(48)   VALUE         CL**1
00153              'CONNECTION AUTHORIZATION FAILURE.  CONTACT DP.  '.     CL**1
00154                                                                      CL**1
00155      05  DM-NOT-CONNECTED-MSG.                                       CL**1
00156          10  FILLER                        PIC X(48)   VALUE         CL**1
00157              'CONNECTION NOT ESTABLISHED.  TRY AGAIN.         '.     CL**1
00158          10  FILLER                        PIC X(36)   VALUE         CL**1
00159              'IF PROBLEM PERSISTS, CONTACT DP.    '.                 CL**1
00160                                                                      CL**1
00161      05  DM-OTHER-DB2-ERROR-MSG.                                     CL**1
00162          10  FILLER                        PIC X(48)   VALUE         CL**1
00163              'A DB2 ERROR HAS OCCURRED - CONTACT DP - '.             CL**1
00164                                                                      CL**1
00165      05  DM-DB2-ERROR-MSG.                                           CL**1
00166          10  DM-ERROR-MSG                  PIC X(84).                CL**1
00167          10  FILLER                        PIC X(45)   VALUE         CL**1
00168              'PROGRAM DPKCS004'.                                     CL**1
00169          10  FILLER                        PIC X(11)   VALUE         CL**1
00170              'SQLCODE = ('.                                          CL**1
00171          10  DM-SQLCODE                    PIC Z(8)9-  VALUE ZERO.   CL**1
00172          10  FILLER                        PIC X(22)   VALUE         CL**1
00173              ')   ROWS PROCESSED = ('.                               CL**1
00174          10  DM-ROWS-ERR-PROCESSED         PIC Z(8)9-  VALUE ZERO.   CL**1
00175          10  FILLER                        PIC X(2)    VALUE ')'.    CL**1
00176          10  FILLER                        PIC X(11)   VALUE         CL**1
00177              'SQLERRML= ('.                                          CL**1
00178          10  DM-SQLERRML                   PIC Z(8)9-  VALUE ZERO.   CL**1
00179          10  FILLER                        PIC X(15)   VALUE         CL**1
00180              ')   SQLERRMC = '.                                      CL**1
00181          10  DM-SQLERRMC                   PIC X(70)   VALUE ZERO.   CL**1
00182                                                                      CL**1
00183      05  DM-DB2-WARNING-MSG.                                         CL**1
00184          10  FILLER                        PIC X(42)   VALUE         CL**1
00185              'A DB2 WARNING HAS OCCURRED - CONTACT DP - '.           CL**1
00186          10  FILLER                        PIC X(43)   VALUE         CL**1
00187              'PROGRAM DPKCS004'.                                     CL**1
00188          10  FILLER                        PIC X(11)   VALUE         CL**1
00189              'SQLWARN = ('.                                          CL**1
00190          10  DM-SQLWARN                    PIC X(8)    VALUE         CL**1
00191                                                       SPACES.        CL**1
00192          10  FILLER                        PIC X(14)   VALUE         CL**1
00193              ')  SQLCODE = ('.                                       CL**1
00194          10  DM-SQLCODE1                   PIC Z(8)9-  VALUE ZERO.   CL**1
00195          10  FILLER                        PIC X(22)   VALUE         CL**1
00196              ')   ROWS PROCESSED = ('.                               CL**1
00197          10  DM-ROWS-WRN-PROCESSED         PIC Z(8)9-  VALUE ZERO.   CL**1
00198          10  FILLER                        PIC X(4)    VALUE ')'.    CL**1
00199                                                                      CL**1
00200  01  ST-SYSTEM-TIME-AREA.                                            CL**1
00201      05  ST-ABSTIME                   PIC S9(18)  VALUE ZERO         CL**1
00202                                       COMP SYNC.                     CL**1
00203      05  ST-TIME-EDIT.                                               CL**1
00204          10  ST-TIME-HHMM             PIC X(5)    VALUE SPACES.      CL**1
00205          10  FILLER                   PIC X(3)    VALUE SPACES.      CL**1
00206      05  ST-TIME-EDIT-R   REDEFINES   ST-TIME-EDIT.                  CL**1
00207          10  ST-TME-HH                PIC XX.                        CL**1
00208          10  FILLER                   PIC X.                         CL**1
00209          10  ST-TME-MM                PIC XX.                        CL**1
00210          10  FILLER                   PIC X.                         CL**1
00211          10  ST-TME-SS                PIC XX.                        CL**1
00212      05  ST-DATE-EDIT.                                               CL**1
00213          10  ST-DTE-MM                PIC XX      VALUE SPACES.      CL**1
00214          10  FILLER                   PIC X       VALUE SPACES.      CL**1
00215          10  ST-DTE-DD                PIC XX      VALUE SPACES.      CL**1
00216          10  FILLER                   PIC X       VALUE SPACES.      CL**1
00217          10  ST-DTE-YY                PIC XX      VALUE SPACES.      CL**1
00218                                                                      CL**1
00219  01  SE-SYSTEM-ERROR-MESSAGE.                                        CL**1
00220      05  FILLER                       PIC X(43)   VALUE              CL**1
00221          'A SYSTEM ERROR HAS OCCURRED - CONTACT DP -'.               CL**1
00222      05  FILLER                       PIC X(33)   VALUE              CL**1
00223          'PROGRAM DPKCS004       EIBRESP = '.                        CL**1
00224      05  SE-CICS-RESPONSE             PIC 9(4)    VALUE ZERO.        CL**1
00225      05  FILLER                       PIC X(5)    VALUE SPACES.      CL**1
00226      05  FILLER                       PIC X(14)   VALUE              CL**1
00227          'ATTEMPING TO '.                                            CL**1
00228      05  SE-ATTEMPTED-ACTION          PIC X(61)   VALUE SPACES.      CL**1
00229                                                                      CL**1
00230  01  CA-COMMON-AREA.                                                 CL**1
00231      05  CA-COMMON-DATA.                                             CL**1
00232          10 CA-TRANSACTION-STATUS     PIC X.                         CL**1
00233              88  CA-INITIALIZE-SCREEN           VALUE 'S'.           CL**1
00234              88  CA-PROCESS-SCREEN              VALUE 'R'.           CL**1
00235          10  CA-MAIN-MENU             PIC X(8)  VALUE SPACES.        CL**1
00236          10  CA-LAST-PROGRAM          PIC X(8)  VALUE SPACES.        CL**1
00237          10  CA-JOB-NAME              PIC X(8)  VALUE SPACES.        CL**1
00238          10  CA-PLAN-NAME             PIC X(8)  VALUE SPACES.        CL**1
00239          10  CA-ACTION                PIC X     VALUE SPACES.        CL**1
00240          10  CA-UPDATE-REQUEST        PIC X     VALUE SPACES.        CL**1
00241              88  CA-CHANGE-REQUEST              VALUE 'C'.           CL**1
00242              88  CA-DELETE-REQUEST              VALUE 'D'.           CL**1
00243              88  CA-UPDATE-COMPLETE             VALUE 'U'.           CL**1
00244          10  CA-EDIT-FREQ             PIC ZZZZ9.                     CL**1
00245          10  CA-BEFORE-IMAGE.                                        CL**1
00246              15  CA-BEFORE-STATUS     PIC X(1)  VALUE SPACES.        CL**1
00247                  88  CA-VALID-STATUS            VALUE '0' '1' '2'    CL**1
00248                                                       '3' '4'.       CL**1
00249              15  CA-BEFORE-CONTROL    PIC X(1)  VALUE SPACES.        CL**1
00250              15  CA-BEFORE-TYPE       PIC X(1)  VALUE SPACES.        CL**1
00251              15  CA-BEFORE-FREQ       PIC S9(5) VALUE +0  COMP-3.    CL**1
00252          10  CA-AFTER-IMAGE.                                         CL**1
00253              15  CA-AFTER-STATUS      PIC X(1)  VALUE SPACES.        CL**1
00254              15  CA-AFTER-CONTROL     PIC X(1)  VALUE SPACES.        CL**1
00255              15  CA-AFTER-TYPE        PIC X(1)  VALUE SPACES.        CL**1
00256              15  CA-AFTER-FREQ        PIC S9(5) VALUE +0  COMP-3.    CL**1
00257                                                                      CL**1
00258  01  PM-PROGRAM-MESSAGE-DATA.                                        CL**1
00259      05  FILLER                       PIC X(79)  VALUE               CL**1
00260          '                                           '.              CL**1
00261      05  FILLER                       PIC X(79)  VALUE               CL**1
00262          'UNKNOWN PF KEY PRESSED'.                                   CL**1
00263      05  FILLER                       PIC X(79)  VALUE               CL**1
00264          'JOB/PLAN DOES NOT EXIST'.                                  CL**1
00265      05  FILLER                       PIC X(79)  VALUE               CL**1
00266          'JOB NAME REQUIRED'.                                        CL**1
00267      05  FILLER                       PIC X(79)  VALUE               CL**1
00268          'INVALID ACTION CODE'.                                      CL**1
00269      05  FILLER                       PIC X(79)  VALUE               CL**1
00270          'JOB/PLAN ALREADY EXISTS'.                                  CL**1
00271      05  FILLER                       PIC X(79)  VALUE               CL**1
00272          'CHECKPOINT CONTROLS ADDED FOR JOB/PLAN'.                   CL**1
00273      05  FILLER                       PIC X(79)  VALUE               CL**1
00274          'PRESS PF2 TO CONFIRM UPDATES OR PRESS CLEAR TO CANCEL'.    CL**1
00275      05  FILLER                       PIC X(79)  VALUE               CL**1
00276         'CHECKPOINT CONTROLS IN USE, CANNOT DELETE THIS JOB/PLAN'.   CL**1
00277      05  FILLER                       PIC X(79)  VALUE               CL**1
00278          'CHECKPOINT CONTROLS WERE NOT MODIFIED'.                    CL**1
00279      05  FILLER                       PIC X(79)  VALUE               CL**1
00280          'INVALID STATUS CODE'.                                      CL**1
00281      05  FILLER                       PIC X(79)  VALUE               CL**1
00282          'CHECKPOINT CONTROLS UPDATED FOR JOB/PLAN'.                 CL**1
00283      05  FILLER                       PIC X(79)  VALUE               CL**1
00284          'JOB/PLAN DELETED'.                                         CL**1
00285      05  FILLER                       PIC X(79)  VALUE               CL**1
00286          'INVALID CONTROL CODE'.                                     CL**1
00287      05  FILLER                       PIC X(79)  VALUE               CL**1
00288          'INVALID TYPE CODE'.                                        CL**1
00289      05  FILLER                       PIC X(79)  VALUE               CL**1
00290          'FREQUENCY MUST BE NUMERIC'.                                CL**1
00291      05  FILLER                       PIC X(79)  VALUE               CL**1
00292          'PF2 USED FOR CONFIRMING CHANGES AND DELETES'.              CL**1
00293      05  FILLER                       PIC X(79)  VALUE               CL**1
00294          'FREQUENCY REQUIRED'.                                       CL**1
00295      05  FILLER                       PIC X(79)  VALUE               CL**1
00296          'PLAN NAME REQUIRED'.                                       CL**1
00297      05  FILLER                       PIC X(79)  VALUE               CL**1
00298        'PRESS PF2 TO CONFIRM THE DELETE OR PRESS CLEAR TO CANCEL'.   CL**1
00299  01  PM-PROGRAM-MESSAGE-TABLE   REDEFINES                            CL**1
00300                                    PM-PROGRAM-MESSAGE-DATA.          CL**1
00301      05  PM-PROGRAM-MESSAGE           OCCURS   20   TIMES            CL**1
00302                                 INDEXED BY PM-MESSAGE-INDEX          CL**1
00303                                       PIC X(79).                     CL**1
00304 *                                                                    CL**1
00305 *  DPRD500 RECORD LAYOUT                                             CL**1
00306 *                                                                    CL**1
00307                                                                      CL**1
00308      COPY DPRD500O.                                                  CL**2
00309                                                                      CL**1
00310 *                                                                    CL**1
00311 *  DSECT FOR THE DPKM004 MAPSET                                      CL**1
00312 *                                                                    CL**1
00313                                                                      CL**1
00314      COPY DPKM004.                                                   CL**1
00315                                                                      CL**1
00316 *                                                                    CL**1
00317 *  SQL AND COBOL DECLARATIONS FOR THE                                CL**1
00318 *  (TCKRSTCN)                                                        CL**1
00319 *                                                                    CL**1
00320                                                                      CL**1
00321      EXEC SQL                                                        CL**1
00322          INCLUDE TCKRSTCN                                            CL**1
00323      END-EXEC.                                                       CL**1
00324                                                                      CL**1
00325 *                                                                    CL**1
00326 *  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                   CL**1
00327 *                                                                    CL**1
00328                                                                      CL**1
00329      EXEC SQL                                                        CL**1
00330          INCLUDE SQLCA                                               CL**1
00331      END-EXEC.                                                       CL**1
00332                                                                      CL**1
00333                                                                      CL**1
00334 ******************************************************************   CL**1
00335  LINKAGE SECTION.                                                    CL**1
00336 ******************************************************************   CL**1
00337                                                                      CL**1
00338  01  DFHCOMMAREA.                                                    CL**1
00339      05  DF-COMMON-DATA.                                             CL**1
00340          10 DF-TRANSACTION-STATUS     PIC X.                         CL**1
00341              88  DF-INITIALIZE-SCREEN           VALUE 'S'.           CL**1
00342              88  DF-PROCESS-SCREEN              VALUE 'R'.           CL**1
00343          10  DF-MAIN-MENU             PIC X(8).                      CL**1
00344          10  DF-LAST-PROGRAM          PIC X(8).                      CL**1
00345          10  DF-JOB-NAME              PIC X(8).                      CL**1
00346          10  DF-PLAN-NAME             PIC X(8).                      CL**1
00347          10  DF-ACTION                PIC X.                         CL**1
00348          10  DF-UPDATE-REQUEST        PIC X.                         CL**1
00349              88  DF-CHANGE-REQUEST              VALUE 'C'.           CL**1
00350              88  DF-DELETE-REQUEST              VALUE 'D'.           CL**1
00351              88  DF-UPDATE-COMPLETE             VALUE 'U'.           CL**1
00352          10  DF-EDIT-FREQ             PIC ZZZZ9.                     CL**1
00353          10  DF-BEFORE-IMAGE.                                        CL**1
00354              15  DF-BEFORE-STATUS     PIC X(1).                      CL**1
00355              15  DF-BEFORE-CONTROL    PIC X(1).                      CL**1
00356              15  DF-BEFORE-TYPE       PIC X(1).                      CL**1
00357              15  DF-BEFORE-FREQ       PIC S9(5).                     CL**1
00358          10  DF-AFTER-IMAGE.                                         CL**1
00359              15  DF-AFTER-STATUS      PIC X(1).                      CL**1
00360              15  DF-AFTER-CONTROL     PIC X(1).                      CL**1
00361              15  DF-AFTER-TYPE        PIC X(1).                      CL**1
00362              15  DF-AFTER-FREQ        PIC S9(5).                     CL**1
00363                                                                      CL**1
00364                                                                      CL**1
00365 ******************************************************************   CL**1
00366  PROCEDURE DIVISION.                                                 CL**1
00367 ******************************************************************   CL**1
00368                                                                      CL**1
00369  0000-MAINLINE.                                                      CL**1
00370                                                                      CL**1
00371      SET PM-MESSAGE-INDEX TO 1.                                      CL**1
00372      MOVE DFHRED TO AMSGC.                                           CL**1
00373      MOVE DFHCOMMAREA TO CA-COMMON-AREA.                             CL**1
00374      MOVE LOW-VALUES TO DP004AI.                                     CL**1
00375                                                                      CL**1
00376      EVALUATE TRUE                                                   CL**1
00377          WHEN EIBCALEN = 0                                           CL**1
00378              PERFORM 9100-RETURN-MAIN-MENU                           CL**1
00379          WHEN DF-INITIALIZE-SCREEN                                   CL**1
00380              PERFORM 1000-INITIALIZE                                 CL**1
00381          WHEN EIBAID = DFHPF2                                        CL**1
00382              PERFORM 5000-CONFIRM-UPDATE-REQUEST                     CL**1
00383          WHEN EIBAID = DFHPF4                                        CL**1
00384              PERFORM 9100-RETURN-MAIN-MENU                           CL**1
00385          WHEN EIBAID = DFHPF5                                        CL**1
00386              PERFORM 9200-TRANS-TO-INQUIRY                           CL**1
00387          WHEN EIBAID = DFHCLEAR                                      CL**1
00388              PERFORM 1000-INITIALIZE                                 CL**1
00389          WHEN EIBAID = DFHENTER                                      CL**1
00390              PERFORM 2000-RECEIVE-DPKM004                            CL**1
00391          WHEN OTHER                                                  CL**1
00392              SET PM-MESSAGE-INDEX TO 2                               CL**1
00393              PERFORM 9500-SEND-AND-RETURN                            CL**1
00394      END-EVALUATE.                                                   CL**1
00395                                                                      CL**1
00396      GOBACK.                                                         CL**1
00397                                                                      CL**1
00398                                                                      CL**1
00399 ******************************************************************   CL**1
00400 *  INITIALIZE SCREEN FIELDS AND THE COMMON AREA FOR PROCESSING.  *   CL**1
00401 *  SEND THE MAP AND THE INITIAL DATA.                            *   CL**1
00402 ******************************************************************   CL**1
00403                                                                      CL**1
00404  1000-INITIALIZE.                                                    CL**1
00405                                                                      CL**1
00406      IF CA-UPDATE-COMPLETE                                           CL**1
00407          CONTINUE                                                    CL**1
00408      ELSE                                                            CL**1
00409      IF CA-VALID-STATUS                                              CL**1
00410          PERFORM 9600-BACKOUT-CHKPT-STATUS                           CL**1
00411      END-IF.                                                         CL**1
00412                                                                      CL**1
00413      IF EIBAID = DFHCLEAR                                            CL**1
00414              INITIALIZE CA-JOB-NAME                                  CL**1
00415                         CA-PLAN-NAME.                                CL**1
00416      MOVE 'DPKCS000' TO CA-MAIN-MENU.                                CL**1
00417      SET CA-PROCESS-SCREEN TO TRUE.                                  CL**1
00418                                                                      CL**1
00419      INITIALIZE        CA-ACTION                                     CL**1
00420                        CA-UPDATE-REQUEST                             CL**1
00421                        CA-BEFORE-STATUS                              CL**1
00422                        CA-BEFORE-CONTROL                             CL**1
00423                        CA-BEFORE-TYPE                                CL**1
00424                        CA-BEFORE-FREQ                                CL**1
00425                        CA-AFTER-STATUS                               CL**1
00426                        CA-AFTER-CONTROL                              CL**1
00427                        CA-AFTER-TYPE                                 CL**1
00428                        CA-AFTER-FREQ.                                CL**1
00429                                                                      CL**1
00430      PERFORM 9000-UPDATE-SCREEN-HEADER.                              CL**1
00431                                                                      CL**1
00432      IF PS-UPDATE-COMPLETE                                           CL**1
00433          MOVE PM-PROGRAM-MESSAGE (PM-MESSAGE-INDEX) TO AMSGO         CL**1
00434          MOVE CA-JOB-NAME TO AJOBNMEO                                CL**1
00435          MOVE CA-PLAN-NAME TO APLNNMEO                               CL**1
00436      END-IF.                                                         CL**1
00437                                                                      CL**1
00438      IF CA-LAST-PROGRAM = 'DPKCS005'                                 CL**1
00439          MOVE SPACES TO CA-LAST-PROGRAM                              CL**1
00440          MOVE CA-JOB-NAME TO AJOBNMEO                                CL**1
00441          MOVE CA-PLAN-NAME TO APLNNMEO                               CL**1
00442      END-IF.                                                         CL**1
00443                                                                      CL**1
00444      EXEC CICS                                                       CL**1
00445          SEND                                                        CL**1
00446              MAP('DP004A')                                           CL**1
00447              MAPSET('DPKM004')                                       CL**1
00448              ERASE                                                   CL**1
00449              FORMFEED                                                CL**1
00450              FREEKB                                                  CL**1
00451      END-EXEC.                                                       CL**1
00452                                                                      CL**1
00453      EXEC CICS                                                       CL**1
00454          RETURN                                                      CL**1
00455              TRANSID('Z004')                                         CL**1
00456              COMMAREA(CA-COMMON-AREA)                                CL**1
00457              LENGTH(PC-COMMON-AREA-LENGTH)                           CL**1
00458      END-EXEC.                                                       CL**1
00459 *1000-EXIT.        EXIT.                                             CL**1
00460                                                                      CL**1
00461                                                                      CL**1
00462 ******************************************************************   CL**1
00463 *  PROCESS INFORMATION ENTERED ON THE SCREEN, BY RECEIVING THE   *   CL**1
00464 *  SCREEN FIELDS, EDITING THE INFORMATION ENTERED, AND EITHER    *   CL**1
00465 *  DISPLAYING ERRORS, OR COMPLETING THE ADD, CHANGE, DELETE      *   CL**1
00466 *  REQUEST.                                                      *   CL**1
00467 ******************************************************************   CL**1
00468                                                                      CL**1
00469  2000-RECEIVE-DPKM004.                                               CL**1
00470                                                                      CL**1
00471      EXEC CICS                                                       CL**1
00472          HANDLE CONDITION                                            CL**1
00473              MAPFAIL(1000-INITIALIZE)                                CL**1
00474      END-EXEC.                                                       CL**1
00475                                                                      CL**1
00476      EXEC CICS                                                       CL**1
00477          RECEIVE                                                     CL**1
00478              MAP('DP004A')                                           CL**1
00479              MAPSET('DPKM004')                                       CL**1
00480      END-EXEC.                                                       CL**1
00481                                                                      CL**1
00482      IF (AACTIONI = PC-CHANGE                                        CL**1
00483        AND AACTIONI = CA-ACTION                                      CL**1
00484        AND AJOBNMEI = CA-JOB-NAME                                    CL**1
00485        AND APLNNMEI = CA-PLAN-NAME)                                  CL**1
00486          MOVE PROT-SKIP-MDT TO AJOBNMEA                              CL**1
00487                                APLNNMEA                              CL**1
00488                                AACTIONA                              CL**1
00489          MOVE UNDERSCORE TO AACTIONH                                 CL**1
00490                             AJOBNMEH                                 CL**1
00491                             APLNNMEH                                 CL**1
00492          MOVE GREEN TO AACTIONC                                      CL**1
00493                        AJOBNMEC                                      CL**1
00494                        APLNNMEC                                      CL**1
00495          SET PM-MESSAGE-INDEX TO 8                                   CL**1
00496                                                                      CL**1
00497          PERFORM 6000-EDIT-MAP-FIELDS                                CL**1
00498                                                                      CL**1
00499          MOVE ASTATUSI TO PV-CHECK-STATUS                            CL**1
00500          IF (CA-BEFORE-STATUS = ASTATUSI                             CL**1
00501            OR PV-VALID-STATUS)                                       CL**1
00502              MOVE ASTATUSI TO CA-AFTER-STATUS                        CL**1
00503              MOVE UNBRI-MDT TO ASTATUSA                              CL**1
00504              MOVE UNDERSCORE TO ASTATUSH                             CL**1
00505              MOVE GREEN TO ASTATUSC                                  CL**1
00506          ELSE                                                        CL**1
00507              MOVE UNBRI-MDT TO ASTATUSA                              CL**1
00508              MOVE DFHREVRS TO ASTATUSH                               CL**1
00509              MOVE DFHRED TO ASTATUSC                                 CL**1
00510            IF PS-NO-EDIT-ERROR                                       CL**1
00511              SET PM-MESSAGE-INDEX TO 11                              CL**1
00512              SET PS-EDIT-ERROR TO TRUE                               CL**1
00513              MOVE -1 TO ASTATUSL                                     CL**1
00514            END-IF                                                    CL**1
00515          END-IF                                                      CL**1
00516          PERFORM 9500-SEND-AND-RETURN                                CL**1
00517      END-IF.                                                         CL**1
00518                                                                      CL**1
00519      IF (AACTIONI = PC-DELETE                                        CL**1
00520        AND AACTIONI = CA-ACTION                                      CL**1
00521        AND AJOBNMEI = CA-JOB-NAME                                    CL**1
00522        AND APLNNMEI = CA-PLAN-NAME)                                  CL**1
00523          MOVE PROT-SKIP-MDT TO AJOBNMEA                              CL**1
00524                                APLNNMEA                              CL**1
00525                                AACTIONA                              CL**1
00526          MOVE UNDERSCORE TO AACTIONH                                 CL**1
00527                             AJOBNMEH                                 CL**1
00528                             APLNNMEH                                 CL**1
00529          MOVE GREEN TO AACTIONC                                      CL**1
00530                        AJOBNMEC                                      CL**1
00531                        APLNNMEC                                      CL**1
00532          SET PM-MESSAGE-INDEX TO 20                                  CL**1
00533          PERFORM 9500-SEND-AND-RETURN                                CL**1
00534      END-IF.                                                         CL**1
00535                                                                      CL**1
00536      MOVE AACTIONI TO PV-ACTION.                                     CL**1
00537      IF PV-VALID-ACTION                                              CL**1
00538          MOVE AACTIONI TO CA-ACTION                                  CL**1
00539          MOVE UNBRI-MDT TO AACTIONA                                  CL**1
00540          MOVE UNDERSCORE TO AACTIONH                                 CL**1
00541          MOVE GREEN TO AACTIONC                                      CL**1
00542      ELSE                                                            CL**1
00543          MOVE UNBRI-MDT TO AACTIONA                                  CL**1
00544          MOVE DFHREVRS TO AACTIONH                                   CL**1
00545          MOVE DFHRED TO AACTIONC                                     CL**1
00546          SET PM-MESSAGE-INDEX TO 5                                   CL**1
00547          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00548          MOVE -1 TO AACTIONL                                         CL**1
00549      END-IF.                                                         CL**1
00550                                                                      CL**1
00551      IF ((AJOBNMEA = PC-EOF-KEYED)                                   CL**1
00552        OR (AJOBNMEI = SPACES OR LOW-VALUES))                         CL**1
00553          MOVE UNBRI-MDT TO AJOBNMEA                                  CL**1
00554          MOVE DFHREVRS TO AJOBNMEH                                   CL**1
00555          MOVE DFHRED TO AJOBNMEC                                     CL**1
00556        IF PS-NO-EDIT-ERROR                                           CL**1
00557          SET PM-MESSAGE-INDEX TO 4                                   CL**1
00558          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00559          MOVE -1 TO AJOBNMEL                                         CL**1
00560        END-IF                                                        CL**1
00561      ELSE                                                            CL**1
00562          MOVE AJOBNMEI TO CA-JOB-NAME                                CL**1
00563          MOVE UNBRI-MDT TO AJOBNMEA                                  CL**1
00564          MOVE UNDERSCORE TO AJOBNMEH                                 CL**1
00565          MOVE GREEN TO AJOBNMEC                                      CL**1
00566      END-IF.                                                         CL**1
00567                                                                      CL**1
00568      IF ((APLNNMEA = PC-EOF-KEYED)                                   CL**1
00569        OR (APLNNMEI = SPACES OR LOW-VALUES))                         CL**1
00570          MOVE UNBRI-MDT TO APLNNMEA                                  CL**1
00571          MOVE DFHREVRS TO APLNNMEH                                   CL**1
00572          MOVE DFHRED TO APLNNMEC                                     CL**1
00573        IF PS-NO-EDIT-ERROR                                           CL**1
00574          SET PM-MESSAGE-INDEX TO 19                                  CL**1
00575          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00576          MOVE -1 TO APLNNMEL                                         CL**1
00577        END-IF                                                        CL**1
00578      ELSE                                                            CL**1
00579          MOVE APLNNMEI TO CA-PLAN-NAME                               CL**1
00580          MOVE UNBRI-MDT TO APLNNMEA                                  CL**1
00581          MOVE UNDERSCORE TO APLNNMEH                                 CL**1
00582          MOVE GREEN TO APLNNMEC                                      CL**1
00583      END-IF.                                                         CL**1
00584                                                                      CL**1
00585      IF PS-EDIT-ERROR                                                CL**1
00586          PERFORM 9500-SEND-AND-RETURN                                CL**1
00587      END-IF.                                                         CL**1
00588                                                                      CL**1
00589      EVALUATE TRUE                                                   CL**1
00590          WHEN AACTIONI = PC-ADD                                      CL**1
00591              PERFORM 3000-ADD-REQUEST                                CL**1
00592          WHEN AACTIONI = PC-CHANGE                                   CL**1
00593              SET CA-CHANGE-REQUEST TO TRUE                           CL**1
00594              PERFORM 4000-CHANGE-DELETE-REQUEST                      CL**1
00595          WHEN AACTIONI = PC-DELETE                                   CL**1
00596              SET CA-DELETE-REQUEST TO TRUE                           CL**1
00597              PERFORM 4000-CHANGE-DELETE-REQUEST                      CL**1
00598      END-EVALUATE.                                                   CL**1
00599 *2000-EXIT.        EXIT.                                             CL**1
00600                                                                      CL**1
00601                                                                      CL**1
00602 ******************************************************************   CL**1
00603 *  READ THE DB2 TABLE FOR A NOT FOUND CONDITION, EDIT THE MAP    *   CL**1
00604 *  FIELDS, AND INSERT THE ROW INTO THE DB2 TABLE. IF ERRORS      *   CL**1
00605 *  DISPLAY MESSAGE AND BYPASS INSERT, OTHERWISE WRITE AUDIT      *   CL**1
00606 *  RECORD AND SEND ADD CONFIRMED MESSAGE TO THE SCREEN.          *   CL**1
00607 ******************************************************************   CL**1
00608                                                                      CL**1
00609  3000-ADD-REQUEST.                                                   CL**1
00610                                                                      CL**1
00611      PERFORM 7000-READ-INQUIRY.                                      CL**1
00612                                                                      CL**1
00613      IF PS-SQL-REC-FOUND                                             CL**1
00614          INITIALIZE ACONTRLO                                         CL**1
00615                     ATYPEO                                           CL**1
00616                     AFREQO                                           CL**1
00617                     ASTATUSO                                         CL**1
00618          MOVE -1 TO AACTIONL                                         CL**1
00619          SET PM-MESSAGE-INDEX TO 6                                   CL**1
00620          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00621          PERFORM 9500-SEND-AND-RETURN                                CL**1
00622      END-IF.                                                         CL**1
00623                                                                      CL**1
00624      PERFORM 6000-EDIT-MAP-FIELDS.                                   CL**1
00625                                                                      CL**1
00626      IF PS-EDIT-ERROR                                                CL**1
00627          PERFORM 9500-SEND-AND-RETURN                                CL**1
00628      END-IF.                                                         CL**1
00629                                                                      CL**1
00630      PERFORM VARYING PW-RETRY-COUNT FROM 1 BY 1                      CL**1
00631          UNTIL PW-RETRY-COUNT > PC-MAX-RETRY                         CL**1
00632                                                                      CL**1
00633          EXEC SQL                                                    CL**1
00634              INSERT                                                  CL**1
00635                  INTO TCKRSTCNTL                                     CL**1
00636                      (JOB_NAME,                                      CL**1
00637                       PLAN_NAME,                                     CL**1
00638                       CKPT_STAT_CODE,                                CL**1
00639                       CKPT_CNTL_CODE,                                CL**1
00640                       CKPT_TYPE_CODE,                                CL**1
00641                       CKPT_FRQNCY_QTY)                               CL**1
00642              VALUES                                                  CL**1
00643                      (:CA-JOB-NAME,                                  CL**1
00644                       :CA-PLAN-NAME,                                 CL**1
00645                        '0',                                          CL**1
00646                       :CA-AFTER-CONTROL,                             CL**1
00647                       :CA-AFTER-TYPE,                                CL**1
00648                       :CA-AFTER-FREQ)                                CL**1
00649          END-EXEC                                                    CL**1
00650                                                                      CL**1
00651          EVALUATE TRUE                                               CL**1
00652              WHEN SQLCODE = -913                                     CL**1
00653              WHEN SQLCODE = -904                                     CL**1
00654                  CONTINUE                                            CL**1
00655              WHEN SQLCODE < 0                                        CL**1
00656                  SET PV-INSERT-JOB-PLAN-ROW TO TRUE                  CL**1
00657                  PERFORM 9300-SQL-ERROR                              CL**1
00658              WHEN SQLWARN0 = 'W'                                     CL**1
00659              WHEN SQLCODE > 0                                        CL**1
00660                  SET PV-INSERT-JOB-PLAN-ROW TO TRUE                  CL**1
00661                  PERFORM 9400-SQL-WARNING                            CL**1
00662              WHEN SQLCODE = 0                                        CL**1
00663                  MOVE PC-MORE-THAN-MAX-RETRY TO PW-RETRY-COUNT       CL**1
00664          END-EVALUATE                                                CL**1
00665                                                                      CL**1
00666      END-PERFORM.                                                    CL**1
00667                                                                      CL**1
00668      SET PM-MESSAGE-INDEX TO 7.                                      CL**1
00669      SET PS-UPDATE-COMPLETE TO TRUE.                                 CL**1
00670      MOVE DFHNEUTR TO AMSGC.                                         CL**1
00671      MOVE 0 TO CA-AFTER-STATUS.                                      CL**1
00672      PERFORM 8000-BUILD-MAINTENANCE-LOG.                             CL**1
00673      PERFORM 1000-INITIALIZE.                                        CL**1
00674 *3000-EXIT.        EXIT.                                             CL**1
00675                                                                      CL**1
00676                                                                      CL**1
00677 ******************************************************************   CL**1
00678 *  READ THE DB2 TABLE AND DISPLAY THE ROW TO BE CHANGED OR       *   CL**1
00679 *  DELETED. UPDATE THE SELECTED ROW WITH A "9" IN THE STATUS     *   CL**1
00680 *  CODE WHICH INDICATES THAT THE CHECKPOINT CONTROLS ARE         *   CL**1
00681 *  IN THE PROCESS OF BEING UPDATED.                              *   CL**1
00682 ******************************************************************   CL**1
00683                                                                      CL**1
00684  4000-CHANGE-DELETE-REQUEST.                                         CL**1
00685                                                                      CL**1
00686      PERFORM 7000-READ-INQUIRY.                                      CL**1
00687                                                                      CL**1
00688      IF PS-SQL-REC-NOT-FOUND                                         CL**1
00689          MOVE -1 TO AJOBNMEL                                         CL**1
00690          SET PM-MESSAGE-INDEX TO 3                                   CL**1
00691          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00692          PERFORM 9500-SEND-AND-RETURN                                CL**1
00693      END-IF.                                                         CL**1
00694                                                                      CL**1
00695      IF CA-DELETE-REQUEST                                            CL**1
00696        MOVE TCKRSTCNTL-CKPT-STAT-CODE TO PV-CHECK-STATUS             CL**1
00697        IF PV-INVALID-DELETE-STATUS                                   CL**1
00698          MOVE -1 TO AJOBNMEL                                         CL**1
00699          SET PM-MESSAGE-INDEX TO 9                                   CL**1
00700          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00701          PERFORM 9500-SEND-AND-RETURN                                CL**1
00702        END-IF                                                        CL**1
00703      END-IF.                                                         CL**1
00704                                                                      CL**1
00705      IF CA-VALID-STATUS                                              CL**1
00706          MOVE CA-BEFORE-STATUS TO ASTATUSO                           CL**1
00707      ELSE                                                            CL**1
00708          MOVE TCKRSTCNTL-CKPT-STAT-CODE TO CA-BEFORE-STATUS          CL**1
00709                                            ASTATUSO                  CL**1
00710      END-IF.                                                         CL**1
00711                                                                      CL**1
00712      MOVE UNBRI-MDT TO ASTATUSA.                                     CL**1
00713      MOVE UNDERSCORE TO ASTATUSH.                                    CL**1
00714      MOVE GREEN TO ASTATUSC.                                         CL**1
00715      MOVE TCKRSTCNTL-CKPT-CNTL-CODE TO CA-BEFORE-CONTROL             CL**1
00716                                        ACONTRLO.                     CL**1
00717      MOVE UNBRI-MDT TO ACONTRLA.                                     CL**1
00718      MOVE UNDERSCORE TO ACONTRLH.                                    CL**1
00719      MOVE GREEN TO ACONTRLC.                                         CL**1
00720      MOVE TCKRSTCNTL-CKPT-TYPE-CODE TO CA-BEFORE-TYPE                CL**1
00721                                        ATYPEO.                       CL**1
00722      MOVE UNBRI-MDT TO ATYPEA.                                       CL**1
00723      MOVE UNDERSCORE TO ATYPEH.                                      CL**1
00724      MOVE GREEN TO ATYPEC.                                           CL**1
00725      MOVE TCKRSTCNTL-CKPT-FRQNCY-QTY TO CA-BEFORE-FREQ               CL**1
00726                                         CA-EDIT-FREQ                 CL**1
00727                                         AFREQO.                      CL**1
00728      MOVE UNBRI-MDT TO AFREQA.                                       CL**1
00729      MOVE UNDERSCORE TO AFREQH.                                      CL**1
00730      MOVE GREEN TO AFREQC.                                           CL**1
00731                                                                      CL**1
00732      MOVE TCKRSTCNTL-CKPT-STAT-CODE TO PV-CHECK-STATUS.              CL**1
00733      IF PV-VALID-STATUS                                              CL**1
00734        PERFORM VARYING PW-RETRY-COUNT FROM 1 BY 1                    CL**1
00735            UNTIL PW-RETRY-COUNT > PC-MAX-RETRY                       CL**1
00736                                                                      CL**1
00737          EXEC SQL                                                    CL**1
00738              UPDATE TCKRSTCNTL                                       CL**1
00739              SET    CKPT_STAT_CODE = '9'                             CL**1
00740              WHERE  JOB_NAME  = :CA-JOB-NAME                         CL**1
00741                AND  PLAN_NAME = :CA-PLAN-NAME                        CL**1
00742          END-EXEC                                                    CL**1
00743                                                                      CL**1
00744          EVALUATE TRUE                                               CL**1
00745              WHEN SQLCODE = -913                                     CL**1
00746              WHEN SQLCODE = -904                                     CL**1
00747                  CONTINUE                                            CL**1
00748              WHEN SQLCODE < 0                                        CL**1
00749                  SET PV-UPDATE-JOB-PLAN-STATUS TO TRUE               CL**1
00750                  PERFORM 9300-SQL-ERROR                              CL**1
00751              WHEN SQLWARN0 = 'W'                                     CL**1
00752              WHEN SQLCODE > 0                                        CL**1
00753                  SET PV-UPDATE-JOB-PLAN-STATUS TO TRUE               CL**1
00754                  PERFORM 9400-SQL-WARNING                            CL**1
00755              WHEN SQLCODE = 0                                        CL**1
00756                  MOVE PC-MORE-THAN-MAX-RETRY TO PW-RETRY-COUNT       CL**1
00757          END-EVALUATE                                                CL**1
00758                                                                      CL**1
00759        END-PERFORM                                                   CL**1
00760      END-IF.                                                         CL**1
00761                                                                      CL**1
00762      IF CA-CHANGE-REQUEST                                            CL**1
00763          MOVE PROT-SKIP-MDT TO AJOBNMEA                              CL**1
00764                                APLNNMEA                              CL**1
00765                                AACTIONA                              CL**1
00766          MOVE -1 TO ACONTRLL                                         CL**1
00767      ELSE                                                            CL**1
00768        IF CA-DELETE-REQUEST                                          CL**1
00769          MOVE PROT-SKIP-MDT TO AJOBNMEA                              CL**1
00770                                APLNNMEA                              CL**1
00771                                AACTIONA                              CL**1
00772                                ACONTRLA                              CL**1
00773                                ATYPEA                                CL**1
00774                                AFREQA                                CL**1
00775                                ASTATUSA                              CL**1
00776        END-IF                                                        CL**1
00777      END-IF.                                                         CL**1
00778                                                                      CL**1
00779      PERFORM 9500-SEND-AND-RETURN.                                   CL**1
00780 *4000-EXIT.        EXIT.                                             CL**1
00781                                                                      CL**1
00782                                                                      CL**1
00783 ******************************************************************   CL**1
00784 *  PF2 KEY WAS ENTERED TO CONFIRM THE UPDATE, THE SCREEN         *   CL**1
00785 *  FIELDS ARE EDITTED FOR ERRORS. IF NO ERRORS THE REQUESTED     *   CL**1
00786 *  DB2 ROW IS EITHER UPDATED OR DELETED, OTHERWISE ERROR MESSAGE *   CL**1
00787 *  IS DISPLAY AND UPDATES BYPASSED.                              *   CL**1
00788 ******************************************************************   CL**1
00789                                                                      CL**1
00790  5000-CONFIRM-UPDATE-REQUEST.                                        CL**1
00791                                                                      CL**1
00792      EXEC CICS                                                       CL**1
00793          HANDLE CONDITION                                            CL**1
00794              MAPFAIL(1000-INITIALIZE)                                CL**1
00795      END-EXEC.                                                       CL**1
00796                                                                      CL**1
00797      EXEC CICS                                                       CL**1
00798          RECEIVE                                                     CL**1
00799              MAP('DP004A')                                           CL**1
00800              MAPSET('DPKM004')                                       CL**1
00801      END-EXEC.                                                       CL**1
00802                                                                      CL**1
00803      IF (EIBAID = DFHPF2                                             CL**1
00804        AND AACTIONI = PC-ADD)                                        CL**1
00805          SET PM-MESSAGE-INDEX TO 17                                  CL**1
00806          PERFORM 9500-SEND-AND-RETURN                                CL**1
00807      END-IF.                                                         CL**1
00808                                                                      CL**1
00809      IF CA-DELETE-REQUEST                                            CL**1
00810          PERFORM 5500-CONFIRM-DELETE-REQUEST                         CL**1
00811      END-IF.                                                         CL**1
00812                                                                      CL**1
00813      IF (CA-BEFORE-STATUS = ASTATUSI                                 CL**1
00814        AND CA-BEFORE-CONTROL = ACONTRLI                              CL**1
00815        AND CA-BEFORE-TYPE = ATYPEI                                   CL**1
00816        AND CA-EDIT-FREQ = AFREQI)                                    CL**1
00817            MOVE PROT-SKIP-MDT TO AJOBNMEA                            CL**1
00818                                  APLNNMEA                            CL**1
00819                                  AACTIONA                            CL**1
00820            MOVE -1 TO ACONTRLL                                       CL**1
00821            SET PS-EDIT-ERROR TO TRUE                                 CL**1
00822            SET PM-MESSAGE-INDEX  TO 10                               CL**1
00823            PERFORM 9500-SEND-AND-RETURN                              CL**1
00824      END-IF.                                                         CL**1
00825                                                                      CL**1
00826      PERFORM 6000-EDIT-MAP-FIELDS.                                   CL**1
00827                                                                      CL**1
00828      MOVE ASTATUSI TO PV-CHECK-STATUS.                               CL**1
00829      IF (CA-BEFORE-STATUS = ASTATUSI                                 CL**1
00830        OR PV-VALID-STATUS)                                           CL**1
00831          MOVE ASTATUSI TO CA-AFTER-STATUS                            CL**1
00832          MOVE UNBRI-MDT TO ASTATUSA                                  CL**1
00833          MOVE UNDERSCORE TO ASTATUSH                                 CL**1
00834          MOVE GREEN TO ASTATUSC                                      CL**1
00835      ELSE                                                            CL**1
00836            MOVE UNBRI-MDT TO ASTATUSA                                CL**1
00837            MOVE DFHREVRS TO ASTATUSH                                 CL**1
00838            MOVE DFHRED TO ASTATUSC                                   CL**1
00839          IF PS-NO-EDIT-ERROR                                         CL**1
00840            SET PM-MESSAGE-INDEX TO 11                                CL**1
00841            SET PS-EDIT-ERROR TO TRUE                                 CL**1
00842            MOVE -1 TO ASTATUSL                                       CL**1
00843          END-IF                                                      CL**1
00844      END-IF.                                                         CL**1
00845                                                                      CL**1
00846      IF PS-EDIT-ERROR                                                CL**1
00847            MOVE PROT-SKIP-MDT TO AJOBNMEA                            CL**1
00848                                  APLNNMEA                            CL**1
00849                                  AACTIONA                            CL**1
00850            PERFORM 9500-SEND-AND-RETURN                              CL**1
00851      END-IF.                                                         CL**1
00852                                                                      CL**1
00853      PERFORM VARYING PW-RETRY-COUNT FROM 1 BY 1                      CL**1
00854          UNTIL PW-RETRY-COUNT > PC-MAX-RETRY                         CL**1
00855                                                                      CL**1
00856          EXEC SQL                                                    CL**1
00857              UPDATE TCKRSTCNTL                                       CL**1
00858              SET    CKPT_STAT_CODE = :CA-AFTER-STATUS,               CL**1
00859                     CKPT_CNTL_CODE = :CA-AFTER-CONTROL,              CL**1
00860                     CKPT_TYPE_CODE = :CA-AFTER-TYPE,                 CL**1
00861                     CKPT_FRQNCY_QTY = :CA-AFTER-FREQ                 CL**1
00862              WHERE  JOB_NAME  = :CA-JOB-NAME                         CL**1
00863                AND  PLAN_NAME = :CA-PLAN-NAME                        CL**1
00864          END-EXEC                                                    CL**1
00865                                                                      CL**1
00866          EVALUATE TRUE                                               CL**1
00867              WHEN SQLCODE = -913                                     CL**1
00868              WHEN SQLCODE = -904                                     CL**1
00869                  CONTINUE                                            CL**1
00870              WHEN SQLCODE < 0                                        CL**1
00871                  SET PV-UPDATE-JOB-PLAN-CONTROL TO TRUE              CL**1
00872                  PERFORM 9300-SQL-ERROR                              CL**1
00873              WHEN SQLWARN0 = 'W'                                     CL**1
00874              WHEN SQLCODE > 0                                        CL**1
00875                  SET PV-UPDATE-JOB-PLAN-CONTROL TO TRUE              CL**1
00876                  PERFORM 9400-SQL-WARNING                            CL**1
00877              WHEN SQLCODE = 0                                        CL**1
00878                  MOVE PC-MORE-THAN-MAX-RETRY TO PW-RETRY-COUNT       CL**1
00879          END-EVALUATE                                                CL**1
00880                                                                      CL**1
00881      END-PERFORM.                                                    CL**1
00882                                                                      CL**1
00883      INITIALIZE AACTIONO.                                            CL**1
00884      SET PM-MESSAGE-INDEX TO 12.                                     CL**1
00885      SET PS-UPDATE-COMPLETE TO TRUE.                                 CL**1
00886      MOVE DFHNEUTR TO AMSGC.                                         CL**1
00887      PERFORM 8000-BUILD-MAINTENANCE-LOG.                             CL**1
00888      SET CA-UPDATE-COMPLETE TO TRUE.                                 CL**1
00889      PERFORM 1000-INITIALIZE.                                        CL**1
00890 *5000-EXIT.        EXIT.                                             CL**1
00891                                                                      CL**1
00892                                                                      CL**1
00893 ******************************************************************   CL**1
00894 *  THE DELETE REQUEST WAS CONFIRMED AND THE DB2 ROW IS DELETED.  *   CL**1
00895 *  AN AUDIT RECORD IS WRITTEN, FIELDS ARE INITIALIZED, AND A     *   CL**1
00896 *  DELETE CONFIRMED MESSAGE IS SENT TO THE SCREEN.               *   CL**1
00897 ******************************************************************   CL**1
00898                                                                      CL**1
00899  5500-CONFIRM-DELETE-REQUEST.                                        CL**1
00900                                                                      CL**1
00901      PERFORM VARYING PW-RETRY-COUNT FROM 1 BY 1                      CL**1
00902          UNTIL PW-RETRY-COUNT > PC-MAX-RETRY                         CL**1
00903                                                                      CL**1
00904          EXEC SQL                                                    CL**1
00905              DELETE                                                  CL**1
00906                  FROM TCKRSTCNTL                                     CL**1
00907                  WHERE  JOB_NAME  = :CA-JOB-NAME                     CL**1
00908                    AND  PLAN_NAME = :CA-PLAN-NAME                    CL**1
00909          END-EXEC                                                    CL**1
00910                                                                      CL**1
00911          EVALUATE TRUE                                               CL**1
00912              WHEN SQLCODE = -913                                     CL**1
00913              WHEN SQLCODE = -904                                     CL**1
00914                  CONTINUE                                            CL**1
00915              WHEN SQLCODE < 0                                        CL**1
00916                  SET PV-DELETE-JOB-PLAN-ROW TO TRUE                  CL**1
00917                  PERFORM 9300-SQL-ERROR                              CL**1
00918              WHEN SQLWARN0 = 'W'                                     CL**1
00919              WHEN SQLCODE > 0                                        CL**1
00920                  SET PV-DELETE-JOB-PLAN-ROW TO TRUE                  CL**1
00921                  PERFORM 9400-SQL-WARNING                            CL**1
00922              WHEN SQLCODE = 0                                        CL**1
00923                  MOVE PC-MORE-THAN-MAX-RETRY TO PW-RETRY-COUNT       CL**1
00924          END-EVALUATE                                                CL**1
00925                                                                      CL**1
00926      END-PERFORM.                                                    CL**1
00927                                                                      CL**1
00928      INITIALIZE ACONTRLO                                             CL**1
00929                 ATYPEO                                               CL**1
00930                 AFREQO                                               CL**1
00931                 ASTATUSO                                             CL**1
00932                 AACTIONO.                                            CL**1
00933      SET PM-MESSAGE-INDEX TO 13.                                     CL**1
00934      SET PS-UPDATE-COMPLETE TO TRUE.                                 CL**1
00935      MOVE DFHNEUTR TO AMSGC.                                         CL**1
00936      PERFORM 8000-BUILD-MAINTENANCE-LOG.                             CL**1
00937      SET CA-UPDATE-COMPLETE TO TRUE.                                 CL**1
00938      PERFORM 1000-INITIALIZE.                                        CL**1
00939 *5500-EXIT.        EXIT.                                             CL**1
00940                                                                      CL**1
00941                                                                      CL**1
00942 ******************************************************************   CL**1
00943 *  THE DELETE REQUEST WAS CONFIRMED AND THE DB2 ROW IS DELETED.  *   CL**1
00944 *  AN AUDIT RECORD IS WRITTEN, FIELDS ARE INITIALIZED, AND A     *   CL**1
00945 *  DELETE CONFIRMED MESSAGE IS SENT TO THE SCREEN.               *   CL**1
00946 ******************************************************************   CL**1
00947                                                                      CL**1
00948  6000-EDIT-MAP-FIELDS.                                               CL**1
00949                                                                      CL**1
00950      MOVE ACONTRLI TO PV-CONTROL-CODE.                               CL**1
00951      IF PV-VALID-CONTROL                                             CL**1
00952          MOVE ACONTRLI TO CA-AFTER-CONTROL                           CL**1
00953          MOVE UNBRI-MDT TO ACONTRLA                                  CL**1
00954          MOVE UNDERSCORE TO ACONTRLH                                 CL**1
00955          MOVE GREEN TO ACONTRLC                                      CL**1
00956      ELSE                                                            CL**1
00957          MOVE UNBRI-MDT TO ACONTRLA                                  CL**1
00958          MOVE DFHREVRS TO ACONTRLH                                   CL**1
00959          MOVE DFHRED TO ACONTRLC                                     CL**1
00960        IF PS-NO-EDIT-ERROR                                           CL**1
00961          SET PM-MESSAGE-INDEX TO 14                                  CL**1
00962          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00963          MOVE -1 TO ACONTRLL                                         CL**1
00964        END-IF                                                        CL**1
00965      END-IF.                                                         CL**1
00966                                                                      CL**1
00967      IF PV-VALID-CONTROL-R                                           CL**1
00968        IF (ATYPEI = SPACES OR LOW-VALUES                             CL**1
00969          OR ATYPEA = PC-EOF-KEYED)                                   CL**1
00970            MOVE 'T' TO ATYPEI                                        CL**1
00971        END-IF                                                        CL**1
00972      END-IF.                                                         CL**1
00973                                                                      CL**1
00974      MOVE ATYPEI TO PV-TYPE-CODE.                                    CL**1
00975      IF PV-VALID-TYPE                                                CL**1
00976          MOVE ATYPEI TO CA-AFTER-TYPE                                CL**1
00977          MOVE UNBRI-MDT TO ATYPEA                                    CL**1
00978          MOVE UNDERSCORE TO ATYPEH                                   CL**1
00979          MOVE GREEN TO ATYPEC                                        CL**1
00980      ELSE                                                            CL**1
00981          MOVE UNBRI-MDT TO ATYPEA                                    CL**1
00982          MOVE DFHREVRS TO ATYPEH                                     CL**1
00983          MOVE DFHRED TO ATYPEC                                       CL**1
00984        IF PS-NO-EDIT-ERROR                                           CL**1
00985          SET PM-MESSAGE-INDEX TO 15                                  CL**1
00986          SET PS-EDIT-ERROR TO TRUE                                   CL**1
00987          MOVE -1 TO ATYPEL                                           CL**1
00988        END-IF                                                        CL**1
00989      END-IF.                                                         CL**1
00990                                                                      CL**1
00991      MOVE AFREQI TO DP010I-UNEDITED-FIELD.                           CL**1
00992      MOVE 5 TO DP010I-MAXIMUM-DIGITS.                                CL**1
00993      MOVE 0 TO DP010I-MAXIMUM-DECIMALS.                              CL**1
00994      SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                        CL**1
262023     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
262023          USING DP010I-NUMERIC-EDIT-AREA.                                 
00996      IF NOT DP010I-ERROR-DETECTED                                    CL**1
00997          MOVE DP010I-NUMERIC-FIELD TO AFREQO                         CL**1
00998                                       CA-AFTER-FREQ                  CL**1
00999          MOVE UNPRT-NUM-BRI-MDT TO AFREQA                            CL**1
01000          MOVE UNDERSCORE TO AFREQH                                   CL**1
01001          MOVE GREEN TO AFREQC                                        CL**1
01002      ELSE                                                            CL**1
01003        IF DP010I-ERROR-DETECTED                                      CL**1
01004          MOVE UNBRI-MDT TO AFREQA                                    CL**1
01005          MOVE DFHREVRS TO AFREQH                                     CL**1
01006          MOVE DFHRED TO AFREQC                                       CL**1
01007          IF PS-NO-EDIT-ERROR                                         CL**1
01008            SET PM-MESSAGE-INDEX TO 16                                CL**1
01009            SET PS-EDIT-ERROR TO TRUE                                 CL**1
01010            MOVE -1 TO AFREQL                                         CL**1
01011          END-IF                                                      CL**1
01012        END-IF                                                        CL**1
01013      END-IF.                                                         CL**1
01014                                                                      CL**1
01015      IF (PV-VALID-CONTROL-R                                          CL**1
01016        AND DP010I-NUMERIC-FIELD = ZEROS)                             CL**1
01017          MOVE +30 TO AFREQO                                          CL**1
01018                      CA-AFTER-FREQ                                   CL**1
01019          MOVE UNPRT-NUM-BRI-MDT TO AFREQA                            CL**1
01020          MOVE UNDERSCORE TO AFREQH                                   CL**1
01021          MOVE GREEN TO AFREQC                                        CL**1
01022      END-IF.                                                         CL**1
01023                                                                      CL**1
01024      IF (PV-VALID-CONTROL-A                                          CL**1
01025        AND DP010I-NUMERIC-FIELD = ZEROS)                             CL**1
01026          MOVE UNBRI-MDT TO AFREQA                                    CL**1
01027          MOVE DFHREVRS TO AFREQH                                     CL**1
01028          MOVE DFHRED TO AFREQC                                       CL**1
01029          IF PS-NO-EDIT-ERROR                                         CL**1
01030            SET PM-MESSAGE-INDEX TO 18                                CL**1
01031            SET PS-EDIT-ERROR TO TRUE                                 CL**1
01032            MOVE -1 TO AFREQL                                         CL**1
01033          END-IF                                                      CL**1
01034      END-IF.                                                         CL**1
01035                                                                      CL**1
01036      IF DP010I-NUMERIC-FIELD = ZEROS                                 CL**1
01037        IF (ACONTRLC = DFHRED                                         CL**1
01038          OR ATYPEC = DFHRED)                                         CL**1
01039            MOVE UNBRI-MDT TO AFREQA                                  CL**1
01040            MOVE DFHREVRS TO AFREQH                                   CL**1
01041            MOVE DFHRED TO AFREQC                                     CL**1
01042        END-IF                                                        CL**1
01043      END-IF.                                                         CL**1
01044 *6000-EXIT.        EXIT.                                             CL**1
01045                                                                      CL**1
01046                                                                      CL**1
01047 ******************************************************************   CL**1
01048 *  READ THE REQUESTED DB2 RECORD.                                *   CL**1
01049 ******************************************************************   CL**1
01050                                                                      CL**1
01051  7000-READ-INQUIRY.                                                  CL**1
01052                                                                      CL**1
01053      PERFORM VARYING PW-RETRY-COUNT FROM 1 BY 1                      CL**1
01054          UNTIL PW-RETRY-COUNT > PC-MAX-RETRY                         CL**1
01055                                                                      CL**1
01056          EXEC SQL                                                    CL**1
01057              SELECT JOB_NAME,                                        CL**1
01058                     PLAN_NAME,                                       CL**1
01059                     CKPT_STAT_CODE,                                  CL**1
01060                     CKPT_CNTL_CODE,                                  CL**1
01061                     CKPT_TYPE_CODE,                                  CL**1
01062                     CKPT_FRQNCY_QTY                                  CL**1
01063              INTO :TCKRSTCNTL-JOB-NAME,                              CL**1
01064                   :TCKRSTCNTL-PLAN-NAME,                             CL**1
01065                   :TCKRSTCNTL-CKPT-STAT-CODE,                        CL**1
01066                   :TCKRSTCNTL-CKPT-CNTL-CODE,                        CL**1
01067                   :TCKRSTCNTL-CKPT-TYPE-CODE,                        CL**1
01068                   :TCKRSTCNTL-CKPT-FRQNCY-QTY                        CL**1
01069              FROM TCKRSTCNTL                                         CL**1
01070              WHERE JOB_NAME   = :CA-JOB-NAME                         CL**1
01071                AND PLAN_NAME  = :CA-PLAN-NAME                        CL**1
01072          END-EXEC                                                    CL**1
01073                                                                      CL**1
01074          EVALUATE TRUE                                               CL**1
01075              WHEN SQLCODE = +100                                     CL**1
01076                  SET PS-SQL-REC-NOT-FOUND TO TRUE                    CL**1
01077                  MOVE PC-MORE-THAN-MAX-RETRY TO PW-RETRY-COUNT       CL**1
01078              WHEN SQLCODE = -913                                     CL**1
01079              WHEN SQLCODE = -904                                     CL**1
01080                  CONTINUE                                            CL**1
01081              WHEN SQLCODE < 0                                        CL**1
01082                  SET PV-FETCH-JOB-PLAN-TABLE TO TRUE                 CL**1
01083                  PERFORM 9300-SQL-ERROR                              CL**1
01084              WHEN SQLWARN0 = 'W'                                     CL**1
01085              WHEN SQLCODE > 0                                        CL**1
01086                  SET PV-FETCH-JOB-PLAN-TABLE TO TRUE                 CL**1
01087                  PERFORM 9400-SQL-WARNING                            CL**1
01088              WHEN SQLCODE = 0                                        CL**1
01089                  SET PS-SQL-REC-FOUND TO TRUE                        CL**1
01090                  MOVE PC-MORE-THAN-MAX-RETRY TO PW-RETRY-COUNT       CL**1
01091          END-EVALUATE                                                CL**1
01092                                                                      CL**1
01093      END-PERFORM.                                                    CL**1
01094                                                                      CL**1
01095 *7000-EXIT.   EXIT.                                                  CL**1
01096                                                                      CL**1
01097                                                                      CL**1
01098 ******************************************************************   CL**1
01099 *  BUILD AND WRITE THE VSAM ESDS MAINTENANCE LOG RECORD.         *   CL**1
01100 ******************************************************************   CL**1
01101                                                                      CL**1
01102  8000-BUILD-MAINTENANCE-LOG.                                         CL**1
01103                                                                      CL**1
01104      PERFORM 9000-UPDATE-SCREEN-HEADER.                              CL**1
01105                                                                      CL**1
01106      INITIALIZE DP500O-DB2-CHKPT-MAINT-RECORD.                       CL**1
01107                                                                      CL**1
01108      MOVE ST-DTE-YY TO DP500O-MAINT-YY.                              CL**1
01109      MOVE ST-DTE-MM TO DP500O-MAINT-MM.                              CL**1
01110      MOVE ST-DTE-DD TO DP500O-MAINT-DD.                              CL**1
01111      MOVE ST-TME-HH TO DP500O-MAINT-HRS.                             CL**1
01112      MOVE ST-TME-MM TO DP500O-MAINT-MIN.                             CL**1
01113      MOVE ST-TME-SS TO DP500O-MAINT-SEC.                             CL**1
01114      MOVE CA-JOB-NAME TO DP500O-JOB-NAME.                            CL**1
01115      MOVE CA-PLAN-NAME TO DP500O-PLAN-NAME.                          CL**1
01116                                                                      CL**1
01117      EXEC CICS                                                       CL**1
01118          ASSIGN                                                      CL**1
01119              USERID(DP500O-USER-ID)                                  CL**1
01120      END-EXEC.                                                       CL**1
01121                                                                      CL**1
01122      MOVE CA-BEFORE-STATUS TO DP500O-BEFORE-STATUS.                  CL**1
01123      MOVE CA-BEFORE-CONTROL TO DP500O-BEFORE-CONTROL.                CL**1
01124      MOVE CA-BEFORE-TYPE TO DP500O-BEFORE-TYPE.                      CL**1
01125      MOVE CA-BEFORE-FREQ TO DP500O-BEFORE-FREQ.                      CL**1
01126      MOVE CA-AFTER-STATUS TO DP500O-AFTER-STATUS.                    CL**1
01127      MOVE CA-AFTER-CONTROL TO DP500O-AFTER-CONTROL.                  CL**1
01128      MOVE CA-AFTER-TYPE TO DP500O-AFTER-TYPE.                        CL**1
01129      MOVE CA-AFTER-FREQ TO DP500O-AFTER-FREQ.                        CL**1
01130                                                                      CL**1
01131      EXEC CICS                                                       CL**1
01132          WRITE                                                       CL**1
01133              DATASET('DPCHKPTL')                                     CL**1
01134              FROM(DP500O-DB2-CHKPT-MAINT-RECORD)                     CL**1
01135              RIDFLD(PV-RBA)                                          CL**1
01136              RBA                                                     CL**1
01137          END-EXEC.                                                   CL**1
01138 *8000-EXIT.   EXIT.                                                  CL**1
01139                                                                      CL**1
01140                                                                      CL**1
01141 ******************************************************************   CL**1
01142 *  FILL IN THE SCREEN HEADER WITH THE DATE, TIME, AND TERMINAL   *   CL**1
01143 *  NUMBER.                                                       *   CL**1
01144 ******************************************************************   CL**1
01145                                                                      CL**1
01146  9000-UPDATE-SCREEN-HEADER.                                          CL**1
01147                                                                      CL**1
01148      EXEC CICS                                                       CL**1
01149          ASKTIME                                                     CL**1
01150              ABSTIME(ST-ABSTIME)                                     CL**1
01151      END-EXEC.                                                       CL**1
01152                                                                      CL**1
01153      EXEC CICS                                                       CL**1
01154          FORMATTIME                                                  CL**1
01155              ABSTIME(ST-ABSTIME)                                     CL**1
01156              MMDDYY(ST-DATE-EDIT)                                    CL**1
01157              DATESEP                                                 CL**1
01158              TIME(ST-TIME-EDIT)                                      CL**1
01159              TIMESEP                                                 CL**1
01160      END-EXEC.                                                       CL**1
01161                                                                      CL**1
01162      MOVE ST-DATE-EDIT TO ADATEO.                                    CL**1
01163      MOVE ST-TIME-HHMM TO ATIMEO.                                    CL**1
01164      MOVE EIBTRMID TO ATERMO.                                        CL**1
01165 *9000-EXIT.        EXIT.                                             CL**1
01166                                                                      CL**1
01167                                                                      CL**1
01168 ******************************************************************   CL**1
01169 *  SEND MAP AND RETURN TO MENU.                                  *   CL**1
01170 ******************************************************************   CL**1
01171                                                                      CL**1
01172  9100-RETURN-MAIN-MENU.                                              CL**1
01173                                                                      CL**1
01174      IF CA-UPDATE-COMPLETE                                           CL**1
01175          CONTINUE                                                    CL**1
01176      ELSE                                                            CL**1
01177        IF CA-VALID-STATUS                                            CL**1
01178            PERFORM 9600-BACKOUT-CHKPT-STATUS                         CL**1
01179        END-IF                                                        CL**1
01180      END-IF.                                                         CL**1
01181                                                                      CL**1
01182      EXEC CICS                                                       CL**1
01183          XCTL                                                        CL**1
01184              PROGRAM(PC-MAIN-MENU)                                   CL**1
01185      END-EXEC.                                                       CL**1
01186 *9100-EXIT.        EXIT.                                             CL**1
01187                                                                      CL**1
01188                                                                      CL**1
01189 ******************************************************************   CL**1
01190 *  RECEIVE THE MAP AND TRANSFER CONTROL TO INQUIRY PROGRAM.      *   CL**1
01191 ******************************************************************   CL**1
01192                                                                      CL**1
01193  9200-TRANS-TO-INQUIRY.                                              CL**1
01194                                                                      CL**1
01195      EXEC CICS                                                       CL**1
01196          HANDLE CONDITION                                            CL**1
01197              MAPFAIL(1000-INITIALIZE)                                CL**1
01198      END-EXEC.                                                       CL**1
01199                                                                      CL**1
01200      EXEC CICS                                                       CL**1
01201          RECEIVE                                                     CL**1
01202              MAP('DP004A')                                           CL**1
01203              MAPSET('DPKM004')                                       CL**1
01204      END-EXEC.                                                       CL**1
01205                                                                      CL**1
01206      IF CA-UPDATE-COMPLETE                                           CL**1
01207          CONTINUE                                                    CL**1
01208      ELSE                                                            CL**1
01209        IF CA-VALID-STATUS                                            CL**1
01210            PERFORM 9600-BACKOUT-CHKPT-STATUS                         CL**1
01211        END-IF                                                        CL**1
01212      END-IF.                                                         CL**1
01213                                                                      CL**1
01214      MOVE 'DPKCS005' TO PT-TRANSFER-PROGRAM.                         CL**1
01215      MOVE PC-TRANS-DPKCS005-LENGTH TO PT-TRANSFER-LENGTH.            CL**1
01216                                                                      CL**1
01217      SET CA-PROCESS-SCREEN TO TRUE.                                  CL**1
01218      MOVE 'DPKCS004' TO CA-LAST-PROGRAM.                             CL**1
01219      MOVE AJOBNMEI TO CA-JOB-NAME.                                   CL**1
01220      MOVE APLNNMEI TO CA-PLAN-NAME.                                  CL**1
01221                                                                      CL**1
01222      EXEC CICS                                                       CL**1
01223          SYNCPOINT                                                   CL**1
01224      END-EXEC.                                                       CL**1
01225                                                                      CL**1
01226      EXEC CICS                                                       CL**1
01227          XCTL                                                        CL**1
01228              PROGRAM(PT-TRANSFER-PROGRAM)                            CL**1
01229              COMMAREA(CA-COMMON-AREA)                                CL**1
01230              LENGTH(PT-TRANSFER-LENGTH)                              CL**1
01231      END-EXEC.                                                       CL**1
01232 *9200-EXIT.        EXIT.                                             CL**1
01233                                                                      CL**1
01234                                                                      CL**1
01235 ******************************************************************   CL**1
01236 *    DB2 SQL WARNING AND SQL ERROR PARAGRAPHS                        CL**1
01237 ******************************************************************   CL**1
01238  9300-SQL-ERROR.                                                     CL**1
01239                                                                      CL**1
01240 **********                                                           CL**1
01241 *    -911 IS NOT EVALUATED BECAUSE IT IS NOT POSSIBLE.  IT IS        CL**1
01242 *         EITHER A -913 OR -911 DEPENDING ON HOW DB2 WAS             CL**1
01243 *         INITIALLY INSTALLED.  AT KOHLS -911 DOES NOT APPLY         CL**1
01244 *         TO CICS PROGRAMS.                                          CL**1
01245 *********                                                            CL**1
01246                                                                      CL**1
01247      EVALUATE SQLCODE                                                CL**1
01248                                                                      CL**1
01249          WHEN -904                                                   CL**1
01250               MOVE DM-RESOURCE-UNAVAIL-MSG TO DM-ERROR-MSG           CL**1
01251          WHEN -913                                                   CL**1
01252               MOVE DM-DEADLOCK-TIMEOUT-MSG TO DM-ERROR-MSG           CL**1
01253          WHEN -922                                                   CL**1
01254               MOVE DM-NOT-AUTHORIZED-MSG  TO DM-ERROR-MSG            CL**1
01255          WHEN -923                                                   CL**1
01256               MOVE DM-NOT-CONNECTED-MSG TO DM-ERROR-MSG              CL**1
01257          WHEN ANY                                                    CL**1
01258               MOVE DM-OTHER-DB2-ERROR-MSG  TO DM-ERROR-MSG           CL**1
01259      END-EVALUATE.                                                   CL**1
01260                                                                      CL**1
01261      MOVE SQLCODE TO DM-SQLCODE.                                     CL**1
01262      MOVE SQLERRD(3) TO DM-ROWS-ERR-PROCESSED.                       CL**1
01263      MOVE SQLERRML   TO DM-SQLERRML.                                 CL**1
01264      MOVE SQLERRMC   TO DM-SQLERRMC.                                 CL**1
01265                                                                      CL**1
01266      EXEC CICS                                                       CL**1
01267          SYNCPOINT ROLLBACK                                          CL**1
01268      END-EXEC                                                        CL**1
01269                                                                      CL**1
01270      EXEC CICS                                                       CL**1
01271          SEND                                                        CL**1
01272          FROM(DM-DB2-ERROR-MSG)                                      CL**1
01273          LENGTH(PC-DB2-ERROR-LENGTH)                                 CL**1
01274          ERASE                                                       CL**1
01275      END-EXEC.                                                       CL**1
01276                                                                      CL**1
01277      EXEC CICS                                                       CL**1
01278          RETURN                                                      CL**1
01279      END-EXEC.                                                       CL**1
01280                                                                      CL**1
01281 ******************************************************************   CL**1
01282 *  EXIT THE CHECK AUTH SYSTEM, DISPLAYING A FORMATTED DB2        *   CL**1
01283 *  WARNING MESSAGE.                                              *   CL**1
01284 ******************************************************************   CL**1
01285                                                                      CL**1
01286  9400-SQL-WARNING.                                                   CL**1
01287                                                                      CL**1
01288      MOVE SQLCODE TO DM-SQLCODE1.                                    CL**1
01289      MOVE SQLWARN TO DM-SQLWARN.                                     CL**1
01290      MOVE SQLERRD(3) TO DM-ROWS-WRN-PROCESSED.                       CL**1
01291                                                                      CL**1
01292      EXEC CICS                                                       CL**1
01293          SYNCPOINT ROLLBACK                                          CL**1
01294      END-EXEC.                                                       CL**1
01295                                                                      CL**1
01296      EXEC CICS                                                       CL**1
01297          SEND                                                        CL**1
01298          FROM(DM-DB2-WARNING-MSG)                                    CL**1
01299          LENGTH(PC-DB2-WARNING-LENGTH)                               CL**1
01300          ERASE                                                       CL**1
01301      END-EXEC.                                                       CL**1
01302                                                                      CL**1
01303      EXEC CICS                                                       CL**1
01304          RETURN                                                      CL**1
01305      END-EXEC.                                                       CL**1
01306 *9400-EXIT.        EXIT.                                             CL**1
01307                                                                      CL**1
01308                                                                      CL**1
01309 ******************************************************************   CL**1
01310 *  SEND MAP AND RETURN TO PROGRAM.                               *   CL**1
01311 ******************************************************************   CL**1
01312                                                                      CL**1
01313  9500-SEND-AND-RETURN.                                               CL**1
01314      MOVE PM-PROGRAM-MESSAGE (PM-MESSAGE-INDEX) TO AMSGO.            CL**1
01315      IF PS-NO-EDIT-ERROR                                             CL**1
01316        IF CA-CHANGE-REQUEST                                          CL**1
01317          MOVE PROT-SKIP-MDT TO AJOBNMEA                              CL**1
01318                                APLNNMEA                              CL**1
01319                                AACTIONA                              CL**1
01320          MOVE -1 TO ACONTRLL                                         CL**1
01321        ELSE                                                          CL**1
01322          MOVE -1 TO AACTIONL                                         CL**1
01323        END-IF                                                        CL**1
01324      END-IF.                                                         CL**1
01325                                                                      CL**1
01326      EXEC CICS                                                       CL**1
01327          SEND                                                        CL**1
01328              MAP('DP004A')                                           CL**1
01329              MAPSET('DPKM004')                                       CL**1
01330              FREEKB                                                  CL**1
01331              CURSOR                                                  CL**1
01332              FORMFEED                                                CL**1
01333      END-EXEC.                                                       CL**1
01334                                                                      CL**1
01335      EXEC CICS                                                       CL**1
01336          RETURN                                                      CL**1
01337              TRANSID('Z004')                                         CL**1
01338              COMMAREA(CA-COMMON-AREA)                                CL**1
01339              LENGTH(PC-COMMON-AREA-LENGTH)                           CL**1
01340      END-EXEC.                                                       CL**1
01341 *9500-EXIT.        EXIT.                                             CL**1
01342                                                                      CL**1
01343                                                                      CL**1
01344 ******************************************************************   CL**1
01345 *  DUE TO THE CHECKPOINT STATUS CODE BEING SET TO "9", IT MUST   *   CL**1
01346 *  BE ALLOWED TO BACKOUT THE "9", IF THE USER TRIES TO EXIT      *   CL**1
01347 *  THE PROGRAM BEFORE THE UPDATE IS COMMITTED.                   *   CL**1
01348 ******************************************************************   CL**1
01349                                                                      CL**1
01350  9600-BACKOUT-CHKPT-STATUS.                                          CL**1
01351                                                                      CL**1
01352      PERFORM VARYING PW-RETRY-COUNT FROM 1 BY 1                      CL**1
01353          UNTIL PW-RETRY-COUNT > PC-MAX-RETRY                         CL**1
01354                                                                      CL**1
01355        EXEC SQL                                                      CL**1
01356            UPDATE TCKRSTCNTL                                         CL**1
01357            SET    CKPT_STAT_CODE = :CA-BEFORE-STATUS                 CL**1
01358            WHERE  JOB_NAME  = :CA-JOB-NAME                           CL**1
01359              AND  PLAN_NAME = :CA-PLAN-NAME                          CL**1
01360        END-EXEC                                                      CL**1
01361                                                                      CL**1
01362        EVALUATE TRUE                                                 CL**1
01363            WHEN SQLCODE = -913                                       CL**1
01364            WHEN SQLCODE = -904                                       CL**1
01365                CONTINUE                                              CL**1
01366            WHEN SQLCODE < 0                                          CL**1
01367                SET PV-UPDATE-JOB-PLAN-STATUS TO TRUE                 CL**1
01368                PERFORM 9300-SQL-ERROR                                CL**1
01369            WHEN SQLWARN0 = 'W'                                       CL**1
01370            WHEN SQLCODE > 0                                          CL**1
01371                SET PV-UPDATE-JOB-PLAN-STATUS TO TRUE                 CL**1
01372                PERFORM 9400-SQL-WARNING                              CL**1
01373            WHEN SQLCODE = 0                                          CL**1
01374                MOVE PC-MORE-THAN-MAX-RETRY TO PW-RETRY-COUNT         CL**1
01375        END-EVALUATE                                                  CL**1
01376                                                                      CL**1
01377      END-PERFORM.                                                    CL**1
01378 *9600-EXIT.        EXIT.                                             CL**1
01379                                                                      CL**1
01380                                                                      CL**1
