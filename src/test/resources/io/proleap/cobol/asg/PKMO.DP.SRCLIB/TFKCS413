      ******************************************************************00010000
      *   CHECK TO SEE IF THIS TRANSACTION WAS TRIGGERED BY THE MQ      00020000
      *   LISTENER.  IF SO, WRITE MESSAGE TO REMOTE QUEUE INSTEAD OF    00030000
      *   TEMPORARY STORAGE QUEUE.                                      00040000
      ******************************************************************00050000
       IDENTIFICATION DIVISION.                                         00060000
      ******************************************************************00070000
                                                                        00080000
       PROGRAM-ID.       TFKCS413.                                      00090000
       AUTHOR.           WILLIAM B. BURT.                               00100000
       INSTALLATION.     KOHLS.                                         00110000
       DATE-WRITTEN      AUGUST, 1996.                                  00120000
       DATE-COMPILED.                                                   00130000
                                                                        00140000
      ******************************************************************00150000
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160000
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170000
      * IS A REQUEST TO POST RECEIPT INFORMATION FOR A PARTICULAR TRANS-00180000
      * FER.  THE TRANSMIT DATA IS THE RESPONSE TO THAT REQUEST.        00190000
      ******************************************************************00200000
      *  DATE 01/15/01                                                  00210000
      *  ADD CODE FOR 2ND LISTNER                                       00220000
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230000
      ******************************************************************00240000
      *  1/20/2003 - RAY GRAF                                           00241000
      *   PROCESS NONINTELLIGENT SKU.                                   00242000
      ******************************************************************00243000
      * 11/28/2003 - DAVE WELLER          WR/IR #: 25501                00244000
      *   MOS AND RTV DEF/DAMAGE TRANSFERS                              00245000
      ******************************************************************00246000
      * 10/14/2004 - DAVE WELLER          WR/IR #: 27349                00247000
      *   STORE EXPANSION                                               00248000
      ******************************************************************00249000
021605* 02/16/2005 - DAVE WELLER          WR/IR #: 27349                00249100
021605*   STANDARDIZE USAGE OF TFWS007                                  00249200
021605******************************************************************00249300
SR3403* 03/15/2012 - ANUJ GUPTA          WR/IR #: 3403                  00249400
SR3403*   LARGE RETAIL EXPANSION                                        00249500
SR3403******************************************************************00249600
      * 02/14/2023 - JEAN KURK           WR/IR #: CHG0281369            00249799
      *   REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE                   00249899
      ******************************************************************00249999
                                                                        00250000
      ******************************************************************00250100
       ENVIRONMENT DIVISION.                                            00250200
      ******************************************************************00251000
                                                                        00260000
      ******************************************************************00270000
       DATA DIVISION.                                                   00280000
      ******************************************************************00290000
                                                                        00300000
      ******************************************************************00310000
       WORKING-STORAGE SECTION.                                         00320000
      ******************************************************************00330000
                                                                        00340000
      *                                                                 00350000
      *  LISTENER QUEUE NAMES                                           00360000
      *                                                                 00370000
           COPY RFWS001.                                                00380000
                                                                        00390000
      *                                                                 00400000
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00410000
      *                                                                 00420000
           COPY TFRD021.                                                00430000
                                                                        00440000
      *                                                                 00450000
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00460000
      *                                                                 00470000
           COPY TFRD022.                                                00480000
                                                                        00490000
      *                                                                 00500000
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00510000
      *                                                                 00520000
           COPY DPWS013.                                                00530000
                                                                        00540000
      *                                                                 00600000
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00610000
      *                                                                 00620000
           COPY DPRD507I.                                               00630000
                                                                        00640000
      *                                                                 00650000
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00660000
      *                                                                 00670000
           COPY DPWS011.                                                00680000
                                                                        00690000
      *                                                                 00700000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER RECEIPT   00710000
      *  TABLE                                                          00720000
      *                                                                 00730000
           EXEC SQL                                                     00740000
               INCLUDE TTFRCPT                                          00750000
           END-EXEC.                                                    00760000
                                                                        00770000
      *                                                                 00780000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TABLE     00790000
      *                                                                 00800000
           EXEC SQL                                                     00810000
               INCLUDE TTFMSTR                                          00820000
           END-EXEC.                                                    00830000
                                                                        00840000
      *                                                                 00850000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PERMANENT PRICE    00860000
      *  CHANGE HISTORY TABLE                                           00870000
      *                                                                 00880000
           EXEC SQL                                                     00890000
               INCLUDE TPPCPRC                                          00900000
           END-EXEC.                                                    00910000
                                                                        00920000
      *                                                                 00930000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE00940000
      *                                                                 00950000
           EXEC SQL                                                     00960000
               INCLUDE TTFITEM                                          00970000
           END-EXEC.                                                    00980000
                                                                        00990000
      *                                                                 01000000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM      01010000
      *  RECEIPT TABLE                                                  01020000
      *                                                                 01030000
           EXEC SQL                                                     01040000
               INCLUDE TTFITRC                                          01050000
           END-EXEC.                                                    01060000
                                                                        01070000
      *                                                                 01080000
      * XS DOMAIN TABLES                                                01090000
      *                                                                 01100000
           EXEC SQL                                                     01101000
               INCLUDE XST00008                                         01102000
           END-EXEC.                                                    01103000
           EXEC SQL                                                     01104000
               INCLUDE XST00010                                         01105000
           END-EXEC.                                                    01106000
           EXEC SQL                                                     01107000
               INCLUDE XST00012                                         01108000
           END-EXEC.                                                    01109000
           EXEC SQL                                                     01109100
               INCLUDE XST00013                                         01109200
           END-EXEC.                                                    01109300
      *                                                                 01109400
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TO SKU         01109500
      *  RELATIONSHIP TABLE                                             01109600
      *                                                                 01109700
101404*    EXEC SQL                                                     01109800
101404*        INCLUDE TUPCSKU                                          01109900
101404*    END-EXEC.                                                    01110000
                                                                        01120000
      *                                                                 01130000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC PHYSICAL       01140000
      *  LOCATION TABLE                                                 01150000
      *                                                                 01160000
101404*    EXEC SQL                                                     01170000
101404*        INCLUDE TUPCPLS                                          01180000
101404*    END-EXEC.                                                    01190000
                                                                        01200000
      *                                                                 01210000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC TABLE          01220000
      *                                                                 01230000
101404*    EXEC SQL                                                     01240000
101404*        INCLUDE TUPC                                             01250000
101404*    END-EXEC.                                                    01260000
                                                                        01261000
      *                                                                 01262000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SKU TABLE          01263000
      *                                                                 01264000
101404*    EXEC SQL                                                     01265000
101404*        INCLUDE TSK                                              01266000
101404*    END-EXEC.                                                    01267000
                                                                        01268000
      *                                                                 01269000
      *  SKU CROSS REFERENCE TABLE                                      01270000
      *                                                                 01280000
           EXEC SQL                                                     01290000
               INCLUDE TSKXREF                                          01300000
           END-EXEC.                                                    01310000
                                                                        01320000
      *                                                                 01330000
      *  COMMUNICATIONS AREA FOR DB2                                    01340000
      *                                                                 01350000
           EXEC SQL                                                     01360000
               INCLUDE SQLCA                                            01370000
           END-EXEC.                                                    01380000
                                                                        01390000
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          01400000
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          01410000
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           01420000
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           01430000
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          01440000
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01450000
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01460000
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01470000
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01480000
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01490000
                                                                        01500000
      *    API CONTROL BLOCKS                                           01510000
                                                                        01520000
       01  MQM-OBJECT-DESCRIPTOR.                                       01530000
           COPY CMQODV.                                                 01540000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01550000
           COPY CMQMDV.                                                 01560000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01570000
           COPY CMQGMOV.                                                01580000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01590000
           COPY CMQPMOV.                                                01600000
                                                                        01610000
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01620000
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01630000
                                                                        01640000
       01  MQM-CONSTANTS.                                               01650000
           COPY CMQV.                                                   01660000
      *                                                                 01670000
      **---------------------------------------------------------------*01680000
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01690000
      **  (EPPD000)                                                    *01700000
      **---------------------------------------------------------------*01710000
                                                                        01720000
           COPY EPWS000.                                                01730000
021605     COPY TFWS007.                                                01740000
                                                                        01750000
      *                                                                 01760000
       01  DK-DB2-KEYS.                                                 01770000
           05  DK-UPC-NBR                      PIC S9(15)  VALUE ZEROS  01780000
                                                           COMP-3.      01790000
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  01800000
                                                           COMP SYNC.   01810000
SR3403     05  DK-XFER-PRIC-AMT                PIC S9(07)V9(02)         01820000
SR3403                                                     VALUE ZEROS  01830000
SR3403                                                     COMP-3.      01840000
SR3403     05  DK-CPLD-RTL-PRIC-AMT            PIC S9(07)V9(02)         01850000
SR3403                                                     VALUE ZEROS  01860000
SR3403                                                     COMP-3.      01870000
SR3403     05  DK-RCVD-XFER-PRIC-AMT           PIC S9(07)V9(02)         01880000
SR3403                                                     VALUE ZEROS  01890000
SR3403                                                     COMP-3.      01900000
           05  DK-STR-NBR                      PIC S9(04)  VALUE ZEROS  01910000
                                                           COMP.        01920000
           05  DK-SELECT-LOC-NBR               PIC S9(04)  VALUE ZEROS  01921000
                                                           COMP.        01922000
      *                                                                 01923000
       01  PC-PROGRAM-CONSTANTS.                                        01924000
           05  PC-CLEARANCE-STATUS             PIC  9(02)  VALUE 30.    01925000
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   01926000
           05  PC-YES                          PIC  X(01)  VALUE 'Y'.   01927000
021605*    COPY TFWS007                                                 01928000
           05  PC-MULTIPLE-ROWS-FOUND          PIC S9(04)  VALUE -811   01929000
                                                           COMP SYNC.   01930000
           05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   01940000
                                                           COMP SYNC.   01950000
           05  PC-ZERO                         PIC S9(04)  VALUE +0     01960000
                                                           COMP SYNC.   01970000
           05  PC-ONE                          PIC  9(01)  VALUE 1.     01980000
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01990000
               'TFKCS413'.                                              02000000
           05  PC-RED-TICKET                   PIC  X(14)  VALUE        02010000
               '   RED TICKET'.                                         02020000
           05  PC-YELLOW-TICKET                PIC  X(14)  VALUE        02030000
               'YELLOW TICKET'.                                         02040000
           05  PC-WHITE-TICKET                 PIC  X(14)  VALUE        02050000
               ' WHITE TICKET'.                                         02060000
                                                                        02070000
           05  PC-TSYMSG-NUMBERS.                                       02080000
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                02090000
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.02100000
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           02110000
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.02120000
      *  UNDO INVALID.  ITEM NOT FOUND.                                 02130000
               10  PC-TSYMSG-01448             PIC  9(05)  VALUE  01448.02140000
      *  ITEM HAS NEW PRICE OF &VAR;  COMPLETE AN INSTORE PRICE CHANGE  02150000
               10  PC-TSYMSG-01460             PIC  9(05)  VALUE  01460.02160000
      *  THIS ITEM IS IN CLEARANCE STATUS; COMPLETE AS IN-STORE PRICE   02170000
      *  CHANGE                                                         02180000
               10  PC-TSYMSG-01461             PIC  9(05)  VALUE  01461.02190000
      *  GROUP PRICE ITEM OWNED AT &VAR.  NO DISCREPANCY                02200000
               10  PC-TSYMSG-01549             PIC  9(05)  VALUE  01549.02210000
      *  THIS ITEM HAS A NEW PRICE.  RETICKET ONLY                      02220000
               10  PC-TSYMSG-01556             PIC  9(05)  VALUE  01556.02230000
      *  THIS IS A CLEARANCE ITEM.  RETICKET ONLY                       02240000
               10  PC-TSYMSG-01557             PIC  9(05)  VALUE  01557.02250000
      *  TRANSFER &VAR HAS BEEN RESET                                   02260000
               10  PC-TSYMSG-01582             PIC  9(05)  VALUE  01582.02270000
      *  ITEM HAS NEW PRICE OF &VAR;  RETICKET ONLY                     02280000
               10  PC-TSYMSG-01789             PIC  9(05)  VALUE  01789.02290000
      *  REGIONAL CLEARANCE ITEM HAS NEW PRICE OF &VAR; RETICKET ONLY.  02300000
               10  PC-TSYMSG-02123             PIC  9(05)  VALUE  02123.02310000
      * RCP- ITEM HAS NEW PRICE OF &VAR; COMPLETE AN IN-STORE PRICE CHG.02320000
               10  PC-TSYMSG-02124             PIC  9(05)  VALUE  02124.02330000
                                                                        02340000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   02350000
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          02360000
           05  PH-REASON                   PIC  S9(09) BINARY.          02370000
      *                                                                 02380000
       01  PS-PROGRAM-SWITCHES.                                         02390000
           05  PS-PRICE-ENTRY-IND              PIC  X(01)  VALUE 'N'.   02400000
               88  PS-GROUP-PRICE-ENTERED                  VALUE 'N'.   02410000
               88  PS-EACH-PRICE-ENTERED                   VALUE 'Y'.   02420000
           05  PS-REGN-CLR-FOUND-SW            PIC  X(01)  VALUE 'N'.   02430000
               88  PS-REGN-CLR-FOUND                       VALUE 'Y'.   02440000
               88  PS-REGN-CLR-NOT-FOUND                   VALUE 'N'.   02450000
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   02460000
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   02470000
      *                                                                 02480000
       01  PV-PROGRAM-VARIABLES.                                        02490000
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          02500000
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          02510000
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          02520000
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          02530000
           05  PV-QM-NAME              PIC X(48).                       02540000
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        02550000
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        02560000
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        02570000
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        02580000
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        02590000
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        02600000
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        02610000
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02620000
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02630000
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02640000
                                                                        02650000
           05  PV-NEW-XFER-LNE-NBR             PIC  9(03)  VALUE ZEROS. 02660000
           05  PV-NEW-XFER-LNE-SEQ-NBR         PIC  9(03)  VALUE ZEROS. 02670000
           05  PV-RECEIVED-QTY                 PIC S9(03)  VALUE ZEROS. 02680000
           05  PV-DISPLAY-DELETE-AREA.                                  02690000
               10  PV-DISPLAY-DELETE-DKEY-ID   PIC  9(09)  VALUE ZEROS. 02700000
               10  PV-DISPLAY-DELETE-LNE-NBR   PIC  9(04)  VALUE ZEROS. 02710000
           05  PV-DISPLAY-INTR-UPC-ID          PIC  9(09)  VALUE ZEROS. 02720000
           05  PV-DISPLAY-ITM-NBR              PIC  9(15)  VALUE ZEROS. 02730000
           05  PV-DISPLAY-UPC-NBR              PIC  9(13)  VALUE ZEROS. 02740000
           05  PV-DISPLAY-XFER-LNE-NBR         PIC  9(04)  VALUE ZEROS. 02750000
           05  PV-DISPLAY-XFER-LNE-SEQ-NBR     PIC  9(04)  VALUE ZEROS. 02760000
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 02770000
SR3403     05  PV-DISPLAY-XFER-PRIC-AMT        PIC  9(07).9(02)         02780000
SR3403                                                     VALUE ZEROS. 02790000
SR3403     05  PV-DISPLAY-CPLD-RTL-PRIC-AMT    PIC  9(07).9(02)         02800000
SR3403                                                     VALUE ZEROS. 02810000
           05  PV-GP-RTL-QTY-NULL-IND          PIC S9(04)  VALUE +0     02820000
                                                           COMP SYNC.   02830000
           05  PV-GP-RTL-AMT-NULL-IND          PIC S9(04)  VALUE +0     02840000
                                                           COMP SYNC.   02850000
           05  PV-DISPLAY-XFER-DOC-NBR-X.                               02860000
101404         10  PV-DISPLAY-FR-STR-NBR       PIC  9(05)  VALUE ZEROS. 02870000
               10  FILLER                      PIC  X(01)  VALUE '-'.   02880000
               10  PV-DISPLAY-XFER-SEQ-NBR     PIC  9(06)  VALUE ZEROS. 02890000
           05  PV-INTERNAL-UPC-NBR             PIC S9(15)  COMP-3       02900000
                                                           VALUE ZEROS. 02910000
           05  PV-KOHLS-INTERNAL-UPC-NBR       PIC  9(15)  VALUE ZEROS. 02920000
           05  PV-KOHLS-INTERNAL-UPC-NBR-X  REDEFINES                   02930000
                   PV-KOHLS-INTERNAL-UPC-NBR.                           02940000
               10  FILLER                      PIC  X(06).              02950000
               10  FILLER                      PIC  X(03).              02960000
               10  FILLER                      PIC  X(02).              02970000
               10  FILLER                      PIC  X(03).              02980000
               10  FILLER                      PIC  X(01).              02990000
           05  PV-XFER-LNE-NBR                 PIC S9(04)  VALUE ZEROS  03000000
                                                           COMP SYNC.   03010000
           05  PV-XFER-LNE-SEQ-NBR             PIC S9(04)  VALUE ZEROS  03020000
                                                           COMP SYNC.   03030000
           05  PV-DB2-NULL-IND                 PIC S9(04)  VALUE ZEROS  03040000
                                                           COMP SYNC.   03050000
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  03060000
                                                           COMP SYNC.   03070000
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  03080000
                                                           COMP SYNC.   03090000
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.03100000
                                                                        03110000
           05  PV-TCPIPPRQ-RECORD1.                                     03120000
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 03130000
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 03140000
               10  FILLER                      PIC X(4104) VALUE SPACE. 03150000
           05  PV-TCPIPPRQ-RECORD2.                                     03160000
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 03170000
               10  FILLER                      PIC X(4112) VALUE SPACE. 03180000
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  03190000
                                                           COMP SYNC.   03200000
           05  PV-SIGN-IND                     PIC  X(01)  VALUE SPACE. 03210000
               88  PV-NEGATIVE                             VALUE '-'.   03220000
               88  PV-POSITIVE                             VALUE '+'.   03230000
           05  PV-RTL-PRICE-X.                                          03240000
SR3403         10  PV-RTL-PRICE-MASK           PIC Z,ZZZ,ZZZ.99         03250000
                                                           VALUE ZEROS. 03260000
SR3403     05  PV-XFER-PRIC-AMT                PIC S9(07)V9(02)         03270000
SR3403                                                     VALUE ZEROS  03280000
SR3403                                                     COMP-3.      03290000
SR3403     05  PV-DIVIDED-PRICE                PIC  S9(07)V9(02)        03300000
SR3403                                                     VALUE ZEROS. 03310000
SR3403     05  PV-KEYED-PRICE                  PIC  9(07)V9(02)         03320000
SR3403                                                     VALUE ZEROS. 03330000
SR3403     05  PV-SAV-CPLD-RTL-PRIC-AMT        PIC  S9(7)V9(2) COMP-3   03340000
SR3403                                                     VALUE ZEROS. 03350000
SR3403     05  PV-SAV-XFER-PRIC-AMT            PIC  S9(7)V9(2) COMP-3   03360000
SR3403                                                     VALUE ZEROS. 03370000
           05  PV-CUR-RTL-AMT                  PIC S9(7)V9(2) COMP-3.   03380000
           05  PV-GP-RTL-AMT                   PIC S9(7)V9(2) COMP-3.   03390000
           05  PV-GP-QTY                       PIC S9(3)V COMP-3.       03400000
           05  PV-MESSAGE.                                              03410000
               10  PV-MSG-COLOR                PIC X(14)   VALUE SPACES.03420000
               10  FILLER                      PIC X(14)   VALUE        03430000
                   'PRICE MUST BE'.                                     03440000
SR3403         10  PV-MSG-PRICE                PIC ZZZZZZZ.99           03450000
SR3403                                             VALUE ZEROS.         03460000
           05  PV-STATUS-CODE.                                          03470000
               10  FILLER                      PIC X(1)    VALUE '0'.   03480000
               10  PV-LOC-SKU-STAT-CDE         PIC X(2)    VALUE '00'.  03490000
           05  PV-STATUS-CODE-N  REDEFINES  PV-STATUS-CODE              03500000
                                               PIC 9(3).                03510000
           05  PV-STATUS-CDE                   PIC S9(3)   COMP-3       03520000
                                                           VALUE +0.    03530000
      *                                                                 03540000
      ******************************************************************03550000
       PROCEDURE DIVISION.                                              03560000
      ******************************************************************03570000
       0000-PROGRAM-MAINLINE.                                           03580000
           INITIALIZE TF022-XFER-TO-PTC-RECORD.                         03590000
                                                                        03600000
           PERFORM 1000-RETRIEVE-TEXT.                                  03610000
                                                                        03620000
           PERFORM 2000-PROCESS-PTC-REQUEST.                            03630000
                                                                        03640000
           GOBACK.                                                      03650000
      *                                                                 03660000
       1000-RETRIEVE-TEXT.                                              03670000
           EXEC CICS                                                    03680000
               RETRIEVE                                                 03690000
                   INTO  (TF021-XFER-FROM-PTC-RECORD)                   03700000
                   RESP  (PV-CICS-RESPONSE)                             03710000
           END-EXEC.                                                    03720000
                                                                        03730000
           EVALUATE TRUE                                                03740000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03750000
                   CONTINUE                                             03760000
               WHEN OTHER                                               03770000
                   MOVE '1000-RETRIEVE-TEXT'                            03780000
                                   TO DP013-PARAGRAPH                   03790000
                   MOVE 'UNABLE TO RECEIVE TEXT'                        03800000
                                   TO DP013-MESSAGE-TEXT (1)            03810000
                   MOVE  TF021-XFER-FROM-PTC-RECORD                     03820000
                                   TO DP013-MESSAGE-TEXT (2)            03830000
                   SET DP013-CICS-ABEND                                 03840000
                       DP013-NO-ROLLBACK                                03850000
                                   TO TRUE                              03860000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      03870000
                   SET  DP011-MSG-FATAL                                 03880000
                                   TO TRUE                              03890000
                   MOVE PC-TSYMSG-01064                                 03900000
                                   TO DP011-MSG-NUMBER                  03910000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      03920000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   03930000
           END-EVALUATE.                                                03940000
                                                                        03950000
                                                                        03960000
           MOVE TF021-LISTENER-CODE                                     03970000
                                   TO PV-QUEUE-PARM.                    03971000
                                                                        03972000
           IF  PV-VALID-PARM                                            03973000
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03974000
                                   TO PV-TSQ-NAME                       03975000
                                                                        03976000
           ELSE                                                         03977000
               MOVE '1000-RETRIEVE-TEXT'                                03978000
                                   TO DP013-PARAGRAPH                   03979000
               MOVE 'INVALID PARM VALUE'                                03980000
                                   TO DP013-MESSAGE-TEXT (1)            03990000
               MOVE 'PARM VALUE = '                                     04000000
                                   TO DP013-MESSAGE-TEXT (2)            04010000
               MOVE TF021-LISTENER-CODE                                 04020000
                                   TO DP013-MESSAGE-TEXT (3)            04030000
                                                                        04040000
               SET DP013-LOGIC-ABEND                                    04050000
                   DP013-NO-ROLLBACK                                    04060000
                                   TO TRUE                              04070000
                                                                        04080000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          04090000
                                                                        04100000
               SET  DP011-MSG-FATAL                                     04110000
                                   TO TRUE                              04120000
                                                                        04130000
               MOVE PC-TSYMSG-01064                                     04140000
                                   TO DP011-MSG-NUMBER                  04150000
                                                                        04160000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04170000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       04180000
           END-IF.                                                      04190000
                                                                        04200000
                                                                        04210000
      ******************************************************************04220000
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 04230000
      ******************************************************************04240000
       2000-PROCESS-PTC-REQUEST.                                        04250000
                                                                        04260000
           PERFORM 7000-SELECT-MAX-RCPT-TMST.                           04270000
                                                                        04280000
           IF PV-DB2-NULL-IND NEGATIVE                                  04290000
               PERFORM 7850-SELECT-XFER                                 04300000
               MOVE TFMSTR-FR-STR-NBR                                   04310000
                                   TO PV-DISPLAY-FR-STR-NBR             04311000
               MOVE TFMSTR-XFER-SEQ-NBR                                 04312000
                                   TO PV-DISPLAY-XFER-SEQ-NBR           04313000
               MOVE PV-DISPLAY-XFER-DOC-NBR-X                           04314000
                                   TO DP011-MSG-TEXT                    04315000
               SET  DP011-MSG-FATAL                                     04316000
                    TF022-XFER-RESET                                    04317000
                                   TO TRUE                              04318000
               MOVE PC-TSYMSG-01582                                     04319000
                                   TO  DP011-MSG-NUMBER                 04320000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          04330000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       04340000
           ELSE                                                         04350000
               SET  TF022-XFER-NOT-RESET                                04360000
                                   TO TRUE                              04370000
           END-IF.                                                      04380000
                                                                        04390000
021605     IF TF021-XFER-TYP-CDE-X  =  TF007-NON-RETAIL                 04400000
               PERFORM 2100-UPDATE-NON-RETAIL-ITM                       04410000
           ELSE                                                         04420000
               PERFORM 2200-UPDATE-RETAIL-ITM                           04430000
           END-IF.                                                      04440000
                                                                        04450000
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          04460000
      *                                                                 04470000
       2100-UPDATE-NON-RETAIL-ITM.                                      04480000
           MOVE TF021-XFER-DKEY    TO  TFITRC-XFER-DKEY-ID.             04490000
                                                                        04500000
           PERFORM 7700-UPDATE-NON-RTL-ITM-RCPT                         04510000
               VARYING NON-RTL-IDX                                      04520000
               FROM    1 BY 1                                           04530000
               UNTIL   (NON-RTL-IDX > TF021-NBR-OF-OCCURS).             04540000
      *                                                                 04550000
       2200-UPDATE-RETAIL-ITM.                                          04560000
           MOVE TF021-SIGN-IND     TO  PV-SIGN-IND.                     04570000
           PERFORM 7850-SELECT-XFER.                                    04580000
                                                                        04590000
           MOVE TF021-UPC-NBR      TO  DK-UPC-NBR                       04600000
                                   TF022-UPC-NBR.                       04610000
           PERFORM 2210-PROCESS-BY-UPC.                                 04620000
      *                                                                 04630000
       2210-PROCESS-BY-UPC.                                             04640000
           MOVE +0                 TO DK-SELECT-LOC-NBR.                04650000
           PERFORM 7050-SELECT-UPC-SKU.                                 04660000
           EVALUATE  TF021-XFER-TYP-CDE-X                               04670000
021605         WHEN TF007-DEFECTIVES-DAMAGES-SORT1                      04680000
021605         WHEN TF007-DEFECTIVES-DAMAGES-SORT2                      04690000
021605         WHEN TF007-CALLBACK                                      04700000
                   IF XST00010-REGN-PRIC-IND = PC-YES                   04710000
                       MOVE TFMSTR-FR-STR-NBR                           04720000
                                   TO DK-SELECT-LOC-NBR                 04730000
                       PERFORM 7060-SELECT-SKU-LOC                      04740000
                   END-IF                                               04750000
021605         WHEN TF007-STOCK-BALANCE-CORPORATE                       04760000
021605         WHEN TF007-STOCK-BALANCE-STORE                           04770000
021605         WHEN TF007-CUSTOMER                                      04780000
021605         WHEN TF007-OFFSITE-STORAGE                               04790000
                   IF XST00010-REGN-PRIC-IND = PC-YES                   04800000
                       MOVE TF021-STR-NBR                               04810000
                                   TO DK-SELECT-LOC-NBR                 04820000
                       PERFORM 7060-SELECT-SKU-LOC                      04830000
                   END-IF                                               04840000
           END-EVALUATE.                                                04850000
                                                                        04860000
           EVALUATE  TF021-XFER-TYP-CDE-X                               04870000
021605         WHEN TF007-DEFECTIVES-DAMAGES-SORT1                      04880000
021605         WHEN TF007-DEFECTIVES-DAMAGES-SORT2                      04890000
021605         WHEN TF007-CALLBACK                                      04900000
                   PERFORM 7100-SELECT-ITM-BY-XFER-PRIC                 04910000
                   IF (SQLCODE  =  PC-ROW-NOT-FOUND                     04920000
                             AND                                        04930000
                       TF021-GP-PRICE-ITM-IND  =  PC-YES)               04940000
                       PERFORM 7125-SELECT-ITM-BY-FILE-PRIC             04950000
                   END-IF                                               04960000
021605         WHEN TF007-STOCK-BALANCE-CORPORATE                       04970000
021605         WHEN TF007-STOCK-BALANCE-STORE                           04980000
021605         WHEN TF007-CUSTOMER                                      04990000
021605         WHEN TF007-OFFSITE-STORAGE                               05000000
                   PERFORM 7150-SELECT-ITM-BY-ITMNBR                    05010000
           END-EVALUATE.                                                05020000
                                                                        05030000
           EVALUATE SQLCODE                                             05040000
               WHEN ZERO                                                05050000
               WHEN PC-MULTIPLE-ROWS-FOUND                              05060000
                   EVALUATE  TF021-XFER-TYP-CDE-X                       05070000
021605                 WHEN TF007-DEFECTIVES-DAMAGES-SORT1              05080000
021605                 WHEN TF007-DEFECTIVES-DAMAGES-SORT2              05090000
021605                 WHEN TF007-CALLBACK                              05100000
                           PERFORM 2212-XFER-ITM-FOUND                  05110000
021605                 WHEN TF007-STOCK-BALANCE-CORPORATE               05120000
021605                 WHEN TF007-STOCK-BALANCE-STORE                   05130000
021605                 WHEN TF007-CUSTOMER                              05140000
021605                 WHEN TF007-OFFSITE-STORAGE                       05150000
                           IF TF021-GP-PRICE-ITM-IND  =  PC-YES         05160000
                               COMPUTE  PV-KEYED-PRICE  =               05170000
                                   (TF021-TKT-PRICE  /  100)            05180000
                               IF PV-KEYED-PRICE = TFITEM-XFER-PRIC-AMT 05190000
                                   CONTINUE                             05200000
                               ELSE                                     05210000
                                   IF PV-KEYED-PRICE                    05220000
                                          = TFITEM-CPLD-RTL-PRIC-AMT    05230000
                                       COMPUTE TF021-TKT-PRICE  =       05240000
                                           (TFITEM-XFER-PRIC-AMT * 100) 05250000
                                       SET PS-EACH-PRICE-ENTERED        05260000
                                   TO TRUE                              05270000
                                   END-IF                               05280000
                               END-IF                                   05290000
                           END-IF                                       05300000
                           IF XST00008-LOC-SKU-STAT-CDE =               05310000
                                   PC-CLEARANCE-STATUS                  05320000
                               PERFORM 7100-SELECT-ITM-BY-XFER-PRIC     05330000
                                                                        05340000
                               EVALUATE SQLCODE                         05350000
                                   WHEN ZERO                            05360000
                                       PERFORM 2212-XFER-ITM-FOUND      05370000
                                   WHEN PC-ROW-NOT-FOUND                05380000
                                       PERFORM 2211-XFER-ITM-NOT-FOUND  05390000
                               END-EVALUATE                             05400000
                           ELSE                                         05410000
                               PERFORM 2212-XFER-ITM-FOUND              05420000
                           END-IF                                       05430000
                   END-EVALUATE                                         05440000
               WHEN PC-ROW-NOT-FOUND                                    05450000
                   PERFORM 2211-XFER-ITM-NOT-FOUND                      05460000
           END-EVALUATE.                                                05470000
      *                                                                 05480000
       2211-XFER-ITM-NOT-FOUND.                                         05490000
           IF PV-NEGATIVE                                               05500000
               SET DP011-MSG-FATAL TO TRUE                              05510000
               MOVE PC-TSYMSG-01448                                     05520000
                                   TO DP011-MSG-NUMBER                  05530000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          05540000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       05550000
           ELSE                                                         05560000
               PERFORM 7200-SELECT-MAX-LINE-NBR                         05570000
               PERFORM 3000-FIND-INTERNAL-UPC-NBR                       05580000
               MOVE PV-INTERNAL-UPC-NBR                                 05590000
                                   TO DK-UPC-NBR                        05600000
                                      PV-KOHLS-INTERNAL-UPC-NBR         05610000
               PERFORM 7250-INSERT-XFER-ITM                             05620000
               MOVE 1              TO  TFITRC-XFER-LNE-SEQ-NBR          05630000
               PERFORM 7350-INSERT-RTL-ITM-RCPT                         05640000
               PERFORM 2310-CHK-XFER-TYPE                               05650000
           END-IF.                                                      05660000
      *                                                                 05670000
       2212-XFER-ITM-FOUND.                                             05680000
           PERFORM 7400-SELECT-XFER-ITM-RCPT.                           05690000
           PERFORM 2300-PROCESS-XFER-ITM-RCPT.                          05700000
      *                                                                 05710000
       2300-PROCESS-XFER-ITM-RCPT.                                      05720000
           IF SQLCODE = PC-ROW-NOT-FOUND                                05730000
               IF PV-NEGATIVE                                           05740000
                   SET  DP011-MSG-FATAL                                 05750000
                                   TO TRUE                              05760000
                   MOVE PC-TSYMSG-01448                                 05770000
                                   TO DP011-MSG-NUMBER                  05780000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05790000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05800000
               ELSE                                                     05810000
                   PERFORM 7300-SELECT-MAX-LINE-SEQ-NBR                 05820000
                   MOVE PV-NEW-XFER-LNE-SEQ-NBR                         05830000
                                   TO  TFITRC-XFER-LNE-SEQ-NBR          05840000
                   PERFORM 7350-INSERT-RTL-ITM-RCPT                     05850000
                   PERFORM 2310-CHK-XFER-TYPE                           05860000
               END-IF                                                   05870000
           ELSE                                                         05880000
               IF PV-NEGATIVE                                           05890000
                   COMPUTE PV-RECEIVED-QTY =                            05900000
                       TFITRC-RCVD-XFER-QTY - TF021-RTL-RECEIVED-QTY    05910000
                                                                        05920000
                   IF PV-RECEIVED-QTY POSITIVE                          05930000
                       PERFORM 7500-UPDATE-RCVD-ITEM-QTY                05940000
                   ELSE                                                 05950000
                       IF TFITRC-XFER-LNE-SEQ-NBR  =  PC-ONE            05960000
                           PERFORM 7300-SELECT-MAX-LINE-SEQ-NBR         05970000
                           IF PV-XFER-LNE-SEQ-NBR  =  PC-ONE            05980000
                               PERFORM 7600-SELECT-XFER-ITEM            05990000
                               IF TFITEM-XFER-QTY  =  ZERO              06000000
                                   PERFORM 7550-DELETE-XFER-ITEM-RCPT   06010000
                                   PERFORM 7650-DELETE-XFER-ITEM        06020000
                               ELSE                                     06030000
                                   PERFORM 7800-UPDATE-RTL-ITM-RCPT     06040000
                               END-IF                                   06050000
                           ELSE                                         06060000
                               PERFORM 7800-UPDATE-RTL-ITM-RCPT         06070000
                           END-IF                                       06080000
                       ELSE                                             06090000
                           PERFORM 7550-DELETE-XFER-ITEM-RCPT           06100000
                       END-IF                                           06110000
                   END-IF                                               06120000
               ELSE                                                     06130000
                   COMPUTE PV-RECEIVED-QTY =                            06140000
                       TFITRC-RCVD-XFER-QTY + TF021-RTL-RECEIVED-QTY    06150000
                   PERFORM 7500-UPDATE-RCVD-ITEM-QTY                    06160000
                   PERFORM 2310-CHK-XFER-TYPE                           06170000
               END-IF                                                   06180000
           END-IF.                                                      06190000
      *                                                                 06200000
       2310-CHK-XFER-TYPE.                                              06210000
           EVALUATE  TF021-XFER-TYP-CDE-X                               06220000
021605         WHEN TF007-STOCK-BALANCE-CORPORATE                       06230000
021605         WHEN TF007-STOCK-BALANCE-STORE                           06240000
021605         WHEN TF007-CUSTOMER                                      06250000
                   IF XST00010-REGN-PRIC-IND NOT = PC-YES               06260000
                       PERFORM 2311-CHK-FOR-PRICE-CHANGE                06270000
                   ELSE                                                 06280000
                       PERFORM 2312-CHK-REGN-PRIC-CHANGE                06290000
                   END-IF                                               06300000
           END-EVALUATE.                                                06310000
      *                                                                 06320000
       2311-CHK-FOR-PRICE-CHANGE.                                       06330000
           IF XST00008-GP-RTL-QTY     >  PC-ONE              OR         06340000
              TF021-GP-PRICE-ITM-IND  =  PC-YES                         06350000
               PERFORM 7175-SELECT-XFER-PRICE                           06360000
           END-IF.                                                      06370000
                                                                        06380000
           IF XST00008-GP-RTL-QTY > PC-ONE                              06390000
               COMPUTE PV-DIVIDED-PRICE  =                              06400000
                   (XST00008-GP-RTL-AMT / XST00008-GP-RTL-QTY)          06410000
               IF (PV-XFER-PRIC-AMT  =  PV-SAV-XFER-PRIC-AMT            06420000
                         OR                                             06430000
                   PV-XFER-PRIC-AMT  =  PV-SAV-CPLD-RTL-PRIC-AMT        06440000
                         OR                                             06450000
                   PV-XFER-PRIC-AMT  =  PV-DIVIDED-PRICE                06460000
                         OR                                             06470000
                   PV-XFER-PRIC-AMT  =  XST00008-UNT-RTL-AMT)           06480000
                   IF (XST00008-UPC-STAT-CHG-DTE NOT =                  06490000
                           XST00008-UNT-RTL-CHG-DTE                     06500000
                               AND                                      06510000
                       PV-XFER-PRIC-AMT  =  PV-SAV-XFER-PRIC-AMT)       06520000
                       SET  DP011-MSG-WARNING                           06530000
                                   TO TRUE                              06540000
                       MOVE PC-TSYMSG-01556                             06550000
                                   TO DP011-MSG-NUMBER                  06560000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  06570000
                   ELSE                                                 06580000
                       IF (TF021-GP-PRICE-ITM-IND  =  PC-YES            06590000
                                 AND                                    06600000
                           PS-EACH-PRICE-ENTERED)                       06610000
                          MOVE PV-SAV-XFER-PRIC-AMT                     06620000
                                   TO PV-RTL-PRICE-MASK                 06630000
                          MOVE PV-RTL-PRICE-X                           06640000
                                   TO DP011-MSG-TEXT                    06650000
                          SET  DP011-MSG-WARNING                        06660000
                                   TO TRUE                              06670000
                          MOVE PC-TSYMSG-01549                          06680000
                                   TO DP011-MSG-NUMBER                  06690000
                          PERFORM 9000-FMT-ERR-MSG-TO-PTC               06700000
                       END-IF                                           06710000
                   END-IF                                               06720000
               ELSE                                                     06730000
                   IF XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE-STATUS   06740000
                       SET  DP011-MSG-WARNING                           06750000
                                   TO TRUE                              06760000
                       MOVE PC-TSYMSG-01557                             06770000
                                   TO DP011-MSG-NUMBER                  06780000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  06790000
                   ELSE                                                 06800000
                       SET  DP011-MSG-WARNING                           06810000
                                   TO TRUE                              06820000
                       MOVE PC-TSYMSG-01556                             06830000
                                   TO DP011-MSG-NUMBER                  06840000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  06850000
                   END-IF                                               06860000
               END-IF                                                   06870000
           ELSE                                                         06880000
               IF XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE-STATUS       06890000
                   IF XST00008-UPC-STAT-CHG-DTE NOT =                   06900000
                           XST00008-UNT-RTL-CHG-DTE                     06910000
                       PERFORM 7750-GET-CLR-ITM-1ST-MKDN-PRIC           06920000
                       IF TF021-GP-PRICE-ITM-IND  =  PC-YES             06930000
                         IF (PV-XFER-PRIC-AMT = PV-SAV-XFER-PRIC-AMT    06940000
                                   OR                                   06950000
                             PV-XFER-PRIC-AMT = PV-SAV-CPLD-RTL-PRIC-AMT06960000
                                   OR                                   06970000
                             PV-XFER-PRIC-AMT  NOT >  PPCPRC-RTL-AMT)   06980000
                             IF PS-EACH-PRICE-ENTERED                   06990000
                               MOVE PV-SAV-XFER-PRIC-AMT                07000000
                                   TO PV-RTL-PRICE-MASK                 07010000
                               MOVE PV-RTL-PRICE-X                      07020000
                                   TO DP011-MSG-TEXT                    07030000
                               SET  DP011-MSG-WARNING                   07040000
                                   TO TRUE                              07050000
                               MOVE PC-TSYMSG-01549                     07060000
                                   TO DP011-MSG-NUMBER                  07070000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          07080000
                             END-IF                                     07090000
                         ELSE                                           07100000
                             SET  DP011-MSG-WARNING                     07110000
                                   TO TRUE                              07120000
                             MOVE PC-TSYMSG-01461                       07130000
                                   TO DP011-MSG-NUMBER                  07140000
                             PERFORM 9000-FMT-ERR-MSG-TO-PTC            07150000
                         END-IF                                         07160000
                       ELSE                                             07170000
                         IF PV-XFER-PRIC-AMT  >  PPCPRC-RTL-AMT         07180000
                             SET  DP011-MSG-WARNING                     07190000
                                   TO TRUE                              07200000
                             MOVE PC-TSYMSG-01461                       07210000
                                   TO DP011-MSG-NUMBER                  07220000
                             PERFORM 9000-FMT-ERR-MSG-TO-PTC            07230000
                         END-IF                                         07240000
                       END-IF                                           07250000
                   ELSE                                                 07260000
                       IF TF021-GP-PRICE-ITM-IND  =  PC-YES             07270000
                         IF (PV-XFER-PRIC-AMT = PV-SAV-XFER-PRIC-AMT    07280000
                                   OR                                   07290000
                             PV-XFER-PRIC-AMT = PV-SAV-CPLD-RTL-PRIC-AMT07300000
                                   OR                                   07310000
                             PV-XFER-PRIC-AMT = XST00008-UNT-RTL-AMT)   07320000
                             IF PS-EACH-PRICE-ENTERED                   07330000
                               MOVE PV-SAV-XFER-PRIC-AMT                07340000
                                   TO PV-RTL-PRICE-MASK                 07350000
                               MOVE PV-RTL-PRICE-X                      07360000
                                   TO DP011-MSG-TEXT                    07370000
                               SET  DP011-MSG-WARNING                   07380000
                                   TO TRUE                              07390000
                               MOVE PC-TSYMSG-01549                     07400000
                                   TO DP011-MSG-NUMBER                  07410000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          07420000
                             END-IF                                     07430000
                         ELSE                                           07440000
                             SET  DP011-MSG-WARNING                     07450000
                                   TO TRUE                              07460000
                             MOVE PC-TSYMSG-01557                       07470000
                                   TO DP011-MSG-NUMBER                  07471000
                             PERFORM 9000-FMT-ERR-MSG-TO-PTC            07472000
                         END-IF                                         07473000
                       ELSE                                             07474000
                         IF XST00008-UNT-RTL-AMT NOT = PV-XFER-PRIC-AMT 07475000
                           MOVE XST00008-UNT-RTL-AMT                    07476000
                                   TO PV-RTL-PRICE-MASK                 07477000
                           MOVE PV-RTL-PRICE-X                          07478000
                                   TO DP011-MSG-TEXT                    07479000
                           SET  DP011-MSG-WARNING                       07480000
                                   TO TRUE                              07490000
                           MOVE PC-TSYMSG-01789                         07500000
                                   TO DP011-MSG-NUMBER                  07510000
                           PERFORM 9000-FMT-ERR-MSG-TO-PTC              07520000
                         END-IF                                         07530000
                       END-IF                                           07540000
                   END-IF                                               07550000
               ELSE                                                     07560000
                   IF TF021-GP-PRICE-ITM-IND  =  PC-YES                 07570000
                       IF (PV-XFER-PRIC-AMT  =  PV-SAV-XFER-PRIC-AMT    07580000
                                 OR                                     07590000
                           PV-XFER-PRIC-AMT  =  PV-SAV-CPLD-RTL-PRIC-AMT07600000
                                 OR                                     07610000
                           PV-XFER-PRIC-AMT  =  XST00008-UNT-RTL-AMT)   07620000
                           IF PS-EACH-PRICE-ENTERED                     07630000
                               MOVE PV-SAV-XFER-PRIC-AMT                07640000
                                   TO PV-RTL-PRICE-MASK                 07650000
                               MOVE PV-RTL-PRICE-X                      07660000
                                   TO DP011-MSG-TEXT                    07670000
                               SET  DP011-MSG-WARNING                   07680000
                                   TO TRUE                              07690000
                               MOVE PC-TSYMSG-01549                     07700000
                                   TO DP011-MSG-NUMBER                  07710000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          07720000
                           END-IF                                       07730000
                       ELSE                                             07740000
                          MOVE XST00008-UNT-RTL-AMT                     07750000
                                   TO PV-RTL-PRICE-MASK                 07760000
                          MOVE PV-RTL-PRICE-X                           07770000
                                   TO DP011-MSG-TEXT                    07780000
                          SET  DP011-MSG-WARNING                        07790000
                                   TO TRUE                              07791000
                          MOVE PC-TSYMSG-01789                          07792000
                                   TO DP011-MSG-NUMBER                  07793000
                          PERFORM 9000-FMT-ERR-MSG-TO-PTC               07794000
                       END-IF                                           07795000
                   ELSE                                                 07796000
                       IF XST00008-UNT-RTL-AMT  NOT =  PV-XFER-PRIC-AMT 07797000
                          IF XST00008-UNT-RTL-AMT                       07798000
                                              = PV-SAV-CPLD-RTL-PRIC-AMT07799000
                              MOVE XST00008-UNT-RTL-AMT                 07800000
                                   TO PV-RTL-PRICE-MASK                 07810000
                              MOVE PV-RTL-PRICE-X                       07820000
                                   TO DP011-MSG-TEXT                    07830000
                              SET  DP011-MSG-WARNING                    07840000
                                   TO TRUE                              07850000
                              MOVE PC-TSYMSG-01460                      07860000
                                   TO DP011-MSG-NUMBER                  07870000
                              PERFORM 9000-FMT-ERR-MSG-TO-PTC           07880000
                          ELSE                                          07890000
                              MOVE XST00008-UNT-RTL-AMT                 07900000
                                   TO PV-RTL-PRICE-MASK                 07910000
                              MOVE PV-RTL-PRICE-X                       07920000
                                   TO DP011-MSG-TEXT                    07930000
                              SET  DP011-MSG-WARNING                    07940000
                                   TO TRUE                              07950000
                              MOVE PC-TSYMSG-01789                      07960000
                                   TO DP011-MSG-NUMBER                  07970000
                              PERFORM 9000-FMT-ERR-MSG-TO-PTC           07980000
                          END-IF                                        07990000
                       END-IF                                           08000000
                   END-IF                                               08010000
               END-IF                                                   08020000
           END-IF.                                                      08030000
      *                                                                 08040000
       2312-CHK-REGN-PRIC-CHANGE.                                       08050000
           IF PV-GP-QTY               >  PC-ONE              OR         08060000
              TF021-GP-PRICE-ITM-IND  =  PC-YES                         08070000
               PERFORM 7175-SELECT-XFER-PRICE                           08080000
           END-IF.                                                      08090000
                                                                        08100000
           IF PV-GP-QTY   >  PC-ONE                                     08110000
               COMPUTE PV-DIVIDED-PRICE  =                              08120000
                   (PV-GP-RTL-AMT   /  PV-GP-QTY)                       08130000
               IF (PV-XFER-PRIC-AMT  =  PV-SAV-XFER-PRIC-AMT            08140000
                         OR                                             08150000
                   PV-XFER-PRIC-AMT  =  PV-SAV-CPLD-RTL-PRIC-AMT        08160000
                         OR                                             08170000
                   PV-XFER-PRIC-AMT  =  PV-DIVIDED-PRICE                08180000
                         OR                                             08190000
                   PV-XFER-PRIC-AMT  =  PV-CUR-RTL-AMT)                 08200000
                   IF (XST00008-UPC-STAT-CHG-DTE NOT =                  08210000
                           XST00008-UNT-RTL-CHG-DTE                     08220000
                             AND                                        08230000
                       PV-XFER-PRIC-AMT  =  PV-SAV-XFER-PRIC-AMT)       08240000
                       SET  DP011-MSG-WARNING                           08250000
                                   TO TRUE                              08251000
                       MOVE PC-TSYMSG-01556                             08252000
                                   TO DP011-MSG-NUMBER                  08253000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  08254000
                   ELSE                                                 08255000
                       IF (TF021-GP-PRICE-ITM-IND  =  PC-YES            08256000
                                 AND                                    08257000
                           PS-EACH-PRICE-ENTERED)                       08258000
                          MOVE PV-SAV-XFER-PRIC-AMT                     08259000
                                   TO PV-RTL-PRICE-MASK                 08260000
                          MOVE PV-RTL-PRICE-X                           08270000
                                   TO DP011-MSG-TEXT                    08280000
                          SET  DP011-MSG-WARNING                        08290000
                                   TO TRUE                              08300000
                          MOVE PC-TSYMSG-01549                          08310000
                                   TO DP011-MSG-NUMBER                  08320000
                          PERFORM 9000-FMT-ERR-MSG-TO-PTC               08330000
                       END-IF                                           08340000
                   END-IF                                               08350000
               ELSE                                                     08360000
                   IF XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE-STATUS   08370000
                       SET  DP011-MSG-WARNING                           08380000
                                   TO TRUE                              08390000
                       MOVE PC-TSYMSG-01557                             08400000
                                   TO DP011-MSG-NUMBER                  08410000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  08420000
                   ELSE                                                 08430000
                       SET  DP011-MSG-WARNING                           08440000
                                   TO TRUE                              08450000
                       MOVE PC-TSYMSG-01556                             08460000
                                   TO DP011-MSG-NUMBER                  08461000
                       PERFORM 9000-FMT-ERR-MSG-TO-PTC                  08462000
                   END-IF                                               08463000
               END-IF                                                   08464000
           ELSE                                                         08465000
               IF PS-REGN-CLR-FOUND                                     08466000
                   IF XST00008-UPC-STAT-CHG-DTE                         08467000
                        NOT = XST00008-UNT-RTL-CHG-DTE                  08468000
                       IF TF021-GP-PRICE-ITM-IND  =  PC-YES             08469000
                         IF (PV-XFER-PRIC-AMT = PV-SAV-XFER-PRIC-AMT    08470000
                                   OR                                   08480000
                             PV-XFER-PRIC-AMT = PV-SAV-CPLD-RTL-PRIC-AMT08490000
                                   OR                                   08500000
                             PV-XFER-PRIC-AMT  NOT =  PV-CUR-RTL-AMT)   08510000
                             IF PS-EACH-PRICE-ENTERED                   08520000
                               MOVE PV-SAV-XFER-PRIC-AMT                08530000
                                   TO PV-RTL-PRICE-MASK                 08540000
                               MOVE PV-RTL-PRICE-X                      08550000
                                   TO DP011-MSG-TEXT                    08560000
                               SET  DP011-MSG-WARNING                   08570000
                                   TO TRUE                              08580000
                               MOVE PC-TSYMSG-01549                     08590000
                                   TO DP011-MSG-NUMBER                  08600000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          08610000
                             END-IF                                     08620000
                         ELSE                                           08630000
                             MOVE PV-CUR-RTL-AMT                        08640000
                                   TO PV-MSG-PRICE                      08650000
                             MOVE PC-RED-TICKET                         08660000
                                   TO PV-MSG-COLOR                      08670000
                             MOVE PV-MESSAGE                            08680000
                                   TO DP011-MSG-TEXT                    08690000
                             SET  DP011-MSG-WARNING                     08700000
                                   TO TRUE                              08710000
                             MOVE PC-TSYMSG-02124                       08720000
                                   TO DP011-MSG-NUMBER                  08730000
                             PERFORM 9000-FMT-ERR-MSG-TO-PTC            08740000
                         END-IF                                         08750000
                       ELSE                                             08760000
                         IF PV-XFER-PRIC-AMT NOT = PV-CUR-RTL-AMT       08770000
                             MOVE PV-CUR-RTL-AMT                        08780000
                                   TO PV-MSG-PRICE                      08781000
                             MOVE PC-RED-TICKET                         08782000
                                   TO PV-MSG-COLOR                      08783000
                             MOVE PV-MESSAGE                            08784000
                                   TO DP011-MSG-TEXT                    08785000
                             SET  DP011-MSG-WARNING                     08786000
                                   TO TRUE                              08787000
                             MOVE PC-TSYMSG-02124                       08788000
                                   TO DP011-MSG-NUMBER                  08789000
                             PERFORM 9000-FMT-ERR-MSG-TO-PTC            08790000
                         END-IF                                         08800000
                       END-IF                                           08810000
                   ELSE                                                 08820000
                       IF TF021-GP-PRICE-ITM-IND  =  PC-YES             08830000
                         IF (PV-XFER-PRIC-AMT = PV-SAV-XFER-PRIC-AMT    08840000
                                   OR                                   08850000
                             PV-XFER-PRIC-AMT = PV-SAV-CPLD-RTL-PRIC-AMT08860000
                                   OR                                   08870000
                             PV-XFER-PRIC-AMT = PV-CUR-RTL-AMT)         08880000
                             IF PS-EACH-PRICE-ENTERED                   08890000
                               MOVE PV-SAV-XFER-PRIC-AMT                08900000
                                   TO PV-RTL-PRICE-MASK                 08910000
                               MOVE PV-RTL-PRICE-X                      08920000
                                   TO DP011-MSG-TEXT                    08930000
                               SET  DP011-MSG-WARNING                   08940000
                                   TO TRUE                              08950000
                               MOVE PC-TSYMSG-01549                     08960000
                                   TO DP011-MSG-NUMBER                  08970000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          08980000
                             END-IF                                     08990000
                         ELSE                                           09000000
                             MOVE PV-CUR-RTL-AMT                        09010000
                                   TO PV-MSG-PRICE                      09020000
                             MOVE PC-YELLOW-TICKET                      09030000
                                   TO PV-MSG-COLOR                      09031000
                             MOVE PV-MESSAGE                            09032000
                                   TO DP011-MSG-TEXT                    09033000
                             SET  DP011-MSG-WARNING                     09034000
                                   TO TRUE                              09035000
                             MOVE PC-TSYMSG-02123                       09036000
                                   TO DP011-MSG-NUMBER                  09037000
                             PERFORM 9000-FMT-ERR-MSG-TO-PTC            09038000
                         END-IF                                         09039000
                       ELSE                                             09040000
                         IF PV-CUR-RTL-AMT NOT = PV-XFER-PRIC-AMT       09050000
                             MOVE PV-CUR-RTL-AMT                        09060000
                                   TO PV-MSG-PRICE                      09070000
                             MOVE PC-YELLOW-TICKET                      09080000
                                   TO PV-MSG-COLOR                      09090000
                             MOVE PV-MESSAGE                            09100000
                                   TO DP011-MSG-TEXT                    09110000
                             SET  DP011-MSG-WARNING                     09120000
                                   TO TRUE                              09130000
                             MOVE PC-TSYMSG-02123                       09140000
                                   TO DP011-MSG-NUMBER                  09150000
                             PERFORM 9000-FMT-ERR-MSG-TO-PTC            09160000
                         END-IF                                         09170000
                       END-IF                                           09180000
                   END-IF                                               09190000
               ELSE                                                     09200000
                   IF TF021-GP-PRICE-ITM-IND  =  PC-YES                 09210000
                       IF (PV-XFER-PRIC-AMT  =  PV-SAV-XFER-PRIC-AMT    09220000
                                 OR                                     09230000
                           PV-XFER-PRIC-AMT  =  PV-SAV-CPLD-RTL-PRIC-AMT09240000
                                 OR                                     09250000
                           PV-XFER-PRIC-AMT  =  PV-CUR-RTL-AMT)         09260000
                           IF PS-EACH-PRICE-ENTERED                     09270000
                               MOVE PV-SAV-XFER-PRIC-AMT                09280000
                                   TO PV-RTL-PRICE-MASK                 09290000
                               MOVE PV-RTL-PRICE-X                      09300000
                                   TO DP011-MSG-TEXT                    09301000
                               SET  DP011-MSG-WARNING                   09302000
                                   TO TRUE                              09303000
                               MOVE PC-TSYMSG-01549                     09304000
                                   TO DP011-MSG-NUMBER                  09305000
                               PERFORM 9000-FMT-ERR-MSG-TO-PTC          09306000
                           END-IF                                       09307000
                       ELSE                                             09308000
                          MOVE PV-CUR-RTL-AMT                           09309000
                                   TO PV-MSG-PRICE                      09310000
                          MOVE PC-WHITE-TICKET                          09320000
                                   TO PV-MSG-COLOR                      09330000
                          MOVE PV-MESSAGE                               09340000
                                   TO DP011-MSG-TEXT                    09350000
                          SET  DP011-MSG-WARNING                        09360000
                                   TO TRUE                              09370000
                          MOVE PC-TSYMSG-02123                          09380000
                                   TO DP011-MSG-NUMBER                  09390000
                          PERFORM 9000-FMT-ERR-MSG-TO-PTC               09400000
                       END-IF                                           09410000
                   ELSE                                                 09420000
                       IF PV-CUR-RTL-AMT  NOT =  PV-XFER-PRIC-AMT       09430000
                           MOVE PV-CUR-RTL-AMT                          09440000
                                   TO PV-MSG-PRICE                      09450000
                           MOVE PC-WHITE-TICKET                         09460000
                                   TO PV-MSG-COLOR                      09461000
                           MOVE PV-MESSAGE                              09462000
                                   TO DP011-MSG-TEXT                    09463000
                           SET  DP011-MSG-WARNING                       09464000
                                   TO TRUE                              09465000
                           MOVE PC-TSYMSG-02123                         09466000
                                   TO DP011-MSG-NUMBER                  09467000
                           PERFORM 9000-FMT-ERR-MSG-TO-PTC              09468000
                       END-IF                                           09469000
                   END-IF                                               09470000
               END-IF                                                   09480000
           END-IF.                                                      09490000
      *                                                                 09500000
       3000-FIND-INTERNAL-UPC-NBR.                                      09510000
           EXEC SQL                                                     09520000
               SELECT  UPC_NBR                                          09530000
                 INTO  :PV-INTERNAL-UPC-NBR                             09540000
                 FROM  XST_UPC                                          09550000
                WHERE  INTR_UPC_ID   =  :XST00012-INTR-UPC-ID           09560000
                  AND  UPC_TYP_CDE   =  'I'                             09570000
                  AND  LAST_ACTN_CDE IN ('A', 'U')                      09580000
                 WITH  UR                                               09590000
           END-EXEC.                                                    09600000
                                                                        09610000
           EVALUATE SQLCODE                                             09620000
               WHEN ZERO                                                09630000
                   CONTINUE                                             09640000
               WHEN -904                                                09650000
               WHEN -913                                                09660000
                   SET  DP011-MSG-FATAL                                 09670000
                                   TO TRUE                              09680000
                   MOVE PC-TSYMSG-01063                                 09690000
                                   TO DP011-MSG-NUMBER                  09700000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09710000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09720000
               WHEN OTHER                                               09730000
                   MOVE '3000-FIND-INTERNAL-UPC-NBR'                    09740000
                                   TO DP013-PARAGRAPH                   09750000
                   MOVE 'SELECT KOHLS INTERNAL UPC FOR UPC_ID: '        09760000
                                   TO DP013-MESSAGE-TEXT (1)            09770000
                   MOVE XST00012-INTR-UPC-ID                            09780000
                                   TO PV-DISPLAY-INTR-UPC-ID            09790000
                   MOVE XST00012-INTR-UPC-ID                            09800000
                                   TO PV-DISPLAY-INTR-UPC-ID            09810000
                   MOVE PV-DISPLAY-INTR-UPC-ID                          09820000
                                   TO DP013-MESSAGE-TEXT (2)            09830000
                   MOVE SQLCA      TO DP013-SQLCA                       09840000
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          09850000
                   SET DP013-DB2-ABEND                                  09851000
                       DP013-NO-ROLLBACK                                09852000
                                   TO TRUE                              09853000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09854000
                   SET  DP011-MSG-FATAL                                 09855000
                                   TO TRUE                              09855100
                   MOVE PC-TSYMSG-01064                                 09855200
                                   TO DP011-MSG-NUMBER                  09855300
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09855400
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09855500
           END-EVALUATE.                                                09855600
      *                                                                 09855700
       7000-SELECT-MAX-RCPT-TMST.                                       09855800
           INITIALIZE DCLTTFRCPT.                                       09855900
           MOVE TF021-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 09856000
                                                                        09857000
           EXEC SQL                                                     09858000
               SELECT  MAX(RCV_XFER_BEG_TMST)                           09859000
                 INTO  :TFRCPT-RCV-XFER-BEG-TMST                        09860000
                           :PV-DB2-NULL-IND                             09870000
                 FROM  TTFRCPT                                          09880000
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          09890000
                  AND   RCV_XFER_BEG_TMST  =  RCV_XFER_END_TMST)        09900000
                 WITH  UR                                               09910000
           END-EXEC.                                                    09920000
                                                                        09930000
           EVALUATE SQLCODE                                             09940000
               WHEN ZERO                                                09950000
                   CONTINUE                                             09960000
               WHEN -904                                                09970000
               WHEN -913                                                09980000
                   SET  DP011-MSG-FATAL                                 09990000
                                   TO TRUE                              10000000
                   MOVE PC-TSYMSG-01063                                 10010000
                                   TO DP011-MSG-NUMBER                  10020000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10030000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10040000
               WHEN OTHER                                               10050000
                   MOVE '7000-SELECT-MAX-RCPT-TMST'                     10060000
                                   TO DP013-PARAGRAPH                   10070000
                   MOVE 'SELECT MAX(RCV_XFER_BEG_TMST) FOR XFER_DKEY_ID:10080000
      -                 ' '        TO DP013-MESSAGE-TEXT (1)            10090000
                   MOVE DK-XFER-DKEY-ID                                 10100000
                                   TO PV-DISPLAY-XFER-DKEY-ID           10110000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         10120000
                                   TO DP013-MESSAGE-TEXT (2)            10130000
                   MOVE SQLCA      TO DP013-SQLCA                       10140000
                   MOVE 'TTFRCPT'  TO DP013-DB2-TABLE-NAME (1)          10150000
                   SET DP013-DB2-ABEND                                  10160000
                       DP013-NO-ROLLBACK                                10170000
                                   TO TRUE                              10180000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10190000
                   SET  DP011-MSG-FATAL                                 10200000
                                   TO TRUE                              10210000
                   MOVE PC-TSYMSG-01064                                 10220000
                                   TO DP011-MSG-NUMBER                  10230000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10240000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10250000
           END-EVALUATE.                                                10260000
      *                                                                 10270000
       7050-SELECT-UPC-SKU.                                             10280000
           INITIALIZE  DCLXST00012.                                     10290000
           INITIALIZE  DCLXST00010.                                     10300000
           INITIALIZE  DCLXST00013.                                     10310000
           INITIALIZE  DCLXST00008.                                     10320000
           EXEC SQL                                                     10330000
               SELECT  D.UNT_RTL_AMT                                    10340000
                     , D.LOC_SKU_STAT_CDE                               10350000
                     , D.UPC_STAT_CHG_DTE                               10360000
                     , D.UNT_RTL_CHG_DTE                                10370000
                     , D.GP_RTL_AMT                                     10380000
                     , D.GP_RTL_QTY                                     10390000
                     , B.REGN_PRIC_IND                                  10400000
                     , C.DEPT_NBR                                       10410000
                     , C.MAJ_CL_NBR                                     10420000
                     , C.SUB_CL_NBR                                     10430000
                     , A.INTR_UPC_ID                                    10440000
                     , E.ITM_NBR                                        10450000
                 INTO  :XST00008-UNT-RTL-AMT                            10460000
                     , :XST00008-LOC-SKU-STAT-CDE                       10470000
                     , :XST00008-UPC-STAT-CHG-DTE                       10480000
                     , :XST00008-UNT-RTL-CHG-DTE                        10490000
                     , :XST00008-GP-RTL-AMT                             10500000
                           :PV-GP-RTL-QTY-NULL-IND                      10510000
                     , :XST00008-GP-RTL-QTY                             10520000
                           :PV-GP-RTL-AMT-NULL-IND                      10530000
                     , :XST00010-REGN-PRIC-IND                          10540000
                     , :XST00013-DEPT-NBR                               10550000
                     , :XST00013-MAJ-CL-NBR                             10560000
                     , :XST00013-SUB-CL-NBR                             10570000
                     , :XST00012-INTR-UPC-ID                            10580000
                     , :SKXREF-ITM-NBR                                  10590000
                 FROM  XST_UPC      A                                   10600000
                     , XST_SKU      B                                   10601000
                     , XST_VND_STYL C                                   10601100
                     , XST_SKU_LOC  D                                   10601200
                     , TSKXREF      E                                   10601300
                WHERE   A.UPC_NBR       =  :DK-UPC-NBR                  10601400
                  AND   A.LAST_ACTN_CDE IN ('A', 'U')                   10601500
                  AND   B.INTR_UPC_ID   =  A.INTR_UPC_ID                10601600
                  AND   C.STYL_ID       =  B.STYL_ID                    10601700
                  AND   D.LOC_NBR       =  :DK-SELECT-LOC-NBR           10601800
                  AND   D.INTR_UPC_ID   =  A.INTR_UPC_ID                10601900
                  AND   D.BEG_TMST      <= CURRENT TIMESTAMP            10602000
                  AND  (D.END_TMST      >  CURRENT TIMESTAMP            10602100
                   OR   D.END_TMST      IS NULL)                        10602200
                  AND   E.INTR_UPC_ID   =  A.INTR_UPC_ID                10602300
                  AND   E.SKU_STAT_CDE  <> '98'                         10602400
                WITH    UR                                              10602500
           END-EXEC.                                                    10602600
                                                                        10602700
           EVALUATE SQLCODE                                             10602800
               WHEN ZERO                                                10602900
      * ZERO THE NULL VALUES                                            10603000
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        10604000
                       MOVE ZEROS TO XST00008-GP-RTL-QTY                10605000
                   END-IF                                               10606000
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        10607000
                       MOVE ZEROS TO XST00008-GP-RTL-AMT                10608000
                   END-IF                                               10609000
                   MOVE XST00008-UNT-RTL-AMT                            10610000
                                   TO PV-CUR-RTL-AMT                    10620000
                   MOVE XST00008-GP-RTL-AMT                             10621000
                                   TO PV-GP-RTL-AMT                     10622000
                   MOVE XST00008-GP-RTL-QTY                             10623000
                                   TO PV-GP-QTY                         10624000
               WHEN -904                                                10625000
               WHEN -913                                                10626000
                   SET  DP011-MSG-FATAL                                 10627000
                                   TO TRUE                              10628000
                   MOVE PC-TSYMSG-01063                                 10629000
                                   TO DP011-MSG-NUMBER                  10630000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10640000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10650000
               WHEN OTHER                                               10660000
                   MOVE '7050-SELECT-UPC-SKU'                           10670000
                                   TO DP013-PARAGRAPH                   10680000
                   MOVE 'SELECT AN ITEM NBR FOR THE FOLLOWING UPC: '    10690000
                                   TO DP013-MESSAGE-TEXT (1)            10700000
                   MOVE DK-UPC-NBR TO PV-DISPLAY-UPC-NBR                10710000
                   MOVE PV-DISPLAY-UPC-NBR                              10720000
                                   TO DP013-MESSAGE-TEXT (2)            10730000
                   MOVE SQLCA      TO DP013-SQLCA                       10740000
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          10750000
                   MOVE 'XST_SKU'  TO DP013-DB2-TABLE-NAME (2)          10760000
                   MOVE 'XST_SKU_LOC'                                   10770000
                                   TO DP013-DB2-TABLE-NAME (3)          10780000
                   SET DP013-DB2-ABEND                                  10790000
                       DP013-NO-ROLLBACK                                10800000
                                   TO TRUE                              10810000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10820000
                   SET  DP011-MSG-FATAL                                 10830000
                                   TO TRUE                              10840000
                   MOVE PC-TSYMSG-01064                                 10850000
                                   TO DP011-MSG-NUMBER                  10851000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10852000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10853000
           END-EVALUATE.                                                10854000
      *                                                                 10855000
       7060-SELECT-SKU-LOC.                                             10856000
101404     EXEC SQL                                                     10857000
               SELECT  B.UNT_RTL_AMT                                    10858000
                     , B.LOC_SKU_STAT_CDE                               10859000
                     , B.UPC_STAT_CHG_DTE                               10860000
                     , B.UNT_RTL_CHG_DTE                                10870000
                     , B.GP_RTL_AMT                                     10880000
                     , B.GP_RTL_QTY                                     10890000
                 INTO  :XST00008-UNT-RTL-AMT                            10900000
                     , :XST00008-LOC-SKU-STAT-CDE                       10910000
                     , :XST00008-UPC-STAT-CHG-DTE                       10920000
                     , :XST00008-UNT-RTL-CHG-DTE                        10930000
                     , :XST00008-GP-RTL-AMT                             10940000
                           :PV-GP-RTL-QTY-NULL-IND                      10940100
                     , :XST00008-GP-RTL-QTY                             10940200
                           :PV-GP-RTL-AMT-NULL-IND                      10940300
                 FROM  XST_UPC      A                                   10940400
                     , XST_SKU_LOC  B                                   10940500
                     , TSKXREF      C                                   10940600
                WHERE   A.UPC_NBR       =  :DK-UPC-NBR                  10940700
                  AND   A.LAST_ACTN_CDE IN ('A', 'U')                   10940800
                  AND   B.LOC_NBR       =  :DK-SELECT-LOC-NBR           10940900
                  AND   B.INTR_UPC_ID   =  A.INTR_UPC_ID                10941000
                  AND   B.BEG_TMST      <= CURRENT TIMESTAMP            10942000
                  AND  (B.END_TMST      >  CURRENT TIMESTAMP            10942100
                   OR   B.END_TMST      IS NULL)                        10942200
                  AND   C.INTR_UPC_ID   =  A.INTR_UPC_ID                10942300
                  AND   C.SKU_STAT_CDE  <> '98'                         10942400
                WITH    UR                                              10942500
           END-EXEC.                                                    10942600
                                                                        10942700
           EVALUATE SQLCODE                                             10942800
               WHEN ZERO                                                10942900
      * ZERO THE NULL VALUES                                            10943000
                   IF PV-GP-RTL-QTY-NULL-IND < 0                        10943100
                       MOVE ZEROS TO XST00008-GP-RTL-QTY                10943200
                   END-IF                                               10943300
                   IF PV-GP-RTL-AMT-NULL-IND < 0                        10943400
                       MOVE ZEROS TO XST00008-GP-RTL-AMT                10943500
                   END-IF                                               10943600
                   MOVE XST00008-UNT-RTL-AMT                            10943700
                                   TO PV-CUR-RTL-AMT                    10943800
                   MOVE XST00008-GP-RTL-AMT                             10943900
                                   TO PV-GP-RTL-AMT                     10944000
                   MOVE XST00008-GP-RTL-QTY                             10944100
                                   TO PV-GP-QTY                         10944200
               WHEN +100                                                10944300
                   CONTINUE                                             10944400
               WHEN -904                                                10944500
               WHEN -913                                                10944600
                   SET  DP011-MSG-FATAL                                 10944700
                                   TO TRUE                              10944800
                   MOVE PC-TSYMSG-01063                                 10944900
                                   TO DP011-MSG-NUMBER                  10945000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10945100
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10945200
               WHEN OTHER                                               10945300
                   MOVE '7060-SELECT-SKU-LOC'                           10945400
                                   TO DP013-PARAGRAPH                   10945500
                   MOVE 'SELECT AN ITEM NBR FOR THE FOLLOWING UPC: '    10945600
                                   TO DP013-MESSAGE-TEXT (1)            10945700
                   MOVE DK-UPC-NBR TO PV-DISPLAY-UPC-NBR                10945800
                   MOVE PV-DISPLAY-UPC-NBR                              10945900
                                   TO DP013-MESSAGE-TEXT (2)            10946000
                   MOVE SQLCA      TO DP013-SQLCA                       10946100
                   MOVE 'XST_UPC'  TO DP013-DB2-TABLE-NAME (1)          10946200
                   MOVE 'XST_SKU-LOC'  TO DP013-DB2-TABLE-NAME (2)      10946300
                   MOVE 'TSKXREF'                                       10946400
                                   TO DP013-DB2-TABLE-NAME (3)          10946500
                   SET DP013-DB2-ABEND                                  10946600
                       DP013-NO-ROLLBACK                                10946700
                                   TO TRUE                              10946800
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10946900
                   SET  DP011-MSG-FATAL                                 10947000
                                   TO TRUE                              10947100
                   MOVE PC-TSYMSG-01064                                 10947200
                                   TO DP011-MSG-NUMBER                  10947300
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      10947400
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   10947500
           END-EVALUATE.                                                10947600
      *                                                                 10947700
       7100-SELECT-ITM-BY-XFER-PRIC.                                    10947800
           INITIALIZE DCLTTFITEM.                                       10947900
                                                                        10948000
           COMPUTE DK-XFER-PRIC-AMT  =                                  10949000
               (TF021-TKT-PRICE  /  100).                               10950000
           MOVE DK-XFER-PRIC-AMT   TO  PV-XFER-PRIC-AMT.                10960000
                                                                        10970000
           EXEC SQL                                                     10980000
               SELECT  XFER_LNE_NBR,                                    10990000
                       CPLD_RTL_PRIC_AMT,                               11000000
                       XFER_PRIC_AMT,                                   11010000
                       XFER_QTY,                                        11020000
                       RNBR_SKU_IND                                     11030000
                 INTO  :TFITEM-XFER-LNE-NBR,                            11040000
                       :TFITEM-CPLD-RTL-PRIC-AMT,                       11050000
                       :TFITEM-XFER-PRIC-AMT,                           11060000
                       :TFITEM-XFER-QTY,                                11070000
                       :TFITEM-RNBR-SKU-IND                             11080000
                 FROM  TTFITEM                                          11090000
                WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID              11100000
                  AND   ITM_NBR        =  :SKXREF-ITM-NBR               11110000
                  AND   XFER_PRIC_AMT  =  :DK-XFER-PRIC-AMT)            11120000
                 WITH   UR                                              11130000
           END-EXEC.                                                    11140000
                                                                        11150000
           EVALUATE SQLCODE                                             11160000
               WHEN ZERO                                                11170000
                   MOVE TFITEM-XFER-LNE-NBR                             11180000
                                   TO TF022-RTL-LINE-NBR                11190000
                   MOVE TFITEM-RNBR-SKU-IND                             11200000
                                   TO TF022-SKU-RENUM-IND               11210000
                   MOVE TFITEM-XFER-QTY                                 11220000
                                   TO TF022-XFER-QTY                    11230000
               WHEN +100                                                11240000
                   CONTINUE                                             11241000
               WHEN -904                                                11242000
               WHEN -913                                                11243000
                   SET  DP011-MSG-FATAL                                 11244000
                                   TO TRUE                              11245000
                   MOVE PC-TSYMSG-01063                                 11246000
                                   TO DP011-MSG-NUMBER                  11247000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      11248000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   11249000
               WHEN OTHER                                               11250000
                   MOVE '7100-SELECT-ITM-BY-XFER-PRIC'                  11260000
                                   TO DP013-PARAGRAPH                   11270000
                   MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR/XFER_11280000
      -                 'PRIC_AMT: '                                    11290000
                                   TO DP013-MESSAGE-TEXT (1)            11300000
                   MOVE DK-XFER-DKEY-ID                                 11310000
                                   TO PV-DISPLAY-XFER-DKEY-ID           11320000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         11330000
                                   TO DP013-MESSAGE-TEXT (2)            11340000
                   MOVE SKXREF-ITM-NBR                                  11350000
                                   TO PV-DISPLAY-ITM-NBR                11360000
                   MOVE PV-DISPLAY-ITM-NBR                              11370000
                                   TO DP013-MESSAGE-TEXT (3)            11380000
                   MOVE DK-XFER-PRIC-AMT                                11390000
                                   TO PV-DISPLAY-XFER-PRIC-AMT          11400000
                   MOVE PV-DISPLAY-XFER-PRIC-AMT                        11410000
                                   TO DP013-MESSAGE-TEXT (4)            11420000
                   MOVE SQLCA      TO DP013-SQLCA                       11430000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          11440000
                   SET DP013-DB2-ABEND                                  11450000
                       DP013-NO-ROLLBACK                                11460000
                                   TO TRUE                              11470000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11480000
                   SET  DP011-MSG-FATAL                                 11490000
                                   TO TRUE                              11500000
                   MOVE PC-TSYMSG-01064                                 11510000
                                   TO DP011-MSG-NUMBER                  11520000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      11530000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   11540000
           END-EVALUATE.                                                11550000
      *                                                                 11560000
       7125-SELECT-ITM-BY-FILE-PRIC.                                    11570000
           INITIALIZE DCLTTFITEM.                                       11580000
                                                                        11590000
           COMPUTE DK-CPLD-RTL-PRIC-AMT  =                              11600000
               (TF021-TKT-PRICE  /  100).                               11610000
           MOVE DK-CPLD-RTL-PRIC-AMT                                    11620000
                                   TO  PV-XFER-PRIC-AMT.                11630000
                                                                        11640000
           EXEC SQL                                                     11650000
               SELECT  XFER_LNE_NBR,                                    11660000
                       CPLD_RTL_PRIC_AMT,                               11670000
                       XFER_PRIC_AMT,                                   11680000
                       XFER_QTY,                                        11690000
                       RNBR_SKU_IND                                     11700000
                 INTO  :TFITEM-XFER-LNE-NBR,                            11710000
                       :TFITEM-CPLD-RTL-PRIC-AMT,                       11720000
                       :TFITEM-XFER-PRIC-AMT,                           11730000
                       :TFITEM-XFER-QTY,                                11740000
                       :TFITEM-RNBR-SKU-IND                             11750000
                 FROM  TTFITEM                                          11760000
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          11770000
                  AND   ITM_NBR            =  :SKXREF-ITM-NBR           11780000
                  AND   CPLD_RTL_PRIC_AMT  =  :DK-CPLD-RTL-PRIC-AMT)    11790000
                 WITH   UR                                              11800000
           END-EXEC.                                                    11810000
                                                                        11820000
           EVALUATE SQLCODE                                             11830000
               WHEN ZERO                                                11840000
                   MOVE TFITEM-XFER-LNE-NBR                             11850000
                                   TO  TF022-RTL-LINE-NBR               11860000
                   MOVE TFITEM-RNBR-SKU-IND                             11870000
                                   TO  TF022-SKU-RENUM-IND              11880000
                   MOVE TFITEM-XFER-QTY                                 11890000
                                   TO  TF022-XFER-QTY                   11900000
                   MOVE TFITEM-XFER-PRIC-AMT                            11910000
                                   TO  PV-XFER-PRIC-AMT                 11920000
                                       PV-RTL-PRICE-MASK                11930000
                   COMPUTE TF021-TKT-PRICE  =                           11940000
                       (TFITEM-XFER-PRIC-AMT * 100)                     11950000
                   MOVE PV-RTL-PRICE-X                                  11960000
                                   TO  DP011-MSG-TEXT                   11961000
                   SET  DP011-MSG-WARNING                               11961100
                                   TO  TRUE                             11961200
                   MOVE PC-TSYMSG-01549                                 11961300
                                   TO  DP011-MSG-NUMBER                 11961400
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      11961500
               WHEN +100                                                11961600
                   CONTINUE                                             11961700
               WHEN -904                                                11961800
               WHEN -913                                                11961900
                   SET  DP011-MSG-FATAL                                 11962000
                                   TO TRUE                              11963000
                   MOVE PC-TSYMSG-01063                                 11964000
                                   TO DP011-MSG-NUMBER                  11965000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      11966000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   11967000
               WHEN OTHER                                               11968000
                   MOVE '7125-SELECT-ITM-BY-FILE-PRIC'                  11969000
                                   TO DP013-PARAGRAPH                   11970000
                   MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR/CPLD_11980000
      -                 'RTL_PRIC_AMT: '                                11990000
                                   TO DP013-MESSAGE-TEXT (1)            12000000
                   MOVE DK-XFER-DKEY-ID                                 12010000
                                   TO PV-DISPLAY-XFER-DKEY-ID           12020000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         12030000
                                   TO DP013-MESSAGE-TEXT (2)            12040000
                   MOVE SKXREF-ITM-NBR                                  12050000
                                   TO PV-DISPLAY-ITM-NBR                12060000
                   MOVE PV-DISPLAY-ITM-NBR                              12070000
                                   TO DP013-MESSAGE-TEXT (3)            12080000
                   MOVE DK-CPLD-RTL-PRIC-AMT                            12090000
                                   TO PV-DISPLAY-CPLD-RTL-PRIC-AMT      12100000
                   MOVE PV-DISPLAY-CPLD-RTL-PRIC-AMT                    12110000
                                   TO DP013-MESSAGE-TEXT (4)            12120000
                   MOVE SQLCA      TO DP013-SQLCA                       12130000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          12140000
                   SET DP013-DB2-ABEND                                  12150000
                       DP013-NO-ROLLBACK                                12160000
                                   TO TRUE                              12170000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      12180000
                   SET  DP011-MSG-FATAL                                 12190000
                                   TO TRUE                              12200000
                   MOVE PC-TSYMSG-01064                                 12210000
                                   TO DP011-MSG-NUMBER                  12220000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      12230000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   12240000
           END-EVALUATE.                                                12250000
      *                                                                 12260000
       7150-SELECT-ITM-BY-ITMNBR.                                       12270000
           INITIALIZE DCLTTFITEM.                                       12280000
                                                                        12290000
           EXEC SQL                                                     12300000
               SELECT  XFER_LNE_NBR,                                    12310000
                       CPLD_RTL_PRIC_AMT,                               12320000
                       XFER_PRIC_AMT,                                   12330000
                       XFER_QTY,                                        12340000
                       RNBR_SKU_IND                                     12350000
                 INTO  :TFITEM-XFER-LNE-NBR,                            12360000
                       :TFITEM-CPLD-RTL-PRIC-AMT,                       12370000
                       :TFITEM-XFER-PRIC-AMT,                           12380000
                       :TFITEM-XFER-QTY,                                12390000
                       :TFITEM-RNBR-SKU-IND                             12400000
                 FROM  TTFITEM                                          12410000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID               12420000
                  AND   ITM_NBR       =  :SKXREF-ITM-NBR)               12430000
                 WITH   UR                                              12440000
           END-EXEC.                                                    12450000
                                                                        12460000
           EVALUATE SQLCODE                                             12470000
               WHEN ZERO                                                12480000
                   MOVE TFITEM-XFER-LNE-NBR                             12490000
                                   TO TF022-RTL-LINE-NBR                12500000
                   MOVE TFITEM-RNBR-SKU-IND                             12510000
                                   TO TF022-SKU-RENUM-IND               12520000
                   MOVE TFITEM-XFER-QTY                                 12530000
                                   TO TF022-XFER-QTY                    12540000
               WHEN -811                                                12550000
               WHEN +100                                                12560000
                   CONTINUE                                             12570000
               WHEN -904                                                12580000
               WHEN -913                                                12590000
                   SET  DP011-MSG-FATAL                                 12600000
                                   TO TRUE                              12610000
                   MOVE PC-TSYMSG-01063                                 12620000
                                   TO DP011-MSG-NUMBER                  12630000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      12640000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   12650000
               WHEN OTHER                                               12660000
                   MOVE '7150-SELECT-ITM-BY-ITMNBR'                     12670000
                                   TO DP013-PARAGRAPH                   12680000
                   MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR: '   12690000
                                   TO DP013-MESSAGE-TEXT (1)            12700000
                   MOVE DK-XFER-DKEY-ID                                 12710000
                                   TO PV-DISPLAY-XFER-DKEY-ID           12720000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         12730000
                                   TO DP013-MESSAGE-TEXT (2)            12740000
                   MOVE SKXREF-ITM-NBR                                  12750000
                                   TO PV-DISPLAY-ITM-NBR                12760000
                   MOVE PV-DISPLAY-ITM-NBR                              12770000
                                   TO DP013-MESSAGE-TEXT (3)            12780000
                   MOVE SQLCA      TO DP013-SQLCA                       12790000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          12800000
                   SET DP013-DB2-ABEND                                  12810000
                       DP013-NO-ROLLBACK                                12820000
                                   TO TRUE                              12830000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      12840000
                   SET  DP011-MSG-FATAL                                 12850000
                                   TO TRUE                              12860000
                   MOVE PC-TSYMSG-01064                                 12870000
                                   TO DP011-MSG-NUMBER                  12880000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      12890000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   12900000
           END-EVALUATE.                                                12910000
      *                                                                 12920000
       7175-SELECT-XFER-PRICE.                                          12930000
                                                                        12940000
           EXEC SQL                                                     12950000
               SELECT  CPLD_RTL_PRIC_AMT,                               12960000
                       XFER_PRIC_AMT                                    12970000
                 INTO  :PV-SAV-CPLD-RTL-PRIC-AMT,                       12980000
                       :PV-SAV-XFER-PRIC-AMT                            12990000
                 FROM  TTFITEM                                          13000000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID               13010000
                  AND   ITM_NBR       =  :SKXREF-ITM-NBR                13020000
                  AND   XFER_QTY      >  :PC-ZERO)                      13030000
                 WITH   UR                                              13040000
           END-EXEC.                                                    13050000
                                                                        13060000
           EVALUATE SQLCODE                                             13070000
               WHEN ZERO                                                13080000
                   CONTINUE                                             13090000
               WHEN -811                                                13100000
               WHEN +100                                                13110000
                   MOVE ZEROES     TO PV-SAV-CPLD-RTL-PRIC-AMT          13120000
                                      PV-SAV-XFER-PRIC-AMT              13130000
               WHEN -904                                                13140000
               WHEN -913                                                13150000
                   SET  DP011-MSG-FATAL                                 13160000
                                   TO TRUE                              13170000
                   MOVE PC-TSYMSG-01063                                 13180000
                                   TO DP011-MSG-NUMBER                  13190000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      13200000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   13210000
               WHEN OTHER                                               13220000
                   MOVE '7175-SELECT-XFER-PRICE'                        13230000
                                   TO DP013-PARAGRAPH                   13240000
                   MOVE 'SELECT XFER PRICE FOR XFER_DKEY_ID/ITM_NBR:'   13250000
                                   TO DP013-MESSAGE-TEXT (1)            13260000
                   MOVE DK-XFER-DKEY-ID                                 13270000
                                   TO PV-DISPLAY-XFER-DKEY-ID           13280000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         13290000
                                   TO DP013-MESSAGE-TEXT (2)            13300000
                   MOVE SKXREF-ITM-NBR                                  13310000
                                   TO PV-DISPLAY-ITM-NBR                13320000
                   MOVE PV-DISPLAY-ITM-NBR                              13330000
                                   TO DP013-MESSAGE-TEXT (3)            13340000
                   MOVE SQLCA      TO DP013-SQLCA                       13350000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          13360000
                   SET DP013-DB2-ABEND                                  13370000
                       DP013-NO-ROLLBACK                                13380000
                                   TO TRUE                              13390000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      13400000
                   SET  DP011-MSG-FATAL                                 13410000
                                   TO TRUE                              13420000
                   MOVE PC-TSYMSG-01064                                 13430000
                                   TO DP011-MSG-NUMBER                  13440000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      13450000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   13460000
           END-EVALUATE.                                                13470000
      *                                                                 13480000
       7200-SELECT-MAX-LINE-NBR.                                        13490000
           INITIALIZE DCLTTFITEM.                                       13500000
                                                                        13510000
           EXEC SQL                                                     13520000
               SELECT  MAX(XFER_LNE_NBR)                                13530000
                 INTO  :PV-XFER-LNE-NBR                                 13540000
                           :PV-DB2-NULL-IND                             13550000
                 FROM  TTFITEM                                          13560000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)              13570000
                 WITH  UR                                               13580000
           END-EXEC.                                                    13590000
                                                                        13600000
           EVALUATE SQLCODE                                             13610000
               WHEN ZERO                                                13620000
                   CONTINUE                                             13630000
               WHEN -904                                                13640000
               WHEN -913                                                13650000
                   SET  DP011-MSG-FATAL                                 13660000
                                   TO TRUE                              13670000
                   MOVE PC-TSYMSG-01063                                 13680000
                                   TO DP011-MSG-NUMBER                  13690000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      13700000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   13710000
               WHEN OTHER                                               13720000
                   MOVE '7200-SELECT-MAX-LINE-NBR'                      13730000
                                   TO DP013-PARAGRAPH                   13740000
                   MOVE 'SELECT MAX(XFER_LNE_NBR) FOR XFER_DKEY_ID: '   13750000
                                   TO DP013-MESSAGE-TEXT (1)            13760000
                   MOVE DK-XFER-DKEY-ID                                 13770000
                                   TO PV-DISPLAY-XFER-DKEY-ID           13780000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         13790000
                                   TO DP013-MESSAGE-TEXT (2)            13800000
                   MOVE SQLCA      TO DP013-SQLCA                       13810000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          13820000
                   SET DP013-DB2-ABEND                                  13830000
                       DP013-NO-ROLLBACK                                13840000
                                   TO TRUE                              13850000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      13860000
                   SET  DP011-MSG-FATAL                                 13870000
                                   TO TRUE                              13880000
                   MOVE PC-TSYMSG-01064                                 13890000
                                   TO DP011-MSG-NUMBER                  13900000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      13910000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   13920000
           END-EVALUATE.                                                13930000
                                                                        13940000
           COMPUTE PV-NEW-XFER-LNE-NBR  =                               13950000
               PV-XFER-LNE-NBR + 1.                                     13960000
      *                                                                 13970000
       7250-INSERT-XFER-ITM.                                            13980000
           INITIALIZE DCLTTFITEM.                                       13990000
                                                                        14000000
           MOVE DK-XFER-DKEY-ID    TO TFITEM-XFER-DKEY-ID.              14010000
           MOVE PV-NEW-XFER-LNE-NBR                                     14020000
                                   TO TFITEM-XFER-LNE-NBR               14030000
                                      TF022-RTL-LINE-NBR.               14040000
           MOVE PV-KOHLS-INTERNAL-UPC-NBR                               14050000
                                   TO TFITEM-KOHLS-UPC-NBR.             14060000
           MOVE TF021-SKU-RENUM-IND                                     14070000
                                   TO TFITEM-RNBR-SKU-IND               14080000
                                      TF022-SKU-RENUM-IND.              14090000
           MOVE SKXREF-ITM-NBR     TO TFITEM-ITM-NBR.                   14100000
           MOVE TF021-UPC-NBR      TO TFITEM-SCN-UPC-NBR.               14110000
                                                                        14120000
           IF XST00008-GP-RTL-QTY > PC-ONE                              14130000
               MOVE PC-YES         TO  TFITEM-ITM-PRIC-MLT-IND          14140000
           ELSE                                                         14150000
               MOVE PC-NO          TO  TFITEM-ITM-PRIC-MLT-IND          14160000
           END-IF.                                                      14170000
                                                                        14180000
           COMPUTE TFITEM-XFER-PRIC-AMT  =                              14190000
               (TF021-TKT-PRICE  /  100).                               14200000
                                                                        14210000
           EXEC SQL                                                     14220000
               INSERT INTO TTFITEM                                      14230000
                   (XFER_DKEY_ID,                                       14240000
                    XFER_LNE_NBR,                                       14250000
                    SCN_UPC_NBR,                                        14260000
                    KOHLS_UPC_NBR,                                      14270000
                    ITM_NBR,                                            14280000
                    XFER_PRIC_AMT,                                      14290000
                    RNBR_SKU_IND,                                       14300000
                    ITM_PRIC_MLT_IND)                                   14310000
               VALUES                                                   14320000
                   (:TFITEM-XFER-DKEY-ID,                               14330000
                    :TFITEM-XFER-LNE-NBR,                               14340000
                    :TFITEM-SCN-UPC-NBR,                                14350000
                    :TFITEM-KOHLS-UPC-NBR,                              14360000
                    :TFITEM-ITM-NBR,                                    14370000
                    :TFITEM-XFER-PRIC-AMT,                              14380000
                    :TFITEM-RNBR-SKU-IND,                               14390000
                    :TFITEM-ITM-PRIC-MLT-IND)                           14400000
           END-EXEC.                                                    14410000
                                                                        14420000
           EVALUATE SQLCODE                                             14430000
               WHEN ZERO                                                14440000
                   CONTINUE                                             14450000
               WHEN -904                                                14460000
               WHEN -913                                                14470000
                   SET  DP011-MSG-FATAL                                 14480000
                                   TO TRUE                              14490000
                   MOVE PC-TSYMSG-01063                                 14500000
                                   TO DP011-MSG-NUMBER                  14510000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      14520000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   14530000
               WHEN OTHER                                               14540000
                   MOVE '7250-INSERT-XFER-ITM'                          14550000
                                   TO DP013-PARAGRAPH                   14560000
                   MOVE 'INSERT RTL XFER ITM FOR XFER_DKEY_ID: '        14570000
                                   TO DP013-MESSAGE-TEXT (1)            14580000
                   MOVE DK-XFER-DKEY-ID                                 14590000
                                   TO PV-DISPLAY-XFER-DKEY-ID           14600000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         14610000
                                   TO DP013-MESSAGE-TEXT (2)            14620000
                   MOVE PV-NEW-XFER-LNE-NBR                             14630000
                                   TO PV-DISPLAY-XFER-LNE-NBR           14640000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         14650000
                                   TO DP013-MESSAGE-TEXT (3)            14660000
                   MOVE SQLCA      TO DP013-SQLCA                       14670000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          14680000
                   SET DP013-DB2-ABEND                                  14690000
                       DP013-NO-ROLLBACK                                14700000
                                   TO TRUE                              14710000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      14720000
                   SET  DP011-MSG-FATAL                                 14730000
                                   TO TRUE                              14740000
                   MOVE PC-TSYMSG-01064                                 14750000
                                   TO DP011-MSG-NUMBER                  14760000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      14770000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   14780000
           END-EVALUATE.                                                14790000
      *                                                                 14800000
       7300-SELECT-MAX-LINE-SEQ-NBR.                                    14810000
           INITIALIZE DCLTTFITRC.                                       14820000
                                                                        14830000
           EXEC SQL                                                     14840000
               SELECT  MAX(XFER_LNE_SEQ_NBR)                            14850000
                 INTO  :PV-XFER-LNE-SEQ-NBR                             14860000
                           :PV-DB2-NULL-IND                             14870000
                 FROM  TTFITRC                                          14880000
                WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID             14890000
                  AND   XFER_LNE_NBR    =  :TFITEM-XFER-LNE-NBR         14900000
                  AND   XFER_RCPT_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)   14910000
                 WITH   UR                                              14920000
           END-EXEC.                                                    14930000
                                                                        14940000
           EVALUATE SQLCODE                                             14950000
               WHEN ZERO                                                14960000
                   CONTINUE                                             14970000
               WHEN OTHER                                               14980000
                   MOVE '7300-SELECT-MAX-LINE-SEQ-NBR'                  14990000
                                   TO DP013-PARAGRAPH                   15000000
                   MOVE 'SELECT MAX(XFER_LNE_SEQ_NBR) FOR XFER_DKEY_ID/X15010000
      -                 'FER_LNE_NBR/XFER_RCV_BEG_TMST: '               15020000
                                   TO DP013-MESSAGE-TEXT (1)            15030000
                   MOVE DK-XFER-DKEY-ID                                 15040000
                                   TO PV-DISPLAY-XFER-DKEY-ID           15050000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         15060000
                                   TO DP013-MESSAGE-TEXT (2)            15070000
                   MOVE TFITEM-XFER-LNE-NBR                             15080000
                                   TO PV-DISPLAY-XFER-LNE-NBR           15090000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         15100000
                                   TO DP013-MESSAGE-TEXT (3)            15110000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        15120000
                                   TO DP013-MESSAGE-TEXT (4)            15130000
                   MOVE SQLCA      TO DP013-SQLCA                       15140000
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          15150000
                   SET DP013-DB2-ABEND                                  15160000
                       DP013-ROLLBACK                                   15170000
                                   TO TRUE                              15180000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      15190000
                   SET  DP011-MSG-FATAL                                 15200000
                                   TO TRUE                              15210000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              15220000
                       MOVE PC-TSYMSG-01063                             15230000
                                   TO DP011-MSG-NUMBER                  15240000
                   ELSE                                                 15250000
                       MOVE PC-TSYMSG-01064                             15260000
                                   TO DP011-MSG-NUMBER                  15270000
                   END-IF                                               15280000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      15290000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   15300000
           END-EVALUATE.                                                15310000
                                                                        15320000
           COMPUTE PV-NEW-XFER-LNE-SEQ-NBR  =                           15330000
               PV-XFER-LNE-SEQ-NBR + 1.                                 15340000
      *                                                                 15350000
       7350-INSERT-RTL-ITM-RCPT.                                        15360000
           MOVE TF021-RTL-RECEIVED-QTY                                  15370000
                                   TO  TFITRC-RCVD-XFER-QTY             15380000
                                               TF022-RECEIVED-QTY.      15390000
           MOVE TF021-TKT-PRICE    TO  TF022-TKT-PRICE.                 15400000
                                                                        15410000
           COMPUTE TFITRC-RCVD-XFER-PRIC-AMT  =                         15420000
               (TF021-TKT-PRICE  /  100).                               15430000
                                                                        15440000
           MOVE ZEROS              TO  TF022-XFER-QTY.                  15450000
                                                                        15460000
           MOVE TFITRC-RCVD-XFER-PRIC-AMT                               15470000
                                   TO  PV-XFER-PRIC-AMT.                15480000
                                                                        15490000
           EXEC SQL                                                     15500000
               INSERT INTO TTFITRC                                      15510000
                   (XFER_DKEY_ID,                                       15520000
                    XFER_LNE_NBR,                                       15530000
                    XFER_LNE_SEQ_NBR,                                   15540000
                    XFER_RCPT_TMST,                                     15550000
                    RCVD_XFER_QTY,                                      15560000
                    RCVD_XFER_PRIC_AMT,                                 15570000
                    RCVD_RTL_PRIC_AMT,                                  15580000
                    XFER_ITM_DSCRP_IND)                                 15590000
               VALUES                                                   15600000
                   (:DK-XFER-DKEY-ID,                                   15610000
                    :TFITEM-XFER-LNE-NBR,                               15620000
                    :TFITRC-XFER-LNE-SEQ-NBR,                           15630000
                    :TFRCPT-RCV-XFER-BEG-TMST,                          15640000
                    :TFITRC-RCVD-XFER-QTY,                              15650000
                    :TFITRC-RCVD-XFER-PRIC-AMT,                         15660000
                    :PV-CUR-RTL-AMT,                                    15670000
                    'N')                                                15680000
           END-EXEC.                                                    15690000
                                                                        15700000
           EVALUATE SQLCODE                                             15710000
               WHEN ZERO                                                15720000
                   CONTINUE                                             15730000
               WHEN OTHER                                               15740000
                   MOVE '7350-INSERT-RTL-ITM-RCPT'                      15750000
                                   TO DP013-PARAGRAPH                   15760000
                   MOVE 'INSERT XFER ITM RECEIPT FOR XFER_DKEY_ID/XFER_L15770000
      -                 'NE_NBR/XFER_RCPT_TMST: '                       15780000
                                   TO DP013-MESSAGE-TEXT (1)            15790000
                   MOVE DK-XFER-DKEY-ID                                 15800000
                                   TO PV-DISPLAY-XFER-DKEY-ID           15810000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         15820000
                                   TO DP013-MESSAGE-TEXT (2)            15830000
                   MOVE TFITEM-XFER-LNE-NBR                             15840000
                                   TO PV-DISPLAY-XFER-LNE-NBR           15850000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         15860000
                                   TO DP013-MESSAGE-TEXT (3)            15870000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        15880000
                                   TO DP013-MESSAGE-TEXT (4)            15890000
                   MOVE SQLCA      TO DP013-SQLCA                       15900000
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          15910000
                   SET DP013-DB2-ABEND                                  15920000
                       DP013-ROLLBACK                                   15930000
                                   TO TRUE                              15940000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      15950000
                   SET  DP011-MSG-FATAL                                 15960000
                                   TO TRUE                              15970000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              15980000
                       MOVE PC-TSYMSG-01063                             15990000
                                   TO DP011-MSG-NUMBER                  16000000
                   ELSE                                                 16010000
                       MOVE PC-TSYMSG-01064                             16020000
                                   TO DP011-MSG-NUMBER                  16030000
                   END-IF                                               16040000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      16050000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   16060000
           END-EVALUATE.                                                16070000
      *                                                                 16080000
       7400-SELECT-XFER-ITM-RCPT.                                       16090000
           COMPUTE DK-RCVD-XFER-PRIC-AMT  =                             16100000
               (TF021-TKT-PRICE  /  100).                               16110000
                                                                        16120000
           EXEC SQL                                                     16130000
               SELECT  XFER_LNE_SEQ_NBR,                                16140000
                       RCVD_XFER_QTY                                    16150000
                 INTO  :TFITRC-XFER-LNE-SEQ-NBR,                        16160000
                       :TFITRC-RCVD-XFER-QTY                            16170000
                 FROM  TTFITRC                                          16180000
                WHERE  (XFER_DKEY_ID        =  :DK-XFER-DKEY-ID         16190000
                  AND   XFER_LNE_NBR        =  :TFITEM-XFER-LNE-NBR     16200000
                  AND   XFER_RCPT_TMST      =  :TFRCPT-RCV-XFER-BEG-TMST16210000
                  AND   RCVD_XFER_PRIC_AMT  =  :DK-RCVD-XFER-PRIC-AMT)  16220000
                 WITH   UR                                              16230000
           END-EXEC.                                                    16240000
                                                                        16250000
           EVALUATE SQLCODE                                             16260000
               WHEN ZERO                                                16270000
               WHEN +100                                                16280000
                   CONTINUE                                             16290000
               WHEN OTHER                                               16300000
                   MOVE '7400-SELECT-XFER-ITM-RCPT'                     16310000
                                   TO DP013-PARAGRAPH                   16320000
                   MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/XFER_LNE_NBR/16330000
      -                 'RCVD_XFER_PRIC_AMT'                            16340000
                                   TO DP013-MESSAGE-TEXT (1)            16350000
                   MOVE DK-XFER-DKEY-ID                                 16360000
                                   TO PV-DISPLAY-XFER-DKEY-ID           16370000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         16380000
                                   TO DP013-MESSAGE-TEXT (2)            16390000
                   MOVE TFITEM-XFER-LNE-NBR                             16400000
                                   TO PV-DISPLAY-XFER-LNE-NBR           16410000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         16420000
                                   TO DP013-MESSAGE-TEXT (3)            16430000
                   MOVE DK-RCVD-XFER-PRIC-AMT                           16440000
                                   TO PV-DISPLAY-XFER-PRIC-AMT          16450000
                   MOVE PV-DISPLAY-XFER-PRIC-AMT                        16460000
                                   TO DP013-MESSAGE-TEXT (4)            16470000
                   MOVE SQLCA      TO DP013-SQLCA                       16480000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          16490000
                   SET DP013-DB2-ABEND                                  16500000
                       DP013-ROLLBACK                                   16510000
                                   TO TRUE                              16520000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      16530000
                   SET  DP011-MSG-FATAL                                 16540000
                                   TO TRUE                              16550000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              16560000
                       MOVE PC-TSYMSG-01063                             16570000
                                   TO DP011-MSG-NUMBER                  16580000
                   ELSE                                                 16590000
                       MOVE PC-TSYMSG-01064                             16600000
                                   TO DP011-MSG-NUMBER                  16610000
                   END-IF                                               16620000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      16630000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   16640000
           END-EVALUATE.                                                16650000
      *                                                                 16660000
       7500-UPDATE-RCVD-ITEM-QTY.                                       16670000
           COMPUTE TFITRC-RCVD-XFER-PRIC-AMT  =                         16680000
               (TF021-TKT-PRICE  /  100).                               16690000
           MOVE TFITRC-RCVD-XFER-PRIC-AMT                               16700000
                                   TO  PV-XFER-PRIC-AMT.                16710000
           MOVE PV-RECEIVED-QTY    TO  TFITRC-RCVD-XFER-QTY             16720000
                                               TF022-RECEIVED-QTY.      16730000
           MOVE TF021-TKT-PRICE    TO  TF022-TKT-PRICE.                 16740000
                                                                        16750000
           IF TFITRC-RCVD-XFER-PRIC-AMT  NOT =  TFITEM-XFER-PRIC-AMT    16760000
               MOVE ZEROS          TO  TF022-XFER-QTY                   16770000
           END-IF.                                                      16780000
                                                                        16790000
           EXEC SQL                                                     16800000
               UPDATE  TTFITRC                                          16810000
                  SET  RCVD_XFER_QTY       = :TFITRC-RCVD-XFER-QTY,     16820000
                       RCVD_RTL_PRIC_AMT   = :PV-CUR-RTL-AMT,           16830000
                       XFER_ITM_DSCRP_IND  = :PC-NO                     16840000
                WHERE  (XFER_DKEY_ID       = :DK-XFER-DKEY-ID           16850000
                  AND   XFER_LNE_NBR       = :TFITEM-XFER-LNE-NBR       16860000
                  AND   XFER_RCPT_TMST     = :TFRCPT-RCV-XFER-BEG-TMST  16870000
                  AND   RCVD_XFER_PRIC_AMT = :TFITRC-RCVD-XFER-PRIC-AMT)16880000
           END-EXEC.                                                    16890000
                                                                        16900000
           EVALUATE SQLCODE                                             16910000
               WHEN ZERO                                                16920000
                   CONTINUE                                             16930000
               WHEN OTHER                                               16940000
                   MOVE '7500-UPDATE-RCVD-ITEM-QTY'                     16950000
                                   TO DP013-PARAGRAPH                   16960000
                   MOVE 'UPDATE XFER ITEM RECEIVED QTY FOR XFER_DKEY_ID/16970000
      -                 'XFER_LNE_NBR/RCV_XFER_BEG_TMST: '              16980000
                                   TO DP013-MESSAGE-TEXT (1)            16990000
                   MOVE DK-XFER-DKEY-ID                                 17000000
                                   TO PV-DISPLAY-XFER-DKEY-ID           17010000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         17020000
                                   TO DP013-MESSAGE-TEXT (2)            17030000
                   MOVE TFITEM-XFER-LNE-NBR                             17040000
                                   TO PV-DISPLAY-XFER-LNE-NBR           17050000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         17060000
                                   TO DP013-MESSAGE-TEXT (3)            17070000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        17080000
                                   TO DP013-MESSAGE-TEXT (4)            17090000
                   MOVE SQLCA      TO DP013-SQLCA                       17100000
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          17110000
                   SET DP013-DB2-ABEND                                  17120000
                       DP013-ROLLBACK                                   17130000
                                   TO TRUE                              17140000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      17150000
                   SET  DP011-MSG-FATAL                                 17160000
                                   TO TRUE                              17170000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              17180000
                       MOVE PC-TSYMSG-01063                             17190000
                                   TO DP011-MSG-NUMBER                  17200000
                   ELSE                                                 17210000
                       MOVE PC-TSYMSG-01064                             17220000
                                   TO DP011-MSG-NUMBER                  17230000
                   END-IF                                               17240000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      17250000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   17260000
           END-EVALUATE.                                                17270000
      *                                                                 17280000
       7550-DELETE-XFER-ITEM-RCPT.                                      17290000
           MOVE TF021-TKT-PRICE    TO  TF022-TKT-PRICE.                 17300000
           IF TFITEM-XFER-PRIC-AMT  NOT =  DK-RCVD-XFER-PRIC-AMT        17310000
               MOVE ZEROS          TO  TF022-XFER-QTY                   17320000
           ELSE                                                         17330000
               MOVE TFITEM-XFER-QTY                                     17340000
                                   TO  TF022-XFER-QTY                   17350000
           END-IF.                                                      17360000
                                                                        17370000
           EXEC SQL                                                     17380000
               DELETE FROM TTFITRC                                      17390000
                WHERE  (XFER_DKEY_ID        =  :DK-XFER-DKEY-ID         17400000
                  AND   XFER_LNE_NBR        =  :TFITEM-XFER-LNE-NBR     17410000
                  AND   XFER_RCPT_TMST      =  :TFRCPT-RCV-XFER-BEG-TMST17420000
                  AND   RCVD_XFER_PRIC_AMT  =  :DK-RCVD-XFER-PRIC-AMT)  17430000
           END-EXEC.                                                    17440000
                                                                        17450000
           EVALUATE SQLCODE                                             17460000
               WHEN ZERO                                                17470000
                   CONTINUE                                             17480000
               WHEN OTHER                                               17490000
                   MOVE '7550-DELETE-XFER-ITEM-RCPT'                    17500000
                                   TO DP013-PARAGRAPH                   17510000
                   MOVE 'DELETE TRANSFER ITEM RECEIPT FOR DKEY_ID/LNE_NB17520000
      -                 'R/RCPT_TMST/RCVC_PRIC_AMT: '                   17530000
                                   TO DP013-MESSAGE-TEXT (1)            17540000
                   MOVE DK-XFER-DKEY-ID                                 17550000
                                   TO PV-DISPLAY-DELETE-DKEY-ID         17560000
                   MOVE TFITEM-XFER-LNE-NBR                             17570000
                                   TO PV-DISPLAY-DELETE-LNE-NBR         17580000
                   MOVE PV-DISPLAY-DELETE-AREA                          17590000
                                   TO DP013-MESSAGE-TEXT (2)            17600000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        17610000
                                   TO DP013-MESSAGE-TEXT (3)            17620000
                   MOVE DK-RCVD-XFER-PRIC-AMT                           17630000
                                   TO PV-DISPLAY-XFER-PRIC-AMT          17640000
                   MOVE PV-DISPLAY-XFER-PRIC-AMT                        17650000
                                   TO DP013-MESSAGE-TEXT (4)            17660000
                   MOVE SQLCA      TO DP013-SQLCA                       17670000
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          17680000
                   SET DP013-DB2-ABEND                                  17690000
                       DP013-ROLLBACK                                   17700000
                                   TO TRUE                              17710000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      17720000
                   SET  DP011-MSG-FATAL                                 17730000
                                   TO TRUE                              17740000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              17750000
                       MOVE PC-TSYMSG-01063                             17760000
                                   TO DP011-MSG-NUMBER                  17770000
                   ELSE                                                 17780000
                       MOVE PC-TSYMSG-01064                             17790000
                                   TO DP011-MSG-NUMBER                  17800000
                   END-IF                                               17810000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      17820000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   17830000
           END-EVALUATE.                                                17840000
      *                                                                 17850000
       7600-SELECT-XFER-ITEM.                                           17860000
           EXEC SQL                                                     17870000
               SELECT  XFER_QTY                                         17880000
                 INTO  :TFITEM-XFER-QTY                                 17890000
                 FROM  TTFITEM                                          17900000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID               17910000
                  AND   XFER_LNE_NBR  =  :TFITEM-XFER-LNE-NBR)          17920000
                 WITH  UR                                               17930000
           END-EXEC.                                                    17940000
                                                                        17950000
           EVALUATE SQLCODE                                             17960000
               WHEN ZERO                                                17970000
                   CONTINUE                                             17980000
               WHEN OTHER                                               17990000
                   MOVE '7600-SELECT-XFER-ITEM'                         18000000
                                   TO DP013-PARAGRAPH                   18010000
                   MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/XFER_LNE_NBR:18020000
      -                 ' '        TO DP013-MESSAGE-TEXT (1)            18030000
                   MOVE DK-XFER-DKEY-ID                                 18040000
                                   TO PV-DISPLAY-XFER-DKEY-ID           18050000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         18060000
                                   TO DP013-MESSAGE-TEXT (2)            18070000
                   MOVE TFITEM-XFER-LNE-NBR                             18080000
                                   TO PV-DISPLAY-XFER-LNE-NBR           18090000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         18100000
                                   TO DP013-MESSAGE-TEXT (3)            18110000
                   MOVE SQLCA      TO DP013-SQLCA                       18120000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          18130000
                   SET DP013-DB2-ABEND                                  18140000
                       DP013-ROLLBACK                                   18150000
                                   TO TRUE                              18160000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      18170000
                   SET  DP011-MSG-FATAL                                 18180000
                                   TO TRUE                              18190000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              18200000
                       MOVE PC-TSYMSG-01063                             18210000
                                   TO DP011-MSG-NUMBER                  18220000
                   ELSE                                                 18230000
                       MOVE PC-TSYMSG-01064                             18240000
                                   TO DP011-MSG-NUMBER                  18250000
                   END-IF                                               18260000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      18270000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   18280000
           END-EVALUATE.                                                18290000
      *                                                                 18300000
       7650-DELETE-XFER-ITEM.                                           18310000
           EXEC SQL                                                     18320000
               DELETE FROM TTFITEM                                      18330000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID               18340000
                  AND   XFER_LNE_NBR  =  :TFITEM-XFER-LNE-NBR)          18350000
           END-EXEC.                                                    18360000
                                                                        18370000
           EVALUATE SQLCODE                                             18380000
               WHEN ZERO                                                18390000
                   CONTINUE                                             18400000
               WHEN OTHER                                               18410000
                   MOVE '7650-DELETE-XFER-ITEM'                         18420000
                                   TO DP013-PARAGRAPH                   18430000
                   MOVE 'DELETE TRANSFER ITEM FOR XFER_DKEY_ID/XFER_LNE_18440000
      -                 'NBR: '    TO DP013-MESSAGE-TEXT (1)            18450000
                   MOVE DK-XFER-DKEY-ID                                 18460000
                                   TO PV-DISPLAY-XFER-DKEY-ID           18470000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         18480000
                                   TO DP013-MESSAGE-TEXT (2)            18490000
                   MOVE TFITEM-XFER-LNE-NBR                             18500000
                                   TO PV-DISPLAY-XFER-LNE-NBR           18510000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         18520000
                                   TO DP013-MESSAGE-TEXT (3)            18530000
                   MOVE SQLCA      TO DP013-SQLCA                       18540000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          18550000
                   SET DP013-DB2-ABEND                                  18560000
                       DP013-ROLLBACK                                   18570000
                                   TO TRUE                              18580000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      18590000
                   SET  DP011-MSG-FATAL                                 18600000
                                   TO TRUE                              18610000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              18620000
                       MOVE PC-TSYMSG-01063                             18630000
                                   TO DP011-MSG-NUMBER                  18640000
                   ELSE                                                 18650000
                       MOVE PC-TSYMSG-01064                             18660000
                                   TO DP011-MSG-NUMBER                  18670000
                   END-IF                                               18680000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      18690000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   18700000
           END-EVALUATE.                                                18710000
      *                                                                 18720000
       7700-UPDATE-NON-RTL-ITM-RCPT.                                    18730000
           MOVE TF021-LINE-NBR (NON-RTL-IDX)                            18740000
                                   TO TFITRC-XFER-LNE-NBR.              18750000
                                                                        18760000
           MOVE TF021-NON-RTL-RECEIVED-QTY (NON-RTL-IDX)                18770000
                                   TO TFITRC-RCVD-XFER-QTY.             18780000
                                                                        18790000
           EXEC SQL                                                     18800000
               UPDATE  TTFITRC                                          18810000
                  SET  RCVD_XFER_QTY    =  :TFITRC-RCVD-XFER-QTY        18820000
                WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID             18830000
                  AND   XFER_LNE_NBR    =  :TFITRC-XFER-LNE-NBR         18840000
                  AND   XFER_RCPT_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)   18850000
           END-EXEC.                                                    18860000
                                                                        18870000
           EVALUATE SQLCODE                                             18880000
               WHEN ZERO                                                18890000
                   CONTINUE                                             18900000
               WHEN OTHER                                               18910000
                   MOVE '7700-UPDATE-NON-RTL-ITM-RCPT'                  18920000
                                   TO DP013-PARAGRAPH                   18930000
                   MOVE 'UPDATE NON-RETAIL ITEM RECEIPT FOR XFER_DKEY_ID18940000
      -                 '/XFER_LNE_NBR/XFER_RCPT_TMST: '                18950000
                                   TO DP013-MESSAGE-TEXT (1)            18960000
                   MOVE DK-XFER-DKEY-ID                                 18970000
                                   TO PV-DISPLAY-XFER-DKEY-ID           18980000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         18990000
                                   TO DP013-MESSAGE-TEXT (2)            19000000
                   MOVE TFITRC-XFER-LNE-NBR                             19010000
                                   TO PV-DISPLAY-XFER-LNE-NBR           19020000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         19030000
                                   TO DP013-MESSAGE-TEXT (3)            19040000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        19050000
                                   TO DP013-MESSAGE-TEXT (4)            19060000
                   MOVE SQLCA      TO DP013-SQLCA                       19070000
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          19080000
                   SET DP013-DB2-ABEND                                  19090000
                       DP013-ROLLBACK                                   19100000
                                   TO TRUE                              19110000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      19120000
                   SET  DP011-MSG-FATAL                                 19130000
                                   TO TRUE                              19140000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              19150000
                       MOVE PC-TSYMSG-01063                             19160000
                                   TO DP011-MSG-NUMBER                  19170000
                   ELSE                                                 19180000
                       MOVE PC-TSYMSG-01064                             19190000
                                   TO DP011-MSG-NUMBER                  19200000
                   END-IF                                               19210000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      19220000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   19230000
           END-EVALUATE.                                                19240000
      *                                                                 19250000
       7750-GET-CLR-ITM-1ST-MKDN-PRIC.                                  19260000
           INITIALIZE DCLTPPCPRC.                                       19270000
           MOVE XST00008-LOC-SKU-STAT-CDE                               19280000
                                  TO PV-LOC-SKU-STAT-CDE.               19290000
           MOVE PV-STATUS-CODE-N  TO PV-STATUS-CDE.                     19300000
                                                                        19310000
           EXEC SQL                                                     19320000
               SELECT  MAX(RTL_AMT)                                     19330000
                 INTO  :PPCPRC-RTL-AMT                                  19340000
                 FROM  TPPCPRC                                          19350000
                WHERE  (TSK_ITM_NBR  =  :SKXREF-ITM-NBR                 19360000
                  AND   STR_NBR      =  :PC-ZERO                        19370000
                  AND   STATUS_CDE   =  :PV-STATUS-CDE)                 19380000
                 WITH   UR                                              19390000
           END-EXEC.                                                    19400000
                                                                        19410000
           EVALUATE SQLCODE                                             19420000
               WHEN ZERO                                                19430000
                   CONTINUE                                             19440000
               WHEN -305                                                19450000
                   MOVE +0 TO PPCPRC-RTL-AMT                            19460000
               WHEN OTHER                                               19470000
                   MOVE '7750-GET-CLR-ITM-1ST-MKDN-PRIC'                19480000
                                   TO DP013-PARAGRAPH                   19490000
                   MOVE 'SELECT THE 1ST MARKDOWN PRICE FOR A CLEARANCE I19500000
      -                 'TEM.  SKXREF-ITM-NBR:'                         19510000
                                   TO DP013-MESSAGE-TEXT (1)            19520000
                   MOVE SKXREF-ITM-NBR                                  19530000
                                   TO PV-DISPLAY-ITM-NBR                19540000
                   MOVE PV-DISPLAY-ITM-NBR                              19550000
                                   TO DP013-MESSAGE-TEXT (2)            19560000
                   MOVE SQLCA      TO DP013-SQLCA                       19570000
                   MOVE 'TPPCPRC'  TO DP013-DB2-TABLE-NAME (1)          19580000
                   SET DP013-DB2-ABEND                                  19590000
                       DP013-ROLLBACK                                   19600000
                                   TO TRUE                              19610000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      19620000
                   SET  DP011-MSG-FATAL                                 19630000
                                   TO TRUE                              19640000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              19650000
                       MOVE PC-TSYMSG-01063                             19660000
                                   TO DP011-MSG-NUMBER                  19670000
                   ELSE                                                 19680000
                       MOVE PC-TSYMSG-01064                             19690000
                                   TO DP011-MSG-NUMBER                  19700000
                   END-IF                                               19710000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      19720000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   19730000
           END-EVALUATE.                                                19740000
      *                                                                 19750000
       7800-UPDATE-RTL-ITM-RCPT.                                        19760000
           MOVE ZEROS              TO  TFITRC-RCVD-XFER-QTY.            19770000
           MOVE TF021-TKT-PRICE    TO  TF022-TKT-PRICE.                 19780000
           MOVE 1                  TO  TFITRC-XFER-LNE-SEQ-NBR.         19790000
                                                                        19800000
           EXEC SQL                                                     19810000
               UPDATE  TTFITRC                                          19820000
                  SET  RCVD_XFER_QTY      =  :TFITRC-RCVD-XFER-QTY      19830000
                WHERE  (XFER_DKEY_ID      =  :DK-XFER-DKEY-ID           19840000
                  AND   XFER_LNE_NBR      =  :TFITEM-XFER-LNE-NBR       19850000
                  AND   XFER_LNE_SEQ_NBR  =  :TFITRC-XFER-LNE-SEQ-NBR   19860000
                  AND   XFER_RCPT_TMST    =  :TFRCPT-RCV-XFER-BEG-TMST) 19870000
           END-EXEC.                                                    19880000
                                                                        19890000
           EVALUATE SQLCODE                                             19900000
               WHEN ZERO                                                19910000
                   CONTINUE                                             19920000
               WHEN OTHER                                               19930000
                   MOVE '7800-UPDATE-RTL-ITM-RCPT'                      19940000
                                   TO DP013-PARAGRAPH                   19950000
                   MOVE 'UPD RTL ITM TO 0 FOR XFER_DKEY_ID/XFER_LNE_NBR/19960000
      -                 'XFER_LNE_SEQ_NBR/XFER_RCPT_TMST: '             19970000
                                   TO DP013-MESSAGE-TEXT (1)            19980000
                   MOVE DK-XFER-DKEY-ID                                 19990000
                                   TO PV-DISPLAY-DELETE-DKEY-ID         20000000
                   MOVE TFITEM-XFER-LNE-NBR                             20010000
                                   TO PV-DISPLAY-DELETE-LNE-NBR         20020000
                   MOVE PV-DISPLAY-DELETE-AREA                          20030000
                                   TO DP013-MESSAGE-TEXT (2)            20040000
                   MOVE TFITRC-XFER-LNE-SEQ-NBR                         20050000
                                   TO  PV-DISPLAY-XFER-LNE-SEQ-NBR      20060000
                   MOVE PV-DISPLAY-XFER-LNE-SEQ-NBR                     20070000
                                   TO DP013-MESSAGE-TEXT (3)            20080000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        20090000
                                   TO DP013-MESSAGE-TEXT (4)            20100000
                   MOVE SQLCA      TO DP013-SQLCA                       20110000
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          20120000
                   SET DP013-DB2-ABEND                                  20130000
                       DP013-ROLLBACK                                   20140000
                                   TO TRUE                              20150000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      20160000
                   SET  DP011-MSG-FATAL                                 20170000
                                   TO TRUE                              20180000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              20190000
                       MOVE PC-TSYMSG-01063                             20200000
                                   TO DP011-MSG-NUMBER                  20210000
                   ELSE                                                 20220000
                       MOVE PC-TSYMSG-01064                             20230000
                                   TO DP011-MSG-NUMBER                  20240000
                   END-IF                                               20250000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      20260000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   20270000
           END-EVALUATE.                                                20280000
      *                                                                 20290000
       7850-SELECT-XFER.                                                20300000
           INITIALIZE DCLTTFMSTR.                                       20310000
                                                                        20320000
           EXEC SQL                                                     20330000
               SELECT  FR_STR_NBR,                                      20340000
                       XFER_SEQ_NBR,                                    20350000
                       XFER_TYP_CDE                                     20360000
                 INTO  :TFMSTR-FR-STR-NBR,                              20370000
                       :TFMSTR-XFER-SEQ-NBR,                            20380000
                       :TFMSTR-XFER-TYP-CDE                             20390000
                 FROM  TTFMSTR                                          20400000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)              20410000
                 WITH  UR                                               20420000
           END-EXEC.                                                    20430000
                                                                        20440000
           EVALUATE SQLCODE                                             20450000
               WHEN ZERO                                                20460000
                   CONTINUE                                             20470000
               WHEN -904                                                20480000
               WHEN -913                                                20490000
                   SET  DP011-MSG-FATAL                                 20500000
                                   TO TRUE                              20510000
                   MOVE PC-TSYMSG-01063                                 20520000
                                   TO DP011-MSG-NUMBER                  20530000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      20540000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   20550000
               WHEN OTHER                                               20560000
                   MOVE '7850-SELECT-XFER'                              20570000
                                   TO DP013-PARAGRAPH                   20580000
                   MOVE 'SELECT TRANSFER FOR XFER_DKEY_ID: '            20590000
                                   TO DP013-MESSAGE-TEXT (1)            20600000
                   MOVE DK-XFER-DKEY-ID                                 20610000
                                   TO PV-DISPLAY-XFER-DKEY-ID           20620000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         20630000
                                   TO DP013-MESSAGE-TEXT (2)            20640000
                   MOVE SQLCA      TO DP013-SQLCA                       20650000
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          20660000
                   SET DP013-DB2-ABEND                                  20670000
                       DP013-NO-ROLLBACK                                20680000
                                   TO TRUE                              20690000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      20700000
                   SET  DP011-MSG-FATAL                                 20710000
                                   TO TRUE                              20720000
                   MOVE PC-TSYMSG-01064                                 20730000
                                   TO DP011-MSG-NUMBER                  20740000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      20750000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   20760000
           END-EVALUATE.                                                20770000
      *                                                                 20780000
      ******************************************************************20790000
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  20800000
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           20810000
      ******************************************************************20820000
       8000-SEND-DATA-TO-LISTENER.                                      20830000
           IF TF021-MQ-INDICATOR-Y                                      20840000
               PERFORM 8500-MQ-SETUP                                    20850000
               PERFORM 8510-MQ-SETUP-REMOTE                             20860000
               PERFORM 8520-PUT-QUEUE                                   20870000
               PERFORM 8600-CLOSE-PUT-Q                                 20880000
               PERFORM 8610-DISCONNECT-QMGR                             20890000
               PERFORM 9100-EXEC-CICS-RETURN                            20900000
           ELSE                                                         20910000
               PERFORM 8110-ENQ-TCPIPPRQ                                20920000
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      20930000
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      20940000
                                                                        20950000
      *MUST BE HERE                                                     20960000
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   20970000
      *MUST BE HERE                                                     20980000
               ADD 1               TO PV-NEXT-RECORD                    20990000
                                                                        21000000
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     21010000
                   MOVE 3          TO PV-NEXT-RECORD                    21020000
               END-IF                                                   21030000
                                                                        21040000
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    21050000
               PERFORM 8160-DEQ-TCPIPPRQ                                21060000
                                                                        21070000
               PERFORM 9100-EXEC-CICS-RETURN                            21080000
           END-IF.                                                      21090000
      *                                                                 21100000
      ******************************************************************21110000
       8110-ENQ-TCPIPPRQ.                                               21120000
           EXEC CICS                                                    21130000
               ENQ                                                      21140000
                   RESOURCE  (PV-TSQ-NAME)                              21150000
                   RESP      (PV-CICS-RESPONSE)                         21160000
           END-EXEC.                                                    21170000
                                                                        21180000
           EVALUATE TRUE                                                21190000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 21200000
                   CONTINUE                                             21210000
               WHEN OTHER                                               21220000
                   MOVE '8110-ENQ-TCPIPPRQ'                             21230000
                                   TO DP013-PARAGRAPH                   21240000
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q21250000
      -                 'UEUE: '                                        21260000
                                   TO DP013-MESSAGE-TEXT (1)            21270000
                   MOVE PV-TSQ-NAME                                     21280000
                                   TO DP013-MESSAGE-TEXT (2)            21290000
                   SET DP013-CICS-ABEND                                 21300000
                       DP013-NO-ROLLBACK                                21310000
                                   TO TRUE                              21320000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      21330000
                   PERFORM 9100-EXEC-CICS-RETURN                        21340000
           END-EVALUATE.                                                21350000
      *                                                                 21360000
      ******************************************************************21370000
       8120-READQ-TCPIPPRQ-RECORD1.                                     21380000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           21390000
                                   TO PV-TSQ-LENGTH.                    21400000
                                                                        21410000
           EXEC CICS                                                    21420000
               READQ TS                                                 21430000
                   QUEUE   (PV-TSQ-NAME)                                21440000
                   INTO    (PV-TCPIPPRQ-RECORD1)                        21450000
                   LENGTH  (PV-TSQ-LENGTH)                              21460000
                   ITEM    (1)                                          21470000
                   RESP    (PV-CICS-RESPONSE)                           21480000
           END-EXEC.                                                    21490000
                                                                        21500000
           EVALUATE TRUE                                                21510000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 21520000
                   CONTINUE                                             21530000
               WHEN OTHER                                               21540000
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   21550000
                                   TO DP013-PARAGRAPH                   21560000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 21570000
      -                 'QUEUE: '                                       21580000
                                   TO DP013-MESSAGE-TEXT (1)            21590000
                   MOVE PV-TSQ-NAME                                     21600000
                                   TO DP013-MESSAGE-TEXT (2)            21610000
                   SET DP013-CICS-ABEND                                 21620000
                       DP013-NO-ROLLBACK                                21630000
                                   TO TRUE                              21640000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      21650000
                   PERFORM 9100-EXEC-CICS-RETURN                        21660000
           END-EVALUATE.                                                21670000
      *                                                                 21680000
      ******************************************************************21690000
       8130-READQ-TCPIPPRQ-RECORD2.                                     21700000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           21710000
                                   TO PV-TSQ-LENGTH.                    21720000
                                                                        21730000
           EXEC CICS                                                    21740000
               READQ TS                                                 21750000
                   QUEUE   (PV-TSQ-NAME)                                21760000
                   INTO    (PV-TCPIPPRQ-RECORD2)                        21770000
                   LENGTH  (PV-TSQ-LENGTH)                              21780000
                   ITEM    (2)                                          21790000
                   RESP    (PV-CICS-RESPONSE)                           21800000
           END-EXEC.                                                    21810000
                                                                        21820000
           EVALUATE TRUE                                                21830000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 21840000
                   CONTINUE                                             21850000
               WHEN OTHER                                               21860000
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   21870000
                                   TO DP013-PARAGRAPH                   21880000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 21890000
      -                 'QUEUE: '                                       21900000
                                   TO DP013-MESSAGE-TEXT (1)            21910000
                   MOVE PV-TSQ-NAME                                     21920000
                                   TO DP013-MESSAGE-TEXT (2)            21930000
                   SET DP013-CICS-ABEND                                 21940000
                       DP013-NO-ROLLBACK                                21950000
                                   TO TRUE                              21960000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      21970000
                   PERFORM 9100-EXEC-CICS-RETURN                        21980000
           END-EVALUATE.                                                21990000
      *                                                                 22000000
      ******************************************************************22010000
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  22020000
           MOVE LENGTH OF TF022-XFER-TO-PTC-RECORD                      22030000
                                   TO  TF022-TOT-REC-LENGTH.            22040000
                                                                        22050000
           MOVE TF021-MATCHING-NBR-FIELD                                22060000
                                   TO  TF022-MATCHING-NBR-FIELD.        22070000
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     22080000
                                                                        22090000
           EXEC CICS                                                    22100000
               WRITEQ TS                                                22110000
                   QUEUE   (PV-TSQ-NAME)                                22120000
                   FROM    (TF022-XFER-TO-PTC-RECORD)                   22130000
                   LENGTH  (PV-TSQ-LENGTH)                              22140000
                   ITEM    (PV-ITEM-NBR)                                22150000
                       REWRITE                                          22160000
                   RESP    (PV-CICS-RESPONSE)                           22170000
           END-EXEC.                                                    22180000
                                                                        22190000
           EVALUATE TRUE                                                22200000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 22210000
                   CONTINUE                                             22220000
               WHEN OTHER                                               22230000
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                22240000
                                   TO DP013-PARAGRAPH                   22250000
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA22260000
      -                 'STORAGE QUEUE: '                               22270000
                                   TO DP013-MESSAGE-TEXT (1)            22280000
                   MOVE PV-TSQ-NAME                                     22290000
                                   TO DP013-MESSAGE-TEXT (2)            22300000
                   SET DP013-CICS-ABEND                                 22310000
                       DP013-NO-ROLLBACK                                22320000
                                   TO TRUE                              22330000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      22340000
                   PERFORM 9100-EXEC-CICS-RETURN                        22350000
           END-EVALUATE.                                                22360000
      *                                                                 22370000
      ******************************************************************22380000
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   22390000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           22400000
                                   TO PV-TSQ-LENGTH.                    22410000
           MOVE +1                 TO PV-ITEM-NBR.                      22420000
                                                                        22430000
           EXEC CICS                                                    22440000
               WRITEQ TS                                                22450000
                   QUEUE   (PV-TSQ-NAME)                                22460000
                   FROM    (PV-TCPIPPRQ-RECORD1)                        22470000
                   LENGTH  (PV-TSQ-LENGTH)                              22480000
                   ITEM    (PV-ITEM-NBR)                                22490000
                       REWRITE                                          22500000
                   RESP    (PV-CICS-RESPONSE)                           22510000
           END-EXEC.                                                    22520000
                                                                        22530000
           EVALUATE TRUE                                                22540000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 22550000
                   CONTINUE                                             22560000
               WHEN OTHER                                               22570000
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 22580000
                                   TO DP013-PARAGRAPH                   22590000
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   22600000
                                   TO DP013-MESSAGE-TEXT (1)            22610000
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     22620000
                                   TO DP013-MESSAGE-TEXT (2)            22630000
                   MOVE PV-TSQ-NAME                                     22640000
                                   TO DP013-MESSAGE-TEXT (3)            22650000
                   MOVE PV-TCPIPPRQ-RECORD1                             22660000
                                   TO DP013-MESSAGE-TEXT (4)            22670000
                   SET DP013-CICS-ABEND                                 22680000
                       DP013-NO-ROLLBACK                                22690000
                                   TO TRUE                              22700000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      22710000
                   PERFORM 9100-EXEC-CICS-RETURN                        22720000
           END-EVALUATE.                                                22730000
      *                                                                 22740000
      ******************************************************************22750000
       8160-DEQ-TCPIPPRQ.                                               22760000
           EXEC CICS                                                    22770000
               DEQ                                                      22780000
                   RESOURCE  (PV-TSQ-NAME)                              22790000
                   RESP      (PV-CICS-RESPONSE)                         22800000
           END-EXEC.                                                    22810000
                                                                        22820000
           EVALUATE TRUE                                                22830000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 22840000
                   CONTINUE                                             22850000
               WHEN OTHER                                               22860000
                   MOVE '8160-DEQ-TCPIPPRQ'                             22870000
                                   TO DP013-PARAGRAPH                   22880000
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q22890000
      -                 'UEUE: '                                        22900000
                                   TO DP013-MESSAGE-TEXT (1)            22910000
                   MOVE PV-TSQ-NAME                                     22920000
                                   TO DP013-MESSAGE-TEXT (2)            22930000
                   SET DP013-CICS-ABEND                                 22940000
                       DP013-NO-ROLLBACK                                22950000
                                   TO TRUE                              22960000
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        22970000
                 PERFORM 9100-EXEC-CICS-RETURN                          22980000
           END-EVALUATE.                                                22990000
                                                                        23000000
       8500-MQ-SETUP.                                                   23010000
                                                                        23020000
      * DETERMINE THE SYSTEM                                            23030000
                                                                        23040000
           PERFORM EP000-0000-INITIALIZE.                               23050000
           IF EP000-PV-KOHLS-PROD-SYSTEM                                23060000
               SET PV-PROD-QMGR-NAME                                    23070000
                                   TO TRUE                              23080000
           ELSE                                                         23090000
                IF EP000-PV-KOHLS-QA-SYSTEM                             23100000
                    SET PV-QA-QMGR-NAME                                 23110000
                                   TO TRUE                              23120000
                ELSE                                                    23130000
                    SET PV-TEST-QMGR-NAME                               23140000
                                   TO TRUE                              23150000
                END-IF                                                  23160000
           END-IF.                                                      23170000
                                                                        23180000
      ***************************************************************   23190000
      *    CONNECT TO THE QUEUE MANAGER                                 23200000
      ***************************************************************   23210000
                                                                        23220000
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       23230000
           CALL WS-MQCONN USING PV-QM-NAME                              23240000
                                PV-HCONN                                23250000
                                PV-COMPLETION-CODE                      23260000
                                PV-REASON.                              23270000
                                                                        23280000
      ***************************************************************   23290000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              23300000
      *    AND EXIT                                                     23310000
      ***************************************************************   23320000
                                                                        23330000
           MOVE PV-REASON          TO PV-CON-REASON.                    23340000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   23350000
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  23360000
               MOVE '8500-MQ-SETUP'                                     23370000
                                   TO DP013-PARAGRAPH                   23380000
               MOVE  PV-ERROR-MESSAGE                                   23390000
                                   TO DP013-MESSAGE-TEXT (1)            23400000
               MOVE  PV-COMPLETION-CODE                                 23410000
                                   TO DP013-MESSAGE-TEXT (2)            23420000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            23430000
               SET DP013-CICS-ABEND                                     23440000
                   DP013-NO-ROLLBACK                                    23450000
                                   TO TRUE                              23460000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          23470000
               PERFORM 9100-EXEC-CICS-RETURN                            23480000
           END-IF.                                                      23490000
                                                                        23500000
                                                                        23510000
       8510-MQ-SETUP-REMOTE.                                            23520000
      ***************************************************************   23530000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     23540000
      *    THIS IS A REMOTE QUEUE.                                      23550000
      ***************************************************************   23560000
                                                                        23570000
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      23580000
                                     MQOO-FAIL-IF-QUIESCING.            23590000
                                                                        23600000
           MOVE TF021-REPLYTOQ     TO MQOD-OBJECTNAME.                  23610000
           MOVE TF021-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              23620000
                                                                        23630000
           CALL WS-MQOPEN USING PV-HCONN                                23640000
                                MQM-OBJECT-DESCRIPTOR                   23650000
                                PV-OPEN-OPTIONS                         23660000
                                PV-PQ-HANDLE                            23670000
                                PV-COMPLETION-CODE                      23680000
                                PV-REASON.                              23690000
                                                                        23700000
      ********************************************************          23710000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    23720000
      *    AND EXIT.                                                    23730000
      ********************************************************          23740000
      *                                                                 23750000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   23760000
               PERFORM 8600-CLOSE-PUT-Q                                 23770000
               PERFORM 8610-DISCONNECT-QMGR                             23780000
               MOVE 'MQOPEN WRITE Q'                                    23790000
                                   TO PV-ERROR-MESSAGE                  23800000
               MOVE '8510-MQ-SETUP-REMOTE'                              23810000
                                   TO DP013-PARAGRAPH                   23820000
               MOVE  PV-ERROR-MESSAGE                                   23830000
                                   TO DP013-MESSAGE-TEXT (1)            23840000
               MOVE  PV-COMPLETION-CODE                                 23850000
                                   TO DP013-MESSAGE-TEXT (2)            23860000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            23870000
               SET DP013-CICS-ABEND                                     23880000
                   DP013-NO-ROLLBACK                                    23890000
                                   TO TRUE                              23900000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          23910000
               PERFORM 9100-EXEC-CICS-RETURN                            23920000
           END-IF.                                                      23930000
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          23940000
      *                                                                 23950000
      ******************************************************************23960000
       8520-PUT-QUEUE.                                                  23970000
           MOVE TF021-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              23980000
           MOVE TF021-REPLYTOQ     TO MQOD-OBJECTNAME.                  23990000
           MOVE TF021-MSGID        TO MQMD-CORRELID.                    24000000
           MOVE MQMI-NONE          TO MQMD-MSGID.                       24010000
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      24020000
           MOVE 5000               TO MQMD-EXPIRY.                      24030000
           MOVE LENGTH OF TF022-XFER-TO-PTC-RECORD                      24040000
                                   TO PV-DATA-LENGTH.                   24050000
           MOVE TF022-XFER-TO-PTC-RECORD                                24060000
                                   TO PV-MSGBUFFER.                     24070000
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 24080000
                                                                        24090000
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      24100000
                                                                        24110000
                                                                        24120000
                                                                        24130000
           CALL WS-MQPUT USING PV-HCONN                                 24140000
                               PV-FMT-OPEN-OUTPUT-HNDL                  24150000
                               MQM-MESSAGE-DESCRIPTOR                   24160000
                               MQM-PUT-MESSAGE-OPTIONS                  24170000
                               PV-DATA-LENGTH                           24180000
                               PV-MSGBUFFER                             24190000
                               PV-COMPLETION-CODE                       24200000
                               PV-REASON.                               24210000
                                                                        24220000
      ***********************************************************       24230000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 24240000
      *        AND BREAK OUT OF LOOP                                    24250000
      ***********************************************************       24260000
                                                                        24270000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   24280000
               MOVE PV-COMPLETION-CODE                                  24290000
                                   TO PH-COMPLETION-CODE                24300000
               MOVE PV-REASON      TO PH-REASON                         24310000
               PERFORM 8600-CLOSE-PUT-Q                                 24320000
               PERFORM 8610-DISCONNECT-QMGR                             24330000
               MOVE 'MQPUT ERR'    TO PV-ERROR-MESSAGE                  24340000
               MOVE '8520-PUT-QUEUE'                                    24350000
                                   TO DP013-PARAGRAPH                   24360000
               MOVE PV-ERROR-MESSAGE                                    24370000
                                   TO DP013-MESSAGE-TEXT (1)            24380000
               MOVE PH-COMPLETION-CODE                                  24390000
                                   TO DP013-MESSAGE-TEXT (2)            24400000
               MOVE PH-REASON      TO DP013-MESSAGE-TEXT (3)            24410000
               SET DP013-CICS-ABEND                                     24420000
                   DP013-NO-ROLLBACK                                    24430000
                                   TO TRUE                              24440000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          24450000
               PERFORM 9100-EXEC-CICS-RETURN                            24460000
           ELSE                                                         24470000
               SET PS-MQPUT-SUCCESSFUL                                  24480000
                                   TO TRUE                              24490000
           END-IF.                                                      24500000
      *                                                                 24510000
      ******************************************************************24520000
       8600-CLOSE-PUT-Q.                                                24530000
           CALL WS-MQCLOSE USING PV-HCONN                               24540000
                                 PV-PQ-HANDLE                           24550000
                                 MQCO-NONE                              24560000
                                 PV-COMPLETION-CODE                     24570000
                                 PV-REASON.                             24580000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   24590000
               MOVE 'MQCLOSE PQ HANDLE'                                 24600000
                                   TO PV-ERROR-MESSAGE                  24610000
               MOVE '8600-CLOSE-PUT-Q'                                  24620000
                                   TO DP013-PARAGRAPH                   24630000
               MOVE  PV-ERROR-MESSAGE                                   24640000
                                   TO DP013-MESSAGE-TEXT (1)            24650000
               MOVE  PV-COMPLETION-CODE                                 24660000
                                   TO DP013-MESSAGE-TEXT (2)            24670000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            24680000
               SET DP013-CICS-ABEND                                     24690000
                   DP013-NO-ROLLBACK                                    24700000
                                   TO TRUE                              24710000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          24720000
               PERFORM 9100-EXEC-CICS-RETURN                            24730000
           END-IF.                                                      24740000
      *                                                                 24750000
      ******************************************************************24760000
       8610-DISCONNECT-QMGR.                                            24770000
                                                                        24780000
           IF PV-CON-REASON IS NOT EQUAL                                24790000
                                   TO MQRC-ALREADY-CONNECTED            24800000
              CALL WS-MQDISC USING PV-HCONN                             24810000
                                   PV-COMPLETION-CODE                   24820000
                                   PV-REASON                            24830000
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                24840000
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  24850000
                  MOVE '8610-DISCONNECT'                                24860000
                                   TO DP013-PARAGRAPH                   24870000
                  MOVE PV-ERROR-MESSAGE                                 24880000
                                   TO DP013-MESSAGE-TEXT (1)            24890000
                  MOVE PV-COMPLETION-CODE                               24900000
                                   TO DP013-MESSAGE-TEXT (2)            24910000
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            24920000
                  SET DP013-CICS-ABEND                                  24930000
                      DP013-NO-ROLLBACK                                 24940000
                                   TO TRUE                              24950000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       24960000
                  PERFORM 9100-EXEC-CICS-RETURN                         24970000
              END-IF                                                    24980000
           END-IF.                                                      24990000
                                                                        25000000
      *                                                                 25010000
      ******************************************************************25020000
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          25030000
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   25040000
      *    STREAM BEING SENT BACK TO THE PTC.                           25050000
      ******************************************************************25060000
       9000-FMT-ERR-MSG-TO-PTC.                                         25070000
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         25080000
           MOVE DP011-MSG-LEVEL    TO  TF022-ERR-TYP-IND.               25090000
           MOVE DP011-MSG-TEXT     TO  TF022-ERR-MSG.                   25100000
      *                                                                 25110000
       9100-EXEC-CICS-RETURN.                                           25120000
           EXEC CICS                                                    25130000
               RETURN                                                   25140000
           END-EXEC.                                                    25150000
      *                                                                 25160000
       9999-WRITE-CICS-LOG-MSG.                                         25170000
           MOVE PC-CURRENT-PROGRAM-NAME                                 25180000
                                   TO  DP013-PROGRAM.                   25190000
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  25200000
                                                                        25210000
           INITIALIZE DP013-SRC-TASK-NUMBER                             25220000
                      DP013-STACK.                                      25230000
                                                                        25240000
           SET DP013-LINK-RETURN   TO  TRUE.                            25250000
                                                                        25260000
           EXEC CICS                                                    25270000
               LINK                                                     25280000
                   PROGRAM   (DP013-NAME)                               25290000
                   COMMAREA  (DP013-PARAMETERS)                         25300000
                   LENGTH    (DP013-LENGTH)                             25310000
           END-EXEC.                                                    25320000
                                                                        25330000
      *                                                                 25340000
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           25350000
      *                                                                 25360000
                                                                        25370000
           COPY DPPD011.                                                25380000
      *                                                                 25390000
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     25400000
      *                                                                 25410000
                                                                        25420000
           COPY DPPD014.                                                25430000
                                                                        25440000
           COPY EPPD000.                                                25450000
