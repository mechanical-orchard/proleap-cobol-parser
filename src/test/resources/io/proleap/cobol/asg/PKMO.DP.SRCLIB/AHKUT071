000100 IDENTIFICATION DIVISION.                                         00010005
000200 PROGRAM-ID.    AHKUT071.                                         00020005
000300 AUTHOR.        AYAN (COGNIZANT).                                 00030005
000400 INSTALLATION.  KOHLS.                                            00040005
000500 DATE-WRITTEN   JAN, 2014.                                        00050012
000600 DATE-COMPILED.                                                   00060005
000700                                                                  00070005
000800* ************************************************************** *00080005
000900* * AHKUT071.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.    * *00090007
001000* *                                                            * *00100005
001100* * PURPOSE:                                                   * *00110005
001200* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TAURECD.        * *00120005
001300* * EXTRACT FILE IS LOADED TO THE "ARCHIVE/HISTORY" VERSIONS   * *00130005
001400* * OF THE TABLES                                              * *00140006
001500* *                                                            * *00150006
001600* * PROCESSING OVERVIEW:                                       * *00160006
001700* * THIS PROGRAM READS A "DRIVER" FILE. FOR EACH ORDER NUMBER  * *00170006
001800* * READ,                                                      * *00180005
001900* * 1) IT INCREMENTS COUNT OF RECORDS READ FROM INPUT FILE.    * *00190005
002000* * 2) ATTEMPTS TO FIND RELATED ROW(S) ON THE TABLE.           * *00200005
002100* *    2.A) IF NO MATCH(ES):                                   * *00210005
002200* *         2.A.1) DO NOT PERFORM ERROR/REPORTING ROUTINES;    * *00220006
002300* *         2.A.2) PROCESSING CONTINUES                        * *00230005
002400* *    2.B) IF MATCH(ES):                                      * *00240005
002500* *         2.B.1) INCREMENT COUNT OF ROW(S) FOUND.            * *00250005
002600* *         2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.     * *00260005
002700* *         2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.         * *00270005
002800* * 3) EVERY NTH RECORD (SET TO 5000), REPORT                  * *00280005
002900* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *00290005
003000* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *00300005
003100* ************************************************************** *00310005
003200 ENVIRONMENT DIVISION.                                            00320005
003300 CONFIGURATION SECTION.                                           00330005
003400 SOURCE-COMPUTER.        IBM-3090.                                00340005
003500 OBJECT-COMPUTER.        IBM-3090.                                00350005
003600                                                                  00360005
003700 INPUT-OUTPUT SECTION.                                            00370005
003800 FILE-CONTROL.                                                    00380005
003900                                                                  00390005
004000     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00400005
004100     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00410005
004200                                                                  00420005
004300******************************************************************00430005
004400 DATA DIVISION.                                                   00440005
004500 FILE SECTION.                                                    00450005
004600                                                                  00460005
004700 FD  IN-DRIVER-FILE                                               00470005
004800     RECORDING MODE IS F                                          00480005
004900     LABEL RECORDS ARE STANDARD                                   00490005
005000     BLOCK CONTAINS 0 RECORDS.                                    00500005
005100 01  IN-DRIVER-RECORD                PIC  X(4).                   00510005
005200                                                                  00520005
005300**** TAURECD:                                                     00530005
005400 FD  OUT-EXTRACT-FILE                                             00540005
005500     RECORDING MODE IS F                                          00550005
005600     LABEL RECORDS ARE STANDARD                                   00560005
005700     BLOCK CONTAINS 0 RECORDS.                                    00570005
005800 01  OUT-EXTRACT-RECORD              PIC  X(133).                 00580011
005900                                                                  00590005
006000                                                                  00600005
006100                                                                  00610005
006200 WORKING-STORAGE SECTION.                                         00620005
006300                                                                  00630005
006400 01  PC-PROGRAM-CONSTANTS.                                        00640005
006500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT071'.  00650005
006600     05  PC-PGM-PROGRESS-DESC.                                    00660005
006700         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00670005
006800         10  PC-CONTINUING           PIC X(10) VALUE              00680005
006900                                               'CONTINUING'.      00690005
007000         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00700005
007100         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00710005
008700     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00870012
008800                                                                  00880005
008900 01  PS-PROGRAM-SWITCHES.                                         00890005
009000     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00900005
009100         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00910005
009200         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         00920005
009300     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         00930005
009400         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         00940005
009500         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         00950005
009600     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00960005
009700         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00970005
009800         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00980005
009900                                                                  00990005
010000 01  PV-PROGRAM-VARIABLES.                                        01000005
010100     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01010005
010300     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01030005
010400     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01040005
010500     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01050005
010600     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01060005
010700                                                                  01070005
010800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01080005
010900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01090005
011000     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01100005
011100     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01110005
011200     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01120005
011300     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01130005
011400                                                                  01140005
011500     05  PV-TMST                     PIC X(26) VALUE SPACES.      01150005
011600     05  PV-TIMESTAMP-DETAIL                                      01160005
011700         REDEFINES                                                01170005
011800         PV-TMST.                                                 01180005
011900         10  PV-TIMESTAMP-19.                                     01190005
012000             15  PV-TMS-DATE.                                     01200005
012100                 20  PV-TMS-YEAR.                                 01210005
012200                     25  PV-TMS-CC   PIC X(02).                   01220005
012300                     25  PV-TMS-YY   PIC X(02).                   01230005
012400                 20  FILLER          PIC X(01).                   01240005
012500                 20  PV-TMS-MONTH    PIC X(02).                   01250005
012600                 20  FILLER          PIC X(01).                   01260005
012700                 20  PV-TMS-DAY      PIC X(02).                   01270005
012800             15  FILLER              PIC X(01).                   01280005
012900             15  PV-TMS-HOUR         PIC X(02).                   01290005
013000             15  FILLER              PIC X(01).                   01300005
013100             15  PV-TMS-MINUTE       PIC X(02).                   01310005
013200             15  FILLER              PIC X(01).                   01320005
013300             15  PV-TMS-SECOND       PIC X(02).                   01330005
013400         10  FILLER                  PIC X(01).                   01340005
013500         10  PV-TMS-MSECOND          PIC X(06).                   01350005
013600                                                                  01360005
013700 01  DM-DISPLAY-MESSAGE.                                          01370005
013800     05  DM-01-10.                                                01380005
013900         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01390005
014000         10  FILLER                  PIC X(02) VALUE ': '.        01400005
014100     05  DM-11-80.                                                01410005
014200         10  FILLER                  PIC X(37) VALUE              01420005
014300                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01430005
014400         10  FILLER                  PIC X(30) VALUE              01440005
014500                        'CREATING TAURECD EXTRACT FILE.'.         01450005
014600         10  FILLER                  PIC X(01) VALUE SPACE.       01460005
014700         10  FILLER                  PIC X(01) VALUE ALL '*'.     01470005
014800     05  DM-81-120.                                               01480005
014900         10  FILLER                  PIC X(40) VALUE ALL '*'.     01490005
015000                                                                  01500005
015100 01  DP-DISPLAY-PROGRESS-MSG.                                     01510005
015200     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01520005
015300     05  FILLER                      PIC X(02) VALUE SPACE.       01530005
015400     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01540005
015500     05  FILLER                      PIC X(04) VALUE ' AT '.      01550005
015600     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01560005
015700     05  FILLER                      PIC X(03) VALUE '.  '.       01570005
015800     05  FILLER                      PIC X(03) VALUE              01580005
015900                                         'IN:'.                   01590005
016000     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01600005
016100                                               VALUE ZERO.        01610005
016200     05  FILLER                      PIC X(02) VALUE ', '.        01620005
016300     05  FILLER                      PIC X(14) VALUE              01630005
016400                                         'ROWS SELECTED:'.        01640005
016500     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01650005
016600                                               VALUE ZERO.        01660005
016700     05  FILLER                      PIC X(02) VALUE ', '.        01670005
016800     05  FILLER                      PIC X(04) VALUE              01680005
016900                                         'OUT:'.                  01690005
017000     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01700005
017100                                               VALUE ZERO.        01710005
017200     05  FILLER                      PIC X(01) VALUE '.'.         01720005
017300                                                                  01730005
017400 01  ABEND-CODE                      PIC S9(04)                   01740005
017500                                               VALUE ZEROES       01750005
017600                                               COMP SYNC.         01760005
017700                                                                  01770005
017800*---------------------------------------------------------------* 01780005
017900*  DB2 FORMATTED MESSAGE AREA                                     01790005
018000*---------------------------------------------------------------* 01800005
018100     COPY DPWS004.                                                01810005
018200                                                                  01820005
018300*---------------------------------------------------------------* 01830005
018400*  AHRD002  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 01840005
018500*---------------------------------------------------------------* 01850005
018600     COPY AHRD002.                                                01860005
018700                                                                  01870005
018800*---------------------------------------------------------------* 01880005
018900*    DB2 AREA FOR TAURECD                                       * 01890005
019000*---------------------------------------------------------------* 01900005
019100     EXEC SQL                                                     01910005
019200          INCLUDE TAURECD                                         01920005
019300     END-EXEC.                                                    01930005
019400                                                                  01940005
019500*---------------------------------------------------------------* 01950005
019600*    DB2 AREA FOR COMMUNICATIONS                                * 01960005
019700*---------------------------------------------------------------* 01970005
019800     EXEC SQL                                                     01980005
019900          INCLUDE SQLCA                                           01990005
020000     END-EXEC.                                                    02000005
020100                                                                  02010005
020200*---------------------------------------------------------------* 02020005
020300*    DEFINE CURSOR FOR TAURECD :                                * 02030005
020400*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02040005
020500*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02050005
020600*---------------------------------------------------------------* 02060005
020700     EXEC SQL                                                     02070005
020800          DECLARE TABLE-CURSOR CURSOR FOR                         02080005
020900          SELECT  ORD_NBR                                         02090005
021000                 ,ORD_LNE_NBR                                     02100005
021100                 ,REC_SEQ_NBR                                     02110005
021200                 ,OPER_UNT_ID                                     02120005
021300                 ,FCLTY_ID                                        02130005
021400                 ,CRE_TMST                                        02140005
021500                 ,CRE_UID                                         02150005
021600                 ,VER_STATUS_CDE                                  02160005
021700                 ,EXPTED_ITM_QTY                                  02170005
021800                 ,VERIFY_ITM_QTY                                  02180005
021900                 ,AP_VERIFY_ITM_QTY                               02190005
022000                 ,STR_NBR                                         02200005
022100                 ,STR_FCLTY_ID                                    02210005
022200                 ,PLAN_ITM_QTY                                    02220005
022300                 ,AP_PRC_CDE                                      02230005
022400                 ,AP_PRC_DTE                                      02240005
022500                 ,UPD_TMST                                        02250005
022600                 ,UPD_UID                                         02260005
022700                 ,UPD_PGM_ID                                      02270005
022800                 ,AUD_TYP_CDE                                     02280005
023000                 ,AUD_FUNC_CDE                                    02300005
023100                 ,ROW_UNLD_SW                                     02310005
023200                 ,NOTIF_NBR                                       02320005
023300                 ,ADJ_CYC_NBR                                     02330005
023400          FROM TAURECD                                            02340005
023500          WHERE ORD_NBR = :PV-PO-NBR-COMP                         02350005
023510         ORDER BY ORD_NBR                                         02351005
023511                 ,REC_SEQ_NBR                                     02351114
023520                 ,ORD_LNE_NBR                                     02352005
023600          FOR FETCH ONLY                                          02360005
023700          WITH UR                                                 02370005
023800     END-EXEC.                                                    02380005
023900                                                                  02390005
024000                                                                  02400005
024010******************************************************************02401014
024100 PROCEDURE DIVISION.                                              02410005
024200******************************************************************02420014
024300                                                                  02430005
024400 0000-PROGRAM-MAINLINE.                                           02440005
024500                                                                  02450005
024600     PERFORM 1000-INITIALIZE.                                     02460005
024700                                                                  02470005
024800     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02480005
024900     PERFORM 2000-PROCESS-DRIVER-FILE                             02490005
025000         UNTIL PS-IN-DRIVER-EOF.                                  02500005
025100                                                                  02510005
025200     PERFORM 6000-EOJ-ROUTINE.                                    02520005
025300     STOP RUN.                                                    02530005
025400                                                                  02540005
025500                                                                  02550005
025600* ************************************************************** *02560005
025700* * INITIALIZATIONS                                            * *02570005
025800* ************************************************************** *02580005
025900 1000-INITIALIZE.                                                 02590005
026000                                                                  02600005
026100     MOVE PC-CURRENT-PROGRAM-NAME     TO DM-PROGRAM.              02610013
026200     DISPLAY DM-DISPLAY-MESSAGE.                                  02620005
026300                                                                  02630005
026400     MOVE PC-BEGINNING                TO DP-STATUS-DESCRIPTION.   02640013
026500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02650005
026600                                                                  02660005
026700     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02670005
026800     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02680005
026900                                                                  02690005
027000                                                                  02700005
027100* ************************************************************** *02710005
027200* * 1) GET NEXT RECORD FROM DRIVER FILE, AND                   * *02720005
027300* *    1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR        * *02730005
027400* *    1B- OPEN TABLE CURSOR                                   * *02740005
027500* *    1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL               * *02750005
027600* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *02760005
027700* *    2) FOR EACH ROW,                                        * *02770005
027800* *       2A- INCREMENT COUNTS                                 * *02780005
027900* *       2B- WRITE EXTRACT RECORD                             * *02790005
028000* *    1D- CLOSE TABLE CURSOR                                  * *02800005
028100* ************************************************************** *02810005
028200 2000-PROCESS-DRIVER-FILE.                                        02820005
028300                                                                  02830005
028400     PERFORM 9050-READ-IN-DRIVER-FILE.                            02840005
028500     IF PS-IN-DRIVER-EOF                                          02850005
028600         CONTINUE                                                 02860005
028700     ELSE                                                         02870005
028800         MOVE AH002-PO-NBR            TO PV-PO-NBR-COMP           02880012
029000         PERFORM 2100-CHECK-PGM-PROGRESS                          02900005
029100         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     02910005
029200         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     02920005
029300         PERFORM 9100-OPEN-TABLE-CURSOR                           02930005
029400         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     02940005
029500             UNTIL PS-TABLE-LOOP-DONE                             02950005
029600         PERFORM 9190-CLOSE-TABLE-CURSOR                          02960005
029700     END-IF.                                                      02970005
029800                                                                  02980005
029900                                                                  02990005
030000* ************************************************************** *03000005
030100* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *03010005
030200* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *03020005
030300* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *03030005
030400* ************************************************************** *03040005
030500 2100-CHECK-PGM-PROGRESS.                                         03050005
030600     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03060005
030700         BY        PC-HOW-OFTEN-TO-DISPLAY                        03070005
030800         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03080005
030900         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03090005
031000                                                                  03100005
031100     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03110005
031200         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03120005
031300         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03130005
031400     END-IF.                                                      03140005
031500                                                                  03150005
031600                                                                  03160005
031700* ************************************************************** *03170005
031800* * EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD     * *03180005
031900* ************************************************************** *03190005
032000 3000-EXTRACT-ROWS-FROM-TABLE.                                    03200005
032100     INITIALIZE DCLTAURECD.                                       03210005
032200     PERFORM 9150-FETCH-TABLE-CURSOR.                             03220005
032300     IF PS-TABLE-LOOP-DONE                                        03230005
032400         CONTINUE                                                 03240005
032500     ELSE                                                         03250005
032600         PERFORM 9750-WRITE-EXTRACT-RECORD                        03260005
032700     END-IF.                                                      03270005
032800                                                                  03280005
032900                                                                  03290005
033000* ************************************************************** *03300005
033100* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03310005
033200* ************************************************************** *03320005
033300 6000-EOJ-ROUTINE.                                                03330005
033400                                                                  03340005
033500     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03350005
033600     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03360005
035710                                                                  03571014
035720     IF PV-IN-DRIVER-RECS-READ-CNT = 0 THEN                       03572014
035730        DISPLAY '** DRIVER FILE IS EMPTY**'                       03573014
035740     END-IF                                                       03574014
033700                                                                  03370005
033800     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03380005
033900     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03390005
034000                                                                  03400005
034100                                                                  03410005
034200* ************************************************************** *03420005
034300* * DISPLAY PROGRAM PROGRESS.                                  * *03430005
034400* ************************************************************** *03440005
034500 6200-DISPLAY-PGM-PROGRESS.                                       03450005
034600                                                                  03460005
034700     EXEC SQL                                                     03470005
034800          SET :PV-TMST = CURRENT TIMESTAMP                        03480005
034900     END-EXEC.                                                    03490005
035000                                                                  03500005
035100     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03510005
035200     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03520005
035300     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03530005
035400                                    TO DP-IN-CNT.                 03540005
035600     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03560005
035700     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03570005
035800                                                                  03580005
035900     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03590005
036000                                                                  03600005
036100                                                                  03610005
036200* ************************************************************** *03620005
036300* * FILE AND DB2 TABLE ACCESS PARAGRAPHS.                      * *03630005
036400* * 90XX- INPUT:  DRIVER FILE                                  * *03640005
036500* * 91XX- INPUT:  TABLE CURSOR                                 * *03650005
036600* * 97XX- OUTPUT: TABLE EXTRACT                                * *03660005
036700* ************************************************************** *03670005
036800                                                                  03680005
036900* ************************************************************** *03690005
037000* * OPEN  INPUT DRIVER FILE                                    * *03700005
037100* ************************************************************** *03710005
037200 9000-OPEN-IN-DRIVER-FILE.                                        03720005
037300     OPEN  INPUT  IN-DRIVER-FILE.                                 03730005
037400                                                                  03740005
037500                                                                  03750005
037600* ************************************************************** *03760005
037700* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *03770005
037800* ************************************************************** *03780005
037900 9050-READ-IN-DRIVER-FILE.                                        03790005
038000     READ IN-DRIVER-FILE                                          03800005
038100          INTO AH002-DRIVER-RECORD-LAYOUT                         03810005
038200          AT END                                                  03820005
038300              SET PS-IN-DRIVER-EOF TO TRUE.                       03830005
038400                                                                  03840005
038500     IF PS-IN-DRIVER-EOF                                          03850005
038600         CONTINUE                                                 03860005
038700     ELSE                                                         03870005
038800         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03880005
038900     END-IF.                                                      03890005
039000                                                                  03900005
039100                                                                  03910005
039200* ************************************************************** *03920005
039300* * CLOSE INPUT DRIVER FILE                                    * *03930005
039400* ************************************************************** *03940005
039500 9090-CLOSE-IN-DRIVER-FILE.                                       03950005
039600     CLOSE IN-DRIVER-FILE.                                        03960005
039700                                                                  03970005
039800                                                                  03980005
039900* ************************************************************** *03990005
040000* * OPEN  TABLE CURSOR                                         * *04000005
040100* ************************************************************** *04010005
040200 9100-OPEN-TABLE-CURSOR.                                          04020005
040300     EXEC SQL                                                     04030005
040400          OPEN TABLE-CURSOR                                       04040005
040500     END-EXEC.                                                    04050005
040600                                                                  04060005
040700     EVALUATE TRUE                                                04070005
040800         WHEN SQLCODE = ZERO                                      04080005
040900              ADD +1                  TO PV-RECS-WITH-MATCHES-CNT 04090013
041000              SET PS-CURSOR-HAS-DATA  TO TRUE                     04100013
041100         WHEN SQLCODE = +100                                      04110005
041200              SET PS-TABLE-LOOP-DONE  TO TRUE                     04120013
041300         WHEN SQLWARN0 NOT EQUAL SPACE                            04130005
041400         WHEN SQLCODE  NOT EQUAL ZERO                             04140005
041500              MOVE '9100-OPEN-TABLE-CURSOR'                       04150005
041600                                      TO PV-PARAGRAPH-NAME        04160013
041700              MOVE 'OPEN TABLE CURSOR'                            04170005
041800                                      TO PV-DB2-OPERATION-MSG-1   04180013
041900              MOVE 'TAURECD'          TO PV-DB2-TABLE-NAME        04190013
042000              PERFORM 9999-DB2-ABEND                              04200005
042100     END-EVALUATE.                                                04210005
042200                                                                  04220005
042300                                                                  04230005
042400* ************************************************************** *04240005
042500* * FETCH TABLE CURSOR                                         * *04250005
042600* ************************************************************** *04260005
042700 9150-FETCH-TABLE-CURSOR.                                         04270005
042800     EXEC SQL                                                     04280005
042900         FETCH TABLE-CURSOR                                       04290005
043000          INTO  :AURECD-ORD-NBR                                   04300005
043100               ,:AURECD-ORD-LNE-NBR                               04310005
043200               ,:AURECD-REC-SEQ-NBR                               04320005
043300               ,:AURECD-OPER-UNT-ID                               04330005
043400               ,:AURECD-FCLTY-ID                                  04340005
043500               ,:AURECD-CRE-TMST                                  04350005
043600               ,:AURECD-CRE-UID                                   04360005
043700               ,:AURECD-VER-STATUS-CDE                            04370005
043800               ,:AURECD-EXPTED-ITM-QTY                            04380005
043900               ,:AURECD-VERIFY-ITM-QTY                            04390005
044000               ,:AURECD-AP-VERIFY-ITM-QTY                         04400005
044100               ,:AURECD-STR-NBR                                   04410005
044200               ,:AURECD-STR-FCLTY-ID                              04420005
044300               ,:AURECD-PLAN-ITM-QTY                              04430005
044400               ,:AURECD-AP-PRC-CDE                                04440005
044500               ,:AURECD-AP-PRC-DTE                                04450005
044600               ,:AURECD-UPD-TMST                                  04460005
044700               ,:AURECD-UPD-UID                                   04470005
044800               ,:AURECD-UPD-PGM-ID                                04480005
044900               ,:AURECD-AUD-TYP-CDE                               04490005
045000               ,:AURECD-AUD-FUNC-CDE                              04500005
045100               ,:AURECD-ROW-UNLD-SW                               04510005
045200               ,:AURECD-NOTIF-NBR                                 04520005
045300               ,:AURECD-ADJ-CYC-NBR                               04530005
045400     END-EXEC.                                                    04540005
045500                                                                  04550005
045600     EVALUATE TRUE                                                04560005
045700         WHEN SQLCODE = ZERO                                      04570005
045800              ADD +1                  TO PV-TABLE-ROW-SELECT-CNT  04580013
045900              SET PS-CURSOR-HAS-DATA  TO TRUE                     04590013
046000         WHEN SQLCODE = +100                                      04600005
046100              SET PS-TABLE-LOOP-DONE  TO TRUE                     04610013
046200         WHEN SQLWARN0 NOT EQUAL SPACE                            04620005
046300         WHEN SQLCODE NOT EQUAL ZERO                              04630005
046400              MOVE '9150-FETCH-TABLE-CURSOR'                      04640005
046500                                      TO PV-PARAGRAPH-NAME        04650013
046600              MOVE 'FETCH TABLE CURSOR'                           04660005
046700                                      TO PV-DB2-OPERATION-MSG-1   04670013
046800              MOVE 'TAURECD'          TO PV-DB2-TABLE-NAME        04680013
046900              PERFORM 9999-DB2-ABEND                              04690005
047000     END-EVALUATE.                                                04700005
047100                                                                  04710005
047200                                                                  04720005
047300* ************************************************************** *04730005
047400* * CLOSE TABLE CURSOR                                         * *04740005
047500* ************************************************************** *04750005
047600 9190-CLOSE-TABLE-CURSOR.                                         04760005
047700     EXEC SQL                                                     04770005
047800          CLOSE TABLE-CURSOR                                      04780005
047900     END-EXEC.                                                    04790005
048000                                                                  04800005
048100     EVALUATE TRUE                                                04810005
048200         WHEN SQLCODE = ZERO                                      04820005
048300              CONTINUE                                            04830005
048400         WHEN SQLWARN0 NOT EQUAL SPACE                            04840005
048500         WHEN SQLCODE NOT EQUAL ZERO                              04850005
048600              MOVE '9190-CLOSE-TABLE-CURSOR'                      04860005
048700                                 TO PV-PARAGRAPH-NAME             04870005
048800              MOVE 'CLOSE TABLE CURSOR'                           04880005
048900                                 TO PV-DB2-OPERATION-MSG-1        04890005
049000              MOVE 'TAURECD'     TO PV-DB2-TABLE-NAME             04900005
049100              PERFORM 9999-DB2-ABEND                              04910005
049200     END-EVALUATE.                                                04920005
049300                                                                  04930005
049400                                                                  04940005
049500* ************************************************************** *04950005
049600* * OPEN OUTPUT EXTRACT FILE                                   * *04960005
049700* ************************************************************** *04970005
049800 9700-OPEN-OUT-EXTRACT-FILE.                                      04980005
049900     OPEN OUTPUT OUT-EXTRACT-FILE.                                04990005
050000                                                                  05000005
050100                                                                  05010005
050200* ************************************************************** *05020005
050300* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *05030005
050400* ************************************************************** *05040005
050500 9750-WRITE-EXTRACT-RECORD.                                       05050005
050600     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTAURECD.                 05060005
050700     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05070005
050800                                                                  05080005
050900                                                                  05090005
051000* ************************************************************** *05100005
051100* * CLOSE OUTPUT EXTRACT FILE                                  * *05110005
051200* ************************************************************** *05120005
051300 9790-CLOSE-OUT-EXTRACT-FILE.                                     05130005
051400     CLOSE OUT-EXTRACT-FILE.                                      05140005
051500                                                                  05150005
051600                                                                  05160005
051700* ************************************************************** *05170005
051800* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05180005
051900* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *05190005
052000* * SQL ERROR OR WARNING CODE OCCURS.                          * *05200005
052100* ************************************************************** *05210005
052200 9999-DB2-ABEND.                                                  05220005
052300                                                                  05230005
052400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05240005
052500             ' 9999-DB2-ABEND'.                                   05250005
052600     DISPLAY PC-CURRENT-PROGRAM-NAME                              05260005
052700             ' ** ABEND           **'.                            05270005
052800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05280005
052900             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05290005
053000     DISPLAY PC-CURRENT-PROGRAM-NAME                              05300005
053100             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05310005
053200     DISPLAY PC-CURRENT-PROGRAM-NAME                              05320005
053300             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05330005
053400                                                                  05340005
053500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05350005
053600             ' ** SQLCODE         ** = ' SQLCODE.                 05360005
053700     MOVE SQLCODE TO PV-SQLCODE.                                  05370005
053800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05380005
053900             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05390005
054000                                                                  05400005
054100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05410005
054200             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05420005
054300                                                                  05430005
054400                                                                  05440005
054500*----------------------------------------------------------------*05450005
054600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05460005
054700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05470005
054800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05480005
054900* FORMAT.                                                        *05490005
055000*----------------------------------------------------------------*05500005
055100     COPY DPPD004.                                                05510005
055200                                                                  05520005
055300     MOVE PC-ABENDING            TO DP-STATUS-DESCRIPTION.        05530013
055400     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05540005
055500     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05550005
055600     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05560005
055700                                                                  05570005
055800*----------------------------------------------------------------*05580005
055900* CALL ABEND                                                     *05590005
056000*----------------------------------------------------------------*05600005
056100     MOVE +4013                  TO ABEND-CODE.                   05610013
056200     CALL 'ILBOABN0' USING ABEND-CODE.                            05620005
056300*                                                                 05630005
