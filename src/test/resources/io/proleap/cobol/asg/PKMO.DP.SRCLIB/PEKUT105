000100******************************************************************00010095
000200 IDENTIFICATION DIVISION.                                         00020095
000300 PROGRAM-ID.             PEKUT105.                                00030095
000400 AUTHOR.                 KELLY LARUM.                             00040095
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050095
000600 DATE-WRITTEN.           MAY 2004.                                00060095
000700 DATE-COMPILED.                                                   00070095
000800******************************************************************00080095
000900*                                                                *00090095
001000*    PEKUT105 - PERM DOMAIN EXTRACT FOR XXT_PRCHG_MDSE           *00100095
001100*                                                                *00110095
001200******************************************************************00120095
001300**  HISTORY LOG:                                                 *00130095
001400******************************************************************00140095
001500* DATE:         03/23/2005                                       *00150095
001600* WR/IR#:       WR27018 - CONTINUED CLEARANCE CHANGES            *00160095
001700* PROGRAMMER:   COLLEEN CUMMINGS                                 *00170095
001800* DESCRIPTION:  ADDED PV-MDSE-PRIC-AMT-NI FOR CONTINUED CLRNC.  * 00180095
001900*               CHANGED CONTINUED CLRNC CURSOR TO MATCH INTFC    *00190095
002000*               VIEW (WHERE CLAUSE WAS INCORRECT).               *00200095
002100*               CHANGED CONTINUED CLEARANCE QUERY TO USE         *00210095
002200*               PET_CLR_MDSE_PRICG.CLR_MDSE_PRICG_ID INSTEAD OF  *00220095
002300*               PET_CLR_MDSE_LNE.CLR_MDSE_LNE_ID FOR THE         *00230095
002400*               PRCHG_MDSE_ID TO THE DOMAINS (TO KEEP THIS KEY   *00240095
002500*               UNIQUE IF CONTINUED CLEARANCE IS PRICED TO THE   *00250095
002600*               SAME MDSE, SAME STORE GROUP, DIFFERENT PRICING   *00260095
002700*               GRIDS (ONE FIRST TIME, ONE CONTINUED).           *00270095
002800*                                                                *00280095
002900* DATE:         03/13/2007                                       *00290095
003000* WR/IR#:       P000981281                                       *00300095
003100* PROGRAMMER:   J. BOLDT, STRATAGEM                              *00310095
003200* DESCRIPTION:  ADD CONTROL CARD TO PROGRAM TO OPTIONALLY LOCK   *00320095
003300*               OR NOT LOCK THE TABLES DURING PROGRAM EXECUTION. *00330095
003300*                                                                 00340095
002900* DATE:         08/14/2012                                       *00350095
DM0814* WR/IR#:       CRQ000000029640                                  *00360095
DM0814* PROGRAMMER:   DAVE METZGER                                     *00370095
DM0814* DESCRIPTION:  CHANGED MAIN CURSOR TO PULL IN PREVIOUS MARK     *00380095
DM0814*               PRICE FROM XKT TABLES AND ADD TO EXTRACT FILE    *00390095
DM0814*               FOR LOGISTICS TEAM.                              *00400095
DM0814* WR/IR#:       CRQ000000029640                                  *00410095
DM0814* PROGRAMMER:   DAVE METZGER                                     *00420095
DM0814* DESCRIPTION:  COMMENTED SQL FOR PREVIOUS PRICE DUE TO *         00430095
DM0814*               PERFORMANCE ISSUES.                              *00440095
002800*                                                                *00450095
002900* DATE:         01/17/2015                                       *00460095
003000* WR/IR#:       PRB0051029                                       *00470095
003100* PROGRAMMER:   COGNIZANT                                        *00480095
003200* DESCRIPTION:  MODIFIED THE PROGRAM TO HANDLE BOTH THE LOGIC OF *00490095
003300*               PEKUT104 AND PEKUT105 IN PEKUT105.               *00500095
002800*                                                                *00510095
002900* DATE:         03/20/2015                                       *00520095
003000* WR/IR#:       PRB0051985                                       *00530095
003100* PROGRAMMER:   COGNIZANT                                        *00540095
003200* DESCRIPTION:  MODIFIED THE PROGRAM TO ACCESS THE TABLE DIRECTLY*00550095
003300*               INSTEAD OF VIEW TO INCREASE THE PERFORMANCE.     *00560095
147460*                                                                *00570095
147460* WR/IR#:  CHG0147460                                            *00580095
147460* PROGRAMMER:   COGNIZANT                                        *00590095
147460* DESCRIPTION:  MODIFIED THE PROGRAM TO HANDLE BOTH THE LOGIC OF *00600095
147460*               PEKUT103 AND PEKUT105 IN PEKUT105.               *00610095
147460*                                                                *00620095
C93562* WR/IR#:  CHG0193562                                            *00630095
C93562* PROGRAMMER:   COGNIZANT                                        *00640095
C93562* DESCRIPTION:  MODIFIED THE CURRENT HINT FOR FASTER EXECUTION   *00650095
C93562*               OF JOB.                                          *00660095
C93562*                                                                *00661097
070941* DATE:         07/30/2018                                       *00662098
070941* WR/IR#:       CHG0204126                                       *00663098
070941* PROGRAMMER:   COGNIZANT                                        *00664098
070941* DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE            *00665098
070941******************************************************************00666098
003500 ENVIRONMENT DIVISION.                                            00680095
003600 CONFIGURATION SECTION.                                           00690095
003700 SOURCE-COMPUTER. IBM-3090.                                       00700095
003800 OBJECT-COMPUTER. IBM-3090.                                       00710095
003900                                                                  00720095
004000 INPUT-OUTPUT SECTION.                                            00730095
004100 FILE-CONTROL.                                                    00740095
004200                                                                  00750095
004300     SELECT DATE-RANGE-FILE                                       00760095
004400         ASSIGN                       TO INP01.                   00770095
004500                                                                  00780095
004600     SELECT LOCK-TBLS-OPTION-FILE                                 00790095
004700         ASSIGN                       TO INP02.                   00800095
                                                                        00810095
070941     SELECT ORACLE-LOGON-FILE                                     00820095
070941         ASSIGN                       TO ORALOGON.                00830095
004800                                                                  00840095
004900     SELECT PRCHGMDSE-FILE                                        00850095
005000         ASSIGN                       TO OUT01.                   00860095
005100                                                                  00870095
004900     SELECT SGPRCHG-FILE                                          00880095
005000         ASSIGN                       TO OUT02.                   00890095
147460                                                                  00900095
147460     SELECT PRCHG-FILE                                            00910095
147460         ASSIGN                       TO OUT03.                   00920095
005100                                                                  00930095
005200 DATA DIVISION.                                                   00940095
005300                                                                  00950095
005400 FILE SECTION.                                                    00960095
005500                                                                  00970095
005600 FD  DATE-RANGE-FILE                                              00980095
005700     RECORDING MODE F                                             00990095
005800     BLOCK CONTAINS 0 RECORDS                                     01000095
005900     LABEL RECORDS ARE OMITTED.                                   01010095
006000 01  DATE-RANGE-LINE                  PIC  X(80).                 01020095
006100                                                                  01030095
006200 FD  LOCK-TBLS-OPTION-FILE                                        01040095
006300     RECORDING MODE F                                             01050095
006400     BLOCK CONTAINS 0 RECORDS                                     01060095
006500     LABEL RECORDS ARE OMITTED.                                   01070095
006600 01  LOCK-TBLS-OPTION-LINE            PIC  X(80).                 01080095
                                                                        01090095
070941 FD  ORACLE-LOGON-FILE                                            01100095
070941     RECORDING MODE IS F                                          01110095
070941     LABEL RECORDS ARE STANDARD                                   01120095
070941     BLOCK CONTAINS 0 RECORDS                                     01130095
070941     RECORD CONTAINS 80 CHARACTERS                                01140095
070941     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      01150095
070941 01  OL-ORACLE-LOGON-RECORD           PIC X(80).                  01160095
006700                                                                  01170095
006800 FD  PRCHGMDSE-FILE                                               01180095
006900     RECORDING MODE F                                             01190095
007000     BLOCK CONTAINS 0 RECORDS                                     01200095
007100     LABEL RECORDS ARE OMITTED.                                   01210095
007200 01  PRCHGMDSE-LINE                   PIC X(200).                 01220095
007300                                                                  01230095
006800 FD  SGPRCHG-FILE                                                 01240095
006900     RECORDING MODE F                                             01250095
007000     BLOCK CONTAINS 0 RECORDS                                     01260095
007100     LABEL RECORDS ARE OMITTED.                                   01270095
007200 01  SGPRCHG-LINE                     PIC X(200).                 01280095
007300                                                                  01290095
147460 FD  PRCHG-FILE                                                   01300095
147460     RECORDING MODE F                                             01310095
147460     BLOCK CONTAINS 0 RECORDS                                     01320095
147460     LABEL RECORDS ARE OMITTED.                                   01330095
147460 01  PRCHG-LINE                       PIC X(200).                 01340095
147460                                                                  01350095
007400 WORKING-STORAGE SECTION.                                         01360095
007500                                                                  01370095
007600 01  ABEND-CODE                       PIC S9(04)   COMP VALUE +0. 01380095
007700     88  ABEND-4001-WRITE-ERROR                    VALUE +4001.   01390095
007800     88  ABEND-4002-READ-ERROR                     VALUE +4002.   01400095
007900     88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.   01410095
008000     88  ABEND-4004-TABLE-ERROR                    VALUE +4004.   01420095
008100     88  ABEND-4005-OPEN-ERROR                     VALUE +4005.   01430095
008200     88  ABEND-4006-CLOSE-ERROR                    VALUE +4006.   01440095
008300     88  ABEND-4007-SEQUENCE-ERROR                 VALUE +4007.   01450095
008400     88  ABEND-4008-DATA-ERROR                     VALUE +4008.   01460095
008500     88  ABEND-4009-KEY-DATA-ERROR                 VALUE +4009.   01470095
008600     88  ABEND-4013-DB2-ERROR                      VALUE +4013.   01480095
008700     88  ABEND-4014-ORACLE-LOGON-ERROR             VALUE +4014.   01490095
008800     88  ABEND-4019-DATE-ROUTINE-ERROR             VALUE +4019.   01500095
008900     88  ABEND-4444-FORCED-ABEND                   VALUE +4444.   01510095
009000                                                                  01520095
009100 01  CC-DATE-RANGE-FILE.                                          01530095
009200     05  CC-START-DATE                PIC X(10).                  01540095
009300     05  FILLER                       PIC X(01).                  01550095
009400     05  CC-END-DATE                  PIC X(10).                  01560095
009500                                                                  01570095
009600 01  CC-LOCK-TBLS-OPTION-FILE                     VALUE SPACE.    01580095
009700     05  CC-LOCK-TBLS-OPTION          PIC X(01).                  01590095
009800     05  FILLER                       PIC X(79).                  01600095
009900                                                                  01610095
010000 01  PS-PROGRAM-SWITCHES.                                         01620095
070941     05  PS-END-OF-LOGON-FILE-SW      PIC X(01)   VALUE 'N'.      01630095
070941         88  PS-END-OF-LOGON-FILE                 VALUE 'Y'.      01640095
070941     05  PS-ORA-SRC-CTL-DONE-SW       PIC  X(01)  VALUE 'N'.      01650095
070941         88  PS-ORA-SRC-EMPTY                     VALUE 'Y'.      01660095
010100     05  PS-DATE-RANGE-FILE-SW           PIC X(1) VALUE 'N'.      01670095
010200         88  PS-DATE-RANGE-FILE-END               VALUE 'Y'.      01680095
010300         88  PS-DATE-RANGE-FILE-START             VALUE 'N'.      01690095
010400     05  PS-LOCK-TBLS-OPTION-FILE-SW  PIC  X(01)  VALUE 'N'.      01700095
010500         88  PS-LOCK-TBLS-OPTION-FILE-END         VALUE 'Y'.      01710095
010600         88  PS-LOCK-TBLS-OPTION-FILE-START       VALUE 'N'.      01720095
010700     05  PS-END-OF-PRCHG-MDSE-CSR-SW     PIC X(1) VALUE 'N'.      01730095
010800         88  PS-END-OF-PRCHG-MDSE-CSR             VALUE 'Y'.      01740095
010900         88  PS-NOT-END-OF-PRCHG-MDSE-CSR         VALUE 'N'.      01750095
011000     05  PS-END-OF-PMDSE-NS-CSR-SW       PIC X(1) VALUE 'N'.      01760095
011100         88  PS-END-OF-PMDSE-NS-CSR               VALUE 'Y'.      01770095
011200         88  PS-NOT-END-OF-PMDSE-NS-CSR           VALUE 'N'.      01780095
147460     05  PS-END-OF-PRCHG-CSR-SWITCH   PIC X(1)    VALUE 'N'.      01790095
147460         88  PS-END-OF-PRCHG-CSR                  VALUE 'Y'.      01800095
147460         88  PS-NOT-END-OF-PRCHG-CSR              VALUE 'N'.      01810095
                                                                        01811095
070941 01  CC-ORACLE-CONNECTION.                                        01812095
070941     05  CC-ORACLE-USERID             PIC X(40).                  01813095
070941         88 CC-AUTO-LOGON                         VALUE '/'.      01814095
070941     05  CC-ORACLE-PASSWORD           PIC X(40).                  01815095
011300                                                                  01820095
011400 01  PC-PROGRAM-CONSTANTS.                                        01830095
070941*    05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)  VALUE           01840096
070941     05  PC-AUTO-LOGON                PIC  X(1)   VALUE '/'.      01841095
070941     05  PC-PROGRAM-NAME              PIC  X(08)  VALUE           01842095
011600                                                     'PEKUT105'.  01850095
011700     05  PC-DASH                      PIC  X(01)  VALUE '-'.      01860095
011800     05  PC-SPACE                     PIC  X(01)  VALUE ' '.      01870095
011800     05  PC-1000                      PIC  9(04)  VALUE 1000.     01880095
147460     05  PC-BUSINESS-EVNT-ID          PIC  9(03)  VALUE 010.      01890095
147460     05  PC-ACTION-CDE                PIC  X(01)  VALUE 'U'.      01900095
011900     05  PC-BEG-TMST                  PIC  X(08)  VALUE           01910095
012000                                                    '00:00:00'.   01920095
012100     05  PC-END-TMST                  PIC  X(08)  VALUE           01930095
012200                                                    '23:59:59'.   01940095
012300                                                                  01950095
012400 01  PV-PROGRAM-VARIABLES.                                        01960095
070941     05  PV-ORACLE-USERID-LEN         PIC S9(4)   VALUE ZEROS     01961095
070941                                                  COMP SYNC.      01962095
070941     05  PV-ORACLE-PASSWORD-LEN       PIC S9(4)   VALUE ZEROS     01963095
070941                                                  COMP SYNC.      01964095
070941     05  PC-AUTO-LOGON                PIC  X(01)  VALUE '/'.      01965095
012500     05  PV-RECORDS-TO-PROCESS        PIC  9(08)  VALUE ZEROS.    01970095
012500     05  PV-CNT                       PIC  9(04)  VALUE ZEROS.    01980095
012600     05  PV-SQL                       PIC S9(04)  VALUE ZEROS.    01990095
012700     05  PV-TABLE-NAME                PIC  X(12)  VALUE SPACES.   02000095
012800     05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.   02010095
012900     05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.   02020095
013000     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACES.   02030095
013100     05  PV-NEW-STRT-DATE             PIC  X(26)  VALUE SPACES.   02040095
013200     05  PV-NEW-END-DATE              PIC  X(26)  VALUE SPACES.   02050095
013300     05  PV-SELECT-COUNTER            PIC  S9(04) COMP VALUE +0.  02060095
013300     05  PV-DISPLAY-CNT               PIC  S9(08) COMP VALUE +0.  02070095
013400                                                                  02080095
013500 01  PC-PROGRAM-CONSTANTS.                                        02090095
013600     05  PC-MAX-RETRY-CNT        PIC  S9(04) COMP VALUE +10.      02100095
013700                                                                  02110095
013800 01  PV-SELECT-VARIABLES.                                         02120095
013900     05  PV-STR-GP-TYP-CDE        OCCURS 1000 TIMES               02130095
014000                                  PIC  9(04) VALUE ZEROES.        02140095
014100     05  PV-STR-GP-ID             OCCURS 1000 TIMES               02150095
014200                                  PIC  9(04) VALUE ZEROES.        02160095
014300     05  PV-PRCHG-ID              OCCURS 1000 TIMES               02170095
014400                                  PIC  9(10) VALUE ZEROES.        02180095
014500     05  PV-PRCHG-MDSE-ID         OCCURS 1000 TIMES               02190095
014600                                  PIC  9(10) VALUE ZEROES.        02200095
014700     05  PV-MDSE-HIER-CDE         OCCURS 1000 TIMES               02210095
014800                                  PIC  X(03) VALUE SPACES.        02220095
014900     05  PV-DEPT-NBR              OCCURS 1000 TIMES               02230095
015000                                  PIC  9(04) VALUE ZEROES.        02240095
015100     05  PV-MAJ-CL-NBR            OCCURS 1000 TIMES               02250095
015200                                  PIC  9(04) VALUE ZEROES.        02260095
015300     05  PV-SUB-CL-NBR            OCCURS 1000 TIMES               02270095
015400                                  PIC  9(04) VALUE ZEROES.        02280095
015500     05  PV-STYL-ID               OCCURS 1000 TIMES               02290095
015600                                  PIC  9(08) VALUE ZEROES.        02300095
015700     05  PV-SKU-NBR               OCCURS 1000 TIMES               02310095
015800                                  PIC  9(08) VALUE ZEROES.        02320095
015900     05  PV-MDSE-PRIC-AMT         OCCURS 1000 TIMES               02330095
016000                                  PIC  S9(07)V99 VALUE ZEROES.    02340095
016100     05  PV-GP-PRIC-ID            OCCURS 1000 TIMES               02350095
016200                                  PIC  9(10) VALUE ZEROES.        02360095
016300     05  PV-GP-PRIC-AMT           OCCURS 1000 TIMES               02370095
016400                                  PIC  S9(07)V99 VALUE ZEROES.    02380095
016500     05  PV-GP-QTY                OCCURS 1000 TIMES               02390095
016600                                  PIC  S9(04) VALUE ZEROES.       02400095
016700     05  PV-CLR-TYP-CDE           OCCURS 1000 TIMES               02410095
016800                                  PIC  X(01) VALUE SPACES.        02420095
016900     05  PV-PRICG-GRID-ID         OCCURS 1000 TIMES               02430095
017000                                  PIC  9(10) VALUE ZEROES.        02440095
017100     05  PV-SOR-CRE-TMST          OCCURS 1000 TIMES               02450095
017200                                  PIC  X(26) VALUE SPACES.        02460095
017300     05  PV-SOR-LAST-UPD-TMST     OCCURS 1000 TIMES               02470095
017400                                  PIC  X(26) VALUE SPACES.        02480095
017300     05  PV-SOR-LST-UPD-TMST      OCCURS 1000 TIMES               02490095
017400                                  PIC  X(26) VALUE SPACES.        02500095
           05  PV-PRCHG-EFF-DTE         OCCURS 1000 TIMES               02510095
                                        PIC  X(08) VALUE SPACES.        02520095
           05  PV-OH-AUTO-CNT-IND       OCCURS 1000 TIMES               02530095
                                        PIC  X(01) VALUE SPACES.        02540095
DM0814     05  PV-PREV-MARK-PRICE       OCCURS 1000 TIMES               02550095
DM6000                                  PIC  S9(07)V99 VALUE ZEROES.    02560095
017500                                                                  02570095
017600     05  PV-NULL-IND.                                             02580095
017700         10  PV-DEPT-NBR-NI       OCCURS 1000 TIMES               02590095
017800                                  PIC S9(04) COMP VALUE 0.        02600095
017900         10  PV-MAJ-CL-NBR-NI     OCCURS 1000 TIMES               02610095
018000                                  PIC S9(04) COMP VALUE 0.        02620095
018100         10  PV-SUB-CL-NBR-NI     OCCURS 1000 TIMES               02630095
018200                                  PIC S9(04) COMP VALUE 0.        02640095
018300         10  PV-STYL-ID-NI        OCCURS 1000 TIMES               02650095
018400                                  PIC S9(04) COMP VALUE 0.        02660095
018500         10  PV-SKU-NBR-NI        OCCURS 1000 TIMES               02670095
018600                                  PIC S9(04) COMP VALUE 0.        02680095
018700         10  PV-MDSE-PRIC-AMT-NI  OCCURS 1000 TIMES               02690095
018800                                  PIC S9(04) COMP VALUE 0.        02700095
018900         10  PV-GP-PRIC-ID-NI     OCCURS 1000 TIMES               02710095
019000                                  PIC S9(04) COMP VALUE 0.        02720095
019100         10  PV-GP-PRIC-AMT-NI    OCCURS 1000 TIMES               02730095
019200                                  PIC S9(04) COMP VALUE 0.        02740095
019300         10  PV-GP-QTY-NI         OCCURS 1000 TIMES               02750095
019400                                  PIC S9(04) COMP VALUE 0.        02760095
019500         10  PV-CLR-TYP-CDE-NI    OCCURS 1000 TIMES               02770095
019600                                  PIC S9(04) COMP VALUE 0.        02780095
019700         10  PV-PRICG-GRID-ID-NI  OCCURS 1000 TIMES               02790095
019800                                  PIC S9(04) COMP VALUE 0.        02800095
DM0814         10  PV-PREV-MARK-PRICE-NI OCCURS 1000 TIMES              02810095
DM0814                                  PIC S9(04) COMP VALUE 0.        02820095
019900                                                                  02830095
147460*                                                                 02840095
147460 01  PV-PRCHG-SELECT-VARIABLES.                                   02850095
147460     05  PV-PRCHG-DESC                OCCURS 1000 TIMES           02860095
147460                                      PIC  X(30)  VALUE SPACES.   02870095
147460     05  PV-PRCHG-DEPT-NBR            OCCURS 1000 TIMES           02880095
147460                                      PIC  9(04)  VALUE ZEROES.   02890095
147460     05  PV-EVNT-CTG-CDE              OCCURS 1000 TIMES           02900095
147460                                      PIC  X(03)  VALUE SPACES.   02910095
147460     05  PV-PRCHG-TYP-CDE             OCCURS 1000 TIMES           02920095
147460                                      PIC  X(03)  VALUE SPACES.   02930095
147460     05  PV-PRCHG-ST-CDE              OCCURS 1000 TIMES           02940095
147460                                      PIC  X(03)  VALUE SPACES.   02950095
147460     05  PV-ALL-RMNG-STR-IND          OCCURS 1000 TIMES           02960095
147460                                      PIC  X(01)  VALUE SPACES.   02970095
147460     05  PV-SUBMTD-BY-USR-ID          OCCURS 1000 TIMES           02980095
147460                                      PIC  X(08)  VALUE SPACES.   02990095
147460     05  PV-SUBMTD-TMST               OCCURS 1000 TIMES           03000095
147460                                      PIC  X(26)  VALUE SPACES.   03010095
147460     05  PV-APP-BY-USR-ID             OCCURS 1000 TIMES           03020095
147460                                      PIC  X(08)  VALUE SPACES.   03030095
147460     05  PV-APP-TMST                  OCCURS 1000 TIMES           03040095
147460                                      PIC  X(26)  VALUE SPACES.   03050095
147460     05  PV-PRCHG-CRE-TMST            OCCURS 1000 TIMES           03060095
147460                                      PIC  X(26)  VALUE SPACES.   03070095
147460     05  PV-PRCHG-LAST-UPD-TMST       OCCURS 1000 TIMES           03080095
147460                                      PIC  X(26)  VALUE SPACES.   03090095
147460                                                                  03100095
147460     05  PV-NULL-IND.                                             03110095
147460         10  PV-PRCHG-DESC-NI         OCCURS 1000 TIMES           03120095
147460                                      PIC S9(4) VALUE +0 COMP.    03130095
147460         10  PV-PRCHG-DEPT-NBR-NI     OCCURS 1000 TIMES           03140095
147460                                      PIC S9(4) VALUE +0 COMP.    03150095
147460         10  PV-ALL-RMNG-STR-IND-NI   OCCURS 1000 TIMES           03160095
147460                                      PIC S9(4) VALUE +0 COMP.    03170095
147460         10  PV-SUBMTD-BY-USR-ID-NI   OCCURS 1000 TIMES           03180095
147460                                      PIC S9(4) VALUE +0 COMP.    03190095
147460         10  PV-SUBMTD-TMST-NI        OCCURS 1000 TIMES           03200095
147460                                      PIC S9(4) VALUE +0 COMP.    03210095
147460         10  PV-APP-BY-USR-ID-NI      OCCURS 1000 TIMES           03220095
147460                                      PIC S9(4) VALUE +0 COMP.    03230095
147460         10  PV-APP-TMST-NI           OCCURS 1000 TIMES           03240095
147460                                      PIC S9(4) VALUE +0 COMP.    03250095
147460 01  PV-PREV-PRCHG-ID                 PIC  9(10) VALUE ZEROES.    03260095
147460 01  PV-PRCHG-SKIP-CNT                PIC  9(10) VALUE ZEROES.    03270095
147460*                                                                 03280095
020000 01  PA-PROGRAM-ACCUMULATORS.                                     03290095
020100     05  PA-RECS-WRITTEN              PIC S9(11)  COMP-3          03300095
147460                                                  VALUE ZEROS.    03310095
147460     05  PA-PRCHG-RECS-WRITTEN        PIC S9(11)  COMP-3          03320095
020200                                                  VALUE ZEROS.    03330095
020300     05  PA-PRCHGMDSE-CNT             PIC S9(11)  COMP-3          03340095
020400                                                  VALUE ZEROS.    03350095
020500     05  PA-PRCHGMDSENS-CNT           PIC S9(11)  COMP-3          03360095
020600                                                  VALUE ZEROS.    03370095
147460     05  PA-PRCHG-CNT                 PIC S9(11)  COMP-3          03380095
                                                        VALUE ZEROS.    03390095
020700                                                                  03400095
020800******************************************************************03410095
020900*    COPYBOOK FOR THE PRCHGMDSE FILE                              03420095
021000******************************************************************03430095
021100     COPY PERD105.                                                03440095
021200                                                                  03450095
020800******************************************************************03460095
020900*    COPYBOOK FOR THE SGPRCHG FILE                                03470095
021000******************************************************************03480095
021100     COPY PERD104.                                                03490095
021200                                                                  03500095
147460******************************************************************03510095
147460*    COPYBOOK FOR THE PRCHG FILE                                  03520095
147460******************************************************************03530095
147460     COPY PERD103.                                                03540095
021300                                                                  03550095
021400***************************************************************** 03560095
021500*                      O  R  A  C  L  E                           03570095
021600*================================================================ 03580095
021700* ORACLE DECLARE SECTION                                          03590095
021800* ORACLE USED AND RETURNED VARIABLES                              03600095
021900***************************************************************** 03610095
022000     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     03620095
022100                                                                  03630095
022200*---------------------------------------------------------------* 03640095
022300* ORACLE LOGON WORKING STORAGE COPYBOOK                           03650095
022400*---------------------------------------------------------------* 03660095
022500 01      PC-ENT01-TYPE-CDE          PIC X(02)      VALUE '01'.    03670095
022600 01      PV-ORACLE-ID               PIC X(1)       VALUE '/'.     03680095
022700                                                                  03690095
022800 01      USERNAME                   PIC X(10)      VARYING.       03700095
022900 01      PASSWD                     PIC X(10)      VARYING.       03710095
023000                                                                  03720095
023100 01      ORACLE-RETURN              PIC X(200)     VALUE SPACES.  03730095
023200                                                                  03740095
023300     EXEC SQL END DECLARE SECTION END-EXEC.                       03750095
023400     EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       03760095
023500                                                                  03770095
023600********************                                              03780095
023700 EJECT                                                            03790095
023800********************                                              03800095
023900 PROCEDURE DIVISION.                                              03810095
024000********************                                              03820095
024100***************************************************************** 03830095
024200* A100-MAINLINE.                                                * 03840095
024300***************************************************************** 03850095
024400 A100-MAINLINE.                                                   03860095
024400     DISPLAY 'A100-MAINLINE.'                                     03870095
024500                                                                  03880095
024600     SET PS-DATE-RANGE-FILE-START TO TRUE.                        03890095
024700     PERFORM B100-OPEN-FILES.                                     03900095
024800     PERFORM B200-READ-DATE-RANGE-FILE.                           03910095
024900     PERFORM B300-READ-LOCK-TBLS-OPT-FILE.                        03920095
025000                                                                  03930095
070941*    PERFORM PE700-A000-ORACLE-SETUP.                             03940096
025200                                                                  03950095
025300     IF CC-LOCK-TBLS-OPTION = 'Y'                                 03960095
025400         PERFORM C150-LOCK-TABLES                                 03970095
025500     END-IF.                                                      03980095
025600                                                                  03990095
025700     PERFORM C200-DECLARE-PRCHG-MDSE-CSR.                         04000095
025800     PERFORM C300-OPEN-PRCHG-MDSE-CSR.                            04010095
024400     DISPLAY 'STARTING LOOP PROCESSING C400-MAINLINE.'            04020095
025900     PERFORM C400-FETCH-PRCHG-MDSE-CSR                            04030095
026000         UNTIL PS-END-OF-PRCHG-MDSE-CSR.                          04040095
026300     PERFORM C600-CLOSE-PRCHG-MDSE-CSR.                           04050095
026400                                                                  04060095
026500     PERFORM B900-CLOSE-FILES.                                    04070095
026600                                                                  04080095
147460     DISPLAY 'RECORDS WRITTEN TO PRCHG FILE = '                   04090095
                                                PA-PRCHG-RECS-WRITTEN.  04100095
026700     DISPLAY 'RECORDS WRITTEN TO FILE = ' PA-RECS-WRITTEN.        04110095
026800     DISPLAY 'PRCHGMDSE CSR FETCHES FROM ORACLE = '               04120095
026900                                                PA-PRCHGMDSE-CNT. 04130095
027000                                                                  04140095
027100     STOP RUN.                                                    04150095
027200                                                                  04160095
027300***************************************************************** 04170095
027400* B100-OPEN-FILES.                                              * 04180095
027500* ==> PROCESSES:                                                * 04190095
027600*  - OPEN TWO INPUT FILES AND ONE OUTPUT FILE                   * 04200095
027700* ==> PERFORMED FROM: A100-MAINLINE                             * 04210095
027800***************************************************************** 04220095
027900 B100-OPEN-FILES.                                                 04230095
                                                                        04231095
070941     DISPLAY 'ORACLE FILE OPEN'.                                  04232095
070941     OPEN INPUT ORACLE-LOGON-FILE.                                04233095
070941                                                                  04234095
070941     DISPLAY 'ORACLE FILE READ'.                                  04235095
070941     PERFORM 7000-READ-ORACLE-LOGON.                              04236095
070941                                                                  04237095
070941     DISPLAY 'ORACLE FILE CLOSE'.                                 04238095
070941     CLOSE ORACLE-LOGON-FILE.                                     04239095
070941                                                                  04239195
070941     IF ((PS-END-OF-LOGON-FILE)                                   04239295
070941             OR (CC-ORACLE-CONNECTION = SPACES))                  04239395
070941         DISPLAY '** ABEND **'                                    04239495
070941         DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '  04239595
070941                   'NOT PROVIDED'                                 04239695
070941         SET PS-ORA-SRC-EMPTY TO TRUE                             04239795
070941         CALL 'ILBOABN0' USING ABEND-CODE                         04239895
070941     END-IF.                                                      04239995
070941                                                                  04240095
070941     IF CC-AUTO-LOGON                                             04240195
070941         DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'        04240295
070941         EXEC SQL                                                 04240395
070941              CONNECT :USERNAME                                   04240495
070941         END-EXEC                                                 04240595
070941     ELSE                                                         04240695
070941         INITIALIZE PV-ORACLE-USERID-LEN                          04240795
070941                    PV-ORACLE-PASSWORD-LEN                        04240895
070941         INSPECT CC-ORACLE-USERID                                 04240995
070941             TALLYING PV-ORACLE-USERID-LEN                        04241095
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     04241195
070941      INSPECT CC-ORACLE-PASSWORD                                  04241295
070941          TALLYING PV-ORACLE-PASSWORD-LEN                         04241395
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     04241495
070941      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           04241595
070941                USERNAME-ARR                                      04241695
070941      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   04241795
070941      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       04241895
070941                PASSWD-ARR                                        04241995
070941      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   04242095
070941      DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '       04242195
070941                USERNAME-ARR                                      04242295
070941      EXEC SQL                                                    04242395
070941        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   04242495
070941      END-EXEC                                                    04242595
070941      INITIALIZE CC-ORACLE-PASSWORD                               04242695
070941                 PASSWD                                           04242795
070941      END-IF.                                                     04242895
070941                                                                  04242995
070941     IF (SQLCODE NOT = 0)                                         04243095
070941         DISPLAY PV-PARAGRAPH-NAME                                04243195
070941         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'  04243295
070941         PERFORM 9900-ORACLE-ABEND                                04243395
070941     END-IF.                                                      04243495
028000                                                                  04244095
028100     OPEN INPUT  DATE-RANGE-FILE                                  04250095
028200                 LOCK-TBLS-OPTION-FILE                            04260095
028300          OUTPUT PRCHGMDSE-FILE                                   04270095
147460                 SGPRCHG-FILE                                     04280095
147460                 PRCHG-FILE.                                      04290095
028400                                                                  04300095
028500***************************************************************** 04310095
028600* B200-READ-DATE-RANGE-FILE.                                    * 04320095
028700* ==> PROCESSES:                                                * 04330095
028800*  - READ IN THE DATE RANGE FILE                                * 04340095
028900* ==> PERFORMED FROM: A100-MAINLINE                             * 04350095
029000***************************************************************** 04360095
029100 B200-READ-DATE-RANGE-FILE.                                       04370095
029200                                                                  04380095
029300     READ DATE-RANGE-FILE INTO CC-DATE-RANGE-FILE                 04390095
029400        AT END                                                    04400095
029500           SET PS-DATE-RANGE-FILE-END TO TRUE                     04410095
029600     END-READ.                                                    04420095
029700                                                                  04430095
029800     IF PS-DATE-RANGE-FILE-END                                    04440095
029900         MOVE 'NO DATE RANGE FILE TO PROCESS'                     04450095
030000                                           TO PV-OPERATION-MSG-1  04460095
030100         SET ABEND-4003-CTRL-CARD-ERROR    TO TRUE                04470095
030200         PERFORM Z910-ABEND                                       04480095
030300     ELSE                                                         04490095
030400         DISPLAY 'CC-START-DATE = ' CC-START-DATE                 04500095
030500         DISPLAY 'CC-END-DATE   = ' CC-END-DATE                   04510095
030600                                                                  04520095
030700         STRING CC-START-DATE DELIMITED BY SPACE                  04530095
030800                PC-SPACE DELIMITED BY SIZE                        04540095
030900                PC-BEG-TMST   DELIMITED BY SIZE                   04550095
031000                INTO PV-NEW-STRT-DATE                             04560095
031100                                                                  04570095
031200         STRING CC-END-DATE DELIMITED BY SPACE                    04580095
031300                PC-SPACE DELIMITED BY SIZE                        04590095
031400                PC-END-TMST   DELIMITED BY SIZE                   04600095
031500                INTO PV-NEW-END-DATE                              04610095
031600     END-IF.                                                      04620095
031700                                                                  04630095
031800***************************************************************** 04640095
031900* B300-READ-LOCK-TBLS-OPT-FILE.                                 * 04650095
032000* ==> PROCESSES:                                                * 04660095
032100*  - READ IN THE LOCK TABLES OPTION FILE                        * 04670095
032200* ==> PERFORMED FROM: A100-MAINLINE                             * 04680095
032300***************************************************************** 04690095
032400 B300-READ-LOCK-TBLS-OPT-FILE.                                    04700095
032500                                                                  04710095
032600     READ LOCK-TBLS-OPTION-FILE INTO CC-LOCK-TBLS-OPTION-FILE     04720095
032700        AT END                                                    04730095
032800           SET PS-LOCK-TBLS-OPTION-FILE-END TO TRUE               04740095
032900     END-READ.                                                    04750095
033000                                                                  04760095
033100     IF PS-LOCK-TBLS-OPTION-FILE-END                              04770095
033200         MOVE 'Y' TO CC-LOCK-TBLS-OPTION                          04780095
033300         DISPLAY 'NO LOCK TABLES OPTION FILE TO PROCESS'          04790095
033400         DISPLAY 'OPTION SET TO YES AS DEFAULT'                   04800095
033500     ELSE                                                         04810095
033600         DISPLAY 'CC-LOCK-TBLS-OPTION = ' CC-LOCK-TBLS-OPTION     04820095
033700     END-IF.                                                      04830095
033800                                                                  04840095
033900     IF CC-LOCK-TBLS-OPTION-FILE = 'Y' OR 'N'                     04850095
034000         NEXT SENTENCE                                            04860095
034100     ELSE                                                         04870095
034200         MOVE 'Y' TO CC-LOCK-TBLS-OPTION                          04880095
034300         DISPLAY 'INVALID LOCK TABLES OPTION ENTERED'             04890095
034400         DISPLAY 'OPTION SET TO YES AS DEFAULT'                   04900095
034500     END-IF.                                                      04910095
034600                                                                  04920095
034700***************************************************************** 04930095
034800* B900-CLOSE-FILES                                              * 04940095
034900* ==> PROCESSES:                                                * 04950095
035000*  - CLOSE THE TWO INPUT FILES AND ONE OUTPUT FILE              * 04960095
035100* ==> PERFORMED FROM: A100-MAINLINE                             * 04970095
035200***************************************************************** 04980095
035300 B900-CLOSE-FILES.                                                04990095
035400                                                                  05000095
035500     CLOSE  DATE-RANGE-FILE                                       05010095
035600            LOCK-TBLS-OPTION-FILE                                 05020095
035700            PRCHGMDSE-FILE                                        05030095
147460            SGPRCHG-FILE                                          05040095
147460            PRCHG-FILE.                                           05050095
035800                                                                  05060095
035900***************************************************************** 05070095
036000* C150-LOCK-TABLES.                                             * 05080095
036100* ==> PROCESSES:                                                * 05090095
036200*  - LOCKS TABLES WHILE PROGRAM IS RUNNING SO THAT THE EXTRACT  * 05100095
036300*    WILL MATCH DOMAINS.                                        * 05110095
036400* ==> PERFORMED FROM: A100-MAINLINE                             * 05120095
036500***************************************************************** 05130095
036600 C150-LOCK-TABLES.                                                05140095
036700                                                                  05150095
036800     PERFORM WITH TEST AFTER                                      05160095
036900       VARYING PV-SELECT-COUNTER                                  05170095
037000       FROM 1 BY 1                                                05180095
037100     UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRY-CNT OR               05190095
037200            SQLCODE NOT = -0054)                                  05200095
037300         EXEC SQL                                                 05210095
037400             LOCK TABLE PET_PERM_EVNT                             05220095
037500                       ,PET_PRCHG                                 05230095
037600                       ,PET_STR_GP_PRCHG_ASSN                     05240095
037700                       ,PET_PRCHG_MDSE_SELN                       05250095
037800                       ,PET_PRCHG_MDSE_SELN_LNE                   05260095
037900                       ,PET_STR_GP_MDSE_LNE_PRICG                 05270095
038000                       ,PET_PRCHG_SKU_SUBLNE                      05280095
038100                       ,PET_CLR_MDSE_LNE                          05290095
038200                       ,PET_CLR_MDSE_PRICG                        05300095
038300                       IN EXCLUSIVE MODE NOWAIT                   05310095
038400         END-EXEC                                                 05320095
038500         EVALUATE TRUE                                            05330095
038600           WHEN SQLCODE = ZEROES                                  05340095
038700               DISPLAY 'PET_PERM_EVNT             TBL IS LOCKED..'05350095
038800               DISPLAY 'PET_PRCHG                 TBL IS LOCKED..'05360095
038900               DISPLAY 'PET_STR_GP_PRCHG_ASSN     TBL IS LOCKED..'05370095
039000               DISPLAY 'PET_PRCHG_MDSE_SELN       TBL IS LOCKED..'05380095
039100               DISPLAY 'PET_PRCHG_MDSE_SELN_LNE   TBL IS LOCKED..'05390095
039200               DISPLAY 'PET_STR_GP_MDSE_LNE_PRICG TBL IS LOCKED..'05400095
039300               DISPLAY 'PET_PRCHG_SKU_SUBLNE      TBL IS LOCKED..'05410095
039400               DISPLAY 'PET_CLR_MDSE_LNE          TBL IS LOCKED..'05420095
039500               DISPLAY 'PET_CLR_MDSE_PRICG        TBL IS LOCKED..'05430095
039600           WHEN SQLCODE = -0054                                   05440095
039700               CONTINUE                                           05450095
039800           WHEN OTHER                                             05460095
039900               MOVE 'C150-LOCK-TABLES                '            05470095
040000                                 TO PV-PARAGRAPH-NAME             05480095
040100               MOVE 'ERROR LOCKING TABLES           '             05490095
040200                                 TO PV-OPERATION-MSG-1            05500095
040300               PERFORM 9900-ORACLE-ABEND                          05510095
040400         END-EVALUATE                                             05520095
040500     END-PERFORM.                                                 05530095
040600                                                                  05540095
040700     IF PV-SELECT-COUNTER > PC-MAX-RETRY-CNT                      05550095
040800         DISPLAY 'MAX RETRY ATTEMPTING TO LOCK TABLES:  '         05560095
040900         DISPLAY 'PET_PERM_EVNT,'                                 05570095
041000         DISPLAY 'PET_PRCHG,'                                     05580095
041100         DISPLAY 'PET_STR_GP_PRCHG_ASSN,'                         05590095
041200         DISPLAY 'PET_PRCHG_MDSE_SELN,'                           05600095
041300         DISPLAY 'PET_PRCHG_MDSE_SELN_LNE,'                       05610095
041400         DISPLAY 'PET_STR_GP_MDSE_LNE_PRICG,'                     05620095
041500         DISPLAY 'PET_PRCHG_SKU_SUBLNE,'                          05630095
041600         DISPLAY 'PET_CLR_MDSE_LNE,'                              05640095
041700         DISPLAY 'PET_CLR_MDSE_PRICG.'                            05650095
041800         DISPLAY 'RETRIED ' PC-MAX-RETRY-CNT ' TIMES - '          05660095
041900         DISPLAY 'RESTART JOB IN A FEW MINUTES.'                  05670095
042000         MOVE 'C150-LOCK-TABLES                '                  05680095
042100                           TO PV-PARAGRAPH-NAME                   05690095
042200         MOVE 'ERROR LOCKING TABLES           '                   05700095
042300                           TO PV-OPERATION-MSG-1                  05710095
042400         PERFORM 9900-ORACLE-ABEND                                05720095
042500     END-IF.                                                      05730095
042600                                                                  05740095
042700***************************************************************** 05750095
042800* C200-DECLARE-PRCHG-MDSE-CSR.                                  * 05760095
042900* ==> PROCESSES:                                                * 05770095
043000*  - USED A VIEW IN THE FROM CLAUSE INSTEAD OF IND TABLES       * 05780095
043100* ==> PERFORMED FROM: A100-MAINLINE                             * 05790095
043200***************************************************************** 05800095
043300 C200-DECLARE-PRCHG-MDSE-CSR.                                     05810095
043400                                                                  05820095
043500     EXEC SQL                                                     05830095
043600          DECLARE PRCHGMDSECSR                                    05840095
043700          CURSOR FOR                                              05850095
           SELECT                                                       05860095
                  VT4.STR_GP_TYP_CDE                                    05870095
                 ,VT4.STR_GP_ID                                         05880095
                 ,VT4.PRCHG_ID                                          05890095
147460           ,VT4.PRCHG_DESC                                        05900095
147460         ,VT4.DEPT_NBR                                            05910095
147460         ,VT4.EVNT_CTG_CDE                                        05920095
147460         ,VT4.PRCHG_TYP_CDE                                       05930095
147460         ,VT4.PRCHG_ST_CDE                                        05940095
147460         ,VT4.ALL_RMNG_STR_IND                                    05950095
147460         ,VT4.SUBMTD_BY_USR_ID                                    05960095
147460         ,VT4.SUBMTD_TMST                                         05970095
147460         ,VT4.APP_BY_USR_ID                                       05980095
147460         ,VT4.APP_TMST                                            05990095
147460         ,VT4.PRCHG_CRE_TMST                                      06000095
147460         ,VT4.PRCHG_LAST_UPD_TMST                                 06010095
                 ,VT4.MDSE_ID                                           06020095
                 ,'SKU' MDSE_LVL                                        06030095
                 ,VT4.N1                                                06040095
                 ,VT4.N2                                                06050095
                 ,VT4.N3                                                06060095
                 ,VT4.N4                                                06070095
                 ,VT4.SKU_NBR                                           06080095
                 ,VT4.NEW_PRICE_AMT                                     06090095
                 ,VT4.NEW_GP_PRICE_ID                                   06100095
                 ,VT4.GP_RTL_AMT                                        06110095
                 ,VT4.GP_RTL_QTY                                        06120095
                 ,VT4.N5                                                06130095
                 ,VT4.N6                                                06140095
                 ,VT4.CRE_TMST                                          06150095
                 ,VT4.LST_UPD_TMST                                      06160095
                 ,VT4.LAST_UPD_TMST                                     06170095
                 ,VT4.EFF_DTE                                           06180095
                 ,VT4.OH_AUTO_CNT_IND                                   06190095
DGM              ,0                                    LAST_MARK_PRICE  06200095
DGM   *          ,NVL(VT5.UNT_RTL_AMT,VT6.UNT_RTL_AMT) LAST_MARK_PRICE  06210095
            FROM                                                        06220095
C93562      (SELECT /*+ FULL(SGPA) FULL(GMLP) FULL(GP)                  06230095
C93562        FULL(XGPC) FULL(SGMLP) PARALLEL */       --GP             06240095
               SGPC.STR_GP_TYP_CDE STR_GP_TYP_CDE                       06250095
              ,SGPC.STR_GP_ID STR_GP_ID                                 06260095
              ,SGPA.PRCHG_ID PRCHG_ID                                   06270095
147460     ,PH.PRCHG_DESC PRCHG_DESC                                    06280095
147460     ,PH.DEPT_NBR   DEPT_NBR                                      06290095
147460     ,PE.EVNT_CTG_CDE EVNT_CTG_CDE                                06300095
147460     ,PH.PRCHG_TYP_CDE PRCHG_TYP_CDE                              06310095
147460     ,PH.PRCHG_ST_CDE  PRCHG_ST_CDE                               06320095
147460     ,PH.ALL_RMNG_STR_IND ALL_RMNG_STR_IND                        06330095
147460     ,PH.SUBMTD_BY_USR_ID SUBMTD_BY_USR_ID                        06340095
147460     ,TO_CHAR(PH.SUBMTD_TMST,                                     06350095
147460                        'YYYY-MM-DD-HH24.MI.SS') SUBMTD_TMST      06360095
147460     ,PH.APP_BY_USR_ID    APP_BY_USR_ID                           06370095
147460     ,TO_CHAR(PH.APP_TMST,                                        06380095
147460              'YYYY-MM-DD-HH24.MI.SS') APP_TMST                   06390095
147460     ,TO_CHAR(PH.CRE_TMST,                                        06400095
147460              'YYYY-MM-DD-HH24.MI.SS') PRCHG_CRE_TMST             06410095
147460     ,TO_CHAR(PH.LAST_UPD_TMST,                                   06420095
                       'YYYY-MM-DD-HH24.MI.SS') PRCHG_LAST_UPD_TMST     06430095
              ,MSL.PRCHG_MDSE_SELN_LNE_ID MDSE_ID                       06440095
              ,'SKU' MDSE_LVL                                           06450095
              ,NULL N1                                                  06460095
              ,NULL N2                                                  06470095
              ,NULL N3                                                  06480095
              ,NULL N4                                                  06490095
              ,MSL.SKU_NBR SKU_NBR                                      06500095
              ,SGMLP.NW_MDSE_LNE_PRIC_AMT NEW_PRICE_AMT                 06510095
              ,SGMLP.NW_GP_PRIC_ID NEW_GP_PRICE_ID                      06520095
              ,GP.GP_RTL_AMT GP_RTL_AMT                                 06530095
              ,GP.GP_RTL_QTY GP_RTL_QTY                                 06540095
              ,NULL N5                                                  06550095
              ,NULL N6                                                  06560095
              ,TO_CHAR(SGMLP.CRE_TMST,                                  06570095
                       'YYYY-MM-DD-HH24.MI.SS') CRE_TMST                06580095
              ,TO_CHAR(SGMLP.LAST_UPD_TMST,                             06590095
                       'YYYY-MM-DD-HH24.MI.SS') LST_UPD_TMST            06600095
              ,TO_CHAR(SGPA.LAST_UPD_TMST,                              06610095
                       'YYYY-MM-DD-HH24.MI.SS') LAST_UPD_TMST           06620095
              ,TO_CHAR(PE.EFF_DTE,                                      06630095
                      'YYYYMMDD') EFF_DTE                               06640095
              ,PE.OH_AUTO_CNT_IND                                       06650095
          FROM PET_PERM_EVNT             PE                             06660095
              ,PET_STR_GP_PRCHG_ASSN     SGPA                           06670095
              ,PET_PRCHG                 PH                             06680095
              ,PET_PRCHG_MDSE_SELN       MS                             06690095
              ,PET_PRCHG_MDSE_SELN_LNE   MSL                            06700095
              ,PET_STR_GP_MDSE_LNE_PRICG SGMLP                          06710095
              ,XKT_GP_PRIC               GP                             06720095
              ,PMT_STR_SELN              SGPB                           06730095
              ,XKT_STR_GP_DTE            SGPC                           06740095
         WHERE PE.PERM_EVNT_ID =  SGPA.PERM_EVNT_ID                     06750095
           AND SGPA.PRCHG_ID   = PH.PRCHG_ID                            06760095
           AND MSL.PRCHG_MDSE_SELN_ID =                                 06770095
                       MS.PRCHG_MDSE_SELN_ID                            06780095
           AND SGMLP.STR_GP_PRCHG_ASSN_ID =                             06790095
                       SGPA.STR_GP_PRCHG_ASSN_ID                        06800095
           AND SGPA.STR_SELN_ID    = SGPB.STR_SELN_ID                   06810095
           AND SGPB.EFF_STR_GP_ID  = SGPC.EFF_STR_GP_ID                 06820095
           AND SGMLP.PRCHG_MDSE_SELN_LNE_ID =                           06830095
                            MSL.PRCHG_MDSE_SELN_LNE_ID                  06840095
           AND PH.PRCHG_ST_CDE IN ('APR',                               06850095
                                   'PND')                               06860095
147460*    AND PE.EVNT_CTG_CDE = 'CON'                                  06870095
           AND PH.STAT_CDE = 'S'                                        06880095
           AND MS.STAT_CDE = 'S'                                        06890095
           AND MS.MDSE_HIER_CDE = 'SKU'                                 06900095
           AND MSL.STAT_CDE = 'S'                                       06910095
           AND SGPA.STAT_CDE = 'S'                                      06920095
           AND SGMLP.STAT_CDE = 'S'                                     06930095
           AND GP.GP_PRIC_ID(+) = SGMLP.NW_GP_PRIC_ID                   06940095
           AND PE.EFF_DTE      >= TO_DATE(                              06950095
                 :CC-START-DATE, 'YYYY-MM-DD HH24:MI:SS')               06960095
           AND PE.EFF_DTE        <= TO_DATE(                            06970095
                 :CC-END-DATE, 'YYYY-MM-DD HH24:MI:SS')                 06980095
            ) VT4                                                       06990095
DGM   *    ,                                                            07000095
DGM   *                                                                 07010095
DGM   *      -- JOIN ON XKT_SKU_LOC - STORE LEVEL ROW                   07020095
DGM   *      (SELECT LOC_NBR                                            07030095
DGM   *             ,UNT_RTL_AMT                                        07040095
DGM   *             ,B.SKU_NBR                                          07050095
DGM   *             ,B.STYL_ID                                          07060095
DGM   *         FROM XKT_SKU_LOC A                                      07070095
DGM   *             ,XKT_SKU     B                                      07080095
DGM   *        WHERE B.INTR_UPC_ID = A.INTR_UPC_ID                      07090095
DGM   *          AND TRUNC(TO_DATE(:CC-START-DATE,'YYYY-MM-DD')) -1     07100095
DGM   *              BETWEEN A.BEG_TMST                                 07110095
DGM   *          AND NVL(A.END_TMST,TRUNC(TO_DATE(:CC-START-DATE,       07120095
DGM   *              'YYYY-MM-DD')))) VT5,                              07130095
DGM   *                                                                 07140095
DGM   *      -- JOIN ON XKT_SKU_LOC - CORPORATE LEVEL ROW               07150095
DGM   *      (SELECT LOC_NBR                                            07160095
DGM   *             ,UNT_RTL_AMT                                        07170095
DGM   *             ,B.SKU_NBR                                          07180095
DGM   *             ,B.STYL_ID                                          07190095
DGM   *         FROM XKT_SKU_LOC A                                      07200095
DGM   *             ,XKT_SKU     B                                      07210095
DGM   *        WHERE B.INTR_UPC_ID = A.INTR_UPC_ID                      07220095
DGM   *          AND TRUNC(TO_DATE(:CC-START-DATE,'YYYY-MM-DD')) -1     07230095
DGM   *              BETWEEN A.BEG_TMST                                 07240095
DGM   *          AND NVL(A.END_TMST,TRUNC(TO_DATE(:CC-START-DATE,       07250095
DGM   *              'YYYY-MM-DD')))                                    07260095
DGM   *          AND LOC_NBR = 0) VT6                                   07270095
DGM   *                                                                 07280095
DGM   *      -- OUTER JOINS TO ENSURE ALL ROWS ARE BROUGHT BACK         07290095
DGM   *          WHERE VT5.LOC_NBR(+) = VT4.STR_GP_ID                   07300095
DGM   *            AND VT5.SKU_NBR(+) = VT4.SKU_NBR                     07310095
DGM   *            AND VT6.SKU_NBR(+) = VT4.SKU_NBR                     07320095
058700     END-EXEC.                                                    07330095
                                                                        07340095
058800***************************************************************   07350095
058900* C300-OPEN-PRCHG-MDSE-CSR.                                   *   07360095
059000* ==> PROCESSES:                                              *   07370095
059100*  - OPEN PRCHGMDSECSR                                        *   07380095
059200* ==> SQLCODE:                                                *   07390095
059300*  - 0 = SUCCESSFUL OPEN                                      *   07400095
059400* ==> PERFORMED FROM: A100-MAINLINE                           *   07410095
059500***************************************************************   07420095
059600 C300-OPEN-PRCHG-MDSE-CSR.                                        07430095
059700                                                                  07440095
059800     EXEC SQL                                                     07450095
059900           OPEN PRCHGMDSECSR                                      07460095
060000     END-EXEC.                                                    07470095
060100                                                                  07480095
060200     EVALUATE TRUE                                                07490095
060300         WHEN SQLCODE = ZERO                                      07500095
060400             CONTINUE                                             07510095
060500         WHEN OTHER                                               07520095
060600             MOVE 'C300-OPEN-PRCHG-MDSE-CSR      '                07530095
060700                               TO PV-PARAGRAPH-NAME               07540095
060800             MOVE 'OPEN ERROR ON PRCHGMDSECSR'                    07550095
060900                               TO PV-OPERATION-MSG-1              07560095
061000             PERFORM 9900-ORACLE-ABEND                            07570095
061100     END-EVALUATE.                                                07580095
061200                                                                  07590095
061300***************************************************************** 07600095
061400* C400-FETCH-PRCHG-MDSE-CSR.                                    * 07610095
061500* ==> PROCESSES:                                                * 07620095
061600*  - WHEN DATA IS BROUGHT BACK FROM THE CURSOR FETCH IT TO THE  * 07630095
061700*    VARIABLES LISTED.                                          * 07640095
061800*  - THEN MOVE TO THE COPYBOOK                                  * 07650095
061900* ==> SQLCODE:                                                  * 07660095
062000*  - 0    = A ROW WAS FOUND                                     * 07670095
062100*  - 1403 = WHEN NO DATA WAS FOUND                              * 07680095
062200* ==> PERFORMED FROM: A100-MAINLINE, C500-PROCESS-PRCHG-MDSE-CSR *07690095
062300***************************************************************** 07700095
062400 C400-FETCH-PRCHG-MDSE-CSR.                                       07710095
062500                                                                  07720095
062600     INITIALIZE PV-SELECT-VARIABLES.                              07730095
062700                                                                  07740095
062800     EXEC SQL                                                     07750095
062900         FETCH PRCHGMDSECSR                                       07760095
063000          INTO  :PV-STR-GP-TYP-CDE                                07770095
063100               ,:PV-STR-GP-ID                                     07780095
063200               ,:PV-PRCHG-ID                                      07790095
147460               ,:PV-PRCHG-DESC      :PV-PRCHG-DESC-NI             07800095
147460               ,:PV-PRCHG-DEPT-NBR  :PV-PRCHG-DEPT-NBR-NI         07810095
147460               ,:PV-EVNT-CTG-CDE                                  07820095
147460               ,:PV-PRCHG-TYP-CDE                                 07830095
147460               ,:PV-PRCHG-ST-CDE                                  07840095
147460               ,:PV-ALL-RMNG-STR-IND :PV-ALL-RMNG-STR-IND-NI      07850095
147460               ,:PV-SUBMTD-BY-USR-ID :PV-SUBMTD-BY-USR-ID-NI      07860095
147460               ,:PV-SUBMTD-TMST      :PV-SUBMTD-TMST-NI           07870095
147460               ,:PV-APP-BY-USR-ID    :PV-APP-BY-USR-ID-NI         07880095
147460               ,:PV-APP-TMST         :PV-APP-TMST-NI              07890095
147460               ,:PV-PRCHG-CRE-TMST                                07900095
147460               ,:PV-PRCHG-LAST-UPD-TMST                           07910095
063300               ,:PV-PRCHG-MDSE-ID                                 07920095
063400               ,:PV-MDSE-HIER-CDE                                 07930095
063500               ,:PV-DEPT-NBR      :PV-DEPT-NBR-NI                 07940095
063600               ,:PV-MAJ-CL-NBR    :PV-MAJ-CL-NBR-NI               07950095
063700               ,:PV-SUB-CL-NBR    :PV-SUB-CL-NBR-NI               07960095
063800               ,:PV-STYL-ID       :PV-STYL-ID-NI                  07970095
063900               ,:PV-SKU-NBR       :PV-SKU-NBR-NI                  07980095
064000               ,:PV-MDSE-PRIC-AMT :PV-MDSE-PRIC-AMT-NI            07990095
064100               ,:PV-GP-PRIC-ID    :PV-GP-PRIC-ID-NI               08000095
064200               ,:PV-GP-PRIC-AMT   :PV-GP-PRIC-AMT-NI              08010095
064300               ,:PV-GP-QTY        :PV-GP-QTY-NI                   08020095
064400               ,:PV-CLR-TYP-CDE   :PV-CLR-TYP-CDE-NI              08030095
064500               ,:PV-PRICG-GRID-ID :PV-PRICG-GRID-ID-NI            08040095
064600               ,:PV-SOR-CRE-TMST                                  08050095
064700               ,:PV-SOR-LAST-UPD-TMST                             08060095
                     ,:PV-SOR-LST-UPD-TMST                              08070095
                     ,:PV-PRCHG-EFF-DTE                                 08080095
                     ,:PV-OH-AUTO-CNT-IND                               08090095
DM0814               ,:PV-PREV-MARK-PRICE :PV-PREV-MARK-PRICE-NI        08100095
064800     END-EXEC.                                                    08110095
064900                                                                  08120095
065000     COMPUTE PV-RECORDS-TO-PROCESS                                08130095
065100           = SQLERRD(3) - PA-PRCHGMDSE-CNT                        08140095
065200     ON SIZE ERROR MOVE ZERO TO PV-RECORDS-TO-PROCESS.            08150095
065300                                                                  08160095
065200     MOVE PV-RECORDS-TO-PROCESS TO PV-CNT.                        08170095
065300                                                                  08180095
065400     EVALUATE TRUE                                                08190095
065500         WHEN SQLCODE = ZERO                                      08200095
065600            ADD PC-1000 TO PA-PRCHGMDSE-CNT                       08210095
065700            PERFORM C500-PROCESS-PRCHG-MDSE-CSR                   08220095
065800               VARYING PV-CNT                                     08230095
065900                  FROM 1 BY 1                                     08240095
066000                     UNTIL PV-CNT > PC-1000                       08250095
066300         WHEN SQLCODE = 1403                                      08260095
066400            IF PV-RECORDS-TO-PROCESS > 1                          08270095
066500               ADD PV-RECORDS-TO-PROCESS TO PA-PRCHGMDSE-CNT      08280095
066600               PERFORM C500-PROCESS-PRCHG-MDSE-CSR                08290095
066700                   VARYING PV-CNT                                 08300095
066800                      FROM 1 BY 1                                 08310095
066900                         UNTIL PV-CNT > PV-RECORDS-TO-PROCESS     08320095
067000            END-IF                                                08330095
067100            DISPLAY 'PRCHGMDSE COUNT FROM FETCH = '               08340095
067200                                            PA-PRCHGMDSE-CNT      08350095
067300            DISPLAY 'END OF ALL STR GP CSR'                       08360095
067400            SET PS-END-OF-PRCHG-MDSE-CSR TO TRUE                  08370095
067500                                                                  08380095
067600         WHEN OTHER                                               08390095
067700             MOVE 'C400-FETCH-PRCHG-MDSE-CSR        '             08400095
067800                               TO PV-PARAGRAPH-NAME               08410095
067900             MOVE 'FETCH ERROR ON PRCHGMDSECSR  '                 08420095
068000                               TO PV-OPERATION-MSG-1              08430095
068100             PERFORM 9900-ORACLE-ABEND                            08440095
068200     END-EVALUATE.                                                08450095
068300                                                                  08460095
068400***************************************************************** 08470095
068500* C500-PROCESS-PRCHG-MDSE-CSR.                                  * 08480095
068600* ==> PROCESSES:                                                * 08490095
068700*  - WRITE THE DATA TO THE FILE                                 * 08500095
068800*  - REINITALIZE THE VARIABLES TO START FROM SCRATCH            * 08510095
068900*  - FETCH THE NEXT ROW IN THE SELECT STATMENT                  * 08520095
069000* ==> PERFORMED FROM: A100-MAINLINE                             * 08530095
069100***************************************************************** 08540095
069200 C500-PROCESS-PRCHG-MDSE-CSR.                                     08550095
069300                                                                  08560095
069400     PERFORM F100-MOVE-TO-PRCHGMDSE-CPYBK.                        08570095
069500     PERFORM W100-WRITE-DETAIL.                                   08580095
069600                                                                  08590095
069700***************************************************************** 08600095
069800* C600-CLOSE-PRCHG-MDSE-CSR.                                    * 08610095
069900* ==> PROCESSES:                                                * 08620095
070000*  - CLOSE THE PRCHGMDSECSR                                     * 08630095
070100* ==> SQLCODE:                                                  * 08640095
070200*  - 0    = CLOSE WAS SUCCESSFUL                                * 08650095
070300* ==> PERFORMED FROM: A100-MAINLINE                             * 08660095
070400***************************************************************** 08670095
070500 C600-CLOSE-PRCHG-MDSE-CSR.                                       08680095
070600                                                                  08690095
070700     EXEC SQL                                                     08700095
070800          CLOSE PRCHGMDSECSR                                      08710095
070900     END-EXEC.                                                    08720095
071000                                                                  08730095
071100     EVALUATE TRUE                                                08740095
071200         WHEN SQLCODE = ZERO                                      08750095
071300             CONTINUE                                             08760095
071400         WHEN OTHER                                               08770095
071500            MOVE 'C600-CLOSE-PRCHG-MDSE-CSR      '                08780095
071600                              TO PV-PARAGRAPH-NAME                08790095
071700            MOVE 'CLOSE ERROR ON PRCHGMDSECSR    '                08800095
071800                              TO PV-OPERATION-MSG-1               08810095
071900             DISPLAY PV-PARAGRAPH-NAME                            08820095
072000             PERFORM 9900-ORACLE-ABEND                            08830095
072100     END-EVALUATE.                                                08840095
072200                                                                  08850095
072300***************************************************************** 08860095
072400* F100-MOVE-TO-PRCHGMDSE-CPYBK                                  * 08870095
072500* ==> PROCESSES:                                                * 08880095
072600*  - MOVE THE VARIABLES TO THE COPYBOOK                         * 08890095
072700* ==> PERFORMED FROM: C400-FETCH-PRCHGMDSE-CSR                  * 08900095
072800***************************************************************** 08910095
072900 F100-MOVE-TO-PRCHGMDSE-CPYBK.                                    08920095
073000                                                                  08930095
073100     INITIALIZE PE105-RECORD.                                     08940095
073200     MOVE PV-STR-GP-TYP-CDE (PV-CNT)   TO  PE105-STR-GP-TYP-CDE   08950095
                                                 PE104-STR-GP-TYP-CDE.  08960095
073300     MOVE PV-STR-GP-ID (PV-CNT)        TO  PE105-STR-GP-ID        08970095
                                                 PE104-STR-GP-ID.       08980095
073400     MOVE PV-PRCHG-ID (PV-CNT)         TO  PE105-PRCHG-ID         08990095
                                                 PE104-PRCHG-ID.        09000095
073500     MOVE PV-PRCHG-MDSE-ID (PV-CNT)    TO  PE105-PRCHG-MDSE-ID.   09010095
073600     MOVE PV-MDSE-HIER-CDE (PV-CNT)    TO  PE105-MDSE-HIER-CDE.   09020095
073700     MOVE PV-DEPT-NBR (PV-CNT)         TO  PE105-DEPT-NBR.        09030095
073800     MOVE PV-DEPT-NBR-NI (PV-CNT)      TO  PE105-DEPT-NBR-NI.     09040095
073900     MOVE PV-MAJ-CL-NBR (PV-CNT)       TO  PE105-MAJ-CL-NBR.      09050095
074000     MOVE PV-MAJ-CL-NBR-NI (PV-CNT)    TO  PE105-MAJ-CL-NBR-NI.   09060095
074100     MOVE PV-SUB-CL-NBR (PV-CNT)       TO  PE105-SUB-CL-NBR.      09070095
074200     MOVE PV-SUB-CL-NBR-NI (PV-CNT)    TO  PE105-SUB-CL-NBR-NI.   09080095
074300     MOVE PV-STYL-ID (PV-CNT)          TO  PE105-STYL-ID.         09090095
074400     MOVE PV-STYL-ID-NI (PV-CNT)       TO  PE105-STYL-ID-NI.      09100095
074500     MOVE PV-SKU-NBR (PV-CNT)          TO  PE105-SKU-NBR.         09110095
074600     MOVE PV-SKU-NBR-NI (PV-CNT)       TO  PE105-SKU-NBR-NI.      09120095
074700     MOVE PV-MDSE-PRIC-AMT (PV-CNT)    TO  PE105-MDSE-PRIC-AMT.   09130095
074800     MOVE PV-MDSE-PRIC-AMT-NI (PV-CNT) TO PE105-MDSE-PRIC-AMT-NI. 09140095
074900     MOVE PV-GP-PRIC-ID (PV-CNT)       TO  PE105-GP-PRIC-ID.      09150095
075000     MOVE PV-GP-PRIC-ID-NI (PV-CNT)    TO  PE105-GP-PRIC-ID-NI.   09160095
075100     MOVE PV-GP-PRIC-AMT (PV-CNT)      TO  PE105-GP-PRIC-AMT.     09170095
075200     MOVE PV-GP-PRIC-AMT-NI (PV-CNT)   TO  PE105-GP-PRIC-AMT-NI.  09180095
075300     MOVE PV-GP-QTY (PV-CNT)           TO  PE105-GP-QTY.          09190095
075400     MOVE PV-GP-QTY-NI (PV-CNT)        TO  PE105-GP-QTY-NI.       09200095
075500     MOVE PV-CLR-TYP-CDE (PV-CNT)      TO  PE105-CLR-TYP-CDE.     09210095
075600     MOVE PV-CLR-TYP-CDE-NI (PV-CNT)   TO  PE105-CLR-TYP-CDE-NI.  09220095
075700     MOVE PV-PRICG-GRID-ID (PV-CNT)    TO  PE105-PRICG-GRID-ID.   09230095
075800     MOVE PV-PRICG-GRID-ID-NI (PV-CNT) TO PE105-PRICG-GRID-ID-NI. 09240095
075900     STRING PV-SOR-CRE-TMST (PV-CNT) DELIMITED BY SPACE           09250095
076000            '.000000'     DELIMITED BY SIZE                       09260095
076100            INTO PE105-SOR-CRE-TMST.                              09270095
075900     STRING PV-SOR-CRE-TMST (PV-CNT) DELIMITED BY SPACE           09280095
076000            '.000000'     DELIMITED BY SIZE                       09290095
                  INTO PE104-SOR-CRE-TMST.                              09300095
076200     STRING PV-SOR-LAST-UPD-TMST (PV-CNT) DELIMITED BY SPACE      09310095
076300            '.000000'     DELIMITED BY SIZE                       09320095
076400            INTO PE105-SOR-LAST-UPD-TMST.                         09330095
076200     STRING PV-SOR-LST-UPD-TMST (PV-CNT) DELIMITED BY SPACE       09340095
076300            '.000000'     DELIMITED BY SIZE                       09350095
076400            INTO PE104-SOR-LAST-UPD-TMST.                         09360095
DM0814     MOVE PV-PRCHG-EFF-DTE (PV-CNT)   TO PE104-PRCHG-EFF-DTE.     09370095
DM0814     MOVE PV-OH-AUTO-CNT-IND (PV-CNT) TO PE104-OH-AUTO-CNT-IND.   09380095
DM0814     MOVE PV-PREV-MARK-PRICE (PV-CNT) TO PE105-PREV-MDSE-PRIC-AMT.09390095
DM0814     MOVE PV-PREV-MARK-PRICE-NI(PV-CNT)                           09400095
DM0814                                   TO PE105-PREV-MDSE-PRIC-AMT-NI.09410095
076500                                                                  09420095
      *                                                                 09430095
147460     IF   PV-PRCHG-ID (PV-CNT) = PV-PREV-PRCHG-ID                 09440095
147460     ADD  +1 TO PV-PRCHG-SKIP-CNT                                 09450095
147460     ELSE                                                         09460095
147460     MOVE PV-PRCHG-ID (PV-CNT)   TO PE103-PRCHG-ID                09470095
147460     MOVE PV-PRCHG-DESC (PV-CNT) TO PE103-PRCHG-DESC              09480095
147460     MOVE PV-PRCHG-DESC-NI (PV-CNT) TO PE103-PRCHG-DESC-NI        09490095
147460     MOVE PV-PRCHG-DEPT-NBR (PV-CNT) TO PE103-DEPT-NBR            09500095
147460     MOVE PV-PRCHG-DEPT-NBR-NI (PV-CNT) TO PE103-DEPT-NBR-NI      09510095
147460     MOVE PV-EVNT-CTG-CDE (PV-CNT) TO PE103-EVNT-CTG-CDE          09520095
147460     MOVE PV-PRCHG-TYP-CDE (PV-CNT) TO PE103-PRCHG-TYP-CDE        09530095
147460     MOVE PV-PRCHG-ST-CDE (PV-CNT) TO PE103-PRCHG-ST-CDE          09540095
147460     MOVE PV-ALL-RMNG-STR-IND (PV-CNT) TO PE103-ALL-RMNG-STR-IND  09550095
147460     MOVE PV-ALL-RMNG-STR-IND-NI (PV-CNT) TO                      09560095
147460                              PE103-ALL-RMNG-STR-IND-NI           09570095
147460                                                                  09580095
147460     MOVE PV-SUBMTD-BY-USR-ID (PV-CNT) TO                         09590095
147460                            PE103-SUBMTD-BY-USR-ID                09600095
147460     MOVE PV-SUBMTD-BY-USR-ID-NI (PV-CNT) TO                      09610095
147460                   PE103-SUBMTD-BY-USR-ID-NI                      09620095
147460                                                                  09630095
147460     IF PV-SUBMTD-TMST-NI (PV-CNT) > -1                           09640095
147460         STRING PV-SUBMTD-TMST (PV-CNT) DELIMITED BY SPACE        09650095
147460                '.000000'     DELIMITED BY SIZE                   09660095
147460                INTO PE103-SUBMTD-TMST                            09670095
147460     END-IF                                                       09680095
147460     MOVE PV-SUBMTD-TMST-NI (PV-CNT) TO PE103-SUBMTD-TMST-NI      09690095
147460                                                                  09700095
147460     MOVE PV-APP-BY-USR-ID (PV-CNT) TO PE103-APP-BY-USR-ID        09710095
147460     MOVE PV-APP-BY-USR-ID-NI (PV-CNT) TO                         09720095
147460                            PE103-APP-BY-USR-ID-NI                09730095
147460                                                                  09740095
147460     IF PV-APP-TMST-NI (PV-CNT) > -1                              09750095
147460         STRING PV-APP-TMST (PV-CNT) DELIMITED BY SPACE           09760095
147460                '.000000'     DELIMITED BY SIZE                   09770095
147460                INTO PE103-APP-TMST                               09780095
147460     END-IF                                                       09790095
147460     MOVE PV-APP-TMST-NI (PV-CNT) TO PE103-APP-TMST-NI            09800095
147460                                                                  09810095
147460     STRING PV-PRCHG-CRE-TMST (PV-CNT) DELIMITED BY SPACE         09820095
147460            '.000000'     DELIMITED BY SIZE                       09830095
147460            INTO PE103-SOR-CRE-TMST                               09840095
147460                                                                  09850095
147460     STRING PV-PRCHG-LAST-UPD-TMST (PV-CNT) DELIMITED BY SPACE    09860095
147460            '.000000'     DELIMITED BY SIZE                       09870095
147460            INTO PE103-SOR-LAST-UPD-TMST                          09880095
147460     WRITE PRCHG-LINE     FROM PE103-RECORD                       09890095
147460                                                                  09900095
147460     ADD +1                    TO PA-PRCHG-RECS-WRITTEN           09910095
147460     MOVE PV-PRCHG-ID (PV-CNT)  TO PV-PREV-PRCHG-ID               09920095
147460     END-IF.                                                      09930095
                                                                        09940095
076600***************************************************************** 09950095
076700* W100-WRITE-DETAIL.                                            * 09960095
076800* ==> PROCESSES:                                                * 09970095
076900*  - WRITE THE DETAIL LINE TO THE ADEVENT OUTPUT FILE           * 09980095
077000* ==> PERFORMED FROM: C500-PROCESS-PRCHG-MDSE-CSR               * 09990095
077100***************************************************************** 10000095
077200 W100-WRITE-DETAIL.                                               10010095
077300                                                                  10020095
077400     WRITE PRCHGMDSE-LINE FROM PE105-RECORD.                      10030095
077500                                                                  10040095
           WRITE SGPRCHG-LINE   FROM PE104-RECORD.                      10050095
077500                                                                  10060095
077600     ADD +1                    TO PA-RECS-WRITTEN                 10070095
                                        PV-DISPLAY-CNT.                 10080095
                                                                        10090095
DM0814     IF PV-DISPLAY-CNT > 499999 THEN                              10100095
DM0814        DISPLAY '500,000 RECORDS WRITTEN'                         10110095
DM0814        MOVE ZERO TO PV-DISPLAY-CNT                               10120095
DM0814     END-IF.                                                      10130095
077700                                                                  10140095
070941****************************************************************  10142095
070941** READ THE ORACLE LOGON CONTROL CARD.                        **  10143095
070941****************************************************************  10144095
070941 7000-READ-ORACLE-LOGON.                                          10145095
070941                                                                  10146095
070941     READ ORACLE-LOGON-FILE                                       10147095
070941         INTO CC-ORACLE-CONNECTION                                10148095
070941         AT END                                                   10149095
070941             SET PS-END-OF-LOGON-FILE TO TRUE                     10149195
070941     END-READ.                                                    10149295
                                                                        10149395
077800******************************************************************10150095
077900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION THAT     *10160095
078000* LOGONS TO ORACLE.                                              *10170095
078100******************************************************************10180095
070941*    COPY PEPD700.                                                10190096
                                                                        10410095
      *----------------------------------------------------------       10411095
      * 9900-ORACLE-ABEND.                                              10412095
      *     PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE.            10413095
      *----------------------------------------------------------       10414095
       9900-ORACLE-ABEND.                                               10415095
                                                                        10416095
           DISPLAY '                       '.                           10417095
           DISPLAY '** ABEND **       ** = SQLERROR'.                   10418095
070941*    DISPLAY '** PROGRAM        ** = ' PC-CURRENT-PROGRAM-NAME.   10419096
070941     DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           10419195
           DISPLAY '** SQLCODE        ** = ' PV-SQL.                    10419295
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                10419395
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   10419495
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  10419595
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                10419695
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         10419795
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.             10419895
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG.          10419995
           DISPLAY '                       '.                           10420095
                                                                        10420195
           CALL 'ILBOABN0' USING ABEND-CODE.                            10420295
                                                                        10420395
080500******************************************************************10421095
080600* Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *10430095
080700******************************************************************10440095
080800 Z910-ABEND.                                                      10450095
080900                                                                  10460095
081000     DISPLAY '** ABEND           **'.                             10470095
070941*    DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  10480096
081100     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          10481095
081200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        10490095
081300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         10500095
081400     DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       10510095
081500                                                                  10520095
081600     CALL 'ILBOABN0' USING ABEND-CODE.                            10530095
