000100 IDENTIFICATION DIVISION.                                         00010013
000200 PROGRAM-ID.     APKRP104.                                        00020013
000300 AUTHOR.         MIKE BESKE.                                      00030013
000400 DATE-WRITTEN.   JANUARY 2002.                                    00040013
000500 DATE-COMPILED.                                                   00050013
000600*-----------------------------------------------------------*     00060013
000700*    COBOL 2 WITH DB2 SQL                                   *     00070015
000800*                                                           *     00080013
000900*    NON-INVOICED RECEIPT AGING REPORT BY FISCAL PERIOD     *     00090035
001000*                                                           *     00100015
001100*    NON-INVOICED RECEIPTS AGING TOTALS BY FISCAL MONTH     *     00110015
001200*    FOR THE LAST 14 FISCAL PERIODS, PLUS TOTALS OF ALL     *     00120015
001300*    RECEIPTS THAT ARE OLDER THAN THE 14 PERIODS ALREADY    *     00130033
001400*    BEING REPORTED PER MONTH ON THE REPORT.                *     00140033
001500*                                                           *     00150013
001600*   PROGRAM OVERVIEW:                                       *     00160013
001700*     THIS PROGRAM CREATES THE NON-INVOICED RECEIPTS        *     00170013
001800*   AGING TOTALS BY FISCAL MONTH FROM THE EXTRACT FILE      *     00180013
001900*   FROM APKUT100.                                          *     00190015
002000*                                                           *     00200013
002100*   DB2:                                                    *     00210015
002200*     TAPCNTL - AP CONTROL TABLE                            *     00220015
002300*                                                           *     00230013
002400*   INPUT:                                                  *     00240015
002500*  1) NON-INVC-FILE                      (APRD042)          *     00250035
002600*                                                           *     00260013
002700*   OUTPUT:                                                 *     00270015
002800*  1) RPT01-FILE                         (DPWS132O)         *     00280035
002900*                                                           *     00290013
003000*-----------------------------------------------------------*     00300013
003100*   CHANGES:                                                *     00310013
003200*                                                           *     00320013
003300*   02/04/03  CHANGE MADE: ARKPO PHASE3 PROJECT.            *     00330036
003400*             UPDATED THE PROGRAM TITLE AND FILES APPEARING *     00340036
003500*             IN THE PROGRAM COMMENT BLOCK. RECOMPILED TO   *     00350037
003600*             PICK UP THE UPDATED COPYBOOK.                 *     00360036
003700*             MADE BY: MIKE BESKE           WR/IR #: 23500  *     00370036
003800*                                                           *     00380038
003900* 05/21/2004  CHANGED MADE: STORE CONSTRAINTS PROJECT       *     00390038
004000*             RECOMPILED THIS PROGRAM TO PICK UP THE APRD042*     00400038
004100*             COPYBOOK MODIFICATIONS.                       *     00410038
004200*             MADE BY: MIKE BESKE             WR/IR #:25805 *     00420038
007100*                                                           *     00421039
006700* 09/10/2021  CHANGED MADE: RECOMPILE FOR NEW APRD042       *     00422039
007000*             MADE BY: JEAN KURK              CHG0260549    *     00423039
004300*                                                           *     00430013
004400*-----------------------------------------------------------*     00440013
004500/                                                                 00450013
004600 ENVIRONMENT DIVISION.                                            00460013
004700 CONFIGURATION SECTION.                                           00470013
004800 INPUT-OUTPUT SECTION.                                            00480013
004900 FILE-CONTROL.                                                    00490013
005000                                                                  00500013
005100     SELECT NON-INVC-FILE        ASSIGN TO UT-S-INP01.            00510013
005200     SELECT RPT01-FILE           ASSIGN TO UT-S-RPT01.            00520013
005300                                                                  00530013
005400 DATA DIVISION.                                                   00540013
005500 FILE SECTION.                                                    00550013
005600 FD  NON-INVC-FILE                                                00560013
005700     RECORDING MODE IS F                                          00570013
005800     LABEL RECORDS ARE STANDARD                                   00580013
005900     BLOCK CONTAINS 0 RECORDS                                     00590013
006000     DATA RECORD IS NON-INVC-RECORD.                              00600013
006100 01  NON-INVC-RECORD             PIC  X(120).                     00610013
006200                                                                  00620013
006300 FD  RPT01-FILE                                                   00630013
006400     RECORDING MODE IS F                                          00640013
006500     LABEL RECORDS ARE STANDARD                                   00650013
006600     BLOCK CONTAINS 0 RECORDS                                     00660013
006700     DATA RECORD IS RPT01-RECORD.                                 00670013
006800 01  RPT01-RECORD                PIC  X(132).                     00680013
006900                                                                  00690013
007000                                                                  00700016
007100 WORKING-STORAGE SECTION.                                         00710013
007200                                                                  00720013
007300 01  PC-PROGRAM-CONSTANTS.                                        00730013
007400     05  FILLER                  PIC  X(30)   VALUE               00740013
007500         '** BEGINING OF APKRP104 W/S **'.                        00750013
007600                                                                  00760013
007700     05  PC-PROGRAM-NAME         PIC  X(08)   VALUE 'APKRP104'.   00770013
007800     05  PC-MAX-LINES            PIC S9(05)   VALUE +60           00780013
007900                                              COMP-3.             00790013
008000                                                                  00800013
008100 01  PV-PROGRAM-VARIABLES.                                        00810013
008200                                                                  00820013
008300     05  PV-LINE-COUNT           PIC S9(05)   VALUE ZERO          00830013
008400                                              COMP-3.             00840013
008500     05  PV-PAGE-COUNT           PIC S9(05)   VALUE ZERO          00850013
008600                                              COMP-3.             00860013
008700     05  PV-DB2-DATE.                                             00870029
008800         10  PV-DB2-CHECK-DATE   PIC X(10)    VALUE SPACES.       00880029
008900                                                                  00890013
009000     05  PV-FORMAT-DATE.                                          00900013
009100         10  PV-FORMAT-MMDDYY.                                    00910013
009200             15  PV-FORMAT-MM    PIC 9(02)    VALUE ZERO.         00920013
009300             15  FILLER          PIC X(01)    VALUE '/'.          00930013
009400             15  PV-FORMAT-DD    PIC 9(02)    VALUE ZERO.         00940013
009500             15  FILLER          PIC X(01)    VALUE '/'.          00950013
009600             15  PV-FORMAT-YY    PIC 9(02)    VALUE ZERO.         00960013
009700                                                                  00970013
009800     05  PV-CURRENT-DATE.                                         00980013
009900         10  PV-CURRENT-YEAR     PIC  9(02)   VALUE ZERO.         00990013
010000         10  PV-CURRENT-MONTH    PIC  9(02)   VALUE ZERO.         01000013
010100         10  PV-CURRENT-DAY      PIC  9(02)   VALUE ZERO.         01010013
010200                                                                  01020013
010300     05  PV-CURRENT-TIME.                                         01030013
010400         10  PV-CURRENT-HOUR     PIC  9(02)   VALUE ZERO.         01040013
010500         10  PV-CURRENT-MINUTE   PIC  9(02)   VALUE ZERO.         01050013
010600         10  FILLER              PIC  9(02)   VALUE ZERO.         01060013
010700                                                                  01070013
010800     05  PV-FIRST-FISCAL-DAY.                                     01080013
010900         10  PV-FIRST-FISCAL-CC  PIC 9(02)    VALUE ZERO.         01090013
011000         10  PV-FIRST-FISCAL-YY  PIC 9(02)    VALUE ZERO.         01100013
011100         10  FILLER              PIC X(01)    VALUE '-'.          01110013
011200         10  PV-FIRST-FISCAL-MM  PIC 9(02)    VALUE ZERO.         01120013
011300         10  FILLER              PIC X(01)    VALUE '-'.          01130013
011400         10  PV-FIRST-FISCAL-DD  PIC 9(02)    VALUE ZERO.         01140013
011500     05  PV-FISCAL-YEAR          PIC 9(02)    VALUE ZERO.         01150013
011600     05  PV-NEXT-PERIOD          PIC 9(02)    VALUE ZERO.         01160013
011700                                                                  01170013
011800                                                                  01180013
011900*----------------------------------------------------------------*01190013
012000*  THIS ARRAY WILL BE LOADED WITH NON-INVOICED RECEIPT TOTALS    *01200013
012100*  FOR THE CURRENT AND PREVIOUS 13 FISCAL MONTHS.  THE FIRST     *01210013
012200*  OCCURRENCE CONTAINS THE CURRENT FISCAL MONTH DATA AS THE      *01220013
012300*  INPUT FILE WILL BE SORTED BY DATE DESCENDING.                 *01230013
012400*----------------------------------------------------------------*01240013
012500 01  FA-FISCAL-ARRAY.                                             01250013
012600     05  FA-FISCAL-ENTRIES OCCURS 15 TIMES                        01260018
012700                           INDEXED BY FA-IND.                     01270013
012800         10  FA-FISCAL-YEAR      PIC  9(02)    VALUE ZERO.        01280013
012900         10  FA-FISCAL-PERIOD    PIC  9(02)    VALUE ZERO.        01290013
013000         10  FA-COST-TOTAL       PIC S9(09)V99 VALUE ZERO         01300013
013100                                               COMP-3.            01310013
013200         10  FA-RETAIL-TOTAL     PIC S9(09)V99 VALUE ZERO         01320013
013300                                               COMP-3.            01330013
013400         10  FA-FIRST-PER-DAY.                                    01340013
013500             15  FA-FIRST-PER-CC PIC  9(02).                      01350013
013600             15  FA-FIRST-PER-YY PIC  9(02).                      01360013
013700             15  FILLER          PIC  X(01).                      01370013
013800             15  FA-FIRST-PER-MM PIC  9(02).                      01380013
013900             15  FILLER          PIC  X(01).                      01390013
014000             15  FA-FIRST-PER-DD PIC  9(02).                      01400013
014100         10  FA-LAST-PER-DAY.                                     01410013
014200             15  FA-LAST-PER-CC  PIC  9(02).                      01420013
014300             15  FA-LAST-PER-YY  PIC  9(02).                      01430013
014400             15  FILLER          PIC  X(01).                      01440013
014500             15  FA-LAST-PER-MM  PIC  9(02).                      01450013
014600             15  FILLER          PIC  X(01).                      01460013
014700             15  FA-LAST-PER-DD  PIC  9(02).                      01470013
014800                                                                  01480013
014900 01  PS-PROGRAM-SWITCHES.                                         01490013
015000     05  PS-EOF-SW               PIC  X(01)    VALUE 'N'.         01500013
015100         88  NOT-EOF                           VALUE 'N'.         01510013
015200         88  IN-EOF                            VALUE 'Y'.         01520013
015300     05  PS-DATE-SW              PIC  X(01)    VALUE 'N'.         01530013
015400         88  VALID-DATE                        VALUE 'Y'.         01540013
015500         88  NOT-VALID-DATE                    VALUE 'N'.         01550013
015600     05  PS-PERIOD-FOUND-SW      PIC  X(01)    VALUE 'N'.         01560013
015700         88  PERIOD-FOUND                      VALUE 'Y'.         01570013
015800         88  PERIOD-NOT-FOUND                  VALUE 'N'.         01580013
015900                                                                  01590016
016000*----------------------------------------------------------------*01600013
016100*  INPUT RECORD LAYOUT                                           *01610013
016200*----------------------------------------------------------------*01620013
016300     COPY APRD042.                                                01630013
016400                                                                  01640013
016500*----------------------------------------------------------------*01650016
016600*  COMMUNICATIONS AREA2 FOR DB2                                  *01660016
016700*----------------------------------------------------------------*01670016
016800     COPY SQLCA2.                                                 01680016
016900                                                                  01690016
017000     EXEC SQL                                                     01700016
017100          INCLUDE SQLCA                                           01710016
017200     END-EXEC.                                                    01720016
017300                                                                  01730016
017400*----------------------------------------------------------------*01740016
017500*  ACCOUNTS PAYABLE CONTROL TABLE                                *01750016
017600*----------------------------------------------------------------*01760016
017700     EXEC SQL                                                     01770016
017800          INCLUDE TAPCNTL                                         01780016
017900     END-EXEC.                                                    01790016
018000                                                                  01800016
018100*----------------------------------------------------------------*01810013
018200*  STANDARD HEADER LAYOUT                                        *01820013
018300*----------------------------------------------------------------*01830013
018400     COPY DPWS132O.                                               01840013
018500                                                                  01850013
018600 01  HEADER-LINE.                                                 01860013
018700     05  FILLER                  PIC  X(44)   VALUE SPACES.       01870013
018800     05  HL2-TITLE               PIC  X(88)   VALUE               01880013
018900         'NON-INVOICED RECEIPTS AGING BY FISCAL PERIOD'.          01890013
019000                                                                  01900013
019100 01  RECEIPTS-DETAIL-LINE.                                        01910025
019200     05  FILLER                  PIC  X(03)    VALUE SPACES.      01920027
019300     05  FILLER                  PIC  X(13)    VALUE              01930025
019400         'RECEIPTS FOR '.                                         01940025
019500     05  RCL-LAST-PER-DATE       PIC  X(08)    VALUE SPACES.      01950025
019600     05  FILLER                  PIC  X(11)    VALUE              01960025
019700         ' AND BEFORE'.                                           01970025
019800                                                                  01980013
019900 01  DETAIL-LINE1.                                                01990025
020000     05  FILLER                  PIC  X(03)    VALUE SPACES.      02000025
020100     05  FILLER                  PIC  X(06)    VALUE 'YEAR:'.     02010025
020200     05  DL-YEAR                 PIC  9(02)    VALUE ZERO.        02020025
020300     05  FILLER                  PIC  X(02)    VALUE SPACES.      02030025
020400     05  FILLER                  PIC  X(08)    VALUE 'PERIOD:'.   02040025
020500     05  DL-PERIOD               PIC  Z9       VALUE ZERO.        02050025
020600     05  FILLER                  PIC  X(03)    VALUE '  ('.       02060025
020700     05  DL-FIRST-PER-DATE       PIC  X(08)    VALUE SPACES.      02070025
020800     05  FILLER                  PIC  X(03)    VALUE ' - '.       02080025
020900     05  DL-LAST-PER-DATE        PIC  X(08)    VALUE SPACES.      02090025
021000     05  FILLER                  PIC  X(87)    VALUE ')'.         02100025
021100                                                                  02110025
021200 01  DETAIL-LINE2.                                                02120013
021300     05  FILLER                  PIC  X(03)    VALUE SPACES.      02130013
021400     05  FILLER                  PIC  X(08)    VALUE 'COST:'.     02140013
021500     05  DL-COST                 PIC  ZZZ,ZZZ,ZZZ.99-             02150013
021600                                               VALUE ZERO.        02160013
021700     05  FILLER                  PIC  X(106)   VALUE SPACES.      02170013
021800                                                                  02180013
021900 01  DETAIL-LINE3.                                                02190013
022000     05  FILLER                  PIC  X(03)    VALUE SPACES.      02200013
022100     05  FILLER                  PIC  X(08)    VALUE 'RETAIL:'.   02210013
022200     05  DL-RETAIL               PIC  ZZZ,ZZZ,ZZZ.99-             02220013
022300                                               VALUE ZERO.        02230013
022400     05  FILLER                  PIC  X(106)   VALUE SPACES.      02240013
022500                                                                  02250013
022600 01  EOR-END-OF-REPORT.                                           02260013
022700     05  FILLER                  PIC  X(52)  VALUE SPACES.        02270013
022800     05  FILLER                  PIC  X(80)  VALUE                02280013
022900         '*****  END OF REPORT *****'.                            02290013
023000                                                                  02300013
023100*----------------------------------------------------------------*02310013
023200* WORKING STORAGE FOR DATE ROUTINE                                02320013
023300*----------------------------------------------------------------*02330013
023400     COPY DPWS500.                                                02340013
023500                                                                  02350013
023600                                                                  02360016
023700*----------------------------------------------------------------*02370013
023800*  ABEND DATA AREAS                                              *02380013
023900*----------------------------------------------------------------*02390013
024000 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02400013
024100                                             COMP SYNC.           02410013
024200     88  AC-BAD-DATA                         VALUE +4003.         02420013
024300     88  AC-TABLE-OVERFLOW                   VALUE +4004.         02430013
024400     88  AC-DB2-ERROR                        VALUE +4013.         02440016
024500     88  AC-DATE-ERROR                       VALUE +4019.         02450013
024600                                                                  02460013
024700                                                                  02470013
024800 01  ABEND-AREAS.                                                 02480013
024900     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02490013
025000             '*****       ABEND'.                                 02500013
025100     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02510013
025200             '*****   PROGRAM: APKRP104'.                         02520013
025300     05  AA-PARAGRAPH-LIT.                                        02530013
025400         10  FILLER              PIC  X(17)  VALUE                02540013
025500             '***** PARAGRAPH: '.                                 02550013
025600         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02560013
025700     05  AA-MESSAGE-LINE.                                         02570013
025800         10  FILLER              PIC  X(06)  VALUE '*****'.       02580013
025900         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02590013
026000     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02600016
026100             '*****    DB2 ERROR'.                                02610016
026200     05  AA-DB2-OPERATION-LIT.                                    02620016
026300         10  FILLER              PIC  X(17)  VALUE                02630016
026400             '***** OPERATION: '.                                 02640016
026500         10  AA-DB2-OPERATION.                                    02650016
026600             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02660016
026700             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02670016
026800     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02680016
026900     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02690016
027000     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02700016
027100                                                                  02710013
027200     COPY DPWS004.                                                02720016
027300                                                                  02730016
027400 01  FILLER                      PIC  X(25)  VALUE                02740013
027500     '** END OF APKRP104 W/S **'.                                 02750013
027600                                                                  02760013
027700                                                                  02770016
027800 PROCEDURE DIVISION.                                              02780013
027900 A000-MAIN.                                                       02790013
028000                                                                  02800013
028100     PERFORM B100-INITIALIZE.                                     02810013
028200                                                                  02820013
028300     PERFORM B200-PROCESS-DATA UNTIL IN-EOF.                      02830013
028400                                                                  02840013
028500     PERFORM B250-FORMAT-RECEIPTS.                                02850025
028600                                                                  02860024
028700*  REPORT IS WRITTEN WITH THE OLDEST PERIOD FIRST                 02870013
028800     PERFORM B300-FORMAT-REPORT                                   02880013
028900         VARYING FA-IND FROM 14 BY -1                             02890013
029000         UNTIL FA-IND = ZERO.                                     02900013
029100                                                                  02910013
029200     WRITE RPT01-RECORD FROM EOR-END-OF-REPORT AFTER 2.           02920013
029300                                                                  02930013
029400     GOBACK.                                                      02940013
029500                                                                  02950016
029600                                                                  02960016
029700*---------------------------------------------------------------* 02970013
029800*  OPEN FILES, RETRIEVE DATES, LOAD INITIAL ARRAY, FIRST READ.  * 02980013
029900*---------------------------------------------------------------* 02990013
030000 B100-INITIALIZE.                                                 03000013
030100                                                                  03010013
030200     OPEN INPUT  NON-INVC-FILE                                    03020013
030300          OUTPUT RPT01-FILE.                                      03030013
030400                                                                  03040013
030500     INITIALIZE DCLTAPCNTL.                                       03050016
030600     PERFORM R200-SELECT-CONTROL-DATA.                            03060016
030700                                                                  03070016
030800     PERFORM B110-PREPARE-FISCAL-ARRAY.                           03080013
030900                                                                  03090013
031000     ACCEPT PV-CURRENT-DATE      FROM DATE.                       03100013
031100     MOVE PV-CURRENT-MONTH       TO   DP132O-RUN-MONTH.           03110013
031200     MOVE PV-CURRENT-DAY         TO   DP132O-RUN-DAY.             03120013
031300     MOVE PV-CURRENT-YEAR        TO   DP132O-RUN-YEAR.            03130013
031400                                                                  03140013
031500     ACCEPT PV-CURRENT-TIME      FROM TIME.                       03150013
031600     MOVE PV-CURRENT-HOUR        TO   DP132O-RUN-HOUR.            03160013
031700     MOVE PV-CURRENT-MINUTE      TO   DP132O-RUN-MINUTE.          03170013
031800                                                                  03180013
031900     MOVE PC-PROGRAM-NAME        TO   DP132O-PROGRAM-NAME.        03190013
032000     MOVE 1                      TO   DP132O-REPORT-NUMBER.       03200013
032100                                                                  03210013
032200     MOVE 99                     TO   PV-LINE-COUNT.              03220013
032300                                                                  03230013
032400     PERFORM R100-READ-NON-INVC-FILE.                             03240013
032500     IF NOT-EOF                                                   03250013
032600         MOVE AP042-REC-DTE            TO PV-DB2-CHECK-DATE       03260029
032700     END-IF.                                                      03270013
032800                                                                  03280013
032900                                                                  03290016
033000*---------------------------------------------------------------* 03300013
033100*  DETERMINES THE FISCAL PERIODS AND YEARS TO BE CONTAININED IN * 03310013
033200*  THE ARRAY BASED ON THE CURRENT DATE:  THE ARRAY WILL CONTAIN * 03320013
033300*  THE CURRENT AND PAST 15 FISCAL PERIODS.  THE 15TH PERIOD     * 03330033
033400*  WILL CONTAIN ALL OF THE RECEIPTS TAHT ARE OLDER THAN THE 14  * 03340033
033500*  FISCAL PERIOD.                                               * 03350033
033600*---------------------------------------------------------------* 03360013
033700 B110-PREPARE-FISCAL-ARRAY.                                       03370013
033800                                                                  03380013
033900     MOVE SPACES                    TO PS-DATE-SW.                03390013
034000     SET FA-IND                     TO 1.                         03400013
034100     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03410013
034200     ACCEPT DPG51-SYSTEM-DATE       FROM DATE.                    03420013
034300                                                                  03430013
034400     SET DPG51-FISCAL-454-CALENDAR                                03440013
034500         DPG51-DO-NOT-INCR-DECR-DATE                              03450013
034600         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      03460016
034700     MOVE APCNTL-BTCH-PRC-DTE       TO DPG52-LK-DATE-INPUT.       03470016
034800                                                                  03480016
034900     PERFORM D100-DATE-ROUTINE.                                   03490016
035000                                                                  03500016
035100     IF VALID-DATE                                                03510016
035200         MOVE DPG56-FISCAL-YEAR-NBR TO FA-FISCAL-YEAR(FA-IND)     03520021
035300         MOVE DPG56-FISCAL-PERIOD-NBR                             03530016
035400                                    TO FA-FISCAL-PERIOD(FA-IND)   03540021
035500         MOVE DPG56-FIRST-FP-DB2-ISO-FMT                          03550016
035600                                    TO PV-FIRST-FISCAL-DAY        03560016
035700                                       FA-FIRST-PER-DAY(FA-IND)   03570021
035800         MOVE DPG56-LAST-FP-DB2-ISO-FMT                           03580016
035900                                    TO FA-LAST-PER-DAY(FA-IND)    03590021
036000         MOVE ZERO                  TO FA-COST-TOTAL(FA-IND)      03600021
036100                                       FA-RETAIL-TOTAL(FA-IND)    03610021
036200     ELSE                                                         03620016
036300         DISPLAY 'BATCH DATE '  APCNTL-BTCH-PRC-DTE               03630034
036400         MOVE 'B100-INITIALIZE'     TO AA-PARAGRAPH-NAME          03640016
036500         MOVE 'BAD DATE CONVERSION FOR CURRENT DATE'              03650016
036600                                    TO AA-MESSAGE                 03660016
036700         SET AC-DATE-ERROR          TO TRUE                       03670016
036800         PERFORM Z999-ABEND                                       03680016
036900     END-IF.                                                      03690016
037000                                                                  03700016
037100     PERFORM WITH TEST AFTER                                      03710016
037200         UNTIL FA-IND = 15                                        03720018
037300                                                                  03730016
037400         INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56      03740021
037500                                                                  03750018
037600         SET DPG51-FISCAL-454-CALENDAR                            03760021
037700             DPG51-DECREMENT-DATE                                 03770021
037800             DPG52-LK-DTE-FISC-PRD TO TRUE                        03780021
037900         MOVE 1                    TO DPG51-INCR-DECR-FISCAL-PRD-903790021
038000         MOVE SPACES               TO DPG52-LK-DATE-INPUT         03800021
038100         MOVE FA-FISCAL-YEAR(FA-IND)   TO DPG52-FISCAL-PRD-YR     03810021
038200         MOVE FA-FISCAL-PERIOD(FA-IND) TO DPG52-FISCAL-PRD-PP     03820021
038300                                                                  03830021
038400         PERFORM D100-DATE-ROUTINE                                03840021
038500                                                                  03850021
038600         SET FA-IND UP BY 1                                       03860021
038700         MOVE DPG56-FISCAL-YEAR-NBR TO FA-FISCAL-YEAR(FA-IND)     03870021
038800         MOVE DPG56-FISCAL-PERIOD-NBR                             03880021
038900                                    TO FA-FISCAL-PERIOD(FA-IND)   03890021
039000         MOVE DPG56-FIRST-FP-DB2-ISO-FMT                          03900021
039100                                    TO FA-FIRST-PER-DAY(FA-IND)   03910021
039200         MOVE DPG56-LAST-FP-DB2-ISO-FMT                           03920021
039300                                    TO FA-LAST-PER-DAY(FA-IND)    03930021
039400         MOVE ZERO                  TO FA-COST-TOTAL(FA-IND)      03940021
039500                                       FA-RETAIL-TOTAL(FA-IND)    03950021
039600                                                                  03960021
039700     END-PERFORM.                                                 03970021
039800                                                                  03980021
039900     MOVE '0001-01-01' TO FA-FIRST-PER-DAY(FA-IND).               03990021
040000     SET FA-IND        TO 1.                                      04000032
040100                                                                  04010021
040200*---------------------------------------------------------------* 04020021
040300*  CONTROLS TOTALING OF AMOUNTS AND LOCATING CORRESPONDING      * 04030021
040400*  FISCAL PREIOD AND YEAR ON THE ARRAY.                         * 04040021
040500*---------------------------------------------------------------* 04050021
040600 B200-PROCESS-DATA.                                               04060021
040700                                                                  04070021
040800     PERFORM C100-TOTAL-COST-RETAIL                               04080021
040900         UNTIL PV-DB2-DATE < PV-FIRST-FISCAL-DAY                  04090021
041000            OR IN-EOF.                                            04100021
041100                                                                  04110021
041200     IF NOT-EOF                                                   04120033
041300        PERFORM C200-SEARCH-ARRAY                                 04130033
041400     END-IF.                                                      04140021
041500                                                                  04150021
041600                                                                  04160021
041700*---------------------------------------------------------------* 04170021
041800*  PREPARES RECEIPTS REPORT FIELDS TO BE WRITTEN.  THIS IS THE  * 04180025
041900*  15TH PERIOD IN THE ARRAY.                                    * 04190033
042000*---------------------------------------------------------------* 04200021
042100 B250-FORMAT-RECEIPTS.                                            04210025
042200                                                                  04220021
042300     SET FA-IND TO 15.                                            04230025
042400                                                                  04240021
042500     MOVE FA-LAST-PER-MM   (FA-IND)  TO PV-FORMAT-MM.             04250021
042600     MOVE FA-LAST-PER-DD   (FA-IND)  TO PV-FORMAT-DD.             04260021
042700     MOVE FA-LAST-PER-YY   (FA-IND)  TO PV-FORMAT-YY.             04270021
042800     MOVE PV-FORMAT-MMDDYY           TO RCL-LAST-PER-DATE.        04280025
042900                                                                  04290021
043000     MOVE FA-COST-TOTAL    (FA-IND)  TO DL-COST.                  04300021
043100     MOVE FA-RETAIL-TOTAL  (FA-IND)  TO DL-RETAIL.                04310021
043200                                                                  04320021
043300     PERFORM W100-WRITE-REPORT.                                   04330021
043400                                                                  04340021
043500                                                                  04350021
043600*---------------------------------------------------------------* 04360025
043700*  PREPARES REPORT FIELDS TO BE WRITTEN.                        * 04370025
043800*---------------------------------------------------------------* 04380025
043900 B300-FORMAT-REPORT.                                              04390025
044000                                                                  04400025
044100     MOVE FA-FISCAL-YEAR   (FA-IND)  TO DL-YEAR.                  04410025
044200     MOVE FA-FISCAL-PERIOD (FA-IND)  TO DL-PERIOD.                04420025
044300                                                                  04430025
044400     MOVE FA-FIRST-PER-MM  (FA-IND)  TO PV-FORMAT-MM.             04440025
044500     MOVE FA-FIRST-PER-DD  (FA-IND)  TO PV-FORMAT-DD.             04450025
044600     MOVE FA-FIRST-PER-YY  (FA-IND)  TO PV-FORMAT-YY.             04460025
044700     MOVE PV-FORMAT-MMDDYY           TO DL-FIRST-PER-DATE.        04470025
044800                                                                  04480025
044900     MOVE FA-LAST-PER-MM   (FA-IND)  TO PV-FORMAT-MM.             04490025
045000     MOVE FA-LAST-PER-DD   (FA-IND)  TO PV-FORMAT-DD.             04500025
045100     MOVE FA-LAST-PER-YY   (FA-IND)  TO PV-FORMAT-YY.             04510025
045200     MOVE PV-FORMAT-MMDDYY           TO DL-LAST-PER-DATE.         04520025
045300                                                                  04530025
045400     MOVE FA-COST-TOTAL    (FA-IND)  TO DL-COST.                  04540025
045500     MOVE FA-RETAIL-TOTAL  (FA-IND)  TO DL-RETAIL.                04550025
045600                                                                  04560025
045700     PERFORM W100-WRITE-REPORT.                                   04570025
045800                                                                  04580025
045900                                                                  04590025
046000*---------------------------------------------------------------* 04600025
046100*  ADDS COST AND RETAIL AMOUNTS TO THE TOTALS IN THE ARRAY      * 04610021
046200*  FOR THE CORRESPONDING FINANCIAL PERIOD.                      * 04620021
046300*---------------------------------------------------------------* 04630021
046400 C100-TOTAL-COST-RETAIL.                                          04640021
046500                                                                  04650021
046600     ADD AP042-CALCD-VRFD-COST-AMT TO FA-COST-TOTAL   (FA-IND).   04660021
046700     ADD AP042-CALCD-VRFD-RTL-AMT  TO FA-RETAIL-TOTAL (FA-IND).   04670021
046800                                                                  04680021
046900     PERFORM R100-READ-NON-INVC-FILE.                             04690021
047000     IF NOT-EOF                                                   04700021
047100         MOVE AP042-REC-DTE            TO PV-DB2-CHECK-DATE       04710029
047200     END-IF.                                                      04720021
047300                                                                  04730021
047400                                                                  04740021
047500*---------------------------------------------------------------* 04750021
047600*  GET THE FINANCIAL PERIOD AND YEAR FOR THE DATE ON THE INPUT  * 04760021
047700*  FILE.  THEN LOCATE THE ARRAY OCCURRENCE CORRESPONDING TO     * 04770021
047800*  THIS PERIOD AND YEAR.                                        * 04780033
047900*---------------------------------------------------------------* 04790021
048000 C200-SEARCH-ARRAY.                                               04800021
048100                                                                  04810021
048200     SET FA-IND TO 1.                                             04820030
048300                                                                  04830021
048400     SEARCH FA-FISCAL-ENTRIES                                     04840030
048500             AT END SET IN-EOF TO TRUE                            04850022
048600          WHEN PV-DB2-DATE >= FA-FIRST-PER-DAY(FA-IND)            04860022
048700           AND PV-DB2-DATE <= FA-LAST-PER-DAY(FA-IND)             04870023
048800             MOVE FA-FIRST-PER-DAY(FA-IND) TO PV-FIRST-FISCAL-DAY 04880026
048900     END-SEARCH.                                                  04890022
049000                                                                  04900021
049100                                                                  04910021
049200*----------------------------------------------------------------*04920021
049300*    CALLS THE DATE ROUTINE MODULE.                              *04930021
049400*----------------------------------------------------------------*04940021
049500 D100-DATE-ROUTINE.                                               04950021
049600                                                                  04960021
049700     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04970021
049800         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04980021
049900                                                                  04990021
050000     IF (DPG54-SEVERE-ERROR OR                                    05000021
050100         DPG54-WARNING-ERROR)                                     05010021
050200         SET NOT-VALID-DATE TO TRUE                               05020021
050300     ELSE                                                         05030021
050400         SET VALID-DATE TO TRUE                                   05040021
050500     END-IF.                                                      05050021
050600                                                                  05060021
050700                                                                  05070021
050800*----------------------------------------------------------------*05080021
050900*  READS NON-INVOICED RECEIPT FILE.                              *05090021
051000*----------------------------------------------------------------*05100021
051100 R100-READ-NON-INVC-FILE.                                         05110021
051200                                                                  05120021
051300     READ NON-INVC-FILE          INTO AP042-EXTRACT-FILE          05130021
051400         AT END SET IN-EOF TO TRUE.                               05140021
051500                                                                  05150021
051600                                                                  05160021
051700*----------------------------------------------------------------*05170021
051800*  RETRIEVES THE BATCH PROCESS DATE FROM THE AP PAYMENT CONTROL  *05180021
051900*            TABLE.                                              *05190021
052000*                                                                *05200021
052100*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE  *05210021
052200*           THE CALCULATION OF THE PERIODS SO PROCESSING         *05220021
052300*           CANNOT PROCEED AND THE PROGRAM MUST ABEND.           *05230021
052400*----------------------------------------------------------------*05240021
052500 R200-SELECT-CONTROL-DATA.                                        05250021
052600                                                                  05260021
052700     EXEC SQL                                                     05270021
052800         SELECT                                                   05280021
052900             BTCH_PRC_DTE                                         05290021
053000         INTO                                                     05300021
053100             :APCNTL-BTCH-PRC-DTE                                 05310021
053200         FROM TAPCNTL                                             05320021
053300     END-EXEC.                                                    05330021
053400                                                                  05340021
053500     EVALUATE TRUE                                                05350021
053600         WHEN SQLCODE = ZEROS                                     05360021
053700              CONTINUE                                            05370021
053800         WHEN OTHER                                               05380021
053900             MOVE 'R200-SELECT-CONTROL-DATA'                      05390021
054000                                 TO AA-PARAGRAPH-NAME             05400021
054100             MOVE 'UNSUCCESSFUL SELECT'                           05410021
054200                                 TO AA-DB2-OPERATION              05420021
054300             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                05430021
054400             MOVE SPACES         TO AA-DB2-TABLE-2                05440021
054500                                    AA-DB2-TABLE-3                05450021
054600             PERFORM Z998-DB2-ABEND                               05460021
054700     END-EVALUATE.                                                05470021
054800                                                                  05480021
054900                                                                  05490021
055000*----------------------------------------------------------------*05500021
055100*  PRINTS REPORT DETAIL LINES.                                   *05510021
055200*----------------------------------------------------------------*05520021
055300 W100-WRITE-REPORT.                                               05530021
055400                                                                  05540021
055500     IF (PV-LINE-COUNT + 3) > PC-MAX-LINES                        05550021
055600         PERFORM W200-PRINT-HEADERS                               05560021
055700     END-IF.                                                      05570021
055800                                                                  05580021
055900     IF FA-IND = 15                                               05590025
056000        WRITE RPT01-RECORD FROM RECEIPTS-DETAIL-LINE AFTER 2      05600025
056100     ELSE                                                         05610025
056200        WRITE RPT01-RECORD FROM DETAIL-LINE1 AFTER 2              05620025
056300     END-IF.                                                      05630025
056400     WRITE RPT01-RECORD FROM DETAIL-LINE2 AFTER 1.                05640025
056500     WRITE RPT01-RECORD FROM DETAIL-LINE3 AFTER 1.                05650025
056600     ADD +3            TO PV-LINE-COUNT.                          05660025
056700                                                                  05670025
056800                                                                  05680025
056900*----------------------------------------------------------------*05690025
057000*  PRINTS REPORT HEADERS.                                        *05700025
057100*----------------------------------------------------------------*05710025
057200 W200-PRINT-HEADERS.                                              05720025
057300                                                                  05730025
057400     ADD 1                       TO   PV-PAGE-COUNT.              05740025
057500     MOVE PV-PAGE-COUNT          TO   DP132O-PAGE-NUMBER.         05750025
057600                                                                  05760025
057700     MOVE 0                      TO   PV-LINE-COUNT.              05770025
057800                                                                  05780025
057900     WRITE RPT01-RECORD FROM DP132O-STANDRD-HEADER-132-COLS       05790025
058000           AFTER PAGE.                                            05800025
058100                                                                  05810025
058200     WRITE RPT01-RECORD FROM HEADER-LINE AFTER 1.                 05820025
058300                                                                  05830025
058400     MOVE 2                      TO   PV-LINE-COUNT.              05840025
058500                                                                  05850025
058600                                                                  05860025
058700*----------------------------------------------------------------*05870025
058800*  DB2 ABEND ROUTINE.                                            *05880025
058900*----------------------------------------------------------------*05890025
059000 Z998-DB2-ABEND.                                                  05900025
059100                                                                  05910025
059200     CLOSE  NON-INVC-FILE                                         05920025
059300            RPT01-FILE.                                           05930025
059400                                                                  05940025
059500     DISPLAY AA-ABEND-LIT.                                        05950025
059600     DISPLAY AA-DB2-ERROR-LIT.                                    05960025
059700     DISPLAY AA-PROGRAM-LIT.                                      05970025
059800     DISPLAY AA-PARAGRAPH-LIT.                                    05980025
059900     DISPLAY AA-DB2-OPERATION-LIT.                                05990025
060000     DISPLAY AA-DB2-TABLE-1.                                      06000025
060100     DISPLAY AA-DB2-TABLE-2.                                      06010025
060200     DISPLAY AA-DB2-TABLE-3.                                      06020025
060300     SET AC-DB2-ERROR TO TRUE.                                    06030025
060400                                                                  06040025
060500     COPY DPPD004.                                                06050025
060600                                                                  06060025
060700     CALL 'ILBOABN0' USING ABEND-CODE.                            06070025
060800                                                                  06080025
060900                                                                  06090025
061000*----------------------------------------------------------------*06100025
061100*    ABEND ROUTINE                                               *06110025
061200*----------------------------------------------------------------*06120025
061300 Z999-ABEND.                                                      06130025
061400                                                                  06140025
061500     CLOSE  NON-INVC-FILE                                         06150025
061600            RPT01-FILE.                                           06160025
061700                                                                  06170025
061800     DISPLAY AA-ABEND-LIT.                                        06180025
061900     DISPLAY AA-PROGRAM-LIT.                                      06190025
062000     DISPLAY AA-PARAGRAPH-LIT.                                    06200025
062100     DISPLAY AA-MESSAGE-LINE.                                     06210025
062200     CALL 'ILBOABN0' USING ABEND-CODE.                            06220025
