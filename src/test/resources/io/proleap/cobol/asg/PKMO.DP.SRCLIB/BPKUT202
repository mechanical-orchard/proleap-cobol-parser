       ID DIVISION.                                                     00010046
       PROGRAM-ID.      BPKUT202.                                       00020046
       AUTHOR.          MARK A FRAMNESS.                                00030046
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040046
       DATE-WRITTEN     05/2011.                                        00050046
       DATE-COMPILED.                                                   00060046
      ******************************************************************00070046
      *                                                                 00080046
      *  BPKUT202 - CREATE WEEKLY (SEASON'S WORTH) OF PLAN FACT         00090046
      *             DATA FOR THE DATA WAREHOUSE. EXCEPT FOR REJ FILE    00100046
      *             WRITING, DEPT. IS CHECKED AND THE RECORD IS ONLY    00110046
      *             WRITTEN IF IT IS NUMERIC                            00120046
      *                                                                 00130046
      *  THIS PROGRAM READS A PLANNING EXTRACT FILE, REFORMATS IT,      00140046
      *  AND CREATES ANOTHER EXTRACT FILE THAT IS USED TO LOAD THE      00150046
      *  WEEKLY DEPARTMENT/MAJ CLASS/CHANNEL TABLE                      00160046
      *  (BPT_WKLY_PLAN_PLAN_FCT) AND THE WEEKLY COST CLASS ROLLUP      00170046
      *  (BPT_WKLY_PLAN_COST_CL_RLP).                                   00180046
      *                                                                 00190046
      *  BOTH THE INPUT AND OUTPUT EXTRACT FILES ARE AT A DEPT/CLASS/   00200046
      *  CHANNEL LEVEL AND CONTAIN WEEKLY DATA FOR A PARTICULAR SEASON. 00210046
      *  EACH RECORD ON THE INPUT EXTRACT FILE CONTAINS 26 OR 27        00220046
      *  OCCURRENCES (ONE FOR EACH WEEK IN THE SEASON) OF ONE           00230046
      *  PARTICULAR PIECE OF INFORMATION (SALES RETAIL AMOUNT, FOR      00240046
      *  EXAMPLE).  EACH RECORD ON THE OUTPUT FILE CONTAINS ALL THE     00250046
      *  NECESSARY PIECES OF INFORMATION FOR ONE WEEK.                  00260046
      *                                                                 00270046
      *  TO CONVERT A RECORD FROM THE INPUT FORMAT TO THE OUTPUT        00280046
      *  FORMAT, ALL THE INFORMATION FOR A DEPARTMENT IS TABLED BY      00290046
      *  WEEK AS IT IS READ.  WHEN THE DEPT/CLASS/CHANNEL CHANGES,      00300046
      *  26 OR 27 OUTPUT RECORDS ARE WRITTEN FROM THE TABLED DATA -     00310046
      *  ONE RECORD FOR EACH WEEK IN THE SEASON.                        00320046
      *                                                                 00330046
      *  THE SEASON BEGIN DATE IS READ FROM A CONTROL CARD.             00340046
      *  IT IS USED TO RETRIEVE THE FISCAL WEEK END DATE AND FISCAL     00350046
      *  FISCAL WEEK NUMBER FROM TDTATTR FOR EACH WEEK IN THE SEASON.   00360046
      ******************************************************************00370046
SB0504*    CHANGED: 05/25/04    BY: STACY BIESZK    WR#=26310           00380046
SB0504*                         FIX PROBLEM WITH INVALID PLAN-AMT       00390046
SB0504*                         CHANGED PROGRAM TO PUT OUT A RC = 4     00400046
SB0504*                         INSTEAD OF ABENDING THE PROGRAM.  ALSO  00410046
SB0504*                         WHEN PLAN-AMT IS NOT VALID THE RECORD   00420046
SB0504*                         WILL BE WRITTEN TO A REJECT FILE.       00430046
SB0504******************************************************************00440046
MZ0707*    CHANGED: 07/31/07    BY: MARIBETH ZAMORA WR#=33012           00450046
MZ0707*                         ADDED PLN-GRO-RCPT-QTY TO THE PLAN FACT 00460046
MZ0707*                         EXTRACT FOR GROSS MARGIN CALCULATION    00470046
MZ0707******************************************************************00480046
      *     CLONED: 05/26/11    BY: MARK A FRAMNESS WR#=39512           00490046
      *                         CLONED FROM MWKUT162. NO CHANGES ASIDE  00500046
      *                         FROM COMMENTS, COPYBOOKS, AND COPYBOOK  00510046
      *                         FIELDNAMES                              00520046
      ******************************************************************00530046
C61213* CHANGED: 07/31/07    BY: COGNIZANT WR/IR #: CHG0161213          00540046
C61213*                      HANDLED THE INCORRECT EDITS FOR PLAN       00550046
C61213*                      AMOUNT TO AVOID SKIPPING OF VALID DATA     00560046
C61213*                                                                 00570046
      ******************************************************************00571046
C54778* CHANGED: 03/04/21    BY: COGNIZANT WR/IR #:                     00572061
C54778*                      REMOVED THE OVERFLOW LOGIC SINCE EDW       00573061
C54778*                      CAN ACCEPT VALUES UP TO 99 BILLION AND     00574063
C54778*                      ALSO CHANGED THE LENGTH OF PROGRAM         00575063
C54778*                      VARIABLE TO S9(11)V99. MADE THE LENGTH OF  00576063
C54778*                      DIGITS ACCEPTABLE IN LEFT SIDE OF THE      00577063
C54778*                      DECIMAL TO 8 DIGITS. SINCE THIS PROGRAM    00578063
C54778*                      MULTIPLES THE VALUE FROM EP BY 1000, MAX   00579063
C54778*                      DIGITS TO THE LENGTH OF THE DECIMAL SHOULD 00579163
C54778*                      BE 8 SO THAT OUTPUT VALUE SHOULD BE IN THE 00579263
C54778*                      LIMIT OF 99 BILLION WHICH IS EDW LIMIT.THE 00579363
C54778*                      VALUES SENT FROM EP ARE IN THOUSANDS AND   00579463
C54778*                      THAT THE PROCESS ON OUR END WILL MULTIPLY  00579563
C54778*                      THE VALUES BY 1000 TO SEND THE REAL        00579663
C54778*                      NUMBER TO EDW. (EVEN THOUGH EDW WILL       00579763
C54778*                      DISPLAY THE NUMBERS IN 1000'S IN THE MSI   00579863
C54778*                      UI).                                       00579963
      ******************************************************************00580046
                                                                        00590046
       ENVIRONMENT DIVISION.                                            00600046
                                                                        00610046
       CONFIGURATION SECTION.                                           00620046
                                                                        00630046
       SOURCE-COMPUTER.        IBM-3090.                                00640046
       OBJECT-COMPUTER.        IBM-3090.                                00650046
                                                                        00660046
       INPUT-OUTPUT SECTION.                                            00670046
                                                                        00680046
       FILE-CONTROL.                                                    00690046
                                                                        00700046
           SELECT  DPT-PLN-FILE                                         00710046
               ASSIGN TO INP01.                                         00720046
                                                                        00730046
           SELECT WEEKLY-PLN-FCT-EXT-FILE                               00740046
               ASSIGN TO OUT01.                                         00750046
                                                                        00760046
           SELECT WEEKLY-PLN-CST-EXT-FILE                               00770046
               ASSIGN TO OUT02.                                         00780046
                                                                        00790046
           SELECT DELETE-DATE-FILE                                      00800046
               ASSIGN TO OUT03.                                         00810046
                                                                        00820046
SB0504     SELECT REJECTED-FILE                                         00830046
SB0504         ASSIGN TO OUT04.                                         00840046
                                                                        00850046
       DATA DIVISION.                                                   00860046
                                                                        00870046
       FILE SECTION.                                                    00880046
                                                                        00890046
       FD  DPT-PLN-FILE                                                 00900046
           RECORDING MODE F                                             00910046
           LABEL RECORDS ARE STANDARD                                   00920046
           BLOCK CONTAINS  0 RECORDS                                    00930046
           RECORD CONTAINS 600 CHARACTERS                               00940046
           DATA RECORD IS DPT-PLN-REC.                                  00950046
                                                                        00960046
       01  DPT-PLN-REC                 PIC X(600).                      00970046
                                                                        00980046
       FD  WEEKLY-PLN-FCT-EXT-FILE                                      00990046
           RECORDING MODE IS F                                          01000046
           LABEL RECORDS ARE STANDARD                                   01010046
           BLOCK CONTAINS 0 RECORDS.                                    01020046
                                                                        01030046
C54778 01  WEEKLY-PLN-FCT-EXT-REC      PIC X(235).                      01040061
                                                                        01050046
       FD  WEEKLY-PLN-CST-EXT-FILE                                      01060046
           RECORDING MODE IS F                                          01070046
           LABEL RECORDS ARE STANDARD                                   01080046
           BLOCK CONTAINS 0 RECORDS.                                    01090046
                                                                        01100046
C54778 01  WEEKLY-PLN-CST-EXT-REC      PIC X(55).                       01110061
                                                                        01120046
       FD  DELETE-DATE-FILE                                             01130046
           RECORDING MODE IS F                                          01140046
           LABEL RECORDS ARE STANDARD                                   01150046
           BLOCK CONTAINS 0 RECORDS.                                    01160046
                                                                        01170046
       01  DELETE-DATE-REC             PIC X(80).                       01180046
                                                                        01190046
SB0504 FD  REJECTED-FILE                                                01200046
SB0504     RECORDING MODE F                                             01210046
SB0504     LABEL RECORDS ARE STANDARD                                   01220046
SB0504     BLOCK CONTAINS  0 RECORDS                                    01230046
SB0504     RECORD CONTAINS 600 CHARACTERS                               01240046
SB0504     DATA RECORD IS REJECTED-REC.                                 01250046
SB0504                                                                  01260046
SB0504 01  REJECTED-REC                 PIC X(600).                     01270046
                                                                        01280046
       WORKING-STORAGE SECTION.                                         01290046
                                                                        01300046
       01  FWT-FSCL-WK-TABLE.                                           01310046
           05  FWT-FSCL-WK-ENTRY       OCCURS 27.                       01320046
               10  FWT-FSCL-WK-BEG-DTE PIC X(10).                       01330046
               10  FWT-FSCL-WK-NBR     PIC X(02).                       01340046
                                                                        01350046
                                                                        01360046
      *  THIS TABLE IS USED TO HOLD ALL INPUT DATA FOR A DEPT/CLASS     01370046
      *  BY WEEK.  WHEN A BREAK OCCURS ON DEPT/CLASS/CHANNEL            01380046
      *  (PHYSSTR, VIRTSTR).  THE OUTPUT RECORDS FOR THE PLANNING       01390046
      *  FACT FILE ARE BUILT FROM THIS TABLE.                           01400046
       01  PDT-PLAN-FACT-TABLE.                                         01410046
           05  PDT-PLAN-FACT-ENTRY                                      01420046
                                       OCCURS 27.                       01430046
C54778         10  PDT-EOPINV-COST-AMT PIC S9(11)V99  COMP-3 VALUE +0.  01440061
C54778         10  PDT-SLS-COST-AMT    PIC S9(11)V99  COMP-3 VALUE +0.  01450061
C54778         10  PDT-PROMO-MKDN-AMT  PIC S9(11)V99  COMP-3 VALUE +0.  01460061
C54778         10  PDT-PERM-MKDN-AMT   PIC S9(11)V99  COMP-3 VALUE +0.  01470061
C54778         10  PDT-RCPT-COST-AMT   PIC S9(11)V99  COMP-3 VALUE +0.  01480061
C54778         10  PDT-RCPT-RTL-AMT    PIC S9(11)V99  COMP-3 VALUE +0.  01490061
C54778         10  PDT-PADJ-COST-AMT   PIC S9(11)V99  COMP-3 VALUE +0.  01500061
C54778         10  PDT-PADJ-RTL-AMT    PIC S9(11)V99  COMP-3 VALUE +0.  01510061
C54778         10  PDT-FRT-COST-AMT    PIC S9(11)V99  COMP-3 VALUE +0.  01520061
C54778         10  PDT-SLS-AMT         PIC S9(11)V99  COMP-3 VALUE +0.  01530061
C54778         10  PDT-BOPINV-RTL-AMT  PIC S9(11)V99  COMP-3 VALUE +0.  01540061
C54778         10  PDT-EOPINV-RTL-AMT  PIC S9(11)V99  COMP-3 VALUE +0.  01550061
C54778         10  PDT-GRO-RCPT-QTY    PIC S9(11)V99  COMP-3 VALUE +0.  01560061
                                                                        01570046
      *  THIS TABLE IS USED TO HOLD ALL INPUT DATA FOR A DEPT/CLASS     01580046
      *  BY WEEK.  IT CONTAINS THE TOTAL COST (PHYSSTR AND VIRTSTR)     01590046
      *  COMBINED (TOTALCO). THE OUTPUT RECORDS FOR THE PLANNING COST   01600046
      *  CLASS ROLLUP TABLE ARE BUILT FROM THIS TABLE.                  01610046
       01  PDT-PLAN-TOT-COST-TABLE.                                     01620046
           05  PDT-PLAN-TOT-COST-ENTRY                                  01630046
                                       OCCURS 27.                       01640046
               10  PDT-EOPINV-TOT-COST-AMT                              01650046
C54778                                  PIC S9(11)V99  COMP-3 VALUE +0. 01660061
               10  PDT-SLS-TOT-COST-AMT                                 01670046
C54778                                  PIC S9(11)V99  COMP-3 VALUE +0. 01680061
                                                                        01690046
       01  PS-PROGRAM-SWITCHES.                                         01700046
           05  PS-END-OF-PLN-FCT-FILE-SW    PIC X     VALUE 'N'.        01710046
               88  PS-END-OF-PLN-FCT-FILE             VALUE 'Y'.        01720046
                                                                        01730046
           05  PS-DATE-FOUND-SW             PIC X     VALUE 'N'.        01740046
               88  PS-DATE-FOUND                      VALUE 'Y'.        01750046
               88  PS-DATE-NOT-FOUND                  VALUE 'N'.        01760046
                                                                        01770046
           05  PS-END-OF-FSCL-WK-CSR-SW     PIC X      VALUE 'N'.       01780046
               88  PS-END-OF-FSCL-WK-CSR               VALUE 'Y'.       01790046
               88  PS-NOT-END-OF-FSCL-WK-CSR           VALUE 'N'.       01800046
                                                                        01810046
SB0504     05  PS-DATA-ERROR-SW           PIC X        VALUE SPACES.    01820046
SB0504         88  PS-DATA-ERROR                       VALUE 'Y'.       01830046
SB0504                                                                  01840046
SB0504     05  PS-REJ-RECORD-SW             PIC X      VALUE SPACES.    01850046
SB0504         88  PS-REJ-RECORD                       VALUE 'Y'.       01860046
SB0504         88  PS-DONT-REJ-RECORD                  VALUE 'N'.       01870046
                                                                        01880046
C61213     05  PS-VALID-RECORD-SW           PIC X      VALUE SPACES.    01890046
C61213         88  PS-VALID-RECORD                     VALUE 'Y'.       01900046
C61213         88  PS-INVALID-RECORD                   VALUE 'N'.       01910046
                                                                        01920046
       01  PV-PROGRAM-VARIABLES.                                        01930046
           05  PV-DEL-ID1              PIC X          VALUE ','.        01940046
           05  PV-DEL-ID2              PIC X          VALUE '_'.        01950046
           05  PV-UNSTR-PTR            PIC S9(04)     COMP SYNC         01960046
                                                      VALUE ZERO.       01970046
           05  PV-PARAGRAPH-NAME       PIC X(30)      VALUE SPACE.      01980046
           05  PV-DB2-OPER-ATTEMPTED   PIC X(30)      VALUE SPACE.      01990046
           05  PV-PGM-NAME             PIC X(08)      VALUE 'BPKUT202'. 02000046
           05  PV-ABEND-CODE           PIC S9(04)     COMP SYNC         02010046
                                                      VALUE ZERO.       02020046
           05  PV-PREV-DEPT-NBR        PIC X(03).                       02030046
           05  PV-PREV-MAJ-CL          PIC X(02).                       02040046
           05  PV-PREV-STORE-CHNL      PIC X(07)      VALUE SPACE.      02050046
               88 TOTAL-ALL-COMPANY                   VALUE 'TOTALCO'.  02060046
               88 E-STORE                             VALUE 'VIRTSTR'.  02070046
               88 PHYSICAL-STORE                      VALUE 'PHYSSTR'.  02080046
           05  PV-PREV-STORE-CAT       PIC X(02)      VALUE SPACE.      02090046
               88 PV-STORE-COMP                       VALUE 'C_'.       02100046
               88 PV-STORE-NON-COMP                   VALUE 'NC'.       02110046
               88 PV-STORE-NEW                        VALUE 'N_'.       02120046
           05  PV-AMT                  PIC S9(11)V9(04).                02130060
           05  PV-PLN-IN-CNT           PIC S9(09) COMP-3 VALUE +0.      02140046
           05  PV-PLN-FCT-CNT          PIC S9(09) COMP-3 VALUE +0.      02150046
           05  PV-PLN-CST-CNT          PIC S9(09) COMP-3 VALUE +0.      02160046
           05  PV-DEL-DTE-CNT          PIC S9(09) COMP-3 VALUE +0.      02170046
SB0504     05  PV-REJ-RECORD-CNT       PIC S9(09) COMP-3 VALUE +0.      02180046
           05  PV-DISP-QTY              PIC ZZZ,ZZZ,ZZ9.99.             02190046
           05  PV-DISP-QTY2             PIC ZZZ,ZZ9.9999.               02200046
C54778*    05  PV-DIGIT-CNT             PIC 9(05) VALUE ZERO.           02210061
C54778*    05  PV-DECIMAL-CNT           PIC 9(05) VALUE ZERO.           02220061
C54778*    05  PV-DIGIT-VALUE           PIC X(10) VALUE SPACE.          02230061
C54778*    05  PV-DECIMAL-VALUE         PIC X(10) VALUE SPACE.          02240061
C54778*    05  PV-VALID-PLAN-AMOUNT     PIC X(13) VALUE SPACE.          02250061
                                                                        02260046
       01  SS-SUBSCRIPTS.                                               02270046
           05  SS-WEEK                 PIC S9(04)     COMP SYNC         02280046
                                                      VALUE +0.         02290046
           05  SS-WEEK-MAX             PIC S9(04)     COMP SYNC         02300046
                                                      VALUE +0.         02310046
       01  PV-WEEKLY-AMT-TABLE.                                         02320046
           05  PV-WEEKLY-AMT           OCCURS 27                        02330053
C54778                                 PIC S9(11)V9(02) VALUE ZERO.     02340061
                                                                        02350046
       01  WS-DELETE-DATE-RECORD.                                       02360046
           05  WS-DEL-BEG-SEASON-DATE    PIC X(10)  VALUE SPACES.       02370046
           05  FILLER                    PIC X(01)  VALUE SPACES.       02380046
           05  WS-DEL-END-SEASON-DATE    PIC X(10)  VALUE SPACES.       02390046
                                                                        02400046
      *************************************************************     02410046
      * SEASONAL PLANNING RETAIL INPUT EXTRACT                    *     02420046
      *************************************************************     02430046
           COPY BPRD204.                                                02440046
                                                                        02450046
      *************************************************************     02460046
      * COPYBOOK FOR THE MERCHANISE PLANNING CONTROL CARD         *     02470046
      *************************************************************     02480046
           COPY BPRD045.                                                02490046
                                                                        02500046
      *************************************************************     02510046
      * COPYBOOK FOR OUTPUT WEEKLY PLANNING FACT LOAD FILE        *     02520046
      *************************************************************     02530046
           COPY BPRD205.                                                02540046
                                                                        02550046
      *************************************************************     02560046
      * COPYBOOK FOR OUTPUT WEEKLY PLANNING COST CLASS RLP FILE   *     02570046
      *************************************************************     02580046
           COPY BPRD206.                                                02590046
                                                                        02600046
      *************************************************************     02610046
      * COPYBOOK FOR CALENDAR ROUTINE                             *     02620046
      *************************************************************     02630046
           COPY DPWS500.                                                02640046
                                                                        02650046
      *************************************************************     02660046
      * COPYBOOK FOR NUMERIC EDIT ROUTINE                         *     02670046
      *************************************************************     02680046
           COPY DPWS010I.                                               02690046
                                                                        02700046
      *************************************************************     02710046
      *  DATE ATTRIBUTE TABLE                                     *     02720046
      *************************************************************     02730046
           EXEC SQL                                                     02740046
               INCLUDE TDTATTR                                          02750046
           END-EXEC.                                                    02760046
                                                                        02770046
      *************************************************************     02780046
      * DB2 ERROR MESSAGE AREA                                    *     02790046
      *************************************************************     02800046
           COPY DPWS004.                                                02810046
                                                                        02820046
      *************************************************************     02830046
      * DB2 COMMUNICATION AREA                                    *     02840046
      *************************************************************     02850046
           EXEC SQL                                                     02860046
               INCLUDE SQLCA                                            02870046
           END-EXEC.                                                    02880046
                                                                        02890046
      ****************************************************************  02900046
      * FISCAL WEEK CURSOR                                              02910046
      *                                                                 02920046
      * THIS CURSOR WILL RETURN THE FISCAL WEEK END DATE AND FISCAL     02930046
      * WEEK NUMBER FOR EACH WEEK IN THE SEASON.                        02940046
      ****************************************************************  02950046
                                                                        02960046
           EXEC SQL                                                     02970046
              DECLARE FSCL-WK-CSR CURSOR FOR                            02980046
                  SELECT                                                02990046
                      FSCL_WK_NBR                                       03000046
                     ,FSCL_WK_BEG_DTE                                   03010046
                  FROM                                                  03020046
                      TDTATTR                                           03030046
                  WHERE SEA_BEG_DTE = :DTATTR-KY-DTE                    03040046
                    AND KY_DTE      = FSCL_WK_BEG_DTE                   03050046
                  FOR FETCH ONLY                                        03060046
           END-EXEC.                                                    03070046
                                                                        03080046
       EJECT                                                            03090046
                                                                        03100046
       PROCEDURE DIVISION.                                              03110046
                                                                        03120046
       1000-MAINLINE.                                                   03130046
                                                                        03140046
           PERFORM 1100-INITIALIZATION.                                 03150046
                                                                        03160046
           PERFORM 2000-PROCESS-DATA                                    03170046
                   UNTIL PS-END-OF-PLN-FCT-FILE.                        03180046
                                                                        03190046
           PERFORM 9000-EOJ.                                            03200046
                                                                        03210046
SB0504     IF PV-REJ-RECORD-CNT > 0                                     03220046
SB0504        MOVE 4 TO RETURN-CODE                                     03230046
SB0504     END-IF.                                                      03240046
                                                                        03250046
           GOBACK.                                                      03260046
                                                                        03270046
      ******************************************************************03280046
      *  VALIDATE DATE CONTROL CARD AND RETRIEVE WEEKS IN SEASON FOR    03290046
      *  CURRENT SEASAON EXTRACTED BY PLANNING.  OPEN FILES, READ 1ST   03300046
      *  RECORD.                                                        03310046
      ******************************************************************03320046
       1100-INITIALIZATION.                                             03330046
                                                                        03340046
      *    OPEN THE FILES.                                              03350046
           OPEN INPUT  DPT-PLN-FILE                                     03360046
                OUTPUT WEEKLY-PLN-FCT-EXT-FILE                          03370046
                       WEEKLY-PLN-CST-EXT-FILE                          03380046
                       DELETE-DATE-FILE                                 03390046
SB0504                 REJECTED-FILE.                                   03400046
                                                                        03410046
           ACCEPT BP045-REC.                                            03420046
                                                                        03430046
           DISPLAY SPACES.                                              03440046
           DISPLAY PV-PGM-NAME ' CONTROL CARD: ' BP045-REC.             03450046
           DISPLAY SPACES.                                              03460046
                                                                        03470046
      *    MAKE SURE THE LAST PLANNING EXPORT WAS IN TY MODE.           03480046
           IF NOT BP045-TY-RUN-MODE                                     03490046
               DISPLAY '** ABEND **'                                    03500046
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  03510046
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION  **'           03520046
               DISPLAY '** INVALID RUN MODE ON CONTROL CARD.'           03530046
               DISPLAY '** EXPECTING TY.'                               03540046
               DISPLAY '** CONTROL CARD RUN MODE = ' BP045-RUN-MODE     03550046
               MOVE +4003 TO PV-ABEND-CODE                              03560046
               PERFORM 9999-ABEND                                       03570046
           END-IF.                                                      03580046
                                                                        03590046
      *    CALL THE CALENDAR ROUTINE TO CONVERT THE SEASON BEGIN DATE   03600046
      *    ON THE CONTROL CARD TO DB2 ISO FORMAT.                       03610046
           MOVE BP045-SEASON-START-DATE  TO DPG52-LK-DATE-INPUT.        03620046
           SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       03630046
           SET DPG52-LK-DTE-ISO          TO TRUE                        03640046
                                                                        03650046
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          03660046
                                                   DPG53 DPG54          03670046
                                                   DPG55 DPG56          03680046
           IF DPG54-SEVERE-ERROR                                        03690046
               DISPLAY '** ABEND **'                                    03700046
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  03710046
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            03720046
               IF DPG54-DATE-INVALID                                    03730046
                   DISPLAY                                              03740046
                       '** INVALID SEASON START DATE ON CONTROL CARD.'  03750046
                   DISPLAY                                              03760046
                       '** EXPECTING CCYYMMDD DATE FORMAT.'             03770046
                   DISPLAY                                              03780046
                       '** SEASON START DATE ON CONTROL CARD: '         03790046
                           BP045-SEASON-START-DATE                      03800046
                   MOVE +4003 TO PV-ABEND-CODE                          03810046
               ELSE                                                     03820046
                   DISPLAY 'ERROR CALLING CALENDAR ROUTINE: '           03830046
                            DPG54-ERROR-MESSAGE                         03840046
                   MOVE +4019 TO PV-ABEND-CODE                          03850046
               END-IF                                                   03860046
               PERFORM 9999-ABEND                                       03870046
           END-IF.                                                      03880046
                                                                        03890046
      *    MAKE SURE THE SEASON BEGIN DATE ON THE CONTROL CARD IS A     03900046
      *    VALID SEASON BEGIN DATE.                                     03910046
           MOVE  DPG55-DB2-ISO-DATE-FMT TO DTATTR-KY-DTE.               03920046
                                                                        03930046
           PERFORM  8000-GET-DATE-ATTRIBUTES.                           03940046
           IF PS-DATE-NOT-FOUND                                         03950046
               DISPLAY '** ABEND **'                                    03960046
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  03970046
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            03980046
               DISPLAY '** SEASON START DATE ON CONTROL CARD NOT'       03990046
               DISPLAY '** FOUND ON TDTATTR.'                           04000046
               DISPLAY '** SEASON START DATE: ' BP045-SEASON-START-DATE 04010046
               MOVE +4003 TO PV-ABEND-CODE                              04020046
               PERFORM 9999-ABEND                                       04030046
           END-IF.                                                      04040046
                                                                        04050046
           IF DTATTR-KY-DTE NOT = DTATTR-SEA-BEG-DTE                    04060046
               DISPLAY '** ABEND **'                                    04070046
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  04080046
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            04090046
               DISPLAY '** SEASON START DATE ON CONTROL CARD IS '       04100046
               DISPLAY '** NOT AN ACTUAL SEASON BEGIN DATE.'            04110046
               DISPLAY '** SEASON START DATE ON CONTROL CARD: '         04120046
                        BP045-SEASON-START-DATE                         04130046
               MOVE +4003 TO PV-ABEND-CODE                              04140046
               PERFORM 9999-ABEND                                       04150046
           END-IF.                                                      04160046
                                                                        04170046
      *    GET THE FISCAL-WEEK-BEG-DATE AND FISCAL-WEEK-NUMBER FOR      04180046
      *    EACH WEEK IN THE SEASON.                                     04190046
           PERFORM 8500-OPEN-FSCL-WK-CSR.                               04200046
           PERFORM 8600-FETCH-FSCL-WK-CSR.                              04210046
                                                                        04220046
           PERFORM VARYING SS-WEEK FROM 1 BY 1 UNTIL SS-WEEK > 27       04230046
                                OR PS-END-OF-FSCL-WK-CSR                04240046
             MOVE DTATTR-FSCL-WK-BEG-DTE TO FWT-FSCL-WK-BEG-DTE(SS-WEEK)04250046
             MOVE DTATTR-FSCL-WK-NBR     TO FWT-FSCL-WK-NBR    (SS-WEEK)04260046
             ADD +1 TO SS-WEEK-MAX                                      04270046
             PERFORM 8600-FETCH-FSCL-WK-CSR                             04280046
           END-PERFORM.                                                 04290046
                                                                        04300046
           PERFORM 8700-CLOSE-FSCL-WK-CSR.                              04310046
                                                                        04320046
           DISPLAY 'NUMBER OF WEEKS IN SEASON = ' SS-WEEK-MAX.          04330046
           DISPLAY SPACES.                                              04340046
                                                                        04350046
      ** PLAN DATA DUE TO UPDATES/CHANGES.  A DELETE DATE FILE IS THEN  04360046
      ** CREATED WITH THE FIRST WEEK DATE OF SEASON AND THE LAST WEEK   04370046
      ** DATE OF THE SEASON TO BE REPLACED. THIS FILE IS THEN USED TO   04380046
      ** DELETE THE SEASON'S WORTH OF DATA FROM THE PLANNING TABLES     04390046
      ** ON THE UNIX BOX SO IT CAN BE REPLACED WITH CURRENT DATA.       04400046
           MOVE FWT-FSCL-WK-BEG-DTE(1)                                  04410046
                                  TO WS-DEL-BEG-SEASON-DATE.            04420046
           MOVE FWT-FSCL-WK-BEG-DTE(SS-WEEK-MAX)                        04430046
                                  TO WS-DEL-END-SEASON-DATE.            04440046
           PERFORM 7300-WRITE-DELETE-DATE-FILE.                         04450046
                                                                        04460046
           PERFORM 7000-READ-DPT-PLN-FILE.                              04470046
           IF PS-END-OF-PLN-FCT-FILE                                    04480046
               DISPLAY '** ABEND **'                                    04490046
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  04500046
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION'               04510046
               DISPLAY '** THE INPUT DEPARTMENT PLAN FILE WAS EMPTY.'   04520046
               MOVE +4008 TO PV-ABEND-CODE                              04530046
               PERFORM 9999-ABEND                                       04540046
           END-IF.                                                      04550046
                                                                        04560046
           MOVE BP204-DEPT-NBR          TO PV-PREV-DEPT-NBR.            04570046
           MOVE BP204-MAJ-CL-NBR        TO PV-PREV-MAJ-CL.              04580046
           MOVE BP204-CHNL-CDE          TO PV-PREV-STORE-CHNL.          04590046
                                                                        04600046
       2000-PROCESS-DATA.                                               04610046
                                                                        04620046
           IF   BP204-DEPT-NBR   = PV-PREV-DEPT-NBR                     04630046
            AND BP204-MAJ-CL-NBR = PV-PREV-MAJ-CL                       04640046
            AND BP204-CHNL-CDE   = PV-PREV-STORE-CHNL                   04650046
               CONTINUE                                                 04660046
           ELSE                                                         04670046
             EVALUATE  PV-PREV-STORE-CHNL                               04680046
               WHEN 'PHYSSTR'                                           04690046
               WHEN 'VIRTSTR'                                           04700046
                 PERFORM 2500-BUILD-WRITE-PLN-FCT-EXT                   04710046
                 INITIALIZE PDT-PLAN-FACT-TABLE                         04720046
               WHEN 'TOTALCO'                                           04730046
                 PERFORM 2600-BUILD-WRITE-PLN-CST-EXT                   04740046
                 INITIALIZE PDT-PLAN-TOT-COST-TABLE                     04750046
             END-EVALUATE                                               04760046
             MOVE BP204-DEPT-NBR   TO PV-PREV-DEPT-NBR                  04770046
             MOVE BP204-MAJ-CL-NBR TO PV-PREV-MAJ-CL                    04780046
             MOVE BP204-CHNL-CDE   TO PV-PREV-STORE-CHNL                04790046
           END-IF.                                                      04800046
                                                                        04810046
           PERFORM 2100-FORMAT-AMOUNTS.                                 04820046
                                                                        04830046
SB0504     IF  PS-REJ-RECORD                                            04840046
SB0504         SET PS-DONT-REJ-RECORD TO TRUE                           04850046
SB0504     ELSE                                                         04860046
               EVALUATE  BP204-CHNL-CDE                                 04870046
                 WHEN 'PHYSSTR'                                         04880046
                 WHEN 'VIRTSTR'                                         04890046
                   PERFORM 2200-LOAD-PLN-FCT-TO-TABLE                   04900046
                 WHEN 'TOTALCO'                                         04910046
                   PERFORM 2400-LOAD-PLN-CST-TO-TABLE                   04920046
               END-EVALUATE                                             04930046
SB0504     END-IF.                                                      04940046
                                                                        04950046
           PERFORM 7000-READ-DPT-PLN-FILE.                              04960046
                                                                        04970046
      ******************************************************************04980046
      *  THE INPUT RECORDS ARE IN A FIXED FORMAT.  THE NUMERIC FIELDS   04990046
      *  ARE IN A CHARACTER FORMAT.  THIS PARAGRAPH CONVERTS THE RETAIL 05000046
      *  AMOUNTS INTO A NUMERIC FORMAT.                                 05010046
      ******************************************************************05020046
       2100-FORMAT-AMOUNTS.                                             05030046
                                                                        05040046
           INITIALIZE PV-WEEKLY-AMT-TABLE.                              05050046
                                                                        05060046
      *     CONVERT THE WEEKLY AMT FIELDS TO NUMERIC VALUES.            05070046
                                                                        05080046
SB0504      SET PS-DONT-REJ-RECORD TO TRUE                              05090046
            PERFORM VARYING SS-WEEK FROM 1 BY 1                         05100046
              UNTIL SS-WEEK > SS-WEEK-MAX                               05110046
SB0504        OR PS-REJ-RECORD                                          05120046
C54778*       MOVE 0 TO PV-DIGIT-CNT                                    05130061
C54778*       MOVE 0 TO PV-DECIMAL-CNT                                  05140061
C54778*       MOVE SPACES TO PV-DIGIT-VALUE                             05150061
C54778*       MOVE SPACES TO PV-DECIMAL-VALUE                           05160061
C54778*       SET PS-VALID-RECORD TO TRUE                               05170061
C54778*                                                                 05180061
C54778*       IF  BP204-OVER-FLOW(SS-WEEK) > SPACES                     05190061
C54778*                                                                 05200061
C54778*         UNSTRING BP204-PLN-AMT(SS-WEEK) DELIMITED               05210061
C54778*         BY ALL '.' OR SPACE INTO PV-DIGIT-VALUE,                05220061
C54778*         PV-DECIMAL-VALUE                                        05230061
C54778*         END-UNSTRING                                            05240061
C54778*                                                                 05250061
C54778*        IF PV-DIGIT-VALUE < 0                                    05260061
C54778*         INSPECT BP204-PLN-AMT(SS-WEEK) TALLYING                 05270061
C54778*           PV-DIGIT-CNT FOR CHARACTERS BEFORE "." AFTER          05280061
C54778*           INITIAL "-"                                           05290061
C54778*           PV-DECIMAL-CNT FOR CHARACTERS AFTER "." BEFORE        05300061
C54778*           SPACE                                                 05310061
C54778*        ELSE                                                     05320061
C54778*         INSPECT BP204-PLN-AMT(SS-WEEK) TALLYING                 05330061
C54778*           PV-DIGIT-CNT FOR CHARACTERS BEFORE "."                05340061
C54778*           PV-DECIMAL-CNT FOR CHARACTERS AFTER "." BEFORE        05350061
C54778*           SPACE                                                 05360061
C54778*        END-IF                                                   05370061
C54778*                                                                 05380061
C54778*          IF (PV-DIGIT-VALUE > 0 AND PV-DIGIT-CNT > 6)           05390061
C54778*            OR (PV-DIGIT-VALUE < 0 AND PV-DIGIT-CNT > 6)         05400061
C54778*             SET PS-INVALID-RECORD TO TRUE                       05410061
C54778*          END-IF                                                 05420061
C54778*                                                                 05430061
C54778*       END-IF                                                    05440061
                                                                        05450046
C54778*        IF  BP204-OVER-FLOW(SS-WEEK) > SPACES                    05460061
C54778*            AND PS-INVALID-RECORD                                05470061
C54778*            DISPLAY '** REJECTED -RECORD **'                     05480061
C54778*            DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'              05490061
C54778*            DISPLAY '** OVER-FLOW EXISTS. PLAN AMT > 12 BYTES'   05500061
C54778*            DISPLAY '** BP204-PLN-AMT = ' BP204-PLN-AMT(SS-WEEK) 05510061
C54778*            DISPLAY '** BP204-OVER-FLOW = '                      05520061
C54778*                                      BP204-OVER-FLOW(SS-WEEK)   05530061
C54778*            DISPLAY '*************************************'      05540061
C54778*            SET PS-REJ-RECORD TO TRUE                            05550061
C54778*            ADD +1 TO PV-REJ-RECORD-CNT                          05560061
C54778*            WRITE REJECTED-REC  FROM                             05570061
C54778*                            BP204-PLANNING-RTL-RECORD            05580061
C54778*        ELSE                                                     05590061
                MOVE SPACE TO DP010I-UNEDITED-FIELD                     05600046
                                                                        05610046
C54778*         IF PS-VALID-RECORD AND PV-DIGIT-VALUE < 0               05620061
C54778*            AND BP204-OVER-FLOW(SS-WEEK) > 0                     05630061
C54778*          STRING BP204-PLN-AMT(SS-WEEK) DELIMITED BY SPACE       05640061
C54778*          BP204-OVER-FLOW(SS-WEEK) DELIMITED BY SPACE            05650061
C54778*          INTO PV-VALID-PLAN-AMOUNT                              05660061
C54778*                                                                 05670061
C54778*            MOVE PV-VALID-PLAN-AMOUNT TO DP010I-UNEDITED-FIELD   05680061
C54778*         ELSE                                                    05690061
                   MOVE BP204-PLN-AMT(SS-WEEK) TO DP010I-UNEDITED-FIELD 05700046
C54778*         END-IF                                                  05710061
                                                                        05720046
C54778             MOVE 8           TO DP010I-MAXIMUM-DIGITS            05730061
                   MOVE 5           TO DP010I-MAXIMUM-DECIMALS          05740046
                   SET DP010I-NEGATIVE-ALLOWED TO TRUE                  05750046
                                                                        05760046
                   PERFORM 2150-NUMERIC-CONVERSION                      05770046
                                                                        05780046
SB0504             IF  PS-DONT-REJ-RECORD                               05790046
                       MOVE DP010I-NUMERIC-FIELD TO PV-AMT              05800046
                       COMPUTE PV-WEEKLY-AMT(SS-WEEK)                   05810046
                                               ROUNDED = PV-AMT * 1000  05820046
                   END-IF                                               05830046
C54778*        END-IF                                                   05840061
           END-PERFORM.                                                 05850046
                                                                        05860046
                                                                        05870046
       2150-NUMERIC-CONVERSION.                                         05880046
                                                                        05890046
           CALL DP010I-NUMERIC-EDIT-ROUTINE USING                       05900046
                                            DP010I-NUMERIC-EDIT-AREA.   05910046
                                                                        05920046
           IF DP010I-NO-ERROR-DETECTED                                  05930046
               NEXT SENTENCE                                            05940046
           ELSE                                                         05950046
               IF DP010I-INVALID-CHARACTER                              05960046
                   MOVE ZEROES TO DP010I-NUMERIC-FIELD                  05970046
               ELSE                                                     05980046
SB0504             DISPLAY '** REJECTED RECORD **'                      05990046
SB0504             DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'              06000046
SB0504             DISPLAY '** PARAGRAPH 2150-NUMERIC-CONVERSION **'    06010046
SB0504             DISPLAY '** ERROR IN CALLED NUMERIC EDIT ROUTINE.'   06020046
SB0504             DISPLAY '** ERROR INDICATOR = ' DP010I-ERROR-IND     06030046
SB0504             DISPLAY '** INPUT RECORD = ' BP204-PLN-AMT(SS-WEEK)  06040046
SB0504             DISPLAY '*****************************'              06050046
SB0504             SET PS-REJ-RECORD TO TRUE                            06060046
SB0504             ADD +1 TO PV-REJ-RECORD-CNT                          06070046
SB0504             WRITE REJECTED-REC  FROM                             06080046
SB0504                             BP204-PLANNING-RTL-RECORD            06090046
               END-IF                                                   06100046
           END-IF.                                                      06110046
                                                                        06120046
                                                                        06130046
      ******************************************************************06140046
      *  THIS PARAGRAPH EVALUATES THE INPUT DATA TO DETERMINE           06150046
      *  WHAT TYPE OF RECORD IS BEING PROCESSED.  IF THE RECORD IS ONE  06160046
      *  OF THE TYPES THAT SHOULD BE EXTRACTED, THE RETAIL AMOUNTS      06170046
      *  ARE LOADED BY WEEK INTO A WORKING STORAGE TABLE.               06180046
      ******************************************************************06190046
       2200-LOAD-PLN-FCT-TO-TABLE.                                      06200046
                                                                        06210046
           EVALUATE BP204-PLN-ELEMENT                                   06220046
             WHEN 'EOP_CST'                                             06230046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06240046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06250046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   06260046
                     TO PDT-EOPINV-COST-AMT(SS-WEEK)                    06270046
               END-PERFORM                                              06280046
             WHEN 'SLS_CST'                                             06290046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06300046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06310046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   06320046
                     TO PDT-SLS-COST-AMT(SS-WEEK)                       06330046
               END-PERFORM                                              06340046
             WHEN 'REC_CST'                                             06350046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06360046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06370046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   06380046
                     TO PDT-RCPT-COST-AMT (SS-WEEK)                     06390046
               END-PERFORM                                              06400046
             WHEN 'RECADJ_CST'                                          06410046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06420046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06430046
                   MOVE PV-WEEKLY-AMT    (SS-WEEK)                      06440046
                     TO PDT-PADJ-COST-AMT  (SS-WEEK)                    06450046
               END-PERFORM                                              06460046
             WHEN 'FRT_CST'                                             06470046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06480046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06490046
                   MOVE PV-WEEKLY-AMT    (SS-WEEK)                      06500046
                     TO PDT-FRT-COST-AMT   (SS-WEEK)                    06510046
               END-PERFORM                                              06520046
             WHEN 'PROMO_DLR'                                           06530046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06540046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06550046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   06560046
                     TO PDT-PROMO-MKDN-AMT  (SS-WEEK)                   06570046
               END-PERFORM                                              06580046
             WHEN 'PERM_DLR'                                            06590046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06600046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06610046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   06620046
                     TO PDT-PERM-MKDN-AMT   (SS-WEEK)                   06630046
               END-PERFORM                                              06640046
             WHEN 'REC_DLR'                                             06650046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06660046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06670046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   06680046
                     TO PDT-RCPT-RTL-AMT    (SS-WEEK)                   06690046
               END-PERFORM                                              06700046
             WHEN 'RECADJ_DLR'                                          06710046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06720046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06730046
                   MOVE PV-WEEKLY-AMT    (SS-WEEK)                      06740046
                     TO PDT-PADJ-RTL-AMT (SS-WEEK)                      06750046
               END-PERFORM                                              06760046
             WHEN 'SLS_DLR'                                             06770046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06780046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06790046
                   MOVE PV-WEEKLY-AMT    (SS-WEEK)                      06800046
                     TO PDT-SLS-AMT (SS-WEEK)                           06810046
               END-PERFORM                                              06820046
             WHEN 'BOP_DLR'                                             06830046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06840046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06850046
                   MOVE PV-WEEKLY-AMT    (SS-WEEK)                      06860046
                     TO PDT-BOPINV-RTL-AMT (SS-WEEK)                    06870046
               END-PERFORM                                              06880046
             WHEN 'EOP_DLR'                                             06890046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      06900046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            06910046
                   MOVE PV-WEEKLY-AMT    (SS-WEEK)                      06920046
                     TO PDT-EOPINV-RTL-AMT (SS-WEEK)                    06930046
               END-PERFORM                                              06940046
MZ0707       WHEN 'GREC_UNT'                                            06950046
MZ0707         PERFORM VARYING SS-WEEK FROM 1 BY 1                      06960046
MZ0707           UNTIL SS-WEEK > SS-WEEK-MAX                            06970046
MZ0707             MOVE PV-WEEKLY-AMT    (SS-WEEK)                      06980046
MZ0707               TO PDT-GRO-RCPT-QTY (SS-WEEK)                      06990046
MZ0707         END-PERFORM                                              07000046
           END-EVALUATE.                                                07010046
                                                                        07020046
      ******************************************************************07030046
      *  THIS PARAGRAPH EVALUATES THE INPUT DATA TO DETERMINE           07040046
      *  WHAT TYPE OF RECORD IS BEING PROCESSED.  IF THE RECORD IS ONE  07050046
      *  OF THE TYPES THAT SHOULD BE EXTRACTED, THE RETAIL AMOUNTS      07060046
      *  ARE LOADED BY WEEK INTO A WORKING STORAGE TABLE.               07070046
      ******************************************************************07080046
       2400-LOAD-PLN-CST-TO-TABLE.                                      07090046
                                                                        07100046
           EVALUATE BP204-PLN-ELEMENT                                   07110046
             WHEN 'EOP_CST'                                             07120046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      07130046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            07140046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   07150046
                     TO PDT-EOPINV-TOT-COST-AMT(SS-WEEK)                07160046
               END-PERFORM                                              07170046
             WHEN 'SLS_CST'                                             07180046
               PERFORM VARYING SS-WEEK FROM 1 BY 1                      07190046
                 UNTIL SS-WEEK > SS-WEEK-MAX                            07200046
                   MOVE PV-WEEKLY-AMT       (SS-WEEK)                   07210046
                     TO PDT-SLS-TOT-COST-AMT(SS-WEEK)                   07220046
               END-PERFORM                                              07230046
           END-EVALUATE.                                                07240046
                                                                        07250046
      ******************************************************************07260046
      *  THIS PARAGRAPH USES THE DATA THAT WAS TABLED FOR THE           07270046
      *  DEPT/CLASS/CHNL/STR CAT TO BUILD AND WRITE ON OUTPUT RECORD    07280046
      *  FOR EACH WEEK IN THE SEASON.                                   07290046
      ******************************************************************07300046
       2500-BUILD-WRITE-PLN-FCT-EXT.                                    07310046
                                                                        07320046
           MOVE PV-PREV-DEPT-NBR     TO BP205-DEPT-NBR.                 07330046
           MOVE PV-PREV-MAJ-CL       TO BP205-MAJ-CL-NBR.               07340046
                                                                        07350046
           EVALUATE TRUE                                                07360046
             WHEN PHYSICAL-STORE                                        07370046
               MOVE 'P' TO BP205-CHNL-CDE                               07380046
             WHEN E-STORE                                               07390046
               MOVE 'V' TO BP205-CHNL-CDE                               07400046
           END-EVALUATE.                                                07410046
                                                                        07420046
           PERFORM VARYING SS-WEEK FROM 1 BY 1                          07430046
             UNTIL SS-WEEK > SS-WEEK-MAX                                07440046
                 MOVE FWT-FSCL-WK-BEG-DTE   (SS-WEEK)                   07450046
                   TO BP205-TM-DIM-KY-DTE                               07460046
                 MOVE PDT-EOPINV-COST-AMT   (SS-WEEK)                   07470046
                   TO BP205-EOPINV-COST-AMT                             07480046
                 MOVE PDT-SLS-COST-AMT      (SS-WEEK)                   07490046
                   TO BP205-SLS-COST-AMT                                07500046
                 MOVE PDT-PROMO-MKDN-AMT    (SS-WEEK)                   07510046
                   TO BP205-PROMO-MKDN-AMT                              07520046
                 MOVE PDT-PERM-MKDN-AMT    (SS-WEEK)                    07530046
                   TO BP205-PERM-MKDN-AMT                               07540046
                 MOVE PDT-RCPT-COST-AMT    (SS-WEEK)                    07550046
                   TO BP205-RCPT-COST-AMT                               07560046
                 MOVE PDT-RCPT-RTL-AMT    (SS-WEEK)                     07570046
                   TO BP205-RCPT-RTL-AMT                                07580046
                 MOVE PDT-PADJ-COST-AMT    (SS-WEEK)                    07590046
                   TO BP205-PADJ-COST-AMT                               07600046
                 MOVE PDT-PADJ-RTL-AMT    (SS-WEEK)                     07610046
                   TO BP205-PADJ-RTL-AMT                                07620046
                 MOVE PDT-FRT-COST-AMT    (SS-WEEK)                     07630046
                   TO BP205-FRT-COST-AMT                                07640046
                 MOVE PDT-SLS-AMT         (SS-WEEK)                     07650046
                   TO BP205-SLS-AMT                                     07660046
                 MOVE PDT-BOPINV-RTL-AMT  (SS-WEEK)                     07670046
                   TO BP205-BOPINV-RTL-AMT                              07680046
                 MOVE PDT-EOPINV-RTL-AMT  (SS-WEEK)                     07690046
                   TO BP205-EOPINV-RTL-AMT                              07700046
                 MOVE PDT-GRO-RCPT-QTY    (SS-WEEK)                     07710046
                   TO BP205-GRO-RCPT-QTY                                07720046
                 PERFORM 7100-WRITE-WEEKLY-PLN-FCT-FCT                  07730046
           END-PERFORM.                                                 07740046
                                                                        07750046
      ******************************************************************07760046
      *  THIS PARAGRAPH USES THE DATA THAT WAS TABLED FOR THE           07770046
      *  DEPT/CLASS/CHNL TO BUILD AND WRITE ON OUTPUT RECORD            07780046
      *  FOR EACH WEEK IN THE SEASON FOR TOTAL COST.                    07790046
      ******************************************************************07800046
       2600-BUILD-WRITE-PLN-CST-EXT.                                    07810046
                                                                        07820046
           MOVE PV-PREV-DEPT-NBR     TO BP206-DEPT-NBR.                 07830046
           MOVE PV-PREV-MAJ-CL       TO BP206-MAJ-CL-NBR.               07840046
                                                                        07850046
           PERFORM VARYING SS-WEEK FROM 1 BY 1                          07860046
             UNTIL SS-WEEK > SS-WEEK-MAX                                07870046
                 MOVE FWT-FSCL-WK-BEG-DTE       (SS-WEEK)               07880046
                   TO BP206-TM-DIM-KY-DTE                               07890046
                 MOVE PDT-EOPINV-TOT-COST-AMT   (SS-WEEK)               07900046
                   TO BP206-EOPINV-COST-AMT                             07910046
                 MOVE PDT-SLS-TOT-COST-AMT      (SS-WEEK)               07920046
                   TO BP206-SLS-COST-AMT                                07930046
                 PERFORM 7200-WRITE-WEEKLY-PLN-CST-FCT                  07940046
           END-PERFORM.                                                 07950046
                                                                        07960046
       7000-READ-DPT-PLN-FILE.                                          07970046
                                                                        07980046
           READ DPT-PLN-FILE                                            07990046
               INTO BP204-PLANNING-RTL-RECORD                           08000046
                   AT END SET PS-END-OF-PLN-FCT-FILE TO TRUE.           08010046
                                                                        08020046
           IF NOT PS-END-OF-PLN-FCT-FILE                                08030046
             ADD +1 TO PV-PLN-IN-CNT                                    08040046
           END-IF.                                                      08050046
                                                                        08060046
       7100-WRITE-WEEKLY-PLN-FCT-FCT.                                   08070046
                                                                        08080046
      * BP DELIVERY REQUESTED THE RECORD BE OUTPUT IF THE DEPT. IS      08090046
      * NON-NUMERIC                                                     08100046
           IF BP205-DEPT-NBR IS NUMERIC                                 08110046
              WRITE WEEKLY-PLN-FCT-EXT-REC  FROM                        08120046
                    BP205-WEEKLY-PLN-FCT-RECORD                         08130046
                                                                        08140046
              ADD +1 TO PV-PLN-FCT-CNT                                  08150046
           ELSE                                                         08160046
              DISPLAY 'NON-NUMERIC DEPT. REC: '                         08170046
                 BP205-WEEKLY-PLN-FCT-RECORD                            08180046
           END-IF.                                                      08190046
                                                                        08200046
       7200-WRITE-WEEKLY-PLN-CST-FCT.                                   08210046
                                                                        08220046
           IF BP206-DEPT-NBR IS NUMERIC                                 08230046
              WRITE WEEKLY-PLN-CST-EXT-REC  FROM                        08240046
                    BP206-WEEKLY-PLN-CST-RECORD                         08250046
                                                                        08260046
              ADD +1 TO PV-PLN-CST-CNT                                  08270046
           END-IF.                                                      08280046
                                                                        08290046
       7300-WRITE-DELETE-DATE-FILE.                                     08300046
                                                                        08310046
           WRITE DELETE-DATE-REC  FROM                                  08320046
                 WS-DELETE-DATE-RECORD.                                 08330046
                                                                        08340046
           ADD +1 TO PV-DEL-DTE-CNT.                                    08350046
                                                                        08360046
       8000-GET-DATE-ATTRIBUTES.                                        08370046
                                                                        08380046
           EXEC SQL                                                     08390046
                SELECT                                                  08400046
                    SEA_BEG_DTE                                         08410046
                INTO                                                    08420046
                    :DTATTR-SEA-BEG-DTE                                 08430046
                FROM                                                    08440046
                    TDTATTR                                             08450046
                WHERE                                                   08460046
                    KY_DTE = :DTATTR-KY-DTE                             08470046
           END-EXEC.                                                    08480046
                                                                        08490046
           EVALUATE TRUE                                                08500046
               WHEN SQLCODE = ZERO                                      08510046
                   SET PS-DATE-FOUND     TO TRUE                        08520046
               WHEN SQLCODE = +100                                      08530046
                   SET PS-DATE-NOT-FOUND TO TRUE                        08540046
               WHEN OTHER                                               08550046
                   DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE           08560046
                   MOVE    '8000-GET-DATE-ATTRIBUTES'                   08570046
                                                TO PV-PARAGRAPH-NAME    08580046
                   MOVE    'SELECT ROW FROM TDTATTR'                    08590046
                                                TO PV-DB2-OPER-ATTEMPTED08600046
                   PERFORM 9998-SQL-ABEND                               08610046
           END-EVALUATE.                                                08620046
                                                                        08630046
                                                                        08640046
       8500-OPEN-FSCL-WK-CSR.                                           08650046
                                                                        08660046
           EXEC SQL                                                     08670046
                OPEN FSCL-WK-CSR                                        08680046
           END-EXEC.                                                    08690046
                                                                        08700046
           EVALUATE TRUE                                                08710046
               WHEN SQLCODE = ZERO                                      08720046
                   CONTINUE                                             08730046
               WHEN OTHER                                               08740046
                   MOVE '8500-OPEN-FSCL-WK-CSR'                         08750046
                                            TO PV-PARAGRAPH-NAME        08760046
                   MOVE 'OPEN FSCL-WK-CSR'  TO PV-DB2-OPER-ATTEMPTED    08770046
                   PERFORM 9998-SQL-ABEND                               08780046
           END-EVALUATE.                                                08790046
                                                                        08800046
                                                                        08810046
      ******************************************************************08820046
      *  THIS PARAGRAPH RETRIEVES THE FISCAL-WEEK-END-DATE AND FISCAL-  08830046
      *  WEEK-NUMBER FOR ALL WEEKS IN THE SEASON.  THESE VALUES WILL    08840046
      *  USED TO BUILD THE OUTPUT RECORDS.                              08850046
      ******************************************************************08860046
       8600-FETCH-FSCL-WK-CSR.                                          08870046
                                                                        08880046
           EXEC SQL                                                     08890046
               FETCH                                                    08900046
                   FSCL-WK-CSR                                          08910046
               INTO                                                     08920046
                  :DTATTR-FSCL-WK-NBR                                   08930046
                 ,:DTATTR-FSCL-WK-BEG-DTE                               08940046
           END-EXEC.                                                    08950046
                                                                        08960046
           EVALUATE TRUE                                                08970046
               WHEN SQLCODE = ZERO                                      08980046
                   CONTINUE                                             08990046
               WHEN SQLCODE = +100                                      09000046
                   SET PS-END-OF-FSCL-WK-CSR TO TRUE                    09010046
               WHEN OTHER                                               09020046
                   MOVE '8600-FETCH-FSCL-WK-CSR' TO PV-PARAGRAPH-NAME   09030046
                   MOVE 'FETCH FSCL-WK-CSR'     TO PV-DB2-OPER-ATTEMPTED09040046
                   PERFORM 9998-SQL-ABEND                               09050046
           END-EVALUATE.                                                09060046
                                                                        09070046
                                                                        09080046
       8700-CLOSE-FSCL-WK-CSR.                                          09090046
                                                                        09100046
           EXEC SQL                                                     09110046
               CLOSE FSCL-WK-CSR                                        09120046
           END-EXEC.                                                    09130046
                                                                        09140046
           EVALUATE TRUE                                                09150046
               WHEN SQLCODE = ZERO                                      09160046
                   CONTINUE                                             09170046
               WHEN OTHER                                               09180046
                   MOVE '8700-CLOSE-FSCL-WK-CSR' TO PV-PARAGRAPH-NAME   09190046
                   MOVE 'CLOSE FSCL-WK-CSR'     TO PV-DB2-OPER-ATTEMPTED09200046
                   PERFORM 9998-SQL-ABEND                               09210046
           END-EVALUATE.                                                09220046
                                                                        09230046
                                                                        09240046
      ******************************************************************09250046
      *  CLOSE FILES AND DISPLAY INPUT/OUTPUT RECORD COUNTS             09260046
      ******************************************************************09270046
       9000-EOJ.                                                        09280046
                                                                        09290046
           EVALUATE  PV-PREV-STORE-CHNL                                 09300046
             WHEN 'PHYSSTR'                                             09310046
             WHEN 'VIRTSTR'                                             09320046
               PERFORM 2500-BUILD-WRITE-PLN-FCT-EXT                     09330046
             WHEN 'TOTALCO'                                             09340046
               PERFORM 2600-BUILD-WRITE-PLN-CST-EXT                     09350046
           END-EVALUATE.                                                09360046
                                                                        09370046
           CLOSE DPT-PLN-FILE                                           09380046
                 WEEKLY-PLN-FCT-EXT-FILE                                09390046
                 WEEKLY-PLN-CST-EXT-FILE                                09400046
SB0504           REJECTED-FILE.                                         09410046
                                                                        09420046
           DISPLAY 'PLANNING INPUT RECORDS   = '  PV-PLN-IN-CNT.        09430046
           DISPLAY 'PLAN FACT OUTPUT RECORDS = '  PV-PLN-FCT-CNT.       09440046
           DISPLAY 'PLAN TOTAL COST OUTPUT   = '  PV-PLN-CST-CNT.       09450046
SB0504     DISPLAY 'REJECTED RECORDS         = '  PV-REJ-RECORD-CNT.    09460046
                                                                        09470046
       9998-SQL-ABEND.                                                  09480046
                                                                        09490046
           MOVE +4013 TO PV-ABEND-CODE.                                 09500046
           DISPLAY ' '.                                                 09510046
           DISPLAY '** ABEND **         ** = SQLERROR'.                 09520046
           DISPLAY '** PROGRAM          ** = ' PV-PGM-NAME.             09530046
           DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       09540046
           DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   09550046
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         09560046
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        09570046
           COPY DPPD004.                                                09580046
           PERFORM 9999-ABEND.                                          09590046
                                                                        09600046
                                                                        09610046
       9999-ABEND.                                                      09620046
                                                                        09630046
           CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        09640046
