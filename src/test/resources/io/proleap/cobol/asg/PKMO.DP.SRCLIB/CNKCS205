000100 IDENTIFICATION DIVISION.                                         11/02/93
000200 PROGRAM-ID.    CNKCS205.                                         CNKCS205
000300 AUTHOR.        TOM RUSKA. G&R.                                      LV001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          CNKCS205
000500 DATE-WRITTEN.  05-03-93.                                         CNKCS205
000600 DATE-COMPILED.                                                   CNKCS205
000700                                                                  CNKCS205
000800*---------------------------------------------------------------* CNKCS205
000900*    Y205 - DEPARTMENT/CLASS TICKET FORMAT LIST                 * CNKCS205
001000*                                                               * CNKCS205
001100*    THIS PROGRAM GENERATES A LIST OF TICKET FORMATS ASSIGNED   * CNKCS205
001200*    TO DEPARTMENT CLASSES.                                     * CNKCS205
001300*    RECORDS CAN BE SELECTED FOR UPDATE AND DELETE.  ADD IS ALSO* CNKCS205
001400*    ALLOWED.  THE APPROPRIATE PROGRAM IS INVOKED WHEN THE      * CNKCS205
001500*    OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION  * CNKCS205
001600*    KEY.  NO SELECTION IS NECESSARY TO ADD A TICKET FORMAT.    * CNKCS205
001700*                                                               * CNKCS205
001800*---------------------------------------------------------------* CNKCS205
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455                 
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263455* MAKING THE CALL DYNAMIC VS STATIC.                                      
263455*----------------------------------------------------------------*        
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001900                                                                  CNKCS205
002000 ENVIRONMENT DIVISION.                                            CNKCS205
002100 DATA DIVISION.                                                   CNKCS205
002200                                                                  CNKCS205
002300/                                                                 CNKCS205
002400 WORKING-STORAGE SECTION.                                         CNKCS205
002500                                                                  CNKCS205
002600 01  DK-DB2-KEYS.                                                 CNKCS205
002700     05  DK-OPER-UNT-ID                 PIC  S9(04) COMP.            CL**3
002800     05  DK-FCLTY-ID                    PIC  S9(04) COMP.            CL**3
002900     05  DK-FCLTY-ID-LOW                PIC  S9(04) COMP.            CL**5
003000     05  DK-FCLTY-ID-HIGH               PIC  S9(04) COMP.            CL**5
003100     05  DK-DEPT-NBR-LOW                PIC  X(03).                  CL**3
003200     05  DK-DEPT-NBR-HIGH               PIC  X(03).                  CL**3
003300     05  DK-TKT-FMT-ID-LOW              PIC  X(06).                  CL**3
003400     05  DK-TKT-FMT-ID-HIGH             PIC  X(06).                  CL**3
003500                                                                  CNKCS205
003600 01  DN-DB2-NULL-INDICATORS.                                      CNKCS205
003700     05  DN-TKT-FMT-ID                  PIC S9(04) VALUE +0          CL**3
003800                                                    COMP.         CNKCS205
003900                                                                  CNKCS205
004000 01  PC-PROGRAM-CONSTANTS.                                        CNKCS205
004100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         CNKCS205
004200                                                    'CN205A  '.   CNKCS205
004300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         CNKCS205
004400                                                    'CNKM205 '.   CNKCS205
004500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         CNKCS205
004600                                                    'CNKCS205'.   CNKCS205
004700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      CNKCS205
004800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      CNKCS205
004900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    CNKCS205
005000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     CNKCS205
005100                                                    COMP SYNC.    CNKCS205
005200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      CNKCS205
005300                                                    COMP SYNC.    CNKCS205
005400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         CNKCS205
005500                                                    +1000000      CNKCS205
005600                                                    COMP-3.       CNKCS205
005700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      CNKCS205
005800                                                    COMP SYNC.    CNKCS205
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      CNKCS205
006000                                                    COMP-3.       CNKCS205
006100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    CNKCS205
006200     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  CNKCS205
006300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  CNKCS205
006400     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  CNKCS205
006500     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  CNKCS205
006600     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  CNKCS205
006700                                                                  CNKCS205
006800     05  PC-TSYMSG-NUMBERS.                                       CNKCS205
006900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  CNKCS205
007000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  CNKCS205
007100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  CNKCS205
007200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  CNKCS205
007300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  CNKCS205
007400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  CNKCS205
007500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  CNKCS205
007600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  CNKCS205
007700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  CNKCS205
007800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  CNKCS205
007900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  CNKCS205
008000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  CNKCS205
008100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  CNKCS205
008200                                                                  CNKCS205
008300 01  PS-PROGRAM-SWITCHES.                                         CNKCS205
008400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    CNKCS205
008500         88  PS-NO-ERROR                            VALUE 'Y'.    CNKCS205
008600         88  PS-ERROR                               VALUE 'N'.    CNKCS205
008700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    CNKCS205
008800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    CNKCS205
008900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    CNKCS205
009000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    CNKCS205
009100         88  PS-DONE                                VALUE 'Y'.    CNKCS205
009200         88  PS-NOT-DONE                            VALUE 'N'.    CNKCS205
009300                                                                  CNKCS205
009400 01  PV-PROGRAM-VARIABLES.                                        CNKCS205
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      CNKCS205
009600                                                    COMP SYNC.    CNKCS205
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      CNKCS205
009800                                                    COMP SYNC.    CNKCS205
009900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      CNKCS205
010000                                                    COMP-3.       CNKCS205
010100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      CNKCS205
010200                                                    COMP-3.       CNKCS205
010300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      CNKCS205
010400                                                    COMP-3.       CNKCS205
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      CNKCS205
010600                                                    COMP-3.       CNKCS205
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      CNKCS205
010800                                                    COMP-3.       CNKCS205
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      CNKCS205
011000                                                    COMP-3.       CNKCS205
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      CNKCS205
011200                                                    COMP-3.       CNKCS205
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      CNKCS205
011400                                                    COMP SYNC.    CNKCS205
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      CNKCS205
011600                                                    COMP SYNC.    CNKCS205
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      CNKCS205
011800                                                    COMP SYNC.    CNKCS205
011900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      CNKCS205
012000                                                    COMP SYNC.    CNKCS205
012100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      CNKCS205
012200                                                    COMP SYNC.    CNKCS205
012300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      CNKCS205
012400                                                    COMP SYNC.    CNKCS205
012500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      CNKCS205
012600                                                    COMP SYNC.    CNKCS205
012700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      CNKCS205
012800                                                    COMP SYNC.    CNKCS205
012900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      CNKCS205
013000                                                    COMP SYNC.    CNKCS205
013100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      CNKCS205
013200                                                    COMP SYNC.    CNKCS205
013300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      CNKCS205
013400                                                    COMP SYNC.    CNKCS205
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      CNKCS205
013600                                                    COMP SYNC.    CNKCS205
013700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      CNKCS205
013800                                                    COMP SYNC.    CNKCS205
013900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      CNKCS205
014000                                                    COMP SYNC.    CNKCS205
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      CNKCS205
014200                                                    COMP SYNC.    CNKCS205
014300                                                                  CNKCS205
014400*---------------------------------------------------------------* CNKCS205
014500*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * CNKCS205
014600*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * CNKCS205
014700*   APPLICATION-SPECIFIC COMMAREA.                              * CNKCS205
014800*---------------------------------------------------------------* CNKCS205
014900 01  LQW-LIST-QUEUE-WORK-AREA.                                    CNKCS205
015000     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  CNKCS205
015100     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           CNKCS205
015200                                        INDEXED BY LQW-IDX.       CNKCS205
015300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       CNKCS205
015400         10  LQW-TEMP-SELECTED-SW       PIC X(01).                CNKCS205
015500         10  LQW-SELECTED-SW            PIC X(01).                CNKCS205
015600             88  LQW-SELECT                         VALUE 'S'.    CNKCS205
015700             88  LQW-DESELECT                       VALUE ' '.    CNKCS205
015800         10  LQW-ACTION                 PIC X(03).                CNKCS205
015900         10  LQW-FCLTY-ID               PIC 9(04).                   CL**5
016000         10  LQW-DEPT-NBR               PIC X(03).                   CL**3
016100         10  LQW-CL-NBR                 PIC X(02).                   CL**3
016200         10  LQW-RANK                   PIC 9(01).                CNKCS205
016300         10  LQW-FORMAT                 PIC X(06).                CNKCS205
016400         10  LQW-DESC                   PIC X(06).                CNKCS205
016500         10  LQW-OPER-UNT-ID            PIC 9(04).                   CL**4
016600                                                                  CNKCS205
016700/                                                                 CNKCS205
016800*---------------------------------------------------------------* CNKCS205
016900*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * CNKCS205
017000*---------------------------------------------------------------* CNKCS205
017100                                                                  CNKCS205
017200     COPY CNWS006.                                                   CL**9
017300                                                                  CNKCS205
017400/                                                                 CNKCS205
017500*---------------------------------------------------------------* CNKCS205
017600*    MAP LAYOUT                                                 * CNKCS205
017700*---------------------------------------------------------------* CNKCS205
017800                                                                  CNKCS205
017900     COPY CNKM205.                                                CNKCS205
018000                                                                  CNKCS205
018100 01  MR-OCCURS-LAYOUT                   REDEFINES  CN205AO.       CNKCS205
018200     05  FILLER                         PIC X(48).                CNKCS205
018300                                                                  CNKCS205
018400     05  MR-OPERL                       PIC S9(04) COMP.             CL**3
018500     05  MR-OPERA                       PIC X(01).                   CL**3
018600     05  MR-OPERC                       PIC X(01).                   CL**3
018700     05  MR-OPERH                       PIC X(01).                   CL**3
018800     05  MR-OPER                        PIC X(04).                   CL**3
018900                                                                  CNKCS205
019000     05  MR-FCLTYL                      PIC S9(04) COMP.             CL**3
019100     05  MR-FCLTYA                      PIC X(01).                   CL**3
019200     05  MR-FCLTYC                      PIC X(01).                   CL**3
019300     05  MR-FCLTYH                      PIC X(01).                   CL**3
019400     05  MR-FCLTY                       PIC X(04).                   CL**3
019500                                                                     CL**3
019600     05  MR-FDESCL                      PIC S9(04) COMP.          CNKCS205
019700     05  MR-FDESCA                      PIC X(01).                CNKCS205
019800     05  MR-FDESCC                      PIC X(01).                CNKCS205
019900     05  MR-FDESCH                      PIC X(01).                CNKCS205
020000     05  MR-FDESC                       PIC X(25).                CNKCS205
020100                                                                  CNKCS205
020200     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          CNKCS205
020300         10  MR-SELECTL                 PIC S9(04) COMP.          CNKCS205
020400         10  MR-SELECTA                 PIC X(01).                CNKCS205
020500         10  MR-SELECTC                 PIC X(01).                CNKCS205
020600         10  MR-SELECTH                 PIC X(01).                CNKCS205
020700         10  MR-SELECT                  PIC X(01).                CNKCS205
020800                                                                  CNKCS205
020900         10  MR-ACTIONL                 PIC S9(04) COMP.          CNKCS205
021000         10  MR-ACTIONA                 PIC X(01).                CNKCS205
021100         10  MR-ACTIONC                 PIC X(01).                CNKCS205
021200         10  MR-ACTIONH                 PIC X(01).                CNKCS205
021300         10  MR-ACTION                  PIC X(03).                CNKCS205
021400                                                                  CNKCS205
021500         10  MR-FACL                    PIC S9(04) COMP.             CL**5
021600         10  MR-FACA                    PIC X(01).                   CL**5
021700         10  MR-FACC                    PIC X(01).                   CL**5
021800         10  MR-FACH                    PIC X(01).                   CL**5
021900         10  MR-FCLTY-ID                PIC X(04).                   CL**5
022000                                                                     CL**5
022100         10  MR-DEPT-NBRL               PIC S9(04) COMP.             CL**3
022200         10  MR-DEPT-NBRA               PIC X(01).                   CL**3
022300         10  MR-DEPT-NBRC               PIC X(01).                   CL**3
022400         10  MR-DEPT-NBRH               PIC X(01).                   CL**3
022500         10  MR-DEPT-NBR                PIC X(03).                   CL**3
022600                                                                  CNKCS205
022700         10  MR-CL-NBRL                 PIC S9(04) COMP.             CL**3
022800         10  MR-CL-NBRA                 PIC X(01).                   CL**3
022900         10  MR-CL-NBRC                 PIC X(01).                   CL**3
023000         10  MR-CL-NBRH                 PIC X(01).                   CL**3
023100         10  MR-CL-NBR                  PIC X(02).                   CL**3
023200                                                                  CNKCS205
023300         10  MR-RANKL                   PIC S9(04) COMP.          CNKCS205
023400         10  MR-RANKA                   PIC X(01).                CNKCS205
023500         10  MR-RANKC                   PIC X(01).                CNKCS205
023600         10  MR-RANKH                   PIC X(01).                CNKCS205
023700         10  MR-RANK-X.                                           CNKCS205
023800             15  MR-RANK                PIC 9.                    CNKCS205
023900                                                                  CNKCS205
024000         10  MR-FORMATL                 PIC S9(04) COMP.          CNKCS205
024100         10  MR-FORMATA                 PIC X(01).                CNKCS205
024200         10  MR-FORMATC                 PIC X(01).                CNKCS205
024300         10  MR-FORMATH                 PIC X(01).                CNKCS205
024400         10  MR-FORMAT                  PIC X(06).                CNKCS205
024500                                                                  CNKCS205
024600         10  MR-DESCL                   PIC S9(04) COMP.          CNKCS205
024700         10  MR-DESCA                   PIC X(01).                CNKCS205
024800         10  MR-DESCC                   PIC X(01).                CNKCS205
024900         10  MR-DESCH                   PIC X(01).                CNKCS205
025000         10  MR-DESC                    PIC X(06).                CNKCS205
025100                                                                  CNKCS205
025200/                                                                 CNKCS205
025300*---------------------------------------------------------------* CNKCS205
025400*    ATTRIBUTE SETTINGS COPYBOOK.                               * CNKCS205
025500*---------------------------------------------------------------* CNKCS205
025600                                                                  CNKCS205
025700     COPY DPWS015.                                                CNKCS205
025800                                                                  CNKCS205
025900*---------------------------------------------------------------* CNKCS205
026000*    FUNCTION KEYS COPYBOOK.                                    * CNKCS205
026100*---------------------------------------------------------------* CNKCS205
026200                                                                  CNKCS205
026300     COPY DPWS016.                                                CNKCS205
026400                                                                  CNKCS205
026500*---------------------------------------------------------------* CNKCS205
026600*    NUMERIC EDIT LAYOUT.                                       * CNKCS205
026700*---------------------------------------------------------------* CNKCS205
026800                                                                  CNKCS205
026900     COPY DPWS010I.                                               CNKCS205
027000                                                                  CNKCS205
027100/                                                                 CNKCS205
027200*---------------------------------------------------------------* CNKCS205
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * CNKCS205
027400*---------------------------------------------------------------* CNKCS205
027500                                                                  CNKCS205
027600     COPY DPWS030.                                                CNKCS205
CICS       COPY DPWS930.                                                        
027700                                                                  CNKCS205
027800/                                                                 CNKCS205
027900*---------------------------------------------------------------* CNKCS205
028000*    STANDARD COMMAREA.                                         * CNKCS205
028100*---------------------------------------------------------------* CNKCS205
028200                                                                  CNKCS205
028300     COPY DPWS020.                                                CNKCS205
028400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                CNKCS205
028500                                                                  CNKCS205
028600*---------------------------------------------------------------* CNKCS205
028700* INTER-APPLICATION COMMAREA.                                   * CNKCS205
028800*   CNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * CNKCS205
028900*             SPEC SCREEN.                                      * CNKCS205
029000*   CNWS003 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * CNKCS205
029100*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * CNKCS205
029200*---------------------------------------------------------------* CNKCS205
029300                                                                  CNKCS205
029400         10  INTER-APPL-COMM-AREA       PIC X(200).               CNKCS205
029500     COPY CNWS001.                                                   CL**9
029600     COPY CNWS003.                                                   CL**9
029700*---------------------------------------------------------------* CNKCS205
029800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * CNKCS205
029900*---------------------------------------------------------------* CNKCS205
030000         10  ASC-SPECIFIC-COMMAREA.                               CNKCS205
030100             15  ASC-LIST-KEYS.                                   CNKCS205
030200                 20  ASC-KEY-OPER-UNT-ID     PIC S9(04) COMP.        CL**5
030300                 20  ASC-KEY-FCLTY-ID        PIC S9(04) COMP.        CL**5
030400                 20  ASC-KEY-FCLTY-ID-LOW    PIC S9(04) COMP.        CL**5
030500                 20  ASC-KEY-FCLTY-ID-HIGH   PIC S9(04) COMP.        CL**5
030600                 20  ASC-KEY-DEPT-NBR-LOW    PIC X(03).              CL**5
030700                 20  ASC-KEY-DEPT-NBR-HIGH   PIC X(03).              CL**5
030800                 20  ASC-KEY-TKT-FMT-ID-LOW  PIC X(06).              CL**3
030900                 20  ASC-KEY-TKT-FMT-ID-HIGH PIC X(06).              CL**3
031000             15  ASC-SEL-UNASSIGNED     PIC X(01).                CNKCS205
031100             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           CNKCS205
031200                 20  ASC-BLOCK-MODIFIED-SW                        CNKCS205
031300                                        PIC  X(01).               CNKCS205
031400                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     CNKCS205
031500                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     CNKCS205
031600                                                                  CNKCS205
031700                 20  ASC-ITEM-ARRAY.                              CNKCS205
031800                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        CNKCS205
031900                         30  ASC-LIST-ITEM-NUMBER                 CNKCS205
032000                                        PIC S9(09) COMP-3.        CNKCS205
032100                         30  ASC-TEMP-SELECTED-SW                 CNKCS205
032200                                        PIC X(01).                CNKCS205
032300                             88  ASC-VALID-SELECT  VALUE ' '      CNKCS205
032400                                                         'S'      CNKCS205
032500                                                         'B'      CNKCS205
032600                                                         'E'.     CNKCS205
032700                             88  ASC-TEMP-NO-SELECT               CNKCS205
032800                                                   VALUE ' '.     CNKCS205
032900                             88  ASC-TEMP-SELECT   VALUE 'S'.     CNKCS205
033000                             88  ASC-TEMP-BEGIN    VALUE 'B'.     CNKCS205
033100                             88  ASC-TEMP-END      VALUE 'E'.     CNKCS205
033200                         30  ASC-SELECTED-SW                      CNKCS205
033300                                        PIC X(01).                CNKCS205
033400                             88  ASC-NO-SELECT     VALUE ' '.     CNKCS205
033500                             88  ASC-SELECT        VALUE 'S'.     CNKCS205
033600                             88  ASC-BEGIN         VALUE 'B'.     CNKCS205
033700                             88  ASC-END           VALUE 'E'.     CNKCS205
033800                         30  ASC-ACTION   PIC X(03).                 CL**3
033900                         30  ASC-FCLTY-ID PIC 9(04).                 CL**5
034000                         30  ASC-DEPT-NBR PIC X(03).                 CL**3
034100                         30  ASC-CL-NBR   PIC X(02).                 CL**3
034200                         30  ASC-RANK     PIC 9(01).                 CL**3
034300                         30  ASC-FORMAT   PIC X(06).                 CL**3
034400                         30  ASC-DESC     PIC X(06).                 CL**3
034500                         30  ASC-OPER-UNT-ID                         CL**3
034600                                          PIC 9(04).                 CL**3
034700                                                                  CNKCS205
034800             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     CNKCS205
034900             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     CNKCS205
035000             15  ASC-NUMBER-OF-ITEMS-READ                         CNKCS205
035100                                        PIC S9(09) COMP-3.        CNKCS205
035200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     CNKCS205
035300                                        PIC S9(09) COMP-3.        CNKCS205
035400             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        CNKCS205
035500             15  ASC-ITEM-AT-TOP-OF-PANEL                         CNKCS205
035600                                        PIC S9(09) COMP-3.        CNKCS205
035700             15  ASC-ITEM-AT-BOT-OF-PANEL                         CNKCS205
035800                                        PIC S9(09) COMP-3.        CNKCS205
035900             15  ASC-HIGHEST-BLOCK-WRITTEN                        CNKCS205
036000                                        PIC S9(04) COMP SYNC.     CNKCS205
036100             15  ASC-START-OF-SELECTED-RANGE                      CNKCS205
036200                                        PIC S9(09) COMP-3.        CNKCS205
036300             15  ASC-END-OF-SELECTED-RANGE                        CNKCS205
036400                                        PIC S9(09) COMP-3.        CNKCS205
036500             15  ASC-ITEMS-LEFT-INDICATOR                         CNKCS205
036600                                        PIC X(01).                CNKCS205
036700                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     CNKCS205
036800                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     CNKCS205
036900             15  ASC-TEMP-QUEUE-UPDATE-SW                         CNKCS205
037000                                        PIC X(01).                CNKCS205
037100                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     CNKCS205
037200                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     CNKCS205
037300             15  ASC-LIST-QUEUE-NAME.                             CNKCS205
037400                 20  ASC-LIST-TERM-ID   PIC X(04).                CNKCS205
037500                 20  ASC-LIST-TASK-NUMBER                         CNKCS205
037600                                        PIC S9(05) COMP-3.        CNKCS205
037700                 20  ASC-LIST-SEQ       PIC 9(01).                CNKCS205
037800             15  ASC-SEL-QUEUE-NAME.                              CNKCS205
037900                 20  ASC-SEL-TERM-ID    PIC X(04).                CNKCS205
038000                 20  ASC-SEL-TASK-NUMBER                          CNKCS205
038100                                        PIC S9(05) COMP-3.        CNKCS205
038200                 20  ASC-SEL-SEQ        PIC 9(01).                CNKCS205
038300                                                                  CNKCS205
038400             15  ASC-CURSOR-SW          PIC X(01).                CNKCS205
038500                 88  ASC-NO-CURSOR                 VALUE 'Z'.     CNKCS205
038600                 88  ASC-TYPE-CURSOR               VALUE 'S'.     CNKCS205
038700                 88  ASC-LOC-CURSOR                VALUE 'N'.     CNKCS205
038800                 88  ASC-DESC-CURSOR               VALUE 'T'.     CNKCS205
038900             15  ASC-START-ITEM-REQUEST.                          CNKCS205
039000                 20  ASC-START-ITEM-REQUEST-N                     CNKCS205
039100                                        PIC 9(07).                CNKCS205
039200             15  ASC-FCLTY-NME          PIC X(25).                   CL**3
039300/                                                                 CNKCS205
039400*---------------------------------------------------------------* CNKCS205
039500*    ABEND PROCESSING COPYBOOK.                                 * CNKCS205
039600*---------------------------------------------------------------* CNKCS205
039700                                                                  CNKCS205
039800     COPY DPWS013.                                                CNKCS205
039900                                                                  CNKCS205
040000/                                                                 CNKCS205
040100*---------------------------------------------------------------* CNKCS205
040200*    DB2 AREA FOR THE TICKET FORMAT TABLE                       * CNKCS205
040300*---------------------------------------------------------------* CNKCS205
040400     EXEC SQL                                                     CNKCS205
040500          INCLUDE TTKTFMT                                            CL**8
040600     END-EXEC.                                                    CNKCS205
040700                                                                  CNKCS205
040800/                                                                 CNKCS205
040900*---------------------------------------------------------------* CNKCS205
041000*    DB2 AREA FOR THE DEPARTMENT/CLASS TICKET FORMAT TABLE      * CNKCS205
041100*---------------------------------------------------------------* CNKCS205
041200     EXEC SQL                                                     CNKCS205
041300          INCLUDE TDCTFAS                                            CL**8
041400     END-EXEC.                                                    CNKCS205
041500                                                                  CNKCS205
041600/                                                                 CNKCS205
041700*---------------------------------------------------------------* CNKCS205
041800*    COPYBOOK USED WHEN CALLING XLKUT071                        * CNKCS205
041900*---------------------------------------------------------------* CNKCS205
042000     COPY XLWS071.                                                CNKCS205
042100                                                                  CNKCS205
042200/                                                                 CNKCS205
042300*---------------------------------------------------------------* CNKCS205
042400*    DB2 AREA FOR COMMUNICATIONS                                * CNKCS205
042500*---------------------------------------------------------------* CNKCS205
042600     EXEC SQL                                                     CNKCS205
042700          INCLUDE SQLCA                                           CNKCS205
042800     END-EXEC.                                                    CNKCS205
042900                                                                  CNKCS205
043000/                                                                 CNKCS205
043100*---------------------------------------------------------------* CNKCS205
043200*    DEPT-CL-NBR-CSR FOR SELECT OF ALL TICKET FORMATS ASSIGNED  *    CL**3
043300*    TO A DEPARTMENT/CLASS                                      * CNKCS205
043400*---------------------------------------------------------------* CNKCS205
043500                                                                  CNKCS205
043600     EXEC SQL                                                     CNKCS205
043700          DECLARE DEPT-CL-NBR-CSR CURSOR FOR                         CL**3
043800           SELECT OPER_UNT_ID                                        CL**7
043900                 ,FCLTY_ID                                           CL**7
044000                 ,DEPT_NBR                                           CL**5
044100                 ,CL_NBR                                             CL**3
044200                 ,RANK_NBR                                        CNKCS205
044300                 ,TKT_FMT_ID                                         CL**3
044400             FROM TDCTFAS                                            CL**8
044500            WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                      CL**3
044600              AND FCLTY_ID  BETWEEN :DK-FCLTY-ID-LOW                 CL**5
044700                                AND :DK-FCLTY-ID-HIGH                CL**5
044800              AND DEPT_NBR  BETWEEN :DK-DEPT-NBR-LOW AND             CL**3
044900                                    :DK-DEPT-NBR-HIGH                CL**3
045000              AND VALUE (TKT_FMT_ID, '######')                       CL**3
045100                            BETWEEN :DK-TKT-FMT-ID-LOW AND           CL**3
045200                                    :DK-TKT-FMT-ID-HIGH              CL**3
045300         ORDER BY FCLTY_ID                                           CL**5
045400                 ,DEPT_NBR                                           CL**5
045500                 ,CL_NBR                                             CL**3
045600                 ,RANK_NBR                                        CNKCS205
045700     END-EXEC.                                                    CNKCS205
045800                                                                  CNKCS205
045900/                                                                 CNKCS205
046000 LINKAGE SECTION.                                                 CNKCS205
046100                                                                  CNKCS205
046200 01  DFHCOMMAREA.                                                 CNKCS205
046300     05  FILLER                         OCCURS  1 TO 4072 TIMES   CNKCS205
046400                                        DEPENDING ON EIBCALEN.    CNKCS205
046500         10  FILLER                     PIC X.                    CNKCS205
046600                                                                  CNKCS205
046700/                                                                 CNKCS205
046800 PROCEDURE DIVISION.                                              CNKCS205
046900*---------------------------------------------------------------* CNKCS205
047000*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * CNKCS205
047100*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * CNKCS205
047200*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * CNKCS205
047300*---------------------------------------------------------------* CNKCS205
047400 0000-MAIN-MODULE.                                                CNKCS205
047500                                                                  CNKCS205
047600     INITIALIZE DP030-CICS-API-FIELDS.                            CNKCS205
047700                                                                  CNKCS205
047800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       CNKCS205
047900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          CNKCS205
048000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         CNKCS205
048100                                                                  CNKCS205
048200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       CNKCS205
048300                                                                  CNKCS205
048400     MOVE LENGTH OF CN205AI        TO DP030-MAP-LENGTH (1).       CNKCS205
048500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     CNKCS205
048600                                                                  CNKCS205
048700     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS205
048800     PERFORM 1000-CONTROL-PROCESSING                              CNKCS205
048900                                                                  CNKCS205
049000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     CNKCS205
049100     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS205
049200                                                                  CNKCS205
049300*---------------------------------------------------------------* CNKCS205
049400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * CNKCS205
049500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * CNKCS205
049600*---------------------------------------------------------------* CNKCS205
049700 0001-CALL-CICS-ARCH-API.                                         CNKCS205
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
049900                                    DFHCOMMAREA                           
050000                                    DP030-CICS-API-FIELDS                 
050100                                    DP020-STANDARD-COMMAREA               
050200                                    CN205AI.                              
050300                                                                  CNKCS205
050400     IF  DP030-RC-CALL-SUCCESSFUL                                 CNKCS205
050500         CONTINUE                                                 CNKCS205
050600     ELSE                                                         CNKCS205
050700         SET DP013-NO-ROLLBACK                                    CNKCS205
050800             DP013-XCTL-DISPLAY-RESTART                           CNKCS205
050900             DP013-CICS-ABEND      TO TRUE                        CNKCS205
051000         MOVE '0001-CALL-CICS-ARCH-API'                           CNKCS205
051100                                   TO DP013-PARAGRAPH             CNKCS205
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
051400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      CNKCS205
051500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
051600     END-IF.                                                      CNKCS205
051700                                                                  CNKCS205
051800*----------------------------------------------------------------*CNKCS205
051900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *CNKCS205
052000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *CNKCS205
052100*                                                                *CNKCS205
052200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *CNKCS205
052300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *CNKCS205
052400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *CNKCS205
052500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *CNKCS205
052600*----------------------------------------------------------------*CNKCS205
052700                                                                  CNKCS205
052800 1000-CONTROL-PROCESSING.                                         CNKCS205
052900                                                                  CNKCS205
053000     EVALUATE TRUE                                                CNKCS205
053100         WHEN DP020-NEXT-ACT-INITIAL                              CNKCS205
053200             INITIALIZE ASC-SPECIFIC-COMMAREA                     CNKCS205
053300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            CNKCS205
053400                                      ASC-SEL-TERM-ID             CNKCS205
053500             MOVE DP020-SRC-TASK-NUMBER                           CNKCS205
053600                                   TO ASC-LIST-TASK-NUMBER        CNKCS205
053700                                      ASC-SEL-TASK-NUMBER         CNKCS205
053800             MOVE PC-LIST-QUEUE-SEQ                               CNKCS205
053900                                   TO ASC-LIST-SEQ                CNKCS205
054000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 CNKCS205
054100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 CNKCS205
054200                                                                  CNKCS205
054300***-----$TEMPLATE NOTE$-------------------------------------------CNKCS205
054400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,CNKCS205
054500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  CNKCS205
054600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.CNKCS205
054700***---------------------------------------------------------------CNKCS205
054800             IF  PS-COMMAREA-NOT-VALID                            CNKCS205
054900                 SET DP020-NEXT-ACT-APPL-ERROR                    CNKCS205
055000                                   TO TRUE                        CNKCS205
055100             ELSE                                                 CNKCS205
055200                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS205
055300             END-IF                                               CNKCS205
055400                                                                  CNKCS205
055500         WHEN DP020-NEXT-ACT-READ-MAP                             CNKCS205
055600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        CNKCS205
055700                                   TO PV-TOP-ITEM                 CNKCS205
055800             PERFORM 2000-PROCESS-PANEL                           CNKCS205
055900                                                                  CNKCS205
056000         WHEN DP020-NEXT-ACT-RETURN                               CNKCS205
056100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        CNKCS205
056200                                   TO PV-TOP-ITEM                 CNKCS205
056300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS205
056400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 CNKCS205
056500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS205
056600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS205
056700                                                                  CNKCS205
056800         WHEN OTHER                                               CNKCS205
056900             SET DP013-LOGIC-ABEND TO TRUE                        CNKCS205
057000             SET DP013-NO-ROLLBACK TO TRUE                        CNKCS205
057100             MOVE '1000-CONTROL-PROCESSING'                       CNKCS205
057200                                   TO DP013-PARAGRAPH             CNKCS205
057300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    CNKCS205
057400                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
057500             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS205
057600     END-EVALUATE.                                                CNKCS205
057700                                                                  CNKCS205
057800/                                                                 CNKCS205
057900*----------------------------------------------------------------*CNKCS205
058000* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *CNKCS205
058100*----------------------------------------------------------------*CNKCS205
058200                                                                  CNKCS205
058300 1100-PROCESS-INTER-APPL-COMM.                                    CNKCS205
058400                                                                  CNKCS205
058500     SET PS-COMMAREA-VALID         TO TRUE.                       CNKCS205
058600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     CNKCS205
058700                                                                  CNKCS205
058800     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           CNKCS205
058900        MOVE CN001-OPER-UNT-ID     TO DK-OPER-UNT-ID                 CL**3
059000                                      ASC-KEY-OPER-UNT-ID            CL**3
059100        MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID                    CL**5
059200                                      DK-FCLTY-ID-LOW                CL**5
059300                                      DK-FCLTY-ID-HIGH               CL**5
059400                                      ASC-KEY-FCLTY-ID-LOW           CL**5
059500                                      ASC-KEY-FCLTY-ID-HIGH          CL**5
059600                                      ASC-KEY-FCLTY-ID               CL**5
059700        MOVE CN001-DEPT-NBR        TO DK-DEPT-NBR-LOW                CL**3
059800                                      DK-DEPT-NBR-HIGH               CL**3
059900                                      ASC-KEY-DEPT-NBR-LOW           CL**3
060000                                      ASC-KEY-DEPT-NBR-HIGH          CL**3
060100        MOVE CN001-TKT-FMT-ID      TO DK-TKT-FMT-ID-LOW              CL**3
060200                                      DK-TKT-FMT-ID-HIGH             CL**3
060300                                      ASC-KEY-TKT-FMT-ID-LOW         CL**3
060400                                      ASC-KEY-TKT-FMT-ID-HIGH        CL**3
060500        MOVE CN001-SEL-UNASSIGNED  TO ASC-SEL-UNASSIGNED          CNKCS205
060600     END-IF.                                                      CNKCS205
060700                                                                  CNKCS205
060800/                                                                 CNKCS205
060900*----------------------------------------------------------------*CNKCS205
061000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *CNKCS205
061100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *CNKCS205
061200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *CNKCS205
061300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *CNKCS205
061400* FUNCTION KEYS CAN GET THIS FAR.                                *CNKCS205
061500*----------------------------------------------------------------*CNKCS205
061600                                                                  CNKCS205
061700 2000-PROCESS-PANEL.                                              CNKCS205
061800     EVALUATE TRUE                                                CNKCS205
061900         WHEN DP020-SRC-AID = DP016-CLEAR                         CNKCS205
062000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS205
062100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS205
062200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS205
062300                                                                  CNKCS205
062400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    CNKCS205
062500             MOVE ASC-KEY-OPER-UNT-ID                                CL**3
062600                                   TO DK-OPER-UNT-ID                 CL**3
062700             MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID                    CL**5
062800             MOVE ASC-KEY-FCLTY-ID-LOW                               CL**5
062900                                   TO DK-FCLTY-ID-LOW                CL**5
063000             MOVE ASC-KEY-FCLTY-ID-HIGH                              CL**5
063100                                   TO DK-FCLTY-ID-HIGH               CL**5
063200             MOVE ASC-KEY-DEPT-NBR-LOW                               CL**3
063300                                   TO DK-DEPT-NBR-LOW                CL**3
063400             MOVE ASC-KEY-DEPT-NBR-HIGH                              CL**3
063500                                   TO DK-DEPT-NBR-HIGH               CL**3
063600             MOVE ASC-KEY-TKT-FMT-ID-LOW                             CL**3
063700                                   TO DK-TKT-FMT-ID-LOW              CL**3
063800             MOVE ASC-KEY-TKT-FMT-ID-HIGH                            CL**3
063900                                   TO DK-TKT-FMT-ID-HIGH             CL**3
064000             PERFORM 2050-DELETE-LIST-QUEUE                       CNKCS205
064100             PERFORM 4000-BUILD-INITIAL-PANEL                     CNKCS205
064200                                                                  CNKCS205
064300         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    CNKCS205
064400             PERFORM 2140-DESELECT-ALL-ITEMS                      CNKCS205
064500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS205
064600                                                                  CNKCS205
064700         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  CNKCS205
064800             PERFORM 2150-SELECT-ALL-ITEMS                        CNKCS205
064900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS205
065000                                                                  CNKCS205
065100         WHEN OTHER                                               CNKCS205
065200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS205
065300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS205
065400             IF  PS-NO-ERROR                                      CNKCS205
065500                 SET DP030-CONTINUE-GO TO TRUE                    CNKCS205
065600                 PERFORM 2100-CHECK-FUNCTION-KEY                  CNKCS205
065700             ELSE                                                 CNKCS205
065800                 SET DP030-OVERRIDE-GO TO TRUE                    CNKCS205
065900             END-IF                                               CNKCS205
066000     END-EVALUATE.                                                CNKCS205
066100                                                                  CNKCS205
066200/                                                                 CNKCS205
066300*----------------------------------------------------------------*CNKCS205
066400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *CNKCS205
066500*----------------------------------------------------------------*CNKCS205
066600 2050-DELETE-LIST-QUEUE.                                          CNKCS205
066700                                                                  CNKCS205
066800     EXEC CICS                                                    CNKCS205
066900         DELETEQ TS                                               CNKCS205
067000           QUEUE (ASC-LIST-QUEUE-NAME)                            CNKCS205
067100            RESP (PV-CICS-RESP)                                   CNKCS205
067200     END-EXEC.                                                    CNKCS205
067300                                                                  CNKCS205
067400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       CNKCS205
067500        (PV-CICS-RESP = DFHRESP(QIDERR))                          CNKCS205
067600         CONTINUE                                                 CNKCS205
067700     ELSE                                                         CNKCS205
067800         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
067900         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
068000                                                                  CNKCS205
068100         MOVE '2050-DELETE-LIST-QUEUE'                            CNKCS205
068200                                   TO DP013-PARAGRAPH             CNKCS205
068300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    CNKCS205
068400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
068500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
068600     END-IF.                                                      CNKCS205
068700                                                                  CNKCS205
068800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  CNKCS205
068900                                                                  CNKCS205
069000/                                                                 CNKCS205
069100*----------------------------------------------------------------*CNKCS205
069200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*CNKCS205
069300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *CNKCS205
069400* CICS ARCHITECTURE API.                                         *CNKCS205
069500*----------------------------------------------------------------*CNKCS205
069600 2100-CHECK-FUNCTION-KEY.                                         CNKCS205
069700                                                                  CNKCS205
069800     EVALUATE TRUE                                                CNKCS205
069900         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  CNKCS205
070000              IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO             CNKCS205
070100                  SET ASC-NO-TSQ-UPDATE TO TRUE                   CNKCS205
070200              END-IF                                              CNKCS205
070300              INITIALIZE CN003-INTER-APPL-COMMAREA                CNKCS205
070400              MOVE ASC-KEY-OPER-UNT-ID                               CL**3
070500                                   TO CN003-OPER-UNT-ID              CL**3
070600              MOVE ASC-KEY-FCLTY-ID                                  CL**3
070700                                   TO CN003-FCLTY-ID                 CL**3
070800              MOVE ASC-NUMBER-OF-SELECTED-ITEMS                   CNKCS205
070900                                 TO CN003-NUMBER-OF-SELECTED-ITEMSCNKCS205
071000              PERFORM 5000-PREPARE-SEL-QUEUE                      CNKCS205
071100                                                                  CNKCS205
071200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  CNKCS205
071300             MOVE +1               TO PV-TOP-ITEM                 CNKCS205
071400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS205
071500             PERFORM 3200-RESET-ATTRIBUTES                           CL**3
071600                                                                  CNKCS205
071700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   CNKCS205
071800             PERFORM 2110-BROWSE-BACKWARD                         CNKCS205
071900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS205
072000             PERFORM 3200-RESET-ATTRIBUTES                           CL**3
072100                                                                  CNKCS205
072200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   CNKCS205
072300             PERFORM 2120-BROWSE-FORWARD                          CNKCS205
072400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS205
072500             PERFORM 3200-RESET-ATTRIBUTES                           CL**3
072600                                                                  CNKCS205
072700         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS205
072800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   CNKCS205
072900             IF  PS-ERROR                                         CNKCS205
073000                 CONTINUE                                         CNKCS205
073100             ELSE                                                 CNKCS205
073200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             CNKCS205
073300             END-IF                                               CNKCS205
073400                                                                  CNKCS205
073500         WHEN OTHER                                               CNKCS205
073600             SET DP013-NO-ROLLBACK                                CNKCS205
073700                 DP013-XCTL-DISPLAY-RESTART                       CNKCS205
073800                 DP013-CICS-ABEND  TO TRUE                        CNKCS205
073900             MOVE '2100-CHECK-FUNCTION-KEY'                       CNKCS205
074000                                   TO DP013-PARAGRAPH             CNKCS205
074100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      CNKCS205
074200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
074300             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS205
074400     END-EVALUATE.                                                CNKCS205
074500/                                                                 CNKCS205
074600*----------------------------------------------------------------*CNKCS205
074700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *CNKCS205
074800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *CNKCS205
074900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *CNKCS205
075000*    MESSAGE.                                                    *CNKCS205
075100*----------------------------------------------------------------*CNKCS205
075200                                                                  CNKCS205
075300 2110-BROWSE-BACKWARD.                                            CNKCS205
075400                                                                  CNKCS205
075500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    CNKCS205
075600         GIVING PV-TOP-ITEM.                                      CNKCS205
075700                                                                  CNKCS205
075800     IF  ((PV-TOP-ITEM < +1)                                      CNKCS205
075900       OR (PV-TOP-ITEM = +1))                                     CNKCS205
076000         MOVE +1                   TO PV-TOP-ITEM                 CNKCS205
076100*        -- TOP OF LIST --                                        CNKCS205
076200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            CNKCS205
076300         SET DP020-MSG-INFORMATIONAL                              CNKCS205
076400                                   TO TRUE                        CNKCS205
076500     END-IF.                                                      CNKCS205
076600                                                                  CNKCS205
076700/                                                                 CNKCS205
076800*----------------------------------------------------------------*CNKCS205
076900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *CNKCS205
077000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *CNKCS205
077100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *CNKCS205
077200*----------------------------------------------------------------*CNKCS205
077300                                                                  CNKCS205
077400 2120-BROWSE-FORWARD.                                             CNKCS205
077500                                                                  CNKCS205
077600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              CNKCS205
077700         GIVING PV-TOP-ITEM.                                      CNKCS205
077800                                                                  CNKCS205
077900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   CNKCS205
078000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            CNKCS205
078100                                   TO PV-TOP-ITEM                 CNKCS205
078200*        -- BOTTOM OF LIST --                                     CNKCS205
078300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            CNKCS205
078400         SET DP020-MSG-INFORMATIONAL                              CNKCS205
078500                                   TO TRUE                        CNKCS205
078600     ELSE                                                         CNKCS205
078700         COMPUTE PV-BOTTOM-ITEM =                                 CNKCS205
078800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 CNKCS205
078900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            CNKCS205
079000*            -- BOTTOM OF LIST --                                 CNKCS205
079100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            CNKCS205
079200             SET DP020-MSG-INFORMATIONAL                          CNKCS205
079300                                   TO TRUE                        CNKCS205
079400         END-IF                                                   CNKCS205
079500     END-IF.                                                      CNKCS205
079600                                                                  CNKCS205
079700/                                                                 CNKCS205
079800*----------------------------------------------------------------*CNKCS205
079900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *CNKCS205
080000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *CNKCS205
080100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *CNKCS205
080200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *CNKCS205
080300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *CNKCS205
080400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *CNKCS205
080500*----------------------------------------------------------------*CNKCS205
080600                                                                  CNKCS205
080700 2130-CHECK-FOR-JUMP-BROWSE.                                      CNKCS205
080800                                                                  CNKCS205
080900     SET PS-NO-ERROR               TO TRUE.                       CNKCS205
081000     IF (ASC-START-ITEM-REQUEST = SPACE)                          CNKCS205
081100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            CNKCS205
081200                                   TO PV-TOP-ITEM                 CNKCS205
081300     ELSE                                                         CNKCS205
081400         MOVE ASC-START-ITEM-REQUEST                              CNKCS205
081500                                   TO DP010I-UNEDITED-FIELD       CNKCS205
081600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       CNKCS205
081700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     CNKCS205
081800         SET DP010I-NEGATIVE-NOT-ALLOWED                          CNKCS205
081900                                   TO TRUE                        CNKCS205
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263455              USING DP010I-NUMERIC-EDIT-AREA                              
082100                                                                  CNKCS205
082200         IF  NOT DP010I-ERROR-DETECTED                            CNKCS205
082300             MOVE DP010I-NUMERIC-FIELD                            CNKCS205
082400                                   TO ASC-START-ITEM-REQUEST-N    CNKCS205
082500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  CNKCS205
082600                 IF  ASC-START-ITEM-REQUEST-N >                   CNKCS205
082700                                          ASC-NUMBER-OF-ITEMS-READCNKCS205
082800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         CNKCS205
082900                     COMPUTE PV-TOP-ITEM =                        CNKCS205
083000                             ASC-NUMBER-OF-ITEMS-READ             CNKCS205
083100                             - PC-ITEMS-PER-PANEL + 1             CNKCS205
083200                     IF  PV-TOP-ITEM < +1                         CNKCS205
083300                         MOVE +1   TO PV-TOP-ITEM                 CNKCS205
083400                         MOVE PC-TSYMSG-00070                     CNKCS205
083500                                   TO DP020-MSG-NUMBER            CNKCS205
083600                         SET DP020-MSG-INFORMATIONAL              CNKCS205
083700                                   TO TRUE                        CNKCS205
083800                     END-IF                                       CNKCS205
083900                 ELSE                                             CNKCS205
084000                     MOVE ASC-START-ITEM-REQUEST-N                CNKCS205
084100                                   TO PV-TOP-ITEM                 CNKCS205
084200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      CNKCS205
084300                     COMPUTE PV-BOTTOM-ITEM =                     CNKCS205
084400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     CNKCS205
084500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READCNKCS205
084600*                        -- BOTTOM OF LIST --                     CNKCS205
084700                         MOVE PC-TSYMSG-00070                     CNKCS205
084800                                   TO DP020-MSG-NUMBER            CNKCS205
084900                         SET DP020-MSG-INFORMATIONAL              CNKCS205
085000                                   TO TRUE                        CNKCS205
085100                     END-IF                                       CNKCS205
085200                 END-IF                                           CNKCS205
085300             ELSE                                                 CNKCS205
085400*                --- VALUE OUT OF RANGE ----                      CNKCS205
085500                 MOVE PC-TSYMSG-00101                             CNKCS205
085600                                   TO DP020-MSG-NUMBER            CNKCS205
085700                 MOVE -1           TO ASTRTITL                    CNKCS205
085800                 SET DP030-SET-CURSOR-APPL-1                      CNKCS205
085900                                   TO TRUE                        CNKCS205
086000                 MOVE DP015-REVERSE                               CNKCS205
086100                                   TO ASTRTITH                    CNKCS205
086200                 MOVE DP015-RED    TO ASTRTITC                    CNKCS205
086300                 MOVE DP015-UNP-NUM-BRT-MDT                       CNKCS205
086400                                   TO ASTRTITA                    CNKCS205
086500                 SET DP020-MSG-FATAL                              CNKCS205
086600                                   TO TRUE                        CNKCS205
086700                 SET PS-ERROR      TO TRUE                        CNKCS205
086800             END-IF                                               CNKCS205
086900                                                                  CNKCS205
087000         ELSE                                                     CNKCS205
087100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            CNKCS205
087200             MOVE -1               TO ASTRTITL                    CNKCS205
087300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  CNKCS205
087400             MOVE DP015-REVERSE    TO ASTRTITH                    CNKCS205
087500             MOVE DP015-RED        TO ASTRTITC                    CNKCS205
087600             MOVE DP015-UNP-NUM-BRT-MDT                           CNKCS205
087700                                   TO ASTRTITA                    CNKCS205
087800             SET DP020-MSG-FATAL   TO TRUE                        CNKCS205
087900             SET PS-ERROR          TO TRUE                        CNKCS205
088000         END-IF                                                   CNKCS205
088100     END-IF.                                                      CNKCS205
088200                                                                  CNKCS205
088300/                                                                 CNKCS205
088400*----------------------------------------------------------------*CNKCS205
088500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *CNKCS205
088600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *CNKCS205
088700*----------------------------------------------------------------*CNKCS205
088800 2140-DESELECT-ALL-ITEMS.                                         CNKCS205
088900                                                                  CNKCS205
089000     MOVE +1                       TO ASC-BLK-SUB.                CNKCS205
089100                                                                  CNKCS205
089200     PERFORM 2141-CLEAR-SELECTED-INDS                             CNKCS205
089300         VARYING ASC-ITEM-SUB                                     CNKCS205
089400         FROM 1 BY 1                                              CNKCS205
089500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS205
089600                                                                  CNKCS205
089700     ADD +1                        TO ASC-BLK-SUB.                CNKCS205
089800                                                                  CNKCS205
089900     PERFORM 2141-CLEAR-SELECTED-INDS                             CNKCS205
090000         VARYING ASC-ITEM-SUB                                     CNKCS205
090100         FROM 1 BY 1                                              CNKCS205
090200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS205
090300                                                                  CNKCS205
090400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS205
090500                                   TO PV-LIST-ITEM-NUMBER.        CNKCS205
090600                                                                  CNKCS205
090700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS205
090800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS205
090900                                                                  CNKCS205
091000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     CNKCS205
091100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      CNKCS205
091200         MOVE +1                   TO ASC-BLK-SUB                 CNKCS205
091300                                                                  CNKCS205
091400         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS205
091500                                                                  CNKCS205
091600         MOVE +1                   TO PV-BLOCK-NUMBER             CNKCS205
091700                                                                  CNKCS205
091800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS205
091900             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS205
092000                                                                  CNKCS205
092100         PERFORM                                                  CNKCS205
092200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       CNKCS205
092300                                                                  CNKCS205
092400             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
092500                                                                  CNKCS205
092600             PERFORM 2141-CLEAR-SELECTED-INDS                     CNKCS205
092700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 CNKCS205
092800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS205
092900                                                                  CNKCS205
093000             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
093100                                                                  CNKCS205
093200             ADD +1                TO PV-BLOCK-NUMBER             CNKCS205
093300                                                                  CNKCS205
093400         END-PERFORM                                              CNKCS205
093500                                                                  CNKCS205
093600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS205
093700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS205
093800                                                                  CNKCS205
093900         PERFORM                                                  CNKCS205
094000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS205
094100                   ASC-HIGHEST-BLOCK-WRITTEN                      CNKCS205
094200                                                                  CNKCS205
094300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS205
094400                                   TO PV-BLOCK-NUMBER             CNKCS205
094500                                                                  CNKCS205
094600             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
094700                                                                  CNKCS205
094800             PERFORM 2141-CLEAR-SELECTED-INDS                     CNKCS205
094900                 VARYING ASC-ITEM-SUB                             CNKCS205
095000                 FROM 1 BY 1                                      CNKCS205
095100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS205
095200                                                                  CNKCS205
095300             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
095400                                                                  CNKCS205
095500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS205
095600                                                                  CNKCS205
095700         END-PERFORM                                              CNKCS205
095800                                                                  CNKCS205
095900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS205
096000                                   TO PV-BLOCK-NUMBER             CNKCS205
096100                                                                  CNKCS205
096200         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS205
096300     END-IF.                                                      CNKCS205
096400                                                                  CNKCS205
096500                                                                  CNKCS205
096600     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS205
096700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.CNKCS205
096800     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  CNKCS205
096900                                                                  CNKCS205
097000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS205
097100                                                                  CNKCS205
097200/                                                                 CNKCS205
097300*----------------------------------------------------------------*CNKCS205
097400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *CNKCS205
097500*----------------------------------------------------------------*CNKCS205
097600                                                                  CNKCS205
097700 2141-CLEAR-SELECTED-INDS.                                        CNKCS205
097800                                                                  CNKCS205
097900     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS205
098000             NOT EQUAL ZERO                                       CNKCS205
098100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS205
098200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS205
098300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    CNKCS205
098400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  CNKCS205
098500                                   TO TRUE                        CNKCS205
098600         END-IF                                                   CNKCS205
098700     END-IF.                                                      CNKCS205
098800                                                                  CNKCS205
098900/                                                                 CNKCS205
099000*----------------------------------------------------------------*CNKCS205
099100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *CNKCS205
099200*  FOR ALL ITEMS.                                                *CNKCS205
099300*----------------------------------------------------------------*CNKCS205
099400                                                                  CNKCS205
099500 2150-SELECT-ALL-ITEMS.                                           CNKCS205
099600                                                                  CNKCS205
099700     MOVE +1                       TO ASC-BLK-SUB.                CNKCS205
099800                                                                  CNKCS205
099900     PERFORM 2151-SET-SELECTED-INDS                               CNKCS205
100000         VARYING ASC-ITEM-SUB                                     CNKCS205
100100         FROM 1 BY 1                                              CNKCS205
100200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS205
100300                                                                  CNKCS205
100400     ADD +1                        TO ASC-BLK-SUB.                CNKCS205
100500                                                                  CNKCS205
100600     PERFORM 2151-SET-SELECTED-INDS                               CNKCS205
100700         VARYING ASC-ITEM-SUB                                     CNKCS205
100800         FROM 1 BY 1                                              CNKCS205
100900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS205
101000                                                                  CNKCS205
101100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS205
101200                                   TO PV-LIST-ITEM-NUMBER.        CNKCS205
101300                                                                  CNKCS205
101400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS205
101500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS205
101600                                                                  CNKCS205
101700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     CNKCS205
101800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    CNKCS205
101900         MOVE +1                   TO ASC-BLK-SUB                 CNKCS205
102000                                                                  CNKCS205
102100         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS205
102200                                                                  CNKCS205
102300         MOVE +1                   TO PV-BLOCK-NUMBER             CNKCS205
102400                                                                  CNKCS205
102500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS205
102600             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS205
102700                                                                  CNKCS205
102800         PERFORM                                                  CNKCS205
102900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       CNKCS205
103000                                                                  CNKCS205
103100             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
103200                                                                  CNKCS205
103300             PERFORM 2151-SET-SELECTED-INDS                       CNKCS205
103400                 VARYING ASC-ITEM-SUB                             CNKCS205
103500                 FROM 1 BY 1                                      CNKCS205
103600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS205
103700                                                                  CNKCS205
103800             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
103900                                                                  CNKCS205
104000             ADD +1                TO PV-BLOCK-NUMBER             CNKCS205
104100         END-PERFORM                                              CNKCS205
104200                                                                  CNKCS205
104300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS205
104400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS205
104500                                                                  CNKCS205
104600         PERFORM                                                  CNKCS205
104700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS205
104800                   ASC-HIGHEST-BLOCK-WRITTEN                      CNKCS205
104900                                                                  CNKCS205
105000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS205
105100                                   TO PV-BLOCK-NUMBER             CNKCS205
105200                                                                  CNKCS205
105300             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
105400                                                                  CNKCS205
105500             PERFORM 2151-SET-SELECTED-INDS                       CNKCS205
105600                 VARYING ASC-ITEM-SUB                             CNKCS205
105700                 FROM 1 BY 1                                      CNKCS205
105800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS205
105900                                                                  CNKCS205
106000             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
106100                                                                  CNKCS205
106200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS205
106300         END-PERFORM                                              CNKCS205
106400                                                                  CNKCS205
106500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS205
106600                                   TO PV-BLOCK-NUMBER             CNKCS205
106700                                                                  CNKCS205
106800         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS205
106900     END-IF.                                                      CNKCS205
107000                                                                  CNKCS205
107100                                                                  CNKCS205
107200     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             CNKCS205
107300          ASC-NUMBER-OF-SELECTED-ITEMS.                           CNKCS205
107400                                                                  CNKCS205
107500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS205
107600                                                                  CNKCS205
107700/                                                                 CNKCS205
107800*----------------------------------------------------------------*CNKCS205
107900*    MARK EACH ITEM AS BEING SELECTED.                           *CNKCS205
108000*----------------------------------------------------------------*CNKCS205
108100                                                                  CNKCS205
108200 2151-SET-SELECTED-INDS.                                          CNKCS205
108300                                                                  CNKCS205
108400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS205
108500             NOT EQUAL ZERO                                       CNKCS205
108600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS205
108700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS205
108800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS205
108900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  CNKCS205
109000                                   TO TRUE                        CNKCS205
109100         END-IF                                                   CNKCS205
109200     END-IF.                                                      CNKCS205
109300                                                                  CNKCS205
109400*----------------------------------------------------------------*CNKCS205
109500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *CNKCS205
109600*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *CNKCS205
109700*----------------------------------------------------------------*CNKCS205
109800 2200-MOVE-SCREEN-TO-COMMAREA.                                    CNKCS205
109900                                                                  CNKCS205
110000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             CNKCS205
110100     MOVE +1                       TO PV-SUB.                     CNKCS205
110200                                                                  CNKCS205
110300     PERFORM 3100-SET-SUBSCRIPTS.                                 CNKCS205
110400                                                                  CNKCS205
110500     IF  ASTRTITL > ZERO                                          CNKCS205
110600         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      CNKCS205
110700     ELSE                                                         CNKCS205
110800         IF  ASTRTITF = DP015-ERASE-EOF                           CNKCS205
110900             INITIALIZE ASC-START-ITEM-REQUEST                    CNKCS205
111000         END-IF                                                   CNKCS205
111100     END-IF.                                                      CNKCS205
111200                                                                  CNKCS205
111300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          CNKCS205
111400         VARYING PV-SUB                                           CNKCS205
111500         FROM 1 BY 1                                              CNKCS205
111600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      CNKCS205
111700                                                                  CNKCS205
111800*----------------------------------------------------------------*CNKCS205
111900*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *CNKCS205
112000*----------------------------------------------------------------*CNKCS205
112100 2210-MOVE-LINES-TO-COMMAREA.                                     CNKCS205
112200                                                                  CNKCS205
112300     IF  MR-SELECTL (PV-SUB) > ZERO                               CNKCS205
112400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     CNKCS205
112500                                   TO TRUE                        CNKCS205
112600         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        CNKCS205
112700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      CNKCS205
112800     ELSE                                                         CNKCS205
112900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                CNKCS205
113000             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         CNKCS205
113100             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        CNKCS205
113200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      CNKCS205
113300         END-IF                                                   CNKCS205
113400     END-IF.                                                      CNKCS205
113500                                                                  CNKCS205
113600     ADD +1                        TO ASC-ITEM-SUB.               CNKCS205
113700                                                                  CNKCS205
113800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        CNKCS205
113900         ADD +1                    TO ASC-BLK-SUB                 CNKCS205
114000         MOVE +1                   TO ASC-ITEM-SUB                CNKCS205
114100     END-IF.                                                      CNKCS205
114200                                                                  CNKCS205
114300*----------------------------------------------------------------*CNKCS205
114400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *CNKCS205
114500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *CNKCS205
114600*----------------------------------------------------------------*CNKCS205
114700 3000-EDIT-DATA-IN-COMMAREA.                                      CNKCS205
114800                                                                  CNKCS205
114900     SET PS-NO-ERROR               TO TRUE.                       CNKCS205
115000                                                                  CNKCS205
115100     PERFORM 3200-RESET-ATTRIBUTES.                               CNKCS205
115200                                                                  CNKCS205
115300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     CNKCS205
115400**                                                                CNKCS205
115500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              CNKCS205
115600* EDITTING IS DONE FROM THE BOTTOM UP.                            CNKCS205
115700**                                                                CNKCS205
115800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       CNKCS205
115900         ASC-ITEMS-DISPLAYED - 1.                                 CNKCS205
116000                                                                  CNKCS205
116100     PERFORM 3100-SET-SUBSCRIPTS.                                 CNKCS205
116200     PERFORM 3300-EDIT-SELECTIONS                                 CNKCS205
116300         VARYING PV-SUB                                           CNKCS205
116400         FROM PV-SUB BY -1                                        CNKCS205
116500         UNTIL PV-SUB < +1                                        CNKCS205
116600                                                                  CNKCS205
116700     IF  PS-NO-ERROR                                              CNKCS205
116800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        CNKCS205
116900     END-IF.                                                      CNKCS205
117000                                                                  CNKCS205
117100     IF  ((PS-NO-ERROR)                                           CNKCS205
117200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   CNKCS205
117300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    CNKCS205
117400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  CNKCS205
117500     END-IF.                                                      CNKCS205
117600                                                                  CNKCS205
117700/                                                                 CNKCS205
117800*----------------------------------------------------------------*CNKCS205
117900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *CNKCS205
118000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*CNKCS205
118100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *CNKCS205
118200*                                                                *CNKCS205
118300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *CNKCS205
118400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *CNKCS205
118500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *CNKCS205
118600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *CNKCS205
118700*----------------------------------------------------------------*CNKCS205
118800                                                                  CNKCS205
118900 3100-SET-SUBSCRIPTS.                                             CNKCS205
119000                                                                  CNKCS205
119100     COMPUTE ASC-ITEM-SUB =                                       CNKCS205
119200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        CNKCS205
119300                                                                  CNKCS205
119400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         CNKCS205
119500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            CNKCS205
119600                                                                  CNKCS205
119700         MOVE PC-MAX-BLOCKS-IN-ARRAY                              CNKCS205
119800                                   TO ASC-BLK-SUB                 CNKCS205
119900     ELSE                                                         CNKCS205
120000         MOVE +1                   TO ASC-BLK-SUB                 CNKCS205
120100     END-IF.                                                      CNKCS205
120200                                                                  CNKCS205
120300*----------------------------------------------------------------*CNKCS205
120400*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *CNKCS205
120500*----------------------------------------------------------------*CNKCS205
120600                                                                  CNKCS205
120700 3200-RESET-ATTRIBUTES.                                           CNKCS205
120800                                                                  CNKCS205
120900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   CNKCS205
121000     MOVE DP015-GREEN              TO ASTRTITC.                   CNKCS205
121100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   CNKCS205
121200                                                                  CNKCS205
121300     IF DP020-NEXT-ACT-RETURN                                     CNKCS205
121400        PERFORM                                                   CNKCS205
121500            VARYING PV-SUB                                        CNKCS205
121600            FROM 1 BY 1                                           CNKCS205
121700            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    CNKCS205
121800            MOVE DP015-UNP-ALP-NOR-OFF                            CNKCS205
121900                                      TO MR-SELECTA (PV-SUB)      CNKCS205
122000            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      CNKCS205
122100            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      CNKCS205
122200        END-PERFORM                                               CNKCS205
122300     ELSE                                                         CNKCS205
122400        PERFORM                                                   CNKCS205
122500            VARYING PV-SUB                                        CNKCS205
122600            FROM 1 BY 1                                           CNKCS205
122700            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     CNKCS205
122800            MOVE DP015-UNP-ALP-NOR-OFF                            CNKCS205
122900                                      TO MR-SELECTA (PV-SUB)      CNKCS205
123000            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      CNKCS205
123100            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      CNKCS205
123200        END-PERFORM                                               CNKCS205
123300     END-IF.                                                      CNKCS205
123400                                                                  CNKCS205
123500*----------------------------------------------------------------*CNKCS205
123600*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *CNKCS205
123700*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *CNKCS205
123800*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *CNKCS205
123900*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *CNKCS205
124000*----------------------------------------------------------------*CNKCS205
124100 3300-EDIT-SELECTIONS.                                            CNKCS205
124200                                                                  CNKCS205
124300     EVALUATE TRUE                                                CNKCS205
124400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     CNKCS205
124500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         CNKCS205
124600                 CONTINUE                                         CNKCS205
124700                                                                  CNKCS205
124800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         CNKCS205
124900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS205
125000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS205
125100                 MOVE ASC-TEMP-SELECTED-SW                        CNKCS205
125200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS205
125300                                   TO ASC-SELECTED-SW             CNKCS205
125400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS205
125500             END-IF                                               CNKCS205
125600                                                                  CNKCS205
125700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     CNKCS205
125800                 = SPACE                                          CNKCS205
125900             EVALUATE TRUE                                        CNKCS205
126000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       CNKCS205
126100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSCNKCS205
126200                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS205
126300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS205
126400                                                                  CNKCS205
126500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        CNKCS205
126600                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE CNKCS205
126700                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS205
126800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS205
126900                                                                  CNKCS205
127000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS205
127100                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   CNKCS205
127200                     MOVE SPACE    TO ASC-SELECTED-SW             CNKCS205
127300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS205
127400             END-EVALUATE                                         CNKCS205
127500                                                                  CNKCS205
127600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS205
127700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS205
127800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    CNKCS205
127900             END-IF                                               CNKCS205
128000             PERFORM 3310-EDIT-RANGE                              CNKCS205
128100                                                                  CNKCS205
128200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             CNKCS205
128300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS205
128400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    CNKCS205
128500             END-IF                                               CNKCS205
128600             PERFORM 3310-EDIT-RANGE                              CNKCS205
128700                                                                  CNKCS205
128800         WHEN OTHER                                               CNKCS205
128900             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            CNKCS205
129000             SET DP020-MSG-FATAL   TO TRUE                        CNKCS205
129100             MOVE -1               TO MR-SELECTL (PV-SUB)         CNKCS205
129200             SET DP030-SET-CURSOR-APPL-1                          CNKCS205
129300                                   TO TRUE                        CNKCS205
129400             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         CNKCS205
129500             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         CNKCS205
129600             SET PS-ERROR          TO TRUE                        CNKCS205
129700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            CNKCS205
129800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     CNKCS205
129900                 MOVE SPACE        TO ASC-SELECTED-SW             CNKCS205
130000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS205
130100             END-IF                                               CNKCS205
130200     END-EVALUATE.                                                CNKCS205
130300                                                                  CNKCS205
130400     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             CNKCS205
130500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               CNKCS205
130600                                                                  CNKCS205
130700     IF  ASC-ITEM-SUB < 1                                         CNKCS205
130800         SUBTRACT +1 FROM ASC-BLK-SUB                             CNKCS205
130900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                CNKCS205
131000     END-IF.                                                      CNKCS205
131100                                                                  CNKCS205
131200*----------------------------------------------------------------*CNKCS205
131300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *CNKCS205
131400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *CNKCS205
131500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *CNKCS205
131600*  THE ENDING.                                                   *CNKCS205
131700*----------------------------------------------------------------*CNKCS205
131800 3310-EDIT-RANGE.                                                 CNKCS205
131900                                                                  CNKCS205
132000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                CNKCS205
132100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   CNKCS205
132200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS205
132300                                   TO ASC-SELECTED-SW             CNKCS205
132400                                        (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS205
132500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE CNKCS205
132600         ELSE                                                     CNKCS205
132700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     CNKCS205
132800                 CONTINUE                                         CNKCS205
132900             ELSE                                                 CNKCS205
133000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        CNKCS205
133100                 MOVE PC-TSYMSG-00054                             CNKCS205
133200                                   TO DP020-MSG-NUMBER            CNKCS205
133300                 SET DP020-MSG-FATAL                              CNKCS205
133400                                   TO TRUE                        CNKCS205
133500                 MOVE -1           TO MR-SELECTL (PV-SUB)         CNKCS205
133600                 SET DP030-SET-CURSOR-APPL-1                      CNKCS205
133700                                   TO TRUE                        CNKCS205
133800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         CNKCS205
133900                 MOVE DP015-UNDERLINE                             CNKCS205
134000                                   TO MR-SELECTH (PV-SUB)         CNKCS205
134100                 SET PS-ERROR      TO TRUE                        CNKCS205
134200             END-IF                                               CNKCS205
134300         END-IF                                                   CNKCS205
134400     ELSE                                                         CNKCS205
134500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     CNKCS205
134600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
134700                                   TO ASC-SELECTED-SW             CNKCS205
134800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   CNKCS205
134900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   CNKCS205
135000         ELSE                                                     CNKCS205
135100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       CNKCS205
135200                 CONTINUE                                         CNKCS205
135300             ELSE                                                 CNKCS205
135400*                -- ONLY ONE END-OF-RANGE ALLOWED --              CNKCS205
135500                 MOVE PC-TSYMSG-00055                             CNKCS205
135600                                   TO DP020-MSG-NUMBER            CNKCS205
135700                 SET DP020-MSG-FATAL                              CNKCS205
135800                                   TO TRUE                        CNKCS205
135900                 MOVE -1           TO MR-SELECTL (PV-SUB)         CNKCS205
136000                 SET DP030-SET-CURSOR-APPL-1                      CNKCS205
136100                                   TO TRUE                        CNKCS205
136200                 SET PS-ERROR      TO TRUE                        CNKCS205
136300             END-IF                                               CNKCS205
136400         END-IF                                                   CNKCS205
136500     END-IF.                                                      CNKCS205
136600                                                                  CNKCS205
136700*----------------------------------------------------------------*CNKCS205
136800*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *CNKCS205
136900*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *CNKCS205
137000*----------------------------------------------------------------*CNKCS205
137100 3400-CHECK-RANGE-SEQUENCE.                                       CNKCS205
137200                                                                  CNKCS205
137300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       CNKCS205
137400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      CNKCS205
137500       AND  ASC-START-OF-SELECTED-RANGE >                         CNKCS205
137600                                         ASC-END-OF-SELECTED-RANGECNKCS205
137700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                CNKCS205
137800         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            CNKCS205
137900         SET DP020-MSG-FATAL       TO TRUE                        CNKCS205
138000         SET PS-ERROR              TO TRUE                        CNKCS205
138100         PERFORM 3410-POSITION-AT-ERROR                           CNKCS205
138200     END-IF.                                                      CNKCS205
138300                                                                  CNKCS205
138400*----------------------------------------------------------------*CNKCS205
138500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *CNKCS205
138600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *CNKCS205
138700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *CNKCS205
138800*----------------------------------------------------------------*CNKCS205
138900 3410-POSITION-AT-ERROR.                                          CNKCS205
139000                                                                  CNKCS205
139100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       CNKCS205
139200                                                                  CNKCS205
139300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 CNKCS205
139400                    - PV-TOP-ITEM + 1.                            CNKCS205
139500                                                                  CNKCS205
139600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS205
139700         CONTINUE                                                 CNKCS205
139800     ELSE                                                         CNKCS205
139900         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS205
140000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS205
140100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         CNKCS205
140200     END-IF.                                                      CNKCS205
140300                                                                  CNKCS205
140400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   CNKCS205
140500                    - PV-TOP-ITEM + 1.                            CNKCS205
140600                                                                  CNKCS205
140700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS205
140800         CONTINUE                                                 CNKCS205
140900     ELSE                                                         CNKCS205
141000         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS205
141100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS205
141200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         CNKCS205
141300     END-IF.                                                      CNKCS205
141400                                                                  CNKCS205
141500/                                                                 CNKCS205
141600*----------------------------------------------------------------*CNKCS205
141700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *CNKCS205
141800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *CNKCS205
141900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *CNKCS205
142000*----------------------------------------------------------------*CNKCS205
142100                                                                  CNKCS205
142200 3500-MARK-RANGE-AS-SELECTED.                                     CNKCS205
142300                                                                  CNKCS205
142400     MOVE +1                       TO ASC-BLK-SUB.                CNKCS205
142500                                                                  CNKCS205
142600     PERFORM 3510-MARK-SELECTED-INDS                              CNKCS205
142700         VARYING ASC-ITEM-SUB                                     CNKCS205
142800         FROM 1 BY 1                                              CNKCS205
142900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS205
143000                                                                  CNKCS205
143100     ADD +1                        TO ASC-BLK-SUB.                CNKCS205
143200                                                                  CNKCS205
143300     PERFORM 3510-MARK-SELECTED-INDS                              CNKCS205
143400         VARYING ASC-ITEM-SUB                                     CNKCS205
143500         FROM 1 BY 1                                              CNKCS205
143600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 CNKCS205
143700                                                                  CNKCS205
143800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               CNKCS205
143900                                   TO PV-LIST-ITEM-NUMBER.        CNKCS205
144000                                                                  CNKCS205
144100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            CNKCS205
144200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         CNKCS205
144300               PC-ITEMS-PER-PANEL).                               CNKCS205
144400                                                                  CNKCS205
144500     MOVE ASC-START-OF-SELECTED-RANGE                             CNKCS205
144600                                   TO PV-START-OF-SELECTED-RANGE. CNKCS205
144700                                                                  CNKCS205
144800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            CNKCS205
144900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  CNKCS205
145000               PC-ITEMS-PER-PANEL).                               CNKCS205
145100                                                                  CNKCS205
145200     MOVE ASC-END-OF-SELECTED-RANGE                               CNKCS205
145300                                   TO PV-END-OF-SELECTED-RANGE.   CNKCS205
145400                                                                  CNKCS205
145500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             CNKCS205
145600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    CNKCS205
145700               PC-ITEMS-PER-PANEL).                               CNKCS205
145800                                                                  CNKCS205
145900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             CNKCS205
146000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             CNKCS205
146100                                                                  CNKCS205
146200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    CNKCS205
146300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        CNKCS205
146400         MOVE +1                   TO ASC-BLK-SUB                 CNKCS205
146500         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS205
146600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         CNKCS205
146700             PV-FIRST-BLOCK-IN-ARRAY - 1                          CNKCS205
146800                                                                  CNKCS205
146900         PERFORM                                                  CNKCS205
147000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      CNKCS205
147100                   PV-PREV-BLOCK-IN-ARRAY                         CNKCS205
147200             MOVE PV-FIRST-BLOCK-IN-RANGE                         CNKCS205
147300                                   TO PV-BLOCK-NUMBER             CNKCS205
147400             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
147500             PERFORM 3510-MARK-SELECTED-INDS                      CNKCS205
147600                 VARYING ASC-ITEM-SUB                             CNKCS205
147700                 FROM 1 BY 1                                      CNKCS205
147800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS205
147900             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
148000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     CNKCS205
148100         END-PERFORM                                              CNKCS205
148200                                                                  CNKCS205
148300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         CNKCS205
148400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     CNKCS205
148500         PERFORM                                                  CNKCS205
148600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       CNKCS205
148700                   PV-LAST-BLOCK-IN-RANGE                         CNKCS205
148800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          CNKCS205
148900                                   TO PV-BLOCK-NUMBER             CNKCS205
149000             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
149100             PERFORM 3510-MARK-SELECTED-INDS                      CNKCS205
149200                 VARYING ASC-ITEM-SUB                             CNKCS205
149300                 FROM 1 BY 1                                      CNKCS205
149400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          CNKCS205
149500             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
149600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      CNKCS205
149700         END-PERFORM                                              CNKCS205
149800                                                                  CNKCS205
149900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             CNKCS205
150000                                   TO PV-BLOCK-NUMBER             CNKCS205
150100         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS205
150200     END-IF.                                                      CNKCS205
150300                                                                  CNKCS205
150400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE CNKCS205
150500                                      ASC-END-OF-SELECTED-RANGE.  CNKCS205
150600                                                                  CNKCS205
150700/                                                                 CNKCS205
150800*----------------------------------------------------------------*CNKCS205
150900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *CNKCS205
151000*----------------------------------------------------------------*CNKCS205
151100                                                                  CNKCS205
151200 3510-MARK-SELECTED-INDS.                                         CNKCS205
151300                                                                  CNKCS205
151400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         CNKCS205
151500         ASC-START-OF-SELECTED-RANGE)                             CNKCS205
151600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         CNKCS205
151700         ASC-START-OF-SELECTED-RANGE)                             CNKCS205
151800                                                                  CNKCS205
151900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     CNKCS205
152000             ASC-END-OF-SELECTED-RANGE)                           CNKCS205
152100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     CNKCS205
152200             ASC-END-OF-SELECTED-RANGE)                           CNKCS205
152300                                                                  CNKCS205
152400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          CNKCS205
152500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   CNKCS205
152600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   CNKCS205
152700                                   TO TRUE                        CNKCS205
152800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              CNKCS205
152900                                   TO TRUE                        CNKCS205
153000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS205
153100             END-IF                                               CNKCS205
153200         END-IF                                                   CNKCS205
153300     END-IF.                                                      CNKCS205
153400                                                                  CNKCS205
153500/                                                                 CNKCS205
153600*----------------------------------------------------------------*CNKCS205
153700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *CNKCS205
153800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *CNKCS205
153900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *CNKCS205
154000*    DISPLAY THE PANEL TO USER.                                  *CNKCS205
154100*----------------------------------------------------------------*CNKCS205
154200                                                                  CNKCS205
154300 4000-BUILD-INITIAL-PANEL.                                        CNKCS205
154400                                                                  CNKCS205
154500     INITIALIZE ASC-BLOCK-ENTRIES (1)                             CNKCS205
154600                ASC-BLOCK-ENTRIES (2).                            CNKCS205
154700                                                                  CNKCS205
154800     MOVE +1                       TO ASC-BLK-SUB.                CNKCS205
154900                                                                  CNKCS205
155000     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       CNKCS205
155100                                                                  CNKCS205
155200     MOVE +0                       TO ASC-ITEM-SUB                CNKCS205
155300                                      ASC-NUMBER-OF-ITEMS-READ    CNKCS205
155400                                      ASC-NUMBER-OF-SELECTED-ITEMSCNKCS205
155500                                      ASC-HIGHEST-BLOCK-WRITTEN   CNKCS205
155600                                      ASC-START-OF-SELECTED-RANGE CNKCS205
155700                                      ASC-END-OF-SELECTED-RANGE   CNKCS205
155800                                      ASC-ITEM-AT-TOP-OF-PANEL.   CNKCS205
155900                                                                  CNKCS205
156000     PERFORM 4100-PREPARE-CURSOR.                                 CNKCS205
156100                                                                  CNKCS205
156200     PERFORM 4010-OPEN-CURSOR.                                    CNKCS205
156300                                                                  CNKCS205
156400     PERFORM 4300-READ-ITEMS-FROM-DB.                             CNKCS205
156500                                                                  CNKCS205
156600     PERFORM 4020-CLOSE-CURSOR.                                   CNKCS205
156700                                                                  CNKCS205
156800     MOVE +1                       TO PV-TOP-ITEM.                CNKCS205
156900                                                                  CNKCS205
157000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          CNKCS205
157100         SET DP020-NEXT-ACT-APPL-ERROR                            CNKCS205
157200                                   TO TRUE                        CNKCS205
157300         SET DP020-MSG-FATAL       TO TRUE                        CNKCS205
157400         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            CNKCS205
157500     ELSE                                                         CNKCS205
157600         MOVE -1                   TO MR-SELECTL (1)              CNKCS205
157700         SET DP030-SET-CURSOR-APPL-1                              CNKCS205
157800                                   TO TRUE                        CNKCS205
157900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     CNKCS205
158000     END-IF.                                                      CNKCS205
158100                                                                  CNKCS205
158200/                                                                 CNKCS205
158300*----------------------------------------------------------------*CNKCS205
158400* OPEN THE DEPT/CLASS CURSOR                                     *CNKCS205
158500*----------------------------------------------------------------*CNKCS205
158600                                                                  CNKCS205
158700 4010-OPEN-CURSOR.                                                CNKCS205
158800                                                                  CNKCS205
158900     PERFORM                                                      CNKCS205
159000         WITH TEST AFTER                                          CNKCS205
159100         VARYING PV-RETRY-COUNTER                                 CNKCS205
159200         FROM 1 BY 1                                              CNKCS205
159300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS205
159400            OR (SQLCODE = +0))                                    CNKCS205
159500                                                                  CNKCS205
159600         EXEC SQL                                                 CNKCS205
159700             OPEN DEPT-CL-NBR-CSR                                    CL**3
159800         END-EXEC                                                 CNKCS205
159900                                                                  CNKCS205
160000         EVALUATE TRUE                                            CNKCS205
160100             WHEN SQLCODE = +0                                    CNKCS205
160200                  CONTINUE                                        CNKCS205
160300             WHEN SQLCODE = -904                                  CNKCS205
160400             WHEN SQLCODE = -913                                  CNKCS205
160500                  CONTINUE                                        CNKCS205
160600             WHEN SQLWARN0 NOT = SPACE                            CNKCS205
160700             WHEN SQLCODE  NOT = +0                               CNKCS205
160800                  MOVE '4010-OPEN-CURSOR'                         CNKCS205
160900                                   TO DP013-PARAGRAPH             CNKCS205
161000                  MOVE 'OPEN DEPT-CL-NBR-CSR CURSOR'                 CL**3
161100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
161200                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS205
161300                  MOVE 'TTCTKAS'   TO DP013-DB2-TABLE-NAME (1)    CNKCS205
161400                  SET DP013-DB2-ABEND                             CNKCS205
161500                                   TO TRUE                        CNKCS205
161600                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS205
161700         END-EVALUATE                                             CNKCS205
161800     END-PERFORM.                                                 CNKCS205
161900                                                                  CNKCS205
162000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS205
162100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             CNKCS205
162200         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              CNKCS205
162300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
162400         MOVE SQLCA                TO DP013-SQLCA                 CNKCS205
162500         SET DP013-DB2-ABEND       TO TRUE                        CNKCS205
162600         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
162700     END-IF.                                                      CNKCS205
162800                                                                  CNKCS205
162900/                                                                 CNKCS205
163000*----------------------------------------------------------------*CNKCS205
163100* CLOSE THE DEPT-CL-NBR CURSOR                                   *   CL**3
163200*----------------------------------------------------------------*CNKCS205
163300                                                                  CNKCS205
163400 4020-CLOSE-CURSOR.                                               CNKCS205
163500                                                                  CNKCS205
163600     EXEC SQL                                                     CNKCS205
163700         CLOSE DEPT-CL-NBR-CSR                                       CL**3
163800     END-EXEC.                                                    CNKCS205
163900                                                                  CNKCS205
164000     EVALUATE TRUE                                                CNKCS205
164100         WHEN SQLCODE = +0                                        CNKCS205
164200              CONTINUE                                            CNKCS205
164300         WHEN SQLWARN0 NOT = SPACE                                CNKCS205
164400         WHEN SQLCODE  NOT = +0                                   CNKCS205
164500              MOVE '4020-CLOSE-CURSOR'                            CNKCS205
164600                                   TO DP013-PARAGRAPH             CNKCS205
164700              MOVE 'CLOSE DEPT-CL-NBR-CSR CURSOR'                    CL**3
164800                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
164900              MOVE SQLCA           TO DP013-SQLCA                 CNKCS205
165000              MOVE 'TDCTFAS'       TO DP013-DB2-TABLE-NAME (1)       CL**8
165100              SET DP013-DB2-ABEND  TO TRUE                        CNKCS205
165200              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS205
165300     END-EVALUATE.                                                CNKCS205
165400                                                                  CNKCS205
165500/                                                                 CNKCS205
165600*----------------------------------------------------------------*CNKCS205
165700*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *CNKCS205
165800*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *CNKCS205
165900*----------------------------------------------------------------*CNKCS205
166000                                                                  CNKCS205
166100 4100-PREPARE-CURSOR.                                             CNKCS205
166200                                                                  CNKCS205
166300     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           CNKCS205
166400        IF CN001-FCLTY-ID > ZEROES                                   CL**5
166500           MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID-LOW             CL**5
166600                                         DK-FCLTY-ID-HIGH            CL**5
166700                                         DK-FCLTY-ID                 CL**5
166800        ELSE                                                         CL**5
166900           MOVE ZEROES                TO DK-FCLTY-ID-LOW             CL**5
167000                                         DK-FCLTY-ID                 CL**5
167100           MOVE 9999                  TO DK-FCLTY-ID-HIGH            CL**5
167200        END-IF                                                       CL**5
167300        IF CN001-DEPT-NBR > SPACES                                   CL**3
167400           MOVE CN001-DEPT-NBR        TO DK-DEPT-NBR-LOW             CL**3
167500                                         DK-DEPT-NBR-HIGH            CL**3
167600        ELSE                                                      CNKCS205
167700           MOVE SPACES                TO DK-DEPT-NBR-LOW             CL**3
167800           MOVE '999'                 TO DK-DEPT-NBR-HIGH            CL**3
167900        END-IF                                                    CNKCS205
168000        IF CN001-TKT-FMT-ID > SPACES                                 CL**3
168100           MOVE CN001-TKT-FMT-ID      TO DK-TKT-FMT-ID-LOW           CL**3
168200                                         DK-TKT-FMT-ID-HIGH          CL**3
168300        ELSE                                                      CNKCS205
168400           IF CN001-SEL-UNASSIGNED = 'Y'                          CNKCS205
168500              MOVE '######'           TO DK-TKT-FMT-ID-LOW           CL**3
168600                                         DK-TKT-FMT-ID-HIGH          CL**3
168700           ELSE                                                   CNKCS205
168800              MOVE SPACES             TO DK-TKT-FMT-ID-LOW           CL**3
168900              MOVE '999999'           TO DK-TKT-FMT-ID-HIGH          CL**3
169000           END-IF                                                 CNKCS205
169100        END-IF                                                    CNKCS205
169200     ELSE                                                         CNKCS205
169300        IF ASC-KEY-FCLTY-ID-LOW > ZEROES                             CL**5
169400           MOVE ASC-KEY-FCLTY-ID-LOW  TO DK-FCLTY-ID-LOW             CL**5
169500        ELSE                                                         CL**5
169600           MOVE ZEROES                TO DK-FCLTY-ID-LOW             CL**5
169700        END-IF                                                       CL**5
169800        IF ASC-KEY-FCLTY-ID-HIGH > ZEROES                            CL**5
169900           MOVE ASC-KEY-FCLTY-ID-HIGH TO DK-FCLTY-ID-HIGH            CL**5
170000        ELSE                                                         CL**5
170100           MOVE 9999                  TO DK-FCLTY-ID-HIGH            CL**5
170200        END-IF                                                       CL**5
170300        IF ASC-KEY-DEPT-NBR-LOW > SPACES                             CL**3
170400           MOVE ASC-KEY-DEPT-NBR-LOW  TO DK-DEPT-NBR-LOW             CL**3
170500        ELSE                                                      CNKCS205
170600           MOVE SPACES                TO DK-DEPT-NBR-LOW             CL**3
170700        END-IF                                                    CNKCS205
170800        IF ASC-KEY-DEPT-NBR-HIGH > SPACES                            CL**3
170900           MOVE ASC-KEY-DEPT-NBR-HIGH TO DK-DEPT-NBR-HIGH            CL**3
171000        ELSE                                                      CNKCS205
171100           MOVE '999'                 TO DK-DEPT-NBR-HIGH            CL**3
171200        END-IF                                                    CNKCS205
171300        IF ASC-KEY-TKT-FMT-ID-LOW > SPACES                           CL**3
171400           MOVE ASC-KEY-TKT-FMT-ID-LOW TO DK-TKT-FMT-ID-LOW          CL**3
171500        ELSE                                                      CNKCS205
171600           MOVE SPACES                 TO DK-TKT-FMT-ID-LOW          CL**3
171700        END-IF                                                    CNKCS205
171800        IF ASC-KEY-TKT-FMT-ID-HIGH > SPACES                          CL**3
171900           MOVE ASC-KEY-TKT-FMT-ID-HIGH TO DK-TKT-FMT-ID-HIGH        CL**3
172000        ELSE                                                      CNKCS205
172100           MOVE '999999'                TO DK-TKT-FMT-ID-HIGH        CL**3
172200        END-IF                                                    CNKCS205
172300     END-IF.                                                      CNKCS205
172400                                                                  CNKCS205
172500/                                                                 CNKCS205
172600*----------------------------------------------------------------*CNKCS205
172700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *CNKCS205
172800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *CNKCS205
172900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *CNKCS205
173000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *CNKCS205
173100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *CNKCS205
173200*                                                                *CNKCS205
173300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *CNKCS205
173400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *CNKCS205
173500*    UPON INITIALIZATION.                                        *CNKCS205
173600*----------------------------------------------------------------*CNKCS205
173700                                                                  CNKCS205
173800 4300-READ-ITEMS-FROM-DB.                                         CNKCS205
173900                                                                  CNKCS205
174000     PERFORM 4320-GET-STORE-INFORMATION.                             CL**3
174100                                                                  CNKCS205
174200     PERFORM                                                      CNKCS205
174300         VARYING PV-READ-COUNT                                    CNKCS205
174400         FROM 1 BY 1                                              CNKCS205
174500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    CNKCS205
174600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         CNKCS205
174700                                                                  CNKCS205
174800         PERFORM 4310-FETCH                                       CNKCS205
174900                                                                  CNKCS205
175000         IF  ASC-ITEMS-LEFT-ON-DB                                 CNKCS205
175100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                CNKCS205
175200                 ADD +1            TO ASC-ITEM-SUB                CNKCS205
175300             ELSE                                                 CNKCS205
175400                 ADD +1            TO ASC-BLK-SUB                 CNKCS205
175500                 MOVE +1           TO ASC-ITEM-SUB                CNKCS205
175600                                                                  CNKCS205
175700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         CNKCS205
175800                     MOVE +1       TO ASC-BLK-SUB                 CNKCS205
175900                     SET ASC-BLOCK-MODIFIED (1)                   CNKCS205
176000                                   TO TRUE                        CNKCS205
176100                     PERFORM 5100-WRITE-TEMP-STORAGE              CNKCS205
176200                     MOVE ASC-BLOCK-ENTRIES                       CNKCS205
176300                               (PC-MAX-BLOCKS-IN-ARRAY)           CNKCS205
176400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) CNKCS205
176500                     ADD +1        TO ASC-BLK-SUB                 CNKCS205
176600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   CNKCS205
176700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      CNKCS205
176800                                   TO TRUE                        CNKCS205
176900                 END-IF                                           CNKCS205
177000             END-IF                                               CNKCS205
177100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    CNKCS205
177200             MOVE ASC-NUMBER-OF-ITEMS-READ                        CNKCS205
177300                                   TO ASC-LIST-ITEM-NUMBER        CNKCS205
177400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  CNKCS205
177500             MOVE DCTFAS-FCLTY-ID  TO ASC-FCLTY-ID                   CL**8
177600                                       (ASC-BLK-SUB ASC-ITEM-SUB)    CL**5
177700             MOVE DCTFAS-DEPT-NBR  TO ASC-DEPT-NBR                   CL**8
177800                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
177900             MOVE DCTFAS-CL-NBR    TO ASC-CL-NBR                     CL**8
178000                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
178100             MOVE DCTFAS-RANK-NBR  TO ASC-RANK                       CL**8
178200                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
178300             IF DN-TKT-FMT-ID = -1                                   CL**3
178400                MOVE SPACES        TO ASC-FORMAT                  CNKCS205
178500                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
178600                                      ASC-DESC                    CNKCS205
178700                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
178800             ELSE                                                 CNKCS205
178900                MOVE DCTFAS-TKT-FMT-ID                               CL**8
179000                                   TO ASC-FORMAT                  CNKCS205
179100                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
179200                PERFORM 4330-SELECT-TTKTFMT                          CL**8
179300                MOVE TKTFMT-TKT-FMT-DESC                             CL**8
179400                                   TO ASC-DESC                    CNKCS205
179500                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
179600             END-IF                                               CNKCS205
179700         END-IF                                                   CNKCS205
179800         MOVE ASC-KEY-OPER-UNT-ID   TO ASC-OPER-UNT-ID               CL**3
179900                                       (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
180000     END-PERFORM.                                                 CNKCS205
180100                                                                  CNKCS205
180200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          CNKCS205
180300         MOVE +1                   TO ASC-BLK-SUB                 CNKCS205
180400         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS205
180500         ADD +1                    TO ASC-BLK-SUB                 CNKCS205
180600         PERFORM 5100-WRITE-TEMP-STORAGE                          CNKCS205
180700                                                                  CNKCS205
180800         MOVE 1                    TO ASC-BLK-SUB                 CNKCS205
180900                                      PV-BLOCK-NUMBER             CNKCS205
181000         PERFORM 4410-READ-TEMP-STORAGE                           CNKCS205
181100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             CNKCS205
181200             MOVE 2                TO ASC-BLK-SUB                 CNKCS205
181300                                      PV-BLOCK-NUMBER             CNKCS205
181400             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
181500         END-IF                                                   CNKCS205
181600     END-IF.                                                      CNKCS205
181700                                                                  CNKCS205
181800/                                                                 CNKCS205
181900*----------------------------------------------------------------*CNKCS205
182000*    FETCH A DEPT/CLASS ROW                                      *CNKCS205
182100*----------------------------------------------------------------*CNKCS205
182200                                                                  CNKCS205
182300 4310-FETCH.                                                      CNKCS205
182400                                                                  CNKCS205
182500     EXEC SQL                                                     CNKCS205
182600         FETCH DEPT-CL-NBR-CSR                                       CL**3
182700          INTO :DCTFAS-OPER-UNT-ID                                   CL**8
182800              ,:DCTFAS-FCLTY-ID                                      CL**8
182900              ,:DCTFAS-DEPT-NBR                                      CL**8
183000              ,:DCTFAS-CL-NBR                                        CL**8
183100              ,:DCTFAS-RANK-NBR                                      CL**8
183200              ,:DCTFAS-TKT-FMT-ID                                    CL**8
183300                 :DN-TKT-FMT-ID                                      CL**3
183400     END-EXEC.                                                    CNKCS205
183500                                                                  CNKCS205
183600     EVALUATE TRUE                                                CNKCS205
183700         WHEN SQLCODE = +0                                        CNKCS205
183800              CONTINUE                                            CNKCS205
183900         WHEN SQLCODE = +100                                      CNKCS205
184000              SET ASC-NO-ITEMS-LEFT-ON-DB                         CNKCS205
184100                                   TO TRUE                        CNKCS205
184200         WHEN SQLWARN0 NOT = SPACE                                CNKCS205
184300         WHEN SQLCODE < +0                                        CNKCS205
184400         WHEN SQLCODE > +0                                        CNKCS205
184500              MOVE '4310-FETCH-CURSOR'                            CNKCS205
184600                                   TO DP013-PARAGRAPH             CNKCS205
184700              MOVE 'FETCH MESSAGE CURSOR'                         CNKCS205
184800                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
184900              MOVE SQLCA           TO DP013-SQLCA                 CNKCS205
185000              MOVE 'TDCTFAS'       TO DP013-DB2-TABLE-NAME (1)       CL**8
185100              SET DP013-DB2-ABEND  TO TRUE                        CNKCS205
185200              PERFORM DP013-0000-PROCESS-ABEND                    CNKCS205
185300     END-EVALUATE.                                                CNKCS205
185400                                                                  CNKCS205
185500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS205
185600         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             CNKCS205
185700         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             CNKCS205
185800                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
185900         MOVE SQLCA                TO DP013-SQLCA                 CNKCS205
186000         SET DP013-DB2-ABEND                                      CNKCS205
186100             DP013-XCTL-DISPLAY-RESTART                           CNKCS205
186200                                   TO TRUE                        CNKCS205
186300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
186400     END-IF.                                                      CNKCS205
186500                                                                  CNKCS205
186600/                                                                 CNKCS205
186700                                                                  18470003
186800****************************************************************  18480003
186900*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  18490003
187000*                                                              *  18500003
187100****************************************************************  18510003
187200                                                                  18520003
187300 4320-GET-STORE-INFORMATION.                                      18530003
187400                                                                  18540003
187500     INITIALIZE XL071-COMMAREA.                                   18550003
187600     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                18560003
187700                                                                  18570003
187800     CALL XL071-LOCATION-MODULE USING                             18580003
187900                                DFHEIBLK                          18590003
188000                                XL071-COMMAREA                    18600003
188100                                XL071-COMMAREA-REC.               18610003
188200                                                                  18620003
188300     EVALUATE TRUE                                                18630003
188400         WHEN XL071-NO-ERRORS                                     18640003
188500         WHEN XL071-DC-ASGMT-NOT-FND                              18650003
188600              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  18660003
188700                                                                  18670003
188800         WHEN XL071-LOC-NOT-FOUND                                 18680003
188900              MOVE SPACES       TO ASC-FCLTY-NME                  18690003
189000                                                                  18700003
189100         WHEN OTHER                                               18710003
189200              MOVE '4320-GET-STORE-INFORMATION'                   18720003
189300                                  TO DP013-PARAGRAPH              18730003
189310              STRING 'SELECT STORE NUMBER - '                             
189320                      XL071-LOCATION-NUMBER                               
189330                     ' - BAD RETURN CODE FROM XLKUT071 - '                
189340                      XL071-RETURN-CODE                                   
189350                      DELIMITED BY SIZE                                   
189360                      INTO DP013-MESSAGE-TEXT (1)                         
189370              STRING 'BAD SQLCODE - '                                     
189380                      XL071-SQLCODE                                       
189390                     ' - '                                                
189391                      XL071-DB2-TABLE                                     
189392                      DELIMITED BY SIZE                                   
189393                      INTO DP013-MESSAGE-TEXT (2)                         
189394              MOVE XL071-SQLCA     TO DP013-SQLCA                         
189395              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)            
190000              MOVE XL071-SQLCODE TO SQLCODE                       18800003
190300              SET DP013-DB2-ABEND                                 18830003
190400                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18840003
190500              PERFORM DP013-0000-PROCESS-ABEND                    18850003
190600                                                                  18860003
190700     END-EVALUATE.                                                18870003
190800                                                                  CNKCS205
190900/                                                                 CNKCS205
191000*----------------------------------------------------------------*CNKCS205
191100*    READ TICKET FORMAT TABLE                                    *CNKCS205
191200*----------------------------------------------------------------*CNKCS205
191300                                                                  CNKCS205
191400 4330-SELECT-TTKTFMT.                                                CL**8
191500                                                                  CNKCS205
191600     PERFORM                                                      CNKCS205
191700         WITH TEST AFTER                                          CNKCS205
191800         VARYING PV-RETRY-COUNTER                                 CNKCS205
191900         FROM 1 BY 1                                              CNKCS205
192000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS205
192100            OR  (SQLCODE = +0))                                   CNKCS205
192200                                                                  CNKCS205
192300         EXEC SQL                                                 CNKCS205
192400             SELECT TKT_FMT_DESC                                     CL**3
192500              INTO :TKTFMT-TKT-FMT-DESC                              CL**8
192600              FROM TTKTFMT                                           CL**8
192700             WHERE OPER_UNT_ID = :DCTFAS-OPER-UNT-ID                 CL**8
192800               AND FCLTY_ID    = :DCTFAS-FCLTY-ID                    CL**8
192900               AND TKT_FMT_ID  = :DCTFAS-TKT-FMT-ID                  CL**8
193000         END-EXEC                                                 CNKCS205
193100                                                                  CNKCS205
193200         EVALUATE TRUE                                            CNKCS205
193300             WHEN SQLCODE = +0                                    CNKCS205
193400             WHEN SQLCODE = -904                                  CNKCS205
193500             WHEN SQLCODE = -913                                  CNKCS205
193600                  CONTINUE                                        CNKCS205
193700             WHEN SQLWARN0 NOT = SPACE                            CNKCS205
193800             WHEN SQLCODE < +0                                    CNKCS205
193900             WHEN SQLCODE > +0                                    CNKCS205
194000                  MOVE '4330-SELECT-TDCTFAS'                         CL**8
194100                                   TO DP013-PARAGRAPH             CNKCS205
194200                  MOVE 'SELECT ON TDCTFAS'                           CL**8
194300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
194400                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS205
194500                  MOVE 'TDCTFAS'   TO DP013-DB2-TABLE-NAME (1)       CL**8
194600                  SET DP013-DB2-ABEND                             CNKCS205
194700                      DP013-XCTL-DISPLAY-RESTART                  CNKCS205
194800                                   TO TRUE                        CNKCS205
194900                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS205
195000         END-EVALUATE                                             CNKCS205
195100     END-PERFORM.                                                 CNKCS205
195200                                                                  CNKCS205
195300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS205
195400         MOVE '4330-SELECT-TDCTFAS'                                  CL**8
195500                                   TO DP013-PARAGRAPH             CNKCS205
195600         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   CNKCS205
195700                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
195800         MOVE 'ON TABLE TDCTFAS '  TO DP013-MESSAGE-TEXT (2)         CL**8
195900         MOVE SQLCA                TO DP013-SQLCA                 CNKCS205
196000         SET DP013-DB2-ABEND                                      CNKCS205
196100             DP013-XCTL-DISPLAY-RESTART                           CNKCS205
196200                                   TO TRUE                        CNKCS205
196300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
196400     END-IF.                                                      CNKCS205
196500                                                                  CNKCS205
196600/                                                                 CNKCS205
196700*----------------------------------------------------------------*CNKCS205
196800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *CNKCS205
196900*----------------------------------------------------------------*CNKCS205
197000                                                                  CNKCS205
197100 4400-MOVE-COMMAREA-TO-SCREEN.                                    CNKCS205
197200                                                                  CNKCS205
197300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             CNKCS205
197400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          CNKCS205
197500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          CNKCS205
197600             MOVE +1               TO ASC-BLK-SUB                 CNKCS205
197700             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
197800             ADD +1                TO ASC-BLK-SUB                 CNKCS205
197900             PERFORM 5100-WRITE-TEMP-STORAGE                      CNKCS205
198000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             CNKCS205
198100                 GIVING PV-BLOCK-NUMBER                           CNKCS205
198200                 REMAINDER PV-REMAINDER                           CNKCS205
198300             IF  PV-REMAINDER > ZERO                              CNKCS205
198400                 ADD +1            TO PV-BLOCK-NUMBER             CNKCS205
198500             END-IF                                               CNKCS205
198600             MOVE +1               TO ASC-BLK-SUB                 CNKCS205
198700             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
198800             ADD +1                TO ASC-BLK-SUB                 CNKCS205
198900                                      PV-BLOCK-NUMBER             CNKCS205
199000             PERFORM 4410-READ-TEMP-STORAGE                       CNKCS205
199100     END-IF.                                                      CNKCS205
199200                                                                  CNKCS205
199300     MOVE +1                       TO ASC-BLK-SUB.                CNKCS205
199400                                                                  CNKCS205
199500     COMPUTE ASC-ITEM-SUB =                                       CNKCS205
199600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              CNKCS205
199700         + PC-ITEMS-PER-PANEL).                                   CNKCS205
199800                                                                  CNKCS205
199900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        CNKCS205
200000         ADD +1                    TO ASC-BLK-SUB                 CNKCS205
200100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            CNKCS205
200200     END-IF.                                                      CNKCS205
200300                                                                  CNKCS205
200400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           CNKCS205
200500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                CNKCS205
200600                                                                  CNKCS205
200700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        CNKCS205
200800     PERFORM 4420-FORMAT-LIST-LINES                               CNKCS205
200900         VARYING PV-SUB                                           CNKCS205
201000         FROM PC-ITEMS-PER-PANEL BY -1                            CNKCS205
201100         UNTIL PV-SUB < +1.                                       CNKCS205
201200                                                                  CNKCS205
201300     COMPUTE ASC-ITEMS-DISPLAYED =                                CNKCS205
201400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          CNKCS205
201500                                                                  CNKCS205
201600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    CNKCS205
201700                                      ASTRTITO.                   CNKCS205
201800                                                                  CNKCS205
201900     MOVE ASC-KEY-OPER-UNT-ID      TO MR-OPER.                       CL**3
202000     MOVE ASC-KEY-FCLTY-ID         TO MR-FCLTY.                      CL**3
202100     MOVE ASC-FCLTY-NME            TO MR-FDESC.                      CL**3
202200                                                                  CNKCS205
202300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    CNKCS205
202400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    CNKCS205
202500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            CNKCS205
202600                                   TO ASELITO.                    CNKCS205
202700                                                                  CNKCS205
202800     IF  DP020-MSG-NUMBER-X = SPACE                               CNKCS205
202900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  CNKCS205
203000*            --- MORE ITEMS TO DISPLAY ----                       CNKCS205
203100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            CNKCS205
203200             SET DP020-MSG-INFORMATIONAL                          CNKCS205
203300                                   TO TRUE                        CNKCS205
203400         END-IF                                                   CNKCS205
203500     END-IF.                                                      CNKCS205
203600                                                                  CNKCS205
203700*----------------------------------------------------------------*CNKCS205
203800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *CNKCS205
203900*----------------------------------------------------------------*CNKCS205
204000                                                                  CNKCS205
204100 4410-READ-TEMP-STORAGE.                                          CNKCS205
204200                                                                  CNKCS205
204300     EXEC CICS                                                    CNKCS205
204400         READQ TS                                                 CNKCS205
204500             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS205
204600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS205
204700             ITEM  (PV-BLOCK-NUMBER)                              CNKCS205
204800             RESP  (PV-CICS-RESP)                                 CNKCS205
204900     END-EXEC.                                                    CNKCS205
205000                                                                  CNKCS205
205100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       CNKCS205
205200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     CNKCS205
205300         CONTINUE                                                 CNKCS205
205400     ELSE                                                         CNKCS205
205500         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
205600         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
205700         MOVE '4410-READ-TEMP-STORAGE'                            CNKCS205
205800                                   TO DP013-PARAGRAPH             CNKCS205
205900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      CNKCS205
206000                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
206100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
206200     END-IF.                                                      CNKCS205
206300                                                                  CNKCS205
206400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      CNKCS205
206500                                   TO TRUE.                       CNKCS205
206600                                                                  CNKCS205
206700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         CNKCS205
206800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               CNKCS205
206900     END-IF.                                                      CNKCS205
207000                                                                  CNKCS205
207100/                                                                 CNKCS205
207200*----------------------------------------------------------------*CNKCS205
207300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *CNKCS205
207400*----------------------------------------------------------------*CNKCS205
207500                                                                  CNKCS205
207600 4420-FORMAT-LIST-LINES.                                          CNKCS205
207700                                                                  CNKCS205
207800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      CNKCS205
207900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                CNKCS205
208000         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         CNKCS205
208100         MOVE SPACES               TO MR-OPER                        CL**3
208200                                      MR-FCLTY                       CL**3
208300                                      MR-FDESC                    CNKCS205
208400         MOVE SPACE                TO MR-SELECT  (PV-SUB)         CNKCS205
208500                                      MR-ACTION  (PV-SUB)         CNKCS205
208600                                      MR-FCLTY-ID (PV-SUB)           CL**5
208700                                      MR-DEPT-NBR (PV-SUB)           CL**5
208800                                      MR-CL-NBR  (PV-SUB)            CL**3
208900                                      MR-RANK-X  (PV-SUB)         CNKCS205
209000                                      MR-FORMAT  (PV-SUB)         CNKCS205
209100                                      MR-DESC    (PV-SUB)         CNKCS205
209200     ELSE                                                         CNKCS205
209300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CNKCS205
209400                                                   > SPACE        CNKCS205
209500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) CNKCS205
209600                                   TO MR-SELECT (PV-SUB)          CNKCS205
209700         ELSE                                                     CNKCS205
209800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      CNKCS205
209900                                   TO MR-SELECT (PV-SUB)          CNKCS205
210000         END-IF                                                   CNKCS205
210100                                                                  CNKCS205
210200         IF  DP030-SET-CURSOR-TRAILER                             CNKCS205
210300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)CNKCS205
210400                 > SPACE)                                         CNKCS205
210500               OR (PV-SUB = 1))                                   CNKCS205
210600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               CNKCS205
210700                MOVE -1            TO MR-SELECTL (PV-SUB)         CNKCS205
210800             END-IF                                               CNKCS205
210900         END-IF                                                   CNKCS205
211000                                                                  CNKCS205
211100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           CNKCS205
211200             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS205
211300                                   TO MR-ACTION (PV-SUB)          CNKCS205
211400             MOVE ASC-FCLTY-ID (ASC-BLK-SUB ASC-ITEM-SUB)            CL**5
211500                                   TO MR-FCLTY-ID (PV-SUB)           CL**5
211600             MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            CL**5
211700                                   TO MR-DEPT-NBR (PV-SUB)           CL**5
211800             MOVE ASC-CL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)              CL**3
211900                                   TO MR-CL-NBR (PV-SUB)             CL**3
212000             MOVE ASC-RANK   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS205
212100                                   TO MR-RANK   (PV-SUB)          CNKCS205
212200             MOVE ASC-FORMAT (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS205
212300                                   TO MR-FORMAT (PV-SUB)          CNKCS205
212400             MOVE ASC-DESC   (ASC-BLK-SUB ASC-ITEM-SUB)           CNKCS205
212500                                   TO MR-DESC (PV-SUB)            CNKCS205
212600         END-IF                                                   CNKCS205
212700     END-IF.                                                      CNKCS205
212800                                                                  CNKCS205
212900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               CNKCS205
213000                                                                  CNKCS205
213100     IF  ASC-ITEM-SUB < + 1                                       CNKCS205
213200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                CNKCS205
213300         MOVE +1                   TO ASC-BLK-SUB                 CNKCS205
213400     END-IF.                                                      CNKCS205
213500                                                                  CNKCS205
213600*----------------------------------------------------------------*CNKCS205
213700*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *CNKCS205
213800*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *CNKCS205
213900*  ISSUE A WARNING.                                              *CNKCS205
214000*----------------------------------------------------------------*CNKCS205
214100 4430-CHECK-FOR-BEGIN-AND-END.                                    CNKCS205
214200                                                                  CNKCS205
214300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       CNKCS205
214400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     CNKCS205
214500*            -- NO END-OF-RANGE SPECFIED ---                      CNKCS205
214600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            CNKCS205
214700             SET DP020-MSG-WARNING TO TRUE                        CNKCS205
214800             PERFORM 4431-POSITION-AT-WARNING                     CNKCS205
214900         END-IF                                                   CNKCS205
215000     ELSE                                                         CNKCS205
215100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     CNKCS205
215200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                CNKCS205
215300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            CNKCS205
215400             SET DP020-MSG-WARNING TO TRUE                        CNKCS205
215500             PERFORM 4431-POSITION-AT-WARNING                     CNKCS205
215600         END-IF                                                   CNKCS205
215700     END-IF.                                                      CNKCS205
215800                                                                  CNKCS205
215900*----------------------------------------------------------------*CNKCS205
216000*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *CNKCS205
216100*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *CNKCS205
216200*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *CNKCS205
216300*  POSITION THE CURSOR THERE.                                    *CNKCS205
216400*----------------------------------------------------------------*CNKCS205
216500 4431-POSITION-AT-WARNING.                                        CNKCS205
216600                                                                  CNKCS205
216700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 CNKCS205
216800                    - PV-TOP-ITEM + 1.                            CNKCS205
216900                                                                  CNKCS205
217000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS205
217100         CONTINUE                                                 CNKCS205
217200     ELSE                                                         CNKCS205
217300         SET DP030-SET-CURSOR-APPL-1                              CNKCS205
217400                                   TO TRUE                        CNKCS205
217500         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS205
217600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS205
217700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         CNKCS205
217800     END-IF.                                                      CNKCS205
217900                                                                  CNKCS205
218000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   CNKCS205
218100                    - PV-TOP-ITEM + 1.                            CNKCS205
218200                                                                  CNKCS205
218300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      CNKCS205
218400         CONTINUE                                                 CNKCS205
218500     ELSE                                                         CNKCS205
218600         SET DP030-SET-CURSOR-APPL-1                              CNKCS205
218700                                   TO TRUE                        CNKCS205
218800         MOVE -1                   TO MR-SELECTL (PV-SUB)         CNKCS205
218900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         CNKCS205
219000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         CNKCS205
219100     END-IF.                                                      CNKCS205
219200                                                                  CNKCS205
219300/                                                                 CNKCS205
219400*----------------------------------------------------------------*CNKCS205
219500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *CNKCS205
219600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *CNKCS205
219700* FOR THE SELECTED ITEMS QUEUE.                                  *CNKCS205
219800*                                                                *CNKCS205
219900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *CNKCS205
220000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *CNKCS205
220100* THE ARRAY IS FULL.                                             *CNKCS205
220200*----------------------------------------------------------------*CNKCS205
220300                                                                  CNKCS205
220400 5000-PREPARE-SEL-QUEUE.                                          CNKCS205
220500                                                                  CNKCS205
220600     MOVE +1                       TO ASC-BLK-SUB.                CNKCS205
220700     PERFORM 5100-WRITE-TEMP-STORAGE.                             CNKCS205
220800     ADD +1                        TO ASC-BLK-SUB.                CNKCS205
220900     PERFORM 5100-WRITE-TEMP-STORAGE.                             CNKCS205
221000                                                                  CNKCS205
221100     MOVE ASC-SEL-QUEUE-NAME       TO CN003-SEL-QUEUE-NAME.       CNKCS205
221200     PERFORM 6010-DELETE-SEL-QUEUE.                               CNKCS205
221300                                                                  CNKCS205
221400     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      CNKCS205
221500         SET ASC-UPDATE-TSQ        TO TRUE                        CNKCS205
221600     END-IF.                                                      CNKCS205
221700                                                                  CNKCS205
221800     SET CN006-IDX                 TO 1.                          CNKCS205
221900     MOVE ZERO                     TO CN003-NUMBER-OF-TS-ITEMS.   CNKCS205
222000     INITIALIZE CN006-SELECTED-ITEM-ARRAY.                        CNKCS205
222100                                                                  CNKCS205
222200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           CNKCS205
222300             VARYING PV-ITEM                                      CNKCS205
222400             FROM 1 BY 1                                          CNKCS205
222500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     CNKCS205
222600                                                                  CNKCS205
222700     IF  CN006-IDX > 1                                            CNKCS205
222800         PERFORM 5205-WRITE-SEL-QUEUE                             CNKCS205
222900         ADD +1                    TO CN003-NUMBER-OF-TS-ITEMS    CNKCS205
223000     END-IF.                                                      CNKCS205
223100                                                                  CNKCS205
223200/                                                                 CNKCS205
223300*----------------------------------------------------------------*CNKCS205
223400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *CNKCS205
223500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *CNKCS205
223600*----------------------------------------------------------------*CNKCS205
223700                                                                  CNKCS205
223800 5100-WRITE-TEMP-STORAGE.                                         CNKCS205
223900                                                                  CNKCS205
224000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     CNKCS205
224100                                   TO PV-LIST-ITEM-NUMBER.        CNKCS205
224200     COMPUTE PV-BLOCK-NUMBER =                                    CNKCS205
224300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    CNKCS205
224400                                                                  CNKCS205
224500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             CNKCS205
224600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             CNKCS205
224700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      CNKCS205
224800             PERFORM 5105-REWRITE-ASC-LISTQ                       CNKCS205
224900         END-IF                                                   CNKCS205
225000     ELSE                                                         CNKCS205
225100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       CNKCS205
225200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            CNKCS205
225300         PERFORM 5110-WRITE-ASC-LISTQ                             CNKCS205
225400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   CNKCS205
225500     END-IF.                                                      CNKCS205
225600                                                                  CNKCS205
225700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      CNKCS205
225800                                   TO TRUE.                       CNKCS205
225900*----------------------------------------------------------------*CNKCS205
226000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *CNKCS205
226100*  SPECIFIC COMMAREA.                                            *CNKCS205
226200*----------------------------------------------------------------*CNKCS205
226300 5105-REWRITE-ASC-LISTQ.                                          CNKCS205
226400                                                                  CNKCS205
226500     EXEC CICS                                                    CNKCS205
226600         WRITEQ TS                                                CNKCS205
226700             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS205
226800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS205
226900             ITEM  (PV-BLOCK-NUMBER)                              CNKCS205
227000             REWRITE                                              CNKCS205
227100             RESP  (PV-CICS-RESP)                                 CNKCS205
227200     END-EXEC.                                                    CNKCS205
227300                                                                  CNKCS205
227400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           CNKCS205
227500         CONTINUE                                                 CNKCS205
227600     ELSE                                                         CNKCS205
227700         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
227800         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
227900         MOVE '5105-REWRITE-ASC-LISTQ'                            CNKCS205
228000                                   TO DP013-PARAGRAPH             CNKCS205
228100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     CNKCS205
228200                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
228300         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
228400     END-IF.                                                      CNKCS205
228500                                                                  CNKCS205
228600*----------------------------------------------------------------*CNKCS205
228700*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *CNKCS205
228800*  SPECIFIC COMMAREA.                                            *CNKCS205
228900*----------------------------------------------------------------*CNKCS205
229000 5110-WRITE-ASC-LISTQ.                                            CNKCS205
229100                                                                  CNKCS205
229200     EXEC CICS                                                    CNKCS205
229300         WRITEQ TS                                                CNKCS205
229400             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS205
229500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               CNKCS205
229600             ITEM  (PV-BLOCK-NUMBER)                              CNKCS205
229700             RESP  (PV-CICS-RESP)                                 CNKCS205
229800     END-EXEC.                                                    CNKCS205
229900                                                                  CNKCS205
230000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      CNKCS205
230100         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
230200         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
230300         MOVE '5110-WRITE-ASC-LISTQ'                              CNKCS205
230400                                   TO DP013-PARAGRAPH             CNKCS205
230500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           CNKCS205
230600                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
230700         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
230800     END-IF.                                                      CNKCS205
230900                                                                  CNKCS205
231000/                                                                 CNKCS205
231100*----------------------------------------------------------------*CNKCS205
231200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *CNKCS205
231300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *CNKCS205
231400*----------------------------------------------------------------*CNKCS205
231500                                                                  CNKCS205
231600 5200-FILL-SEL-QUEUE-RECORD.                                      CNKCS205
231700                                                                  CNKCS205
231800     PERFORM 6112-READ-LIST-QUEUE.                                CNKCS205
231900                                                                  CNKCS205
232000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       CNKCS205
232100         PERFORM                                                  CNKCS205
232200         VARYING LQW-IDX                                          CNKCS205
232300         FROM 1 BY 1                                              CNKCS205
232400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            CNKCS205
232500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          CNKCS205
232600                                                                  CNKCS205
232700             IF  LQW-SELECT (LQW-IDX)                             CNKCS205
232800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              CNKCS205
232900                                   TO CN006-ITEM (CN006-IDX)      CNKCS205
233000                 MOVE LQW-DEPT-NBR (LQW-IDX)                         CL**3
233100                                   TO CN006-DEPT-NBR (CN006-IDX)     CL**3
233200                 MOVE LQW-CL-NBR (LQW-IDX)                           CL**3
233300                                   TO CN006-CL-NBR (CN006-IDX)       CL**3
233400                 MOVE LQW-RANK   (LQW-IDX)                        CNKCS205
233500                                   TO CN006-RANK (CN006-IDX)      CNKCS205
233600                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                      CL**3
233700                                 TO CN006-OPER-UNT-ID (CN006-IDX)    CL**3
233800                 MOVE LQW-FCLTY-ID (LQW-IDX)                         CL**3
233900                                   TO CN006-FCLTY-ID  (CN006-IDX)    CL**3
234000                 MOVE SPACE        TO CN006-ACTION-SW (CN006-IDX) CNKCS205
234100                 SET CN006-IDX UP BY 1                            CNKCS205
234200                 IF  CN006-IDX > CN006-MAX-ITEMS                  CNKCS205
234300                     PERFORM 5205-WRITE-SEL-QUEUE                 CNKCS205
234400                     ADD +1        TO CN003-NUMBER-OF-TS-ITEMS    CNKCS205
234500                     INITIALIZE CN006-SELECTED-ITEM-ARRAY         CNKCS205
234600                     SET CN006-IDX TO 1                           CNKCS205
234700                 END-IF                                           CNKCS205
234800             END-IF                                               CNKCS205
234900         END-PERFORM                                              CNKCS205
235000     END-IF.                                                      CNKCS205
235100                                                                  CNKCS205
235200*----------------------------------------------------------------*CNKCS205
235300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *CNKCS205
235400*----------------------------------------------------------------*CNKCS205
235500                                                                  CNKCS205
235600 5205-WRITE-SEL-QUEUE.                                            CNKCS205
235700                                                                  CNKCS205
235800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            CNKCS205
235900                                   TO CN006-SELECTED-ITEMS.       CNKCS205
236000                                                                  CNKCS205
236100     EXEC CICS                                                    CNKCS205
236200          WRITEQ TS                                               CNKCS205
236300              QUEUE (ASC-SEL-QUEUE-NAME)                          CNKCS205
236400              FROM  (CN006-TS-SEL-REC)                            CNKCS205
236500              ITEM  (PV-SEL-QUEUE-ITEM)                           CNKCS205
236600              RESP  (PV-CICS-RESP)                                CNKCS205
236700     END-EXEC.                                                    CNKCS205
236800                                                                  CNKCS205
236900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS205
237000         CONTINUE                                                 CNKCS205
237100     ELSE                                                         CNKCS205
237200         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
237300         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
237400         MOVE '5205-WRITE-SEL-QUEUE'                              CNKCS205
237500                                   TO DP013-PARAGRAPH             CNKCS205
237600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          CNKCS205
237700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
237800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
237900     END-IF.                                                      CNKCS205
238000                                                                  CNKCS205
238100/                                                                 CNKCS205
238200*----------------------------------------------------------------*CNKCS205
238300*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *CNKCS205
238400*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *CNKCS205
238500*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *CNKCS205
238600*  THE USER.                                                     *CNKCS205
238700*----------------------------------------------------------------*CNKCS205
238800 6000-REFRESH-PANEL-FROM-TEMP.                                    CNKCS205
238900                                                                  CNKCS205
239000     IF  ASC-UPDATE-TSQ                                           CNKCS205
239100         SET ASC-NO-TSQ-UPDATE     TO TRUE                        CNKCS205
239200         MOVE ZERO                 TO PV-SAVE-ITEM                CNKCS205
239300                                      PV-SEL-QUEUE-ITEM           CNKCS205
239400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        CNKCS205
239500                                   TO PV-HOLD-SELECTED-ITEMS      CNKCS205
239600         PERFORM 6100-UPDATE-TSQ                                  CNKCS205
239700             UNTIL PV-ITEMS-PROCESSED >                           CNKCS205
239800                                     ASC-NUMBER-OF-SELECTED-ITEMS CNKCS205
239900         PERFORM 6010-DELETE-SEL-QUEUE                            CNKCS205
240000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         CNKCS205
240100                    ASC-BLOCK-ENTRIES (2)                         CNKCS205
240200     END-IF.                                                      CNKCS205
240300                                                                  CNKCS205
240400*----------------------------------------------------------------*CNKCS205
240500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *CNKCS205
240600*----------------------------------------------------------------*CNKCS205
240700 6010-DELETE-SEL-QUEUE.                                           CNKCS205
240800                                                                  CNKCS205
240900     EXEC CICS                                                    CNKCS205
241000         DELETEQ TS                                               CNKCS205
241100             QUEUE (ASC-SEL-QUEUE-NAME)                           CNKCS205
241200             RESP  (PV-CICS-RESP)                                 CNKCS205
241300     END-EXEC.                                                    CNKCS205
241400                                                                  CNKCS205
241500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      CNKCS205
241600         (PV-CICS-RESP = DFHRESP(QIDERR)))                        CNKCS205
241700         CONTINUE                                                 CNKCS205
241800     ELSE                                                         CNKCS205
241900         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
242000         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
242100         MOVE '6010-DELETE-SEL-QUEUE'                             CNKCS205
242200                                   TO DP013-PARAGRAPH             CNKCS205
242300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         CNKCS205
242400                                   TO DP013-MESSAGE-TEXT (1)      CNKCS205
242500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
242600     END-IF.                                                      CNKCS205
242700                                                                  CNKCS205
242800*----------------------------------------------------------------*CNKCS205
242900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *CNKCS205
243000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *CNKCS205
243100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *CNKCS205
243200*    THE TEMP QUEUE.                                             *CNKCS205
243300*----------------------------------------------------------------*CNKCS205
243400                                                                  CNKCS205
243500 6100-UPDATE-TSQ.                                                 CNKCS205
243600                                                                  CNKCS205
243700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          CNKCS205
243800     PERFORM 6105-READ-SEL-QUEUE.                                 CNKCS205
243900                                                                  CNKCS205
244000     PERFORM                                                      CNKCS205
244100         VARYING CN006-IDX                                        CNKCS205
244200         FROM 1 BY 1                                              CNKCS205
244300         UNTIL ((PV-ITEMS-PROCESSED >                             CNKCS205
244400                              PV-HOLD-SELECTED-ITEMS)             CNKCS205
244500         OR (CN006-IDX GREATER THAN CN006-MAX-ITEMS))             CNKCS205
244600         IF  CN006-ACTION-SW (CN006-IDX) > SPACE                  CNKCS205
244700             PERFORM 6110-PROCESS-ITEMS                           CNKCS205
244800         END-IF                                                   CNKCS205
244900         ADD +1                    TO PV-ITEMS-PROCESSED          CNKCS205
245000     END-PERFORM.                                                 CNKCS205
245100                                                                  CNKCS205
245200     PERFORM 6111-WRITE-LIST-QUEUE.                               CNKCS205
245300                                                                  CNKCS205
245400*----------------------------------------------------------------*CNKCS205
245500*    READ THE LIST QUEUE RECORD.                                 *CNKCS205
245600*----------------------------------------------------------------*CNKCS205
245700                                                                  CNKCS205
245800 6105-READ-SEL-QUEUE.                                             CNKCS205
245900                                                                  CNKCS205
246000     EXEC CICS                                                    CNKCS205
246100          READQ TS                                                CNKCS205
246200              QUEUE (ASC-SEL-QUEUE-NAME)                          CNKCS205
246300              INTO  (CN006-TS-SEL-REC)                            CNKCS205
246400              ITEM  (PV-SEL-QUEUE-ITEM)                           CNKCS205
246500              RESP  (PV-CICS-RESP)                                CNKCS205
246600     END-EXEC.                                                    CNKCS205
246700                                                                  CNKCS205
246800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS205
246900         CONTINUE                                                 CNKCS205
247000     ELSE                                                         CNKCS205
247100         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
247200         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
247300         MOVE '6105-READ-SEL-QUEUE'                               CNKCS205
247400                                   TO DP013-PARAGRAPH             CNKCS205
247500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           CNKCS205
247600                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
247700         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
247800     END-IF.                                                      CNKCS205
247900                                                                  CNKCS205
248000/                                                                 CNKCS205
248100*----------------------------------------------------------------*CNKCS205
248200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*CNKCS205
248300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*CNKCS205
248400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *CNKCS205
248500*----------------------------------------------------------------*CNKCS205
248600                                                                  CNKCS205
248700 6110-PROCESS-ITEMS.                                              CNKCS205
248800                                                                  CNKCS205
248900     COMPUTE PV-ITEM = 1 + ((CN006-ITEM (CN006-IDX) - 1)          CNKCS205
249000                     / PC-ITEMS-PER-PANEL).                       CNKCS205
249100                                                                  CNKCS205
249200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           CNKCS205
249300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          CNKCS205
249400             PERFORM 6111-WRITE-LIST-QUEUE                        CNKCS205
249500         END-IF                                                   CNKCS205
249600         MOVE PV-ITEM              TO PV-SAVE-ITEM                CNKCS205
249700                                                                  CNKCS205
249800         PERFORM 6112-READ-LIST-QUEUE                             CNKCS205
249900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               CNKCS205
250000             CONTINUE                                             CNKCS205
250100         END-IF                                                   CNKCS205
250200     END-IF.                                                      CNKCS205
250300                                                                  CNKCS205
250400     COMPUTE PV-SUB = (CN006-ITEM (CN006-IDX)                     CNKCS205
250500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              CNKCS205
250600                                                                  CNKCS205
250700     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       CNKCS205
250800     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        CNKCS205
250900                                     (PV-SUB).                    CNKCS205
251000     EVALUATE TRUE                                                CNKCS205
251100         WHEN CN006-INQ (CN006-IDX)                               CNKCS205
251200              MOVE PC-INQ          TO LQW-ACTION (PV-SUB)         CNKCS205
251300                                                                  CNKCS205
251400         WHEN CN006-UPD (CN006-IDX)                               CNKCS205
251500              MOVE PC-UPD          TO LQW-ACTION (PV-SUB)         CNKCS205
251600                                                                  CNKCS205
251700         WHEN CN006-DEL (CN006-IDX)                               CNKCS205
251800              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         CNKCS205
251900                                                                  CNKCS205
252000         WHEN CN006-ERR (CN006-IDX)                               CNKCS205
252100              MOVE PC-ERR          TO LQW-ACTION (PV-SUB)         CNKCS205
252200     END-EVALUATE.                                                CNKCS205
252300                                                                  CNKCS205
252400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                CNKCS205
252500                                                                  CNKCS205
252600*----------------------------------------------------------------*CNKCS205
252700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *CNKCS205
252800*----------------------------------------------------------------*CNKCS205
252900                                                                  CNKCS205
253000 6111-WRITE-LIST-QUEUE.                                           CNKCS205
253100                                                                  CNKCS205
253200     EXEC CICS                                                    CNKCS205
253300         WRITEQ TS                                                CNKCS205
253400             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS205
253500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     CNKCS205
253600             ITEM  (PV-SAVE-ITEM)                                 CNKCS205
253700             REWRITE                                              CNKCS205
253800             RESP  (PV-CICS-RESP)                                 CNKCS205
253900     END-EXEC.                                                    CNKCS205
254000                                                                  CNKCS205
254100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS205
254200         CONTINUE                                                 CNKCS205
254300     ELSE                                                         CNKCS205
254400         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
254500         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
254600         MOVE '6111-WRITE-LIST-QUEUE'                             CNKCS205
254700                                   TO DP013-PARAGRAPH             CNKCS205
254800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  CNKCS205
254900                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
255000         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
255100     END-IF.                                                      CNKCS205
255200                                                                  CNKCS205
255300/                                                                 CNKCS205
255400*----------------------------------------------------------------*CNKCS205
255500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*CNKCS205
255600*----------------------------------------------------------------*CNKCS205
255700                                                                  CNKCS205
255800 6112-READ-LIST-QUEUE.                                            CNKCS205
255900                                                                  CNKCS205
256000     EXEC CICS                                                    CNKCS205
256100         READQ TS                                                 CNKCS205
256200             QUEUE (ASC-LIST-QUEUE-NAME)                          CNKCS205
256300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     CNKCS205
256400             ITEM  (PV-ITEM)                                      CNKCS205
256500             RESP  (PV-CICS-RESP)                                 CNKCS205
256600     END-EXEC.                                                    CNKCS205
256700                                                                  CNKCS205
256800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          CNKCS205
256900         CONTINUE                                                 CNKCS205
257000     ELSE                                                         CNKCS205
257100         SET DP013-CICS-ABEND      TO TRUE                        CNKCS205
257200         SET DP013-NO-ROLLBACK     TO TRUE                        CNKCS205
257300         MOVE '6112-READ-LIST-QUEUE'                              CNKCS205
257400                                   TO DP013-PARAGRAPH             CNKCS205
257500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    CNKCS205
257600                                   TO DP013-MESSAGE-TEXT(1)       CNKCS205
257700         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS205
257800     END-IF.                                                      CNKCS205
257900                                                                  CNKCS205
258000/                                                                 CNKCS205
258100*----------------------------------------------------------------*CNKCS205
258200*    ABEND PROCESSOR MODULE                                      *CNKCS205
258300*----------------------------------------------------------------*CNKCS205
258400                                                                  CNKCS205
258500     COPY DPPD013.                                                CNKCS205
