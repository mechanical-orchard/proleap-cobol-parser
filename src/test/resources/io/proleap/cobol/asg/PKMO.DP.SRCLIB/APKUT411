000100 IDENTIFICATION DIVISION.                                         00010058
000200 PROGRAM-ID.    APKUT411.                                         00020058
000300 AUTHOR.        JILL JUEL.                                        00030058
000400 DATE-WRITTEN.  FEBRUARY 2000.                                    00040058
000500 DATE-COMPILED.                                                   00050058
000600***************************************************************** 00060058
000700*     PEOPLESOFT PAID HISTORY EXTRACT PROGRAM                   * 00070058
000800*     PART 1                                                    * 00080058
000900***************************************************************** 00090058
001000*     COBOL II WITH PEOPLESOFT SQL                              * 00100058
001100***************************************************************** 00110058
001200*  PURPOSE:  TO CREATE A PRG TAX AUDIT FILE, EXTRACTING DATA    * 00120058
001300*            FROM PEOPLESOFT TABLES.                            * 00130058
001400***************************************************************** 00140058
001500*  THIS PROGRAM DOES THE PEOPLESOFT PAID HISTORY EXTRACT        * 00150058
001600*  TO BE FEED INTO APKUT412 WHICH ADDS THE VENDOR NAME AND      * 00160058
001700*  PO NUMBER TO THE FILE. THE REASON THIS IS DONE IN A          * 00170058
001800*  SEPARATE PROGRAM IS TO SHORTEN THE RUN TIME.                 * 00180058
001900***************************************************************** 00190058
002000*                                                               * 00200058
002100*  PEOPLESOFT TABLES:  PS_PAYMENT_TBL  COBOL DCLGENS: FIT00180  * 00210058
002200*                      PS_PYMNT_VCHR_XREF             FIT00198  * 00220058
002300*                      PS_VOUCHER                     FIT00260  * 00230058
002400*                      PS_VOUCHER_LINE                FIT00261  * 00240058
002500*                      PS_DISTRIB_LINE                FIT00164  * 00250058
002600*                      PS_A25_ACCT_DEPTID             PSA25     * 00260058
002700*                      PS_XFT_LOC_ATTR                XFT00004  * 00270058
002710*                      PS_A22_VOU_INFO                FIT00148  * 00271058
002720*                                                               * 00272058
002730*  OUTPUT: PEOPLESOFT PAID HISTORY FILE                         * 00273058
002740*                                                               * 00274058
002750***************************************************************** 00275058
002760*  CHANGES:                                                     * 00276058
002770*  07/21/2000  INCREASED LRECL FOR OUTPUT FILE AND ADDED A      * 00277058
002780*              MOVE TO THE DEPT-NBR SINCE IT WAS ADDE TO THE    * 00278058
002790*              APRD411 COPY BOOK.                               * 00279058
002800*     MADE BY: JILL JUEL                                        * 00280058
002900*                                                               * 00290058
003000*   06/11/2002                                                  * 00300058
003100*      MODIFIED MOVE OF PYMNT_ID_REF TO FIRST 10 CHARACTERS.    * 00310058
003200*   MADE BY:  L SCHALLHORN                          WR# 23417   * 00320058
003300*                                                               * 00330058
003400*   08/12/02                                                    * 00340058
003500*      PARSED ALL COMPARE AND MOVE STATMENTS THAT               * 00350058
003600*      INVOLVED PYMNT-ID-REF OF FIT00180 SO THAT IT WIL ACCOMODATE00360058
003700*      THE NEW SIZE.                                            * 00370058
003800*   MADE BY: BRIAN HASSLINGER        WR/IR #: WR23417           * 00380058
003900*                                                               * 00390058
004000*   DATE  08/27/2003                                            * 00400058
004100*       CHANGE MADE: REMOVED PS_A17_LOC_MST AND                 * 00410058
004200*       PS_A25_ACCT_DEPTID DCLGENS.  TABLES NOT USED.           * 00420058
004300*       MADE BY: L SCHALLHORN            WR/IR #: WR24674       * 00430058
004400*                                                               * 00440058
004500*   DATE  09/12/2011                                            * 00450058
004600*       CHANGE MADE: CONVERT TO ORACLE FOR PEOPLESOFT FINANCIALS* 00460058
004700*       UPGRADE TO VERSION 9.1                                  * 00470058
004800*       - ADDED NEW FILE AND B150 PARA FOR ORACLE CONNECT       * 00480058
004900*       - REMOVED SQL COMMUNICATION AREA DCLGEN                 * 00490058
005000*       - ADDED PREFETCH=5000 TO IMPROVE PERFORMANCE.           * 00500058
005100*       - PROGRAM APKUT412 LOGIC TO FETCH VENDOR NAME ADDED IN  * 00510058
005200*         THIS PROGRAM.THUS PROGRAM APKUT412 WILL BE REMOVED.   * 00520058
005300*       - ADDED DCLGEN FIT00148 FOR PS_A22_VOU_INFO AND         * 00530058
005400*         FIT00236 FOR VENDOR TABLE IN PROGRAM                  * 00540058
005500*       - CHANGED AUDIT_CSR TO FETCH PO NUMBER, DEPT NUMBER AND * 00550058
005600*         VENDOR NAME FROM PS_A22_VOU_INFO, VENDOR TABLE        * 00560058
005700*       - CHANGED THE SQL IN AUDIT_CSR TO FETCH THE DATE IN     * 00570058
005800*         DB2 FORMAT                                            * 00580058
005900*       - OLD DCLGEN VARIABLE ARE CHANGED TO ORACLE DCLGEN      * 00590058
006000*         VARIABLE                                              * 00600058
006100*       - VARIABLE WHICH HAS -DB2- CHANGED TO -ORA TO INDICATE  * 00610058
006200*         ORACLE                                                * 00620058
006300*       - CHANGES DONE IN PARA B100-, B200-, B300-, F100-       * 00630058
006400*         , Y100-,Y200-,Z999-                                   * 00640058
006500*       DB2 DCLGEN ARE REPLACED BY ORACLE DCLGEN.               * 00650058
006600*           DB2 DCLGEN     ORACLE DCLGEN                        * 00660058
006700*           ----------     -------------                        * 00670058
006800*         1. PFI00021      FIT00180                             * 00680058
006900*         2. PFI00023      FIT00198                             * 00690058
007000*         3. PFI00018      FIT00260                             * 00700058
007100*         4. PFI00019      FIT00261                             * 00710058
007200*         5. PFI00020      FIT00164                             * 00720058
007300*                                                               * 00730058
007400*     MADE BY: VIGNESH V               WR/IR #: WR37038         * 00740058
007500***************************************************************** 00750058
007600 ENVIRONMENT DIVISION.                                            00760058
007700 CONFIGURATION SECTION.                                           00770058
007800 SOURCE-COMPUTER.        IBM-370.                                 00780058
007900 OBJECT-COMPUTER.        IBM-370.                                 00790058
008000                                                                  00800058
008100 INPUT-OUTPUT SECTION.                                            00810058
008200                                                                  00820058
008300 FILE-CONTROL.                                                    00830058
008400     SELECT ORACLE-LOGIN-FILE     ASSIGN TO UT-S-ORALOGON.        00840058
008500     SELECT PAIDHIST-EXTRACT-FILE ASSIGN TO UT-S-OUT01.           00850058
008600                                                                  00860058
008700 DATA DIVISION.                                                   00870058
008800 FILE SECTION.                                                    00880058
008900 FD  ORACLE-LOGIN-FILE                                            00890058
009000     RECORDING MODE IS F                                          00900058
009100     LABEL RECORDS ARE STANDARD                                   00910058
009200     BLOCK CONTAINS 0 RECORDS                                     00920058
009300     DATA RECORD IS ORACLE-LOGIN-REC.                             00930058
009400 01  ORACLE-LOGIN-REC.                                            00940058
009500     05  FILLER                          PIC X(80).               00950058
009600                                                                  00960058
009700 FD  PAIDHIST-EXTRACT-FILE                                        00970058
009800     RECORDING MODE IS F                                          00980058
009900     LABEL RECORDS ARE STANDARD                                   00990058
010000     BLOCK CONTAINS 0 RECORDS                                     01000058
010100     RECORD CONTAINS 500 CHARACTERS                               01010058
010200     DATA RECORD IS PAIDHIST-EXTRACT-RECORD.                      01020058
010300                                                                  01030058
010400 01  PAIDHIST-EXTRACT-RECORD             PIC X(500).              01040058
010500                                                                  01050058
010600 EJECT                                                            01060058
010700                                                                  01070058
010800 WORKING-STORAGE SECTION.                                         01080058
010900 01  PROGRAM-VARIABLES.                                           01090058
011000     05  PV-PROGRAM-NAME                PIC X(08)  VALUE          01100058
011100                                                   'APKUT411'.    01110058
011200     05  PV-ORACLE-USERID-LEN           PIC S9(4)  VALUE ZEROS.   01120058
011300     05  PV-ORACLE-PASSWORD-LEN         PIC S9(4)  VALUE ZEROS.   01130058
011400     05  PV-PYMNT-ID-REF                PIC X(20)  VALUE SPACES.  01140058
011500                                                                  01150058
011600 01  PROGRAM-SWITCHES.                                            01160058
011700     05  PS-AUDIT-END-OF-CSR            PIC X  VALUE 'N'.         01170058
011800         88  AUDIT-END-OF-CSR                  VALUE 'Y'.         01180058
011900     05  PS-ORACLE-LOGIN-EOF-SW         PIC X  VALUE 'N'.         01190058
012000         88  ORACLE-LOGIN-EOF                  VALUE 'Y'.         01200058
012100                                                                  01210058
012200 01  CC-CONTROL-CARD.                                             01220058
012400     05  CC-BEGIN-DATE                  PIC X(10).                01240058
012500     05  FILLER REDEFINES CC-BEGIN-DATE.                          01250058
012600         10 CC-BEGIN-DATE-CCYY          PIC X(04).                01260058
012700         10 FILLER                      PIC X(01).                01270058
012800         10 CC-BEGIN-DATE-MM            PIC X(02).                01280058
012900         10 FILLER                      PIC X(01).                01290058
013000         10 CC-BEGIN-DATE-DD            PIC X(02).                01300058
013100     05  FILLER                         PIC X(01).                01310059
013200     05  CC-END-DATE                    PIC X(10).                01320058
013300     05  FILLER REDEFINES CC-END-DATE.                            01330058
013400         10 CC-END-DATE-CCYY            PIC X(04).                01340058
013500         10 FILLER                      PIC X(01).                01350058
013600         10 CC-END-DATE-MM              PIC X(02).                01360058
013700         10 FILLER                      PIC X(01).                01370058
013800         10 CC-END-DATE-DD              PIC X(02).                01380058
013900     05  FILLER                         PIC X(39).                01390059
014000                                                                  01400058
014100 01  PROGRAM-COUNTERS.                                            01410058
014200     05  AUDIT-CSR-COUNT                PIC S9(09) COMP VALUE 0.  01420058
014300     05  AUDIT-OUT-COUNT                PIC S9(09) COMP VALUE 0.  01430058
014400                                                                  01440058
014500 01  ABEND-CODE                         PIC S9(04) VALUE ZEROS    01450058
014600                                                   COMP SYNC.     01460058
014700     88  AC-BAD-WRITE                   VALUE  +4001.             01470058
014800     88  AC-CONTROL-CARD-ERROR          VALUE  +4003.             01480058
014900     88  AC-OPEN-ERROR                  VALUE  +4005.             01490058
015000     88  AC-CLOSE-ERROR                 VALUE  +4006.             01500058
015100     88  AC-BAD-DATA                    VALUE  +4008.             01510058
015200     88  AC-ORA-ERROR                   VALUE  +4013.             01520058
015300     88  AC-UNSUCCESSFUL-SELECT         VALUE  +4015.             01530058
015400     88  AC-MAX-RETRIES-EXCEEDED        VALUE  +4016.             01540058
015500     88  AC-DATE-ERROR                  VALUE  +4019.             01550058
015600                                                                  01560058
015700 01  ABEND-AREAS.                                                 01570058
015800     05  AA-ABEND-LIT                   PIC  X(40)  VALUE         01580058
015900             '*****       ABEND'.                                 01590058
016000     05  AA-PROGRAM-LIT                 PIC  X(40)  VALUE         01600058
016100             '*****   PROGRAM: APKUT411'.                         01610058
016200     05  AA-PARAGRAPH-LIT.                                        01620058
016300         10  FILLER                     PIC  X(17)  VALUE         01630058
016400             '***** PARAGRAPH: '.                                 01640058
016500         10  AA-PARAGRAPH-NAME          PIC  X(35)  VALUE SPACES. 01650058
016600     05  AA-MESSAGE-LINE.                                         01660058
016700         10  FILLER                     PIC  X(06)  VALUE         01670058
016800             '*****'.                                             01680058
016900         10  AA-MESSAGE                 PIC  X(127) VALUE SPACES. 01690058
017000         10  FILLER REDEFINES AA-MESSAGE.                         01700058
017100             15 AA-MESSAGE-1     PIC  X(45).                      01710058
017200             15 AA-MESSAGE-2     PIC  X(45).                      01720058
017300             15 AA-MESSAGE-3     PIC  X(37).                      01730058
017400     05  AA-ORA-ERROR-LIT               PIC  X(40)  VALUE         01740058
017500             '*****    ORACLE ERROR'.                             01750058
017600     05  AA-ORA-OPERATION-LIT.                                    01760058
017700         10  FILLER                     PIC  X(17)  VALUE         01770058
017800             '***** OPERATION: '.                                 01780058
017900         10  AA-ORA-OPERATION.                                    01790058
018000             15  AA-ORA-OP-1            PIC  X(25)  VALUE SPACES. 01800058
018100             15  AA-ORA-OP-2            PIC  X(25)  VALUE SPACES. 01810058
018200     05  AA-ORA-TABLE-1                 PIC  X(18)  VALUE SPACES. 01820058
018300     05  AA-ORA-TABLE-2                 PIC  X(18)  VALUE SPACES. 01830058
018400     05  AA-ORA-TABLE-3                 PIC  X(18)  VALUE SPACES. 01840058
018500 EJECT                                                            01850058
018600                                                                  01860058
018700*--------------------------------------------------------------*  01870058
018800* AP411-PAIDHIST-EXTRACT-RECORD                                *  01880058
018900*--------------------------------------------------------------*  01890058
019000     COPY APRD411.                                                01900058
019100 EJECT                                                            01910058
019200                                                                  01920058
019300*--------------------------------------------------------------*  01930058
019400* WORKING STORAGE FOR CALENDAR ROUTINE                         *  01940058
019500*--------------------------------------------------------------*  01950058
019600     COPY DPWS500.                                                01960058
019700 EJECT                                                            01970058
019800                                                                  01980058
019900*--------------------------------------------------------------*  01990058
020000*  DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA     *  02000058
020100*  MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS. *  02010058
020200*--------------------------------------------------------------*  02020058
020300     COPY DPWS004.                                                02030058
020400 EJECT                                                            02040058
020500                                                                  02050058
020600 01  CC-ORACLE-CONNECTION.                                        02060058
020700     05  CC-ORACLE-USERID        PIC X(40).                       02070058
020800         88 CC-AUTO-SIGNON-IND                VALUE '/'.          02080058
020900     05  CC-ORACLE-PASSWORD      PIC X(40).                       02090058
021000                                                                  02100058
021100******************************************************************02110058
021200*                      O  R  A  C  L  E                          *02120058
021300*=================================================================02130058
021400* ORACLE DECLARE SECTION                                         *02140058
021500* ORACLE USED AND RETURNED VARIABLES                             *02150058
021600******************************************************************02160058
021700                                                                  02170058
021800*----------------------------------------------------------------*02180058
021900* ORACLE LOGON WORKING STORAGE COPYBOOK                          *02190058
022000*----------------------------------------------------------------*02200058
022100 01  PC-ENT01-TYPE-CDE           PIC X(02)    VALUE '01'.         02210058
022200 01  PV-ORACLE-ID                PIC X(01)    VALUE '/'.          02220058
022300                                                                  02230058
022400 01  USERNAME                    PIC X(10)    VARYING.            02240058
022500 01  PASSWD                      PIC X(10)    VARYING.            02250058
022600                                                                  02260058
022700 01  ORACLE-RETURN               PIC X(200)   VALUE SPACES.       02270058
022800                                                                  02280058
022900     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02290058
023000                                                                  02300058
023100     EXEC ORACLE OPTION (PREFETCH=5000) END-EXEC.                 02310058
023200*--------------------------------------------------------------*  02320058
023300*  PEOPLESOFT PAYMENT_TBL TABLE                                *  02330058
023400*--------------------------------------------------------------*  02340058
023500     EXEC SQL                                                     02350058
023600          INCLUDE FIT00180                                        02360058
023700     END-EXEC.                                                    02370058
023800 EJECT                                                            02380058
023900*--------------------------------------------------------------*  02390058
024000*  PEOPLESOFT PYMNT_VCHR_XREF TABLE                            *  02400058
024100*--------------------------------------------------------------*  02410058
024200     EXEC SQL                                                     02420058
024300          INCLUDE FIT00198                                        02430058
024400     END-EXEC.                                                    02440058
024500 EJECT                                                            02450058
024600*--------------------------------------------------------------*  02460058
024700*  PEOPLESOFT VOUCHER TABLE                                    *  02470058
024800*--------------------------------------------------------------*  02480058
024900     EXEC SQL                                                     02490058
025000          INCLUDE FIT00260                                        02500058
025100     END-EXEC.                                                    02510058
025200 EJECT                                                            02520058
025300*--------------------------------------------------------------*  02530058
025400*  PEOPLESOFT VOUCHER LINE TABLE                               *  02540058
025500*--------------------------------------------------------------*  02550058
025600     EXEC SQL                                                     02560058
025700          INCLUDE FIT00261                                        02570058
025800     END-EXEC.                                                    02580058
025900 EJECT                                                            02590058
026000*--------------------------------------------------------------*  02600058
026100*  PEOPLESOFT DISTRIB LINE TABLE                               *  02610058
026200*--------------------------------------------------------------*  02620058
026300     EXEC SQL                                                     02630058
026400          INCLUDE FIT00164                                        02640058
026500     END-EXEC.                                                    02650058
026600 EJECT                                                            02660058
026700*--------------------------------------------------------------*  02670058
026800*   PS_A22_VOU_INFO                                            *  02680058
026900*--------------------------------------------------------------*  02690058
027000     EXEC SQL                                                     02700058
027100          INCLUDE FIT00148                                        02710058
027200     END-EXEC.                                                    02720058
027300 EJECT                                                            02730058
027400*--------------------------------------------------------------*  02740058
027500*  PEOPLESOFT VENDOR TABLE                                     *  02750058
027600*--------------------------------------------------------------*  02760058
027700     EXEC SQL                                                     02770058
027800          INCLUDE FIT00236                                        02780058
027900     END-EXEC.                                                    02790058
028000 EJECT                                                            02800058
028100                                                                  02810058
028200     EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       02820058
028300     EXEC SQL END DECLARE SECTION END-EXEC.                       02830058
028400 EJECT                                                            02840058
028500*--------------------------------------------------------------*  02850058
028600*  AUDIT_CSR                                                   *  02860058
028700*--------------------------------------------------------------*  02870058
028800     EXEC SQL                                                     02880058
028900       DECLARE AUDIT_CSR CURSOR FOR                               02890058
029000          SELECT A.VOUCHER_ID                                     02900058
029100               , A.VENDOR_ID                                      02910058
029200               , A.ORIGIN                                         02920058
029300               , A.INVOICE_ID                                     02930058
029400               , TO_CHAR(A.INVOICE_DT,'YYYY-MM-DD')               02940058
029500               , TO_CHAR(A.ACCOUNTING_DT,'YYYY-MM-DD')            02950058
029600               , A.OPRID                                          02960058
029700               , TO_CHAR(A.ENTERED_DT,'YYYY-MM-DD')               02970058
029800               , A.DESCR254_MIXED                                 02980058
029900               , C.DEPTID                                         02990058
030000               , C.ACCOUNT                                        03000058
030100               , C.DSCNT_AMT                                      03010058
030200               , C.FREIGHT_AMT                                    03020058
030300               , C.MERCHANDISE_AMT                                03030058
030400               , C.MONETARY_AMOUNT                                03040058
030500               , C.SALETX_AMT                                     03050058
030600               , D.PAID_AMT                                       03060058
030700               , D.PYMNT_HOLD                                     03070058
030800               , TO_CHAR(D.SCHEDULED_PAY_DT,'YYYY-MM-DD')         03080058
030900               , E.BANK_CD                                        03090058
031000               , TO_CHAR(E.PYMNT_DT,'YYYY-MM-DD')                 03100058
031100               , E.PYMNT_ID_REF                                   03110058
031200               , E.REMIT_VENDOR                                   03120058
031300               , E.NAME1                                          03130058
031400               , F.KC_PO_NBR                                      03140058
031500               , F.KC_DEPT_NBR                                    03150058
031600               , G.NAME1                                          03160058
031700            FROM PS_VOUCHER A                                     03170058
031800               , PS_DISTRIB_LINE C                                03180058
031900               , PS_PYMNT_VCHR_XREF D                             03190058
032000               , PS_PAYMENT_TBL E                                 03200058
032100               , PS_A22_VOU_INFO F                                03210058
032200               , PS_VENDOR G                                      03220058
032300           WHERE A.BUSINESS_UNIT      = 'KDS'                     03230058
032400             AND A.BUSINESS_UNIT      = C.BUSINESS_UNIT           03240058
032500             AND A.VOUCHER_ID         = C.VOUCHER_ID              03250058
032600             AND D.PYMNT_SELCT_STATUS = 'P'                       03260058
032700             AND D.BUSINESS_UNIT      = A.BUSINESS_UNIT           03270058
032800             AND D.VOUCHER_ID         = A.VOUCHER_ID              03280058
032900             AND E.BANK_SETID         = 'SHARE'                   03290058
033000             AND E.PYMNT_DT                                       03300058
033100                 BETWEEN TO_DATE(:CC-BEGIN-DATE,'YYYY-MM-DD') AND 03310058
033200                         TO_DATE(:CC-END-DATE,'YYYY-MM-DD')       03320058
033300             AND E.BANK_SETID         = D.BANK_SETID              03330058
033400             AND E.BANK_CD            = D.BANK_CD                 03340058
033500             AND E.BANK_ACCT_KEY      = D.BANK_ACCT_KEY           03350058
033600             AND E.PYMNT_ID           = D.PYMNT_ID                03360058
033700             AND E.PYMNT_METHOD       = D.PYMNT_METHOD            03370058
033800             AND E.PAY_CYCLE          = D.PAY_CYCLE               03380058
033900             AND E.PAY_CYCLE_SEQ_NUM  = D.PAY_CYCLE_SEQ_NUM       03390058
034000             AND E.REMIT_VENDOR       = D.REMIT_VENDOR            03400058
034100             AND F.BUSINESS_UNIT      = A.BUSINESS_UNIT           03410058
034200             AND F.VOUCHER_ID         = A.VOUCHER_ID              03420058
034300             AND G.SETID              = A.VENDOR_SETID            03430058
034400             AND G.VENDOR_ID          = A.VENDOR_ID               03440058
034500     END-EXEC.                                                    03450058
034600                                                                  03460058
034700                                                                  03470058
034800************************                                          03480058
034900 PROCEDURE DIVISION.                                              03490058
035000************************                                          03500058
035100 A100-MAINLINE-ROUTINE.                                           03510058
035200                                                                  03520058
035300     PERFORM B100-INITIALIZATION.                                 03530058
035400                                                                  03540058
035500     PERFORM B200-PROCESS-AUDIT-CSR                               03550058
035600       UNTIL AUDIT-END-OF-CSR.                                    03560058
035700                                                                  03570058
035800     PERFORM B300-TERMINATION.                                    03580058
035900     GOBACK.                                                      03590058
036000                                                                  03600058
036100*--------------------------------------------------------------*  03610058
036200*  INITIALIZATION PROCESSING                                   *  03620058
036300*--------------------------------------------------------------*  03630058
036400 B100-INITIALIZATION.                                             03640058
036500                                                                  03650058
036600     DISPLAY ' '.                                                 03660058
036700     DISPLAY '**----------- APKUT411 BEGINS -------------**'.     03670058
036800     DISPLAY 'SYSTEM DATE ' FUNCTION CURRENT-DATE(1:8)            03680058
036900                 '   TIME ' FUNCTION CURRENT-DATE(9:6)            03690058
037000                                                                  03700058
037100     ACCEPT CC-CONTROL-CARD.                                      03710058
037200     DISPLAY ' '.                                                 03720058
037300     DISPLAY 'BEGIN DATE = ' CC-BEGIN-DATE.                       03730058
037400     DISPLAY 'END   DATE = ' CC-END-DATE.                         03740058
037500     DISPLAY ' '.                                                 03750058
037600                                                                  03760058
037700** THIS VERIFIES THE CONTROL CARD DATE, CC-BEGIN-DATE             03770058
037800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03780058
037900     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      03790058
038000     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            03800058
038100     MOVE CC-BEGIN-DATE TO DPG52-DB2-ISO-DATE-FMT                 03810058
038200     PERFORM Z900-CALENDAR-ROUTINE.                               03820058
038300     IF (DPG54-SEVERE-ERROR) OR                                   03830058
038400        (DPG54-WARNING-ERROR)                                     03840058
038500         SET AC-DATE-ERROR TO TRUE                                03850058
038600         MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-NAME          03860058
038700         MOVE DPG54-ERROR-MESSAGE   TO AA-MESSAGE                 03870058
038800         PERFORM Z999-ABEND                                       03880058
038900     END-IF.                                                      03890058
039000                                                                  03900058
039100** THIS VERIFIES THE CONTROL CARD DATE, CC-END-DATE               03910058
039200     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03920058
039300     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      03930058
039400     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            03940058
039500     MOVE CC-END-DATE TO DPG52-DB2-ISO-DATE-FMT                   03950058
039600     PERFORM Z900-CALENDAR-ROUTINE.                               03960058
039700     IF (DPG54-SEVERE-ERROR) OR                                   03970058
039800        (DPG54-WARNING-ERROR)                                     03980058
039900         SET AC-DATE-ERROR TO TRUE                                03990058
040000         MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-NAME          04000058
040100         MOVE DPG54-ERROR-MESSAGE   TO AA-MESSAGE                 04010058
040200         PERFORM Z999-ABEND                                       04020058
040300     END-IF.                                                      04030058
040400                                                                  04040058
040500     INITIALIZE AP411-PAIDHIST-EXTRACT-RECORD.                    04050058
040600     OPEN INPUT  ORACLE-LOGIN-FILE                                04060058
040700          OUTPUT PAIDHIST-EXTRACT-FILE.                           04070058
040800                                                                  04080058
040900     PERFORM B150-CONNECT-TO-ORACLE.                              04090058
041000                                                                  04100058
041100     DISPLAY 'OPEN AUDIT CURSOR'                                  04110058
041200     PERFORM Y100-OPEN-AUDIT-CSR.                                 04120058
041300     DISPLAY 'TIME ' FUNCTION CURRENT-DATE(9:6)                   04130058
041400     PERFORM F100-FETCH-AUDIT-CSR.                                04140058
041500*    DISPLAY 'INVOICE  ' INVOICE-ID OF FIT00260                   04150058
041600*            '  ' BANK-CD OF FIT00180                             04160058
041700*            '  ' ORIGIN OF FIT00260.                             04170058
041800 EJECT.                                                           04180058
041900                                                                  04190058
042000*----------------------------------------------------------------*04200058
042100*    LOGON TO ORACLE                                             *04210058
042200*    - READ THE CONTROL CARD TO GET THE CREDENTIALS AND LOGON    *04220058
042300*    - ORACLE                                                    *04230058
042400*----------------------------------------------------------------*04240058
042500 B150-CONNECT-TO-ORACLE.                                          04250058
042600                                                                  04260058
042700     READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             04270058
042800        AT END                                                    04280058
042900           SET ORACLE-LOGIN-EOF TO TRUE.                          04290058
043000                                                                  04300058
043100     IF NOT ORACLE-LOGIN-EOF                                      04310058
043200        INITIALIZE PV-ORACLE-USERID-LEN                           04320058
043300                  PV-ORACLE-PASSWORD-LEN                          04330058
043400        INSPECT CC-ORACLE-USERID                                  04340058
043500           TALLYING PV-ORACLE-USERID-LEN                          04350058
043600           FOR CHARACTERS BEFORE INITIAL SPACE                    04360058
043700        INSPECT CC-ORACLE-PASSWORD                                04370058
043800           TALLYING PV-ORACLE-PASSWORD-LEN                        04380058
043900           FOR CHARACTERS BEFORE INITIAL SPACE                    04390058
044000        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         04400058
044100                  USERNAME-ARR                                    04410058
044200        MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                 04420058
044300        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     04430058
044400                  PASSWD-ARR                                      04440058
044500        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 04450058
044600                                                                  04460058
044700        IF CC-AUTO-SIGNON-IND                                     04470058
044800           DISPLAY PV-PROGRAM-NAME ' - AUTO SIGN-ON TO ORACLE'    04480058
044900           EXEC SQL                                               04490058
045000                CONNECT :USERNAME                                 04500058
045100           END-EXEC                                               04510058
045200        ELSE                                                      04520058
045300           DISPLAY PV-PROGRAM-NAME ' - SIGN-ON TO ORACLE AS USER '04530058
045400                   USERNAME-ARR                                   04540058
045500           EXEC SQL                                               04550058
045600                CONNECT :USERNAME IDENTIFIED BY :PASSWD           04560058
045700           END-EXEC                                               04570058
045800        END-IF                                                    04580058
045900                                                                  04590058
046000        INITIALIZE CC-ORACLE-PASSWORD                             04600058
046100                   PASSWD                                         04610058
046200                   PV-ORACLE-PASSWORD-LEN                         04620058
046300                   PASSWD-LEN                                     04630058
046400                                                                  04640058
046500        IF (SQLCODE NOT = 0)                                      04650058
046600            MOVE 'B150-CONNECT-TO-ORACLE' TO AA-PARAGRAPH-NAME    04660058
046700            DISPLAY PV-PROGRAM-NAME                               04670058
046800                   ' - ERROR SIGNING ON TO ORACLE'                04680058
046900            PERFORM Z998-ORA-ABEND                                04690058
047000        END-IF                                                    04700058
047100     END-IF.                                                      04710058
047200*--------------------------------------------------------------*  04720058
047300*  THIS ROUTINE HOLDS THE MAIN LOGIC FOR CREATING THE PAIDHIST *  04730058
047400*  EXTRACT FILE.                                               *  04740058
047500*--------------------------------------------------------------*  04750058
047600 B200-PROCESS-AUDIT-CSR.                                          04760058
047700     MOVE VENDOR-ID     OF FIT00260  TO AP411-VENDOR-ID.          04770058
047800     MOVE ORIGIN        OF FIT00260  TO AP411-ORIGIN.             04780058
047900     MOVE DEPTID        OF FIT00164  TO AP411-DEPTID.             04790058
048000     MOVE ACCOUNT       OF FIT00164  TO AP411-ACCOUNT.            04800058
048100     MOVE VOUCHER-ID    OF FIT00260  TO AP411-VOUCHER-ID.         04810058
048200     MOVE INVOICE-ID    OF FIT00260  TO AP411-INVOICE-ID.         04820058
048300     MOVE INVOICE-DT    OF FIT00260  TO AP411-INVOICE-DT.         04830058
048400     MOVE ACCOUNTING-DT OF FIT00260  TO AP411-ACCOUNTING-DT.      04840058
048500     MOVE DSCNT-AMT     OF FIT00164  TO AP411-DSCNT-AMT.          04850058
048600     MOVE FREIGHT-AMT   OF FIT00164  TO AP411-FREIGHT-AMT.        04860058
048700     MOVE SALETX-AMT    OF FIT00164  TO AP411-SALETX-AMT.         04870058
048800     MOVE MERCHANDISE-AMT                                         04880058
048900                        OF FIT00164  TO AP411-MERCHANDISE-AMT.    04890058
049000     MOVE MONETARY-AMOUNT                                         04900058
049100                        OF FIT00164  TO AP411-MONETARY-AMOUNT.    04910058
049200     MOVE PAID-AMT      OF FIT00198  TO AP411-PAID-AMT.           04920058
049300     MOVE PYMNT-DT      OF FIT00180  TO AP411-PYMNT-DT.           04930058
049400     MOVE PYMNT-ID-REF  OF FIT00180  TO PV-PYMNT-ID-REF.          04940058
049500     MOVE PV-PYMNT-ID-REF(1:10)      TO AP411-PYMNT-ID-REF.       04950058
049600     MOVE PYMNT-HOLD    OF FIT00198  TO AP411-PYMNT-HOLD.         04960058
049700     MOVE OPRID         OF FIT00260  TO AP411-OPRID.              04970058
049800     MOVE ENTERED-DT    OF FIT00260  TO AP411-ENTERED-DT.         04980058
049900     MOVE SCHEDULED-PAY-DT                                        04990058
050000                        OF FIT00198  TO AP411-SCHEDULED-PAY-DT.   05000058
050100     MOVE DESCR254-MIXED                                          05010058
050200                        OF FIT00260  TO AP411-DESCR254.           05020058
050300     MOVE KC-PO-NBR     OF FIT00148  TO AP411-PO-NBR.             05030058
050400     MOVE KC-DEPT-NBR   OF FIT00148  TO AP411-DEPT-NBR.           05040058
050500     IF VENDOR-ID OF FIT00260 = REMIT-VENDOR OF FIT00180          05050058
050600        MOVE NAME1      OF FIT00180  TO AP411-VENDOR-NAME         05060058
050700     ELSE                                                         05070058
050800        MOVE NAME1      OF FIT00236  TO AP411-VENDOR-NAME         05080058
050900     END-IF.                                                      05090058
051000                                                                  05100058
051100     PERFORM W100-WRITE-PAIDHIST-EXTRACT.                         05110058
051200                                                                  05120058
051300     PERFORM F100-FETCH-AUDIT-CSR.                                05130058
051400*    DISPLAY 'INVOICE  ' INVOICE-ID OF FIT00260                   05140058
051500*            '  ' BANK-CD OF FIT00180                             05150058
051600*            '  ' ORIGIN OF FIT00260.                             05160058
051700 EJECT.                                                           05170058
051800                                                                  05180058
051900*--------------------------------------------------------------*  05190058
052000*  END OF PROGRAM PROCESSING                                   *  05200058
052100*--------------------------------------------------------------*  05210058
052200 B300-TERMINATION.                                                05220058
052300     DISPLAY '*********************************************'.     05230058
052400     DISPLAY '**      RECORD COUNTS                      **'.     05240058
052500     DISPLAY '*********************************************'.     05250058
052600     DISPLAY 'AUDIT CURSOR COUNT     ' AUDIT-CSR-COUNT.           05260058
052700     DISPLAY 'AUDIT RECORDS WRITTEN  ' AUDIT-OUT-COUNT.           05270058
052800     DISPLAY '*********************************************'.     05280058
052900     DISPLAY '********  END OF PROGRAM APKUT411  **********'.     05290058
053000     DISPLAY '*********************************************'.     05300058
053100     PERFORM Y200-CLOSE-AUDIT-CSR.                                05310058
053200                                                                  05320058
053300     CLOSE ORACLE-LOGIN-FILE                                      05330058
053400           PAIDHIST-EXTRACT-FILE.                                 05340058
053500                                                                  05350058
053600     DISPLAY '**----------- APKUT411 ENDS ---------------**'.     05360058
053700 EJECT.                                                           05370058
053800                                                                  05380058
053900*--------------------------------------------------------------*  05390058
054000*  EXTRACTS THE INFORMATION NEEDED FOR STATE TAX AUDIT         *  05400058
054100*--------------------------------------------------------------*  05410058
054200 F100-FETCH-AUDIT-CSR.                                            05420058
054300     EXEC SQL                                                     05430058
054400         FETCH AUDIT_CSR                                          05440058
054500          INTO :FIT00260.VOUCHER-ID                               05450058
054600             , :FIT00260.VENDOR-ID                                05460058
054700             , :FIT00260.ORIGIN                                   05470058
054800             , :FIT00260.INVOICE-ID                               05480058
054900             , :FIT00260.INVOICE-DT                               05490058
055000             , :FIT00260.ACCOUNTING-DT                            05500058
055100             , :FIT00260.OPRID                                    05510058
055200             , :FIT00260.ENTERED-DT                               05520058
055300             , :FIT00260.DESCR254-MIXED                           05530058
055400             , :FIT00164.DEPTID                                   05540058
055500             , :FIT00164.ACCOUNT                                  05550058
055600             , :FIT00164.DSCNT-AMT                                05560058
055700             , :FIT00164.FREIGHT-AMT                              05570058
055800             , :FIT00164.MERCHANDISE-AMT                          05580058
055900             , :FIT00164.MONETARY-AMOUNT                          05590058
056000             , :FIT00164.SALETX-AMT                               05600058
056100             , :FIT00198.PAID-AMT                                 05610058
056200             , :FIT00198.PYMNT-HOLD                               05620058
056300             , :FIT00198.SCHEDULED-PAY-DT                         05630058
056400             , :FIT00180.BANK-CD                                  05640058
056500             , :FIT00180.PYMNT-DT                                 05650058
056600             , :FIT00180.PYMNT-ID-REF                             05660058
056700             , :FIT00180.REMIT-VENDOR                             05670058
056800             , :FIT00180.NAME1                                    05680058
056900             , :FIT00148.KC-PO-NBR                                05690058
057000             , :FIT00148.KC-DEPT-NBR                              05700058
057100             , :FIT00236.NAME1                                    05710058
057200     END-EXEC.                                                    05720058
057300     EVALUATE TRUE                                                05730058
057400         WHEN SQLCODE = ZERO                                      05740058
057500             ADD 1 TO AUDIT-CSR-COUNT                             05750058
057600         WHEN SQLCODE = +1403                                     05760058
057700             SET AUDIT-END-OF-CSR TO TRUE                         05770058
057800         WHEN OTHER                                               05780058
057900             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                05790058
058000             MOVE 'F100-FETCH-AUDIT-CSR'   TO AA-PARAGRAPH-NAME   05800058
058100             MOVE 'UNSUCCESSFUL FETCH '    TO AA-ORA-OPERATION    05810058
058200             MOVE 'PS_PAYMENT_TBL'         TO AA-ORA-TABLE-1      05820058
058300             MOVE 'PS_VOUCHER'             TO AA-ORA-TABLE-2      05830058
058400             MOVE 'PS_A22_VOU_INFO'        TO AA-ORA-TABLE-3      05840058
058500             PERFORM Z998-ORA-ABEND                               05850058
058600     END-EVALUATE.                                                05860058
058700 EJECT.                                                           05870058
058800*--------------------------------------------------------------*  05880058
058900*  THIS ROUTINE WRITES A RECORD TO UPDATE THE INVOICE TABLE    *  05890058
059000*--------------------------------------------------------------*  05900058
059100 W100-WRITE-PAIDHIST-EXTRACT.                                     05910058
059200     WRITE PAIDHIST-EXTRACT-RECORD                                05920058
059300           FROM AP411-PAIDHIST-EXTRACT-RECORD.                    05930058
059400     ADD 1 TO AUDIT-OUT-COUNT.                                    05940058
059500 EJECT.                                                           05950058
059600*--------------------------------------------------------------*  05960058
059700*  THIS ROUTINE OPENS THE AUDIT CURSOR                         *  05970058
059800*--------------------------------------------------------------*  05980058
059900 Y100-OPEN-AUDIT-CSR.                                             05990058
060000     EXEC SQL                                                     06000058
060100         OPEN AUDIT_CSR                                           06010058
060200     END-EXEC.                                                    06020058
060300     EVALUATE TRUE                                                06030058
060400         WHEN SQLCODE = ZERO                                      06040058
060500             CONTINUE                                             06050058
060600         WHEN OTHER                                               06060058
060700             SET AC-OPEN-ERROR TO TRUE                            06070058
060800             MOVE 'Y100-OPEN-AUDIT-CSR'  TO AA-PARAGRAPH-NAME     06080058
060900             MOVE 'UNSUCCESSFUL OPEN'    TO AA-ORA-OPERATION      06090058
061000             MOVE 'PS_PAYMENT_TBL'       TO AA-ORA-TABLE-1        06100058
061100             MOVE 'PS_VOUCHER'           TO AA-ORA-TABLE-2        06110058
061200             MOVE 'PS_A22_VOU_INFO'      TO AA-ORA-TABLE-3        06120058
061300             PERFORM Z998-ORA-ABEND                               06130058
061400     END-EVALUATE.                                                06140058
061500                                                                  06150058
061600*--------------------------------------------------------------*  06160058
061700*  THIS ROUTINE CLOSES THE AUDIT CURSOR                        *  06170058
061800*--------------------------------------------------------------*  06180058
061900 Y200-CLOSE-AUDIT-CSR.                                            06190058
062000     EXEC SQL                                                     06200058
062100         CLOSE AUDIT_CSR                                          06210058
062200     END-EXEC.                                                    06220058
062300     EVALUATE TRUE                                                06230058
062400         WHEN SQLCODE = ZERO                                      06240058
062500             CONTINUE                                             06250058
062600         WHEN OTHER                                               06260058
062700             SET AC-CLOSE-ERROR TO TRUE                           06270058
062800             MOVE 'Y200-CLOSE-AUDIT-CSR'  TO AA-PARAGRAPH-NAME    06280058
062900             MOVE 'UNSUCCESSFUL CLOSE'    TO AA-ORA-OPERATION     06290058
063000             MOVE 'PS_PAYMENT_TBL'        TO AA-ORA-TABLE-1       06300058
063100             MOVE 'PS_VOUCHER'            TO AA-ORA-TABLE-2       06310058
063200             MOVE 'PS_A22_VOU_INFO'       TO AA-ORA-TABLE-3       06320058
063300             PERFORM Z998-ORA-ABEND                               06330058
063400     END-EVALUATE.                                                06340058
063500 EJECT.                                                           06350058
063600                                                                  06360058
063700*--------------------------------------------------------------*  06370058
063800*  THIS ROUTINE CALLS THE NEW FISCAL CALENDAR SUBROUTINE       *  06380058
063900*  TO OBTAIN DATE, PROGRAM NAME DPKUT500                       *  06390058
064000*--------------------------------------------------------------*  06400058
064100 Z900-CALENDAR-ROUTINE.                                           06410058
064200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                06420058
064300                                             DPG52                06430058
064400                                             DPG53                06440058
064500                                             DPG54                06450058
064600                                             DPG55                06460058
064700                                             DPG56.               06470058
064800 EJECT.                                                           06480058
064900*--------------------------------------------------------------*  06490058
065000*  ORACLE ABEND ROUTINE                                        *  06500058
065100*--------------------------------------------------------------*  06510058
065200 Z998-ORA-ABEND.                                                  06520058
065300     DISPLAY '*********************************************'.     06530058
065400     DISPLAY '!!!!!!!!  PROGRAM APKUT411 ABENDING  !!!!!!!!'.     06540058
065500     DISPLAY '*********************************************'.     06550058
065600     DISPLAY 'AUDIT CURSOR COUNT     ' AUDIT-CSR-COUNT.           06560058
065700     DISPLAY 'AUDIT RECORDS WRITTEN  ' AUDIT-OUT-COUNT.           06570058
065800     DISPLAY '*********************************************'.     06580058
065900     DISPLAY '!!!!!!!!  PROGRAM APKUT411 ABENDING  !!!!!!!!'.     06590058
066000     DISPLAY '*********************************************'.     06600058
066100                                                                  06610058
066200     DISPLAY AA-ABEND-LIT.                                        06620058
066300     DISPLAY AA-ORA-ERROR-LIT.                                    06630058
066400     DISPLAY AA-PROGRAM-LIT.                                      06640058
066500     DISPLAY AA-PARAGRAPH-LIT.                                    06650058
066600     DISPLAY AA-ORA-OPERATION-LIT.                                06660058
066700     DISPLAY AA-ORA-TABLE-1.                                      06670058
066800     DISPLAY AA-ORA-TABLE-2.                                      06680058
066900     DISPLAY AA-ORA-TABLE-3.                                      06690058
067000     SET AC-ORA-ERROR TO TRUE.                                    06700058
067100                                                                  06710058
067200     COPY DPPD004.                                                06720058
067300                                                                  06730058
067400     CALL 'ILBOABN0' USING ABEND-CODE.                            06740058
067500                                                                  06750058
067600*--------------------------------------------------------------*  06760058
067700*  ABEND ROUTINE                                               *  06770058
067800*--------------------------------------------------------------*  06780058
067900 Z999-ABEND.                                                      06790058
068000     DISPLAY '*********************************************'.     06800058
068100     DISPLAY '!!!!!!!!  PROGRAM APKUT411 ABENDING  !!!!!!!!'.     06810058
068200     DISPLAY '*********************************************'.     06820058
068300     DISPLAY 'AUDIT CURSOR COUNT     ' AUDIT-CSR-COUNT.           06830058
068400     DISPLAY 'AUDIT RECORDS WRITTEN  ' AUDIT-OUT-COUNT.           06840058
068500     DISPLAY '*********************************************'.     06850058
068600     DISPLAY '!!!!!!!!  PROGRAM APKUT411 ABENDING  !!!!!!!!'.     06860058
068700     DISPLAY '*********************************************'.     06870058
068800                                                                  06880058
068900     DISPLAY AA-ABEND-LIT.                                        06890058
069000     DISPLAY AA-PROGRAM-LIT.                                      06900058
069100     DISPLAY AA-PARAGRAPH-LIT.                                    06910058
069200     DISPLAY AA-MESSAGE-LINE.                                     06920058
069300                                                                  06930058
069400     CALL 'ILBOABN0' USING ABEND-CODE.                            06940058
069500                                                                  06950058
