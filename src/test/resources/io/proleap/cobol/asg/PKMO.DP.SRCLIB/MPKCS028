000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MPKCS028.                                00050000
000600 AUTHOR.                 WILLIAM B. BURT.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            APRIL, 1991.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS A SCREEN ON THE LRT (LASER RADIO TERMINAL)00120000
001300******************************************************************00130000
001400                                                                  00140000
001500******************************************************************00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700******************************************************************00170000
001800                                                                  00180000
001900******************************************************************00190000
002000 DATA DIVISION.                                                   00200000
002100******************************************************************00210000
002200                                                                  00220000
002300******************************************************************00230000
002400 WORKING-STORAGE SECTION.                                         00240000
002500******************************************************************00250000
002600*                                                                 00260000
002700 01  CA-COMMAREA.                                                 00270000
002800     05  CA-COMMON-DATA.                                          00280000
002900         10  CA-TRANSACTION-STATUS                                00290000
003000                                         PIC  X(01)  VALUE SPACE. 00300000
003100             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00310000
003200             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00320000
003300         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00330000
003400     05  CA-PROGRAM-DATA.                                         00340000
003500         10  CA-ACTION-CODE              PIC  X(02)  VALUE SPACE. 00350000
003600             88  CA-CERTIFICATION-REQUIRED           VALUE '10'.  00360000
003700             88  CA-INSERT-SUCCESSFUL                VALUE '11'.  00370000
003800             88  CA-NO-SCAN                          VALUE '20'.  00380000
003900             88  CA-DECERTIFY-ALL-UPCS-FOR-SKU       VALUE '21'.  00390000
004000             88  CA-SKU-MISMATCH-DECERT-SCANNED      VALUE '30'.  00400000
004100             88  CA-NEW-VENDOR-UPC-LOADED            VALUE '40'.  00410000
004200             88  CA-DANGLING-UPC                     VALUE '50'.  00420000
004300             88  CA-NO-UPC-ON-MERCHANDISE            VALUE '60'.  00430000
004400         10  CA-OPER-UNT-ID              PIC S9(4)   VALUE ZEROS  00440000
004500                                                     COMP.        00450000
004600         10  CA-FCLTY-ID                 PIC S9(4)   VALUE ZEROS  00460000
004700                                                     COMP.        00470000
004800         10  CA-PO-NBR-X                 PIC  X(08)  VALUE SPACE. 00480000
004900         10  CA-PO-NBR  REDEFINES  CA-PO-NBR-X                    00490000
005000                                         PIC  9(08).              00500000
005100         10  CA-REC-SEQ-NBR-X            PIC  X(03)  VALUE SPACE. 00510000
005200         10  CA-REC-SEQ-NBR    REDEFINES  CA-REC-SEQ-NBR-X        00520000
005300                                         PIC  9(03).              00530000
005400         10  CA-LINE-ITEM-NBR-X          PIC  X(04)  VALUE SPACE. 00540000
005500         10  CA-LINE-ITEM-NBR  REDEFINES  CA-LINE-ITEM-NBR-X      00550000
005600                                         PIC  9(04).              00560000
005610******************************************************************00570000
005620*   SIZE OF CA-SEQ-NBR IS INCREASED FROM X(3) TO X(8). WR# 21361 *00580000
005630******************************************************************00590000
005700         10  CA-SKU-NBR.                                          00600000
005800             15  CA-MERCH-DEPT-NBR       PIC  X(03)  VALUE SPACE. 00610000
005900             15  FILLER                  PIC  X(01)  VALUE SPACE. 00620000
006000             15  CA-MERCH-CLASS-NBR      PIC  X(02)  VALUE SPACE. 00630000
006100             15  FILLER                  PIC  X(01)  VALUE SPACE. 00640000
006210             15  CA-SEQ-NBR              PIC  X(08)  VALUE SPACE. 00650000
006220******************************************************************00660000
006230*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *00670000
006240******************************************************************00680000
006300         10  CA-CURRENT-UNIT-RETAIL-AMOUNT                        00690000
006400                                         PIC  9(05)V9(02)         00700001
006500                                                     VALUE ZEROS. 00710000
006600         10  CA-SKU-DESC                 PIC  X(19)  VALUE SPACE. 00720000
006700         10  CA-SIZE-DESC                PIC  X(05)  VALUE SPACE. 00730000
006800         10  CA-COLOR-DESC               PIC  X(04)  VALUE SPACE. 00740000
006900         10  CA-FORMATTED-GROUP-PRICING  PIC  X(09)  VALUE SPACE. 00750002
007000         10  CA-VENDOR-STYLE-CODE        PIC  X(15)  VALUE SPACE. 00760000
007100         10  CA-IN-HOUSE-VENDOR-NAME     PIC  X(19)  VALUE SPACE. 00770000
007200         10  CA-ITEM-NBR                 PIC S9(15)  VALUE ZEROS  00780000
007300                                                     COMP-3.      00790000
007400         10  CA-UPC-NBR-X                PIC  X(13)  VALUE SPACE. 00800000
007500         10  CA-UPC-NBR   REDEFINES CA-UPC-NBR-X                  00810000
007600                                         PIC  9(13).              00820000
007700         10  CA-UPC-FIRST-12  REDEFINES CA-UPC-NBR-X.             00830000
007800             15  CA-FIRST-TWELVE-BYTES-OF-UPC                     00840000
007900                                         PIC  9(12).              00850000
008000             15  CA-CHECK-DIGIT          PIC  X(01).              00860000
008100         10  CA-UPC-LAST-12  REDEFINES CA-UPC-NBR-X.              00870000
008200             15  CA-FIRST-DIGIT-COUNTRY-CODE                      00880000
008300                                         PIC  X(01).              00890000
008400             15  CA-LAST-TWELVE-BYTES-OF-UPC                      00900000
008500                                         PIC  9(12).              00910000
008600         10  CA-MISMATCHED-ITEM-NBR      PIC S9(15)  VALUE ZEROS  00920000
008700                                                     COMP-3.      00930000
008800         10  CA-MDSE-PRC-AREA-CDE        PIC  X(06)  VALUE SPACE. 00940000
008900         10  CA-MISMATCHED-UPC-NBR       PIC S9(15)  VALUE ZEROS  00950000
009000                                                     COMP-3.      00960000
009100*                                                                 00970000
009200 01  PC-PROGRAM-CONSTANTS.                                        00980000
009300     05  PC-TRANID                       PIC  X(04)  VALUE 'M028'.00990000
009400     05  PC-CERTIFY-SELECTION-TRANID     PIC  X(04)  VALUE 'M023'.01000000
009500     05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +166   01010003
009600                                                     COMP SYNC.   01020000
009700     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     01030000
009800                                                     COMP SYNC.   01040000
009900     05  PC-CERTIFY-SELECTION-PGM        PIC  X(08)  VALUE        01050000
010000         'MPKCS023'.                                              01060000
010100     05  PC-CERTIFY-PGM                  PIC  X(08)  VALUE        01070000
010200         'MPKCS024'.                                              01080000
010300     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01090000
010400         'MPKCS028'.                                              01100000
010500     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01110000
010600         'TRANS NOT AVAILABLE'.                                   01120000
010700     05  PC-ENTER-THROUGH-MENU-MSG       PIC  X(19)  VALUE        01130000
010800         'ENTER THROUGH MENU '.                                   01140000
010900     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        01150000
011000         'UNRECOGNIZED PF KEY'.                                   01160000
011100     05  PC-DB2-DATABASE-ERROR-MSG       PIC  X(19)  VALUE        01170000
011200         'DB2 ACCESS ERROR   '.                                   01180000
011300     05  PC-CICS-ERROR-MSG               PIC  X(19)  VALUE        01190000
011400         'CICS ACCESS ERROR  '.                                   01200000
011500     05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   01210000
011600                                                     COMP SYNC.   01220000
011700*                                                                 01230000
011800 01  PV-PROGRAM-VARIABLES.                                        01240000
020900     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   01250000
021000                                                     COMP SYNC.   01260000
011900     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01270000
012000     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01280000
012100                                                     COMP SYNC.   01290000
012200     05  PV-INSERT-COUNTER               PIC S9(04)  VALUE +0     01300000
012300                                                     COMP SYNC.   01310000
012400     05  PV-DELETE-COUNTER               PIC S9(04)  VALUE +0     01320000
012500                                                     COMP SYNC.   01330000
012600     05  PV-USER-ID-NBR                  PIC  X(08)  VALUE SPACE. 01340000
021600     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01350000
012700                                                                  01360000
012800 01  DK-DB2-KEYS.                                                 01370000
012900     05  DK-PO-NBR                       PIC  S9(9) VALUE ZEROS   01380000
013000                                                    COMP.         01390000
013100     05  DK-REC-SEQ-NBR                  PIC  S9(9) VALUE ZEROS   01400000
013200                                                    COMP.         01410000
013300     05  DK-PO-LNE-NBR                   PIC  S9(9) VALUE ZEROS   01420000
013400                                                    COMP.         01430000
013500                                                                  01440000
013510******************************************************************01450000
013520*  SIZE OF ASKU INCREASED AND NUMBER OF COLUMNS OF     WR# 21361 *01460000
013530*  THE MAP INCREASED.                                            *01470000
013540******************************************************************01480000
013600*                                                                 01490000
013700*  GENEREATED DSECT FOR THE MPKM028 MAPSET                        01500000
013800*                                                                 01510000
013900     COPY MPKM028.                                                01520000
014000                                                                  01530000
028300******************************************************************01540000
028400* HELP SCREEN COMMAREA                                            01550000
028500******************************************************************01560000
028600     COPY PCWS192.                                                01570000
028700******************************************************************01580000
028800* HELP SCREEN WORK AREA                                           01590000
028900******************************************************************01600000
029000     COPY PCWS188.                                                01610000
029100/                                                                 01620000
014010******************************************************************01630000
014011*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *01640000
014020******************************************************************01650000
014100*                                                                 01660000
014200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01670000
014300*                                                                 01680000
014400     COPY DPWS013.                                                01690000
014500                                                                  01700000
014600*                                                                 01710000
014700*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01720000
014800*                                                                 01730000
014900     COPY DFHAID.                                                 01740000
015000                                                                  01750000
015100*                                                                 01760000
015200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE UPC CERTIFICATION  01770000
015300*  TABLE.                                                         01780000
015400*                                                                 01790000
015500     EXEC SQL                                                     01800000
015600         INCLUDE TUPCCER                                          01810000
015700     END-EXEC.                                                    01820000
015800                                                                  01830000
015900*                                                                 01840000
016000*  COMMUNICATIONS AREA FOR DB2                                    01850000
016100*                                                                 01860000
016200     EXEC SQL                                                     01870000
016300         INCLUDE SQLCA                                            01880000
016400     END-EXEC.                                                    01890000
016500                                                                  01900000
016600******************************************************************01910000
016700 LINKAGE SECTION.                                                 01920000
016800******************************************************************01930000
016810******************************************************************01940000
016820*                                                      WR# 21361 *01950000
016821*   SIZE OF DFHCOMMAREA IS INCREASED FROM X(150) TO X(155).      *01960000
016830******************************************************************01970000
016910 01  DFHCOMMAREA                   PIC  X(155).                   01980000
016920******************************************************************01990000
016930*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *02000000
016940******************************************************************02010000
017000                                                                  02020000
017100******************************************************************02030000
017200 PROCEDURE DIVISION.                                              02040000
017300******************************************************************02050000
017400 0000-PROGRAM-MAINLINE.                                           02060000
040300     IF EIBTRNID = 'Z278'                                         02070000
040400         MOVE DFHCOMMAREA            TO PC192-COMMAREA            02080000
040500         MOVE PC192-HOST-SAVE-AREA   TO CA-COMMAREA               02090000
040600     ELSE                                                         02100000
017500         MOVE DFHCOMMAREA TO CA-COMMAREA                          02110000
           END-IF                                                       02120000
                                                                        02130000
017600     MOVE LOW-VALUES  TO MP028AI.                                 02140000
017700                                                                  02150000
017800     EVALUATE TRUE                                                02160000
017900         WHEN EIBCALEN = ZERO                                     02170000
018000             MOVE PC-ENTER-THROUGH-MENU-MSG TO PV-MESSAGE-AREA    02180000
018100             PERFORM 8300-RETURN                                  02190000
018200         WHEN CA-INITIALIZE-SCREEN                                02200000
018300             SET CA-PROCESS-SCREEN TO TRUE                        02210000
018400             PERFORM 2000-FILL-SCREEN                             02220000
018500             PERFORM 8000-SEND-MAP                                02230000
018600             PERFORM 8200-RETURN-TRANID                           02240000
018700         WHEN EIBAID = DFHCLEAR                                   02250000
018800             PERFORM 2000-FILL-SCREEN                             02260000
018900             PERFORM 8000-SEND-MAP                                02270000
019000             PERFORM 8200-RETURN-TRANID                           02280000
019100         WHEN EIBAID = DFHENTER                                   02290000
019200             MOVE CA-IN-HOUSE-VENDOR-NAME TO AMSGLNO              02300000
019300             PERFORM 8100-SEND-DATA-ONLY                          02310000
019400             PERFORM 8200-RETURN-TRANID                           02320000
019500         WHEN EIBAID = DFHPF3                                     02330000
019600             PERFORM 1000-XCTL-CERTIFY-SELECT-PGM                 02340000
019700         WHEN EIBAID = DFHPF7                                     02350000
019800             PERFORM 2100-DETERMINE-USER-ID                       02360000
019900             SET CA-CERTIFICATION-REQUIRED TO TRUE                02370000
020000             PERFORM 2300-DEL-CERT-REQ-ROW-TUPCCER                02380000
020100             SET CA-NO-UPC-ON-MERCHANDISE TO TRUE                 02390000
020200             PERFORM 2300-INSERT-TUPCCER                          02400000
020300             PERFORM 1000-XCTL-CERTIFY-SELECT-PGM                 02410000
020400         WHEN EIBAID = DFHPF9                                     02420000
020500             PERFORM 1100-XCTL-CERTIFY-PGM                        02430000
042800         WHEN EIBAID = DFHPF1                                     02440000
042900              PERFORM 1400-HELP-SCREEN                            02450000
020600         WHEN OTHER                                               02460000
020700             MOVE PC-UNRECOGNIZED-PF-KEY-MSG TO AMSGLNO           02470000
020800             PERFORM 8100-SEND-DATA-ONLY                          02480000
020900             PERFORM 8200-RETURN-TRANID                           02490000
021000     END-EVALUATE.                                                02500000
021100                                                                  02510000
021200     GOBACK.                                                      02520000
021300*                                                                 02530000
021400 1000-XCTL-CERTIFY-SELECT-PGM.                                    02540000
021500     SET CA-INITIALIZE-SCREEN     TO TRUE.                        02550000
021600     MOVE PC-CURRENT-PROGRAM-NAME TO CA-LAST-PROGRAM.             02560000
021700                                                                  02570000
021800     EXEC CICS                                                    02580000
021900         XCTL  PROGRAM   (PC-CERTIFY-SELECTION-PGM)               02590000
022000               COMMAREA  (CA-COMMAREA)                            02600000
022100               LENGTH    (PC-COMMAREA-LENGTH)                     02610000
022200               RESP      (PV-CICS-RESPONSE)                       02620000
022300     END-EXEC.                                                    02630000
022400                                                                  02640000
022500     EVALUATE TRUE                                                02650000
022600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02660000
022700             CONTINUE                                             02670000
022800         WHEN OTHER                                               02680000
022900             MOVE '1000-XCTL-CERTIFY-SELECT-PGM'                  02690000
023000                 TO DP013-PARAGRAPH                               02700000
023100             MOVE 'UNABLE TO XCTL TO UPC CERTIFICATION SELECTION' 02710000
023200                 TO DP013-MESSAGE-TEXT (1)                        02720000
023300             MOVE 'PROGRAM: '                                     02730000
023400                 TO DP013-MESSAGE-TEXT (2)                        02740000
023500             MOVE PC-CERTIFY-SELECTION-PGM                        02750000
023600                 TO DP013-MESSAGE-TEXT (3)                        02760000
023700             SET DP013-CICS-ABEND TO TRUE                         02770000
023800             SET DP013-ROLLBACK   TO TRUE                         02780000
023900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               02790000
024000             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             02800000
024100             PERFORM 8100-SEND-DATA-ONLY                          02810000
024200             PERFORM 8200-RETURN-TRANID                           02820000
024300     END-EVALUATE.                                                02830000
024400*                                                                 02840000
024500 1100-XCTL-CERTIFY-PGM.                                           02850000
024600     SET CA-INITIALIZE-SCREEN TO TRUE.                            02860000
024700     MOVE PC-CURRENT-PROGRAM-NAME TO CA-LAST-PROGRAM.             02870000
024800                                                                  02880000
024900     EXEC CICS                                                    02890000
025000         XCTL  PROGRAM   (PC-CERTIFY-PGM)                         02900000
025100               COMMAREA  (CA-COMMAREA)                            02910000
025200               LENGTH    (PC-COMMAREA-LENGTH)                     02920000
025300               RESP      (PV-CICS-RESPONSE)                       02930000
025400     END-EXEC.                                                    02940000
025500                                                                  02950000
025600     EVALUATE TRUE                                                02960000
025700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02970000
025800             CONTINUE                                             02980000
025900         WHEN OTHER                                               02990000
026000             MOVE '1100-XCTL-CERTIFY-PGM'                         03000000
026100                 TO DP013-PARAGRAPH                               03010000
026200             MOVE 'UNABLE TO XCTL TO THE UPC CERTIFICATION'       03020000
026300                 TO DP013-MESSAGE-TEXT (1)                        03030000
026400             MOVE 'PROGRAM: '                                     03040000
026500                 TO DP013-MESSAGE-TEXT (2)                        03050000
026600             MOVE PC-CERTIFY-PGM                                  03060000
026700                 TO DP013-MESSAGE-TEXT (3)                        03070000
026800             SET DP013-CICS-ABEND  TO TRUE                        03080000
026900             SET DP013-NO-ROLLBACK TO TRUE                        03090000
027000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03100000
027100             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             03110000
027200             SET CA-PROCESS-SCREEN         TO TRUE                03120000
027300             PERFORM 8100-SEND-DATA-ONLY                          03130000
027400             PERFORM 8200-RETURN-TRANID                           03140000
027500     END-EVALUATE.                                                03150000
027600*                                                                 03160000
053900 1400-HELP-SCREEN.                                                03170000
054000     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03180000
054100     MOVE 'MPKCS028'                  TO PC192-PROGRAM-NAME       03190000
054200     COPY PCPD188.                                                03200000
054300     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03210000
054400     PERFORM 2200-XCTL-TO-HELP.                                   03220000
054500                                                                  03230000
027700 2000-FILL-SCREEN.                                                03240000
027800     MOVE CA-SKU-NBR                     TO  ASKUO.               03250000
027900     MOVE CA-SKU-DESC                    TO  ADESCO.              03260000
028000     MOVE CA-SIZE-DESC                   TO  ASIZEO.              03270000
028100     MOVE CA-COLOR-DESC                  TO  ACOLORO.             03280000
028200     MOVE CA-VENDOR-STYLE-CODE           TO  ASTYLEO.             03290000
028300     MOVE CA-CURRENT-UNIT-RETAIL-AMOUNT  TO  ARETAILO.            03300000
028400     MOVE CA-FORMATTED-GROUP-PRICING     TO  AGRPRTLO.            03310000
028500     MOVE CA-IN-HOUSE-VENDOR-NAME        TO  AMSGLNO.             03320000
028600*                                                                 03330000
028700 2100-DETERMINE-USER-ID.                                          03340000
028800     EXEC CICS                                                    03350000
028900         ASSIGN USERID  (PV-USER-ID-NBR)                          03360000
029000                RESP    (PV-CICS-RESPONSE)                        03370000
029100     END-EXEC.                                                    03380000
029200                                                                  03390000
029300     EVALUATE TRUE                                                03400000
029400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03410000
029500             CONTINUE                                             03420000
029600         WHEN OTHER                                               03430000
029700             MOVE '2100-DETERMINE-USER-ID' TO DP013-PARAGRAPH     03440000
029800             MOVE 'UNABLE TO ASSIGN USER-ID'                      03450000
029900                 TO DP013-MESSAGE-TEXT (1)                        03460000
030000             SET DP013-CICS-ABEND          TO TRUE                03470000
030100             SET DP013-NO-ROLLBACK         TO TRUE                03480000
030200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03490000
030300             MOVE PC-CICS-ERROR-MSG TO AMSGLNO                    03500000
030400             PERFORM 8100-SEND-DATA-ONLY                          03510000
030500             PERFORM 8200-RETURN-TRANID                           03520000
030600     END-EVALUATE.                                                03530000
030700*                                                                 03540000
060500 2200-XCTL-TO-HELP.                                               03550000
060600                                                                  03560000
060700     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      03570000
060800     SET CA-INITIALIZE-SCREEN         TO TRUE.                    03580000
060900     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    03590000
061000                                                                  03600000
061100     EXEC CICS                                                    03610000
061200         XCTL                                                     03620000
061300             PROGRAM   (PV-TRANSFER-PROGRAM)                      03630000
061400             COMMAREA  (PC192-COMMAREA)                           03640000
061500             LENGTH    (PV-COMMAREA-LENGTH)                       03650000
061600             RESP      (PV-CICS-RESPONSE)                         03660000
061700     END-EXEC.                                                    03670000
022500     EVALUATE TRUE                                                03680000
022600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03690000
022700             CONTINUE                                             03700000
022800         WHEN OTHER                                               03710000
022900             MOVE '2200-XCTL-TO HELP'                             03720000
023000                 TO DP013-PARAGRAPH                               03730000
023100             MOVE 'UNABLE TO XCTL TO HELP SCREEN'                 03740000
023200                 TO DP013-MESSAGE-TEXT (1)                        03750000
023300             MOVE 'PROGRAM: '                                     03760000
023400                 TO DP013-MESSAGE-TEXT (2)                        03770000
023500             MOVE PC-CERTIFY-SELECTION-PGM                        03780000
023600                 TO DP013-MESSAGE-TEXT (3)                        03790000
023700             SET DP013-CICS-ABEND TO TRUE                         03800000
023800             SET DP013-ROLLBACK   TO TRUE                         03810000
023900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               03820000
024000             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             03830000
024100             PERFORM 8100-SEND-DATA-ONLY                          03840000
024200             PERFORM 8200-RETURN-TRANID                           03850000
024300     END-EVALUATE.                                                03860000
024400*                                                                 03870000
061800                                                                  03880000
030800 2300-DEL-CERT-REQ-ROW-TUPCCER.                                   03890000
030900     MOVE CA-PO-NBR        TO DK-PO-NBR.                          03900000
031000     MOVE CA-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.                     03910000
031100     MOVE CA-LINE-ITEM-NBR TO DK-PO-LNE-NBR.                      03920000
031200     PERFORM                                                      03930000
031300         WITH TEST AFTER                                          03940000
031400         VARYING PV-DELETE-COUNTER                                03950000
031500         FROM 1 BY 1                                              03960000
031600         UNTIL (PV-DELETE-COUNTER > PC-MAX-RETRIES                03970000
031700                   OR SQLCODE = ZERO                              03980000
031800                   OR SQLCODE = PC-ROW-NOT-FOUND)                 03990000
031900                                                                  04000000
032000         EXEC SQL                                                 04010000
032100             DELETE FROM TUPCCER                                  04020000
032200              WHERE (PO_NBR = :DK-PO-NBR                          04030000
032300                AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                 04040000
032400                AND PO_LNE_NBR = :DK-PO-LNE-NBR                   04050000
032500                AND ACT_CDE = :CA-ACTION-CODE)                    04060000
032600         END-EXEC                                                 04070000
032700                                                                  04080000
032800         EVALUATE TRUE                                            04090000
032900             WHEN SQLCODE = ZERO                                  04100000
033000             WHEN SQLCODE = PC-ROW-NOT-FOUND                      04110000
033100             WHEN SQLCODE = -904                                  04120000
033200             WHEN SQLCODE = -913                                  04130000
033300                 CONTINUE                                         04140000
033400             WHEN SQLWARN0 NOT = SPACES                           04150000
033500             WHEN SQLCODE < ZERO                                  04160000
033600             WHEN SQLCODE > ZERO                                  04170000
033700                 MOVE '2300-DEL-CERT-REQ-ROW-TUPCCER'             04180000
033800                     TO DP013-PARAGRAPH                           04190000
033900                 MOVE 'DELETE A ROW FROM THE UPC CERTIFICATION'   04200000
034000                     TO DP013-MESSAGE-TEXT (1)                    04210000
034100                 MOVE 'TABLE FOR THE FOLLOWING KEYREC AND LINE ITE04220000
034200-                     'M NUMBER: '                                04230000
034300                     TO DP013-MESSAGE-TEXT (2)                    04240000
034400                 MOVE CA-PO-NBR-X                                 04250000
034500                     TO DP013-MESSAGE-TEXT (3)                    04260000
034600                 MOVE CA-LINE-ITEM-NBR-X                          04270000
034700                     TO DP013-MESSAGE-TEXT (4)                    04280000
034800                 MOVE SQLCA          TO DP013-SQLCA               04290000
034900                 MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)  04300000
035000                 SET DP013-DB2-ABEND TO TRUE                      04310000
035100                 SET DP013-ROLLBACK  TO TRUE                      04320000
035200                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           04330000
035300                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO        04340000
035400                 PERFORM 8100-SEND-DATA-ONLY                      04350000
035500                 PERFORM 8200-RETURN-TRANID                       04360000
035600         END-EVALUATE                                             04370000
035700     END-PERFORM.                                                 04380000
035800                                                                  04390000
035900     IF PV-DELETE-COUNTER > PC-MAX-RETRIES                        04400000
036000         MOVE '2300-DEL-CERT-REQ-ROW-TUPCCER'                     04410000
036100             TO DP013-PARAGRAPH                                   04420000
036200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO DELETE A ROW04430000
036300-             'FROM THE UPC'                                      04440000
036400             TO DP013-MESSAGE-TEXT (1)                            04450000
036500         MOVE 'CERTIFICATION TABLE FOR THE FOLLOWING   PO AND LINE04460000
036600-             'ITEM NUMBER:'                                      04470000
036700             TO DP013-MESSAGE-TEXT (2)                            04480000
036800         MOVE CA-PO-NBR-X                                         04490000
036900             TO DP013-MESSAGE-TEXT (3)                            04500000
037000         MOVE CA-LINE-ITEM-NBR-X                                  04510000
037100             TO DP013-MESSAGE-TEXT (4)                            04520000
037200         MOVE SQLCA          TO DP013-SQLCA                       04530000
037300         MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)          04540000
037400         SET DP013-DB2-ABEND TO TRUE                              04550000
037500         SET DP013-ROLLBACK  TO TRUE                              04560000
037600         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04570000
037700         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO                04580000
037800         PERFORM 8100-SEND-DATA-ONLY                              04590000
037900         PERFORM 8200-RETURN-TRANID                               04600000
038000     END-IF.                                                      04610000
038100*                                                                 04620000
038200 2300-INSERT-TUPCCER.                                             04630000
038300     INITIALIZE DCLTUPCCER.                                       04640000
038400                                                                  04650000
038500     PERFORM                                                      04660000
038600         WITH TEST AFTER                                          04670000
038700         VARYING PV-INSERT-COUNTER                                04680000
038800         FROM 1 BY 1                                              04690000
038900         UNTIL (PV-INSERT-COUNTER > PC-MAX-RETRIES                04700000
039000                   OR SQLCODE = ZERO)                             04710000
039100                                                                  04720000
039200         EXEC SQL                                                 04730000
039300             INSERT INTO TUPCCER                                  04740000
039400                    (MDSE_LNE_ITM_NBR,                            04750000
039500                     CRE_TMST,                                    04760000
039600                     ACT_CDE,                                     04770000
039700                     OPER_UNT_ID,                                 04780000
039800                     PO_NBR,                                      04790000
039900                     REC_SEQ_NBR,                                 04800000
040000                     PO_LNE_NBR,                                  04810000
040100                     UID_NBR,                                     04820000
040200                     UPC_NBR,                                     04830000
040300                     FUNC_CDE,                                    04840000
040400                     SCAN_ITM_NBR,                                04850000
040500                     MDSE_PRC_AREA_CDE,                           04860000
040600                     REQ_FOR_CERT_CDE)                            04870000
040700             VALUES (:CA-ITEM-NBR,                                04880000
040800                      CURRENT TIMESTAMP,                          04890000
040900                     :CA-ACTION-CODE,                             04900000
041000                     :CA-OPER-UNT-ID,                             04910000
041100                     :DK-PO-NBR,                                  04920000
041200                     :DK-REC-SEQ-NBR,                             04930000
041300                     :DK-PO-LNE-NBR,                              04940000
041400                     :PV-USER-ID-NBR,                             04950000
041500                     :UPCCER-UPC-NBR,                             04960000
041600                     '1',                                         04970000
041700                     :UPCCER-SCAN-ITM-NBR,                        04980000
041800                     :CA-MDSE-PRC-AREA-CDE,                       04990000
041900                     'N')                                         05000000
042000         END-EXEC                                                 05010000
042100                                                                  05020000
042200         EVALUATE TRUE                                            05030000
042300             WHEN SQLCODE = ZERO                                  05040000
042400             WHEN SQLCODE = -904                                  05050000
042500             WHEN SQLCODE = -913                                  05060000
042600                 CONTINUE                                         05070000
042700             WHEN SQLWARN0 NOT = SPACES                           05080000
042800             WHEN SQLCODE < ZERO                                  05090000
042900             WHEN SQLCODE > ZERO                                  05100000
043000                 MOVE '2300-INSERT-TUPCCER'                       05110000
043100                     TO DP013-PARAGRAPH                           05120000
043200                 MOVE 'INSERT A ROW TO THE UPC CERTIFICATION'     05130000
043300                     TO DP013-MESSAGE-TEXT (1)                    05140000
043400                 MOVE 'TABLE FOR THE FOLLOWING ITEM NUMBER: '     05150000
043500                     TO DP013-MESSAGE-TEXT (2)                    05160000
043600                 MOVE CA-ITEM-NBR                                 05170000
043700                     TO DP013-MESSAGE-TEXT (3)                    05180000
043800                 MOVE SQLCA          TO DP013-SQLCA               05190000
043900                 MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)  05200000
044000                 SET DP013-DB2-ABEND TO TRUE                      05210000
044100                 SET DP013-ROLLBACK  TO TRUE                      05220000
044200                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           05230000
044300                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO        05240000
044400                 PERFORM 8100-SEND-DATA-ONLY                      05250000
044500                 PERFORM 8200-RETURN-TRANID                       05260000
044600         END-EVALUATE                                             05270000
044700     END-PERFORM.                                                 05280000
044800                                                                  05290000
044900     IF PV-INSERT-COUNTER > PC-MAX-RETRIES                        05300000
045000         MOVE '2300-INSERT-TUPCCER'                               05310000
045100             TO DP013-PARAGRAPH                                   05320000
045200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A'   05330000
045300             TO DP013-MESSAGE-TEXT (1)                            05340000
045400         MOVE 'ROW TO THE UPC CERTIFICATION TABLE FOR THE'        05350000
045500             TO DP013-MESSAGE-TEXT (2)                            05360000
045600         MOVE 'FOLLOWING ITEM NUMBER: '                           05370000
045700             TO DP013-MESSAGE-TEXT (3)                            05380000
045800          MOVE CA-ITEM-NBR                                        05390000
045900             TO DP013-MESSAGE-TEXT (4)                            05400000
046000         MOVE SQLCA          TO DP013-SQLCA                       05410000
046100         MOVE 'TUPCCER'      TO DP013-DB2-TABLE-NAME (1)          05420000
046200         SET DP013-DB2-ABEND TO TRUE                              05430000
046300         SET DP013-ROLLBACK  TO TRUE                              05440000
046400         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   05450000
046500         MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO                05460000
046600         PERFORM 8100-SEND-DATA-ONLY                              05470000
046700         PERFORM 8200-RETURN-TRANID                               05480000
046800     END-IF.                                                      05490000
046900*                                                                 05500000
047000 8000-SEND-MAP.                                                   05510000
047100     EXEC CICS                                                    05520000
047200         SEND MAP       ('MP028A')                                05530000
047300              MAPSET    ('MPKM028')                               05540000
047400              ERASE                                               05550000
047500              RESP      (PV-CICS-RESPONSE)                        05560000
047600     END-EXEC.                                                    05570000
047700                                                                  05580000
047800     EVALUATE TRUE                                                05590000
047900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05600000
048000             CONTINUE                                             05610000
048100         WHEN OTHER                                               05620000
048200             MOVE '8000-SEND-MAP'      TO DP013-PARAGRAPH         05630000
048300             MOVE 'UNABLE TO SEND MAP' TO DP013-MESSAGE-TEXT (1)  05640000
048400             SET DP013-CICS-ABEND      TO TRUE                    05650000
048500             SET DP013-ROLLBACK        TO TRUE                    05660000
048600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05670000
048700     END-EVALUATE.                                                05680000
048800*                                                                 05690000
048900 8100-SEND-DATA-ONLY.                                             05700000
049000     EXEC CICS                                                    05710000
049100         SEND MAP       ('MP028A')                                05720000
049200              MAPSET    ('MPKM028')                               05730000
049300              CURSOR                                              05740000
049400              DATAONLY                                            05750000
049500              RESP      (PV-CICS-RESPONSE)                        05760000
049600     END-EXEC.                                                    05770000
049700                                                                  05780000
049800     EVALUATE TRUE                                                05790000
049900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05800000
050000             CONTINUE                                             05810000
050100         WHEN OTHER                                               05820000
050200             MOVE '8100-SEND-DATA-ONLY' TO DP013-PARAGRAPH        05830000
050300             MOVE 'UNABLE TO SEND DATA' TO DP013-MESSAGE-TEXT (1) 05840000
050400             SET DP013-CICS-ABEND       TO TRUE                   05850000
050500             SET DP013-ROLLBACK         TO TRUE                   05860000
050600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05870000
050700     END-EVALUATE.                                                05880000
050800*                                                                 05890000
050900 8200-RETURN-TRANID.                                              05900000
051000     EXEC CICS                                                    05910000
051100         RETURN TRANSID  (PC-TRANID)                              05920000
051200                COMMAREA (CA-COMMAREA)                            05930000
051300                LENGTH   (PC-COMMAREA-LENGTH)                     05940000
051400                RESP     (PV-CICS-RESPONSE)                       05950000
051500     END-EXEC.                                                    05960000
051600                                                                  05970000
051700     EVALUATE TRUE                                                05980000
051800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05990000
051900             CONTINUE                                             06000000
052000         WHEN OTHER                                               06010000
052100             MOVE '8200-RETURN-TRANIND' TO DP013-PARAGRAPH        06020000
052200             MOVE 'UNABLE TO RETURN TO TRANID'                    06030000
052300                 TO DP013-MESSAGE-TEXT (1)                        06040000
052400             SET DP013-CICS-ABEND       TO TRUE                   06050000
052500             SET DP013-ROLLBACK         TO TRUE                   06060000
052600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06070000
052700     END-EVALUATE.                                                06080000
052800*                                                                 06090000
052900 8300-RETURN.                                                     06100000
053000     EXEC CICS                                                    06110000
053100         SEND FROM (PV-MESSAGE-AREA)                              06120000
053200              LENGTH (19)                                         06130000
053300              ERASE                                               06140000
053400     END-EXEC.                                                    06150000
053500                                                                  06160000
053600     EXEC CICS                                                    06170000
053700         RETURN                                                   06180000
053800     END-EXEC.                                                    06190000
053900*                                                                 06200000
054000 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  06210000
054100     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              06220000
054200     MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             06230000
054300     INITIALIZE DP013-SRC-TASK-NUMBER                             06240000
054400                DP013-STACK.                                      06250000
054500     SET DP013-LINK-RETURN TO TRUE.                               06260000
054600                                                                  06270000
054700     EXEC CICS                                                    06280000
054800         LINK                                                     06290000
054900             PROGRAM   (DP013-NAME)                               06300000
055000             COMMAREA  (DP013-PARAMETERS)                         06310000
055100             LENGTH    (DP013-LENGTH)                             06320000
055200     END-EXEC.                                                    06330000
055300*                                                                 06340000
