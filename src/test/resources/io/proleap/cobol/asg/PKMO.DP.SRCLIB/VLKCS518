000100*-----------------------*                                         05/02/95
000200 IDENTIFICATION DIVISION.                                         DPKCS036
000300*-----------------------*                                            LV002
000400 PROGRAM-ID.    VLKCS518.                                         DPKCS036
000500 AUTHOR.        MIKE WALTERS.                                     DPKCS036
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          DPKCS036
000700 DATE-WRITTEN.  12-10-96.                                         DPKCS036
000800 DATE-COMPILED.                                                   DPKCS036
000900                                                                  DPKCS036
001000*---------------------------------------------------------------* DPKCS036
001100*    V518 - TICKET FORMAT LIST PROGRAM.                         * DPKCS036
001200*                                                               * DPKCS036
001300*    THIS PROGRAM GENERATES A LIST OF THE AVAILABLE TICKET      * DPKCS036
001400*    FORMATS.  THE USER CAN SELECT 1 OR MORE FORMATS, AND UPDATE* DPKCS036
001500*    OR DELETE THEM...NOT SELECTION OS NECESSARY TO ADD A NEW   * DPKCS036
001600*    TICKET FORMAT.                                             * DPKCS036
001700*                                                               * DPKCS036
001710*    DAN H (11/3/97)  THIS IS A COPY OF VLKCS518 WHERE WE SPLIT * DPKCS036
001720*    THE DRIVING CURSOR TO DO A SEPARATE CALL FOR THE TVSCHVL   * DPKCS036
001730*    TABLE.  THE CALL TO THIS TABLE CAN BE FOUND IN PARAGRAPH   * DPKCS036
001740*    "4320-GET-PRETICKET-INFO".                                 * DPKCS036
001750*                                                               * DPKCS036
001800*---------------------------------------------------------------* DPKCS036
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*---------------------------------------------------------------*         
CICS  * CHANGED 11/14/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
001900 EJECT                                                            DPKCS036
002000 ENVIRONMENT DIVISION.                                            DPKCS036
002100                                                                  DPKCS036
002200 DATA DIVISION.                                                   DPKCS036
002300                                                                  DPKCS036
002400 WORKING-STORAGE SECTION.                                         DPKCS036
002500                                                                  DPKCS036
002600 01  PC-PROGRAM-CONSTANTS.                                        DPKCS036
002700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         DPKCS036
002800                                                    'VL518A  '.   DPKCS036
002900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         DPKCS036
003000                                                    'VLKM518 '.   DPKCS036
003100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         DPKCS036
003200                                                    'VLKCS518'.   DPKCS036
003300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      DPKCS036
003400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      DPKCS036
003500     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    DPKCS036
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     DPKCS036
003700                                                    COMP SYNC.    DPKCS036
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      DPKCS036
003900                                                    COMP SYNC.    DPKCS036
003910     05  PC-VS-TICKET-TYPE-CDE          PIC S9(04)  VALUE +2              
003920                                                    COMP SYNC.    DPKCS036
004000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         DPKCS036
004100                                                    +1000000      DPKCS036
004200                                                    COMP-3.       DPKCS036
004300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      DPKCS036
004400                                                    COMP SYNC.    DPKCS036
004500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       DPKCS036
004600                                                    COMP-3.       DPKCS036
004700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    DPKCS036
004800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  DPKCS036
004900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  DPKCS036
005000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  DPKCS036
005100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  DPKCS036
005200*                                                                 DPKCS036
005300     05  PC-TSYMSG-NUMBERS.                                       DPKCS036
005400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  DPKCS036
005500         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  DPKCS036
005600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  DPKCS036
005700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  DPKCS036
005800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  DPKCS036
005900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  DPKCS036
006000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  DPKCS036
006100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  DPKCS036
006200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  DPKCS036
006300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  DPKCS036
006400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  DPKCS036
006500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  DPKCS036
006510         10  PC-TSYMSG-00112            PIC  9(05)  VALUE 00112.  DPKCS036
006600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  DPKCS036
006700         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  DPKCS036
006800*                                                                 DPKCS036
006900 01  PS-PROGRAM-SWITCHES.                                         DPKCS036
007000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    DPKCS036
007100         88  PS-NO-ERROR                            VALUE 'Y'.    DPKCS036
007200         88  PS-ERROR                               VALUE 'N'.    DPKCS036
007300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    DPKCS036
007400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    DPKCS036
007500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    DPKCS036
007600     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    DPKCS036
007700         88  PS-DONE                                VALUE 'Y'.    DPKCS036
007800         88  PS-NOT-DONE                            VALUE 'N'.    DPKCS036
007900*                                                                 DPKCS036
008000 01  PV-PROGRAM-VARIABLES.                                        DPKCS036
008100     05  PV-SUB                         PIC S9(04)  VALUE +0      DPKCS036
008200                                                    COMP SYNC.    DPKCS036
008300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      DPKCS036
008400                                                    COMP SYNC.    DPKCS036
008500     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      DPKCS036
008600                                                    COMP-3.       DPKCS036
008700     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      DPKCS036
008800                                                    COMP-3.       DPKCS036
008900     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      DPKCS036
009000                                                    COMP-3.       DPKCS036
009100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      DPKCS036
009200                                                    COMP-3.       DPKCS036
009300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      DPKCS036
009400                                                    COMP-3.       DPKCS036
009500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      DPKCS036
009600                                                    COMP-3.       DPKCS036
009700     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      DPKCS036
009800                                                    COMP-3.       DPKCS036
009900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      DPKCS036
010000                                                    COMP SYNC.    DPKCS036
010100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      DPKCS036
010200                                                    COMP SYNC.    DPKCS036
010300     05  PV-ITEM                        PIC S9(04)  VALUE +0      DPKCS036
010400                                                    COMP SYNC.    DPKCS036
010500     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      DPKCS036
010600                                                    COMP SYNC.    DPKCS036
010700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      DPKCS036
010800                                                    COMP SYNC.    DPKCS036
010900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      DPKCS036
011000                                                    COMP SYNC.    DPKCS036
011100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      DPKCS036
011200                                                    COMP SYNC.    DPKCS036
011300     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      DPKCS036
011400                                                    COMP SYNC.    DPKCS036
011500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
011600                                                    COMP SYNC.    DPKCS036
011700     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      DPKCS036
011800                                                    COMP SYNC.    DPKCS036
011900     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      DPKCS036
012000                                                    COMP SYNC.    DPKCS036
012100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      DPKCS036
012200                                                    COMP SYNC.    DPKCS036
012300     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      DPKCS036
012400                                                    COMP SYNC.    DPKCS036
012500     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      DPKCS036
012600                                                    COMP SYNC.    DPKCS036
012700     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      DPKCS036
012800                                                    COMP SYNC.    DPKCS036
012900     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      DPKCS036
013000                                                    COMP SYNC.    DPKCS036
013100******************************************************************DPKCS036
013200**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **DPKCS036
013300**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **DPKCS036
013400**  APPLICATION-SPECIFIC COMMAREA.                              **DPKCS036
013500******************************************************************DPKCS036
013600 01  LQW-LIST-QUEUE-WORK-AREA.                                    DPKCS036
013700     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  DPKCS036
013800     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           DPKCS036
013900                                        INDEXED BY LQW-IDX.       DPKCS036
014000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       DPKCS036
014100         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               DPKCS036
014200         10  LQW-SELECTED-SW            PIC  X(01).               DPKCS036
014300             88  LQW-SELECT                         VALUE 'S'.    DPKCS036
014400             88  LQW-DESELECT                       VALUE ' '.    DPKCS036
014500         10  LQW-ACTION                 PIC  X(03).               DPKCS036
014600         10  LQW-TKT-FMT-ID             PIC  X(06).                     36
014700         10  LQW-TKT-FMT-DESC           PIC  X(30).                     36
014800         10  LQW-PTICK-FMT-IND          PIC  X(03).                     36
014900             88 LQW-VALID-PTICK-FMT     VALUE 'YES'.                      
015000             88 LQW-NOT-VALID-PTICK-FMT VALUE 'NO '.                      
015100                                                                  DPKCS036
015200     EJECT                                                        DPKCS036
015300*---------------------------------------------------------------* DPKCS036
015400*  RECORD LAYOUT FOR THE TICKET FORMAT SELECTION TEMP STORAGE   * DPKCS036
015500*---------------------------------------------------------------* DPKCS036
015600                                                                  DPKCS036
015700     COPY VLWS014.                                                DPKCS036
015800                                                                  DPKCS036
015900     EJECT                                                        DPKCS036
016000*---------------------------------------------------------------* DPKCS036
016100*    MAP LAYOUT                                                 * DPKCS036
016200*---------------------------------------------------------------* DPKCS036
016300                                                                  DPKCS036
016400     COPY VLKM518.                                                DPKCS036
016500*                                                                 DPKCS036
016600 01  MR-OCCURS-LAYOUT                   REDEFINES  VL518AO.       DPKCS036
016700     05  FILLER                         PIC X(42).                DPKCS036
016800     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          DPKCS036
016900         10  MR-SELECTL                 PIC S9(04) COMP.          DPKCS036
017000         10  MR-SELECTA                 PIC  X(01).               DPKCS036
017100         10  MR-SELECTC                 PIC  X(01).               DPKCS036
017200         10  MR-SELECTH                 PIC  X(01).               DPKCS036
017300         10  MR-SELECTI                 PIC  X(01).               DPKCS036
017400                                                                  DPKCS036
017500         10  MR-ACTIONL                 PIC S9(04) COMP.          DPKCS036
017600         10  MR-ACTIONA                 PIC  X(01).               DPKCS036
017700         10  MR-ACTIONC                 PIC  X(01).               DPKCS036
017800         10  MR-ACTIONH                 PIC  X(01).               DPKCS036
017900         10  MR-ACTION                  PIC  X(03).               DPKCS036
018000                                                                  DPKCS036
018100         10  MR-TKT-FMT-IDL             PIC S9(04) COMP.          DPKCS036
018200         10  MR-TKT-FMT-IDA             PIC  X(01).               DPKCS036
018300         10  MR-TKT-FMT-IDC             PIC  X(01).               DPKCS036
018400         10  MR-TKT-FMT-IDH             PIC  X(01).               DPKCS036
018500         10  MR-TKT-FMT-ID              PIC  X(06).               DPKCS036
018600                                                                  DPKCS036
018700         10  MR-TKT-FMT-DESCL           PIC S9(04) COMP.          DPKCS036
018800         10  MR-TKT-FMT-DESCA           PIC  X(01).               DPKCS036
018900         10  MR-TKT-FMT-DESCC           PIC  X(01).               DPKCS036
019000         10  MR-TKT-FMT-DESCH           PIC  X(01).               DPKCS036
019100         10  MR-TKT-FMT-DESC            PIC  X(30).               DPKCS036
019200                                                                  DPKCS036
019300         10  MR-PTICK-FMT-INDL          PIC S9(04) COMP.          DPKCS036
019400         10  MR-PTICK-FMT-INDA          PIC  X(01).               DPKCS036
019500         10  MR-PTICK-FMT-INDC          PIC  X(01).               DPKCS036
019600         10  MR-PTICK-FMT-INDH          PIC  X(01).               DPKCS036
019700         10  MR-PTICK-FMT-IND           PIC  X(03).               DPKCS036
019800                                                                  DPKCS036
019900     EJECT                                                        DPKCS036
020000*---------------------------------------------------------------* DPKCS036
020100*    ATTRIBUTE SETTINGS COPYBOOK.                               * DPKCS036
020200*---------------------------------------------------------------* DPKCS036
020300                                                                  DPKCS036
020400     COPY DPWS015.                                                DPKCS036
020500                                                                  DPKCS036
020600*---------------------------------------------------------------* DPKCS036
020700*    FUNCTION KEYS COPYBOOK.                                    * DPKCS036
020800*---------------------------------------------------------------* DPKCS036
020900                                                                  DPKCS036
021000     COPY DPWS016.                                                DPKCS036
021100                                                                  DPKCS036
021200*---------------------------------------------------------------* DPKCS036
021300*    NUMERIC EDIT LAYOUT.                                       * DPKCS036
021400*---------------------------------------------------------------* DPKCS036
021500                                                                  DPKCS036
021600     COPY DPWS010I.                                               DPKCS036
021700 EJECT                                                            DPKCS036
021800*---------------------------------------------------------------* DPKCS036
021900*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * DPKCS036
022000*---------------------------------------------------------------* DPKCS036
022100                                                                  DPKCS036
022200     COPY DPWS030.                                                DPKCS036
CICS       COPY DPWS930.                                                DPKCS036
022300 EJECT                                                            DPKCS036
022400*---------------------------------------------------------------* DPKCS036
022500*    STANDARD COMMAREA.                                         * DPKCS036
022600*---------------------------------------------------------------* DPKCS036
022700                                                                  DPKCS036
022800     COPY DPWS020.                                                DPKCS036
022900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                DPKCS036
023000                                                                  DPKCS036
023100*---------------------------------------------------------------* DPKCS036
023200* INTER-APPLICATION COMMAREA.                                   * DPKCS036
023300*   VLWS013 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * DPKCS036
023400*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * DPKCS036
023500*---------------------------------------------------------------* DPKCS036
023600                                                                  DPKCS036
023700         10  INTER-APPL-COMM-AREA       PIC X(200).               DPKCS036
023800     COPY VLWS013.                                                DPKCS036
023900*---------------------------------------------------------------* DPKCS036
024000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * DPKCS036
024100*---------------------------------------------------------------* DPKCS036
024200         10  ASC-SPECIFIC-COMMAREA.                               DPKCS036
024300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                DPKCS036
024400                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  DPKCS036
024500                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   DPKCS036
024600                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   DPKCS036
024700                                                                  DPKCS036
024800                 20  ASC-ITEM-ARRAY.                              DPKCS036
024900                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        DPKCS036
025000                         30  ASC-LIST-ITEM-NUMBER                 DPKCS036
025100                                                     PIC S9(09)   DPKCS036
025200                                                     COMP-3.      DPKCS036
025300                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  DPKCS036
025400                             88  ASC-VALID-SELECT    VALUE ' '    DPKCS036
025500                                                           'S'    DPKCS036
025600                                                           'B'    DPKCS036
025700                                                           'E'.   DPKCS036
025800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   DPKCS036
025900                             88  ASC-TEMP-SELECT     VALUE 'S'.   DPKCS036
026000                             88  ASC-TEMP-BEGIN      VALUE 'B'.   DPKCS036
026100                             88  ASC-TEMP-END        VALUE 'E'.   DPKCS036
026200                         30  ASC-SELECTED-SW         PIC  X(01).  DPKCS036
026300                             88  ASC-NO-SELECT       VALUE ' '.   DPKCS036
026400                             88  ASC-SELECT          VALUE 'S'.   DPKCS036
026500                             88  ASC-BEGIN           VALUE 'B'.   DPKCS036
026600                             88  ASC-END             VALUE 'E'.   DPKCS036
026700                         30  ASC-ACTION              PIC  X(03).  DPKCS036
026800                         30  ASC-TKT-FMT-ID          PIC  X(06).  DPKCS036
026900                         30  ASC-TKT-FMT-DESC        PIC  X(30).  DPKCS036
027000                         30  ASC-PTICK-FMT-IND       PIC  X(3).         36
027100                             88  ASC-VALID-PTICK-FMT VALUE 'YES'.         
027200                             88  ASC-NOT-VALID-PTICK-FMT                  
027300                                                     VALUE 'NO '.         
027400                                                                  DPKCS036
027500             15  ASC-BLK-SUB                         PIC S9(04)   DPKCS036
027600                                                          COMP    DPKCS036
027700                                                          SYNC.   DPKCS036
027800             15  ASC-ITEM-SUB                        PIC S9(04)   DPKCS036
027900                                                          COMP    DPKCS036
028000                                                          SYNC.   DPKCS036
028100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   DPKCS036
028200                                                          COMP-3. DPKCS036
028300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   DPKCS036
028400                                                          COMP-3. DPKCS036
028500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   DPKCS036
028600                                                          COMP-3. DPKCS036
028700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   DPKCS036
028800                                                          COMP-3. DPKCS036
028900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   DPKCS036
029000                                                          COMP-3. DPKCS036
029100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   DPKCS036
029200                                                          COMP    DPKCS036
029300                                                          SYNC.   DPKCS036
029400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   DPKCS036
029500                                                          COMP-3. DPKCS036
029600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   DPKCS036
029700                                                          COMP-3. DPKCS036
029800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  DPKCS036
029900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   DPKCS036
030000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   DPKCS036
030100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  DPKCS036
030200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   DPKCS036
030300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   DPKCS036
030400             15  ASC-LIST-QUEUE-NAME.                             DPKCS036
030500                 20  ASC-LIST-TERM-ID                PIC  X(04).  DPKCS036
030600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   DPKCS036
030700                                                          COMP-3. DPKCS036
030800                 20  ASC-LIST-SEQ                    PIC  9(01).  DPKCS036
030900             15  ASC-SEL-QUEUE-NAME.                              DPKCS036
031000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  DPKCS036
031100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   DPKCS036
031200                                                          COMP-3. DPKCS036
031300                 20  ASC-SEL-SEQ                     PIC  9(01).  DPKCS036
031400                                                                  DPKCS036
031500             15  ASC-CURSOR-SW                       PIC  X(01).  DPKCS036
031600                 88  ASC-NO-CURSOR                   VALUE 'Z'.   DPKCS036
031700                 88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   DPKCS036
031800                 88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   DPKCS036
031900                 88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   DPKCS036
032000             15  ASC-START-ITEM-REQUEST.                          DPKCS036
032100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  DPKCS036
032200     EJECT                                                        DPKCS036
032300*---------------------------------------------------------------* DPKCS036
032400*    ABEND PROCESSING COPYBOOK.                                 * DPKCS036
032500*---------------------------------------------------------------* DPKCS036
032600                                                                  DPKCS036
032700     COPY DPWS013.                                                DPKCS036
032800                                                                  DPKCS036
032900 EJECT                                                            DPKCS036
033000*---------------------------------------------------------------* DPKCS036
033100*    DB2 AREA FOR THE TICKET FORMAT TABLE                       * DPKCS036
033200*---------------------------------------------------------------* DPKCS036
033300     EXEC SQL                                                     DPKCS036
033400          INCLUDE TTKTFMT                                         DPKCS036
033500     END-EXEC.                                                    DPKCS036
033600*---------------------------------------------------------------* DPKCS036
033700*    DB2 AREA FOR THE PRINT STOCK TABLE                         * DPKCS036
033800*---------------------------------------------------------------* DPKCS036
033900     EXEC SQL                                                     DPKCS036
034000          INCLUDE TPRTSTK                                         DPKCS036
034100     END-EXEC.                                                    DPKCS036
034200*---------------------------------------------------------------* DPKCS036
034300*    DB2 AREA FOR THE VSM DEFAULT CHARACTERISTIC TABLE          * DPKCS036
034400*---------------------------------------------------------------* DPKCS036
034500     EXEC SQL                                                     DPKCS036
034600          INCLUDE TVSCHAR                                         DPKCS036
034700     END-EXEC.                                                    DPKCS036
034800*---------------------------------------------------------------* DPKCS036
034900*    DB2 AREA FOR THE VSM DEFAULT CHARACTERISTIC VALUE TABLE    * DPKCS036
035000*---------------------------------------------------------------* DPKCS036
035100     EXEC SQL                                                     DPKCS036
035200          INCLUDE TVSCHVL                                         DPKCS036
035300     END-EXEC.                                                    DPKCS036
035400*---------------------------------------------------------------* DPKCS036
035500*    DB2 AREA FOR COMMUNICATIONS                                * DPKCS036
035600*---------------------------------------------------------------* DPKCS036
035700     EXEC SQL                                                     DPKCS036
035800          INCLUDE SQLCA                                           DPKCS036
035900     END-EXEC.                                                    DPKCS036
036000                                                                  DPKCS036
036100*---------------------------------------------------------------* DPKCS036
036200*    TMESSAGE CURSOR WHEN MESSAGE NUMBER IS REQUESTED           * DPKCS036
036300*---------------------------------------------------------------* DPKCS036
036400                                                                  DPKCS036
036500     EXEC SQL                                                     DPKCS036
036600          DECLARE TKT_FMT_CURSOR CURSOR                           DPKCS036
036700          FOR SELECT                                              DPKCS036
036800                       TKT_FMT_ID                                         
036900                     , TKT_FMT_DESC                                       
037100              FROM                                                        
037200                      TTKTFMT                                             
037400              GROUP BY                                                    
037500                       TKT_FMT_ID                                         
037600                     , TKT_FMT_DESC                                       
037400              ORDER BY                                                    
037500                       TKT_FMT_ID                                         
037600                     , TKT_FMT_DESC                                       
037800                                                                          
037900     END-EXEC.                                                    DPKCS036
038000                                                                  DPKCS036
038100 EJECT                                                            DPKCS036
038200 LINKAGE SECTION.                                                 DPKCS036
038300                                                                  DPKCS036
038400 01  DFHCOMMAREA.                                                 DPKCS036
038500     05  FILLER                         OCCURS  1 TO 4072 TIMES   DPKCS036
038600                                        DEPENDING ON EIBCALEN.    DPKCS036
038700         10  FILLER                     PIC X.                    DPKCS036
038800                                                                  DPKCS036
038900 EJECT                                                            DPKCS036
039000 PROCEDURE DIVISION.                                              DPKCS036
039100******************************************************************DPKCS036
039200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **DPKCS036
039300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **DPKCS036
039400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **DPKCS036
039500******************************************************************DPKCS036
039600 0000-MAIN-MODULE.                                                DPKCS036
039700     INITIALIZE DP030-CICS-API-FIELDS.                            DPKCS036
039800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       DPKCS036
039900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          DPKCS036
040000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         DPKCS036
040100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       DPKCS036
040200     MOVE LENGTH OF VL518AI        TO DP030-MAP-LENGTH (1).       DPKCS036
040300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     DPKCS036
040400     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
040500*                                                                 DPKCS036
040600     PERFORM 1000-CONTROL-PROCESSING                              DPKCS036
040700*                                                                 DPKCS036
040800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     DPKCS036
040900     PERFORM 0001-CALL-CICS-ARCH-API.                             DPKCS036
041000                                                                  DPKCS036
041100******************************************************************DPKCS036
041200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **DPKCS036
041300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **DPKCS036
041400******************************************************************DPKCS036
041500 0001-CALL-CICS-ARCH-API.                                         DPKCS036
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
041700                                    DFHCOMMAREA                           
041800                                    DP030-CICS-API-FIELDS                 
041900                                    DP020-STANDARD-COMMAREA               
042000                                    VL518AI.                              
042100*                                                                 DPKCS036
042200     IF  DP030-RC-CALL-SUCCESSFUL                                 DPKCS036
042300         CONTINUE                                                 DPKCS036
042400     ELSE                                                         DPKCS036
042500         SET DP013-NO-ROLLBACK                                    DPKCS036
042600             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
042700             DP013-CICS-ABEND      TO TRUE                        DPKCS036
042800         MOVE '0001-CALL-CICS-ARCH-API'                           DPKCS036
042900                                   TO DP013-PARAGRAPH             DPKCS036
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
043200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      DPKCS036
043300         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
043400     END-IF.                                                      DPKCS036
043500*----------------------------------------------------------------*DPKCS036
043600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *DPKCS036
043700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *DPKCS036
043800*                                                                *DPKCS036
043900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *DPKCS036
044000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *DPKCS036
044100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *DPKCS036
044200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *DPKCS036
044300*----------------------------------------------------------------*DPKCS036
044400                                                                  DPKCS036
044500 1000-CONTROL-PROCESSING.                                         DPKCS036
044600                                                                  DPKCS036
044700     EVALUATE TRUE                                                DPKCS036
044800         WHEN DP020-NEXT-ACT-INITIAL                              DPKCS036
044900             INITIALIZE ASC-SPECIFIC-COMMAREA                     DPKCS036
045000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            DPKCS036
045100                                      ASC-SEL-TERM-ID             DPKCS036
045200             MOVE DP020-SRC-TASK-NUMBER                           DPKCS036
045300                                   TO ASC-LIST-TASK-NUMBER        DPKCS036
045400                                      ASC-SEL-TASK-NUMBER         DPKCS036
045500             MOVE PC-LIST-QUEUE-SEQ                               DPKCS036
045600                                   TO ASC-LIST-SEQ                DPKCS036
045700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 DPKCS036
045800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 DPKCS036
045900***-----$TEMPLATE NOTE$-------------------------------------------DPKCS036
046000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,DPKCS036
046100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  DPKCS036
046200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.DPKCS036
046300***---------------------------------------------------------------DPKCS036
046400             IF  PS-COMMAREA-NOT-VALID                            DPKCS036
046500***              MOVE PC-TSYMSG-99901                             DPKCS036
046600***                                TO DP020-MSG-NUMBER            DPKCS036
046700***              SET DP020-MSG-FATAL                              DPKCS036
046800***                                TO TRUE                        DPKCS036
046900                 SET DP020-NEXT-ACT-APPL-ERROR                    DPKCS036
047000                                   TO TRUE                        DPKCS036
047100             ELSE                                                 DPKCS036
047200                 PERFORM 4000-BUILD-INITIAL-PANEL                 DPKCS036
047300             END-IF                                               DPKCS036
047400                                                                  DPKCS036
047500         WHEN DP020-NEXT-ACT-READ-MAP                             DPKCS036
047600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
047700                                   TO PV-TOP-ITEM                 DPKCS036
047800             PERFORM 2000-PROCESS-PANEL                           DPKCS036
047900                                                                  DPKCS036
048000         WHEN DP020-NEXT-ACT-RETURN                               DPKCS036
048100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        DPKCS036
048200                                   TO PV-TOP-ITEM                 DPKCS036
048300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
048400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 DPKCS036
048500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
048600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                      CL**2
048700                                                                  DPKCS036
048800         WHEN OTHER                                               DPKCS036
048900             SET DP013-LOGIC-ABEND TO TRUE                        DPKCS036
049000             SET DP013-NO-ROLLBACK TO TRUE                        DPKCS036
049100             MOVE '1000-CONTROL-PROCESSING'                       DPKCS036
049200                                   TO DP013-PARAGRAPH             DPKCS036
049300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    DPKCS036
049400                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
049500             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
049600     END-EVALUATE.                                                DPKCS036
049700                                                                  DPKCS036
049800 EJECT                                                            DPKCS036
049900*----------------------------------------------------------------*DPKCS036
050000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *DPKCS036
050100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *DPKCS036
050200*----------------------------------------------------------------*DPKCS036
050300                                                                  DPKCS036
050400 1100-PROCESS-INTER-APPL-COMM.                                    DPKCS036
050500                                                                  DPKCS036
050600     SET PS-COMMAREA-VALID         TO TRUE.                       DPKCS036
050700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     DPKCS036
050800                                                                  DPKCS036
050900 EJECT                                                            DPKCS036
051000*----------------------------------------------------------------*DPKCS036
051100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *DPKCS036
051200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *DPKCS036
051300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *DPKCS036
051400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *DPKCS036
051500* FUNCTION KEYS CAN GET THIS FAR.                                *DPKCS036
051600*----------------------------------------------------------------*DPKCS036
051700                                                                  DPKCS036
051800 2000-PROCESS-PANEL.                                              DPKCS036
051900     EVALUATE TRUE                                                DPKCS036
052000         WHEN DP020-SRC-AID = DP016-CLEAR                         DPKCS036
052100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
052200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
052300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
052400                                                                  DPKCS036
052500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    DPKCS036
052600             PERFORM 2050-DELETE-LIST-QUEUE                       DPKCS036
052700             PERFORM 4000-BUILD-INITIAL-PANEL                     DPKCS036
052800                                                                  DPKCS036
052900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    DPKCS036
053000             PERFORM 2140-DESELECT-ALL-ITEMS                      DPKCS036
053100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
053200                                                                  DPKCS036
053300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  DPKCS036
053400             PERFORM 2150-SELECT-ALL-ITEMS                        DPKCS036
053500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
053600                                                                  DPKCS036
053700         WHEN OTHER                                               DPKCS036
053800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 DPKCS036
053900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   DPKCS036
054000             IF  PS-NO-ERROR                                      DPKCS036
054100                 SET DP030-CONTINUE-GO                            DPKCS036
054200                                 TO TRUE                          DPKCS036
054300                 PERFORM 2100-CHECK-FUNCTION-KEY                  DPKCS036
054400             ELSE                                                 DPKCS036
054500                 SET DP030-OVERRIDE-GO                            DPKCS036
054600                                 TO TRUE                          DPKCS036
054700             END-IF                                               DPKCS036
054800     END-EVALUATE.                                                DPKCS036
054900 EJECT                                                            DPKCS036
055000*----------------------------------------------------------------*DPKCS036
055100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *DPKCS036
055200*----------------------------------------------------------------*DPKCS036
055300 2050-DELETE-LIST-QUEUE.                                          DPKCS036
055400                                                                  DPKCS036
055500     EXEC CICS                                                    DPKCS036
055600         DELETEQ TS                                               DPKCS036
055700             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
055800             RESP  (PV-CICS-RESP)                                 DPKCS036
055900     END-EXEC.                                                    DPKCS036
056000                                                                  DPKCS036
056100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       DPKCS036
056200        (PV-CICS-RESP = DFHRESP(QIDERR))                          DPKCS036
056300         CONTINUE                                                 DPKCS036
056400     ELSE                                                         DPKCS036
056500         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
056600         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
056700                                                                  DPKCS036
056800         MOVE '2050-DELETE-LIST-QUEUE'                            DPKCS036
056900                                   TO DP013-PARAGRAPH             DPKCS036
057000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    DPKCS036
057100                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
057200         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
057300     END-IF.                                                      DPKCS036
057400                                                                  DPKCS036
057500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  DPKCS036
057600 EJECT                                                            DPKCS036
057700*----------------------------------------------------------------*DPKCS036
057800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*DPKCS036
057900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *DPKCS036
058000* CICS ARCHITECTURE API.                                         *DPKCS036
058100*----------------------------------------------------------------*DPKCS036
058200 2100-CHECK-FUNCTION-KEY.                                         DPKCS036
058300     EVALUATE TRUE                                                DPKCS036
058400*    WHEN ADD IS PRESSED                                                  
058500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              DPKCS036
058510             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              DPKCS036
058520                 SET DP030-OVERRIDE-GO                            DPKCS036
058530                                   TO TRUE                        DPKCS036
058540                 MOVE PC-TSYMSG-00112                             DPKCS036
058550                                   TO DP020-MSG-NUMBER            DPKCS036
058560                 SET DP020-MSG-WARNING                            DPKCS036
058570                                   TO TRUE                        DPKCS036
058960             ELSE                                                 DPKCS036
058970                 INITIALIZE VL013-INTER-APPL-COMMAREA             DPKCS036
058980                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                DPKCS036
058990                                TO VL013-NUMBER-OF-SELECTED-ITEMS DPKCS036
058991                 PERFORM 5000-PREPARE-SEL-QUEUE                   DPKCS036
058994             END-IF                                               DPKCS036
059000                                                                  DPKCS036
059100*    WHEN UPDATE (02) OR DELETE (03) IS PRESSED                           
059200         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              DPKCS036
059300         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              DPKCS036
059400             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              DPKCS036
059500                 INITIALIZE VL013-INTER-APPL-COMMAREA             DPKCS036
059600                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                DPKCS036
059700                                TO VL013-NUMBER-OF-SELECTED-ITEMS DPKCS036
059800                 PERFORM 5000-PREPARE-SEL-QUEUE                   DPKCS036
059900             ELSE                                                 DPKCS036
060000                 SET DP030-OVERRIDE-GO                            DPKCS036
060100                                   TO TRUE                        DPKCS036
060200                 MOVE PC-TSYMSG-00057                             DPKCS036
060300                                   TO DP020-MSG-NUMBER            DPKCS036
060400                 SET DP020-MSG-WARNING                            DPKCS036
060500                                   TO TRUE                        DPKCS036
060600             END-IF                                               DPKCS036
060700                                                                          
060800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  DPKCS036
060900             MOVE +1               TO PV-TOP-ITEM                 DPKCS036
061000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
061100                                                                  DPKCS036
061200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   DPKCS036
061300             PERFORM 2110-BROWSE-BACKWARD                         DPKCS036
061400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
061500                                                                  DPKCS036
061600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   DPKCS036
061700             PERFORM 2120-BROWSE-FORWARD                          DPKCS036
061800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 DPKCS036
061900                                                                  DPKCS036
062000         WHEN DP020-SRC-AID = DP016-ENTER                         DPKCS036
062100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   DPKCS036
062200             IF  PS-ERROR                                         DPKCS036
062300                 CONTINUE                                         DPKCS036
062400             ELSE                                                 DPKCS036
062500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             DPKCS036
062600             END-IF                                               DPKCS036
062700                                                                  DPKCS036
062800         WHEN OTHER                                               DPKCS036
062900             SET DP013-NO-ROLLBACK                                DPKCS036
063000                 DP013-XCTL-DISPLAY-RESTART                       DPKCS036
063100                 DP013-CICS-ABEND  TO TRUE                        DPKCS036
063200             MOVE '2100-CHECK-FUNCTION-KEY'                       DPKCS036
063300                                   TO DP013-PARAGRAPH             DPKCS036
063400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      DPKCS036
063500                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
063600             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
063700     END-EVALUATE.                                                DPKCS036
063800*                                                                 DPKCS036
063900*----------------------------------------------------------------*DPKCS036
064000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *DPKCS036
064100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *DPKCS036
064200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *DPKCS036
064300*    MESSAGE.                                                    *DPKCS036
064400*----------------------------------------------------------------*DPKCS036
064500                                                                  DPKCS036
064600 2110-BROWSE-BACKWARD.                                            DPKCS036
064700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
064800         GIVING PV-TOP-ITEM.                                      DPKCS036
064900*                                                                 DPKCS036
065000     IF  ((PV-TOP-ITEM < +1)                                      DPKCS036
065100       OR (PV-TOP-ITEM = +1))                                     DPKCS036
065200         MOVE +1                   TO PV-TOP-ITEM                 DPKCS036
065300*        -- TOP OF LIST --                                        DPKCS036
065400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            DPKCS036
065500         SET DP020-MSG-INFORMATIONAL TO TRUE                      DPKCS036
065600     END-IF.                                                      DPKCS036
065700                                                                  DPKCS036
065800 EJECT                                                            DPKCS036
065900*----------------------------------------------------------------*DPKCS036
066000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *DPKCS036
066100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *DPKCS036
066200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *DPKCS036
066300*----------------------------------------------------------------*DPKCS036
066400                                                                  DPKCS036
066500 2120-BROWSE-FORWARD.                                             DPKCS036
066600                                                                  DPKCS036
066700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              DPKCS036
066800         GIVING PV-TOP-ITEM.                                      DPKCS036
066900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   DPKCS036
067000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
067100                                   TO PV-TOP-ITEM                 DPKCS036
067200*        -- BOTTOM OF LIST --                                     DPKCS036
067300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            DPKCS036
067400         SET DP020-MSG-INFORMATIONAL                              DPKCS036
067500                                   TO TRUE                        DPKCS036
067600     ELSE                                                         DPKCS036
067700         COMPUTE PV-BOTTOM-ITEM =                                 DPKCS036
067800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 DPKCS036
067900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            DPKCS036
068000*            -- BOTTOM OF LIST --                                 DPKCS036
068100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            DPKCS036
068200             SET DP020-MSG-INFORMATIONAL                          DPKCS036
068300                                   TO TRUE                        DPKCS036
068400         END-IF                                                   DPKCS036
068500     END-IF.                                                      DPKCS036
068600 EJECT                                                            DPKCS036
068700*----------------------------------------------------------------*DPKCS036
068800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *DPKCS036
068900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *DPKCS036
069000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *DPKCS036
069100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *DPKCS036
069200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *DPKCS036
069300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *DPKCS036
069400*----------------------------------------------------------------*DPKCS036
069500                                                                  DPKCS036
069600 2130-CHECK-FOR-JUMP-BROWSE.                                      DPKCS036
069700     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
069800     IF (ASC-START-ITEM-REQUEST = SPACE)                          DPKCS036
069900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            DPKCS036
070000                                   TO PV-TOP-ITEM                 DPKCS036
070100     ELSE                                                         DPKCS036
070200         MOVE ASC-START-ITEM-REQUEST                              DPKCS036
070300                                   TO DP010I-UNEDITED-FIELD       DPKCS036
070400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       DPKCS036
070500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     DPKCS036
070600         SET DP010I-NEGATIVE-NOT-ALLOWED                          DPKCS036
070700                                   TO TRUE                        DPKCS036
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
070900                                                                  DPKCS036
071000         IF  NOT DP010I-ERROR-DETECTED                            DPKCS036
071100             MOVE DP010I-NUMERIC-FIELD                            DPKCS036
071200                                   TO  ASC-START-ITEM-REQUEST-N   DPKCS036
071300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  DPKCS036
071400                 IF  ASC-START-ITEM-REQUEST-N >                   DPKCS036
071500                                          ASC-NUMBER-OF-ITEMS-READDPKCS036
071600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         DPKCS036
071700                     COMPUTE PV-TOP-ITEM =                        DPKCS036
071800                             ASC-NUMBER-OF-ITEMS-READ             DPKCS036
071900                             - PC-ITEMS-PER-PANEL + 1             DPKCS036
072000                     IF  PV-TOP-ITEM < +1                         DPKCS036
072100                         MOVE +1   TO PV-TOP-ITEM                 DPKCS036
072200                         MOVE PC-TSYMSG-00070                     DPKCS036
072300                                   TO DP020-MSG-NUMBER            DPKCS036
072400                         SET DP020-MSG-INFORMATIONAL              DPKCS036
072500                                   TO TRUE                        DPKCS036
072600                     END-IF                                       DPKCS036
072700                 ELSE                                             DPKCS036
072800                     MOVE ASC-START-ITEM-REQUEST-N                DPKCS036
072900                                   TO PV-TOP-ITEM                 DPKCS036
073000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      DPKCS036
073100                     COMPUTE PV-BOTTOM-ITEM =                     DPKCS036
073200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     DPKCS036
073300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READDPKCS036
073400*                        -- BOTTOM OF LIST --                     DPKCS036
073500                         MOVE PC-TSYMSG-00070                     DPKCS036
073600                                   TO DP020-MSG-NUMBER            DPKCS036
073700                         SET DP020-MSG-INFORMATIONAL              DPKCS036
073800                                   TO TRUE                        DPKCS036
073900                     END-IF                                       DPKCS036
074000                 END-IF                                           DPKCS036
074100             ELSE                                                 DPKCS036
074200*                --- VALUE OUT OF RANGE ----                      DPKCS036
074300                 MOVE PC-TSYMSG-00101                             DPKCS036
074400                                   TO DP020-MSG-NUMBER            DPKCS036
074500                 MOVE -1           TO ASTRTITL                    DPKCS036
074600                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
074700                                   TO TRUE                        DPKCS036
074800                 MOVE DP015-REVERSE                               DPKCS036
074900                                   TO ASTRTITH                    DPKCS036
075000                 MOVE DP015-RED    TO ASTRTITC                    DPKCS036
075100                 MOVE DP015-UNP-NUM-BRT-MDT                       DPKCS036
075200                                   TO ASTRTITA                    DPKCS036
075300                 SET DP020-MSG-FATAL                              DPKCS036
075400                                   TO TRUE                        DPKCS036
075500                 SET PS-ERROR      TO TRUE                        DPKCS036
075600             END-IF                                               DPKCS036
075700                                                                  DPKCS036
075800         ELSE                                                     DPKCS036
075900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            DPKCS036
076000             MOVE -1               TO ASTRTITL                    DPKCS036
076100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  DPKCS036
076200             MOVE DP015-REVERSE    TO ASTRTITH                    DPKCS036
076300             MOVE DP015-RED        TO ASTRTITC                    DPKCS036
076400             MOVE DP015-UNP-NUM-BRT-MDT                           DPKCS036
076500                                   TO ASTRTITA                    DPKCS036
076600             SET DP020-MSG-FATAL   TO TRUE                        DPKCS036
076700             SET PS-ERROR          TO TRUE                        DPKCS036
076800         END-IF                                                   DPKCS036
076900     END-IF.                                                      DPKCS036
077000 EJECT                                                            DPKCS036
077100*----------------------------------------------------------------*DPKCS036
077200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *DPKCS036
077300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *DPKCS036
077400*----------------------------------------------------------------*DPKCS036
077500 2140-DESELECT-ALL-ITEMS.                                         DPKCS036
077600     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
077700                                                                  DPKCS036
077800     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
077900         VARYING ASC-ITEM-SUB                                     DPKCS036
078000         FROM 1 BY 1                                              DPKCS036
078100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
078200                                                                  DPKCS036
078300     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
078400                                                                  DPKCS036
078500     PERFORM 2141-CLEAR-SELECTED-INDS                             DPKCS036
078600         VARYING ASC-ITEM-SUB                                     DPKCS036
078700         FROM 1 BY 1                                              DPKCS036
078800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
078900                                                                  DPKCS036
079000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
079100                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
079200                                                                  DPKCS036
079300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
079400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
079500                                                                  DPKCS036
079600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
079700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      DPKCS036
079800         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
079900                                                                  DPKCS036
080000         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
080100                                                                  DPKCS036
080200         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
080300                                                                  DPKCS036
080400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
080500             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
080600                                                                  DPKCS036
080700         PERFORM                                                  DPKCS036
080800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
080900                                                                  DPKCS036
081000             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
081100                                                                  DPKCS036
081200             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
081300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 DPKCS036
081400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
081500                                                                  DPKCS036
081600             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
081700                                                                  DPKCS036
081800             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
081900                                                                  DPKCS036
082000         END-PERFORM                                              DPKCS036
082100                                                                  DPKCS036
082200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
082300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
082400                                                                  DPKCS036
082500         PERFORM                                                  DPKCS036
082600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
082700                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
082800                                                                  DPKCS036
082900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
083000                                   TO PV-BLOCK-NUMBER             DPKCS036
083100                                                                  DPKCS036
083200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
083300                                                                  DPKCS036
083400             PERFORM 2141-CLEAR-SELECTED-INDS                     DPKCS036
083500                 VARYING ASC-ITEM-SUB                             DPKCS036
083600                 FROM 1 BY 1                                      DPKCS036
083700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
083800                                                                  DPKCS036
083900             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
084000                                                                  DPKCS036
084100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
084200                                                                  DPKCS036
084300         END-PERFORM                                              DPKCS036
084400                                                                  DPKCS036
084500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
084600                                   TO PV-BLOCK-NUMBER             DPKCS036
084700                                                                  DPKCS036
084800         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
084900     END-IF.                                                      DPKCS036
085000                                                                  DPKCS036
085100                                                                  DPKCS036
085200     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. DPKCS036
085300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.DPKCS036
085400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  DPKCS036
085500                                                                  DPKCS036
085600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
085700                                                                  DPKCS036
085800 EJECT                                                            DPKCS036
085900*----------------------------------------------------------------*DPKCS036
086000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *DPKCS036
086100*----------------------------------------------------------------*DPKCS036
086200                                                                  DPKCS036
086300 2141-CLEAR-SELECTED-INDS.                                        DPKCS036
086400                                                                  DPKCS036
086500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
086600             NOT EQUAL ZERO                                       DPKCS036
086700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
086800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
086900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    DPKCS036
087000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
087100                                   TO TRUE                        DPKCS036
087200         END-IF                                                   DPKCS036
087300     END-IF.                                                      DPKCS036
087400                                                                  DPKCS036
087500 EJECT                                                            DPKCS036
087600*----------------------------------------------------------------*DPKCS036
087700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *DPKCS036
087800*  FOR ALL ITEMS.                                                *DPKCS036
087900*----------------------------------------------------------------*DPKCS036
088000                                                                  DPKCS036
088100 2150-SELECT-ALL-ITEMS.                                           DPKCS036
088200                                                                  DPKCS036
088300     MOVE +1                       TO ASC-BLK-SUB.                DPKCS036
088400                                                                  DPKCS036
088500     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
088600         VARYING ASC-ITEM-SUB                                     DPKCS036
088700         FROM 1 BY 1                                              DPKCS036
088800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
088900                                                                  DPKCS036
089000     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
089100                                                                  DPKCS036
089200     PERFORM 2151-SET-SELECTED-INDS                               DPKCS036
089300         VARYING ASC-ITEM-SUB                                     DPKCS036
089400         FROM 1 BY 1                                              DPKCS036
089500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
089600                                                                  DPKCS036
089700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
089800                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
089900                                                                  DPKCS036
090000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
090100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
090200                                                                  DPKCS036
090300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     DPKCS036
090400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    DPKCS036
090500         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
090600                                                                  DPKCS036
090700         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
090800                                                                  DPKCS036
090900         MOVE +1                   TO PV-BLOCK-NUMBER             DPKCS036
091000                                                                  DPKCS036
091100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
091200             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
091300                                                                  DPKCS036
091400         PERFORM                                                  DPKCS036
091500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       DPKCS036
091600                                                                  DPKCS036
091700             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
091800                                                                  DPKCS036
091900             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
092000                 VARYING ASC-ITEM-SUB                             DPKCS036
092100                 FROM 1 BY 1                                      DPKCS036
092200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
092300                                                                  DPKCS036
092400             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
092500                                                                  DPKCS036
092600             ADD +1                TO PV-BLOCK-NUMBER             DPKCS036
092700                                                                  DPKCS036
092800         END-PERFORM                                              DPKCS036
092900                                                                  DPKCS036
093000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
093100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
093200                                                                  DPKCS036
093300         PERFORM                                                  DPKCS036
093400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
093500                   ASC-HIGHEST-BLOCK-WRITTEN                      DPKCS036
093600                                                                  DPKCS036
093700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
093800                                   TO PV-BLOCK-NUMBER             DPKCS036
093900                                                                  DPKCS036
094000             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
094100                                                                  DPKCS036
094200             PERFORM 2151-SET-SELECTED-INDS                       DPKCS036
094300                 VARYING ASC-ITEM-SUB                             DPKCS036
094400                 FROM 1 BY 1                                      DPKCS036
094500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
094600                                                                  DPKCS036
094700             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
094800                                                                  DPKCS036
094900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
095000                                                                  DPKCS036
095100         END-PERFORM                                              DPKCS036
095200                                                                  DPKCS036
095300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
095400                                   TO PV-BLOCK-NUMBER             DPKCS036
095500                                                                  DPKCS036
095600         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
095700     END-IF.                                                      DPKCS036
095800                                                                  DPKCS036
095900                                                                  DPKCS036
096000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             DPKCS036
096100                       ASC-NUMBER-OF-SELECTED-ITEMS.              DPKCS036
096200                                                                  DPKCS036
096300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        DPKCS036
096400                                                                  DPKCS036
096500 EJECT                                                            DPKCS036
096600*----------------------------------------------------------------*DPKCS036
096700*    MARK EACH ITEM AS BEING SELECTED.                           *DPKCS036
096800*----------------------------------------------------------------*DPKCS036
096900                                                                  DPKCS036
097000 2151-SET-SELECTED-INDS.                                          DPKCS036
097100                                                                  DPKCS036
097200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
097300             NOT EQUAL ZERO                                       DPKCS036
097400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
097500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
097600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
097700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  DPKCS036
097800                               TO  TRUE                           DPKCS036
097900         END-IF                                                   DPKCS036
098000     END-IF.                                                      DPKCS036
098100******************************************************************DPKCS036
098200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **DPKCS036
098300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **DPKCS036
098400******************************************************************DPKCS036
098500 2200-MOVE-SCREEN-TO-COMMAREA.                                    DPKCS036
098600                                                                  DPKCS036
098700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             DPKCS036
098800     MOVE +1                       TO PV-SUB.                     DPKCS036
098900*                                                                 DPKCS036
099000     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
099100     IF  ASTRTITL > ZERO                                          DPKCS036
099200         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          DPKCS036
099300     ELSE                                                         DPKCS036
099400         IF  ASTRTITF = DP015-ERASE-EOF                           DPKCS036
099500             INITIALIZE ASC-START-ITEM-REQUEST                    DPKCS036
099600         END-IF                                                   DPKCS036
099700     END-IF.                                                      DPKCS036
099800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          DPKCS036
099900         VARYING PV-SUB                                           DPKCS036
100000         FROM 1 BY 1                                              DPKCS036
100100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      DPKCS036
100200******************************************************************DPKCS036
100300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**DPKCS036
100400******************************************************************DPKCS036
100500 2210-MOVE-LINES-TO-COMMAREA.                                     DPKCS036
100600     IF  MR-SELECTL (PV-SUB) > ZERO                               DPKCS036
100700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             DPKCS036
100800         MOVE MR-SELECTI (PV-SUB)                                 DPKCS036
100900                                   TO ASC-TEMP-SELECTED-SW        DPKCS036
101000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
101100     ELSE                                                         DPKCS036
101200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                DPKCS036
101300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     DPKCS036
101400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        DPKCS036
101500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      DPKCS036
101600         END-IF                                                   DPKCS036
101700     END-IF.                                                      DPKCS036
101800     ADD +1                        TO ASC-ITEM-SUB.               DPKCS036
101900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
102000         ADD +1                    TO ASC-BLK-SUB                 DPKCS036
102100         MOVE +1                   TO ASC-ITEM-SUB                DPKCS036
102200     END-IF.                                                      DPKCS036
102300******************************************************************DPKCS036
102400** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **DPKCS036
102500** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **DPKCS036
102600******************************************************************DPKCS036
102700 3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
102800     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
102900     PERFORM 3200-RESET-ATTRIBUTES.                               DPKCS036
103000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     DPKCS036
103100**                                                                DPKCS036
103200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              DPKCS036
103300* EDITTING IS DONE FROM THE BOTTOM UP.                            DPKCS036
103400**                                                                DPKCS036
103500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
103600         ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
103700     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
103800     PERFORM 3300-EDIT-SELECTIONS                                 DPKCS036
103900         VARYING PV-SUB                                           DPKCS036
104000         FROM PV-SUB BY -1                                        DPKCS036
104100         UNTIL PV-SUB < +1                                        DPKCS036
104200*                                                                 DPKCS036
104300     IF  PS-NO-ERROR                                              DPKCS036
104400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        DPKCS036
104500     END-IF.                                                      DPKCS036
104600*                                                                 DPKCS036
104700     IF  ((PS-NO-ERROR)                                           DPKCS036
104800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   DPKCS036
104900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    DPKCS036
105000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  DPKCS036
105100     END-IF.                                                      DPKCS036
105200 EJECT                                                            DPKCS036
105300*----------------------------------------------------------------*DPKCS036
105400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *DPKCS036
105500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*DPKCS036
105600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *DPKCS036
105700*                                                                *DPKCS036
105800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *DPKCS036
105900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *DPKCS036
106000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *DPKCS036
106100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *DPKCS036
106200*----------------------------------------------------------------*DPKCS036
106300                                                                  DPKCS036
106400 3100-SET-SUBSCRIPTS.                                             DPKCS036
106500                                                                  DPKCS036
106600     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
106700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        DPKCS036
106800                                                                  DPKCS036
106900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         DPKCS036
107000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
107100                                                                  DPKCS036
107200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               DPKCS036
107300     ELSE                                                         DPKCS036
107400         MOVE +1                     TO ASC-BLK-SUB               DPKCS036
107500     END-IF.                                                      DPKCS036
107600******************************************************************DPKCS036
107700** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **DPKCS036
107800******************************************************************DPKCS036
107900                                                                  DPKCS036
108000 3200-RESET-ATTRIBUTES.                                           DPKCS036
108100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   DPKCS036
108200     MOVE DP015-GREEN              TO ASTRTITC.                   DPKCS036
108300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   DPKCS036
108400*                                                                 DPKCS036
108500     PERFORM                                                      DPKCS036
108600         VARYING PV-SUB                                           DPKCS036
108700         FROM 1 BY 1                                              DPKCS036
108800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
108900         MOVE DP015-UNP-ALP-NOR-OFF                               DPKCS036
109000                                   TO MR-SELECTA (PV-SUB)         DPKCS036
109100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         DPKCS036
109200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         DPKCS036
109300     END-PERFORM.                                                 DPKCS036
109400******************************************************************DPKCS036
109500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **DPKCS036
109600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **DPKCS036
109700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **DPKCS036
109800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **DPKCS036
109900******************************************************************DPKCS036
110000 3300-EDIT-SELECTIONS.                                            DPKCS036
110100     EVALUATE TRUE                                                DPKCS036
110200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
110300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
110400                 CONTINUE                                         DPKCS036
110500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         DPKCS036
110600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
110700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   DPKCS036
110800                 MOVE ASC-TEMP-SELECTED-SW                        DPKCS036
110900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
111000                                TO ASC-SELECTED-SW                DPKCS036
111100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
111200             END-IF                                               DPKCS036
111300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     DPKCS036
111400                 = SPACE                                          DPKCS036
111500             EVALUATE TRUE                                        DPKCS036
111600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       DPKCS036
111700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMSDPKCS036
111800                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
111900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
112000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        DPKCS036
112100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    DPKCS036
112200                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
112300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
112400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
112500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      DPKCS036
112600                     MOVE SPACE TO ASC-SELECTED-SW                DPKCS036
112700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
112800             END-EVALUATE                                         DPKCS036
112900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
113000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
113100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
113200             END-IF                                               DPKCS036
113300             PERFORM 3310-EDIT-RANGE                              DPKCS036
113400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             DPKCS036
113500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
113600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
113700             END-IF                                               DPKCS036
113800             PERFORM 3310-EDIT-RANGE                              DPKCS036
113900         WHEN OTHER                                               DPKCS036
114000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           DPKCS036
114100             SET DP020-MSG-FATAL    TO TRUE                       DPKCS036
114200             MOVE -1                TO MR-SELECTL (PV-SUB)        DPKCS036
114300             SET DP030-SET-CURSOR-APPL-1                          DPKCS036
114400                                    TO TRUE                       DPKCS036
114500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        DPKCS036
114600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        DPKCS036
114700             SET PS-ERROR TO TRUE                                 DPKCS036
114800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            DPKCS036
114900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     DPKCS036
115000                 MOVE SPACE         TO ASC-SELECTED-SW            DPKCS036
115100                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
115200             END-IF                                               DPKCS036
115300     END-EVALUATE.                                                DPKCS036
115400                                                                  DPKCS036
115500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 DPKCS036
115600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               DPKCS036
115700     IF  ASC-ITEM-SUB < 1                                         DPKCS036
115800         SUBTRACT +1 FROM ASC-BLK-SUB                             DPKCS036
115900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                DPKCS036
116000     END-IF.                                                      DPKCS036
116100******************************************************************DPKCS036
116200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **DPKCS036
116300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **DPKCS036
116400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**DPKCS036
116500** THE ENDING.                                                  **DPKCS036
116600******************************************************************DPKCS036
116700 3310-EDIT-RANGE.                                                 DPKCS036
116800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                DPKCS036
116900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   DPKCS036
117000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
117100                                   TO ASC-SELECTED-SW             DPKCS036
117200                                        (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
117300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE DPKCS036
117400         ELSE                                                     DPKCS036
117500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     DPKCS036
117600                 CONTINUE                                         DPKCS036
117700             ELSE                                                 DPKCS036
117800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        DPKCS036
117900                 MOVE PC-TSYMSG-00054                             DPKCS036
118000                                   TO DP020-MSG-NUMBER            DPKCS036
118100                 SET DP020-MSG-FATAL                              DPKCS036
118200                                   TO TRUE                        DPKCS036
118300                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
118400                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
118500                                   TO TRUE                        DPKCS036
118600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         DPKCS036
118700                 MOVE DP015-UNDERLINE                             DPKCS036
118800                                   TO MR-SELECTH (PV-SUB)         DPKCS036
118900                 SET PS-ERROR      TO TRUE                        DPKCS036
119000             END-IF                                               DPKCS036
119100         END-IF                                                   DPKCS036
119200     ELSE                                                         DPKCS036
119300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
119400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
119500                                   TO ASC-SELECTED-SW             DPKCS036
119600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   DPKCS036
119700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   DPKCS036
119800         ELSE                                                     DPKCS036
119900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       DPKCS036
120000                 CONTINUE                                         DPKCS036
120100             ELSE                                                 DPKCS036
120200*                -- ONLY ONE END-OF-RANGE ALLOWED --              DPKCS036
120300                 MOVE PC-TSYMSG-00055                             DPKCS036
120400                                   TO DP020-MSG-NUMBER            DPKCS036
120500                 SET DP020-MSG-FATAL                              DPKCS036
120600                                   TO TRUE                        DPKCS036
120700                 MOVE -1           TO MR-SELECTL (PV-SUB)         DPKCS036
120800                 SET DP030-SET-CURSOR-APPL-1                      DPKCS036
120900                                   TO TRUE                        DPKCS036
121000                 SET PS-ERROR      TO TRUE                        DPKCS036
121100             END-IF                                               DPKCS036
121200         END-IF                                                   DPKCS036
121300     END-IF.                                                      DPKCS036
121400*                                                                 DPKCS036
121500******************************************************************DPKCS036
121600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **DPKCS036
121700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **DPKCS036
121800******************************************************************DPKCS036
121900 3400-CHECK-RANGE-SEQUENCE.                                       DPKCS036
122000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
122100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      DPKCS036
122200       AND  ASC-START-OF-SELECTED-RANGE >                         DPKCS036
122300                                         ASC-END-OF-SELECTED-RANGEDPKCS036
122400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                DPKCS036
122500         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 DPKCS036
122600         SET DP020-MSG-FATAL TO TRUE                              DPKCS036
122700         SET PS-ERROR TO TRUE                                     DPKCS036
122800         PERFORM 3410-POSITION-AT-ERROR                           DPKCS036
122900     END-IF.                                                      DPKCS036
123000******************************************************************DPKCS036
123100** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **DPKCS036
123200** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **DPKCS036
123300** SHOULD BE POSITIONED ON A RANGE ERROR.                       **DPKCS036
123400******************************************************************DPKCS036
123500 3410-POSITION-AT-ERROR.                                          DPKCS036
123600     SET DP030-SET-CURSOR-APPL-1                                  DPKCS036
123700                                   TO TRUE.                       DPKCS036
123800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
123900                    - PV-TOP-ITEM + 1.                            DPKCS036
124000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
124100         CONTINUE                                                 DPKCS036
124200     ELSE                                                         DPKCS036
124300         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
124400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
124500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
124600     END-IF.                                                      DPKCS036
124700*                                                                 DPKCS036
124800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
124900                    - PV-TOP-ITEM + 1.                            DPKCS036
125000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
125100         CONTINUE                                                 DPKCS036
125200     ELSE                                                         DPKCS036
125300         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
125400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
125500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         DPKCS036
125600     END-IF.                                                      DPKCS036
125700 EJECT                                                            DPKCS036
125800*----------------------------------------------------------------*DPKCS036
125900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *DPKCS036
126000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *DPKCS036
126100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *DPKCS036
126200*----------------------------------------------------------------*DPKCS036
126300                                                                  DPKCS036
126400 3500-MARK-RANGE-AS-SELECTED.                                     DPKCS036
126500     MOVE +1                       TO  ASC-BLK-SUB.               DPKCS036
126600     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
126700         VARYING ASC-ITEM-SUB                                     DPKCS036
126800         FROM 1 BY 1                                              DPKCS036
126900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
127000                                                                  DPKCS036
127100     ADD +1                        TO ASC-BLK-SUB.                DPKCS036
127200     PERFORM 3510-MARK-SELECTED-INDS                              DPKCS036
127300         VARYING ASC-ITEM-SUB                                     DPKCS036
127400         FROM 1 BY 1                                              DPKCS036
127500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 DPKCS036
127600                                                                  DPKCS036
127700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               DPKCS036
127800                                   TO  PV-LIST-ITEM-NUMBER.       DPKCS036
127900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            DPKCS036
128000         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         DPKCS036
128100               PC-ITEMS-PER-PANEL).                               DPKCS036
128200                                                                  DPKCS036
128300     MOVE ASC-START-OF-SELECTED-RANGE                             DPKCS036
128400                                   TO PV-START-OF-SELECTED-RANGE. DPKCS036
128500     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            DPKCS036
128600         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  DPKCS036
128700               PC-ITEMS-PER-PANEL).                               DPKCS036
128800                                                                  DPKCS036
128900     MOVE ASC-END-OF-SELECTED-RANGE                               DPKCS036
129000                                   TO  PV-END-OF-SELECTED-RANGE.  DPKCS036
129100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             DPKCS036
129200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    DPKCS036
129300               PC-ITEMS-PER-PANEL).                               DPKCS036
129400     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             DPKCS036
129500         PV-FIRST-BLOCK-IN-ARRAY + 1.                             DPKCS036
129600                                                                  DPKCS036
129700     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    DPKCS036
129800        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        DPKCS036
129900         MOVE +1                   TO ASC-BLK-SUB                 DPKCS036
130000         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
130100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         DPKCS036
130200             PV-FIRST-BLOCK-IN-ARRAY - 1                          DPKCS036
130300                                                                  DPKCS036
130400         PERFORM                                                  DPKCS036
130500             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      DPKCS036
130600                   PV-PREV-BLOCK-IN-ARRAY                         DPKCS036
130700             MOVE PV-FIRST-BLOCK-IN-RANGE                         DPKCS036
130800                                   TO PV-BLOCK-NUMBER             DPKCS036
130900             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
131000             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
131100                 VARYING ASC-ITEM-SUB                             DPKCS036
131200                 FROM 1 BY 1                                      DPKCS036
131300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
131400             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
131500             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     DPKCS036
131600         END-PERFORM                                              DPKCS036
131700                                                                  DPKCS036
131800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         DPKCS036
131900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     DPKCS036
132000         PERFORM                                                  DPKCS036
132100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       DPKCS036
132200                   PV-LAST-BLOCK-IN-RANGE                         DPKCS036
132300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          DPKCS036
132400                                   TO PV-BLOCK-NUMBER             DPKCS036
132500             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
132600             PERFORM 3510-MARK-SELECTED-INDS                      DPKCS036
132700                 VARYING ASC-ITEM-SUB                             DPKCS036
132800                 FROM 1 BY 1                                      DPKCS036
132900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          DPKCS036
133000             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
133100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      DPKCS036
133200         END-PERFORM                                              DPKCS036
133300                                                                  DPKCS036
133400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             DPKCS036
133500                                   TO PV-BLOCK-NUMBER             DPKCS036
133600         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
133700     END-IF.                                                      DPKCS036
133800                                                                  DPKCS036
133900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE DPKCS036
134000                                      ASC-END-OF-SELECTED-RANGE.  DPKCS036
134100                                                                  DPKCS036
134200 EJECT                                                            DPKCS036
134300*----------------------------------------------------------------*DPKCS036
134400* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *DPKCS036
134500*----------------------------------------------------------------*DPKCS036
134600                                                                  DPKCS036
134700 3510-MARK-SELECTED-INDS.                                         DPKCS036
134800                                                                  DPKCS036
134900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
135000                                ASC-ITEM-SUB) >                   DPKCS036
135100         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
135200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         DPKCS036
135300                                ASC-ITEM-SUB) =                   DPKCS036
135400         ASC-START-OF-SELECTED-RANGE)                             DPKCS036
135500                                                                  DPKCS036
135600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
135700                                    ASC-ITEM-SUB) <               DPKCS036
135800             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
135900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     DPKCS036
136000                                    ASC-ITEM-SUB) =               DPKCS036
136100             ASC-END-OF-SELECTED-RANGE)                           DPKCS036
136200                                                                  DPKCS036
136300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          DPKCS036
136400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
136500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   DPKCS036
136600                               TO TRUE                            DPKCS036
136700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              DPKCS036
136800                               TO TRUE                            DPKCS036
136900                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    DPKCS036
137000             END-IF                                               DPKCS036
137100         END-IF                                                   DPKCS036
137200     END-IF.                                                      DPKCS036
137300                                                                  DPKCS036
137400 EJECT                                                            DPKCS036
137500*----------------------------------------------------------------*DPKCS036
137600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *DPKCS036
137700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *DPKCS036
137800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *DPKCS036
137900*    DISPLAY THE PANEL TO USER.                                  *DPKCS036
138000*----------------------------------------------------------------*DPKCS036
138100                                                                  DPKCS036
138200 4000-BUILD-INITIAL-PANEL.                                        DPKCS036
138300                                                                  DPKCS036
138400     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            DPKCS036
138500                                 ASC-BLOCK-ENTRIES (2).           DPKCS036
138600     MOVE +1                 TO ASC-BLK-SUB.                      DPKCS036
138700     SET ASC-ITEMS-LEFT-ON-DB                                     DPKCS036
138800                             TO TRUE.                             DPKCS036
138900                                                                  DPKCS036
139000     MOVE +0                 TO ASC-ITEM-SUB                      DPKCS036
139100                                ASC-NUMBER-OF-ITEMS-READ          DPKCS036
139200                                ASC-NUMBER-OF-SELECTED-ITEMS      DPKCS036
139300                                ASC-HIGHEST-BLOCK-WRITTEN         DPKCS036
139400                                ASC-START-OF-SELECTED-RANGE       DPKCS036
139500                                ASC-END-OF-SELECTED-RANGE         DPKCS036
139600                                ASC-ITEM-AT-TOP-OF-PANEL.         DPKCS036
139700     PERFORM 4010-OPEN-CURSOR.                                    DPKCS036
139800                                                                  DPKCS036
139900     PERFORM 4300-READ-ITEMS-FROM-DB.                             DPKCS036
140000                                                                  DPKCS036
140100     PERFORM 4020-CLOSE-CURSOR.                                   DPKCS036
140200                                                                  DPKCS036
140300     MOVE +1                   TO  PV-TOP-ITEM.                   DPKCS036
140400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          DPKCS036
140500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    DPKCS036
140600         SET DP020-MSG-FATAL   TO  TRUE                           DPKCS036
140700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               DPKCS036
140800     ELSE                                                         DPKCS036
140900         MOVE -1               TO MR-SELECTL (1)                  DPKCS036
141000         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
141100                               TO TRUE                            DPKCS036
141200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     DPKCS036
141300     END-IF.                                                      DPKCS036
141400 EJECT                                                            DPKCS036
141500*----------------------------------------------------------------*DPKCS036
141600* OPEN THE TMESSAGE CURSOR.                                      *DPKCS036
141700*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *DPKCS036
141800*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *DPKCS036
141900*   USER.                                                        *DPKCS036
142000*----------------------------------------------------------------*DPKCS036
142100                                                                  DPKCS036
142200 4010-OPEN-CURSOR.                                                DPKCS036
142300     PERFORM                                                      DPKCS036
142400         WITH TEST AFTER                                          DPKCS036
142500         VARYING PV-RETRY-COUNTER                                 DPKCS036
142600         FROM 1 BY 1                                              DPKCS036
142700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               DPKCS036
142800                   OR (SQLCODE = ZERO))                           DPKCS036
142900         EXEC SQL                                                       36
143000             OPEN TKT_FMT_CURSOR                                  DPKCS036
143100         END-EXEC                                                       36
143200                                                                  DPKCS036
143300         EVALUATE TRUE                                            DPKCS036
143400             WHEN SQLCODE = ZERO                                  DPKCS036
143500             WHEN SQLCODE = -904                                  DPKCS036
143600             WHEN SQLCODE = -913                                  DPKCS036
143700                 CONTINUE                                         DPKCS036
143800             WHEN SQLWARN0 NOT = SPACES                           DPKCS036
143900             WHEN SQLCODE < ZERO                                  DPKCS036
144000             WHEN SQLCODE > ZERO                                  DPKCS036
144100                 MOVE '4010-OPEN-CURSOR'                          DPKCS036
144200                                   TO DP013-PARAGRAPH             DPKCS036
144300                 MOVE 'OPEN TICKET_FOMRAT_CURSOR '                      36
144400                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
144500                 MOVE SQLCA        TO DP013-SQLCA                 DPKCS036
144600                 MOVE 'TTKTFMT '   TO DP013-DB2-TABLE-NAME (1)    DPKCS036
144800                 SET DP013-DB2-ABEND                              DPKCS036
144900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           DPKCS036
145000                 PERFORM DP013-0000-PROCESS-ABEND                 DPKCS036
145100         END-EVALUATE                                             DPKCS036
145200     END-PERFORM.                                                 DPKCS036
145300*                                                                 DPKCS036
145400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        DPKCS036
145500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             DPKCS036
145600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   DPKCS036
145700                                   TO DP013-MESSAGE-TEXT (1)      DPKCS036
145800         MOVE SQLCA                TO DP013-SQLCA                 DPKCS036
145900         MOVE 'TTKTFMT '           TO DP013-DB2-TABLE-NAME (1)    DPKCS036
146100         SET DP013-DB2-ABEND                                      DPKCS036
146200             DP013-XCTL-DISPLAY-RESTART                           DPKCS036
146300                                   TO TRUE                        DPKCS036
146400         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
146500     END-IF.                                                      DPKCS036
146600                                                                  DPKCS036
146700 EJECT                                                            DPKCS036
146800*----------------------------------------------------------------*DPKCS036
146900* CLOSE THE TMESSAGE CURSOR.                                     *DPKCS036
147000*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *DPKCS036
147100*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *DPKCS036
147200*   USER.                                                        *DPKCS036
147300*----------------------------------------------------------------*DPKCS036
147400                                                                  DPKCS036
147500 4020-CLOSE-CURSOR.                                               DPKCS036
147600     EXEC SQL                                                     DPKCS036
147700         CLOSE TKT_FMT_CURSOR                                     DPKCS036
147800     END-EXEC.                                                          36
147900*                                                                 DPKCS036
148000     EVALUATE TRUE                                                DPKCS036
148100         WHEN SQLCODE = ZERO                                      DPKCS036
148200             CONTINUE                                             DPKCS036
148300         WHEN SQLWARN0 NOT = SPACES                               DPKCS036
148400         WHEN SQLCODE < ZERO                                      DPKCS036
148500         WHEN SQLCODE > ZERO                                      DPKCS036
148600             MOVE '4020-CLOSE-CURSOR'                             DPKCS036
148700                               TO DP013-PARAGRAPH                 DPKCS036
148800             MOVE 'CLOSE TKT_FMT_CURSOR  '                        DPKCS036
148900                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
149000             MOVE SQLCA        TO DP013-SQLCA                     DPKCS036
149100             SET DP013-DB2-ABEND                                  DPKCS036
149200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               DPKCS036
149300             PERFORM DP013-0000-PROCESS-ABEND                     DPKCS036
149400     END-EVALUATE.                                                DPKCS036
149500                                                                  DPKCS036
149600 EJECT                                                            DPKCS036
149700*----------------------------------------------------------------*DPKCS036
149800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *DPKCS036
149900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *DPKCS036
150000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *DPKCS036
150100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *DPKCS036
150200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *DPKCS036
150300*                                                                *DPKCS036
150400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *DPKCS036
150500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *DPKCS036
150600*    UPON INITIALIZATION.                                        *DPKCS036
150700*----------------------------------------------------------------*DPKCS036
150800                                                                  DPKCS036
150900 4300-READ-ITEMS-FROM-DB.                                         DPKCS036
151000                                                                  DPKCS036
151100     PERFORM                                                      DPKCS036
151200         VARYING PV-READ-COUNT                                    DPKCS036
151300         FROM 1 BY 1                                              DPKCS036
151400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    DPKCS036
151500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         DPKCS036
151600                                                                  DPKCS036
151700         PERFORM 4310-FETCH                                       DPKCS036
151800                                                                  DPKCS036
151900         IF  ASC-ITEMS-LEFT-ON-DB                                 DPKCS036
152000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                DPKCS036
152100                 ADD +1            TO ASC-ITEM-SUB                DPKCS036
152200             ELSE                                                 DPKCS036
152300                 ADD +1            TO ASC-BLK-SUB                 DPKCS036
152400                 MOVE +1           TO ASC-ITEM-SUB                DPKCS036
152500                                                                  DPKCS036
152600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         DPKCS036
152700                     MOVE +1       TO ASC-BLK-SUB                 DPKCS036
152800                     SET ASC-BLOCK-MODIFIED (1)                   DPKCS036
152900                                   TO TRUE                        DPKCS036
153000                     PERFORM 5100-WRITE-TEMP-STORAGE              DPKCS036
153100                     MOVE ASC-BLOCK-ENTRIES                       DPKCS036
153200                               (PC-MAX-BLOCKS-IN-ARRAY)           DPKCS036
153300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) DPKCS036
153400                     ADD +1        TO ASC-BLK-SUB                 DPKCS036
153500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   DPKCS036
153600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      DPKCS036
153700                                   TO TRUE                        DPKCS036
153800                 END-IF                                           DPKCS036
153900             END-IF                                               DPKCS036
154000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    DPKCS036
154100             MOVE ASC-NUMBER-OF-ITEMS-READ                        DPKCS036
154200                                   TO ASC-LIST-ITEM-NUMBER        DPKCS036
154300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  DPKCS036
154400             MOVE TKTFMT-TKT-FMT-ID                                     36
154500                                   TO ASC-TKT-FMT-ID                    36
154600                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
154700             MOVE TKTFMT-TKT-FMT-DESC                             DPKCS036
154800                                   TO ASC-TKT-FMT-DESC                  36
154900                                       (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
154910                                                                        KC
154920             PERFORM 4320-GET-PRETICKET-INFO                          DPKC
155000             IF VSCHVL-STAT-CDE = 'A'                             DPKCS036
155010                 SET ASC-VALID-PTICK-FMT                          DPKCS036
155020                     (ASC-BLK-SUB ASC-ITEM-SUB)  TO TRUE                36
155300             ELSE                                                       36
155400                 SET ASC-NOT-VALID-PTICK-FMT                      DPKCS036
155500                     (ASC-BLK-SUB ASC-ITEM-SUB)  TO TRUE                36
155600             END-IF                                                     36
155700         END-IF                                                   DPKCS036
155800     END-PERFORM.                                                 DPKCS036
155900                                                                  DPKCS036
156000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          DPKCS036
156100         MOVE +1               TO ASC-BLK-SUB                     DPKCS036
156200         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
156300         ADD +1                TO ASC-BLK-SUB                     DPKCS036
156400         PERFORM 5100-WRITE-TEMP-STORAGE                          DPKCS036
156500                                                                  DPKCS036
156600         MOVE 1                TO ASC-BLK-SUB                     DPKCS036
156700                                  PV-BLOCK-NUMBER                 DPKCS036
156800         PERFORM 4410-READ-TEMP-STORAGE                           DPKCS036
156900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             DPKCS036
157000             MOVE 2            TO ASC-BLK-SUB                     DPKCS036
157100                                  PV-BLOCK-NUMBER                 DPKCS036
157200             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
157300         END-IF                                                   DPKCS036
157400     END-IF.                                                      DPKCS036
157500 EJECT                                                            DPKCS036
157600*----------------------------------------------------------------*DPKCS036
157700*    FETCH THE MESSAGE CURSOR.                                   *DPKCS036
157800*----------------------------------------------------------------*DPKCS036
157900                                                                  DPKCS036
158000 4310-FETCH.                                                      DPKCS036
158100                                                                  DPKCS036
158110     INITIALIZE DCLTTKTFMT.                                       DPKCS036
158120                                                                  DPKCS036
158200     EXEC SQL                                                           36
158300         FETCH TKT_FMT_CURSOR                                     DPKCS036
158400         INTO  :TKTFMT-TKT-FMT-ID                                 DPKCS036
158500             , :TKTFMT-TKT-FMT-DESC                               DPKCS036
158700     END-EXEC.                                                          36
158800                                                                  DPKCS036
158900     EVALUATE TRUE                                                DPKCS036
159000         WHEN SQLCODE = ZERO                                      DPKCS036
159100         WHEN SQLCODE = +100                                      DPKCS036
159200              CONTINUE                                            DPKCS036
159300         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
159400         WHEN SQLCODE NOT = ZERO                                  DPKCS036
159500              MOVE '4310-FETCH-CURSOR'                            DPKCS036
159600                               TO DP013-PARAGRAPH                 DPKCS036
159700              MOVE 'FETCH TKT_FMT_CURSOR'                         DPKCS036
159800                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
159810              MOVE 'TTKTFMT '  TO DP013-DB2-TABLE-NAME (1)                
159900              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
160000              SET DP013-DB2-ABEND                                 DPKCS036
160100                               TO TRUE                            DPKCS036
160200              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
160300     END-EVALUATE.                                                DPKCS036
160400                                                                  DPKCS036
160500     IF  SQLCODE EQUAL +100                                       DPKCS036
160600         SET ASC-NO-ITEMS-LEFT-ON-DB                              DPKCS036
160700                                   TO TRUE                        DPKCS036
160800     END-IF.                                                      DPKCS036
160900                                                                  DPKCS036
161000 EJECT                                                            DPKCS036
161001*----------------------------------------------------------------*        
161002*    DETERMINE IF THE TICKET FORMAT IS PRETICKET TYPE            *        
161003*----------------------------------------------------------------*        
161004                                                                          
161005 4320-GET-PRETICKET-INFO.                                                 
161006                                                                          
161007     INITIALIZE DCLTVSCHVL.                                               
161008                                                                          
161009     EXEC SQL                                                             
161010         SELECT  DISTINCT                                                 
161011                 STAT_CDE                                                 
161012         INTO                                                             
161013                 :VSCHVL-STAT-CDE                                         
161014         FROM                                                             
161015                 TVSCHVL                                                  
161016         WHERE                                                            
161017               CHARTC_CDE      = :PC-VS-TICKET-TYPE-CDE                   
161018           AND CHARTC_VAL_DESC = :TKTFMT-TKT-FMT-DESC                     
161019           AND STAT_CDE        = 'A'                                      
161020     END-EXEC.                                                            
161021                                                                          
161022     EVALUATE TRUE                                                DPKCS036
161023         WHEN SQLCODE = ZERO                                      DPKCS036
161024         WHEN SQLCODE = +100                                      DPKCS036
161025              CONTINUE                                            DPKCS036
161026         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
161027         WHEN SQLCODE NOT = ZERO                                  DPKCS036
161028              MOVE '4320-GET-PRETICKET-INFO'                      DPKCS036
161029                               TO DP013-PARAGRAPH                 DPKCS036
161030              MOVE 'FETCH PRETICKET INFORMATION'                  DPKCS036
161031                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
161032              MOVE TKTFMT-TKT-FMT-DESC                                    
161033                               TO DP013-MESSAGE-TEXT (2)                  
161034              MOVE 'TVSCHVL '  TO DP013-DB2-TABLE-NAME (1)                
161035              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
161036              SET DP013-DB2-ABEND                                 DPKCS036
161037                               TO TRUE                            DPKCS036
161038              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
161039     END-EVALUATE.                                                DPKCS036
161055                                                                          
161060 EJECT                                                                    
161100*----------------------------------------------------------------*DPKCS036
161200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *DPKCS036
161300*----------------------------------------------------------------*DPKCS036
161400                                                                  DPKCS036
161500 4400-MOVE-COMMAREA-TO-SCREEN.                                    DPKCS036
161600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             DPKCS036
161700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          DPKCS036
161800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          DPKCS036
161900             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
162000             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
162100             ADD +1     TO ASC-BLK-SUB                            DPKCS036
162200             PERFORM 5100-WRITE-TEMP-STORAGE                      DPKCS036
162300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             DPKCS036
162400                 GIVING PV-BLOCK-NUMBER                           DPKCS036
162500                 REMAINDER PV-REMAINDER                           DPKCS036
162600             IF  PV-REMAINDER > ZERO                              DPKCS036
162700                 ADD +1 TO PV-BLOCK-NUMBER                        DPKCS036
162800             END-IF                                               DPKCS036
162900             MOVE +1    TO ASC-BLK-SUB                            DPKCS036
163000             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
163100             ADD +1     TO ASC-BLK-SUB                            DPKCS036
163200                           PV-BLOCK-NUMBER                        DPKCS036
163300             PERFORM 4410-READ-TEMP-STORAGE                       DPKCS036
163400     END-IF.                                                      DPKCS036
163500     MOVE +1            TO ASC-BLK-SUB.                           DPKCS036
163600     COMPUTE ASC-ITEM-SUB =                                       DPKCS036
163700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              DPKCS036
163800         + PC-ITEMS-PER-PANEL).                                   DPKCS036
163900*                                                                 DPKCS036
164000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        DPKCS036
164100         ADD +1         TO ASC-BLK-SUB                            DPKCS036
164200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            DPKCS036
164300     END-IF.                                                      DPKCS036
164400*                                                                 DPKCS036
164500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           DPKCS036
164600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                DPKCS036
164700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        DPKCS036
164800     PERFORM 4420-FORMAT-LIST-LINES                               DPKCS036
164900         VARYING PV-SUB                                           DPKCS036
165000         FROM PC-ITEMS-PER-PANEL BY -1                            DPKCS036
165100         UNTIL PV-SUB < +1.                                       DPKCS036
165200*                                                                 DPKCS036
165300     COMPUTE ASC-ITEMS-DISPLAYED =                                DPKCS036
165400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          DPKCS036
165500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    DPKCS036
165600                                      ASTRTITO.                   DPKCS036
165700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    DPKCS036
165800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    DPKCS036
165900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
166000                                   TO ATOTSELO.                   DPKCS036
166100*                                                                 DPKCS036
166200     IF  DP020-MSG-NUMBER-X = SPACE                               DPKCS036
166300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  DPKCS036
166400*            --- MORE ITEMS TO DISPLAY ----                       DPKCS036
166500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            DPKCS036
166600             SET DP020-MSG-INFORMATIONAL TO TRUE                  DPKCS036
166700         END-IF                                                   DPKCS036
166800     END-IF.                                                      DPKCS036
166900*----------------------------------------------------------------*DPKCS036
167000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *DPKCS036
167100*----------------------------------------------------------------*DPKCS036
167200                                                                  DPKCS036
167300 4410-READ-TEMP-STORAGE.                                          DPKCS036
167400                                                                  DPKCS036
167500     EXEC CICS                                                    DPKCS036
167600         READQ TS                                                 DPKCS036
167700             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
167800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
167900             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
168000             RESP  (PV-CICS-RESP)                                 DPKCS036
168100     END-EXEC.                                                    DPKCS036
168200                                                                  DPKCS036
168300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       DPKCS036
168400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     DPKCS036
168500         CONTINUE                                                 DPKCS036
168600     ELSE                                                         DPKCS036
168700         SET DP013-CICS-ABEND     TO TRUE                         DPKCS036
168800         SET DP013-NO-ROLLBACK    TO TRUE                         DPKCS036
168900         MOVE '4410-READ-TEMP-STORAGE'                            DPKCS036
169000                                  TO DP013-PARAGRAPH              DPKCS036
169100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      DPKCS036
169200                                  TO DP013-MESSAGE-TEXT(1)        DPKCS036
169300         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
169400     END-IF.                                                      DPKCS036
169500                                                                  DPKCS036
169600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
169700*                                                                 DPKCS036
169800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         DPKCS036
169900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               DPKCS036
170000     END-IF.                                                      DPKCS036
170100 EJECT                                                            DPKCS036
170200*----------------------------------------------------------------*DPKCS036
170300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *DPKCS036
170400*----------------------------------------------------------------*DPKCS036
170500                                                                  DPKCS036
170600 4420-FORMAT-LIST-LINES.                                          DPKCS036
170700     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      DPKCS036
170800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                DPKCS036
170900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           DPKCS036
171000         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           DPKCS036
171100         MOVE SPACE              TO MR-SELECTI (PV-SUB)           DPKCS036
171200                                    MR-ACTION (PV-SUB)            DPKCS036
171300                                    MR-TKT-FMT-ID (PV-SUB)              36
171400                                    MR-TKT-FMT-DESC (PV-SUB)      DPKCS036
171500                                    MR-PTICK-FMT-IND (PV-SUB)           36
171600     ELSE                                                         DPKCS036
171700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
171800                                                   > SPACE        DPKCS036
171900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) DPKCS036
172000                                 TO MR-SELECTI (PV-SUB)           DPKCS036
172100         ELSE                                                     DPKCS036
172200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      DPKCS036
172300                                 TO MR-SELECTI (PV-SUB)           DPKCS036
172400         END-IF                                                   DPKCS036
172500*                                                                 DPKCS036
172600         IF  DP030-SET-CURSOR-TRAILER                             DPKCS036
172700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)DPKCS036
172800                 > SPACE)                                         DPKCS036
172900               OR (PV-SUB = 1))                                   DPKCS036
173000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               DPKCS036
173100                MOVE -1          TO MR-SELECTL (PV-SUB)           DPKCS036
173200             END-IF                                               DPKCS036
173300         END-IF                                                   DPKCS036
173400*                                                                 DPKCS036
173500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           DPKCS036
173600             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           DPKCS036
173700                                 TO MR-ACTION (PV-SUB)            DPKCS036
173800             MOVE ASC-TKT-FMT-ID (ASC-BLK-SUB ASC-ITEM-SUB)             36
173900                                 TO MR-TKT-FMT-ID (PV-SUB)              36
174000             MOVE ASC-TKT-FMT-DESC (ASC-BLK-SUB ASC-ITEM-SUB)           36
174100                                 TO MR-TKT-FMT-DESC (PV-SUB)            36
174200             MOVE ASC-PTICK-FMT-IND (ASC-BLK-SUB ASC-ITEM-SUB)          36
174300                                 TO MR-PTICK-FMT-IND (PV-SUB)           36
174400         END-IF                                                   DPKCS036
174500     END-IF.                                                      DPKCS036
174600     SUBTRACT +1 FROM ASC-ITEM-SUB                                DPKCS036
174700     IF  ASC-ITEM-SUB < + 1                                       DPKCS036
174800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  DPKCS036
174900         MOVE +1                 TO ASC-BLK-SUB                   DPKCS036
175000     END-IF.                                                      DPKCS036
175100******************************************************************DPKCS036
175200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **DPKCS036
175300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **DPKCS036
175400** ISSUE A WARNING.                                             **DPKCS036
175500******************************************************************DPKCS036
175600 4430-CHECK-FOR-BEGIN-AND-END.                                    DPKCS036
175700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       DPKCS036
175800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     DPKCS036
175900*            -- NO END-OF-RANGE SPECFIED ---                      DPKCS036
176000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            DPKCS036
176100             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
176200             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
176300         END-IF                                                   DPKCS036
176400     ELSE                                                         DPKCS036
176500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     DPKCS036
176600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                DPKCS036
176700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            DPKCS036
176800             SET DP020-MSG-WARNING TO TRUE                        DPKCS036
176900             PERFORM 4431-POSITION-AT-WARNING                     DPKCS036
177000         END-IF                                                   DPKCS036
177100     END-IF.                                                      DPKCS036
177200******************************************************************DPKCS036
177300** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **DPKCS036
177400** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **DPKCS036
177500** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **DPKCS036
177600** POSITION THE CURSOR THERE.                                   **DPKCS036
177700******************************************************************DPKCS036
177800 4431-POSITION-AT-WARNING.                                        DPKCS036
177900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 DPKCS036
178000                    - PV-TOP-ITEM + 1.                            DPKCS036
178100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
178200         CONTINUE                                                 DPKCS036
178300     ELSE                                                         DPKCS036
178400         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
178500                                   TO TRUE                        DPKCS036
178600         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
178700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
178800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
178900     END-IF.                                                      DPKCS036
179000*                                                                 DPKCS036
179100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   DPKCS036
179200                    - PV-TOP-ITEM + 1.                            DPKCS036
179300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      DPKCS036
179400         CONTINUE                                                 DPKCS036
179500     ELSE                                                         DPKCS036
179600         SET DP030-SET-CURSOR-APPL-1                              DPKCS036
179700                                   TO TRUE                        DPKCS036
179800         MOVE -1                   TO MR-SELECTL (PV-SUB)         DPKCS036
179900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         DPKCS036
180000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         DPKCS036
180100     END-IF.                                                      DPKCS036
180200 EJECT                                                            DPKCS036
180300*----------------------------------------------------------------*DPKCS036
180400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *DPKCS036
180500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *DPKCS036
180600* FOR THE SELECTED ITEMS QUEUE.                                  *DPKCS036
180700*                                                                *DPKCS036
180800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *DPKCS036
180900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *DPKCS036
181000* THE ARRAY IS FULL.                                             *DPKCS036
181100*----------------------------------------------------------------*DPKCS036
181200                                                                  DPKCS036
181300 5000-PREPARE-SEL-QUEUE.                                          DPKCS036
181400                                                                  DPKCS036
181500     MOVE +1                   TO  ASC-BLK-SUB.                   DPKCS036
181600     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
181700     ADD +1                    TO  ASC-BLK-SUB.                   DPKCS036
181800     PERFORM 5100-WRITE-TEMP-STORAGE.                             DPKCS036
181900                                                                  DPKCS036
182000     MOVE ASC-SEL-QUEUE-NAME   TO  VL013-SEL-QUEUE-NAME.          DPKCS036
182100     PERFORM 6010-DELETE-SEL-QUEUE.                               DPKCS036
182200                                                                  DPKCS036
182300     SET ASC-UPDATE-TSQ        TO  TRUE.                          DPKCS036
182400                                                                  DPKCS036
182500     SET VL014-IDX             TO  1.                             DPKCS036
182600     MOVE ZERO                 TO VL013-NUMBER-OF-TS-ITEMS.       DPKCS036
182700     INITIALIZE VL014-SELECTED-ITEM-ARRAY.                        DPKCS036
182800                                                                  DPKCS036
182900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           DPKCS036
183000             VARYING PV-ITEM                                      DPKCS036
183100             FROM 1 BY 1                                          DPKCS036
183200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     DPKCS036
183300                                                                  DPKCS036
183400     IF  VL014-IDX > 1                                            DPKCS036
183500         PERFORM 5205-WRITE-SEL-QUEUE                             DPKCS036
183600         ADD +1                TO VL013-NUMBER-OF-TS-ITEMS        DPKCS036
183700     END-IF.                                                      DPKCS036
183800 EJECT                                                            DPKCS036
183900*----------------------------------------------------------------*DPKCS036
184000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *DPKCS036
184100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *DPKCS036
184200*----------------------------------------------------------------*DPKCS036
184300                                                                  DPKCS036
184400 5100-WRITE-TEMP-STORAGE.                                         DPKCS036
184500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     DPKCS036
184600                                   TO PV-LIST-ITEM-NUMBER.        DPKCS036
184700     COMPUTE PV-BLOCK-NUMBER =                                    DPKCS036
184800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    DPKCS036
184900                                                                  DPKCS036
185000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
185100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             DPKCS036
185200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      DPKCS036
185300             PERFORM 5105-REWRITE-ASC-LISTQ                       DPKCS036
185400         END-IF                                                   DPKCS036
185500     ELSE                                                         DPKCS036
185600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       DPKCS036
185700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            DPKCS036
185800         PERFORM 5110-WRITE-ASC-LISTQ                             DPKCS036
185900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   DPKCS036
186000     END-IF.                                                      DPKCS036
186100                                                                  DPKCS036
186200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             DPKCS036
186300******************************************************************DPKCS036
186400** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **DPKCS036
186500** SPECIFIC COMMAREA.                                           **DPKCS036
186600******************************************************************DPKCS036
186700 5105-REWRITE-ASC-LISTQ.                                          DPKCS036
186800     EXEC CICS                                                    DPKCS036
186900         WRITEQ TS                                                DPKCS036
187000             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
187100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
187200             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
187300             REWRITE                                              DPKCS036
187400             RESP  (PV-CICS-RESP)                                 DPKCS036
187500     END-EXEC.                                                    DPKCS036
187600                                                                  DPKCS036
187700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           DPKCS036
187800         CONTINUE                                                 DPKCS036
187900     ELSE                                                         DPKCS036
188000         SET DP013-CICS-ABEND            TO TRUE                  DPKCS036
188100         SET DP013-NO-ROLLBACK           TO TRUE                  DPKCS036
188200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       DPKCS036
188300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     DPKCS036
188400                                         TO DP013-MESSAGE-TEXT(1) DPKCS036
188500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
188600     END-IF.                                                      DPKCS036
188700                                                                  DPKCS036
188800******************************************************************DPKCS036
188900** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **DPKCS036
189000** SPECIFIC COMMAREA.                                           **DPKCS036
189100******************************************************************DPKCS036
189200 5110-WRITE-ASC-LISTQ.                                            DPKCS036
189300     EXEC CICS                                                    DPKCS036
189400         WRITEQ TS                                                DPKCS036
189500             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
189600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               DPKCS036
189700             ITEM  (PV-BLOCK-NUMBER)                              DPKCS036
189800             RESP  (PV-CICS-RESP)                                 DPKCS036
189900     END-EXEC.                                                    DPKCS036
190000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      DPKCS036
190100         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
190200         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
190300         MOVE '5110-WRITE-ASC-LISTQ'                              DPKCS036
190400                                   TO DP013-PARAGRAPH             DPKCS036
190500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           DPKCS036
190600                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
190700         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
190800     END-IF.                                                      DPKCS036
190900 EJECT                                                            DPKCS036
191000*----------------------------------------------------------------*DPKCS036
191100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *DPKCS036
191200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *DPKCS036
191300*----------------------------------------------------------------*DPKCS036
191400                                                                  DPKCS036
191500 5200-FILL-SEL-QUEUE-RECORD.                                      DPKCS036
191600                                                                  DPKCS036
191700     PERFORM 6112-READ-LIST-QUEUE.                                DPKCS036
191800                                                                  DPKCS036
191900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       DPKCS036
192000         PERFORM                                                  DPKCS036
192100         VARYING LQW-IDX                                          DPKCS036
192200         FROM 1 BY 1                                              DPKCS036
192300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            DPKCS036
192400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          DPKCS036
192500                                                                  DPKCS036
192600             IF  LQW-SELECT (LQW-IDX)                             DPKCS036
192700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              DPKCS036
192800                                   TO VL014-ITEM (VL014-IDX)      DPKCS036
192900                 MOVE LQW-TKT-FMT-ID (LQW-IDX)                          36
193000                                   TO VL014-TKT-FMT-ID            DPKCS036
193100                                        (VL014-IDX)               DPKCS036
193200                 MOVE SPACE        TO VL014-ACTION-SW (VL014-IDX) DPKCS036
193300                 SET VL014-IDX UP BY 1                            DPKCS036
193400                 IF  VL014-IDX > VL014-MAX-ITEMS                  DPKCS036
193500                     PERFORM 5205-WRITE-SEL-QUEUE                 DPKCS036
193600                     ADD +1        TO VL013-NUMBER-OF-TS-ITEMS    DPKCS036
193700                     INITIALIZE VL014-SELECTED-ITEM-ARRAY         DPKCS036
193800                     SET VL014-IDX TO  1                          DPKCS036
193900                 END-IF                                           DPKCS036
194000             END-IF                                               DPKCS036
194100         END-PERFORM                                              DPKCS036
194200     END-IF.                                                      DPKCS036
194300                                                                  DPKCS036
194400*----------------------------------------------------------------*DPKCS036
194500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *DPKCS036
194600*----------------------------------------------------------------*DPKCS036
194700                                                                  DPKCS036
194800 5205-WRITE-SEL-QUEUE.                                            DPKCS036
194900                                                                  DPKCS036
195000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            DPKCS036
195100                                   TO VL014-SELECTED-ITEMS.       DPKCS036
195200                                                                  DPKCS036
195300     EXEC CICS                                                    DPKCS036
195400          WRITEQ TS                                               DPKCS036
195500              QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
195600              FROM  (VL014-TKT-FMT-SEL-REC)                       DPKCS036
195700              ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
195800              RESP  (PV-CICS-RESP)                                DPKCS036
195900     END-EXEC.                                                    DPKCS036
196000                                                                  DPKCS036
196100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
196200         CONTINUE                                                 DPKCS036
196300     ELSE                                                         DPKCS036
196400         SET DP013-CICS-ABEND      TO TRUE                        DPKCS036
196500         SET DP013-NO-ROLLBACK     TO TRUE                        DPKCS036
196600         MOVE '5205-WRITE-SEL-QUEUE'                              DPKCS036
196700                                   TO DP013-PARAGRAPH             DPKCS036
196800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          DPKCS036
196900                                   TO DP013-MESSAGE-TEXT(1)       DPKCS036
197000         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
197100     END-IF.                                                      DPKCS036
197200 EJECT                                                            DPKCS036
197300******************************************************************DPKCS036
197400** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **DPKCS036
197500** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **DPKCS036
197600** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **DPKCS036
197700** THE USER.                                                    **DPKCS036
197800******************************************************************DPKCS036
197900 6000-REFRESH-PANEL-FROM-TEMP.                                    DPKCS036
198000     IF  ASC-UPDATE-TSQ                                           DPKCS036
198100         SET ASC-NO-TSQ-UPDATE TO TRUE                            DPKCS036
198200         MOVE ZERO                 TO PV-SAVE-ITEM                DPKCS036
198300                                      PV-SEL-QUEUE-ITEM           DPKCS036
198400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        DPKCS036
198500                                   TO PV-HOLD-SELECTED-ITEMS      DPKCS036
198600         MOVE +1                   TO PV-ITEMS-PROCESSED          DPKCS036
198700         PERFORM 6100-UPDATE-TSQ                                  DPKCS036
198800             UNTIL PV-ITEMS-PROCESSED >                           DPKCS036
198900                                     PV-HOLD-SELECTED-ITEMS       DPKCS036
199000         PERFORM 6010-DELETE-SEL-QUEUE                            DPKCS036
199100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         DPKCS036
199200                    ASC-BLOCK-ENTRIES (2)                         DPKCS036
199300     END-IF.                                                      DPKCS036
199400                                                                  DPKCS036
199500*----------------------------------------------------------------*DPKCS036
199600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *DPKCS036
199700*----------------------------------------------------------------*DPKCS036
199800 6010-DELETE-SEL-QUEUE.                                           DPKCS036
199900                                                                  DPKCS036
200000     EXEC CICS                                                    DPKCS036
200100         DELETEQ TS                                               DPKCS036
200200             QUEUE (ASC-SEL-QUEUE-NAME)                           DPKCS036
200300             RESP  (PV-CICS-RESP)                                 DPKCS036
200400     END-EXEC.                                                    DPKCS036
200500*                                                                 DPKCS036
200600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      DPKCS036
200700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         DPKCS036
200800         CONTINUE                                                 DPKCS036
200900     ELSE                                                         DPKCS036
201000         SET DP013-CICS-ABEND TO TRUE                             DPKCS036
201100         SET DP013-NO-ROLLBACK TO TRUE                            DPKCS036
201200         MOVE '6010-DELETE-SEL-QUEUE'                             DPKCS036
201300                        TO DP013-PARAGRAPH                        DPKCS036
201400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         DPKCS036
201500                        TO DP013-MESSAGE-TEXT (1)                 DPKCS036
201600         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
201700     END-IF.                                                      DPKCS036
201800                                                                  DPKCS036
201900*----------------------------------------------------------------*DPKCS036
202000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *DPKCS036
202100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *DPKCS036
202200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *DPKCS036
202300*    THE TEMP QUEUE.                                             *DPKCS036
202400*----------------------------------------------------------------*DPKCS036
202500                                                                  DPKCS036
202600 6100-UPDATE-TSQ.                                                 DPKCS036
202700                                                                  DPKCS036
202800     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             DPKCS036
202900     PERFORM 6105-READ-SEL-QUEUE.                                 DPKCS036
203000     PERFORM                                                      DPKCS036
203100         VARYING VL014-IDX                                        DPKCS036
203200         FROM 1 BY 1                                              DPKCS036
203300         UNTIL ((PV-ITEMS-PROCESSED >                             DPKCS036
203400                              PV-HOLD-SELECTED-ITEMS)             DPKCS036
203500         OR (VL014-IDX GREATER THAN VL014-MAX-ITEMS))             DPKCS036
203600         IF  VL014-ACTION-SW (VL014-IDX) > SPACE                  DPKCS036
203700             PERFORM 6110-PROCESS-ITEMS                           DPKCS036
203800         END-IF                                                   DPKCS036
203900         ADD +1                TO PV-ITEMS-PROCESSED              DPKCS036
204000     END-PERFORM.                                                 DPKCS036
204100     PERFORM 6111-WRITE-LIST-QUEUE.                               DPKCS036
204200*----------------------------------------------------------------*DPKCS036
204300*    READ THE LIST QUEUE RECORD.                                 *DPKCS036
204400*----------------------------------------------------------------*DPKCS036
204500                                                                  DPKCS036
204600 6105-READ-SEL-QUEUE.                                             DPKCS036
204700                                                                  DPKCS036
204800     EXEC CICS                                                    DPKCS036
204900          READQ TS                                                DPKCS036
205000              QUEUE (ASC-SEL-QUEUE-NAME)                          DPKCS036
205100              INTO  (VL014-TKT-FMT-SEL-REC)                       DPKCS036
205200              ITEM  (PV-SEL-QUEUE-ITEM)                           DPKCS036
205300              RESP  (PV-CICS-RESP)                                DPKCS036
205400     END-EXEC.                                                    DPKCS036
205500*                                                                 DPKCS036
205600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
205700         CONTINUE                                                 DPKCS036
205800     ELSE                                                         DPKCS036
205900         SET DP013-CICS-ABEND      TO  TRUE                       DPKCS036
206000         SET DP013-NO-ROLLBACK     TO  TRUE                       DPKCS036
206100         MOVE '6105-READ-SEL-QUEUE'                               DPKCS036
206200                                   TO  DP013-PARAGRAPH            DPKCS036
206300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           DPKCS036
206400                                   TO  DP013-MESSAGE-TEXT(1)      DPKCS036
206500         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
206600     END-IF.                                                      DPKCS036
206700 EJECT                                                            DPKCS036
206800*----------------------------------------------------------------*DPKCS036
206900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*DPKCS036
207000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*DPKCS036
207100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *DPKCS036
207200*----------------------------------------------------------------*DPKCS036
207300                                                                  DPKCS036
207400 6110-PROCESS-ITEMS.                                              DPKCS036
207500                                                                  DPKCS036
207600     COMPUTE PV-ITEM = 1 + ((VL014-ITEM (VL014-IDX) - 1)          DPKCS036
207700                     / PC-ITEMS-PER-PANEL).                       DPKCS036
207800                                                                  DPKCS036
207900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           DPKCS036
208000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          DPKCS036
208100             PERFORM 6111-WRITE-LIST-QUEUE                        DPKCS036
208200         END-IF                                                   DPKCS036
208300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    DPKCS036
208400                                                                  DPKCS036
208500         PERFORM 6112-READ-LIST-QUEUE                             DPKCS036
208600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               DPKCS036
208700             CONTINUE                                             DPKCS036
208800         END-IF                                                   DPKCS036
208900     END-IF.                                                      DPKCS036
209000                                                                  DPKCS036
209100     COMPUTE PV-SUB = (VL014-ITEM (VL014-IDX)                     DPKCS036
209200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              DPKCS036
209300     SET LQW-DESELECT (PV-SUB) TO    TRUE                         DPKCS036
209400     MOVE LQW-SELECTED-SW (PV-SUB)                                DPKCS036
209500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  DPKCS036
209600     EVALUATE TRUE                                                DPKCS036
209700         WHEN VL014-INQ (VL014-IDX)                               DPKCS036
209800              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             DPKCS036
209900                                                                  DPKCS036
210000         WHEN VL014-UPD (VL014-IDX)                               DPKCS036
210100              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             DPKCS036
210200                                                                  DPKCS036
210300         WHEN VL014-DEL (VL014-IDX)                               DPKCS036
210400              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             DPKCS036
210500                                                                  DPKCS036
210600         WHEN VL014-ERR (VL014-IDX)                               DPKCS036
210700              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             DPKCS036
210800     END-EVALUATE.                                                DPKCS036
210900                                                                  DPKCS036
211000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                DPKCS036
211100                                                                  DPKCS036
211200*----------------------------------------------------------------*DPKCS036
211300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *DPKCS036
211400*----------------------------------------------------------------*DPKCS036
211500                                                                  DPKCS036
211600 6111-WRITE-LIST-QUEUE.                                           DPKCS036
211700                                                                  DPKCS036
211800     EXEC CICS                                                    DPKCS036
211900         WRITEQ TS                                                DPKCS036
212000             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
212100             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
212200             ITEM  (PV-SAVE-ITEM)                                 DPKCS036
212300             REWRITE                                              DPKCS036
212400             RESP  (PV-CICS-RESP)                                 DPKCS036
212500     END-EXEC.                                                    DPKCS036
212600*                                                                 DPKCS036
212700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
212800         CONTINUE                                                 DPKCS036
212900     ELSE                                                         DPKCS036
213000         SET DP013-CICS-ABEND  TO  TRUE                           DPKCS036
213100         SET DP013-NO-ROLLBACK TO  TRUE                           DPKCS036
213200         MOVE '6111-WRITE-LIST-QUEUE'                             DPKCS036
213300                               TO  DP013-PARAGRAPH                DPKCS036
213400         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  DPKCS036
213500                               TO  DP013-MESSAGE-TEXT(1)          DPKCS036
213600         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
213700     END-IF.                                                      DPKCS036
213800                                                                  DPKCS036
213900 EJECT                                                            DPKCS036
214000*----------------------------------------------------------------*DPKCS036
214100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*DPKCS036
214200*----------------------------------------------------------------*DPKCS036
214300                                                                  DPKCS036
214400 6112-READ-LIST-QUEUE.                                            DPKCS036
214500                                                                  DPKCS036
214600     EXEC CICS                                                    DPKCS036
214700         READQ TS                                                 DPKCS036
214800             QUEUE (ASC-LIST-QUEUE-NAME)                          DPKCS036
214900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     DPKCS036
215000             ITEM  (PV-ITEM)                                      DPKCS036
215100             RESP  (PV-CICS-RESP)                                 DPKCS036
215200     END-EXEC.                                                    DPKCS036
215300*                                                                 DPKCS036
215400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          DPKCS036
215500         CONTINUE                                                 DPKCS036
215600     ELSE                                                         DPKCS036
215700         SET DP013-CICS-ABEND        TO TRUE                      DPKCS036
215800         SET DP013-NO-ROLLBACK       TO TRUE                      DPKCS036
215900         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           DPKCS036
216000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    DPKCS036
216100                                     TO DP013-MESSAGE-TEXT(1)     DPKCS036
216200         PERFORM DP013-0000-PROCESS-ABEND                         DPKCS036
216300     END-IF.                                                      DPKCS036
216400                                                                  DPKCS036
216500 EJECT                                                            DPKCS036
216600*----------------------------------------------------------------*DPKCS036
216700*    ABEND PROCESSOR MODULE                                      *DPKCS036
216800*----------------------------------------------------------------*DPKCS036
216900                                                                  DPKCS036
217000     COPY DPPD013.                                                DPKCS036
