      ******************************************************************00010012
       IDENTIFICATION DIVISION.                                         00020012
      ******************************************************************00030012
                                                                        00040012
       PROGRAM-ID.             TFKRP499.                                00050012
       AUTHOR.                 JACK KRAMER.                             00060012
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070012
       DATE-WRITTEN            JULY 1997.                               00080012
       DATE-COMPILED.                                                   00090012
                                                                        00100012
      ******************************************************************00110012
      *    THIS PROGRAM PRODUCES A DAILY REPORT OF TRANSFERS THAT WERE  00120012
      *  RECEIVED WITH A TOTAL RECEIVE QUANTITY OF ZERO.                00130012
      ******************************************************************00140012
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00141013
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00142013
      ***************************************************************** 00143013
022712** 02/27/2012 CHANGED BY: CHERI PARMLEY           PRJ#3403        00144016
022712**     COMPILE FOR CHANGES TO TTFITRC TABLE                       00145016
      ***************************************************************** 00146016
                                                                        00150012
      ******************************************************************00160012
       ENVIRONMENT DIVISION.                                            00170012
      ******************************************************************00180012
                                                                        00190012
       CONFIGURATION SECTION.                                           00200012
                                                                        00210012
       SOURCE-COMPUTER.        IBM-3090.                                00220012
       OBJECT-COMPUTER.        IBM-3090.                                00230012
                                                                        00240012
       INPUT-OUTPUT SECTION.                                            00250012
                                                                        00260012
       FILE-CONTROL.                                                    00270012
                                                                        00280012
           SELECT TRANSFER-REPORT-FILE                                  00290012
               ASSIGN TO RPT01.                                         00300012
                                                                        00310012
           SELECT CONTROL-CARD-FILE                                     00320012
               ASSIGN TO INP01.                                         00330012
      *                                                                 00340012
      ******************************************************************00350012
       DATA DIVISION.                                                   00360012
      ******************************************************************00370012
                                                                        00380012
       FILE SECTION.                                                    00390012
                                                                        00400012
       FD  TRANSFER-REPORT-FILE                                         00410012
           LABEL RECORDS ARE STANDARD                                   00420012
           RECORDING MODE IS F                                          00430012
           BLOCK CONTAINS 0 RECORDS                                     00440012
           RECORD CONTAINS 132 CHARACTERS                               00450012
           DATA RECORD IS TRANSFER-REPORT-RECORD.                       00460012
                                                                        00470012
       01  TRANSFER-REPORT-RECORD PIC X(132).                           00480012
                                                                        00490012
       FD  CONTROL-CARD-FILE                                            00500012
           LABEL RECORDS ARE STANDARD                                   00510012
           RECORDING MODE IS F                                          00520012
           BLOCK CONTAINS 0 RECORDS                                     00530012
           RECORD CONTAINS 80 CHARACTERS.                               00540012
       01  CC-RECORD                       PIC X(80).                   00550012
                                                                        00560012
      *                                                                 00570012
       WORKING-STORAGE SECTION.                                         00580012
                                                                        00590012
      *                                                                 00600012
      *  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 00610012
           COPY DPWS132O.                                               00620012
      *                                                                 00630012
      *  RECORD LAYOUT FOR THE CONTROL CARD FILE                        00640012
      *                                                                 00650012
           COPY TFRD031.                                                00660012
                                                                        00670012
      *                                                                 00680012
      *----------------------------------------------------------------*00690012
      *  DATE VALIDATION CALLING PARAMETER LIST                        *00700012
      *----------------------------------------------------------------*00710012
           COPY DPWS500.                                                00720012
           EJECT                                                        00730012
      *                                                                 00740012
      *---------------------------------------------------------------* 00750012
      *    DB2 AREA FOR TRANSFER MASTER TABLE                         * 00760012
      *---------------------------------------------------------------* 00770012
           EXEC SQL                                                     00780012
                INCLUDE TTFMSTR                                         00790012
           END-EXEC.                                                    00800012
      *---------------------------------------------------------------* 00810012
      *    DB2 AREA FOR TRANSFER RECEIPT TABLE                        * 00820012
      *---------------------------------------------------------------* 00830012
           EXEC SQL                                                     00840012
                INCLUDE TTFRCPT                                         00850012
           END-EXEC.                                                    00860012
      *---------------------------------------------------------------* 00870012
      *    DB2 AREA FOR TRANSFER ITEM RECEIPT TABLE                   * 00880012
      *---------------------------------------------------------------* 00890012
           EXEC SQL                                                     00900012
                INCLUDE TTFITRC                                         00910012
           END-EXEC.                                                    00920012
      *---------------------------------------------------------------* 00930012
      *    DB2 AREA FOR TRANSFER STATUS TABLE                         * 00940012
      *---------------------------------------------------------------* 00950012
           EXEC SQL                                                     00960012
                INCLUDE TTFSTAT                                         00970012
           END-EXEC.                                                    00980012
                                                                        00990012
           EXEC SQL                                                     01000012
               INCLUDE SQLCA                                            01010012
           END-EXEC.                                                    01020012
      *                                                                 01030012
      *  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING           01040012
      *  SQL CODES FOR DISPLAY                                          01050012
      *                                                                 01060012
           COPY SQLCA2.                                                 01070012
      *                                                                 01080012
       01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          01090012
                                       COMP SYNC.                       01100012
                                                                        01110012
       01  PS-PROGRAM-SWITCHES.                                         01120012
           05  PS-END-OF-RECEIPTS-SW    PIC X(01)   VALUE 'N'.          01130012
               88  PS-END-OF-RECEIPTS               VALUE 'Y'.          01140012
               88  PS-NOT-END-OF-RECEIPTS           VALUE 'N'.          01150012
           05  PS-FIRST-TIME-SW        PIC X(01)    VALUE 'Y'.          01160012
               88  PS-FIRST-TIME                    VALUE 'Y'.          01170012
               88  PS-NOT-FIRST-TIME                VALUE 'N'.          01180012
                                                                        01190012
       01  PC-PROGRAM-CONSTANTS.                                        01200012
           05  PC-PROGRAM-NAME         PIC X(08)    VALUE 'TFKRP499'.   01210012
           05  PC-POSITIVE-RECEIPT       PIC  X(02)  VALUE  'PR'.       01220012
           05  PC-PAGE-MAX               PIC  S9(03) VALUE  +60.        01230012
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      01240012
                                                           COMP-3.      01250012
                                                                        01260012
       01  PV-PROGRAM-VARIABLES.                                        01270012
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          01280012
                                       COMP SYNC.                       01290012
           05  PV-PAGE-COUNT           PIC 9(5)    VALUE ZERO.          01300012
           05  PV-LINE-COUNT           PIC S9(4)   VALUE ZERO.          01310012
           05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE. 01320012
           05  PV-DB2-OPERATION                PIC X(30)   VALUE SPACE. 01330012
           05  PV-XFER-NBR.                                             01340012
100404*        10 PV-FR-STR-NBR        PIC 9(03).                       01350014
100404         10 PV-FR-STR-NBR        PIC 9(04).                       01351014
               10                      PIC X(01)   VALUE '-'.           01360012
               10 PV-XFER-SEQ-NBR      PIC 9(06).                       01370012
           05  PV-BEG-TIMESTAMP.                                        01380012
               10  PV-BEG-DATE.                                         01390012
                   15  PV-BEG-CC       PIC 9(02).                       01400012
                   15  PV-BEG-YY       PIC 9(02).                       01410012
                   15  FILLER          PIC X(01)      VALUE '-'.        01420012
                   15  PV-BEG-MM       PIC 9(02).                       01430012
                   15  FILLER          PIC X(01)      VALUE '-'.        01440012
                   15  PV-BEG-DD       PIC 9(02).                       01450012
               10                      PIC X(16) VALUE                  01460012
                                       '-00.00.00.000000'.              01470012
           05  PV-BEG-TMST REDEFINES                                    01480012
                               PV-BEG-TIMESTAMP  PIC X(26).             01490012
           05  PV-END-TIMESTAMP.                                        01500012
               10  PV-END-DATE.                                         01510012
                   15  PV-END-CC       PIC 9(02).                       01520012
                   15  PV-END-YY       PIC 9(02).                       01530012
                   15  FILLER          PIC X(01)      VALUE '-'.        01540012
                   15  PV-END-MM       PIC 9(02).                       01550012
                   15  FILLER          PIC X(01)      VALUE '-'.        01560012
                   15  PV-END-DD       PIC 9(02).                       01570012
               10                      PIC X(16) VALUE                  01580012
                                       '-23.59.59.999999'.              01590012
           05  PV-END-TMST REDEFINES                                    01600012
                               PV-END-TIMESTAMP  PIC X(26).             01610012
                                                                        01620012
       01  BLANK-LINE                  PIC X(132)   VALUE SPACES.       01630012
                                                                        01640012
       01  END-OF-REPORT-LINE.                                          01650012
           05  FILLER                  PIC X(52)    VALUE SPACES.       01660012
           05  FILLER                  PIC X(26)    VALUE               01670012
               '   *** END OF REPORT ***'.                              01680012
           05  FILLER                  PIC X(54)    VALUE SPACES.       01690012
                                                                        01700012
       01  NO-DATA-LINE.                                                01710012
           05  FILLER                  PIC X(35)    VALUE SPACES.       01720012
           05  FILLER                  PIC X(45)    VALUE               01730012
               '****  NO DATA TO PROCESS FOR THIS REPORT  ***'.         01740012
                                                                        01750012
       01  CD-CURRENT-DATE.                                             01760012
           05  CD-CURRENT-YEAR         PIC 9(2)     VALUE ZERO.         01770012
           05  CD-CURRENT-MONTH        PIC 9(2)     VALUE ZERO.         01780012
           05  CD-CURRENT-DAY          PIC 9(2)     VALUE ZERO.         01790012
                                                                        01800012
       01  CT-CURRENT-TIME.                                             01810012
           05  CT-CURRENT-HOUR         PIC 9(2)     VALUE ZERO.         01820012
           05  CT-CURRENT-MINUTE       PIC 9(2)     VALUE ZERO.         01830012
           05  FILLER                  PIC 9(4)     VALUE ZERO.         01840012
                                                                        01850012
       01  HL2-HEADING-LINE-2.                                          01860012
           05  FILLER                  PIC X(46)    VALUE SPACES.       01870012
           05  FILLER                  PIC X(31)    VALUE               01880012
               'DAILY ZERO RECEIVED REPORT FOR'.                        01890012
           05  HL2-MONTH               PIC X(02)  VALUE SPACE.          01900012
           05  FILLER                  PIC X(01)  VALUE '-'.            01910012
           05  HL2-DAY                 PIC X(02)  VALUE SPACE.          01920012
           05  FILLER                  PIC X(01)  VALUE '-'.            01930012
           05  HL2-CENTURY             PIC X(02)  VALUE SPACE.          01940012
           05  HL2-YEAR                PIC X(02)  VALUE SPACE.          01950012
                                                                        01960012
       01  HL3-HEADING-LINE-3.                                          01970012
           05  FILLER                  PIC X(14)  VALUE ' TRANSFER'.    01980012
           05  FILLER                  PIC X(12)  VALUE 'RCV STR'.      01990012
           05  FILLER                  PIC X(20)  VALUE                 02000012
           'RECEIVED BY'.                                               02010012
                                                                        02020012
       01  DL1-DETAIL-LINE-1.                                           02030012
100404*    05  DL1-TRANSFER-NBR        PIC X(10)  VALUE SPACES.         02040014
100404     05  DL1-TRANSFER-NBR        PIC X(11)  VALUE SPACES.         02041014
100404*    05  FILLER                  PIC X(05)  VALUE SPACES.         02050014
100404     05  FILLER                  PIC X(04)  VALUE SPACES.         02051014
           05  DL1-RCV-STR             PIC 9(04)  VALUE ZEROES.         02060015
           05  FILLER                  PIC X(07)  VALUE SPACES.         02070012
           05  DL1-RCV-BY-INIT         PIC X(01)  VALUE SPACE.          02080012
           05  FILLER                  PIC X(01)  VALUE SPACES.         02090012
           05  DL1-RCV-BY-LAST-NM      PIC X(20)  VALUE SPACE.          02100012
                                                                        02110012
      *---------------------------------------------------------------* 02120012
      *    CURSOR TO RETRIEVE ZERO RECEIVED TRANSFERS                 * 02130012
      *---------------------------------------------------------------* 02140012
           EXEC SQL                                                     02150012
              DECLARE RCV_CSR CURSOR FOR                                02160012
              SELECT      M.FR_STR_NBR                                  02170012
                        , M.XFER_SEQ_NBR                                02180012
                        , R.STR_NBR                                     02190012
                        , R.RCVR_INIT_1ST_NM                            02200012
                        , R.RCVR_LAST_NM                                02210012
              FROM                                                      02220012
                          TTFMSTR M                                     02230012
                        , TTFRCPT R                                     02240012
                        , TTFITRC I                                     02250012
                        , TTFSTAT S                                     02260012
              WHERE                                                     02270012
                    I.XFER_DKEY_ID    = M.XFER_DKEY_ID          AND     02280012
                    S.XFER_DKEY_ID    = M.XFER_DKEY_ID          AND     02290012
                    R.XFER_DKEY_ID    = M.XFER_DKEY_ID          AND     02300012
                    S.XFER_STAT_CDE   = :PC-POSITIVE-RECEIPT    AND     02310012
                    S.XFER_STAT_TMST  = I.XFER_RCPT_TMST        AND     02320012
                    S.XFER_STAT_TMST  = R.RCV_XFER_BEG_TMST     AND     02330012
                    S.XFER_STAT_TMST  BETWEEN :PV-BEG-TMST              02340012
                              AND             :PV-END-TMST              02350012
             GROUP BY    M.FR_STR_NBR                                   02360012
                       , M.XFER_SEQ_NBR                                 02370012
                       , R.STR_NBR                                      02380012
                       , R.RCVR_INIT_1ST_NM                             02390012
                       , R.RCVR_LAST_NM                                 02400012
             HAVING    SUM(RCVD_XFER_QTY) = 0.                          02410012
           END-EXEC.                                                    02420012
                                                                        02430012
      ******************************************************************02440012
       PROCEDURE DIVISION.                                              02450012
      ******************************************************************02460012
       0000-MAINLINE.                                                   02470012
           PERFORM 1000-INITIALIZE.                                     02480012
           PERFORM 2000-OPEN-CURSOR.                                    02490012
           PERFORM 2100-PROCESS-CURSOR.                                 02500012
                                                                        02510012
           EXEC SQL                                                     02520012
                CLOSE RCV_CSR                                           02530012
           END-EXEC.                                                    02540012
                                                                        02550012
           IF PS-FIRST-TIME                                             02560012
               PERFORM 8000-PRINT-HEADINGS                              02570012
               WRITE TRANSFER-REPORT-RECORD                             02580012
                   FROM NO-DATA-LINE                                    02590012
                   AFTER ADVANCING 2                                    02600012
           END-IF.                                                      02610012
                                                                        02620012
           WRITE TRANSFER-REPORT-RECORD                                 02630012
                   FROM END-OF-REPORT-LINE                              02640012
                   AFTER ADVANCING 2.                                   02650012
                                                                        02660012
           CLOSE TRANSFER-REPORT-FILE                                   02670012
                 CONTROL-CARD-FILE.                                     02680012
           STOP RUN.                                                    02690012
                                                                        02700012
      ******************************************************************02710012
      *  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES/ CURSOR     02720012
      *  FILLING THE FIELDS OF THE STANDARD REPORT HEADER,              02730012
      *  READING FIRST RECORD, PRINT HEADINGS.                          02740012
      ******************************************************************02750012
                                                                        02760012
       1000-INITIALIZE.                                                 02770012
           OPEN OUTPUT TRANSFER-REPORT-FILE                             02780012
                INPUT  CONTROL-CARD-FILE.                               02790012
           ACCEPT CD-CURRENT-DATE FROM DATE.                            02800012
           MOVE CD-CURRENT-YEAR TO DP132O-RUN-YEAR.                     02810012
           MOVE CD-CURRENT-MONTH TO DP132O-RUN-MONTH.                   02820012
           MOVE CD-CURRENT-DAY TO DP132O-RUN-DAY.                       02830012
                                                                        02840012
           MOVE 100 TO PV-LINE-COUNT.                                   02850012
                                                                        02860012
           ACCEPT CT-CURRENT-TIME FROM TIME.                            02870012
           MOVE CT-CURRENT-HOUR TO DP132O-RUN-HOUR.                     02880012
           MOVE CT-CURRENT-MINUTE TO DP132O-RUN-MINUTE.                 02890012
           MOVE PC-PROGRAM-NAME   TO DP132O-PROGRAM-NAME.               02900012
           MOVE 1 TO DP132O-REPORT-NUMBER.                              02910012
           PERFORM 7200-READ-CONTROL-CARD-FILE.                         02920012
           DISPLAY 'TF031-CONTROL-CARD-RECORD = '                       02930012
               TF031-CONTROL-CARD-RECORD.                               02940012
           MOVE TF031-SCHEDULED-DATE    TO PV-BEG-DATE                  02950012
                                           PV-END-DATE.                 02960012
           MOVE TF031-SCHEDULE-MONTH    TO HL2-MONTH.                   02970012
           MOVE TF031-SCHEDULE-DAY      TO HL2-DAY.                     02980012
           MOVE TF031-SCHEDULE-YEAR     TO HL2-YEAR.                    02990012
           MOVE TF031-SCHEDULE-CENTURY  TO HL2-CENTURY.                 03000012
                                                                        03010012
      ******************************************************************03020012
      *  OPEN THE RECEIPT CURSOR.                                       03030012
      ******************************************************************03040012
       2000-OPEN-CURSOR.                                                03050012
                                                                        03060012
           PERFORM WITH TEST AFTER                                      03070012
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       03080012
               UNTIL SQLCODE = 0 OR                                     03090012
                     PV-RETRY-COUNT > PC-MAX-RETRIES                    03100012
                   EXEC SQL                                             03110012
                        OPEN RCV_CSR                                    03120012
                   END-EXEC                                             03130012
                                                                        03140012
               EVALUATE TRUE                                            03150012
                   WHEN SQLCODE = +0                                    03160012
                   WHEN SQLCODE = -904                                  03170012
                   WHEN SQLCODE = -911                                  03180012
                       CONTINUE                                         03190012
                   WHEN SQLCODE = +100                                  03200012
                       SET PS-END-OF-RECEIPTS  TO TRUE                  03210012
                   WHEN OTHER                                           03220014
                       DISPLAY '2000-OPEN-CURSOR'                       03250012
                       DISPLAY 'OPEN THE RECEIPT CURSOR'                03260012
                       PERFORM 9100-SQL-ERROR                           03270012
               END-EVALUATE                                             03280012
           END-PERFORM.                                                 03290012
                                                                        03300012
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           03310012
             DISPLAY '2000-OPEN-CURSOR'                                 03320012
             DISPLAY 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO '          03330012
             DISPLAY 'OPEN THE RECEIPT CURSOR'                          03340012
             PERFORM 9100-SQL-ERROR                                     03350012
           END-IF.                                                      03360012
      ******************************************************************03370012
      * PROCESS COMPLETE POSTINGS                                       03380012
      ******************************************************************03390012
       2100-PROCESS-CURSOR.                                             03400012
           PERFORM                                                      03410012
               UNTIL PS-END-OF-RECEIPTS                                 03420012
               PERFORM 2150-FETCH-CURSOR                                03430012
                                                                        03440012
               IF  PS-NOT-END-OF-RECEIPTS                               03450012
                   PERFORM 3000-PRINT-REPORT                            03460012
               END-IF                                                   03470012
           END-PERFORM.                                                 03480012
       EJECT                                                            03490012
      ******************************************************************03500012
      * FETCH THE NEXT TRANSFER ROW.                                    03510012
      ******************************************************************03520012
       2150-FETCH-CURSOR.                                               03530012
           PERFORM                                                      03540012
             WITH TEST AFTER                                            03550012
             VARYING PV-RETRY-COUNT                                     03560012
             FROM 1 BY 1                                                03570012
             UNTIL ( SQLCODE = ZERO OR                                  03580012
                     SQLCODE = +100 OR                                  03590012
                    PV-RETRY-COUNT > PC-MAX-RETRIES)                    03600012
                                                                        03610012
               EXEC SQL                                                 03620012
                    FETCH RCV_CSR                                       03630012
                       INTO  :TFMSTR-FR-STR-NBR                         03640012
                            ,:TFMSTR-XFER-SEQ-NBR                       03650012
                            ,:TFRCPT-STR-NBR                            03660012
                            ,:TFRCPT-RCVR-INIT-1ST-NM                   03670012
                            ,:TFRCPT-RCVR-LAST-NM                       03680012
               END-EXEC                                                 03690012
               EVALUATE TRUE                                            03700012
                   WHEN SQLCODE = +0                                    03710012
                   WHEN SQLCODE = -904                                  03720012
                   WHEN SQLCODE = -911                                  03730012
                       CONTINUE                                         03740012
                   WHEN SQLCODE = +100                                  03750012
                       SET PS-END-OF-RECEIPTS   TO TRUE                 03760012
                   WHEN OTHER                                           03770014
                       DISPLAY '2150-FETCH-CURSOR'                      03800012
022712                 DISPLAY 'READ TABLES TTFMSTR-RCPT-STAT-ITRC'     03810016
                       PERFORM 9100-SQL-ERROR                           03820012
               END-EVALUATE                                             03830012
           END-PERFORM.                                                 03840012
                                                                        03850012
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           03860012
             DISPLAY '2150-FETCH-CURSOR'                                03870012
             DISPLAY 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO '          03880012
             DISPLAY 'READ TABLES TTFMSTR TTFRCPT TTFSTAT TTFITRC'      03890012
             PERFORM 9100-SQL-ERROR                                     03900012
           END-IF.                                                      03910012
       EJECT.                                                           03920012
       3000-PRINT-REPORT.                                               03930012
           MOVE SPACES                   TO DL1-DETAIL-LINE-1.          03940012
           MOVE TFMSTR-FR-STR-NBR        TO PV-FR-STR-NBR.              03950012
           MOVE TFMSTR-XFER-SEQ-NBR      TO PV-XFER-SEQ-NBR.            03960012
           MOVE PV-XFER-NBR              TO DL1-TRANSFER-NBR.           03970012
           MOVE TFRCPT-STR-NBR           TO DL1-RCV-STR.                03980012
           MOVE TFRCPT-RCVR-INIT-1ST-NM  TO DL1-RCV-BY-INIT.            03990012
           MOVE TFRCPT-RCVR-LAST-NM      TO DL1-RCV-BY-LAST-NM.         04000012
           IF PV-LINE-COUNT > PC-PAGE-MAX                               04010012
               PERFORM 8000-PRINT-HEADINGS                              04020012
           END-IF.                                                      04030012
           WRITE TRANSFER-REPORT-RECORD                                 04040012
               FROM DL1-DETAIL-LINE-1                                   04050012
               AFTER ADVANCING 1.                                       04060012
           ADD 1                      TO PV-LINE-COUNT.                 04070012
       7200-READ-CONTROL-CARD-FILE.                                     04080012
           READ CONTROL-CARD-FILE                                       04090012
               INTO TF031-CONTROL-CARD-RECORD                           04100012
           END-READ.                                                    04110012
      ******************************************************************04120012
      *  PRINT REPORT HEADINGS                                          04130012
      ******************************************************************04140012
                                                                        04150012
       8000-PRINT-HEADINGS.                                             04160012
                                                                        04170012
           IF PS-FIRST-TIME                                             04180012
               SET PS-NOT-FIRST-TIME       TO TRUE                      04190012
           END-IF.                                                      04200012
           ADD 1 TO PV-PAGE-COUNT.                                      04210012
           MOVE 5             TO PV-LINE-COUNT.                         04220012
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    04230012
           WRITE TRANSFER-REPORT-RECORD                                 04240012
               FROM DP132O-STANDRD-HEADER-132-COLS                      04250012
               AFTER ADVANCING PAGE.                                    04260012
           WRITE TRANSFER-REPORT-RECORD                                 04270012
               FROM HL2-HEADING-LINE-2                                  04280012
               AFTER ADVANCING 1.                                       04290012
           WRITE TRANSFER-REPORT-RECORD                                 04300012
               FROM HL3-HEADING-LINE-3                                  04310012
               AFTER ADVANCING 2.                                       04320012
           WRITE TRANSFER-REPORT-RECORD                                 04330012
               FROM BLANK-LINE                                          04340012
               AFTER ADVANCING 1.                                       04350012
                                                                        04360012
      ******************************************************************04370012
      *  FORMAT A DB2 ERROR MESSAGE, RELEASE ALL LOCKS, AND ABEND THE  *04380012
      *  PROGRAM.                                                      *04390012
      ******************************************************************04400012
       9100-SQL-ERROR.                                                  04410012
           MOVE SQLCODE TO SQLCODE2.                                    04420012
           MOVE SQLERRD(3) TO SQLERRD3.                                 04430012
           DISPLAY '** ABEND **'.                                       04440012
           DISPLAY 'TFKRP499 - SQL ERROR'.                              04450012
           DISPLAY '       SQLCODE = ' SQLCODE2.                        04460012
           DISPLAY '      SQLWARN0 = ' SQLWARN0.                        04470012
           DISPLAY '      SQLWARN1 = ' SQLWARN1.                        04480012
           DISPLAY '      SQLWARN2 = ' SQLWARN2.                        04490012
           DISPLAY '      SQLWARN3 = ' SQLWARN3.                        04500012
           DISPLAY '      SQLWARN4 = ' SQLWARN4.                        04510012
           DISPLAY '      SQLWARN5 = ' SQLWARN5.                        04520012
           DISPLAY '      SQLWARN6 = ' SQLWARN6.                        04530012
           DISPLAY '      SQLWARN7 = ' SQLWARN7.                        04540012
           DISPLAY 'ROWS PROCESSED = ' SQLERRD3.                        04550012
           DISPLAY                    '** PARAGRAPH ** = '              04560012
                                       PV-PARAGRAPH-NAME.               04570012
           DISPLAY                    '** OPERATION ** = '              04580012
                                       PV-DB2-OPERATION.                04590012
                                                                        04600012
           EXEC SQL                                                     04610012
               COMMIT                                                   04620012
           END-EXEC.                                                    04630012
                                                                        04640012
           MOVE +4013 TO ABEND-CODE.                                    04650012
           CALL 'ILBOABN0' USING ABEND-CODE.                            04660012
                                                                        04670012
