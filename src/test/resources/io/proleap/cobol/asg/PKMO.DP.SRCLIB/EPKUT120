000100 IDENTIFICATION DIVISION.                                         00010006
000200 PROGRAM-ID.      EPKUT120.                                       00020006
000300 AUTHOR.          BOB KOLESAR (SAFENET CONSULTING).               00030006
000400 DATE-WRITTEN.    APRIL, 2003.                                    00040006
000500                                                                  00050006
000600*-----------------------------------------------------------      00060006
000700*          STORE GROUP CORRECTION IDENTIFIER                      00070006
000800*-----------------------------------------------------------      00080006
000900*-----------------------------------------------------------      00090006
001000* HISTORY LOG:                                                    00100006
001100*-----------------------------------------------------------      00110006
001200* DATE: 09/24/2003                                                00120071
001300* WR/IR#: IR#589916                                               00130072
001400* PROGRAMMER: SCOTT BARTELT                                       00140071
001500* DESCRIPTION: LOGIC WAS MISSING FOR WHEN AN 'UPDATE' STORE       00150071
001600*   GROUP RECORD IS FOUND.  THE PROGRAM SHOULD WRITE OUT AN       00160089
001700*   EMERGENCY DELETE AND A NIGHTLY DELETE. THE PROGRAM WAS        00170076
001800*   MISSING THE LOGIC TO PERFORM THE NIGHTLY RECORD.              00180076
001900*                                                                 00190071
002000* DATE: 03/10/2004                                                00200073
002100* WR/IR#: IR#639851                                               00210075
002200* PROGRAMMER: SCOTT BARTELT                                       00220073
002300* DESCRIPTION: THE OVERRIDE CURSOR CURRENTLY DOES NOT CHECK       00230073
002400*   IF THE RECORD IS SCHEDULED OR NOT.  IT ALSO DOES NOT          00240076
002500*   CHECK TO SEE IF THE OVERRIDE SHOULD BE PICKED UP BASED        00250076
002600*   ON PROMOTION START/END DATES. THEREFORE, AN OVERRIDE          00260076
002700*   DATES. THERFORE, AN OVERRIDE WHICH IS NOT MEANT TO BE         00270076
002800*   ACTIVE COULD BE PICKED UP AND SENT.                           00280076
002900*                                                                 00290073
003000* DATE: 03/26/2004                                                00300076
003100* WR/IR#: IR#644367                                               00310082
003200* PROGRAMMER: SCOTT BARTELT                                       00320076
003300* DESCRIPTION: CORRECT AN ISSUE WHICH WAS OCCURRING WITH          00330076
003400*   STORE OVERRIDES. TAKE THE FOLLOWING SCENARIO: A STORE         00340076
003500*   SPECIFIC OVERRIDE CURRENTLY EXISTS AT A STORE. THEN THE       00350076
003600*   STORE SPECIFIC OVERRIDE IS DELETED, AND INSTEAD A METRO       00360076
003700*   OVERRIDE IS MADE. THIS PROGRAM WILL CREATE:                   00370076
003800*     1.) A DELETE RECORD FOR THE STORE OVERRIDE.                 00380076
003900*     2.) AN ADD RECORD FOR THE METRO OVERRIDE.                   00390076
004000*     3.) AN ADD RECORD WITH THE PARENT(ADVERSION) VALUES,        00400076
004100*         DISTRIBUTED TO THE SPECIFIC STORE WHICH HAD THE         00410076
004200*         OVERRIDE.                                               00420076
004300*   LATER IN THE SYSTEM FLOW THE RECORDS WILL BE SORTED AS        00430076
004400*   FOLLOWS: #2,#1,#3 BECAUSE #2 HAS A LOWER STORE HIERARCHY      00440076
004500*   LEVEL CODE IT WILL COME FIRST. THEREFORE, LEAVING THE         00450076
004600*   STORE WHICH HAD THE OVERRIDE WITH THE PARENT VALUES           00460076
004700*   INSTEAD OF THE METRO OVERRIDE VALUES.  THIS PROBLEM DOES      00470082
004800*   NOT OCCUR WITH ADHOC PARENTS BECAUSE ONLY STORE SPECIFIC      00480082
004900*   RECORDS CAN OVERRIDE AN ADHOC.                                00490082
005000*                                                                 00500073
005100* DATE: 08/25/2004                                                00510099
005200* WR/IR#: IR#685725                                               00520099
005300* PROGRAMMER: SCOTT BARTELT                                       00530099
005400* DESCRIPTION: CHANGED THE LOGIC SO THAT WHEN A DELETE RECORD     00540099
005500*   IS WRITTEN FOR AN INTERFACE I.D. WHICH IS ATTACHED TO AN      00541099
005600*   ADHOC STORE GROUP IT IS WRITTEN TO BOTH THE EMERGENCY AND     00542099
005700*   THE NIGHTLY FILES.  PRIOR TO THIS CHANGE IT WAS ONLY BEING    00543099
005800*   WRITTEN TO THE EMERGENCY FILE AND THEN WHEN THE NIGHTLY       00544099
005900*   FILE APPLIED IT WOULD NO LONGER HAVE THE DELETE AND THE       00545099
006000*   RECORD WOULD BE READDED.                                      00546099
006100*                                                                 00550099
006200* DATE: 08/23/2006                                                00510099
006300* WR/IR#: IR#915606                                               00520099
006400* PROGRAMMER: MARGARET MORRISON                                   00530099
006500* DESCRIPTION: CHANGED THE LOGIC SO THAT THE LAST UPDATED         00540099
006600*   TIMESTAMP FOR DELETED PROMO REINSTATEMENTS THAT ARE BEING             
006700*   CREATED EQUALS THE LAST UPDATED TIMESTAMP - 1 NANOSECOND.             
006800*   THIS CHANGE WAS MADE DUE TO THE FACT THAT AT TIMES THEY ARE   00542099
006900*   BEING DELETED WHEN THEY SHOULD BE ADDED.                      00543099
007000*                                                                 00550099
W39620* DATE: 05/16/2011                                                00510099
W39620* WR/IR#: WR39620                                                 00520099
W39620* PROGRAMMER: COGNIZANT                                           00530099
W39620* DESCRIPTION: CHANGED THE STORE AND ADHOC CURSOR TO ALSO PICK    00540099
W39620*   DATA FOR XST_VND_STYL TABLE CHANGES AND DEPT-NBR, MAJ-CL-NBR,         
W39620*   OR SUB-CL-NBR IS NOT EQUAL TO CORRESPONDING COLUMNS ON                
W39620*   XST_MDSE_LNE_SELN FOR PROMOTIONS THAT ARE IN EFFECT OR WILL   00542099
W39620*   BE IN EFFECT WITHIN NEXT COUPLE OF DAYS.                      00543099
007000*                                                                 00550099
007100* DATE: MM/DD/CCYY                                                00551099
007200* WR/IR#:                                                         00552099
007300* PROGRAMMER:                                                     00553099
007400* DESCRIPTION:                                                    00554099
007500*                                                                 00555099
007600*-----------------------------------------------------------      00560071
007700                                                                  00570006
007800*----------------------------------------------------------       00580006
007900 ENVIRONMENT DIVISION.                                            00590006
008000*----------------------------------------------------------       00600006
008100 CONFIGURATION SECTION.                                           00610006
008200 SOURCE-COMPUTER.        IBM-3090.                                00620006
008300 OBJECT-COMPUTER.        IBM-3090.                                00630006
008400                                                                  00640006
008500 INPUT-OUTPUT SECTION.                                            00650006
008600                                                                  00660006
008700 FILE-CONTROL.                                                    00670006
008800                                                                  00680006
008900     SELECT CONTROL-CARD-PGM-LAST-RUN-DTE                         00690006
009000       ASSIGN TO INP01.                                           00700006
009100     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00710006
009200       ASSIGN TO INP02.                                           00720006
009300     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00730006
009400       ASSIGN TO INP03.                                           00740006
009500     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00750006
009600       ASSIGN TO INP04.                                           00760006
009700     SELECT PROMO-NIGHT-FILE                                      00770006
009800       ASSIGN TO OUT01.                                           00780006
009900     SELECT PROMO-EMERGENCY-FILE                                  00790006
010000       ASSIGN TO OUT02.                                           00800006
010100                                                                  00810006
010200 DATA DIVISION.                                                   00820006
010300 FILE SECTION.                                                    00830006
010400                                                                  00840006
010500 FD  CONTROL-CARD-PGM-LAST-RUN-DTE                                00850006
010600     RECORDING MODE F                                             00860006
010700     BLOCK CONTAINS 0 RECORDS                                     00870006
010800     LABEL RECORDS ARE OMITTED                                    00880006
010900     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00890006
011000 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00900006
011100                                                                  00910006
011200 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00920006
011300     RECORDING MODE F                                             00930006
011400     BLOCK CONTAINS 0 RECORDS                                     00940006
011500     LABEL RECORDS ARE OMITTED                                    00950006
011600     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00960006
011700 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00970006
011800                                                                  00980006
011900 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00990006
012000     RECORDING MODE F                                             01000006
012100     BLOCK CONTAINS 0 RECORDS                                     01010006
012200     LABEL RECORDS ARE OMITTED                                    01020006
012300     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                01030006
012400 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   01040006
012500                                                                  01050006
012600 FD  CONTROL-CARD-CRIT-EFF-DTE                                    01060006
012700     RECORDING MODE F                                             01070006
012800     BLOCK CONTAINS 0 RECORDS                                     01080006
012900     LABEL RECORDS ARE OMITTED                                    01090006
013000     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  01100006
013100 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   01110006
013200                                                                  01120006
013300 FD  PROMO-NIGHT-FILE                                             01130006
013400     RECORDING MODE F                                             01140006
013500     BLOCK CONTAINS 0 RECORDS                                     01150006
013600     LABEL RECORDS ARE OMITTED                                    01160006
013700     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        01170006
013800 01  PROMO-NIGHT-RECORD                            PIC  X(200).   01180006
013900                                                                  01190006
014000 FD  PROMO-EMERGENCY-FILE                                         01200006
014100     RECORDING MODE F                                             01210006
014200     BLOCK CONTAINS 0 RECORDS                                     01220006
014300     LABEL RECORDS ARE OMITTED                                    01230006
014400     DATA RECORD IS PROMO-EMERG-ID-RECORD.                        01240070
014500 01  PROMO-EMERGENCY-RECORD                        PIC  X(200).   01250070
014600                                                                  01260070
014700 WORKING-STORAGE SECTION.                                         01270070
014800*-----------------------------------------------------------      01280070
014900* PS - PROGRAM SWITCHES                                           01290070
015000*-----------------------------------------------------------      01300070
015100 01  PS-PROGRAM-SWITCHES.                                         01310070
015200     05  PS-RMS-STORE-CSR-EOF-SW                   PIC  X(001).   01320070
015300       88  PS-RMS-STORE-CSR-EOF                      VALUE 'Y'.   01330070
015400       88  PS-RMS-STORE-CSR-NOT-EOF                  VALUE 'N'.   01340070
015500     05  PS-ADHOC-STORE-CSR-EOF-SW                 PIC  X(001).   01350070
015600       88  PS-ADHOC-STORE-CSR-EOF                    VALUE 'Y'.   01360070
015700       88  PS-ADHOC-STORE-CSR-NOT-EOF                VALUE 'N'.   01370070
015800     05  PS-STORE-OVRRDE-CSR-EOF-SW                PIC  X(001).   01380012
015900       88  PS-STORE-OVRRDE-CSR-EOF                   VALUE 'Y'.   01390012
016000       88  PS-STORE-OVRRDE-CSR-NOT-EOF               VALUE 'N'.   01400012
016100     05  PS-PRNT-STORE-CALL-COMPLETE               PIC  X(001).   01410045
016200       88  PS-PRNT-CALL-COMPLETED                    VALUE 'Y'.   01420045
016300     05  PS-RMS-PRNT-STORE-NOT-FND-SW              PIC  X(001).   01430045
016400       88  PS-RMS-PRNT-STORE-FND                     VALUE 'Y'.   01440045
016500       88  PS-RMS-PRNT-STORE-NOT-FND                 VALUE 'N'.   01450039
016600     05  PS-ADHC-PRNT-STORE-NOT-FND-SW             PIC  X(001).   01460039
016700       88  PS-ADHC-PRNT-STORE-FND                    VALUE 'Y'.   01470039
016800       88  PS-ADHC-PRNT-STORE-NOT-FND                VALUE 'N'.   01480039
016900     05  PS-CHK-OVERRDS-LVL-SW                     PIC  X(001).   01490090
017000       88  PS-OVERRDS-CHK-OF-PRNT-STRGP              VALUE 'P'.   01500090
017100       88  PS-OVERRDS-CHK-OF-CHG-STRGP               VALUE 'C'.   01510090
017200       88  PS-NO-OVERRDS-CHK                         VALUE 'N'.   01520090
017300     05  PS-ADHC-OUTPUT-RECS-CREATE-SW             PIC  X(001).   01530027
017400       88  PS-ADHC-REC-CREATED                       VALUE 'Y'.   01540027
017500       88  PS-ADHC-RECS-NOT-CREATED                  VALUE 'N'.   01550027
017600     05  PS-WRITE-PROMO-SW                         PIC  X(001).   01560006
017700       88  PS-WRITE-PROMO                            VALUE 'Y'.   01570006
017800       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   01580006
017900     05  PS-FILE-STATUS                            PIC  X(002).   01590006
018000       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  01600006
018100       88  PS-END-OF-FILE                            VALUE '10'.  01610006
018200       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  01620006
018300     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   01630006
018400       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   01640006
018500       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   01650006
018600     05  PS-ACT-RMS-OVERRDS-EXIST-SW               PIC  X(001).   01660082
018700       88  PS-ACT-RMS-OVERRDS-EXIST                  VALUE 'Y'.   01670082
018800       88  PS-ACT-RMS-OVERRDS-DONT-EXIST             VALUE 'N'.   01680082
018900                                                                  01690082
019000*-----------------------------------------------------------      01700006
019100* PROGRAM CONSTANTS                                               01710006
019200*-----------------------------------------------------------      01720006
019300 01  PC-PROGRAM-CONSTANTS.                                        01730006
019400     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    01740006
019500       VALUE 'EPKUT120'.                                          01750008
019600     05  PC-PRICG-BUS-EVENT                        PIC  X(003)    01760026
019700       VALUE '090'.                                               01770026
019800     05  PC-PRICG-STR-GRP-EVENT                    PIC  X(003)    01780026
019900       VALUE '120'.                                               01790026
020000     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    01800006
020100       VALUE 'R'.                                                 01810006
020200     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    01820006
020300       VALUE 'A'.                                                 01830006
020400     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    01840006
020500       VALUE '99999'.                                             01850006
020600     05  PC-FILE-ACT-TYPE                          PIC  X(003)    01860006
020700       VALUE 'CHG'.                                               01870006
020800     05  PC-APPLY-NIGHTLY                          PIC  X(001)    01880006
020900       VALUE 'N'.                                                 01890006
021000     05  PC-APPLY-CORRECTION                       PIC  X(001)    01900006
021100       VALUE 'C'.                                                 01910006
021200     05  PC-PROMO-STAT-CDE                         PIC  X(001).   01920006
021300       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   01930006
021400       88  PC-DELETE-STATUS                          VALUE 'D'.   01940006
021500       88  PC-CANCEL-STATUS                          VALUE 'C'.   01950006
021600     05  PC-ADD-STAT-CDE                           PIC  X(001)    01960006
021700       VALUE 'A'.                                                 01970006
021800     05  PC-DELETE-STAT-CDE                        PIC  X(001)    01980006
021900       VALUE 'D'.                                                 01990006
022000     05  PC-MDSE-INCL-BOTH-IND                     PIC  X(001)    02000006
022100       VALUE 'B'.                                                 02010006
022200     05  PC-STORE-TYPE                             PIC  X(001).   02020031
022300       88  PC-STORE-TYPE-RMS                         VALUE 'R'.   02030031
022400       88  PC-STORE-TYPE-ADHOC                       VALUE 'D'.   02040031
022410     05  PC-PERIOD                                 PIC  X(001)    02000006
022420       VALUE '.'.                                                 02010006
022421     05  PC-DASH                                   PIC  X(001)    02000006
022422       VALUE '-'.                                                 02010006
022430     05  PC-9S                                     PIC  X(006)    02000006
022440       VALUE '999999'.                                            02010006
022450     05  PC-59                                     PIC  X(002)    02000006
022460       VALUE '59'.                                                02010006
022470     05  PC-11                                     PIC  X(002)    02000006
022480       VALUE '11'.                                                02010006
022500                                                                  02050006
022600*-----------------------------------------------------------      02060006
022700* PV- PROGRAM VARIABLES                                           02070006
022800*-----------------------------------------------------------      02080006
022900 01  PV-PROGRAM-VARAIBLES.                                        02090006
023000     05  PV-SQL-SUB                                PIC S9(004)    02100006
023100                                                     VALUE +0     02110006
023200                                                     COMP.        02120006
023300     05  PV-CURRENT-SYSTEM-TMST                    PIC  X(026)    02130006
023400                                                     VALUE SPACES.02140006
023500     05  PV-ACTL-STRT-TMST.                                       02150006
023600       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    02160006
023700                                                     VALUE SPACES.02170006
023800       10  FILLER                                  PIC  X(016)    02180006
023900                                                     VALUE SPACES.02190006
024000     05  PV-ACTL-END-TMST.                                        02200064
024100       10  PV-ACTL-END-TMST-DATE                   PIC  X(010)    02210064
024200                                                     VALUE SPACES.02220064
024300       10  FILLER                                  PIC  X(016)    02230064
024400                                                     VALUE SPACES.02240064
024500     05  PV-PRNT-RMS-ACTL-STRT-TMST.                              02250067
024600       10  PV-PRNT-RMS-ACTL-STRT-DATE              PIC  X(010)    02260067
024700                                                     VALUE SPACES.02270067
024800       10  FILLER                                  PIC  X(016)    02280067
024900                                                     VALUE SPACES.02290067
025000     05  PV-PRNT-RMS-ACTL-END-TMST.                               02300067
025100       10  PV-PRNT-RMS-ACTL-END-DATE               PIC  X(010)    02310067
025200                                                     VALUE SPACES.02320067
025300       10  FILLER                                  PIC  X(016)    02330067
025400                                                     VALUE SPACES.02340067
025500     05  PV-PRNT-ADHOC-ACTL-STRT-TMST.                            02350067
025600       10  PV-PRNT-ADHOC-ACTL-STRT-DATE            PIC  X(010)    02360067
025700                                                     VALUE SPACES.02370067
025800       10  FILLER                                  PIC  X(016)    02380067
025900                                                     VALUE SPACES.02390067
026000     05  PV-PRNT-ADHOC-ACTL-END-TMST.                             02400067
026100       10  PV-PRNT-ADHOC-ACTL-END-DATE             PIC  X(010)    02410067
026200                                                     VALUE SPACES.02420067
026300       10  FILLER                                  PIC  X(016)    02430067
026400                                                     VALUE SPACES.02440067
026500     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    02450067
026600                                                     VALUE SPACES.02460067
026700     05  PV-EFF-STRT-TMST                          PIC  X(026)    02470006
026800                                                     VALUE SPACES.02480006
026900     05  PV-EFF-END-TMST                           PIC  X(026)    02490006
027000                                                     VALUE SPACES.02500006
027100     05  PV-EFF-END-NULL                           PIC S9(004)    02510006
027200                                                     VALUE ZEROS  02520006
027300                                                     COMP.        02530006
027400     05  PV-ABEND-CODE                             PIC  9999      02540006
027500                                                     VALUE ZEROS  02550006
027600                                                     COMP.        02560006
027700     05  PV-FUL-FILE-STR                           PIC  9(005)    02570006
027800                                                     VALUE ZEROS. 02580006
027900     05  PV-STORE-PROMO-INTFC-ID                   PIC S9(010)    02590011
028000                                                     VALUE ZEROS  02600011
028100                                                     COMP-3.      02610011
028200     05  PV-STORE-MDSE-LNE-ID                      PIC S9(010)    02620011
028300                                                     VALUE ZEROS  02630011
028400                                                     COMP-3.      02640011
028500     05  PV-STORE-STR-SELN-HIER-CDE                PIC S9(002)    02650018
028600                                                     VALUE ZEROS  02660018
028700                                                     COMP-3.      02670018
028800     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    02680018
028900                                                     VALUE SPACES.02690006
029000     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    02700006
029100                                                     VALUE SPACES.02710006
029200     05  PV-OVERRIDES-EXIST                        PIC  X(001)    02720083
029300                                                     VALUE SPACES.02730083
029400                                                                  02740019
029407                                                                          
029418     05  PV-HOLD-TMST.                                                    
029419         10  PV-HOLD-TMST-DTE           PIC X(10)  VALUE SPACES.          
029420         10  FILLER                     PIC X(01)  VALUE SPACES.          
029421         10  PV-HOLD-TMST-TM.                                             
029422             15  PV-HOLD-TMST-TM-HH     PIC X(02).                        
029423             15  PV-HOLD-TMST-TM-HH-NUM REDEFINES                         
029424                 PV-HOLD-TMST-TM-HH     PIC 9(02).                        
029425             15  FILLER                 PIC X(01)  VALUE SPACES.          
029426             15  PV-HOLD-TMST-TM-MM     PIC X(02).                        
029427             15  PV-HOLD-TMST-TM-MM-NUM REDEFINES                         
029428                 PV-HOLD-TMST-TM-MM     PIC 9(02).                        
029429             15  FILLER                 PIC X(01)  VALUE SPACES.          
029430             15  PV-HOLD-TMST-TM-SS     PIC X(02).                        
029431             15  PV-HOLD-TMST-TM-SS-NUM REDEFINES                         
029432                 PV-HOLD-TMST-TM-SS     PIC 9(02).                        
029433             15  FILLER                 PIC X(01)  VALUE SPACES.          
029434             15  PV-HOLD-TMST-TM-NN     PIC X(06).                        
029435             15  PV-HOLD-TMST-TM-NN-NUM REDEFINES                         
029436                 PV-HOLD-TMST-TM-NN     PIC 9(06).                        
029437                                                                          
029450     05  PV-FORMAT-TMST.                                                  
029451         10  PV-FORMAT-TMST-DTE         PIC X(10)  VALUE SPACES.          
029452         10  PV-FORMAT-TMST-DASH        PIC X(01)  VALUE '-'.             
029453         10  PV-FORMAT-TMST-TM.                                           
029454             15  PV-FORMAT-TMST-TM-HH   PIC X(02).                        
029455             15  PV-FORMAT-TMST-TM-HH-NUM REDEFINES                       
029456                 PV-FORMAT-TMST-TM-HH   PIC 9(02).                        
029457             15  PV-FORMAT-TMST-TM-D1   PIC X(01)  VALUE '.'.             
029458             15  PV-FORMAT-TMST-TM-MM   PIC X(02).                        
029459             15  PV-FORMAT-TMST-TM-MM-NUM REDEFINES                       
029460                 PV-FORMAT-TMST-TM-MM   PIC 9(02).                        
029461             15  PV-FORMAT-TMST-TM-D2   PIC X(01)  VALUE '.'.             
029462             15  PV-FORMAT-TMST-TM-SS   PIC X(02).                        
029463             15  PV-FORMAT-TMST-TM-SS-NUM REDEFINES                       
029464                 PV-FORMAT-TMST-TM-SS   PIC 9(02).                        
029465             15  PV-FORMAT-TMST-TM-D3   PIC X(01)  VALUE '.'.             
029466             15  PV-FORMAT-TMST-TM-NN   PIC X(06).                        
029467             15  PV-FORMAT-TMST-TM-NN-NUM REDEFINES                       
029468                 PV-FORMAT-TMST-TM-NN   PIC 9(06).                        
029470                                                                          
029500*-----------------------------------------------------------      02750019
029600* IV- DB2 INDICATOR VARIABLES                                     02760019
029700*-----------------------------------------------------------      02770019
029800 01  IV-INDICATOR-VARIABLES.                                      02780019
029900     05  IV-PRNT-GP-TYP-CDE                        PIC S9(004)    02790096
030000                                                     VALUE ZEROS  02800019
030100                                                     COMP.        02810019
030200     05  IV-PRNT-STR-GP-CDE                        PIC S9(004)    02820020
030300                                                     VALUE ZEROS  02830019
030400                                                     COMP.        02840019
030500     05  IV-PRNT-STR-GP-ID                         PIC S9(004)    02850020
030600                                                     VALUE ZEROS  02860019
030700                                                     COMP.        02870019
030800     05  IV-PRNT-ADHC-GP-ID                        PIC S9(004)    02880020
030900                                                     VALUE ZEROS  02890019
031000                                                     COMP.        02900019
031100*----------------------------------------------------------       02910006
031200* FULL FILE EXTRACT OUTPUT FILE.                                  02920006
031300*----------------------------------------------------------       02930006
031400     COPY EPRD072.                                                02940006
031500                                                                  02950006
031600*----------------------------------------------------------       02960006
031700* EPCC109 CONTROL CARD LAYOUT                                     02970006
031800*----------------------------------------------------------       02980006
031900     COPY EPRD109.                                                02990006
032000                                                                  03000006
032100*----------------------------------------------------------       03010006
032200* EPCC111 CONTROL CARD LAYOUT                                     03020006
032300*----------------------------------------------------------       03030006
032400     COPY EPRD111.                                                03040006
032500                                                                  03050006
032600*----------------------------------------------------------       03060006
032700* EPCC113 CONTROL CARD LAYOUT                                     03070006
032800*----------------------------------------------------------       03080006
032900     COPY EPRD113.                                                03090006
033000                                                                  03100006
033100*----------------------------------------------------------       03110006
033200* EPCC128 CONTROL CARD LAYOUT                                     03120006
033300*----------------------------------------------------------       03130006
033400     COPY EPRD128.                                                03140006
033500                                                                  03150006
033600*----------------------------------------------------------       03160006
033700* DATE ROUTINE COPY MEMBERS                                       03170006
033800*----------------------------------------------------------       03180006
033900     COPY DPWS500.                                                03190006
034000                                                                  03200006
034100*-----------------------------------------------------------      03210006
034200* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         03220006
034300*-----------------------------------------------------------      03230006
034400     COPY DPWS004.                                                03240006
034500                                                                  03250006
034600*-----------------------------------------------------------      03260006
034700* DB2 ABEND COPYBOOK                                              03270006
034800*-----------------------------------------------------------      03280006
034900     COPY DPWS900.                                                03290006
035000                                                                  03300006
035100*-----------------------------------------------------------      03310006
035200* DB2 MESSAGE AREA                                                03320006
035300*-----------------------------------------------------------      03330006
035400     COPY SQLCA2.                                                 03340006
035500                                                                  03350006
035600 01  PC-PROGRAM-COUNTERS.                                         03360006
035700     05  PC-CNT-READ-RECS                          PIC  9(009)    03370006
035800                                                     VALUE 0.     03380006
035900     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    03390006
036000                                                     VALUE 0.     03400006
036100     05  PC-CNT-EMERG-RECS                         PIC  9(009)    03410006
036200                                                     VALUE 0.     03420006
036300     05  PC-CNT-PROMO-RECS                         PIC  9(009)    03430006
036400                                                     VALUE 0.     03440006
036500     05  PC-CNT-OVRRDE-RECS                        PIC  9(009)    03450060
036600                                                     VALUE 0.     03460006
036700     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    03470006
036800                                                     VALUE 0.     03480006
036900     05  PC-CNT-RMS-RECS                           PIC  9(009)    03490013
037000                                                     VALUE 0.     03500006
037100     05  PC-CNT-PMAP-RECS                          PIC  9(009)    03510006
037200                                                     VALUE 0.     03520006
037300     05  PC-CNT-ERROR-RECS                         PIC  9(009)    03530006
037400                                                     VALUE 0.     03540006
037500     05  PC-CNT-ALL-RECS                           PIC  9(009)    03550006
037600                                                     VALUE 0.     03560006
037700     05  PC-CNT-SPACES                             PIC  9(009)    03570006
037800                                                     VALUE 0.     03580006
037900     05  PC-CNT-POS                                PIC  9(009)    03590006
038000                                                     VALUE 0.     03600006
038100     05  PC-MAX-RETRIES                            PIC S9(004)    03610006
038200                                                     VALUE +5     03620006
038300                                                     COMP.        03630006
038400                                                                  03640006
038500*-----------------------------------------------------------      03650009
038600* PARENT RMS LAYOUT FOR PARENT DB2 SELECT.                        03660009
038700*-----------------------------------------------------------      03670009
038800 01  PRNT-RMS-RECORD.                                             03680009
038900     10 PRNT-RMS-PROMO-INTFC-ID       PIC  S9(10)V COMP-3.        03690009
039000     10 PRNT-RMS-MDSE-LNE-ID          PIC  S9(10)V COMP-3.        03700009
039100     10 PRNT-RMS-STR-GP-TYP-CDE       PIC  S9(4) COMP.            03710009
039200     10 PRNT-RMS-STR-GP-ID            PIC  S9(4) COMP.            03720009
039300     10 PRNT-RMS-PROMO-PRIC-VER-ID    PIC  S9(10)V COMP-3.        03730009
039400     10 PRNT-RMS-STR-SELN-HIER-CDE    PIC  S9(2)V COMP-3.         03740009
039500     10 PRNT-RMS-STAT-CDE             PIC   X(1).                 03750009
039600     10 PRNT-RMS-PRNT-GP-TYP-CDE      PIC   X(1).                 03760009
039700     10 PRNT-RMS-PRNT-STR-GP-CDE      PIC  S9(4) COMP.            03770009
039800     10 PRNT-RMS-PRNT-STR-GP-ID       PIC  S9(4) COMP.            03780009
039900     10 PRNT-RMS-PRNT-ADHC-GP-ID      PIC  S9(10)V COMP-3.        03790009
040000     10 PRNT-RMS-PROMO-STRT-TMST      PIC   X(26).                03800009
040100     10 PRNT-RMS-PROMO-END-TMST       PIC   X(26).                03810009
040200     10 PRNT-RMS-ACTL-STRT-TMST       PIC   X(26).                03820067
040300     10 PRNT-RMS-ACTL-END-TMST        PIC   X(26).                03830067
040400     10 PRNT-RMS-LAST-UPD-TMST        PIC   X(26).                03840009
040500     10 PRNT-RMS-SOR-LAST-UPD-TMST    PIC   X(26).                03850009
040600     10 PRNT-RMS-LAST-ACTN-CDE        PIC   X(1).                 03860009
040700                                                                  03870009
040800*-----------------------------------------------------------      03880009
040900* PARENT ADHOC LAYOUT FOR PARENT DB2 SELECT.                      03890009
041000*-----------------------------------------------------------      03900009
041100 01  PRNT-ADHOC-RECORD.                                           03910009
041200     10 PRNT-ADHOC-PROMO-INTFC-ID                  PIC  S9(10)V   03920064
041300                                                     COMP-3.      03930064
041400     10 PRNT-ADHOC-MDSE-LNE-ID                     PIC  S9(10)V   03940064
041500                                                     COMP-3.      03950064
041600     10 PRNT-ADHOC-ADHC-STR-GP-ID                  PIC  S9(10)V   03960064
041700                                                     COMP-3.      03970064
041800     10 PRNT-ADHOC-PROMO-PRIC-VER-ID               PIC  S9(10)V   03980064
041900                                                     COMP-3.      03990064
042000     10 PRNT-ADHOC-STR-SELN-HIER-CDE               PIC  S9(2)V    04000064
042100                                                     COMP-3.      04010064
042200     10 PRNT-ADHOC-STAT-CDE                        PIC   X(1).    04020064
042300     10 PRNT-ADHOC-PROMO-STRT-TMST                 PIC   X(26).   04030064
042400     10 PRNT-ADHOC-PROMO-END-TMST                  PIC   X(26).   04040064
042500     10 PRNT-ADHOC-ACTL-STRT-TMST                  PIC   X(26).   04050067
042600     10 PRNT-ADHOC-ACTL-END-TMST                   PIC   X(26).   04060067
042700     10 PRNT-ADHOC-LAST-UPD-TMST                   PIC   X(26).   04070064
042800     10 PRNT-ADHOC-SOR-LAST-UPD-TMST               PIC   X(26).   04080064
042900     10 PRNT-ADHOC-LAST-ACTN-CDE                   PIC   X(1).    04090064
043000                                                                  04100064
043100*-----------------------------------------------------------      04110064
043200* ERROR HANDLING                                                  04120064
043300*-----------------------------------------------------------      04130064
043400 01  PV-MISC-ABEND-FIELDS.                                        04140064
043500     05  PV-PARAGRAPH-NAME                         PIC  X(030)    04150064
043600                                                     VALUE SPACE. 04160064
043700     05  PV-OPERATION-MSG-1                        PIC  X(040)    04170064
043800                                                     VALUE SPACE. 04180064
043900     05  PV-OPERATION-MSG-2                        PIC  X(040)    04190064
044000                                                     VALUE SPACE. 04200064
044100     05  PV-DB2-OPERATION                          PIC  X(030)    04210064
044200                                                     VALUE SPACE. 04220064
044300 01  ABEND-CODE                                    PIC S9(004)    04230064
044400                                                     VALUE ZEROS  04240064
044500                                                     COMP         04250064
044600                                                     SYNC.        04260006
044700   88  ABEND-4003-CTRL-CARD-ERROR                    VALUE +4003. 04270006
044800   88  ABEND-4013-DB2-ERROR                          VALUE +4013. 04280006
044900   88  ABEND-4019-CAL-SUB-ERROR                      VALUE +4019. 04290006
045000   88  ABEND-4020-MQ-ERROR                           VALUE +4020. 04300006
045100   88  ABEND-4444-FORCED-ABEND                       VALUE +4444. 04310006
045200   88  ABEND-4008                                    VALUE +4008. 04320006
045300                                                                  04330006
045400                                                                  04340006
045500*-----------------------------------------------------------      04350006
045600* DB2 COMMUNICATIONS AREA                                         04360006
045700*-----------------------------------------------------------      04370006
045800     EXEC SQL                                                     04380006
045900       INCLUDE SQLCA                                              04390006
046000     END-EXEC.                                                    04400006
046100                                                                  04410006
046200*-----------------------------------------------------------      04420006
046300* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       04430006
046400*-----------------------------------------------------------      04440006
046500     EXEC SQL                                                     04450006
046600       INCLUDE XST00028                                           04460006
046700     END-EXEC.                                                    04470006
046800                                                                  04480006
046900*-----------------------------------------------------------      04490006
047000* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       04500006
047100*                                               TABLE             04510006
047200*-----------------------------------------------------------      04520006
047300     EXEC SQL                                                     04530006
047400       INCLUDE XST00029                                           04540006
047500     END-EXEC.                                                    04550006
047600                                                                  04560006
047700*-----------------------------------------------------------      04570006
047800* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           04580006
047900*-----------------------------------------------------------      04590006
048000     EXEC SQL                                                     04600006
048100       INCLUDE XST00031                                           04610006
048200     END-EXEC.                                                    04620006
048300                                                                  04630006
W39620*----------------------------------------------------------------*        
W39620* DB2 TABLE XST00013(XST_VND_STYL) - VENDOR STYLE TABLE                   
W39620*----------------------------------------------------------------*        
W39620     EXEC SQL                                                             
W39620       INCLUDE XST00013                                                   
W39620     END-EXEC.                                                            
W39620                                                                          
048400*----------------------------------------------------------------*04640084
048500* DB2 AREA FOR SYSDUMMY                                           04650084
048600*----------------------------------------------------------------*04660084
048700     EXEC SQL                                                     04670084
048800       INCLUDE SYSDUMMY                                           04680084
048900     END-EXEC.                                                    04690084
049000                                                                  04700084
049100*-----------------------------------------------------------      04710006
049200* RMS STORE CHANGE CURSOR. (RMS)                                  04720009
049300*-----------------------------------------------------------      04730006
049400     EXEC SQL                                                     04740006
049500       DECLARE RMS-STORE CURSOR FOR                               04750006
049600         SELECT STRGP.PROMO_INTFC_ID                              04760008
049700               ,STRGP.MDSE_LNE_ID                                 04770006
049800               ,STRGP.STR_GP_TYP_CDE                              04780006
049900               ,STRGP.STR_GP_ID                                   04790006
050000               ,STRGP.STR_SELN_HIER_CDE                           04800006
050100               ,STRGP.STAT_CDE                                    04810008
050200               ,STRGP.PRNT_GP_TYP_CDE                             04820019
050300               ,STRGP.PRNT_STR_GP_CDE                             04830019
050400               ,STRGP.PRNT_STR_GP_ID                              04840019
050500               ,STRGP.PRNT_ADHC_GP_ID                             04850019
050600               ,STRGP.ACTL_STRT_TMST                              04860018
050700               ,STRGP.ACTL_END_TMST                               04870007
050800               ,STRGP.LAST_UPD_TMST                               04880008
050900               ,STRGP.SOR_LAST_UPD_TMST                           04890008
051000               ,STRGP.LAST_ACTN_CDE                               04900008
051100               ,MDSSEL.PRICG_TYP_CDE                              04910007
051200         FROM XST_PROMO_STR_GP   STRGP                            04920008
051300             ,XST_MDSE_LNE_SELN  MDSSEL                           04930007
051400         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       04940008
051500           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          04950007
051600           AND (STRGP.LAST_UPD_TMST                               04960008
051700               BETWEEN :EP109-CC-STRGP-CUTOFF-TMST                04970008
051800                   AND :PV-CURRENT-SYSTEM-TMST)                   04980007
051900           AND ((:EP111-CC-CRNT-DTE                               04990061
052000               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 05000061
052100                   AND DATE(STRGP.ACTL_END_TMST))                 05010061
052200           OR  (DATE(STRGP.ACTL_STRT_TMST)                        05020061
052300               BETWEEN :EP111-CC-DATE-PLUS1                       05030061
052400                   AND :EP113-CC-CRNT-DTE-MINUS1))                05040061
W39620         UNION                                                            
W39620         SELECT STRGP.PROMO_INTFC_ID                                      
W39620               ,STRGP.MDSE_LNE_ID                                         
W39620               ,STRGP.STR_GP_TYP_CDE                                      
W39620               ,STRGP.STR_GP_ID                                           
W39620               ,STRGP.STR_SELN_HIER_CDE                                   
W39620               ,STRGP.STAT_CDE                                            
W39620               ,STRGP.PRNT_GP_TYP_CDE                                     
W39620               ,STRGP.PRNT_STR_GP_CDE                                     
W39620               ,STRGP.PRNT_STR_GP_ID                                      
W39620               ,STRGP.PRNT_ADHC_GP_ID                                     
W39620               ,STRGP.ACTL_STRT_TMST                                      
W39620               ,STRGP.ACTL_END_TMST                                       
W39620               ,STRGP.LAST_UPD_TMST                                       
W39620               ,STRGP.SOR_LAST_UPD_TMST                                   
W39620               ,STRGP.LAST_ACTN_CDE                                       
W39620               ,MDSSEL.PRICG_TYP_CDE                                      
W39620         FROM XST_PROMO_STR_GP   STRGP                                    
W39620             ,XST_MDSE_LNE_SELN  MDSSEL                                   
W39620             ,XST_VND_STYL       VNDSYL                                   
W39620         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID               
W39620           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID                  
W39620           AND STRGP.STAT_CDE = 'S'                                       
W39620           AND MDSSEL.STAT_CDE = 'S'                                      
W39620           AND MDSSEL.MDSE_HIER_CDE = 'STY'                               
W39620           AND MDSSEL.STYL_ID = VNDSYL.STYL_ID                            
W39620           AND (MDSSEL.DEPT_NBR <> VNDSYL.DEPT_NBR                        
W39620            OR MDSSEL.MAJ_CL_NBR <> VNDSYL.MAJ_CL_NBR                     
W39620            OR MDSSEL.SUB_CL_NBR <> VNDSYL.SUB_CL_NBR)                    
W39620           AND VNDSYL.LAST_UPD_TMST                                       
W39620               BETWEEN :EP109-CC-STRGP-CUTOFF-TMST                        
W39620                   AND :PV-CURRENT-SYSTEM-TMST                            
W39620           AND VNDSYL.LAST_UPD_TMST < STRGP.ACTL_END_TMST                 
W39620           AND ((:EP111-CC-CRNT-DTE                                       
W39620               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                         
W39620                   AND DATE(STRGP.ACTL_END_TMST))                         
W39620           OR  (DATE(STRGP.ACTL_STRT_TMST)                                
W39620               BETWEEN :EP111-CC-DATE-PLUS1                               
W39620                   AND :EP113-CC-CRNT-DTE-MINUS1))                        
052500         FOR FETCH ONLY                                           05050007
052600         WITH UR                                                  05060007
052700     END-EXEC.                                                    05070007
052800                                                                  05080007
052900*-----------------------------------------------------------      05090007
053000* ADHOC STORE CHANGE ID CURSOR.                                   05100009
053100*-----------------------------------------------------------      05110007
053200     EXEC SQL                                                     05120007
053300       DECLARE ADHOC-STORE CURSOR FOR                             05130007
053400         SELECT ADHOC.PROMO_INTFC_ID                              05140008
053500               ,ADHOC.MDSE_LNE_ID                                 05150007
053600               ,ADHOC.ADHC_STR_GP_ID                              05160007
053700               ,ADHOC.STR_SELN_HIER_CDE                           05170007
053800               ,ADHOC.STAT_CDE                                    05180008
053900               ,ADHOC.ACTL_STRT_TMST                              05190007
054000               ,ADHOC.ACTL_END_TMST                               05200007
054100               ,ADHOC.LAST_UPD_TMST                               05210008
054200               ,ADHOC.SOR_LAST_UPD_TMST                           05220008
054300               ,ADHOC.LAST_ACTN_CDE                               05230008
054400               ,MDSSEL.PRICG_TYP_CDE                              05240007
054500         FROM XST_PROMO_ADHC_RLT ADHOC                            05250008
054600             ,XST_MDSE_LNE_SELN  MDSSEL                           05260007
054700         WHERE ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID      05270008
054800           AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID         05280007
054900           AND (ADHOC.LAST_UPD_TMST                               05290015
055000               BETWEEN : EP109-CC-STRGP-CUTOFF-TMST               05300008
055100                   AND :PV-CURRENT-SYSTEM-TMST)                   05310007
055200           AND ((:EP111-CC-CRNT-DTE                               05320061
055300               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 05330061
055400                   AND DATE(ADHOC.ACTL_END_TMST))                 05340061
055500           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        05350061
055600               BETWEEN :EP111-CC-DATE-PLUS1                       05360061
055700                   AND :EP113-CC-CRNT-DTE-MINUS1))                05370061
W39620         UNION                                                            
W39620         SELECT ADHOC.PROMO_INTFC_ID                                      
W39620               ,ADHOC.MDSE_LNE_ID                                         
W39620               ,ADHOC.ADHC_STR_GP_ID                                      
W39620               ,ADHOC.STR_SELN_HIER_CDE                                   
W39620               ,ADHOC.STAT_CDE                                            
W39620               ,ADHOC.ACTL_STRT_TMST                                      
W39620               ,ADHOC.ACTL_END_TMST                                       
W39620               ,ADHOC.LAST_UPD_TMST                                       
W39620               ,ADHOC.SOR_LAST_UPD_TMST                                   
W39620               ,ADHOC.LAST_ACTN_CDE                                       
W39620               ,MDSSEL.PRICG_TYP_CDE                                      
W39620         FROM XST_PROMO_ADHC_RLT ADHOC                                    
W39620             ,XST_MDSE_LNE_SELN  MDSSEL                                   
W39620             ,XST_VND_STYL       VNDSYL                                   
W39620         WHERE ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID              
W39620           AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID                 
W39620           AND ADHOC.STAT_CDE = 'S'                                       
W39620           AND MDSSEL.STAT_CDE = 'S'                                      
W39620           AND MDSSEL.MDSE_HIER_CDE = 'STY'                               
W39620           AND MDSSEL.STYL_ID = VNDSYL.STYL_ID                            
W39620           AND (MDSSEL.DEPT_NBR <> VNDSYL.DEPT_NBR                        
W39620            OR MDSSEL.MAJ_CL_NBR <> VNDSYL.MAJ_CL_NBR                     
W39620            OR MDSSEL.SUB_CL_NBR <> VNDSYL.SUB_CL_NBR)                    
W39620           AND VNDSYL.LAST_UPD_TMST                                       
W39620               BETWEEN :EP109-CC-STRGP-CUTOFF-TMST                        
W39620                   AND :PV-CURRENT-SYSTEM-TMST                            
W39620           AND VNDSYL.LAST_UPD_TMST < ADHOC.ACTL_END_TMST                 
W39620           AND ((:EP111-CC-CRNT-DTE                                       
W39620               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                         
W39620                   AND DATE(ADHOC.ACTL_END_TMST))                         
W39620           OR  (DATE(ADHOC.ACTL_STRT_TMST)                                
W39620               BETWEEN :EP111-CC-DATE-PLUS1                               
W39620                   AND :EP113-CC-CRNT-DTE-MINUS1))                        
055800         FOR FETCH ONLY                                           05380007
055900         WITH UR                                                  05390007
056000     END-EXEC.                                                    05400007
056100                                                                  05410007
056200*-----------------------------------------------------------      05420006
056300* STORE OVERRIDE CURSOR. (RMS & ADHOC STORES)                     05430011
056400*-----------------------------------------------------------      05440006
056500     EXEC SQL                                                     05450006
056600       DECLARE STORE-OVRRDE CURSOR FOR                            05460006
056700         SELECT STRGP.PROMO_INTFC_ID                              05470006
056800               ,STRGP.MDSE_LNE_ID                                 05480006
056900               ,STRGP.STR_GP_TYP_CDE                              05490006
057000               ,STRGP.STR_GP_ID                                   05500006
057100               ,STRGP.STR_SELN_HIER_CDE                           05510006
057200               ,STRGP.STAT_CDE                                    05520006
057300               ,STRGP.ACTL_STRT_TMST                              05530006
057400               ,STRGP.ACTL_END_TMST                               05540006
057500               ,STRGP.LAST_UPD_TMST                               05550006
057600               ,STRGP.SOR_LAST_UPD_TMST                           05560006
057700               ,MDSSEL.PRICG_TYP_CDE                              05570006
057800         FROM XST_PROMO_STR_GP   STRGP                            05580006
057900             ,XST_MDSE_LNE_SELN  MDSSEL                           05590006
058000         WHERE MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       05600034
058100           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          05610006
058200           AND STRGP.PROMO_INTFC_ID  = :PV-STORE-PROMO-INTFC-ID   05620011
058300           AND STRGP.MDSE_LNE_ID     = :PV-STORE-MDSE-LNE-ID      05630011
058400           AND (STRGP.STR_SELN_HIER_CDE                           05640006
058500                                   > :PV-STORE-STR-SELN-HIER-CDE) 05650011
058600           AND STRGP.STAT_CDE        IN ('S')                     05660073
058700           AND MDSSEL.STAT_CDE       IN ('S')                     05670073
058800           AND ((:EP111-CC-CRNT-DTE                               05680073
058900               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 05690073
059000                   AND DATE(STRGP.ACTL_END_TMST))                 05700073
059100           OR  (DATE(STRGP.ACTL_STRT_TMST)                        05710073
059200               BETWEEN :EP111-CC-DATE-PLUS1                       05720073
059300                   AND :EP113-CC-CRNT-DTE-MINUS1))                05730073
059400         FOR FETCH ONLY                                           05740006
059500         WITH UR                                                  05750006
059600     END-EXEC.                                                    05760006
059700                                                                  05770048
059800 LINKAGE SECTION.                                                 05780006
059900                                                                  05790006
060000*----------------------------------------------------------       05800006
060100 PROCEDURE DIVISION.                                              05810011
060200*----------------------------------------------------------       05820006
060300 0000-MAINLINE.                                                   05830006
060400                                                                  05840006
060500     PERFORM 1000-INITIALIZATION.                                 05850006
060600                                                                  05860006
060700     PERFORM 2000-PROCESS-STORE-GROUPS                            05870008
060800                                                                  05880006
060900     PERFORM 9999-WRAPUP.                                         05890006
061000                                                                  05900006
061100     GOBACK.                                                      05910006
061200                                                                  05920006
061300*0000-EXIT.                                                       05930006
061400 EJECT.                                                           05940006
061500                                                                  05950006
061600*----------------------------------------------------------       05960006
061700* 1000-INITIALIZATION.                                            05970006
061800*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      05980006
061900*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      05990006
062000*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             06000006
062100*     INTERFACE ID FILE.                                          06010006
062200*----------------------------------------------------------       06020006
062300 1000-INITIALIZATION.                                             06030006
062400                                                                  06040006
062500     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      06050006
062600                 CONTROL-CARD-FUTRE-CORR-DTE                      06060006
062700                 CONTROL-CARD-PGM-LAST-RUN-DTE                    06070006
062800                 CONTROL-CARD-CRIT-EFF-DTE.                       06080006
062900     OPEN OUTPUT PROMO-NIGHT-FILE                                 06090006
063000                 PROMO-EMERGENCY-FILE.                            06100006
063100                                                                  06110006
063200     INITIALIZE EP072-PROMO-INTFC-RECORD.                         06120006
063300                                                                  06130006
063400     PERFORM 1010-GET-CURRENT-SYSTEM-TMST.                        06140006
063500     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         06150006
063600     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       06160006
063700     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       06170006
063800     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         06180006
063900     PERFORM 6100-DATE-ROUTINE.                                   06190006
064000                                                                  06200006
064100*1000-EXIT.                                                       06210006
064200 EJECT.                                                           06220006
064300                                                                  06230006
064400*----------------------------------------------------------       06240006
064500* 1010-GET-CURRENT-SYSTEM-TMST.                                   06250006
064600*     RETREIVE THE CURRENT SYSTEM TIMESTAMP. THIS WILL BE         06260006
064700*     USED WITHIN THE QUERIES TO IDENTIFY WHICH PROMO CHANGES     06270006
064800*     NEED TO BE INCLUDED. TMST ALSO WILL BE USED TO UPDATE       06280006
064900*     EPCC123 ON PROGRAM EXIT.                                    06290006
065000*----------------------------------------------------------       06300006
065100 1010-GET-CURRENT-SYSTEM-TMST.                                    06310006
065200                                                                  06320006
065300     EXEC SQL                                                     06330006
065400       SET :PV-CURRENT-SYSTEM-TMST = CURRENT TIMESTAMP            06340006
065500     END-EXEC.                                                    06350006
065600                                                                  06360006
065700     IF SQLCODE NOT EQUAL ZERO                                    06370006
065800       MOVE 'GET CURRENT TIMESTAMP' TO PV-DB2-OPERATION           06380006
065900       MOVE '1010-GET-CURRENT-SYSTEM-TMST'                        06390006
066000                                     TO PV-PARAGRAPH-NAME         06400006
066100       PERFORM 9900-SQL-ABEND-ROUTINE                             06410006
066200     END-IF.                                                      06420006
066300                                                                  06430006
066400*1010-EXIT.                                                       06440006
066500 EJECT.                                                           06450006
066600                                                                  06460006
066700*----------------------------------------------------------       06470006
066800* 1020-READ-PGM-LAST-RUN-CARD.                                    06480006
066900*     READ CONTROL CARD EPCC109. THIS CONTROL CARD CONTAINS       06490008
067000*     THE TIMESTAMP FROM THE LAST RUN OF EPKUT120                 06500008
067100*----------------------------------------------------------       06510006
067200 1020-READ-PGM-LAST-RUN-CARD.                                     06520006
067300                                                                  06530006
067400     READ CONTROL-CARD-PGM-LAST-RUN-DTE                           06540006
067500                                    INTO EP109-CC-CONTROL-CARD    06550008
067600       AT END                                                     06560006
067700          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06570006
067800                                                                  06580006
067900     IF PS-END-OF-CNTL-CRD-FILE                                   06590006
068000       DISPLAY ' '                                                06600006
068100       DISPLAY '** ABEND     **'                                  06610006
068200       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      06620006
068300       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   06630006
068400       DISPLAY '** CONTROL FILE IS EMPTY  '                       06640006
068500       DISPLAY ' '                                                06650006
068600       MOVE +4002 TO ABEND-CODE                                   06660006
068700       CALL 'ILBOABN0' USING ABEND-CODE                           06670006
068800     ELSE                                                         06680006
068900       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             06690006
069000       DISPLAY '** EPCC109     **  =' EP109-CC-STRGP-CUTOFF-TMST  06700008
069100       DISPLAY ' '                                                06710006
069200     END-IF.                                                      06720006
069300                                                                  06730006
069400*1020-EXIT.                                                       06740006
069500 EJECT.                                                           06750006
069600                                                                  06760006
069700*----------------------------------------------------------       06770006
069800* 1030-READ-CURR-PRICG-DTE-CARD.                                  06780006
069900*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       06790006
070000*     THE CURRENT PRICING DATE.                                   06800006
070100*----------------------------------------------------------       06810006
070200 1030-READ-CURR-PRICG-DTE-CARD.                                   06820006
070300                                                                  06830006
070400     READ CONTROL-CARD-CURR-PRICG-DTE                             06840006
070500                               INTO EP111-CC-CONTROL-CARD         06850006
070600       AT END                                                     06860006
070700          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    06870006
070800                                                                  06880006
070900     IF PS-END-OF-CNTL-CRD-FILE                                   06890006
071000       DISPLAY ' '                                                06900006
071100       DISPLAY '** ABEND     **'                                  06910006
071200       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      06920006
071300       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 06930006
071400       DISPLAY '** CONTROL FILE IS EMPTY  '                       06940006
071500       DISPLAY ' '                                                06950006
071600       MOVE +4002 TO ABEND-CODE                                   06960006
071700       CALL 'ILBOABN0' USING ABEND-CODE                           06970006
071800     ELSE                                                         06980006
071900       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         06990006
072000       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        07000006
072100       DISPLAY ' '                                                07010006
072200     END-IF.                                                      07020006
072300                                                                  07030006
072400*1030-EXIT.                                                       07040006
072500 EJECT.                                                           07050006
072600                                                                  07060006
072700*----------------------------------------------------------       07070006
072800* 1040-READ-FUTRE-CORR-DTE-CARD.                                  07080006
072900*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       07090006
073000*     THE NEXT FUTURE CORRECTIONS DATE                            07100006
073100*----------------------------------------------------------       07110006
073200 1040-READ-FUTRE-CORR-DTE-CARD.                                   07120006
073300                                                                  07130006
073400     READ CONTROL-CARD-FUTRE-CORR-DTE                             07140006
073500                               INTO EP113-CC-CONTROL-CARD         07150006
073600       AT END                                                     07160006
073700          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07170006
073800                                                                  07180006
073900     IF PS-END-OF-CNTL-CRD-FILE                                   07190006
074000       DISPLAY ' '                                                07200006
074100       DISPLAY '** ABEND     **'                                  07210006
074200       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      07220006
074300       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 07230006
074400       DISPLAY '** CONTROL FILE IS EMPTY  '                       07240006
074500       DISPLAY ' '                                                07250006
074600       MOVE +4002 TO ABEND-CODE                                   07260006
074700       CALL 'ILBOABN0' USING ABEND-CODE                           07270006
074800     ELSE                                                         07280006
074900       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       07290006
075000       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        07300006
075100       DISPLAY ' '                                                07310006
075200     END-IF.                                                      07320006
075300                                                                  07330006
075400*1040-EXIT.                                                       07340006
075500 EJECT.                                                           07350006
075600                                                                  07360006
075700*----------------------------------------------------------       07370006
075800* 1050-READ-CRIT-EFF-DTE-CARD.                                    07380006
075900*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       07390006
076000*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    07400006
076100*     ARE EMERGENCY OR NIGHTLY.                                   07410006
076200*----------------------------------------------------------       07420006
076300 1050-READ-CRIT-EFF-DTE-CARD.                                     07430006
076400                                                                  07440006
076500     READ CONTROL-CARD-CRIT-EFF-DTE                               07450006
076600                               INTO EP128-CC-CONTROL-CARD         07460006
076700       AT END                                                     07470006
076800          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    07480006
076900                                                                  07490006
077000     IF PS-END-OF-CNTL-CRD-FILE                                   07500006
077100       DISPLAY ' '                                                07510006
077200       DISPLAY '** ABEND     **'                                  07520006
077300       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      07530006
077400       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   07540006
077500       DISPLAY '** CONTROL FILE IS EMPTY  '                       07550006
077600       DISPLAY ' '                                                07560006
077700       MOVE +4002 TO ABEND-CODE                                   07570006
077800       CALL 'ILBOABN0' USING ABEND-CODE                           07580006
077900     ELSE                                                         07590006
078000       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      07600006
078100       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    07610006
078200       DISPLAY ' '                                                07620006
078300     END-IF.                                                      07630006
078400                                                                  07640006
078500*1050-EXIT.                                                       07650006
078600 EJECT.                                                           07660006
078700                                                                  07670006
078800*----------------------------------------------------------       07680006
078900* 2000-PROCESS-STORE-GROUPS.                                      07690008
079000*     MAIN PROCESSING AREA - EXECUTES 2 QUERIES TO IDENTIFY ANY   07700033
079100*     CHANGES THAT WERE MADE TO EITHER THE ADHOC OR RMS STORE     07710008
079200*     TABLES. IF A CHANGED RECORD IS FOUND, THE ACTION CODE,      07720008
079300*     STAT CODE, AND ACTUAL START AND END DATES ARE EXAMINED TO   07730008
079400*     DETERMINE THE OUTPUT RECORDS THAT WILL NEED TO BE WRITTEN   07740008
079500*     OUT. A SECOND QUERY IS ALSO EXECUTED TO FIND ANY STORE      07750009
079600*     OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES EXIST,       07760008
079700*     ANOTHER OUTPUT RECORD IS PRODUCED FROM THE SECOND QUERY.    07770009
079800*----------------------------------------------------------       07780008
079900 2000-PROCESS-STORE-GROUPS.                                       07790008
080000                                                                  07800008
080100     PERFORM 2100-PROCESS-RMS-CURSOR.                             07810008
080200                                                                  07820008
080300     PERFORM 2200-PROCESS-ADHOC-CURSOR.                           07830008
080400                                                                  07840008
080500*2000-EXIT.                                                       07850008
080600 EJECT.                                                           07860008
080700                                                                  07870008
080800*----------------------------------------------------------       07880008
080900* 2100-PROCESS-RMS-CURSOR.                                        07890008
081000*     RMS PROCESSING AREA - EXECUTES A QUERY TO IDENTIFY ANY      07900009
081100*     CHANGES THAT WERE MADE TO THE RMS STORE TABLE. IF A         07910009
081200*     CHANGED RECORD IS FOUND, THE ACTION CODE, STAT CODE, AND    07920009
081300*     ACTUAL START AND END DATES ARE EXAMINED TO DETERMINE        07930009
081400*     THE OUTPUT RECORDS THAT WILL NEED TO BE WRITTEN OUT.        07940009
081500*     THE PARENT CODES ARE ALSO CHECKED, AND IF A PARENT          07950009
081600*     RELATION EXISTS, THE PARENT RECORD IS SELECTED AND          07960009
081700*     USED TO WRITE ADDITIONAL UPDATE RECORDS. IN ADDITION,       07970009
081800*     A SECOND QUERY IS EXECUTED TO FIND ANY STORE                07980009
081900*     OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES EXIST,       07990008
082000*     AN OUTPUT FILE IS PRODUCED FROM THE SECOND QUERY.           08000008
082100*----------------------------------------------------------       08010008
082200 2100-PROCESS-RMS-CURSOR.                                         08020012
082300                                                                  08030008
082400     PERFORM 2110-OPEN-RMS-STORE-CSR.                             08040008
082500     PERFORM 2120-FETCH-RMS-STORE-CSR                             08050008
082600       UNTIL PS-RMS-STORE-CSR-EOF.                                08060008
082700     PERFORM 2130-CLOSE-RMS-STORE-CSR.                            08070008
082800                                                                  08080008
082900*2100-EXIT.                                                       08090008
083000 EJECT.                                                           08100008
083100                                                                  08110008
083200*----------------------------------------------------------       08120008
083300* 2110-OPEN-RMS-STORE-CSR.                                        08130008
083400*     OPEN THE CURSOR TO BE USED IN FINDING CHANGED OR            08140008
083500*     UPDATED RMS STORES.                                         08150008
083600*----------------------------------------------------------       08160008
083700 2110-OPEN-RMS-STORE-CSR.                                         08170008
083800                                                                  08180008
083900     PERFORM                                                      08190008
084000         WITH TEST AFTER                                          08200008
084100         VARYING PV-SQL-SUB                                       08210008
084200         FROM 1 BY 1                                              08220008
084300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08230008
084400                OR  SQLCODE = 0)                                  08240008
084500                                                                  08250006
084600         EXEC SQL                                                 08260006
084700           OPEN RMS-STORE                                         08270009
084800         END-EXEC                                                 08280006
084900                                                                  08290006
085000         EVALUATE TRUE                                            08300006
085100           WHEN SQLCODE = -904                                    08310006
085200           WHEN SQLCODE = -911                                    08320006
085300           WHEN SQLCODE = -913                                    08330006
085400             CONTINUE                                             08340006
085500           WHEN SQLCODE = 0                                       08350006
085600             SET PS-RMS-STORE-CSR-NOT-EOF TO TRUE                 08360009
085700           WHEN SQLWARN0 NOT EQUAL SPACE                          08370006
085800           WHEN SQLCODE NOT EQUAL ZERO                            08380006
085900             MOVE '2110-OPEN-RMS-STORE-CSR'                       08390009
086000                                   TO PV-PARAGRAPH-NAME           08400006
086100             MOVE 'ERROR ON OPEN OF RMS STORE CURSOR'             08410009
086200                                   TO PV-DB2-OPERATION            08420006
086300             PERFORM 9900-SQL-ABEND-ROUTINE                       08430006
086400         END-EVALUATE                                             08440006
086500     END-PERFORM.                                                 08450006
086600                                                                  08460006
086700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08470006
086800       MOVE '2110-OPEN-RMS-STORE-CSR'                             08480009
086900                             TO  PV-PARAGRAPH-NAME                08490006
087000       MOVE 'OPEN RETRIES EXCEEDED'                               08500006
087100                              TO  PV-DB2-OPERATION                08510006
087200       PERFORM 9900-SQL-ABEND-ROUTINE                             08520006
087300     END-IF.                                                      08530006
087400                                                                  08540006
087500*2110-EXIT.                                                       08550008
087600 EJECT.                                                           08560006
087700                                                                  08570006
087800*----------------------------------------------------------       08580006
087900* 2120-FETCH-RMS-STORE-CSR.                                       08590008
088000*     FETCH THE DATA FROM THE RMS STORE CURSOR. IF A              08600009
088100*     RECORD IS FOUND USING THIS CURSOR, IT IS CHECKED FOR        08610010
088200*     A PARENT RELATION. A SECOND QUERY IS PERFORMED              08620010
088300*     THAT WILL CHECK THE XST_PROMO_STR_GP TABLE                  08630010
088400*     FOR OVERRIDES.                                              08640006
088500*----------------------------------------------------------       08650006
088600 2120-FETCH-RMS-STORE-CSR.                                        08660008
088700                                                                  08670006
088800     PERFORM                                                      08680006
088900         WITH TEST AFTER                                          08690006
089000         VARYING PV-SQL-SUB                                       08700006
089100         FROM 1 BY 1                                              08710006
089200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08720006
089300                   OR  SQLCODE = 0                                08730006
089400                   OR  SQLCODE = +100)                            08740006
089500                                                                  08750006
089600         EXEC SQL                                                 08760006
089700           FETCH RMS-STORE                                        08770009
089800            INTO :XST00029-PROMO-INTFC-ID                         08780011
089900                ,:XST00029-MDSE-LNE-ID                            08790011
090000                ,:XST00029-STR-GP-TYP-CDE                         08800011
090100                ,:XST00029-STR-GP-ID                              08810011
090200                ,:XST00029-STR-SELN-HIER-CDE                      08820011
090300                ,:XST00029-STAT-CDE                               08830011
090400                ,:XST00029-PRNT-GP-TYP-CDE                        08840020
090500                       :IV-PRNT-GP-TYP-CDE                        08850096
090600                ,:XST00029-PRNT-STR-GP-CDE                        08860020
090700                       :IV-PRNT-STR-GP-CDE                        08870020
090800                ,:XST00029-PRNT-STR-GP-ID                         08880020
090900                       :IV-PRNT-STR-GP-ID                         08890020
091000                ,:XST00029-PRNT-ADHC-GP-ID                        08900020
091100                       :IV-PRNT-ADHC-GP-ID                        08910020
091200                ,:XST00029-ACTL-STRT-TMST                         08920011
091300                ,:XST00029-ACTL-END-TMST                          08930011
091400                ,:XST00029-LAST-UPD-TMST                          08940011
091500                ,:XST00029-SOR-LAST-UPD-TMST                      08950011
091600                ,:XST00029-LAST-ACTN-CDE                          08960015
091700                ,:XST00028-PRICG-TYP-CDE                          08970015
091800         END-EXEC                                                 08980006
091900                                                                  08990006
092000         EVALUATE TRUE                                            09000006
092100           WHEN SQLCODE = -904                                    09010006
092200           WHEN SQLCODE = -911                                    09020006
092300           WHEN SQLCODE = -913                                    09030006
092400             CONTINUE                                             09040006
092500           WHEN SQLCODE = ZERO                                    09050006
092600             PERFORM 2140-CREATE-RMS-OUTPUT                       09060009
092700           WHEN SQLCODE = +100                                    09070006
092800             SET PS-RMS-STORE-CSR-EOF TO TRUE                     09080009
092900           WHEN SQLWARN0 NOT EQUAL SPACE                          09090006
093000           WHEN SQLCODE NOT EQUAL ZERO                            09100006
093100             MOVE '2120-FETCH-RMS-STORE-CSR'                      09110009
093200                                    TO PV-PARAGRAPH-NAME          09120006
093300             MOVE 'ERROR ON FETCHING RMS STORE CURSOR'            09130009
093400                                    TO PV-DB2-OPERATION           09140006
093500             PERFORM 9900-SQL-ABEND-ROUTINE                       09150006
093600         END-EVALUATE                                             09160006
093700     END-PERFORM.                                                 09170006
093800                                                                  09180006
093900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09190006
094000       MOVE '2120-FETCH-RMS-STORE-CSR'                            09200009
094100                               TO  PV-PARAGRAPH-NAME              09210006
094200       MOVE 'FETCH RETRIES EXCEEDED'                              09220006
094300                               TO  PV-DB2-OPERATION               09230006
094400       PERFORM 9900-SQL-ABEND-ROUTINE                             09240006
094500     END-IF.                                                      09250006
094600                                                                  09260006
094700*2120-EXIT.                                                       09270008
094800 EJECT.                                                           09280006
094900                                                                  09290006
095000*-----------------------------------------------------------      09300006
095100* 2130-CLOSE-RMS-STORE-CSR.                                       09310008
095200*-----------------------------------------------------------      09320006
095300 2130-CLOSE-RMS-STORE-CSR.                                        09330008
095400                                                                  09340006
095500     PERFORM                                                      09350006
095600         WITH TEST AFTER                                          09360006
095700         VARYING PV-SQL-SUB                                       09370006
095800         FROM 1 BY 1                                              09380006
095900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09390006
096000                   OR  SQLCODE = 0)                               09400006
096100                                                                  09410006
096200         EXEC SQL                                                 09420006
096300           CLOSE RMS-STORE                                        09430009
096400         END-EXEC                                                 09440006
096500                                                                  09450006
096600         EVALUATE TRUE                                            09460006
096700           WHEN SQLCODE = -904                                    09470006
096800           WHEN SQLCODE = -911                                    09480006
096900           WHEN SQLCODE = -913                                    09490006
097000           WHEN SQLCODE = 0                                       09500006
097100             CONTINUE                                             09510006
097200           WHEN SQLWARN0 NOT EQUAL SPACE                          09520006
097300           WHEN SQLCODE NOT EQUAL ZERO                            09530006
097400             MOVE '2130-CLOSE-RMS-STORE-CSR'                      09540008
097500                                       TO PV-PARAGRAPH-NAME       09550006
097600             MOVE 'ERROR ON CLOSE OF RMS STORE CURSOR'            09560009
097700                                       TO PV-DB2-OPERATION        09570006
097800             PERFORM 9900-SQL-ABEND-ROUTINE                       09580006
097900         END-EVALUATE                                             09590006
098000     END-PERFORM.                                                 09600006
098100                                                                  09610006
098200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09620006
098300       MOVE '2130-CLOSE-RMS-STORE-CSR'                            09630008
098400                               TO  PV-PARAGRAPH-NAME              09640006
098500       MOVE 'CLOSE RETRIES EXCEEDED'                              09650006
098600                               TO  PV-DB2-OPERATION               09660006
098700       PERFORM 9900-SQL-ABEND-ROUTINE                             09670006
098800     END-IF.                                                      09680006
098900                                                                  09690006
099000*2130-EXIT.                                                       09700008
099100 EJECT.                                                           09710006
099200                                                                  09720006
099300*-----------------------------------------------------------      09730009
099400* 2140-CREATE-RMS-OUTPUT.                                         09740027
099500*     DETERMINE WHICH OUTPUT RECORDS NEED TO BE PRODUCED          09750059
099600*     FROM THE RMS STORE GROUP QUERY.                             09760059
099700*-----------------------------------------------------------      09770027
099800 2140-CREATE-RMS-OUTPUT.                                          09780027
099900                                                                  09790027
100000*** IT'S POSSIBLE THE PROMO EFFECTIVE DATES ARE BEING CHANGED     09800089
100100*** AND THEREFORE THE PROMOTION MAY ALREADY BE AT THE STORES(S)   09810089
100200*** DUE TO WHAT THE DATES WERE.  THEREFORE, A DELETE RECORD       09820089
100300*** MUST BE SENT NO MATTER WHAT BECAUSE THE NEW DATES MAY HAVE    09830089
100400*** THE PROMOTION STARTING LATER.                                 09840089
100500     IF XST00029-STAT-CDE = 'S'                                   09850044
100600       IF XST00029-LAST-ACTN-CDE = 'U'                            09860089
100710         PERFORM 3005-RMS-DELREC-TO-CHG-STRGP-2                   09870089
100800         SET PS-OVERRDS-CHK-OF-CHG-STRGP TO TRUE                  09880090
100900       END-IF                                                     09890089
101000                                                                  09900089
101100       IF ((XST00029-ACTL-STRT-TMST > EP128-CC-CRITICAL-DTE       09910027
101200         AND XST00029-ACTL-STRT-TMST < EP113-CC-CRNT-DTE)         09920027
101300       OR (XST00029-ACTL-STRT-TMST <= EP128-CC-CRITICAL-DTE       09930027
101400         AND XST00029-ACTL-END-TMST >= EP111-CC-CRNT-DTE))        09940027
101500          PERFORM 3010-RMS-ADD-REC                                09950089
101600          SET PS-OVERRDS-CHK-OF-CHG-STRGP TO TRUE                 09960090
101700       END-IF                                                     09970043
101800     END-IF.                                                      09980043
101900                                                                  09990043
102000*** DELETES FOR CANCELED/DELETED STORE GROUPS WHICH ARE NOT       10000090
102100*** AN OVERRIDE TO A HIGHER LEVEL PARENT.                         10010090
102200     IF (XST00029-STAT-CDE = 'C' OR XST00029-STAT-CDE = 'D')      10020089
102300      AND (XST00029-PRNT-GP-TYP-CDE NOT EQUAL 'P'                 10030096
102400           OR IV-PRNT-GP-TYP-CDE = -1)                            10040096
102500      AND (XST00029-PRNT-GP-TYP-CDE NOT EQUAL 'A'                 10050096
102600           OR IV-PRNT-GP-TYP-CDE = -1)                            10060096
102700      AND (XST00029-LAST-ACTN-CDE = 'U')                          10070089
102800        PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                      10080089
102900        SET PS-NO-OVERRDS-CHK TO TRUE                             10090090
103000     END-IF.                                                      10100089
103100                                                                  10110089
103200*** LOOK UP THE PARENT RECORD FOR A CANCELED/DELETED              10120090
103300*** OVERRIDE                                                      10130090
103400     IF XST00029-STAT-CDE = 'C' OR XST00029-STAT-CDE = 'D'        10140043
103500       IF XST00029-PRNT-GP-TYP-CDE = 'P'                          10150069
103600        AND IV-PRNT-GP-TYP-CDE NOT EQUAL -1                       10160096
103700          PERFORM 2150-SELECT-RMS-PRNT-REC                        10170096
103800            UNTIL PS-PRNT-CALL-COMPLETED                          10180096
103900       ELSE                                                       10190037
104000         IF XST00029-PRNT-GP-TYP-CDE = 'A'                        10200037
104100          AND IV-PRNT-GP-TYP-CDE NOT EQUAL -1                     10210096
104200            PERFORM 2160-SELECT-ADHC-PRNT-REC                     10220096
104300              UNTIL PS-PRNT-CALL-COMPLETED                        10230096
104400         END-IF                                                   10240037
104500       END-IF                                                     10250037
104600     END-IF.                                                      10260037
104700                                                                  10270037
104800*** CREATE A DELETE RECORD FOR STORE OVERRIDES WHICH              10280090
104900*** DON'T HAVE A 'S'CHEDULED PARENT.  THE RECORD WILL             10290090
105000*** BE SENT TO THE STORE GROUP ON THE OVERRIDE RECORD             10300090
105100     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE NOT EQUAL 'S' 10310094
105200       PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                       10320089
105300       SET PS-NO-OVERRDS-CHK TO TRUE                              10330090
105400     END-IF.                                                      10340089
105500                                                                  10350089
105600*** IF OTHER OVERRIDES ARE ACTIVE UNDER THE PARENT SEND A         10360090
105700*** DELETE RECORD TO THE PARENT STORE GROUP. LATER, THE           10370090
105800*** PARENT AND ALL ACTIVE OVERRIDES WILL BE READDED.              10380090
105900*** IF NO OTHER OVERRIDES ARE ACTIVE UNDER THE PARENT SEND        10390090
106000*** THE DELETE TO THE OVERRIDE STORE GROUP AND THEN SEND          10400090
106100*** AN ADD WITH THE PARENT VALUES TO THE OVERRIDE STORE           10410090
106200*** GROUP.                                                        10420090
106300     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE = 'S'         10430089
106400       PERFORM 2170-CHK-FOR-PRNT-OVERRIDES                        10440089
106500       IF PS-ACT-RMS-OVERRDS-EXIST                                10450089
106600         PERFORM 3040-RMS-DELREC-TO-PRNT-STRGP                    10460089
106700         SET PS-OVERRDS-CHK-OF-PRNT-STRGP TO TRUE                 10470090
106800       ELSE                                                       10480089
106900         PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                     10490089
107000         SET PS-NO-OVERRDS-CHK TO TRUE                            10500090
107100       END-IF                                                     10510089
107200                                                                  10520089
107300       IF ((PV-PRNT-RMS-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE    10530089
107400         AND PV-PRNT-RMS-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)      10540089
107500         OR (PV-PRNT-RMS-ACTL-STRT-DATE                           10550089
107600                                      <= EP128-CC-CRITICAL-DTE))  10560089
107700           IF PS-ACT-RMS-OVERRDS-EXIST                            10570090
107800             PERFORM 3050-RMS-PRNTREC-TO-PRNT-STRGP               10580090
107900           ELSE                                                   10590089
108000             PERFORM 3020-RMS-PRNTREC-TO-CHG-STRGP                10600090
108100           END-IF                                                 10610089
108200       END-IF                                                     10620089
108300     END-IF.                                                      10630067
108400                                                                  10640067
108500*** A CANCELED/DELETED OVERRIDE WHICH HAS AN ADHOC PARENT         10650090
108600*** WILL BE SENT A DELETE RECORD TO THE OVERRIDE STORE            10660090
108700*** GROUP, AND DEPENDING ON THE PARENT EFFECTIVE DATES            10670090
108800*** AN ADD WITH THE ADHOC PARENT VALUES MAY BE SENT TO THE        10680090
108900*** OVERRIDE STORE GROUP.  ONLY STORE SPECIFIC STORE GROUPS       10690090
109000*** CAN OVERRIDE AN ADHOC STORE GROUP.                            10700090
109100     IF PS-ADHC-PRNT-STORE-FND                                    10710089
109200       PERFORM 3000-RMS-DELREC-TO-CHG-STRGP                       10720089
109300                                                                  10730089
109400       IF PRNT-ADHOC-STAT-CDE = 'S'                               10740089
109500         IF ((PV-PRNT-ADHOC-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE10750089
109600           AND PV-PRNT-ADHOC-ACTL-STRT-DATE                       10760089
109700                                        < EP113-CC-CRNT-DTE) OR   10770089
109800           (PV-PRNT-ADHOC-ACTL-STRT-DATE                          10780089
109900                                        <= EP128-CC-CRITICAL-DTE))10790089
110000             PERFORM 3120-ADHOC-PRNT-REC                          10800089
110100         END-IF                                                   10810089
110200       END-IF                                                     10820089
110300       SET PS-NO-OVERRDS-CHK TO TRUE                              10830090
110400     END-IF.                                                      10840067
110500                                                                  10850067
110600*** PROCESS ANY STORE OVERRIDES WHICH MAY EXIST FOR CURRENTLY     10860090
110700*** 'S'CHEDULED OUTPUTS WHICH WERE WRITTEN TO THE STORE           10870090
110800*** GROUP ON THE CHANGED RECORD.                                  10880090
110900     IF PS-OVERRDS-CHK-OF-CHG-STRGP                               10890090
111000       MOVE XST00029-PROMO-INTFC-ID                               10900067
111100                             TO PV-STORE-PROMO-INTFC-ID           10910067
111200       MOVE XST00029-MDSE-LNE-ID                                  10920067
111300                             TO PV-STORE-MDSE-LNE-ID              10930067
111400       MOVE XST00029-STR-SELN-HIER-CDE                            10940089
111500                             TO PV-STORE-STR-SELN-HIER-CDE        10950089
111600       MOVE PC-RMS-PRC-SETUP-IND                                  10960089
111700                             TO PC-STORE-TYPE                     10970067
111800       PERFORM 2300-FIND-STORE-OVERRIDES                          10980067
111900         UNTIL PS-STORE-OVRRDE-CSR-EOF                            10990067
112000     END-IF.                                                      11000067
112100                                                                  11010067
112200*** PROCESS STORE OVERRIDES WHICH EXIST FOR CURRENTLY             11020090
112300*** 'S'CHEDULED PARENTS WHICH HAD RECORDS WRITTEN TO THE          11030090
112400*** PARENT STORE GROUP.                                           11040090
112500     IF PS-OVERRDS-CHK-OF-PRNT-STRGP                              11050090
112600       MOVE XST00029-PROMO-INTFC-ID                               11060089
112700                             TO PV-STORE-PROMO-INTFC-ID           11070089
112800       MOVE XST00029-MDSE-LNE-ID                                  11080089
112900                             TO PV-STORE-MDSE-LNE-ID              11090089
113000       MOVE PRNT-RMS-STR-SELN-HIER-CDE                            11100090
113100                             TO PV-STORE-STR-SELN-HIER-CDE        11110090
113200       MOVE PC-RMS-PRC-SETUP-IND                                  11120089
113300                             TO PC-STORE-TYPE                     11130089
113400       PERFORM 2300-FIND-STORE-OVERRIDES                          11140089
113500         UNTIL PS-STORE-OVRRDE-CSR-EOF                            11150089
113600     END-IF.                                                      11160089
113700                                                                  11170089
113800     MOVE 'N'              TO PS-CHK-OVERRDS-LVL-SW               11180093
113900                              PS-ADHC-PRNT-STORE-NOT-FND-SW       11190067
114000                              PS-RMS-PRNT-STORE-NOT-FND-SW        11200067
114100                              PS-PRNT-STORE-CALL-COMPLETE         11210067
114200                              PS-STORE-OVRRDE-CSR-EOF-SW          11220093
114300                              PS-ACT-RMS-OVERRDS-EXIST-SW.        11230089
114400                                                                  11240067
114500*2140-EXIT.                                                       11250067
114600 EJECT.                                                           11260067
114700                                                                  11270067
114800*-----------------------------------------------------------      11280067
114900* 2150-SELECT-RMS-PRNT-REC.                                       11290089
115000*     IF THE RMS QUERY ON THE STORE TABLE IDENTIFES A PARENT      11300067
115100*     RELATIONSHIP, THIS SELECT IS EXECUTED TO FIND THE           11310067
115200*     PARENT RECORD. IF FOUND AN ADDITIONAL OUTPUT RECORD         11320067
115300*     IS PRODUCED.                                                11330067
115400*-----------------------------------------------------------      11340067
115500 2150-SELECT-RMS-PRNT-REC.                                        11350089
115600                                                                  11360067
115700     PERFORM                                                      11370067
115800         WITH TEST AFTER                                          11380067
115900         VARYING PV-SQL-SUB                                       11390067
116000         FROM 1 BY 1                                              11400067
116100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 11410067
116200                   OR  SQLCODE = 0                                11420067
116300                   OR  SQLCODE = +100)                            11430067
116400                                                                  11440067
116500         EXEC SQL                                                 11450067
116600            SELECT STR_GP_TYP_CDE                                 11460049
116700                  ,STR_GP_ID                                      11470049
116800                  ,STAT_CDE                                       11480049
116900                  ,PROMO_STRT_TMST                                11490041
117000                  ,PROMO_END_TMST                                 11500041
117100                  ,ACTL_STRT_TMST                                 11510041
117200                  ,ACTL_END_TMST                                  11520041
117300                  ,STR_SELN_HIER_CDE                              11530082
117400                  ,SOR_LAST_UPD_TMST                              11540049
117500           INTO :PRNT-RMS-STR-GP-TYP-CDE                          11550049
117600               ,:PRNT-RMS-STR-GP-ID                               11560049
117700               ,:PRNT-RMS-STAT-CDE                                11570049
117800               ,:PRNT-RMS-PROMO-STRT-TMST                         11580049
117900               ,:PRNT-RMS-PROMO-END-TMST                          11590049
118000               ,:PRNT-RMS-ACTL-STRT-TMST                          11600049
118100               ,:PRNT-RMS-ACTL-END-TMST                           11610049
118200               ,:PRNT-RMS-STR-SELN-HIER-CDE                       11620082
118300               ,:PRNT-RMS-SOR-LAST-UPD-TMST                       11630049
118400           FROM XST_PROMO_STR_GP                                  11640049
118500           WHERE PROMO_INTFC_ID = :XST00029-PROMO-INTFC-ID        11650049
118600             AND MDSE_LNE_ID    = :XST00029-MDSE-LNE-ID           11660049
118700             AND STR_GP_TYP_CDE = :XST00029-PRNT-STR-GP-CDE       11670049
118800             AND STR_GP_ID      = :XST00029-PRNT-STR-GP-ID        11680049
118900           WITH UR                                                11690049
119000         END-EXEC                                                 11700049
119100                                                                  11710049
119200         EVALUATE TRUE                                            11720049
119300           WHEN SQLCODE = -904                                    11730049
119400           WHEN SQLCODE = -911                                    11740049
119500           WHEN SQLCODE = -913                                    11750049
119600             CONTINUE                                             11760049
119700           WHEN SQLCODE = ZERO                                    11770049
119800             SET PS-RMS-PRNT-STORE-FND  TO TRUE                   11780049
119900             SET PS-PRNT-CALL-COMPLETED TO TRUE                   11790049
120000             MOVE PRNT-RMS-ACTL-STRT-TMST                         11800067
120100                                     TO PV-PRNT-RMS-ACTL-STRT-TMST11810067
120200             MOVE PRNT-RMS-ACTL-END-TMST                          11820067
120300                                     TO PV-PRNT-RMS-ACTL-END-TMST 11830067
120400           WHEN SQLCODE = +100                                    11840067
120500             SET PS-RMS-PRNT-STORE-NOT-FND  TO TRUE               11850067
120600             SET PS-PRNT-CALL-COMPLETED     TO TRUE               11860067
120700           WHEN SQLWARN0 NOT EQUAL SPACE                          11870067
120800           WHEN SQLCODE NOT EQUAL ZERO                            11880067
120900             MOVE '2150-SELECT-RMS-PRNT-REC'                      11890089
121000                                     TO PV-PARAGRAPH-NAME         11900067
121100             MOVE 'ERROR ON SELECTING PARENT REC'                 11910067
121200                                     TO PV-DB2-OPERATION          11920067
121300             PERFORM 9900-SQL-ABEND-ROUTINE                       11930067
121400         END-EVALUATE                                             11940067
121500     END-PERFORM.                                                 11950067
121600                                                                  11960067
121700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11970067
121800       MOVE '2150-SELECT-RMS-PRNT-REC'                            11980089
121900                               TO  PV-PARAGRAPH-NAME              11990067
122000       MOVE 'SELECT RETRIES EXCEEDED'                             12000067
122100                               TO  PV-DB2-OPERATION               12010067
122200       PERFORM 9900-SQL-ABEND-ROUTINE                             12020067
122300     END-IF.                                                      12030067
122400                                                                  12040067
122500*2150-EXIT.                                                       12050067
122600 EJECT.                                                           12060067
122700                                                                  12070076
122800*-----------------------------------------------------------      12080067
122900* 2160-SELECT-ADHC-PRNT-REC.                                      12090089
123000*     FIND ADHOC PARENT STORE.                                    12100067
123100*-----------------------------------------------------------      12110067
123200 2160-SELECT-ADHC-PRNT-REC.                                       12120089
123300                                                                  12130067
123400     PERFORM                                                      12140067
123500         WITH TEST AFTER                                          12150067
123600         VARYING PV-SQL-SUB                                       12160067
123700         FROM 1 BY 1                                              12170067
123800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12180067
123900                   OR  SQLCODE = 0                                12190067
124000                   OR  SQLCODE = +100)                            12200067
124100                                                                  12210067
124200         EXEC SQL                                                 12220067
124300           SELECT ADHC_STR_GP_ID                                  12230067
124400                 ,STAT_CDE                                        12240067
124500                 ,PROMO_STRT_TMST                                 12250067
124600                 ,PROMO_END_TMST                                  12260067
124700                 ,ACTL_STRT_TMST                                  12270067
124800                 ,ACTL_END_TMST                                   12280067
124900                 ,SOR_LAST_UPD_TMST                               12290067
125000           INTO  :PRNT-ADHOC-ADHC-STR-GP-ID                       12300067
125100                ,:PRNT-ADHOC-STAT-CDE                             12310067
125200                ,:PRNT-ADHOC-PROMO-STRT-TMST                      12320067
125300                ,:PRNT-ADHOC-PROMO-END-TMST                       12330067
125400                ,:PRNT-ADHOC-ACTL-STRT-TMST                       12340067
125500                ,:PRNT-ADHOC-ACTL-END-TMST                        12350067
125600                ,:PRNT-ADHOC-SOR-LAST-UPD-TMST                    12360067
125700           FROM XST_PROMO_ADHC_RLT                                12370067
125800           WHERE PROMO_INTFC_ID = :XST00029-PROMO-INTFC-ID        12380067
125900             AND MDSE_LNE_ID    = :XST00029-MDSE-LNE-ID           12390067
126000             AND ADHC_STR_GP_ID = :XST00029-PRNT-ADHC-GP-ID       12400067
126100           WITH UR                                                12410067
126200         END-EXEC                                                 12420067
126300                                                                  12430067
126400         EVALUATE TRUE                                            12440067
126500           WHEN SQLCODE = -904                                    12450067
126600           WHEN SQLCODE = -911                                    12460067
126700           WHEN SQLCODE = -913                                    12470067
126800             CONTINUE                                             12480067
126900           WHEN SQLCODE = ZERO                                    12490067
127000             SET PS-ADHC-PRNT-STORE-FND TO TRUE                   12500067
127100             SET PS-PRNT-CALL-COMPLETED TO TRUE                   12510067
127200           WHEN SQLCODE = +100                                    12520067
127300             SET PS-ADHC-PRNT-STORE-NOT-FND TO TRUE               12530067
127400             SET PS-PRNT-CALL-COMPLETED     TO TRUE               12540067
127500             MOVE PRNT-ADHOC-ACTL-STRT-TMST                       12550067
127600                                  TO PV-PRNT-ADHOC-ACTL-STRT-TMST 12560067
127700             MOVE PRNT-RMS-ACTL-END-TMST                          12570067
127800                                  TO PV-PRNT-ADHOC-ACTL-END-TMST  12580067
127900           WHEN SQLWARN0 NOT EQUAL SPACE                          12590067
128000           WHEN SQLCODE NOT EQUAL ZERO                            12600067
128100             MOVE '2160-SELECT-ADHC-PRNT-REC'                     12610089
128200                                     TO PV-PARAGRAPH-NAME         12620067
128300             MOVE 'ERROR ON SELECTING PRNT REC'                   12630089
128400                                     TO PV-DB2-OPERATION          12640067
128500             PERFORM 9900-SQL-ABEND-ROUTINE                       12650067
128600         END-EVALUATE                                             12660067
128700     END-PERFORM.                                                 12670067
128800                                                                  12680067
128900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12690067
129000       MOVE '2160-SELECT-ADHC-PRNT-REC'                           12700089
129100                               TO  PV-PARAGRAPH-NAME              12710067
129200       MOVE 'SELECT RETRIES EXCEEDED'                             12720067
129300                               TO  PV-DB2-OPERATION               12730067
129400       PERFORM 9900-SQL-ABEND-ROUTINE                             12740067
129500     END-IF.                                                      12750067
129600                                                                  12760067
129700*2160-EXIT.                                                       12770067
129800 EJECT.                                                           12780067
129900                                                                  12790067
130000*-----------------------------------------------------------      12800077
130100* 2170-CHK-FOR-PRNT-OVERRIDES.                                    12810077
130200*     WHEN AN OVERRIDE HAS BEEN CANCELED/DELETED AND AN           12820077
130300*     ACTIVE PARENT EXISTS, CHECK IF THERE ARE ANY ACTIVE         12830077
130400*     OVERRIDES WHICH STILL EXIST.                                12840077
130500*-----------------------------------------------------------      12850077
130600 2170-CHK-FOR-PRNT-OVERRIDES.                                     12860077
130700                                                                  12870078
130800     PERFORM                                                      12880080
130900       WITH TEST AFTER                                            12890080
131000       VARYING PV-SQL-SUB                                         12900080
131100       FROM 1 BY 1                                                12910080
131200       UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                   12920080
131300                 OR  SQLCODE = +0                                 12930080
131400                 OR  SQLCODE = +100)                              12940080
131500                                                                  12950079
131600         EXEC SQL                                                 12960079
131700          SELECT '1'                                              12970080
131800            INTO :PV-OVERRIDES-EXIST                              12980080
131900            FROM SYSIBM.SYSDUMMY1 X                               12990080
132000          WHERE EXISTS                                            13000080
132100            (SELECT '1'                                           13010080
132200               FROM XST_PROMO_STR_GP                              13020080
132300             WHERE PROMO_INTFC_ID    = :XST00029-PROMO-INTFC-ID   13030080
132400               AND MDSE_LNE_ID       = :XST00029-MDSE-LNE-ID      13040080
132500               AND PRNT_STR_GP_CDE   = :XST00029-PRNT-STR-GP-CDE  13050097
132600               AND PRNT_STR_GP_ID    = :XST00029-PRNT-STR-GP-ID   13060097
132700               AND STR_SELN_HIER_CDE > :PRNT-RMS-STR-SELN-HIER-CDE13070080
132800               AND STAT_CDE          IN ('S')                     13080082
132900               AND X.IBMREQD         = X.IBMREQD)                 13090080
133000                                                                  13100080
133100           WITH UR                                                13110079
133200         END-EXEC                                                 13120079
133300                                                                  13130079
133400         EVALUATE TRUE                                            13140079
133500           WHEN SQLCODE = -904                                    13150079
133600           WHEN SQLCODE = -911                                    13160079
133700           WHEN SQLCODE = -913                                    13170079
133800             CONTINUE                                             13180079
133900           WHEN SQLCODE = +0                                      13190082
134000             SET PS-ACT-RMS-OVERRDS-EXIST TO TRUE                 13200082
134100           WHEN SQLCODE = +100                                    13210079
134200             SET PS-ACT-RMS-OVERRDS-DONT-EXIST TO TRUE            13220085
134300           WHEN SQLWARN0 NOT EQUAL SPACE                          13230079
134400           WHEN SQLCODE NOT EQUAL ZERO                            13240079
134500             MOVE '2170-CHK-FOR-PRNT-OVERRIDES'                   13250082
134600                                     TO PV-PARAGRAPH-NAME         13260079
134700             MOVE 'ERROR ON CHECKING EXISTENCE OF OVERRIDES'      13270082
134800                                     TO PV-DB2-OPERATION          13280079
134900             PERFORM 9900-SQL-ABEND-ROUTINE                       13290079
135000         END-EVALUATE                                             13300079
135100     END-PERFORM.                                                 13310079
135200                                                                  13320079
135300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13330079
135400       MOVE '2170-CHK-FOR-PRNT-OVERRIDES'                         13340082
135500                               TO  PV-PARAGRAPH-NAME              13350079
135600       MOVE 'SELECT RETRIES EXCEEDED'                             13360079
135700                               TO  PV-DB2-OPERATION               13370079
135800       PERFORM 9900-SQL-ABEND-ROUTINE                             13380079
135900     END-IF.                                                      13390079
136000                                                                  13400078
136100*2170-EXIT.                                                       13410078
136200 EJECT.                                                           13420078
136300                                                                  13430078
136400*----------------------------------------------------------       13440078
136500* 2200-PROCESS-ADHOC-CURSOR.                                      13450078
136600*     ADHOC PROCESSING AREA - EXECUTES A QUERY TO IDENTIFY ANY    13460078
136700*     CHANGES THAT WERE MADE TO THE ADHOC STORE TABLE. IF A       13470078
136800*     CHANGED RECORD IS FOUND, THE ACTION CODE, STAT CODE, AND    13480078
136900*     ACTUAL START AND END DATES ARE EXAMINED TO DETERMINE        13490078
137000*     THE OUTPUT RECORDS THAT WILL NEED TO BE WRITTEN OUT.        13500078
137100*     A SECOND QUERY IS EXECUTED TO FIND ANY STORE                13510078
137200*     OVERRIDES WHICH MAY EXIST. IF AN OVERRIDE DOES EXIST,       13520078
137300*     AN OUTPUT FILE IS PRODUCED FROM THE SECOND QUERY.           13530078
137400*----------------------------------------------------------       13540078
137500 2200-PROCESS-ADHOC-CURSOR.                                       13550078
137600                                                                  13560078
137700     PERFORM 2210-OPEN-ADHOC-STORE-CSR.                           13570078
137800     PERFORM 2220-FETCH-ADHOC-STORE-CSR                           13580078
137900       UNTIL PS-ADHOC-STORE-CSR-EOF.                              13590078
138000     PERFORM 2230-CLOSE-ADHOC-STORE-CSR.                          13600078
138100                                                                  13610078
138200*2200-EXIT.                                                       13620078
138300 EJECT.                                                           13630078
138400                                                                  13640078
138500*----------------------------------------------------------       13650078
138600* 2210-OPEN-ADHOC-STORE-CSR.                                      13660078
138700*     OPEN THE CURSOR TO BE USED IN FINDING CHANGED OR            13670078
138800*     UPDATED ADHOC STORES.                                       13680078
138900*----------------------------------------------------------       13690078
139000 2210-OPEN-ADHOC-STORE-CSR.                                       13700078
139100                                                                  13710078
139200     PERFORM                                                      13720078
139300         WITH TEST AFTER                                          13730078
139400         VARYING PV-SQL-SUB                                       13740078
139500         FROM 1 BY 1                                              13750078
139600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13760078
139700                OR  SQLCODE = 0)                                  13770078
139800                                                                  13780078
139900         EXEC SQL                                                 13790078
140000           OPEN ADHOC-STORE                                       13800078
140100         END-EXEC                                                 13810078
140200                                                                  13820078
140300         EVALUATE TRUE                                            13830078
140400           WHEN SQLCODE = -904                                    13840078
140500           WHEN SQLCODE = -911                                    13850078
140600           WHEN SQLCODE = -913                                    13860078
140700             CONTINUE                                             13870078
140800           WHEN SQLCODE = 0                                       13880078
140900             SET PS-ADHOC-STORE-CSR-NOT-EOF TO TRUE               13890078
141000           WHEN SQLWARN0 NOT EQUAL SPACE                          13900078
141100           WHEN SQLCODE NOT EQUAL ZERO                            13910078
141200             MOVE '2210-OPEN-ADHOC-STORE-CSR'                     13920078
141300                                   TO PV-PARAGRAPH-NAME           13930078
141400             MOVE 'ERROR ON OPEN OF ADHOC STORE CURSOR'           13940078
141500                                   TO PV-DB2-OPERATION            13950078
141600             PERFORM 9900-SQL-ABEND-ROUTINE                       13960078
141700         END-EVALUATE                                             13970078
141800     END-PERFORM.                                                 13980078
141900                                                                  13990078
142000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14000078
142100       MOVE '2210-OPEN-ADHOC-STORE-CSR'                           14010078
142200                             TO  PV-PARAGRAPH-NAME                14020078
142300       MOVE 'OPEN RETRIES EXCEEDED'                               14030078
142400                              TO  PV-DB2-OPERATION                14040078
142500       PERFORM 9900-SQL-ABEND-ROUTINE                             14050078
142600     END-IF.                                                      14060078
142700                                                                  14070078
142800*2210-EXIT.                                                       14080078
142900 EJECT.                                                           14090078
143000                                                                  14100078
143100*----------------------------------------------------------       14110078
143200* 2220-FETCH-ADHOC-STORE-CSR.                                     14120078
143300*     FETCH THE DATA FROM THE ADHOC STORE CURSOR. IF A            14130078
143400*     RECORD IS FOUND USING THIS CURSOR, A SECOND QUERY IS        14140078
143500*     PERFORMED THAT WILL CHECK THE XST_PROMO_STR_GP TABLE        14150078
143600*     FOR OVERRIDES.                                              14160078
143700*----------------------------------------------------------       14170078
143800 2220-FETCH-ADHOC-STORE-CSR.                                      14180078
143900                                                                  14190078
144000     PERFORM                                                      14200078
144100         WITH TEST AFTER                                          14210078
144200         VARYING PV-SQL-SUB                                       14220078
144300         FROM 1 BY 1                                              14230078
144400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14240078
144500                   OR  SQLCODE = 0                                14250078
144600                   OR  SQLCODE = +100)                            14260078
144700                                                                  14270078
144800         EXEC SQL                                                 14280078
144900           FETCH ADHOC-STORE                                      14290078
145000            INTO :XST00031-PROMO-INTFC-ID                         14300078
145100                ,:XST00031-MDSE-LNE-ID                            14310078
145200                ,:XST00031-ADHC-STR-GP-ID                         14320078
145300                ,:XST00031-STR-SELN-HIER-CDE                      14330078
145400                ,:XST00031-STAT-CDE                               14340078
145500                ,:XST00031-ACTL-STRT-TMST                         14350078
145600                ,:XST00031-ACTL-END-TMST                          14360078
145700                ,:XST00031-LAST-UPD-TMST                          14370078
145800                ,:XST00031-SOR-LAST-UPD-TMST                      14380078
145900                ,:XST00031-LAST-ACTN-CDE                          14390078
146000                ,:XST00028-PRICG-TYP-CDE                          14400078
146100         END-EXEC                                                 14410078
146200                                                                  14420078
146300         EVALUATE TRUE                                            14430078
146400           WHEN SQLCODE = -904                                    14440078
146500           WHEN SQLCODE = -911                                    14450078
146600           WHEN SQLCODE = -913                                    14460078
146700             CONTINUE                                             14470078
146800           WHEN SQLCODE = ZERO                                    14480078
146900             PERFORM 2240-CREATE-ADHOC-OUTPUT                     14490078
147000           WHEN SQLCODE = +100                                    14500078
147100             SET PS-ADHOC-STORE-CSR-EOF TO TRUE                   14510078
147200           WHEN SQLWARN0 NOT EQUAL SPACE                          14520078
147300           WHEN SQLCODE NOT EQUAL ZERO                            14530078
147400             MOVE '2220-FETCH-ADHOC-STORE-CSR'                    14540078
147500                                    TO PV-PARAGRAPH-NAME          14550078
147600             MOVE 'ERROR ON FETCHING ADHOC STORE CURSOR'          14560078
147700                                    TO PV-DB2-OPERATION           14570078
147800             PERFORM 9900-SQL-ABEND-ROUTINE                       14580078
147900         END-EVALUATE                                             14590078
148000     END-PERFORM.                                                 14600078
148100                                                                  14610078
148200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14620078
148300       MOVE '2220-FETCH-ADHOC-STORE-CSR'                          14630078
148400                               TO  PV-PARAGRAPH-NAME              14640078
148500       MOVE 'FETCH RETRIES EXCEEDED'                              14650078
148600                               TO  PV-DB2-OPERATION               14660078
148700       PERFORM 9900-SQL-ABEND-ROUTINE                             14670078
148800     END-IF.                                                      14680078
148900                                                                  14690078
149000*2220-EXIT.                                                       14700078
149100 EJECT.                                                           14710078
149200                                                                  14720078
149300*-----------------------------------------------------------      14730078
149400* 2230-CLOSE-ADHOC-STORE-CSR.                                     14740078
149500*-----------------------------------------------------------      14750078
149600 2230-CLOSE-ADHOC-STORE-CSR.                                      14760078
149700                                                                  14770078
149800     PERFORM                                                      14780078
149900         WITH TEST AFTER                                          14790078
150000         VARYING PV-SQL-SUB                                       14800078
150100         FROM 1 BY 1                                              14810078
150200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14820078
150300                   OR  SQLCODE = 0)                               14830078
150400                                                                  14840078
150500         EXEC SQL                                                 14850078
150600           CLOSE ADHOC-STORE                                      14860078
150700         END-EXEC                                                 14870078
150800                                                                  14880078
150900         EVALUATE TRUE                                            14890078
151000           WHEN SQLCODE = -904                                    14900078
151100           WHEN SQLCODE = -911                                    14910078
151200           WHEN SQLCODE = -913                                    14920078
151300           WHEN SQLCODE = 0                                       14930078
151400             CONTINUE                                             14940078
151500           WHEN SQLWARN0 NOT EQUAL SPACE                          14950078
151600           WHEN SQLCODE NOT EQUAL ZERO                            14960078
151700             MOVE '2230-CLOSE-ADHOC-STORE-CSR'                    14970078
151800                                       TO PV-PARAGRAPH-NAME       14980078
151900             MOVE 'ERROR ON CLOSE OF ADHOC STORE CURSOR'          14990078
152000                                       TO PV-DB2-OPERATION        15000078
152100             PERFORM 9900-SQL-ABEND-ROUTINE                       15010078
152200         END-EVALUATE                                             15020078
152300     END-PERFORM.                                                 15030078
152400                                                                  15040078
152500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15050078
152600       MOVE '2230-CLOSE-ADHOC-STORE-CSR'                          15060078
152700                               TO  PV-PARAGRAPH-NAME              15070078
152800       MOVE 'CLOSE RETRIES EXCEEDED'                              15080078
152900                               TO  PV-DB2-OPERATION               15090078
153000       PERFORM 9900-SQL-ABEND-ROUTINE                             15100078
153100     END-IF.                                                      15110078
153200                                                                  15120078
153300*2230-EXIT.                                                       15130078
153400 EJECT.                                                           15140078
153500                                                                  15150078
153600*-----------------------------------------------------------      15160078
153700* 2240-CREATE-ADHOC-OUTPUT.                                       15170078
153800*     DETERMINE WHICH OUTPUT RECORDS NEED TO BE PRODUCED.         15180078
153900*-----------------------------------------------------------      15190078
154000 2240-CREATE-ADHOC-OUTPUT.                                        15200078
154100                                                                  15210078
154200*** IT'S POSSIBLE THE PROMO EFFECTIVE DATES ARE BEING CHANGED     15220099
154300*** AND THEREFORE THE PROMOTION MAY ALREADY BE AT THE STORES(S)   15230099
154400*** DUE TO WHAT THE DATES WERE.  THEREFORE, A DELETE RECORD       15240099
154500*** MUST BE SENT NO MATTER WHAT BECAUSE THE NEW DATES MAY HAVE    15250099
154600*** THE PROMOTION STARTING LATER.                                 15260099
154700     IF XST00031-LAST-ACTN-CDE = 'U'                              15270099
154800       PERFORM 3100-ADHC-DEL-REC                                  15280099
154900       SET PS-ADHC-REC-CREATED TO TRUE                            15290099
155000     END-IF.                                                      15300099
155100                                                                  15310078
155200     IF XST00031-STAT-CDE = 'S'                                   15320099
155300       IF ((XST00031-ACTL-STRT-TMST > EP128-CC-CRITICAL-DTE       15330078
155400         AND XST00031-ACTL-STRT-TMST < EP113-CC-CRNT-DTE)         15340078
155500       OR (XST00031-ACTL-STRT-TMST <= EP128-CC-CRITICAL-DTE       15350099
155600         AND XST00031-ACTL-END-TMST >= EP111-CC-CRNT-DTE))        15360078
155700           PERFORM 3110-ADHC-ADD-REC                              15370089
155800           SET PS-ADHC-REC-CREATED TO TRUE                        15380099
155900       END-IF                                                     15390078
156000     END-IF.                                                      15400078
156100                                                                  15410078
156200     IF PS-ADHC-REC-CREATED                                       15420078
156300       MOVE XST00031-PROMO-INTFC-ID                               15430078
156400                             TO PV-STORE-PROMO-INTFC-ID           15440078
156500       MOVE XST00031-MDSE-LNE-ID                                  15450078
156600                             TO PV-STORE-MDSE-LNE-ID              15460078
156700       MOVE XST00031-STR-SELN-HIER-CDE                            15470078
156800                             TO PV-STORE-STR-SELN-HIER-CDE        15480078
156900       MOVE  PC-ADHOC-PRC-SETUP-IND                               15490078
157000                             TO PC-STORE-TYPE                     15500078
157100       PERFORM 2300-FIND-STORE-OVERRIDES                          15510078
157200         UNTIL PS-STORE-OVRRDE-CSR-EOF                            15520078
157300     END-IF.                                                      15530078
157400                                                                  15540078
157500     MOVE 'N'              TO PS-ADHC-OUTPUT-RECS-CREATE-SW       15550078
157600                              PS-STORE-OVRRDE-CSR-EOF-SW.         15560078
157700                                                                  15570078
157800*2240-EXIT.                                                       15580078
157900 EJECT.                                                           15590078
158000                                                                  15600078
158100*----------------------------------------------------------       15610078
158200* 2300-FIND-STORE-OVERRIDES.                                      15620078
158300*     ONCE AN ADHOC STORE IS FOUND USING THE ADHOC CURSOR,        15630078
158400*     A SECOND CURSOR IS EXECUTED TO SEE IF ANY STORE OVERRIDES   15640078
158500*     EXIST FOR THAT STORE. IF AN OVERRIDE IS FOUND A PROMO       15650078
158600*     RECORD IS WRITTEN FROM THE OVERRIDE CURSOR, IF NOT          15660006
158700*     FOUND A PROMO RECORD IS WRIITEN FROM THE ADHOC CURSOR.      15670006
158800*----------------------------------------------------------       15680006
158900 2300-FIND-STORE-OVERRIDES.                                       15690009
159000                                                                  15700006
159100     PERFORM 2310-OPEN-STORE-OVRRDE-CSR.                          15710009
159200     PERFORM 2320-FETCH-STORE-OVRRDE-CSR                          15720077
159300       UNTIL PS-STORE-OVRRDE-CSR-EOF.                             15730056
159400     PERFORM 2330-CLOSE-STORE-OVRRDE-CSR.                         15740077
159500                                                                  15750006
159600*2300-EXIT.                                                       15760009
159700 EJECT.                                                           15770006
159800                                                                  15780006
159900*----------------------------------------------------------       15790006
160000* 2310-OPEN-STORE-OVRRDE-CSR.                                     15800009
160100*     OPEN THE STORE OVERRIDE CURSOR.                             15810006
160200*----------------------------------------------------------       15820006
160300 2310-OPEN-STORE-OVRRDE-CSR.                                      15830009
160400                                                                  15840006
160500     PERFORM                                                      15850006
160600         WITH TEST AFTER                                          15860006
160700         VARYING PV-SQL-SUB                                       15870006
160800         FROM 1 BY 1                                              15880006
160900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15890006
161000                   OR  SQLCODE = 0)                               15900006
161100                                                                  15910006
161200         EXEC SQL                                                 15920006
161300           OPEN STORE-OVRRDE                                      15930006
161400         END-EXEC                                                 15940006
161500                                                                  15950006
161600         EVALUATE TRUE                                            15960006
161700           WHEN SQLCODE = -904                                    15970006
161800           WHEN SQLCODE = -911                                    15980006
161900           WHEN SQLCODE = -913                                    15990006
162000             CONTINUE                                             16000006
162100           WHEN SQLCODE = 0                                       16010006
162200             SET PS-STORE-OVRRDE-CSR-NOT-EOF TO TRUE              16020006
162300           WHEN SQLWARN0 NOT EQUAL SPACE                          16030006
162400           WHEN SQLCODE NOT EQUAL ZERO                            16040006
162500             MOVE '2310-OPEN-STORE-OVRRDE-CSR'                    16050008
162600                                     TO PV-PARAGRAPH-NAME         16060006
162700             MOVE 'ERROR ON OPEN OF STORE OVRRDE CURSOR'          16070006
162800                                     TO PV-DB2-OPERATION          16080006
162900             PERFORM 9900-SQL-ABEND-ROUTINE                       16090006
163000         END-EVALUATE                                             16100006
163100     END-PERFORM.                                                 16110006
163200                                                                  16120006
163300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16130006
163400       MOVE '2310-OPEN-STORE-OVRRDE-CSR'                          16140008
163500                             TO  PV-PARAGRAPH-NAME                16150006
163600       MOVE 'OPEN RETRIES EXCEEDED'                               16160006
163700                              TO  PV-DB2-OPERATION                16170006
163800       PERFORM 9900-SQL-ABEND-ROUTINE                             16180006
163900     END-IF.                                                      16190006
164000                                                                  16200006
164100*2310-EXIT.                                                       16210009
164200 EJECT.                                                           16220006
164300                                                                  16230006
164400*----------------------------------------------------------       16240006
164500* 2320-FETCH-STORE-OVRRDE-CSR.                                    16250009
164600*     FETCH THE DATA FOR THE STORE OVERRIDE CURSOR. IF A          16260006
164700*     RECORD IS FOUND WITH THIS CURSOR, A PROMO RECORD IS         16270006
164800*     WRITTEN FOR THE OVERRIDE STORE. IF AN OVERRIDE IS NOT       16280006
164900*     FOUND, A PROMO RECORD IS WRITTEN FOR THE ADHOC STORE.       16290006
165000*----------------------------------------------------------       16300006
165100 2320-FETCH-STORE-OVRRDE-CSR.                                     16310009
165200                                                                  16320006
165300     PERFORM                                                      16330006
165400         WITH TEST AFTER                                          16340006
165500         VARYING PV-SQL-SUB                                       16350006
165600         FROM 1 BY 1                                              16360006
165700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16370006
165800                   OR  SQLCODE = 0                                16380006
165900                   OR  SQLCODE = +100)                            16390006
166000                                                                  16400006
166100         EXEC SQL                                                 16410006
166200           FETCH STORE-OVRRDE                                     16420006
166300            INTO  :XST00029-PROMO-INTFC-ID                        16430006
166400                 ,:XST00029-MDSE-LNE-ID                           16440006
166500                 ,:XST00029-STR-GP-TYP-CDE                        16450006
166600                 ,:XST00029-STR-GP-ID                             16460006
166700                 ,:XST00029-STR-SELN-HIER-CDE                     16470006
166800                 ,:XST00029-STAT-CDE                              16480006
166900                 ,:XST00029-ACTL-STRT-TMST                        16490006
167000                 ,:XST00029-ACTL-END-TMST                         16500006
167100                 ,:XST00029-LAST-UPD-TMST                         16510006
167200                 ,:XST00029-SOR-LAST-UPD-TMST                     16520006
167300                 ,:XST00028-PRICG-TYP-CDE                         16530006
167400         END-EXEC                                                 16540006
167500                                                                  16550006
167600         EVALUATE TRUE                                            16560006
167700           WHEN SQLCODE = -904                                    16570006
167800           WHEN SQLCODE = -911                                    16580006
167900           WHEN SQLCODE = -913                                    16590006
168000             CONTINUE                                             16600006
168100           WHEN SQLCODE = ZERO                                    16610006
168200           IF PC-STORE-TYPE-RMS                                   16620055
168300             PERFORM 3030-RMS-OVRRDE-OUTPUT                       16630089
168400           ELSE                                                   16640054
168500             PERFORM 3130-ADHC-OVRRDE-OUTPUT                      16650089
168600           END-IF                                                 16660054
168700           WHEN SQLCODE = +100                                    16670006
168800             SET PS-STORE-OVRRDE-CSR-EOF TO TRUE                  16680054
168900           WHEN SQLWARN0 NOT EQUAL SPACE                          16690006
169000           WHEN SQLCODE NOT EQUAL ZERO                            16700006
169100             MOVE '2320-FETCH-STORE-OVRRDE-CSR'                   16710008
169200                                    TO PV-PARAGRAPH-NAME          16720006
169300             MOVE 'ERROR ON FETCHING STORE OVRRDE CURSOR'         16730006
169400                                    TO PV-DB2-OPERATION           16740006
169500             DISPLAY 'SQLCODE= ' SQLCODE                          16750006
169600             PERFORM 9900-SQL-ABEND-ROUTINE                       16760006
169700         END-EVALUATE                                             16770006
169800     END-PERFORM.                                                 16780006
169900                                                                  16790006
170000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16800006
170100       MOVE '2320-FETCH-STORE-OVRRDE-CSR'                         16810008
170200                              TO  PV-PARAGRAPH-NAME               16820006
170300       MOVE 'FETCH RETRIES EXCEEDED'                              16830006
170400                              TO  PV-DB2-OPERATION                16840006
170500       PERFORM 9900-SQL-ABEND-ROUTINE                             16850006
170600     END-IF.                                                      16860006
170700                                                                  16870006
170800*2320-EXIT.                                                       16880009
170900 EJECT.                                                           16890006
171000                                                                  16900006
171100*-----------------------------------------------------------      16910006
171200* 2330-CLOSE-STORE-OVRRDE-CSR.                                    16920077
171300*     CLOSE THE STORE OVERRIDE CURSOR.                            16930006
171400*-----------------------------------------------------------      16940006
171500 2330-CLOSE-STORE-OVRRDE-CSR.                                     16950077
171600                                                                  16960006
171700     PERFORM                                                      16970006
171800         WITH TEST AFTER                                          16980006
171900         VARYING PV-SQL-SUB                                       16990006
172000         FROM 1 BY 1                                              17000006
172100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 17010006
172200                   OR  SQLCODE = 0)                               17020006
172300                                                                  17030006
172400         EXEC SQL                                                 17040006
172500           CLOSE STORE-OVRRDE                                     17050006
172600         END-EXEC                                                 17060006
172700                                                                  17070006
172800         EVALUATE TRUE                                            17080006
172900           WHEN SQLCODE = -904                                    17090006
173000           WHEN SQLCODE = -911                                    17100006
173100           WHEN SQLCODE = -913                                    17110006
173200           WHEN SQLCODE = 0                                       17120006
173300             CONTINUE                                             17130006
173400           WHEN SQLWARN0 NOT EQUAL SPACE                          17140006
173500           WHEN SQLCODE NOT EQUAL ZERO                            17150006
173600             MOVE '2330-CLOSE-STORE-OVRRDE-CSR'                   17160077
173700                                     TO PV-PARAGRAPH-NAME         17170006
173800             MOVE 'ERROR ON CLOSE OF STORE OVRRDE CURSOR'         17180006
173900                                     TO PV-DB2-OPERATION          17190006
174000             PERFORM 9900-SQL-ABEND-ROUTINE                       17200006
174100         END-EVALUATE                                             17210006
174200     END-PERFORM.                                                 17220006
174300                                                                  17230006
174400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17240006
174500       MOVE '2330-CLOSE-STORE-OVRRDE-CSR'                         17250077
174600                               TO  PV-PARAGRAPH-NAME              17260006
174700       MOVE 'CLOSE RETRIES EXCEEDED'                              17270006
174800                               TO  PV-DB2-OPERATION               17280006
174900       PERFORM 9900-SQL-ABEND-ROUTINE                             17290006
175000     END-IF.                                                      17300006
175100                                                                  17310006
175200*2330-EXIT.                                                       17320077
175300 EJECT.                                                           17330006
175400                                                                  17340006
175500*-----------------------------------------------------------      17350009
175600* 3000-RMS-DELREC-TO-CHG-STRGP.                                   17360089
175700*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND NIGHTLY         17370070
175800*     DELETE RECORDS WHICH SHOULD BE SENT TO THE STORE GROUP      17380089
175900*     WHICH IS ON THE IDENTIFIED CHANGED RECORD.                  17390089
176000*-----------------------------------------------------------      17400009
176100 3000-RMS-DELREC-TO-CHG-STRGP.                                    17410089
176200                                                                  17420009
176300     INITIALIZE EP072-PROMO-INTFC-RECORD.                         17430009
176400     MOVE PC-PRICG-STR-GRP-EVENT                                  17440026
176500                             TO EP072-BUSINESS-EVENT-ID.          17450009
176600     MOVE PC-RMS-PRC-SETUP-IND                                    17460009
176700                             TO EP072-PRC-SETUP-IND.              17470009
176800                                                                  17480089
176900     MOVE XST00029-STR-GP-TYP-CDE                                 17490089
177000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      17500090
177100     MOVE XST00029-STR-GP-ID                                      17510089
177200                             TO EP072-SETUP-STR-GRP-ID.           17520089
177300     MOVE XST00029-STR-SELN-HIER-CDE                              17530089
177400                             TO EP072-STR-SELN-HIER-CDE.          17540089
177500     MOVE XST00029-STR-GP-TYP-CDE                                 17550089
177600                             TO EP072-DIST-STR-GRP-TYP-CDE.       17560089
177700     MOVE XST00029-STR-GP-ID                                      17570089
177800                             TO EP072-DIST-STR-GRP-ID.            17580089
177900                                                                  17590089
178000     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               17600009
178100     MOVE PC-DELETE-STAT-CDE                                      17610009
178200                             TO EP072-RECORD-ACTION               17620009
178300     MOVE XST00029-PROMO-INTFC-ID                                 17630009
178400                             TO EP072-PROMO-INTFC-ID.             17640009
178500     MOVE XST00029-MDSE-LNE-ID                                    17650009
178600                             TO EP072-MERCH-LNE-ID.               17660009
178700     MOVE XST00028-PRICG-TYP-CDE                                  17670009
178800                             TO EP072-PRICG-TYP-CDE.              17680009
178900     MOVE PC-MDSE-INCL-BOTH-IND                                   17690026
179000                             TO EP072-MDSE-INC-EXC-IND.           17700009
179100     MOVE XST00029-ACTL-STRT-TMST                                 17710009
179200                             TO EP072-STR-GRP-PROMO-STRT-TMST.    17720009
179300     MOVE XST00029-ACTL-END-TMST                                  17730009
179400                             TO EP072-STR-GRP-PROMO-END-TMST.     17740009
179500                                                                  17750097
179600*** WHEN A DELETE RECORD IS WRITTEN OUT FOR A CANCELED            17760097
179700*** OVERRIDE, AND AN ACTIVE PARENT EXISTS, AND THE RECORD         17770097
179800*** WILL BE DISTRIBUTED TO THE STORE GROUP OF THE CHANGED         17780097
179900*** RECORD...USE THE SOR-LAST-UPD-TMST FROM THE PARENT RECORD.    17790097
180000*** IF THE SOR-LAST-UPD-TMST OF THE CHANGED RECORD IS USED THE    17800097
180100*** SORTING WHICH OCCURS AFTER THIS PROGRAM WILL PUT THE ADD      17810097
180200*** OF THE PARENT VALUES FIRST AND THEN THE DELETE WHICH WILL     17820097
180300*** END UP LEAVING THE STORE GROUP WITH NOTHING.                  17830097
180400     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE = 'S'         17840097
180500       MOVE PRNT-RMS-SOR-LAST-UPD-TMST                            17850097
180600                             TO EP072-SOR-LAST-UPD-TMST           17860097
180700     ELSE                                                         17870097
180800       MOVE XST00029-SOR-LAST-UPD-TMST                            17880097
180900                             TO EP072-SOR-LAST-UPD-TMST           17890097
181000     END-IF.                                                      17900097
181100                                                                  17910009
181200*** WRITE AN EMERGENCY RECORD OUT FOR THE DELETE                  17920070
181300     MOVE PC-APPLY-CORRECTION                                     17930070
181400                             TO EP072-APPLY-IND.                  17940070
181500     PERFORM 4100-WRITE-EMERG-APPLY-REC.                          17950089
181600     ADD 1 TO PC-CNT-RMS-RECS.                                    17960059
181700                                                                  17970009
181800*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     17980070
181900     MOVE PC-APPLY-NIGHTLY                                        17990070
182000                             TO EP072-APPLY-IND.                  18000070
182100     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          18010089
182200     ADD 1 TO PC-CNT-RMS-RECS.                                    18020070
182300                                                                  18030070
182400*3000-EXIT.                                                       18040009
182500 EJECT.                                                           18050009
182600                                                                  18060009
182620*-----------------------------------------------------------      17350009
182630* 3005-RMS-DELREC-TO-CHG-STRGP-2.                                 17360089
182640*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND NIGHTLY         17370070
182650*     DELETE RECORDS WHICH SHOULD BE SENT TO THE STORE GROUP      17380089
182660*     WHICH IS ON THE IDENTIFIED CHANGED RECORD.                  17390089
182670*-----------------------------------------------------------      17400009
182680 3005-RMS-DELREC-TO-CHG-STRGP-2.                                  17410089
182690                                                                  17420009
182691     INITIALIZE EP072-PROMO-INTFC-RECORD.                         17430009
182692     MOVE PC-PRICG-STR-GRP-EVENT                                  17440026
182693                             TO EP072-BUSINESS-EVENT-ID.          17450009
182694     MOVE PC-RMS-PRC-SETUP-IND                                    17460009
182695                             TO EP072-PRC-SETUP-IND.              17470009
182696                                                                  17480089
182697     MOVE XST00029-STR-GP-TYP-CDE                                 17490089
182698                             TO EP072-SETUP-STR-GRP-TYP-CDE.      17500090
182699     MOVE XST00029-STR-GP-ID                                      17510089
182700                             TO EP072-SETUP-STR-GRP-ID.           17520089
182701     MOVE XST00029-STR-SELN-HIER-CDE                              17530089
182702                             TO EP072-STR-SELN-HIER-CDE.          17540089
182703     MOVE XST00029-STR-GP-TYP-CDE                                 17550089
182704                             TO EP072-DIST-STR-GRP-TYP-CDE.       17560089
182705     MOVE XST00029-STR-GP-ID                                      17570089
182706                             TO EP072-DIST-STR-GRP-ID.            17580089
182707                                                                  17590089
182708     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               17600009
182709     MOVE PC-DELETE-STAT-CDE                                      17610009
182710                             TO EP072-RECORD-ACTION               17620009
182711     MOVE XST00029-PROMO-INTFC-ID                                 17630009
182712                             TO EP072-PROMO-INTFC-ID.             17640009
182713     MOVE XST00029-MDSE-LNE-ID                                    17650009
182714                             TO EP072-MERCH-LNE-ID.               17660009
182715     MOVE XST00028-PRICG-TYP-CDE                                  17670009
182716                             TO EP072-PRICG-TYP-CDE.              17680009
182717     MOVE PC-MDSE-INCL-BOTH-IND                                   17690026
182718                             TO EP072-MDSE-INC-EXC-IND.           17700009
182719     MOVE XST00029-ACTL-STRT-TMST                                 17710009
182720                             TO EP072-STR-GRP-PROMO-STRT-TMST.    17720009
182721     MOVE XST00029-ACTL-END-TMST                                  17730009
182722                             TO EP072-STR-GRP-PROMO-END-TMST.     17740009
182723                                                                  17750097
182724*** WHEN A DELETE RECORD IS WRITTEN OUT FOR A CANCELED            17760097
182725*** OVERRIDE, AND AN ACTIVE PARENT EXISTS, AND THE RECORD         17770097
182726*** WILL BE DISTRIBUTED TO THE STORE GROUP OF THE CHANGED         17780097
182727*** RECORD...USE THE SOR-LAST-UPD-TMST FROM THE PARENT RECORD.    17790097
182728*** IF THE SOR-LAST-UPD-TMST OF THE CHANGED RECORD IS USED THE    17800097
182729*** SORTING WHICH OCCURS AFTER THIS PROGRAM WILL PUT THE ADD      17810097
182730*** OF THE PARENT VALUES FIRST AND THEN THE DELETE WHICH WILL     17820097
182731*** END UP LEAVING THE STORE GROUP WITH NOTHING.                  17830097
182732     IF PS-RMS-PRNT-STORE-FND AND PRNT-RMS-STAT-CDE = 'S'         17840097
182733       MOVE PRNT-RMS-SOR-LAST-UPD-TMST                            17850097
182734                             TO EP072-SOR-LAST-UPD-TMST           17860097
182735     ELSE                                                         17870097
182736       MOVE XST00029-SOR-LAST-UPD-TMST                            17880097
182737                             TO EP072-SOR-LAST-UPD-TMST           17890097
182738     END-IF.                                                      17900097
182739                                                                  17910009
182741     PERFORM 3200-CALC-LAST-UPD-TMST.                                     
182745                                                                  17910009
182746*** WRITE AN EMERGENCY RECORD OUT FOR THE DELETE                  17920070
182747     MOVE PC-APPLY-CORRECTION                                     17930070
182748                             TO EP072-APPLY-IND.                  17940070
182749     PERFORM 4100-WRITE-EMERG-APPLY-REC.                          17950089
182750     ADD 1 TO PC-CNT-RMS-RECS.                                    17960059
182751                                                                  17970009
182752*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     17980070
182753     MOVE PC-APPLY-NIGHTLY                                        17990070
182754                             TO EP072-APPLY-IND.                  18000070
182755     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          18010089
182756     ADD 1 TO PC-CNT-RMS-RECS.                                    18020070
182757                                                                  18030070
182758*3005-EXIT.                                                       18040009
182759 EJECT.                                                           18050009
182761                                                                  18060009
182770*-----------------------------------------------------------      18070009
182800* 3010-RMS-ADD-REC.                                               18080089
182900*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND/OR NIGHTLY      18090089
183000*     ADD RECORDS.                                                18100089
183100*-----------------------------------------------------------      18110009
183200 3010-RMS-ADD-REC.                                                18120089
183300                                                                  18130009
183400     INITIALIZE EP072-PROMO-INTFC-RECORD.                         18140009
183500     MOVE PC-PRICG-STR-GRP-EVENT                                  18150026
183600                             TO EP072-BUSINESS-EVENT-ID.          18160009
183700     MOVE PC-RMS-PRC-SETUP-IND                                    18170009
183800                             TO EP072-PRC-SETUP-IND.              18180009
183900     MOVE XST00029-STR-GP-TYP-CDE                                 18190009
184000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      18200009
184100     MOVE XST00029-STR-GP-ID                                      18210009
184200                             TO EP072-SETUP-STR-GRP-ID.           18220006
184300     MOVE XST00029-STR-SELN-HIER-CDE                              18230009
184400                             TO EP072-STR-SELN-HIER-CDE.          18240006
184500     MOVE XST00029-STR-GP-TYP-CDE                                 18250009
184600                             TO EP072-DIST-STR-GRP-TYP-CDE.       18260006
184700     MOVE XST00029-STR-GP-ID                                      18270009
184800                             TO EP072-DIST-STR-GRP-ID.            18280006
184900     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               18290006
185000                                                                  18300006
185100     MOVE XST00029-ACTL-STRT-TMST                                 18310064
185200                             TO PV-ACTL-STRT-TMST.                18320064
185300     MOVE XST00029-ACTL-END-TMST                                  18330064
185400                             TO PV-ACTL-END-TMST.                 18340064
185500                                                                  18350064
185600     IF (PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE           18360064
185700       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE)            18370064
185800         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               18380013
185900     ELSE                                                         18390009
186000       IF (PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE        18400064
186100         AND PV-ACTL-END-TMST-DATE >= EP111-CC-CRNT-DTE)          18410064
186200           MOVE PC-APPLY-CORRECTION TO EP072-APPLY-IND            18420064
186300       END-IF                                                     18430009
186400     END-IF.                                                      18440009
186500                                                                  18450074
186600     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               18460009
186700     MOVE XST00029-PROMO-INTFC-ID                                 18470009
186800                             TO EP072-PROMO-INTFC-ID.             18480006
186900     MOVE XST00029-MDSE-LNE-ID                                    18490009
187000                             TO EP072-MERCH-LNE-ID.               18500006
187100     MOVE XST00028-PRICG-TYP-CDE                                  18510006
187200                             TO EP072-PRICG-TYP-CDE.              18520006
187300     MOVE PC-MDSE-INCL-BOTH-IND                                   18530006
187400                             TO EP072-MDSE-INC-EXC-IND.           18540006
187500     MOVE XST00029-ACTL-STRT-TMST                                 18550009
187600                             TO EP072-STR-GRP-PROMO-STRT-TMST.    18560006
187700     MOVE XST00029-ACTL-END-TMST                                  18570009
187800                             TO EP072-STR-GRP-PROMO-END-TMST.     18580006
187900     MOVE XST00029-SOR-LAST-UPD-TMST                              18590009
188000                             TO EP072-SOR-LAST-UPD-TMST.          18600006
188100                                                                  18610006
188200     IF EP072-APPLY-NIGHTLY                                       18620006
188300       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         18630089
188400       ADD 1 TO PC-CNT-RMS-RECS                                   18640059
188500     ELSE                                                         18650006
188600       PERFORM 4100-WRITE-EMERG-APPLY-REC                         18660089
188700       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 18670006
188800       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         18680089
188900       ADD 2 TO PC-CNT-RMS-RECS                                   18690059
189000     END-IF.                                                      18700006
189100                                                                  18710006
189200*3010-EXIT.                                                       18720009
189300 EJECT.                                                           18730006
189400                                                                  18740006
189500*-----------------------------------------------------------      18750009
189600* 3020-RMS-ADDREC-TO-CHG-STRGP.                                   18760089
189700*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND/OR NIGHTLY      18770089
189800*     ADD RECORDS WHICH ARE POPULATED WITH THE PARENT             18780089
189900*     EFFECTIVITY TIMESTAMPS.                                     18790089
190000*-----------------------------------------------------------      18800009
190100 3020-RMS-PRNTREC-TO-CHG-STRGP.                                   18810089
190200                                                                  18820009
190300     INITIALIZE EP072-PROMO-INTFC-RECORD.                         18830009
190400     MOVE PC-PRICG-STR-GRP-EVENT                                  18840026
190500                             TO EP072-BUSINESS-EVENT-ID.          18850009
190600     MOVE PC-RMS-PRC-SETUP-IND                                    18860009
190700                             TO EP072-PRC-SETUP-IND.              18870009
190800     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 18880049
190900                             TO EP072-SETUP-STR-GRP-TYP-CDE.      18890050
191000     MOVE PRNT-RMS-STR-GP-ID                                      18900049
191100                             TO EP072-SETUP-STR-GRP-ID.           18910009
191200     MOVE XST00029-STR-SELN-HIER-CDE                              18920090
191300                             TO EP072-STR-SELN-HIER-CDE           18930090
191400     MOVE XST00029-STR-GP-TYP-CDE                                 18940089
191500                             TO EP072-DIST-STR-GRP-TYP-CDE        18950082
191600     MOVE XST00029-STR-GP-ID                                      18960089
191700                             TO EP072-DIST-STR-GRP-ID             18970082
191800     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               18980090
191900                                                                  18990009
192000     IF (PV-PRNT-RMS-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE       19000068
192100       AND PV-PRNT-RMS-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)        19010068
192200         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               19020013
192300     ELSE                                                         19030009
192400       IF PV-PRNT-RMS-ACTL-STRT-DATE <= EP128-CC-CRITICAL-DTE     19040068
192500         MOVE PC-APPLY-CORRECTION TO EP072-APPLY-IND              19050033
192600       END-IF                                                     19060009
192700     END-IF.                                                      19070009
192800                                                                  19080009
192900     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               19090009
193000     MOVE XST00029-PROMO-INTFC-ID                                 19100009
193100                             TO EP072-PROMO-INTFC-ID.             19110009
193200     MOVE XST00029-MDSE-LNE-ID                                    19120009
193300                             TO EP072-MERCH-LNE-ID.               19130009
193400     MOVE XST00028-PRICG-TYP-CDE                                  19140009
193500                             TO EP072-PRICG-TYP-CDE.              19150009
193600     MOVE PC-MDSE-INCL-BOTH-IND                                   19160009
193700                             TO EP072-MDSE-INC-EXC-IND.           19170009
193800     MOVE PRNT-RMS-ACTL-STRT-TMST                                 19180052
193900                             TO EP072-STR-GRP-PROMO-STRT-TMST.    19190009
194000     MOVE PRNT-RMS-ACTL-END-TMST                                  19200052
194100                             TO EP072-STR-GRP-PROMO-END-TMST.     19210009
194200     MOVE PRNT-RMS-SOR-LAST-UPD-TMST                              19220049
194300                             TO EP072-SOR-LAST-UPD-TMST.          19230009
194400                                                                  19240009
194500     IF EP072-APPLY-NIGHTLY                                       19250009
194600       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         19260089
194700       ADD 1 TO PC-CNT-RMS-RECS                                   19270059
194800     ELSE                                                         19280009
194900       PERFORM 4100-WRITE-EMERG-APPLY-REC                         19290089
195000       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 19300009
195100       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         19310089
195200       ADD 2 TO PC-CNT-RMS-RECS                                   19320059
195300     END-IF.                                                      19330009
195400                                                                  19340009
195500*3020-EXIT.                                                       19350009
195600 EJECT.                                                           19360009
195700                                                                  19370009
195800*-----------------------------------------------------------      19380050
195900* 3030-RMS-OVRRDE-OUTPUT.                                         19390089
196000*     POPULATE COPYBOOK EPRD072.                                  19400050
196100*-----------------------------------------------------------      19410050
196200 3030-RMS-OVRRDE-OUTPUT.                                          19420089
196300                                                                  19430050
196400     INITIALIZE EP072-PROMO-INTFC-RECORD.                         19440050
196500     MOVE PC-PRICG-BUS-EVENT                                      19450050
196600                             TO EP072-BUSINESS-EVENT-ID.          19460050
196700     MOVE PC-RMS-PRC-SETUP-IND                                    19470050
196800                             TO EP072-PRC-SETUP-IND.              19480050
196900     MOVE XST00029-STR-GP-TYP-CDE                                 19490050
197000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      19500050
197100     MOVE XST00029-STR-GP-ID                                      19510050
197200                             TO EP072-SETUP-STR-GRP-ID.           19520050
197300     MOVE XST00029-STR-SELN-HIER-CDE                              19530050
197400                             TO EP072-STR-SELN-HIER-CDE.          19540050
197500     MOVE XST00029-STR-GP-TYP-CDE                                 19550050
197600                             TO EP072-DIST-STR-GRP-TYP-CDE.       19560050
197700     MOVE XST00029-STR-GP-ID                                      19570050
197800                             TO EP072-DIST-STR-GRP-ID.            19580050
197900     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               19590050
198000     MOVE XST00029-ACTL-STRT-TMST                                 19600064
198100                             TO PV-ACTL-STRT-TMST.                19610064
198200                                                                  19620050
198300     IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE           19630064
198400       MOVE PC-APPLY-CORRECTION   TO EP072-APPLY-IND              19640058
198500     ELSE                                                         19650058
198600       IF PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE              19660064
198700         MOVE PC-APPLY-NIGHTLY    TO EP072-APPLY-IND              19670058
198800       END-IF                                                     19680050
198900     END-IF.                                                      19690050
199000                                                                  19700050
199100     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              19710050
199200     MOVE XST00029-PROMO-INTFC-ID                                 19720050
199300                             TO EP072-PROMO-INTFC-ID.             19730050
199400     MOVE XST00029-MDSE-LNE-ID                                    19740050
199500                             TO EP072-MERCH-LNE-ID.               19750050
199600     MOVE XST00028-PRICG-TYP-CDE                                  19760050
199700                             TO EP072-PRICG-TYP-CDE.              19770050
199800     MOVE PC-MDSE-INCL-BOTH-IND                                   19780050
199900                             TO EP072-MDSE-INC-EXC-IND.           19790050
200000     MOVE XST00029-ACTL-STRT-TMST                                 19800050
200100                             TO EP072-STR-GRP-PROMO-STRT-TMST.    19810050
200200     MOVE XST00029-ACTL-END-TMST                                  19820050
200300                             TO EP072-STR-GRP-PROMO-END-TMST.     19830050
200400     MOVE XST00029-SOR-LAST-UPD-TMST                              19840050
200500                             TO EP072-SOR-LAST-UPD-TMST.          19850050
200600                                                                  19860050
200700     IF EP072-APPLY-NIGHTLY                                       19870050
200800       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         19880089
200900       ADD 1 TO PC-CNT-OVRRDE-RECS                                19890059
201000     ELSE                                                         19900050
201100       PERFORM 4100-WRITE-EMERG-APPLY-REC                         19910089
201200       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 19920050
201300       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         19930089
201400       ADD 2 TO PC-CNT-OVRRDE-RECS                                19940059
201500     END-IF.                                                      19950050
201600                                                                  19960050
201700*3030-EXIT.                                                       19970050
201800 EJECT.                                                           19980050
201900                                                                  19990050
202000*-----------------------------------------------------------      20000089
202100* 3040-RMS-DELREC-TO-PRNT-STRGP.                                  20010089
202200*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND NIGHTLY         20020089
202300*     DELETE RECORDS.                                             20030089
202400*-----------------------------------------------------------      20040089
202500 3040-RMS-DELREC-TO-PRNT-STRGP.                                   20050089
202600                                                                  20060089
202700     INITIALIZE EP072-PROMO-INTFC-RECORD.                         20070089
202800     MOVE PC-PRICG-STR-GRP-EVENT                                  20080089
202900                             TO EP072-BUSINESS-EVENT-ID.          20090089
203000     MOVE PC-RMS-PRC-SETUP-IND                                    20100089
203100                             TO EP072-PRC-SETUP-IND.              20110089
203200     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 20120090
203300                             TO EP072-SETUP-STR-GRP-TYP-CDE.      20130093
203400     MOVE PRNT-RMS-STR-GP-ID                                      20140090
203500                             TO EP072-SETUP-STR-GRP-ID.           20150089
203600     MOVE PRNT-RMS-STR-SELN-HIER-CDE                              20160090
203700                             TO EP072-STR-SELN-HIER-CDE.          20170089
203800     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 20180090
203900                             TO EP072-DIST-STR-GRP-TYP-CDE.       20190089
204000     MOVE PRNT-RMS-STR-GP-ID                                      20200090
204100                             TO EP072-DIST-STR-GRP-ID.            20210089
204200                                                                  20220089
204300     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               20230089
204400     MOVE PC-DELETE-STAT-CDE                                      20240089
204500                             TO EP072-RECORD-ACTION               20250089
204600     MOVE XST00029-PROMO-INTFC-ID                                 20260089
204700                             TO EP072-PROMO-INTFC-ID.             20270089
204800     MOVE XST00029-MDSE-LNE-ID                                    20280089
204900                             TO EP072-MERCH-LNE-ID.               20290089
205000     MOVE XST00028-PRICG-TYP-CDE                                  20300089
205100                             TO EP072-PRICG-TYP-CDE.              20310089
205200     MOVE PC-MDSE-INCL-BOTH-IND                                   20320089
205300                             TO EP072-MDSE-INC-EXC-IND.           20330089
205400     MOVE PRNT-RMS-ACTL-STRT-TMST                                 20340090
205500                             TO EP072-STR-GRP-PROMO-STRT-TMST.    20350089
205600     MOVE PRNT-RMS-ACTL-END-TMST                                  20360090
205700                             TO EP072-STR-GRP-PROMO-END-TMST.     20370089
205800     MOVE PRNT-RMS-SOR-LAST-UPD-TMST                              20380090
205900                             TO EP072-SOR-LAST-UPD-TMST.          20390089
206000                                                                  20400089
206100*** WRITE AN EMERGENCY RECORD OUT FOR THE DELETE                  20410089
206200     MOVE PC-APPLY-CORRECTION                                     20420089
206300                             TO EP072-APPLY-IND.                  20430089
206400     PERFORM 4100-WRITE-EMERG-APPLY-REC.                          20440089
206500     ADD 1 TO PC-CNT-RMS-RECS.                                    20450089
206600                                                                  20460089
206700*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     20470089
206800     MOVE PC-APPLY-NIGHTLY                                        20480089
206900                             TO EP072-APPLY-IND.                  20490089
207000     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          20500089
207100     ADD 1 TO PC-CNT-RMS-RECS.                                    20510089
207200                                                                  20520089
207300*3040-EXIT.                                                       20530089
207400 EJECT.                                                           20540089
207500                                                                  20550089
207600*-----------------------------------------------------------      20560089
207700* 3050-RMS-PRNTREC-TO-PRNT-STRGP.                                 20570090
207800*     POPULATE COPYBOOK EPRD072 FOR EMERGENCY AND/OR NIGHTLY      20580090
207900*     ADD RECORDS WHICH ARE POPULATED WITH THE PARENT             20590090
208000*     VALUES AND SENT TO THE PARENT STORE GROUP.                  20600090
208100*-----------------------------------------------------------      20610089
208200 3050-RMS-PRNTREC-TO-PRNT-STRGP.                                  20620090
208300                                                                  20630089
208400     INITIALIZE EP072-PROMO-INTFC-RECORD.                         20640089
208500     MOVE PC-PRICG-STR-GRP-EVENT                                  20650089
208600                             TO EP072-BUSINESS-EVENT-ID.          20660089
208700     MOVE PC-RMS-PRC-SETUP-IND                                    20670089
208800                             TO EP072-PRC-SETUP-IND.              20680089
208900     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 20690089
209000                             TO EP072-SETUP-STR-GRP-TYP-CDE.      20700089
209100     MOVE PRNT-RMS-STR-GP-ID                                      20710089
209200                             TO EP072-SETUP-STR-GRP-ID.           20720089
209300     MOVE PRNT-RMS-STR-SELN-HIER-CDE                              20730091
209400                             TO EP072-STR-SELN-HIER-CDE           20740091
209500     MOVE PRNT-RMS-STR-GP-TYP-CDE                                 20750090
209600                             TO EP072-DIST-STR-GRP-TYP-CDE        20760089
209700     MOVE PRNT-RMS-STR-GP-ID                                      20770090
209800                             TO EP072-DIST-STR-GRP-ID             20780089
209900     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               20790091
210000                                                                  20800089
210100     IF (PV-PRNT-RMS-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE       20810089
210200       AND PV-PRNT-RMS-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)        20820089
210300         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               20830089
210400     ELSE                                                         20840089
210500       IF PV-PRNT-RMS-ACTL-STRT-DATE <= EP128-CC-CRITICAL-DTE     20850089
210600         MOVE PC-APPLY-CORRECTION TO EP072-APPLY-IND              20860089
210700       END-IF                                                     20870089
210800     END-IF.                                                      20880089
210900                                                                  20890089
211000     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               20900089
211100     MOVE XST00029-PROMO-INTFC-ID                                 20910089
211200                             TO EP072-PROMO-INTFC-ID.             20920089
211300     MOVE XST00029-MDSE-LNE-ID                                    20930089
211400                             TO EP072-MERCH-LNE-ID.               20940089
211500     MOVE XST00028-PRICG-TYP-CDE                                  20950089
211600                             TO EP072-PRICG-TYP-CDE.              20960089
211700     MOVE PC-MDSE-INCL-BOTH-IND                                   20970089
211800                             TO EP072-MDSE-INC-EXC-IND.           20980089
211900     MOVE PRNT-RMS-ACTL-STRT-TMST                                 20990089
212000                             TO EP072-STR-GRP-PROMO-STRT-TMST.    21000089
212100     MOVE PRNT-RMS-ACTL-END-TMST                                  21010089
212200                             TO EP072-STR-GRP-PROMO-END-TMST.     21020089
212300     MOVE PRNT-RMS-SOR-LAST-UPD-TMST                              21030089
212400                             TO EP072-SOR-LAST-UPD-TMST.          21040089
212500                                                                  21050089
212600     IF EP072-APPLY-NIGHTLY                                       21060089
212700       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         21070089
212800       ADD 1 TO PC-CNT-RMS-RECS                                   21080089
212900     ELSE                                                         21090089
213000       PERFORM 4100-WRITE-EMERG-APPLY-REC                         21100089
213100       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 21110089
213200       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         21120089
213300       ADD 2 TO PC-CNT-RMS-RECS                                   21130089
213400     END-IF.                                                      21140089
213500                                                                  21150089
213600*3050-EXIT.                                                       21160089
213700 EJECT.                                                           21170089
213800                                                                  21180089
213900*-----------------------------------------------------------      21190009
214000* 3100-ADHC-DEL-REC.                                              21200089
214100*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC DELETE.      21210009
214200*-----------------------------------------------------------      21220009
214300 3100-ADHC-DEL-REC.                                               21230089
214400                                                                  21240009
214500     INITIALIZE EP072-PROMO-INTFC-RECORD.                         21250009
214600     MOVE PC-PRICG-STR-GRP-EVENT                                  21260029
214700                             TO EP072-BUSINESS-EVENT-ID.          21270009
214800     MOVE PC-ADHOC-PRC-SETUP-IND                                  21280009
214900                             TO EP072-PRC-SETUP-IND.              21290009
215000                                                                  21300099
215100     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                21310009
215200                             TO EP072-SETUP-STR-GRP-TYP-CDE.      21320009
215300     MOVE XST00031-ADHC-STR-GP-ID                                 21330009
215400                             TO EP072-SETUP-STR-GRP-ID.           21340009
215500     MOVE XST00031-STR-SELN-HIER-CDE                              21350009
215600                             TO EP072-STR-SELN-HIER-CDE.          21360009
215700     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                21370049
215800                             TO EP072-DIST-STR-GRP-TYP-CDE.       21380009
215900     MOVE XST00031-ADHC-STR-GP-ID                                 21390050
216000                             TO EP072-DIST-STR-GRP-ID.            21400009
216100                                                                  21401099
216200     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               21410009
216300     MOVE PC-DELETE-STAT-CDE                                      21420009
216400                             TO EP072-RECORD-ACTION.              21430009
216500     MOVE XST00031-PROMO-INTFC-ID                                 21440009
216600                             TO EP072-PROMO-INTFC-ID.             21450009
216700     MOVE XST00031-MDSE-LNE-ID                                    21460009
216800                             TO EP072-MERCH-LNE-ID.               21470009
216900     MOVE XST00028-PRICG-TYP-CDE                                  21480009
217000                             TO EP072-PRICG-TYP-CDE.              21490009
217100     MOVE PC-MDSE-INCL-BOTH-IND                                   21500009
217200                             TO EP072-MDSE-INC-EXC-IND.           21510009
217300     MOVE XST00031-ACTL-STRT-TMST                                 21520009
217400                             TO EP072-STR-GRP-PROMO-STRT-TMST.    21530009
217500     MOVE XST00031-ACTL-END-TMST                                  21540009
217600                             TO EP072-STR-GRP-PROMO-END-TMST.     21550009
217700     MOVE XST00031-SOR-LAST-UPD-TMST                              21560049
217800                             TO EP072-SOR-LAST-UPD-TMST.          21570009
217811     PERFORM 3200-CALC-LAST-UPD-TMST.                                     
217900                                                                  21580009
218000*** WRITE AN EMERGENCY RECORD OUT FOR THE DELETE                  21590099
218100     MOVE PC-APPLY-CORRECTION                                     21600099
218200                             TO EP072-APPLY-IND.                  21610099
218300     PERFORM 4100-WRITE-EMERG-APPLY-REC.                          21620089
218400     ADD 1 TO PC-CNT-ADHOC-RECS.                                  21630059
218500                                                                  21640009
218600*** WRITE A NIGHTLY RECORD OUT FOR THE DELETE                     21650099
218700     MOVE PC-APPLY-NIGHTLY                                        21660099
218800                             TO EP072-APPLY-IND.                  21670099
218900     PERFORM 4000-WRITE-NIGHT-APPLY-REC.                          21680099
219000     ADD 1 TO PC-CNT-ADHOC-RECS.                                  21690099
219100                                                                  21700099
219200*3100-EXIT.                                                       21710009
219300 EJECT.                                                           21720009
219400                                                                  21730009
219500*-----------------------------------------------------------      21740009
219600* 3110-ADHC-ADD-REC.                                              21750089
219700*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC CURSOR.      21760009
219800*-----------------------------------------------------------      21770009
219900 3110-ADHC-ADD-REC.                                               21780089
220000                                                                  21790009
220100     INITIALIZE EP072-PROMO-INTFC-RECORD.                         21800009
220200     MOVE PC-PRICG-STR-GRP-EVENT                                  21810029
220300                             TO EP072-BUSINESS-EVENT-ID.          21820009
220400     MOVE PC-ADHOC-PRC-SETUP-IND                                  21830009
220500                             TO EP072-PRC-SETUP-IND.              21840009
220600     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                21850009
220700                             TO EP072-SETUP-STR-GRP-TYP-CDE.      21860009
220800     MOVE XST00031-ADHC-STR-GP-ID                                 21870009
220900                             TO EP072-SETUP-STR-GRP-ID.           21880009
221000     MOVE XST00031-STR-SELN-HIER-CDE                              21890009
221100                             TO EP072-STR-SELN-HIER-CDE.          21900009
221200     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                21910049
221300                             TO EP072-DIST-STR-GRP-TYP-CDE.       21920009
221400     MOVE XST00031-ADHC-STR-GP-ID                                 21930049
221500                             TO EP072-DIST-STR-GRP-ID.            21940009
221600     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               21950009
221700                                                                  21960033
221800     MOVE XST00031-ACTL-STRT-TMST                                 21970064
221900                             TO PV-ACTL-STRT-TMST.                21980064
222000     MOVE XST00031-ACTL-END-TMST                                  21990064
222100                             TO PV-ACTL-END-TMST.                 22000064
222200                                                                  22010064
222300     IF (PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE           22020064
222400       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE)            22030064
222500         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               22040064
222600     ELSE                                                         22050064
222700       IF (PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE        22060064
222800         AND PV-ACTL-END-TMST-DATE >= EP111-CC-CRNT-DTE)          22070064
222900           MOVE PC-APPLY-CORRECTION TO EP072-APPLY-IND            22080064
223000       END-IF                                                     22090064
223100     END-IF.                                                      22100064
223200                                                                  22110033
223300     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION               22120049
223400     MOVE XST00031-PROMO-INTFC-ID                                 22130009
223500                             TO EP072-PROMO-INTFC-ID.             22140009
223600     MOVE XST00031-MDSE-LNE-ID                                    22150009
223700                             TO EP072-MERCH-LNE-ID.               22160009
223800     MOVE XST00028-PRICG-TYP-CDE                                  22170009
223900                             TO EP072-PRICG-TYP-CDE.              22180009
224000     MOVE PC-MDSE-INCL-BOTH-IND                                   22190009
224100                             TO EP072-MDSE-INC-EXC-IND.           22200009
224200     MOVE XST00031-ACTL-STRT-TMST                                 22210009
224300                             TO EP072-STR-GRP-PROMO-STRT-TMST.    22220009
224400     MOVE XST00031-ACTL-END-TMST                                  22230009
224500                             TO EP072-STR-GRP-PROMO-END-TMST.     22240009
224600     MOVE XST00031-SOR-LAST-UPD-TMST                              22250049
224700                             TO EP072-SOR-LAST-UPD-TMST.          22260009
224800                                                                  22270009
224900     IF EP072-APPLY-NIGHTLY                                       22280009
225000       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         22290089
225100       ADD 1 TO PC-CNT-ADHOC-RECS                                 22300059
225200     ELSE                                                         22310009
225300       PERFORM 4100-WRITE-EMERG-APPLY-REC                         22320089
225400       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 22330009
225500       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         22340089
225600       ADD 2 TO PC-CNT-ADHOC-RECS                                 22350059
225700     END-IF.                                                      22360009
225800                                                                  22370009
225900*3110-EXIT.                                                       22380009
226000 EJECT.                                                           22390009
226100                                                                  22400009
226200*-----------------------------------------------------------      22410009
226300* 3120-ADHOC-PRNT-REC.                                            22420089
226400*     POPULATE COPYBOOK EPRD072 WITH DATA FROM ADHOC CURSOR.      22430009
226500*-----------------------------------------------------------      22440009
226600 3120-ADHOC-PRNT-REC.                                             22450089
226700                                                                  22460009
226800     INITIALIZE EP072-PROMO-INTFC-RECORD.                         22470009
226900     MOVE PC-PRICG-STR-GRP-EVENT                                  22480029
227000                             TO EP072-BUSINESS-EVENT-ID.          22490009
227100     MOVE PC-ADHOC-PRC-SETUP-IND                                  22500009
227200                             TO EP072-PRC-SETUP-IND.              22510009
227300     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                22520049
227400                             TO EP072-SETUP-STR-GRP-TYP-CDE.      22530009
227500     MOVE PRNT-ADHOC-ADHC-STR-GP-ID                               22540049
227600                             TO EP072-SETUP-STR-GRP-ID.           22550009
227700     MOVE XST00029-STR-SELN-HIER-CDE                              22560052
227800                             TO EP072-STR-SELN-HIER-CDE.          22570009
227900     MOVE XST00029-STR-GP-TYP-CDE                                 22580052
228000                             TO EP072-DIST-STR-GRP-TYP-CDE.       22590009
228100     MOVE XST00029-STR-GP-ID                                      22600052
228200                             TO EP072-DIST-STR-GRP-ID.            22610009
228300     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               22620009
228400                                                                  22630009
228500     IF (PV-PRNT-ADHOC-ACTL-STRT-DATE > EP128-CC-CRITICAL-DTE     22640068
228600       AND PV-PRNT-ADHOC-ACTL-STRT-DATE < EP113-CC-CRNT-DTE)      22650068
228700         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               22660033
228800     ELSE                                                         22670033
228900       IF PV-PRNT-ADHOC-ACTL-STRT-DATE <= EP128-CC-CRITICAL-DTE   22680068
229000         MOVE PC-APPLY-CORRECTION TO EP072-APPLY-IND              22690033
229100       END-IF                                                     22700033
229200     END-IF.                                                      22710033
229300                                                                  22720033
229400     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              22730052
229500     MOVE XST00029-PROMO-INTFC-ID                                 22740052
229600                             TO EP072-PROMO-INTFC-ID.             22750009
229700     MOVE XST00029-MDSE-LNE-ID                                    22760052
229800                             TO EP072-MERCH-LNE-ID.               22770009
229900     MOVE XST00028-PRICG-TYP-CDE                                  22780009
230000                             TO EP072-PRICG-TYP-CDE.              22790009
230100     MOVE PC-MDSE-INCL-BOTH-IND                                   22800009
230200                             TO EP072-MDSE-INC-EXC-IND.           22810009
230300     MOVE PRNT-ADHOC-ACTL-STRT-TMST                               22820052
230400                             TO EP072-STR-GRP-PROMO-STRT-TMST.    22830009
230500     MOVE PRNT-ADHOC-ACTL-END-TMST                                22840052
230600                             TO EP072-STR-GRP-PROMO-END-TMST.     22850009
230700     MOVE PRNT-ADHOC-SOR-LAST-UPD-TMST                            22860049
230800                             TO EP072-SOR-LAST-UPD-TMST.          22870009
230900                                                                  22880009
231000     IF EP072-APPLY-NIGHTLY                                       22890009
231100       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         22900089
231200       ADD 1 TO PC-CNT-ADHOC-RECS                                 22910059
231300     ELSE                                                         22920009
231400       PERFORM 4100-WRITE-EMERG-APPLY-REC                         22930089
231500       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 22940009
231600       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         22950089
231700       ADD 2 TO PC-CNT-ADHOC-RECS                                 22960059
231800     END-IF.                                                      22970009
231900                                                                  22980009
232000*3120-EXIT.                                                       22990009
232100 EJECT.                                                           23000009
232200                                                                  23010009
232300*-----------------------------------------------------------      23020009
232400* 3130-ADHC-OVRRDE-OUTPUT.                                        23030089
232500*     POPULATE COPYBOOK EPRD072.                                  23040009
232600*-----------------------------------------------------------      23050009
232700 3130-ADHC-OVRRDE-OUTPUT.                                         23060089
232800                                                                  23070009
232900     INITIALIZE EP072-PROMO-INTFC-RECORD.                         23080009
233000     MOVE PC-PRICG-BUS-EVENT                                      23090026
233100                             TO EP072-BUSINESS-EVENT-ID.          23100009
233200     MOVE PC-ADHOC-PRC-SETUP-IND                                  23110050
233300                             TO EP072-PRC-SETUP-IND.              23120050
233400     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                23130050
233500                             TO EP072-SETUP-STR-GRP-TYP-CDE.      23140050
233600     MOVE PRNT-ADHOC-ADHC-STR-GP-ID                               23150050
233700                             TO EP072-SETUP-STR-GRP-ID.           23160050
233800     MOVE XST00031-STR-SELN-HIER-CDE                              23170050
233900                             TO EP072-STR-SELN-HIER-CDE.          23180050
234000     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                23190050
234100                             TO EP072-DIST-STR-GRP-TYP-CDE.       23200050
234200     MOVE XST00031-ADHC-STR-GP-ID                                 23210050
234300                             TO EP072-DIST-STR-GRP-ID.            23220050
234400     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               23230009
234500     MOVE XST00031-ACTL-STRT-TMST                                 23240050
234600                             TO PV-ACTL-STRT-TMST.                23250009
234700                                                                  23260058
234800     IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE           23270064
234900       MOVE PC-APPLY-CORRECTION   TO EP072-APPLY-IND              23280058
235000     ELSE                                                         23290058
235100       IF PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE              23300064
235200         MOVE PC-APPLY-NIGHTLY    TO EP072-APPLY-IND              23310058
235300       END-IF                                                     23320058
235400     END-IF.                                                      23330058
235500                                                                  23340058
235600     MOVE PC-ADD-STAT-CDE    TO EP072-RECORD-ACTION.              23350009
235700     MOVE XST00031-PROMO-INTFC-ID                                 23360050
235800                             TO EP072-PROMO-INTFC-ID.             23370009
235900     MOVE XST00031-MDSE-LNE-ID                                    23380050
236000                             TO EP072-MERCH-LNE-ID.               23390009
236100     MOVE XST00028-PRICG-TYP-CDE                                  23400009
236200                             TO EP072-PRICG-TYP-CDE.              23410009
236300     MOVE PC-MDSE-INCL-BOTH-IND                                   23420026
236400                             TO EP072-MDSE-INC-EXC-IND.           23430009
236500     MOVE XST00031-ACTL-STRT-TMST                                 23440050
236600                             TO EP072-STR-GRP-PROMO-STRT-TMST.    23450009
236700     MOVE XST00031-ACTL-END-TMST                                  23460050
236800                             TO EP072-STR-GRP-PROMO-END-TMST.     23470009
236900     MOVE XST00031-SOR-LAST-UPD-TMST                              23480050
237000                             TO EP072-SOR-LAST-UPD-TMST.          23490009
237100                                                                  23500009
237200     IF EP072-APPLY-NIGHTLY                                       23510009
237300       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         23520089
237400       ADD 1 TO PC-CNT-OVRRDE-RECS                                23530059
237500     ELSE                                                         23540009
237600       PERFORM 4100-WRITE-EMERG-APPLY-REC                         23550089
237700       MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND                 23560009
237800       PERFORM 4000-WRITE-NIGHT-APPLY-REC                         23570089
237900       ADD 2 TO PC-CNT-OVRRDE-RECS                                23580059
238000     END-IF.                                                      23590009
238100                                                                  23600009
238200*3130-EXIT.                                                       23610050
238300 EJECT.                                                           23620009
238301                                                                          
238303*-----------------------------------------------------------      23020009
238304* 3200-CALC-LAST-UPD-TMST.                                        23030089
238305*     CALCULATE LAST-UPD-TMST FOR CREATED DELETE RECORDS.         23040009
238306*-----------------------------------------------------------      23050009
238307 3200-CALC-LAST-UPD-TMST.                                         23060089
238308                                                                  23070009
238309     INITIALIZE PV-HOLD-TMST                                              
238310                PV-FORMAT-TMST.                                           
238311                                                                          
238317     MOVE EP072-SOR-LAST-UPD-TMST                                         
238320                              TO PV-HOLD-TMST.                            
238321                                                                          
238323     MOVE PC-DASH             TO PV-FORMAT-TMST-DASH.                     
238324     MOVE PC-PERIOD           TO PV-FORMAT-TMST-TM-D1                     
238325                                 PV-FORMAT-TMST-TM-D2                     
238326                                 PV-FORMAT-TMST-TM-D3.                    
238327                                                                          
238334     IF PV-HOLD-TMST-TM-NN-NUM > ZERO                                     
238335        COMPUTE PV-FORMAT-TMST-TM-NN-NUM =                                
238336              (PV-HOLD-TMST-TM-NN-NUM - 1)                                
238337        MOVE PV-HOLD-TMST-TM-SS TO PV-FORMAT-TMST-TM-SS                   
238338        MOVE PV-HOLD-TMST-TM-MM TO PV-FORMAT-TMST-TM-MM                   
238339        MOVE PV-HOLD-TMST-TM-HH TO PV-FORMAT-TMST-TM-HH                   
238340        MOVE PV-HOLD-TMST-DTE TO PV-FORMAT-TMST-DTE                       
238341     ELSE                                                                 
238342        IF PV-HOLD-TMST-TM-SS-NUM > ZERO                                  
238343           COMPUTE PV-FORMAT-TMST-TM-SS-NUM =                             
238344                 (PV-HOLD-TMST-TM-SS-NUM - 1)                             
238345           MOVE PC-9S TO PV-FORMAT-TMST-TM-NN                             
238346           MOVE PV-HOLD-TMST-TM-HH TO PV-FORMAT-TMST-TM-HH                
238347           MOVE PV-HOLD-TMST-TM-MM TO PV-FORMAT-TMST-TM-MM                
238348           MOVE PV-HOLD-TMST-DTE   TO PV-FORMAT-TMST-DTE                  
238349        ELSE                                                              
238350           IF PV-HOLD-TMST-TM-MM-NUM > ZERO                               
238351              COMPUTE PV-FORMAT-TMST-TM-MM-NUM =                          
238352                    (PV-HOLD-TMST-TM-MM-NUM - 1)                          
238353              MOVE PC-9S TO PV-FORMAT-TMST-TM-NN                          
238354              MOVE PC-59 TO PV-FORMAT-TMST-TM-SS                          
238355              MOVE PV-HOLD-TMST-TM-HH TO PV-FORMAT-TMST-TM-HH             
238356              MOVE PV-HOLD-TMST-DTE   TO PV-FORMAT-TMST-DTE               
238357           ELSE                                                           
238358               IF PV-HOLD-TMST-TM-HH-NUM > ZERO                           
238359                  COMPUTE PV-FORMAT-TMST-TM-HH-NUM =                      
238360                       (PV-HOLD-TMST-TM-HH-NUM - 1)                       
238361                  MOVE PC-9S TO PV-FORMAT-TMST-TM-NN                      
238362                  MOVE PC-59 TO PV-FORMAT-TMST-TM-SS                      
238363                                PV-FORMAT-TMST-TM-MM                      
238364                  MOVE PV-HOLD-TMST-DTE TO                                
238365                                        PV-FORMAT-TMST-DTE                
238366               ELSE                                                       
238367                   PERFORM 6110-DATE-ROUTINE-FOR-TMST                     
238369                   MOVE PC-9S TO PV-FORMAT-TMST-TM-NN                     
238370                   MOVE PC-59 TO PV-FORMAT-TMST-TM-SS                     
238371                                 PV-FORMAT-TMST-TM-MM                     
238372                   MOVE PC-11 TO PV-FORMAT-TMST-TM-HH                     
238380               END-IF                                                     
238381           END-IF                                                         
238382        END-IF                                                            
238383     END-IF.                                                              
238384                                                                          
238385     MOVE PV-FORMAT-TMST TO EP072-SOR-LAST-UPD-TMST.                      
238386                                                                          
238387*3200-EXIT.                                                       23610050
238388 EJECT.                                                           23620009
238390                                                                          
238400*----------------------------------------------------------       23630009
238500* 4000-WRITE-NIGHT-APPLY-REC.                                     23640089
238600*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          23650009
238700*----------------------------------------------------------       23660009
238800 4000-WRITE-NIGHT-APPLY-REC.                                      23670089
238900                                                                  23680009
239000     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      23690009
239100                                                                  23700009
239200     ADD 1           TO PC-CNT-NIGHT-RECS                         23710009
239300                        PC-CNT-ALL-RECS.                          23720009
239400                                                                  23730009
239500*4000-EXIT.                                                       23740009
239600 EJECT.                                                           23750009
239700                                                                  23760009
239800*----------------------------------------------------------       23770009
239900* 4100-WRITE-EMERG-APPLY-REC.                                     23780089
240000*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          23790009
240100*----------------------------------------------------------       23800009
240200 4100-WRITE-EMERG-APPLY-REC.                                      23810089
240300                                                                  23820009
240400     WRITE PROMO-EMERGENCY-RECORD FROM EP072-PROMO-INTFC-RECORD.  23830009
240500                                                                  23840009
240600     ADD 1           TO PC-CNT-EMERG-RECS                         23850009
240700                        PC-CNT-ALL-RECS.                          23860009
240800                                                                  23870074
240900*4100-EXIT.                                                       23880009
241000 EJECT.                                                           23890006
241100                                                                  23900006
241200*----------------------------------------------------------       23910006
241300* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      23920006
241400* CCYYMMDD FORMAT.                                                23930006
241500*----------------------------------------------------------       23940006
241600 6100-DATE-ROUTINE.                                               23950006
241700                                                                  23960006
241800     INITIALIZE DPG51 DPG52 DPG53                                 23970006
241900                DPG54 DPG55 DPG56.                                23980006
242000                                                                  23990006
242100     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      24000006
242200     SET DPG51-INCREMENT-DATE       TO TRUE.                      24010006
242300     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      24020006
242400     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    24030006
242500     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    24040006
242600                                                                  24050006
242700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    24060006
242800                                             DPG54 DPG55 DPG56.   24070006
242900                                                                  24080006
243000     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  24090006
243100       DISPLAY '** ABEND **'                                      24100006
243200       DISPLAY '** PROGRAM = EPKUT120'                            24110008
243300       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        24120006
243400       DISPLAY DPG54-ERROR-MESSAGE                                24130006
243500       MOVE 4019 TO PV-ABEND-CODE                                 24140006
243600       CALL 'ILBOABN0' USING PV-ABEND-CODE                        24150006
243700     END-IF.                                                      24160006
243800                                                                  24170006
243900     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      24180006
244000                                                                  24190006
244100     INITIALIZE DPG51 DPG52 DPG53                                 24200006
244200                DPG54 DPG55 DPG56.                                24210006
244300                                                                  24220006
244400     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      24230006
244500     SET DPG51-DECREMENT-DATE       TO TRUE.                      24240006
244600     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      24250006
244700     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    24260006
244800     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    24270006
244900                                                                  24280006
245000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    24290006
245100                                             DPG54 DPG55 DPG56.   24300006
245200                                                                  24310006
245300     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  24320006
245400       DISPLAY '** ABEND **'                                      24330006
245500       DISPLAY '** PROGRAM = EPKUT120'                            24340008
245600       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        24350006
245700       DISPLAY DPG54-ERROR-MESSAGE                                24360006
245800       MOVE 4019 TO PV-ABEND-CODE                                 24370006
245900       CALL 'ILBOABN0' USING PV-ABEND-CODE                        24380006
246000     END-IF.                                                      24390006
246100                                                                  24400006
246200     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  24410006
246300                                                                  24420006
246400*6100-EXIT.                                                       24430006
246500 EJECT.                                                           24440006
246600                                                                  24450006
246610*----------------------------------------------------------       23910006
246620* DATE ROUTINE TO SUBTRACT 1 DAY FROM LAST UPD TMST.              23920006
246640*----------------------------------------------------------       23940006
246650 6110-DATE-ROUTINE-FOR-TMST.                                      23950006
246710                                                                  24190006
246711     INITIALIZE DPG51 DPG52 DPG53                                 24200006
246712                DPG54 DPG55 DPG56.                                24210006
246713                                                                  24220006
246714     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      24230006
246715     SET DPG51-DECREMENT-DATE       TO TRUE.                      24240006
246716     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      24250006
246717     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    24260006
246718     MOVE PV-HOLD-TMST-DTE          TO DPG52-DB2-ISO-DATE-FMT.    24270006
246720                                                                  24280006
246721     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    24290006
246722                                             DPG54 DPG55 DPG56.   24300006
246723                                                                  24310006
246724     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  24320006
246725       DISPLAY '** ABEND **'                                      24330006
246726       DISPLAY '** PROGRAM = EPKUT120'                            24340008
246727       DISPLAY 'DATE = ' EP072-SOR-LAST-UPD-TMST                  24350006
246728       DISPLAY DPG54-ERROR-MESSAGE                                24360006
246729       MOVE 4019 TO PV-ABEND-CODE                                 24370006
246730       CALL 'ILBOABN0' USING PV-ABEND-CODE                        24380006
246731     END-IF.                                                      24390006
246732                                                                  24400006
246733     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-FORMAT-TMST-DTE.        24410006
246734                                                                  24420006
246735*6110-EXIT.                                                       24430006
246736 EJECT.                                                           24440006
246737                                                                  24450006
246740*----------------------------------------------------------       24460006
246800* 9900-SQL-ABEND-ROUTINE.                                         24470006
246900*     SQL ABEND ROUTINE.                                          24480006
247000*----------------------------------------------------------       24490006
247100 9900-SQL-ABEND-ROUTINE.                                          24500006
247200                                                                  24510006
247300     DISPLAY '** ABEND     **'.                                   24520006
247400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        24530006
247500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              24540006
247600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               24550006
247700                                                                  24560006
247800     COPY DPPD004.                                                24570006
247900     SET ABEND-4013-DB2-ERROR TO TRUE.                            24580006
248000     CALL 'ILBOABN0' USING ABEND-CODE.                            24590006
248100                                                                  24600006
248200*9900-EXIT.                                                       24610006
248300 EJECT.                                                           24620006
248400                                                                  24630006
248500*----------------------------------------------------------       24640006
248600* 9999-WRAPUP.                                                    24650006
248700*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      24660006
248800*     ANY DATA FROM THE PROGRAM.                                  24670006
248900*----------------------------------------------------------       24680006
249000 9999-WRAPUP.                                                     24690006
249100                                                                  24700006
249200     CLOSE CONTROL-CARD-PGM-LAST-RUN-DTE.                         24710006
249300     OPEN OUTPUT CONTROL-CARD-PGM-LAST-RUN-DTE.                   24720006
249400                                                                  24730006
249500     MOVE PV-CURRENT-SYSTEM-TMST TO EP109-CC-STRGP-CUTOFF-TMST    24740008
249600     WRITE CNTRL-CARD-PGM-LAST-RUN-REC                            24750006
249700                                   FROM EP109-CC-CONTROL-CARD.    24760008
249800                                                                  24770006
249900     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            24780006
250000           CONTROL-CARD-FUTRE-CORR-DTE                            24790006
250100           CONTROL-CARD-PGM-LAST-RUN-DTE                          24800006
250200           CONTROL-CARD-CRIT-EFF-DTE                              24810006
250300           PROMO-NIGHT-FILE                                       24820006
250400           PROMO-EMERGENCY-FILE.                                  24830006
250500                                                                  24840006
250600     DISPLAY ' '.                                                 24850006
250700     DISPLAY '*********************************************'.     24860006
250800     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            24870006
250900     DISPLAY '*********************************************'.     24880006
251000     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN: ' PC-CNT-NIGHT-RECS.  24890006
251100     DISPLAY 'NUMBER OF EMERG. RECS WRITTEN: ' PC-CNT-EMERG-RECS. 24900006
251200     DISPLAY 'NUMBER OF RECS FROM RMS QUERY: ' PC-CNT-RMS-RECS.   24910009
251300     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.24920006
251400     DISPLAY 'NUMBER OF RECS FROM OVRD QUERY:' PC-CNT-OVRRDE-RECS.24930009
251500     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                24940006
251600     DISPLAY '*********************************************'.     24950006
251700                                                                  24960006
251800*9999-EXIT.                                                       24970006
251900 EJECT.                                                           24980006
252000                                                                  24990006
