000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.                DPKCS055.                             00040000
000500 AUTHOR.                    CHERI MASTEL.                         00050000
000600 INSTALLATION.              KOHLS DEPARTMENT STORES.              00060000
000700 DATE-WRITTEN.              DECEMBER 1996.                        00070000
000800 DATE-COMPILED.                                                   00080000
000900 SKIP2                                                            00090000
001000******************************************************************00100000
001100*  CICS PROGRAM - DPKCS055                                       *00110000
001200*  TRANSACTION ID. - Z055                                        *00120000
001300*                                                                *00130000
001400*                  COPY MNEMONIC PROGRAM                         *00140000
001500*                                                                *00150000
001600*  THIS TRANSACTION PROCESSES MNEMONIC COPY REQUESTS, ADDING ROWS*00160000
001700*  TO THE TMNEMONIC AND TCICSROUTE DB2 TABLES.                   *00170000
001800*  THESE TABLES ARE USED TO CONTROL NAVIGATION WITHIN CICS.      *00180000
001900*                                                                *00190000
002000*  THIS CODE IS MODELED AFTER DPKCS055 - ADD MNEMONIC.           *00200000
002100*                                                                *00210000
002200*  PF KEY PROCESSING:                                            *00220000
002300*         ENTER - EDIT SCREEN                                    *00230000
002400*         PA2   - TOGGLE FUNCTION KEY LINES                      *00240000
002500*         PF15  - ADD TO DATABASE                                *00250000
002600*         CLEAR - RESET SCREEN TO LAST DISPLAY                   *00260000
002700*                                                                *00270000
002800*  NAVIGATION PF KEY PROCESSING:                                 *00280000
002900*         PF15  - COPY; ADD ROWS TO DATABASE                     *00290000
003000*         *SEE MNEMONIC FILE FOR NAVIGATION PF KEY DEFINITIONS.  *00300000
003100*                                                                *00310000
003200******************************************************************00320000
003300 SKIP2                                                            00330000
003400******************************************************************00340000
003500 ENVIRONMENT DIVISION.                                            00350000
003600******************************************************************00360000
003700 EJECT                                                            00370000
003800******************************************************************00380000
003900 DATA DIVISION.                                                   00390000
004000******************************************************************00400000
004100 SKIP2                                                            00410000
004200 WORKING-STORAGE SECTION.                                         00420000
004300 SKIP1                                                            00430000
004400*********************                                             00440000
004500* PROGRAM CONSTANTS *                                             00450000
004600*********************                                             00460000
004700 SKIP1                                                            00470000
004800 01  PROGRAM-CONSTANT-AREA.                                       00480000
004900     05  PC-MAXIMUM-COMMAREA-LENGTH                               00490000
005000                                 PIC S9(4)      VALUE +4072       00500000
005100                                                COMP SYNC.        00510000
005200     05  PC-CURRENT-MAP-NAME     PIC X(8)       VALUE 'DP055A  '. 00520000
005300     05  PC-CURRENT-MAPSET-NAME  PIC X(8)       VALUE 'DPKM055 '. 00530000
005400     05  PC-CURRENT-PROGRAM-NAME PIC X(8)       VALUE 'DPKCS055'. 00540000
005500     05  PC-MRO-PROGRAM          PIC X(8)       VALUE 'DFHCRP  '. 00550000
005600     05  PC-SPACES               PIC X(8)       VALUE SPACES.     00560000
005700     05  PC-NAVIGATOR-TRAN-ID    PIC X(4)       VALUE 'Z008'.     00570000
005800     05  PC-MENU-TRAN-ID         PIC X(4)       VALUE 'MENU'.     00580000
005900     05  PC-Z007                 PIC X(4)       VALUE 'Z007'.     00590000
006000     05  PC-Y                    PIC X(1)       VALUE 'Y'.        00600000
006100     05  PC-P-DEFAULT-TO-PROD    PIC X(1)       VALUE 'P'.        00610000
006200     05  PC-L                    PIC X(1)       VALUE 'L'.        00620000
006300     05  PC-LEAVE-SYSTEM-LENGTH  PIC S9(4)      VALUE +80         00630000
006400                                                COMP SYNC.        00640000
006500     05  PC-MAX-APPL-COMM-LENGTH PIC 9(4)       VALUE 2865.       00650000
006600     05  PC-MENU-COMMAREA-LEN    PIC 9(4)       VALUE 1845.       00660000
006700     05  PC-MIN-APPL-COMM-LENGTH PIC 9(4)       VALUE 0003.       00670000
006800     05  PC-TRANSACTION-ENABLED  PIC S9(8)      COMP              00680000
006900                                                VALUE 23.         00690000
007000     05  PC-TRANSACTION-DISABLED PIC S9(8)      COMP              00700000
007100                                                VALUE 24.         00710000
007200     05  PC-TRANSACTION-DISABLING                                 00720000
007300                                 PIC S9(8)      COMP              00730000
007400                                                VALUE 25.         00740000
007500     05  PC-GO-TO-KEY            PIC X(01)      VALUE '1'.        00750007
007600     05  PC-LOCAL-GO-KEY         PIC X(01)      VALUE 'B'.        00760007
007700     05  PC-TSYMSG-00007         PIC 9(5)       VALUE 00007.      00770007
007800     05  PC-TSYMSG-00034         PIC 9(5)       VALUE 00034.      00780007
007900     05  PC-TSYMSG-00117         PIC 9(5)       VALUE 00117.      00790006
008000     05  PC-TSYMSG-00148         PIC 9(5)       VALUE 00148.      00800002
008100     05  PC-TSYMSG-00224         PIC 9(5)       VALUE 00224.      00810000
008200     05  PC-TSYMSG-00261         PIC 9(5)       VALUE 00261.      00810000
008300     05  PC-TSYMSG-01481         PIC 9(5)       VALUE 01481.      00820005
008400 SKIP2                                                            00830000
008500*********************                                             00840000
008600* PROGRAM VARIABLES *                                             00850000
008700*********************                                             00860000
008800 SKIP1                                                            00870000
008900 01  PROGRAM-VARIABLE-AREA.                                       00880000
009000     05  PV-CICS-RESPONSE        PIC S9(8)      VALUE ZERO        00890000
009100                                                COMP SYNC.        00900000
009200     05  PV-TERMINAL             PIC X(4)       VALUE SPACES.     00910000
009300     05  PV-LEAVE-SYSTEM-MSG     PIC X(80)      VALUE SPACES.     00920000
009400     05  PV-HOLD-MESSAGE         PIC X(78)      VALUE SPACES.     00930000
009500     05  PV-HOLD-SEVERITY-IND    PIC X(1)       VALUE SPACES.     00940000
009600     05  PV-MNEMONIC             PIC X(8)       VALUE SPACES.     00950000
009700     05  PV-COMM-LENGTH-ALPHA    PIC X(4).                        00960000
009800     05  PV-COMM-LENGTH-NUMERIC  REDEFINES                        00970000
009900         PV-COMM-LENGTH-ALPHA    PIC 9(4).                        00980000
010000     05  PV-CMNT-TXT.                                             00990004
010100         10  FILLER              PIC X(12)      VALUE             01000004
010200                                                'COPIED FROM '.   01010004
010300         10  PV-CMNT-FROM-MNEM   PIC X(8)       VALUE SPACES.     01020007
010400                                                                  01030004
010500********************                                              01040000
010600* PROGRAM SWITCHES *                                              01050000
010700********************                                              01060000
010800 SKIP1                                                            01070000
010900 01  PROGRAM-SWITCHES.                                            01080000
011000     05  PS-MAP-SEND-TYPE        PIC X          VALUE '1'.        01090000
011100         88  PS-SEND-MAP-N-DATA-FRSET           VALUE '1'.        01100000
011200         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN     VALUE '2'.        01110000
011300         88  PS-SEND-DATA-ONLY-FRSET            VALUE '3'.        01120000
011400         88  PS-SEND-DATA-ONLY                  VALUE '4'.        01130000
011500         88  PS-SEND-DATA-ONLY-ERASEAUP         VALUE '5'.        01140000
011600         88  PS-SEND-MAP-ONLY-FRSET             VALUE '6'.        01150000
011700     05  PS-LOCAL-FUNCTION-KEY-IND                                01160000
011800                                 PIC X          VALUE 'N'.        01170000
011900         88  PS-LOCAL-FUNCTION-NO               VALUE 'N'.        01180000
012000         88  PS-LOCAL-FUNCTION-YES              VALUE 'Y'.        01190000
012100     05  PS-ROW-FOUND-IND        PIC X          VALUE 'N'.        01200000
012200         88  PS-ROW-FOUND-NO                    VALUE 'N'.        01210000
012300         88  PS-ROW-FOUND-YES                   VALUE 'Y'.        01220000
012400     05  PS-EDIT-ERROR-SW        PIC X          VALUE 'N'.        01230000
012500         88  PS-EDIT-ERROR-NO                   VALUE 'N'.        01240000
012600         88  PS-EDIT-ERROR-YES                  VALUE 'Y'.        01250000
012700     05  PS-NEW-SCREEN-SENT-SW   PIC X          VALUE 'N'.        01260000
012800         88  PS-NEW-SCREEN-SENT-NO              VALUE 'N'.        01270000
012900         88  PS-NEW-SCREEN-SENT-YES             VALUE 'Y'.        01280000
013000 EJECT                                                            01290000
013100******************                                                01300000
013200* ERROR MESSAGES *                                                01310000
013300******************                                                01320000
013400 SKIP1                                                            01330000
013500 01  ERROR-MESSAGES.                                              01340000
013600     05  TCICSRTE-FOUND-MSG      PIC X(78)      VALUE             01350000
013700         'MNEMONIC ALREADY ON TCICSRTE DATABASE                   01360000
013800-        '                      '.                                01370000
013900     05  NOT-CICS-TRANID-MSG     PIC X(78)      VALUE             01380000
014000         'THE TRANSACTION IS NOT DEFINED TO CICS                  01390000
014100-        '                      '.                                01400000
014200     05  NOT-NAVG-TRANID-MSG     PIC X(78)      VALUE             01410000
014300         'THE TRAN ID ENTERED MAY NOT BE Z008 OR MENU             01420000
014400-        '                      '.                                01430000
014500     05  ENTER-PROGRAM-MSG       PIC X(78)      VALUE             01440000
014600         'NNNNN-S-THIS IS AN MRO TRANSACTION.  PLEASE ENTER THE PR01450000
014700-        'OGRAM NAME.           '.                                01460000
014800     05  INVALID-NEXT-APPL-MSG   PIC X(78)      VALUE             01470000
014900         'NEXT APPLICATION CODE INVALID                           01480000
015000-        '                      '.                                01490000
015100     05  INVALID-LABEL-MSG       PIC X(78)      VALUE             01500000
015200         'NNNNN-E-MNEMONIC ALREADY EXISTS AS A LABEL FOR MNEMONIC 01510000
015300-        '                      '.                                01520000
015400     05  INVALID-LABEL-MSG-RDF  REDEFINES  INVALID-LABEL-MSG.     01530000
015500         10  FILLER              PIC X(57).                       01540000
015600         10  INVALID-LABEL-MNEMONIC                               01550000
015700                                 PIC X(8).                        01560000
015800 EJECT                                                            01570000
015900**************************                                        01580000
016000* DB2 COMMUNICATION AREA *                                        01590000
016100**************************                                        01600000
016200 SKIP1                                                            01610000
016300     EXEC SQL                                                     01620000
016400         INCLUDE SQLCA                                            01630000
016500     END-EXEC.                                                    01640000
016600 SKIP2                                                            01650000
016700***********************************                               01660000
016800* DB2 SQL RETURN CODE DEFINITIONS *                               01670000
016900*    USING '88' LEVEL             *                               01680000
017000***********************************                               01690000
017100 SKIP1                                                            01700000
017200 01  SQL-RETURN-CODE             PIC S9(9)      COMP-4.           01710000
017300     88  SQL-SUCCESSFUL                         VALUE +0.         01720000
017400     88  SQL-ROW-FOUND                          VALUE +0.         01730000
017500     88  SQL-ROW-NOT-FOUND                      VALUE +100.       01740000
017600     88  SQL-WARNING                            VALUE +100        01750000
017700                                                      +558        01760000
017800                                                      +560.       01770000
017900     88  SQL-DUPLICATE-ROW                      VALUE -803.       01780000
018000     88  SQL-MORE-THAN-1-ROW                    VALUE -811.       01790000
018100     88  SQL-NOT-AVAILABLE                      VALUE -911.       01800000
018200     88  SQL-DB2-DOWN                           VALUE -923.       01810000
018300     88  SQL-NULL-VALUE                         VALUE -305.       01820000
018400     88  SQL-DEPENDENT-ROW                      VALUE -532.       01830000
018500 EJECT                                                            01840000
018600**************************************                            01850000
018700* STANDARD ATTENTION IDENTIFIER LIST *                            01860000
018800**************************************                            01870000
018900 SKIP1                                                            01880000
019000     COPY DFHAID.                                                 01890000
019100 EJECT                                                            01900000
019200**************************************************************    01910000
019300* SYSTEM MESSAGE FILE RECORD LAYOUT                          *    01920000
019400**************************************************************    01930000
019500     COPY DPRD507I.                                               01940000
019600 EJECT                                                            01950000
019700*---------------------------------------------------------------* 01960000
019800*    WORKING STORAGE INCLUDE MEMBER USED WITH INCLUDE DPPD005   * 01970000
019900*---------------------------------------------------------------* 01980000
020000     COPY DPWS006.                                                01990000
020100 EJECT                                                            02000000
020200**************************************************************    02010000
020300* WORKING-STORAGE LAYOUT USED TO LOAD THE FUNCTION KEY LINES *    02020000
020400**************************************************************    02030000
020500     COPY DPWS009.                                                02040000
020600 EJECT                                                            02050000
020700***************************                                       02060000
020800* COMMON ABEND DATA AREAS *                                       02070000
020900***************************                                       02080000
021000 SKIP1                                                            02090000
021100     COPY DPWS013.                                                02100000
021200 EJECT                                                            02110000
021300*********************************************************         02120000
021400* KOHL'S DEFINED:                                       *         02130000
021500* STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST *         02140000
021600*********************************************************         02150000
021700 SKIP1                                                            02160000
021800     COPY DPWS015.                                                02170000
021900 EJECT                                                            02180000
022000**************************************                            02190000
022100* KOHL'S:                            *                            02200000
022200* STANDARD ATTENTION IDENTIFIER LIST *                            02210000
022300**************************************                            02220000
022400 SKIP1                                                            02230000
022500     COPY DPWS016.                                                02240000
022600 EJECT                                                            02250000
022700***************************************************************   02260000
022800* WORKING-STORAGE LAYOUT USED TO GET THE SYSTEM DATE AND TIME *   02270000
022900***************************************************************   02280000
023000     COPY DPWS017.                                                02290000
023100 EJECT                                                            02300000
023200*******************************                                   02310000
023300* STANDARD COMMUNICATION AREA *                                   02320000
023400*******************************                                   02330000
023500 SKIP1                                                            02340000
023600     COPY DPWS020.                                                02350000
023700     05  FILLER                  REDEFINES                        02360000
023800         DP020-VARIABLE-COMMAREA.                                 02370000
023900***************************************                           02380000
024000* CICSARC INTER APPLICATION DATA AREA *                           02390000
024100***************************************                           02400000
024200         10  INTER-APPL-COMM-AREA                                 02410000
024300                                 PIC X(200).                      02420000
024400     COPY DPWS050.                                                02430000
024500     COPY DPWS051.                                                02440000
024600     COPY DPWS052.                                                02450000
024700     COPY DPWS055.                                                02460000
024800*******************************************                       02470000
024900* DPKCS055 APPLICATION SPECIFIC COMM AREA *                       02480000
025000*******************************************                       02490000
025100         10  DP055-APPL-SPECIFIC-COMM-AREA.                       02500000
025200             15  FILLER          PIC X(02).                       02510000
025300             15  DP055-CURRENT-SCREEN-IMAGE.                      02520000
025400                 20  DP055-SCREEN-FROM-MNEMONIC                   02530002
025500                                 PIC X(8).                        02540000
025600                 20  DP055-SCREEN-TO-MNEMONIC                     02550002
025700                                 PIC X(8).                        02560002
025800                 20  DP055-FROM-PROGRAM                           02570002
025900                                 PIC X(8).                        02580000
026000                 20  DP055-FROM-TRAN-ID                           02590002
026100                                 PIC X(4).                        02600000
026200                 20  DP055-FROM-MNEMONIC-TITLE                    02610002
026300                                 PIC X(30).                       02620000
026400                 20  DP055-FROM-AVAILABIL-IND                     02630002
026500                                 PIC X.                           02640000
026600                 20  DP055-FROM-COMMAREA-FORMAT                   02650002
026700                                 PIC X.                           02660000
026800                 20  DP055-FROM-SAVE-COMM-IND                     02670002
026900                                 PIC X.                           02680000
027000                 20  DP055-FROM-SAVE-COMM-LENGTH                  02690002
027100                                 PIC X(4).                        02700000
027200                 20  DP055-FROM-GLOBAL-ACCESS                     02710002
027300                                 PIC X(1).                        02720000
027400                 20  DP055-FROM-TYPE-CODE                         02730002
027500                                 PIC X(1).                        02740000
027600                 20  DP055-FROM-DB2-PKG-CDE                       02750002
027700                                 PIC X(1).                        02760000
027800                 20  DP055-FROM-CMNT-TXT                          02770002
027900                                 PIC X(40).                       02780000
028000             15  DP055-TRAN-DEFINED-CICS                          02790000
028100                                 PIC X.                           02800000
028200             15  DP055-SELECT-MAINT-RESULT                        02810000
028300                                 PIC X.                           02820000
028400                 88  DP055-RESULT-IS-CREATE      VALUE '1'.       02830000
028500                 88  DP055-RESULT-IS-UPDATE      VALUE '2'.       02840000
028600                 88  DP055-RESULT-IS-DELETE      VALUE '3'.       02850000
028700                 88  DP055-RESULT-IS-READ        VALUE '4'.       02860000
028800                 88  DP055-RESULT-IS-ERROR       VALUE '5'.       02870000
028900             15  DP055-INTER-APPL-COMMAREA.                       02880000
029000                 20  DP055-INTER-APPL-FORMAT-CODE                 02890000
029100                                 PIC X(04).                       02900000
029200                 20  DP055-INTER-APPL-ACKNLG-CODE                 02910000
029300                                 PIC X(04).                       02920000
029400                 20  DP055-MITM-AREA.                             02930000
029500                     25  DP055-MITM-MENU-NAME                     02940000
029600                                 PIC X(08).                       02950000
029700                     25  DP055-MITM-ITEM-MNEMONIC                 02960000
029800                                 PIC X(08).                       02970000
029900                     25  DP055-MITM-SEQUENCE-NUMBER               02980000
030000                                 PIC S9(4)      COMP.             02990000
030100                     25  DP055-MITM-TRAN-ID                       03000000
030200                                 PIC X(04).                       03010000
030300                     25  DP055-MITM-TITLE                         03020000
030400                                 PIC X(30).                       03030000
030500                     25  DP055-MITM-ITEM-TITLE                    03040000
030600                                 PIC X(30).                       03050000
030700                     25  DP055-MITM-MAINTENANCE-RESULT            03060000
030800                                 PIC X.                           03070000
030900                         88  DP055-MITM-RESULT-IS-CREATE          03080000
031000                                 VALUE '1'.                       03090000
031100                         88  DP055-MITM-RESULT-IS-UPDATE          03100000
031200                                 VALUE '2'.                       03110000
031300                         88  DP055-MITM-RESULT-IS-DELETE          03120000
031400                                 VALUE '3'.                       03130000
031500                         88  DP055-MITM-RESULT-IS-READ            03140000
031600                                 VALUE '4'.                       03150000
031700                         88  DP055-MITM-RESULT-IS-ERROR           03160000
031800                                 VALUE '5'.                       03170000
031900                     25  FILLER  PIC X(109).                      03180000
032000                 20  DP055-FKEY-AREA                              03190000
032100                                 REDEFINES                        03200000
032200                     DP055-MITM-AREA.                             03210000
032300                     25  DP055-FKEY-MNEMONIC                      03220000
032400                                 PIC X(08).                       03230000
032500                     25  DP055-FKEY-FUNCTION-KEY                  03240000
032600                                 PIC S9(04)     COMP.             03250000
032700                     25  DP055-FKEY-FUNCT-KEY-MNEMONIC            03260000
032800                                 PIC X(08).                       03270000
032900                     25  DP055-FKEY-MAINTENANCE-RESULT            03280000
033000                                 PIC X.                           03290000
033100                         88  DP055-FKEY-RESULT-IS-CREATE          03300000
033200                                 VALUE '1'.                       03310000
033300                         88  DP055-FKEY-RESULT-IS-UPDATE          03320000
033400                                 VALUE '2'.                       03330000
033500                         88  DP055-FKEY-RESULT-IS-DELETE          03340000
033600                                 VALUE '3'.                       03350000
033700                         88  DP055-FKEY-RESULT-IS-READ            03360000
033800                                 VALUE '4'.                       03370000
033900                         88  DP055-FKEY-RESULT-IS-ERROR           03380000
034000                                 VALUE '5'.                       03390000
034100                     25  FILLER  PIC X(173).                      03400000
034200                 20  DP055-CMIA-AREA                              03410000
034300                                 REDEFINES                        03420000
034400                     DP055-FKEY-AREA.                             03430000
034500                     25  DP055-CMIA-MNEMONIC                      03440000
034600                                 PIC X(08).                       03450000
034700                     25  DP055-CMIA-TRAN-ID                       03460000
034800                                 PIC X(04).                       03470000
034900                     25  DP055-CMIA-TITLE                         03480000
035000                                 PIC X(30).                       03490000
035100                     25  DP055-CMIA-MAINTENANCE-RESULT            03500000
035200                                 PIC X.                           03510000
035300                         88  DP055-CMIA-RESULT-IS-CREATE          03520000
035400                                 VALUE '1'.                       03530000
035500                         88  DP055-CMIA-RESULT-IS-UPDATE          03540000
035600                                 VALUE '2'.                       03550000
035700                         88  DP055-CMIA-RESULT-IS-DELETE          03560000
035800                                 VALUE '3'.                       03570000
035900                         88  DP055-CMIA-RESULT-IS-READ            03580000
036000                                 VALUE '4'.                       03590000
036100                         88  DP055-CMIA-RESULT-IS-ERROR           03600000
036200                                 VALUE '5'.                       03610000
036300                     25  FILLER  PIC X(149).                      03620000
036400             15  DP055-ENTER-PROGRAM-SW         PIC X.            03630000
036500                 88  DP055-ENTER-PROGRAM        VALUE 'Y'.        03640000
036600                 88  DP055-DONT-ENTER-PROGRAM   VALUE 'N'.        03650000
036700             15  DP055-TIMESTAMP     PIC X(26).                   03660000
036800             15  DP055-LAST-MNEMONIC PIC X(08).                   03670000
036900             15  DP055-SAVE-INTER-APPL-COMMAREA                   03680000
037000                                     PIC X(200).                  03690000
037100 EJECT                                                            03700000
037200**************************************************************    03710000
037300* PARAMETER LIST USED TO CALL THE 'TRANSLATE AID' SUBROUTINE *    03720000
037400**************************************************************    03730000
037500     COPY DPWS045.                                                03740000
037600  EJECT                                                           03750000
037700********************************                                  03760000
037800* DSECT FOR THE DPKM055 MAPSET *                                  03770000
037900********************************                                  03780000
038000 SKIP1                                                            03790000
038100     COPY DPKM055.                                                03800000
038200 SKIP2                                                            03810000
038300************************************************                  03820000
038400* REDEFINES OF DP055AI MAPSET OF DETAIL FIELDS *                  03830000
038500************************************************                  03840000
038600 01  MD-MAP-DATA-AREA            REDEFINES                        03850000
038700     DP055AO                     PIC X(1200).                     03860000
038800 EJECT                                                            03870000
038900******************************                                    03880000
039000* DCLGEN FOR TABLE TMNEMONIC *                                    03890000
039100******************************                                    03900000
039200                                                                  03910000
039300     EXEC SQL                                                     03920000
039400         INCLUDE TMNMNC                                           03930000
039500     END-EXEC.                                                    03940000
039600                                                                  03950000
039700*******************************                                   04040000
039800* DCLGEN FOR TABLE TCICSRTE   *                                   04050000
039900*******************************                                   04060000
040000                                                                  04070000
040100     EXEC SQL                                                     04080000
040200         INCLUDE TCICSRTE                                         04090000
040300     END-EXEC.                                                    04100000
040400                                                                  04110000
040500************************************                              04120000
040600* CURSOR FOR ROUTE ALT LABEL CHECK *                              04130000
040700************************************                              04140000
040800                                                                  04150000
040900     EXEC SQL DECLARE LABEL-CURSOR CURSOR FOR                     04160000
041000         SELECT                                                   04170000
041100                 MNEMONIC_CODE                                    04180000
041200         FROM                                                     04190000
041300                 TCICSROUTE                                       04200000
041400         WHERE                                                    04210000
041500                 FUNC_KEY_LBL_NAME   =  :TMNEMONIC-MNEMONIC-CODE  04220000
041600         ORDER BY                                                 04170000
041700                 MNEMONIC_CODE                                    04180000
041800     END-EXEC.                                                    04230000
041900                                                                  04240000
042000********************************************************          04250000
042100* CURSOR FOR COPYING PFKEY DEFINITIONS FROM TCICSROUTE *          04260000
042200********************************************************          04270000
042300                                                                  04280000
042400     EXEC SQL DECLARE PFKEYS-CURSOR CURSOR FOR                          00
042500         SELECT                                                   04300000
042600                 MNEMONIC_CODE                                    04350000
042700               , AID_SEQUENCE_NMBR                                04310000
042800               , DEST_MNEMONIC_CODE                               04310000
042900               , ACTION_CODE                                      04310000
043000               , LAST_UPDATE_TMESTP                               04320000
043100               , ROUTE_STACK_INDCT                                04330000
043200               , FUNC_KEY_LBL_NAME                                04340000
043300               , IN_APLCTN_COMM_CDE                               04340000
043400               , FUNC_KY_DISPN_IND                                04340000
043500         FROM                                                     04360000
043600                 TCICSROUTE                                       04370000
043700         WHERE                                                    04380000
043800                 MNEMONIC_CODE  =  :DP055-SCREEN-FROM-MNEMONIC          02
043900         ORDER BY                                                 04430000
044000                 AID_SEQUENCE_NMBR                                04440000
044100     END-EXEC.                                                    04450000
044200 EJECT                                                            04460000
044300 LINKAGE SECTION.                                                 04470000
044400 SKIP2                                                            04480000
044500 01  DFHCOMMAREA.                                                 04490000
044600     05  FILLER                         OCCURS  1 TO 4072 TIMES   04500000
044700                                        DEPENDING ON EIBCALEN.    04510000
044800         10  FILLER                     PIC X.                    04520000
044900 EJECT                                                            04530000
045000 PROCEDURE DIVISION.                                              04540000
045100                                                                  04550000
045200******************************************************************04560000
045300* A000-COPY-AND-ADD-MNEMONIC                                     *04570000
045400* MAINLINE SECTION.                                              *04580000
045500******************************************************************04590000
045600                                                                  04600000
045700 A000-COPY-AND-ADD-MNEMONIC.                                      04610000
045800                                                                  04620000
045900     PERFORM DP015-0000-CHECK-COMMAREA.                           04630000
046000                                                                  04640000
046100***************************************************************** 04650000
046200* THE VARIABLE 'RETURN-WITH-TRAN-ID' WILL BE SET TO 'Y' IN      * 04660000
046300* U13-CHECK-COMMAREA IF A BAD COMMAREA OR NO COMMAREA WAS       * 04670000
046400* ENCOUNTERED. IF THAT HAPPENS U13-CHECK-COMMAREA STARTS THE    * 04680000
046500* NAVIGATION TRANSACTION AND SETS THIS INDICATOR TO 'Y'. CHECK- * 04690000
046600* ING FOR A 'Y' HERE WILL PREVENT THIS TRANSACTION FROM CONTINU-* 04700000
046700* ING TO EXECUTE IF THE NAVIGATOR HAS BEEN REQUESTED TO START.  * 04710000
046800***************************************************************** 04720000
046900                                                                  04730000
047000     IF  DP020-SRC-RETURN-W-TRAN-ID                               04740000
047100         PERFORM A050-CONTROL-PROCESSING                          04750000
047200     END-IF.                                                      04760000
047300                                                                  04770000
047400     PERFORM DP003-0000-RETURN-TO-CICS.                           04780000
047500                                                                  04790000
047600     GOBACK.                                                      04800000
047700 EJECT                                                            04810000
047800******************************************************************04820000
047900* A050-CONTROL-PROCESSING                                        *04830000
048000******************************************************************04840000
048100                                                                  04850000
048200 A050-CONTROL-PROCESSING.                                         04860000
048300                                                                  04870000
048400     MOVE SPACES               TO  DCLTCICSROUTE.                 04880000
048500                                                                  04890000
048600     EVALUATE TRUE                                                04900000
048700                                                                  04910000
048800         WHEN DP020-NEXT-ACT-INITIAL                              04920000
048900             SET PS-SEND-MAP-N-DATA-FRSET                         04930000
049000                                 TO TRUE                          04940000
049100             INITIALIZE DP055-APPL-SPECIFIC-COMM-AREA             04950000
049200             PERFORM A200-PROCESS-INTER-APPL-COMM                 04960000
049300             PERFORM A250-SEND-INITIAL-SCREEN                     04970000
049400                                                                  04980000
049500         WHEN DP020-NEXT-ACT-RETURN                               04990000
049600             SET PS-SEND-MAP-N-DATA-FRSET                         05000000
049700                                 TO TRUE                          05010000
049800             PERFORM A200-PROCESS-INTER-APPL-COMM                 05020000
049900             IF  (DP055-SCREEN-FROM-MNEMONIC NOT = SPACES   AND   05030007
050000                                                  LOW-VALUES)     05040007
050100             AND (DP055-SCREEN-TO-MNEMONIC   NOT = SPACES   AND   05050007
050200                                                  LOW-VALUES)     05060007
050300                 PERFORM A450-EDIT-SCREEN                         05070000
050400             ELSE                                                 05080000
050500                 PERFORM A460-RESET-ATTRIBUTES                    05090000
050600                 MOVE -1         TO AMNEM1L                       05100003
050700             END-IF                                               05110000
050800             PERFORM A470-SET-COMMAND-ATTRIBUTES                  05120000
050900             PERFORM A550-DISPLAY-PANEL                           05130000
051000                                                                  05140000
051100         WHEN DP020-NEXT-ACT-ERROR                                05150000
051200             SET PS-SEND-DATA-ONLY-FRSET                          05160000
051300                                 TO TRUE                          05170000
051400             PERFORM A470-SET-COMMAND-ATTRIBUTES                  05180000
051500             PERFORM A200-PROCESS-INTER-APPL-COMM                 05190000
051600             MOVE PV-HOLD-MESSAGE                                 05200000
051700                                 TO  DP020-MSG-MESSAGE            05210000
051800             MOVE PV-HOLD-SEVERITY-IND                            05220000
051900                                 TO  DP020-MSG-SEVERITY-IND       05230000
052000             PERFORM A550-DISPLAY-PANEL                           05240000
052100                                                                  05250000
052200         WHEN DP020-NEXT-ACT-READ-MAP                             05260000
052300             SET PS-SEND-DATA-ONLY-FRSET                          05270000
052400                                 TO TRUE                          05280000
052500             PERFORM A470-SET-COMMAND-ATTRIBUTES                  05290000
052600             PERFORM A100-PROCESS-MAP                             05300000
052700                                                                  05310000
052800         WHEN OTHER                                               05320000
052900             SET  DP013-OTHER-ABEND                               05330000
053000                                 TO TRUE                          05340000
053100             MOVE 'A050-CONTROL-PROCESSING       '                05350000
053200                                 TO DP013-PARAGRAPH               05360000
053300             MOVE INVALID-NEXT-APPL-MSG                           05370000
053400                                 TO DP013-MESSAGE-TEXT (1)        05380000
053500             MOVE DP020-NEXT-APPL-ACTIVITY                        05390000
053600                                 TO DP013-MESSAGE-TEXT (2)        05400000
053700             PERFORM DP013-0000-PROCESS-ABEND                     05410000
053800                                                                  05420000
053900     END-EVALUATE.                                                05430000
054000 EJECT                                                            05440000
054100******************************************************************05450000
054200* A100-PROCESS-MAP                                               *05460000
054300******************************************************************05470000
054400                                                                  05480000
054500 A100-PROCESS-MAP.                                                05490000
054600                                                                  05500000
054700     IF  EIBAID  =  DFHPA2                                        05510000
054800                                                                  05520000
054900* PA2 KEY  -  CHANGE PFKEYS DISPLAYED *                           05530000
055000                                                                  05540000
055100         MOVE -1                 TO AMNEM1L                       05550003
055200         MOVE DP016-PA2          TO DP020-SRC-AID                 05560000
055300         PERFORM DP009-0000-LOAD-FK-LINES                         05570000
055400         PERFORM DP018-0000-GET-CURR-TIME                         05580000
055500         SET PS-SEND-DATA-ONLY                                    05590000
055600                                 TO TRUE                          05600000
055700         PERFORM DP008-0000-WRITE-PANEL                           05610000
055800     ELSE                                                         05620000
055900         IF  EIBAID  =  DFHCLEAR                                  05630000
056000             MOVE DP016-CLEAR      TO DP020-SRC-AID               05640000
056100             PERFORM A460-RESET-ATTRIBUTES                        05650000
056200             MOVE -1               TO AMNEM1L                     05660003
056300             SET PS-SEND-MAP-N-DATA-FRSET                         05670000
056400                                   TO TRUE                        05680000
056500             PERFORM A550-DISPLAY-PANEL                           05690000
056600         ELSE                                                     05700000
056700             PERFORM DP007-0000-GET-PANEL                         05710000
056800             IF  DP020-SRC-AID  NOT =  DP016-CLEAR                05720000
056900                 PERFORM A650-MOVE-SCREEN-TO-COMM                 05730000
057000             END-IF                                               05740000
057100             PERFORM A200-PROCESS-INTER-APPL-COMM                 05750000
057200             PERFORM A300-CHECK-LOCAL-PF-KEYS                     05760000
057300             IF  PS-LOCAL-FUNCTION-NO                             05770000
057400                 IF  DP020-SRC-AID = DP016-PF15                   05780000
057500                     PERFORM A350-LOCAL-PF-KEY-CONTROL            05790000
057600                     IF  PS-EDIT-ERROR-NO                         05800000
057700                         PERFORM DP015-1000-START-NAVIGATOR       05810000
057800                     END-IF                                       05820000
057900                 ELSE                                             05830000
058000                     PERFORM DP015-1000-START-NAVIGATOR           05840000
058100                 END-IF                                           05850000
058200             ELSE                                                 05860000
058300                 IF  ((DP020-SRC-AID  =  DP016-ENTER)    AND      05870000
058400                      (DP020-NAV-MNEMONIC  NOT =  SPACES  AND     05880000
058500                                                  LOW-VALUES))    05890000
058600                     PERFORM DP015-1000-START-NAVIGATOR           05900000
058700                 ELSE                                             05910000
058800                     IF  PS-NEW-SCREEN-SENT-NO                    05920000
058900***************************************************************** 05930000
059000* THIS STRUCTURE WILL PREVENT THE PROGRAM FROM EDITTING AND     * 05940000
059100* PROCESSING THE SCREEN AFTER A NEW SCREEN HAS BEEN SENT TO THE * 05950000
059200* TERMINAL. THIS SWITCH IS SET IN MODULE A650-MOVE-SCREEN-TO-COM* 05960000
059300* TO 'Y' IF THE USER HAS HIT ERASE-EOF IN THE MNEMONIC FIELD ON * 05970000
059400* THE SCREEN, OTHERWISW IT IS ALWAYS SET TO 'N'. SINCE THIS     * 05980000
059500* FIELD IS THE KEY TO THE TMNEMONIC TABLE, IF THE USER HAS ER-  * 05990000
059600* ASED IT FROM THE SCREEN WE HAVE NO OPTION OTHER THAN TO REDIS-* 06000000
059700* PLAY A BLANK SCREEN AND PROMPT THE USER TO ENTER THE CORRECT  * 06010000
059800* MNEMONIC.                                                       06020000
059900***************************************************************** 06030000
060000                         PERFORM A350-LOCAL-PF-KEY-CONTROL        06040000
060100                     END-IF                                       06050000
060200                 END-IF                                           06060000
060300             END-IF                                               06070000
060400         END-IF                                                   06080000
060500     END-IF.                                                      06090000
060600 EJECT                                                            06100000
060700******************************************************************06110000
060800* A200-PROCESS-INTER-APPL-COMM                                   *06120000
060900* THE PURPOSE OF THIS MODULE IS TO MANIPULATE THE INTER-APPL-    *06130000
061000* COMMAREA UNDER THE FOUR POSSIBLE CYCLES OF THIS TRANSACTION:   *06140000
061100*                                                                *06150000
061200*        1. DP020-NEXT-ACT-INITIAL                               *06160000
061300*        2. DP020-NEXT-ACT-RETURN                                *06170000
061400*        3. DP020-NEXT-ACT-READ-MAP                              *06180000
061500*        4. DP020-NEXT-ACT-ERROR-RETURN                          *06190000
061600*                                                                *06200000
061700* THREE DATA AREAS ARE NEEDED TO CORRECTLY USE THE INTER-APPL-   *06210000
061800* COMMAREA:                                                      *06220000
061900*                                                                *06230000
062000*        1. THE INTER-APPL-COMMAREA PORTION OF THE STANDARD-COMM-*06240000
062100*           AREA                                                 *06250000
062200*        2. AN AREA OF THE APPLICATION COMMAREA THAT WILL BE USED*06260000
062300*           TO STORE THE CONTENTS OF THE INTER-APPL-COMMAREA SENT*06270000
062400*           TO THIS PROGRAM. (NOTE: ONLY SAVE THOSE FIELDS       *06280000
062500*           RELAVENT TO THIS PROGRAM).                           *06290000
062600*        3. AN AREA OF THE APPLICATION COMMAREA THAT WILL BE USED*06300000
062700*           TO HOLD THE DATA RELAVENT TO THE CURRENT OBJECT BEING*06310000
062800*           PROCESSED BY THIS PROGRAM.                           *06320000
062900******************************************************************06330000
063000                                                                  06340000
063100 A200-PROCESS-INTER-APPL-COMM.                                    06350000
063200                                                                  06360000
063300     IF  DP020-NEXT-ACT-INITIAL                                   06370000
063400         MOVE INTER-APPL-COMM-AREA TO                             06380000
063500              DP055-SAVE-INTER-APPL-COMMAREA                      06390000
063600     ELSE                                                         06400000
063700         IF  DP020-NEXT-ACT-RETURN                                06410000
063800             MOVE DP055-SAVE-INTER-APPL-COMMAREA                  06420000
063900                               TO  INTER-APPL-COMM-AREA           06430000
064000         ELSE                                                     06440000
064100             IF  DP020-NEXT-ACT-READ-MAP                          06450000
064200                 IF (DP020-FK-GO-TO-TRAN (DP020-SRC-AID)          06460000
064300                 OR  DP020-FK-LOCAL-GOTO (DP020-SRC-AID))         06470000
064400                     PERFORM A800-SETUP-INTER-APPL                06480000
064500                 ELSE                                             06490000
064600                     IF  DP020-FK-RETURN (DP020-SRC-AID)          06500000
064700                         PERFORM A850-RESET-INITIAL-INTER-APPL    06510000
064800                     END-IF                                       06520000
064900                 END-IF                                           06530000
065000             END-IF                                               06540000
065100         END-IF                                                   06550000
065200     END-IF.                                                      06560000
065300 EJECT                                                            06570000
065400******************************************************************06580000
065500* A250-SEND-INITIAL-SCREEN                                       *06590000
065600* RETRIEVE THE DATA FROM THE DATABASE, FORMAT DATA ON SCREEN, AND*06600000
065700* DISPLAY THE SCREEN TO THE USER.                                *06610000
065800******************************************************************06620000
065900                                                                  06630000
066000 A250-SEND-INITIAL-SCREEN.                                        06640000
066100                                                                  06650000
066200     PERFORM A500-RETRIEVE-DATA-FOR-SCREEN.                       06660000
066300                                                                  06670000
066400     PERFORM A550-DISPLAY-PANEL.                                  06680000
066500 EJECT                                                            06690000
066600******************************************************************06700000
066700* A300-CHECK-LOCAL-PF-KEYS                                       *06710000
066800*                                                                *06720000
066900* LOCAL FUNCTION KEYS:                                           *06730000
067000*      PF5   (DP020-SRC-AID = 05)  - REFRESH SCREEN              *06740000
067100*      PF15  (DP020-SRC-AID = 15)  - ADD ROW TO TMNEMONIC TABLE  *06750000
067200*      PA2   (DP020-SRC-AID = 26)  - TOGGLE THE FUNCTION KEY     *06760000
067300*                                    LINES ON SCREEN             *06770000
067400*      CLEAR (DP020-SRC-AID = 27)  - REFRESH SCREEN              *06780000
067500*      ENTER (DP020-SRC-AID = 28)  - EDIT SCREEN                 *06790000
067600******************************************************************06800000
067700                                                                  06810000
067800 A300-CHECK-LOCAL-PF-KEYS.                                        06820000
067900                                                                  06830000
068000     SET PS-LOCAL-FUNCTION-NO    TO TRUE.                         06840000
068100                                                                  06850000
068200     IF (DP020-FK-LOCAL-KEY (DP020-SRC-AID)  OR                   06860000
068300         DP020-FK-CONFIRM (DP020-SRC-AID)    OR                   06870000
068400         DP020-FK-REFRESH (DP020-SRC-AID)    OR                   06880000
068500         DP020-FK-PREV-PAGE (DP020-SRC-AID)  OR                   06890000
068600         DP020-FK-NEXT-PAGE (DP020-SRC-AID)  OR                   06900000
068700         DP020-FK-FIRST-PAGE (DP020-SRC-AID) OR                   06910000
068800         DP020-FK-DESELECT (DP020-SRC-AID))                       06920000
068900         SET PS-LOCAL-FUNCTION-YES                                06930000
069000                                 TO TRUE                          06940000
069100     END-IF.                                                      06950000
069200 EJECT                                                            06960000
069300******************************************************************06970000
069400* A350-LOCAL-PF-KEY-CONTROL                                      *06980000
069500******************************************************************06990000
069600                                                                  07000000
069700 A350-LOCAL-PF-KEY-CONTROL.                                       07010000
069800                                                                  07020000
069900     EVALUATE DP020-SRC-AID                                       07030000
070000                                                                  07040000
070100         WHEN  DP016-PF5                                          07050000
070200             SET PS-SEND-MAP-N-DATA-FRSET                         07060000
070300                                 TO TRUE                          07070000
070400             PERFORM A250-SEND-INITIAL-SCREEN                     07080000
070500                                                                  07090000
070600         WHEN  DP016-PF15                                         07100004
070700             PERFORM A450-EDIT-SCREEN                             07110000
070800             IF  PS-EDIT-ERROR-NO                                 07120000
070900                 PERFORM A400-PROCESS-ADD                         07130000
071000                 MOVE PC-TSYMSG-00224                             07140000
071100                                 TO  DP020-MSG-NUMBER             07150000
071200                 SET DP020-MSG-INFORMATIONAL                      07160000
071300                                 TO  TRUE                         07170000
071400             ELSE                                                 07180000
071500                 SET PS-SEND-MAP-N-DATA-FRSET                     07190000
071600                                 TO TRUE                          07200000
071700                 PERFORM A550-DISPLAY-PANEL                       07210000
071800             END-IF                                               07220000
071900                                                                  07230000
072000         WHEN  DP016-PA2                                          07240000
072100             MOVE -1             TO AMNEM1L                       07250003
072200             SET PS-SEND-DATA-ONLY                                07260000
072300                                 TO TRUE                          07270000
072400             PERFORM DP005-0000-FORMAT-MSG-LINES                  07280000
072500             PERFORM DP009-0000-LOAD-FK-LINES                     07290000
072600             PERFORM DP018-0000-GET-CURR-TIME                     07300000
072700             PERFORM DP008-0000-WRITE-PANEL                       07310000
072800                                                                  07320000
072900         WHEN  DP016-CLEAR                                        07330000
073000             SET PS-SEND-MAP-N-DATA-FRSET                         07340000
073100                                 TO TRUE                          07350000
073200             MOVE -1             TO AMNEM1L                       07360003
073300             PERFORM A550-DISPLAY-PANEL                           07370000
073400                                                                  07380000
073500         WHEN OTHER                                               07390000
073600             PERFORM A450-EDIT-SCREEN                             07400000
073700             PERFORM A550-DISPLAY-PANEL                           07410000
073800                                                                  07420000
073900     END-EVALUATE.                                                07430000
074000 EJECT                                                            07440000
074100******************************************************************07450000
074200* A400-PROCESS-ADD                                               *07460000
074300* ALL DB2 DATABASE MAINTENANCE USES 'TIMESTAMP' VALIDATION SYNTAX*07470000
074400* TO ENSURE THAT THE SET OF DATA BEING UPDATED IS IN THE SAME    *07480000
074500* CONDITION AT THE TIME OF UPDATE THAT IT WAS IN WHEN THE SET OF *07490000
074600* DATA WAS RETRIEVED FROM THE DATABASE FOR PROCESSING. THIS IS A *07500000
074700* RECOGNITION OF THE POTENTIAL FOR CONCURRENT UPDATING ON ALL    *07510000
074800* RELATIONS WITHIN THE DB2 ENVIRONMENT.                          *07520000
074900******************************************************************07530000
075000                                                                  07540000
075100 A400-PROCESS-ADD.                                                07550000
075200                                                                  07560000
075300     MOVE DP055-SCREEN-FROM-MNEMONIC                              07570005
075400                                 TO PV-CMNT-FROM-MNEM.            07580005
075500     MOVE PV-CMNT-TXT            TO TMNEMONIC-CMNT-TXT.           07590005
075600                                                                  07600005
075700     MOVE DP055-SCREEN-TO-MNEMONIC                                07610005
075800                                 TO TMNEMONIC-MNEMONIC-CODE.      07620005
075900     MOVE PC-Y                   TO TMNEMONIC-UPD-VSAM-IND.       07630000
076000                                                                  07640000
076100     PERFORM X910-ADD-TMNEMONIC-ROW.                              07650000
076200                                                                  07660000
076300     IF  SQL-SUCCESSFUL                                           07670000
076400         MOVE PC-TSYMSG-00034    TO DP020-MSG-NUMBER              07680000
076500         SET DP020-MSG-INFORMATIONAL                              07690000
076600                                 TO TRUE                          07700000
076700         SET DP055-RESULT-IS-CREATE                               07710000
076800                                 TO TRUE                          07720000
076900         MOVE DP055-SCREEN-TO-MNEMONIC                            07730007
077000                                 TO DP055-LAST-MNEMONIC           07740000
077100         MOVE DP055-SCREEN-TO-MNEMONIC                            07750007
077200                                 TO TMNEMONIC-MNEMONIC-CODE       07760000
077300                                                                  07770000
077400         PERFORM X940-OPEN-PFKEYS-CURSOR                          07780000
077500         PERFORM X930-FETCH-PFKEYS-CURSOR                         07790000
077600         PERFORM X600-PROCESS-ROUTE-RECORDS                       07800000
077700             UNTIL SQLCODE NOT EQUAL ZERO                         07810000
077800                                                                  07820000
077900         INITIALIZE AMNEM1O                                       07830003
078000                    AMNEM2O                                       07840003
078100                    DP055-CURRENT-SCREEN-IMAGE                    07850000
078200         PERFORM A460-RESET-ATTRIBUTES                            07860000
078300         MOVE -1                 TO AMNEM1L                       07870003
078400     ELSE                                                         07880000
078500         MOVE PC-TSYMSG-00117    TO DP020-MSG-NUMBER                    00
078600         SET DP020-MSG-FATAL     TO TRUE                          08180000
078700         MOVE -1                 TO AMNEM2L                       07900003
078800         MOVE DP015-UNP-ALP-BRT-OFF                               07910000
078900                                 TO AMNEM2A                       07920003
079000         MOVE DP015-RED          TO AMNEM2C                       07930003
079100         MOVE DP015-REVERSE      TO AMNEM2H                       07940003
079200     END-IF.                                                      07950000
079300     EJECT                                                        07960000
079400******************************************************************07970000
079500* A450-EDIT-SCREEN                                               *07980000
079600* EDITS WILL OCCUR FROM THE BOTTOM OF THE SCREEN TO THE TOP      *07990000
079700******************************************************************08000000
079800                                                                  08010000
079900 A450-EDIT-SCREEN.                                                08020000
080000                                                                  08030000
080100     SET PS-EDIT-ERROR-NO        TO TRUE.                         08040000
080200                                                                  08050000
080300***********************************************                   08060005
080400* VALIDATE SCREEN "TO MNEMONIC"               *                   08070005
080500* FROM THE APPLICATION SPECIFIC COMMAREA      *                   08080005
080600***********************************************                   08090005
080700                                                                  08100000
080800     IF  DP055-SCREEN-TO-MNEMONIC  =  (SPACES OR LOW-VALUES)      08110003
080900*        **************************************                   08120005
081000*        * REQUIRED FIELD; NO DATA ENTERED.   *                   08130005
081100*        * ERROR.                             *                   08140005
081200*        **************************************                   08150005
081300         SET PS-EDIT-ERROR-YES   TO TRUE                          08160000
081400         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              08170000
081500         SET DP020-MSG-FATAL     TO TRUE                          08180000
081600         MOVE -1                 TO AMNEM2L                       08190003
081700         MOVE DP015-UNP-ALP-BRT-OFF                               08200000
081800                                 TO AMNEM2A                       08210003
081900         MOVE DP015-RED          TO AMNEM2C                       08220003
082000         MOVE DP015-REVERSE      TO AMNEM2H                       08230003
082100     ELSE                                                         08240000
082200*        **************************************                   08250005
082300*        * REQUIRED FIELD; DATA ENTERED.      *                   08260005
082400*        * SO FAR SO GOOD.                    *                   08270005
082500*        **************************************                   08280005
082600         MOVE DP055-SCREEN-TO-MNEMONIC                            08290005
082700                                 TO TMNEMONIC-MNEMONIC-CODE       08300000
082800         PERFORM X900-READ-TMNEMONIC-ROW                          08310000
082900         IF  SQL-ROW-NOT-FOUND                                    08320000
083000*            **********************************                   08330005
083100*            * "TO" MNEMONIC DOES NOT EXIST.  *                   08340005
083200*            * SO FAR SO GOOD.                *                   08350005
083300*            **********************************                   08360005
083400             MOVE DP015-UNP-ALP-NOR-OFF                           08370000
083500                                 TO AMNEM2A                       08380003
083600             MOVE DP015-GREEN    TO AMNEM2C                       08390003
083700             MOVE DP015-UNDERLINE                                 08400000
083800                                 TO AMNEM2H                       08410003
083900             MOVE DP055-SCREEN-TO-MNEMONIC                              05
084000                                 TO TMNEMONIC-MNEMONIC-CODE             05
084100             PERFORM A455-LABEL-CHECK                             08420000
084200             IF  SQLCODE EQUAL ZERO                               08430000
084300*                ******************************                   08440005
084400*                * AT LEAST 1 MNEMONIC FETCHED*                   08450005
084500*                * FROM LABEL CURSOR;         *                   08450005
084600*                * MNEMONIC EXISTS AS A LABEL.*                   08450005
084700*                * ERROR.                     *                   08460005
084800*                ******************************                   08470005
084900                 SET PS-EDIT-ERROR-YES TO TRUE                    08480000
085000                 MOVE PC-TSYMSG-01481  TO DP020-MSG-NUMBER              00
085100                 SET DP020-MSG-FATAL   TO TRUE                          00
085200*                * POPULATE &VAR FIELD IN MSG *                         00
085300                 MOVE INVALID-LABEL-MNEMONIC                            00
085400                                       TO DP020-MSG-TEXT                00
085500                 SET DP020-MSG-FATAL   TO TRUE                          05
085600                 MOVE -1               TO AMNEM2L                 08510003
085700                 MOVE DP015-UNP-ALP-BRT-OFF                       08520000
085800                                       TO AMNEM2A                 08530003
085900                 MOVE DP015-RED        TO AMNEM2C                 08540003
086000                 MOVE DP015-REVERSE    TO AMNEM2H                 08550003
086100             END-IF                                               08560000
086200             PERFORM A456-LABEL-CURSOR-CLOSE                      08420000
086300         ELSE                                                     08570000
086400             IF  SQL-ROW-FOUND                                    08580000
086500*                *******************************                  08590005
086600*                * "TO" MNEMONIC EXISTS.       *                  08600005
086700*                * ERROR.                      *                  08610005
086800*                *******************************                  08620005
086900                 SET PS-EDIT-ERROR-YES TO TRUE                    08630000
087000                 MOVE PC-TSYMSG-00117  TO DP020-MSG-NUMBER        08640000
087100                 SET DP020-MSG-FATAL   TO TRUE                          00
087200                 MOVE -1               TO AMNEM2L                 08650003
087300                 MOVE DP015-UNP-ALP-BRT-OFF                       08660000
087400                                       TO AMNEM2A                 08670003
087500                 MOVE DP015-RED        TO AMNEM2C                 08680003
087600                 MOVE DP015-REVERSE    TO AMNEM2H                 08690003
087700             END-IF                                               08700000
087800         END-IF                                                   08710000
087900     END-IF.                                                      08720000
088000                                                                  08730000
088100***********************************************                   08740005
088200* VALIDATE SCREEN "FROM MNEMONIC".            *                   08750005
088300* FROM THE APPLICATION SPECIFIC COMMAREA      *                   08760005
088400***********************************************                   08770005
088500                                                                  08780005
088600     IF  DP055-SCREEN-FROM-MNEMONIC = (SPACES OR LOW-VALUES)      08790005
088700*        **************************************                   08800005
088800*        * REQUIRED FIELD; NO DATA ENTERED.   *                   08810005
088900*        * ERROR.                             *                   08820005
089000*        **************************************                   08830005
089100         SET PS-EDIT-ERROR-YES   TO TRUE                          08840005
089200         MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER              08850005
089300         SET DP020-MSG-FATAL     TO TRUE                          08860005
089400         MOVE -1                 TO AMNEM1L                       08870005
089500         MOVE DP015-UNP-ALP-BRT-OFF                               08880005
089600                                 TO AMNEM1A                       08890005
089700         MOVE DP015-RED          TO AMNEM1C                       08900005
089800         MOVE DP015-REVERSE      TO AMNEM1H                       08910005
089900     ELSE                                                         08920005
090000*        **************************************                   08930005
090100*        * REQUIRED FIELD; DATA ENTERED.      *                   08940005
090200*        * SO FAR SO GOOD.                    *                   08950005
090300*        **************************************                   08960005
090400         MOVE DP055-SCREEN-FROM-MNEMONIC                          08970005
090500                                 TO TMNEMONIC-MNEMONIC-CODE       08980005
090600         PERFORM X900-READ-TMNEMONIC-ROW                          08990005
090700         IF  SQL-ROW-FOUND                                        09000005
090800*            **********************************                   09010005
090900*            * "FROM" MNEMONIC EXISTS.        *                   09020005
091000*            * SO FAR SO GOOD.                *                   09030005
091100*            **********************************                   09040005
091200             MOVE DP015-UNP-ALP-NOR-OFF                           09050005
091300                                 TO AMNEM1A                       09060005
091400             MOVE DP015-GREEN    TO AMNEM1C                       09070005
091500             MOVE DP015-UNDERLINE                                 09080005
091600                                 TO AMNEM1H                       09090005
091700         ELSE                                                     09250005
091800             IF  SQL-ROW-NOT-FOUND                                09260005
091900*                *******************************                  09270005
092000*                * "FROM" MNEM DOES NOT EXIST. *                  09280005
092100*                * ERROR.                      *                  09290005
092200*                *******************************                  09300005
092300                 SET PS-EDIT-ERROR-YES TO TRUE                    09310005
092400                 MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER        09320005
092500                 SET DP020-MSG-FATAL   TO TRUE                          05
092600                 MOVE -1               TO AMNEM1L                 09330005
092700                 MOVE DP015-UNP-ALP-BRT-OFF                       09340005
092800                                       TO AMNEM1A                 09350005
092900                 MOVE DP015-RED        TO AMNEM1C                 09360005
093000                 MOVE DP015-REVERSE    TO AMNEM1H                 09370005
093100             END-IF                                               09380005
093200         END-IF                                                   09390005
093300     END-IF.                                                      09400005
093400                                                                  09410005
093500     IF  PS-EDIT-ERROR-NO                                         09420003
093600         MOVE -1                       TO ANAVKEYL                09430005
093700     END-IF.                                                      09440000
093800                                                                  09450005
093900 EJECT                                                            09460000
094000******************************************************************09470000
094100*    CHECK TO SEE IF THE REQUESTED MNEMONIC IS ALREADY USED AS   *09480000
094200*    A LABEL FOR ANOTHER MNEMONIC -OR- MULTIPLE OTHER MNEMONICS. *09490000
094300*                                                                *09490000
094400*    IF USED AS A LABEL, JUST THE FIRST MNEMONIC FOR WHICH IT IS *09490000
094500*    USED AS A LABEL WILL BE DISPLAYED IN THE ERROR MESSAGE.     *09490000
094600******************************************************************09500000
094700 A455-LABEL-CHECK.                                                09510000
094800                                                                  09520000
094900     EXEC SQL                                                     09530000
095000          OPEN LABEL-CURSOR                                       09540000
095100     END-EXEC.                                                    09550000
095200                                                                  09560000
095300     IF (SQLCODE EQUAL ZERO                                       09570000
095400     OR  SQLCODE EQUAL +100)                                      09580000
095500         CONTINUE                                                 09590000
095600     ELSE                                                         09600000
095700         SET  DP013-DB2-ABEND    TO TRUE                          09610000
095800         MOVE 'A455-LABEL-CHECK              '                    09620000
095900                                 TO DP013-PARAGRAPH               09630000
096000         MOVE SQLCA              TO DP013-SQLCA                   09640000
096100         MOVE 'TCICSRTE - OPEN   '                                09650000
096200                                 TO DP013-DB2-TABLE-NAME (1)      09660000
096300         MOVE TCICSROUTE-MNEMONIC-CODE                            09670000
096400                                 TO DP013-MESSAGE-TEXT (1)        09680000
096500         PERFORM DP013-0000-PROCESS-ABEND                         09690000
096600     END-IF.                                                      09700000
096700                                                                  09710000
096800     IF  SQLCODE EQUAL ZERO                                       09720000
096900         EXEC SQL FETCH LABEL-CURSOR                              09730000
097000              INTO                                                09740000
097100                 :INVALID-LABEL-MNEMONIC                          09750000
097200         END-EXEC                                                 09760000
097300                                                                  09770000
097400         IF (SQLCODE EQUAL ZERO                                   09780000
097500         OR  SQLCODE EQUAL +100)                                  09790000
097600             CONTINUE                                             09800000
097700         ELSE                                                     09810000
097800             SET DP013-DB2-ABEND TO TRUE                          09820000
097900             MOVE 'A455-LABEL-CHECK              '                09830000
098000                                 TO DP013-PARAGRAPH               09840000
098100             MOVE SQLCA          TO DP013-SQLCA                   09850000
098200             MOVE 'TCICSRTE - FETCH  '                            09860000
098300                                 TO DP013-DB2-TABLE-NAME (1)      09870000
098400             MOVE TCICSROUTE-MNEMONIC-CODE                        09880000
098500                                 TO DP013-MESSAGE-TEXT (1)        09890000
098600             PERFORM DP013-0000-PROCESS-ABEND                     09900000
098700         END-IF                                                   09910000
098800     END-IF.                                                      09920000
098900                                                                  09930000
099000******************************************************************09470000
099100*    CLOSE THE LABEL CURSOR.                                     *09480000
099200******************************************************************09500000
099300 A456-LABEL-CURSOR-CLOSE.                                         09510000
099400     EXEC SQL                                                     09530000
099500          CLOSE LABEL-CURSOR                                            00
099600     END-EXEC.                                                    09550000
099700                                                                  09560000
099800 EJECT                                                            09940000
099900******************************************************************09950000
100000* A460-RESET-ATTRIBUTES                                          *09960000
100100******************************************************************09970000
100200 A460-RESET-ATTRIBUTES.                                           09980000
100300     MOVE DP015-UNP-ALP-NOR-OFF                                   09990000
100400                           TO AMNEM1A.                            10000003
100500     MOVE DP015-GREEN      TO AMNEM1C.                            10010003
100600     MOVE DP015-UNDERLINE  TO AMNEM1H.                            10020003
100700                                                                  10030003
100800     MOVE DP015-UNP-ALP-NOR-OFF                                   10040003
100900                           TO AMNEM2A.                            10050003
101000     MOVE DP015-GREEN      TO AMNEM2C.                            10060003
101100     MOVE DP015-UNDERLINE  TO AMNEM2H.                            10070003
101200                                                                  10080003
101300 EJECT                                                            10090000
101400***************************************************************** 10100000
101500*     EVERY TIME IN SET THE COMMAND FIELD TO EITHER RED         * 10110000
101600*     OR GREEN. THIS IS BECAUSE IT IS UNEDITTED IN THE          * 10120000
101700*     PROGRAM AND IT NEEDS RESETTING.                           * 10130000
101800***************************************************************** 10140000
101900 A470-SET-COMMAND-ATTRIBUTES.                                     10150000
102000     IF DP020-NEXT-ACT-ERROR                                      10160000
102100         MOVE DP020-MSG-MESSAGE                                   10170000
102200                                 TO PV-HOLD-MESSAGE               10180000
102300         MOVE DP020-MSG-SEVERITY-IND                              10190000
102400                                 TO PV-HOLD-SEVERITY-IND          10200000
102500         IF DP020-NAV-MNEMONIC NOT EQUAL TO SPACES                10210000
102600             MOVE DP015-UNP-ALP-BRT-MDT                           10220000
102700                                 TO ANAVCMDA                      10230000
102800             MOVE DP015-RED                                       10240000
102900                                 TO ANAVCMDC                      10250000
103000             MOVE DP015-REVERSE                                   10260000
103100                                 TO ANAVCMDH                      10270000
103200         ELSE                                                     10280000
103300             MOVE SPACES         TO ANAVCMDO                      10290000
103400                                    DP020-NAV-MNEMONIC            10300000
103500             MOVE DP015-UNP-ALP-NOR-OFF                           10310000
103600                                 TO ANAVCMDA                      10320000
103700             MOVE DP015-GREEN                                     10330000
103800                                 TO ANAVCMDC                      10340000
103900             MOVE DP015-UNDERLINE                                 10350000
104000                                 TO ANAVCMDH                      10360000
104100         END-IF                                                   10370000
104200     ELSE                                                         10380000
104300         IF (EIBAID  NOT EQUAL DFHPA2    AND                      10390000
104400                               DFHCLEAR)                          10400000
104500         MOVE DP015-UNP-ALP-NOR-OFF                               10410000
104600                                 TO ANAVCMDA                      10420000
104700         MOVE DP015-GREEN                                         10430000
104800                                 TO ANAVCMDC                      10440000
104900         MOVE DP015-UNDERLINE                                     10450000
105000                                 TO ANAVCMDH                      10460000
105100     END-IF.                                                      10470000
105200 EJECT                                                            10480000
105300******************************************************************10490000
105400* A500-RETRIEVE-DATA-FOR-SCREEN                                  *10500000
105500******************************************************************10510000
105600                                                                  10520000
105700 A500-RETRIEVE-DATA-FOR-SCREEN.                                   10530000
105800                                                                  10540000
105900     IF  (    DP020-NEXT-ACT-INITIAL                              10550000
106000         OR   DP020-SRC-AID  =  DP016-PF5                         10560000
106100         )                                                        10570000
106200         INITIALIZE DP055-CURRENT-SCREEN-IMAGE                    10580000
106300     END-IF.                                                      10590000
106400     SET PS-SEND-MAP-N-DATA-FRSET TO TRUE.                        10600000
106500                                                                  10610000
106600     IF  DP055-SCREEN-FROM-MNEMONIC  =  ( SPACES OR LOW-VALUES )  10620003
106700         MOVE -1                 TO AMNEM1L.                      10630003
106800                                                                  10640000
106900 EJECT                                                            10650000
107000******************************************************************10660000
107100* A550-DISPLAY-PANEL                                             *10670000
107200******************************************************************10680000
107300                                                                  10690000
107400 A550-DISPLAY-PANEL.                                              10700000
107500                                                                  10710000
107600     IF  PS-SEND-DATA-ONLY-FRSET                                  10720000
107700         PERFORM DP018-0000-GET-CURR-TIME                         10730000
107800     ELSE                                                         10740000
107900         PERFORM DP017-0000-GET-CURR-DATE-TIME                    10750000
108000         PERFORM DP002-0000-FORMAT-TITLE-LINES                    10760000
108100     END-IF.                                                      10770000
108200                                                                  10780000
108300     IF  PS-SEND-MAP-N-DATA-FRSET                                 10790000
108400         PERFORM A600-LOAD-DETAIL-DATA                            10800000
108500     END-IF.                                                      10810000
108600                                                                  10820000
108700     PERFORM DP005-0000-FORMAT-MSG-LINES.                         10830000
108800                                                                  10840000
108900     IF (    PS-SEND-MAP-N-DATA-FRSET                             10850000
109000        OR   DP020-SRC-AID  =  DP016-PA2                          10860000
109100        )                                                         10870000
109200***************************************                           10880000
109300* PA2 KEY  -  CHANGE PFKEYS DISPLAYED *                           10890000
109400***************************************                           10900000
109500        PERFORM DP009-0000-LOAD-FK-LINES                          10910000
109600     END-IF.                                                      10920000
109700                                                                  10930000
109800     PERFORM DP008-0000-WRITE-PANEL.                              10940000
109900 EJECT                                                            10950000
110000******************************************************************10960000
110100* A600-LOAD-DETAIL-DATA                                          *10970000
110200******************************************************************10980000
110300                                                                  10990000
110400 A600-LOAD-DETAIL-DATA.                                           11000000
110500                                                                  11010000
110600     MOVE DP055-SCREEN-FROM-MNEMONIC  TO AMNEM1O.                 11020003
110700     MOVE DP055-SCREEN-TO-MNEMONIC    TO AMNEM2O.                 11030003
110800                                                                  11040000
110900                                                                  11050000
111000 EJECT                                                            11060000
111100******************************************************************11070000
111200* A650-MOVE-SCREEN-TO-COMM                                       *11080000
111300* IN ORDER TO MINIMIZE DATA TRANSMISSIONS, ALL SCREEN VARIABLES  *11090000
111400* WILL BE STORED IN THE COMMAREA. ALL EDITING AND DATABASE I/O   *11100000
111500* WILL BE FROM THESE FIELDS IN THE APPLICATION SPECIFIC COMMAREA.*11110000
111600* ONLY ATTRIBUTE CHANGES WILL BE SENT TO THE TERMINAL AS LONG AS *11120000
111700* THE CURRENT MAP IS STILL BEING DISPLAYED. THIS MODULE OVERLAYS *11130000
111800* ANY COMMAREA SCREEN VARIABLE THAT HAS CHANGED (EITHER A LENGTH *11140000
111900* GREATER THAN ZERO OR EOF HAS BEEN PRESSED) WITH THE INPUT FIELD*11150000
112000* FROM THE SCREEN. IF ERASE-EOF HAS BEEN PRESSED WITHIN THE      *11160000
112100* MNEMONIC FIELD ON THE SCREEN IT IS NECESSARY TO SEND AN INITIAL*11170000
112200* SCREEN. THIS IS DONE BECAUSE MNEMONIC IS THE KEY TO THE TMNEMO-*11180000
112300* NIC TABLE THAT THE USER IS TRYING TO ADD A ROW TO. IF THIS PRO-*11190000
112400* GRAM HAS NO MNEMONIC, IT CAN'T ADD A ROW. THE SWITCH 'PS-NEW-  *11200000
112500* SCREEN-SENT-SW' IS SET TO A 'Y' IN THIS SITUATION SO THAT FUR- *11210000
112600* THER PROCESSING OF THE SCREEN IS NOT ATTEMPTED (SEE MODULE A100*11220000
112700* -PROCESS-MAP FOR WHERE THIS SWITCH IS INTERROGATED AND PROCESS-*11230000
112800* ING BYPASSED IF IT IS OTHER THAN 'N'.                          *11240000
112900******************************************************************11250000
113000                                                                  11260000
113100 A650-MOVE-SCREEN-TO-COMM.                                        11270000
113200                                                                  11280000
113300     IF  (     ANAVKEYL       >  ZEROS                            11290000
113400         AND   ANAVCMDL       =  ZEROS                            11300000
113500         AND   DP020-SRC-AID  =  DP016-ENTER                      11310000
113600         )                                                        11320000
113700         SET PS-NEW-SCREEN-SENT-YES                               11330000
113800                                 TO TRUE                          11340000
113900         INITIALIZE DP055-CURRENT-SCREEN-IMAGE                    11350000
114000         MOVE ANAVKEYI           TO PV-MNEMONIC                   11360000
114100                                    DP055-SCREEN-TO-MNEMONIC      11370007
114200         MOVE LOW-VALUES         TO ANAVKEYO                      11380000
114300         MOVE SPACES             TO DP055-SELECT-MAINT-RESULT     11390000
114400         SET PS-SEND-MAP-N-DATA-FRSET                             11400000
114500                                 TO TRUE                          11410000
114600         PERFORM A250-SEND-INITIAL-SCREEN                         11420000
114700     ELSE                                                         11430000
114800         SET PS-NEW-SCREEN-SENT-NO                                11440000
114900                                 TO TRUE                          11450000
115000         IF  AMNEM1F  =  DP015-ERASE-EOF                          11460003
115100         OR  AMNEM2F  =  DP015-ERASE-EOF                          11470003
115200             SET PS-NEW-SCREEN-SENT-YES                           11480000
115300                                 TO TRUE                          11490000
115400             INITIALIZE DP055-CURRENT-SCREEN-IMAGE                11500000
115500             MOVE SPACES         TO DP055-SCREEN-TO-MNEMONIC      11510007
115600                                    PV-MNEMONIC                   11520000
115700             PERFORM A250-SEND-INITIAL-SCREEN                     11530000
115800         ELSE                                                     11540000
115900             IF  AMNEM1L  >  ZERO                                 11550003
116000                 MOVE AMNEM1I      TO                             11560003
116100                                   DP055-SCREEN-FROM-MNEMONIC           07
116200             END-IF                                               11600000
116300             IF  AMNEM2L  >  ZERO                                 11550003
116400                 MOVE AMNEM2I      TO                             11560003
116500                                   DP055-SCREEN-TO-MNEMONIC       11570007
116600                                   PV-MNEMONIC                    11580000
116700                                   DP055-LAST-MNEMONIC            11590000
116800             END-IF                                               11600000
116900                                                                  11610000
117000         END-IF                                                   11620000
117100     END-IF.                                                      11630000
117200 EJECT                                                            11640000
117300******************************************************************11650000
117400* A800-SETUP-INTER-APPL                                          *11660000
117500* (Z019-16 SETUP INTER-APPL)                                     *11670000
117600*                                                                *11680000
117700* WHENEVER THIS TRANSACTION IS ABOUT TO NAVIGATE TO ANOTHER      *11690000
117800* TRANSACTION, THIS MODULE WILL FORMAT THE INTER APPLICATION     *11700000
117900* COMMAREA WITH THE DATA SAVED FOR THE CURRENT OBJECT BEING PRO- *11710000
118000* CESSED BY THIS TRANSACTION.                                    *11720000
118100******************************************************************11730000
118200                                                                  11740000
118300 A800-SETUP-INTER-APPL.                                           11750000
118400                                                                  11760000
118500     MOVE INTER-APPL-COMM-AREA                                    11770000
118600                              TO DP055-SAVE-INTER-APPL-COMMAREA.  11780000
118700     MOVE DP055-LAST-MNEMONIC TO DP055-MNEMONIC.                  11790000
118800                                                                  11800000
118900 EJECT                                                            11810000
119000******************************************************************11820000
119100* A850-RESET-INITIAL-INTER-APPL                                  *11830000
119200* (Z019-17 RESET INITIAL INTER-APPL)                             *11840000
119300*                                                                *11850000
119400* WHEN THIS MODULE IS ABOUT TO RETURN TO THE MODULE THAT INVOKED *11860000
119500* IT, IT WILL RESET THE COMMAREA TO THE CONTENTS THAT WERE SENT  *11870000
119600* TO IT.                                                         *11880000
119700*                                                                *11890000
119800******************************************************************11900000
119900                                                                  11910000
120000 A850-RESET-INITIAL-INTER-APPL.                                   11920000
120100                                                                  11930000
120200     MOVE DP055-SAVE-INTER-APPL-COMMAREA                          11940000
120300                            TO  INTER-APPL-COMM-AREA.             11950000
120400                                                                  11960000
120500     MOVE ZERO              TO  DP055-NUMBER-PROCESSED-ITEMS.     11970000
120600                                                                  11980000
120700 EJECT                                                            11990000
120800*****************************************************             12000000
120900* ROUTINE TO ADD ROUTING RECORDS TO TCICSRTE TABLE  *             12010000
121000*****************************************************             12020000
121100                                                                  12030000
121200 X600-PROCESS-ROUTE-RECORDS.                                      12040000
121300                                                                  12050000
121400******************************************************************12060000
121500* PERFORMED AFTER SUCCESSFULLY UPDATING THE TMNEMONIC TABLE,     *      00
121600* THIS MODULE COPIES THE 'FROM' MNEMONIC'S PFKEY ASSIGNMENTS     *12070000
121700* FROM THE TCICSROUTE TABLE TO CREATE THE 'TO' MNEMONIC'S PFKEYS *      00
121800* ON THE TCICSROUTE TABLE.                                       *12080000
121900******************************************************************12120000
122000                                                                  12130000
122100     MOVE TMNEMONIC-MNEMONIC-CODE                                 12140000
122200                                 TO TCICSROUTE-MNEMONIC-CODE.     12150000
122300                                                                  12310000
122400     PERFORM X920-ADD-TCICSRTE-ROW.                               12320000
122500                                                                  12330000
122600     PERFORM X930-FETCH-PFKEYS-CURSOR.                            12340000
122700                                                                  12350000
122800 EJECT                                                            12360000
122900**********************************                                12370000
123000* FETCH ROW FROM TABLE TMNEMONIC *                                12380000
123100**********************************                                12390000
123200                                                                  12400000
123300 X900-READ-TMNEMONIC-ROW.                                         12410000
123400                                                                  12420000
123500       EXEC SQL                                                   12430000
123600           SELECT       MNEMONIC_CODE,                            12440000
123700                        TRANS_ID_CODE,                            12450000
123800                        AVAIL_INDCT,                              12460000
123900                        CMAREA_FRMT_CODE,                         12470000
124000                        SAVE_CMAREA_INDCT,                        12480000
124100                        CMAREA_LNGTH_MSRMT,                       12490000
124200                        PANEL_TITLE_NAME,                         12500000
124300                        LAST_UPDATE_TMESTP,                       12510000
124400                        GLBL_ACCS_IND,                            12520000
124500                        PGM_NAME,                                 12530000
124600                        SCRN_TYP_CDE,                             12540000
124700                        UPD_VSAM_IND,                             12550000
124800                        DB2_PKG_CDE,                              12560000
124900                        CMNT_TXT                                  12570000
125000                 INTO   :TMNEMONIC-MNEMONIC-CODE,                 12580000
125100                        :TMNEMONIC-TRANS-ID-CODE,                 12590000
125200                        :TMNEMONIC-AVAIL-INDCT,                   12600000
125300                        :TMNEMONIC-CMAREA-FRMT-CODE,              12610000
125400                        :TMNEMONIC-SAVE-CMAREA-INDCT,             12620000
125500                        :TMNEMONIC-CMAREA-LNGTH-MSRMT,            12630000
125600                        :TMNEMONIC-PANEL-TITLE-NAME,              12640000
125700                        :TMNEMONIC-LAST-UPDATE-TMESTP,            12650000
125800                        :TMNEMONIC-GLBL-ACCS-IND,                 12660000
125900                        :TMNEMONIC-PGM-NAME,                      12670000
126000                        :TMNEMONIC-SCRN-TYP-CDE,                  12680000
126100                        :TMNEMONIC-UPD-VSAM-IND,                  12690000
126200                        :TMNEMONIC-DB2-PKG-CDE,                   12700000
126300                        :TMNEMONIC-CMNT-TXT                       12710000
126400                 FROM   TMNEMONIC                                 12720000
126500                 WHERE  MNEMONIC_CODE  =                          12730000
126600                                :TMNEMONIC-MNEMONIC-CODE          12740000
126700       END-EXEC.                                                  12750000
126800                                                                  12760000
126900***************************                                       12770000
127000* CHECK SQLCODE OF SELECT *                                       12780000
127100***************************                                       12790000
127200                                                                  12800000
127300       MOVE SQLCODE              TO SQL-RETURN-CODE.              12810000
127400       IF  SQL-ROW-NOT-FOUND                                      12820000
127500           CONTINUE                                               12830000
127600       ELSE                                                       12840000
127700       IF  NOT SQL-SUCCESSFUL                                     12850000
127800           SET  DP013-DB2-ABEND  TO TRUE                          12860000
127900           MOVE 'X900-READ-TMNEMONIC-ROW       '                  12870000
128000                                 TO DP013-PARAGRAPH               12880000
128100           MOVE SQLCA            TO DP013-SQLCA                   12890000
128200           MOVE 'TMNMNC            '                              12900000
128300                                 TO DP013-DB2-TABLE-NAME (1)      12910000
128400           PERFORM DP013-0000-PROCESS-ABEND                       12920000
128500       END-IF                                                     12930000
128600       END-IF.                                                    12940000
128700 EJECT                                                            12950000
128800******************************                                    12960000
128900* ADD ROW TO TABLE TMNEMONIC *                                    12970000
129000******************************                                    12980000
129100                                                                  12990000
129200 X910-ADD-TMNEMONIC-ROW.                                          13000000
129300                                                                  13010000
129400       EXEC SQL                                                   13020000
129500           INSERT INTO  TMNEMONIC                                 13030000
129600                 (MNEMONIC_CODE,                                  13040000
129700                  TRANS_ID_CODE,                                  13050000
129800                  AVAIL_INDCT,                                    13060000
129900                  CMAREA_FRMT_CODE,                               13070000
130000                  SAVE_CMAREA_INDCT,                              13080000
130100                  CMAREA_LNGTH_MSRMT,                             13090000
130200                  PANEL_TITLE_NAME,                               13100000
130300                  LAST_UPDATE_TMESTP,                             13110000
130400                  GLBL_ACCS_IND,                                  13120000
130500                  PGM_NAME,                                       13130000
130600                  SCRN_TYP_CDE,                                   13140000
130700                  UPD_VSAM_IND,                                   13150000
130800                  DB2_PKG_CDE,                                    13160000
130900                  CMNT_TXT)                                       13170000
131000             VALUES                                               13180000
131100                 (:TMNEMONIC-MNEMONIC-CODE,                       13190000
131200                  :TMNEMONIC-TRANS-ID-CODE,                       13200000
131300                  :TMNEMONIC-AVAIL-INDCT,                         13210000
131400                  :TMNEMONIC-CMAREA-FRMT-CODE,                    13220000
131500                  :TMNEMONIC-SAVE-CMAREA-INDCT,                   13230000
131600                  :TMNEMONIC-CMAREA-LNGTH-MSRMT,                  13240000
131700                  :TMNEMONIC-PANEL-TITLE-NAME,                    13250000
131800                  CURRENT TIMESTAMP,                              13260000
131900                  :TMNEMONIC-GLBL-ACCS-IND,                       13270000
132000                  :TMNEMONIC-PGM-NAME,                            13280000
132100                  :TMNEMONIC-SCRN-TYP-CDE,                        13290000
132200                  :TMNEMONIC-UPD-VSAM-IND,                        13300000
132300                  :TMNEMONIC-DB2-PKG-CDE,                         13310000
132400                  :TMNEMONIC-CMNT-TXT)                            13320000
132500       END-EXEC.                                                  13330000
132600                                                                  13340000
132700************************                                          13350000
132800* CHECK SQLCODE OF ADD *                                          13360000
132900************************                                          13370000
133000                                                                  13380000
133100       MOVE SQLCODE              TO SQL-RETURN-CODE.              13390000
133200       IF  (  SQL-ROW-FOUND    OR   SQL-DUPLICATE-ROW  )          13400000
133300           CONTINUE                                               13410000
133400       ELSE                                                       13420000
133500           IF  NOT SQL-SUCCESSFUL                                 13430000
133600               SET  DP013-DB2-ABEND  TO TRUE                      13440000
133700               MOVE 'X910-ADD-TMNEMONIC-ROW        '              13450000
133800                                     TO DP013-PARAGRAPH           13460000
133900               MOVE SQLCA            TO DP013-SQLCA               13470000
134000               MOVE 'TMNMNC            '                          13480000
134100                                     TO DP013-DB2-TABLE-NAME (1)  13490000
134200               PERFORM DP013-0000-PROCESS-ABEND                   13500000
134300           END-IF                                                 13510000
134400       END-IF.                                                    13520000
134500 EJECT                                                            13530000
134600***************************************************************   13540000
134700* ADD ROW TO TCICSRTE TABLE TO SETUP PFKEYS FOR 'TO' MNEMONIC *   13550000
134800***************************************************************   13560000
134900                                                                  13570000
135000 X920-ADD-TCICSRTE-ROW.                                           13580000
135100                                                                  13590000
135200       EXEC SQL                                                   13600000
135300           INSERT INTO  TCICSROUTE                                13610000
135400                 (MNEMONIC_CODE,                                  13620000
135500                  AID_SEQUENCE_NMBR,                              13630000
135600                  DEST_MNEMONIC_CODE,                             13640000
135700                  ACTION_CODE,                                    13650000
135800                  LAST_UPDATE_TMESTP,                             13660000
135900                  ROUTE_STACK_INDCT,                              13680000
136000                  FUNC_KEY_LBL_NAME,                              13670000
136100                  IN_APLCTN_COMM_CDE,                             13670000
136200                  FUNC_KY_DISPN_IND)                              13670000
136300             VALUES                                               13690000
136400                 (:TCICSROUTE-MNEMONIC-CODE,                      13700000
136500                  :TCICSROUTE-AID-SEQUENCE-NMBR,                  13710000
136600                  :TCICSROUTE-DEST-MNEMONIC-CODE,                 13720000
136700                  :TCICSROUTE-ACTION-CODE,                        13730000
136800                  CURRENT TIMESTAMP,                              13740000
136900                  :TCICSROUTE-ROUTE-STACK-INDCT,                  13760000
137000                  :TCICSROUTE-FUNC-KEY-LBL-NAME,                  13750000
137100                  :TCICSROUTE-IN-APLCTN-COMM-CDE,                 13750000
137200                  :TCICSROUTE-FUNC-KY-DISPN-IND)                  13750000
137300       END-EXEC.                                                  13770000
137400                                                                  13780000
137500       INITIALIZE DCLTCICSROUTE.                                  13790000
137600                                                                  13800000
137700************************                                          13810000
137800* CHECK SQLCODE OF ADD *                                          13820000
137900************************                                          13830000
138000                                                                  13840000
138100       MOVE SQLCODE              TO SQL-RETURN-CODE.              13850000
138200       IF  NOT SQL-SUCCESSFUL                                     13860000
138300           SET  DP013-DB2-ABEND  TO TRUE                          13870000
138400           MOVE 'X920-ADD-TCICSRTE-ROW         '                  13880000
138500                                 TO DP013-PARAGRAPH               13890000
138600           MOVE SQLCA            TO DP013-SQLCA                   13900000
138700           MOVE 'TCICSRTE          '                              13910000
138800                                 TO DP013-DB2-TABLE-NAME (1)      13920000
138900           MOVE TCICSROUTE-MNEMONIC-CODE                          13930000
139000                                 TO DP013-MESSAGE-TEXT (1)        13940000
139100           MOVE TCICSRTE-FOUND-MSG                                13950000
139200                                 TO DP013-MESSAGE-TEXT (2)        13960000
139300           PERFORM DP013-0000-PROCESS-ABEND                       13970000
139400       END-IF.                                                    13980000
139500                                                                  13990000
139600 EJECT                                                            14000000
139700*******************************                                   14010000
139800* FETCH ROW FROM PFKEYS CURSOR*                                   14020000
139900*******************************                                   14030000
140000                                                                  14040000
140100 X930-FETCH-PFKEYS-CURSOR.                                        14050000
140200                                                                  14060000
140300       EXEC SQL                                                   14070000
140400            FETCH PFKEYS-CURSOR                                   14080000
140500            INTO                                                  14090000
140600                  :TCICSROUTE-MNEMONIC-CODE                       13700000
140700                , :TCICSROUTE-AID-SEQUENCE-NMBR                   13710000
140800                , :TCICSROUTE-DEST-MNEMONIC-CODE                  13720000
140900                , :TCICSROUTE-ACTION-CODE                         13730000
141000                , :TCICSROUTE-LAST-UPDATE-TMESTP                        00
141100                , :TCICSROUTE-ROUTE-STACK-INDCT                   13760000
141200                , :TCICSROUTE-FUNC-KEY-LBL-NAME                   13750000
141300                , :TCICSROUTE-IN-APLCTN-COMM-CDE                  13750000
141400                , :TCICSROUTE-FUNC-KY-DISPN-IND                   13750000
141500       END-EXEC.                                                  14150000
141600                                                                  14160000
141700       IF (SQLCODE EQUAL ZERO                                     14170000
141800       OR  SQLCODE EQUAL +100)                                    14180000
141900           CONTINUE                                               14190000
142000       ELSE                                                       14200000
142100           SET  DP013-DB2-ABEND  TO TRUE                          14210000
142200           MOVE 'X930-FETCH-PFKEYS-CURSOR      '                  14220000
142300                                 TO DP013-PARAGRAPH               14230000
142400           MOVE SQLCA            TO DP013-SQLCA                   14240000
142500           MOVE 'TCICSROUTE        '                              14250000
142600                                 TO DP013-DB2-TABLE-NAME (1)      14260000
142700           MOVE TCICSROUTE-MNEMONIC-CODE                          14270000
142800                                 TO DP013-MESSAGE-TEXT (1)        14280000
142900           MOVE 'FETCH PFKEYS CURSOR'                                   00
143000                                 TO DP013-MESSAGE-TEXT (2)        14300000
143100           PERFORM DP013-0000-PROCESS-ABEND                       14310000
143200       END-IF.                                                    14320000
143300                                                                  14330000
143400 EJECT                                                            14340000
143500*******************************                                   14350000
143600* OPEN THE PFKEYS CURSOR      *                                   14360000
143700*******************************                                   14370000
143800                                                                  14380000
143900 X940-OPEN-PFKEYS-CURSOR.                                         14390000
144000                                                                  14400000
144100       EXEC SQL                                                   14410000
144200            OPEN PFKEYS-CURSOR                                    14420000
144300       END-EXEC.                                                  14430000
144400                                                                  14440000
144500       IF (SQLCODE EQUAL ZERO                                     14450000
144600       OR  SQLCODE EQUAL +100)                                    14460000
144700           CONTINUE                                               14470000
144800       ELSE                                                       14480000
144900           SET  DP013-DB2-ABEND  TO TRUE                          14490000
145000           MOVE 'X940-OPEN-PFKEYS-CURSOR       '                  14500000
145100                                 TO DP013-PARAGRAPH               14510000
145200           MOVE SQLCA            TO DP013-SQLCA                   14520000
145300           MOVE 'TCICSROUTE        '                              14530000
145400                                 TO DP013-DB2-TABLE-NAME (1)      14540000
145500           MOVE TCICSROUTE-MNEMONIC-CODE                          14550000
145600                                 TO DP013-MESSAGE-TEXT (1)        14560000
145700           MOVE 'OPEN PFKEYS CURSOR'                                    00
145800                                 TO DP013-MESSAGE-TEXT (2)        14580000
145900           PERFORM DP013-0000-PROCESS-ABEND                       14590000
146000       END-IF.                                                    14600000
146100 EJECT                                                            14610000
146200**********************************************                    14620000
146300* COPYBOOK FOR DP002-0000-FORMAT-TITLE-LINES *                    14630000
146400**********************************************                    14640000
146500     COPY DPPD022.                                                14650000
146600 EJECT                                                            14660000
146700******************************************                        14670000
146800* COPYBOOK FOR DP003-0000-RETURN-TO-CICS *                        14680000
146900******************************************                        14690000
147000     COPY DPPD003.                                                14700000
147100 EJECT                                                            14710000
147200********************************************                      14720000
147300* COPYBOOK FOR DP005-0000-FORMAT-MSG-LINES *                      14730000
147400********************************************                      14740000
147500     COPY DPPD005.                                                14750000
147600 EJECT                                                            14760000
147700*************************************                             14770000
147800* COPYBOOK FOR DP007-0000-GET-PANEL *                             14780000
147900*************************************                             14790000
148000     COPY DPPD007.                                                14800000
148100 EJECT                                                            14810000
148200***************************************                           14820000
148300* COPYBOOK FOR DP008-0000-WRITE-PANEL *                           14830000
148400***************************************                           14840000
148500     COPY DPPD008.                                                14850000
148600 EJECT                                                            14860000
148700*****************************************                         14870000
148800* COPYBOOK FOR DP009-0000-LOAD-FK-LINES *                         14880000
148900*****************************************                         14890000
149000     COPY DPPD009.                                                14900000
149100 EJECT                                                            14910000
149200*****************************************                         14920000
149300* COPYBOOK FOR DP013-0000-PROCESS-ABEND *                         14930000
149400*****************************************                         14940000
149500     COPY DPPD013.                                                14950000
149600 EJECT                                                            14960000
149700******************************************                        14970000
149800* COPYBOOK FOR DP015-0000-CHECK-COMMAREA *                        14980000
149900******************************************                        14990000
150000     COPY DPPD015.                                                15000000
150100 EJECT                                                            15010000
150200**********************************************                    15020000
150300* COPYBOOK FOR DP017-0000-GET-CURR-DATE-TIME *                    15030000
150400**********************************************                    15040000
150500     COPY DPPD017.                                                15050000
150600 EJECT                                                            15060000
150700*****************************************                         15070000
150800* COPYBOOK FOR DP018-0000-GET-CURR-TIME *                         15080000
150900*****************************************                         15090000
151000     COPY DPPD018.                                                15100000
