000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    PCKUT088.                                         00050000
000600 AUTHOR.        BRENDA ROCKWELL.                                  00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   DECEMBER 2009.                                    00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200******************************************************************00120000
001300* THIS PROGRAM WILL READ A FILE OF NON-TRANSCRIBED AND PBS ORDER *00130000
001400* TYPES THAT ARE ATTACHED TO ARRIVED TRAILERS.  THE PROGRAM WILL *00140000
001500* DETERMINE TOTAL CARTON COUNTS FOR PBS ORDERS WITH RECEIVERS.   *00150000
001700******************************************************************00160000
W40392***************************************************************** 00170000
W40392*  CHANGE LOG.                                                    00180000
W40392*  DATE         CHANGED BY      DESC                              00190000
W40392*  -----------  -------------- ---------------------------------- 00200000
W40392*  10/07/2011   S. ANDERSON    EFC OPTIMIZATION AND HOLIDAY PREP  00210000
W40392*               (CODEWORKS)     - ADDITIONAL DATA NEEDED FOR      00220000
W40392*                                 SUMMARY REPORTS                 00230000
W40392*                              PROJ ID:   3253                    00240000
W40392*                              WR/IR#:   WR40392                  00250000
W40392*  RECOMPILE TO PICK UP CHANGES TO COPY PCRD068                   00260000
W40392***************************************************************** 00270000
001800******************************************************************00280000
001900 ENVIRONMENT DIVISION.                                            00290000
002000******************************************************************00300000
002100 CONFIGURATION SECTION.                                           00310000
002200 SOURCE-COMPUTER.        IBM-3090.                                00320000
002300 OBJECT-COMPUTER.        IBM-3090.                                00330000
002400                                                                  00340000
002500 INPUT-OUTPUT SECTION.                                            00350000
002600 FILE-CONTROL.                                                    00360000
002700                                                                  00370000
002800     SELECT INPUT-FILE                                            00380000
002900         ASSIGN TO INP01.                                         00390000
003000                                                                  00400000
003100     SELECT OUTPUT-FILE                                           00410000
003200         ASSIGN TO OUT01.                                         00420000
003300                                                                  00430000
003400******************************************************************00440000
003500 DATA DIVISION.                                                   00450000
003600******************************************************************00460000
003700                                                                  00470000
003800******************************************************************00480000
003900 FILE SECTION.                                                    00490000
004000******************************************************************00500000
004100 FD  INPUT-FILE                                                   00510000
004200     RECORDING MODE IS F                                          00520000
004300     LABEL RECORDS ARE STANDARD                                   00530000
004400     BLOCK CONTAINS 0 RECORDS                                     00540000
004500     DATA RECORD IS INPUT-RECORD.                                 00550000
004600                                                                  00560000
004700 01  INPUT-RECORD              PIC  X(400).                       00570000
004800                                                                  00580000
004900 FD  OUTPUT-FILE                                                  00590000
005000     RECORDING MODE IS F                                          00600000
005100     LABEL RECORDS ARE STANDARD                                   00610000
005200     BLOCK CONTAINS 0 RECORDS                                     00620000
005300     DATA RECORD IS OUTPUT-RECORD.                                00630000
005400                                                                  00640000
005500 01  OUTPUT-RECORD             PIC  X(400).                       00650000
005600                                                                  00660000
005700******************************************************************00670000
005800 WORKING-STORAGE SECTION.                                         00680000
005900******************************************************************00690000
006000 01  PS-PROGRAM-SWITCHES.                                         00700000
006100     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00710000
006200         88  PS-EOF-INPUT                        VALUE 'Y'.       00720000
006300         88  PS-NOT-EOF-INPUT                    VALUE 'N'.       00730000
006400                                                                  00740000
006900 01  PC-PROGRAM-CONSTANTS.                                        00750000
007000     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'PCKUT088'. 00760000
008100                                                                  00770000
008200 01  PV-PROGRAM-VARIABLES.                                        00780000
008300     05  PV-RECORDS-READ              PIC 9(09)  VALUE ZERO.      00790000
008400     05  PV-RECORDS-WRITTEN           PIC 9(09)  VALUE ZERO.      00800000
008410     05  PV-PBS-REC-NOT-WRITTEN       PIC 9(09)  VALUE ZERO.      00810000
008500     05  PV-RETRY-COUNTER             PIC S9(04) VALUE 0 COMP.    00820000
008600     05  PV-REMAINDER                 PIC 9(05) VALUE ZEROS.      00830000
008700     05  PV-SAVE-DC                   PIC 9(04) VALUE ZEROS.      00840000
008800     05  PV-DISPLAY-PO-NBR            PIC 9(09) VALUE ZEROS.      00850021
008900     05  PV-DISPLAY-RCVR-SEQ          PIC 9(04) VALUE ZEROS.      00860000
009000     05  PV-DISPLAY-LINE-NBR          PIC 9(04) VALUE ZEROS.      00870000
009100     05  PV-DISPLAY-OPER-UNT-ID       PIC 9(04) VALUE ZEROS.      00880000
009200     05  PV-DISPLAY-SEQ-NBR           PIC 9(04) VALUE ZEROS.      00890000
009300     05  PV-DISPLAY-DEPT-NBR          PIC 9(04) VALUE ZEROS.      00900000
009400     05  PV-DISPLAY-MAJ-CL-NBR        PIC 9(04) VALUE ZEROS.      00910000
009500     05  PV-DISPLAY-TRIP-ID           PIC 9(09) VALUE ZEROS.      00920000
009600     05  PV-DISPLAY-SHIP-UNT-ID       PIC 9(18) VALUE ZEROS.      00930000
009800     05  PV-MOD-NBR.                                              00940000
009900         10  FILLER                   PIC X(03) VALUE 'MOD'.      00950000
010000         10  PV-MOD-NBR-4-8           PIC X(05) VALUE SPACES.     00960000
010100     05  PV-ASSIGNMENT.                                           00970000
010200         10  PV-ASSIGNMENT-1-10       PIC X(10) VALUE SPACES.     00980000
010300         10  PV-ASSIGNMENT-11-15      PIC 9(05) VALUE ZEROS.      00990000
010400     05  PV-ASGMT-NBR-TXT.                                        01000000
010500         10 FILLER                    PIC X(04) VALUE SPACES.     01010000
010600         10 PV-ASGMT-NBR-TXT-5-10     PIC X(06) VALUE SPACES.     01020000
010700     05  PV-TOTAL-UNITS               PIC  9(09) VALUE 0.         01030000
010800     05  PV-SUM-UNITS                 PIC S9(09) VALUE 0 COMP.    01040000
010900     05  PV-SUM-CARTONS               PIC S9(09) VALUE 0 COMP.    01050000
011000     05  PV-PO-NBR                    PIC 9(09) VALUE ZEROS.      01060000
011100     05  PV-REC-SEQ                   PIC 9(03) VALUE ZEROS.      01070000
011200     05  PV-PO-LNE-NBR                PIC 9(03) VALUE ZEROS.      01080000
011300     05  PV-PBS-CRTN-CNT              PIC S9(09)  COMP.           01090000
011310     05  PV-TROUBLE-COUNT             PIC S9(09)  COMP.           01100000
011320     05  PV-UCC128-COUNT              PIC S9(09)  COMP.           01110000
011400                                                                  01120000
011500 01  PV-ABEND-FIELDS.                                             01130000
011600     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         01140000
011700                                                 COMP SYNC.       01150000
011800     05  PV-SQLCODE                   PIC  Z(08)9-.               01160000
011900     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01170000
012000     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01180000
012100     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01190000
012200     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01200000
012300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01210000
012400     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01220000
012500     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01230000
012600     05  PV-DB2-TABLE-NAME-1          PIC X(12)  VALUE SPACE.     01240000
012700     05  PV-DB2-TABLE-NAME-2          PIC X(12)  VALUE SPACE.     01250000
012800                                                                  01260000
012900 01  DK-DB-KEYS.                                                  01270000
013000     05 DK-PO-NBR                     PIC S9(09) COMP.            01280000
013100     05 DK-REC-SEQ-NBR                PIC S9(09) COMP.            01290000
013200     05 DK-TOT-CTN-CNT                PIC S9(09) COMP.            01300000
013300                                                                  01310000
013400******************************************************************01320000
013500*  DB2 FORMATTED MESSAGE AREA                                     01330000
013600******************************************************************01340000
013700     COPY DPWS004.                                                01350000
013800*                                                                 01360000
013900******************************************************************01370000
014000*  COPYBOOK PCRD068                                               01380000
014100******************************************************************01390000
014200     COPY PCRD068.                                                01400000
014300*                                                                 01410000
014400******************************************************************01420000
014500*    TINPKSU TABLE                                                01430000
014600******************************************************************01440000
014700     EXEC SQL                                                     01450000
014800          INCLUDE TINPKSU                                         01460000
014900     END-EXEC.                                                    01470000
015000                                                                  01480000
015100******************************************************************01490000
015200*    TPKSLIP TABLE                                                01500000
015300******************************************************************01510000
015400     EXEC SQL                                                     01520000
015500          INCLUDE TPKSLIP                                         01530000
015600     END-EXEC.                                                    01540000
015700                                                                  01550000
015710******************************************************************01560000
015720*    TTRBNTF TABLE                                                01570000
015730******************************************************************01580000
015740     EXEC SQL                                                     01590000
015750          INCLUDE TTRBNTF                                         01600000
015760     END-EXEC.                                                    01610000
015770                                                                  01620000
015780******************************************************************01630000
015790*    TTRBRSN TABLE                                                01640000
015791******************************************************************01650000
015792     EXEC SQL                                                     01660000
015793          INCLUDE TTRBRSN                                         01670000
015794     END-EXEC.                                                    01680000
015795                                                                  01690000
015796******************************************************************01700000
015797*    TTRBRCN TABLE                                                01710000
015798******************************************************************01720000
015799     EXEC SQL                                                     01730000
015800          INCLUDE TTRBRCN                                         01740000
015801     END-EXEC.                                                    01750000
015802                                                                  01760000
015803******************************************************************01770000
015804*    TSHUUPC TABLE                                                01780000
015805******************************************************************01790000
015806     EXEC SQL                                                     01800000
015807          INCLUDE TSHUUPC                                         01810000
015808     END-EXEC.                                                    01820000
015809                                                                  01830000
015810******************************************************************01840000
015900*  COMMUNICATIONS AREA FOR DB2                                    01850000
016000******************************************************************01860000
016100     EXEC SQL                                                     01870000
016200          INCLUDE SQLCA                                           01880000
016300     END-EXEC.                                                    01890000
016400                                                                  01900000
016500                                                                  01910000
016600******************************************************************01920000
016700 PROCEDURE DIVISION.                                              01930000
016800******************************************************************01940000
016900 0000-PROGRAM-MAINLINE.                                           01950000
017100                                                                  01960000
017200     OPEN INPUT  INPUT-FILE                                       01970000
017300          OUTPUT OUTPUT-FILE.                                     01980000
017400                                                                  01990000
017500     INITIALIZE OUTPUT-RECORD.                                    02000000
017700                                                                  02010000
017800     PERFORM 1000-READ-INPUT-FILE.                                02020000
017900                                                                  02030000
018000     PERFORM 2000-PROCESS-INPUT-FILE                              02040000
018100         UNTIL PS-EOF-INPUT.                                      02050000
018200                                                                  02060000
018300     PERFORM 9000-EOJ.                                            02070000
018400                                                                  02080000
018500     STOP RUN.                                                    02090000
018600                                                                  02100000
018700******************************************************************02110000
018800* READS RECORD FROM THE INPUT FILE                                02120000
018900******************************************************************02130000
019000 1000-READ-INPUT-FILE.                                            02140000
019100     MOVE '1000-READ-INPUT-FILE.'      TO  PV-ABEND-PARAGRAPH.    02150000
019200                                                                  02160000
019300     READ INPUT-FILE                                              02170000
019400          INTO PC068-RECORD-LAYOUT                                02180000
019500            AT END                                                02190000
019600               SET PS-EOF-INPUT     TO TRUE                       02200000
019700                                                                  02210000
019800            NOT AT END                                            02220000
019900               SET PS-NOT-EOF-INPUT TO TRUE                       02230000
020000               ADD +1 TO PV-RECORDS-READ                          02240000
020100     END-READ.                                                    02250000
020200                                                                  02260000
020300******************************************************************02270000
020400* PROCESS INPUT RECORDS                                          *02280000
020500******************************************************************02290000
020600 2000-PROCESS-INPUT-FILE.                                         02300000
020700     MOVE '2000-PROCESS-INPUT-FILE.'   TO PV-ABEND-PARAGRAPH.     02310000
020800                                                                  02320000
020900     MOVE PC068-PO-NBR             TO DK-PO-NBR.                  02330000
021000     MOVE PC068-REC-SEQ-NBR        TO DK-REC-SEQ-NBR.             02340000
021100     MOVE PC068-TOT-CTN-CNT        TO DK-TOT-CTN-CNT.             02350000
021200                                                                  02360000
021300     IF PC068-PBS-ORDER                                           02370000
021400        IF PC068-TRANSCRIBED                                      02380000
021500           IF PC068-REC-SEQ-NBR > 0                               02390000
021600              PERFORM 2500-GET-CARTON-COUNT                       02400000
021610              PERFORM 3000-GET-TROUBLE-COUNT                      02410000
021620              PERFORM 3500-GET-UCC128-IND                         02420000
021700              PERFORM 8000-LOAD-OUTPUT-DATA                       02430000
021800              PERFORM 8900-WRITE-OUTPUT-RECORD                    02440000
021900           END-IF                                                 02450000
021910        ELSE                                                      02460000
021920           ADD +1   TO PV-PBS-REC-NOT-WRITTEN                     02470000
022000        END-IF                                                    02480000
022100     ELSE                                                         02490000
022200        PERFORM 8000-LOAD-OUTPUT-DATA                             02500000
022300        PERFORM 8900-WRITE-OUTPUT-RECORD                          02510000
022400     END-IF.                                                      02520000
022500                                                                  02530000
022600     PERFORM 1000-READ-INPUT-FILE.                                02540000
022700                                                                  02550000
022800******************************************************************02560000
022900* GET CARTON COUNTS FOR PBS ORDERS                               *02570000
023000******************************************************************02580000
023100 2500-GET-CARTON-COUNT.                                           02590000
023200                                                                  02600000
023300      EXEC SQL                                                    02610000
023400         SELECT COUNT(*)                                          02620000
023500           INTO                                                   02630000
023600                 :PV-PBS-CRTN-CNT                                 02640000
023700           FROM TINPKSU B                                         02650000
023800              , TPKSLIP A                                         02660000
023900          WHERE A.PO_NBR      = :DK-PO-NBR                        02670000
024000            AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                   02680000
024100            AND A.PO_NBR      = B.PO_NBR                          02690000
024200            AND A.SEQ_NBR     = B.SEQ_NBR                         02700000
024300            AND VER_STAT_CDE  = 'A'                               02710000
024310           WITH UR                                                02720000
024400      END-EXEC                                                    02730000
024500                                                                  02740000
024600      EVALUATE TRUE                                               02750000
024700        WHEN SQLCODE = ZERO                                       02760000
      * TEST CODE USED TO VERIFY THE PO-NBR EXPANSION WORKS             02760124
      * COMMENTED OUT ON 10/14/2014                                     02760224
      * DRW START FOR TESTING ONLY                                      02760322
      *         MOVE DK-PO-NBR TO PV-DISPLAY-PO-NBR                     02760424
      *         MOVE DK-REC-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ              02760524
026854*         STRING ' PO/RCVR     '         DELIMITED BY SIZE        02761024
026855*                 PV-DISPLAY-PO-NBR      DELIMITED BY SIZE        02762024
026856*                 '/'                    DELIMITED BY SIZE        02763024
026857*                 PV-DISPLAY-RCVR-SEQ    DELIMITED BY SIZE        02764024
026858*                                INTO PV-DB2-OPERATION-MESSAGE-2  02765024
      *         DISPLAY PV-DB2-OPERATION-MESSAGE-2                      02766024
      * DRW END FOR TESTING ONLY                                        02767022
024800          CONTINUE                                                02770000
024900        WHEN SQLWARN0 NOT = SPACES                                02780000
025000        WHEN SQLCODE NOT = ZERO                                   02790000
025100          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          02800000
025200          MOVE DK-REC-SEQ-NBR       TO PV-DISPLAY-RCVR-SEQ        02810000
025300                                                                  02820000
025400          STRING ' PO/RCVR     '         DELIMITED BY SIZE        02830000
025500                  PV-DISPLAY-PO-NBR      DELIMITED BY SIZE        02840000
025600                  '/'                    DELIMITED BY SIZE        02850000
025700                  PV-DISPLAY-RCVR-SEQ    DELIMITED BY SIZE        02860000
025800                                 INTO PV-DB2-OPERATION-MESSAGE-2  02870000
025900          MOVE SQLCODE               TO PV-SQLCODE                02880000
026000          MOVE 'GET PBS CARTON COUNTS '                           02890000
026100                                    TO PV-DB2-OPERATION-MESSAGE-1 02900000
026200          MOVE 'TINPKSU '     TO PV-DB2-TABLE-NAME-1              02910000
026300          MOVE 'TPKSLIP '     TO PV-DB2-TABLE-NAME-2              02920000
026400          PERFORM 9999-SQL-ABEND                                  02930000
026500      END-EVALUATE.                                               02940000
026600                                                                  02950000
026710******************************************************************02960000
026720* GET TROUBLE COUNTS FOR PBS ORDERS                              *02970000
026730******************************************************************02980000
026740 3000-GET-TROUBLE-COUNT.                                          02990000
026750                                                                  03000000
026760      EXEC SQL                                                    03010000
026761         SELECT COUNT(*)                                          03020000
026762            INTO :PV-TROUBLE-COUNT                                03030000
026763            FROM TTRBNTF A                                        03040000
026764                ,TTRBRSN C                                        03050000
026765           WHERE A.PO_NBR       =  :DK-PO-NBR                     03060000
026766             AND A.REC_SEQ_NBR  =  :DK-REC-SEQ-NBR                03070000
026767             AND A.RESOLVED_IND IN ('N','I','R')                  03080000
026768             AND A.TRBL_RSN_CDE = C.TRBL_RSN_CDE                  03090000
026769             AND C.NOTIF_IND    =  'T'                            03100000
026770             AND NOT EXISTS                                       03110000
026771                ( SELECT *                                        03120000
026780                  FROM  TTRBRCN B                                 03130000
026790                  WHERE B.RPT_PGM_NM  = 'SUKRF502'                03140000
026791                    AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE )       03150000
026792           WITH UR                                                03160000
026798      END-EXEC                                                    03170000
026799                                                                  03180000
026800      EVALUATE TRUE                                               03190000
026801        WHEN SQLCODE = ZERO                                       03200000
026802          CONTINUE                                                03210000
026803        WHEN SQLWARN0 NOT = SPACES                                03220000
026804        WHEN SQLCODE NOT = ZERO                                   03230000
026805          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          03240000
026806          MOVE DK-REC-SEQ-NBR       TO PV-DISPLAY-RCVR-SEQ        03250000
026807                                                                  03260000
026808          STRING ' PO/RCVR     '         DELIMITED BY SIZE        03270000
026809                  PV-DISPLAY-PO-NBR      DELIMITED BY SIZE        03280000
026810                  '/'                    DELIMITED BY SIZE        03290000
026811                  PV-DISPLAY-RCVR-SEQ    DELIMITED BY SIZE        03300000
026812                                 INTO PV-DB2-OPERATION-MESSAGE-2  03310000
026813          MOVE SQLCODE               TO PV-SQLCODE                03320000
026814          MOVE 'GET PBS TROUBLE COUNTS '                          03330000
026815                                    TO PV-DB2-OPERATION-MESSAGE-1 03340000
026816          MOVE 'TTRBRSN '     TO PV-DB2-TABLE-NAME-1              03350000
026817          MOVE 'TPKSLIP '     TO PV-DB2-TABLE-NAME-2              03360000
026818          PERFORM 9999-SQL-ABEND                                  03370000
026819      END-EVALUATE.                                               03380000
026821                                                                  03390000
026822******************************************************************03400000
026823* SET THE UCC128 INDICATOR IF VALID                              *03410000
026824******************************************************************03420000
026825 3500-GET-UCC128-IND.                                             03430000
026826                                                                  03440000
026827      EXEC SQL                                                    03450000
026828         SELECT  COUNT(*)                                         03460000
026829           INTO  :PV-UCC128-COUNT                                 03470000
026830           FROM  TPKSLIP A                                        03480000
026831                ,TINPKSU B                                        03490000
026832                ,TSHUUPC C                                        03500000
026833          WHERE  A.PO_NBR         = :DK-PO-NBR                    03510000
026834            AND  A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR               03520000
026835            AND  A.VER_STAT_CDE   = 'A'                           03530000
026836            AND  A.PKSL_STAT_CDE  = 'AC'                          03540000
026837            AND  B.PO_NBR         = A.PO_NBR                      03550000
026838            AND  B.SEQ_NBR        = A.SEQ_NBR                     03560000
026839            AND  C.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                03570000
026840            AND  C.TRN_NBR        = B.PO_NBR                      03580000
026841            AND  C.TRN_LNE_NBR    > 0                             03590000
026842           WITH UR                                                03600000
026843      END-EXEC                                                    03610000
026844                                                                  03620000
026845      EVALUATE TRUE                                               03630000
026846        WHEN SQLCODE = ZERO                                       03640000
026847          CONTINUE                                                03650000
026849        WHEN SQLWARN0 NOT = SPACES                                03660000
026850        WHEN SQLCODE NOT = ZERO                                   03670000
026851          MOVE DK-PO-NBR            TO PV-DISPLAY-PO-NBR          03680000
026852          MOVE DK-REC-SEQ-NBR       TO PV-DISPLAY-RCVR-SEQ        03690000
026853                                                                  03700000
026854          STRING ' PO/RCVR     '         DELIMITED BY SIZE        03710000
026855                  PV-DISPLAY-PO-NBR      DELIMITED BY SIZE        03720000
026856                  '/'                    DELIMITED BY SIZE        03730000
026857                  PV-DISPLAY-RCVR-SEQ    DELIMITED BY SIZE        03740000
026858                                 INTO PV-DB2-OPERATION-MESSAGE-2  03750000
026859          MOVE SQLCODE               TO PV-SQLCODE                03760000
026860          MOVE 'GET UCC128 INDICATOR  '                           03770000
026861                                    TO PV-DB2-OPERATION-MESSAGE-1 03780000
026862          MOVE 'TPINKSU '     TO PV-DB2-TABLE-NAME-1              03790000
026863          MOVE 'TPKSLIP '     TO PV-DB2-TABLE-NAME-2              03800000
026864          PERFORM 9999-SQL-ABEND                                  03810000
026865      END-EVALUATE.                                               03820000
026866                                                                  03830000
026870 8000-LOAD-OUTPUT-DATA.                                           03840000
026900        EVALUATE TRUE                                             03850000
027000          WHEN PC068-PBS-ORDER                                    03860000
027100             IF PV-PBS-CRTN-CNT > 0                               03870000
027200                MOVE PV-PBS-CRTN-CNT TO PC068-TOT-CTN-CNT         03880000
027210                                        PC068-XDCK-CTN-CNT        03890000
027300             END-IF                                               03900000
027510             IF PV-TROUBLE-COUNT > 0                              03910000
027521                MOVE PC068-TOT-CTN-CNT TO PC068-TRBLE-CTN-LINE    03920000
027530             ELSE                                                 03930000
027540                MOVE 0                TO PC068-TRBLE-CTN-LINE     03940000
027550             END-IF                                               03950000
027560             IF PV-UCC128-COUNT > 0                               03960000
027570                MOVE 'Y'              TO PC068-UCC128-IND         03970000
027580             END-IF                                               03980000
027600          WHEN OTHER                                              03990000
027700             MOVE 0 TO PC068-TOT-CTN-CNT                          04000000
027701             MOVE 0 TO PC068-XDCK-CTN-CNT                         04010000
027710             MOVE 0 TO PC068-TRBLE-CTN-LINE                       04020000
027800        END-EVALUATE.                                             04030000
027900                                                                  04040000
028000******************************************************************04050000
028100* WRITES THE OUTPUT RECORDS                                      *04060000
028200******************************************************************04070000
028300 8900-WRITE-OUTPUT-RECORD.                                        04080000
028400     MOVE '9000-WRITE-OUTPUT-RECORD.'  TO PV-ABEND-PARAGRAPH.     04090000
028500                                                                  04100000
028600      WRITE OUTPUT-RECORD                                         04110000
028700           FROM PC068-RECORD-LAYOUT                               04120000
028800                                                                  04130000
028900      ADD  1  TO  PV-RECORDS-WRITTEN.                             04140000
029000                                                                  04150000
029100******************************************************************04160000
029200* END OF JOB ROUTINE                                             *04170000
029300******************************************************************04180000
029400 9000-EOJ.                                                        04190000
029500                                                                  04200000
029600     CLOSE INPUT-FILE                                             04210000
029700           OUTPUT-FILE.                                           04220000
029800                                                                  04230000
029900     DISPLAY ' RECORDS READ              ' PV-RECORDS-READ        04240000
030000     DISPLAY ' RECORDS WRITTEN           ' PV-RECORDS-WRITTEN.    04250000
030010     DISPLAY ' NON-TRANS PBS NOT WRITTEN ' PV-PBS-REC-NOT-WRITTEN.04260000
030100                                                                  04270000
030200******************************************************************04280000
030300* ABEND PROCEDURE                                                *04290000
030400******************************************************************04300000
030500 9999-SQL-ABEND.                                                  04310000
030600     DISPLAY '** ABEND           ** = SQLABEND'.                  04320000
030700     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          04330000
030800     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.       04340000
030900     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME-1.      04350000
031000     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME-2.      04360000
031100     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MESSAGE-104370000
031200     DISPLAY '**                 ** = ' PV-DB2-OPERATION-MESSAGE-204380000
031300     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               04390000
031400     COPY DPPD004.                                                04400000
031500     MOVE +4013                  TO PV-ABEND-CODE.                04410000
031600     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       04420000
031700                                                                  04430000
