000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    CEKUP006.                                         00030098
000400 AUTHOR.        JOE LAROSA.                                       00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  12/08/99.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000800******************************************************************00080051
000900*                 CENTRAL STOCK BATCH PROCESSING                 *00090012
001000* BATCH PROGRAM WILL UPDATE STATUSES ON THE CENTRAL STOCK TABLES *00100012
001100* FOR ITEMS THAT HAVE BEEN PULLED AND DISTRIBUTED, BUT NOT YET   *00110012
001200* POSTED.  THE PROGRAM WILL ALSO CREATE AN OUTPUT TABLE WITH ALL *00120012
001300* DISTRIBUTED ITEMS.  THE OUTPUT TABLE WILL BE USED IN CREATING  *00130012
001400* THE FASHION SALES AND MERCHANDISE LEDGER INTERFACE FILES.  THE *00140012
001500* OUTPUT TABLE WILL ALSO BE USED IN CREATING A REPORT EXTRACT    *00150012
001600* FILE FOR CE REPORTING PURPOSES.                                *00160012
001700*                                                                *00170051
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100                                                                  00210000
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220000
002300 SOURCE-COMPUTER.  IBM-3090.                                      00230000
002400                                                                  00240000
002500 INPUT-OUTPUT SECTION.                                            00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800******************************************************************00280000
002900 DATA DIVISION.                                                   00290000
003000 FILE SECTION.                                                    00300000
003100                                                                  00310000
003200 WORKING-STORAGE SECTION.                                         00320000
003300 01  PS-PROGRAM-SWITCHES.                                         00330000
003400     05  PS-ITM-CSR-DONE-SW           PIC  X(01) VALUE 'N'.       00340004
003500         88  PS-ITM-CSR-DONE-NO                  VALUE 'N'.       00350004
003600         88  PS-ITM-CSR-DONE-YES                 VALUE 'Y'.       00360004
003700     05  PS-STR-CSR-DONE-SW           PIC  X(01) VALUE 'N'.       00370004
003800         88  PS-STR-CSR-DONE-NO                  VALUE 'N'.       00380004
003900         88  PS-STR-CSR-DONE-YES                 VALUE 'Y'.       00390004
004000     05  PS-STS-CSR-DONE-SW           PIC  X(01) VALUE 'N'.       00400013
004100         88  PS-STS-CSR-DONE-NO                  VALUE 'N'.       00410013
004200         88  PS-STS-CSR-DONE-YES                 VALUE 'Y'.       00420013
004300     05  PS-MF-CSR-DONE-SW            PIC  X(01) VALUE 'N'.       00430051
004400         88  PS-MF-CSR-DONE-NO                   VALUE 'N'.       00440051
004500         88  PS-MF-CSR-DONE-YES                  VALUE 'Y'.       00450051
004600     05  PS-AU-CSR-DONE-SW            PIC  X(01) VALUE 'N'.       00460051
004700         88  PS-AU-CSR-DONE-NO                   VALUE 'N'.       00470051
004800         88  PS-AU-CSR-DONE-YES                  VALUE 'Y'.       00480051
004810     05  PS-AU-SUM-CSR-DONE-SW        PIC  X(01) VALUE 'N'.       00481075
004820         88  PS-AU-SUM-CSR-DONE-NO               VALUE 'N'.       00482075
004830         88  PS-AU-SUM-CSR-DONE-YES              VALUE 'Y'.       00483075
004900                                                                  00490000
005000 01  PC-PROGRAM-CONSTANTS.                                        00500001
005100     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'CEKUP006'.00510004
005200     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00520001
005300                                                 COMP SYNC.       00530001
005400     05  PC-CA                        PIC  X(02) VALUE 'CA'.      00540004
005500     05  PC-DS                        PIC  X(02) VALUE 'DS'.      00550004
005600     05  PC-PD                        PIC  X(02) VALUE 'PD'.      00560003
005700     05  PC-3SPACES                   PIC  X(03) VALUE SPACES.    00570055
005800     05  PC-SYSTEM-DATE               PIC  9(06) VALUE ZERO.      00580001
005900                                                                  00590001
006000 01  DK-DB-KEYS.                                                  00600031
006100     05  DK-REQ-PL-NBR                PIC S9(09) VALUE +0 COMP.   00610031
006200     05  DK-PL-LNE-NBR                PIC S9(04) VALUE +0 COMP.   00620031
006300     05  DK-ITM-NBR                   PIC S9(15)V VALUE ZEROES    00630053
006400                                                 COMP-3.          00640031
006500     05  DK-STR-NBR                   PIC S9(04) VALUE +0 COMP.   00650051
006600                                                                  00660051
006700 01  PV-PROGRAM-VARIABLES.                                        00670000
006800     05  PV-SQLCODE                   PIC  9(09) VALUE ZERO.      00680004
006900     05  PV-NULL-IND-1                PIC S9(04) VALUE +0         00690040
007000                                                 COMP.            00700040
007100     05  PV-NULL-IND-2                PIC S9(04) VALUE +0         00710040
007200                                                 COMP.            00720040
007300     05  PV-NULL-IND-3                PIC S9(04) VALUE +0         00730040
007400                                                 COMP.            00740040
007500     05  PV-BATCH-NMBR.                                           00750004
007600         10  FILLER                   PIC  X(02) VALUE '07'.      00760043
007700         10  PV-BATCH-DAY             PIC  X(02) VALUE SPACES.    00770004
007800     05  PV-BATCH-NMBR-2.                                         00780035
007900         10  FILLER                   PIC  X(01).                 00790035
008000         10  PV-EXPRT-PRC-BTCH-ID     PIC  X(03).                 00800036
008100     05  PV-STORE-NBR                 PIC  9(04) VALUE ZERO.      00810035
008200     05  PV-CEPLDS-DISTRB-QTY         PIC S9(09) VALUE +0 COMP.   00820041
008300     05  PV-CEPLMF-UNT-QTY            PIC S9(09) VALUE +0 COMP.   00830055
008400     05  PV-CEPLAU-BEF-QTY            PIC S9(09) VALUE +0 COMP.   00840055
008500     05  PV-CEPLAU-AFT-QTY            PIC S9(09) VALUE +0 COMP.   00850055
008600     05  PV-CEPLAU-DIF-QTY            PIC S9(09) VALUE +0 COMP.   00860057
008601     05  PV-CEPLAU-DIF-SUM-QTY        PIC S9(09) VALUE +0 COMP.   00860175
008610     05  PV-CEPLAU-ADJ-TOT-QTY        PIC S9(09) VALUE +0 COMP.   00861069
008700     05  PV-REQ-PL-NBR-PREV           PIC S9(09) VALUE +0 COMP.   00870057
008800     05  PV-PL-LNE-NBR-PREV           PIC S9(04) VALUE +0 COMP.   00880057
008810     05  PV-REQ-PL-NBR-PREV2          PIC S9(09) VALUE +0 COMP.   00881073
008820     05  PV-PL-LNE-NBR-PREV2          PIC S9(04) VALUE +0 COMP.   00882073
008900     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00890009
009000                                                 COMP SYNC.       00900004
009100     05  PV-DB2-COUNT                 PIC S9(9)  VALUE ZERO       00910004
009200                                                 COMP-3.          00920004
009300     05  PV-RECS-WRITTEN              PIC  9(6)  VALUE ZERO.      00930049
009400     05  PV-RECS-WRITTEN-O            PIC  9(6)  VALUE ZERO.      00940058
009500     05  PV-RECS-WRITTEN-M            PIC  9(6)  VALUE ZERO.      00950058
009600     05  PV-RECS-WRITTEN-A            PIC  9(6)  VALUE ZERO.      00960058
009700     05  PV-DISPLAY-REC               PIC  ZZZ,ZZ9.               00970056
009800     05  PV-CURRENT-DB2-DATE          PIC  X(10).                 00980004
009900     05  PV-CURR-DATE.                                            00990004
010000         10 PV-CURRENT-DB2-CCYY.                                  01000001
010100            15 PV-CURRENT-DB2-CC      PIC  9(02) VALUE 0.         01010004
010200            15 PV-CURRENT-DB2-YY      PIC  9(02) VALUE 0.         01020004
010300         10 FILLER                    PIC  X(01) VALUE '-'.       01030004
010400         10 PV-CURRENT-DB2-MM         PIC  9(02) VALUE 0.         01040004
010500         10 FILLER                    PIC  X(01) VALUE '-'.       01050004
010600         10 PV-CURRENT-DB2-DD         PIC  9(02) VALUE 0.         01060004
010700                                                                  01070004
010800      05 PV-EXTRACT-DATE              PIC  X(26) VALUE SPACE.     01080004
010900      05 FILLER  REDEFINES PV-EXTRACT-DATE.                       01090004
011000         10 PV-EXTRACT-DATE-YYYY      PIC  9999.                  01100004
011100         10 PV-EXTRACT-DATE-1ST       PIC  X.                     01110004
011200         10 PV-EXTRACT-DATE-MM        PIC  99.                    01120004
011300         10 PV-EXTRACT-DATE-2ND       PIC  X.                     01130004
011400         10 PV-EXTRACT-DATE-DD        PIC  99.                    01140004
011500         10 PV-EXTRACT-DATE-3RD       PIC  X.                     01150004
011600         10 PV-EXTRACT-TIMESTAMP      PIC  X(15).                 01160004
011700                                                                  01170004
011800      05 PV-CEPLST-DS-TMST            PIC  X(26) VALUE SPACE.     01180004
011900      05 FILLER  REDEFINES PV-CEPLST-DS-TMST.                     01190004
012000         10 PV-CEPLST-DS-DATE.                                    01200047
012100             15 PV-CEPLST-DS-TMST-CC  PIC  99.                    01210047
012200             15 PV-CEPLST-DS-TMST-YY  PIC  99.                    01220047
012300             15 PV-CEPLST-DS-TMST-1ST PIC  X.                     01230047
012400             15 PV-CEPLST-DS-TMST-MM  PIC  99.                    01240047
012500             15 PV-CEPLST-DS-TMST-2ND PIC  X.                     01250047
012600             15 PV-CEPLST-DS-TMST-DD  PIC  99.                    01260047
012700             15 PV-CEPLST-DS-TMST-3RD PIC  X.                     01270047
012800         10 PV-CEPLST-TIMESTAMP       PIC  X(15).                 01280004
012900                                                                  01290047
013000      05 PV-INV-START-TMST            PIC  X(26).                 01300048
013100      05 FILLER REDEFINES PV-INV-START-TMST.                      01310048
013200          10 PV-INV-START-DATE        PIC  X(10).                 01320047
013300          10 PV-INV-START-TIME        PIC  X(16).                 01330047
013400      05 PV-INV-STOP-TMST             PIC  X(26).                 01340048
013500      05 FILLER REDEFINES PV-INV-STOP-TMST.                       01350048
013600          10 PV-INV-STOP-DATE         PIC  X(10).                 01360047
013700          10 PV-INV-STOP-TIME         PIC  X(16).                 01370047
013800                                                                  01380000
013900 01  PV-ABEND-FIELDS.                                             01390001
014000     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01400001
014100                                                 COMP SYNC.       01410001
014200     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'CEKUP006'.01420001
014300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01430001
014400     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01440001
014500     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01450001
014600     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01460001
014700     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01470001
014800     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01480001
014900     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01490001
015000     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01500001
015100     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01510001
015200     05  PV-ABEND-PULL-REQ            PIC  9(09) VALUE ZEROES.    01520004
015300     05  PV-ABEND-PULL-LINE           PIC  9(04) VALUE ZEROES.    01530004
015400     05  PV-ABEND-PULL-ITEM           PIC  9(15) VALUE ZEROES.    01540004
015500     05  PV-ABEND-PULL-STR            PIC  9(04) VALUE ZEROES.    01550004
015600                                                                  01560001
015700*-----------------------------------------------------------------01570000
015800*  CENTRAL STOCK TRANSFER RECORD LAYOUT                           01580003
015900*-----------------------------------------------------------------01590000
016000     COPY CERD012.                                                01600098
016100                                                                  01610000
015700*-----------------------------------------------------------------01611086
015800*  LOGISTICS DOMAIN ITEM ACCESS MODULE LAYOUT                     01612086
015900*-----------------------------------------------------------------01613086
016000     COPY XLWS001.                                                01614086
016100                                                                  01615086
016200*-----------------------------------------------------------------01620000
016300*  CALENDAR ROUTINE WORKING STORAGE                               01630000
016400*-----------------------------------------------------------------01640000
016500     COPY DPWS500.                                                01650000
016600                                                                  01660000
016700*-----------------------------------------------------------------01670000
016800*  ABEND ROUTINE WORKING STORAGE                                  01680000
016900*-----------------------------------------------------------------01690000
017000     COPY DPWS004.                                                01700000
017100                                                                  01710000
017200*-----------------------------------------------------------------01720000
017300*  CENTRAL STOCK - REQUEST TABLE                                  01730000
017400*-----------------------------------------------------------------01740000
017500     EXEC SQL                                                     01750000
017600        INCLUDE TCEPLRQ                                           01760000
017700     END-EXEC.                                                    01770000
017800                                                                  01780000
017900*-----------------------------------------------------------------01790000
018000*  CENTRAL STOCK - LINE ITEM TABLE                                01800004
018100*-----------------------------------------------------------------01810000
018200     EXEC SQL                                                     01820000
018300        INCLUDE TCEPLIT                                           01830000
018400     END-EXEC.                                                    01840000
018500                                                                  01850000
018600*-----------------------------------------------------------------01860000
018700*  CENTRAL STOCK - STORE (DISTRIBUTION) TABLE                     01870000
018800*-----------------------------------------------------------------01880000
018900     EXEC SQL                                                     01890000
019000        INCLUDE TCEPLDS                                           01900000
019100     END-EXEC.                                                    01910000
019200                                                                  01920000
019300*-----------------------------------------------------------------01930000
019400*  CENTRAL STOCK - STATUS (AUDIT) TABLE                           01940000
019500*-----------------------------------------------------------------01950000
019600     EXEC SQL                                                     01960000
019700        INCLUDE TCEPLST                                           01970000
019800     END-EXEC.                                                    01980000
019900                                                                  01990000
020000*-----------------------------------------------------------------02000051
020100*  CENTRAL STOCK - MANIFEST TABLE                                 02010051
020200*-----------------------------------------------------------------02020051
020300     EXEC SQL                                                     02030051
020400        INCLUDE TCEPLMF                                           02040051
020500     END-EXEC.                                                    02050051
020600                                                                  02060051
020700*-----------------------------------------------------------------02070051
020800*  CENTRAL STOCK - ADJUSTMENT TABLE                               02080051
020900*-----------------------------------------------------------------02090051
021000     EXEC SQL                                                     02100051
021100        INCLUDE TCEPLAU                                           02110051
021200     END-EXEC.                                                    02120051
021300                                                                  02130051
021400*-----------------------------------------------------------------02140003
021500*  CENTRAL STOCK - TRANSFER TABLE                                 02150003
021600*-----------------------------------------------------------------02160003
021700     EXEC SQL                                                     02170003
021800        INCLUDE TCEOUT1                                           02180003
021900     END-EXEC.                                                    02190003
022000                                                                  02200003
022100*-----------------------------------------------------------------02210000
022200*  COMPANY CONTROL TABLE                                          02220000
022300*-----------------------------------------------------------------02230000
022400     EXEC SQL                                                     02240000
022500        INCLUDE TCOCNTL                                           02250000
022600     END-EXEC.                                                    02260000
022700                                                                  02270000
023500*-----------------------------------------------------------------02350047
023600*  RC - KOHLS TO RETEK PROCESSING PARAMETERS TABLE                02360050
023700*-----------------------------------------------------------------02370047
023800     EXEC SQL                                                     02380047
023900        INCLUDE TKRPRPM                                           02390047
024000     END-EXEC.                                                    02400047
024100                                                                  02410047
024200*-----------------------------------------------------------------02420047
024300* CENTRAL STOCK STATUS CSR                                        02430047
024400*   - GET STATUS BASED ON COMPARE OF RECORD TIMESTAMP TO RUNDATE. 02440047
024500*-----------------------------------------------------------------02450047
024600     EXEC SQL                                                     02460047
024700         DECLARE CEPLST-HOLD-CSR CURSOR WITH HOLD FOR             02470047
024800         SELECT  A.CNSTK_REQ_PL_NBR                               02480047
024900              ,  A.PL_LNE_NBR                                     02490047
025000              ,  A.CRE_TMST                                       02500047
025100              ,  A.STAT_CDE                                       02510047
025200           FROM  TCEPLST A                                        02520047
025300          WHERE  A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR              02530047
025400            AND  A.PL_LNE_NBR       = :DK-PL-LNE-NBR              02540047
025500            AND  A.CRE_TMST        <= :PV-EXTRACT-DATE            02550062
025600            AND  A.STAT_CDE         = :PC-DS                      02560047
025700       ORDER BY  A.CRE_TMST DESC                                  02570047
025800     END-EXEC.                                                    02580047
025900                                                                  02590047
026000*-----------------------------------------------------------------02600047
026100* CENTRAL STOCK ITEM CSR                                          02610047
026200*   - SELECT ALL ITEMS THAT ARE ELIGIBLE TO BE POSTED.            02620047
026300*-----------------------------------------------------------------02630047
026400     EXEC SQL                                                     02640047
026500         DECLARE CEPLIT-HOLD-CSR CURSOR WITH HOLD FOR             02650047
026600          SELECT A.CNSTK_REQ_PL_NBR                               02660047
026700               , A.PL_LNE_NBR                                     02670047
026800               , A.ITM_NBR                                        02680047
026900               , A.STAT_CDE                                       02690047
027000               , A.UNT_RTL_AMT                                    02700047
027100               , A.EXPRT_PRC_BTCH_ID                              02710047
027200            FROM TCEPLIT A                                        02720047
027300           WHERE A.STAT_CDE = :PC-DS                              02730047
027400        FOR UPDATE OF STAT_CDE                                    02740047
027500                    , EXPRT_PRC_BTCH_ID                           02750047
027600     END-EXEC.                                                    02760047
027700                                                                  02770047
027800*-----------------------------------------------------------------02780047
027900* CENTRAL STOCK STORE CSR                                         02790047
028000*   - SELECT ALL STORES UNDER THE CURRENT ITEM                    02800047
028100*-----------------------------------------------------------------02810047
028200     EXEC SQL                                                     02820047
028300         DECLARE CEPLDS-CSR CURSOR FOR                            02830047
028400          SELECT A.STR_NBR                                        02840047
028500               , A.REQ_ORD_QTY                                    02850047
028600               , A.ACTL_DISTRB_QTY                                02860047
028700            FROM TCEPLDS A                                        02870047
028800           WHERE A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR              02880047
028900             AND A.PL_LNE_NBR       = :DK-PL-LNE-NBR              02890047
029000             AND A.ACTL_DISTRB_QTY  > 0                           02900047
029100        ORDER BY A.STR_NBR                                        02910047
029200     END-EXEC.                                                    02920047
029300                                                                  02930047
029400*-----------------------------------------------------------------02940051
029500* CENTRAL STOCK MANIFEST CSR                                      02950051
029600*   - SELECT ALL TABLE ENTRIES WHERE EXPRT_PRC_BTCH_ID = SPACES   02960051
029700*-----------------------------------------------------------------02970051
029800     EXEC SQL                                                     02980051
029900         DECLARE CEPLMF-CSR CURSOR FOR                            02990051
030000          SELECT CNSTK_REQ_PL_NBR                                 03000051
030100               , PL_LNE_NBR                                       03010051
030200               , STR_NBR                                          03020051
030400               , SUM(MFST_UNT_QTY)                                03040062
030700            FROM TCEPLMF                                          03070051
030800           WHERE EXPRT_PRC_BTCH_ID = '   '                        03080051
030810            AND  MFST_TMST         <= :PV-EXTRACT-DATE            03081062
030820        GROUP BY CNSTK_REQ_PL_NBR                                 03082062
030830               , PL_LNE_NBR                                       03083062
030840               , STR_NBR                                          03084062
030900        ORDER BY CNSTK_REQ_PL_NBR                                 03090056
031000               , PL_LNE_NBR                                       03100056
031100               , STR_NBR                                          03110056
031200     END-EXEC.                                                    03120051
031300                                                                  03130051
031400*-----------------------------------------------------------------03140051
031500* CENTRAL STOCK ADJUSTMENT CSR                                    03150051
031600*   - SELECT ALL TABLE ENTRIES WHERE EXPRT_PRC_BTCH_ID = SPACES   03160051
031700*-----------------------------------------------------------------03170051
031800     EXEC SQL                                                     03180051
031900         DECLARE CEPLAU-CSR CURSOR FOR                            03190051
032000          SELECT CNSTK_REQ_PL_NBR                                 03200051
032100               , PL_LNE_NBR                                       03210051
032200               , STR_NBR                                          03220051
032400               , SUM(AFT_ADJ_UNT_QTY - BEF_ADJ_UNT_QTY), 'A'      03240081
032900            FROM TCEPLAU                                          03290051
033000           WHERE EXPRT_PRC_BTCH_ID = '   '                        03300051
033010            AND  ADJ_TMST          <= :PV-EXTRACT-DATE            03301062
033100        GROUP BY CNSTK_REQ_PL_NBR                                 03310063
033200               , PL_LNE_NBR                                       03320056
033300               , STR_NBR                                          03330056
033301          HAVING SUM(AFT_ADJ_UNT_QTY - BEF_ADJ_UNT_QTY) < 0       03330182
033302        UNION ALL                                                 03330281
033303          SELECT CNSTK_REQ_PL_NBR                                 03330381
033304               , PL_LNE_NBR                                       03330481
033305               , STR_NBR                                          03330581
033306               , SUM(AFT_ADJ_UNT_QTY - BEF_ADJ_UNT_QTY), 'B'      03330681
033307            FROM TCEPLAU                                          03330781
033308           WHERE EXPRT_PRC_BTCH_ID = '   '                        03330881
033309            AND  ADJ_TMST          <= :PV-EXTRACT-DATE            03330981
033310        GROUP BY CNSTK_REQ_PL_NBR                                 03331081
033311               , PL_LNE_NBR                                       03331181
033312               , STR_NBR                                          03331281
033313          HAVING SUM(AFT_ADJ_UNT_QTY - BEF_ADJ_UNT_QTY) >= 0      03331382
033320        ORDER BY 5, 1, 2, 3                                       03332082
033400     END-EXEC.                                                    03340051
033410                                                                  03341075
033420*-----------------------------------------------------------------03342075
033430* CENTRAL STOCK ADJUSTMENT SUMMARY CURSOR                         03343075
033440*   - WILL ONLY BE USED TO ACCUMULATE THE TOTAL NUMBER OF UNITS   03344075
033441*     ADJUSTED FROM THE DC FOR ALL STORES FOR A LINE              03344175
033450*-----------------------------------------------------------------03345075
033460     EXEC SQL                                                     03346075
033470         DECLARE CEPLAU-TOT-CSR CURSOR FOR                        03347075
033492          SELECT SUM(AFT_ADJ_UNT_QTY - BEF_ADJ_UNT_QTY)           03349275
033493            FROM TCEPLAU                                          03349375
033494           WHERE EXPRT_PRC_BTCH_ID = '   '                        03349475
033495            AND  ADJ_TMST          <= :PV-EXTRACT-DATE            03349575
033496            AND  CNSTK_REQ_PL_NBR  = :DK-REQ-PL-NBR               03349675
033497            AND  PL_LNE_NBR        = :DK-PL-LNE-NBR               03349775
033498        GROUP BY CNSTK_REQ_PL_NBR                                 03349875
033499               , PL_LNE_NBR                                       03349975
033500               , STR_NBR                                          03350075
033501        HAVING  SUM(AFT_ADJ_UNT_QTY - BEF_ADJ_UNT_QTY) > 0        03350175
033502        ORDER BY 1                                                03350276
033503     END-EXEC.                                                    03350375
033510                                                                  03351075
033600*-----------------------------------------------------------------03360047
033700*  DB2 COMMUNICATION AREA                                         03370047
033800*-----------------------------------------------------------------03380047
033900     EXEC SQL                                                     03390047
034000        INCLUDE SQLCA                                             03400047
034100     END-EXEC.                                                    03410047
034200                                                                  03420051
034300/*****************************************************************03430051
034400 PROCEDURE DIVISION.                                              03440047
034500******************************************************************03450047
034600     DISPLAY '**** START OF CEKUP006 ****'.                       03460083
034700                                                                  03470047
034800     PERFORM 1000-INITIALIZATION.                                 03480047
034900                                                                  03490047
035000************                                                      03500051
035100*  ONLINE  *                                                      03510051
035200************                                                      03520051
035300*GET FIRST QUALIFIED CEPLIT TABLE ENTRY.                          03530047
035400     PERFORM 2100-FETCH-CEPLIT-CSR.                               03540047
035500     MOVE DK-REQ-PL-NBR TO PV-REQ-PL-NBR-PREV.                    03550047
035600                                                                  03560047
035700*PROCESS REMAINING QUALIFIED CEPLIT TABLE ENTRIES.                03570047
035800     PERFORM 2000-PROCESS-CEPLIT                                  03580047
035900       UNTIL PS-ITM-CSR-DONE-YES.                                 03590047
036000                                                                  03600047
036100*CLOSE CEPLIT CURSOR.                                             03610047
036200     PERFORM 3000-CLOSE-CEPLIT-CSR.                               03620047
036300                                                                  03630047
036400************                                                      03640051
036500* MANIFEST *                                                      03650051
036600************                                                      03660051
036700*OPEN 2ND PROCESSING CURSOR (MANIFEST).                           03670051
036800     SET PS-MF-CSR-DONE-NO TO TRUE.                               03680051
036900     MOVE ZEROES TO PV-REQ-PL-NBR-PREV                            03690057
037000                    PV-PL-LNE-NBR-PREV.                           03700057
037100     PERFORM 4000-OPEN-CEPLMF-CSR.                                03710051
037200                                                                  03720051
037300*GET FIRST QUALIFIED CEPLMF TABLE ENTRY.                          03730051
037400     PERFORM 4100-FETCH-CEPLMF-CSR.                               03740051
037500                                                                  03750051
037600*PROCESS QUALIFIED CEPLMF TABLE ENTRIES.                          03760051
037700     PERFORM 4300-PROCESS-CEPLMF                                  03770051
037800       UNTIL PS-MF-CSR-DONE-YES.                                  03780051
037900                                                                  03790051
038000*CLOSE 2ND PROCESSING CURSOR.                                     03800051
038100     PERFORM 4200-CLOSE-CEPLMF-CSR.                               03810051
038200                                                                  03820051
038300**************                                                    03830051
038400* ADJUSTMENT *                                                    03840051
038500**************                                                    03850051
038600*OPEN 3RD PROCESSING CURSOR (ADJUSTMENTS).                        03860051
038700     SET PS-AU-CSR-DONE-NO TO TRUE.                               03870051
038800     MOVE ZEROES TO PV-REQ-PL-NBR-PREV                            03880057
038900                    PV-PL-LNE-NBR-PREV.                           03890057
039000     PERFORM 5000-OPEN-CEPLAU-CSR.                                03900051
039100                                                                  03910051
039200*GET FIRST QUALIFIED CEPLAU TABLE ENTRY.                          03920051
039300     PERFORM 5100-FETCH-CEPLAU-CSR.                               03930051
039400                                                                  03940051
039500*PROCESS QUALIFIED CEPLAU TABLE ENTRIES.                          03950051
039600     PERFORM 5300-PROCESS-CEPLAU                                  03960051
039700       UNTIL PS-AU-CSR-DONE-YES.                                  03970051
039800                                                                  03980051
039900*CLOSE 3RD PROCESSING CURSOR.                                     03990051
040000     PERFORM 5200-CLOSE-CEPLAU-CSR.                               04000051
040100                                                                  04010051
040200                                                                  04020051
040300     DISPLAY '  ** RECORDS WRITTEN TO TCEOUT1 (ONLINE)   = '      04030058
040400             PV-RECS-WRITTEN-O.                                   04040058
040500     DISPLAY '  ** RECORDS WRITTEN TO TCEOUT1 (MANIFEST) = '      04050058
040600             PV-RECS-WRITTEN-M.                                   04060058
040700     DISPLAY '  ** RECORDS WRITTEN TO TCEOUT1 (ADJUST)   = '      04070058
040800             PV-RECS-WRITTEN-A.                                   04080058
040900     DISPLAY '  ** TOTAL NBR RECORDS WRITTEN TO TCEOUT1  = '      04090058
041000             PV-RECS-WRITTEN.                                     04100058
041100     DISPLAY ' '.                                                 04110055
041200     DISPLAY '****  END OF CEKUP006  ****'.                       04120055
041300     GOBACK.                                                      04130047
041400                                                                  04140047
041500******************************************************************04150047
041600 1000-INITIALIZATION.                                             04160047
041700******************************************************************04170047
041800     MOVE '1000-INITIALIZATION     ' TO PV-ABEND-PARAGRAPH.       04180047
041900                                                                  04190047
042000     ACCEPT PC-SYSTEM-DATE FROM DATE.                             04200047
042100                                                                  04210047
042200*GET EXTRACT DATE.                                                04220047
042300     EXEC SQL                                                     04230047
042400         SELECT  BTCH_PRC_DTE                                     04240047
042500           INTO  :PV-CURRENT-DB2-DATE                             04250047
042600           FROM  TCOCNTL                                          04260047
042700          WHERE  OPER_UNT_ID = 90                                 04270047
042800     END-EXEC.                                                    04280047
042900                                                                  04290047
043000     EVALUATE TRUE                                                04300047
043100       WHEN SQLCODE = ZERO                                        04310047
043200           MOVE PV-CURRENT-DB2-DATE   TO PV-CURR-DATE             04320047
043300           MOVE PV-CURRENT-DB2-CCYY   TO PV-EXTRACT-DATE-YYYY     04330047
043400           MOVE PV-CURRENT-DB2-MM     TO PV-EXTRACT-DATE-MM       04340047
043500           MOVE PV-CURRENT-DB2-DD     TO PV-EXTRACT-DATE-DD       04350047
043600           MOVE '-'                   TO PV-EXTRACT-DATE-1ST      04360047
043700                                         PV-EXTRACT-DATE-2ND      04370047
043800                                         PV-EXTRACT-DATE-3RD      04380047
043900           MOVE '23.59.59.999999'     TO PV-EXTRACT-TIMESTAMP     04390047
044000                                                                  04400099
044100       WHEN OTHER                                                 04410047
044200           MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH       04420047
044300           MOVE 'TCOCNTL'      TO PV-DB2-TABLE-NAME               04430047
044400           MOVE 'EXTRACT DATE' TO PV-DB2-OPERATION-MESSAGE-1      04440047
044500           PERFORM Z999-SQL-ABEND                                 04450047
044600     END-EVALUATE.                                                04460047
044700                                                                  04470047
044800     DISPLAY '  **** PV-EXTRACT-DATE = ' PV-EXTRACT-DATE.         04480047
044900                                                                  04490047
045000*GET INVENTORY PERIOD START/STOP DATES.                           04500047
045100     EXEC SQL                                                     04510047
045200         SELECT  FUNC_BEG_TMST                                    04520047
045300              ,  FUNC_END_TMST                                    04530047
045400           INTO  :PV-INV-START-TMST                               04540047
045500              ,  :PV-INV-STOP-TMST                                04550047
045600           FROM  TKRPRPM A                                        04560047
045700          WHERE  A.SYS_PRC_FUNC_CDE  = 'CSINDT'                   04570047
045710            AND  A.LOC_ID = 90                                    04571080
045720            AND  A.INTFC_SYS_CDE = 'KHL'                          04572080
045800     END-EXEC.                                                    04580047
045900                                                                  04590047
046000     EVALUATE TRUE                                                04600047
046100       WHEN SQLCODE = ZERO                                        04610047
046200           CONTINUE                                               04620047
046300                                                                  04630047
046400       WHEN OTHER                                                 04640047
046500           MOVE '1000-INITIALIZATION' TO PV-ABEND-PARAGRAPH       04650047
046600           MOVE 'TCOCNTL'      TO PV-DB2-TABLE-NAME               04660047
046700           MOVE 'GET INV DATE' TO PV-DB2-OPERATION-MESSAGE-1      04670047
046800           PERFORM Z999-SQL-ABEND                                 04680047
046900     END-EVALUATE.                                                04690047
047000                                                                  04700047
047100     DISPLAY ' '.                                                 04710047
047200     DISPLAY '  **** INV START DATE = ' PV-INV-START-DATE.        04720047
047300     DISPLAY '  **** INV STOP  DATE = ' PV-INV-STOP-DATE.         04730047
047400     DISPLAY ' '.                                                 04740047
047500                                                                  04750047
047600*COMPARE EXTRACT DATE TO INVENTORY DATES.  IF EXTRACT DATE IS     04760047
047700*WITHIN INVENTORY PERIOD, STOP (DO NOT PROCESS ANY ITEMS).        04770047
047800     IF  (PV-CURRENT-DB2-DATE < PV-INV-START-DATE)                04780080
047900     OR  (PV-CURRENT-DB2-DATE > PV-INV-STOP-DATE)                 04790080
048000         CONTINUE                                                 04800047
048100     ELSE                                                         04810047
048200         DISPLAY '*** ===> CEKUP006 STOPPED <==== ***'            04820047
048300         DISPLAY '*** EXTRACT DATE WITHIN INVENTORY PERIOD ***'   04830047
048400         GOBACK                                                   04840047
048500     END-IF.                                                      04850047
048600                                                                  04860047
048700*SET ACCUMULATORS.                                                04870058
048800     MOVE ZEROES TO PV-RECS-WRITTEN                               04880058
048900                    PV-RECS-WRITTEN-O                             04890058
049000                    PV-RECS-WRITTEN-M                             04900058
049100                    PV-RECS-WRITTEN-A.                            04910058
049200                                                                  04920058
049300*SET PROCESSING SWITCH.                                           04930047
049400     SET PS-ITM-CSR-DONE-NO TO TRUE.                              04940047
049500                                                                  04950047
049600*OPEN 1ST PROCESSING CURSOR (ONLINE).                             04960051
049700     PERFORM 1100-OPEN-CEPLIT-CSR.                                04970047
049800                                                                  04980047
049900*INITIALIZE REQUEST KEY HOLDER.                                   04990047
050000     MOVE ZEROES TO PV-REQ-PL-NBR-PREV.                           05000047
050100                                                                  05010047
050200***************************************************************** 05020047
050300 1100-OPEN-CEPLIT-CSR.                                            05030047
050400***************************************************************** 05040047
050500     MOVE '1100-OPEN-CEPLIT-CSR' TO PV-ABEND-PARAGRAPH.           05050047
050600                                                                  05060047
050700     EXEC SQL                                                     05070047
050800         OPEN CEPLIT-HOLD-CSR                                     05080047
050900     END-EXEC.                                                    05090047
051000                                                                  05100047
051100     EVALUATE TRUE                                                05110047
051200       WHEN SQLCODE = +0                                          05120047
051300           CONTINUE                                               05130047
051400                                                                  05140047
051500       WHEN SQLWARN0 NOT = SPACE                                  05150047
051600       WHEN SQLCODE  NOT = +0                                     05160047
051700           SET PS-ITM-CSR-DONE-YES TO TRUE                        05170047
051800           MOVE '1100-OPEN-CEPLIT-CSR' TO PV-ABEND-PARAGRAPH      05180047
051900           MOVE 'TCEPLIT'     TO PV-DB2-TABLE-NAME                05190047
052000           MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1       05200047
052100           PERFORM Z999-SQL-ABEND                                 05210047
052200     END-EVALUATE.                                                05220047
052300                                                                  05230047
052400***************************************************************** 05240047
052500 2000-PROCESS-CEPLIT.                                             05250047
052600***************************************************************** 05260047
052700     MOVE '2000-PROCESS-CEPLIT    ' TO PV-ABEND-PARAGRAPH.        05270047
052800                                                                  05280047
052900*CHECK LATEST STATUS RECORD FOR REQUEST/LINE.                     05290047
053000     SET PS-STS-CSR-DONE-NO TO TRUE.                              05300047
053100     PERFORM 2500-OPEN-CEPLST-CSR.                                05310047
053200     PERFORM 2600-FETCH-CEPLST-CSR.                               05320047
053300     PERFORM 2700-CLOSE-CEPLST-CSR.                               05330047
053400                                                                  05340047
053500     IF CEPLST-STAT-CDE = 'DS'                                    05350047
053600         PERFORM 2200-INSERT-TCEOUT1                              05360047
053700         ADD 1 TO PV-RECS-WRITTEN                                 05370049
053800                  PV-RECS-WRITTEN-O                               05380058
053900         PERFORM 2300-UPDATE-TCEPLIT                              05390047
054000         PERFORM 2400-INSERT-TCEPLST                              05400047
054100     END-IF.                                                      05410047
054200                                                                  05420047
054300*GET NEXT QUALIFIED CEPLIT TABLE ENTRY.                           05430047
054400     PERFORM 2100-FETCH-CEPLIT-CSR.                               05440047
054500                                                                  05450047
054600*AFTER PROCESSING ALL CEPLIT, CHECK CEPLRQ FOR UPDATES.           05460047
054700     IF PS-ITM-CSR-DONE-YES                                       05470047
054800       OR PV-REQ-PL-NBR-PREV NOT = DK-REQ-PL-NBR                  05480047
054900         PERFORM 2800-PROCESS-CEPLRQ                              05490047
055000     END-IF.                                                      05500047
055100                                                                  05510047
055200*AFTER PROCESSING CEPLIT, SAVE PREVIOUS REQUEST NUMBER.           05520047
055300     IF PS-ITM-CSR-DONE-NO                                        05530047
055400         MOVE DK-REQ-PL-NBR TO PV-REQ-PL-NBR-PREV                 05540047
055500     END-IF.                                                      05550047
055600                                                                  05560047
055700***************************************************************** 05570047
055800 2100-FETCH-CEPLIT-CSR.                                           05580047
055900***************************************************************** 05590047
056000     MOVE '2100-FETCH-CEPLIT-CSR  ' TO PV-ABEND-PARAGRAPH.        05600047
056100                                                                  05610047
056200     EXEC SQL                                                     05620047
056300         FETCH  CEPLIT-HOLD-CSR                                   05630047
056400          INTO :CEPLIT-CNSTK-REQ-PL-NBR                           05640047
056500             , :CEPLIT-PL-LNE-NBR                                 05650047
056600             , :CEPLIT-ITM-NBR                                    05660047
056700             , :CEPLIT-STAT-CDE                                   05670047
056800             , :CEPLIT-UNT-RTL-AMT                                05680047
056900             , :CEPLIT-EXPRT-PRC-BTCH-ID                          05690047
057000     END-EXEC.                                                    05700047
057100                                                                  05710047
057200     EVALUATE TRUE                                                05720047
057300       WHEN SQLCODE = +0                                          05730047
057400           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO DK-REQ-PL-NBR          05740047
057500           MOVE CEPLIT-PL-LNE-NBR       TO DK-PL-LNE-NBR          05750047
057600           MOVE CEPLIT-ITM-NBR          TO DK-ITM-NBR             05760047
057700                                                                  05770047
057800*          MOVE SPACES TO PV-DB2-OPERATION-MESSAGE-1              05780047
057900*          MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      05790047
058000*          MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     05800047
058100*          MOVE CEPLIT-ITM-NBR          TO PV-ABEND-PULL-ITEM     05810047
058200*          STRING '2100-FETCH (IT) PULL USING - '                 05820047
058300*                 PV-ABEND-PULL-REQ ' / '                         05830047
058400*                 PV-ABEND-PULL-LINE ' / '                        05840047
058500*                 PV-ABEND-PULL-ITEM ' / '                        05850047
058600*                 CEPLIT-STAT-CDE                                 05860047
058700*            DELIMITED BY SIZE                                    05870047
058800*            INTO PV-DB2-OPERATION-MESSAGE-1                      05880047
058900*          DISPLAY PV-DB2-OPERATION-MESSAGE-1                     05890047
059000                                                                  05900047
059100       WHEN SQLCODE = +100                                        05910047
059200           SET PS-ITM-CSR-DONE-YES TO TRUE                        05920047
059300           MOVE ZEROES             TO DK-REQ-PL-NBR               05930047
059400                                                                  05940047
059500       WHEN SQLWARN0 NOT = SPACE                                  05950047
059600       WHEN SQLCODE  NOT = +0                                     05960047
059700           MOVE '2100-FETCH-PROCESS-CSR' TO PV-ABEND-PARAGRAPH    05970047
059800           MOVE 'FETCH   '               TO PV-ABEND-OPERATION    05980047
059900           MOVE 'TCEPLIT '               TO PV-DB2-TABLE-NAME     05990047
060000           PERFORM Z999-SQL-ABEND                                 06000047
060100     END-EVALUATE.                                                06010047
060200                                                                  06020047
060300***************************************************************** 06030047
060400 2200-INSERT-TCEOUT1.                                             06040047
060500***************************************************************** 06050047
060600     MOVE '2200-INSERT-TCEOUT1    ' TO PV-ABEND-PARAGRAPH.        06060047
060700                                                                  06070047
060800*GET REQUESTED PULL INFO.                                         06080047
060900     PERFORM 2210-GET-REQ.                                        06090047
061000                                                                  06100047
061100*GET ASSOCIATED SKU INFO.                                         06110047
061200     PERFORM 2220-GET-SKU.                                        06120047
061300                                                                  06130047
061400*INIT/LOAD CENTRAL STOCK TRANSFER RECORD.                         06140047
061500     INITIALIZE CE012-CENTRAL-STK-XFER-RECORD.                    06150047
061600                                                                  06160047
061700     MOVE PV-CURRENT-DB2-DATE     TO CE012-BTCH-PRC-DTE.          06170047
061800     MOVE CEPLIT-CNSTK-REQ-PL-NBR TO CE012-PULL-NBR.              06180047
061900     MOVE CEPLIT-PL-LNE-NBR       TO CE012-PULL-LNE-NBR.          06190047
062000                                                                  06200047
062100*  FILL CE012-BATCH-NMBR.                                         06210047
062200     MOVE PV-CURRENT-DB2-DD       TO PV-BATCH-DAY.                06220047
062300     MOVE PV-BATCH-NMBR           TO CE012-BATCH-NMBR             06230047
062400                                     PV-BATCH-NMBR-2.             06240047
062500                                                                  06250047
062600*  FILL CE012-SKU-A.                                              06260085
062700     MOVE XL001-DEPT-NBR-3CH      TO CE012-DEPT.                  06270086
062800     MOVE XL001-SUB-CL-NBR-2CH    TO CE012-CLASS.                 06280099
062900     MOVE XL001-SKU-NBR           TO CE012-SKU-NBR.               06290099
063000                                                                  06300047
063100*  FILL CE012-FILLED-DATE-MMDDCCYY.                               06310047
063200     MOVE PV-CURRENT-DB2-DATE  TO PV-CEPLST-DS-DATE.              06320047
063300     MOVE PV-CEPLST-DS-TMST-MM TO CE012-FILLED-DATE-MMDDCCYY-MM.  06330047
063400     MOVE PV-CEPLST-DS-TMST-DD TO CE012-FILLED-DATE-MMDDCCYY-DD.  06340047
063500     MOVE PV-CEPLST-DS-TMST-CC TO CE012-FILLED-DATE-MMDDCCYY-CC.  06350047
063600     MOVE PV-CEPLST-DS-TMST-YY TO CE012-FILLED-DATE-MMDDCCYY-YY.  06360047
063700                                                                  06370047
063800*  FILL CE012-DC-STORE-NMBR FROM PULL REQUEST (CEPLRQ).           06380047
063900     MOVE CEPLRQ-CNSTK-LOC-ID     TO CE012-DC-STORE-NMBR.         06390047
064000                                                                  06400047
064100*  FILL CE012-TOTAL-QTY FROM ACCUMMULATED STORE DISTRIBUTED QTY.  06410047
064200     PERFORM 2230-ACCUM-STR-QTY.                                  06420047
064300     MOVE PV-CEPLDS-DISTRB-QTY    TO CE012-TOTAL-QTY.             06430047
064400                                                                  06440047
064500*  FILL CE012-UNIT-PRICE FROM SKU                                 06450099
064600     IF CEPLIT-UNT-RTL-AMT EQUAL 0.00                             06460086
  4700         MOVE 0.01                TO CE012-UNIT-PRICE             06470086
064800     ELSE                                                         06480047
064900         MOVE CEPLIT-UNT-RTL-AMT  TO CE012-UNIT-PRICE             06490051
065000     END-IF.                                                      06500051
065100                                                                  06510047
065200*  FILL CE012-SOURCE-CDE (FROM ONLINE).                           06520051
065300     SET CE012-ONLINE-SOURCE      TO TRUE.                        06530051
065400                                                                  06540051
065500*  INSERT A TCEOUT1 RECORD FOR EVERY STORE FOUND UNDER THE ITEM.  06550047
065600     SET PS-STR-CSR-DONE-NO TO TRUE.                              06560047
065700     PERFORM 2240-OPEN-STR-CSR.                                   06570047
065800                                                                  06580047
065900     PERFORM 2250-FETCH-STR-CSR.                                  06590047
066000                                                                  06600047
066100     PERFORM 2260-PROCESS-CEPLDS                                  06610047
066200       UNTIL PS-STR-CSR-DONE-YES.                                 06620047
066300                                                                  06630047
066400     PERFORM 2270-CLOSE-STR-CSR.                                  06640047
066500                                                                  06650047
066600***************************************************************** 06660047
066700 2210-GET-REQ.                                                    06670047
066800***************************************************************** 06680047
066900     MOVE '2210-GET-REQ           ' TO PV-ABEND-PARAGRAPH.        06690047
067000                                                                  06700047
067100     EXEC SQL                                                     06710047
067200         SELECT  CNSTK_LOC_ID                                     06720047
067300              ,  SRC_REF_NBR                                      06730047
067400              ,  SRC_TYP_CDE                                      06740047
067500              ,  STAT_CDE                                         06750047
067600           INTO  :CEPLRQ-CNSTK-LOC-ID                             06760047
067700              ,  :CEPLRQ-SRC-REF-NBR                              06770047
067800              ,  :CEPLRQ-SRC-TYP-CDE                              06780047
067900              ,  :CEPLRQ-STAT-CDE                                 06790047
068000           FROM  TCEPLRQ                                          06800047
068100          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                06810047
068200     END-EXEC.                                                    06820047
068300                                                                  06830047
068400     EVALUATE TRUE                                                06840047
068500       WHEN SQLCODE = +0                                          06850047
068600           CONTINUE                                               06860047
068700                                                                  06870047
068800       WHEN OTHER                                                 06880051
068900           MOVE '2210-GET-REQ '         TO PV-ABEND-PARAGRAPH     06890047
069000           MOVE 'SELECT  '              TO PV-ABEND-OPERATION     06900047
069100           MOVE 'TCEPLRQ'               TO PV-DB2-TABLE-NAME      06910047
069200           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      06920047
069300           MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     06930047
069400           MOVE CEPLIT-ITM-NBR          TO PV-ABEND-PULL-ITEM     06940047
069500           STRING '2210-SELECT PULL USING - '                     06950047
069600                  PV-ABEND-PULL-REQ                               06960047
069700             DELIMITED BY SIZE                                    06970047
069800             INTO PV-DB2-OPERATION-MESSAGE-1                      06980047
069900           PERFORM Z999-SQL-ABEND                                 06990047
070000     END-EVALUATE.                                                07000047
070100                                                                  07010047
070200***************************************************************** 07020051
070300 2215-GET-ITM.                                                    07030051
070400***************************************************************** 07040051
070500     MOVE '2215-GET-ITM           ' TO PV-ABEND-PARAGRAPH.        07050051
070600                                                                  07060051
070700     EXEC SQL                                                     07070051
070800         SELECT  CNSTK_REQ_PL_NBR                                 07080051
070900              ,  PL_LNE_NBR                                       07090051
071000              ,  ITM_NBR                                          07100051
071100              ,  STAT_CDE                                         07110051
071200              ,  UNT_RTL_AMT                                      07120051
071300              ,  EXPRT_PRC_BTCH_ID                                07130051
071400           INTO :CEPLIT-CNSTK-REQ-PL-NBR                          07140051
071500              , :CEPLIT-PL-LNE-NBR                                07150051
071600              , :CEPLIT-ITM-NBR                                   07160051
071700              , :CEPLIT-STAT-CDE                                  07170051
071800              , :CEPLIT-UNT-RTL-AMT                               07180051
071900              , :CEPLIT-EXPRT-PRC-BTCH-ID                         07190051
072000           FROM  TCEPLIT                                          07200051
072100          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                07210051
072200            AND  PL_LNE_NBR       = :DK-PL-LNE-NBR                07220051
072300     END-EXEC.                                                    07230051
072400                                                                  07240051
072500     EVALUATE TRUE                                                07250051
072600       WHEN SQLCODE = +0                                          07260051
072700           CONTINUE                                               07270051
072800                                                                  07280051
072900       WHEN OTHER                                                 07290051
073000           MOVE '2215-GET-REQ '         TO PV-ABEND-PARAGRAPH     07300051
073100           MOVE 'SELECT  '              TO PV-ABEND-OPERATION     07310051
073200           MOVE 'TCEPLIT'               TO PV-DB2-TABLE-NAME      07320051
073300           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      07330051
073400           MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     07340051
073500           STRING '2215-SELECT PULL ITEM USING - '                07350051
073600                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        07360051
073700             DELIMITED BY SIZE                                    07370051
073800             INTO PV-DB2-OPERATION-MESSAGE-1                      07380051
073900           PERFORM Z999-SQL-ABEND                                 07390051
074000     END-EVALUATE.                                                07400051
074100                                                                  07410051
074200***************************************************************** 07420051
074300 2216-GET-STR.                                                    07430051
074400***************************************************************** 07440051
074500     MOVE '2216-GET-STR           ' TO PV-ABEND-PARAGRAPH.        07450051
074600                                                                  07460051
074700     EXEC SQL                                                     07470051
074800         SELECT  CNSTK_REQ_PL_NBR                                 07480051
074900              ,  PL_LNE_NBR                                       07490051
075000              ,  STR_NBR                                          07500051
075100              ,  REQ_ORD_QTY                                      07510051
075200              ,  ACTL_DISTRB_QTY                                  07520079
075300           INTO :CEPLDS-CNSTK-REQ-PL-NBR                          07530051
075400              , :CEPLDS-PL-LNE-NBR                                07540051
075500              , :CEPLDS-STR-NBR                                   07550051
075600              , :CEPLDS-REQ-ORD-QTY :PV-NULL-IND-1                07560079
075700              , :CEPLDS-ACTL-DISTRB-QTY :PV-NULL-IND-2            07570079
075800           FROM  TCEPLDS                                          07580051
075900          WHERE  CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR                07590051
076000            AND  PL_LNE_NBR       = :DK-PL-LNE-NBR                07600051
076100            AND  STR_NBR          = :DK-STR-NBR                   07610051
076200     END-EXEC.                                                    07620051
076300                                                                  07630051
076400     EVALUATE TRUE                                                07640051
076500       WHEN SQLCODE = +0                                          07650051
076510           IF PV-NULL-IND-1 < +0                                  07651079
076520               MOVE ZEROES TO CEPLDS-REQ-ORD-QTY                  07652079
076530           END-IF                                                 07653079
076540           IF PV-NULL-IND-2 < +0                                  07654079
076550               MOVE ZEROES TO CEPLDS-ACTL-DISTRB-QTY              07655079
076560           END-IF                                                 07656079
076800       WHEN OTHER                                                 07680051
076900           MOVE '2216-GET-STR '         TO PV-ABEND-PARAGRAPH     07690051
077000           MOVE 'SELECT  '              TO PV-ABEND-OPERATION     07700051
077100           MOVE 'TCEPLDS'               TO PV-DB2-TABLE-NAME      07710051
077200           MOVE CEPLDS-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      07720051
077300           MOVE CEPLDS-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     07730051
077400           MOVE CEPLDS-STR-NBR          TO PV-ABEND-PULL-STR      07740051
077500           STRING '2216-SELECT PULL STR USING - '                 07750051
077600                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        07760051
077700                                    '/' PV-ABEND-PULL-STR         07770051
077800             DELIMITED BY SIZE                                    07780051
077900             INTO PV-DB2-OPERATION-MESSAGE-1                      07790051
078000           PERFORM Z999-SQL-ABEND                                 07800051
078100     END-EVALUATE.                                                07810051
078200                                                                  07820051
078300***************************************************************** 07830051
078400 2220-GET-SKU.                                                    07840047
078500***************************************************************** 07850047
078600     MOVE '2220-GET-SKU           ' TO PV-ABEND-PARAGRAPH.        07860047
078700                                                                  07870047
           INITIALIZE XL001-ITEM-COMMAREA.                              07871092
           SET XL001-BY-ITEM                                            07872086
               XL001-SELECT-SKU                                         07873086
               XL001-SELECT-VND-STYL                                    07874086
               XL001-SELECT-SKU-STR    TO TRUE                          07875093
                                                                        07876086
           MOVE DK-ITM-NBR TO XL001-KEY-ITM-NBR.                        07877086
           CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.                07878086
                                                                        07879086
080000                                                                  08000047
080100     EVALUATE TRUE                                                08010047
080200       WHEN XL001-SUCCESSFUL                                      08020088
080300           CONTINUE                                               08030047
080400                                                                  08040047
             WHEN XL001-INVALID-ACCESS                                  08041089
                 MOVE '2220-GET-SKU '         TO PV-ABEND-PARAGRAPH     08042089
                 MOVE XL001-ACCESS-METHOD     TO PV-ABEND-OPERATION     08043090
                 PERFORM Z999-SQL-ABEND                                 08044090
                                                                        08045090
             WHEN XL001-SQL-ERROR                                       08046090
               IF XL001-SKU-SQLCODE > ZERO                              08047090
                 MOVE XL001-SKU-SQLCODE       TO PV-SQLCODE             08048090
                 MOVE '2220-GET-SKU'          TO PV-ABEND-PARAGRAPH     08049090
                 MOVE 'XLV_SKU  '             TO PV-DB2-TABLE-NAME      08049190
081000           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      08049290
081100           MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     08049390
081200           MOVE CEPLIT-ITM-NBR          TO PV-ABEND-PULL-ITEM     08049490
081300           STRING 'SELECT SKU USING PULL#/LINE - '                08049599
081400                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        08049690
081500             DELIMITED BY SIZE                                    08049790
081600             INTO PV-DB2-OPERATION-MESSAGE-1                      08049890
081700           STRING 'SELECT SKU USING ITEM# - '                     08049999
081800                  PV-ABEND-PULL-ITEM                              08050090
081900             DELIMITED BY SIZE                                    08050190
082000             INTO PV-DB2-OPERATION-MESSAGE-2                      08050290
082100           PERFORM Z999-SQL-ABEND                                 08050390
               ELSE                                                     08050590
                 IF XL001-VND-STYL-SQLCODE > ZERO                       08050690
                   MOVE XL001-VND-STYL-SQLCODE                          08050790
                                          TO PV-SQLCODE                 08050890
                   MOVE '2220-GET-SKU'    TO PV-ABEND-PARAGRAPH         08050990
                   MOVE 'XLV_VND_STYL'    TO PV-DB2-TABLE-NAME          08051090
081000             MOVE CEPLIT-CNSTK-REQ-PL-NBR                         08051190
                                          TO PV-ABEND-PULL-REQ          08051290
081100             MOVE CEPLIT-PL-LNE-NBR TO PV-ABEND-PULL-LINE         08051390
081200             MOVE CEPLIT-ITM-NBR    TO PV-ABEND-PULL-ITEM         08051490
081300             STRING 'SELECT SKU USING PULL#/LINE - '              08051599
081400                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        08051690
081500             DELIMITED BY SIZE                                    08051790
081600               INTO PV-DB2-OPERATION-MESSAGE-1                    08051890
081700               STRING 'SELECT SKU USING ITEM# - '                 08051999
081800                  PV-ABEND-PULL-ITEM                              08052090
081900             DELIMITED BY SIZE                                    08052190
082000               INTO PV-DB2-OPERATION-MESSAGE-2                    08052290
082100             PERFORM Z999-SQL-ABEND                               08052390
                 ELSE                                                   08052590
                   IF XL001-SKU-STR-SQLCODE > ZERO                      08052690
                     MOVE XL001-SKU-STR-SQLCODE                         08052790
                                          TO PV-SQLCODE                 08052890
                     MOVE '220-GET-SKU'   TO PV-ABEND-PARAGRAPH         08052990
                     MOVE 'XLV_SKU_STR'   TO PV-DB2-TABLE-NAME          08053090
081000               MOVE CEPLIT-CNSTK-REQ-PL-NBR                       08053190
                                          TO PV-ABEND-PULL-REQ          08053290
081100               MOVE CEPLIT-PL-LNE-NBR TO PV-ABEND-PULL-LINE       08053390
081200               MOVE CEPLIT-ITM-NBR    TO PV-ABEND-PULL-ITEM       08053490
081300               STRING 'SELECT SKU USING PULL#/LINE - '            08053599
081400                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        08053690
081500               DELIMITED BY SIZE                                  08053790
081600                 INTO PV-DB2-OPERATION-MESSAGE-1                  08053890
081700                 STRING 'SELECT SKU USING ITEM# - '               08053999
081800                      PV-ABEND-PULL-ITEM                          08054090
081900               DELIMITED BY SIZE                                  08054190
082000                 INTO PV-DB2-OPERATION-MESSAGE-2                  08054290
082100               PERFORM Z999-SQL-ABEND                             08054390
                   ELSE                                                 08054590
                     IF XL001-UPC-SQLCODE > ZERO                        08054690
                       MOVE XL001-UPC-SQLCODE                           08054790
                                            TO PV-SQLCODE               08054890
                       MOVE '220-GET-SKU'   TO PV-ABEND-PARAGRAPH       08054990
                       MOVE 'XLV_UPC    '   TO PV-DB2-TABLE-NAME        08055092
                       PERFORM Z999-SQL-ABEND                           08055190
                     END-IF                                             08055290
                   END-IF                                               08055390
                 END-IF                                                 08055490
               END-IF                                                   08056090
082200     END-EVALUATE.                                                08220047
082300                                                                  08230047
082400***************************************************************** 08240047
082500 2230-ACCUM-STR-QTY.                                              08250047
082600***************************************************************** 08260047
082700     MOVE '2230-ACCUM-STR-QTY     ' TO PV-ABEND-PARAGRAPH.        08270047
082800                                                                  08280047
082900     EXEC SQL                                                     08290047
083000         SELECT SUM(A.ACTL_DISTRB_QTY)                            08300047
083100           INTO :PV-CEPLDS-DISTRB-QTY  :PV-NULL-IND-1             08310047
083200           FROM TCEPLDS A                                         08320047
083300          WHERE A.CNSTK_REQ_PL_NBR = :DK-REQ-PL-NBR               08330047
083400            AND A.PL_LNE_NBR       = :DK-PL-LNE-NBR               08340047
083500     END-EXEC.                                                    08350047
083600                                                                  08360047
083700     EVALUATE TRUE                                                08370047
083800       WHEN SQLCODE = +0                                          08380047
083900           CONTINUE                                               08390047
084000                                                                  08400047
084100       WHEN SQLWARN0 NOT = SPACE                                  08410047
084200       WHEN SQLCODE  NOT = +0                                     08420047
084300           MOVE '2230-ACCUM-STR-QTY   ' TO PV-ABEND-PARAGRAPH     08430047
084400           MOVE 'ACCUM   '              TO PV-ABEND-OPERATION     08440047
084500           MOVE 'TCEPLDS '              TO PV-DB2-TABLE-NAME      08450047
084600           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      08460047
084700           MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     08470047
084800           MOVE CEPLIT-ITM-NBR          TO PV-ABEND-PULL-ITEM     08480047
084900           STRING 'ACCUM TCEPLDS QTY USING PULL#/LINE - '         08490047
085000                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        08500047
085100             DELIMITED BY SIZE                                    08510047
085200             INTO PV-DB2-OPERATION-MESSAGE-1                      08520047
085300           PERFORM Z999-SQL-ABEND                                 08530047
085400     END-EVALUATE.                                                08540047
085500                                                                  08550047
085600***************************************************************** 08560047
085700 2240-OPEN-STR-CSR.                                               08570047
085800***************************************************************** 08580047
085900     MOVE '2240-OPEN-CEPLDS-CSR' TO PV-ABEND-PARAGRAPH.           08590047
086000                                                                  08600047
086100     EXEC SQL                                                     08610047
086200         OPEN CEPLDS-CSR                                          08620047
086300     END-EXEC.                                                    08630047
086400                                                                  08640047
086500     EVALUATE TRUE                                                08650047
086600       WHEN SQLCODE = +0                                          08660047
086700           CONTINUE                                               08670047
086800                                                                  08680047
086900       WHEN SQLWARN0 NOT = SPACE                                  08690047
087000       WHEN SQLCODE  NOT = +0                                     08700047
087100           SET PS-STR-CSR-DONE-YES TO TRUE                        08710047
087200           MOVE '2240-OPEN-CEPLDS-CSR' TO PV-ABEND-PARAGRAPH      08720047
087300           MOVE 'TCEPLDS'     TO PV-DB2-TABLE-NAME                08730047
087400           MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1       08740047
087500           PERFORM Z999-SQL-ABEND                                 08750047
087600     END-EVALUATE.                                                08760047
087700                                                                  08770047
087800***************************************************************** 08780047
087900 2250-FETCH-STR-CSR.                                              08790047
088000***************************************************************** 08800047
088100     MOVE '2250-FETCH-CEPLDS-CSR  ' TO PV-ABEND-PARAGRAPH.        08810047
088200                                                                  08820047
088300     EXEC SQL                                                     08830047
088400         FETCH  CEPLDS-CSR                                        08840047
088500          INTO :CEPLDS-STR-NBR                                    08850047
088600             , :CEPLDS-REQ-ORD-QTY     :PV-NULL-IND-1             08860047
088700             , :CEPLDS-ACTL-DISTRB-QTY :PV-NULL-IND-2             08870047
088800     END-EXEC.                                                    08880047
088900                                                                  08890047
089000     EVALUATE TRUE                                                08900047
089100       WHEN SQLCODE = +0                                          08910047
089200           IF PV-NULL-IND-1 < +0                                  08920047
089300               MOVE ZEROES TO CEPLDS-REQ-ORD-QTY                  08930047
089400           END-IF                                                 08940047
089500           IF PV-NULL-IND-2 < +0                                  08950047
089600               MOVE ZEROES TO CEPLDS-ACTL-DISTRB-QTY              08960047
089700           END-IF                                                 08970047
089800                                                                  08980047
089900       WHEN SQLCODE = +100                                        08990047
090000           SET PS-STR-CSR-DONE-YES TO TRUE                        09000047
090100                                                                  09010047
090200       WHEN SQLWARN0 NOT = SPACE                                  09020047
090300       WHEN SQLCODE  NOT = +0                                     09030047
090400           MOVE '2250-FETCH-CEPLDS-CSR' TO PV-ABEND-PARAGRAPH     09040047
090500           MOVE 'FETCH   '              TO PV-ABEND-OPERATION     09050047
090600           MOVE 'TCEPLDS '              TO PV-DB2-TABLE-NAME      09060047
090700           PERFORM Z999-SQL-ABEND                                 09070047
090800     END-EVALUATE.                                                09080047
090900                                                                  09090047
091000***************************************************************** 09100047
091100 2260-PROCESS-CEPLDS.                                             09110047
091200***************************************************************** 09120047
091300     MOVE '2260-PROCESS-CEPLDS    ' TO PV-ABEND-PARAGRAPH.        09130047
091400                                                                  09140047
091500*MOVE INDIVIDUAL STORE VALUES TO COPYBOOK LAYOUT.                 09150047
091600     MOVE CEPLDS-STR-NBR         TO PV-STORE-NBR.                 09160047
091700     MOVE PV-STORE-NBR           TO CE012-RECV-STORE-NMBR.        09170047
091800     MOVE CEPLDS-ACTL-DISTRB-QTY TO CE012-RECV-STORE-QTY.         09180047
091900                                                                  09190047
092000*MOVE FILLED COPYBOOK LAYOUT TO DB2 TABLE FOR INSERT.             09200047
092100     MOVE CE012-CENTRAL-STK-XFER-RECORD                           09210047
092200                                 TO CEOUT1-CNSTK-SYS-RPTG-ODR.    09220047
092300                                                                  09230047
092400*INSERT CENTRAL STOCK TRANSFER RECORD.                            09240047
092500     PERFORM WITH TEST AFTER                                      09250047
092600       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       09260047
092700         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  09270047
092800            OR SQLCODE = ZERO                                     09280047
092900                                                                  09290047
093000         EXEC SQL                                                 09300047
093100             INSERT INTO TCEOUT1                                  09310047
093200                     (CNSTK_SYS_RPTG_ODR)                         09320047
093300              VALUES (:CEOUT1-CNSTK-SYS-RPTG-ODR)                 09330047
093400         END-EXEC                                                 09340047
093500                                                                  09350047
093600     EVALUATE TRUE                                                09360047
093700       WHEN SQLCODE = ZERO                                        09370047
093800           CONTINUE                                               09380047
093900                                                                  09390047
094000       WHEN OTHER                                                 09400047
094100           MOVE '2260-INSERT-TCEOUT1  ' TO PV-ABEND-PARAGRAPH     09410047
094200           MOVE 'INSERT  '              TO PV-ABEND-OPERATION     09420047
094300           MOVE 'TCEOUT1 '              TO PV-DB2-TABLE-NAME      09430047
094400           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      09440047
094500           MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     09450047
094600           MOVE CEPLIT-ITM-NBR          TO PV-ABEND-PULL-ITEM     09460047
094700           STRING 'INSERT TCEOUT1 USING PULL#/LINE - '            09470047
094800                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        09480047
094900             DELIMITED BY SIZE                                    09490047
095000             INTO PV-DB2-OPERATION-MESSAGE-1                      09500047
095100           PERFORM Z999-SQL-ABEND                                 09510047
095200     END-EVALUATE                                                 09520047
095300     END-PERFORM.                                                 09530047
095400                                                                  09540047
095500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         09550047
095600       AND SQLCODE NOT = ZERO                                     09560047
095700         MOVE '2260-INSERT-TCEOUT1  ' TO PV-ABEND-PARAGRAPH       09570047
095800         MOVE 'MAX TRYS'              TO PV-ABEND-OPERATION       09580047
095900         MOVE 'TCEOUT1 '              TO PV-DB2-TABLE-NAME        09590047
096000         MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ        09600047
096100         MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE       09610047
096200         MOVE CEPLIT-ITM-NBR          TO PV-ABEND-PULL-ITEM       09620047
096300         MOVE CEPLDS-STR-NBR          TO PV-ABEND-PULL-STR        09630047
096400         STRING 'INSERT TCEOUT1 USING PULL#/LINE - '              09640047
096500                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          09650047
096600           DELIMITED BY SIZE                                      09660047
096700           INTO PV-DB2-OPERATION-MESSAGE-1                        09670047
096800         STRING 'INSERT TCEOUT1 USING ITEM#/STR# - '              09680047
096900                PV-ABEND-PULL-ITEM '/' PV-ABEND-PULL-STR          09690047
097000           DELIMITED BY SIZE                                      09700047
097100           INTO PV-DB2-OPERATION-MESSAGE-2                        09710047
097200         PERFORM Z999-SQL-ABEND                                   09720047
097300     END-IF.                                                      09730047
097400                                                                  09740047
097500*GET NEXT STORE FOR THE PULL#/LINE# COMBINATION.                  09750047
097600     PERFORM 2250-FETCH-STR-CSR.                                  09760047
097700                                                                  09770047
097800***************************************************************** 09780047
097900 2270-CLOSE-STR-CSR.                                              09790047
098000***************************************************************** 09800047
098100     MOVE '2270-CLOSE-CEPLDS-CSR' TO PV-ABEND-PARAGRAPH.          09810047
098200                                                                  09820047
098300     EXEC SQL                                                     09830047
098400         CLOSE CEPLDS-CSR                                         09840047
098500     END-EXEC                                                     09850047
098600                                                                  09860047
098700     EVALUATE TRUE                                                09870047
098800       WHEN SQLCODE = ZERO                                        09880047
098900           CONTINUE                                               09890047
099000                                                                  09900047
099100       WHEN OTHER                                                 09910047
099200           PERFORM Z999-SQL-ABEND                                 09920047
099300     END-EVALUATE.                                                09930047
099400                                                                  09940047
099500***************************************************************** 09950047
099600 2300-UPDATE-TCEPLIT.                                             09960047
099700***************************************************************** 09970047
099800     MOVE '2300-UPDATE-TCEPLIT    ' TO PV-ABEND-PARAGRAPH.        09980047
099900                                                                  09990047
100000     EXEC SQL                                                     10000047
100100         UPDATE TCEPLIT                                           10010047
100200            SET STAT_CDE          = :PC-PD                        10020047
100300              , EXPRT_PRC_BTCH_ID = :PV-EXPRT-PRC-BTCH-ID         10030047
100400          WHERE CURRENT OF CEPLIT-HOLD-CSR                        10040047
100500     END-EXEC.                                                    10050047
100600                                                                  10060047
100700     EVALUATE TRUE                                                10070047
100800       WHEN SQLCODE = ZERO                                        10080047
100900           CONTINUE                                               10090047
101000                                                                  10100047
101100       WHEN OTHER                                                 10110047
101200           MOVE '2300-UPDATE-TCEPLIT  ' TO PV-ABEND-PARAGRAPH     10120047
101300           MOVE 'TCEPLIT'               TO PV-DB2-TABLE-NAME      10130047
101400           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      10140047
101500           MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     10150047
101600           STRING 'UPDATE CEPLIT USING PULL#/LINE - '             10160047
101700                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        10170047
101800             DELIMITED BY SIZE                                    10180047
101900             INTO PV-DB2-OPERATION-MESSAGE-1                      10190047
102000           PERFORM Z999-SQL-ABEND                                 10200047
102100     END-EVALUATE.                                                10210047
102200                                                                  10220047
102300***************************************************************** 10230047
102400 2400-INSERT-TCEPLST.                                             10240047
102500***************************************************************** 10250047
102600     MOVE '2400-INSERT-TCEPLST   ' TO PV-ABEND-PARAGRAPH.         10260047
102700                                                                  10270047
102800*INIT/LOAD CENTRAL STOCK STATUS RECORD.                           10280047
102900     INITIALIZE DCLTCEPLST.                                       10290047
103000                                                                  10300047
103100     MOVE CEPLIT-CNSTK-REQ-PL-NBR  TO CEPLST-CNSTK-REQ-PL-NBR.    10310047
103200     MOVE CEPLIT-PL-LNE-NBR        TO CEPLST-PL-LNE-NBR.          10320047
103300     MOVE 'PD'                     TO CEPLST-STAT-CDE.            10330047
103400     MOVE 'CEKUP006'               TO CEPLST-CRE-BY-USR-ID.       10340047
103500                                                                  10350047
103600*INSERT CENTRAL STOCK STATUS RECORD.                              10360047
103700     PERFORM WITH TEST AFTER                                      10370047
103800       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       10380047
103900         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  10390047
104000            OR SQLCODE = ZERO                                     10400047
104100                                                                  10410047
104200         EXEC SQL                                                 10420047
104300             INSERT INTO TCEPLST                                  10430047
104400                     (CNSTK_REQ_PL_NBR                            10440047
104500                   ,  PL_LNE_NBR                                  10450047
104600                   ,  CRE_TMST                                    10460047
104700                   ,  STAT_CDE                                    10470047
104800                   ,  CRE_BY_USR_ID)                              10480047
104900              VALUES (:CEPLST-CNSTK-REQ-PL-NBR                    10490047
105000                   ,  :CEPLST-PL-LNE-NBR                          10500047
105100                   ,  CURRENT TIMESTAMP                           10510047
105200                   ,  :CEPLST-STAT-CDE                            10520047
105300                   ,  :CEPLST-CRE-BY-USR-ID)                      10530047
105400         END-EXEC                                                 10540047
105500                                                                  10550047
105600     EVALUATE TRUE                                                10560047
105700       WHEN SQLCODE = ZERO                                        10570047
105800           CONTINUE                                               10580047
105900                                                                  10590047
106000       WHEN OTHER                                                 10600047
106100           MOVE '2400-INSERT-TCEPLST  ' TO PV-ABEND-PARAGRAPH     10610047
106200           MOVE 'TCEPLST'               TO PV-DB2-TABLE-NAME      10620047
106300           MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      10630047
106400           MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     10640047
106500           STRING 'INSERT CEPLST USING PULL#/LINE - '             10650047
106600                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        10660047
106700             DELIMITED BY SIZE                                    10670047
106800             INTO PV-DB2-OPERATION-MESSAGE-1                      10680047
106900           PERFORM Z999-SQL-ABEND                                 10690047
107000     END-EVALUATE                                                 10700047
107100     END-PERFORM.                                                 10710047
107200                                                                  10720047
107300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         10730047
107400       AND SQLCODE NOT = ZERO                                     10740047
107500         MOVE '2400-INSERT-TCEPLST  ' TO PV-ABEND-PARAGRAPH       10750047
107600         MOVE 'MAX TRYS'              TO PV-ABEND-OPERATION       10760047
107700         MOVE 'TCEPLST'               TO PV-DB2-TABLE-NAME        10770047
107800         MOVE CEPLIT-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ        10780047
107900         MOVE CEPLIT-PL-LNE-NBR       TO PV-ABEND-PULL-LINE       10790047
108000         STRING 'INSERT CEPLST USING PULL#/LINE - '               10800047
108100                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          10810047
108200           DELIMITED BY SIZE                                      10820047
108300           INTO PV-DB2-OPERATION-MESSAGE-1                        10830047
108400         PERFORM Z999-SQL-ABEND                                   10840047
108500     END-IF.                                                      10850047
108600                                                                  10860047
108700***************************************************************** 10870047
108800 2500-OPEN-CEPLST-CSR.                                            10880047
108900***************************************************************** 10890047
109000     MOVE '2500-OPEN-CEPLST-CSR' TO PV-ABEND-PARAGRAPH.           10900047
109100                                                                  10910047
109200     EXEC SQL                                                     10920047
109300         OPEN CEPLST-HOLD-CSR                                     10930047
109400     END-EXEC.                                                    10940047
109500                                                                  10950047
109600     EVALUATE TRUE                                                10960047
109700       WHEN SQLCODE = +0                                          10970047
109800           CONTINUE                                               10980047
109900                                                                  10990047
110000       WHEN SQLWARN0 NOT = SPACE                                  11000047
110100       WHEN SQLCODE  NOT = +0                                     11010047
110200           SET PS-STS-CSR-DONE-YES TO TRUE                        11020047
110300           MOVE '2500-OPEN-CEPLST-CSR' TO PV-ABEND-PARAGRAPH      11030047
110400           MOVE 'TCEPLST'     TO PV-DB2-TABLE-NAME                11040047
110500           MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1       11050047
110600           PERFORM Z999-SQL-ABEND                                 11060047
110700     END-EVALUATE.                                                11070047
110800                                                                  11080047
110900***************************************************************** 11090047
111000 2600-FETCH-CEPLST-CSR.                                           11100047
111100***************************************************************** 11110047
111200     MOVE '2600-FETCH-CEPLST-CSR' TO PV-ABEND-PARAGRAPH.          11120047
111300                                                                  11130047
111400     MOVE 'XX' TO CEPLST-STAT-CDE.                                11140047
111500                                                                  11150047
111600     EXEC SQL                                                     11160047
111700         FETCH CEPLST-HOLD-CSR                                    11170047
111800          INTO :CEPLST-CNSTK-REQ-PL-NBR                           11180047
111900             , :CEPLST-PL-LNE-NBR                                 11190047
112000             , :CEPLST-CRE-TMST :PV-NULL-IND-1                    11200047
112100             , :CEPLST-STAT-CDE                                   11210047
112200     END-EXEC.                                                    11220047
112300                                                                  11230047
112400     EVALUATE TRUE                                                11240047
112500       WHEN SQLCODE = +0                                          11250047
112600           IF PV-NULL-IND-1 < +0                                  11260047
112700               MOVE ZEROES TO CEPLST-CRE-TMST                     11270047
112800           END-IF                                                 11280047
112900                                                                  11290047
113000*          MOVE SPACES TO PV-DB2-OPERATION-MESSAGE-1              11300047
113100*          MOVE CEPLST-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      11310047
113200*          MOVE CEPLST-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     11320047
113300*          STRING '  FETCH LATEST CEPLST DATE - '                 11330047
113400*               PV-ABEND-PULL-REQ ' / ' PV-ABEND-PULL-LINE        11340047
113500*               ' / ' CEPLST-CRE-TMST ' / ' CEPLST-STAT-CDE       11350047
113600*            DELIMITED BY SIZE                                    11360047
113700*            INTO PV-DB2-OPERATION-MESSAGE-1                      11370047
113800*          DISPLAY PV-DB2-OPERATION-MESSAGE-1                     11380047
113900                                                                  11390047
114000       WHEN SQLCODE = +100                                        11400047
114100           SET PS-STS-CSR-DONE-YES TO TRUE                        11410047
114200                                                                  11420047
114300       WHEN SQLWARN0 NOT = SPACE                                  11430047
114400       WHEN SQLCODE  NOT = +0                                     11440047
114500           MOVE '2600-FETCH-CEPLST-CSR' TO PV-ABEND-PARAGRAPH     11450047
114600           MOVE 'FETCH   '              TO PV-ABEND-OPERATION     11460047
114700           MOVE 'TCEPLST '              TO PV-DB2-TABLE-NAME      11470047
114800           PERFORM Z999-SQL-ABEND                                 11480047
114900     END-EVALUATE.                                                11490047
115000                                                                  11500047
115100***************************************************************** 11510047
115200 2700-CLOSE-CEPLST-CSR.                                           11520047
115300***************************************************************** 11530047
115400     MOVE '2700-CLOSE-CEPLST-CSR' TO PV-ABEND-PARAGRAPH.          11540047
115500                                                                  11550047
115600     EXEC SQL                                                     11560047
115700         CLOSE CEPLST-HOLD-CSR                                    11570047
115800     END-EXEC                                                     11580047
115900                                                                  11590047
116000     EVALUATE TRUE                                                11600047
116100       WHEN SQLCODE = ZERO                                        11610047
116200           CONTINUE                                               11620047
116300                                                                  11630047
116400       WHEN OTHER                                                 11640047
116500           PERFORM Z999-SQL-ABEND                                 11650047
116600     END-EVALUATE.                                                11660047
116700                                                                  11670047
116800***************************************************************** 11680047
116900 2800-PROCESS-CEPLRQ.                                             11690047
117000***************************************************************** 11700047
117100     MOVE '2800-PROCESS-CEPLRQ  ' TO PV-ABEND-PARAGRAPH.          11710047
117200                                                                  11720047
117300*COUNT TCEPLIT RECORDS FOR STATUS OTHER THAN 'CA' & 'PD'.         11730047
117400     MOVE ZEROES TO PV-DB2-COUNT.                                 11740047
117500     EXEC SQL                                                     11750047
117600         SELECT COUNT (*)                                         11760047
117700           INTO  :PV-DB2-COUNT                                    11770047
117800           FROM  TCEPLIT A                                        11780047
117900          WHERE  A.CNSTK_REQ_PL_NBR = :PV-REQ-PL-NBR-PREV         11790047
118000            AND  A.STAT_CDE        <> :PC-CA                      11800047
118100            AND  A.STAT_CDE        <> :PC-PD                      11810047
118200     END-EXEC.                                                    11820047
118300                                                                  11830047
118400     EVALUATE TRUE                                                11840047
118500       WHEN SQLCODE = ZERO                                        11850047
118600           CONTINUE                                               11860047
118700                                                                  11870047
118800       WHEN OTHER                                                 11880047
118900           MOVE '2800-PROCESS-CEPLRQ' TO PV-ABEND-PARAGRAPH       11890047
119000           MOVE 'TCEPLIT '      TO PV-DB2-TABLE-NAME              11900047
119100           MOVE 'COUNT TCEPLIT' TO PV-DB2-OPERATION-MESSAGE-1     11910047
119200           PERFORM Z999-SQL-ABEND                                 11920047
119300     END-EVALUATE.                                                11930047
119400                                                                  11940047
119500     MOVE PV-DB2-COUNT TO PV-ABEND-PULL-REQ                       11950047
119600*    DISPLAY '   CEPLIT STS COUNT = ' PV-ABEND-PULL-REQ           11960047
119700                                                                  11970047
119800*IF COUNT = 0, UPDATE TCEPLRQ & INSERT TCEPLST.                   11980047
119900     IF PV-DB2-COUNT = ZEROES                                     11990047
120000         PERFORM 2810-UPDATE-CEPLRQ                               12000047
120100         PERFORM 2820-INSERT-CEPLST                               12010047
120200     END-IF.                                                      12020047
120300                                                                  12030047
120400***************************************************************** 12040047
120500 2810-UPDATE-CEPLRQ.                                              12050047
120600***************************************************************** 12060047
120700     MOVE '2810-UPDATE-CEPLRQ   ' TO PV-ABEND-PARAGRAPH.          12070047
120800                                                                  12080047
120900     EXEC SQL                                                     12090047
121000         UPDATE TCEPLRQ                                           12100047
121100            SET STAT_CDE = :PC-PD                                 12110047
121200          WHERE CNSTK_REQ_PL_NBR = :PV-REQ-PL-NBR-PREV            12120047
121300     END-EXEC.                                                    12130047
121400                                                                  12140047
121500     EVALUATE TRUE                                                12150047
121600       WHEN SQLCODE = ZERO                                        12160047
121700           CONTINUE                                               12170047
121800                                                                  12180047
121900       WHEN OTHER                                                 12190047
122000           MOVE '2810-UPDATE-TCEPLRQ  ' TO PV-ABEND-PARAGRAPH     12200047
122100           MOVE 'TCEPLRQ'               TO PV-DB2-TABLE-NAME      12210047
122200           MOVE PV-REQ-PL-NBR-PREV      TO PV-ABEND-PULL-REQ      12220047
122300           STRING 'UPDATE CEPLRQ USING PULL# - '                  12230047
122400                  PV-ABEND-PULL-REQ                               12240047
122500             DELIMITED BY SIZE                                    12250047
122600             INTO PV-DB2-OPERATION-MESSAGE-1                      12260047
122700           PERFORM Z999-SQL-ABEND                                 12270047
122800     END-EVALUATE.                                                12280047
122900                                                                  12290047
123000***************************************************************** 12300047
123100 2820-INSERT-CEPLST.                                              12310047
123200***************************************************************** 12320047
123300     MOVE '2820-INSERT-CEPLST   ' TO PV-ABEND-PARAGRAPH.          12330047
123400                                                                  12340047
123500*INIT/LOAD CENTRAL STOCK STATUS RECORD.                           12350047
123600     INITIALIZE DCLTCEPLST.                                       12360047
123700                                                                  12370047
123800     MOVE PV-REQ-PL-NBR-PREV       TO CEPLST-CNSTK-REQ-PL-NBR.    12380047
123900     MOVE ZEROES                   TO CEPLST-PL-LNE-NBR.          12390047
124000     MOVE 'PD'                     TO CEPLST-STAT-CDE.            12400047
124100     MOVE 'CEKUP006'               TO CEPLST-CRE-BY-USR-ID.       12410047
124200                                                                  12420047
124300*INSERT CENTRAL STOCK STATUS RECORD.                              12430047
124400     PERFORM WITH TEST AFTER                                      12440047
124500       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       12450047
124600         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  12460047
124700            OR SQLCODE = ZERO                                     12470047
124800                                                                  12480047
124900         EXEC SQL                                                 12490047
125000             INSERT INTO TCEPLST                                  12500047
125100                     (CNSTK_REQ_PL_NBR                            12510047
125200                   ,  PL_LNE_NBR                                  12520047
125300                   ,  CRE_TMST                                    12530047
125400                   ,  STAT_CDE                                    12540047
125500                   ,  CRE_BY_USR_ID)                              12550047
125600              VALUES (:CEPLST-CNSTK-REQ-PL-NBR                    12560047
125700                   ,  :CEPLST-PL-LNE-NBR                          12570047
125800                   ,  CURRENT TIMESTAMP                           12580047
125900                   ,  :CEPLST-STAT-CDE                            12590047
126000                   ,  :CEPLST-CRE-BY-USR-ID)                      12600047
126100         END-EXEC                                                 12610047
126200                                                                  12620047
126300     EVALUATE TRUE                                                12630047
126400       WHEN SQLCODE = ZERO                                        12640047
126500           CONTINUE                                               12650047
126600                                                                  12660047
126700       WHEN OTHER                                                 12670047
126800           MOVE '2820-INSERT-TCEPLST  ' TO PV-ABEND-PARAGRAPH     12680047
126900           MOVE 'TCEPLST'               TO PV-DB2-TABLE-NAME      12690047
127000           MOVE PV-REQ-PL-NBR-PREV      TO PV-ABEND-PULL-REQ      12700047
127100           MOVE ZEROES                  TO PV-ABEND-PULL-LINE     12710047
127200           STRING 'INSERT CEPLST USING PULL#/LINE - '             12720047
127300                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        12730047
127400             DELIMITED BY SIZE                                    12740047
127500             INTO PV-DB2-OPERATION-MESSAGE-1                      12750047
127600           PERFORM Z999-SQL-ABEND                                 12760047
127700     END-EVALUATE                                                 12770047
127800     END-PERFORM.                                                 12780047
127900                                                                  12790047
128000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12800047
128100       AND SQLCODE NOT = ZERO                                     12810047
128200         MOVE '2820-INSERT-TCEPLST  ' TO PV-ABEND-PARAGRAPH       12820047
128300         MOVE 'MAX TRYS'              TO PV-ABEND-OPERATION       12830047
128400         MOVE 'TCEPLST'               TO PV-DB2-TABLE-NAME        12840047
128500         MOVE PV-REQ-PL-NBR-PREV      TO PV-ABEND-PULL-REQ        12850047
128600         MOVE ZEROES                  TO PV-ABEND-PULL-LINE       12860047
128700         STRING 'INSERT CEPLST USING PULL#/LINE - '               12870047
128800                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          12880047
128900           DELIMITED BY SIZE                                      12890047
129000           INTO PV-DB2-OPERATION-MESSAGE-1                        12900047
129100         PERFORM Z999-SQL-ABEND                                   12910047
129200     END-IF.                                                      12920047
129300                                                                  12930047
129400***************************************************************** 12940047
129500 3000-CLOSE-CEPLIT-CSR.                                           12950047
129600***************************************************************** 12960047
129700     MOVE '3000-CLOSE-CEPLIT-CSR' TO PV-ABEND-PARAGRAPH.          12970047
129800                                                                  12980047
129900     EXEC SQL                                                     12990047
130000         CLOSE CEPLIT-HOLD-CSR                                    13000047
130100     END-EXEC                                                     13010047
130200                                                                  13020047
130300     EVALUATE TRUE                                                13030047
130400       WHEN SQLCODE = ZERO                                        13040047
130500           CONTINUE                                               13050047
130600                                                                  13060047
130700       WHEN OTHER                                                 13070047
130800           PERFORM Z999-SQL-ABEND                                 13080047
130900     END-EVALUATE.                                                13090047
131000                                                                  13100047
131100***************************************************************** 13110051
131200 4000-OPEN-CEPLMF-CSR.                                            13120051
131300***************************************************************** 13130051
131400     MOVE '4000-OPEN-CEPLMF-CSR' TO PV-ABEND-PARAGRAPH.           13140051
131500                                                                  13150051
131600     EXEC SQL                                                     13160051
131700         OPEN CEPLMF-CSR                                          13170051
131800     END-EXEC.                                                    13180051
131900                                                                  13190051
132000     EVALUATE TRUE                                                13200051
132100       WHEN SQLCODE = +0                                          13210051
132200           CONTINUE                                               13220051
132300                                                                  13230051
132400       WHEN SQLWARN0 NOT = SPACE                                  13240051
132500       WHEN SQLCODE  NOT = +0                                     13250051
132600           MOVE '4000-OPEN-CEPLMF-CSR' TO PV-ABEND-PARAGRAPH      13260051
132700           MOVE 'TCEPLMF'     TO PV-DB2-TABLE-NAME                13270051
132800           MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1       13280051
132900           PERFORM Z999-SQL-ABEND                                 13290051
133000     END-EVALUATE.                                                13300051
133100                                                                  13310051
133200***************************************************************** 13320051
133300 4100-FETCH-CEPLMF-CSR.                                           13330051
133400***************************************************************** 13340051
133500     MOVE '4100-FETCH-CEPLMF-CSR' TO PV-ABEND-PARAGRAPH.          13350051
133600                                                                  13360051
133700     EXEC SQL                                                     13370051
133800         FETCH CEPLMF-CSR                                         13380051
133900          INTO :CEPLMF-CNSTK-REQ-PL-NBR                           13390051
134000             , :CEPLMF-PL-LNE-NBR                                 13400051
134100             , :CEPLMF-STR-NBR                                    13410051
134300             , :CEPLMF-MFST-UNT-QTY                               13430051
134600     END-EXEC.                                                    13460051
134700                                                                  13470051
134800     EVALUATE TRUE                                                13480051
134900       WHEN SQLCODE = +0                                          13490051
135000           CONTINUE                                               13500051
135100                                                                  13510051
135200       WHEN SQLCODE = +100                                        13520051
135300           SET PS-MF-CSR-DONE-YES TO TRUE                         13530051
135400                                                                  13540051
135500       WHEN SQLWARN0 NOT = SPACE                                  13550051
135600       WHEN SQLCODE  NOT = +0                                     13560051
135700           MOVE '4100-FETCH-CEPLMF-CSR' TO PV-ABEND-PARAGRAPH     13570051
135800           MOVE 'FETCH   '              TO PV-ABEND-OPERATION     13580051
135900           MOVE 'TCEPLMF '              TO PV-DB2-TABLE-NAME      13590051
136000           PERFORM Z999-SQL-ABEND                                 13600051
136100     END-EVALUATE.                                                13610051
136200                                                                  13620051
136300***************************************************************** 13630051
136400 4200-CLOSE-CEPLMF-CSR.                                           13640051
136500***************************************************************** 13650051
136600     MOVE '4200-CLOSE-CEPLMF-CSR' TO PV-ABEND-PARAGRAPH.          13660051
136700                                                                  13670051
136800     EXEC SQL                                                     13680051
136900         CLOSE CEPLMF-CSR                                         13690051
137000     END-EXEC                                                     13700051
137100                                                                  13710051
137200     EVALUATE TRUE                                                13720051
137300       WHEN SQLCODE = ZERO                                        13730051
137400           CONTINUE                                               13740051
137500                                                                  13750051
137600       WHEN OTHER                                                 13760051
137700           PERFORM Z999-SQL-ABEND                                 13770051
137800     END-EVALUATE.                                                13780051
137900                                                                  13790051
138000***************************************************************** 13800051
138100 4300-PROCESS-CEPLMF.                                             13810051
138200***************************************************************** 13820051
138300     MOVE '4300-PROCESS-CEPLMF  ' TO PV-ABEND-PARAGRAPH.          13830051
138400                                                                  13840051
138500*GET PULL REQUEST INFO.                                           13850051
138600     MOVE CEPLMF-CNSTK-REQ-PL-NBR TO DK-REQ-PL-NBR.               13860051
138700     PERFORM 2210-GET-REQ.                                        13870051
138800                                                                  13880051
138900*GET PULL ITEM INFO.                                              13890051
139000     MOVE CEPLMF-PL-LNE-NBR       TO DK-PL-LNE-NBR.               13900051
139100     PERFORM 2215-GET-ITM.                                        13910054
139200                                                                  13920051
139300*GET ASSOCIATED SKU INFO.                                         13930051
139400     MOVE CEPLIT-ITM-NBR          TO DK-ITM-NBR.                  13940051
139500     PERFORM 2220-GET-SKU.                                        13950054
139600                                                                  13960051
139700*GET PULL STORE INFO.                                             13970051
139800     MOVE CEPLMF-STR-NBR          TO DK-STR-NBR.                  13980051
139900     PERFORM 2216-GET-STR.                                        13990051
140000                                                                  14000051
140100*INIT/LOAD CENTRAL STOCK TRANSFER RECORD.                         14010051
140200     INITIALIZE CE012-CENTRAL-STK-XFER-RECORD.                    14020051
140300                                                                  14030051
140400     MOVE PV-CURRENT-DB2-DATE     TO CE012-BTCH-PRC-DTE.          14040051
140500     MOVE CEPLMF-CNSTK-REQ-PL-NBR TO CE012-PULL-NBR.              14050051
140600     MOVE CEPLMF-PL-LNE-NBR       TO CE012-PULL-LNE-NBR.          14060051
140700                                                                  14070051
140800*  FILL CE012-BATCH-NMBR.                                         14080051
140900     MOVE PV-CURRENT-DB2-DD       TO PV-BATCH-DAY.                14090051
141000     MOVE PV-BATCH-NMBR           TO CE012-BATCH-NMBR             14100051
141100                                     PV-BATCH-NMBR-2.             14110051
141200                                                                  14120051
141300*  FILL CE012-SKU-A.                                              14130085
141400     MOVE XL001-DEPT-NBR-3CH      TO CE012-DEPT.                  14140092
141500     MOVE XL001-SUB-CL-NBR-2CH    TO CE012-CLASS.                 14150099
141600     MOVE XL001-SKU-NBR           TO CE012-SKU-NBR.               14160099
141700                                                                  14170051
141800*  FILL CE012-FILLED-DATE-MMDDCCYY.                               14180051
141900     MOVE PV-CURRENT-DB2-DATE     TO PV-CEPLST-DS-DATE.           14190051
142000     MOVE PV-CEPLST-DS-TMST-MM TO CE012-FILLED-DATE-MMDDCCYY-MM.  14200051
142100     MOVE PV-CEPLST-DS-TMST-DD TO CE012-FILLED-DATE-MMDDCCYY-DD.  14210051
142200     MOVE PV-CEPLST-DS-TMST-CC TO CE012-FILLED-DATE-MMDDCCYY-CC.  14220051
142300     MOVE PV-CEPLST-DS-TMST-YY TO CE012-FILLED-DATE-MMDDCCYY-YY.  14230051
142400                                                                  14240051
142500*  FILL CE012-DC-STORE-NMBR FROM PULL REQUEST (CEPLRQ).           14250051
142600     MOVE CEPLRQ-CNSTK-LOC-ID     TO CE012-DC-STORE-NMBR.         14260051
142700                                                                  14270051
142800*  FILL CE012-TOTAL-QTY FROM ACCUMMULATED STORE DISTRIBUTED QTY.  14280051
142900     IF  (PV-REQ-PL-NBR-PREV = ZEROES)                            14290062
143000     AND (PV-PL-LNE-NBR-PREV = ZEROES)                            14300062
143100         PERFORM 4310-ACCUM-STR-QTY                               14310057
143200         MOVE PV-CEPLMF-UNT-QTY     TO CE012-TOTAL-QTY            14320057
143300     ELSE                                                         14330057
143400         IF  (PV-REQ-PL-NBR-PREV NOT = DK-REQ-PL-NBR)             14340062
143500         OR (PV-PL-LNE-NBR-PREV NOT = DK-PL-LNE-NBR)              14350062
143600             PERFORM 4310-ACCUM-STR-QTY                           14360057
143700             MOVE PV-CEPLMF-UNT-QTY TO CE012-TOTAL-QTY            14370057
143800         ELSE                                                     14380057
143900             MOVE PV-CEPLMF-UNT-QTY TO CE012-TOTAL-QTY            14390057
144000         END-IF                                                   14400057
144100     END-IF.                                                      14410057
144200                                                                  14420051
144300*  FILL CE012-UNIT-PRICE FROM SKU                                 14430099
144400     IF CEPLIT-UNT-RTL-AMT EQUAL 0.00                             14440055
144500         MOVE 0.01                TO CE012-UNIT-PRICE             14450051
144600     ELSE                                                         14460051
144700         MOVE CEPLIT-UNT-RTL-AMT  TO CE012-UNIT-PRICE             14470051
144800     END-IF.                                                      14480051
144900                                                                  14490051
145000*  FILL CE012-RECV-STORE VALUES.                                  14500051
145100     MOVE CEPLMF-STR-NBR          TO CE012-RECV-STORE-NMBR.       14510051
145200     MOVE CEPLMF-MFST-UNT-QTY     TO CE012-RECV-STORE-QTY.        14520051
145300                                                                  14530051
145400*  FILL CE012-SOURCE-CDE (FROM MANIFEST).                         14540051
145500     SET CE012-MANIFEST-SOURCE    TO TRUE.                        14550051
145600                                                                  14560051
145700*MOVE FILLED COPYBOOK LAYOUT TO DB2 TABLE FOR INSERT.             14570051
145800     MOVE CE012-CENTRAL-STK-XFER-RECORD                           14580051
145900                                  TO CEOUT1-CNSTK-SYS-RPTG-ODR.   14590051
146000                                                                  14600051
146100*INSERT CENTRAL STOCK TRANSFER RECORD.                            14610051
146101     MOVE ZERO TO PV-RETRY-COUNTER.                               14610184
146102                                                                  14610284
146110     IF  CE012-RECV-STORE-QTY > 0                                 14611084
146200         PERFORM WITH TEST AFTER                                  14620084
146300           VARYING PV-RETRY-COUNTER FROM 1 BY 1                   14630084
146400             UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES              14640084
146500                OR SQLCODE = ZERO                                 14650084
146600                                                                  14660084
146700             EXEC SQL                                             14670084
146800                 INSERT INTO TCEOUT1                              14680084
146900                         (CNSTK_SYS_RPTG_ODR)                     14690084
147000                  VALUES (:CEOUT1-CNSTK-SYS-RPTG-ODR)             14700084
147100             END-EXEC                                             14710084
147200                                                                  14720084
147300         EVALUATE TRUE                                            14730084
147400           WHEN SQLCODE = ZERO                                    14740084
147500               ADD 1 TO PV-RECS-WRITTEN                           14750084
147600                        PV-RECS-WRITTEN-M                         14760084
147700                                                                  14770084
147800           WHEN OTHER                                             14780084
147900               MOVE '4300-PROCESS-CEPLMF  ' TO PV-ABEND-PARAGRAPH 14790084
148000               MOVE 'INSERT  '              TO PV-ABEND-OPERATION 14800084
148100               MOVE 'TCEOUT1 '              TO PV-DB2-TABLE-NAME  14810084
148200               MOVE CEPLMF-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ  14820084
148300               MOVE CEPLMF-PL-LNE-NBR       TO PV-ABEND-PULL-LINE 14830084
148400               MOVE CEPLMF-STR-NBR          TO PV-ABEND-PULL-STR  14840084
148500               STRING 'INSERT TCEOUT1 USING PULL#/LNE/STR - '     14850084
148600                      PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE    14860084
148700                                        '/' PV-ABEND-PULL-STR     14870084
148800                 DELIMITED BY SIZE                                14880084
148900                 INTO PV-DB2-OPERATION-MESSAGE-1                  14890084
149000               PERFORM Z999-SQL-ABEND                             14900084
149100         END-EVALUATE                                             14910084
149200         END-PERFORM                                              14920084
149210     END-IF.                                                      14921084
149300                                                                  14930051
149400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14940062
149500     AND SQLCODE NOT = ZERO                                       14950062
149600         MOVE '4300-PROCESS-CEPLMF  ' TO PV-ABEND-PARAGRAPH       14960051
149700         MOVE 'MAX TRYS'              TO PV-ABEND-OPERATION       14970051
149800         MOVE 'TCEOUT1 '              TO PV-DB2-TABLE-NAME        14980051
149900         MOVE CEPLMF-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ        14990051
150000         MOVE CEPLMF-PL-LNE-NBR       TO PV-ABEND-PULL-LINE       15000051
150100         MOVE CEPLMF-STR-NBR          TO PV-ABEND-PULL-STR        15010051
150200         STRING 'INSERT TCEOUT1 USING PULL#/LNE/STR - '           15020051
150300                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          15030051
150400                                  '/' PV-ABEND-PULL-STR           15040051
150500           DELIMITED BY SIZE                                      15050051
150600           INTO PV-DB2-OPERATION-MESSAGE-1                        15060051
150700         PERFORM Z999-SQL-ABEND                                   15070051
150800     END-IF.                                                      15080051
150900                                                                  15090051
151000*GET NEXT QUALIFIED CEPLMF TABLE ENTRY.                           15100055
151100     PERFORM 4100-FETCH-CEPLMF-CSR.                               15110055
151200                                                                  15120055
151300*COMPARE MANIFEST ROWS / CHECK IF READY FOR CEPLMF UPDATE.        15130057
151400***  IF PS-MF-CSR-DONE-YES                                        15140057
151500***    OR ((CEPLMF-CNSTK-REQ-PL-NBR NOT = PV-REQ-PL-NBR-PREV)     15150057
151600***     OR (CEPLMF-PL-LNE-NBR       NOT = PV-PL-LNE-NBR-PREV))    15160057
151700     PERFORM 4400-UPDATE-CEPLMF.                                  15170062
151800***  END-IF.                                                      15180057
151900                                                                  15190057
152000*AFTER PROCESSING MANIFEST ROW, SAVE PULL KEYS.                   15200057
152100     IF  PS-MF-CSR-DONE-NO                                        15210062
152200         MOVE DK-REQ-PL-NBR TO PV-REQ-PL-NBR-PREV                 15220057
152300         MOVE DK-PL-LNE-NBR TO PV-PL-LNE-NBR-PREV                 15230057
152400     END-IF.                                                      15240057
152500                                                                  15250057
152600***************************************************************** 15260055
152700 4310-ACCUM-STR-QTY.                                              15270055
152800***************************************************************** 15280055
152900     MOVE '4310-ACCUM-STR-QTY     ' TO PV-ABEND-PARAGRAPH.        15290055
153000                                                                  15300057
153100***  MOVE DK-REQ-PL-NBR           TO PV-ABEND-PULL-REQ.           15310056
153200***  MOVE DK-PL-LNE-NBR           TO PV-ABEND-PULL-LINE.          15320056
153300***  DISPLAY ' 4310-ACCUM-MF KEYS =' PV-ABEND-PULL-REQ            15330056
153400***    '=' PV-ABEND-PULL-LINE '=' PC-3SPACES '<' PV-EXTRACT-DATE. 15340056
153500                                                                  15350056
153600     EXEC SQL                                                     15360055
153700         SELECT SUM(MFST_UNT_QTY)                                 15370055
153800           INTO :PV-CEPLMF-UNT-QTY   :PV-NULL-IND-1               15380055
153900           FROM  TCEPLMF                                          15390055
154000          WHERE  CNSTK_REQ_PL_NBR  = :DK-REQ-PL-NBR               15400055
154100            AND  PL_LNE_NBR        = :DK-PL-LNE-NBR               15410055
154200            AND  EXPRT_PRC_BTCH_ID = :PC-3SPACES                  15420055
154300            AND  MFST_TMST        <= :PV-EXTRACT-DATE             15430062
154400     END-EXEC.                                                    15440055
154500                                                                  15450055
154600     EVALUATE TRUE                                                15460055
154700       WHEN SQLCODE = +0                                          15470055
154800           MOVE PV-CEPLMF-UNT-QTY TO PV-DISPLAY-REC               15480056
154900***        DISPLAY ' 4310-QTY = ' PV-DISPLAY-REC                  15490056
155000                                                                  15500055
155100       WHEN SQLWARN0 NOT = SPACE                                  15510055
155200       WHEN SQLCODE  NOT = +0                                     15520055
155300           MOVE '4310-ACCUM-STR-QTY   ' TO PV-ABEND-PARAGRAPH     15530055
155400           MOVE 'ACCUM   '              TO PV-ABEND-OPERATION     15540055
155500           MOVE 'TCEPLMF '              TO PV-DB2-TABLE-NAME      15550055
155600           MOVE CEPLMF-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      15560055
155700           MOVE CEPLMF-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     15570055
155800           STRING 'ACCUM CEPLMF QTY USING PULL#/LNE - '           15580055
155900                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          15590055
156000             DELIMITED BY SIZE                                    15600055
156100             INTO PV-DB2-OPERATION-MESSAGE-1                      15610055
156200           PERFORM Z999-SQL-ABEND                                 15620055
156300     END-EVALUATE.                                                15630055
156400                                                                  15640055
156500***************************************************************** 15650055
156600 4400-UPDATE-CEPLMF.                                              15660055
156700***************************************************************** 15670055
156800     MOVE '4400-UPDATE-CEPLMF   ' TO PV-ABEND-PARAGRAPH.          15680055
156900                                                                  15690055
157000     EXEC SQL                                                     15700055
157100         UPDATE TCEPLMF                                           15710055
157200            SET EXPRT_PRC_BTCH_ID = :PV-EXPRT-PRC-BTCH-ID         15720055
157300          WHERE CNSTK_REQ_PL_NBR  = :DK-REQ-PL-NBR                15730055
157400            AND PL_LNE_NBR        = :DK-PL-LNE-NBR                15740055
157500            AND STR_NBR           = :DK-STR-NBR                   15750055
157501            AND EXPRT_PRC_BTCH_ID = '   '                         15750165
157510            AND MFST_TMST        <= :PV-EXTRACT-DATE              15751062
157600     END-EXEC.                                                    15760055
157700                                                                  15770055
157800     EVALUATE TRUE                                                15780055
157900       WHEN SQLCODE = ZERO                                        15790055
158000           CONTINUE                                               15800055
158100                                                                  15810055
158200       WHEN OTHER                                                 15820055
158300           MOVE '4400-UPDATE-TCEPLMF  ' TO PV-ABEND-PARAGRAPH     15830055
158400           MOVE 'TCEPLMF'               TO PV-DB2-TABLE-NAME      15840055
158500           MOVE DK-REQ-PL-NBR           TO PV-ABEND-PULL-REQ      15850057
158600           MOVE DK-PL-LNE-NBR           TO PV-ABEND-PULL-LINE     15860057
158700           MOVE DK-STR-NBR              TO PV-ABEND-PULL-STR      15870057
158800           STRING 'UPDATE CEPLMF USING PULL#/LNE/STR - '          15880055
158900                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          15890055
159000                                  '/' PV-ABEND-PULL-STR           15900055
159100             DELIMITED BY SIZE                                    15910055
159200             INTO PV-DB2-OPERATION-MESSAGE-1                      15920055
159300           PERFORM Z999-SQL-ABEND                                 15930055
159400     END-EVALUATE.                                                15940055
159500                                                                  15950055
159600***************************************************************** 15960051
159700 5000-OPEN-CEPLAU-CSR.                                            15970051
159800***************************************************************** 15980051
159900     MOVE '5000-OPEN-CEPLAU-CSR' TO PV-ABEND-PARAGRAPH.           15990051
160000                                                                  16000051
160100     EXEC SQL                                                     16010051
160200         OPEN CEPLAU-CSR                                          16020051
160300     END-EXEC.                                                    16030051
160400                                                                  16040051
160500     EVALUATE TRUE                                                16050051
160600       WHEN SQLCODE = +0                                          16060051
160700           CONTINUE                                               16070051
160800                                                                  16080051
160900       WHEN SQLWARN0 NOT = SPACE                                  16090051
161000       WHEN SQLCODE  NOT = +0                                     16100051
161100           MOVE '5000-OPEN-CEPLAU-CSR' TO PV-ABEND-PARAGRAPH      16110051
161200           MOVE 'TCEPLAU'     TO PV-DB2-TABLE-NAME                16120051
161300           MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1       16130051
161400           PERFORM Z999-SQL-ABEND                                 16140051
161500     END-EVALUATE.                                                16150051
161600                                                                  16160051
161700***************************************************************** 16170051
161800 5100-FETCH-CEPLAU-CSR.                                           16180051
161900***************************************************************** 16190051
162000     MOVE '5100-FETCH-CEPLAU-CSR' TO PV-ABEND-PARAGRAPH.          16200051
162100                                                                  16210051
162200     EXEC SQL                                                     16220051
162300         FETCH CEPLAU-CSR                                         16230051
162400          INTO :CEPLAU-CNSTK-REQ-PL-NBR                           16240051
162500             , :CEPLAU-PL-LNE-NBR                                 16250051
162600             , :CEPLAU-STR-NBR                                    16260051
162800             , :PV-CEPLAU-DIF-QTY                                 16280063
163300     END-EXEC.                                                    16330051
163400                                                                  16340051
163500     EVALUATE TRUE                                                16350051
163600       WHEN SQLCODE = +0                                          16360051
163700           CONTINUE                                               16370051
163800                                                                  16380051
163900       WHEN SQLCODE = +100                                        16390051
164000           SET PS-AU-CSR-DONE-YES TO TRUE                         16400051
164100                                                                  16410051
164200       WHEN SQLWARN0 NOT = SPACE                                  16420051
164300       WHEN SQLCODE  NOT = +0                                     16430051
164400           MOVE '5100-FETCH-CEPLAU-CSR' TO PV-ABEND-PARAGRAPH     16440051
164500           MOVE 'FETCH   '              TO PV-ABEND-OPERATION     16450051
164600           MOVE 'TCEPLAU '              TO PV-DB2-TABLE-NAME      16460051
164700           PERFORM Z999-SQL-ABEND                                 16470051
164800     END-EVALUATE.                                                16480051
164900                                                                  16490051
165000***************************************************************** 16500051
165100 5200-CLOSE-CEPLAU-CSR.                                           16510051
165200***************************************************************** 16520051
165300     MOVE '5200-CLOSE-CEPLAU-CSR' TO PV-ABEND-PARAGRAPH.          16530051
165400                                                                  16540051
165500     EXEC SQL                                                     16550051
165600         CLOSE CEPLAU-CSR                                         16560051
165700     END-EXEC                                                     16570051
165800                                                                  16580051
165900     EVALUATE TRUE                                                16590051
166000       WHEN SQLCODE = ZERO                                        16600051
166100           CONTINUE                                               16610051
166200                                                                  16620051
166300       WHEN OTHER                                                 16630051
166400           PERFORM Z999-SQL-ABEND                                 16640051
166500     END-EVALUATE.                                                16650051
166600                                                                  16660051
166700***************************************************************** 16670051
166800 5300-PROCESS-CEPLAU.                                             16680051
166900***************************************************************** 16690051
167000     MOVE '5300-PROCESS-CEPLAU  ' TO PV-ABEND-PARAGRAPH.          16700051
167100                                                                  16710051
167101     MOVE CEPLAU-CNSTK-REQ-PL-NBR TO DK-REQ-PL-NBR.               16710174
167102     MOVE CEPLAU-PL-LNE-NBR       TO DK-PL-LNE-NBR.               16710274
167104     MOVE CEPLAU-STR-NBR          TO DK-STR-NBR.                  16710474
167105                                                                  16710574
167110     IF  PV-CEPLAU-DIF-QTY = 0                                    16711067
167111         CONTINUE                                                 16711167
167120     ELSE                                                         16712067
167400         PERFORM 2210-GET-REQ                                     16740067
167800         PERFORM 2215-GET-ITM                                     16780067
167900         MOVE CEPLIT-ITM-NBR          TO DK-ITM-NBR               16790078
168200         PERFORM 2220-GET-SKU                                     16820067
168600         PERFORM 2216-GET-STR                                     16860067
168900         INITIALIZE CE012-CENTRAL-STK-XFER-RECORD                 16890067
169100         MOVE PV-CURRENT-DB2-DATE     TO CE012-BTCH-PRC-DTE       16910067
169200         MOVE CEPLAU-CNSTK-REQ-PL-NBR TO CE012-PULL-NBR           16920067
169300         MOVE CEPLAU-PL-LNE-NBR       TO CE012-PULL-LNE-NBR       16930067
169600         MOVE PV-CURRENT-DB2-DD       TO PV-BATCH-DAY             16960067
169700         MOVE PV-BATCH-NMBR           TO CE012-BATCH-NMBR         16970067
169800                                         PV-BATCH-NMBR-2          16980067
170100         MOVE XL001-DEPT-NBR-3CH      TO CE012-DEPT               17010086
170200         MOVE XL001-SUB-CL-NBR-2CH    TO CE012-CLASS              17020099
170300         MOVE XL001-SKU-NBR           TO CE012-SKU-NBR            17030099
170600         MOVE PV-CURRENT-DB2-DATE     TO PV-CEPLST-DS-DATE        17060067
170700         MOVE PV-CEPLST-DS-TMST-MM TO                             17070067
170710              CE012-FILLED-DATE-MMDDCCYY-MM                       17071067
170800         MOVE PV-CEPLST-DS-TMST-DD TO                             17080067
170810              CE012-FILLED-DATE-MMDDCCYY-DD                       17081067
170900         MOVE PV-CEPLST-DS-TMST-CC TO                             17090067
170910              CE012-FILLED-DATE-MMDDCCYY-CC                       17091067
171000         MOVE PV-CEPLST-DS-TMST-YY TO                             17100067
171010              CE012-FILLED-DATE-MMDDCCYY-YY                       17101067
171101         IF  PV-CEPLAU-DIF-QTY < 0                                17110169
171103             MOVE CEPLRQ-CNSTK-LOC-ID     TO CE012-RECV-STORE-NMBR17110367
171105             MOVE CEPLAU-STR-NBR          TO CE012-DC-STORE-NMBR  17110567
171106             MOVE PV-CEPLAU-DIF-QTY       TO CE012-TOTAL-QTY      17110669
171107                                             CE012-RECV-STORE-QTY 17110769
171111         ELSE                                                     17111167
171112             MOVE CEPLRQ-CNSTK-LOC-ID     TO CE012-DC-STORE-NMBR  17111267
171114             MOVE CEPLAU-STR-NBR          TO CE012-RECV-STORE-NMBR17111467
171115             MOVE PV-CEPLAU-DIF-QTY       TO CE012-RECV-STORE-QTY 17111569
171116             DISPLAY 'DK REQ PL NBR = '                           17111672
171117                      DK-REQ-PL-NBR                               17111772
171118             DISPLAY 'PV REQ PL NBR PREV = '                      17111872
171119                      PV-REQ-PL-NBR-PREV2                         17111973
171120             DISPLAY 'DK PL LNE NBR = '                           17112072
171121                      DK-PL-LNE-NBR                               17112172
171122             DISPLAY 'PV PL LNE NBR PREV = '                      17112272
171123                      PV-PL-LNE-NBR-PREV2                         17112373
171124             IF  DK-REQ-PL-NBR EQUAL PV-REQ-PL-NBR-PREV2          17112473
171125             AND DK-PL-LNE-NBR EQUAL PV-PL-LNE-NBR-PREV2          17112573
171126                 MOVE PV-CEPLAU-ADJ-TOT-QTY   TO CE012-TOTAL-QTY  17112672
171127*                DISPLAY 'BYPASSED 5310 '                         17112783
171128             ELSE                                                 17112872
171129*                DISPLAY 'EXECUTED 5310 '                         17112983
171130                 SET PS-AU-SUM-CSR-DONE-NO TO TRUE                17113075
171131                 MOVE ZEROS TO PV-CEPLAU-ADJ-TOT-QTY              17113175
171132                               PV-CEPLAU-DIF-SUM-QTY              17113275
171133                 PERFORM 5330-OPEN-CEPLAU-SUM-CSR                 17113375
171134                 PERFORM 5340-FETCH-CEPLAU-SUM-CSR                17113475
171137                   UNTIL PS-AU-SUM-CSR-DONE-YES                   17113775
171140                 PERFORM 5360-CLOSE-CEPLAU-SUM-CSR                17114075
171141*                PERFORM 5310-ACCUM-STR-QTY                       17114175
171142                 MOVE PV-CEPLAU-ADJ-TOT-QTY   TO CE012-TOTAL-QTY  17114272
171143                 MOVE DK-REQ-PL-NBR TO PV-REQ-PL-NBR-PREV2        17114373
171144                 MOVE DK-PL-LNE-NBR TO PV-PL-LNE-NBR-PREV2        17114473
171145             END-IF                                               17114572
171150         END-IF                                                   17115067
173500         IF  CEPLIT-UNT-RTL-AMT EQUAL 0.00                        17350067
173600             MOVE 0.01                TO CE012-UNIT-PRICE         17360067
173700         ELSE                                                     17370067
173800             MOVE CEPLIT-UNT-RTL-AMT  TO CE012-UNIT-PRICE         17380067
173900         END-IF                                                   17390067
174700         SET CE012-ADJUST-SOURCE      TO TRUE                     17470067
175000         MOVE CE012-CENTRAL-STK-XFER-RECORD TO                    17500067
175100              CEOUT1-CNSTK-SYS-RPTG-ODR                           17510067
175200         PERFORM 5320-WRITE-TO-TCEOUT1                            17520067
175300                                                                  17530069
180500* UPDATE THE AUDIT ROWS TO INDICATE THAT THEY HAVE BEEN           18050067
180510* EXTRACTED AND SENT FOR PROCESSING.                              18051067
180900     PERFORM 5400-UPDATE-CEPLAU.                                  18090060
181000                                                                  18100069
181010* GET NEXT QUALIFIED CEPLAU TABLE ENTRY.                          18101069
181020     PERFORM 5100-FETCH-CEPLAU-CSR.                               18102069
181100                                                                  18110057
181200*AFTER PROCESSING MANIFEST ROW, SAVE PULL KEYS.                   18120057
181300     IF  PS-AU-CSR-DONE-NO                                        18130060
181400         MOVE DK-REQ-PL-NBR TO PV-REQ-PL-NBR-PREV                 18140057
181500         MOVE DK-PL-LNE-NBR TO PV-PL-LNE-NBR-PREV                 18150057
181600     END-IF.                                                      18160057
181700                                                                  18170057
181800***************************************************************** 18180055
181900 5310-ACCUM-STR-QTY.                                              18190055
182000***************************************************************** 18200055
182100     MOVE '5310-ACCUM-STR-QTY     ' TO PV-ABEND-PARAGRAPH.        18210055
182200                                                                  18220055
182300     MOVE ZEROES TO PV-CEPLAU-ADJ-TOT-QTY.                        18230070
182500                                                                  18250055
182600     EXEC SQL                                                     18260055
182700         SELECT SUM(AFT_ADJ_UNT_QTY - BEF_ADJ_UNT_QTY)            18270070
182900           INTO :PV-CEPLAU-ADJ-TOT-QTY  :PV-NULL-IND-2            18290070
183100           FROM TCEPLAU                                           18310055
183200          WHERE CNSTK_REQ_PL_NBR   = :DK-REQ-PL-NBR               18320055
183300            AND PL_LNE_NBR         = :DK-PL-LNE-NBR               18330055
183400            AND EXPRT_PRC_BTCH_ID  = :PC-3SPACES                  18340055
183500            AND ADJ_TMST          <= :PV-EXTRACT-DATE             18350070
183510            AND AFT_ADJ_UNT_QTY    > BEF_ADJ_UNT_QTY              18351071
183600     END-EXEC.                                                    18360055
183700                                                                  18370055
183800     EVALUATE TRUE                                                18380055
183900       WHEN SQLCODE = +0                                          18390055
183910            IF  PV-NULL-IND-2 < +0                                18391070
183911                DISPLAY 'NULL IND = 0'                            18391172
183920                MOVE ZEROES TO PV-CEPLAU-ADJ-TOT-QTY              18392070
183930            END-IF                                                18393070
184100                                                                  18410055
184200       WHEN SQLWARN0 NOT = SPACE                                  18420055
184300       WHEN SQLCODE  NOT = +0                                     18430055
184400           MOVE '5310-ACCUM-STR-QTY   ' TO PV-ABEND-PARAGRAPH     18440055
184500           MOVE 'ACCUM   '              TO PV-ABEND-OPERATION     18450055
184600           MOVE 'TCEPLAU '              TO PV-DB2-TABLE-NAME      18460055
184700           MOVE CEPLAU-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      18470055
184800           MOVE CEPLAU-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     18480055
184900           STRING 'ACCUM CEPLAU QTY USING PULL#/LNE - '           18490055
185000                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          18500055
185100             DELIMITED BY SIZE                                    18510055
185200             INTO PV-DB2-OPERATION-MESSAGE-1                      18520055
185300           PERFORM Z999-SQL-ABEND                                 18530055
185400     END-EVALUATE.                                                18540055
185500                                                                  18550055
185501***************************************************************** 18550167
185502 5320-WRITE-TO-TCEOUT1.                                           18550267
185503***************************************************************** 18550367
185504                                                                  18550467
185505     MOVE '5320-WRITE-TO-TCEOUT1' TO PV-ABEND-PARAGRAPH.          18550567
185506                                                                  18550667
185520     PERFORM WITH TEST AFTER                                      18552067
185530       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       18553067
185540         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  18554067
185550            OR SQLCODE = ZERO                                     18555067
185560                                                                  18556067
185570     EXEC SQL                                                     18557067
185580         INSERT INTO TCEOUT1                                      18558067
185590                 (CNSTK_SYS_RPTG_ODR)                             18559067
185591          VALUES (:CEOUT1-CNSTK-SYS-RPTG-ODR)                     18559167
185592     END-EXEC                                                     18559267
185593                                                                  18559367
185594     EVALUATE TRUE                                                18559467
185595       WHEN SQLCODE = ZERO                                        18559567
185596           ADD 1 TO PV-RECS-WRITTEN                               18559667
185597                    PV-RECS-WRITTEN-A                             18559767
185598                                                                  18559867
185599       WHEN OTHER                                                 18559967
185601           MOVE 'INSERT  '              TO PV-ABEND-OPERATION     18560167
185602           MOVE 'TCEOUT1 '              TO PV-DB2-TABLE-NAME      18560267
185603           MOVE CEPLAU-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ      18560367
185604           MOVE CEPLAU-PL-LNE-NBR       TO PV-ABEND-PULL-LINE     18560467
185605           MOVE CEPLAU-STR-NBR          TO PV-ABEND-PULL-STR      18560567
185606           STRING 'INSERT TCEOUT1 USING PULL#/LNE/STR - '         18560667
185607                  PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE        18560767
185608                                    '/' PV-ABEND-PULL-STR         18560867
185609             DELIMITED BY SIZE                                    18560967
185610             INTO PV-DB2-OPERATION-MESSAGE-1                      18561067
185611           PERFORM Z999-SQL-ABEND                                 18561167
185612     END-EVALUATE                                                 18561267
185613     END-PERFORM.                                                 18561367
185614                                                                  18561467
185615     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18561567
185616     AND SQLCODE NOT = ZERO                                       18561667
185618         MOVE 'MAX TRYS'              TO PV-ABEND-OPERATION       18561867
185619         MOVE 'TCEOUT1 '              TO PV-DB2-TABLE-NAME        18561967
185620         MOVE CEPLAU-CNSTK-REQ-PL-NBR TO PV-ABEND-PULL-REQ        18562067
185621         MOVE CEPLAU-PL-LNE-NBR       TO PV-ABEND-PULL-LINE       18562167
185622         MOVE CEPLAU-STR-NBR          TO PV-ABEND-PULL-STR        18562267
185623         STRING 'INSERT TCEOUT1 USING PULL#/LNE/STR - '           18562367
185624                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          18562467
185625                                  '/' PV-ABEND-PULL-STR           18562567
185626           DELIMITED BY SIZE                                      18562667
185627           INTO PV-DB2-OPERATION-MESSAGE-1                        18562767
185628         PERFORM Z999-SQL-ABEND                                   18562867
185629     END-IF.                                                      18562967
185630                                                                  18563067
185631***************************************************************** 18563175
185632 5330-OPEN-CEPLAU-SUM-CSR.                                        18563275
185640***************************************************************** 18564055
185641                                                                  18564175
185642     MOVE '5330-OPEN-CEPLAU-SUM-CSR' TO PV-ABEND-PARAGRAPH.       18564275
185643                                                                  18564375
185644     EXEC SQL                                                     18564475
185645         OPEN CEPLAU-TOT-CSR                                      18564575
185646     END-EXEC.                                                    18564675
185647                                                                  18564775
185648     EVALUATE TRUE                                                18564875
185649       WHEN SQLCODE = +0                                          18564975
185650           CONTINUE                                               18565075
185651                                                                  18565175
185652       WHEN SQLWARN0 NOT = SPACE                                  18565275
185653       WHEN SQLCODE  NOT = +0                                     18565375
185655           MOVE 'TCEPLAU'     TO PV-DB2-TABLE-NAME                18565575
185656           MOVE 'OPEN CURSOR' TO PV-DB2-OPERATION-MESSAGE-1       18565675
185657           PERFORM Z999-SQL-ABEND                                 18565775
185658     END-EVALUATE.                                                18565875
185659                                                                  18565975
185660***************************************************************** 18566075
185661 5340-FETCH-CEPLAU-SUM-CSR.                                       18566175
185662***************************************************************** 18566275
185663     MOVE '5340-FETCH-CEPLAU-SUM-CSR' TO PV-ABEND-PARAGRAPH.      18566375
185664                                                                  18566475
185665     EXEC SQL                                                     18566575
185666         FETCH CEPLAU-TOT-CSR                                     18566675
185670          INTO :PV-CEPLAU-DIF-SUM-QTY                             18567075
185671     END-EXEC.                                                    18567175
185672                                                                  18567275
185673     EVALUATE TRUE                                                18567375
185674       WHEN SQLCODE = +0                                          18567475
185675           ADD PV-CEPLAU-DIF-SUM-QTY  TO                          18567575
185676               PV-CEPLAU-ADJ-TOT-QTY                              18567675
185678                                                                  18567875
185679       WHEN SQLCODE = +100                                        18567975
185680           SET PS-AU-SUM-CSR-DONE-YES TO TRUE                     18568075
185681                                                                  18568175
185682       WHEN SQLWARN0 NOT = SPACE                                  18568275
185683       WHEN SQLCODE  NOT = +0                                     18568375
185684           MOVE 'FETCH   '              TO PV-ABEND-OPERATION     18568475
185685           MOVE 'TCEPLAU '              TO PV-DB2-TABLE-NAME      18568575
185686           PERFORM Z999-SQL-ABEND                                 18568675
185687     END-EVALUATE.                                                18568775
185688                                                                  18568875
185689***************************************************************** 18568975
185690 5360-CLOSE-CEPLAU-SUM-CSR.                                       18569075
185691***************************************************************** 18569175
185692     MOVE '5360-CLOSE-CEPLAU-SUM-CSR' TO PV-ABEND-PARAGRAPH.      18569275
185693                                                                  18569375
185694     EXEC SQL                                                     18569475
185695         CLOSE CEPLAU-TOT-CSR                                     18569575
185696     END-EXEC                                                     18569675
185697                                                                  18569775
185698     EVALUATE TRUE                                                18569875
185699       WHEN SQLCODE = ZERO                                        18569975
185700           CONTINUE                                               18570075
185701                                                                  18570175
185702       WHEN OTHER                                                 18570275
185703           MOVE 'CLOSE CURSOR'          TO PV-ABEND-OPERATION     18570375
185704           MOVE 'TCEPLAU '              TO PV-DB2-TABLE-NAME      18570475
185705           PERFORM Z999-SQL-ABEND                                 18570575
185706     END-EVALUATE.                                                18570675
185707                                                                  18570775
185708***************************************************************** 18570875
185710 5400-UPDATE-CEPLAU.                                              18571055
185800***************************************************************** 18580055
185900     MOVE '5400-UPDATE-CEPLAU   ' TO PV-ABEND-PARAGRAPH.          18590055
186000                                                                  18600055
186100     EXEC SQL                                                     18610055
186200         UPDATE TCEPLAU                                           18620055
186300            SET EXPRT_PRC_BTCH_ID = :PV-EXPRT-PRC-BTCH-ID         18630055
186400          WHERE CNSTK_REQ_PL_NBR  = :DK-REQ-PL-NBR                18640055
186500            AND PL_LNE_NBR        = :DK-PL-LNE-NBR                18650055
186600            AND STR_NBR           = :DK-STR-NBR                   18660055
186610            AND EXPRT_PRC_BTCH_ID = '   '                         18661065
186620            AND ADJ_TMST          <= :PV-EXTRACT-DATE             18662065
186700     END-EXEC.                                                    18670055
186800                                                                  18680055
186900     EVALUATE TRUE                                                18690055
187000       WHEN SQLCODE = ZERO                                        18700055
187100           CONTINUE                                               18710055
187200                                                                  18720055
187300       WHEN OTHER                                                 18730055
187400           MOVE '5400-UPDATE-TCEPLAU  ' TO PV-ABEND-PARAGRAPH     18740055
187500           MOVE 'TCEPLAU'               TO PV-DB2-TABLE-NAME      18750055
187600           MOVE DK-REQ-PL-NBR           TO PV-ABEND-PULL-REQ      18760057
187700           MOVE DK-PL-LNE-NBR           TO PV-ABEND-PULL-LINE     18770057
187800           MOVE DK-STR-NBR              TO PV-ABEND-PULL-STR      18780057
187900           STRING 'UPDATE CEPLAU USING PULL#/LNE/STR - '          18790055
188000                PV-ABEND-PULL-REQ '/' PV-ABEND-PULL-LINE          18800055
188100                                  '/' PV-ABEND-PULL-STR           18810055
188200             DELIMITED BY SIZE                                    18820055
188300             INTO PV-DB2-OPERATION-MESSAGE-1                      18830055
188400           PERFORM Z999-SQL-ABEND                                 18840055
188500     END-EVALUATE.                                                18850055
188600                                                                  18860055
188700***************************************************************** 18870051
188800 Z999-SQL-ABEND.                                                  18880051
188900***************************************************************** 18890047
189000     MOVE SQLCODE TO PV-SQLCODE.                                  18900047
189100     DISPLAY '*** DB2 ERROR '.                                    18910047
189200     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       18920047
189300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 18930047
189400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               18940047
189500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               18950047
189600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       18960047
189700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       18970047
189800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       18980047
189900     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             18990047
190000                                                                  19000047
190100     COPY DPPD004.                                                19010047
190200                                                                  19020047
190300     MOVE +4013 TO PV-ABEND-CODE.                                 19030047
190400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         19040047
