000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS560.                                         00040000
000500 AUTHOR.        DEANNA BRANTNER.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  JUNE, 2001.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900*---------------------------------------------------------------* 00090000
001000*    S560 - SHIPPING DOOR STATUS  - TRAILER HISTORY LIST        * 00100000
001100*---------------------------------------------------------------* 00110003
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00112025
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00113025
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00114025
001130*                                                                 00114126
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00114226
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00114326
263968*---------------------------------------------------------------* 00115025
001200 ENVIRONMENT DIVISION.                                            00120003
001300 DATA DIVISION.                                                   00130003
001400                                                                  00140003
001500 WORKING-STORAGE SECTION.                                         00150003
001600 01  DK-DB2-KEYS.                                                 00160003
001700     05  DK-FROM-TMST                   PIC  X(26)  VALUE SPACES. 00170003
001800     05  DK-TO-TMST                     PIC  X(26)  VALUE SPACES. 00180003
001900     05  DK-SCAC-TRLR-ID.                                         00190003
002000         10  DK-SCAC                    PIC X(04)  VALUE SPACES.  00200003
002100         10  FILLER                     PIC X(01)  VALUE '/'.     00210003
002200         10  DK-TRLR-ID                 PIC X(12)  VALUE SPACES.  00220003
002300     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00230003
002400                                                    COMP.         00240003
002500     05  DK-TRLR-SRL-NBR                PIC S9(09)  VALUE ZERO    00250003
002600                                                    COMP.         00260003
002700     05  DK-TRIP-ID                     PIC S9(09)  VALUE ZERO    00270003
002800                                                    COMP.         00280003
002900     05  DK-STORE-NUMBER                PIC S9(04)  VALUE ZERO    00290003
003000                                                    COMP.         00300003
003100 01  PC-PROGRAM-CONSTANTS.                                        00310003
003200     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'SU560A  '.  00320003
003300     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'SUKM560'.   00330003
003400     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'SUKCS560'.  00340003
003500     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00350003
003600     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00360003
003700     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00370003
003800     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00380003
003900     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +12          00390003
004000                                               COMP SYNC.         00400003
004100     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00410003
004200                                               COMP SYNC.         00420003
004300     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00430003
004400                                               COMP-3.            00440003
004500     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00450003
004600                                               COMP SYNC.         00460003
004700     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00470003
004800                                               COMP-3.            00480003
004900     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00490003
005000     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00500003
005100     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00510003
005200     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00520003
005300     05  PC-NEW                    PIC  X(02)  VALUE 'NW'.        00530003
005400     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00540003
005500     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00550003
005600                                               COMP.              00560003
005700     05  PC-01                     PIC  X(02)  VALUE '01'.        00570003
005800     05  PC-DO                     PIC  X(02)  VALUE 'DO'.        00580003
005900     05  PC-AO                     PIC  X(02)  VALUE 'AO'.        00590003
006000     05  PC-AK                     PIC  X(02)  VALUE 'AK'.        00600003
006100     05  PC-AR                     PIC  X(02)  VALUE 'AR'.        00610003
006200     05  PC-DS                     PIC  X(02)  VALUE 'DS'.        00620003
006300     05  PC-DC                     PIC  X(02)  VALUE 'DC'.        00630003
006400     05  PC-SO                     PIC  X(02)  VALUE 'SO'.        00640003
006500     05  PC-SU                     PIC  X(02)  VALUE 'SU'.        00650003
006600*                                                                 00660003
006700*                                                                 00670003
006800*----------------------------------------------------------------*00680003
006900*  SYSTEM MESSAGES                                               *00690003
007000*----------------------------------------------------------------*00700003
007100*   00005 = INVALID VALUE                                        *00710003
007200*   00008 = MUST BE NUMERIC                                      *00720003
007300*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00730003
007400*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00740003
007500*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00750003
007600*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00760003
007700*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00770003
007800*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00780003
007900*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00790003
008000*   00069 - TOP OF LIST                                          *00800003
008100*   00070 - BOTTOM OF LIST                                       *00810003
008200*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00820003
008300*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00830003
008400*   00279 - MORE ITEMS TO DISPLAY                                *00840003
008500*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00850003
008600*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00860003
008700*   99901 = INVALID COMMAND WAS ENTERED                          *00870003
008800*----------------------------------------------------------------*00880003
008900     05  PC-TSYMSG-NUMBERS.                                       00890003
009000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00900003
009100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00910003
009200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00920003
009300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00930003
009400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00940003
009500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00950003
009600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00960003
009700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00970003
009800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00980003
009900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00990003
010000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01000003
010100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01010003
010200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01020003
010300         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01030003
010400         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  01040003
010500         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  01050003
010600         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  01060003
010700         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01070003
010800         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  01080003
010900         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01090003
011000*                                                                 01100003
011100 01  PS-PROGRAM-SWITCHES.                                         01110003
011200     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01120003
011300         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01130003
011400         88  PS-BLOCK-ERROR                         VALUE 'N'.    01140003
011500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01150003
011600         88  PS-NO-ERROR                            VALUE 'Y'.    01160003
011700         88  PS-ERROR                               VALUE 'N'.    01170003
011800     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01180003
011900         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01190003
012000         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01200003
012100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01210003
012200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01220003
012300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01230003
012400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01240003
012500         88  PS-DONE                                VALUE 'Y'.    01250003
012600         88  PS-NOT-DONE                            VALUE 'N'.    01260003
012700     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01270003
012800         88  PS-LIST-END                            VALUE  'Y'.   01280003
012900         88  PS-NO-LIST-END                         VALUE  'N'.   01290003
013000     05  PS-CURSOR-SW                   PIC  X(01)  VALUE  ' '.   01300003
013100         88  PS-TRLR-SRL-NBR-CSR                    VALUE  'A'.   01310003
013200         88  PS-TRIP-ID-CSR                         VALUE  'B'.   01320003
013300     05  PS-ACCESS                      PIC  X(01)  VALUE 'N'.    01330003
013400         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.    01340003
013500         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.    01350003
013600*                                                                 01360003
013700 01 PV-PROGRAM-VARIABLES.                                         01370003
013800     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01380003
013900                                                     COMP SYNC.   01390003
014000     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01400003
014100     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01410003
014200     05  PV-RACF-ERROR-CODE             PIC 9(04)  VALUE ZEROES.  01420003
014300     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01430003
014400                                        COMP SYNC.                01440003
014500     05  PV-SUB                         PIC S9(04)  VALUE +0      01450003
014600                                                    COMP SYNC.    01460003
014700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01470003
014800                                                    COMP SYNC.    01480003
014900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01490003
015000                                                    COMP-3.       01500003
015100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01510003
015200                                                    COMP-3.       01520003
015300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01530003
015400                                                    COMP-3.       01540003
015500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01550003
015600                                                    COMP-3.       01560003
015700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01570003
015800                                                    COMP-3.       01580003
015900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01590003
016000                                                    COMP-3.       01600003
016100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01610003
016200                                                    COMP-3.       01620003
016300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01630003
016400                                                    COMP SYNC.    01640003
016500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01650003
016600                                                    COMP SYNC.    01660003
016700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01670003
016800                                                    COMP SYNC.    01680003
016900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01690003
017000                                                    COMP SYNC.    01700003
017100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01710003
017200                                                    COMP SYNC.    01720003
017300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01730003
017400                                                    COMP SYNC.    01740003
017500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01750003
017600                                                    COMP SYNC.    01760003
017700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01770003
017800                                                    COMP SYNC.    01780003
017900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01790003
018000                                                    COMP SYNC.    01800003
018100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01810003
018200                                                    COMP SYNC.    01820003
018300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01830003
018400                                                    COMP SYNC.    01840003
018500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01850003
018600                                                    COMP SYNC.    01860003
018700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01870003
018800                                                    COMP SYNC.    01880003
018900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01890003
019000                                                    COMP SYNC.    01900003
019100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01910003
019200                                                    COMP SYNC.    01920003
019300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01930003
019400                                                    COMP SYNC.    01940003
019500     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      01950003
019600                                                    COMP.         01960003
019700     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      01970003
019800                                                    COMP.         01980003
019900     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      01990003
020000                                                    COMP.         02000003
020100     05  PV-SOFT-ABORT-MSG.                                       02010003
020200         10  FILLER            PIC X(12) VALUE ' SUKCS560 - '.    02020003
020300         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       02030003
020400         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    02040003
020500         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    02050003
020600         10  PV-SOFT-PARAGRAPH PIC X(30).                         02060003
020700     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02070003
020800                                                     COMP SYNC.   02080003
020900     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02090003
021000     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02100003
021100     05  PV-CICS-MSG-HOLD.                                        02110003
021200         10  FILLER                      PIC  X(01)  VALUE SPACE. 02120003
021300         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02130003
021400     05  PV-CICS-MSG-HOLD2.                                       02140003
021500         10  FILLER                      PIC  X(01)  VALUE SPACE. 02150003
021600         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02160003
021700                                                                  02170003
021800     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02180003
021900     05  PV-TMST-R REDEFINES  PV-TMST.                            02190003
022000         10   PV-TMST-DATE.                                       02200003
022100             15   PV-TMST-YY            PIC X(04).                02210003
022200             15   FILLER                PIC X(01).                02220003
022300             15   PV-TMST-MM            PIC X(02).                02230003
022400             15   FILLER                PIC X(01).                02240003
022500             15   PV-TMST-DD            PIC X(02).                02250003
022600         10   FILLER                    PIC X(01).                02260003
022700         10   PV-TMST-TIME.                                       02270003
022800             15   PV-TMST-HRS           PIC X(02).                02280003
022900             15   FILLER                PIC X(01).                02290003
023000             15   PV-TMST-MIN           PIC X(02).                02300003
023100         10   FILLER                    PIC X(01).                02310003
023200         10   PV-TMST-SEC               PIC X(02).                02320003
023300         10   FILLER                    PIC X(07).                02330003
023400     05  PV-FROM-TMST.                                            02340003
023500         10   PV-FROM-YY    PIC X(04)  VALUE ZEROES.              02350003
023600         10   FILLER        PIC X(01)  VALUE '-'.                 02360003
023700         10   PV-FROM-MM    PIC X(02)  VALUE ZEROES.              02370003
023800         10   FILLER        PIC X(01)  VALUE '-'.                 02380003
023900         10   PV-FROM-DD    PIC X(02)  VALUE ZEROES.              02390003
024000         10   FILLER        PIC X(16)  VALUE '-00.00.00.000000'.  02400003
024100     05  PV-TO-TMST.                                              02410003
024200         10   PV-TO-YY      PIC X(04)  VALUE ZEROES.              02420003
024300         10   FILLER        PIC X(01)  VALUE '-'.                 02430003
024400         10   PV-TO-MM      PIC X(02)  VALUE ZEROES.              02440003
024500         10   FILLER        PIC X(01)  VALUE '-'.                 02450003
024600         10   PV-TO-DD      PIC X(02)  VALUE ZEROES.              02460003
024700         10   FILLER        PIC X(16)  VALUE '-23.59.59.999999'.  02470003
024800     05  PV-DATE-TIME-DISPLAY.                                    02480003
024900         10   PV-DISPLAY-MM             PIC X(02)   VALUE SPACES. 02490003
025000         10   PV-SLASH-1                PIC X(01)   VALUE SPACES. 02500003
025100         10   PV-DISPLAY-DD             PIC X(02)   VALUE SPACES. 02510003
025200         10   PV-SLASH-2                PIC X(01)   VALUE SPACES. 02520003
025300         10   PV-DISPLAY-CCYY           PIC X(04)   VALUE SPACES. 02530003
025400         10   PV-AT                     PIC X(03)   VALUE SPACES. 02540003
025500         10   PV-DISPLAY-HRS            PIC X(02)   VALUE SPACES. 02550003
025600         10   PV-SEMICOLON-1            PIC X(01)   VALUE SPACES. 02560003
025700         10   PV-DISPLAY-MIN            PIC X(02)   VALUE SPACES. 02570003
025800         10   PV-SEMICOLON-2            PIC X(01)   VALUE SPACES. 02580003
025900         10   PV-DISPLAY-SEC            PIC X(02)   VALUE SPACES. 02590003
026000     05  PV-CREATE-DATE                  PIC  X(08) VALUE SPACES. 02600003
026100     05  PV-USA-DATE                     PIC  X(10) VALUE SPACES. 02610003
026200     05  PV-JIS-TIME                     PIC  X(05) VALUE SPACES. 02620003
026300     05  PV-SELECT-LIST-SEQ              PIC  X(01) VALUE SPACES. 02630003
026400     05  PV-NBR-ITEMS                    PIC  9(05) VALUE ZEROES. 02640003
026500     05  PV-SEL-TERM-ID                  PIC  X(04).              02650003
026600     05  PV-SEL-TASK-NUMBER              PIC  9(05).              02660003
026700     05  PV-SEL-SEQ                      PIC  9(01).              02670003
026800                                                                  02680003
026900******************************************************************02690003
027000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02700003
027100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02710003
027200**  APPLICATION-SPECIFIC COMMAREA.                              **02720003
027300******************************************************************02730003
027400 01  LQW-LIST-QUEUE-WORK-AREA.                                    02740003
027500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02750003
027600     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           02760003
027700                                        INDEXED BY LQW-IDX.       02770003
027800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02780003
027900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02790003
028000         10  LQW-SELECTED-SW            PIC  X(01).               02800003
028100             88  LQW-SELECT                         VALUE 'S'.    02810003
028200             88  LQW-DESELECT                       VALUE ' '.    02820003
028300         10  LQW-ACTION                 PIC  X(03).               02830003
028400             88  LQW-DEL                            VALUE 'DEL'.  02840003
028500             88  LQW-INQ                            VALUE 'INQ'.  02850003
028600             88  LQW-UPD                            VALUE 'UPD'.  02860003
028700             88  LQW-ERR                            VALUE 'ERR'.  02870003
028800         10  LQW-TRIP-ID                PIC  9(09).               02880003
028900         10  LQW-TRIP-STATUS            PIC  X(24).               02890003
029000         10  LQW-STAT-DATE              PIC  X(10).               02900003
029100         10  LQW-STAT-TIME              PIC  X(05).               02910003
029200         10  LQW-USER-ID                PIC  X(08).               02920003
029300         10  LQW-DOOR-SLOT              PIC  X(06).               02930003
029400         10  LQW-DEST-NBR               PIC  9(04).               02940003
029500                                                                  02950003
029600*---------------------------------------------------------------* 02960003
029700* SELECTON QUEUE LAYOUT                                         * 02970003
029800*---------------------------------------------------------------* 02980003
029900     COPY SUWS010.                                                02990003
030000                                                                  03000003
030100*---------------------------------------------------------------* 03010003
030200*    MAP LAYOUT                                                 * 03020003
030300*---------------------------------------------------------------* 03030003
030400     COPY SUKM560.                                                03040003
030500*                                                                 03050003
030600 01  MR-OCCURS-LAYOUT                   REDEFINES  SU560AO.       03060003
030700     05  FILLER                         PIC X(087).               03070003
030800     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          03080003
030900         10  MR-SELECTL                 PIC S9(04) COMP.          03090003
031000         10  MR-SELECTA                 PIC  X(01).               03100003
031100         10  MR-SELECTC                 PIC  X(01).               03110003
031200         10  MR-SELECTH                 PIC  X(01).               03120003
031300         10  MR-SELECTI                 PIC  X(01).               03130003
031400                                                                  03140003
031500         10  MR-ACTIONL                 PIC S9(04) COMP.          03150003
031600         10  MR-ACTIONA                 PIC  X(01).               03160003
031700         10  MR-ACTIONC                 PIC  X(01).               03170003
031800         10  MR-ACTIONH                 PIC  X(01).               03180003
031900         10  MR-ACTION                  PIC  X(03).               03190003
032000                                                                  03200003
032100         10  MR-TRIP-IDL                PIC S9(04) COMP.          03210003
032200         10  MR-TRIP-IDA                PIC  X(01).               03220003
032300         10  MR-TRIP-IDC                PIC  X(01).               03230003
032400         10  MR-TRIP-IDH                PIC  X(01).               03240003
032500         10  MR-TRIP-ID                 PIC  X(09).               03250003
032600                                                                  03260003
032700         10  MR-TRIP-STATUSL            PIC S9(04) COMP.          03270003
032800         10  MR-TRIP-STATUSA            PIC  X(01).               03280003
032900         10  MR-TRIP-STATUSC            PIC  X(01).               03290003
033000         10  MR-TRIP-STATUSH            PIC  X(01).               03300003
033100         10  MR-TRIP-STATUS             PIC  X(24).               03310003
033200                                                                  03320003
033300         10  MR-STAT-DATEL              PIC S9(04) COMP.          03330003
033400         10  MR-STAT-DATEA              PIC  X(01).               03340003
033500         10  MR-STAT-DATEC              PIC  X(01).               03350003
033600         10  MR-STAT-DATEH              PIC  X(01).               03360003
033700         10  MR-STAT-DATE               PIC  X(10).               03370003
033800                                                                  03380003
033900         10  MR-STAT-TIMEL              PIC S9(04) COMP.          03390003
034000         10  MR-STAT-TIMEA              PIC  X(01).               03400003
034100         10  MR-STAT-TIMEC              PIC  X(01).               03410003
034200         10  MR-STAT-TIMEH              PIC  X(01).               03420003
034300         10  MR-STAT-TIME               PIC  X(05).               03430003
034400                                                                  03440003
034500         10  MR-USER-IDL                PIC S9(04) COMP.          03450003
034600         10  MR-USER-IDA                PIC  X(01).               03460003
034700         10  MR-USER-IDC                PIC  X(01).               03470003
034800         10  MR-USER-IDH                PIC  X(01).               03480003
034900         10  MR-USER-ID                 PIC  X(08).               03490003
035000                                                                  03500003
035100         10  MR-DOOR-SLOTL              PIC S9(04) COMP.          03510003
035200         10  MR-DOOR-SLOTA              PIC  X(01).               03520003
035300         10  MR-DOOR-SLOTC              PIC  X(01).               03530003
035400         10  MR-DOOR-SLOTH              PIC  X(01).               03540003
035500         10  MR-DOOR-SLOT               PIC  X(06).               03550003
035600                                                                  03560003
035700         10  MR-DEST-NBRL               PIC S9(04) COMP.          03570003
035800         10  MR-DEST-NBRA               PIC  X(01).               03580003
035900         10  MR-DEST-NBRC               PIC  X(01).               03590003
036000         10  MR-DEST-NBRH               PIC  X(01).               03600003
036100         10  MR-DEST-NBR                PIC  X(04).               03610003
036200                                                                  03620003
036300*---------------------------------------------------------------* 03630003
036400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03640003
036500*---------------------------------------------------------------* 03650003
036600     COPY DPWS015.                                                03660003
036700                                                                  03670003
036800*---------------------------------------------------------------* 03680003
036900*    FUNCTION KEYS COPYBOOK.                                    * 03690003
037000*---------------------------------------------------------------* 03700003
037100     COPY DPWS016.                                                03710003
037200                                                                  03720003
037300*---------------------------------------------------------------* 03730003
037400*    NUMERIC EDIT LAYOUT.                                       * 03740003
037500*---------------------------------------------------------------* 03750003
037600     COPY DPWS010I.                                               03760003
037700                                                                  03770003
037800*----------------------------------------------------------------*03780003
037900**  SECURITY SUBROUTINE PARAMETERS                                03790003
038000*----------------------------------------------------------------*03800003
038100     COPY DPWS008.                                                03810003
038200                                                                  03820003
038300*---------------------------------------------------------------* 03830003
038400*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 03840026
038500*---------------------------------------------------------------* 03850003
038600     COPY DPWS030.                                                03860003
038600     COPY DPWS930.                                                03861026
038700                                                                  03870003
038800*---------------------------------------------------------------* 03880003
038900*    STANDARD COMMAREA.                                         * 03890003
039000*---------------------------------------------------------------* 03900003
039100     COPY DPWS020.                                                03910003
039200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03920003
039300                                                                  03930003
039400*---------------------------------------------------------------* 03940003
039500* INTER-APPLICATION COMMAREA.                                   * 03950003
039600*   SUWS008 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03960003
039700*             SPEC SCREEN.                                      * 03970003
039800*   SUWS009 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03980003
039900*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03990003
040000*---------------------------------------------------------------* 04000003
040100                                                                  04010003
040200         10  INTER-APPL-COMM-AREA       PIC X(200).               04020003
040300     COPY SUWS008.                                                04030003
040400     COPY SUWS009.                                                04040003
040500*---------------------------------------------------------------* 04050003
040600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04060003
040700*---------------------------------------------------------------* 04070003
040800         10  ASC-SPECIFIC-COMMAREA.                               04080003
040900             15  ASC-OPER-UNT-ID             PIC  X(04).          04090003
041000             15  ASC-OPER-UNT-ID-N REDEFINES                      04100003
041100                     ASC-OPER-UNT-ID         PIC  9(04).          04110003
041200             15  ASC-DOOR-ID                 PIC  X(04).          04120003
041300             15  ASC-DOOR-ID-R  REDEFINES ASC-DOOR-ID.            04130003
041400                 20  ASC-DOOR-ID-N           PIC  9(04).          04140003
041500             15  ASC-DOOR-DESC               PIC  X(25).          04150003
041600             15  ASC-DOOR-TYPE               PIC  X(10).          04160003
041700             15  ASC-TRLR-SRL-NMBR           PIC  9(09).          04170003
041800             15  ASC-SCAC-CODE               PIC  X(04).          04180003
041900             15  ASC-TRLR-ID                 PIC  X(12).          04190003
042000             15  ASC-SCAC-TRLR-ID            PIC  X(17).          04200003
042100             15  ASC-STR-NBR-X               PIC  X(04).          04210003
042200             15  ASC-STR-NBR-N REDEFINES ASC-STR-NBR-X.           04220003
042300                 20  ASC-STR-NBR             PIC  9(04).          04230003
042400             15  ASC-OUTBOUND-TRIP-ID        PIC  9(09).          04240003
042500             15  ASC-TRIP-STAT-CDE           PIC  X(24).          04250003
042600             15  ASC-DOORSLOT                PIC  X(06).          04260003
042700             15  ASC-STATUS-DATE             PIC  X(10).          04270003
042800             15  ASC-STATUS-TIME             PIC  X(05).          04280003
042900             15  ASC-USERID                  PIC  X(08).          04290003
043000             15  FILLER                      PIC  X(125).         04300003
043100*-----------------------------------------------------------------04310003
043200             15  ASC-BLK-SUB                  PIC S9(04) COMP     04320003
043300                                                         SYNC.    04330003
043400             15  ASC-ITEM-SUB                 PIC S9(04) COMP     04340003
043500                                                         SYNC.    04350003
043600             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  04360003
043700             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  04370003
043800             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  04380003
043900             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  04390003
044000             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  04400003
044100             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     04410003
044200                                                         SYNC.    04420003
044300             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  04430003
044400             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  04440003
044500             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         04450003
044600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04460003
044700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04470003
044800             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         04480003
044900                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04490003
045000                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04500003
045100             15  ASC-LIST-QUEUE-NAME.                             04510003
045200                 20  ASC-LIST-TERM-ID         PIC  X(04).         04520003
045300                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04530003
045400                 20  ASC-LIST-SEQ             PIC  9(01).         04540003
045500                                                                  04550003
045600             15  ASC-START-ITEM-REQUEST.                          04560003
045700                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         04570003
045800                                                                  04580003
045900             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04590003
046000             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04600003
046100             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04610003
046200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04620003
046300*** BEGIN - AHP 12/31/07                                          04630024
046610             15  ASC-SEL-QUEUE-NAME-IN.                           04661022
046620                 20  ASC-SEL-TERM-ID-IN       PIC  X(04).         04662022
046630                 20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  04663023
046640                 20  ASC-SEL-SEQ-IN           PIC  9(01).         04664022
046650             15  ASC-SEL-QUEUE-NAME-OUT.                          04665022
046660                 20  ASC-SEL-TERM-ID-OUT      PIC  X(04).         04666022
046670                 20  ASC-SEL-TASK-NUMBER-OUT  PIC S9(05) COMP-3.  04667023
046680                 20  ASC-SEL-SEQ-OUT          PIC  9(01).         04668022
046700             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04670003
046710*** END   - AHP 12/31/07                                          04671024
046800                                                                  04680003
046900*-----------------------------------------------------------------04690003
047000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04700003
047100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04710003
047200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04720003
047300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04730003
047400                                                                  04740003
047500                 20  ASC-ITEM-ARRAY.                              04750003
047600                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        04760003
047700                         30  ASC-LIST-ITEM-NUMBER                 04770003
047800                                                     PIC S9(09)   04780003
047900                                                     COMP-3.      04790003
048000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04800003
048100                             88  ASC-VALID-SELECT    VALUE ' '    04810003
048200                                                           'S'    04820003
048300                                                           'B'    04830003
048400                                                           'E'.   04840003
048500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04850003
048600                             88  ASC-TEMP-SELECT     VALUE 'S'.   04860003
048700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04870003
048800                             88  ASC-TEMP-END        VALUE 'E'.   04880003
048900                         30  ASC-SELECTED-SW         PIC  X(01).  04890003
049000                             88  ASC-NO-SELECT       VALUE ' '.   04900003
049100                             88  ASC-SELECT          VALUE 'S'.   04910003
049200                             88  ASC-BEGIN           VALUE 'B'.   04920003
049300                             88  ASC-END             VALUE 'E'.   04930003
049400                         30  ASC-ACTION              PIC  X(03).  04940003
049500                         30  ASC-TRIP-ID             PIC  9(09).  04950003
049600                         30  ASC-TRIP-STATUS         PIC  X(24).  04960003
049700                         30  ASC-STAT-DATE           PIC  X(10).  04970003
049800                         30  ASC-STAT-TIME           PIC  X(05).  04980003
049900                         30  ASC-USER-ID             PIC  X(08).  04990003
050000                         30  ASC-DOOR-SLOT           PIC  X(06).  05000003
050100                         30  ASC-DEST-NBR            PIC  9(04).  05010003
050200                                                                  05020003
050300*---------------------------------------------------------------* 05030003
050400*    ABEND PROCESSING COPYBOOK.                                 * 05040003
050500*---------------------------------------------------------------* 05050003
050600     COPY DPWS013.                                                05060003
050700                                                                  05070003
050800*---------------------------------------------------------------* 05080003
050900*    TSUOBTR - OUTBOUND TRAILER TRIP                            * 05090003
051000*---------------------------------------------------------------* 05100003
051100     EXEC SQL                                                     05110003
051200          INCLUDE TSUOBTR                                         05120003
051300     END-EXEC.                                                    05130003
051400                                                                  05140003
051500*---------------------------------------------------------------* 05150003
051600*    TSUOBTS - OUTBOUND TRAILER TRIP STATUS                     * 05160003
051700*---------------------------------------------------------------* 05170003
051800     EXEC SQL                                                     05180003
051900          INCLUDE TSUOBTS                                         05190003
052000     END-EXEC.                                                    05200003
052100                                                                  05210003
052200*---------------------------------------------------------------* 05220003
052300*    TSUOBSC - TRIP STATUS CODE DESCRIPTION                       05230003
052400*---------------------------------------------------------------* 05240003
052500     EXEC SQL                                                     05250003
052600          INCLUDE TSUOBSC                                         05260003
052700     END-EXEC.                                                    05270003
052800                                                                  05280003
052900*---------------------------------------------------------------* 05290003
053000*    TCNDCDR - DC TO DOOR ASSIGNMENT                            * 05300003
053100*---------------------------------------------------------------* 05310003
053200     EXEC SQL                                                     05320003
053300          INCLUDE TCNDCDR                                         05330003
053400     END-EXEC.                                                    05340003
053500                                                                  05350003
053600*---------------------------------------------------------------* 05360003
053700*    TCNTRID - TRAILIER ID TABLE                                  05370003
053800*---------------------------------------------------------------* 05380003
053900     EXEC SQL                                                     05390003
054000          INCLUDE TCNTRID                                         05400003
054100     END-EXEC.                                                    05410003
054200                                                                  05420003
054300*---------------------------------------------------------------* 05430003
054400*    DB2 AREA FOR COMMUNICATIONS                                * 05440003
054500*---------------------------------------------------------------* 05450003
054600     EXEC SQL                                                     05460003
054700          INCLUDE SQLCA                                           05470003
054800     END-EXEC.                                                    05480003
054900                                                                  05490003
055000*---------------------------------------------------------------* 05500003
055100*    TRAILER SERIAL NUMBER CURSOR                                 05510003
055200*---------------------------------------------------------------* 05520003
055300      EXEC SQL                                                    05530003
055400          DECLARE TRLR-SRL-NBR-CSR CURSOR FOR                     05540003
055500                 SELECT  A.TRLR_SRL_NBR                           05550003
055600                        ,A.OTBND_TRIP_ID                          05560003
055700                        ,A.DEST_OPER_UNT_ID                       05570003
055800                        ,B.OTBND_STAT_TMST                        05580003
055900                        ,CHAR(DATE(B.OTBND_STAT_TMST),USA)        05590003
056000                        ,CHAR(TIME(B.OTBND_STAT_TMST),JIS)        05600003
056100                        ,B.TRIP_STAT_CDE                          05610003
056200                        ,B.OTBND_STAT_USR_ID                      05620003
056300                        ,B.DOOR_ID                                05630003
056400                        ,B.SHIP_SCAC_CDE                          05640003
056500                        ,B.TRLR_PRKG_LOC_DESC                     05650003
056600                        ,B.TRLR_PRKG_SLOT_NBR                     05660003
056700                        ,C.TRIP_STAT_DESC                         05670003
056800                   FROM  TSUOBTR A                                05680003
056900                        ,TSUOBTS B                                05690003
057000                        ,TSUOBSC C                                05700003
057100                  WHERE  A.TRLR_SRL_NBR     = :DK-TRLR-SRL-NBR    05710003
057200                    AND  A.TRIP_ACTV_CDE    = 'A'                 05720016
057300                    AND  A.OTBND_TRIP_ID    = B.OTBND_TRIP_ID     05730017
057400                    AND  B.TRIP_STAT_CDE    = C.TRIP_STAT_CDE     05740017
057500                  ORDER BY                                        05750017
057600                    B.OTBND_STAT_TMST  DESC                       05760017
057700                  , A.OTBND_TRIP_ID                               05770017
057800             END-EXEC.                                            05780003
057900                                                                  05790003
058000*---------------------------------------------------------------* 05800003
058100*    TRIP ID CURSOR                                               05810003
058200*---------------------------------------------------------------* 05820003
058300      EXEC SQL                                                    05830003
058400          DECLARE TRIP-ID-CSR CURSOR FOR                          05840003
058500                 SELECT  A.TRLR_SRL_NBR                           05850003
058600                        ,A.OTBND_TRIP_ID                          05860003
058700                        ,A.DEST_OPER_UNT_ID                       05870003
058800                        ,B.OTBND_STAT_TMST                        05880003
058900                        ,CHAR(DATE(B.OTBND_STAT_TMST),USA)        05890003
059000                        ,CHAR(TIME(B.OTBND_STAT_TMST),JIS)        05900003
059100                        ,B.TRIP_STAT_CDE                          05910003
059200                        ,B.OTBND_STAT_USR_ID                      05920003
059300                        ,B.DOOR_ID                                05930003
059400                        ,B.SHIP_SCAC_CDE                          05940003
059500                        ,B.TRLR_PRKG_LOC_DESC                     05950003
059600                        ,B.TRLR_PRKG_SLOT_NBR                     05960003
059700                        ,C.TRIP_STAT_DESC                         05970003
059800                   FROM  TSUOBTR A                                05980003
059900                        ,TSUOBTS B                                05990003
060000                        ,TSUOBSC C                                06000003
060100                  WHERE  A.OTBND_TRIP_ID    = B.OTBND_TRIP_ID     06010003
060200                    AND  B.TRIP_STAT_CDE    = C.TRIP_STAT_CDE     06020003
060300                                                                  06030003
060400                    AND  A.OTBND_TRIP_ID    = :DK-TRIP-ID         06040003
060500                    AND  A.TRIP_ACTV_CDE    = 'A'                 06050003
060600                  ORDER BY B.OTBND_STAT_TMST DESC                 06060003
060700             END-EXEC.                                            06070003
060800                                                                  06080003
060900*-----------------------------------------------------------------06090003
061000 LINKAGE SECTION.                                                 06100003
061100                                                                  06110003
061200 01  DFHCOMMAREA.                                                 06120003
061300     05  FILLER                         OCCURS  1 TO 4072 TIMES   06130003
061400                                        DEPENDING ON EIBCALEN.    06140003
061500         10  FILLER                     PIC X.                    06150003
061600                                                                  06160003
061700                                                                  06170003
061800 PROCEDURE DIVISION.                                              06180003
061900******************************************************************06190003
062000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06200003
062100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06210003
062200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06220003
062300******************************************************************06230003
062400 0000-MAIN-MODULE.                                                06240003
062500     INITIALIZE DP030-CICS-API-FIELDS.                            06250003
062600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06260003
062700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06270003
062800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06280003
062900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06290003
063000     MOVE LENGTH OF SU560AI        TO DP030-MAP-LENGTH (1).       06300003
063100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06310003
063200     PERFORM 0001-CALL-CICS-ARCH-API.                             06320003
063300*                                                                 06330003
063400     PERFORM 1000-CONTROL-PROCESSING                              06340003
063500*                                                                 06350003
063600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06360003
063700     PERFORM 0001-CALL-CICS-ARCH-API.                             06370003
063800                                                                  06380003
063900******************************************************************06390003
064000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06400003
064100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06410003
064200******************************************************************06420003
064300 0001-CALL-CICS-ARCH-API.                                         06430003
064400*    CALL 'DPKCS030' USING DFHEIBLK                               06440026
064400     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06441026
064500                           DFHCOMMAREA                            06450003
064600                           DP030-CICS-API-FIELDS                  06460003
064700                           DP020-STANDARD-COMMAREA                06470003
064800                           SU560AI.                               06480003
064900*                                                                 06490003
065000     IF  DP030-RC-CALL-SUCCESSFUL                                 06500003
065100         CONTINUE                                                 06510003
065200     ELSE                                                         06520003
065300         SET DP013-NO-ROLLBACK                                    06530003
065400             DP013-XCTL-DISPLAY-RESTART                           06540003
065500             DP013-CICS-ABEND      TO TRUE                        06550003
065600         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        06560003
065700*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06570026
065800*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06580026
065700         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06581026
065800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06582026
065900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06590003
066000         PERFORM DP013-0000-PROCESS-ABEND                         06600003
066100     END-IF.                                                      06610003
066200                                                                  06620003
066300*----------------------------------------------------------------*06630003
066400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06640003
066500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06650003
066600*                                                                *06660003
066700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06670003
066800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06680003
066900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06690003
067000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06700003
067100*----------------------------------------------------------------*06710003
067200 1000-CONTROL-PROCESSING.                                         06720003
067300                                                                  06730003
067400     EVALUATE TRUE                                                06740003
067500         WHEN DP020-NEXT-ACT-INITIAL                              06750003
067600             INITIALIZE ASC-SPECIFIC-COMMAREA                     06760003
067700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06770003
067710*** BEGIN - AHP 12/31/07                                          06771024
067800                                      ASC-SEL-TERM-ID-OUT         06780022
067810*** END   - AHP 12/31/07                                          06781024
067900             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06790003
067910*** BEGIN - AHP 12/31/07                                          06791024
068000                                           ASC-SEL-TASK-NUMBER-OUT06800022
068010*** END   - AHP 12/31/07                                          06801024
068100             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              06810003
068110*** BEGIN - AHP 12/31/07                                          06811024
068200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             06820022
068210*** END   - AHP 12/31/07                                          06821024
068300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06830003
068400             PERFORM 4000-BUILD-INITIAL-PANEL                     06840003
068500                                                                  06850003
068600         WHEN DP020-NEXT-ACT-READ-MAP                             06860003
068700             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06870003
068800             PERFORM 2000-PROCESS-PANEL                           06880003
068900                                                                  06890003
069000         WHEN DP020-NEXT-ACT-RETURN                               06900003
069100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06910003
069200             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               06920003
069300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06930003
069400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06940003
069500                                                                  06950003
069600         WHEN OTHER                                               06960003
069700             SET DP013-LOGIC-ABEND TO TRUE                        06970003
069800             SET DP013-NO-ROLLBACK TO TRUE                        06980003
069900             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    06990003
070000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07000003
070100                                   TO DP013-MESSAGE-TEXT(1)       07010003
070200             PERFORM DP013-0000-PROCESS-ABEND                     07020003
070300     END-EVALUATE.                                                07030003
070400                                                                  07040003
070500*----------------------------------------------------------------*07050003
070600* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07060003
070700* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07070003
070800*----------------------------------------------------------------*07080003
070900 1100-PROCESS-INTER-APPL-COMM.                                    07090003
071000                                                                  07100003
071100     SET PS-COMMAREA-VALID         TO TRUE.                       07110003
071200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07120003
071300                                                                  07130003
071400     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07140003
071500         MOVE SU008-OPER-UNT-ID       TO ASC-OPER-UNT-ID-N        07150003
071600         MOVE SU008-DOOR-ID           TO ASC-DOOR-ID              07160003
071700         MOVE SU008-DOOR-TYPE         TO ASC-DOOR-TYPE            07170003
071800         MOVE SU008-SCAC-CDE          TO ASC-SCAC-CODE            07180003
071900         MOVE SU008-TRLR-SRL-NBR      TO ASC-TRLR-SRL-NMBR        07190003
072000         MOVE SU008-DEST-STR-NBR      TO ASC-STR-NBR              07200003
072100         MOVE SU008-TRIP-ID           TO ASC-OUTBOUND-TRIP-ID     07210003
072200     ELSE                                                         07220003
072300         SET ASC-USE-SELECTION-QUEUE TO TRUE                      07230003
072400         MOVE SU009-NUMBER-OF-SELECTED-ITEMS TO                   07240003
072500                                      ASC-NUMBER-OF-SELECTED-ITEMS07250003
072600         MOVE SU009-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  07260003
072610*** BEGIN - AHP 12/31/07                                          07261024
072700         MOVE SU009-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN   07270022
072710*** END   - AHP 12/31/07                                          07271024
072800         MOVE SU009-OPER-UNT-ID       TO ASC-OPER-UNT-ID-N        07280003
072900                                         DK-OPER-UNT-ID           07290003
073000         PERFORM 1120-PREPARE-LIST-ENTRY                          07300003
073100     END-IF.                                                      07310003
073200                                                                  07320003
073300*-----------------------------------------------------------------07330003
073400 1120-PREPARE-LIST-ENTRY.                                         07340003
073500                                                                  07350003
073600     MOVE SU010-MAX-ITEMS          TO ASC-SEL-SUB.                07360003
073700     MOVE ZERO                     TO ASC-SEL-ITEM.               07370003
073800     PERFORM 1130-GET-NEXT-RECORD.                                07380003
073900                                                                  07390003
074000*-----------------------------------------------------------------07400003
074100*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*07410003
074200*-----------------------------------------------------------------07420003
074300 1130-GET-NEXT-RECORD.                                            07430003
074400                                                                  07440003
074500     ADD +1                       TO ASC-SEL-SUB.                 07450003
074600                                                                  07460003
074700     IF  ASC-SEL-SUB > SU010-MAX-ITEMS                            07470003
074800         ADD +1                   TO ASC-SEL-ITEM                 07480003
074900         MOVE +1                  TO ASC-SEL-SUB                  07490003
075000     END-IF.                                                      07500003
075100                                                                  07510003
075200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07520003
075300         PERFORM 9100-READ-SEL-QUEUE                              07530003
075400         IF  SU010-ITEM (ASC-SEL-SUB) > ZERO                      07540003
075500             MOVE SU010-TRLR-SRL-NBR (ASC-SEL-SUB)                07550003
075600                                          TO ASC-TRLR-SRL-NMBR    07560003
075700             MOVE SU010-TRIP-ID (ASC-SEL-SUB)                     07570003
075800                                       TO ASC-OUTBOUND-TRIP-ID    07580003
075900             MOVE SU010-TRIP-STATUS (ASC-SEL-SUB)                 07590003
076000                                       TO ASC-TRIP-STAT-CDE       07600003
076100             MOVE SU010-STAT-DATE (ASC-SEL-SUB)                   07610003
076200                                          TO ASC-STATUS-DATE      07620003
076300             MOVE SU010-DOOR-ID  (ASC-SEL-SUB)                    07630012
076400                                       TO ASC-DOORSLOT            07640003
076500             MOVE SU010-DEST-NBR (ASC-SEL-SUB)                    07650003
076600                                       TO ASC-STR-NBR             07660003
076700             SET SU010-INQ (ASC-SEL-SUB) TO TRUE                  07670003
076800             PERFORM 9200-REWRITE-SEL-QUEUE                       07680003
076900         ELSE                                                     07690003
077000             SUBTRACT +1 FROM ASC-SEL-SUB                         07700003
077100             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07710003
077200             SET DP020-MSG-INFORMATIONAL                          07720003
077300                 PS-LIST-END             TO TRUE                  07730003
077400         END-IF                                                   07740003
077500     ELSE                                                         07750003
077600         SUBTRACT +1 FROM ASC-SEL-ITEM                            07760003
077700         MOVE SU010-MAX-ITEMS     TO ASC-SEL-SUB                  07770003
077800         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07780003
077900         SET DP020-MSG-INFORMATIONAL                              07790003
078000             PS-LIST-END             TO TRUE                      07800003
078100     END-IF.                                                      07810003
078200                                                                  07820003
078300*-----------------------------------------------------------------07830003
078400*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07840003
078500*    PROCESSED.                                                  *07850003
078600*-----------------------------------------------------------------07860003
078700 1140-GET-PREV-RECORD.                                            07870003
078800                                                                  07880003
078900     SUBTRACT +1 FROM ASC-SEL-SUB.                                07890003
079000                                                                  07900003
079100     IF  ASC-SEL-SUB < +1                                         07910003
079200         SUBTRACT +1 FROM ASC-SEL-ITEM                            07920003
079300         MOVE SU010-MAX-ITEMS     TO ASC-SEL-SUB                  07930003
079400     END-IF.                                                      07940003
079500                                                                  07950003
079600     IF  ASC-SEL-ITEM > ZERO                                      07960003
079700         PERFORM 9100-READ-SEL-QUEUE                              07970003
079800         MOVE SU010-TRLR-SRL-NBR (ASC-SEL-SUB)                    07980003
079900                                            TO ASC-TRLR-SRL-NMBR  07990003
080000         MOVE SU010-TRIP-ID (ASC-SEL-SUB) TO ASC-OUTBOUND-TRIP-ID 08000003
080100         MOVE SU010-TRIP-STATUS (ASC-SEL-SUB)                     08010003
080200                                            TO ASC-TRIP-STAT-CDE  08020003
080300         MOVE SU010-STAT-DATE (ASC-SEL-SUB) TO ASC-STATUS-DATE    08030003
080400         MOVE SU010-DOOR-ID  (ASC-SEL-SUB)  TO ASC-DOORSLOT       08040012
080500         MOVE SU010-DEST-NBR (ASC-SEL-SUB)  TO ASC-STR-NBR        08050003
080600         SET SU010-INQ (ASC-SEL-SUB) TO TRUE                      08060003
080700         PERFORM 9200-REWRITE-SEL-QUEUE                           08070003
080800     ELSE                                                         08080003
080900         MOVE +1                  TO ASC-SEL-ITEM                 08090003
081000                                     ASC-SEL-SUB                  08100003
081100         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             08110003
081200         SET DP020-MSG-INFORMATIONAL                              08120003
081300             PS-LIST-END             TO TRUE                      08130003
081400     END-IF.                                                      08140003
081500                                                                  08150003
081600*----------------------------------------------------------------*08160003
081700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08170003
081800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08180003
081900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08190003
082000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08200003
082100* FUNCTION KEYS CAN GET THIS FAR.                                *08210003
082200*----------------------------------------------------------------*08220003
082300 2000-PROCESS-PANEL.                                              08230003
082400     EVALUATE TRUE                                                08240003
082500         WHEN DP020-SRC-AID = DP016-CLEAR                         08250003
082600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08260003
082700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08270003
082800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08280003
082900                                                                  08290003
083000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08300003
083100             PERFORM 2050-DELETE-LIST-QUEUE                       08310003
083200             PERFORM 4000-BUILD-INITIAL-PANEL                     08320003
083300                                                                  08330003
083400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08340003
083500             PERFORM 2140-DESELECT-ALL-ITEMS                      08350003
083600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08360003
083700                                                                  08370003
083800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08380003
083900             PERFORM 2150-SELECT-ALL-ITEMS                        08390003
084000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08400003
084100                                                                  08410003
084200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08420003
084300             IF  ASC-USE-SELECTION-QUEUE                          08430003
084400                 PERFORM 1130-GET-NEXT-RECORD                     08440003
084500                 IF PS-LIST-END                                   08450003
084600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08460003
084700                     SET PS-NO-LIST-END TO TRUE                   08470003
084800                 ELSE                                             08480003
084900                     PERFORM 2050-DELETE-LIST-QUEUE               08490003
085000                     PERFORM 3200-RESET-ATTRIBUTES                08500003
085100                     PERFORM 4000-BUILD-INITIAL-PANEL             08510003
085200                 END-IF                                           08520003
085300              ELSE                                                08530003
085400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08540003
085500*                --- BOTTOM OF LIST ---                           08550003
085600                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         08560003
085700                 SET DP020-MSG-INFORMATIONAL TO TRUE              08570003
085800             END-IF                                               08580003
085900                                                                  08590003
086000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08600003
086100             IF  ASC-USE-SELECTION-QUEUE                          08610003
086200                 PERFORM 1140-GET-PREV-RECORD                     08620003
086300                 IF PS-LIST-END                                   08630003
086400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08640003
086500                     SET PS-NO-LIST-END TO TRUE                   08650003
086600                 ELSE                                             08660003
086700                     PERFORM 2050-DELETE-LIST-QUEUE               08670003
086800                     PERFORM 3200-RESET-ATTRIBUTES                08680003
086900                     PERFORM 4000-BUILD-INITIAL-PANEL             08690003
087000                 END-IF                                           08700003
087100             ELSE                                                 08710003
087200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08720003
087300                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         08730003
087400                 SET DP020-MSG-INFORMATIONAL TO TRUE              08740003
087500             END-IF                                               08750003
087600                                                                  08760003
087700         WHEN OTHER                                               08770003
087800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08780003
087900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08790003
088000                                                                  08800003
088100             IF  PS-NO-ERROR                                      08810003
088200                 SET DP030-CONTINUE-GO TO TRUE                    08820003
088300                 PERFORM 2100-CHECK-FUNCTION-KEY                  08830003
088400             ELSE                                                 08840003
088500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08850003
088600                 SET DP030-OVERRIDE-GO TO TRUE                    08860003
088700             END-IF                                               08870003
088800     END-EVALUATE.                                                08880003
088900                                                                  08890003
089000*----------------------------------------------------------------*08900003
089100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08910003
089200*----------------------------------------------------------------*08920003
089300 2050-DELETE-LIST-QUEUE.                                          08930003
089400                                                                  08940003
089500     EXEC CICS                                                    08950003
089600         DELETEQ TS                                               08960003
089700             QUEUE (ASC-LIST-QUEUE-NAME)                          08970003
089800             RESP  (PV-CICS-RESP)                                 08980003
089900     END-EXEC.                                                    08990003
090000                                                                  09000003
090100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09010003
090200        (PV-CICS-RESP = DFHRESP(QIDERR))                          09020003
090300         CONTINUE                                                 09030003
090400     ELSE                                                         09040003
090500         SET DP013-CICS-ABEND      TO TRUE                        09050003
090600         SET DP013-NO-ROLLBACK     TO TRUE                        09060003
090700                                                                  09070003
090800         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         09080003
090900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09090003
091000                                   TO DP013-MESSAGE-TEXT (1)      09100003
091100         PERFORM DP013-0000-PROCESS-ABEND                         09110003
091200     END-IF.                                                      09120003
091300                                                                  09130003
091400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09140003
091500                                                                  09150003
091600*----------------------------------------------------------------*09160003
091700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09170003
091800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09180003
091900* CICS ARCHITECTURE API.                                         *09190003
092000*----------------------------------------------------------------*09200003
092100 2100-CHECK-FUNCTION-KEY.                                         09210003
092200                                                                  09220003
092300     EVALUATE TRUE                                                09230003
092400*                                                                 09240003
092500* F18 - TRAILER CARTONS                                           09250003
092600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09260003
092700             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09270003
092800                 SET ASC-USE-SELECTION-QUEUE TO TRUE              09280003
092900                 INITIALIZE SU009-INTER-APPL-COMMAREA             09290003
093000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09300003
093100                                TO SU009-NUMBER-OF-SELECTED-ITEMS 09310003
093200                 MOVE ASC-NUMBER-OF-TS-ITEMS                      09320003
093300                                      TO SU009-NUMBER-OF-TS-ITEMS 09330003
093310*** BEGIN - AHP 12/31/07                                          09331024
093400                 MOVE ASC-SEL-QUEUE-NAME-OUT                      09340022
093410                                      TO SU009-SEL-QUEUE-NAME     09341022
093420*** END   - AHP 12/31/07                                          09342024
093500                 MOVE ASC-OPER-UNT-ID-N    TO SU009-OPER-UNT-ID   09350003
093600                 MOVE ASC-TRLR-SRL-NMBR    TO SU009-TRLR-SRL-NBR  09360003
093700                 MOVE ASC-SCAC-CODE        TO SU009-SCAC-CDE      09370012
093800                 MOVE ASC-TRLR-ID          TO SU009-TRLR-ID       09380007
093900                 PERFORM 5000-PREPARE-SEL-QUEUE                   09390003
094000             ELSE                                                 09400003
094100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09410003
094200                 SET DP030-OVERRIDE-GO TO TRUE                    09420003
094300                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         09430003
094400                 SET DP020-MSG-WARNING TO TRUE                    09440003
094500             END-IF                                               09450003
094600*                                                                 09460003
094700* F22 - ASSOCIATE LIST                                            09470003
094800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              09480003
094900             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09490003
095000                 SET ASC-USE-SELECTION-QUEUE TO TRUE              09500003
095100                 INITIALIZE SU009-INTER-APPL-COMMAREA             09510003
095200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09520003
095300                                TO SU009-NUMBER-OF-SELECTED-ITEMS 09530003
095400                 MOVE ASC-NUMBER-OF-TS-ITEMS                      09540003
095500                                      TO SU009-NUMBER-OF-TS-ITEMS 09550003
095510*** BEGIN - AHP 12/31/07                                          09551024
095600                 MOVE ASC-SEL-QUEUE-NAME-OUT                      09560022
095700                                           TO SU009-SEL-QUEUE-NAME09570003
095710*** END   - AHP 12/31/07                                          09571024
095800                 MOVE ASC-OPER-UNT-ID-N  TO SU009-OPER-UNT-ID     09580003
095900                 MOVE ASC-TRLR-SRL-NMBR TO SU009-TRLR-SRL-NBR     09590003
096000                 MOVE ASC-SCAC-CODE        TO SU009-SCAC-CDE      09600007
096100                 MOVE ASC-TRLR-ID          TO SU009-TRLR-ID       09610007
096200                 PERFORM 5000-PREPARE-SEL-QUEUE                   09620003
096300             ELSE                                                 09630003
096400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09640003
096500                 SET DP030-OVERRIDE-GO TO TRUE                    09650003
096600                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         09660003
096700                 SET DP020-MSG-WARNING TO TRUE                    09670003
096800             END-IF                                               09680003
096900*                                                                 09690003
097000* F23 - TRAILER SEAL LIST                                         09700003
097100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09710003
097200             MOVE 'SUTRLRSL' TO DP008-FUNCTION-NAME               09720003
097300             PERFORM 2105-RACF-ACCESS                             09730003
097400             IF  PS-ACCESS-NOT-ALLOWED                            09740003
097500                 SET  PS-ERROR                                    09750003
097600                      DP020-MSG-FATAL TO TRUE                     09760003
097700                 MOVE PC-TSYMSG-00840 TO DP020-MSG-NUMBER         09770003
097800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09780003
097900                 SET DP030-OVERRIDE-GO TO TRUE                    09790003
098000             END-IF                                               09800003
098100                                                                  09810003
098200             IF  PS-NO-ERROR                                      09820003
098300                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09830003
098400                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09840003
098500                     INITIALIZE SU009-INTER-APPL-COMMAREA         09850003
098600                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09860003
098700                                TO SU009-NUMBER-OF-SELECTED-ITEMS 09870003
098800                     MOVE ASC-NUMBER-OF-TS-ITEMS                  09880003
098900                                      TO SU009-NUMBER-OF-TS-ITEMS 09890003
098910*** BEGIN - AHP 12/31/07                                          09891024
099000                     MOVE ASC-SEL-QUEUE-NAME-OUT                  09900022
099100                                      TO SU009-SEL-QUEUE-NAME     09910022
099110*** END   - AHP 12/31/07                                          09911024
099200                     MOVE ASC-OPER-UNT-ID-N  TO SU009-OPER-UNT-ID 09920003
099300                     MOVE ASC-SCAC-CODE      TO SU009-SCAC-CDE    09930007
099400                     MOVE ASC-TRLR-ID        TO SU009-TRLR-ID     09940007
099500                     PERFORM 5000-PREPARE-SEL-QUEUE               09950003
099600                 ELSE                                             09960003
099700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09970003
099800                     SET DP030-OVERRIDE-GO TO TRUE                09980003
099900                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     09990003
100000                     SET DP020-MSG-WARNING TO TRUE                10000003
100100                 END-IF                                           10010003
100200             END-IF                                               10020003
100300*                                                                 10030003
100400* F6 - FIRST PAGE                                                 10040003
100500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10050003
100600             MOVE +1               TO PV-TOP-ITEM                 10060003
100700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10070003
100800*                                                                 10080003
100900* F7 - PREVIOUS PAGE                                              10090003
101000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10100003
101100             PERFORM 2110-BROWSE-BACKWARD                         10110003
101200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10120003
101300*                                                                 10130003
101400* F8 - NEXT PAGE                                                  10140003
101500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10150003
101600             PERFORM 2120-BROWSE-FORWARD                          10160003
101700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10170003
101800*                                                                 10180003
101900* ENTER KEY                                                       10190003
102000         WHEN DP020-SRC-AID = DP016-ENTER                         10200003
102100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10210003
102200             IF  PS-ERROR                                         10220003
102300                 CONTINUE                                         10230003
102400             ELSE                                                 10240003
102500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10250003
102600             END-IF                                               10260003
102700                                                                  10270003
102800         WHEN OTHER                                               10280003
102900             SET DP013-NO-ROLLBACK                                10290003
103000                 DP013-XCTL-DISPLAY-RESTART                       10300003
103100                 DP013-CICS-ABEND  TO TRUE                        10310003
103200             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    10320003
103300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10330003
103400                                   TO DP013-MESSAGE-TEXT (1)      10340003
103500             PERFORM DP013-0000-PROCESS-ABEND                     10350003
103600     END-EVALUATE.                                                10360003
103700*                                                                 10370003
103800*----------------------------------------------------------------*10380003
103900* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     10390003
104000*----------------------------------------------------------------*10400003
104100 2105-RACF-ACCESS.                                                10410003
104200                                                                  10420003
104300      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  10430003
104400      SET DP008-ACCESS-TYPE-USE          TO TRUE                  10440003
104500                                                                  10450003
104600      EXEC CICS                                                   10460003
104700         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 10470003
104800              COMMAREA (DP008-SECURITY-COMMAREA)                  10480003
104900              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             10490003
105000      END-EXEC                                                    10500003
105100                                                                  10510003
105200      IF DP008-CALL-SUCCESSFUL                                    10520003
105300         IF DP008-ACCESS-ALLOWED                                  10530003
105400             SET PS-ACCESS-ALLOWED TO TRUE                        10540003
105500         ELSE                                                     10550003
105600             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    10560003
105700             MOVE DP008-ERROR-CODE TO PV-RACF-ERROR-CODE          10570003
105800             STRING ' SUKCS560- RACF -'  DELIMITED BY SIZE        10580003
105900                    ' DP008-ACCESS-SW- ' DELIMITED BY SIZE        10590003
106000                      DP008-ACCESS-SW    DELIMITED BY SIZE        10600003
106100                    ' RACF ERROR CODE-'  DELIMITED BY SIZE        10610003
106200                      PV-RACF-ERROR-CODE DELIMITED BY SIZE        10620003
106300                                    INTO PV-CICS-MSG-AREA2        10630003
106400             MOVE LENGTH OF PV-CICS-MSG-AREA2                     10640003
106500               TO PV-COMMAREA-LENGTH                              10650003
106600             EXEC CICS                                            10660003
106700                  WRITEQ TD                                       10670003
106800                   QUEUE  ('CSSL')                                10680003
106900                    FROM  (PV-CICS-MSG-AREA2)                     10690003
107000                  LENGTH  (PV-COMMAREA-LENGTH)                    10700003
107100                    RESP  (PV-CICS-RESP)                          10710003
107200             END-EXEC                                             10720003
107300         END-IF                                                   10730003
107400     ELSE                                                         10740003
107500         MOVE ' 2105-RACF-ACCESS'                                 10750003
107600                               TO DP013-PARAGRAPH                 10760003
107700          MOVE 'UNABLE TO ACCESS CICS'                            10770003
107800                               TO DP013-MESSAGE-TEXT (1)          10780003
107900          MOVE SQLCA                 TO DP013-SQLCA               10790003
108000          SET DP013-DB2-ABEND                                     10800003
108100              DP013-XCTL-DISPLAY-RESTART                          10810003
108200                               TO TRUE                            10820003
108300          PERFORM DP013-0000-PROCESS-ABEND                        10830003
108400      END-IF.                                                     10840003
108500                                                                  10850003
108600                                                                  10860003
108700*----------------------------------------------------------------*10870003
108800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10880003
108900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10890003
109000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10900003
109100*    MESSAGE.                                                    *10910003
109200*----------------------------------------------------------------*10920003
109300 2110-BROWSE-BACKWARD.                                            10930003
109400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10940003
109500         GIVING PV-TOP-ITEM.                                      10950003
109600*                                                                 10960003
109700     IF  ((PV-TOP-ITEM < +1)                                      10970003
109800       OR (PV-TOP-ITEM = +1))                                     10980003
109900         MOVE +1                   TO PV-TOP-ITEM                 10990003
110000*        -- TOP OF LIST --                                        11000003
110100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11010003
110200         SET DP020-MSG-INFORMATIONAL TO TRUE                      11020003
110300     END-IF.                                                      11030003
110400                                                                  11040003
110500*----------------------------------------------------------------*11050003
110600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11060003
110700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11070003
110800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11080003
110900*----------------------------------------------------------------*11090003
111000 2120-BROWSE-FORWARD.                                             11100003
111100                                                                  11110003
111200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11120003
111300         GIVING PV-TOP-ITEM.                                      11130003
111400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11140003
111500         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11150003
111600*        -- BOTTOM OF LIST --                                     11160003
111700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11170003
111800         SET DP020-MSG-INFORMATIONAL  TO TRUE                     11180003
111900     ELSE                                                         11190003
112000         COMPUTE PV-BOTTOM-ITEM =                                 11200003
112100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11210003
112200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11220003
112300*            -- BOTTOM OF LIST --                                 11230003
112400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11240003
112500             SET DP020-MSG-INFORMATIONAL TO TRUE                  11250003
112600         END-IF                                                   11260003
112700     END-IF.                                                      11270003
112800                                                                  11280003
112900*----------------------------------------------------------------*11290003
113000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11300003
113100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11310003
113200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11320003
113300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11330003
113400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11340003
113500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11350003
113600*----------------------------------------------------------------*11360003
113700 2130-CHECK-FOR-JUMP-BROWSE.                                      11370003
113800     SET PS-NO-ERROR               TO TRUE.                       11380003
113900     IF (ASC-START-ITEM-REQUEST = SPACE)                          11390003
114000         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11400003
114100     ELSE                                                         11410003
114200         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     11420003
114300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11430003
114400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11440003
114500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  11450003
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11461025
263968              USING DP010I-NUMERIC-EDIT-AREA                      11462025
114700                                                                  11470003
114800         IF  NOT DP010I-ERROR-DETECTED                            11480003
114900             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N11490003
115000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11500003
115100                 IF  ASC-START-ITEM-REQUEST-N >                   11510003
115200                                          ASC-NUMBER-OF-ITEMS-READ11520003
115300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11530003
115400                     COMPUTE PV-TOP-ITEM =                        11540003
115500                             ASC-NUMBER-OF-ITEMS-READ             11550003
115600                             - PC-ITEMS-PER-PANEL + 1             11560003
115700                     IF  PV-TOP-ITEM < +1                         11570003
115800                         MOVE +1   TO PV-TOP-ITEM                 11580003
115900                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11590003
116000                         SET DP020-MSG-INFORMATIONAL TO TRUE      11600003
116100                     END-IF                                       11610003
116200                 ELSE                                             11620003
116300                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 11630003
116400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11640003
116500                     COMPUTE PV-BOTTOM-ITEM =                     11650003
116600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11660003
116700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11670003
116800*                        -- BOTTOM OF LIST --                     11680003
116900                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11690003
117000                         SET DP020-MSG-INFORMATIONAL TO TRUE      11700003
117100                     END-IF                                       11710003
117200                 END-IF                                           11720003
117300             ELSE                                                 11730003
117400*                --- VALUE OUT OF RANGE ----                      11740003
117500                 MOVE PC-TSYMSG-00101  TO DP020-MSG-NUMBER        11750003
117600                 MOVE -1           TO ASTRTITL                    11760003
117700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              11770003
117800                 MOVE DP015-REVERSE TO ASTRTITH                   11780003
117900                 MOVE DP015-RED    TO ASTRTITC                    11790003
118000                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           11800003
118100                 SET DP020-MSG-FATAL                              11810003
118200                     PS-ERROR        TO TRUE                      11820003
118300             END-IF                                               11830003
118400                                                                  11840003
118500         ELSE                                                     11850003
118600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11860003
118700             MOVE -1               TO ASTRTITL                    11870003
118800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11880003
118900             MOVE DP015-REVERSE    TO ASTRTITH                    11890003
119000             MOVE DP015-RED        TO ASTRTITC                    11900003
119100             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               11910003
119200             SET DP020-MSG-FATAL   TO TRUE                        11920003
119300             SET PS-ERROR          TO TRUE                        11930003
119400         END-IF                                                   11940003
119500     END-IF.                                                      11950003
119600                                                                  11960003
119700*----------------------------------------------------------------*11970003
119800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11980003
119900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11990003
120000*----------------------------------------------------------------*12000003
120100 2140-DESELECT-ALL-ITEMS.                                         12010003
120200     MOVE +1                       TO ASC-BLK-SUB.                12020003
120300                                                                  12030003
120400     PERFORM 2141-CLEAR-SELECTED-INDS                             12040003
120500         VARYING ASC-ITEM-SUB                                     12050003
120600         FROM 1 BY 1                                              12060003
120700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12070003
120800                                                                  12080003
120900     ADD +1                        TO ASC-BLK-SUB.                12090003
121000                                                                  12100003
121100     PERFORM 2141-CLEAR-SELECTED-INDS                             12110003
121200         VARYING ASC-ITEM-SUB                                     12120003
121300         FROM 1 BY 1                                              12130003
121400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12140003
121500                                                                  12150003
121600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12160003
121700                                   TO PV-LIST-ITEM-NUMBER.        12170003
121800                                                                  12180003
121900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12190003
122000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12200003
122100                                                                  12210003
122200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12220003
122300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12230003
122400         MOVE +1                   TO ASC-BLK-SUB                 12240003
122500                                                                  12250003
122600         PERFORM 5100-WRITE-TEMP-STORAGE                          12260003
122700         MOVE +2                   TO ASC-BLK-SUB                 12270003
122800         PERFORM 5100-WRITE-TEMP-STORAGE                          12280003
122900         MOVE +1                   TO ASC-BLK-SUB                 12290003
123000                                                                  12300003
123100         MOVE +1                   TO PV-BLOCK-NUMBER             12310003
123200                                                                  12320003
123300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12330003
123400             PV-FIRST-BLOCK-IN-ARRAY - 1                          12340003
123500                                                                  12350003
123600         PERFORM                                                  12360003
123700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12370003
123800                                                                  12380003
123900             PERFORM 4410-READ-TEMP-STORAGE                       12390003
124000                                                                  12400003
124100             PERFORM 2141-CLEAR-SELECTED-INDS                     12410003
124200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12420003
124300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12430003
124400                                                                  12440003
124500             PERFORM 5100-WRITE-TEMP-STORAGE                      12450003
124600                                                                  12460003
124700             ADD +1                TO PV-BLOCK-NUMBER             12470003
124800                                                                  12480003
124900         END-PERFORM                                              12490003
125000                                                                  12500003
125100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12510003
125200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12520003
125300                                                                  12530003
125400         PERFORM                                                  12540003
125500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12550003
125600                   ASC-HIGHEST-BLOCK-WRITTEN                      12560003
125700                                                                  12570003
125800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12580003
125900                                   TO PV-BLOCK-NUMBER             12590003
126000                                                                  12600003
126100             PERFORM 4410-READ-TEMP-STORAGE                       12610003
126200                                                                  12620003
126300             PERFORM 2141-CLEAR-SELECTED-INDS                     12630003
126400                 VARYING ASC-ITEM-SUB                             12640003
126500                 FROM 1 BY 1                                      12650003
126600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12660003
126700                                                                  12670003
126800             PERFORM 5100-WRITE-TEMP-STORAGE                      12680003
126900                                                                  12690003
127000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12700003
127100         END-PERFORM                                              12710003
127200                                                                  12720003
127300         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          12730003
127400         PERFORM 4410-READ-TEMP-STORAGE                           12740003
127500     END-IF.                                                      12750003
127600                                                                  12760003
127700                                                                  12770003
127800     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 12780003
127900     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  12790003
128000     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    12800003
128100                                                                  12810003
128200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12820003
128300                                                                  12830003
128400*----------------------------------------------------------------*12840003
128500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12850003
128600*----------------------------------------------------------------*12860003
128700 2141-CLEAR-SELECTED-INDS.                                        12870003
128800                                                                  12880003
128900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12890003
129000             NOT EQUAL ZERO                                       12900003
129100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12910003
129200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12920003
129300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12930003
129400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12940003
129500                                   TO TRUE                        12950003
129600         END-IF                                                   12960003
129700     END-IF.                                                      12970003
129800                                                                  12980003
129900*----------------------------------------------------------------*12990003
130000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *13000003
130100*  FOR ALL ITEMS.                                                *13010003
130200*----------------------------------------------------------------*13020003
130300 2150-SELECT-ALL-ITEMS.                                           13030003
130400                                                                  13040003
130500     MOVE +1                       TO ASC-BLK-SUB.                13050003
130600                                                                  13060003
130700     PERFORM 2151-SET-SELECTED-INDS                               13070003
130800         VARYING ASC-ITEM-SUB                                     13080003
130900         FROM 1 BY 1                                              13090003
131000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13100003
131100                                                                  13110003
131200     ADD +1                        TO ASC-BLK-SUB.                13120003
131300                                                                  13130003
131400     PERFORM 2151-SET-SELECTED-INDS                               13140003
131500         VARYING ASC-ITEM-SUB                                     13150003
131600         FROM 1 BY 1                                              13160003
131700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13170003
131800                                                                  13180003
131900     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       13190003
132000                                                                  13200003
132100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13210003
132200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13220003
132300                                                                  13230003
132400     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            13240003
132500         MOVE +1                   TO ASC-BLK-SUB                 13250003
132600                                                                  13260003
132700         PERFORM 5100-WRITE-TEMP-STORAGE                          13270003
132800         MOVE +2                   TO ASC-BLK-SUB                 13280003
132900         PERFORM 5100-WRITE-TEMP-STORAGE                          13290003
133000         MOVE +1                   TO ASC-BLK-SUB                 13300003
133100         MOVE +1                   TO PV-BLOCK-NUMBER             13310003
133200     END-IF.                                                      13320003
133300                                                                  13330003
133400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13340003
133500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13350003
133600         MOVE +1                   TO ASC-BLK-SUB                 13360003
133700                                                                  13370003
133800         PERFORM 5100-WRITE-TEMP-STORAGE                          13380003
133900         MOVE +2                   TO ASC-BLK-SUB                 13390003
134000         PERFORM 5100-WRITE-TEMP-STORAGE                          13400003
134100         MOVE +1                   TO ASC-BLK-SUB                 13410003
134200         MOVE +1                   TO PV-BLOCK-NUMBER             13420003
134300                                                                  13430003
134400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13440003
134500             PV-FIRST-BLOCK-IN-ARRAY - 1                          13450003
134600                                                                  13460003
134700         PERFORM                                                  13470003
134800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13480003
134900                                                                  13490003
135000             PERFORM 4410-READ-TEMP-STORAGE                       13500003
135100                                                                  13510003
135200             PERFORM 2151-SET-SELECTED-INDS                       13520003
135300                 VARYING ASC-ITEM-SUB                             13530003
135400                 FROM 1 BY 1                                      13540003
135500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13550003
135600                                                                  13560003
135700             PERFORM 5100-WRITE-TEMP-STORAGE                      13570003
135800                                                                  13580003
135900             ADD +1                TO PV-BLOCK-NUMBER             13590003
136000                                                                  13600003
136100         END-PERFORM                                              13610003
136200                                                                  13620003
136300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13630003
136400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13640003
136500                                                                  13650003
136600         PERFORM                                                  13660003
136700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13670003
136800                   ASC-HIGHEST-BLOCK-WRITTEN                      13680003
136900                                                                  13690003
137000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13700003
137100                                   TO PV-BLOCK-NUMBER             13710003
137200                                                                  13720003
137300             PERFORM 4410-READ-TEMP-STORAGE                       13730003
137400                                                                  13740003
137500             PERFORM 2151-SET-SELECTED-INDS                       13750003
137600                 VARYING ASC-ITEM-SUB                             13760003
137700                 FROM 1 BY 1                                      13770003
137800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13780003
137900                                                                  13790003
138000             PERFORM 5100-WRITE-TEMP-STORAGE                      13800003
138100                                                                  13810003
138200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13820003
138300                                                                  13830003
138400         END-PERFORM                                              13840003
138500                                                                  13850003
138600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13860003
138700                                   TO PV-BLOCK-NUMBER             13870003
138800                                                                  13880003
138900         PERFORM 4410-READ-TEMP-STORAGE                           13890003
139000     END-IF.                                                      13900003
139100                                                                  13910003
139200                                                                  13920003
139300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13930003
139400                       ASC-NUMBER-OF-SELECTED-ITEMS.              13940003
139500                                                                  13950003
139600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13960003
139700                                                                  13970003
139800*----------------------------------------------------------------*13980003
139900*    MARK EACH ITEM AS BEING SELECTED.                           *13990003
140000*----------------------------------------------------------------*14000003
140100 2151-SET-SELECTED-INDS.                                          14010003
140200                                                                  14020003
140300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           14030003
140400             NOT EQUAL ZERO                                       14040003
140500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14050003
140600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14060003
140700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        14070003
140800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14080003
140900                               TO  TRUE                           14090003
141000         END-IF                                                   14100003
141100     END-IF.                                                      14110003
141200                                                                  14120003
141300******************************************************************14130003
141400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **14140003
141500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **14150003
141600******************************************************************14160003
141700 2200-MOVE-SCREEN-TO-COMMAREA.                                    14170003
141800                                                                  14180003
141900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             14190003
142000     MOVE +1                       TO PV-SUB.                     14200003
142100*                                                                 14210003
142200     PERFORM 3100-SET-SUBSCRIPTS.                                 14220003
142300     IF  ASTRTITL > ZERO                                          14230003
142400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          14240003
142500     ELSE                                                         14250003
142600         IF  ASTRTITF = DP015-ERASE-EOF                           14260003
142700             INITIALIZE ASC-START-ITEM-REQUEST                    14270003
142800         END-IF                                                   14280003
142900     END-IF.                                                      14290003
143000                                                                  14300003
143100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14310003
143200         VARYING PV-SUB                                           14320003
143300         FROM 1 BY 1                                              14330003
143400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14340003
143500******************************************************************14350003
143600** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**14360003
143700******************************************************************14370003
143800 2210-MOVE-LINES-TO-COMMAREA.                                     14380003
143900     IF  MR-SELECTL (PV-SUB) > ZERO                               14390003
144000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14400003
144100         MOVE MR-SELECTI (PV-SUB)                                 14410003
144200                                   TO ASC-TEMP-SELECTED-SW        14420003
144300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14430003
144400     ELSE                                                         14440003
144500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14450003
144600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14460003
144700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        14470003
144800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14480003
144900         END-IF                                                   14490003
145000     END-IF.                                                      14500003
145100     ADD +1                        TO ASC-ITEM-SUB.               14510003
145200                                                                  14520003
145300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14530003
145400         ADD +1                    TO ASC-BLK-SUB                 14540003
145500         MOVE +1                   TO ASC-ITEM-SUB                14550003
145600     END-IF.                                                      14560003
145700******************************************************************14570003
145800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **14580003
145900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14590003
146000******************************************************************14600003
146100 3000-EDIT-DATA-IN-COMMAREA.                                      14610003
146200     SET PS-NO-ERROR               TO TRUE.                       14620003
146300     PERFORM 3200-RESET-ATTRIBUTES.                               14630003
146400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14640003
146500                                                                  14650003
146600**                                                                14660003
146700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14670003
146800* EDITTING IS DONE FROM THE BOTTOM UP.                            14680003
146900**                                                                14690003
147000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14700003
147100         ASC-ITEMS-DISPLAYED - 1.                                 14710003
147200     PERFORM 3100-SET-SUBSCRIPTS.                                 14720003
147300*                                                                 14730003
147400     IF  PS-NO-ERROR                                              14740003
147500         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        14750003
147600     END-IF.                                                      14760003
147700                                                                  14770003
147800     IF  PS-NO-ERROR                                              14780003
147900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14790003
148000     END-IF.                                                      14800003
148100*                                                                 14810003
148200     IF  ((PS-NO-ERROR)                                           14820003
148300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14830003
148400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14840003
148500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14850003
148600     END-IF.                                                      14860003
148700                                                                  14870003
148800*----------------------------------------------------------------*14880003
148900*   3005-EDIT-COMMAREA-BLOCKS                                    *14890003
149000*----------------------------------------------------------------*14900003
149100 3005-EDIT-COMMAREA-BLOCKS.                                       14910003
149200     MOVE +1                       TO PV-BLOCK-NUMBER.            14920003
149300     MOVE +1                       TO ASC-BLK-SUB.                14930003
149400     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               14940003
149500                                                                  14950003
149600     COMPUTE PV-BLOCK-NUMBER  =                                   14960003
149700        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 14970003
149800            PC-ITEMS-PER-PANEL.                                   14980003
149900                                                                  14990003
150000     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          15000003
150100                                                                  15010003
150200     PERFORM                                                      15020003
150300       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          15030003
150400          OR PS-ERROR                                             15040003
150500          OR PS-BLOCK-ERROR                                       15050003
150600                                                                  15060003
150700             COMPUTE PV-ITEMS-HOLD  =                             15070003
150800                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        15080003
150900                     PC-ITEMS-PER-PANEL - 1                       15090003
151000                                                                  15100003
151100             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       15110003
151200                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               15120003
151300                     FROM  PV-ITEMS-HOLD                          15130003
151400                   GIVING  PV-ITEMS-DIFF                          15140003
151500                 SUBTRACT  PV-ITEMS-DIFF                          15150003
151600                     FROM  PC-ITEMS-PER-PANEL                     15160003
151700                   GIVING  PV-ITEMS-HOLD                          15170003
151800                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              15180003
151900                                              ASC-ITEM-SUB        15190003
152000                                              ASC-ITEMS-DISPLAYED 15200003
152100             ELSE                                                 15210003
152200                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              15220003
152300                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        15230003
152400             END-IF                                               15240003
152500                                                                  15250003
152600             PERFORM 3300-EDIT-SELECTIONS                         15260003
152700                     VARYING PV-SUB                               15270003
152800                        FROM PV-SUB BY -1                         15280003
152900                       UNTIL PV-SUB < +1                          15290003
153000                                                                  15300003
153100             MOVE +1               TO ASC-BLK-SUB                 15310003
153200                                                                  15320003
153300             PERFORM 5105-REWRITE-ASC-LISTQ                       15330003
153400                                                                  15340003
153500             MOVE +1                TO ASC-BLK-SUB                15350003
153600                                                                  15360003
153700             IF  PS-BLOCK-ERROR                                   15370003
153800                 SET  PS-ERROR     TO TRUE                        15380003
153900                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        15390003
154000                                   TO PV-TOP-ITEM                 15400003
154100             ELSE                                                 15410003
154200                 ADD  +1           TO PV-BLOCK-NUMBER             15420003
154300                 IF  PV-BLOCK-NUMBER >                            15430003
154400                     ASC-HIGHEST-BLOCK-WRITTEN                    15440003
154500                     MOVE +2       TO ASC-BLK-SUB                 15450003
154600                     PERFORM 4410-READ-TEMP-STORAGE               15460003
154700                     MOVE +1       TO ASC-BLK-SUB                 15470003
154800                 ELSE                                             15480003
154900                     PERFORM 4410-READ-TEMP-STORAGE               15490003
155000                     ADD  +1        TO PV-BLOCK-NUMBER            15500003
155100                     MOVE +2        TO ASC-BLK-SUB                15510003
155200                     PERFORM 4410-READ-TEMP-STORAGE               15520003
155300                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            15530003
155400                     MOVE +1        TO ASC-BLK-SUB                15540003
155500                 END-IF                                           15550003
155600             END-IF                                               15560003
155700     END-PERFORM.                                                 15570003
155800                                                                  15580003
155900     IF  PV-ORIGINAL-BLOCK  = +1    OR                            15590003
156000         PS-ERROR                   OR                            15600003
156100         PS-BLOCK-ERROR                                           15610003
156200         CONTINUE                                                 15620003
156300     ELSE                                                         15630003
156400         MOVE +1                 TO PV-BLOCK-NUMBER               15640003
156500         MOVE +1                 TO ASC-BLK-SUB                   15650003
156600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  15660003
156700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           15670003
156800         PERFORM 4410-READ-TEMP-STORAGE                           15680003
156900                                                                  15690003
157000         PERFORM                                                  15700003
157100           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              15710003
157200              OR PS-ERROR                                         15720003
157300              OR PS-BLOCK-ERROR                                   15730003
157400                                                                  15740003
157500                 COMPUTE PV-ITEMS-HOLD  =                         15750003
157600                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    15760003
157700                         PC-ITEMS-PER-PANEL - 1                   15770003
157800                                                                  15780003
157900                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     15790003
158000                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           15800003
158100                         FROM  PV-ITEMS-HOLD                      15810003
158200                       GIVING  PV-ITEMS-DIFF                      15820003
158300                     SUBTRACT  PV-ITEMS-DIFF                      15830003
158400                         FROM  PC-ITEMS-PER-PANEL                 15840003
158500                       GIVING  PV-ITEMS-HOLD                      15850003
158600                         MOVE  PV-ITEMS-HOLD TO PV-SUB            15860003
158700                                                ASC-ITEM-SUB      15870003
158800                                               ASC-ITEMS-DISPLAYED15880003
158900                 ELSE                                             15890003
159000                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          15900003
159100                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    15910003
159200                 END-IF                                           15920003
159300                                                                  15930003
159400                 PERFORM 3300-EDIT-SELECTIONS                     15940003
159500                         VARYING PV-SUB                           15950003
159600                            FROM PV-SUB BY -1                     15960003
159700                           UNTIL PV-SUB < +1                      15970003
159800                                                                  15980003
159900                 MOVE +1               TO ASC-BLK-SUB             15990003
160000                                                                  16000003
160100                 PERFORM 5105-REWRITE-ASC-LISTQ                   16010003
160200                                                                  16020003
160300                 MOVE +1                TO ASC-BLK-SUB            16030003
160400                                                                  16040003
160500                 IF  PS-BLOCK-ERROR                               16050003
160600                     SET  PS-ERROR     TO TRUE                    16060003
160700                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    16070003
160800                                       TO PV-TOP-ITEM             16080003
160900                 ELSE                                             16090003
161000                     ADD  +1            TO PV-BLOCK-NUMBER        16100003
161100                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      16110003
161200                         MOVE +2        TO ASC-BLK-SUB            16120003
161300                         PERFORM 4410-READ-TEMP-STORAGE           16130003
161400                         MOVE +1        TO ASC-BLK-SUB            16140003
161500                     ELSE                                         16150003
161600                         PERFORM 4410-READ-TEMP-STORAGE           16160003
161700                         ADD  +1        TO PV-BLOCK-NUMBER        16170003
161800                         MOVE +2        TO ASC-BLK-SUB            16180003
161900                         PERFORM 4410-READ-TEMP-STORAGE           16190003
162000                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        16200003
162100                         MOVE +1        TO ASC-BLK-SUB            16210003
162200                     END-IF                                       16220003
162300                 END-IF                                           16230003
162400     END-PERFORM.                                                 16240003
162500                                                                  16250003
162600*----------------------------------------------------------------*16260003
162700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *16270003
162800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*16280003
162900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *16290003
163000*                                                                *16300003
163100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *16310003
163200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *16320003
163300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *16330003
163400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *16340003
163500*----------------------------------------------------------------*16350003
163600 3100-SET-SUBSCRIPTS.                                             16360003
163700                                                                  16370003
163800     COMPUTE ASC-ITEM-SUB =                                       16380003
163900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        16390003
164000                                                                  16400003
164100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16410003
164200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16420003
164300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               16430003
164400     ELSE                                                         16440003
164500         MOVE +1                     TO ASC-BLK-SUB               16450003
164600     END-IF.                                                      16460003
164700******************************************************************16470003
164800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **16480003
164900******************************************************************16490003
165000 3200-RESET-ATTRIBUTES.                                           16500003
165100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   16510003
165200     MOVE DP015-GREEN              TO ASTRTITC.                   16520003
165300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   16530003
165400                                                                  16540003
165500     PERFORM                                                      16550003
165600         VARYING PV-SUB                                           16560003
165700         FROM 1 BY 1                                              16570003
165800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        16580003
165900             MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    16590003
166000             MOVE DP015-GREEN         TO MR-SELECTC (PV-SUB)      16600003
166100             MOVE DP015-UNDERLINE     TO MR-SELECTH (PV-SUB)      16610003
166200     END-PERFORM.                                                 16620003
166300                                                                  16630003
166400******************************************************************16640003
166500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **16650003
166600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **16660003
166700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **16670003
166800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16680003
166900******************************************************************16690003
167000 3300-EDIT-SELECTIONS.                                            16700003
167100     EVALUATE TRUE                                                16710003
167200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16720003
167300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16730003
167400                 CONTINUE                                         16740003
167500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         16750003
167600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        16760003
167700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   16770003
167800                 MOVE ASC-TEMP-SELECTED-SW                        16780003
167900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16790003
168000                                TO ASC-SELECTED-SW                16800003
168100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16810003
168200             END-IF                                               16820003
168300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16830003
168400                 = SPACE                                          16840003
168500             EVALUATE TRUE                                        16850003
168600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16860003
168700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16870003
168800                     MOVE SPACE TO ASC-SELECTED-SW                16880003
168900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16890003
169000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16900003
169100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    16910003
169200                     MOVE SPACE TO ASC-SELECTED-SW                16920003
169300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16930003
169400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16940003
169500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16950003
169600                     MOVE SPACE TO ASC-SELECTED-SW                16960003
169700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16970003
169800             END-EVALUATE                                         16980003
169900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16990003
170000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17000003
170100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17010003
170200             END-IF                                               17020003
170300             PERFORM 3310-EDIT-RANGE                              17030003
170400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             17040003
170500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17050003
170600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17060003
170700             END-IF                                               17070003
170800             PERFORM 3310-EDIT-RANGE                              17080003
170900         WHEN OTHER                                               17090003
171000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           17100003
171100             SET DP020-MSG-FATAL    TO TRUE                       17110003
171200             MOVE -1                TO MR-SELECTL (PV-SUB)        17120003
171300             SET DP030-SET-CURSOR-APPL-1                          17130003
171400                                    TO TRUE                       17140003
171500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        17150003
171600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        17160003
171700             SET DP030-SET-CURSOR-APPL-1                          17170003
171800                                    TO TRUE                       17180003
171900             SET PS-ERROR TO TRUE                                 17190003
172000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17200003
172100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     17210003
172200                 MOVE SPACE         TO ASC-SELECTED-SW            17220003
172300                                        (ASC-BLK-SUB ASC-ITEM-SUB)17230003
172400             END-IF                                               17240003
172500     END-EVALUATE.                                                17250003
172600                                                                  17260003
172700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 17270003
172800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17280003
172900     IF  ASC-ITEM-SUB < 1                                         17290003
173000         SUBTRACT +1 FROM ASC-BLK-SUB                             17300003
173100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                17310003
173200     END-IF.                                                      17320003
173300                                                                  17330003
173400******************************************************************17340003
173500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **17350003
173600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **17360003
173700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**17370003
173800** THE ENDING.                                                  **17380003
173900******************************************************************17390003
174000 3310-EDIT-RANGE.                                                 17400003
174100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                17410003
174200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   17420003
174300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)17430003
174400                                   TO ASC-SELECTED-SW             17440003
174500                                        (ASC-BLK-SUB ASC-ITEM-SUB)17450003
174600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 17460003
174700         ELSE                                                     17470003
174800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     17480003
174900                 CONTINUE                                         17490003
175000             ELSE                                                 17500003
175100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        17510003
175200                 MOVE PC-TSYMSG-00054                             17520003
175300                                       TO DP020-MSG-NUMBER        17530003
175400                 MOVE -1               TO MR-SELECTL (PV-SUB)     17540003
175500                 MOVE DP015-RED        TO MR-SELECTC (PV-SUB)     17550003
175600                 MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)     17560003
175700                 SET DP020-MSG-FATAL                              17570003
175800                     DP030-SET-CURSOR-APPL-1                      17580003
175900                     PS-ERROR          TO TRUE                    17590003
176000             END-IF                                               17600003
176100         END-IF                                                   17610003
176200     ELSE                                                         17620003
176300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17630003
176400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17640003
176500                                   TO ASC-SELECTED-SW             17650003
176600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17660003
176700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   17670003
176800         ELSE                                                     17680003
176900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       17690003
177000                 CONTINUE                                         17700003
177100             ELSE                                                 17710003
177200*                -- ONLY ONE END-OF-RANGE ALLOWED --              17720003
177300                 MOVE PC-TSYMSG-00055                             17730003
177400                                        TO DP020-MSG-NUMBER       17740003
177500                 MOVE -1                TO MR-SELECTL (PV-SUB)    17750003
177600                 SET DP020-MSG-FATAL                              17760003
177700                     DP030-SET-CURSOR-APPL-1                      17770003
177800                     PS-ERROR           TO TRUE                   17780003
177900             END-IF                                               17790003
178000         END-IF                                                   17800003
178100     END-IF.                                                      17810003
178200*                                                                 17820003
178300******************************************************************17830003
178400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **17840003
178500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **17850003
178600******************************************************************17860003
178700 3400-CHECK-RANGE-SEQUENCE.                                       17870003
178800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17880003
178900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17890003
179000       AND  ASC-START-OF-SELECTED-RANGE >                         17900003
179100                                         ASC-END-OF-SELECTED-RANGE17910003
179200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17920003
179300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17930003
179400         SET DP020-MSG-FATAL TO TRUE                              17940003
179500         SET PS-ERROR TO TRUE                                     17950003
179600         PERFORM 3410-POSITION-AT-ERROR                           17960003
179700     END-IF.                                                      17970003
179800******************************************************************17980003
179900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **17990003
180000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **18000003
180100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **18010003
180200******************************************************************18020003
180300 3410-POSITION-AT-ERROR.                                          18030003
180400     SET DP030-SET-CURSOR-APPL-1                                  18040003
180500                                   TO TRUE.                       18050003
180600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18060003
180700                    - PV-TOP-ITEM + 1.                            18070003
180800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18080003
180900         CONTINUE                                                 18090003
181000     ELSE                                                         18100003
181100         MOVE -1                   TO MR-SELECTL (PV-SUB)         18110003
181200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18120003
181300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18130003
181400     END-IF.                                                      18140003
181500*                                                                 18150003
181600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18160003
181700                    - PV-TOP-ITEM + 1.                            18170003
181800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18180003
181900         CONTINUE                                                 18190003
182000     ELSE                                                         18200003
182100         MOVE -1                   TO MR-SELECTL (PV-SUB)         18210003
182200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18220003
182300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18230003
182400     END-IF.                                                      18240003
182500                                                                  18250003
182600*----------------------------------------------------------------*18260003
182700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *18270003
182800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *18280003
182900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *18290003
183000*----------------------------------------------------------------*18300003
183100 3500-MARK-RANGE-AS-SELECTED.                                     18310003
183200     MOVE +1                       TO  ASC-BLK-SUB.               18320003
183300     PERFORM 3510-MARK-SELECTED-INDS                              18330003
183400         VARYING ASC-ITEM-SUB                                     18340003
183500         FROM 1 BY 1                                              18350003
183600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18360003
183700                                                                  18370003
183800     ADD +1                        TO ASC-BLK-SUB.                18380003
183900     PERFORM 3510-MARK-SELECTED-INDS                              18390003
184000         VARYING ASC-ITEM-SUB                                     18400003
184100         FROM 1 BY 1                                              18410003
184200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18420003
184300                                                                  18430003
184400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18440003
184500                                   TO  PV-LIST-ITEM-NUMBER.       18450003
184600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18460003
184700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         18470003
184800               PC-ITEMS-PER-PANEL).                               18480003
184900                                                                  18490003
185000     MOVE ASC-START-OF-SELECTED-RANGE                             18500003
185100                                   TO PV-START-OF-SELECTED-RANGE. 18510003
185200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            18520003
185300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  18530003
185400               PC-ITEMS-PER-PANEL).                               18540003
185500                                                                  18550003
185600     MOVE ASC-END-OF-SELECTED-RANGE                               18560003
185700                                   TO  PV-END-OF-SELECTED-RANGE.  18570003
185800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             18580003
185900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    18590003
186000               PC-ITEMS-PER-PANEL).                               18600003
186100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             18610003
186200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             18620003
186300                                                                  18630003
186400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    18640003
186500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        18650003
186600         MOVE +1                   TO ASC-BLK-SUB                 18660003
186700         PERFORM 5100-WRITE-TEMP-STORAGE                          18670003
186800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18680003
186900             PV-FIRST-BLOCK-IN-ARRAY - 1                          18690003
187000                                                                  18700003
187100         PERFORM                                                  18710003
187200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18720003
187300                   PV-PREV-BLOCK-IN-ARRAY                         18730003
187400             MOVE PV-FIRST-BLOCK-IN-RANGE                         18740003
187500                                   TO PV-BLOCK-NUMBER             18750003
187600             PERFORM 4410-READ-TEMP-STORAGE                       18760003
187700             PERFORM 3510-MARK-SELECTED-INDS                      18770003
187800                 VARYING ASC-ITEM-SUB                             18780003
187900                 FROM 1 BY 1                                      18790003
188000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18800003
188100             PERFORM 5100-WRITE-TEMP-STORAGE                      18810003
188200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18820003
188300         END-PERFORM                                              18830003
188400                                                                  18840003
188500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18850003
188600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18860003
188700         PERFORM                                                  18870003
188800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18880003
188900                   PV-LAST-BLOCK-IN-RANGE                         18890003
189000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18900003
189100                                   TO PV-BLOCK-NUMBER             18910003
189200             PERFORM 4410-READ-TEMP-STORAGE                       18920003
189300             PERFORM 3510-MARK-SELECTED-INDS                      18930003
189400                 VARYING ASC-ITEM-SUB                             18940003
189500                 FROM 1 BY 1                                      18950003
189600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18960003
189700             PERFORM 5100-WRITE-TEMP-STORAGE                      18970003
189800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18980003
189900         END-PERFORM                                              18990003
190000                                                                  19000003
190100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19010003
190200                                   TO PV-BLOCK-NUMBER             19020003
190300         PERFORM 4410-READ-TEMP-STORAGE                           19030003
190400     END-IF.                                                      19040003
190500                                                                  19050003
190600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19060003
190700                                      ASC-END-OF-SELECTED-RANGE.  19070003
190800                                                                  19080003
190900*----------------------------------------------------------------*19090003
191000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *19100003
191100*----------------------------------------------------------------*19110003
191200 3510-MARK-SELECTED-INDS.                                         19120003
191300                                                                  19130003
191400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19140003
191500                                ASC-ITEM-SUB) >                   19150003
191600         ASC-START-OF-SELECTED-RANGE)                             19160003
191700     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19170003
191800                                ASC-ITEM-SUB) =                   19180003
191900         ASC-START-OF-SELECTED-RANGE)                             19190003
192000                                                                  19200003
192100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19210003
192200                                    ASC-ITEM-SUB) <               19220003
192300             ASC-END-OF-SELECTED-RANGE)                           19230003
192400         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19240003
192500                                    ASC-ITEM-SUB) =               19250003
192600             ASC-END-OF-SELECTED-RANGE)                           19260003
192700                                                                  19270003
192800             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19280003
192900                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   19290003
193000                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   19300003
193100                               TO TRUE                            19310003
193200                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              19320003
193300                               TO TRUE                            19330003
193400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    19340003
193500             END-IF                                               19350003
193600         END-IF                                                   19360003
193700     END-IF.                                                      19370003
193800                                                                  19380003
193900*----------------------------------------------------------------*19390003
194000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *19400003
194100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *19410003
194200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19420003
194300*    DISPLAY THE PANEL TO USER.                                  *19430003
194400*----------------------------------------------------------------*19440003
194500 4000-BUILD-INITIAL-PANEL.                                        19450003
194600                                                                  19460003
194700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            19470003
194800                                 ASC-BLOCK-ENTRIES (2).           19480003
194900     MOVE +1                 TO ASC-BLK-SUB.                      19490003
195000     SET ASC-ITEMS-LEFT-ON-DB                                     19500003
195100                             TO TRUE.                             19510003
195200                                                                  19520003
195300     MOVE +0                 TO ASC-ITEM-SUB                      19530003
195400                                ASC-NUMBER-OF-ITEMS-READ          19540003
195500                                ASC-NUMBER-OF-SELECTED-ITEMS      19550003
195600                                ASC-HIGHEST-BLOCK-WRITTEN         19560003
195700                                ASC-START-OF-SELECTED-RANGE       19570003
195800                                ASC-END-OF-SELECTED-RANGE         19580003
195900                                ASC-ITEM-AT-TOP-OF-PANEL.         19590003
196000                                                                  19600003
196100     PERFORM 4100-PREPARE-CURSOR.                                 19610003
196200     PERFORM 4010-OPEN-CURSOR.                                    19620003
196300     PERFORM 4300-READ-ITEMS-FROM-DB.                             19630003
196400                                                                  19640003
196500     PERFORM 4020-CLOSE-CURSOR.                                   19650003
196600                                                                  19660003
196700     MOVE +1                   TO  PV-TOP-ITEM.                   19670003
196800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19680003
196900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    19690003
197000         SET DP020-MSG-FATAL   TO  TRUE                           19700003
197100         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19710003
197200     ELSE                                                         19720003
197300         MOVE -1               TO MR-SELECTL (1)                  19730003
197400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      19740003
197500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19750003
197600     END-IF.                                                      19760003
197700                                                                  19770003
197800*----------------------------------------------------------------*19780003
197900* OPEN THE CURSOR                                                 19790003
198000*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *19800003
198100*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *19810003
198200*   USER.                                                        *19820003
198300*----------------------------------------------------------------*19830003
198400 4010-OPEN-CURSOR.                                                19840003
198500     PERFORM                                                      19850003
198600         WITH TEST AFTER                                          19860003
198700         VARYING PV-RETRY-COUNTER                                 19870003
198800         FROM 1 BY 1                                              19880003
198900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19890003
199000                   OR (SQLCODE = ZERO))                           19900003
199100                                                                  19910003
199200         EVALUATE TRUE                                            19920003
199300             WHEN PS-TRLR-SRL-NBR-CSR                             19930003
199400                 EXEC SQL                                         19940003
199500                      OPEN TRLR-SRL-NBR-CSR                       19950003
199600                 END-EXEC                                         19960003
199700                                                                  19970003
199800             WHEN PS-TRIP-ID-CSR                                  19980003
199900                 EXEC SQL                                         19990003
200000                      OPEN TRIP-ID-CSR                            20000003
200100                 END-EXEC                                         20010003
200200         END-EVALUATE                                             20020003
200300                                                                  20030003
200400         EVALUATE TRUE                                            20040003
200500             WHEN SQLCODE = ZERO                                  20050003
200600             WHEN SQLCODE = -904                                  20060003
200700             WHEN SQLCODE = -913                                  20070003
200800                 CONTINUE                                         20080003
200900             WHEN SQLWARN0 NOT = SPACES                           20090003
201000             WHEN SQLCODE < ZERO                                  20100003
201100             WHEN SQLCODE > ZERO                                  20110003
201200                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       20120003
201300                 MOVE 'OPEN CURSOR PROBLEM    - '                 20130003
201400                                   TO DP013-MESSAGE-TEXT (1)      20140003
201500                 MOVE SQLCA        TO DP013-SQLCA                 20150003
201600                 MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)    20160003
201700                 SET DP013-DB2-ABEND                              20170003
201800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20180003
201900                 PERFORM DP013-0000-PROCESS-ABEND                 20190003
202000         END-EVALUATE                                             20200003
202100     END-PERFORM.                                                 20210003
202200*                                                                 20220003
202300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20230003
202400         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             20240003
202500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   20250003
202600                                   TO DP013-MESSAGE-TEXT (1)      20260003
202700         MOVE SQLCA                TO DP013-SQLCA                 20270003
202800         MOVE 'TSUOBTR '           TO DP013-DB2-TABLE-NAME (1)    20280003
202900         SET DP013-DB2-ABEND                                      20290003
203000             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20300003
203100         PERFORM DP013-0000-PROCESS-ABEND                         20310003
203200     END-IF.                                                      20320003
203300                                                                  20330003
203400*----------------------------------------------------------------*20340003
203500* CLOSE THE CURSOR.                                               20350003
203600*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *20360003
203700*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *20370003
203800*   USER.                                                        *20380003
203900*----------------------------------------------------------------*20390003
204000 4020-CLOSE-CURSOR.                                               20400003
204100                                                                  20410003
204200     EVALUATE TRUE                                                20420003
204300         WHEN PS-TRLR-SRL-NBR-CSR                                 20430003
204400             EXEC SQL                                             20440003
204500                  CLOSE TRLR-SRL-NBR-CSR                          20450003
204600             END-EXEC                                             20460003
204700                                                                  20470003
204800         WHEN PS-TRIP-ID-CSR                                      20480003
204900             EXEC SQL                                             20490003
205000                  CLOSE TRIP-ID-CSR                               20500003
205100             END-EXEC                                             20510003
205200     END-EVALUATE.                                                20520003
205300                                                                  20530003
205400     EVALUATE TRUE                                                20540003
205500         WHEN SQLCODE = ZERO                                      20550003
205600         WHEN SQLCODE = +100                                      20560003
205700             CONTINUE                                             20570003
205800         WHEN SQLWARN0 NOT = SPACES                               20580003
205900         WHEN SQLCODE < ZERO                                      20590003
206000         WHEN SQLCODE > ZERO                                      20600003
206100             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          20610003
206200             MOVE 'CLOSE CURSOR PROBLEM   '                       20620003
206300                               TO DP013-MESSAGE-TEXT (1)          20630003
206400             MOVE SQLCA        TO DP013-SQLCA                     20640003
206500             MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)        20650003
206600             SET DP013-DB2-ABEND                                  20660003
206700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20670003
206800             PERFORM DP013-0000-PROCESS-ABEND                     20680003
206900     END-EVALUATE.                                                20690003
207000                                                                  20700003
207100*----------------------------------------------------------------*20710003
207200*    SET UP THE HOST VARIABLES.                                  *20720003
207300*----------------------------------------------------------------*20730003
207400 4100-PREPARE-CURSOR.                                             20740003
207500     MOVE SPACE TO PS-CURSOR-SW.                                  20750003
207600     MOVE ASC-TRLR-SRL-NMBR    TO DK-TRLR-SRL-NBR.                20760003
207700     MOVE ASC-OUTBOUND-TRIP-ID TO DK-TRIP-ID.                     20770003
207800     MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID.                 20780003
207900     IF ASC-OUTBOUND-TRIP-ID > ZERO                               20790003
208000         SET PS-TRIP-ID-CSR TO TRUE                               20800003
208100         PERFORM 4330-GET-SCAC-TRLR-BY-TRIP                       20810003
208200     ELSE                                                         20820003
208300         IF ASC-TRLR-SRL-NMBR > ZERO                              20830003
208400             SET PS-TRLR-SRL-NBR-CSR TO TRUE                      20840003
208500             PERFORM 4331-GET-SCAC-TRLR-BY-SRL                    20850003
208600         END-IF                                                   20860003
208700     END-IF.                                                      20870003
208800                                                                  20880003
208900     MOVE DK-SCAC-TRLR-ID TO ASC-SCAC-TRLR-ID.                    20890003
209000                                                                  20900003
209100*----------------------------------------------------------------*20910003
209200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20920003
209300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20930003
209400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20940003
209500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20950003
209600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20960003
209700*                                                                *20970003
209800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20980003
209900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20990003
210000*    UPON INITIALIZATION.                                        *21000003
210100*----------------------------------------------------------------*21010003
210200 4300-READ-ITEMS-FROM-DB.                                         21020003
210300                                                                  21030003
210400     PERFORM                                                      21040003
210500         VARYING PV-READ-COUNT                                    21050003
210600         FROM 1 BY 1                                              21060003
210700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    21070003
210800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21080003
210900                                                                  21090003
211000         PERFORM 4310-FETCH                                       21100003
211100                                                                  21110003
211200         IF  ASC-ITEMS-LEFT-ON-DB                                 21120003
211300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                21130003
211400                 ADD +1            TO ASC-ITEM-SUB                21140003
211500             ELSE                                                 21150003
211600                 ADD +1            TO ASC-BLK-SUB                 21160003
211700                 MOVE +1           TO ASC-ITEM-SUB                21170003
211800                                                                  21180003
211900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         21190003
212000                     MOVE +1       TO ASC-BLK-SUB                 21200003
212100                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           21210003
212200                     PERFORM 5100-WRITE-TEMP-STORAGE              21220003
212300                     MOVE ASC-BLOCK-ENTRIES                       21230003
212400                                   (PC-MAX-BLOCKS-IN-ARRAY)       21240003
212500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21250003
212600                     ADD +1        TO ASC-BLK-SUB                 21260003
212700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   21270003
212800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      21280003
212900                                                          TO TRUE 21290003
213000                 END-IF                                           21300003
213100             END-IF                                               21310003
213200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21320003
213300             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          21330003
213400             MOVE ASC-NUMBER-OF-ITEMS-READ                        21340003
213500                                   TO ASC-LIST-ITEM-NUMBER        21350003
213600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21360003
213700             MOVE SUOBTR-OTBND-TRIP-ID                            21370003
213800                        TO ASC-TRIP-ID (ASC-BLK-SUB ASC-ITEM-SUB) 21380003
213900             MOVE SUOBSC-TRIP-STAT-DESC                           21390003
214000                   TO ASC-TRIP-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)  21400003
214100             MOVE SUOBTS-OTBND-STAT-TMST TO PV-TMST               21410003
214200             MOVE PV-USA-DATE                                     21420003
214300                      TO ASC-STAT-DATE (ASC-BLK-SUB ASC-ITEM-SUB) 21430003
214400             MOVE PV-JIS-TIME                                     21440003
214500                      TO ASC-STAT-TIME (ASC-BLK-SUB ASC-ITEM-SUB) 21450003
214600             MOVE SUOBTS-OTBND-STAT-USR-ID                        21460003
214700                       TO ASC-USER-ID  (ASC-BLK-SUB ASC-ITEM-SUB) 21470003
214800*LMM         MOVE ASC-DOOR-DESC                                   21480004
214900             MOVE ASC-DOOR-ID                                     21490004
215000                   TO ASC-DOOR-SLOT  (ASC-BLK-SUB ASC-ITEM-SUB)   21500003
215100             MOVE SUOBTR-DEST-OPER-UNT-ID                         21510003
215200                   TO ASC-DEST-NBR (ASC-BLK-SUB ASC-ITEM-SUB)     21520003
215300         END-IF                                                   21530003
215400     END-PERFORM.                                                 21540003
215500                                                                  21550003
215600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21560003
215700         MOVE +1               TO ASC-BLK-SUB                     21570003
215800         PERFORM 5100-WRITE-TEMP-STORAGE                          21580003
215900         ADD +1                TO ASC-BLK-SUB                     21590003
216000         PERFORM 5100-WRITE-TEMP-STORAGE                          21600003
216100                                                                  21610003
216200         MOVE 1                TO ASC-BLK-SUB                     21620003
216300                                  PV-BLOCK-NUMBER                 21630003
216400         PERFORM 4410-READ-TEMP-STORAGE                           21640003
216500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             21650003
216600             MOVE 2            TO ASC-BLK-SUB                     21660003
216700                                  PV-BLOCK-NUMBER                 21670003
216800             PERFORM 4410-READ-TEMP-STORAGE                       21680003
216900         END-IF                                                   21690003
217000     END-IF.                                                      21700003
217100                                                                  21710003
217200*----------------------------------------------------------------*21720003
217300*    FETCH THE CURSOR                                             21730003
217400*----------------------------------------------------------------*21740003
217500 4310-FETCH.                                                      21750003
217600     EVALUATE TRUE                                                21760003
217700         WHEN PS-TRIP-ID-CSR                                      21770003
217800             EXEC SQL                                             21780003
217900                 FETCH TRIP-ID-CSR                                21790003
218000                  INTO  :SUOBTR-TRLR-SRL-NBR                      21800003
218100                       ,:SUOBTR-OTBND-TRIP-ID                     21810003
218200                       ,:SUOBTR-DEST-OPER-UNT-ID                  21820003
218300                       ,:SUOBTS-OTBND-STAT-TMST                   21830003
218400                       ,:PV-USA-DATE                              21840003
218500                       ,:PV-JIS-TIME                              21850003
218600                       ,:SUOBTS-TRIP-STAT-CDE                     21860003
218700                       ,:SUOBTS-OTBND-STAT-USR-ID                 21870003
218800                       ,:SUOBTS-DOOR-ID                           21880003
218900                       ,:SUOBTS-SHIP-SCAC-CDE                     21890003
219000                       ,:SUOBTS-TRLR-PRKG-LOC-DESC                21900003
219100                       ,:SUOBTS-TRLR-PRKG-SLOT-NBR                21910003
219200                       ,:SUOBSC-TRIP-STAT-DESC                    21920003
219300             END-EXEC                                             21930003
219400                                                                  21940003
219500         WHEN PS-TRLR-SRL-NBR-CSR                                 21950003
219600             EXEC SQL                                             21960003
219700                FETCH  TRLR-SRL-NBR-CSR                           21970003
219800                  INTO  :SUOBTR-TRLR-SRL-NBR                      21980003
219900                       ,:SUOBTR-OTBND-TRIP-ID                     21990003
220000                       ,:SUOBTR-DEST-OPER-UNT-ID                  22000003
220100                       ,:SUOBTS-OTBND-STAT-TMST                   22010003
220200                       ,:PV-USA-DATE                              22020003
220300                       ,:PV-JIS-TIME                              22030003
220400                       ,:SUOBTS-TRIP-STAT-CDE                     22040003
220500                       ,:SUOBTS-OTBND-STAT-USR-ID                 22050003
220600                       ,:SUOBTS-DOOR-ID                           22060003
220700                       ,:SUOBTS-SHIP-SCAC-CDE                     22070003
220800                       ,:SUOBTS-TRLR-PRKG-LOC-DESC                22080003
220900                       ,:SUOBTS-TRLR-PRKG-SLOT-NBR                22090003
221000                       ,:SUOBSC-TRIP-STAT-DESC                    22100003
221100             END-EXEC                                             22110003
221200     END-EVALUATE.                                                22120003
221300                                                                  22130003
221400     EVALUATE TRUE                                                22140003
221500         WHEN SQLCODE = ZERO                                      22150003
221600             MOVE SUOBTR-TRLR-SRL-NBR  TO ASC-TRLR-SRL-NMBR       22160003
221700                                                                  22170005
221800             IF SUOBTS-TRLR-PRKG-SLOT-NBR > SPACES                22180005
221900                 MOVE SUOBTS-DOOR-ID            TO ASC-DOOR-ID    22190005
222000             ELSE                                                 22200005
222100                 PERFORM 4320-GET-DOOR-ID                         22210005
222200             END-IF                                               22220005
222300                                                                  22230003
222400         WHEN SQLCODE = +100                                      22240003
222500              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 22250014
222600                                                                  22260014
222700         WHEN SQLWARN0 NOT = SPACE                                22270003
222800         WHEN SQLCODE NOT = ZERO                                  22280003
222900              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         22290003
223000              MOVE 'FETCH CURSOR PROBLEM '                        22300003
223100                               TO DP013-MESSAGE-TEXT (1)          22310003
223200              MOVE SQLCA       TO DP013-SQLCA                     22320003
223300              MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)       22330003
223400              SET DP013-DB2-ABEND TO TRUE                         22340003
223500              PERFORM DP013-0000-PROCESS-ABEND                    22350003
223600     END-EVALUATE.                                                22360003
223700                                                                  22370003
223800                                                                  22380003
223900*----------------------------------------------------------------*22390003
224000* RETRIEVE DOOR ID DESCRIPTION FROM TCNDCDR TABLE                 22400003
224100*----------------------------------------------------------------*22410003
224200 4320-GET-DOOR-ID.                                                22420005
224300     EXEC SQL                                                     22430003
224400          SELECT DOOR_ID                                          22440005
224500          INTO  :CNDCDR-DOOR-ID                                   22450005
224600           FROM  TCNDCDR                                          22460003
224700          WHERE  OPER_UNT_ID  =  :DK-OPER-UNT-ID                  22470003
224800            AND  DOOR_ID      =  :SUOBTS-DOOR-ID                  22480003
224900     END-EXEC                                                     22490003
225000     EVALUATE TRUE                                                22500003
225100         WHEN SQLCODE = ZERO                                      22510003
225200             MOVE CNDCDR-DOOR-ID       TO ASC-DOOR-ID             22520005
225300         WHEN SQLCODE = +100                                      22530003
225400             MOVE SPACES TO ASC-DOOR-ID                           22540005
225500         WHEN SQLWARN0 NOT = SPACE                                22550003
225600         WHEN SQLCODE NOT = ZERO                                  22560003
225700              MOVE '4320-GET-DOOR-ID' TO DP013-PARAGRAPH          22570005
225800              MOVE 'GET DOOR ID '                                 22580005
225900                               TO DP013-MESSAGE-TEXT (1)          22590003
226000              MOVE SQLCA       TO DP013-SQLCA                     22600003
226100              MOVE 'TCNDCDR '   TO DP013-DB2-TABLE-NAME (1)       22610003
226200              SET DP013-DB2-ABEND TO TRUE                         22620003
226300              PERFORM DP013-0000-PROCESS-ABEND                    22630003
226400     END-EVALUATE.                                                22640003
226500                                                                  22650003
226600 4330-GET-SCAC-TRLR-BY-TRIP.                                      22660003
226700                                                                  22670003
226800     EXEC SQL                                                     22680003
226900         SELECT                                                   22690003
227000             TRID.TRLR_ID                                         22700003
227100         ,   TRID.SCAC_CDE                                        22710003
227200         INTO                                                     22720003
227300             :CNTRID-TRLR-ID                                      22730003
227400         ,   :CNTRID-SCAC-CDE                                     22740003
227500         FROM                                                     22750003
227600             TCNTRID TRID                                         22760003
227700         ,   TSUOBTR OBTR                                         22770003
227800         WHERE                                                    22780003
227900             TRID.TRLR_SRL_NBR     = OBTR.TRLR_SRL_NBR            22790003
228000         AND                                                      22800003
228100             OBTR.OTBND_TRIP_ID    = :DK-TRIP-ID                  22810003
228200**LMM    AND  OBTR.ORGN_OPER_UNT_ID = :DK-OPER-UNT-ID             22820017
228300     END-EXEC.                                                    22830003
228400                                                                  22840003
228500     EVALUATE TRUE                                                22850003
228600         WHEN SQLCODE = ZERO                                      22860003
228700             MOVE CNTRID-SCAC-CDE   TO ASC-SCAC-CODE              22870008
228800                                       DK-SCAC                    22880008
228900             MOVE CNTRID-TRLR-ID    TO ASC-TRLR-ID                22890008
229000                                       DK-TRLR-ID                 22900008
229100         WHEN SQLCODE = +100                                      22910003
229200             MOVE SPACES            TO ASC-SCAC-CODE              22920008
229300                                       ASC-TRLR-ID                22930008
229400                                       DK-SCAC                    22940008
229500                                       DK-TRLR-ID                 22950008
229600         WHEN SQLWARN0 NOT = SPACE                                22960003
229700         WHEN SQLCODE NOT = ZERO                                  22970003
229800              MOVE '4330-GET-SCAC-TRLR' TO DP013-PARAGRAPH        22980003
229900              MOVE 'GET SCAC AND TRAILER ID'                      22990003
230000                               TO DP013-MESSAGE-TEXT (1)          23000003
230100              MOVE SQLCA       TO DP013-SQLCA                     23010003
230200              MOVE 'TCNTRID '   TO DP013-DB2-TABLE-NAME (1)       23020003
230300              MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (2)       23030003
230400              SET DP013-DB2-ABEND TO TRUE                         23040003
230500              PERFORM DP013-0000-PROCESS-ABEND                    23050003
230600     END-EVALUATE.                                                23060003
230700                                                                  23070003
230800 4331-GET-SCAC-TRLR-BY-SRL.                                       23080003
230900                                                                  23090003
231000     EXEC SQL                                                     23100003
231100         SELECT                                                   23110003
231200             TRID.TRLR_ID                                         23120003
231300         ,   TRID.SCAC_CDE                                        23130003
231400         INTO                                                     23140003
231500             :CNTRID-TRLR-ID                                      23150011
231600         ,   :CNTRID-SCAC-CDE                                     23160011
231700         FROM                                                     23170003
231800             TCNTRID TRID                                         23180003
231900         WHERE                                                    23190003
232000             TRID.TRLR_SRL_NBR  = :DK-TRLR-SRL-NBR                23200003
232100     END-EXEC.                                                    23210003
232200                                                                  23220003
232300     EVALUATE TRUE                                                23230003
232400         WHEN SQLCODE = ZERO                                      23240003
232500             MOVE CNTRID-SCAC-CDE   TO ASC-SCAC-CODE              23250009
232600                                       DK-SCAC                    23260009
232700             MOVE CNTRID-TRLR-ID    TO ASC-TRLR-ID                23270009
232800                                       DK-TRLR-ID                 23280009
232900         WHEN SQLCODE = +100                                      23290009
233000             MOVE SPACES            TO ASC-SCAC-CODE              23300009
233100                                       ASC-TRLR-ID                23310009
233200                                       DK-SCAC                    23320009
233300                                       DK-TRLR-ID                 23330009
233400         WHEN SQLWARN0 NOT = SPACE                                23340003
233500         WHEN SQLCODE NOT = ZERO                                  23350003
233600              MOVE '4331-GET-SCAC-TRLR' TO DP013-PARAGRAPH        23360003
233700              MOVE 'GET SCAC AND TRAILER ID'                      23370003
233800                               TO DP013-MESSAGE-TEXT (1)          23380003
233900              MOVE SQLCA       TO DP013-SQLCA                     23390003
234000              MOVE 'TCNTRID '   TO DP013-DB2-TABLE-NAME (1)       23400003
234100              SET DP013-DB2-ABEND TO TRUE                         23410003
234200              PERFORM DP013-0000-PROCESS-ABEND                    23420003
234300     END-EVALUATE.                                                23430003
234400                                                                  23440003
234500*----------------------------------------------------------------*23450003
234600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23460003
234700*----------------------------------------------------------------*23470003
234800 4400-MOVE-COMMAREA-TO-SCREEN.                                    23480003
234900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23490003
235000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23500003
235100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23510003
235200             MOVE +1    TO ASC-BLK-SUB                            23520003
235300             PERFORM 5100-WRITE-TEMP-STORAGE                      23530003
235400             ADD +1     TO ASC-BLK-SUB                            23540003
235500             PERFORM 5100-WRITE-TEMP-STORAGE                      23550003
235600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23560003
235700                 GIVING PV-BLOCK-NUMBER                           23570003
235800                 REMAINDER PV-REMAINDER                           23580003
235900             IF  PV-REMAINDER > ZERO                              23590003
236000                 ADD +1 TO PV-BLOCK-NUMBER                        23600003
236100             END-IF                                               23610003
236200             MOVE +1    TO ASC-BLK-SUB                            23620003
236300             PERFORM 4410-READ-TEMP-STORAGE                       23630003
236400             ADD +1     TO ASC-BLK-SUB                            23640003
236500                           PV-BLOCK-NUMBER                        23650003
236600             PERFORM 4410-READ-TEMP-STORAGE                       23660003
236700     END-IF.                                                      23670003
236800     MOVE +1            TO ASC-BLK-SUB.                           23680003
236900     COMPUTE ASC-ITEM-SUB =                                       23690003
237000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23700003
237100         + PC-ITEMS-PER-PANEL).                                   23710003
237200*                                                                 23720003
237300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23730003
237400         ADD +1         TO ASC-BLK-SUB                            23740003
237500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23750003
237600     END-IF.                                                      23760003
237700*                                                                 23770003
237800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23780003
237900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23790003
238000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23800003
238100     PERFORM 4420-FORMAT-LIST-LINES                               23810003
238200         VARYING PV-SUB                                           23820003
238300         FROM PC-ITEMS-PER-PANEL BY -1                            23830003
238400         UNTIL PV-SUB < +1.                                       23840003
238500*                                                                 23850003
238600     COMPUTE ASC-ITEMS-DISPLAYED =                                23860003
238700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23870003
238800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23880003
238900                                      ASTRTITO.                   23890003
239000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    23900003
239100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    23910003
239200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23920003
239300                                   TO ASELITO.                    23930003
239400                                                                  23940003
239500     MOVE ASC-OPER-UNT-ID            TO AOPERO.                   23950003
239600     MOVE ASC-TRLR-SRL-NMBR          TO ATRLRO.                   23960003
239700     MOVE ASC-SCAC-TRLR-ID           TO ASCACO.                   23970003
239800                                                                  23980003
239900     IF  DP020-MSG-NUMBER-X = SPACE                               23990003
240000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  24000003
240100*            --- MORE ITEMS TO DISPLAY ----                       24010003
240200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            24020003
240300             SET DP020-MSG-INFORMATIONAL TO TRUE                  24030003
240400         END-IF                                                   24040003
240500     END-IF.                                                      24050003
240600                                                                  24060003
240700*----------------------------------------------------------------*24070003
240800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *24080003
240900*----------------------------------------------------------------*24090003
241000 4410-READ-TEMP-STORAGE.                                          24100003
241100                                                                  24110003
241200     EXEC CICS                                                    24120003
241300         READQ TS                                                 24130003
241400             QUEUE (ASC-LIST-QUEUE-NAME)                          24140003
241500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24150003
241600             ITEM  (PV-BLOCK-NUMBER)                              24160003
241700             RESP  (PV-CICS-RESP)                                 24170003
241800     END-EXEC.                                                    24180003
241900                                                                  24190003
242000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       24200003
242100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     24210003
242200         CONTINUE                                                 24220003
242300     ELSE                                                         24230003
242400         SET DP013-CICS-ABEND     TO TRUE                         24240003
242500         SET DP013-NO-ROLLBACK    TO TRUE                         24250003
242600         MOVE '4410-READ-TEMP-STORAGE'                            24260003
242700                                  TO DP013-PARAGRAPH              24270003
242800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      24280003
242900                                  TO DP013-MESSAGE-TEXT(1)        24290003
243000         PERFORM DP013-0000-PROCESS-ABEND                         24300003
243100     END-IF.                                                      24310003
243200                                                                  24320003
243300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24330003
243400*                                                                 24340003
243500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         24350003
243600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               24360003
243700     END-IF.                                                      24370003
243800                                                                  24380003
243900*----------------------------------------------------------------*24390003
244000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *24400003
244100*----------------------------------------------------------------*24410003
244200 4420-FORMAT-LIST-LINES.                                          24420003
244300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      24430003
244400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                24440003
244500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           24450003
244600         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           24460003
244700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           24470003
244800                                    MR-ACTION (PV-SUB)            24480003
244900                                    MR-TRIP-ID (PV-SUB)           24490003
245000                                    MR-TRIP-STATUS (PV-SUB)       24500003
245100                                    MR-STAT-DATE (PV-SUB)         24510003
245200                                    MR-STAT-TIME (PV-SUB)         24520003
245300                                    MR-USER-ID (PV-SUB)           24530003
245400                                    MR-DOOR-SLOT (PV-SUB)         24540003
245500                                    MR-DEST-NBR (PV-SUB)          24550003
245600     ELSE                                                         24560003
245700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24570003
245800                                                   > SPACE        24580003
245900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24590003
246000                                 TO MR-SELECTI (PV-SUB)           24600003
246100         ELSE                                                     24610003
246200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24620003
246300                                 TO MR-SELECTI (PV-SUB)           24630003
246400         END-IF                                                   24640003
246500         IF  DP030-SET-CURSOR-TRAILER                             24650003
246600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24660003
246700                 > SPACE)                                         24670003
246800               OR (PV-SUB = 1))                                   24680003
246900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24690003
247000                MOVE -1               TO MR-SELECTL (PV-SUB)      24700003
247100             END-IF                                               24710003
247200         END-IF                                                   24720003
247300*                                                                 24730003
247400         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               24740003
247500                                           TO MR-ACTION (PV-SUB)  24750003
247600         MOVE ASC-TRIP-ID (ASC-BLK-SUB ASC-ITEM-SUB)              24760003
247700                                           TO MR-TRIP-ID (PV-SUB) 24770003
247800         MOVE ASC-TRIP-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)          24780003
247900                                       TO MR-TRIP-STATUS (PV-SUB) 24790003
248000         MOVE ASC-STAT-DATE (ASC-BLK-SUB ASC-ITEM-SUB)            24800003
248100                                         TO MR-STAT-DATE (PV-SUB) 24810003
248200         MOVE ASC-STAT-TIME (ASC-BLK-SUB ASC-ITEM-SUB)            24820003
248300                                         TO MR-STAT-TIME (PV-SUB) 24830003
248400         MOVE ASC-USER-ID (ASC-BLK-SUB ASC-ITEM-SUB)              24840003
248500                                           TO MR-USER-ID (PV-SUB) 24850003
248600         MOVE ASC-DOOR-SLOT (ASC-BLK-SUB ASC-ITEM-SUB)            24860003
248700                                         TO MR-DOOR-SLOT (PV-SUB) 24870003
248800         MOVE ASC-DEST-NBR (ASC-BLK-SUB ASC-ITEM-SUB)             24880003
248900                                          TO MR-DEST-NBR (PV-SUB) 24890003
249000     END-IF.                                                      24900003
249100     SUBTRACT +1 FROM ASC-ITEM-SUB                                24910003
249200     IF  ASC-ITEM-SUB < + 1                                       24920003
249300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24930003
249400         MOVE +1                 TO ASC-BLK-SUB                   24940003
249500     END-IF.                                                      24950003
249600                                                                  24960003
249700******************************************************************24970003
249800** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **24980003
249900** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **24990003
250000** ISSUE A WARNING.                                             **25000003
250100******************************************************************25010003
250200 4430-CHECK-FOR-BEGIN-AND-END.                                    25020003
250300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       25030003
250400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25040003
250500*            -- NO END-OF-RANGE SPECFIED ---                      25050003
250600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            25060003
250700             SET DP020-MSG-WARNING TO TRUE                        25070003
250800             PERFORM 4431-POSITION-AT-WARNING                     25080003
250900         END-IF                                                   25090003
251000     ELSE                                                         25100003
251100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     25110003
251200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                25120003
251300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            25130003
251400             SET DP020-MSG-WARNING TO TRUE                        25140003
251500             PERFORM 4431-POSITION-AT-WARNING                     25150003
251600         END-IF                                                   25160003
251700     END-IF.                                                      25170003
251800******************************************************************25180003
251900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **25190003
252000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **25200003
252100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **25210003
252200** POSITION THE CURSOR THERE.                                   **25220003
252300******************************************************************25230003
252400 4431-POSITION-AT-WARNING.                                        25240003
252500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 25250003
252600                    - PV-TOP-ITEM + 1.                            25260003
252700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25270003
252800         CONTINUE                                                 25280003
252900     ELSE                                                         25290003
253000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25300003
253100         MOVE -1                   TO MR-SELECTL (PV-SUB)         25310003
253200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25320003
253300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25330003
253400     END-IF.                                                      25340003
253500*                                                                 25350003
253600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   25360003
253700                    - PV-TOP-ITEM + 1.                            25370003
253800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25380003
253900         CONTINUE                                                 25390003
254000     ELSE                                                         25400003
254100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25410003
254200         MOVE -1                   TO MR-SELECTL (PV-SUB)         25420003
254300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25430003
254400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25440003
254500     END-IF.                                                      25450003
254600                                                                  25460003
254700*----------------------------------------------------------------*25470003
254800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25480003
254900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25490003
255000* FOR THE SELECTED ITEMS QUEUE.                                  *25500003
255100*                                                                *25510003
255200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25520003
255300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25530003
255400* THE ARRAY IS FULL.                                             *25540003
255500*----------------------------------------------------------------*25550003
255600 5000-PREPARE-SEL-QUEUE.                                          25560003
255700                                                                  25570003
255800     MOVE +1                   TO  ASC-BLK-SUB.                   25580003
255900     PERFORM 5100-WRITE-TEMP-STORAGE.                             25590003
256000     ADD +1                    TO  ASC-BLK-SUB.                   25600003
256100     PERFORM 5100-WRITE-TEMP-STORAGE.                             25610003
256200                                                                  25620003
256210*** BEGIN - AHP 12/31/07                                          25621024
256300     MOVE ASC-SEL-QUEUE-NAME-OUT   TO  SU009-SEL-QUEUE-NAME.      25630022
256310*** END   - AHP 12/31/07                                          25631024
256400     PERFORM 6010-DELETE-SEL-QUEUE.                               25640003
256500                                                                  25650003
256600     SET ASC-UPDATE-TSQ        TO  TRUE.                          25660003
256700                                                                  25670003
256800     SET SU010-IDX             TO  1.                             25680003
256900     MOVE ZERO                 TO SU009-NUMBER-OF-TS-ITEMS.       25690003
257000     INITIALIZE SU010-SELECTED-ITEM-ARRAY.                        25700003
257100                                                                  25710003
257200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25720003
257300             VARYING PV-ITEM                                      25730003
257400             FROM 1 BY 1                                          25740003
257500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25750003
257600                                                                  25760003
257700     IF  SU010-IDX > 1                                            25770003
257800         PERFORM 5205-WRITE-SEL-QUEUE                             25780003
257900         ADD +1                TO SU009-NUMBER-OF-TS-ITEMS        25790003
258000     END-IF.                                                      25800003
258100*----------------------------------------------------------------*25810003
258200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25820003
258300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25830003
258400*----------------------------------------------------------------*25840003
258500 5100-WRITE-TEMP-STORAGE.                                         25850003
258600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25860003
258700                                   TO PV-LIST-ITEM-NUMBER.        25870003
258800     COMPUTE PV-BLOCK-NUMBER =                                    25880003
258900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25890003
259000                                                                  25900003
259100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25910003
259200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25920003
259300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25930003
259400             PERFORM 5105-REWRITE-ASC-LISTQ                       25940003
259500         END-IF                                                   25950003
259600     ELSE                                                         25960003
259700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25970003
259800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25980003
259900         PERFORM 5110-WRITE-ASC-LISTQ                             25990003
260000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26000003
260100     END-IF.                                                      26010003
260200                                                                  26020003
260300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26030003
260400                                                                  26040003
260500******************************************************************26050003
260600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **26060003
260700** SPECIFIC COMMAREA.                                           **26070003
260800******************************************************************26080003
260900 5105-REWRITE-ASC-LISTQ.                                          26090003
261000     EXEC CICS                                                    26100003
261100         WRITEQ TS                                                26110003
261200             QUEUE (ASC-LIST-QUEUE-NAME)                          26120003
261300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26130003
261400             ITEM  (PV-BLOCK-NUMBER)                              26140003
261500             REWRITE                                              26150003
261600             RESP  (PV-CICS-RESP)                                 26160003
261700     END-EXEC.                                                    26170003
261800                                                                  26180003
261900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           26190003
262000         CONTINUE                                                 26200003
262100     ELSE                                                         26210003
262200         SET DP013-CICS-ABEND            TO TRUE                  26220003
262300         SET DP013-NO-ROLLBACK           TO TRUE                  26230003
262400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       26240003
262500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     26250003
262600                                         TO DP013-MESSAGE-TEXT(1) 26260003
262700         PERFORM DP013-0000-PROCESS-ABEND                         26270003
262800     END-IF.                                                      26280003
262900                                                                  26290003
263000******************************************************************26300003
263100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **26310003
263200** SPECIFIC COMMAREA.                                           **26320003
263300******************************************************************26330003
263400 5110-WRITE-ASC-LISTQ.                                            26340003
263500     EXEC CICS                                                    26350003
263600         WRITEQ TS                                                26360003
263700             QUEUE (ASC-LIST-QUEUE-NAME)                          26370003
263800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26380003
263900             ITEM  (PV-BLOCK-NUMBER)                              26390003
264000             RESP  (PV-CICS-RESP)                                 26400003
264100     END-EXEC.                                                    26410003
264200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26420003
264300         SET DP013-CICS-ABEND      TO TRUE                        26430003
264400         SET DP013-NO-ROLLBACK     TO TRUE                        26440003
264500         MOVE '5110-WRITE-ASC-LISTQ'                              26450003
264600                                   TO DP013-PARAGRAPH             26460003
264700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26470003
264800                                   TO DP013-MESSAGE-TEXT(1)       26480003
264900         PERFORM DP013-0000-PROCESS-ABEND                         26490003
265000     END-IF.                                                      26500003
265100                                                                  26510003
265200*----------------------------------------------------------------*26520003
265300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26530003
265400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26540003
265500*----------------------------------------------------------------*26550003
265600 5200-FILL-SEL-QUEUE-RECORD.                                      26560003
265700                                                                  26570003
265800     PERFORM 6112-READ-LIST-QUEUE.                                26580003
265900                                                                  26590003
266000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26600003
266100         PERFORM                                                  26610003
266200         VARYING LQW-IDX                                          26620003
266300         FROM 1 BY 1                                              26630003
266400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26640003
266500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26650003
266600                                                                  26660003
266700             IF  LQW-SELECT (LQW-IDX)                             26670003
266800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26680003
266900                                   TO SU010-ITEM (SU010-IDX)      26690003
267000                 MOVE SPACE        TO SU010-ACTION-SW (SU010-IDX) 26700003
267100                                                                  26710003
267200                 MOVE LQW-TRIP-ID (LQW-IDX)                       26720003
267300                                     TO SU010-TRIP-ID (SU010-IDX) 26730003
267400                 MOVE LQW-TRIP-STATUS (LQW-IDX)                   26740003
267500                                 TO SU010-TRIP-STATUS (SU010-IDX) 26750003
267600                 MOVE LQW-STAT-DATE (LQW-IDX)                     26760003
267700                                   TO SU010-STAT-DATE (SU010-IDX) 26770003
267800                 MOVE LQW-STAT-TIME (LQW-IDX)                     26780003
267900                                   TO SU010-STAT-TIME (SU010-IDX) 26790003
268000                 MOVE LQW-USER-ID (LQW-IDX)                       26800003
268100                                     TO SU010-USER-ID (SU010-IDX) 26810003
268200                 MOVE LQW-DOOR-SLOT (LQW-IDX)                     26820003
268300                                    TO SU010-DOOR-ID  (SU010-IDX) 26830012
268400                 MOVE LQW-DEST-NBR (LQW-IDX)                      26840003
268500                                    TO SU010-DEST-NBR (SU010-IDX) 26850003
268600                                                                  26860003
268700                 SET SU010-IDX UP BY 1                            26870003
268800                 IF  SU010-IDX > SU010-MAX-ITEMS                  26880003
268900                     PERFORM 5205-WRITE-SEL-QUEUE                 26890003
269000                     ADD +1        TO SU009-NUMBER-OF-TS-ITEMS    26900003
269100                     INITIALIZE SU010-SELECTED-ITEM-ARRAY         26910003
269200                     SET SU010-IDX TO  1                          26920003
269300                 END-IF                                           26930003
269400             END-IF                                               26940003
269500         END-PERFORM                                              26950003
269600     END-IF.                                                      26960003
269700                                                                  26970003
269800*----------------------------------------------------------------*26980003
269900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26990003
270000*----------------------------------------------------------------*27000003
270100 5205-WRITE-SEL-QUEUE.                                            27010003
270200                                                                  27020003
270300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27030003
270400                                   TO SU010-SELECTED-ITEMS.       27040003
270500                                                                  27050003
270600     EXEC CICS                                                    27060003
270700          WRITEQ TS                                               27070003
270710*** BEGIN - AHP 12/31/07                                          27071024
270800              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      27080022
270810*** END   - AHP 12/31/07                                          27081024
270900              FROM  (SU010-SELECT-RECORD)                         27090003
271000              ITEM  (PV-SEL-QUEUE-ITEM)                           27100003
271100              RESP  (PV-CICS-RESP)                                27110003
271200     END-EXEC.                                                    27120003
271300                                                                  27130003
271400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27140003
271500         CONTINUE                                                 27150003
271600     ELSE                                                         27160003
271700         SET DP013-CICS-ABEND      TO TRUE                        27170003
271800         SET DP013-NO-ROLLBACK     TO TRUE                        27180003
271900         MOVE '5205-WRITE-SEL-QUEUE'                              27190003
272000                                   TO DP013-PARAGRAPH             27200003
272100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          27210003
272200                                   TO DP013-MESSAGE-TEXT(1)       27220003
272300         PERFORM DP013-0000-PROCESS-ABEND                         27230003
272400     END-IF.                                                      27240003
272500******************************************************************27250003
272600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **27260003
272700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **27270003
272800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **27280003
272900** THE USER.                                                    **27290003
273000******************************************************************27300003
273100 6000-REFRESH-PANEL-FROM-TEMP.                                    27310003
273200     IF  ASC-UPDATE-TSQ                                           27320003
273300         SET ASC-NO-TSQ-UPDATE TO TRUE                            27330003
273400         MOVE ZERO                 TO PV-SAVE-ITEM                27340003
273500                                      PV-SEL-QUEUE-ITEM           27350003
273600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        27360003
273700                                   TO PV-HOLD-SELECTED-ITEMS      27370003
273800         MOVE +1                   TO PV-ITEMS-PROCESSED          27380003
273900         PERFORM 6100-UPDATE-TSQ                                  27390003
274000             UNTIL PV-ITEMS-PROCESSED >                           27400003
274100                                     PV-HOLD-SELECTED-ITEMS       27410003
274200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27420003
274300                    ASC-BLOCK-ENTRIES (2)                         27430003
274400     END-IF.                                                      27440003
274500                                                                  27450003
274600*----------------------------------------------------------------*27460003
274700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27470003
274800*----------------------------------------------------------------*27480003
274900 6010-DELETE-SEL-QUEUE.                                           27490003
275000                                                                  27500003
275100     EXEC CICS                                                    27510003
275200         DELETEQ TS                                               27520003
275210*** BEGIN - AHP 12/31/07                                          27521024
275300             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       27530022
275310*** END   - AHP 12/31/07                                          27531024
275400             RESP  (PV-CICS-RESP)                                 27540003
275500     END-EXEC.                                                    27550003
275600*                                                                 27560003
275700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27570003
275800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         27580003
275900         CONTINUE                                                 27590003
276000     ELSE                                                         27600003
276100         SET DP013-CICS-ABEND TO TRUE                             27610003
276200         SET DP013-NO-ROLLBACK TO TRUE                            27620003
276300         MOVE '6010-DELETE-SEL-QUEUE'                             27630003
276400                        TO DP013-PARAGRAPH                        27640003
276500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27650003
276600                        TO DP013-MESSAGE-TEXT (1)                 27660003
276700         PERFORM DP013-0000-PROCESS-ABEND                         27670003
276800     END-IF.                                                      27680003
276900                                                                  27690003
277000*----------------------------------------------------------------*27700003
277100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27710003
277200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27720003
277300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27730003
277400*    THE TEMP QUEUE.                                             *27740003
277500*----------------------------------------------------------------*27750003
277600 6100-UPDATE-TSQ.                                                 27760003
277700                                                                  27770003
277800     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27780003
277900     PERFORM 6150-READ-SEL-QUEUE.                                 27790003
278000     PERFORM                                                      27800003
278100         VARYING SU010-IDX                                        27810003
278200         FROM 1 BY 1                                              27820003
278300         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     27830003
278400         OR (SU010-IDX GREATER THAN SU010-MAX-ITEMS))             27840003
278500         IF  SU010-ACTION-SW (SU010-IDX) > SPACE                  27850003
278600             PERFORM 6110-PROCESS-ITEMS                           27860003
278700         END-IF                                                   27870003
278800         ADD +1                TO PV-ITEMS-PROCESSED              27880003
278900     END-PERFORM.                                                 27890003
279000     PERFORM 6111-WRITE-LIST-QUEUE.                               27900003
279100                                                                  27910003
279200*----------------------------------------------------------------*27920003
279300*    READ THE LIST QUEUE RECORD.                                 *27930003
279400*----------------------------------------------------------------*27940003
279500 6150-READ-SEL-QUEUE.                                             27950003
279600                                                                  27960003
279700     EXEC CICS                                                    27970003
279800          READQ TS                                                27980003
279810*** BEGIN - AHP 12/31/07                                          27981024
279900              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      27990022
279910*** END   - AHP 12/31/07                                          27991024
280000              INTO  (SU010-SELECT-RECORD)                         28000003
280100              ITEM  (PV-SEL-QUEUE-ITEM)                           28010003
280200              RESP  (PV-CICS-RESP)                                28020003
280300     END-EXEC.                                                    28030003
280400*                                                                 28040003
280500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28050003
280600         CONTINUE                                                 28060003
280700     ELSE                                                         28070003
280800         SET DP013-CICS-ABEND      TO  TRUE                       28080003
280900         SET DP013-NO-ROLLBACK     TO  TRUE                       28090003
281000         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           28100003
281100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           28110003
281200                                   TO  DP013-MESSAGE-TEXT(1)      28120003
281300         PERFORM DP013-0000-PROCESS-ABEND                         28130003
281400     END-IF.                                                      28140003
281500                                                                  28150003
281600*----------------------------------------------------------------*28160003
281700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*28170003
281800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*28180003
281900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *28190003
282000*----------------------------------------------------------------*28200003
282100 6110-PROCESS-ITEMS.                                              28210003
282200                                                                  28220003
282300     COMPUTE PV-ITEM = 1 + ((SU010-ITEM (SU010-IDX) - 1)          28230003
282400                     / PC-ITEMS-PER-PANEL).                       28240003
282500                                                                  28250003
282600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           28260003
282700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          28270003
282800             PERFORM 6111-WRITE-LIST-QUEUE                        28280003
282900         END-IF                                                   28290003
283000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    28300003
283100                                                                  28310003
283200         PERFORM 6112-READ-LIST-QUEUE                             28320003
283300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               28330003
283400             CONTINUE                                             28340003
283500         END-IF                                                   28350003
283600     END-IF.                                                      28360003
283700                                                                  28370003
283800     COMPUTE PV-SUB = (SU010-ITEM (SU010-IDX)                     28380003
283900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28390003
284000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         28400003
284100     MOVE LQW-SELECTED-SW (PV-SUB)                                28410003
284200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  28420003
284300                                                                  28430003
284400     EVALUATE TRUE                                                28440003
284500         WHEN SU010-INQ (SU010-IDX)                               28450003
284600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             28460003
284700                                                                  28470003
284800         WHEN SU010-UPD (SU010-IDX)                               28480003
284900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             28490003
285000                                                                  28500003
285100         WHEN SU010-DEL (SU010-IDX)                               28510003
285200              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             28520003
285300                                                                  28530003
285400         WHEN SU010-ERR (SU010-IDX)                               28540003
285500              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             28550003
285600     END-EVALUATE.                                                28560003
285700                                                                  28570003
285800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28580003
285900                                                                  28590003
286000*----------------------------------------------------------------*28600003
286100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28610003
286200*----------------------------------------------------------------*28620003
286300 6111-WRITE-LIST-QUEUE.                                           28630003
286400                                                                  28640003
286500     EXEC CICS                                                    28650003
286600         WRITEQ TS                                                28660003
286700             QUEUE (ASC-LIST-QUEUE-NAME)                          28670003
286800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28680003
286900             ITEM  (PV-SAVE-ITEM)                                 28690003
287000             REWRITE                                              28700003
287100             RESP  (PV-CICS-RESP)                                 28710003
287200     END-EXEC.                                                    28720003
287300*                                                                 28730003
287400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28740003
287500         CONTINUE                                                 28750003
287600     ELSE                                                         28760003
287700         SET DP013-CICS-ABEND  TO  TRUE                           28770003
287800         SET DP013-NO-ROLLBACK TO  TRUE                           28780003
287900         MOVE '6111-WRITE-LIST-QUEUE'                             28790003
288000                               TO  DP013-PARAGRAPH                28800003
288100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28810003
288200                               TO  DP013-MESSAGE-TEXT(1)          28820003
288300         PERFORM DP013-0000-PROCESS-ABEND                         28830003
288400     END-IF.                                                      28840003
288500                                                                  28850003
288600*----------------------------------------------------------------*28860003
288700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28870003
288800*----------------------------------------------------------------*28880003
288900 6112-READ-LIST-QUEUE.                                            28890003
289000                                                                  28900003
289100     EXEC CICS                                                    28910003
289200         READQ TS                                                 28920003
289300             QUEUE (ASC-LIST-QUEUE-NAME)                          28930003
289400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28940003
289500             ITEM  (PV-ITEM)                                      28950003
289600             RESP  (PV-CICS-RESP)                                 28960003
289700     END-EXEC.                                                    28970003
289800*                                                                 28980003
289900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28990003
290000         CONTINUE                                                 29000003
290100     ELSE                                                         29010003
290200         SET DP013-CICS-ABEND        TO TRUE                      29020003
290300         SET DP013-NO-ROLLBACK       TO TRUE                      29030003
290400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           29040003
290500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    29050003
290600                                     TO DP013-MESSAGE-TEXT(1)     29060003
290700         PERFORM DP013-0000-PROCESS-ABEND                         29070003
290800     END-IF.                                                      29080003
290900                                                                  29090003
291000*-----------------------------------------------------------------29100003
291100*  READ THE LIST QUEUE RECORD                                     29110003
291200*-----------------------------------------------------------------29120003
291300 9100-READ-SEL-QUEUE.                                             29130003
291400                                                                  29140003
291500     EXEC CICS                                                    29150003
291600         READQ TS                                                 29160003
291610*** BEGIN - AHP 12/31/07                                          29161024
291700             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        29170022
291710*** END   - AHP 12/31/07                                          29171024
291800             INTO  (SU010-SELECT-RECORD)                          29180003
291900             ITEM  (ASC-SEL-ITEM)                                 29190003
292000             RESP  (PV-CICS-RESP)                                 29200003
292100     END-EXEC.                                                    29210003
292200     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        29220003
292300         CONTINUE                                                 29230003
292400     ELSE                                                         29240003
292500         SET DP013-LOGIC-ABEND                                    29250003
292600             DP013-NO-ROLLBACK   TO   TRUE                        29260003
292700         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          29270003
292800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   29280003
292900                                 TO   DP013-MESSAGE-TEXT (1)      29290003
293000         PERFORM DP013-0000-PROCESS-ABEND                         29300003
293100     END-IF.                                                      29310003
293200                                                                  29320003
293300*-----------------------------------------------------------------29330003
293400* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *29340003
293500*-----------------------------------------------------------------29350003
293600 9200-REWRITE-SEL-QUEUE.                                          29360003
293700                                                                  29370003
293800     EXEC CICS                                                    29380003
293900          WRITEQ TS                                               29390003
293910*** BEGIN - AHP 12/31/07                                          29391024
294000              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      29400022
294010*** END   - AHP 12/31/07                                          29401024
294100              FROM   (SU010-SELECT-RECORD)                        29410003
294200              ITEM   (ASC-SEL-ITEM)                               29420003
294300              RESP   (PV-CICS-RESP)                               29430003
294400              REWRITE                                             29440003
294500     END-EXEC.                                                    29450003
294600                                                                  29460003
294700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   29470003
294800         SET DP013-CICS-ABEND                                     29480003
294900             DP013-NO-ROLLBACK     TO TRUE                        29490003
295000         MOVE '9200-REWRITE-SEL-QUEUE'                            29500003
295100                                   TO DP013-PARAGRAPH             29510003
295200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29520003
295300                                   TO DP013-MESSAGE-TEXT (1)      29530003
295400         PERFORM DP013-0000-PROCESS-ABEND                         29540003
295500     END-IF.                                                      29550003
295600                                                                  29560003
295700*----------------------------------------------------------------*29570003
295800*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *29580003
295900*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *29590003
296000*----------------------------------------------------------------*29600003
296100 9900-SOFT-ABORT.                                                 29610003
296200                                                                  29620003
296300     EXEC CICS SYNCPOINT                                          29630003
296400          ROLLBACK                                                29640003
296500     END-EXEC.                                                    29650003
296600                                                                  29660003
296700     SET  PS-ERROR                                                29670003
296800          PS-SOFT-ABORT-ERROR                                     29680003
296900          DP020-MSG-FATAL       TO  TRUE.                         29690003
297000                                                                  29700003
297100*----------------------------------------------------------------*29710003
297200*    ABEND PROCESSOR MODULE                                      *29720003
297300*----------------------------------------------------------------*29730003
297400                                                                  29740003
297500     COPY DPPD013.                                                29750003
